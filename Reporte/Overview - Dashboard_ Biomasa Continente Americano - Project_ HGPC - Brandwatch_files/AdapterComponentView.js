function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};var ownKeys=Object.keys(source);if(typeof Object.getOwnPropertySymbols==="function"){ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))}ownKeys.forEach(function(key){_defineProperty(target,key,source[key])})}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}define(["underscore","backbone","src/views/ComponentView","src/globals/categories","src/globals/tags","src/globals/theme","src/globals/currentDashboard","src/globals/currentProject","src/ReactAppLoader","src/helpers/queueEventsHelper","src/components/chart/helper/dimensionsHelper","src/components/mentions/views/MentionsPopup","src/graphColourRegister"],function(_,Backbone,ComponentView,categoriesGlobal,tagsGlobal,theme,currentDashboard,currentProject,ReactAppLoader,queueEventsHelper,dimensionsHelper,MentionsPopup,graphColourRegister){"use strict";function getColourForDimensionKey(dimension,key){var hexColour=graphColourRegister.getColour(dimension,key);return{name:theme.hex2ColorName(hexColour),hex:hexColour}}var AdapterComponentView=ComponentView.extend({constructor:function AdapterComponentView(){var _this=this;var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};ComponentView.call(this,options);this.adapterView=new ReactAppLoader(options.appKey);this.messageBus=options.messageBus;this.renderProps=options.renderProps;this.listenToMessageBus();this.listenTo(this.model,"sync",function(){_this.messageBus.trigger("data:change",_this.model.toJSON())});this.listenTo(categoriesGlobal,"sync",this.emitGlobalsChange);this.listenTo(tagsGlobal,"sync",this.emitGlobalsChange)},emitGlobalsChange:function emitGlobalsChange(){this.messageBus.trigger("globals:change",this.getGlobals())},getGlobals:function getGlobals(){return{tags:tagsGlobal.toJSON(),categories:categoriesGlobal.toJSON(),currentDashboard:currentDashboard.toJSON(),currentProject:currentProject.toJSON(),utils:{getColourForDimensionKey:getColourForDimensionKey}}},waitingForData:function waitingForData(){this.messageBus.trigger("data:loading")},clearWaitingMessage:function clearWaitingMessage(){this.messageBus.trigger("data:loaded")},showErrorMessage:function showErrorMessage(model,res){var errorMessage=this.getErrorMessage(res);this.messageBus.trigger("data:error",_.unescapeHTML(errorMessage))},showValidationError:function showValidationError(){this.messageBus.trigger("data:error","Please check the Filters section")},listenToMessageBus:function listenToMessageBus(){var _this2=this;var ignoreEvents=["data:error","data:loading","data:loaded","component:ready"];queueEventsHelper.listenForEvents(this.messageBus,ignoreEvents);this.listenTo(this.messageBus,"component:ready",function(){queueEventsHelper.retriggerEvents(_this2.messageBus)});this.listenTo(this.messageBus,"mentionspopup:open",function(dimension1Filter,dimension2Filter){var additionalSettings=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var settings=_this2.model.settings.clone();settings.set(additionalSettings);var additionalOptions=dimensionsHelper.getFilters(dimension1Filter,dimension2Filter,settings)||{};MentionsPopup.showMentions({settings:settings,additionalOptions:additionalOptions})});this.listenTo(this.messageBus,"insightsSidebarActive:toggled",function(active){_this2.renderProps.insightsSidebarActive=active;_this2.render()});this.listenTo(this.messageBus,"data:reload",function(){_this2.model.fetch()})},render:function render(){this.adapterView.render(_objectSpread({messageBus:this.messageBus,settings:_objectSpread({timezone:this.settings.timezone},this.model.settings.toJSON()),data:this.model.toJSON(),globals:this.getGlobals()},this.renderProps));this.$el.append(this.adapterView.$el)},remove:function remove(){if(this.adapterView){this.adapterView.remove();this.adapterView=null}Backbone.View.prototype.remove.apply(this)}});return AdapterComponentView});