(function(){define("underscore",[],function(){"use strict";var _=window._;_.mixin(_.omit(_.string.exports(),"splice"));return _});define("backbone",["underscore"],function(){"use strict";var Backbone=window.Backbone;return Backbone});define("jquery",[],function(){"use strict";var oldOffset=window.jQuery.fn.offset;window.jQuery.fn.offset=function(){var elem=this[0];var origin={top:0,left:0};if(!elem||!elem.nodeType){return origin}var docElem=(elem.ownerDocument||document).documentElement;if(!window.jQuery.contains(docElem,elem)){return origin}return oldOffset.apply(this,arguments)};return window.jQuery});(function(){var async={};var root,previous_async;root=this;if(root!=null){previous_async=root.async}async.noConflict=function(){root.async=previous_async;return async};function only_once(fn){var called=false;return function(){if(called)throw new Error("Callback was already called.");called=true;fn.apply(root,arguments)}}var _each=function(arr,iterator){if(arr.forEach){return arr.forEach(iterator)}for(var i=0;i<arr.length;i+=1){iterator(arr[i],i,arr)}};var _map=function(arr,iterator){if(arr.map){return arr.map(iterator)}var results=[];_each(arr,function(x,i,a){results.push(iterator(x,i,a))});return results};var _reduce=function(arr,iterator,memo){if(arr.reduce){return arr.reduce(iterator,memo)}_each(arr,function(x,i,a){memo=iterator(memo,x,i,a)});return memo};var _keys=function(obj){if(Object.keys){return Object.keys(obj)}var keys=[];for(var k in obj){if(obj.hasOwnProperty(k)){keys.push(k)}}return keys};if(typeof process==="undefined"||!process.nextTick){if(typeof setImmediate==="function"){async.nextTick=function(fn){setImmediate(fn)}}else{async.nextTick=function(fn){setTimeout(fn,0)}}}else{async.nextTick=process.nextTick}async.each=function(arr,iterator,callback){callback=callback||function(){};if(!arr.length){return callback()}var completed=0;_each(arr,function(x){iterator(x,only_once(function(err){if(err){callback(err);callback=function(){}}else{completed+=1;if(completed>=arr.length){callback(null)}}}))})};async.forEach=async.each;async.eachSeries=function(arr,iterator,callback){callback=callback||function(){};if(!arr.length){return callback()}var completed=0;var iterate=function(){var sync=true;iterator(arr[completed],function(err){if(err){callback(err);callback=function(){}}else{completed+=1;if(completed>=arr.length){callback(null)}else{if(sync){async.nextTick(iterate)}else{iterate()}}}});sync=false};iterate()};async.forEachSeries=async.eachSeries;async.eachLimit=function(arr,limit,iterator,callback){var fn=_eachLimit(limit);fn.apply(null,[arr,iterator,callback])};async.forEachLimit=async.eachLimit;var _eachLimit=function(limit){return function(arr,iterator,callback){callback=callback||function(){};if(!arr.length||limit<=0){return callback()}var completed=0;var started=0;var running=0;(function replenish(){if(completed>=arr.length){return callback()}while(running<limit&&started<arr.length){started+=1;running+=1;iterator(arr[started-1],function(err){if(err){callback(err);callback=function(){}}else{completed+=1;running-=1;if(completed>=arr.length){callback()}else{replenish()}}})}})()}};var doParallel=function(fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[async.each].concat(args))}};var doParallelLimit=function(limit,fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[_eachLimit(limit)].concat(args))}};var doSeries=function(fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[async.eachSeries].concat(args))}};var _asyncMap=function(eachfn,arr,iterator,callback){var results=[];arr=_map(arr,function(x,i){return{index:i,value:x}});eachfn(arr,function(x,callback){iterator(x.value,function(err,v){results[x.index]=v;callback(err)})},function(err){callback(err,results)})};async.map=doParallel(_asyncMap);async.mapSeries=doSeries(_asyncMap);async.mapLimit=function(arr,limit,iterator,callback){return _mapLimit(limit)(arr,iterator,callback)};var _mapLimit=function(limit){return doParallelLimit(limit,_asyncMap)};async.reduce=function(arr,memo,iterator,callback){async.eachSeries(arr,function(x,callback){iterator(memo,x,function(err,v){memo=v;callback(err)})},function(err){callback(err,memo)})};async.inject=async.reduce;async.foldl=async.reduce;async.reduceRight=function(arr,memo,iterator,callback){var reversed=_map(arr,function(x){return x}).reverse();async.reduce(reversed,memo,iterator,callback)};async.foldr=async.reduceRight;var _filter=function(eachfn,arr,iterator,callback){var results=[];arr=_map(arr,function(x,i){return{index:i,value:x}});eachfn(arr,function(x,callback){iterator(x.value,function(v){if(v){results.push(x)}callback()})},function(err){callback(_map(results.sort(function(a,b){return a.index-b.index}),function(x){return x.value}))})};async.filter=doParallel(_filter);async.filterSeries=doSeries(_filter);async.select=async.filter;async.selectSeries=async.filterSeries;var _reject=function(eachfn,arr,iterator,callback){var results=[];arr=_map(arr,function(x,i){return{index:i,value:x}});eachfn(arr,function(x,callback){iterator(x.value,function(v){if(!v){results.push(x)}callback()})},function(err){callback(_map(results.sort(function(a,b){return a.index-b.index}),function(x){return x.value}))})};async.reject=doParallel(_reject);async.rejectSeries=doSeries(_reject);var _detect=function(eachfn,arr,iterator,main_callback){eachfn(arr,function(x,callback){iterator(x,function(result){if(result){main_callback(x);main_callback=function(){}}else{callback()}})},function(err){main_callback()})};async.detect=doParallel(_detect);async.detectSeries=doSeries(_detect);async.some=function(arr,iterator,main_callback){async.each(arr,function(x,callback){iterator(x,function(v){if(v){main_callback(true);main_callback=function(){}}callback()})},function(err){main_callback(false)})};async.any=async.some;async.every=function(arr,iterator,main_callback){async.each(arr,function(x,callback){iterator(x,function(v){if(!v){main_callback(false);main_callback=function(){}}callback()})},function(err){main_callback(true)})};async.all=async.every;async.sortBy=function(arr,iterator,callback){async.map(arr,function(x,callback){iterator(x,function(err,criteria){if(err){callback(err)}else{callback(null,{value:x,criteria:criteria})}})},function(err,results){if(err){return callback(err)}else{var fn=function(left,right){var a=left.criteria,b=right.criteria;return a<b?-1:a>b?1:0};callback(null,_map(results.sort(fn),function(x){return x.value}))}})};async.auto=function(tasks,callback){callback=callback||function(){};var keys=_keys(tasks);if(!keys.length){return callback(null)}var results={};var listeners=[];var addListener=function(fn){listeners.unshift(fn)};var removeListener=function(fn){for(var i=0;i<listeners.length;i+=1){if(listeners[i]===fn){listeners.splice(i,1);return}}};var taskComplete=function(){_each(listeners.slice(0),function(fn){fn()})};addListener(function(){if(_keys(results).length===keys.length){callback(null,results);callback=function(){}}});_each(keys,function(k){var task=tasks[k]instanceof Function?[tasks[k]]:tasks[k];var taskCallback=function(err){if(err){callback(err);callback=function(){}}else{var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}results[k]=args;async.nextTick(taskComplete)}};var requires=task.slice(0,Math.abs(task.length-1))||[];var ready=function(){return _reduce(requires,function(a,x){return a&&results.hasOwnProperty(x)},true)&&!results.hasOwnProperty(k)};if(ready()){task[task.length-1](taskCallback,results)}else{var listener=function(){if(ready()){removeListener(listener);task[task.length-1](taskCallback,results)}};addListener(listener)}})};async.waterfall=function(tasks,callback){callback=callback||function(){};if(!tasks.length){return callback()}var wrapIterator=function(iterator){return function(err){if(err){callback.apply(null,arguments);callback=function(){}}else{var args=Array.prototype.slice.call(arguments,1);var next=iterator.next();if(next){args.push(wrapIterator(next))}else{args.push(callback)}async.nextTick(function(){iterator.apply(null,args)})}}};wrapIterator(async.iterator(tasks))()};var _parallel=function(eachfn,tasks,callback){callback=callback||function(){};if(tasks.constructor===Array){eachfn.map(tasks,function(fn,callback){if(fn){fn(function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}callback.call(null,err,args)})}},callback)}else{var results={};eachfn.each(_keys(tasks),function(k,callback){tasks[k](function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}results[k]=args;callback(err)})},function(err){callback(err,results)})}};async.parallel=function(tasks,callback){_parallel({map:async.map,each:async.each},tasks,callback)};async.parallelLimit=function(tasks,limit,callback){_parallel({map:_mapLimit(limit),each:_eachLimit(limit)},tasks,callback)};async.series=function(tasks,callback){callback=callback||function(){};if(tasks.constructor===Array){async.mapSeries(tasks,function(fn,callback){if(fn){fn(function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}callback.call(null,err,args)})}},callback)}else{var results={};async.eachSeries(_keys(tasks),function(k,callback){tasks[k](function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}results[k]=args;callback(err)})},function(err){callback(err,results)})}};async.iterator=function(tasks){var makeCallback=function(index){var fn=function(){if(tasks.length){tasks[index].apply(null,arguments)}return fn.next()};fn.next=function(){return index<tasks.length-1?makeCallback(index+1):null};return fn};return makeCallback(0)};async.apply=function(fn){var args=Array.prototype.slice.call(arguments,1);return function(){return fn.apply(null,args.concat(Array.prototype.slice.call(arguments)))}};var _concat=function(eachfn,arr,fn,callback){var r=[];eachfn(arr,function(x,cb){fn(x,function(err,y){r=r.concat(y||[]);cb(err)})},function(err){callback(err,r)})};async.concat=doParallel(_concat);async.concatSeries=doSeries(_concat);async.whilst=function(test,iterator,callback){if(test()){var sync=true;iterator(function(err){if(err){return callback(err)}if(sync){async.nextTick(function(){async.whilst(test,iterator,callback)})}else{async.whilst(test,iterator,callback)}});sync=false}else{callback()}};async.doWhilst=function(iterator,test,callback){var sync=true;iterator(function(err){if(err){return callback(err)}if(test()){if(sync){async.nextTick(function(){async.doWhilst(iterator,test,callback)})}else{async.doWhilst(iterator,test,callback)}}else{callback()}});sync=false};async.until=function(test,iterator,callback){if(!test()){var sync=true;iterator(function(err){if(err){return callback(err)}if(sync){async.nextTick(function(){async.until(test,iterator,callback)})}else{async.until(test,iterator,callback)}});sync=false}else{callback()}};async.doUntil=function(iterator,test,callback){var sync=true;iterator(function(err){if(err){return callback(err)}if(!test()){if(sync){async.nextTick(function(){async.doUntil(iterator,test,callback)})}else{async.doUntil(iterator,test,callback)}}else{callback()}});sync=false};async.queue=function(worker,concurrency){function _insert(q,data,pos,callback){if(data.constructor!==Array){data=[data]}_each(data,function(task){var item={data:task,callback:typeof callback==="function"?callback:null};if(pos){q.tasks.unshift(item)}else{q.tasks.push(item)}if(q.saturated&&q.tasks.length===concurrency){q.saturated()}async.nextTick(q.process)})}var workers=0;var q={tasks:[],concurrency:concurrency,saturated:null,empty:null,drain:null,push:function(data,callback){_insert(q,data,false,callback)},unshift:function(data,callback){_insert(q,data,true,callback)},process:function(){if(workers<q.concurrency&&q.tasks.length){var task=q.tasks.shift();if(q.empty&&q.tasks.length===0){q.empty()}workers+=1;var sync=true;var next=function(){workers-=1;if(task.callback){task.callback.apply(task,arguments)}if(q.drain&&q.tasks.length+workers===0){q.drain()}q.process()};var cb=only_once(function(){var cbArgs=arguments;if(sync){async.nextTick(function(){next.apply(null,cbArgs)})}else{next.apply(null,arguments)}});worker(task.data,cb);sync=false}},length:function(){return q.tasks.length},running:function(){return workers}};return q};async.cargo=function(worker,payload){var working=false,tasks=[];var cargo={tasks:tasks,payload:payload,saturated:null,empty:null,drain:null,push:function(data,callback){if(data.constructor!==Array){data=[data]}_each(data,function(task){tasks.push({data:task,callback:typeof callback==="function"?callback:null});if(cargo.saturated&&tasks.length===payload){cargo.saturated()}});async.nextTick(cargo.process)},process:function process(){if(working)return;if(tasks.length===0){if(cargo.drain)cargo.drain();return}var ts=typeof payload==="number"?tasks.splice(0,payload):tasks.splice(0);var ds=_map(ts,function(task){return task.data});if(cargo.empty)cargo.empty();working=true;worker(ds,function(){working=false;var args=arguments;_each(ts,function(data){if(data.callback){data.callback.apply(null,args)}});process()})},length:function(){return tasks.length},running:function(){return working}};return cargo};var _console_fn=function(name){return function(fn){var args=Array.prototype.slice.call(arguments,1);fn.apply(null,args.concat([function(err){var args=Array.prototype.slice.call(arguments,1);if(typeof console!=="undefined"){if(err){if(console.error){console.error(err)}}else if(console[name]){_each(args,function(x){console[name](x)})}}}]))}};async.log=_console_fn("log");async.dir=_console_fn("dir");async.memoize=function(fn,hasher){var memo={};var queues={};hasher=hasher||function(x){return x};var memoized=function(){var args=Array.prototype.slice.call(arguments);var callback=args.pop();var key=hasher.apply(null,args);if(key in memo){callback.apply(null,memo[key])}else if(key in queues){queues[key].push(callback)}else{queues[key]=[callback];fn.apply(null,args.concat([function(){memo[key]=arguments;var q=queues[key];delete queues[key];for(var i=0,l=q.length;i<l;i++){q[i].apply(null,arguments)}}]))}};memoized.memo=memo;memoized.unmemoized=fn;return memoized};async.unmemoize=function(fn){return function(){return(fn.unmemoized||fn).apply(null,arguments)}};async.times=function(count,iterator,callback){var counter=[];for(var i=0;i<count;i++){counter.push(i)}return async.map(counter,iterator,callback)};async.timesSeries=function(count,iterator,callback){var counter=[];for(var i=0;i<count;i++){counter.push(i)}return async.mapSeries(counter,iterator,callback)};async.compose=function(){var fns=Array.prototype.reverse.call(arguments);return function(){var that=this;var args=Array.prototype.slice.call(arguments);var callback=args.pop();async.reduce(fns,args,function(newargs,fn,cb){fn.apply(that,newargs.concat([function(){var err=arguments[0];var nextargs=Array.prototype.slice.call(arguments,1);cb(err,nextargs)}]))},function(err,results){callback.apply(that,[err].concat(results))})}};if(typeof define!=="undefined"&&define.amd){define("async",[],function(){return async})}else if(typeof module!=="undefined"&&module.exports){module.exports=async}else{root.async=async}})();(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?module.exports=factory():typeof define==="function"&&define.amd?define("moment",factory):global.moment=factory()})(this,function(){"use strict";var hookCallback;function hooks(){return hookCallback.apply(null,arguments)}function setHookCallback(callback){hookCallback=callback}function isArray(input){return input instanceof Array||Object.prototype.toString.call(input)==="[object Array]"}function isObject(input){return input!=null&&Object.prototype.toString.call(input)==="[object Object]"}function isObjectEmpty(obj){if(Object.getOwnPropertyNames){return Object.getOwnPropertyNames(obj).length===0}else{var k;for(k in obj){if(obj.hasOwnProperty(k)){return false}}return true}}function isUndefined(input){return input===void 0}function isNumber(input){return typeof input==="number"||Object.prototype.toString.call(input)==="[object Number]"}function isDate(input){return input instanceof Date||Object.prototype.toString.call(input)==="[object Date]"}function map(arr,fn){var res=[],i;for(i=0;i<arr.length;++i){res.push(fn(arr[i],i))}return res}function hasOwnProp(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function extend(a,b){for(var i in b){if(hasOwnProp(b,i)){a[i]=b[i]}}if(hasOwnProp(b,"toString")){a.toString=b.toString}if(hasOwnProp(b,"valueOf")){a.valueOf=b.valueOf}return a}function createUTC(input,format,locale,strict){return createLocalOrUTC(input,format,locale,strict,true).utc()}function defaultParsingFlags(){return{empty:false,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:false,invalidMonth:null,invalidFormat:false,userInvalidated:false,iso:false,parsedDateParts:[],meridiem:null,rfc2822:false,weekdayMismatch:false}}function getParsingFlags(m){if(m._pf==null){m._pf=defaultParsingFlags()}return m._pf}var some;if(Array.prototype.some){some=Array.prototype.some}else{some=function(fun){var t=Object(this);var len=t.length>>>0;for(var i=0;i<len;i++){if(i in t&&fun.call(this,t[i],i,t)){return true}}return false}}function isValid(m){if(m._isValid==null){var flags=getParsingFlags(m);var parsedParts=some.call(flags.parsedDateParts,function(i){return i!=null});var isNowValid=!isNaN(m._d.getTime())&&flags.overflow<0&&!flags.empty&&!flags.invalidMonth&&!flags.invalidWeekday&&!flags.weekdayMismatch&&!flags.nullInput&&!flags.invalidFormat&&!flags.userInvalidated&&(!flags.meridiem||flags.meridiem&&parsedParts);if(m._strict){isNowValid=isNowValid&&flags.charsLeftOver===0&&flags.unusedTokens.length===0&&flags.bigHour===undefined}if(Object.isFrozen==null||!Object.isFrozen(m)){m._isValid=isNowValid}else{return isNowValid}}return m._isValid}function createInvalid(flags){var m=createUTC(NaN);if(flags!=null){extend(getParsingFlags(m),flags)}else{getParsingFlags(m).userInvalidated=true}return m}var momentProperties=hooks.momentProperties=[];function copyConfig(to,from){var i,prop,val;if(!isUndefined(from._isAMomentObject)){to._isAMomentObject=from._isAMomentObject}if(!isUndefined(from._i)){to._i=from._i}if(!isUndefined(from._f)){to._f=from._f}if(!isUndefined(from._l)){to._l=from._l}if(!isUndefined(from._strict)){to._strict=from._strict}if(!isUndefined(from._tzm)){to._tzm=from._tzm}if(!isUndefined(from._isUTC)){to._isUTC=from._isUTC}if(!isUndefined(from._offset)){to._offset=from._offset}if(!isUndefined(from._pf)){to._pf=getParsingFlags(from)}if(!isUndefined(from._locale)){to._locale=from._locale}if(momentProperties.length>0){for(i=0;i<momentProperties.length;i++){prop=momentProperties[i];val=from[prop];if(!isUndefined(val)){to[prop]=val}}}return to}var updateInProgress=false;function Moment(config){copyConfig(this,config);this._d=new Date(config._d!=null?config._d.getTime():NaN);if(!this.isValid()){this._d=new Date(NaN)}if(updateInProgress===false){updateInProgress=true;hooks.updateOffset(this);updateInProgress=false}}function isMoment(obj){return obj instanceof Moment||obj!=null&&obj._isAMomentObject!=null}function absFloor(number){if(number<0){return Math.ceil(number)||0}else{return Math.floor(number)}}function toInt(argumentForCoercion){var coercedNumber=+argumentForCoercion,value=0;if(coercedNumber!==0&&isFinite(coercedNumber)){value=absFloor(coercedNumber)}return value}function compareArrays(array1,array2,dontConvert){var len=Math.min(array1.length,array2.length),lengthDiff=Math.abs(array1.length-array2.length),diffs=0,i;for(i=0;i<len;i++){if(dontConvert&&array1[i]!==array2[i]||!dontConvert&&toInt(array1[i])!==toInt(array2[i])){diffs++}}return diffs+lengthDiff}function warn(msg){if(hooks.suppressDeprecationWarnings===false&&typeof console!=="undefined"&&console.warn){console.warn("Deprecation warning: "+msg)}}function deprecate(msg,fn){var firstTime=true;return extend(function(){if(hooks.deprecationHandler!=null){hooks.deprecationHandler(null,msg)}if(firstTime){var args=[];var arg;for(var i=0;i<arguments.length;i++){arg="";if(typeof arguments[i]==="object"){arg+="\n["+i+"] ";for(var key in arguments[0]){arg+=key+": "+arguments[0][key]+", "}arg=arg.slice(0,-2)}else{arg=arguments[i]}args.push(arg)}warn(msg+"\nArguments: "+Array.prototype.slice.call(args).join("")+"\n"+(new Error).stack);firstTime=false}return fn.apply(this,arguments)},fn)}var deprecations={};function deprecateSimple(name,msg){if(hooks.deprecationHandler!=null){hooks.deprecationHandler(name,msg)}if(!deprecations[name]){warn(msg);deprecations[name]=true}}hooks.suppressDeprecationWarnings=false;hooks.deprecationHandler=null;function isFunction(input){return input instanceof Function||Object.prototype.toString.call(input)==="[object Function]"}function set(config){var prop,i;for(i in config){prop=config[i];if(isFunction(prop)){this[i]=prop}else{this["_"+i]=prop}}this._config=config;this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)}function mergeConfigs(parentConfig,childConfig){var res=extend({},parentConfig),prop;for(prop in childConfig){if(hasOwnProp(childConfig,prop)){if(isObject(parentConfig[prop])&&isObject(childConfig[prop])){res[prop]={};extend(res[prop],parentConfig[prop]);extend(res[prop],childConfig[prop])}else if(childConfig[prop]!=null){res[prop]=childConfig[prop]}else{delete res[prop]}}}for(prop in parentConfig){if(hasOwnProp(parentConfig,prop)&&!hasOwnProp(childConfig,prop)&&isObject(parentConfig[prop])){res[prop]=extend({},res[prop])}}return res}function Locale(config){if(config!=null){this.set(config)}}var keys;if(Object.keys){keys=Object.keys}else{keys=function(obj){var i,res=[];for(i in obj){if(hasOwnProp(obj,i)){res.push(i)}}return res}}var defaultCalendar={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"};function calendar(key,mom,now){var output=this._calendar[key]||this._calendar["sameElse"];return isFunction(output)?output.call(mom,now):output}var defaultLongDateFormat={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};function longDateFormat(key){var format=this._longDateFormat[key],formatUpper=this._longDateFormat[key.toUpperCase()];if(format||!formatUpper){return format}this._longDateFormat[key]=formatUpper.replace(/MMMM|MM|DD|dddd/g,function(val){return val.slice(1)});return this._longDateFormat[key]}var defaultInvalidDate="Invalid date";function invalidDate(){return this._invalidDate}var defaultOrdinal="%d";var defaultDayOfMonthOrdinalParse=/\d{1,2}/;function ordinal(number){return this._ordinal.replace("%d",number)}var defaultRelativeTime={future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function relativeTime(number,withoutSuffix,string,isFuture){var output=this._relativeTime[string];return isFunction(output)?output(number,withoutSuffix,string,isFuture):output.replace(/%d/i,number)}function pastFuture(diff,output){var format=this._relativeTime[diff>0?"future":"past"];return isFunction(format)?format(output):format.replace(/%s/i,output)}var aliases={};function addUnitAlias(unit,shorthand){var lowerCase=unit.toLowerCase();aliases[lowerCase]=aliases[lowerCase+"s"]=aliases[shorthand]=unit}function normalizeUnits(units){return typeof units==="string"?aliases[units]||aliases[units.toLowerCase()]:undefined}function normalizeObjectUnits(inputObject){var normalizedInput={},normalizedProp,prop;for(prop in inputObject){if(hasOwnProp(inputObject,prop)){normalizedProp=normalizeUnits(prop);if(normalizedProp){normalizedInput[normalizedProp]=inputObject[prop]}}}return normalizedInput}var priorities={};function addUnitPriority(unit,priority){priorities[unit]=priority}function getPrioritizedUnits(unitsObj){var units=[];for(var u in unitsObj){units.push({unit:u,priority:priorities[u]})}units.sort(function(a,b){return a.priority-b.priority});return units}function zeroFill(number,targetLength,forceSign){var absNumber=""+Math.abs(number),zerosToFill=targetLength-absNumber.length,sign=number>=0;return(sign?forceSign?"+":"":"-")+Math.pow(10,Math.max(0,zerosToFill)).toString().substr(1)+absNumber}var formattingTokens=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;var localFormattingTokens=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g;var formatFunctions={};var formatTokenFunctions={};function addFormatToken(token,padded,ordinal,callback){var func=callback;if(typeof callback==="string"){func=function(){return this[callback]()}}if(token){formatTokenFunctions[token]=func}if(padded){formatTokenFunctions[padded[0]]=function(){return zeroFill(func.apply(this,arguments),padded[1],padded[2])}}if(ordinal){formatTokenFunctions[ordinal]=function(){return this.localeData().ordinal(func.apply(this,arguments),token)}}}function removeFormattingTokens(input){if(input.match(/\[[\s\S]/)){return input.replace(/^\[|\]$/g,"")}return input.replace(/\\/g,"")}function makeFormatFunction(format){var array=format.match(formattingTokens),i,length;for(i=0,length=array.length;i<length;i++){if(formatTokenFunctions[array[i]]){array[i]=formatTokenFunctions[array[i]]}else{array[i]=removeFormattingTokens(array[i])}}return function(mom){var output="",i;for(i=0;i<length;i++){output+=isFunction(array[i])?array[i].call(mom,format):array[i]}return output}}function formatMoment(m,format){if(!m.isValid()){return m.localeData().invalidDate()}format=expandFormat(format,m.localeData());formatFunctions[format]=formatFunctions[format]||makeFormatFunction(format);return formatFunctions[format](m)}function expandFormat(format,locale){var i=5;function replaceLongDateFormatTokens(input){return locale.longDateFormat(input)||input}localFormattingTokens.lastIndex=0;while(i>=0&&localFormattingTokens.test(format)){format=format.replace(localFormattingTokens,replaceLongDateFormatTokens);localFormattingTokens.lastIndex=0;i-=1}return format}var match1=/\d/;var match2=/\d\d/;var match3=/\d{3}/;var match4=/\d{4}/;var match6=/[+-]?\d{6}/;var match1to2=/\d\d?/;var match3to4=/\d\d\d\d?/;var match5to6=/\d\d\d\d\d\d?/;var match1to3=/\d{1,3}/;var match1to4=/\d{1,4}/;var match1to6=/[+-]?\d{1,6}/;var matchUnsigned=/\d+/;var matchSigned=/[+-]?\d+/;var matchOffset=/Z|[+-]\d\d:?\d\d/gi;var matchShortOffset=/Z|[+-]\d\d(?::?\d\d)?/gi;var matchTimestamp=/[+-]?\d+(\.\d{1,3})?/;var matchWord=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i;var regexes={};function addRegexToken(token,regex,strictRegex){regexes[token]=isFunction(regex)?regex:function(isStrict,localeData){return isStrict&&strictRegex?strictRegex:regex}}function getParseRegexForToken(token,config){if(!hasOwnProp(regexes,token)){return new RegExp(unescapeFormat(token))}return regexes[token](config._strict,config._locale)}function unescapeFormat(s){return regexEscape(s.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(matched,p1,p2,p3,p4){return p1||p2||p3||p4}))}function regexEscape(s){return s.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}var tokens={};function addParseToken(token,callback){var i,func=callback;if(typeof token==="string"){token=[token]}if(isNumber(callback)){func=function(input,array){array[callback]=toInt(input)}}for(i=0;i<token.length;i++){tokens[token[i]]=func}}function addWeekParseToken(token,callback){addParseToken(token,function(input,array,config,token){config._w=config._w||{};callback(input,config._w,config,token)})}function addTimeToArrayFromToken(token,input,config){if(input!=null&&hasOwnProp(tokens,token)){tokens[token](input,config._a,config,token)}}var YEAR=0;var MONTH=1;var DATE=2;var HOUR=3;var MINUTE=4;var SECOND=5;var MILLISECOND=6;var WEEK=7;var WEEKDAY=8;addFormatToken("Y",0,0,function(){var y=this.year();return y<=9999?""+y:"+"+y});addFormatToken(0,["YY",2],0,function(){return this.year()%100});addFormatToken(0,["YYYY",4],0,"year");addFormatToken(0,["YYYYY",5],0,"year");addFormatToken(0,["YYYYYY",6,true],0,"year");addUnitAlias("year","y");addUnitPriority("year",1);addRegexToken("Y",matchSigned);addRegexToken("YY",match1to2,match2);addRegexToken("YYYY",match1to4,match4);addRegexToken("YYYYY",match1to6,match6);addRegexToken("YYYYYY",match1to6,match6);addParseToken(["YYYYY","YYYYYY"],YEAR);addParseToken("YYYY",function(input,array){array[YEAR]=input.length===2?hooks.parseTwoDigitYear(input):toInt(input)});addParseToken("YY",function(input,array){array[YEAR]=hooks.parseTwoDigitYear(input)});addParseToken("Y",function(input,array){array[YEAR]=parseInt(input,10)});function daysInYear(year){return isLeapYear(year)?366:365}function isLeapYear(year){return year%4===0&&year%100!==0||year%400===0}hooks.parseTwoDigitYear=function(input){return toInt(input)+(toInt(input)>68?1900:2e3)};var getSetYear=makeGetSet("FullYear",true);function getIsLeapYear(){return isLeapYear(this.year())}function makeGetSet(unit,keepTime){return function(value){if(value!=null){set$1(this,unit,value);hooks.updateOffset(this,keepTime);return this}else{return get(this,unit)}}}function get(mom,unit){return mom.isValid()?mom._d["get"+(mom._isUTC?"UTC":"")+unit]():NaN}function set$1(mom,unit,value){if(mom.isValid()&&!isNaN(value)){if(unit==="FullYear"&&isLeapYear(mom.year())&&mom.month()===1&&mom.date()===29){mom._d["set"+(mom._isUTC?"UTC":"")+unit](value,mom.month(),daysInMonth(value,mom.month()))}else{mom._d["set"+(mom._isUTC?"UTC":"")+unit](value)}}}function stringGet(units){units=normalizeUnits(units);if(isFunction(this[units])){return this[units]()}return this}function stringSet(units,value){if(typeof units==="object"){units=normalizeObjectUnits(units);var prioritized=getPrioritizedUnits(units);for(var i=0;i<prioritized.length;i++){this[prioritized[i].unit](units[prioritized[i].unit])}}else{units=normalizeUnits(units);if(isFunction(this[units])){return this[units](value)}}return this}function mod(n,x){return(n%x+x)%x}var indexOf;if(Array.prototype.indexOf){indexOf=Array.prototype.indexOf}else{indexOf=function(o){var i;for(i=0;i<this.length;++i){if(this[i]===o){return i}}return-1}}function daysInMonth(year,month){if(isNaN(year)||isNaN(month)){return NaN}var modMonth=mod(month,12);year+=(month-modMonth)/12;return modMonth===1?isLeapYear(year)?29:28:31-modMonth%7%2}addFormatToken("M",["MM",2],"Mo",function(){return this.month()+1});addFormatToken("MMM",0,0,function(format){return this.localeData().monthsShort(this,format)});addFormatToken("MMMM",0,0,function(format){return this.localeData().months(this,format)});addUnitAlias("month","M");addUnitPriority("month",8);addRegexToken("M",match1to2);addRegexToken("MM",match1to2,match2);addRegexToken("MMM",function(isStrict,locale){return locale.monthsShortRegex(isStrict)});addRegexToken("MMMM",function(isStrict,locale){return locale.monthsRegex(isStrict)});addParseToken(["M","MM"],function(input,array){array[MONTH]=toInt(input)-1});addParseToken(["MMM","MMMM"],function(input,array,config,token){var month=config._locale.monthsParse(input,token,config._strict);if(month!=null){array[MONTH]=month}else{getParsingFlags(config).invalidMonth=input}});var MONTHS_IN_FORMAT=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/;var defaultLocaleMonths="January_February_March_April_May_June_July_August_September_October_November_December".split("_");function localeMonths(m,format){if(!m){return isArray(this._months)?this._months:this._months["standalone"]}return isArray(this._months)?this._months[m.month()]:this._months[(this._months.isFormat||MONTHS_IN_FORMAT).test(format)?"format":"standalone"][m.month()]}var defaultLocaleMonthsShort="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_");function localeMonthsShort(m,format){if(!m){return isArray(this._monthsShort)?this._monthsShort:this._monthsShort["standalone"]}return isArray(this._monthsShort)?this._monthsShort[m.month()]:this._monthsShort[MONTHS_IN_FORMAT.test(format)?"format":"standalone"][m.month()]}function handleStrictParse(monthName,format,strict){var i,ii,mom,llc=monthName.toLocaleLowerCase();if(!this._monthsParse){this._monthsParse=[];this._longMonthsParse=[];this._shortMonthsParse=[];for(i=0;i<12;++i){mom=createUTC([2e3,i]);this._shortMonthsParse[i]=this.monthsShort(mom,"").toLocaleLowerCase();this._longMonthsParse[i]=this.months(mom,"").toLocaleLowerCase()}}if(strict){if(format==="MMM"){ii=indexOf.call(this._shortMonthsParse,llc);return ii!==-1?ii:null}else{ii=indexOf.call(this._longMonthsParse,llc);return ii!==-1?ii:null}}else{if(format==="MMM"){ii=indexOf.call(this._shortMonthsParse,llc);if(ii!==-1){return ii}ii=indexOf.call(this._longMonthsParse,llc);return ii!==-1?ii:null}else{ii=indexOf.call(this._longMonthsParse,llc);if(ii!==-1){return ii}ii=indexOf.call(this._shortMonthsParse,llc);return ii!==-1?ii:null}}}function localeMonthsParse(monthName,format,strict){var i,mom,regex;if(this._monthsParseExact){return handleStrictParse.call(this,monthName,format,strict)}if(!this._monthsParse){this._monthsParse=[];this._longMonthsParse=[];this._shortMonthsParse=[]}for(i=0;i<12;i++){mom=createUTC([2e3,i]);if(strict&&!this._longMonthsParse[i]){this._longMonthsParse[i]=new RegExp("^"+this.months(mom,"").replace(".","")+"$","i");this._shortMonthsParse[i]=new RegExp("^"+this.monthsShort(mom,"").replace(".","")+"$","i")}if(!strict&&!this._monthsParse[i]){regex="^"+this.months(mom,"")+"|^"+this.monthsShort(mom,"");this._monthsParse[i]=new RegExp(regex.replace(".",""),"i")}if(strict&&format==="MMMM"&&this._longMonthsParse[i].test(monthName)){return i}else if(strict&&format==="MMM"&&this._shortMonthsParse[i].test(monthName)){return i}else if(!strict&&this._monthsParse[i].test(monthName)){return i}}}function setMonth(mom,value){var dayOfMonth;if(!mom.isValid()){return mom}if(typeof value==="string"){if(/^\d+$/.test(value)){value=toInt(value)}else{value=mom.localeData().monthsParse(value);if(!isNumber(value)){return mom}}}dayOfMonth=Math.min(mom.date(),daysInMonth(mom.year(),value));mom._d["set"+(mom._isUTC?"UTC":"")+"Month"](value,dayOfMonth);return mom}function getSetMonth(value){if(value!=null){setMonth(this,value);hooks.updateOffset(this,true);return this}else{return get(this,"Month")}}function getDaysInMonth(){return daysInMonth(this.year(),this.month())}var defaultMonthsShortRegex=matchWord;function monthsShortRegex(isStrict){if(this._monthsParseExact){if(!hasOwnProp(this,"_monthsRegex")){computeMonthsParse.call(this)}if(isStrict){return this._monthsShortStrictRegex}else{return this._monthsShortRegex}}else{if(!hasOwnProp(this,"_monthsShortRegex")){this._monthsShortRegex=defaultMonthsShortRegex}return this._monthsShortStrictRegex&&isStrict?this._monthsShortStrictRegex:this._monthsShortRegex}}var defaultMonthsRegex=matchWord;function monthsRegex(isStrict){if(this._monthsParseExact){if(!hasOwnProp(this,"_monthsRegex")){computeMonthsParse.call(this)}if(isStrict){return this._monthsStrictRegex}else{return this._monthsRegex}}else{if(!hasOwnProp(this,"_monthsRegex")){this._monthsRegex=defaultMonthsRegex}return this._monthsStrictRegex&&isStrict?this._monthsStrictRegex:this._monthsRegex}}function computeMonthsParse(){function cmpLenRev(a,b){return b.length-a.length}var shortPieces=[],longPieces=[],mixedPieces=[],i,mom;for(i=0;i<12;i++){mom=createUTC([2e3,i]);shortPieces.push(this.monthsShort(mom,""));longPieces.push(this.months(mom,""));mixedPieces.push(this.months(mom,""));mixedPieces.push(this.monthsShort(mom,""))}shortPieces.sort(cmpLenRev);longPieces.sort(cmpLenRev);mixedPieces.sort(cmpLenRev);for(i=0;i<12;i++){shortPieces[i]=regexEscape(shortPieces[i]);longPieces[i]=regexEscape(longPieces[i])}for(i=0;i<24;i++){mixedPieces[i]=regexEscape(mixedPieces[i])}this._monthsRegex=new RegExp("^("+mixedPieces.join("|")+")","i");this._monthsShortRegex=this._monthsRegex;this._monthsStrictRegex=new RegExp("^("+longPieces.join("|")+")","i");this._monthsShortStrictRegex=new RegExp("^("+shortPieces.join("|")+")","i")}function createDate(y,m,d,h,M,s,ms){var date=new Date(y,m,d,h,M,s,ms);if(y<100&&y>=0&&isFinite(date.getFullYear())){date.setFullYear(y)}return date}function createUTCDate(y){var date=new Date(Date.UTC.apply(null,arguments));if(y<100&&y>=0&&isFinite(date.getUTCFullYear())){date.setUTCFullYear(y)}return date}function firstWeekOffset(year,dow,doy){var fwd=7+dow-doy,fwdlw=(7+createUTCDate(year,0,fwd).getUTCDay()-dow)%7;return-fwdlw+fwd-1}function dayOfYearFromWeeks(year,week,weekday,dow,doy){var localWeekday=(7+weekday-dow)%7,weekOffset=firstWeekOffset(year,dow,doy),dayOfYear=1+7*(week-1)+localWeekday+weekOffset,resYear,resDayOfYear;if(dayOfYear<=0){resYear=year-1;resDayOfYear=daysInYear(resYear)+dayOfYear}else if(dayOfYear>daysInYear(year)){resYear=year+1;resDayOfYear=dayOfYear-daysInYear(year)}else{resYear=year;resDayOfYear=dayOfYear}return{year:resYear,dayOfYear:resDayOfYear}}function weekOfYear(mom,dow,doy){var weekOffset=firstWeekOffset(mom.year(),dow,doy),week=Math.floor((mom.dayOfYear()-weekOffset-1)/7)+1,resWeek,resYear;if(week<1){resYear=mom.year()-1;resWeek=week+weeksInYear(resYear,dow,doy)}else if(week>weeksInYear(mom.year(),dow,doy)){resWeek=week-weeksInYear(mom.year(),dow,doy);resYear=mom.year()+1}else{resYear=mom.year();resWeek=week}return{week:resWeek,year:resYear}}function weeksInYear(year,dow,doy){var weekOffset=firstWeekOffset(year,dow,doy),weekOffsetNext=firstWeekOffset(year+1,dow,doy);return(daysInYear(year)-weekOffset+weekOffsetNext)/7}addFormatToken("w",["ww",2],"wo","week");addFormatToken("W",["WW",2],"Wo","isoWeek");addUnitAlias("week","w");addUnitAlias("isoWeek","W");addUnitPriority("week",5);addUnitPriority("isoWeek",5);addRegexToken("w",match1to2);addRegexToken("ww",match1to2,match2);addRegexToken("W",match1to2);addRegexToken("WW",match1to2,match2);addWeekParseToken(["w","ww","W","WW"],function(input,week,config,token){week[token.substr(0,1)]=toInt(input)});function localeWeek(mom){return weekOfYear(mom,this._week.dow,this._week.doy).week}var defaultLocaleWeek={dow:0,doy:6};function localeFirstDayOfWeek(){return this._week.dow}function localeFirstDayOfYear(){return this._week.doy}function getSetWeek(input){var week=this.localeData().week(this);return input==null?week:this.add((input-week)*7,"d")}function getSetISOWeek(input){var week=weekOfYear(this,1,4).week;return input==null?week:this.add((input-week)*7,"d")}addFormatToken("d",0,"do","day");addFormatToken("dd",0,0,function(format){return this.localeData().weekdaysMin(this,format)});addFormatToken("ddd",0,0,function(format){return this.localeData().weekdaysShort(this,format)});addFormatToken("dddd",0,0,function(format){return this.localeData().weekdays(this,format)});addFormatToken("e",0,0,"weekday");addFormatToken("E",0,0,"isoWeekday");addUnitAlias("day","d");addUnitAlias("weekday","e");addUnitAlias("isoWeekday","E");addUnitPriority("day",11);addUnitPriority("weekday",11);addUnitPriority("isoWeekday",11);addRegexToken("d",match1to2);addRegexToken("e",match1to2);addRegexToken("E",match1to2);addRegexToken("dd",function(isStrict,locale){return locale.weekdaysMinRegex(isStrict)});addRegexToken("ddd",function(isStrict,locale){return locale.weekdaysShortRegex(isStrict)});addRegexToken("dddd",function(isStrict,locale){return locale.weekdaysRegex(isStrict)});addWeekParseToken(["dd","ddd","dddd"],function(input,week,config,token){var weekday=config._locale.weekdaysParse(input,token,config._strict);if(weekday!=null){week.d=weekday}else{getParsingFlags(config).invalidWeekday=input}});addWeekParseToken(["d","e","E"],function(input,week,config,token){week[token]=toInt(input)});function parseWeekday(input,locale){if(typeof input!=="string"){return input}if(!isNaN(input)){return parseInt(input,10)}input=locale.weekdaysParse(input);if(typeof input==="number"){return input}return null}function parseIsoWeekday(input,locale){if(typeof input==="string"){return locale.weekdaysParse(input)%7||7}return isNaN(input)?null:input}var defaultLocaleWeekdays="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_");function localeWeekdays(m,format){if(!m){return isArray(this._weekdays)?this._weekdays:this._weekdays["standalone"]}return isArray(this._weekdays)?this._weekdays[m.day()]:this._weekdays[this._weekdays.isFormat.test(format)?"format":"standalone"][m.day()]}var defaultLocaleWeekdaysShort="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_");function localeWeekdaysShort(m){return m?this._weekdaysShort[m.day()]:this._weekdaysShort}var defaultLocaleWeekdaysMin="Su_Mo_Tu_We_Th_Fr_Sa".split("_");function localeWeekdaysMin(m){return m?this._weekdaysMin[m.day()]:this._weekdaysMin}function handleStrictParse$1(weekdayName,format,strict){var i,ii,mom,llc=weekdayName.toLocaleLowerCase();if(!this._weekdaysParse){this._weekdaysParse=[];this._shortWeekdaysParse=[];this._minWeekdaysParse=[];for(i=0;i<7;++i){mom=createUTC([2e3,1]).day(i);this._minWeekdaysParse[i]=this.weekdaysMin(mom,"").toLocaleLowerCase();this._shortWeekdaysParse[i]=this.weekdaysShort(mom,"").toLocaleLowerCase();this._weekdaysParse[i]=this.weekdays(mom,"").toLocaleLowerCase()}}if(strict){if(format==="dddd"){ii=indexOf.call(this._weekdaysParse,llc);return ii!==-1?ii:null}else if(format==="ddd"){ii=indexOf.call(this._shortWeekdaysParse,llc);return ii!==-1?ii:null}else{ii=indexOf.call(this._minWeekdaysParse,llc);return ii!==-1?ii:null}}else{if(format==="dddd"){ii=indexOf.call(this._weekdaysParse,llc);if(ii!==-1){return ii}ii=indexOf.call(this._shortWeekdaysParse,llc);if(ii!==-1){return ii}ii=indexOf.call(this._minWeekdaysParse,llc);return ii!==-1?ii:null}else if(format==="ddd"){ii=indexOf.call(this._shortWeekdaysParse,llc);if(ii!==-1){return ii}ii=indexOf.call(this._weekdaysParse,llc);if(ii!==-1){return ii}ii=indexOf.call(this._minWeekdaysParse,llc);return ii!==-1?ii:null}else{ii=indexOf.call(this._minWeekdaysParse,llc);if(ii!==-1){return ii}ii=indexOf.call(this._weekdaysParse,llc);if(ii!==-1){return ii}ii=indexOf.call(this._shortWeekdaysParse,llc);return ii!==-1?ii:null}}}function localeWeekdaysParse(weekdayName,format,strict){var i,mom,regex;if(this._weekdaysParseExact){return handleStrictParse$1.call(this,weekdayName,format,strict)}if(!this._weekdaysParse){this._weekdaysParse=[];this._minWeekdaysParse=[];this._shortWeekdaysParse=[];this._fullWeekdaysParse=[]}for(i=0;i<7;i++){mom=createUTC([2e3,1]).day(i);if(strict&&!this._fullWeekdaysParse[i]){this._fullWeekdaysParse[i]=new RegExp("^"+this.weekdays(mom,"").replace(".",".?")+"$","i");this._shortWeekdaysParse[i]=new RegExp("^"+this.weekdaysShort(mom,"").replace(".",".?")+"$","i");this._minWeekdaysParse[i]=new RegExp("^"+this.weekdaysMin(mom,"").replace(".",".?")+"$","i")}if(!this._weekdaysParse[i]){regex="^"+this.weekdays(mom,"")+"|^"+this.weekdaysShort(mom,"")+"|^"+this.weekdaysMin(mom,"");this._weekdaysParse[i]=new RegExp(regex.replace(".",""),"i")}if(strict&&format==="dddd"&&this._fullWeekdaysParse[i].test(weekdayName)){return i}else if(strict&&format==="ddd"&&this._shortWeekdaysParse[i].test(weekdayName)){return i}else if(strict&&format==="dd"&&this._minWeekdaysParse[i].test(weekdayName)){return i}else if(!strict&&this._weekdaysParse[i].test(weekdayName)){return i}}}function getSetDayOfWeek(input){if(!this.isValid()){return input!=null?this:NaN}var day=this._isUTC?this._d.getUTCDay():this._d.getDay();if(input!=null){input=parseWeekday(input,this.localeData());return this.add(input-day,"d")}else{return day}}function getSetLocaleDayOfWeek(input){if(!this.isValid()){return input!=null?this:NaN}var weekday=(this.day()+7-this.localeData()._week.dow)%7;return input==null?weekday:this.add(input-weekday,"d")}function getSetISODayOfWeek(input){if(!this.isValid()){return input!=null?this:NaN}if(input!=null){var weekday=parseIsoWeekday(input,this.localeData());return this.day(this.day()%7?weekday:weekday-7)}else{return this.day()||7}}var defaultWeekdaysRegex=matchWord;function weekdaysRegex(isStrict){if(this._weekdaysParseExact){if(!hasOwnProp(this,"_weekdaysRegex")){computeWeekdaysParse.call(this)}if(isStrict){return this._weekdaysStrictRegex}else{return this._weekdaysRegex}}else{if(!hasOwnProp(this,"_weekdaysRegex")){this._weekdaysRegex=defaultWeekdaysRegex}return this._weekdaysStrictRegex&&isStrict?this._weekdaysStrictRegex:this._weekdaysRegex}}var defaultWeekdaysShortRegex=matchWord;function weekdaysShortRegex(isStrict){if(this._weekdaysParseExact){if(!hasOwnProp(this,"_weekdaysRegex")){computeWeekdaysParse.call(this)}if(isStrict){return this._weekdaysShortStrictRegex}else{return this._weekdaysShortRegex}}else{if(!hasOwnProp(this,"_weekdaysShortRegex")){this._weekdaysShortRegex=defaultWeekdaysShortRegex}return this._weekdaysShortStrictRegex&&isStrict?this._weekdaysShortStrictRegex:this._weekdaysShortRegex}}var defaultWeekdaysMinRegex=matchWord;function weekdaysMinRegex(isStrict){if(this._weekdaysParseExact){if(!hasOwnProp(this,"_weekdaysRegex")){computeWeekdaysParse.call(this)}if(isStrict){return this._weekdaysMinStrictRegex}else{return this._weekdaysMinRegex}}else{if(!hasOwnProp(this,"_weekdaysMinRegex")){this._weekdaysMinRegex=defaultWeekdaysMinRegex}return this._weekdaysMinStrictRegex&&isStrict?this._weekdaysMinStrictRegex:this._weekdaysMinRegex}}function computeWeekdaysParse(){function cmpLenRev(a,b){return b.length-a.length}var minPieces=[],shortPieces=[],longPieces=[],mixedPieces=[],i,mom,minp,shortp,longp;for(i=0;i<7;i++){mom=createUTC([2e3,1]).day(i);minp=this.weekdaysMin(mom,"");shortp=this.weekdaysShort(mom,"");longp=this.weekdays(mom,"");minPieces.push(minp);shortPieces.push(shortp);longPieces.push(longp);mixedPieces.push(minp);mixedPieces.push(shortp);mixedPieces.push(longp)}minPieces.sort(cmpLenRev);shortPieces.sort(cmpLenRev);longPieces.sort(cmpLenRev);mixedPieces.sort(cmpLenRev);for(i=0;i<7;i++){shortPieces[i]=regexEscape(shortPieces[i]);longPieces[i]=regexEscape(longPieces[i]);mixedPieces[i]=regexEscape(mixedPieces[i])}this._weekdaysRegex=new RegExp("^("+mixedPieces.join("|")+")","i");this._weekdaysShortRegex=this._weekdaysRegex;this._weekdaysMinRegex=this._weekdaysRegex;this._weekdaysStrictRegex=new RegExp("^("+longPieces.join("|")+")","i");this._weekdaysShortStrictRegex=new RegExp("^("+shortPieces.join("|")+")","i");this._weekdaysMinStrictRegex=new RegExp("^("+minPieces.join("|")+")","i")}function hFormat(){return this.hours()%12||12}function kFormat(){return this.hours()||24}addFormatToken("H",["HH",2],0,"hour");addFormatToken("h",["hh",2],0,hFormat);addFormatToken("k",["kk",2],0,kFormat);addFormatToken("hmm",0,0,function(){return""+hFormat.apply(this)+zeroFill(this.minutes(),2)});addFormatToken("hmmss",0,0,function(){return""+hFormat.apply(this)+zeroFill(this.minutes(),2)+zeroFill(this.seconds(),2)});addFormatToken("Hmm",0,0,function(){return""+this.hours()+zeroFill(this.minutes(),2)});addFormatToken("Hmmss",0,0,function(){return""+this.hours()+zeroFill(this.minutes(),2)+zeroFill(this.seconds(),2)});function meridiem(token,lowercase){addFormatToken(token,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),lowercase)})}meridiem("a",true);meridiem("A",false);addUnitAlias("hour","h");addUnitPriority("hour",13);function matchMeridiem(isStrict,locale){return locale._meridiemParse}addRegexToken("a",matchMeridiem);addRegexToken("A",matchMeridiem);addRegexToken("H",match1to2);addRegexToken("h",match1to2);addRegexToken("k",match1to2);addRegexToken("HH",match1to2,match2);addRegexToken("hh",match1to2,match2);addRegexToken("kk",match1to2,match2);addRegexToken("hmm",match3to4);addRegexToken("hmmss",match5to6);addRegexToken("Hmm",match3to4);addRegexToken("Hmmss",match5to6);addParseToken(["H","HH"],HOUR);addParseToken(["k","kk"],function(input,array,config){var kInput=toInt(input);array[HOUR]=kInput===24?0:kInput});addParseToken(["a","A"],function(input,array,config){config._isPm=config._locale.isPM(input);config._meridiem=input});addParseToken(["h","hh"],function(input,array,config){array[HOUR]=toInt(input);getParsingFlags(config).bigHour=true});addParseToken("hmm",function(input,array,config){var pos=input.length-2;array[HOUR]=toInt(input.substr(0,pos));array[MINUTE]=toInt(input.substr(pos));getParsingFlags(config).bigHour=true});addParseToken("hmmss",function(input,array,config){var pos1=input.length-4;var pos2=input.length-2;array[HOUR]=toInt(input.substr(0,pos1));array[MINUTE]=toInt(input.substr(pos1,2));array[SECOND]=toInt(input.substr(pos2));getParsingFlags(config).bigHour=true});addParseToken("Hmm",function(input,array,config){var pos=input.length-2;array[HOUR]=toInt(input.substr(0,pos));array[MINUTE]=toInt(input.substr(pos))});addParseToken("Hmmss",function(input,array,config){var pos1=input.length-4;var pos2=input.length-2;array[HOUR]=toInt(input.substr(0,pos1));array[MINUTE]=toInt(input.substr(pos1,2));array[SECOND]=toInt(input.substr(pos2))});function localeIsPM(input){return(input+"").toLowerCase().charAt(0)==="p"}var defaultLocaleMeridiemParse=/[ap]\.?m?\.?/i;function localeMeridiem(hours,minutes,isLower){if(hours>11){return isLower?"pm":"PM"}else{return isLower?"am":"AM"}}var getSetHour=makeGetSet("Hours",true);var baseConfig={calendar:defaultCalendar,longDateFormat:defaultLongDateFormat,invalidDate:defaultInvalidDate,ordinal:defaultOrdinal,dayOfMonthOrdinalParse:defaultDayOfMonthOrdinalParse,relativeTime:defaultRelativeTime,months:defaultLocaleMonths,monthsShort:defaultLocaleMonthsShort,week:defaultLocaleWeek,weekdays:defaultLocaleWeekdays,weekdaysMin:defaultLocaleWeekdaysMin,weekdaysShort:defaultLocaleWeekdaysShort,meridiemParse:defaultLocaleMeridiemParse};var locales={};var localeFamilies={};var globalLocale;function normalizeLocale(key){return key?key.toLowerCase().replace("_","-"):key}function chooseLocale(names){var i=0,j,next,locale,split;while(i<names.length){split=normalizeLocale(names[i]).split("-");j=split.length;next=normalizeLocale(names[i+1]);next=next?next.split("-"):null;while(j>0){locale=loadLocale(split.slice(0,j).join("-"));if(locale){return locale}if(next&&next.length>=j&&compareArrays(split,next,true)>=j-1){break}j--}i++}return globalLocale}function loadLocale(name){var oldLocale=null;if(!locales[name]&&typeof module!=="undefined"&&module&&module.exports){try{oldLocale=globalLocale._abbr;var aliasedRequire=require;aliasedRequire("./locale/"+name);getSetGlobalLocale(oldLocale)}catch(e){}}return locales[name]}function getSetGlobalLocale(key,values){var data;if(key){if(isUndefined(values)){data=getLocale(key)}else{data=defineLocale(key,values)}if(data){globalLocale=data}else{if(typeof console!=="undefined"&&console.warn){console.warn("Locale "+key+" not found. Did you forget to load it?")}}}return globalLocale._abbr}function defineLocale(name,config){if(config!==null){var locale,parentConfig=baseConfig;config.abbr=name;if(locales[name]!=null){deprecateSimple("defineLocaleOverride","use moment.updateLocale(localeName, config) to change "+"an existing locale. moment.defineLocale(localeName, "+"config) should only be used for creating a new locale "+"See http://momentjs.com/guides/#/warnings/define-locale/ for more info.");parentConfig=locales[name]._config}else if(config.parentLocale!=null){if(locales[config.parentLocale]!=null){parentConfig=locales[config.parentLocale]._config}else{locale=loadLocale(config.parentLocale);if(locale!=null){parentConfig=locale._config}else{if(!localeFamilies[config.parentLocale]){localeFamilies[config.parentLocale]=[]}localeFamilies[config.parentLocale].push({name:name,config:config});return null}}}locales[name]=new Locale(mergeConfigs(parentConfig,config));if(localeFamilies[name]){localeFamilies[name].forEach(function(x){defineLocale(x.name,x.config)})}getSetGlobalLocale(name);return locales[name]}else{delete locales[name];return null}}function updateLocale(name,config){if(config!=null){var locale,tmpLocale,parentConfig=baseConfig;tmpLocale=loadLocale(name);if(tmpLocale!=null){parentConfig=tmpLocale._config}config=mergeConfigs(parentConfig,config);locale=new Locale(config);locale.parentLocale=locales[name];locales[name]=locale;getSetGlobalLocale(name)}else{if(locales[name]!=null){if(locales[name].parentLocale!=null){locales[name]=locales[name].parentLocale}else if(locales[name]!=null){delete locales[name]}}}return locales[name]}function getLocale(key){var locale;if(key&&key._locale&&key._locale._abbr){key=key._locale._abbr}if(!key){return globalLocale}if(!isArray(key)){locale=loadLocale(key);if(locale){return locale}key=[key]}return chooseLocale(key)}function listLocales(){return keys(locales)}function checkOverflow(m){var overflow;var a=m._a;if(a&&getParsingFlags(m).overflow===-2){overflow=a[MONTH]<0||a[MONTH]>11?MONTH:a[DATE]<1||a[DATE]>daysInMonth(a[YEAR],a[MONTH])?DATE:a[HOUR]<0||a[HOUR]>24||a[HOUR]===24&&(a[MINUTE]!==0||a[SECOND]!==0||a[MILLISECOND]!==0)?HOUR:a[MINUTE]<0||a[MINUTE]>59?MINUTE:a[SECOND]<0||a[SECOND]>59?SECOND:a[MILLISECOND]<0||a[MILLISECOND]>999?MILLISECOND:-1;if(getParsingFlags(m)._overflowDayOfYear&&(overflow<YEAR||overflow>DATE)){overflow=DATE}if(getParsingFlags(m)._overflowWeeks&&overflow===-1){overflow=WEEK}if(getParsingFlags(m)._overflowWeekday&&overflow===-1){overflow=WEEKDAY}getParsingFlags(m).overflow=overflow}return m}function defaults(a,b,c){if(a!=null){return a}if(b!=null){return b}return c}function currentDateArray(config){var nowValue=new Date(hooks.now());if(config._useUTC){return[nowValue.getUTCFullYear(),nowValue.getUTCMonth(),nowValue.getUTCDate()]}return[nowValue.getFullYear(),nowValue.getMonth(),nowValue.getDate()]}function configFromArray(config){var i,date,input=[],currentDate,expectedWeekday,yearToUse;if(config._d){return}currentDate=currentDateArray(config);if(config._w&&config._a[DATE]==null&&config._a[MONTH]==null){dayOfYearFromWeekInfo(config)}if(config._dayOfYear!=null){yearToUse=defaults(config._a[YEAR],currentDate[YEAR]);if(config._dayOfYear>daysInYear(yearToUse)||config._dayOfYear===0){getParsingFlags(config)._overflowDayOfYear=true}date=createUTCDate(yearToUse,0,config._dayOfYear);config._a[MONTH]=date.getUTCMonth();config._a[DATE]=date.getUTCDate()}for(i=0;i<3&&config._a[i]==null;++i){config._a[i]=input[i]=currentDate[i]}for(;i<7;i++){config._a[i]=input[i]=config._a[i]==null?i===2?1:0:config._a[i]}if(config._a[HOUR]===24&&config._a[MINUTE]===0&&config._a[SECOND]===0&&config._a[MILLISECOND]===0){config._nextDay=true;config._a[HOUR]=0}config._d=(config._useUTC?createUTCDate:createDate).apply(null,input);expectedWeekday=config._useUTC?config._d.getUTCDay():config._d.getDay();if(config._tzm!=null){config._d.setUTCMinutes(config._d.getUTCMinutes()-config._tzm)}if(config._nextDay){config._a[HOUR]=24}if(config._w&&typeof config._w.d!=="undefined"&&config._w.d!==expectedWeekday){getParsingFlags(config).weekdayMismatch=true}}function dayOfYearFromWeekInfo(config){var w,weekYear,week,weekday,dow,doy,temp,weekdayOverflow;w=config._w;if(w.GG!=null||w.W!=null||w.E!=null){dow=1;doy=4;weekYear=defaults(w.GG,config._a[YEAR],weekOfYear(createLocal(),1,4).year);week=defaults(w.W,1);weekday=defaults(w.E,1);if(weekday<1||weekday>7){weekdayOverflow=true}}else{dow=config._locale._week.dow;doy=config._locale._week.doy;var curWeek=weekOfYear(createLocal(),dow,doy);weekYear=defaults(w.gg,config._a[YEAR],curWeek.year);week=defaults(w.w,curWeek.week);if(w.d!=null){weekday=w.d;if(weekday<0||weekday>6){weekdayOverflow=true}}else if(w.e!=null){weekday=w.e+dow;if(w.e<0||w.e>6){weekdayOverflow=true}}else{weekday=dow}}if(week<1||week>weeksInYear(weekYear,dow,doy)){getParsingFlags(config)._overflowWeeks=true}else if(weekdayOverflow!=null){getParsingFlags(config)._overflowWeekday=true}else{temp=dayOfYearFromWeeks(weekYear,week,weekday,dow,doy);config._a[YEAR]=temp.year;config._dayOfYear=temp.dayOfYear}}var extendedIsoRegex=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/;var basicIsoRegex=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/;var tzRegex=/Z|[+-]\d\d(?::?\d\d)?/;var isoDates=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,false],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,false],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,false],["YYYYDDD",/\d{7}/]];var isoTimes=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]];var aspNetJsonRegex=/^\/?Date\((\-?\d+)/i;function configFromISO(config){var i,l,string=config._i,match=extendedIsoRegex.exec(string)||basicIsoRegex.exec(string),allowTime,dateFormat,timeFormat,tzFormat;if(match){getParsingFlags(config).iso=true;for(i=0,l=isoDates.length;i<l;i++){if(isoDates[i][1].exec(match[1])){dateFormat=isoDates[i][0];allowTime=isoDates[i][2]!==false;break}}if(dateFormat==null){config._isValid=false;return}if(match[3]){for(i=0,l=isoTimes.length;i<l;i++){if(isoTimes[i][1].exec(match[3])){timeFormat=(match[2]||" ")+isoTimes[i][0];break}}if(timeFormat==null){config._isValid=false;return}}if(!allowTime&&timeFormat!=null){config._isValid=false;return}if(match[4]){if(tzRegex.exec(match[4])){tzFormat="Z"}else{config._isValid=false;return}}config._f=dateFormat+(timeFormat||"")+(tzFormat||"");configFromStringAndFormat(config)}else{config._isValid=false}}var rfc2822=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/;function extractFromRFC2822Strings(yearStr,monthStr,dayStr,hourStr,minuteStr,secondStr){var result=[untruncateYear(yearStr),defaultLocaleMonthsShort.indexOf(monthStr),parseInt(dayStr,10),parseInt(hourStr,10),parseInt(minuteStr,10)];if(secondStr){result.push(parseInt(secondStr,10))}return result}function untruncateYear(yearStr){var year=parseInt(yearStr,10);if(year<=49){return 2e3+year}else if(year<=999){return 1900+year}return year}function preprocessRFC2822(s){return s.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}function checkWeekday(weekdayStr,parsedInput,config){if(weekdayStr){var weekdayProvided=defaultLocaleWeekdaysShort.indexOf(weekdayStr),weekdayActual=new Date(parsedInput[0],parsedInput[1],parsedInput[2]).getDay();if(weekdayProvided!==weekdayActual){getParsingFlags(config).weekdayMismatch=true;config._isValid=false;return false}}return true}var obsOffsets={UT:0,GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function calculateOffset(obsOffset,militaryOffset,numOffset){if(obsOffset){return obsOffsets[obsOffset]}else if(militaryOffset){return 0}else{var hm=parseInt(numOffset,10);var m=hm%100,h=(hm-m)/100;return h*60+m}}function configFromRFC2822(config){var match=rfc2822.exec(preprocessRFC2822(config._i));if(match){var parsedArray=extractFromRFC2822Strings(match[4],match[3],match[2],match[5],match[6],match[7]);if(!checkWeekday(match[1],parsedArray,config)){return}config._a=parsedArray;config._tzm=calculateOffset(match[8],match[9],match[10]);config._d=createUTCDate.apply(null,config._a);config._d.setUTCMinutes(config._d.getUTCMinutes()-config._tzm);getParsingFlags(config).rfc2822=true}else{config._isValid=false}}function configFromString(config){var matched=aspNetJsonRegex.exec(config._i);if(matched!==null){config._d=new Date(+matched[1]);return}configFromISO(config);if(config._isValid===false){delete config._isValid}else{return}configFromRFC2822(config);if(config._isValid===false){delete config._isValid}else{return}hooks.createFromInputFallback(config)}hooks.createFromInputFallback=deprecate("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), "+"which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are "+"discouraged and will be removed in an upcoming major release. Please refer to "+"http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(config){config._d=new Date(config._i+(config._useUTC?" UTC":""))});hooks.ISO_8601=function(){};hooks.RFC_2822=function(){};function configFromStringAndFormat(config){if(config._f===hooks.ISO_8601){configFromISO(config);return}if(config._f===hooks.RFC_2822){configFromRFC2822(config);return}config._a=[];getParsingFlags(config).empty=true;var string=""+config._i,i,parsedInput,tokens,token,skipped,stringLength=string.length,totalParsedInputLength=0;tokens=expandFormat(config._f,config._locale).match(formattingTokens)||[];for(i=0;i<tokens.length;i++){token=tokens[i];parsedInput=(string.match(getParseRegexForToken(token,config))||[])[0];if(parsedInput){skipped=string.substr(0,string.indexOf(parsedInput));if(skipped.length>0){getParsingFlags(config).unusedInput.push(skipped)}string=string.slice(string.indexOf(parsedInput)+parsedInput.length);totalParsedInputLength+=parsedInput.length}if(formatTokenFunctions[token]){if(parsedInput){getParsingFlags(config).empty=false}else{getParsingFlags(config).unusedTokens.push(token)}addTimeToArrayFromToken(token,parsedInput,config)}else if(config._strict&&!parsedInput){getParsingFlags(config).unusedTokens.push(token)}}getParsingFlags(config).charsLeftOver=stringLength-totalParsedInputLength;if(string.length>0){getParsingFlags(config).unusedInput.push(string)}if(config._a[HOUR]<=12&&getParsingFlags(config).bigHour===true&&config._a[HOUR]>0){getParsingFlags(config).bigHour=undefined}getParsingFlags(config).parsedDateParts=config._a.slice(0);getParsingFlags(config).meridiem=config._meridiem;config._a[HOUR]=meridiemFixWrap(config._locale,config._a[HOUR],config._meridiem);configFromArray(config);checkOverflow(config)}function meridiemFixWrap(locale,hour,meridiem){var isPm;if(meridiem==null){return hour}if(locale.meridiemHour!=null){return locale.meridiemHour(hour,meridiem)}else if(locale.isPM!=null){isPm=locale.isPM(meridiem);if(isPm&&hour<12){hour+=12}if(!isPm&&hour===12){hour=0}return hour}else{return hour}}function configFromStringAndArray(config){var tempConfig,bestMoment,scoreToBeat,i,currentScore;if(config._f.length===0){getParsingFlags(config).invalidFormat=true;config._d=new Date(NaN);return}for(i=0;i<config._f.length;i++){currentScore=0;tempConfig=copyConfig({},config);if(config._useUTC!=null){tempConfig._useUTC=config._useUTC}tempConfig._f=config._f[i];configFromStringAndFormat(tempConfig);if(!isValid(tempConfig)){continue}currentScore+=getParsingFlags(tempConfig).charsLeftOver;currentScore+=getParsingFlags(tempConfig).unusedTokens.length*10;getParsingFlags(tempConfig).score=currentScore;if(scoreToBeat==null||currentScore<scoreToBeat){scoreToBeat=currentScore;bestMoment=tempConfig}}extend(config,bestMoment||tempConfig)}function configFromObject(config){if(config._d){return}var i=normalizeObjectUnits(config._i);config._a=map([i.year,i.month,i.day||i.date,i.hour,i.minute,i.second,i.millisecond],function(obj){return obj&&parseInt(obj,10)});configFromArray(config)}function createFromConfig(config){var res=new Moment(checkOverflow(prepareConfig(config)));if(res._nextDay){res.add(1,"d");res._nextDay=undefined}return res}function prepareConfig(config){var input=config._i,format=config._f;config._locale=config._locale||getLocale(config._l);if(input===null||format===undefined&&input===""){return createInvalid({nullInput:true})}if(typeof input==="string"){config._i=input=config._locale.preparse(input)}if(isMoment(input)){return new Moment(checkOverflow(input))}else if(isDate(input)){config._d=input}else if(isArray(format)){configFromStringAndArray(config)}else if(format){configFromStringAndFormat(config)}else{configFromInput(config)}if(!isValid(config)){config._d=null}return config}function configFromInput(config){var input=config._i;if(isUndefined(input)){config._d=new Date(hooks.now())}else if(isDate(input)){config._d=new Date(input.valueOf())}else if(typeof input==="string"){configFromString(config)}else if(isArray(input)){config._a=map(input.slice(0),function(obj){return parseInt(obj,10)});configFromArray(config)}else if(isObject(input)){configFromObject(config)}else if(isNumber(input)){config._d=new Date(input)}else{hooks.createFromInputFallback(config)}}function createLocalOrUTC(input,format,locale,strict,isUTC){var c={};if(locale===true||locale===false){strict=locale;locale=undefined}if(isObject(input)&&isObjectEmpty(input)||isArray(input)&&input.length===0){input=undefined}c._isAMomentObject=true;c._useUTC=c._isUTC=isUTC;c._l=locale;c._i=input;c._f=format;c._strict=strict;return createFromConfig(c)}function createLocal(input,format,locale,strict){return createLocalOrUTC(input,format,locale,strict,false)}var prototypeMin=deprecate("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var other=createLocal.apply(null,arguments);if(this.isValid()&&other.isValid()){return other<this?this:other}else{return createInvalid()}});var prototypeMax=deprecate("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var other=createLocal.apply(null,arguments);if(this.isValid()&&other.isValid()){return other>this?this:other}else{return createInvalid()}});function pickBy(fn,moments){var res,i;if(moments.length===1&&isArray(moments[0])){moments=moments[0]}if(!moments.length){return createLocal()}res=moments[0];for(i=1;i<moments.length;++i){if(!moments[i].isValid()||moments[i][fn](res)){res=moments[i]}}return res}function min(){var args=[].slice.call(arguments,0);return pickBy("isBefore",args)}function max(){var args=[].slice.call(arguments,0);return pickBy("isAfter",args)}var now=function(){return Date.now?Date.now():+new Date};var ordering=["year","quarter","month","week","day","hour","minute","second","millisecond"];function isDurationValid(m){for(var key in m){if(!(indexOf.call(ordering,key)!==-1&&(m[key]==null||!isNaN(m[key])))){return false}}var unitHasDecimal=false;for(var i=0;i<ordering.length;++i){if(m[ordering[i]]){if(unitHasDecimal){return false}if(parseFloat(m[ordering[i]])!==toInt(m[ordering[i]])){unitHasDecimal=true}}}return true}function isValid$1(){return this._isValid}function createInvalid$1(){return createDuration(NaN)}function Duration(duration){var normalizedInput=normalizeObjectUnits(duration),years=normalizedInput.year||0,quarters=normalizedInput.quarter||0,months=normalizedInput.month||0,weeks=normalizedInput.week||0,days=normalizedInput.day||0,hours=normalizedInput.hour||0,minutes=normalizedInput.minute||0,seconds=normalizedInput.second||0,milliseconds=normalizedInput.millisecond||0;this._isValid=isDurationValid(normalizedInput);this._milliseconds=+milliseconds+seconds*1e3+minutes*6e4+hours*1e3*60*60;this._days=+days+weeks*7;this._months=+months+quarters*3+years*12;this._data={};this._locale=getLocale();this._bubble()}function isDuration(obj){return obj instanceof Duration}function absRound(number){if(number<0){return Math.round(-1*number)*-1}else{return Math.round(number)}}function offset(token,separator){addFormatToken(token,0,0,function(){var offset=this.utcOffset();var sign="+";if(offset<0){offset=-offset;sign="-"}return sign+zeroFill(~~(offset/60),2)+separator+zeroFill(~~offset%60,2)})}offset("Z",":");offset("ZZ","");addRegexToken("Z",matchShortOffset);addRegexToken("ZZ",matchShortOffset);addParseToken(["Z","ZZ"],function(input,array,config){config._useUTC=true;config._tzm=offsetFromString(matchShortOffset,input)});var chunkOffset=/([\+\-]|\d\d)/gi;function offsetFromString(matcher,string){var matches=(string||"").match(matcher);if(matches===null){return null}var chunk=matches[matches.length-1]||[];var parts=(chunk+"").match(chunkOffset)||["-",0,0];var minutes=+(parts[1]*60)+toInt(parts[2]);return minutes===0?0:parts[0]==="+"?minutes:-minutes}function cloneWithOffset(input,model){var res,diff;if(model._isUTC){res=model.clone();diff=(isMoment(input)||isDate(input)?input.valueOf():createLocal(input).valueOf())-res.valueOf();res._d.setTime(res._d.valueOf()+diff);hooks.updateOffset(res,false);return res}else{return createLocal(input).local()}}function getDateOffset(m){return-Math.round(m._d.getTimezoneOffset()/15)*15}hooks.updateOffset=function(){};function getSetOffset(input,keepLocalTime,keepMinutes){var offset=this._offset||0,localAdjust;if(!this.isValid()){return input!=null?this:NaN}if(input!=null){if(typeof input==="string"){input=offsetFromString(matchShortOffset,input);if(input===null){return this}}else if(Math.abs(input)<16&&!keepMinutes){input=input*60}if(!this._isUTC&&keepLocalTime){localAdjust=getDateOffset(this)}this._offset=input;this._isUTC=true;if(localAdjust!=null){this.add(localAdjust,"m")}if(offset!==input){if(!keepLocalTime||this._changeInProgress){addSubtract(this,createDuration(input-offset,"m"),1,false)}else if(!this._changeInProgress){this._changeInProgress=true;hooks.updateOffset(this,true);this._changeInProgress=null}}return this}else{return this._isUTC?offset:getDateOffset(this)}}function getSetZone(input,keepLocalTime){if(input!=null){if(typeof input!=="string"){input=-input}this.utcOffset(input,keepLocalTime);return this}else{return-this.utcOffset()}}function setOffsetToUTC(keepLocalTime){return this.utcOffset(0,keepLocalTime)}function setOffsetToLocal(keepLocalTime){if(this._isUTC){this.utcOffset(0,keepLocalTime);this._isUTC=false;if(keepLocalTime){this.subtract(getDateOffset(this),"m")}}return this}function setOffsetToParsedOffset(){if(this._tzm!=null){this.utcOffset(this._tzm,false,true)}else if(typeof this._i==="string"){var tZone=offsetFromString(matchOffset,this._i);if(tZone!=null){this.utcOffset(tZone)}else{this.utcOffset(0,true)}}return this}function hasAlignedHourOffset(input){if(!this.isValid()){return false}input=input?createLocal(input).utcOffset():0;return(this.utcOffset()-input)%60===0}function isDaylightSavingTime(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function isDaylightSavingTimeShifted(){if(!isUndefined(this._isDSTShifted)){return this._isDSTShifted}var c={};copyConfig(c,this);c=prepareConfig(c);if(c._a){var other=c._isUTC?createUTC(c._a):createLocal(c._a);this._isDSTShifted=this.isValid()&&compareArrays(c._a,other.toArray())>0}else{this._isDSTShifted=false}return this._isDSTShifted}function isLocal(){return this.isValid()?!this._isUTC:false}function isUtcOffset(){return this.isValid()?this._isUTC:false}function isUtc(){return this.isValid()?this._isUTC&&this._offset===0:false}var aspNetRegex=/^(\-|\+)?(?:(\d*)[. ])?(\d+)\:(\d+)(?:\:(\d+)(\.\d*)?)?$/;var isoRegex=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function createDuration(input,key){var duration=input,match=null,sign,ret,diffRes;if(isDuration(input)){duration={ms:input._milliseconds,d:input._days,M:input._months}}else if(isNumber(input)){duration={};if(key){duration[key]=input}else{duration.milliseconds=input}}else if(!!(match=aspNetRegex.exec(input))){sign=match[1]==="-"?-1:1;duration={y:0,d:toInt(match[DATE])*sign,h:toInt(match[HOUR])*sign,m:toInt(match[MINUTE])*sign,s:toInt(match[SECOND])*sign,ms:toInt(absRound(match[MILLISECOND]*1e3))*sign}}else if(!!(match=isoRegex.exec(input))){sign=match[1]==="-"?-1:match[1]==="+"?1:1;duration={y:parseIso(match[2],sign),M:parseIso(match[3],sign),w:parseIso(match[4],sign),d:parseIso(match[5],sign),h:parseIso(match[6],sign),m:parseIso(match[7],sign),s:parseIso(match[8],sign)}}else if(duration==null){duration={}}else if(typeof duration==="object"&&("from"in duration||"to"in duration)){diffRes=momentsDifference(createLocal(duration.from),createLocal(duration.to));duration={};duration.ms=diffRes.milliseconds;duration.M=diffRes.months}ret=new Duration(duration);if(isDuration(input)&&hasOwnProp(input,"_locale")){ret._locale=input._locale}return ret}createDuration.fn=Duration.prototype;createDuration.invalid=createInvalid$1;function parseIso(inp,sign){var res=inp&&parseFloat(inp.replace(",","."));return(isNaN(res)?0:res)*sign}function positiveMomentsDifference(base,other){var res={milliseconds:0,months:0};res.months=other.month()-base.month()+(other.year()-base.year())*12;if(base.clone().add(res.months,"M").isAfter(other)){--res.months}res.milliseconds=+other-+base.clone().add(res.months,"M");return res}function momentsDifference(base,other){var res;if(!(base.isValid()&&other.isValid())){return{milliseconds:0,months:0}}other=cloneWithOffset(other,base);if(base.isBefore(other)){res=positiveMomentsDifference(base,other)}else{res=positiveMomentsDifference(other,base);res.milliseconds=-res.milliseconds;res.months=-res.months}return res}function createAdder(direction,name){return function(val,period){var dur,tmp;if(period!==null&&!isNaN(+period)){deprecateSimple(name,"moment()."+name+"(period, number) is deprecated. Please use moment()."+name+"(number, period). "+"See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info.");tmp=val;val=period;period=tmp}val=typeof val==="string"?+val:val;dur=createDuration(val,period);addSubtract(this,dur,direction);return this}}function addSubtract(mom,duration,isAdding,updateOffset){var milliseconds=duration._milliseconds,days=absRound(duration._days),months=absRound(duration._months);if(!mom.isValid()){return}updateOffset=updateOffset==null?true:updateOffset;if(months){setMonth(mom,get(mom,"Month")+months*isAdding)}if(days){set$1(mom,"Date",get(mom,"Date")+days*isAdding)}if(milliseconds){mom._d.setTime(mom._d.valueOf()+milliseconds*isAdding)}if(updateOffset){hooks.updateOffset(mom,days||months)}}var add=createAdder(1,"add");var subtract=createAdder(-1,"subtract");function getCalendarFormat(myMoment,now){var diff=myMoment.diff(now,"days",true);return diff<-6?"sameElse":diff<-1?"lastWeek":diff<0?"lastDay":diff<1?"sameDay":diff<2?"nextDay":diff<7?"nextWeek":"sameElse"}function calendar$1(time,formats){var now=time||createLocal(),sod=cloneWithOffset(now,this).startOf("day"),format=hooks.calendarFormat(this,sod)||"sameElse";var output=formats&&(isFunction(formats[format])?formats[format].call(this,now):formats[format]);return this.format(output||this.localeData().calendar(format,this,createLocal(now)))}function clone(){return new Moment(this)}function isAfter(input,units){var localInput=isMoment(input)?input:createLocal(input);if(!(this.isValid()&&localInput.isValid())){return false}units=normalizeUnits(!isUndefined(units)?units:"millisecond");if(units==="millisecond"){return this.valueOf()>localInput.valueOf()}else{return localInput.valueOf()<this.clone().startOf(units).valueOf()}}function isBefore(input,units){var localInput=isMoment(input)?input:createLocal(input);if(!(this.isValid()&&localInput.isValid())){return false}units=normalizeUnits(!isUndefined(units)?units:"millisecond");if(units==="millisecond"){return this.valueOf()<localInput.valueOf()}else{return this.clone().endOf(units).valueOf()<localInput.valueOf()}}function isBetween(from,to,units,inclusivity){inclusivity=inclusivity||"()";return(inclusivity[0]==="("?this.isAfter(from,units):!this.isBefore(from,units))&&(inclusivity[1]===")"?this.isBefore(to,units):!this.isAfter(to,units))}function isSame(input,units){var localInput=isMoment(input)?input:createLocal(input),inputMs;if(!(this.isValid()&&localInput.isValid())){return false}units=normalizeUnits(units||"millisecond");if(units==="millisecond"){return this.valueOf()===localInput.valueOf()}else{inputMs=localInput.valueOf();return this.clone().startOf(units).valueOf()<=inputMs&&inputMs<=this.clone().endOf(units).valueOf()}}function isSameOrAfter(input,units){return this.isSame(input,units)||this.isAfter(input,units)}function isSameOrBefore(input,units){return this.isSame(input,units)||this.isBefore(input,units)}function diff(input,units,asFloat){var that,zoneDelta,output;if(!this.isValid()){return NaN}that=cloneWithOffset(input,this);if(!that.isValid()){return NaN}zoneDelta=(that.utcOffset()-this.utcOffset())*6e4;units=normalizeUnits(units);switch(units){case"year":output=monthDiff(this,that)/12;break;case"month":output=monthDiff(this,that);break;case"quarter":output=monthDiff(this,that)/3;break;case"second":output=(this-that)/1e3;break;case"minute":output=(this-that)/6e4;break;case"hour":output=(this-that)/36e5;break;case"day":output=(this-that-zoneDelta)/864e5;break;case"week":output=(this-that-zoneDelta)/6048e5;break;default:output=this-that}return asFloat?output:absFloor(output)}function monthDiff(a,b){var wholeMonthDiff=(b.year()-a.year())*12+(b.month()-a.month()),anchor=a.clone().add(wholeMonthDiff,"months"),anchor2,adjust;if(b-anchor<0){anchor2=a.clone().add(wholeMonthDiff-1,"months");adjust=(b-anchor)/(anchor-anchor2)}else{anchor2=a.clone().add(wholeMonthDiff+1,"months");adjust=(b-anchor)/(anchor2-anchor)}return-(wholeMonthDiff+adjust)||0}hooks.defaultFormat="YYYY-MM-DDTHH:mm:ssZ";hooks.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";function toString(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function toISOString(keepOffset){if(!this.isValid()){return null}var utc=keepOffset!==true;var m=utc?this.clone().utc():this;if(m.year()<0||m.year()>9999){return formatMoment(m,utc?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ")}if(isFunction(Date.prototype.toISOString)){if(utc){return this.toDate().toISOString()}else{return new Date(this.valueOf()+this.utcOffset()*60*1e3).toISOString().replace("Z",formatMoment(m,"Z"))}}return formatMoment(m,utc?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")}function inspect(){if(!this.isValid()){return"moment.invalid(/* "+this._i+" */)"}var func="moment";var zone="";if(!this.isLocal()){func=this.utcOffset()===0?"moment.utc":"moment.parseZone";zone="Z"}var prefix="["+func+'("]';var year=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY";var datetime="-MM-DD[T]HH:mm:ss.SSS";var suffix=zone+'[")]';return this.format(prefix+year+datetime+suffix)}function format(inputString){if(!inputString){inputString=this.isUtc()?hooks.defaultFormatUtc:hooks.defaultFormat}var output=formatMoment(this,inputString);return this.localeData().postformat(output)}function from(time,withoutSuffix){if(this.isValid()&&(isMoment(time)&&time.isValid()||createLocal(time).isValid())){return createDuration({to:this,from:time}).locale(this.locale()).humanize(!withoutSuffix)}else{return this.localeData().invalidDate()}}function fromNow(withoutSuffix){return this.from(createLocal(),withoutSuffix)}function to(time,withoutSuffix){if(this.isValid()&&(isMoment(time)&&time.isValid()||createLocal(time).isValid())){return createDuration({from:this,to:time}).locale(this.locale()).humanize(!withoutSuffix)}else{return this.localeData().invalidDate()}}function toNow(withoutSuffix){return this.to(createLocal(),withoutSuffix)}function locale(key){var newLocaleData;if(key===undefined){return this._locale._abbr}else{newLocaleData=getLocale(key);if(newLocaleData!=null){this._locale=newLocaleData}return this}}var lang=deprecate("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(key){if(key===undefined){return this.localeData()}else{return this.locale(key)}});function localeData(){return this._locale}function startOf(units){units=normalizeUnits(units);switch(units){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":case"date":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}if(units==="week"){this.weekday(0)}if(units==="isoWeek"){this.isoWeekday(1)}if(units==="quarter"){this.month(Math.floor(this.month()/3)*3)}return this}function endOf(units){units=normalizeUnits(units);if(units===undefined||units==="millisecond"){return this}if(units==="date"){units="day"}return this.startOf(units).add(1,units==="isoWeek"?"week":units).subtract(1,"ms")}function valueOf(){return this._d.valueOf()-(this._offset||0)*6e4}function unix(){return Math.floor(this.valueOf()/1e3)}function toDate(){return new Date(this.valueOf())}function toArray(){var m=this;return[m.year(),m.month(),m.date(),m.hour(),m.minute(),m.second(),m.millisecond()]}function toObject(){var m=this;return{years:m.year(),months:m.month(),date:m.date(),hours:m.hours(),minutes:m.minutes(),seconds:m.seconds(),milliseconds:m.milliseconds()}}function toJSON(){return this.isValid()?this.toISOString():null}function isValid$2(){return isValid(this)}function parsingFlags(){return extend({},getParsingFlags(this))}function invalidAt(){return getParsingFlags(this).overflow}function creationData(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}}addFormatToken(0,["gg",2],0,function(){return this.weekYear()%100});addFormatToken(0,["GG",2],0,function(){return this.isoWeekYear()%100});function addWeekYearFormatToken(token,getter){addFormatToken(0,[token,token.length],0,getter)}addWeekYearFormatToken("gggg","weekYear");addWeekYearFormatToken("ggggg","weekYear");addWeekYearFormatToken("GGGG","isoWeekYear");addWeekYearFormatToken("GGGGG","isoWeekYear");addUnitAlias("weekYear","gg");addUnitAlias("isoWeekYear","GG");addUnitPriority("weekYear",1);addUnitPriority("isoWeekYear",1);addRegexToken("G",matchSigned);addRegexToken("g",matchSigned);addRegexToken("GG",match1to2,match2);addRegexToken("gg",match1to2,match2);addRegexToken("GGGG",match1to4,match4);addRegexToken("gggg",match1to4,match4);addRegexToken("GGGGG",match1to6,match6);addRegexToken("ggggg",match1to6,match6);addWeekParseToken(["gggg","ggggg","GGGG","GGGGG"],function(input,week,config,token){week[token.substr(0,2)]=toInt(input)});addWeekParseToken(["gg","GG"],function(input,week,config,token){week[token]=hooks.parseTwoDigitYear(input)});function getSetWeekYear(input){return getSetWeekYearHelper.call(this,input,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)}function getSetISOWeekYear(input){return getSetWeekYearHelper.call(this,input,this.isoWeek(),this.isoWeekday(),1,4)}function getISOWeeksInYear(){return weeksInYear(this.year(),1,4)}function getWeeksInYear(){var weekInfo=this.localeData()._week;return weeksInYear(this.year(),weekInfo.dow,weekInfo.doy)}function getSetWeekYearHelper(input,week,weekday,dow,doy){var weeksTarget;if(input==null){return weekOfYear(this,dow,doy).year}else{weeksTarget=weeksInYear(input,dow,doy);if(week>weeksTarget){week=weeksTarget}return setWeekAll.call(this,input,week,weekday,dow,doy)}}function setWeekAll(weekYear,week,weekday,dow,doy){var dayOfYearData=dayOfYearFromWeeks(weekYear,week,weekday,dow,doy),date=createUTCDate(dayOfYearData.year,0,dayOfYearData.dayOfYear);this.year(date.getUTCFullYear());this.month(date.getUTCMonth());this.date(date.getUTCDate());return this}addFormatToken("Q",0,"Qo","quarter");addUnitAlias("quarter","Q");addUnitPriority("quarter",7);addRegexToken("Q",match1);addParseToken("Q",function(input,array){array[MONTH]=(toInt(input)-1)*3});function getSetQuarter(input){return input==null?Math.ceil((this.month()+1)/3):this.month((input-1)*3+this.month()%3)}addFormatToken("D",["DD",2],"Do","date");addUnitAlias("date","D");addUnitPriority("date",9);addRegexToken("D",match1to2);addRegexToken("DD",match1to2,match2);addRegexToken("Do",function(isStrict,locale){return isStrict?locale._dayOfMonthOrdinalParse||locale._ordinalParse:locale._dayOfMonthOrdinalParseLenient});addParseToken(["D","DD"],DATE);addParseToken("Do",function(input,array){array[DATE]=toInt(input.match(match1to2)[0])});var getSetDayOfMonth=makeGetSet("Date",true);addFormatToken("DDD",["DDDD",3],"DDDo","dayOfYear");addUnitAlias("dayOfYear","DDD");addUnitPriority("dayOfYear",4);addRegexToken("DDD",match1to3);addRegexToken("DDDD",match3);addParseToken(["DDD","DDDD"],function(input,array,config){config._dayOfYear=toInt(input)});function getSetDayOfYear(input){var dayOfYear=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return input==null?dayOfYear:this.add(input-dayOfYear,"d")}addFormatToken("m",["mm",2],0,"minute");addUnitAlias("minute","m");addUnitPriority("minute",14);addRegexToken("m",match1to2);addRegexToken("mm",match1to2,match2);addParseToken(["m","mm"],MINUTE);var getSetMinute=makeGetSet("Minutes",false);addFormatToken("s",["ss",2],0,"second");addUnitAlias("second","s");addUnitPriority("second",15);addRegexToken("s",match1to2);addRegexToken("ss",match1to2,match2);addParseToken(["s","ss"],SECOND);var getSetSecond=makeGetSet("Seconds",false);addFormatToken("S",0,0,function(){return~~(this.millisecond()/100)});addFormatToken(0,["SS",2],0,function(){return~~(this.millisecond()/10)});addFormatToken(0,["SSS",3],0,"millisecond");addFormatToken(0,["SSSS",4],0,function(){return this.millisecond()*10});addFormatToken(0,["SSSSS",5],0,function(){return this.millisecond()*100});addFormatToken(0,["SSSSSS",6],0,function(){return this.millisecond()*1e3});addFormatToken(0,["SSSSSSS",7],0,function(){return this.millisecond()*1e4});addFormatToken(0,["SSSSSSSS",8],0,function(){return this.millisecond()*1e5});addFormatToken(0,["SSSSSSSSS",9],0,function(){return this.millisecond()*1e6});addUnitAlias("millisecond","ms");addUnitPriority("millisecond",16);addRegexToken("S",match1to3,match1);addRegexToken("SS",match1to3,match2);addRegexToken("SSS",match1to3,match3);var token;for(token="SSSS";token.length<=9;token+="S"){addRegexToken(token,matchUnsigned)}function parseMs(input,array){array[MILLISECOND]=toInt(("0."+input)*1e3)}for(token="S";token.length<=9;token+="S"){addParseToken(token,parseMs)}var getSetMillisecond=makeGetSet("Milliseconds",false);addFormatToken("z",0,0,"zoneAbbr");addFormatToken("zz",0,0,"zoneName");function getZoneAbbr(){return this._isUTC?"UTC":""}function getZoneName(){return this._isUTC?"Coordinated Universal Time":""}var proto=Moment.prototype;proto.add=add;proto.calendar=calendar$1;proto.clone=clone;proto.diff=diff;proto.endOf=endOf;proto.format=format;proto.from=from;proto.fromNow=fromNow;proto.to=to;proto.toNow=toNow;proto.get=stringGet;proto.invalidAt=invalidAt;proto.isAfter=isAfter;proto.isBefore=isBefore;proto.isBetween=isBetween;proto.isSame=isSame;proto.isSameOrAfter=isSameOrAfter;proto.isSameOrBefore=isSameOrBefore;proto.isValid=isValid$2;proto.lang=lang;proto.locale=locale;proto.localeData=localeData;proto.max=prototypeMax;proto.min=prototypeMin;proto.parsingFlags=parsingFlags;proto.set=stringSet;proto.startOf=startOf;proto.subtract=subtract;proto.toArray=toArray;proto.toObject=toObject;proto.toDate=toDate;proto.toISOString=toISOString;proto.inspect=inspect;proto.toJSON=toJSON;proto.toString=toString;proto.unix=unix;proto.valueOf=valueOf;proto.creationData=creationData;proto.year=getSetYear;proto.isLeapYear=getIsLeapYear;proto.weekYear=getSetWeekYear;proto.isoWeekYear=getSetISOWeekYear;proto.quarter=proto.quarters=getSetQuarter;proto.month=getSetMonth;proto.daysInMonth=getDaysInMonth;proto.week=proto.weeks=getSetWeek;proto.isoWeek=proto.isoWeeks=getSetISOWeek;proto.weeksInYear=getWeeksInYear;proto.isoWeeksInYear=getISOWeeksInYear;proto.date=getSetDayOfMonth;proto.day=proto.days=getSetDayOfWeek;proto.weekday=getSetLocaleDayOfWeek;proto.isoWeekday=getSetISODayOfWeek;proto.dayOfYear=getSetDayOfYear;proto.hour=proto.hours=getSetHour;proto.minute=proto.minutes=getSetMinute;proto.second=proto.seconds=getSetSecond;proto.millisecond=proto.milliseconds=getSetMillisecond;proto.utcOffset=getSetOffset;proto.utc=setOffsetToUTC;proto.local=setOffsetToLocal;proto.parseZone=setOffsetToParsedOffset;proto.hasAlignedHourOffset=hasAlignedHourOffset;proto.isDST=isDaylightSavingTime;proto.isLocal=isLocal;proto.isUtcOffset=isUtcOffset;proto.isUtc=isUtc;proto.isUTC=isUtc;proto.zoneAbbr=getZoneAbbr;proto.zoneName=getZoneName;proto.dates=deprecate("dates accessor is deprecated. Use date instead.",getSetDayOfMonth);proto.months=deprecate("months accessor is deprecated. Use month instead",getSetMonth);proto.years=deprecate("years accessor is deprecated. Use year instead",getSetYear);proto.zone=deprecate("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",getSetZone);proto.isDSTShifted=deprecate("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",isDaylightSavingTimeShifted);function createUnix(input){return createLocal(input*1e3)}function createInZone(){return createLocal.apply(null,arguments).parseZone()}function preParsePostFormat(string){return string}var proto$1=Locale.prototype;proto$1.calendar=calendar;proto$1.longDateFormat=longDateFormat;proto$1.invalidDate=invalidDate;proto$1.ordinal=ordinal;proto$1.preparse=preParsePostFormat;proto$1.postformat=preParsePostFormat;proto$1.relativeTime=relativeTime;proto$1.pastFuture=pastFuture;proto$1.set=set;proto$1.months=localeMonths;proto$1.monthsShort=localeMonthsShort;proto$1.monthsParse=localeMonthsParse;proto$1.monthsRegex=monthsRegex;proto$1.monthsShortRegex=monthsShortRegex;proto$1.week=localeWeek;proto$1.firstDayOfYear=localeFirstDayOfYear;proto$1.firstDayOfWeek=localeFirstDayOfWeek;proto$1.weekdays=localeWeekdays;proto$1.weekdaysMin=localeWeekdaysMin;proto$1.weekdaysShort=localeWeekdaysShort;proto$1.weekdaysParse=localeWeekdaysParse;proto$1.weekdaysRegex=weekdaysRegex;proto$1.weekdaysShortRegex=weekdaysShortRegex;proto$1.weekdaysMinRegex=weekdaysMinRegex;proto$1.isPM=localeIsPM;proto$1.meridiem=localeMeridiem;function get$1(format,index,field,setter){var locale=getLocale();var utc=createUTC().set(setter,index);return locale[field](utc,format)}function listMonthsImpl(format,index,field){if(isNumber(format)){index=format;format=undefined}format=format||"";if(index!=null){return get$1(format,index,field,"month")}var i;var out=[];for(i=0;i<12;i++){out[i]=get$1(format,i,field,"month")}return out}function listWeekdaysImpl(localeSorted,format,index,field){if(typeof localeSorted==="boolean"){if(isNumber(format)){index=format;format=undefined}format=format||""}else{format=localeSorted;index=format;localeSorted=false;if(isNumber(format)){index=format;format=undefined}format=format||""}var locale=getLocale(),shift=localeSorted?locale._week.dow:0;if(index!=null){return get$1(format,(index+shift)%7,field,"day")}var i;var out=[];for(i=0;i<7;i++){out[i]=get$1(format,(i+shift)%7,field,"day")}return out}function listMonths(format,index){return listMonthsImpl(format,index,"months")}function listMonthsShort(format,index){return listMonthsImpl(format,index,"monthsShort")}function listWeekdays(localeSorted,format,index){return listWeekdaysImpl(localeSorted,format,index,"weekdays")}function listWeekdaysShort(localeSorted,format,index){return listWeekdaysImpl(localeSorted,format,index,"weekdaysShort")}function listWeekdaysMin(localeSorted,format,index){return listWeekdaysImpl(localeSorted,format,index,"weekdaysMin")}getSetGlobalLocale("en",{dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(number){var b=number%10,output=toInt(number%100/10)===1?"th":b===1?"st":b===2?"nd":b===3?"rd":"th";return number+output}});hooks.lang=deprecate("moment.lang is deprecated. Use moment.locale instead.",getSetGlobalLocale);hooks.langData=deprecate("moment.langData is deprecated. Use moment.localeData instead.",getLocale);var mathAbs=Math.abs;function abs(){var data=this._data;this._milliseconds=mathAbs(this._milliseconds);this._days=mathAbs(this._days);this._months=mathAbs(this._months);data.milliseconds=mathAbs(data.milliseconds);data.seconds=mathAbs(data.seconds);data.minutes=mathAbs(data.minutes);data.hours=mathAbs(data.hours);data.months=mathAbs(data.months);data.years=mathAbs(data.years);return this}function addSubtract$1(duration,input,value,direction){var other=createDuration(input,value);duration._milliseconds+=direction*other._milliseconds;duration._days+=direction*other._days;duration._months+=direction*other._months;return duration._bubble()}function add$1(input,value){return addSubtract$1(this,input,value,1)}function subtract$1(input,value){return addSubtract$1(this,input,value,-1)}function absCeil(number){if(number<0){return Math.floor(number)}else{return Math.ceil(number)}}function bubble(){var milliseconds=this._milliseconds;var days=this._days;var months=this._months;var data=this._data;var seconds,minutes,hours,years,monthsFromDays;if(!(milliseconds>=0&&days>=0&&months>=0||milliseconds<=0&&days<=0&&months<=0)){milliseconds+=absCeil(monthsToDays(months)+days)*864e5;days=0;months=0}data.milliseconds=milliseconds%1e3;seconds=absFloor(milliseconds/1e3);data.seconds=seconds%60;minutes=absFloor(seconds/60);data.minutes=minutes%60;hours=absFloor(minutes/60);data.hours=hours%24;days+=absFloor(hours/24);monthsFromDays=absFloor(daysToMonths(days));months+=monthsFromDays;days-=absCeil(monthsToDays(monthsFromDays));years=absFloor(months/12);months%=12;data.days=days;data.months=months;data.years=years;return this}function daysToMonths(days){return days*4800/146097}function monthsToDays(months){return months*146097/4800}function as(units){if(!this.isValid()){return NaN}var days;var months;var milliseconds=this._milliseconds;units=normalizeUnits(units);if(units==="month"||units==="year"){days=this._days+milliseconds/864e5;months=this._months+daysToMonths(days);return units==="month"?months:months/12}else{days=this._days+Math.round(monthsToDays(this._months));switch(units){case"week":return days/7+milliseconds/6048e5;case"day":return days+milliseconds/864e5;case"hour":return days*24+milliseconds/36e5;case"minute":return days*1440+milliseconds/6e4;case"second":return days*86400+milliseconds/1e3;case"millisecond":return Math.floor(days*864e5)+milliseconds;default:throw new Error("Unknown unit "+units)}}}function valueOf$1(){if(!this.isValid()){return NaN}return this._milliseconds+this._days*864e5+this._months%12*2592e6+toInt(this._months/12)*31536e6}function makeAs(alias){return function(){return this.as(alias)}}var asMilliseconds=makeAs("ms");var asSeconds=makeAs("s");var asMinutes=makeAs("m");var asHours=makeAs("h");var asDays=makeAs("d");var asWeeks=makeAs("w");var asMonths=makeAs("M");var asYears=makeAs("y");function clone$1(){return createDuration(this)}function get$2(units){units=normalizeUnits(units);return this.isValid()?this[units+"s"]():NaN}function makeGetter(name){return function(){return this.isValid()?this._data[name]:NaN}}var milliseconds=makeGetter("milliseconds");var seconds=makeGetter("seconds");var minutes=makeGetter("minutes");var hours=makeGetter("hours");var days=makeGetter("days");var months=makeGetter("months");var years=makeGetter("years");function weeks(){return absFloor(this.days()/7)}var round=Math.round;var thresholds={ss:44,s:45,m:45,h:22,d:26,M:11};function substituteTimeAgo(string,number,withoutSuffix,isFuture,locale){return locale.relativeTime(number||1,!!withoutSuffix,string,isFuture)}function relativeTime$1(posNegDuration,withoutSuffix,locale){var duration=createDuration(posNegDuration).abs();var seconds=round(duration.as("s"));var minutes=round(duration.as("m"));var hours=round(duration.as("h"));var days=round(duration.as("d"));var months=round(duration.as("M"));var years=round(duration.as("y"));var a=seconds<=thresholds.ss&&["s",seconds]||seconds<thresholds.s&&["ss",seconds]||minutes<=1&&["m"]||minutes<thresholds.m&&["mm",minutes]||hours<=1&&["h"]||hours<thresholds.h&&["hh",hours]||days<=1&&["d"]||days<thresholds.d&&["dd",days]||months<=1&&["M"]||months<thresholds.M&&["MM",months]||years<=1&&["y"]||["yy",years];a[2]=withoutSuffix;a[3]=+posNegDuration>0;a[4]=locale;return substituteTimeAgo.apply(null,a)}function getSetRelativeTimeRounding(roundingFunction){if(roundingFunction===undefined){return round}if(typeof roundingFunction==="function"){round=roundingFunction;return true}return false}function getSetRelativeTimeThreshold(threshold,limit){if(thresholds[threshold]===undefined){return false}if(limit===undefined){return thresholds[threshold]}thresholds[threshold]=limit;if(threshold==="s"){thresholds.ss=limit-1}return true}function humanize(withSuffix){if(!this.isValid()){return this.localeData().invalidDate()}var locale=this.localeData();var output=relativeTime$1(this,!withSuffix,locale);if(withSuffix){output=locale.pastFuture(+this,output)}return locale.postformat(output)}var abs$1=Math.abs;function sign(x){return(x>0)-(x<0)||+x}function toISOString$1(){if(!this.isValid()){return this.localeData().invalidDate()}var seconds=abs$1(this._milliseconds)/1e3;var days=abs$1(this._days);var months=abs$1(this._months);var minutes,hours,years;minutes=absFloor(seconds/60);hours=absFloor(minutes/60);seconds%=60;minutes%=60;years=absFloor(months/12);months%=12;var Y=years;var M=months;var D=days;var h=hours;var m=minutes;var s=seconds?seconds.toFixed(3).replace(/\.?0+$/,""):"";var total=this.asSeconds();if(!total){return"P0D"}var totalSign=total<0?"-":"";var ymSign=sign(this._months)!==sign(total)?"-":"";var daysSign=sign(this._days)!==sign(total)?"-":"";var hmsSign=sign(this._milliseconds)!==sign(total)?"-":"";return totalSign+"P"+(Y?ymSign+Y+"Y":"")+(M?ymSign+M+"M":"")+(D?daysSign+D+"D":"")+(h||m||s?"T":"")+(h?hmsSign+h+"H":"")+(m?hmsSign+m+"M":"")+(s?hmsSign+s+"S":"")}var proto$2=Duration.prototype;proto$2.isValid=isValid$1;proto$2.abs=abs;proto$2.add=add$1;proto$2.subtract=subtract$1;proto$2.as=as;proto$2.asMilliseconds=asMilliseconds;proto$2.asSeconds=asSeconds;proto$2.asMinutes=asMinutes;proto$2.asHours=asHours;proto$2.asDays=asDays;proto$2.asWeeks=asWeeks;proto$2.asMonths=asMonths;proto$2.asYears=asYears;proto$2.valueOf=valueOf$1;proto$2._bubble=bubble;proto$2.clone=clone$1;proto$2.get=get$2;proto$2.milliseconds=milliseconds;proto$2.seconds=seconds;proto$2.minutes=minutes;proto$2.hours=hours;proto$2.days=days;proto$2.weeks=weeks;proto$2.months=months;proto$2.years=years;proto$2.humanize=humanize;proto$2.toISOString=toISOString$1;proto$2.toString=toISOString$1;proto$2.toJSON=toISOString$1;proto$2.locale=locale;proto$2.localeData=localeData;proto$2.toIsoString=deprecate("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",toISOString$1);proto$2.lang=lang;addFormatToken("X",0,0,"unix");addFormatToken("x",0,0,"valueOf");addRegexToken("x",matchSigned);addRegexToken("X",matchTimestamp);addParseToken("X",function(input,array,config){config._d=new Date(parseFloat(input,10)*1e3)});addParseToken("x",function(input,array,config){config._d=new Date(toInt(input))});hooks.version="2.22.1";setHookCallback(createLocal);hooks.fn=proto;hooks.min=min;hooks.max=max;hooks.now=now;hooks.utc=createUTC;hooks.unix=createUnix;hooks.months=listMonths;hooks.isDate=isDate;hooks.locale=getSetGlobalLocale;hooks.invalid=createInvalid;hooks.duration=createDuration;hooks.isMoment=isMoment;hooks.weekdays=listWeekdays;hooks.parseZone=createInZone;hooks.localeData=getLocale;hooks.isDuration=isDuration;hooks.monthsShort=listMonthsShort;hooks.weekdaysMin=listWeekdaysMin;hooks.defineLocale=defineLocale;hooks.updateLocale=updateLocale;hooks.locales=listLocales;hooks.weekdaysShort=listWeekdaysShort;hooks.normalizeUnits=normalizeUnits;hooks.relativeTimeRounding=getSetRelativeTimeRounding;hooks.relativeTimeThreshold=getSetRelativeTimeThreshold;hooks.calendarFormat=getCalendarFormat;hooks.prototype=proto;hooks.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"YYYY-[W]WW",MONTH:"YYYY-MM"};return hooks});!function(t,e){"use strict";"function"==typeof define&&define.amd?define("moment-tz",["moment"],e):"object"==typeof module&&module.exports?module.exports=e(require("moment")):e(t.moment)}(this,function(s){"use strict";var e,i={},f={},u={},c={},t=s.version.split("."),n=+t[0],o=+t[1];function a(t){return 96<t?t-87:64<t?t-29:t-48}function r(t){var e=0,n=t.split("."),o=n[0],r=n[1]||"",s=1,i=0,f=1;for(45===t.charCodeAt(0)&&(f=-(e=1));e<o.length;e++)i=60*i+a(o.charCodeAt(e));for(e=0;e<r.length;e++)s/=60,i+=a(r.charCodeAt(e))*s;return i*f}function h(t){for(var e=0;e<t.length;e++)t[e]=r(t[e])}function l(t,e){var n,o=[];for(n=0;n<e.length;n++)o[n]=t[e[n]];return o}function p(t){var e=t.split("|"),n=e[2].split(" "),o=e[3].split(""),r=e[4].split(" ");return h(n),h(o),h(r),function(t,e){for(var n=0;n<e;n++)t[n]=Math.round((t[n-1]||0)+6e4*t[n]);t[e-1]=1/0}(r,o.length),{name:e[0],abbrs:l(e[1].split(" "),o),offsets:l(n,o),untils:r,population:0|e[5]}}function d(t){t&&this._set(p(t))}function m(t){var e=t.toTimeString(),n=e.match(/\([a-z ]+\)/i);"GMT"===(n=n&&n[0]?(n=n[0].match(/[A-Z]/g))?n.join(""):void 0:(n=e.match(/[A-Z]{3,5}/g))?n[0]:void 0)&&(n=void 0),this.at=+t,this.abbr=n,this.offset=t.getTimezoneOffset()}function v(t){this.zone=t,this.offsetScore=0,this.abbrScore=0}function z(t,e){for(var n,o;o=6e4*((e.at-t.at)/12e4|0);)(n=new m(new Date(t.at+o))).offset===t.offset?t=n:e=n;return t}function b(t,e){return t.offsetScore!==e.offsetScore?t.offsetScore-e.offsetScore:t.abbrScore!==e.abbrScore?t.abbrScore-e.abbrScore:e.zone.population-t.zone.population}function g(t,e){var n,o;for(h(e),n=0;n<e.length;n++)o=e[n],c[o]=c[o]||{},c[o][t]=!0}function _(){try{var t=Intl.DateTimeFormat().resolvedOptions().timeZone;if(t&&3<t.length){var e=u[w(t)];if(e)return e;M("Moment Timezone found "+t+" from the Intl api, but did not have that data loaded.")}}catch(t){}var n,o,r,s=function(){var t,e,n,o=(new Date).getFullYear()-2,r=new m(new Date(o,0,1)),s=[r];for(n=1;n<48;n++)(e=new m(new Date(o,n,1))).offset!==r.offset&&(t=z(r,e),s.push(t),s.push(new m(new Date(t.at+6e4)))),r=e;for(n=0;n<4;n++)s.push(new m(new Date(o+n,0,1))),s.push(new m(new Date(o+n,6,1)));return s}(),i=s.length,f=function(t){var e,n,o,r=t.length,s={},i=[];for(e=0;e<r;e++)for(n in o=c[t[e].offset]||{})o.hasOwnProperty(n)&&(s[n]=!0);for(e in s)s.hasOwnProperty(e)&&i.push(u[e]);return i}(s),a=[];for(o=0;o<f.length;o++){for(n=new v(S(f[o]),i),r=0;r<i;r++)n.scoreOffsetAt(s[r]);a.push(n)}return a.sort(b),0<a.length?a[0].zone.name:void 0}function w(t){return(t||"").toLowerCase().replace(/\//g,"_")}function y(t){var e,n,o,r;for("string"==typeof t&&(t=[t]),e=0;e<t.length;e++)r=w(n=(o=t[e].split("|"))[0]),i[r]=t[e],u[r]=n,g(r,o[2].split(" "))}function S(t,e){t=w(t);var n,o=i[t];return o instanceof d?o:"string"==typeof o?(o=new d(o),i[t]=o):f[t]&&e!==S&&(n=S(f[t],S))?((o=i[t]=new d)._set(n),o.name=u[t],o):null}function O(t){var e,n,o,r;for("string"==typeof t&&(t=[t]),e=0;e<t.length;e++)o=w((n=t[e].split("|"))[0]),r=w(n[1]),f[o]=r,u[o]=n[0],f[r]=o,u[r]=n[1]}function A(t){var e="X"===t._f||"x"===t._f;return!(!t._a||void 0!==t._tzm||e)}function M(t){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(t)}function j(t){var e=Array.prototype.slice.call(arguments,0,-1),n=arguments[arguments.length-1],o=S(n),r=s.utc.apply(null,e);return o&&!s.isMoment(t)&&A(r)&&r.add(o.parse(r),"minutes"),r.tz(n),r}(n<2||2===n&&o<6)&&M("Moment Timezone requires Moment.js >= 2.6.0. You are using Moment.js "+s.version+". See momentjs.com"),d.prototype={_set:function(t){this.name=t.name,this.abbrs=t.abbrs,this.untils=t.untils,this.offsets=t.offsets,this.population=t.population},_index:function(t){var e,n=+t,o=this.untils;for(e=0;e<o.length;e++)if(n<o[e])return e},parse:function(t){var e,n,o,r,s=+t,i=this.offsets,f=this.untils,a=f.length-1;for(r=0;r<a;r++)if(e=i[r],n=i[r+1],o=i[r?r-1:r],e<n&&j.moveAmbiguousForward?e=n:o<e&&j.moveInvalidForward&&(e=o),s<f[r]-6e4*e)return i[r];return i[a]},abbr:function(t){return this.abbrs[this._index(t)]},offset:function(t){return M("zone.offset has been deprecated in favor of zone.utcOffset"),this.offsets[this._index(t)]},utcOffset:function(t){return this.offsets[this._index(t)]}},v.prototype.scoreOffsetAt=function(t){this.offsetScore+=Math.abs(this.zone.utcOffset(t.at)-t.offset),this.zone.abbr(t.at).replace(/[^A-Z]/g,"")!==t.abbr&&this.abbrScore++},j.version="0.5.16",j.dataVersion="",j._zones=i,j._links=f,j._names=u,j.add=y,j.link=O,j.load=function(t){y(t.zones),O(t.links),j.dataVersion=t.version},j.zone=S,j.zoneExists=function t(e){return t.didShowError||(t.didShowError=!0,M("moment.tz.zoneExists('"+e+"') has been deprecated in favor of !moment.tz.zone('"+e+"')")),!!S(e)},j.guess=function(t){return e&&!t||(e=_()),e},j.names=function(){var t,e=[];for(t in u)u.hasOwnProperty(t)&&(i[t]||i[f[t]])&&u[t]&&e.push(u[t]);return e.sort()},j.Zone=d,j.unpack=p,j.unpackBase60=r,j.needsOffset=A,j.moveInvalidForward=!0,j.moveAmbiguousForward=!1;var D,x=s.fn;function T(t){return function(){return this._z?this._z.abbr(this):t.call(this)}}s.tz=j,s.defaultZone=null,s.updateOffset=function(t,e){var n,o=s.defaultZone;void 0===t._z&&(o&&A(t)&&!t._isUTC&&(t._d=s.utc(t._a)._d,t.utc().add(o.parse(t),"minutes")),t._z=o),t._z&&(n=t._z.utcOffset(t),Math.abs(n)<16&&(n/=60),void 0!==t.utcOffset?t.utcOffset(-n,e):t.zone(n,e))},x.tz=function(t,e){return t?(this._z=S(t),this._z?s.updateOffset(this,e):M("Moment Timezone has no data for "+t+". See http://momentjs.com/timezone/docs/#/data-loading/."),this):this._z?this._z.name:void 0},x.zoneName=T(x.zoneName),x.zoneAbbr=T(x.zoneAbbr),x.utc=(D=x.utc,function(){return this._z=null,D.apply(this,arguments)}),s.tz.setDefault=function(t){return(n<2||2===n&&o<9)&&M("Moment Timezone setDefault() requires Moment.js >= 2.9.0. You are using Moment.js "+s.version+"."),s.defaultZone=t?S(t):null,s};var Z=s.momentProperties;return"[object Array]"===Object.prototype.toString.call(Z)?(Z.push("_z"),Z.push("_a")):Z&&(Z._z=null),s});define("src/helpers/appSettingsHelper",[],function(){"use strict";if(!window.AppSettings){throw new Error("Cannot bootstrap application, window.AppSettings is not defined")}var data=Object.freeze(window.AppSettings);window.AppSettings=null;return{get:function get(prop){return data[prop]},json:function json(){return data}}});define("moment-timezone",["moment-tz","src/helpers/appSettingsHelper"],function(momentTimezone,appSettingsHelper){"use strict";momentTimezone.tz.load(appSettingsHelper.get("timezones"));return momentTimezone});(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==="object"&&typeof module==="object")module.exports=factory(require("moment-timezone"),require("underscore"));else if(typeof define==="function"&&define.amd)define("bw-fe-helpers/timezoneDateHelper",["moment-timezone","underscore"],factory);else{var a=typeof exports==="object"?factory(require("moment-timezone"),require("underscore")):factory(root["moment-timezone"],root["underscore"]);for(var i in a)(typeof exports==="object"?exports:root)[i]=a[i]}})(this,function(__WEBPACK_EXTERNAL_MODULE__0__,__WEBPACK_EXTERNAL_MODULE__1__){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=30)}({0:function(module,exports){module.exports=__WEBPACK_EXTERNAL_MODULE__0__},1:function(module,exports){module.exports=__WEBPACK_EXTERNAL_MODULE__1__},2:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var moment_timezone__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0);var moment_timezone__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(moment_timezone__WEBPACK_IMPORTED_MODULE_0__);var underscore__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(1);var underscore__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(underscore__WEBPACK_IMPORTED_MODULE_1__);var notADateRegex=/^[0-9]{0,6}$/,ticksSince1970Regex=/^([0-9]{6,})$/,ISODateAndTimeRegex=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})/,yearMonthDayRegex=/^([0-9]{4})-([0-9]{1,2})-([0-9]{1,2})$/,dayMonthYearRegex=/^([0-9]{1,2})-([0-9]{1,2})-([0-9]{4})$/,yearMonthDayWithTimeRegex=/^([0-9]{4})-([0-9]{2})-([0-9]{1,2}).([0-9]{1,2}):([0-9]{1,2}):?([0-9]{1,2})?/,dayMonthYearWithTimeRegex=/^([0-9]{1,2})-([0-9]{2})-([0-9]{4}).([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})/,workbenchTimeRegex=/^([a-z]{3}) ([0-9]{2}), ([0-9]{4})$/i,ieTimeStringRegex=/^[a-z]{3} ([a-z]{3}) ([0-9]{1,2}) ([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2}) UTC([+-][0-9]{4}) ([0-9]{4})$/i,twentyFourHourRegex=/^(\d{2})(?::\d{2})?$/,monthsShort="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),DEFAULT_TIMEZONE="UTC";function today(timezone){var now=timezone?moment_timezone__WEBPACK_IMPORTED_MODULE_0___default.a.tz(timezone):moment_timezone__WEBPACK_IMPORTED_MODULE_0___default()();return now.startOf("day").toDate()}function isIsoDateString(str){var LOOKS_LIKE_ISO8601=new RegExp(/^\d{4}(-\d{2}(-\d{2})?)?((\s|T)\d{2}(:\d{2})(:\d{2})?)?/),isString=typeof str==="string",isIsoDate=isString&&LOOKS_LIKE_ISO8601.test(str);return isIsoDate||false}function isLocaleDateString(str){var localeDateStringRegex=new RegExp("^("+monthsShort.join("|")+") ([0-9]{1,2}),\\s?([0-9]{4})$","i"),isString=typeof str==="string",isLocaleDate=isString&&localeDateStringRegex.test(str);return isLocaleDate||false}function buildMomentInTimezone(arg,timezone){if(timezone){return moment_timezone__WEBPACK_IMPORTED_MODULE_0___default.a.tz(arg,timezone)}else{return moment_timezone__WEBPACK_IMPORTED_MODULE_0___default()(arg)}}function buildDateObject(arg,timezone){return buildMomentInTimezone(arg,timezone).toDate()}__webpack_exports__["default"]={isLocaleDateString:isLocaleDateString,isIsoDateString:isIsoDateString,today:today,monthsShort:monthsShort,fromNow:function fromNow(date,options){options=options||{};var parsedDate=this.parse(date),m=moment_timezone__WEBPACK_IMPORTED_MODULE_0___default()(parsedDate),diff=moment_timezone__WEBPACK_IMPORTED_MODULE_0___default()(new Date).diff(m),format=options.format||"MMM DD, YYYY",timezone=options.timezone;if(!parsedDate){return undefined}if(diff>7*24*60*60*1e3){return timezone?m.tz(options.timezone).format(format):m.format(format)}else if(diff<=3e4){return"Just now"}else if(diff>3e4&&diff<9e4){return"About a minute ago"}return m.from(new Date)},parse:function parse(originalDate,timezone){var date;var execResult;if(underscore__WEBPACK_IMPORTED_MODULE_1___default.a.isDate(originalDate)){return originalDate}else if(underscore__WEBPACK_IMPORTED_MODULE_1___default.a.isUndefined(originalDate)){return}if(notADateRegex.test(originalDate)){return}else if(execResult=ticksSince1970Regex.exec(originalDate)){date=buildDateObject(parseInt(execResult[1],10),timezone)}else if(execResult=ISODateAndTimeRegex.exec(originalDate)){date=buildDateObject(originalDate,timezone)}else if(execResult=yearMonthDayRegex.exec(originalDate)){date=buildDateObject([execResult[1],execResult[2]-1,execResult[3]],timezone)}else if(execResult=dayMonthYearRegex.exec(originalDate)){date=buildDateObject([parseInt(execResult[3],10),parseInt(execResult[2],10)-1,parseInt(execResult[1],10)],timezone)}else if(execResult=yearMonthDayWithTimeRegex.exec(originalDate)){date=buildDateObject([parseInt(execResult[1],10),parseInt(execResult[2],10)-1,parseInt(execResult[3],10),parseInt(execResult[4],10),parseInt(execResult[5],10),parseInt(execResult[6],10)||0],timezone)}else if(execResult=dayMonthYearWithTimeRegex.exec(originalDate)){date=buildDateObject([parseInt(execResult[3],10),parseInt(execResult[2],10)-1,parseInt(execResult[1],10),parseInt(execResult[4],10),parseInt(execResult[5],10),parseInt(execResult[6],10)||0],timezone)}else if(execResult=workbenchTimeRegex.exec(originalDate)){date=buildDateObject([parseInt(execResult[3],10),monthsShort.indexOf(execResult[1]),parseInt(execResult[2],10)],timezone)}else if(execResult=ieTimeStringRegex.exec(originalDate)){date=buildDateObject([parseInt(execResult[7],10),monthsShort.indexOf(execResult[1]),parseInt(execResult[2],10),parseInt(execResult[3],10),parseInt(execResult[4],10),parseInt(execResult[5],10)],timezone)}else{date=buildDateObject(originalDate,timezone)}if(underscore__WEBPACK_IMPORTED_MODULE_1___default.a.isDate(date)&&!isNaN(date)&&!underscore__WEBPACK_IMPORTED_MODULE_1___default.a.isNumber(date)){if(date.getFullYear()===1970){return}return date}return},daysBetween:function daysBetween(dt1,dt2){if(dt1 instanceof Date===false){dt1=this.parse(dt1)}if(dt2 instanceof Date===false){dt2=this.parse(dt2)}var diff=moment_timezone__WEBPACK_IMPORTED_MODULE_0___default()(dt1).diff(moment_timezone__WEBPACK_IMPORTED_MODULE_0___default()(dt2),"days");return diff<0?-diff:diff},isFixedDate:function isFixedDate(date){date=date||"";var split=date.split(" - ");if(split.length===0||split.length>2){return false}return underscore__WEBPACK_IMPORTED_MODULE_1___default()(split).all(function(s){return this.parse(s)},this)},parseRelativeDate:function parseRelativeDate(relativeDate,timezone){var rxDays=/^Last ([0-9]+) Days$/i,daysMatch,output={start:today(timezone),end:today(timezone)};relativeDate=relativeDate.toLowerCase();if(relativeDate==="today"){return output}daysMatch=rxDays.exec(relativeDate);if(!daysMatch){throw new Error("unable to parse relative date "+relativeDate)}output.start=moment_timezone__WEBPACK_IMPORTED_MODULE_0___default()(output.start).add({d:-parseInt(daysMatch[1],10)}).toDate();return output},parseDateRange:function parseDateRange(val,timezone){var startDate,endDate,split;if(underscore__WEBPACK_IMPORTED_MODULE_1___default.a.isString(val)){split=val.split(" - ");if(split.length===2){startDate=this.parse(split[0],timezone);endDate=this.parse(split[1],timezone)}else{return this.parseRelativeDate(val,timezone)}}else if(underscore__WEBPACK_IMPORTED_MODULE_1___default.a.isDate(val.startDate)&&underscore__WEBPACK_IMPORTED_MODULE_1___default.a.isDate(val.endDate)){startDate=val.startDate;endDate=val.endDate}if(endDate&&startDate&&endDate.getTime()<startDate.getTime()){return}return{start:startDate,end:endDate}},formatInterval:function formatInterval(startDate,endDate){var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var timezone=options.timezone||DEFAULT_TIMEZONE;if(!underscore__WEBPACK_IMPORTED_MODULE_1___default.a.isDate(startDate)){throw new TypeError("startDate argument must be a Date")}if(!underscore__WEBPACK_IMPORTED_MODULE_1___default.a.isDate(endDate)){throw new TypeError("endDate argument must be a Date")}return moment_timezone__WEBPACK_IMPORTED_MODULE_0___default.a.tz(startDate,timezone).format("MMM DD, YYYY")+" - "+moment_timezone__WEBPACK_IMPORTED_MODULE_0___default.a.tz(endDate,timezone).format("MMM DD, YYYY")},makeDateRange:function makeDateRange(startDate,endDate,options){options=options||{};var format="MMM DD, YYYY";var timezone=options.timezone;var formatAsRelative=options.formatAsRelative;var parsedStartDate;var parsedEndDate;var days;if(formatAsRelative){days=this.daysBetween(startDate,endDate);return days===0?"Today":"Last "+days+" days"}parsedStartDate=this.parse(startDate);parsedEndDate=this.parse(endDate);if(timezone){return moment_timezone__WEBPACK_IMPORTED_MODULE_0___default.a.tz(parsedStartDate,timezone).format(format)+" - "+moment_timezone__WEBPACK_IMPORTED_MODULE_0___default.a.tz(parsedEndDate,timezone).format(format)}return moment_timezone__WEBPACK_IMPORTED_MODULE_0___default()(parsedStartDate).format(format)+" - "+moment_timezone__WEBPACK_IMPORTED_MODULE_0___default()(parsedEndDate).format(format)},prettifyDate:function prettifyDate(text,params){params=params||{};var timezone=params.timezone;var d=this.parse(text,timezone);var momentForDate=buildMomentInTimezone(d,timezone);var formatOptions={timezone:timezone};if(!d){return text}if(params.format){return this.format(d,params.format,formatOptions)}if(momentForDate.minutes()>0){return this.format(d,"D MMM h:mma",formatOptions)}if(momentForDate.hours()>0){return this.format(d,"D MMM ha",formatOptions)}return this.format(d,"D MMM",formatOptions)},format:function format(date,_format,options){options=options||{};var timezone=options.timezone;if(!date){return undefined}date=this.parse(date,timezone);if(timezone){return moment_timezone__WEBPACK_IMPORTED_MODULE_0___default.a.tz(date,timezone).format(_format)}return moment_timezone__WEBPACK_IMPORTED_MODULE_0___default()(date).format(_format)},getFirstDayOfTheWeek:function getFirstDayOfTheWeek(date,format){var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};if(!date){return undefined}var timezone=options.timezone;date=this.parse(date,timezone);if(timezone){return moment_timezone__WEBPACK_IMPORTED_MODULE_0___default.a.tz(date,timezone).startOf("isoweek").format(format)}return moment_timezone__WEBPACK_IMPORTED_MODULE_0___default()(date).startOf("isoweek").format(format)},getEndOf:function getEndOf(date,unit,timezone){return moment_timezone__WEBPACK_IMPORTED_MODULE_0___default.a.tz(date,timezone).endOf(unit).toISOString()},getStartOf:function getStartOf(date,unit,timezone){return moment_timezone__WEBPACK_IMPORTED_MODULE_0___default.a.tz(date,timezone).startOf(unit).toISOString()},getLastDayOfTheWeek:function getLastDayOfTheWeek(date,format){var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};if(!date){return undefined}var timezone=options.timezone;date=this.parse(date,timezone);if(timezone){return moment_timezone__WEBPACK_IMPORTED_MODULE_0___default.a.tz(date,timezone).endOf("isoweek").format(format)}return moment_timezone__WEBPACK_IMPORTED_MODULE_0___default()(date).endOf("isoweek").format(format)},addUnit:function addUnit(date,duration,unit,timezone){return moment_timezone__WEBPACK_IMPORTED_MODULE_0___default.a.tz(date,timezone).add(duration,unit).toISOString(true)},formatTimeStamp:function formatTimeStamp(timestamp,timezone){var now=moment_timezone__WEBPACK_IMPORTED_MODULE_0___default.a.utc(),date,diffSeconds;if(!timestamp){return undefined}date=moment_timezone__WEBPACK_IMPORTED_MODULE_0___default.a.utc(timestamp);if(now.diff(date,"hours")>23){return date.tz(timezone||DEFAULT_TIMEZONE).format("D MMM")}diffSeconds=now.diff(date,"seconds");if(diffSeconds<60){return diffSeconds+"s"}if(diffSeconds<3600){return now.diff(date,"minutes")+"m"}return now.diff(date,"hours")+"h"},prettifyChartDimensionLabel:function prettifyChartDimensionLabel(text,type){switch(type.toLowerCase()){case"hour":return this.prettifyDate(text,{format:"D MMM ha"});case"day":case"week":return this.prettifyDate(text);case"month":return this.prettifyDate(text,{format:"MMM YYYY"})}return text},formatDateForSync:function formatDateForSync(date){return this.format(date,"YYYY-MM-DDTHH:mm:ss.000\\Z")},formatEndDateForSync:function formatEndDateForSync(date){date=this.parse(date);if(!date){return}date=moment_timezone__WEBPACK_IMPORTED_MODULE_0___default()(date).clone().add({d:1}).toDate();return this.formatDateForSync(date)},remainingDaysThisMonth:function remainingDaysThisMonth(){var now=new Date,nextMonth=moment_timezone__WEBPACK_IMPORTED_MODULE_0___default()([now.getFullYear(),now.getMonth(),1]).add({M:1});return nextMonth.diff(moment_timezone__WEBPACK_IMPORTED_MODULE_0___default()(now),"days")},formatDateForJSON:function formatDateForJSON(date){return this.format(date,"YYYY-MM-DDTHH:mm:ss.000\\Z")},addTimezoneOffset:function addTimezoneOffset(date){date=this.parse(date);return new Date(date.getTime()+date.getTimezoneOffset()*60*1e3)},removeTimezoneOffset:function removeTimezoneOffset(date){date=this.parse(date);if(!date){return undefined}return new Date(date.getTime()-date.getTimezoneOffset()*60*1e3)},formatTwentyFourHourAsTwelveHour:function formatTwentyFourHourAsTwelveHour(val){var hourMatches;hourMatches=twentyFourHourRegex.exec(val);if(!hourMatches||hourMatches[1]>23){throw new Error("invalid twenty four hour value: "+val)}return moment_timezone__WEBPACK_IMPORTED_MODULE_0___default()(val+"","HH").format("ha")},formatNumericDayOfWeekInFull:function formatNumericDayOfWeekInFull(val){var numericDay=underscore__WEBPACK_IMPORTED_MODULE_1___default.a.isNumber(val)?val:parseInt(val,10);if(numericDay<1||numericDay>7){throw new Error("invalid numeric day: "+val)}return moment_timezone__WEBPACK_IMPORTED_MODULE_0___default()().isoWeekday(numericDay).format("dddd")}}},30:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var moment_timezone__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0);var moment_timezone__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(moment_timezone__WEBPACK_IMPORTED_MODULE_0__);var _dateHelper__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(2);var DEFAULT_DATE_TIME_FORMAT="ddd, DD MMM YYYY HH:mm:ss",DEFAULT_TIMEZONE="UTC",SUPPORTED_TIMEZONES=moment_timezone__WEBPACK_IMPORTED_MODULE_0___default.a.tz.names();function extractFormattingOptions(options){options=options||{};var timezone=options.timezone||DEFAULT_TIMEZONE,format=options.format||DEFAULT_DATE_TIME_FORMAT,timezoneAbbr=timezone==="UTC"?" (UTC)":" (UTCZ)";return{format:format+timezoneAbbr,timezone:timezone}}__webpack_exports__["default"]={DEFAULT_TIMEZONE:DEFAULT_TIMEZONE,prettifyDate:function prettifyDate(date,options){return _dateHelper__WEBPACK_IMPORTED_MODULE_1__["default"].prettifyDate(date,extractFormattingOptions(options))},fromNow:function fromNow(date,options){return _dateHelper__WEBPACK_IMPORTED_MODULE_1__["default"].fromNow(date,extractFormattingOptions(options))},getSupportedTimezones:function getSupportedTimezones(){return SUPPORTED_TIMEZONES},getTimezoneNameWithOffset:function getTimezoneNameWithOffset(timezoneName){if(timezoneName&&timezoneName!=="UTC"){return[this.formatTimezoneName(timezoneName),moment_timezone__WEBPACK_IMPORTED_MODULE_0___default.a.tz(timezoneName).format("(UTCZ)")].join(" ")}else{return"UTC"}},formatTimezoneName:function formatTimezoneName(timezoneName){return timezoneName.replace(/_/gi," ")},getTimezoneOffset:function getTimezoneOffset(date,timezone){return 0-moment_timezone__WEBPACK_IMPORTED_MODULE_0___default.a.tz(date,timezone).utcOffset()},addOffset:function addOffset(date,timezone){var utcOffset=moment_timezone__WEBPACK_IMPORTED_MODULE_0___default.a.tz(date,timezone).utcOffset();return moment_timezone__WEBPACK_IMPORTED_MODULE_0___default.a.utc(date).add({m:utcOffset})},stripOffset:function stripOffset(date,timezone){var utcOffset=moment_timezone__WEBPACK_IMPORTED_MODULE_0___default.a.tz(date,timezone).utcOffset();return moment_timezone__WEBPACK_IMPORTED_MODULE_0___default.a.utc(date).subtract({m:utcOffset})},replaceTimezoneOffset:function replaceTimezoneOffset(dateTime,newTimezone){var ISOString=moment_timezone__WEBPACK_IMPORTED_MODULE_0___default.a.parseZone(dateTime).format("YYYY-MM-DDTHH:mm:ss.000");var offset=moment_timezone__WEBPACK_IMPORTED_MODULE_0___default.a.tz(ISOString,newTimezone).format("Z");return ISOString+offset},formatInAnotherTimezone:function formatInAnotherTimezone(dateTime,newTimezone){return moment_timezone__WEBPACK_IMPORTED_MODULE_0___default.a.tz(dateTime,newTimezone).format("YYYY-MM-DDTHH:mm:ss.000Z")},getUtcOffsetInMinutes:function getUtcOffsetInMinutes(date,offsetString){if(offsetString==="UTC"){return 0}var utcISOString=moment_timezone__WEBPACK_IMPORTED_MODULE_0___default.a.utc(date).format("YYYY-MM-DDTHH:mm:ss.000");return moment_timezone__WEBPACK_IMPORTED_MODULE_0___default.a.parseZone(utcISOString+offsetString).utcOffset()}}}})["default"]});define("src/models/Project",["jquery","backbone","underscore","bw-fe-helpers/timezoneDateHelper"],function($,Backbone,_,timezoneDateHelper){"use strict";return Backbone.Validations.Model.extend({defaults:{defaultLangCodes:["en"],defaultIndustry:"general-(recommended)"},validate:{name:{required:true},defaultLangCodes:{custom:"validateDefaultLangCodes"},timezone:{custom:"validateTimezone"}},validateDefaultLangCodes:function validateDefaultLangCodes(attrName,attrValue){if(!_.isArray(attrValue)){return"Array of default languages is required"}},validateTimezone:function validateTimezone(attrName,timezone){if(timezoneDateHelper.getSupportedTimezones().indexOf(timezone)===-1){return"Please choose a valid timezone"}},url:function url(){return"/projects/"+(this.id||"")},getTimezone:function getTimezone(){return this.get("timezone")||timezoneDateHelper.DEFAULT_TIMEZONE},copy:function copy(options){var Workbench=require("src/Workbench");var ajaxOptions=_.extend({contentType:"application/json",type:"POST",url:Workbench.buildApiUrl("/projects/"+this.id+"/copy")},options);$.ajax(ajaxOptions)}})});(function(definition){"use strict";if(typeof bootstrap==="function"){bootstrap("promise",definition)}else if(typeof exports==="object"&&typeof module==="object"){module.exports=definition()}else if(typeof define==="function"&&define.amd){define("q",definition)}else if(typeof ses!=="undefined"){if(!ses.ok()){return}else{ses.makeQ=definition}}else if(typeof self!=="undefined"){self.Q=definition()}else{throw new Error("This environment was not anticipated by Q. Please file a bug.")}})(function(){"use strict";var hasStacks=false;try{throw new Error}catch(e){hasStacks=!!e.stack}var qStartingLine=captureLine();var qFileName;var noop=function(){};var nextTick=function(){var head={task:void 0,next:null};var tail=head;var flushing=false;var requestTick=void 0;var isNodeJS=false;var laterQueue=[];function flush(){var task,domain;while(head.next){head=head.next;task=head.task;head.task=void 0;domain=head.domain;if(domain){head.domain=void 0;domain.enter()}runSingle(task,domain)}while(laterQueue.length){task=laterQueue.pop();runSingle(task)}flushing=false}function runSingle(task,domain){try{task()}catch(e){if(isNodeJS){if(domain){domain.exit()}setTimeout(flush,0);if(domain){domain.enter()}throw e}else{setTimeout(function(){throw e},0)}}if(domain){domain.exit()}}nextTick=function(task){tail=tail.next={task:task,domain:isNodeJS&&process.domain,next:null};if(!flushing){flushing=true;requestTick()}};if(typeof process==="object"&&process.toString()==="[object process]"&&process.nextTick){isNodeJS=true;requestTick=function(){process.nextTick(flush)}}else if(typeof setImmediate==="function"){if(typeof window!=="undefined"){requestTick=setImmediate.bind(window,flush)}else{requestTick=function(){setImmediate(flush)}}}else if(typeof MessageChannel!=="undefined"){var channel=new MessageChannel;channel.port1.onmessage=function(){requestTick=requestPortTick;channel.port1.onmessage=flush;flush()};var requestPortTick=function(){channel.port2.postMessage(0)};requestTick=function(){setTimeout(flush,0);requestPortTick()}}else{requestTick=function(){setTimeout(flush,0)}}nextTick.runAfter=function(task){laterQueue.push(task);if(!flushing){flushing=true;requestTick()}};return nextTick}();var call=Function.call;function uncurryThis(f){return function(){return call.apply(f,arguments)}}var array_slice=uncurryThis(Array.prototype.slice);var array_reduce=uncurryThis(Array.prototype.reduce||function(callback,basis){var index=0,length=this.length;if(arguments.length===1){do{if(index in this){basis=this[index++];break}if(++index>=length){throw new TypeError}}while(1)}for(;index<length;index++){if(index in this){basis=callback(basis,this[index],index)}}return basis});var array_indexOf=uncurryThis(Array.prototype.indexOf||function(value){for(var i=0;i<this.length;i++){if(this[i]===value){return i}}return-1});var array_map=uncurryThis(Array.prototype.map||function(callback,thisp){var self=this;var collect=[];array_reduce(self,function(undefined,value,index){collect.push(callback.call(thisp,value,index,self))},void 0);return collect});var object_create=Object.create||function(prototype){function Type(){}Type.prototype=prototype;return new Type};var object_hasOwnProperty=uncurryThis(Object.prototype.hasOwnProperty);var object_keys=Object.keys||function(object){var keys=[];for(var key in object){if(object_hasOwnProperty(object,key)){keys.push(key)}}return keys};var object_toString=uncurryThis(Object.prototype.toString);function isObject(value){return value===Object(value)}function isStopIteration(exception){return object_toString(exception)==="[object StopIteration]"||exception instanceof QReturnValue}var QReturnValue;if(typeof ReturnValue!=="undefined"){QReturnValue=ReturnValue}else{QReturnValue=function(value){this.value=value}}var STACK_JUMP_SEPARATOR="From previous event:";function makeStackTraceLong(error,promise){if(hasStacks&&promise.stack&&typeof error==="object"&&error!==null&&error.stack&&error.stack.indexOf(STACK_JUMP_SEPARATOR)===-1){var stacks=[];for(var p=promise;!!p;p=p.source){if(p.stack){stacks.unshift(p.stack)}}stacks.unshift(error.stack);var concatedStacks=stacks.join("\n"+STACK_JUMP_SEPARATOR+"\n");error.stack=filterStackString(concatedStacks)}}function filterStackString(stackString){var lines=stackString.split("\n");var desiredLines=[];for(var i=0;i<lines.length;++i){var line=lines[i];if(!isInternalFrame(line)&&!isNodeFrame(line)&&line){desiredLines.push(line)}}return desiredLines.join("\n")}function isNodeFrame(stackLine){return stackLine.indexOf("(module.js:")!==-1||stackLine.indexOf("(node.js:")!==-1}function getFileNameAndLineNumber(stackLine){var attempt1=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(stackLine);if(attempt1){return[attempt1[1],Number(attempt1[2])]}var attempt2=/at ([^ ]+):(\d+):(?:\d+)$/.exec(stackLine);if(attempt2){return[attempt2[1],Number(attempt2[2])]}var attempt3=/.*@(.+):(\d+)$/.exec(stackLine);if(attempt3){return[attempt3[1],Number(attempt3[2])]}}function isInternalFrame(stackLine){var fileNameAndLineNumber=getFileNameAndLineNumber(stackLine);if(!fileNameAndLineNumber){return false}var fileName=fileNameAndLineNumber[0];var lineNumber=fileNameAndLineNumber[1];return fileName===qFileName&&lineNumber>=qStartingLine&&lineNumber<=qEndingLine}function captureLine(){if(!hasStacks){return}try{throw new Error}catch(e){var lines=e.stack.split("\n");var firstLine=lines[0].indexOf("@")>0?lines[1]:lines[2];var fileNameAndLineNumber=getFileNameAndLineNumber(firstLine);if(!fileNameAndLineNumber){return}qFileName=fileNameAndLineNumber[0];return fileNameAndLineNumber[1]}}function deprecate(callback,name,alternative){return function(){if(typeof console!=="undefined"&&typeof console.warn==="function"){console.warn(name+" is deprecated, use "+alternative+" instead.",new Error("").stack)}return callback.apply(callback,arguments)}}function Q(value){if(value instanceof Promise){return value}if(isPromiseAlike(value)){return coerce(value)}else{return fulfill(value)}}Q.resolve=Q;Q.nextTick=nextTick;Q.longStackSupport=false;if(typeof process==="object"&&process&&process.env&&process.env.Q_DEBUG){Q.longStackSupport=true}Q.defer=defer;function defer(){var messages=[],progressListeners=[],resolvedPromise;var deferred=object_create(defer.prototype);var promise=object_create(Promise.prototype);promise.promiseDispatch=function(resolve,op,operands){var args=array_slice(arguments);if(messages){messages.push(args);if(op==="when"&&operands[1]){progressListeners.push(operands[1])}}else{Q.nextTick(function(){resolvedPromise.promiseDispatch.apply(resolvedPromise,args)})}};promise.valueOf=function(){if(messages){return promise}var nearerValue=nearer(resolvedPromise);if(isPromise(nearerValue)){resolvedPromise=nearerValue}return nearerValue};promise.inspect=function(){if(!resolvedPromise){return{state:"pending"}}return resolvedPromise.inspect()};if(Q.longStackSupport&&hasStacks){try{throw new Error}catch(e){promise.stack=e.stack.substring(e.stack.indexOf("\n")+1)}}function become(newPromise){resolvedPromise=newPromise;promise.source=newPromise;array_reduce(messages,function(undefined,message){Q.nextTick(function(){newPromise.promiseDispatch.apply(newPromise,message)})},void 0);messages=void 0;progressListeners=void 0}deferred.promise=promise;deferred.resolve=function(value){if(resolvedPromise){return}become(Q(value))};deferred.fulfill=function(value){if(resolvedPromise){return}become(fulfill(value))};deferred.reject=function(reason){if(resolvedPromise){return}become(reject(reason))};deferred.notify=function(progress){if(resolvedPromise){return}array_reduce(progressListeners,function(undefined,progressListener){Q.nextTick(function(){progressListener(progress)})},void 0)};return deferred}defer.prototype.makeNodeResolver=function(){var self=this;return function(error,value){if(error){self.reject(error)}else if(arguments.length>2){self.resolve(array_slice(arguments,1))}else{self.resolve(value)}}};Q.Promise=promise;Q.promise=promise;function promise(resolver){if(typeof resolver!=="function"){throw new TypeError("resolver must be a function.")}var deferred=defer();try{resolver(deferred.resolve,deferred.reject,deferred.notify)}catch(reason){deferred.reject(reason)}return deferred.promise}promise.race=race;promise.all=all;promise.reject=reject;promise.resolve=Q;Q.passByCopy=function(object){return object};Promise.prototype.passByCopy=function(){return this};Q.join=function(x,y){return Q(x).join(y)};Promise.prototype.join=function(that){return Q([this,that]).spread(function(x,y){if(x===y){return x}else{throw new Error("Can't join: not the same: "+x+" "+y)}})};Q.race=race;function race(answerPs){return promise(function(resolve,reject){for(var i=0,len=answerPs.length;i<len;i++){Q(answerPs[i]).then(resolve,reject)}})}Promise.prototype.race=function(){return this.then(Q.race)};Q.makePromise=Promise;function Promise(descriptor,fallback,inspect){if(fallback===void 0){fallback=function(op){return reject(new Error("Promise does not support operation: "+op))}}if(inspect===void 0){inspect=function(){return{state:"unknown"}}}var promise=object_create(Promise.prototype);promise.promiseDispatch=function(resolve,op,args){var result;try{if(descriptor[op]){result=descriptor[op].apply(promise,args)}else{result=fallback.call(promise,op,args)}}catch(exception){result=reject(exception)}if(resolve){resolve(result)}};promise.inspect=inspect;if(inspect){var inspected=inspect();if(inspected.state==="rejected"){promise.exception=inspected.reason}promise.valueOf=function(){var inspected=inspect();if(inspected.state==="pending"||inspected.state==="rejected"){return promise}return inspected.value}}return promise}Promise.prototype.toString=function(){return"[object Promise]"};Promise.prototype.then=function(fulfilled,rejected,progressed){var self=this;var deferred=defer();var done=false;function _fulfilled(value){try{return typeof fulfilled==="function"?fulfilled(value):value}catch(exception){return reject(exception)}}function _rejected(exception){if(typeof rejected==="function"){makeStackTraceLong(exception,self);try{return rejected(exception)}catch(newException){return reject(newException)}}return reject(exception)}function _progressed(value){return typeof progressed==="function"?progressed(value):value}Q.nextTick(function(){self.promiseDispatch(function(value){if(done){return}done=true;deferred.resolve(_fulfilled(value))},"when",[function(exception){if(done){return}done=true;deferred.resolve(_rejected(exception))}])});self.promiseDispatch(void 0,"when",[void 0,function(value){var newValue;var threw=false;try{newValue=_progressed(value)}catch(e){threw=true;if(Q.onerror){Q.onerror(e)}else{throw e}}if(!threw){deferred.notify(newValue)}}]);return deferred.promise};Q.tap=function(promise,callback){return Q(promise).tap(callback)};Promise.prototype.tap=function(callback){callback=Q(callback);return this.then(function(value){return callback.fcall(value).thenResolve(value)})};Q.when=when;function when(value,fulfilled,rejected,progressed){return Q(value).then(fulfilled,rejected,progressed)}Promise.prototype.thenResolve=function(value){return this.then(function(){return value})};Q.thenResolve=function(promise,value){return Q(promise).thenResolve(value)};Promise.prototype.thenReject=function(reason){return this.then(function(){throw reason})};Q.thenReject=function(promise,reason){return Q(promise).thenReject(reason)};Q.nearer=nearer;function nearer(value){if(isPromise(value)){var inspected=value.inspect();if(inspected.state==="fulfilled"){return inspected.value}}return value}Q.isPromise=isPromise;function isPromise(object){return object instanceof Promise}Q.isPromiseAlike=isPromiseAlike;function isPromiseAlike(object){return isObject(object)&&typeof object.then==="function"}Q.isPending=isPending;function isPending(object){return isPromise(object)&&object.inspect().state==="pending"}Promise.prototype.isPending=function(){return this.inspect().state==="pending"};Q.isFulfilled=isFulfilled;function isFulfilled(object){return!isPromise(object)||object.inspect().state==="fulfilled"}Promise.prototype.isFulfilled=function(){return this.inspect().state==="fulfilled"};Q.isRejected=isRejected;function isRejected(object){return isPromise(object)&&object.inspect().state==="rejected"}Promise.prototype.isRejected=function(){return this.inspect().state==="rejected"};var unhandledReasons=[];var unhandledRejections=[];var reportedUnhandledRejections=[];var trackUnhandledRejections=true;function resetUnhandledRejections(){unhandledReasons.length=0;unhandledRejections.length=0;if(!trackUnhandledRejections){trackUnhandledRejections=true}}function trackRejection(promise,reason){if(!trackUnhandledRejections){return}if(typeof process==="object"&&typeof process.emit==="function"){Q.nextTick.runAfter(function(){if(array_indexOf(unhandledRejections,promise)!==-1){process.emit("unhandledRejection",reason,promise);reportedUnhandledRejections.push(promise)}})}unhandledRejections.push(promise);if(reason&&typeof reason.stack!=="undefined"){unhandledReasons.push(reason.stack)}else{unhandledReasons.push("(no stack) "+reason)}}function untrackRejection(promise){if(!trackUnhandledRejections){return}var at=array_indexOf(unhandledRejections,promise);if(at!==-1){if(typeof process==="object"&&typeof process.emit==="function"){Q.nextTick.runAfter(function(){var atReport=array_indexOf(reportedUnhandledRejections,promise);if(atReport!==-1){process.emit("rejectionHandled",unhandledReasons[at],promise);reportedUnhandledRejections.splice(atReport,1)}})}unhandledRejections.splice(at,1);unhandledReasons.splice(at,1)}}Q.resetUnhandledRejections=resetUnhandledRejections;Q.getUnhandledReasons=function(){return unhandledReasons.slice()};Q.stopUnhandledRejectionTracking=function(){resetUnhandledRejections();trackUnhandledRejections=false};resetUnhandledRejections();Q.reject=reject;function reject(reason){var rejection=Promise({when:function(rejected){if(rejected){untrackRejection(this)}return rejected?rejected(reason):this}},function fallback(){return this},function inspect(){return{state:"rejected",reason:reason}});trackRejection(rejection,reason);return rejection}Q.fulfill=fulfill;function fulfill(value){return Promise({when:function(){return value},get:function(name){return value[name]},set:function(name,rhs){value[name]=rhs},delete:function(name){delete value[name]},post:function(name,args){if(name===null||name===void 0){return value.apply(void 0,args)}else{return value[name].apply(value,args)}},apply:function(thisp,args){return value.apply(thisp,args)},keys:function(){return object_keys(value)}},void 0,function inspect(){return{state:"fulfilled",value:value}})}function coerce(promise){var deferred=defer();Q.nextTick(function(){try{promise.then(deferred.resolve,deferred.reject,deferred.notify)}catch(exception){deferred.reject(exception)}});return deferred.promise}Q.master=master;function master(object){return Promise({isDef:function(){}},function fallback(op,args){return dispatch(object,op,args)},function(){return Q(object).inspect()})}Q.spread=spread;function spread(value,fulfilled,rejected){return Q(value).spread(fulfilled,rejected)}Promise.prototype.spread=function(fulfilled,rejected){return this.all().then(function(array){return fulfilled.apply(void 0,array)},rejected)};Q.async=async;function async(makeGenerator){return function(){function continuer(verb,arg){var result;if(typeof StopIteration==="undefined"){try{result=generator[verb](arg)}catch(exception){return reject(exception)}if(result.done){return Q(result.value)}else{return when(result.value,callback,errback)}}else{try{result=generator[verb](arg)}catch(exception){if(isStopIteration(exception)){return Q(exception.value)}else{return reject(exception)}}return when(result,callback,errback)}}var generator=makeGenerator.apply(this,arguments);var callback=continuer.bind(continuer,"next");var errback=continuer.bind(continuer,"throw");return callback()}}Q.spawn=spawn;function spawn(makeGenerator){Q.done(Q.async(makeGenerator)())}Q["return"]=_return;function _return(value){throw new QReturnValue(value)}Q.promised=promised;function promised(callback){return function(){return spread([this,all(arguments)],function(self,args){return callback.apply(self,args)})}}Q.dispatch=dispatch;function dispatch(object,op,args){return Q(object).dispatch(op,args)}Promise.prototype.dispatch=function(op,args){var self=this;var deferred=defer();Q.nextTick(function(){self.promiseDispatch(deferred.resolve,op,args)});return deferred.promise};Q.get=function(object,key){return Q(object).dispatch("get",[key])};Promise.prototype.get=function(key){return this.dispatch("get",[key])};Q.set=function(object,key,value){return Q(object).dispatch("set",[key,value])};Promise.prototype.set=function(key,value){return this.dispatch("set",[key,value])};Q.del=Q["delete"]=function(object,key){return Q(object).dispatch("delete",[key])};Promise.prototype.del=Promise.prototype["delete"]=function(key){return this.dispatch("delete",[key])};Q.mapply=Q.post=function(object,name,args){return Q(object).dispatch("post",[name,args])};Promise.prototype.mapply=Promise.prototype.post=function(name,args){return this.dispatch("post",[name,args])};Q.send=Q.mcall=Q.invoke=function(object,name){return Q(object).dispatch("post",[name,array_slice(arguments,2)])};Promise.prototype.send=Promise.prototype.mcall=Promise.prototype.invoke=function(name){return this.dispatch("post",[name,array_slice(arguments,1)])};Q.fapply=function(object,args){return Q(object).dispatch("apply",[void 0,args])};Promise.prototype.fapply=function(args){return this.dispatch("apply",[void 0,args])};Q["try"]=Q.fcall=function(object){return Q(object).dispatch("apply",[void 0,array_slice(arguments,1)])};Promise.prototype.fcall=function(){return this.dispatch("apply",[void 0,array_slice(arguments)])};Q.fbind=function(object){var promise=Q(object);var args=array_slice(arguments,1);return function fbound(){return promise.dispatch("apply",[this,args.concat(array_slice(arguments))])}};Promise.prototype.fbind=function(){var promise=this;var args=array_slice(arguments);return function fbound(){return promise.dispatch("apply",[this,args.concat(array_slice(arguments))])}};Q.keys=function(object){return Q(object).dispatch("keys",[])};Promise.prototype.keys=function(){return this.dispatch("keys",[])};Q.all=all;function all(promises){return when(promises,function(promises){var pendingCount=0;var deferred=defer();array_reduce(promises,function(undefined,promise,index){var snapshot;if(isPromise(promise)&&(snapshot=promise.inspect()).state==="fulfilled"){promises[index]=snapshot.value}else{++pendingCount;when(promise,function(value){promises[index]=value;if(--pendingCount===0){deferred.resolve(promises)}},deferred.reject,function(progress){deferred.notify({index:index,value:progress})})}},void 0);if(pendingCount===0){deferred.resolve(promises)}return deferred.promise})}Promise.prototype.all=function(){return all(this)};Q.any=any;function any(promises){if(promises.length===0){return Q.resolve()}var deferred=Q.defer();var pendingCount=0;array_reduce(promises,function(prev,current,index){var promise=promises[index];pendingCount++;when(promise,onFulfilled,onRejected,onProgress);function onFulfilled(result){deferred.resolve(result)}function onRejected(){pendingCount--;if(pendingCount===0){deferred.reject(new Error("Can't get fulfillment value from any promise, all "+"promises were rejected."))}}function onProgress(progress){deferred.notify({index:index,value:progress})}},undefined);return deferred.promise}Promise.prototype.any=function(){return any(this)};Q.allResolved=deprecate(allResolved,"allResolved","allSettled");function allResolved(promises){return when(promises,function(promises){promises=array_map(promises,Q);return when(all(array_map(promises,function(promise){return when(promise,noop,noop)})),function(){return promises})})}Promise.prototype.allResolved=function(){return allResolved(this)};Q.allSettled=allSettled;function allSettled(promises){return Q(promises).allSettled()}Promise.prototype.allSettled=function(){return this.then(function(promises){return all(array_map(promises,function(promise){promise=Q(promise);function regardless(){return promise.inspect()}return promise.then(regardless,regardless)}))})};Q.fail=Q["catch"]=function(object,rejected){return Q(object).then(void 0,rejected)};Promise.prototype.fail=Promise.prototype["catch"]=function(rejected){return this.then(void 0,rejected)};Q.progress=progress;function progress(object,progressed){return Q(object).then(void 0,void 0,progressed)}Promise.prototype.progress=function(progressed){return this.then(void 0,void 0,progressed)};Q.fin=Q["finally"]=function(object,callback){return Q(object)["finally"](callback)};Promise.prototype.fin=Promise.prototype["finally"]=function(callback){callback=Q(callback);return this.then(function(value){return callback.fcall().then(function(){return value})},function(reason){return callback.fcall().then(function(){throw reason})})};Q.done=function(object,fulfilled,rejected,progress){return Q(object).done(fulfilled,rejected,progress)};Promise.prototype.done=function(fulfilled,rejected,progress){var onUnhandledError=function(error){Q.nextTick(function(){makeStackTraceLong(error,promise);if(Q.onerror){Q.onerror(error)}else{throw error}})};var promise=fulfilled||rejected||progress?this.then(fulfilled,rejected,progress):this;if(typeof process==="object"&&process&&process.domain){onUnhandledError=process.domain.bind(onUnhandledError)}promise.then(void 0,onUnhandledError)};Q.timeout=function(object,ms,error){return Q(object).timeout(ms,error)};Promise.prototype.timeout=function(ms,error){var deferred=defer();var timeoutId=setTimeout(function(){if(!error||"string"===typeof error){error=new Error(error||"Timed out after "+ms+" ms");error.code="ETIMEDOUT"}deferred.reject(error)},ms);this.then(function(value){clearTimeout(timeoutId);deferred.resolve(value)},function(exception){clearTimeout(timeoutId);deferred.reject(exception)},deferred.notify);return deferred.promise};Q.delay=function(object,timeout){if(timeout===void 0){timeout=object;object=void 0}return Q(object).delay(timeout)};Promise.prototype.delay=function(timeout){return this.then(function(value){var deferred=defer();setTimeout(function(){deferred.resolve(value)},timeout);return deferred.promise})};Q.nfapply=function(callback,args){return Q(callback).nfapply(args)};Promise.prototype.nfapply=function(args){var deferred=defer();var nodeArgs=array_slice(args);nodeArgs.push(deferred.makeNodeResolver());this.fapply(nodeArgs).fail(deferred.reject);return deferred.promise};Q.nfcall=function(callback){var args=array_slice(arguments,1);return Q(callback).nfapply(args)};Promise.prototype.nfcall=function(){var nodeArgs=array_slice(arguments);var deferred=defer();nodeArgs.push(deferred.makeNodeResolver());this.fapply(nodeArgs).fail(deferred.reject);return deferred.promise};Q.nfbind=Q.denodeify=function(callback){var baseArgs=array_slice(arguments,1);return function(){var nodeArgs=baseArgs.concat(array_slice(arguments));var deferred=defer();nodeArgs.push(deferred.makeNodeResolver());Q(callback).fapply(nodeArgs).fail(deferred.reject);return deferred.promise}};Promise.prototype.nfbind=Promise.prototype.denodeify=function(){var args=array_slice(arguments);args.unshift(this);return Q.denodeify.apply(void 0,args)};Q.nbind=function(callback,thisp){var baseArgs=array_slice(arguments,2);return function(){var nodeArgs=baseArgs.concat(array_slice(arguments));var deferred=defer();nodeArgs.push(deferred.makeNodeResolver());function bound(){return callback.apply(thisp,arguments)}Q(bound).fapply(nodeArgs).fail(deferred.reject);return deferred.promise}};Promise.prototype.nbind=function(){var args=array_slice(arguments,0);args.unshift(this);return Q.nbind.apply(void 0,args)};Q.nmapply=Q.npost=function(object,name,args){return Q(object).npost(name,args)};Promise.prototype.nmapply=Promise.prototype.npost=function(name,args){var nodeArgs=array_slice(args||[]);var deferred=defer();nodeArgs.push(deferred.makeNodeResolver());this.dispatch("post",[name,nodeArgs]).fail(deferred.reject);return deferred.promise};Q.nsend=Q.nmcall=Q.ninvoke=function(object,name){var nodeArgs=array_slice(arguments,2);var deferred=defer();nodeArgs.push(deferred.makeNodeResolver());Q(object).dispatch("post",[name,nodeArgs]).fail(deferred.reject);return deferred.promise};Promise.prototype.nsend=Promise.prototype.nmcall=Promise.prototype.ninvoke=function(name){var nodeArgs=array_slice(arguments,1);var deferred=defer();nodeArgs.push(deferred.makeNodeResolver());this.dispatch("post",[name,nodeArgs]).fail(deferred.reject);return deferred.promise};Q.nodeify=nodeify;function nodeify(object,nodeback){return Q(object).nodeify(nodeback)}Promise.prototype.nodeify=function(nodeback){if(nodeback){this.then(function(value){Q.nextTick(function(){nodeback(null,value)})},function(error){Q.nextTick(function(){nodeback(error)})})}else{return this}};var qEndingLine=captureLine();return Q});define("src/globals/currentProject",["backbone","async","src/models/Project","q"],function(Backbone,async,Project,Q){"use strict";var project=new Project,loadProjectCallbacks=[];function loadProject(projectId){return new Q.Promise(function(resolve,reject){if(projectId instanceof Backbone.Model){project.set(projectId.toJSON());return resolve(project)}if(project.id===projectId){return reject("loadedAlready")}project.clear({silent:true});var p=new Project({id:projectId});p.fetch({success:function success(){project.set(p.toJSON());return resolve(project)},error:function error(model,err){project.unset("id");project.clear();return reject(err)}})})}project.onLoad=function(callback){loadProjectCallbacks.push(callback)};project.offLoad=function(callback){loadProjectCallbacks.splice(loadProjectCallbacks.indexOf(callback),0)};function runOnLoadCallbacks(done){async.forEach(loadProjectCallbacks,function(callback,done){callback(done)},function(err){if(err){done(err);return}done()})}project.removeLoadCallbacks=function(){loadProjectCallbacks=[]};project.load=function load(newProjectId){if(!newProjectId){return new Q.Promise(function(resolve,reject){project.unset("id");project.clear();runOnLoadCallbacks(function(err){if(err){reject(err);return}resolve()})})}return new Q.Promise(function(resolve,reject){return loadProject(newProjectId).then(function(project){runOnLoadCallbacks(function(err){if(err){return reject(err)}return resolve(project)})}).catch(function(err){if(err){if(err==="loadedAlready"){return resolve(project)}else{return reject(err)}}})})};return project});define("src/Workbench",["backbone","underscore","src/globals/currentProject"],function(Backbone,_,currentProject){"use strict";var apiUrl="/fe-api";var instance;instance={apiUrl:apiUrl,configure:function configure(settings){instance.buildNumber=settings.buildNumber;instance.emailMd5=settings.emailMd5;instance.modules=settings.userModules||[];instance.logToGoogleAnalytics=settings.logToGoogleAnalytics;instance.uniqueSessionId=settings.uniqueSessionId},isApiUrl:function isApiUrl(url){return url.indexOf(apiUrl)===0},buildApiUrl:function buildApiUrl(segment){return[apiUrl,segment].join("/").replace(/([^:])\/+/g,"$1/").replace(/\{projectId\}/g,currentProject.id)}};return _.extend(instance,Backbone.Events)});define("src/backboneSync",["backbone","underscore","src/Workbench"],function(Backbone,_,Workbench){"use strict";var originalSync=Backbone.sync;function setData(options,queryData,method){options.data=options.data||queryData;if(!options.data||_.isEmpty(options.data)&&!_.isArray(options.data)){delete options.data}if(options.data&&(method==="create"||method==="update"||method==="patch"||method==="delete")){options.contentType="application/json";options.data=JSON.stringify(options.attrs||options.data)}}function getUrl(options,model){var url=options.url||model.url;if(_.isFunction(url)){return url.apply(model)}return url}function getQueryData(model){return _.isFunction(model.getQueryData)?model.getQueryData():{}}function setUrl(options,url){if(!Workbench.isApiUrl(url)){url=Workbench.buildApiUrl(url);options.url=url}}function disableCaching(options){options.cache=false}function applyResetHack(options,model){if(model instanceof Backbone.Collection&&!("reset"in options)){options.reset=true}}function applySyncOverride(){Backbone.sync=function(method,model,options){var url=getUrl(options,model),queryData=getQueryData(model);if(!url||url.indexOf("http")===0||url.indexOf("//")===0){return originalSync(method,model,options)}if(queryData===false){return false}setData(options,queryData,method);setUrl(options,url,model);disableCaching(options);applyResetHack(options,model);return originalSync(method,model,options)}}return{apply:function apply(){originalSync=Backbone.sync;applySyncOverride()},restore:function restore(){Backbone.sync=originalSync}}});define("src/models/Me",["backbone","underscore"],function(Backbone,_){"use strict";return Backbone.Model.extend({url:"/me/",getDisabledPageTours:function getDisabledPageTours(){var tags=this.get("tags")||{};return _.has(tags,"disabledTours")?tags.disabledTours.split(/[,&]/):[]},getTag:function getTag(key){return(this.get("tags")||{})[key]},setTag:function setTag(key,value){var tags=this.get("tags")||{};tags[key]=(value||"").toString();this.set("tags",tags)},getClientId:function getClientId(){if(!this.get("client")||!this.get("client").id){throw new Error("client Id not found")}return this.get("client").id}})});define("src/globals/me",["src/models/Me"],function(Me){"use strict";return new Me});define("src/helpers/colourHelper",[],function(){"use strict";function getColourShade(colour,luminance){colour=String(colour).replace(/[^0-9a-f]/gi,"");luminance=luminance||.5;var shadedColour="#";var sum;for(var index=0;index<3;index++){sum=parseInt(colour.substr(index*2,2),16);sum=Math.round(Math.min(Math.max(0,sum+sum*luminance),255)).toString(16);shadedColour+=("00"+sum).substr(sum.length)}return shadedColour.toUpperCase()}function brightness(colour){var HEX_PATTERN=/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/;if(!HEX_PATTERN.test(colour)){return}if(colour.length===7){colour=colour.replace(/^#/,"")}var R=parseInt(colour.substring(0,2),16);var G=parseInt(colour.substring(2,4),16);var B=parseInt(colour.substring(4,6),16);return Math.sqrt(R*R*.241+G*G*.691+B*B*.068)}function rgb2Hex(red,green,blue){return"#"+(blue|green<<8|red<<16|1<<24).toString(16).slice(1)}return{rgb2Hex:rgb2Hex,brightness:brightness,getColourShade:getColourShade}});function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}define("src/globals/theme",["src/helpers/colourHelper"],function(colourHelper){"use strict";var axiomColors={"blast-off":{r:249,g:138,b:57},"crash-course":{r:255,g:109,b:86},"critical-mass":{r:227,g:90,b:122},"deep-thought":{r:187,g:185,b:192},"electric-dreams":{r:59,g:121,b:204},"event-horizon":{r:96,g:99,b:161},extraterrestrial:{r:116,g:201,b:113},"social-facebook":{r:59,g:89,b:152},"fantastic-voyage":{r:167,g:46,b:94},"forbidden-planet":{r:245,g:177,b:164},"future-shock":{r:240,g:236,b:29},"giant-leap":{r:85,g:205,b:230},"ground-control":{r:158,g:97,b:57},"social-instagram":{r:183,g:71,b:146},"luna-dust":{r:120,g:144,b:156},"moon-lagoon":{r:36,g:173,b:189},"new-horizon":{r:255,g:190,b:10},"outer-limits":{r:127,g:214,b:248},"paradise-lost":{r:156,g:115,b:178},"primeval-soup":{r:200,g:200,b:25},"rocky-planet":{r:158,g:142,b:117},"sentiment-negative":{r:215,g:74,b:74},"sentiment-positive":{r:76,g:161,b:90},"serene-sea":{r:144,g:160,b:214},"solar-rust":{r:205,g:129,b:26},"space-invader":{r:47,g:145,b:112},"space-oddity":{r:189,g:163,b:91},"sun-maker":{r:252,g:213,b:18},"terra-form":{r:128,g:190,b:76},"tiny-clanger":{r:244,g:152,b:183},"social-twitter":{r:29,g:161,b:242}};axiomColors["sentiment-neutral"]=axiomColors["deep-thought"];var rgbConverter=function rgbConverter(_ref){var r=_ref.r,g=_ref.g,b=_ref.b;return colourHelper.rgb2Hex(r,g,b)};var hexValueForColorName=function hexValueForColorName(colorName){var rgb=axiomColors[colorName];if(!rgb){throw new Error("No color found with name: ".concat(colorName))}return rgbConverter(rgb)};var hexColorNamesLookup=Object.entries(axiomColors).reduce(function(memo,_ref2){var _ref3=_slicedToArray(_ref2,2),name=_ref3[0],rgb=_ref3[1];var key=rgbConverter(rgb);memo[key]=name;return memo},{});var Theme={name:"",productName:"",contactEmail:"",color:undefined,footerLinks:[],userGuidePath:undefined,logoUrl:undefined,logoTitle:undefined,hideProjectSelectionExample:undefined,canSeeUserGuide:undefined,canSeeSupportPortal:undefined,canSeeFeedbackLink:undefined,canSeeAnnotationAuthor:undefined,canSeeAnnotationFeedback:undefined,feedbackUrl:undefined,chartColours:{sentiment:{positive:hexValueForColorName("sentiment-positive"),negative:hexValueForColorName("sentiment-negative"),neutral:hexValueForColorName("sentiment-neutral")},emotions:{"emotions:joy":hexValueForColorName("new-horizon"),"emotions:sadness":hexValueForColorName("event-horizon"),"-1":hexValueForColorName("deep-thought"),"emotions:disgust":hexValueForColorName("paradise-lost"),"emotions:anger":hexValueForColorName("critical-mass"),"emotions:fear":hexValueForColorName("blast-off"),"emotions:surprise":hexValueForColorName("terra-form")},gender:{male:hexValueForColorName("electric-dreams"),female:hexValueForColorName("fantastic-voyage")},accountTypes:{individual:hexValueForColorName("primeval-soup"),organisational:hexValueForColorName("luna-dust")},pageTypes:{news:hexValueForColorName("ground-control"),blog:hexValueForColorName("giant-leap"),forum:hexValueForColorName("new-horizon"),video:hexValueForColorName("crash-course"),twitter:hexValueForColorName("social-twitter"),general:hexValueForColorName("blast-off"),facebook:hexValueForColorName("social-facebook"),instagram:hexValueForColorName("social-instagram"),image:hexValueForColorName("critical-mass"),review:hexValueForColorName("space-invader"),print:hexValueForColorName("forbidden-planet"),microblog:hexValueForColorName("serene-sea"),licensed:hexValueForColorName("primeval-soup")},general:[hexValueForColorName("giant-leap"),hexValueForColorName("new-horizon"),hexValueForColorName("terra-form"),hexValueForColorName("paradise-lost"),hexValueForColorName("critical-mass"),hexValueForColorName("blast-off"),hexValueForColorName("ground-control"),hexValueForColorName("moon-lagoon"),hexValueForColorName("tiny-clanger"),hexValueForColorName("serene-sea"),hexValueForColorName("primeval-soup"),hexValueForColorName("luna-dust"),hexValueForColorName("crash-course"),hexValueForColorName("sun-maker"),hexValueForColorName("event-horizon"),hexValueForColorName("forbidden-planet"),hexValueForColorName("space-oddity"),hexValueForColorName("outer-limits"),hexValueForColorName("space-invader"),hexValueForColorName("extraterrestrial"),hexValueForColorName("rocky-planet")]},hex2ColorName:function hex2ColorName(hexValue){return hexColorNamesLookup[hexValue]},isBrandwatchOrGreyLabelTheme:function isBrandwatchOrGreyLabelTheme(){return this.isGrayLabelTheme||this.name==="brandwatch"},configure:function configure(settings){this.productName=settings.productName;this.contactEmail=settings.contactEmail;this.fbAppId=settings.facebookAppId;this.twitterAppId=settings.twitterAppId;this.loginUrl=settings.loginUrl;this.name=settings.themeName}};return Theme});define("src/LoginPromotionManager",[],function(){"use strict";function showPopup(){}return{showPopup:showPopup}});define("src/ApiError",["underscore"],function(_){"use strict";var errorLookup={internal_server_error:"A server error occurred"};function ApiError(response){var parsedResponse;this.response=response;this.message=ApiError.DEFAULT_MESSAGE;this.errorCodes=[];this.errorMessages=[];if(response instanceof Error){this.message=response.message;return}if(response&&response.message){response.responseText=response.message}try{parsedResponse=JSON.parse(response&&response.responseText);this.errorMessages=[].concat(parsedResponse.errors||parsedResponse.message||this.message);if(parsedResponse.errors&&parsedResponse.errors.length&&parsedResponse.errors[0].code){this.errorCodes=_.map(parsedResponse.errors,function(error){return""+error.code})}this.message=_(this.errorMessages).map(function(error){var errorString=error.message||error;return _.escapeHTML(errorLookup[errorString]||errorString)}).join(", ")}catch(err){if(err instanceof SyntaxError){console.error("could not parse JSON from api error response",response);this.errorMessages=["unknown"];this.errorCodes=[];this.message=ApiError.DEFAULT_MESSAGE}else{throw err}}}ApiError.prototype.toString=function(){return this.message};ApiError.prototype.hasCode=function(code){if(typeof code==="number"){code=""+code}return this.errorCodes.indexOf(code)!==-1};ApiError.DEFAULT_MESSAGE="Were sorry, something went wrong with that request. We have been notified about the error.";return ApiError});(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define("mixpanel-analytics-helper",[],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.mixpanelAnalyticsHelper=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){(function(global){"use strict";var _=typeof window!=="undefined"?window["_"]:typeof global!=="undefined"?global["_"]:null;var _s=typeof window!=="undefined"?window["_"]:typeof global!=="undefined"?global["_"]:null;function extractEventMetadata(eventName){var parts=eventName.split(":");if(parts.length!==2){return{}}return{eventCollectionName:parts[0],action:parts[1]}}function humanizeEventString(str,ignore){if(typeof str!=="string"){throw new Error("Analytics.humanizeEventString must be called with an string argument")}ignore=ignore||[];function humanize(str){return _s.capitalize(_s.underscored(str)).replace(/_/g," ")}function mixpanelize(str){var ret=str.split(" ").map(function(phrase){if(ignore.indexOf(phrase)===-1){return humanize(phrase)}return phrase}).join(" ");if(ret!==str){return mixpanelize(ret)}return ret}return mixpanelize(str)}function humanizeEventData(data,ignore){ignore=ignore||{};var res;var ignoredKeys=ignore.ignoredKeys||[];var ignoredValues=ignore.ignoredValues||[];if(typeof data==="function"){return data}if(typeof data==="string"){return humanizeEventString(data,ignoredValues)}if(Array.isArray(data)){res=[];_.each(data,function(val){res.push(humanizeEventData(val,ignore))});return res}if(_.isObject(data)){res={};_.each(data,function(val,key){key=humanizeEventString(key,ignoredKeys);res[key]=ignoredKeys.indexOf(key)>-1?val:humanizeEventData(val,ignore)});return res}return data}function buildEventParameters(eventName,data,settings){var mixpanelData;var mixpanelEventName;var eventMetadata;var collectionNameIsMissing;var actionIsMissing;var eventCollectionName;var eventAction;settings=settings||{};_.defaults(settings,{rewriteEventName:true,rewriteProperties:true,ignore:{}});_.defaults(settings.ignore,{ignoredKeys:[],ignoredValues:[]});eventMetadata=extractEventMetadata(eventName);eventCollectionName=eventMetadata.eventCollectionName;eventAction=eventMetadata.action;collectionNameIsMissing=_.isNull(eventCollectionName)||_.isEmpty(eventCollectionName);actionIsMissing=_.isNull(eventAction)||_.isEmpty(eventAction);if(collectionNameIsMissing||actionIsMissing){throw new Error("Could not track "+eventName+' in mixpanel. The event name must be defined in "collection:action" format.')}mixpanelData=_({Action:eventMetadata.action}).extend(data);mixpanelEventName=eventMetadata.eventCollectionName;if(settings.rewriteEventName){mixpanelEventName=humanizeEventString(mixpanelEventName,settings.ignore.ignoredValues)}if(settings.rewriteProperties){mixpanelData=humanizeEventData(mixpanelData,settings.ignore)}return{eventName:mixpanelEventName,eventData:mixpanelData}}module.exports={humanizeEventString:humanizeEventString,humanizeEventData:humanizeEventData,buildEventParameters:buildEventParameters}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}]},{},[1])(1)});!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("ldclient",t):e.LDClient=t()}(this,function(){"use strict";var e,t=(function(e,t){!function(){var e=t,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function r(e){this.message=e}r.prototype=new Error,r.prototype.name="InvalidCharacterError",e.btoa||(e.btoa=function(e){for(var t,o,a=String(e),i=0,u=n,s="";a.charAt(0|i)||(u="=",i%1);s+=u.charAt(63&t>>8-i%1*8)){if((o=a.charCodeAt(i+=.75))>255)throw new r("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");t=t<<8|o}return s}),e.atob||(e.atob=function(e){var t=String(e).replace(/[=]+$/,"");if(t.length%4==1)throw new r("'atob' failed: The string to be decoded is not correctly encoded.");for(var o,a,i=0,u=0,s="";a=t.charAt(u++);~a&&(o=i%4?64*o+a:a,i++%4)?s+=String.fromCharCode(255&o>>(-2*i&6)):0)a=n.indexOf(a);return s})}()}(e={exports:{}},e.exports),e.exports),n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};function r(e){return t.btoa(unescape(encodeURIComponent(e)))}function o(e){return r(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function a(e){return JSON.parse(JSON.stringify(e))}function i(e){setTimeout(e,0)}function u(e,t){var n=e.then(function(e){return t&&setTimeout(function(){t(null,e)},0),e},function(e){if(!t)return Promise.reject(e);setTimeout(function(){t(e,null)},0)});return t?void 0:n}function s(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]={value:e[n],version:0});return t}function c(e){e.setRequestHeader("X-LaunchDarkly-User-Agent","JSClient/2.3.1")}function l(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.reduce(function(e,t){return n({},e,t)},{})}var f=2e3;function v(e,t,n,r){var a=void 0,i=e+"/events/bulk/"+t,u=e+"/a/"+t+".gif",s={};function l(e,t){var n=new Image;t&&n.addEventListener("load",t),n.src=e}function v(e,t,n){var a=r||l,s=function(r){if(t){var s=new XMLHttpRequest;s.open("POST",i,!n),c(s),s.setRequestHeader("Content-Type","application/json"),s.setRequestHeader("X-LaunchDarkly-Event-Schema","3"),n||s.addEventListener("load",function(){r(function(e){var t={status:e.status},n=e.getResponseHeader("Date");if(n){var r=Date.parse(n);r&&(t.serverTime=r)}return t}(s))}),s.send(JSON.stringify(e))}else{var l=u+"?d="+o(JSON.stringify(e));a(l,n?null:r)}};if(!n)return new Promise(function(e){s(e)});s()}return s.sendEvents=function(t,r){void 0===a&&(a=void 0===n?"withCredentials"in new XMLHttpRequest:n);var i=void 0!==r&&r,u=void 0;u=a?[t]:function(e,t){for(var n=t.slice(0),r=[],a=e,i=void 0;n.length>0;){for(i=[];a>0;){var u=n.shift();if(!u)break;(a-=o(JSON.stringify(u)).length)<0&&i.length>0?n.unshift(u):i.push(u)}a=e,r.push(i)}return r}(f-e.length,t);for(var s=[],c=0;c<u.length;c++)s.push(v(u[c],a,i));return r?Promise.resolve():Promise.all(s)},s}var d=" Please see https://docs.launchdarkly.com/docs/js-sdk-reference#section-initializing-the-client for instructions on SDK initialization.",p=function(){return"localStorage is unavailable"},g=function(e){return'Custom event "'+e+'" does not exist'},y=function(){return"environment not found."+d},h=function(){return"No environment specified."+d},m=function(e){return"Error fetching flag settings: "+(e.message||e)},k=function(){return"No user specified."+d},w=function(){return"Invalid user specified."+d},b=function(e,t){return'[LaunchDarkly] "'+e+'" is deprecated, please use "'+t+'"'},E=function(e,t,n){return"Received error "+e+(401===e?" (invalid SDK key)":"")+" for "+t+" - "+(errors.isHttpErrorRecoverable(e)?n:"giving up permanently")};function S(e){var t={},n=void 0!==e.allAttributesPrivate?e.allAttributesPrivate:e.all_attributes_private,r=(void 0!==e.privateAttributeNames?e.privateAttributeNames:e.private_attribute_names)||[],o={key:!0,custom:!0,anonymous:!0},a={key:!0,secondary:!0,ip:!0,country:!0,email:!0,firstName:!0,lastName:!0,avatar:!0,name:!0,anonymous:!0,custom:!0};return void 0!==e.all_attributes_private&&console&&console.warn&&console.warn(b("all_attributes_private","allAttributesPrivate")),void 0!==e.private_attribute_names&&console&&console.warn&&console.warn(b("private_attribute_names","privateAttributeNames")),t.filterUser=function(e){if(!e)return null;var t=e.privateAttributeNames||[],i=function(e,a){return Object.keys(e).reduce(function(i,u){var s=i;return a(u)&&(!function(e){return!o[e]&&(n||-1!==t.indexOf(e)||-1!==r.indexOf(e))}(u)?s[0][u]=e[u]:s[1][u]=!0),s},[{},{}])},u=i(e,function(e){return a[e]}),s=u[0],c=u[1];if(e.custom){var f=i(e.custom,function(){return!0});s.custom=f[0],c=l({},c,f[1])}var v=Object.keys(c);return v.length&&(v.sort(),s.privateAttrs=v),s},t}function D(e){function t(e,t){Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.message=e,this.code=t}return t.prototype=new Error,t.prototype.name=e,t.prototype.constructor=t,t}var N=D("LaunchDarklyUnexpectedResponseError"),R=D("LaunchDarklyInvalidEnvironmentIdError"),O=D("LaunchDarklyInvalidUserError"),U=D("LaunchDarklyInvalidEventKeyError"),T=D("LaunchDarklyInvalidArgumentError"),L=D("LaunchDarklyFlagFetchError");function x(e,t){var n,r,o,a,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,f={},d=c||v(e,t),p=(r=0,o=0,a={},(n={}).summarizeEvent=function(e){if("feature"===e.kind){var t=e.key+":"+(null!==e.variation&&void 0!==e.variation?e.variation:"")+":"+(null!==e.version&&void 0!==e.version?e.version:""),n=a[t];n?n.count=n.count+1:a[t]={count:1,key:e.key,variation:e.variation,version:e.version,value:e.value,default:e.default},(0===r||e.creationDate<r)&&(r=e.creationDate),e.creationDate>o&&(o=e.creationDate)}},n.getSummary=function(){var e={},t=!0;for(var n in a){var i=a[n],u=e[i.key];u||(u={default:i.default,counters:[]},e[i.key]=u);var s={value:i.value,count:i.count};void 0!==i.variation&&null!==i.variation&&(s.variation=i.variation),i.version?s.version=i.version:s.unknown=!0,u.counters.push(s),t=!1}return t?null:{startDate:r,endDate:o,features:e}},n.clearSummary=function(){r=0,o=0,a={}},n),g=S(u),y=!!u.inlineUsersInEvents,h=[],m=void 0,k=void 0,w=0,b=!1,D=void 0;function R(e){i(function(){s&&s.maybeReportError(new T(e))})}function O(){return 0===k||0===Math.floor(Math.random()*k)}return void 0!==u.samplingInterval&&(isNaN(u.samplingInterval)||u.samplingInterval<0)?(k=0,R("Invalid sampling interval configured. Sampling interval must be an integer >= 0.")):k=u.samplingInterval||0,void 0!==u.flushInterval&&(isNan(u.flushInterval)||u.flushInterval<2e3)?(m=2e3,R("Invalid flush interval configured. Must be an integer >= 2000 (milliseconds).")):m=u.flushInterval||2e3,f.enqueue=function(e){if(!b){var t,n=!1,r=!1;if(p.summarizeEvent(e),"feature"===e.kind?O()&&(n=!!e.trackEvents,r=!!(t=e).debugEventsUntilDate&&t.debugEventsUntilDate>w&&t.debugEventsUntilDate>(new Date).getTime()):n=O(),n&&h.push(function(e){var t=l({},e);return y||"identify"===e.kind?t.user=g.filterUser(e.user):(t.userKey=e.user.key,delete t.user),"feature"===e.kind&&(delete t.trackEvents,delete t.debugEventsUntilDate),t}(e)),r){var o=l({},e,{kind:"debug"});delete o.trackEvents,delete o.debugEventsUntilDate,delete o.variation,h.push(o)}}},f.flush=function(e){if(b)return Promise.resolve();var t=h,n=p.getSummary();return p.clearSummary(),n&&(n.kind="summary",t.push(n)),0===t.length?Promise.resolve():(h=[],d.sendEvents(t,e).then(function(e){var t;e&&(e.serverTime&&(w=e.serverTime),(t=e.status)>=400&&t<500&&408!==t&&429!==t&&(b=!0),e.status>=400&&i(function(){s.maybeReportError(new N(E(e.status,"event posting","some events were dropped")))}))}))},f.start=function(){D=setTimeout(function e(){f.flush(),D=setTimeout(e,m)},m)},f.stop=function(){clearTimeout(D)},f}function I(){var e={},t={};return e.on=function(e,n,r){t[e]=t[e]||[],t[e]=t[e].concat({handler:n,context:r})},e.off=function(e,n,r){if(t[e])for(var o=0;o<t[e].length;o++)t[e][o].handler===n&&t[e][o].context===r&&(t[e]=t[e].slice(0,o).concat(t[e].slice(o+1)))},e.emit=function(e){if(t[e])for(var n=0;n<t[e].length;n++)t[e][n].handler.apply(t[e][n].context,Array.prototype.slice.call(arguments,1))},e.maybeReportError=function(e){e&&(t["error"]?this.emit("error",e):console.error(e.message))},e}var P=/[|\\{}()[\]^$+*?.]/g,A=function(e){if("string"!=typeof e)throw new TypeError("Expected a string");return e.replace(P,"\\$&")};function C(e,t,n,r){var o=t.replace(n,"").replace(r,""),a=void 0,i=void 0;switch(e.kind){case"exact":i=t,a=new RegExp("^"+A(e.url)+"/?$");break;case"canonical":i=o,a=new RegExp("^"+A(e.url)+"/?$");break;case"substring":i=o,a=new RegExp(".*"+A(e.substring)+".*$");break;case"regex":i=o,a=new RegExp(e.pattern);break;default:return!1}return a.test(i)}function F(e,t){for(var n={},r=null,o=[],a=0;a<e.length;a++)for(var i=e[a],u=i.urls||[],s=0;s<u.length;s++)if(C(u[s],location.href,location.search,location.hash)){"pageview"===i.kind?t("pageview",i):(o.push(i),t("click_pageview",i));break}return o.length>0&&(r=function(e){for(var n=function(e,t){for(var n=[],r=0;r<t.length;r++)for(var o=e.target,a=t[r],i=a.selector,u=document.querySelectorAll(i);o&&u.length>0;){for(var s=0;s<u.length;s++)o===u[s]&&n.push(a);o=o.parentNode}return n}(e,o),r=0;r<n.length;r++)t("click",n[r])},document.addEventListener("click",r)),n.dispose=function(){document.removeEventListener("click",r)},n}var j="application/json";function J(e,t,n){var r=new XMLHttpRequest;return r.addEventListener("load",function(){200===r.status&&r.getResponseHeader("Content-type")&&0===r.getResponseHeader("Content-Type").lastIndexOf(j)?n(null,JSON.parse(r.responseText)):n(_(r))}),r.addEventListener("error",function(){n(_(r))}),t?(r.open("REPORT",e),r.setRequestHeader("Content-Type","application/json"),c(r),r.send(JSON.stringify(t))):(r.open("GET",e),c(r),r.send()),r}function _(e){return 404===e.status?new R(y()):e.statusText}function q(e,t){var n={},r=void 0;return n.setUser=function(e){r=function(e){var t=a(e);return t.key&&(t.key=t.key.toString()),t}(e),t(a(r))},n.getUser=function(){return r?a(r):null},e&&n.setUser(e),n}var H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$="ready",G="change",M="goalsReady",z=300;return{initialize:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=n.baseUrl||"https://app.launchdarkly.com",c=n.eventsUrl||"https://events.launchdarkly.com",f=n.streamUrl||"https://clientstream.launchdarkly.com",v=n.hash,d=void 0===n.sendEvents||n.sendEvents,y=!!n.allowFrequentDuplicateEvents,b=!!n.sendEventsOnlyForVariation,E=e,S=I(),D=function(e,t,n,r){var a={},i=e+"/eval/"+t+"/",u=null;return a.connect=function(a,s){if("undefined"!=typeof EventSource){var c=void 0;for(var l in r?c=e+"/ping/"+t:(c=i+o(JSON.stringify(a)),null!=n&&(c=c+"?h="+n)),u=new window.EventSource(c),s)s.hasOwnProperty(l)&&u.addEventListener(l,s[l])}},a.disconnect=function(){u&&u.close()},a.isConnected=function(){return u&&(u.readyState===EventSource.OPEN||u.readyState===EventSource.CONNECTING)},a}(f,E,v,n.useReport),T=n.eventProcessor||x(c,E,n,S),P=function(e,t,n){var r=void 0,a=void 0,i={fetchFlagSettings:function(i,u,s){var c=void 0,l=void 0,f=void 0,v=void 0;n?(l=[e,"/sdk/evalx/",t,"/user",u?"?h="+u:""].join(""),f=i):(c=o(JSON.stringify(i)),l=[e,"/sdk/evalx/",t,"/users/",c,u?"?h="+u:""].join(""));var d,p,g=(d=s,function(e,t){d(e,t),r=null,a=null});r?(r.abort(),p=a,v=function(){p&&p.apply(null,arguments),g.apply(null,arguments)}):v=g,a=v,r=J(l,f,v)},fetchGoals:function(n){J([e,"/sdk/goals/",t].join(""),null,n)}};return i}(a,E,n.useReport),A={},C="object"===H(n.bootstrap)?s(n.bootstrap):{},j=void 0,_=void 0,X=void 0,B=void 0,K=!0;function V(){return d&&(e=void 0,!("1"===(e=navigator&&void 0!==navigator.doNotTrack?navigator.doNotTrack:navigator&&void 0!==navigator.msDoNotTrack?navigator.msDoNotTrack:window.doNotTrack)||"yes"===e));var e}function Y(e){e.user?(K=!1,V()&&T.enqueue(e)):K&&(console&&console.warn&&console.warn("Be sure to call `identify` in the LaunchDarkly client: http://docs.launchdarkly.com/docs/running-an-ab-test#include-the-client-side-snippet"),K=!1)}var Q=q(t,function(e){e&&Y({kind:"identify",key:e.key,user:e,creationDate:(new Date).getTime()})}),W=function(e,t,n){var o={};function a(){var o="",a=n.getUser();return a&&(o=t||r(JSON.stringify(a))),"ld:"+e+":"+o}return o.loadFlags=function(){var e=a(),t=void 0,n=void 0;try{t=localStorage.getItem(e)}catch(e){return console.warn(p()),null}try{n=JSON.parse(t)}catch(e){return o.clearFlags(),null}if(n){var r=n.$schema;(void 0===r||r<1)&&(n=s(n))}return n},o.saveFlags=function(e){var t=a(),n=l({},e,{$schema:1});try{localStorage.setItem(t,JSON.stringify(n))}catch(e){console.warn(p())}},o.clearFlags=function(){var e=a();try{localStorage.removeItem(e)}catch(e){}},o}(E,v,Q);function Z(e,t,n){var r=Q.getUser(),o=new Date;if(!y){var a=JSON.stringify(t)+(r&&r.key?r.key:"")+e,i=A[a];if(i&&o-i<3e5)return;A[a]=o}var u={kind:"feature",key:e,user:r,value:t,default:n,creationDate:o.getTime()},s=C[e];s&&(u.version=s.flagVersion?s.flagVersion:s.version,u.variation=s.variation,u.trackEvents=s.trackEvents,u.debugEventsUntilDate=s.debugEventsUntilDate),Y(u)}function ee(e,t){var n={kind:e,key:t.key,data:null,url:window.location.href,user:Q.getUser(),creationDate:(new Date).getTime()};return"click"===e&&(n.selector=t.selector),Y(n)}function te(e,t,n){var r=void 0;return r=C&&C.hasOwnProperty(e)&&C[e]&&!C[e].deleted?null===C[e].value?t:C[e].value:t,n&&Z(e,r,t),r}function ne(){Q.getUser()&&(D.disconnect(),D.connect(Q.getUser(),{ping:function(){P.fetchFlagSettings(Q.getUser(),v,function(e,t){e&&S.maybeReportError(new L(m(e))),re(t)})},put:function(e){re(JSON.parse(e.data))},patch:function(e){var t=JSON.parse(e.data),n=C[t.key];if(!n||!n.version||!t.version||n.version<t.version){var r={},o=l({},t);delete o.key,C[t.key]=o,r[t.key]=n?{previous:n.value,current:t.value}:{current:t.value},oe(r)}},delete:function(e){var t=JSON.parse(e.data);if(!C[t.key]||C[t.key].version<t.version){var n={};C[t.key]&&!C[t.key].deleted&&(n[t.key]={previous:C[t.key].value}),C[t.key]={version:t.version,deleted:!0},oe(n)}}}))}function re(e){var t={};if(e){for(var n in C)C.hasOwnProperty(n)&&C[n]&&(e[n]&&e[n].value!==C[n].value?t[n]={previous:C[n].value,current:e[n].value}:e[n]&&!e[n].deleted||(t[n]={previous:C[n].value}));for(var r in e)e.hasOwnProperty(r)&&e[r]&&(!C[r]||C[r].deleted)&&(t[r]={current:e[r].value});C=e,oe(t)}}function oe(e){var t=Object.keys(e);_&&W.saveFlags(C),t.length>0&&(t.forEach(function(t){S.emit(G+":"+t,e[t].current,e[t].previous)}),S.emit(G,e),b||t.forEach(function(t){Z(t,e[t].current)}))}function ae(){j&&j.dispose(),X&&X.length&&(j=F(X,ee))}function ie(){d&&T.start()}e||i(function(){S.maybeReportError(new R(h()))}),t?t.key||i(function(){S.maybeReportError(new O(w()))}):i(function(){S.maybeReportError(new O(k()))}),"object"===H(n.bootstrap)?i(function(){S.emit($)}):"string"==typeof n.bootstrap&&"LOCALSTORAGE"===n.bootstrap.toUpperCase()&&localStorage?(_=!0,null===(C=W.loadFlags())?(C={},P.fetchFlagSettings(Q.getUser(),v,function(e,t){e&&S.maybeReportError(new L(m(e))),t?(C=t,W.saveFlags(C)):C={},S.emit($)})):(i(function(){S.emit($)}),P.fetchFlagSettings(Q.getUser(),v,function(e,t){e&&S.maybeReportError(new L(m(e))),t&&W.saveFlags(t)}))):P.fetchFlagSettings(Q.getUser(),v,function(e,t){e&&S.maybeReportError(new L(m(e))),C=t||{},S.emit($)}),P.fetchGoals(function(e,t){e&&S.maybeReportError(new N((e.message,e.message))),t&&t.length>0&&(j=F(X=t,ee),function(e,t){var n=location.href,r=void 0;function o(){(r=location.href)!==n&&(n=r,t())}!function e(t,n){t(),setTimeout(function(){e(t,n)},n)}(o,e),window.history&&history.pushState?window.addEventListener("popstate",o):window.addEventListener("hashchange",o)}(z,ae)),S.emit(M)}),"complete"!==document.readyState?window.addEventListener("load",ie):ie(),window.addEventListener("beforeunload",function(){d&&(T.stop(),T.flush(!0))}),window.addEventListener("message",function(e){if(e.origin===a&&"SYN"===e.data.type){window.editorClientBaseUrl=a;var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=a+e.data.editorClientUrl;var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n)}});var ue=new Promise(function(e){var t=S.on($,function(){S.off($,t),e()})}),se=new Promise(function(e){var t=S.on(M,function(){S.off(M,t),e()})});return{waitUntilReady:function(){return ue},waitUntilGoalsReady:function(){return se},identify:function(e,t,n){return _&&W.clearFlags(),u(new Promise(function(n,r){if(e&&null!==e.key&&void 0!==e.key)Q.setUser(e),P.fetchFlagSettings(Q.getUser(),t,function(e,t){if(e)return S.maybeReportError(new L(m(e))),r(e);t&&re(t),n(t),B&&ne()});else{var o=new O(e?w():k());S.maybeReportError(o),r(o)}}),n)},variation:function(e,t){return te(e,t,!0)},track:function(e,t){"string"==typeof e?(X&&!function(e){if(!X||0===X.length)return!1;for(var t=0;t<X.length;t++)if("custom"===X[t].kind&&X[t].key===e)return!0;return!1}(e)&&console.warn(g(e)),Y({kind:"custom",key:e,data:t,user:Q.getUser(),url:window.location.href,creationDate:(new Date).getTime()})):S.maybeReportError(new U(g(e)))},on:function(e,t,n){e.substr(0,G.length)===G?(B=!0,D.isConnected()||ne(),S.on.apply(S,[e,t,n])):S.on.apply(S,Array.prototype.slice.call(arguments))},off:function(e){e===G&&(B=!0)&&(B=!1,D.disconnect()),S.off.apply(S,Array.prototype.slice.call(arguments))},flush:function(e){return u(new Promise(function(e){return d?e(T.flush()):e()},e))},allFlags:function(){var e={};if(!C)return e;for(var t in C)C.hasOwnProperty(t)&&(e[t]=te(t,null,!b));return e}}},version:"2.3.1"}});define("src/globals/flags",["backbone","ldclient"],function(Backbone,LDClient){"use strict";var ldClient;var config;var getUser=function getUser(){var isSubClient=config.parentClientId!==-1;return{key:config.userId,custom:{clientId:config.clientId,parentClientId:isSubClient?config.parentClientId:config.clientId}}};return Object.assign({},Backbone.Events,{start:function start(){var _this=this;var cfg=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(!cfg.clientSideId){throw new Error("flags start: clientSideId is required")}if(!cfg.defaults){throw new Error("flags start: defaults are required")}if(!cfg.userId){throw new Error("flags start: userId is required")}if(!cfg.clientId){throw new Error("flags start: clientId is required")}config=Object.assign({},cfg);return new Promise(function(resolve){ldClient=LDClient.initialize(config.clientSideId,getUser(),{sendEventsOnlyForVariation:true});ldClient.on("change",function(changedFlags){_this.trigger("change",changedFlags);Object.keys(changedFlags).forEach(function(key){return _this.trigger("change:".concat(key),changedFlags[key])})});ldClient.on("ready",function(){return resolve()})})},allFlags:function allFlags(){return ldClient&&ldClient.allFlags()},variation:function variation(flagName){return ldClient.variation(flagName,config.defaults[flagName])}})});function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};var ownKeys=Object.keys(source);if(typeof Object.getOwnPropertySymbols==="function"){ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))}ownKeys.forEach(function(key){_defineProperty(target,key,source[key])})}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}define("src/analytics/Analytics",["underscore","q","mixpanel-analytics-helper","src/Workbench","src/globals/flags"],function(_,Q,mixpanelAnalyticsHelper,Workbench,flags){"use strict";var userInformation={};var sessionId;var NOT_HUMANIZED_EVENT_PARAMETERS=["parentClientId","userId","clientId","sessionId","username","queryId","projectId","queryGroupId","groupCreatorId","signalsGroupId","groupCreatorClientId","uniqueSessionId","groupId","queryIds","hubId","emailId","tabId","dashboardId","processId","salesForceId","logoImagesGroupId","logoImageUrl"];function logMetric(name){var attrs=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(window.newrelic&&window.newrelic.addPageAction){window.newrelic.addPageAction(name,_.extend(attrs,getMetricAttributes()))}}function trackTimeToInteractiveCompleteEvent(){window.removeEventListener("tti:complete",trackTimeToInteractiveCompleteEvent);window.removeEventListener("tti:invalid",trackTimeToInteractiveInvalidEvent);logMetric("tti")}function trackTimeToInteractiveInvalidEvent(){window.removeEventListener("tti:complete",trackTimeToInteractiveCompleteEvent);window.removeEventListener("tti:invalid",trackTimeToInteractiveInvalidEvent);logMetric("tti_invalid")}function trackPerformanceEvent(){var event=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _event$detail=event.detail,name=_event$detail.name,type=_event$detail.type;performance.measure(name,"".concat(name,"-start"),"".concat(name,"-end"));var data=performance.getEntriesByName(name);if(data.length){var _data$=data[0],_name=_data$.name,duration=_data$.duration;performance.clearMarks("".concat(_name,"-start"));performance.clearMarks("".concat(_name,"-end"));performance.clearMeasures(_name);logMetric("performance",{perfName:_name,perfDuration:duration,perfType:type})}}function trackResourceTimingsEvent(){var event=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _event$detail2=event.detail,name=_event$detail2.name,scriptUrl=_event$detail2.scriptUrl;performance.getEntriesByName(scriptUrl).map(function(perfItem){return{resourceUrl:perfItem.name,type:perfItem.initiatorType,duration:Math.round(perfItem.duration)}}).forEach(function(item){logMetric("resourceTimings",_objectSpread({name:name},item))})}function initialisePerformanceMetrics(){window.addEventListener("tti:complete",trackTimeToInteractiveCompleteEvent);window.addEventListener("tti:invalid",trackTimeToInteractiveInvalidEvent);window.addEventListener("performance:complete",trackPerformanceEvent);window.addEventListener("resourceTimings:complete",trackResourceTimingsEvent)}function trackGoogleAnalyticsEvent(googleAnalyticsUtility,data){var category=data.name,action=data.action,label=data.origin,value=data.values?data.values.numberOfMentions:undefined,errors;errors=googleAnalyticsUtility.push(["_trackEvent",category,action,label,value]);if(errors>0){console.warn("Google Analytics recording failed for "+category+", "+action)}}function getFeatureFlags(){return Object.entries(flags.allFlags()||{}).reduce(function(memo,_ref){var _ref2=_slicedToArray(_ref,2),key=_ref2[0],value=_ref2[1];memo[_.camelize("ld-".concat(key))]=value;return memo},{})}function getMetricAttributes(){var buildNumber=Workbench.buildNumber;if(typeof buildNumber==="string"){var value=parseInt(buildNumber.replace("build.",""),10);if(Number.isInteger(value)){buildNumber=value}}return _objectSpread({userId:userInformation.userId,clientName:userInformation.clientName,clientId:userInformation.clientId,parentClientId:userInformation.parentClientId,pricingModel:userInformation.pricingModel,role:userInformation.role,buildNumber:buildNumber},getFeatureFlags())}return{googleAnalyticsUtility:window._gaq,mixpanelUtility:window.mixpanel,trackMixpanelEvent:function trackMixpanelEvent(eventName,data,settings){var eventParameters;var trackingDef=Q.defer();settings=settings||{};settings.ignore=settings.ignore||{};settings.ignore.ignoredKeys=(settings.ignore.ignoredKeys||[]).concat(NOT_HUMANIZED_EVENT_PARAMETERS);if(!this.mixpanelUtility){trackingDef.resolve();return trackingDef.promise}try{eventParameters=mixpanelAnalyticsHelper.buildEventParameters(eventName,data,settings)}catch(err){err.message+=" for buildEventParameters with argument: "+JSON.stringify(data);if(window.NREUM&&window.NREUM.noticeError){window.NREUM.noticeError(err)}else{console.error(err)}trackingDef.resolve();return trackingDef.promise}this.mixpanelUtility.track(eventParameters.eventName,eventParameters.eventData,function(){trackingDef.resolve()});return trackingDef.promise},trackEvent:function trackEvent(data){if(!_.isUndefined(this.googleAnalyticsUtility)){trackGoogleAnalyticsEvent(this.googleAnalyticsUtility,data)}},trackPageView:function trackPageView(fragment){if(!_.isUndefined(this.googleAnalyticsUtility)){this.googleAnalyticsUtility.push(["_trackPageview",fragment])}},setUserInformation:function setUserInformation(data){userInformation=data},setMixpanelPeopleObject:function setMixpanelPeopleObject(data){if(!this.mixpanelUtility){return}this.mixpanelUtility.identify(data.userId);this.mixpanelUtility.people.set({$first_name:data.firstName,$last_name:data.lastName,$username:data.username,$email:data.username,client:data.client,clientId:data.clientId,clientStartDate:data.clientStartDate,salesForceId:data.salesForceId,theme:data.theme,themeName:data.themeName,role:data.role,creationDate:data.creationDate})},setSessionId:function setSessionId(id){sessionId=id;if(this.mixpanelUtility){this.mixpanelRegister(userInformation,sessionId)}},mixpanelRegister:function mixpanelRegister(userInformation,sessionId){if(!userInformation){return console.error("An userInformation is required")}if(!sessionId){return console.error("A sessionId is required")}this.mixpanelUtility.register(_.extend({sessionId:sessionId},userInformation))},getNotHumanizedEventParameters:function getNotHumanizedEventParameters(){return NOT_HUMANIZED_EVENT_PARAMETERS},logMetric:logMetric,initialisePerformanceMetrics:initialisePerformanceMetrics}});define("src/globals/flagNames",[],function(){"use strict";return{ENABLE_INSTAGRAMFILTERS_COMPONENT:"enable-instagramfilters-component",DASHBOARD_EXPORT:"dashboard-export",DASHBOARD_EXPORT_FORCE_WHITELABEL:"dashboard-export-force-whitelabel",SHARABLE_REPORTS_FORCE_WHITELABEL:"sharable-reports-force-whitelabel",EXPORT_NOTES:"export-notes",ENABLE_INSTAGRAMCOMMENTS_COMPONENT:"enable-instagramcomments-component",INSTAGRAMINSIGHTS_EXTRA_COLS:"iginsights-extracols",ENABLE_QUERYWIZARD_COMPLETIONS:"enable-querywizard-completions",ENABLE_QUERYWIZARD_RECOMMENDATIONS:"enable-querywizard-recommendations",ENABLE_INSTAGRAM_TOKEN_STATUS_CHECK:"enable-instagram-token-status-check",ENABLE_IMAGEANALYSIS_COMPONENT:"enable-imageanalysis-component",ENABLE_LOGO_QUERIES_RULES_IMAGE_FILTER:"enable-logo-queries-rules-image-filter",ENABLE_LOGOWALL_STORIES_SORTING:"enable-logowall-stories-sorting",ENABLE_RULE_BULKACTION:"enable-rule-bulkaction",MULTIVARIATE_LOGIN_PROMO:"multivariate-login-promo",WORDCLOUD_USE_EMOJIS:"wordcloud-use-emojis",ENABLE_TOPICWHEEL_COMPONENT:"enable-topicwheel-component",ENABLE_TOPICPLOT_COMPONENT:"enable-topicplot-component",ENABLE_TOPICCLOUD_TRENDING_VIEW:"enable-topic-cloud-trending-view",ENABLE_WORDCLOUD_FULL_SCREEN:"enable-wordcloud-full-screen",ENABLE_YOUTUBEANALYTICS_COMPONENT:"enable-youtubeanalytics-component",ENABLE_YOUTUBEMENTIONS_COMPONENT:"enable-youtubementions-component",ENABLE_COMPONENT_PICKER_TOPICS:"enable-component-picker-topics",ENABLE_EMOTIONS:"enable-emotions",ENABLE_EMOTIONS_MARKUP:"enable-emotions-markup",FACEBOOK_COMPLIANCE:"facebook-compliance",ENABLE_HOMEPAGE:"enable-homepage",TOPIC_WHEEL_ADVANCED_FEATURES:"topic-wheel-advanced-features",ENABLE_RESEARCH_QUERIES:"enable-research-queries",ENABLE_ROLLBACK_QUERIES:"enable-rollback-queries",ENABLE_REACH_METRIC:"enable-reach-metric",ENABLE_INSTAGRAM_HASHTAGS:"enable-instagram-hashtags",ENABLE_DASHBOARD_SCREENSHOTS:"enable-dashboard-screenshots",HIDE_FB_AND_INSTAGRAM_SETUP:"hide-fb-and-instagram-setup",ENABLE_OPTIMISED_DASHBOARD_LIST:"enable-optimised-dashboard-list",ENABLE_NEW_CUSTOMIZE_BAR:"enable-new-customize-bar",ENABLE_TRENDINGTOPICS_COMPONENT:"enable-trendingtopics-component",ENABLE_IMAGELABELS_COMPONENT:"enable-imagelabels-component"}});define("src/globals/moduleRollup",[],function(){"use strict";var lookup=[];return{configure:function configure(){var modules=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];lookup=modules},variation:function variation(moduleName){return lookup.includes(moduleName)}}});define("src/models/MyClient",["backbone"],function(Backbone){"use strict";return Backbone.Model.extend({url:function url(){return"/client/"},allowedMentionBasedSubclients:function allowedMentionBasedSubclients(){var tags=this.get("tags")||{},allow=tags.allowedMentionBasedSubclients;return allow===true||allow==="true"}})});define("src/globals/myClient",["src/models/MyClient"],function(MyClient){"use strict";var myClient=new MyClient;return myClient});define("src/themeLoader",["underscore"],function(_){"use strict";return{_onError:function _onError(window){window.location="/logout?err=missingTheme"},loadTheme:function loadTheme(themeName,done){var self=this;if("default"===themeName){return done()}require(["themes/"+themeName+"/theme"],function(theme){if(!_.isUndefined(theme)&&_.isFunction(theme.applyTheme)&&!theme.isActive()){theme.applyTheme()}_.defer(function(){done(undefined,theme)})},function(){self._onError(window)})}}});define("src/moduleLoader",["async","underscore"],function(async,_){"use strict";return{applyModuleSpecificFunctionality:function applyModuleSpecificFunctionality(context,loadedModules){var module=context;_(loadedModules).each(function(loadedModule){if(_(module["apply"+loadedModule.id]).isFunction()){module["apply"+loadedModule.id].call(module)}});_(loadedModules).each(function(loadedModule){if(_(loadedModule["apply"+module.id]).isFunction()){loadedModule["apply"+module.id].call(loadedModule)}})},loadModules:function loadModules(modules,done){var loadedModules=[],self=this;async.forEach(modules,function(path,next){require([path],function(module){if(!module.id){return next(new Error("Module "+path+" must have an id"))}module.apply();self.applyModuleSpecificFunctionality(module,loadedModules);loadedModules.push(module);_.defer(function(){next()})},function(err){if(err){console.error("could not load module at path",path,err)}return next(err)})},function(err){if(err){console.error("Error applying modules",err)}return done(err)})}}});define("src/PageViewTracker",[],function(){"use strict";function PageViewTracker(bbHistory,Analytics){this._Analytics=Analytics;this._history=bbHistory;bbHistory.on("route",this.trackPageView,this)}PageViewTracker.prototype.trackPageView=function(){this._Analytics.trackPageView(this._history.getFragment())};return{create:function create(bbHistory,Analytics){return new PageViewTracker(bbHistory,Analytics)}}});(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==="object"&&typeof module==="object")module.exports=factory(require("jquery"),require("q"));else if(typeof define==="function"&&define.amd)define("bw-fe-helpers/promiseHelper",["jquery","q"],factory);else{var a=typeof exports==="object"?factory(require("jquery"),require("q")):factory(root["jquery"],root["q"]);for(var i in a)(typeof exports==="object"?exports:root)[i]=a[i]}})(this,function(__WEBPACK_EXTERNAL_MODULE__6__,__WEBPACK_EXTERNAL_MODULE__9__){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=29)}({29:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var q__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(9);var q__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(q__WEBPACK_IMPORTED_MODULE_0__);var jquery__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(6);var jquery__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_1__);__webpack_exports__["default"]={ajax:function ajax(options){options=options||{};options.dataType=options.dataType||"json";options.error=jquery__WEBPACK_IMPORTED_MODULE_1___default.a.noop;return this.wrapJqXHR(jquery__WEBPACK_IMPORTED_MODULE_1___default.a.ajax(options))},wrapJqXHR:function wrapJqXHR(jqXHR){if(!jqXHR){return q__WEBPACK_IMPORTED_MODULE_0___default.a.reject(false)}return q__WEBPACK_IMPORTED_MODULE_0___default.a.Promise(function(resolve,reject){jqXHR.then(function(data){return resolve(data)}).fail(function(jqXHR,textStatus,errorThrown){return reject({status:jqXHR.status,responseText:jqXHR.responseText,textStatus:textStatus,error:errorThrown})})})}}},6:function(module,exports){module.exports=__WEBPACK_EXTERNAL_MODULE__6__},9:function(module,exports){module.exports=__WEBPACK_EXTERNAL_MODULE__9__}})["default"]});define("src/components/imagewall/helpers/logoqueriesEnabledHelper",["bw-fe-helpers/promiseHelper"],function(promiseHelper){"use strict";var logoQueriesEnabled;var load=function load(done){promiseHelper.ajax({url:"/fe-api/client/logoqueriesenabled"}).then(function(response){logoQueriesEnabled=response.logoQueriesEnabled;done()}).catch(function(){logoQueriesEnabled=false;done()})};return{isEnabled:function isEnabled(){return logoQueriesEnabled},load:load}});define("src/events/globalEventNames",[],function(){"use strict";return{APP:{NAVIGATED:"app:navigated"},PROJECTS:{PROJECT_CHANGE:"project:change",PROJECT_CREATE:"project:create",NOTIFICATION_SHOWN:"notification:shown",NEW_TIMEZONE_CHOSEN:"project:newTimezoneChosen"},QUERIES:{QUERY_DESTROY:"query:destroy",QUERY_CHANGE:"query:change",QUERY_CREATE:"query:create",QUERY_BUILDER_OPEN:"queryBuilder:open",QUERY_BUILDER_CLOSE:"queryBuilder:close",QUERY_BUILDER_TAB_SHOWN:"queryBuilder:tabShown",QUERY_BUILDER_TESTSEARCH_USED:"queryBuilder:testsearchUsed",QUERY_BUILDER_TESTSEARCH_TOPICS_VIEW_SWITCHED:"queryBuilder:testsearchTopicsViewSwitched",QUERY_BUILDER_TESTSEARCH_TOPIC_CLICKED:"queryBuilder:testsearchTopicClicked",QUERY_BUILDER_TESTSEARCH_TOPIC_RESULTS_BACK_BUTTON_CLICKED:"queryBuilder:testsearchTopicResultsBackButtonClicked",QUERY_LOCKED:"query:locked",QUERY_UNLOCKED:"query:unlocked",QUERY_REAUTH:"query:reauth",QUERY_EXAMPLES_SHOWN:"queryBuilder:queryExamplesShown"},DASHBOARDS:{DASHBOARD_CREATED:"dashboard:created",DASHBOARD_DELETED:"dashboard:deleted",DASHBOARD_SETUP_CREATION_FAILED:"dashboardSetup:creationFailed",DASHBOARD_SETUP_DELETED:"dashboardSetup:deleted",TAB_CREATED:"dashboard:tabCreated",DASHBOARD_SHOWN:"dashboard:shown",DASHBOARD_HIDDEN:"dashboard:hidden",DASHBOARD_SHARED:"dashboard:sharingUpdated",GLOBAL_SETTINGS_APPLIED:"dashboard:globalSettingsApplied",TIMEZONE_UPDATED:"timezone:updated",NEW_TIMEZONE_CHOSEN:"dashboard:newTimezoneChosen",COMPONENTS_COPIED:"dashboard:componentsCopied",COMPONENTS_PASTED:"dashboard:componentsPasted"},DASHBOARD_EXPORTS:{EXPORT_INITIATED:"dashboardExport:initiated",EXPORT_REQUESTED:"dashboardExport:requested"},COMPONENTS:{COMPONENT_ADDED:"component:added",COMPONENT_REMOVED:"component:removed",COMPONENT_RENDERED:"component:rendered",ANNOTATION_REMOVED:"component:annotationRemoved",ANNOTATION_REMOVED_ALL:"component:annotationAllRemoved",COMPONENT_LOADED:"component:loaded",TIMEPICKER_OPENED:"timepicker:opened",TIMEPICKER_SELECTED:"timepicker:selected",SETTINGS_SET:"componentSettings:set"},ALERTS:{ALERT_SAVED:"alert:saved"},ADMINISTRATION:{TAB_CHANGED:"adminTab:shown",ACCOUNTINFO_COLUMN_SORTED:"accountInfo:columnSorted",USER_UPDATED:"user:updated",MODAL_OPENED:"uiModalOpened",CLIENT_UPDATED:"client:updated",PROJECT_UPDATED:"project:updated",EXPORT_ACCOUNTINFO_USAGE:"accountInfo:exportUsageReport",EXPORT_ACCOUNTINFO_LOGIN:"accountInfo:exportLoginReport"},MENTIONS:{MENTION_DELETE:"mention:delete",MENTION_MARK_AS_SPAM:"mention:markAsSpam",MENTION_VIEWED:"single-mention-view:viewed"},RULES:{RULE_ADDED:"rule:added",RULE_UPDATED:"rule:updated",RULE_DELETED:"rule:deleted"},SIGNALS:{SIGNAL_CREATED:"signals:hubCreated",SIGNAL_DELETED:"signals:hubDeleted",SIGNAL_UPDATED:"signals:hubUpdated"},ADVERT_POPUPS:{ADVERT_POPUP_SHOWN:"advertPopup:shown",ADVERT_POPUP_CLOSED:"advertPopup:closed",ADVERT_POPUP_POSTPONED:"advertPopup:postponed",ADVERT_POPUP_LINK_CLICKED:"advertPopup:linkClicked"},LOGO_DETECTION_PROMOTION:{PROMOTION_SHOWN:"logoDetectionPromotion:shown",PROMOTION_CLOSED:"logoDetectionPromotion:closed",PROMOTION_SIGNUP:"logoDetectionPromotion:signup",PROMOTION_SIGNUP_ERROR:"logoDetectionPromotion:signupError"},IMAGE_CLASSIFICATION:{REPORT:"imageClassification:report",USER:"imageClassification:userReport"},IMAGE_INSIGHTS:{IMAGE_LOAD_SUCCESS:"imageInsights:imageLoadSuccess",IMAGE_LOAD_FAILURE:"imageInsights:imageLoadFailure"},FACEBOOK_COVERAGE:{INVITE_SENT:"facebookCoverage:inviteSent",INVITE_SENT_FAILED:"facebookCoverage:inviteSentFailed",INVITE_DIALOG_OPENED:"facebookCoverage:inviteDialogOpened",INVITE_DIALOG_CLOSED:"facebookCoverage:inviteDialogClosed",AUTHENTICATION_STARTED:"facebookCoverage:authenticationStarted",AUTHENTICATION_SUCCESS:"facebookCoverage:authenticationSuccess",AUTHENTICATION_FAILED:"facebookCoverage:authenticationFailed"},INSTAGRAM_COVERAGE:{INVITE_SENT:"instagramCoverage:inviteSent",INVITE_SENT_FAILED:"instagramCoverage:inviteSentFailed",INVITE_DIALOG_OPENED:"instagramCoverage:inviteDialogOpened",INVITE_DIALOG_CLOSED:"instagramCoverage:inviteDialogClosed",AUTHENTICATION_STARTED:"instagramCoverage:authenticationStarted",AUTHENTICATION_SUCCESS:"instagramCoverage:authenticationSuccess",AUTHENTICATION_FAILED:"instagramCoverage:authenticationFailed"},QUICK_SEARCH:{QUICK_SEARCH_SUBMITTED:"quickSearch:submitted"},GUIDER:{GUIDER_OPENED:"guider:opened",GUIDER_CLOSED:"guider:closed",GUIDER_DISMISSED:"guider:dismissed"},MONITORS:{MONITOR_CREATED:"monitor:created",MONITOR_EDITED:"monitor:edited"}}});define("src/events/queryEvents",["underscore","backbone"],function(_,Backbone){"use strict";return _.clone(Backbone.Events)});(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==="object"&&typeof module==="object")module.exports=factory(require("underscore"));else if(typeof define==="function"&&define.amd)define("bw-fe-helpers/languageGroupHelper",["underscore"],factory);else{var a=typeof exports==="object"?factory(require("underscore")):factory(root["underscore"]);for(var i in a)(typeof exports==="object"?exports:root)[i]=a[i]}})(this,function(__WEBPACK_EXTERNAL_MODULE__1__){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=25)}({1:function(module,exports){module.exports=__WEBPACK_EXTERNAL_MODULE__1__},25:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var underscore__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1);var underscore__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(underscore__WEBPACK_IMPORTED_MODULE_0__);var europeanKeys=["cat","catalan","cs","de","ell","en","fr","gle","hu","hye","it","lav","lit","nl","pol","pt-PT","ro","ru","tr"];var scandinavianKeys=["dk","fi","no","se"];var americasKeys=["pt-BR"];var middleEastKeys=["ar","arf","arz","heb","pes"];var asiaKeys=["ben","div","dzo","hin","ind","jp","khm","kr","lao","may","mya","sin","tam","th","tl","urd","vie","zh","zh-TR"];var ideographicLanguages=["jp","kr","lao","th","zh","zh-TR"];function makeLanguageObjects(languageGroup,languageCollection){return underscore__WEBPACK_IMPORTED_MODULE_0___default()(languageGroup).chain().map(function(code){var language=languageCollection.get(code);return underscore__WEBPACK_IMPORTED_MODULE_0___default.a.extend(language.toJSON(),{name:language?language.get("name")||code:code})}).sortBy(function(lang){return lang.name}).value()}__webpack_exports__["default"]={asteriskAlphaLanguages:function asteriskAlphaLanguages(languageGroups){Object.keys(languageGroups).forEach(function(key){languageGroups[key]=languageGroups[key].map(function(languageData){if(languageData.alpha){languageData.name+="*"}return languageData})});return languageGroups},makeGroupedLanguages:function makeGroupedLanguages(languageCodes){return underscore__WEBPACK_IMPORTED_MODULE_0___default()(languageCodes).reduce(function(memo,code){if(underscore__WEBPACK_IMPORTED_MODULE_0___default()(europeanKeys).contains(code)){memo.european.push(code)}else if(underscore__WEBPACK_IMPORTED_MODULE_0___default()(scandinavianKeys).contains(code)){memo.scandinavian.push(code)}else if(underscore__WEBPACK_IMPORTED_MODULE_0___default()(americasKeys).contains(code)){memo.americas.push(code)}else if(underscore__WEBPACK_IMPORTED_MODULE_0___default()(middleEastKeys).contains(code)){memo.middleEast.push(code)}else if(underscore__WEBPACK_IMPORTED_MODULE_0___default()(asiaKeys).contains(code)){memo.asia.push(code)}else{memo.other.push(code)}return memo},{european:[],scandinavian:[],americas:[],middleEast:[],asia:[],other:[]})},getLanguageData:function getLanguageData(languageCollection){var languageGroups=this.makeGroupedLanguages(languageCollection.pluck("code"));var languageData={};languageData.asia=makeLanguageObjects(languageGroups.asia,languageCollection);languageData.middleEast=makeLanguageObjects(languageGroups.middleEast,languageCollection);languageData.european=makeLanguageObjects(languageGroups.european,languageCollection);languageData.scandinavian=makeLanguageObjects(languageGroups.scandinavian,languageCollection);languageData.americas=makeLanguageObjects(languageGroups.americas,languageCollection);languageData.newLanguage=makeLanguageObjects(languageGroups.other,languageCollection);return languageData},isIdeographic:function isIdeographic(languageCode){return ideographicLanguages.includes(languageCode)}}}})["default"]});define("src/globals/crimsonMode",["src/globals/me"],function(me){"use strict";return{enabled:function enabled(){var client=me.get("client")||{};return client.hasOwnProperty("crimsonMode")&&client.crimsonMode}}});define("src/models/Query",["jquery","backbone","underscore","src/Workbench","bw-fe-helpers/languageGroupHelper","src/globals/currentProject","src/globals/crimsonMode","src/events/queryEvents","src/events/globalEventNames","src/ApiError"],function($,Backbone,_,Workbench,languageGroupHelper,currentProject,crimsonMode,queryEvents,globalEventNames,ApiError){"use strict";var QUERY_TEXT_MAX_LENGTH=4095,DESCRIPTION_MAX_LENGTH=500,getRawIncludedTerms,getRawIncludedTermsWithParenthesis,getRawContextTerms,getRawExcludedTerms,getRawExcludedTermsDetailed;function setLanguageAttributes(model){var defaultLangCodes=currentProject.get("defaultLangCodes");var modelLanguages=model.get("languages");var hasLanguages=modelLanguages&&modelLanguages.length>0;var hasProjectDefaultLanguages=defaultLangCodes&&defaultLangCodes.length>0;var isLanguageAgnostic=model.get("languageAgnostic");if(hasLanguages&&isLanguageAgnostic){return}if(hasLanguages){return model.set("languageAgnostic",false)}if(hasProjectDefaultLanguages){return model.set({languageAgnostic:false,languages:defaultLangCodes})}model.set({languageAgnostic:true,languages:["en"]})}function isEmptyNullOrUndefined(value){if(_.isNull(value)||_.isUndefined(value)||value===""){return true}return false}function negate(terms){return _(terms).map(function(term){return"-"+term})}function negateDetailed(terms){return _(terms).map(function(term){return"NOT "+term})}function parenthesise(text){return"("+text+")"}function phraseify(terms){return _(terms).map(function(term){var trimmed=term.trim();return trimmed.indexOf(" ")===-1?trimmed:'"'+trimmed+'"'})}function group(terms){return terms.join(" OR ")}getRawIncludedTerms=_.compose(group,phraseify);getRawIncludedTermsWithParenthesis=_.compose(parenthesise,getRawIncludedTerms);getRawContextTerms=_.compose(parenthesise,group,phraseify);getRawExcludedTerms=_.compose(negate,phraseify);getRawExcludedTermsDetailed=_.compose(negateDetailed,phraseify);function mapType(model,reverse){var typeMapping={monitor:"monitor","search string":"text",brand:"structured"},type=model.get?model.get("type"):model.type;if(reverse){typeMapping=_.invert(typeMapping)}if(_(typeMapping).has(type)){if(model.set){model.set({type:typeMapping[type]},{silent:true})}else{model.type=typeMapping[type]}}}function trackDestroyEvent(model){queryEvents.trigger(globalEventNames.QUERIES.QUERY_DESTROY,model)}return Backbone.Model.extend({defaults:function defaults(){var defaults={type:crimsonMode.enabled()?"monitor":"text",languageAgnostic:false,samplePercent:100};if(crimsonMode.enabled()){defaults["monitorStartDate"]=null}return defaults},constructor:function Query(){Backbone.Validations.Model.apply(this,arguments);this.projectId=this.get("projectId");if(!this.projectId){this.projectId=currentProject.id}if(!this.projectId){throw new Error("no project id for query")}setLanguageAttributes(this);this.on("destroy",trackDestroyEvent)},validate:function validate(attrs){var reducedResults,validationResults={name:this.validateName(attrs),description:this.validateDescription(attrs),languages:this.validateLanguages(attrs),includedTerms:this.validateIncludedTerms(attrs)};reducedResults=_(validationResults).reduce(function(memo,val,key){if(val){memo[key]=[].concat(val)}return memo},{});return _.size(reducedResults)?reducedResults:false},validateName:function validateName(attrs){var name=attrs.name;if(isEmptyNullOrUndefined(name)){return"required"}return this.validateNameUniquenessWithinProject(attrs)},validateNameUniquenessWithinProject:function validateNameUniquenessWithinProject(attrs){var queries=require("src/globals/queries");if(this.get("name")===attrs.name){return}if(queries.findWhere({name:attrs.name})){return"notUnique"}},validateDescription:function validateDescription(attrs){var description=attrs.description;if(_.isString(description)&&description.length>DESCRIPTION_MAX_LENGTH){return"maxlength"}},validateLanguages:function validateLanguages(attrs){return this.validateLanguagePresent(attrs)||this.validateLanguageCombination(attrs)},validateLanguagePresent:function validateLanguagePresent(attrs){var languages=attrs.languages;var isLanguageAgnostic=attrs.languageAgnostic;var hasValidationError=languages.length?false:"required";if(!_.isArray(languages)){throw new Error('Expected "languages" property to be an array')}if(hasValidationError&&isLanguageAgnostic){return false}return hasValidationError},validateLanguageCombination:function validateLanguageCombination(attrs){var languages=attrs.languages,langCount;if(attrs.languageAgnostic){return false}if(languages.length===1){return false}langCount=_.countBy(languages,function(lang){return languageGroupHelper.isIdeographic(lang)?"ideographic":"nonIdeographic"});if(langCount.ideographic&&langCount.nonIdeographic){return"unsupported"}return false},validateIncludedTerms:function validateIncludedTerms(attrs){var terms=attrs.includedTerms;return this.validateTerms("includedTerms",terms)},validateTerms:function validateTerms(attrName,terms){var errors={};if(this.get("type")==="publicfacebook"){return}if(_.isUndefined(terms)){terms=attrName}else{terms=_.object([attrName],terms)}if(_(terms).has("includedTerms")){errors=this.validateFreeTextTerm(terms.includedTerms)}return _(errors).size()?errors:null},validateFreeTextTerm:function validateFreeTextTerm(term){if(!term||!term.length||!term[0]){return{freeText:"required"}}},url:function url(){return"/projects/"+this.projectId+"/queries/"+(this.id||"")},parse:function parse(response){var queryText,queryClass=this.constructor;mapType(response);delete this._wasConvertedFromStructuredQuery;if(!response.type||response.type!=="structured"){return response}queryText=queryClass.getRawQueryTerm(response,true);if(queryText.length>queryClass.queryTextMaxLength){queryText=queryClass.getRawQueryTerm(response)}this._wasConvertedFromStructuredQuery=true;delete response.contextTerms;delete response.excludedTerms;return _.extend(response,{type:"text",includedTerms:[queryText]})},sync:function sync(method,model,options){if(_(["update","create"]).indexOf(method)!==-1){mapType(model,true);options=options||{};if(!options.attrs){options.attrs=model.toJSON(options)}if(options.attrs.projectId){delete options.attrs.projectId}}return Backbone.sync.call(this,method,model,options)},moveTo:function moveTo(destinationProjectId){var self=this,params;if(!this.id){throw new Error("Cannot move an unsaved query!")}params={success:function success(){self.trigger("queryMoved")},error:function error(_error){self.trigger("queryMovedError",new ApiError(_error))},url:"/projects/"+this.projectId+"/queries/"+this.id+"/move/"+destinationProjectId};Backbone.sync("create",this,params)},destroy:function destroy(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(this.get("type")==="instagram"&&!options.url){options.url="/projects/{projectId}/instagramqueries/"+this.id}return Backbone.Model.prototype.destroy.call(this,options)},lock:function lock(onSuccess,onError){$.ajax({type:"POST",url:Workbench.buildApiUrl("/admin/projects/"+this.projectId+"/queries/"+this.id+"/lock"),success:onSuccess,error:onError})},unlock:function unlock(onSuccess,onError){$.ajax({type:"DELETE",url:Workbench.buildApiUrl("/admin/projects/"+this.projectId+"/queries/"+this.id+"/lock"),success:onSuccess,error:onError})},wasConvertedFromStructuredQuery:function wasConvertedFromStructuredQuery(){return!!this._wasConvertedFromStructuredQuery}},{queryTextMaxLength:QUERY_TEXT_MAX_LENGTH,descriptionMaxLength:DESCRIPTION_MAX_LENGTH,getRawQueryTerm:function getRawQueryTerm(queryData,prettyPrint){var includes=queryData.includedTerms||[],context=queryData.contextTerms||[],excludes=queryData.excludedTerms||[],result=[],joinBy=prettyPrint?"\n\n":" ";if(includes.length===1&&!context.length&&!excludes.length){return includes[0]}if(context.length){result.push(getRawIncludedTermsWithParenthesis(includes))}else{result.push(getRawIncludedTerms(includes))}if(context.length){result.push("AND");result.push(getRawContextTerms(context))}if(excludes.length){if(prettyPrint){result.push(getRawExcludedTermsDetailed(excludes).join(" "))}else{result.push(getRawExcludedTerms(excludes).join(" "))}}return result.join(joinBy)}})});define("src/models/QuerySummaryCollection",["underscore","backbone","src/models/Query"],function(_,Backbone,Query){"use strict";function getQueryType(queries,queryId){var query=queries.findWhere({id:queryId});return query&&query.get("type")}return Backbone.Collection.extend({model:Query,constructor:function QuerySummaryCollection(data,options){Backbone.Collection.apply(this,arguments);this.projectId=options&&options.projectId},parse:function parse(response){var projectId=this.projectId;return _(response.results).map(function(query){return _.extend(query,{projectId:projectId})})},comparator:function comparator(model){return(model.get("name")||"").toLowerCase()},url:function url(){var projectId=this.projectId||"{projectId}";return"/projects/"+projectId+"/queries/summary"},areFacebookQueries:function areFacebookQueries(ids){if(!ids||ids.length===0){return false}var facebookModels=this.where({type:"publicfacebook"}),facebookIds=_.pluck(facebookModels,"id");return _.intersection(ids,facebookIds).length===ids.length},containsLogoQueryIds:function containsLogoQueryIds(){var _this=this;var queryIds=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];return[].concat(queryIds).some(function(queryId){return _this.findWhere({id:queryId,type:"logo"})})},getQueryTypesFromIds:function getQueryTypesFromIds(){var _this2=this;var queryIds=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];return[].concat(queryIds).map(function(queryId){return getQueryType(_this2,queryId)})},getAllowedQueryIds:function getAllowedQueryIds(){var _this3=this;var queryIds=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var allowedQueryTypes=arguments.length>1?arguments[1]:undefined;if(!allowedQueryTypes){return[].concat(queryIds).filter(function(queryId){return _this3.get(queryId)})}return[].concat(queryIds).filter(function(queryId){return allowedQueryTypes.includes(getQueryType(_this3,queryId))})}})});define("src/globals/queries",["q","src/events/globalEventNames","src/events/queryEvents","src/globals/currentProject","src/models/QuerySummaryCollection"],function(Q,globalEventNames,queryEvents,currentProject,QuerySummaryCollection){"use strict";var QUERY_EVENTS=globalEventNames.QUERIES;var queries=new QuerySummaryCollection;function fetchQueries(){return new Q(queries.fetch())}queryEvents.on(QUERY_EVENTS.QUERY_CREATE,fetchQueries);queryEvents.on(QUERY_EVENTS.QUERY_CHANGE,fetchQueries);queryEvents.on(QUERY_EVENTS.QUERY_DESTROY,fetchQueries);currentProject.onLoad(function(callback){queries.projectId=currentProject.id;if(!currentProject.id){queries.reset([],{silent:false});return}queries.reset([],{silent:true});fetchQueries().then(function(){callback()}).catch(function(err){callback(err)})});return queries});define("src/globals/appState",["backbone","underscore","src/globals/me","src/globals/currentProject","src/globals/queries"],function(Backbone,_,me,currentProject,queries){"use strict";var isInitialized=null;function getMixpanelToken(){return window.mixpanel&&window.mixpanel.config.token}var appState={toJSON:function toJSON(){return{mixpanelToken:getMixpanelToken(),me:me.toJSON(),currentProject:currentProject.toJSON(),queries:queries.toJSON()}},initialize:function initialize(){if(isInitialized!==null){throw new Error("Cannot initialize appState more than once")}isInitialized=true;appState.listenTo(me,"change",emitChange);appState.listenTo(currentProject,"change",emitChange);appState.listenTo(queries,"reset add remove",emitChange)}};function emitChange(){appState.trigger("change",appState.toJSON())}_.extend(appState,Backbone.Events);return appState});define("src/appInitialise",["async","underscore","backbone","src/LoginPromotionManager","src/Workbench","src/ApiError","src/analytics/Analytics","src/globals/flags","src/globals/flagNames","src/globals/moduleRollup","src/globals/me","src/globals/myClient","src/globals/theme","src/helpers/appSettingsHelper","src/themeLoader","src/moduleLoader","src/PageViewTracker","src/components/imagewall/helpers/logoqueriesEnabledHelper","src/globals/appState"],function(async,_,Backbone,LoginPromotionManager,Workbench,ApiError,Analytics,flags,FLAGS,moduleRollup,me,myClient,theme,appSettingsHelper,themeLoader,moduleLoader,PageViewTracker,logoqueriesEnabledHelper,appState){"use strict";var initializedAlready=false;function getUserInformation(){var meData,clientData,crmData;meData=me.toJSON();clientData=meData.client||{};crmData=meData.crmAccount||{};return{distinct_id:meData.id,userId:meData.id,role:meData.uiRole,clientId:clientData.id,clientName:clientData.name,parentClientId:clientData.parentId,pricingModel:myClient.get("pricingModel"),modules:_.pluck(Workbench.modules,"name"),crmId:crmData.crmId,accountType:crmData.accountType,accountOwner:crmData.accountOwner,managementGroup:crmData.managementGroup,accountCurrency:crmData.accountCurrency,accountStatus:crmData.status,subscribedProducts:crmData.subscribedProducts,useCases:crmData.useCases}}function getUserProfile(){var meData,clientData;meData=me.toJSON();clientData=meData.client||{};return{distinct_id:meData.id,userId:meData.id,firstName:meData.firstName,lastName:meData.lastName,username:meData.username,client:clientData.name,clientId:clientData.id,clientStartDate:clientData.startDate,salesForceId:clientData.salesForceId,theme:clientData.theme,themeName:appSettingsHelper.get("theme").themeName,role:meData.uiRole,creationDate:meData.creationDate}}function loadFlags(done){Analytics.logMetric("flags:load");var settings=appSettingsHelper.get("flags");var _getUserInformation=getUserInformation(),userId=_getUserInformation.userId,clientId=_getUserInformation.clientId,parentClientId=_getUserInformation.parentClientId;flags.start({clientSideId:settings.clientSideId,defaults:settings.defaults,userId:userId,clientId:clientId,parentClientId:parentClientId}).then(function(){Analytics.logMetric("flags:load-complete");done()})}function forceSharableReportsExtension(modules){var sharableReportsExtension="src/extensions/ReportsExtension";if(modules.indexOf(sharableReportsExtension)>-1){return modules}else if(flags.variation(FLAGS.SHARABLE_REPORTS_FORCE_WHITELABEL)){return[sharableReportsExtension].concat(modules)}return modules}function doInitialise(done){if(initializedAlready){return done(new Error("App has already been initialized"))}async.parallel({fetchMe:function fetchMe(callback){if(!me.isNew()){return callback()}me.fetch({success:function success(){callback()},error:function error(xhr){callback({message:"Could not fetch me data: "+new ApiError(xhr).message})}})},fetchMyClient:function fetchMyClient(callback){myClient.fetch({success:function success(){callback()},error:function error(xhr){callback({message:"Could not fetch myClient data: "+new ApiError(xhr).message})}})}},function(err){if(err){return done(err)}loadFlags(function(){async.parallel({loadAnalytics:function loadAnalytics(done){Analytics.initialisePerformanceMetrics();Analytics.setUserInformation(getUserInformation());Analytics.setSessionId(Workbench.uniqueSessionId);Analytics.setMixpanelPeopleObject(getUserProfile());if(Workbench.logToGoogleAnalytics){Workbench.pageViewTracker=PageViewTracker.create(Backbone.history,Analytics)}done()},loadTheme:function loadTheme(done){themeLoader.loadTheme(theme.name,done)},loadModules:function loadModules(done){var modulesFromServer=_.pluck(Workbench.modules,"path").filter(Boolean);var modules=forceSharableReportsExtension(modulesFromServer);moduleRollup.configure(_.pluck(Workbench.modules,"name"));if(!_(modules).isArray()||_(modules).isEmpty()){return done()}moduleLoader.loadModules(modules,done)},loadLogoQueries:function loadLogoQueries(done){logoqueriesEnabledHelper.load(done)}},function(err){LoginPromotionManager.showPopup();appState.initialize();done(err)})})})}return{go:doInitialise}});define("src/storageProvider",[],function(){"use strict";var storage=localStorage;return{setStorage:function setStorage(newStorage){storage=newStorage},set:function set(key,value){var val=typeof value==="string"?value:JSON.stringify(value);return storage.setItem(key,val)},get:function get(key){var item;try{item=storage.getItem(key);if(!item){return}return JSON.parse(item)}catch(e){return item}},remove:function remove(key){return storage.removeItem(key)},clear:function clear(){return storage.clear()}}});define("src/permissions",["underscore","src/globals/me"],function(_,meGlobal){"use strict";var DEFAULT_PERMISSIONS={"see.projects":["regular","analystPlus","analyst","view","viewMetricsOnly","viewNoMentionExport"],"see.videoHelp":["regular","analystPlus"],"see.queries":["regular","analystPlus"],"see.mainMenu.oldDashboardVersion":["regular","analystPlus"],"see.downloadMenu":["regular","analystPlus"],"see.notifications":["regular","analystPlus"],"see.engagement":["regular","analystPlus"],"see.mentions":["regular","analystPlus","analyst","view","viewNoMentionExport"],"see.engagement.twitterIntents":["regular","analystPlus","analyst","view","viewMetricsOnly","viewNoMentionExport"],"see.dashboard.globalControls":["regular","analystPlus","analyst","view","viewMetricsOnly","viewNoMentionExport"],"see.dashboard.controls":["regular","analystPlus","analyst","view","viewMetricsOnly","viewNoMentionExport"],"see.dashboard.controls.queryField":["regular","analystPlus"],"see.dashboard.controls.dateRange":["regular","analystPlus","analyst","view","viewMetricsOnly","viewNoMentionExport"],"see.dashboard.controls.fixedDateRange":["regular","analystPlus","analyst","view","viewMetricsOnly","viewNoMentionExport"],"see.dashboard.controls.advancedFilters":["regular","analystPlus","analyst"],"see.dashboard.controls.clearFilters":["regular","analystPlus","analyst"],"see.dashboard.controls.createAlert":["regular","analystPlus"],"see.dashboard.controls.searchWithinMentions":["regular","analystPlus","analyst"],"see.dashboard.controls.help":["regular","analystPlus"],"see.historyComparison.controls.addQuery":["regular","analystPlus"],"see.historyComparison.controls.removeQuery":["regular","analystPlus"],"see.historyComparison.controls.createDateRange":["regular","analystPlus"],"see.historyComparison.controls.editDateRange":["regular","analystPlus"],"edit.historyComparison.controls.query":["regular","analystPlus"],"see.dashboard.component.help":["regular","analystPlus"],"see.dashboard.component.changeView":["regular","analystPlus","analyst","view","viewMetricsOnly","viewNoMentionExport"],"see.dashboard.component.showHideColumns":["regular","analystPlus","analyst"],"see.dashboard.component.optionsSummary":["regular","analystPlus","analyst","view","viewMetricsOnly","viewNoMentionExport"],"see.tools":["regular","analystPlus"],"see.adminPage":["superadmin","admin","regular"],"see.userPreferenceMenu":["regular","analystPlus","analyst","view","viewMetricsOnly","viewNoMentionExport"],"share.dashboard":["regular","analystPlus"],"edit.notifications":["superadmin"],"edit.querySubscriptions":["admin"],"edit.projects":["regular"],"edit.queries":["regular"],"lock.queries":["admin"],"edit.queries.in.admin":["superadmin"],"edit.channels.coverage":["admin"],"edit.groups":["regular","analystPlus"],"mark.as.spam":["regular","analystPlus"],"edit.categories":["regular","analystPlus"],"edit.alerts":["regular","analystPlus"],"edit.mentions":["regular","analystPlus","analyst"],"select.mentions":["regular","analystPlus","analyst"],"edit.topics":["regular","analystPlus"],"edit.dashboard":["regular","analystPlus"],"edit.rules":["regular"],"see.all.clients":["admin","regular"],"edit.client.users":["admin"],"edit.reseller.agency.clients":["admin"],"see.usageSummary":["admin"],"see.legacyUsageSummary":["admin"],"see.jwtIntegrations":["admin"],"see.reports":["regular","analystPlus","analyst"],"see.streams":["regular","analystPlus","analyst"],"see.signals":["regular","analystPlus"],"see.superadmin.link":["superadmin"],"see.buildNumber":["superadmin"],"export.mentions":["regular","analystPlus","analyst","view","viewMetricsOnly"]};var PERMISSIONS;function resetPermissions(){PERMISSIONS=_(DEFAULT_PERMISSIONS).reduce(function(memo,value,key){memo[key]=_.clone(value);return memo},{})}function getAllowedRoles(permissionName){var allowedRoles=PERMISSIONS[permissionName];if(!allowedRoles){throw new Error("Permission "+permissionName+" does not exist")}allowedRoles=[].concat(allowedRoles);if(_.intersection(["viewNoMentionExport","viewMetricsOnly","view","analyst","analystPlus","regular"],allowedRoles).length>0){allowedRoles.push("superadmin");allowedRoles.push("admin")}return allowedRoles}function standardiseRole(roleName){return roleName==="administrator"?"admin":roleName}function isAllowedRole(userRole,allowedRoles){return allowedRoles.indexOf(userRole)>-1}function isValidTargetObject(targetObject){if(!targetObject){return false}if(!_.isFunction(targetObject.getApplicableUserRole)){return false}if(!_.isFunction(targetObject.getOwner)){return false}return true}function isOwnTargetObject(targetObject,userId){var targetOwnerId=parseInt(targetObject.getOwner()||userId,10)||0;var targetObjectRole=targetObject.getApplicableUserRole();userId=parseInt(userId,10)||0;if(userId===targetOwnerId){return true}if(!targetObjectRole){throw new Error("Accessing a non-shared non-owned target object (user: "+userId+" owner: "+targetOwnerId+", target id: "+targetObject.id+")")}return false}function hasPermissionOnTargetObject(permissionName,targetObject){var targetObjectRole=targetObject.getApplicableUserRole(),allowedRoles=getAllowedRoles(permissionName);return isAllowedRole(targetObjectRole,allowedRoles)}resetPermissions();return{get:function get(permissionName){var allowedRoles=PERMISSIONS[permissionName];if(!allowedRoles){return}return[].concat(allowedRoles)},set:function set(permissionName,allowedRoles){PERMISSIONS[permissionName]=[].concat(allowedRoles)},remove:function remove(permissionName){delete PERMISSIONS[permissionName]},append:function append(permissionName,allowedRoles){PERMISSIONS[permissionName]=_.unique(PERMISSIONS[permissionName].concat(allowedRoles))},reset:function reset(){resetPermissions()},check:function check(permissionName,targetObject){var allowedRoles=getAllowedRoles(permissionName),userRole=standardiseRole(meGlobal.get("uiRole")),hasPermission,hasPermissionOnTargetOjbect;if(userRole==="superadmin"&&!targetObject){return true}hasPermission=isAllowedRole(userRole,allowedRoles);if(!isValidTargetObject(targetObject)||isOwnTargetObject(targetObject,meGlobal.id)){return hasPermission}hasPermissionOnTargetOjbect=hasPermissionOnTargetObject(permissionName,targetObject);return hasPermission&&hasPermissionOnTargetOjbect}}});define("src/events/appEvents",["underscore","backbone"],function(_,Backbone){"use strict";return _.clone(Backbone.Events)});define("src/views/navigation/localStorageKeys",[],function(){"use strict";return{NAVIGATION_COLLAPSED:"navigation-collapsed"}});define("src/models/mixins/PaginationMethods",["underscore"],function(_){"use strict";return{initialize:function initialize(models,options){options=_.defaults(options||{},{page:0,pageSize:50});options.page=Math.max(options.page,0);options.pageSize=Math.max(options.pageSize,1);this._paginated=options.pagination!==false;this.setPage(options.page);this.setPageSize(options.pageSize)},getQueryData:function getQueryData(){var isPaginated=this._paginated;return{page:isPaginated?this.getPage():0,pageSize:isPaginated?this.getPageSize():99999}},parse:function parse(res){this.setPage(res.resultsPage);this.setPageSize(res.resultsPageSize);this._totalResults=res.resultsTotal;if(!this._paginated&&_.isUndefined(this._totalResults)){this._totalResults=res.results&&res.results.length}return[].concat(res.results)},getPage:function getPage(){return this._page},setPage:function setPage(val){this._page=val},getPageSize:function getPageSize(){return this._pageSize},setPageSize:function setPageSize(value){this._pageSize=value},setPagination:function setPagination(pagination){this._paginated=pagination},isPaginated:function isPaginated(){return this._paginated},hasMorePages:function hasMorePages(){if(!this.isPaginated()){return false}if(_.isUndefined(this._totalResults)){return true}return(this.getPage()||1)*this.getPageSize()<this._totalResults},getTotalResults:function getTotalResults(){return this.isPaginated()?this._totalResults:this.length},getPaginatedData:function getPaginatedData(){return{page:this.getPage(),pageSize:this.getPageSize(),totalResults:this.getTotalResults(),items:this.toJSON()}}}});define("src/models/PaginatedCollection",["backbone","src/models/mixins/PaginationMethods"],function(Backbone,PaginationMethods){"use strict";return Backbone.Collection.extend(PaginationMethods)});define("src/models/ProjectSummaryCollection",["underscore","src/models/PaginatedCollection"],function(_,PaginatedCollection){"use strict";return PaginatedCollection.extend({constructor:function ProjectSummaryCollection(){PaginatedCollection.apply(this,arguments)},url:function url(){return"/projects/summary"},sortedBy:"name",sortedAsc:true,sort:function sort(options){var sortVal=this.sortedBy||"name";this.comparator=function(project){var val=project.get(sortVal)||"";return val.toLowerCase?val.toLowerCase():val};options=options||{};var wasSilent=!!options.silent;options.silent=true;PaginatedCollection.prototype.sort.call(this,options);if(!this.sortedAsc){this.models=this.models.reverse()}if(!wasSilent){this.trigger("reset",this,{})}},initialize:function initialize(models,options){PaginatedCollection.prototype.initialize.call(this,models,options);this._filter=(options||{}).filter||"";if(this.models&&this.models.length){this.sort()}this.fetching=false;this.on("request",this.onRequest,this);this.on("sync",this.onSync,this);this.on("error",this.onError,this)},parse:function parse(response){this.defaultProjectId=response.defaultProjectId;return PaginatedCollection.prototype.parse.call(this,response)},getQueryData:function getQueryData(){var options=PaginatedCollection.prototype.getQueryData.call(this);return _.extend(options,{nameContains:this._filter})},getFilter:function getFilter(){return this._filter},setFilter:function setFilter(val){this._filter=val},onRequest:function onRequest(){this.fetching=true},onSync:function onSync(){this.fetching=false},onError:function onError(){this.fetching=false}})});define("src/AppRouter",["backbone","jquery","q","src/storageProvider","src/globals/flags","src/permissions","src/globals/currentProject","src/globals/flagNames","src/events/appEvents","src/events/globalEventNames","src/views/navigation/localStorageKeys","src/models/ProjectSummaryCollection"],function(Backbone,$,Q,storageProvider,flags,permissions,currentProject,FLAGS,appEvents,globalEventNames,navigationLocalStorageKeys,ProjectSummaryCollection){"use strict";function cleanupRoute(router,name){if(router[name]){router[name].unload();router[name]=null}}function requireAsPromise(paths){return new Q.Promise(function(resolve,reject){require(paths,resolve,reject)})}var AppRouter=Backbone.Router.extend({initialize:function initialize(){this.on("route",this.onRouteChanged)},routes:function(){return{"":"reRouteToHomepage","project/:id/homepage":"routeHomepage","project/:id/quickSearch":"routeQuickSearch","project/:id(/)(?*splat)":"reRouteToDashboardList","project/:id/dashboards":"routeDashboardList","project/:id/dashboards/new/*splat":"routeDefaultDashboard","project/:projectId/dashboards/:id":"routeDashboard","project/:id/data":"routeProjectData","project/:id/data/queries":"routeProjectQueries","project/:id/data/channels":"routeProjectChannels","project/:id/data/groups":"routeProjectDataGroups","project/:id/data/logoqueries":"routeProjectLogoQueries","project/:id/queries":"routeProjectQueries","project/:id/queries/groups":"routeProjectDataGroups","project/:id/tools":"routeProjectTools","project/:id/tools/sitelists":"routeSiteLists","project/:id/tools/locationlists":"routeLocationLists","project/:id/tools/authorlists":"routeAuthorLists","project/:id/tools/categories":"routeCategoriesLists","project/:id/tools/tags":"routeTagsLists","project/:id/tools/rules":"routeRules","project/:id/tools/downloads":"routeDownloads","project/:id/tools/mentionfinder":"routeMentionChecker","project/:id/alerts":"routeAlerts","project/:id/alerts/signals":"routeSignalsGroups","project/:id/alerts/custom":"routeAlertsList",administration:"routeAdmin","administration/main":"routeAdmin","administration/projects":"routeAdminProjects","administration/accountinfo":"routeUsageSummary","administration/users":"routeUserManagement","administration/coverage":"routeCoverageManagement","administration/hashtags":"routeHashtagsManagement","*splat":"routeNotFound"}}(),unload:function unload(){this.cleanup()},cleanup:function cleanup(){this.off();if(flags.variation(FLAGS.ENABLE_HOMEPAGE)){cleanupRoute(this,"homepageRoute");cleanupRoute(this,"noProjectsRoute")}else{cleanupRoute(this,"projectSelectionRoute")}cleanupRoute(this,"dataSourceRoute");cleanupRoute(this,"projectToolsRoute");cleanupRoute(this,"alertsRoute");cleanupRoute(this,"signalsRoute");cleanupRoute(this,"dashboardListRoute");cleanupRoute(this,"dashboardRoute");cleanupRoute(this,"adminRoute")},canHandle:function canHandle(href){return href&&(href==="/"||href.indexOf("/project/")===0||href.indexOf("/administration/")===0)},reload:function reload(){window.location="/"},home:function home(){this.navigate("/",{trigger:true})},routeNotFound:function routeNotFound(){$.notify({text:"Not Found",className:"notification-error"});this.navigate("/",{trigger:true})},routeQuickSearch:function routeQuickSearch(projectId){var self=this;if(self.quickSearchRoute){return self.quickSearchRoute.load()}return requireAsPromise(["src/routes/quickSearchRoute"]).then(function(quickSearchRoute){self.quickSearchRoute=quickSearchRoute;quickSearchRoute.load(projectId)})},routeHomepage:function routeHomepage(projectId){var _this=this;if(!flags.variation(FLAGS.ENABLE_HOMEPAGE)){return this.routeProjectSelection()}if(this.homepageRoute){return this.homepageRoute.load(projectId)}return requireAsPromise(["src/routes/homepageRoute"]).then(function(homepageRoute){_this.homepageRoute=homepageRoute;homepageRoute.load(projectId)})},reRouteToHomepage:function reRouteToHomepage(){var _this2=this;if(!flags.variation(FLAGS.ENABLE_HOMEPAGE)){return this.routeProjectSelection()}new ProjectSummaryCollection(undefined,{pagination:false}).fetch({success:function success(collection){if(!collection.length){return flags.variation(FLAGS.ENABLE_HOMEPAGE)?_this2.routeNoProjects(false):_this2.routeProjectSelection()}var lastUsedProjectId=(storageProvider.get("currentProject")||{}).id;var targetProjectId=lastUsedProjectId||collection.defaultProjectId;var targetProject=collection.get(targetProjectId)||collection.at(0);_this2.navigate("/project/".concat(targetProject.id,"/homepage"),{trigger:true})},error:function error(){if(flags.variation(FLAGS.ENABLE_HOMEPAGE)){_this2.routeNoProjects(true)}else{_this2.routeProjectSelection()}}})},routeProjectSelection:function routeProjectSelection(){var self=this;if(self.projectSelectionRoute){return self.projectSelectionRoute.load()}return requireAsPromise(["src/routes/projectSelectionRoute"]).then(function(projectSelectionRoute){self.projectSelectionRoute=projectSelectionRoute;projectSelectionRoute.load()})},routeNoProjects:function routeNoProjects(loadingError){var self=this;if(self.noProjectsRoute){return self.noProjectsRoute.load(loadingError)}return requireAsPromise(["src/routes/noProjectsRoute"]).then(function(noProjectsRoute){self.noProjectsRoute=noProjectsRoute;noProjectsRoute.load(loadingError)})},_loadDataSourcePage:function _loadDataSourcePage(){var appRouter=this;if(appRouter.dataSourceRoute){return Q.resolve(appRouter.dataSourceRoute)}return requireAsPromise(["src/routes/dataSourceRoute"]).then(function(dataSourceRoute){appRouter.dataSourceRoute=dataSourceRoute;return dataSourceRoute})},routeProjectData:function routeProjectData(projectId){return this._loadDataSourcePage().then(function(dataSourceRoute){dataSourceRoute.loadLandingPage(projectId)})},routeProjectQueries:function routeProjectQueries(projectId){return this._loadDataSourcePage().then(function(dataSourceRoute){dataSourceRoute.loadQueries(projectId)})},routeProjectDataGroups:function routeProjectDataGroups(projectId){return this._loadDataSourcePage().then(function(dataSourceRoute){dataSourceRoute.loadDataGroups(projectId)})},routeProjectLogoQueries:function routeProjectLogoQueries(projectId){return this._loadDataSourcePage().then(function(dataSourceRoute){dataSourceRoute.loadLogoQueries(projectId)})},routeProjectChannels:function routeProjectChannels(projectId){return this._loadDataSourcePage().then(function(dataSourceRoute){dataSourceRoute.loadChannels(projectId)})},_loadAdminPage:function _loadAdminPage(){var appRouter=this;if(appRouter.adminRoute){return Q.resolve(appRouter.adminRoute)}return requireAsPromise(["src/routes/adminRoute"]).then(function(adminRoute){appRouter.adminRoute=adminRoute;return adminRoute})},routeAdmin:function routeAdmin(){if(!permissions.check("see.adminPage")){return Q.resolve(this.routeNotFound())}return this._loadAdminPage().then(function(adminRoute){return adminRoute.loadLandingPage()})},routeAdminProjects:function routeAdminProjects(){if(!permissions.check("see.adminPage")){return Q.resolve(this.routeNotFound())}if(flags.variation(FLAGS.ENABLE_ENTERPRISE_ADMIN)){return Q.resolve()}return this._loadAdminPage().then(function(adminRoute){return adminRoute.loadProjects()})},routeUsageSummary:function routeUsageSummary(){if(!permissions.check("see.adminPage")){return Q.resolve(this.routeNotFound())}if(flags.variation(FLAGS.ENABLE_ENTERPRISE_ADMIN)){return Q.resolve()}return this._loadAdminPage().then(function(adminRoute){return adminRoute.loadUsageSummary()})},routeUserManagement:function routeUserManagement(){if(!permissions.check("edit.client.users")){return Q.resolve(this.routeNotFound())}if(flags.variation(FLAGS.ENABLE_ENTERPRISE_ADMIN)){return Q.resolve()}return this._loadAdminPage().then(function(adminRoute){return adminRoute.loadUserManagement()})},routeCoverageManagement:function routeCoverageManagement(){if(!permissions.check("edit.channels.coverage")){return Q.resolve(this.routeNotFound())}return this._loadAdminPage().then(function(adminRoute){return adminRoute.loadCoverageManagement()})},routeHashtagsManagement:function routeHashtagsManagement(){if(!(permissions.check("edit.channels.coverage")&&flags.variation(FLAGS.ENABLE_INSTAGRAM_HASHTAGS)&&!flags.variation(FLAGS.HIDE_FB_AND_INSTAGRAM_SETUP))){return Promise.resolve(this.routeNotFound())}return this._loadAdminPage().then(function(adminRoute){return adminRoute.loadHashtagsManagement()})},_loadProjectToolsPage:function _loadProjectToolsPage(){var appRouter=this;if(appRouter.projectToolsRoute){return Q.resolve(appRouter.projectToolsRoute)}return requireAsPromise(["src/routes/projectToolsRoute"]).then(function(projectToolsRoute){appRouter.projectToolsRoute=projectToolsRoute;return projectToolsRoute})},routeProjectTools:function routeProjectTools(projectId){return this._loadProjectToolsPage().then(function(projectToolsRoute){return projectToolsRoute.loadLandingPage(projectId)})},routeSiteLists:function routeSiteLists(projectId){return this._loadProjectToolsPage().then(function(projectToolsRoute){return projectToolsRoute.loadSiteLists(projectId)})},routeLocationLists:function routeLocationLists(projectId){return this._loadProjectToolsPage().then(function(projectToolsRoute){return projectToolsRoute.loadLocationLists(projectId)})},routeAuthorLists:function routeAuthorLists(projectId){return this._loadProjectToolsPage().then(function(projectToolsRoute){return projectToolsRoute.loadAuthorLists(projectId)})},routeCategoriesLists:function routeCategoriesLists(projectId){return this._loadProjectToolsPage().then(function(projectToolsRoute){return projectToolsRoute.loadCategoriesLists(projectId)})},routeTagsLists:function routeTagsLists(projectId){return this._loadProjectToolsPage().then(function(projectToolsRoute){return projectToolsRoute.loadTagsLists(projectId)})},routeRules:function routeRules(projectId){return this._loadProjectToolsPage().then(function(projectToolsRoute){return projectToolsRoute.loadRules(projectId)})},routeDownloads:function routeDownloads(projectId){return this._loadProjectToolsPage().then(function(projectToolsRoute){return projectToolsRoute.loadDownloads(projectId)})},routeMentionChecker:function routeMentionChecker(projectId){return this._loadProjectToolsPage().then(function(projectToolsRoute){return projectToolsRoute.loadMentionChecker(projectId)})},_loadAlertsPage:function _loadAlertsPage(){var appRouter=this;if(appRouter.alertsRoute){return Q.resolve(appRouter.alertsRoute)}return requireAsPromise(["src/routes/alertsRoute"]).then(function(alertsRoute){appRouter.alertsRoute=alertsRoute;return alertsRoute})},_loadSignalsPage:function _loadSignalsPage(){var appRouter=this;if(appRouter.signalsRoute){return Q.resolve(appRouter.signalsRoute)}return requireAsPromise(["src/routes/signalsRoute"]).then(function(signalsRoute){appRouter.signalsRoute=signalsRoute;return signalsRoute})},routeAlerts:function routeAlerts(projectId){var _this3=this;return this._loadAlertsPage().then(function(){if(permissions.check("see.signals")){return _this3.routeSignalsGroups(projectId)}return _this3.routeAlertsList(projectId)})},routeSignalsGroups:function routeSignalsGroups(projectId){if(!permissions.check("see.signals")){return Q.resolve(this.routeNotFound())}return this._loadSignalsPage().then(function(signalsRoute){signalsRoute.loadSignalsGroupList(projectId)})},routeAlertsList:function routeAlertsList(projectId){return this._loadAlertsPage().then(function(alertsRoute){alertsRoute.load(projectId)})},reRouteToDashboardList:function reRouteToDashboardList(projectId){if(flags.variation(FLAGS.ENABLE_HOMEPAGE)&&!window.location.href.includes("dashboards")){return this.navigate("/project/".concat(projectId,"/homepage"),{trigger:true})}return this.routeDashboardList(projectId)},routeDashboardList:function routeDashboardList(projectId){var appRouter=this;if(appRouter.dashboardListRoute){return appRouter.dashboardListRoute.loadDashboardList(projectId)}return requireAsPromise(["src/routes/dashboardListRoute"]).then(function(dashboardListRoute){appRouter.dashboardListRoute=dashboardListRoute;return dashboardListRoute.loadDashboardList(projectId)})},_loadDashboardPage:function _loadDashboardPage(){var appRouter=this;if(appRouter.dashboardRoute){return Q.resolve(appRouter.dashboardRoute)}return requireAsPromise(["src/routes/dashboardRoute"]).then(function(dashboardRoute){appRouter.dashboardRoute=dashboardRoute;return dashboardRoute})},routeDefaultDashboard:function routeDefaultDashboard(projectId){return this._loadDashboardPage().then(function(dashboardRoute){return dashboardRoute.loadDefaultDashboard(projectId)})},routeDashboard:function routeDashboard(projectId,id){return this._loadDashboardPage().then(function(dashboardRoute){return dashboardRoute.loadDashboard(projectId,id)})},loadDashboardFromTemplate:function loadDashboardFromTemplate(args){return this._loadDashboardPage().then(function(dashboardRoute){return dashboardRoute.loadDashboardFromTemplate(args)})},navigateBackToDashboard:function navigateBackToDashboard(){var app=this;return this._loadDashboardPage().then(function(dashboardRoute){var dashboardView=dashboardRoute.dashboardView,model=dashboardView.model;app.navigateToDashboard(model.get("projectId"),model.id,dashboardView.currentTab.model.id,{trigger:false})})},navigateToDashboard:function navigateToDashboard(projectId,dashboardId,tabId,options){var app=this;return this._loadDashboardPage().then(function(dashboardRoute){app.navigate(dashboardRoute.buildDashboardUrl(projectId,dashboardId,tabId),options)})},isInProject:function isInProject(fragment){var projectId=currentProject?currentProject.id:"undefined",regExp=new RegExp("\\/?project/"+projectId+"\\/.+");return regExp.test(fragment)},getDashboardsUrl:function getDashboardsUrl(){return"/project/"+currentProject.id+"/dashboards"},getDashboardUrl:function getDashboardUrl(dashboard){return"/project/"+currentProject.id+"/dashboards/"+dashboard.id},onRouteChanged:function onRouteChanged(route){this.routeChanged(route);appEvents.trigger(globalEventNames.APP.NAVIGATED,{route:route,fragment:Backbone.history.fragment,navigationCollapsed:storageProvider.get(navigationLocalStorageKeys.NAVIGATION_COLLAPSED)})},routeChanged:function routeChanged(route){var self=this;if(this.dashboardRoute&&route!=="routeDashboard"){this.dashboardRoute.close(function(result){if(!result){self.navigateBackToDashboard();return}self.dashboardRoute.unload();self.dashboardRoute=undefined})}}});AppRouter.prototype.navigate=function(fragment,options){options=options||{};if(this.preventNavigate){return}var self=this,dashboardRoute=this.dashboardRoute;if(!dashboardRoute||options.trigger===false){return Backbone.history.navigate(fragment,options)}dashboardRoute.close(function(result){if(!result){return}self.dashboardRoute.unload();self.dashboardRoute=undefined;return Backbone.history.navigate(fragment,options)},options)};return AppRouter});define("src/events/projectEvents",["backbone","underscore"],function(Backbone,_){"use strict";return _.clone(Backbone.Events)});define("src/models/LegacyUsageSummary",["backbone"],function(Backbone){"use strict";return Backbone.Model.extend({url:"/usagereport/",getQueryData:function getQueryData(){return{clientId:this.get("clientid"),startDate:this.get("startDate")}},initialize:function initialize(options){var opts=options||{};if(!opts.clientid){throw new Error("LegacyUsageSummary requires clientid to be passed as an option")}this.set({clientid:opts.clientid});Backbone.Model.prototype.initialize.call(this,opts)}})});(function($){"use strict";function cleanUpTooltip($element){var tooltip=$element.data("tooltip"),tip;if(tooltip){tip=tooltip.getTip();if(tip){tip.remove()}$element.removeData("tooltip")}}$.fn.showInputValidation=function(message){var $input=$(this),validationTip=this.validationTip;if(!validationTip){validationTip=this.validationTip=$("<div>",{class:"validation-tip notification-error rounded smallpadding-vertical singlepadding-horizontal"})}if(!validationTip.parent().length){validationTip.appendTo("body")}$input.removeData("tooltip").attr("title",message).addClass("invalid").tooltip({position:"top center",offset:[-10,0],tip:".validation-tip",delay:0,events:{input:"mouseover, mouseout"}})};$.fn.hideValidation=function(){$(this).removeClass("invalid");cleanUpTooltip($(this))}})($);define("lib/jquery.showValidation",function(){});(function($){function isIE(){return $("html").hasClass("ie")}$.tools=$.tools||{version:"@VERSION"};$.tools.tooltip={conf:{effect:"toggle",fadeOutSpeed:"fast",predelay:0,delay:30,opacity:1,tip:0,fadeIE:false,position:["top","center"],offset:[0,0],relative:false,cancelDefault:true,events:{def:"mouseenter,mouseleave",input:"focus,blur",widget:"focus mouseenter,blur mouseleave",tooltip:"mouseenter,mouseleave"},layout:"<div/>",tipClass:"tooltip"},addEffect:function(name,loadFn,hideFn){effects[name]=[loadFn,hideFn]}};var effects={toggle:[function(done){var conf=this.getConf(),tip=this.getTip(),o=conf.opacity;if(o<1){tip.css({opacity:o})}tip.show();done.call()},function(done){this.getTip().hide();done.call()}],fade:[function(done){var conf=this.getConf();if(!isIE()||conf.fadeIE){this.getTip().fadeTo(conf.fadeInSpeed,conf.opacity,done)}else{this.getTip().show();done()}},function(done){var conf=this.getConf();if(!isIE()||conf.fadeIE){this.getTip().fadeOut(conf.fadeOutSpeed,done)}else{this.getTip().hide();done()}}]};function getPosition(trigger,tip,conf){var top=conf.relative?trigger.position().top:trigger.offset().top,left=conf.relative?trigger.position().left:trigger.offset().left,pos=conf.position[0];top-=tip.outerHeight()-conf.offset[0];left+=trigger.outerWidth()+conf.offset[1];if(/iPad/i.test(navigator.userAgent)){top-=$(window).scrollTop()}var height=tip.outerHeight()+trigger.outerHeight();if(pos=="center"){top+=height/2}if(pos=="bottom"){top+=height}pos=conf.position[1];var width=tip.outerWidth()+trigger.outerWidth();if(pos=="center"){left-=width/2}if(pos=="left"){left-=width}return{top:top,left:left}}function Tooltip(trigger,conf){var self=this,fire=trigger.add(self),tip,timer=0,pretimer=0,title=trigger.attr("title"),tipAttr=trigger.attr("data-tooltip"),effect=effects[conf.effect],shown,isInput=trigger.is(":input"),isWidget=isInput&&trigger.is(":checkbox, :radio, select, :button, :submit"),type=trigger.attr("type"),evt=conf.events[type]||conf.events[isInput?isWidget?"widget":"input":"def"];if(!effect){throw'Nonexistent effect "'+conf.effect+'"'}evt=evt.split(/,\s*/);if(evt.length!=2){throw"Tooltip: bad events configuration for "+type}trigger.on(evt[0],function(e){clearTimeout(timer);if(conf.predelay){pretimer=setTimeout(function(){self.show(e)},conf.predelay)}else{self.show(e)}}).on(evt[1],function(e){clearTimeout(pretimer);if(conf.delay){timer=setTimeout(function(){self.hide(e)},conf.delay)}else{self.hide(e)}});if(title&&conf.cancelDefault){trigger.removeAttr("title");trigger.data("title",title)}$.extend(self,{show:function(e){if(!tip){if(tipAttr){tip=$(tipAttr)}else if(conf.tip){tip=$(conf.tip).eq(0)}else if(title){tip=$(conf.layout).addClass(conf.tipClass).appendTo(document.body).hide().append(title)}else{tip=trigger.next();if(!tip.length){tip=trigger.parent().next()}}if(!tip.length){throw"Cannot find tooltip for "+trigger}}if(self.isShown()){return self}tip.stop(true,true);var pos=getPosition(trigger,tip,conf);if(conf.tip){tip.html(trigger.data("title"))}e=$.Event();e.type="onBeforeShow";fire.trigger(e,[pos]);if(e.isDefaultPrevented()){return self}pos=getPosition(trigger,tip,conf);tip.css({position:"absolute",top:pos.top,left:pos.left});shown=true;effect[0].call(self,function(){e.type="onShow";shown="full";fire.trigger(e)});var event=conf.events.tooltip.split(/,\s*/);if(!tip.data("__set")){tip.off(event[0]).on(event[0],function(){clearTimeout(timer);clearTimeout(pretimer)});if(event[1]&&!trigger.is("input:not(:checkbox, :radio), textarea")){tip.off(event[1]).on(event[1],function(e){if(e.relatedTarget!=trigger[0]){trigger.trigger(evt[1].split(" ")[0])}})}if(!conf.tip)tip.data("__set",true)}return self},hide:function(e){if(!tip||!self.isShown()){return self}e=$.Event();e.type="onBeforeHide";fire.trigger(e);if(e.isDefaultPrevented()){return}shown=false;effects[conf.effect][1].call(self,function(){e.type="onHide";fire.trigger(e)});return self},isShown:function(fully){return fully?shown=="full":shown},getConf:function(){return conf},getTip:function(){return tip},getTrigger:function(){return trigger}});$.each("onHide,onBeforeShow,onShow,onBeforeHide".split(","),function(i,name){if($.isFunction(conf[name])){$(self).on(name,conf[name])}self[name]=function(fn){if(fn){$(self).on(name,fn)}return self}})}$.fn.tooltip=function(conf){var api=this.data("tooltip");if(api){return api}conf=$.extend(true,{},$.tools.tooltip.conf,conf);if(typeof conf.position=="string"){conf.position=conf.position.split(/,?\s/)}this.each(function(){api=new Tooltip($(this),conf);$(this).data("tooltip",api)});return conf.api?api:this}})(jQuery);define("jquery-tools-tooltip",["jquery"],function(global){return function(){var ret,fn;return ret||global.jQuery.fn.tooltip}}(this));define("src/helpers/validationTooltipHelper",["underscore","jquery","lib/jquery.showValidation","jquery-tools-tooltip"],function(_,$){"use strict";function validationTooltipHelper(){var $validationTooltip,tooltipClasses=["validation-tip","notification-error","rounded","smallpadding-vertical","singlepadding-horizontal"].join(" ");function setupValidationTooltip(){if(!$validationTooltip){$validationTooltip=$("<div />").addClass(tooltipClasses)}if(!$validationTooltip.parent().length){$validationTooltip.appendTo("body")}}function getTooltip(){setupValidationTooltip();return $validationTooltip}function showError(error,$formElement){if(Array.isArray(error)){error=error.join(" ")}if(!error){return}setupValidationTooltip();$formElement.removeData("tooltip").attr("title",error).addClass("invalid").tooltip({position:"top center",offset:[-10,0],tip:".validation-tip",delay:0,events:{input:"mouseenter, mouseleave",widget:"mouseenter, mouseleave"}})}function hideError($formElement){$formElement.removeClass("invalid");detachTooltip($formElement)}function getInputEvents(conf){if(!conf||!conf.events||!conf.events.input){return"mouseenter mouseleave"}return conf.events.input.replace(/,\s*/," ")}function detachTooltip($formElement){var api=$formElement.data("tooltip");if(!api){return}var tip=api.getTip();var trigger=api.getTrigger();api.hide();if(tip){tip.off()}var inputEvents=getInputEvents(api.getConf());trigger.off(inputEvents);$formElement.removeData("tooltip")}function showErrorsForForm(errors,$form){errors=errors||{};$form.find("[name]").each(function(){var $el=$(this);var errorKey=_.camelize(this.getAttribute("name"));var error=errors[errorKey];hideError($el);showError(error,$el)})}return{showError:showError,hideError:hideError,getTooltip:getTooltip,showErrorsForForm:showErrorsForForm}}return validationTooltipHelper()});define("src/helpers/validationMessageHelper",["underscore"],function(_){"use strict";function getValidator(model,attributeName,customMessages){return function(attributeValue){var errors=model.validate(_.defaults(_.object([[attributeName,attributeValue]]),model.toJSON()));if(!errors){return}return formatErrors(attributeName,attributeValue,errors[attributeName],customMessages)}}function filterErrors(errors){errors=[].concat(errors||[]);if(_(errors).contains("required")){return["required"]}return errors}function filterErrorsByType(errors,selection){errors=[].concat(errors||[]);selection=[].concat(selection||[]);return _.intersection(filterErrors(errors),selection)}function isPlural(word){return _.endsWith(word,"s")}function translateError(attributeName,attributeValue,error){var plural=isPlural(attributeName),areIs=plural?"are":"is",wereWas=plural?"were":"was",friendlyName=_.capitalize(attributeName);switch(error){case"required":return friendlyName+" "+areIs+" required";case"minlength":return friendlyName+" "+areIs+" shorter than required";case"maxlength":return friendlyName+" "+areIs+" longer than permitted";case"pattern":return friendlyName+" "+wereWas+" in an invalid format";case"email":return attributeValue+" "+areIs+" not a valid email address";case"invalidchar":return"Please do not use backslashes or double quotes";default:return error}}function formatErrors(attributeName,attributeValue,errors,customMessages){customMessages=customMessages||{};errors=filterErrors(errors);return _(errors).map(function(error){return customMessages["validationmessage"+error]||customMessages[error]||translateError(attributeName,attributeValue,error)}).join(", ")}return{getValidator:getValidator,filterErrorsByType:filterErrorsByType,formatErrors:formatErrors}});define("src/views/ValidatingFormView",["backbone","underscore","jquery","src/helpers/validationTooltipHelper","src/helpers/validationMessageHelper","src/ApiError","lib/jquery.showValidation","jquery-tools-tooltip"],function(Backbone,_,$,validationTooltipHelper,validationMessageHelper,ApiError){"use strict";function removeAsterisk(string){return string.split("*").join("").trim()}function findDataAttributes($input){return _($input.closest(".validation-wrapper").data()).chain().map(function(value,key){return{key:key.toLowerCase().replace(/-/g,""),value:value}}).reduce(function(memo,value){memo[value.key]=value.value;return memo},{}).value()}function getFriendlyErrors($input,suppliedValue,errors){errors=[].concat(errors);var name=removeAsterisk($input.siblings("label").text()),dataAttributes=findDataAttributes($input);return validationMessageHelper.formatErrors(name,suppliedValue,errors,dataAttributes)}return Backbone.View.extend({initialize:function initialize(){this.model.on("invalid",this.onModelError,this)},remove:function remove(){this.cleanupTooltip();this.model.off("invalid",this.onModelError,this);Backbone.View.prototype.remove.call(this)},showInputValidation:function showInputValidation($input,errors){var val=$input.val(),name=$input.attr("data-validation-modelkey")||$input.attr("name"),type=$input.attr("type")||"text",$wrapper=$input.closest(".validation-wrapper"),attrs={},message,filteredInput;this.validationTip=validationTooltipHelper.getTooltip();if(type==="checkbox"){filteredInput=$input.filter(":checked");val=$input.length===1?filteredInput.val():_(filteredInput).map(function(el){return $(el).val()});if(val&&val.length===0){val=undefined}}attrs[name]=val;if(!errors){errors=this.model.validate({attributes:attrs})}if(errors&&errors[name]){message=errors[name].message||getFriendlyErrors($input,val,errors[name]);validationTooltipHelper.showError(message,$wrapper)}},onServerError:function onServerError(model,response){var error=new ApiError(response),errorMessages=[];this.$("[name]").each(function(){$(this).hideValidation()});if(error.message){errorMessages.push(error.message)}else{errorMessages.push("There was an error saving")}this.showErrors(errorMessages)},onModelError:function onModelError(model,errors){var self=this;this.hideErrors();_(errors).chain().keys().unique().each(function(modelkey){self.showInputValidation(self.$('[name="'+modelkey+'"],[data-validation-modelkey="'+modelkey+'"]'),errors)})},showErrors:function showErrors(errorMessages){var errorPane=this.$(".errorPane"),lis=_([].concat(errorMessages)).map(function(err){return"<li>"+err+"</li>"});if(!errorPane.length){console.warn("No error pane");return}this.$el.addClass("invalid");errorPane.removeClass("hidden").html("<ul>"+lis.join("")+"</ul>")},hideErrors:function hideErrors(){if(this.validationTip){this.validationTip.hide()}this.$el.removeClass("invalid");this.$(".errorPane").addClass("hidden").text("");this.$(".validation-wrapper.invalid").each(function(){validationTooltipHelper.hideError($(this))})},hideError:function hideError($element){validationTooltipHelper.hideError($element)},removeTooltip:function removeTooltip($element){validationTooltipHelper.removeTooltip($element)},cleanupTooltip:function cleanupTooltip(){if(this.validationTip&&_.isFunction(this.validationTip.remove)){this.validationTip.remove();delete this.validationTip}}})});(function(){if(typeof twttr==="undefined"||twttr===null){var twttr={}}twttr.txt={};twttr.txt.regexen={};var HTML_ENTITIES={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#39;"};twttr.txt.htmlEscape=function(text){return text&&text.replace(/[&"'><]/g,function(character){return HTML_ENTITIES[character]})};function regexSupplant(regex,flags){flags=flags||"";if(typeof regex!=="string"){if(regex.global&&flags.indexOf("g")<0){flags+="g"}if(regex.ignoreCase&&flags.indexOf("i")<0){flags+="i"}if(regex.multiline&&flags.indexOf("m")<0){flags+="m"}regex=regex.source}return new RegExp(regex.replace(/#\{(\w+)\}/g,function(match,name){var newRegex=twttr.txt.regexen[name]||"";if(typeof newRegex!=="string"){newRegex=newRegex.source}return newRegex}),flags)}twttr.txt.regexSupplant=regexSupplant;function stringSupplant(str,values){return str.replace(/#\{(\w+)\}/g,function(match,name){return values[name]||""})}twttr.txt.stringSupplant=stringSupplant;function addCharsToCharClass(charClass,start,end){var s=String.fromCharCode(start);if(end!==start){s+="-"+String.fromCharCode(end)}charClass.push(s);return charClass}twttr.txt.addCharsToCharClass=addCharsToCharClass;var fromCode=String.fromCharCode;var UNICODE_SPACES=[fromCode(32),fromCode(133),fromCode(160),fromCode(5760),fromCode(6158),fromCode(8232),fromCode(8233),fromCode(8239),fromCode(8287),fromCode(12288)];addCharsToCharClass(UNICODE_SPACES,9,13);addCharsToCharClass(UNICODE_SPACES,8192,8202);var INVALID_CHARS=[fromCode(65534),fromCode(65279),fromCode(65535)];addCharsToCharClass(INVALID_CHARS,8234,8238);twttr.txt.regexen.spaces_group=regexSupplant(UNICODE_SPACES.join(""));twttr.txt.regexen.spaces=regexSupplant("["+UNICODE_SPACES.join("")+"]");twttr.txt.regexen.invalid_chars_group=regexSupplant(INVALID_CHARS.join(""));twttr.txt.regexen.punct=/\!'#%&'\(\)*\+,\\\-\.\/:;<=>\?@\[\]\^_{|}~\$/;twttr.txt.regexen.rtl_chars=/[\u0600-\u06FF]|[\u0750-\u077F]|[\u0590-\u05FF]|[\uFE70-\uFEFF]/gm;twttr.txt.regexen.non_bmp_code_pairs=/[\uD800-\uDBFF][\uDC00-\uDFFF]/gm;var latinAccentChars=[];addCharsToCharClass(latinAccentChars,192,214);addCharsToCharClass(latinAccentChars,216,246);addCharsToCharClass(latinAccentChars,248,255);addCharsToCharClass(latinAccentChars,256,591);addCharsToCharClass(latinAccentChars,595,596);addCharsToCharClass(latinAccentChars,598,599);addCharsToCharClass(latinAccentChars,601,601);addCharsToCharClass(latinAccentChars,603,603);addCharsToCharClass(latinAccentChars,611,611);addCharsToCharClass(latinAccentChars,616,616);addCharsToCharClass(latinAccentChars,623,623);addCharsToCharClass(latinAccentChars,626,626);addCharsToCharClass(latinAccentChars,649,649);addCharsToCharClass(latinAccentChars,651,651);addCharsToCharClass(latinAccentChars,699,699);addCharsToCharClass(latinAccentChars,768,879);addCharsToCharClass(latinAccentChars,7680,7935);twttr.txt.regexen.latinAccentChars=regexSupplant(latinAccentChars.join(""));var unicodeLettersAndMarks=/A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B2\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08E4-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C03\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D01-\u0D03\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u18A9\u1920-\u192B\u1930-\u193B\u19B0-\u19C0\u19C8\u19C9\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF8\u1CF9\u1DC0-\u1DF5\u1DFC-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C4\uA8E0-\uA8F1\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2D/.source;var unicodeNumbers=/0-9\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0BE6-\u0BEF\u0C66-\u0C6F\u0CE6-\u0CEF\u0D66-\u0D6F\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F29\u1040-\u1049\u1090-\u1099\u17E0-\u17E9\u1810-\u1819\u1946-\u194F\u19D0-\u19D9\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\uA620-\uA629\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19/.source;var hashtagSpecialChars=/_\u200c\u200d\ua67e\u05be\u05f3\u05f4\uff5e\u301c\u309b\u309c\u30a0\u30fb\u3003\u0f0b\u0f0c\u00b7/.source;twttr.txt.regexen.hashSigns=/[#]/;twttr.txt.regexen.hashtagAlpha=new RegExp("["+unicodeLettersAndMarks+"]");twttr.txt.regexen.hashtagAlphaNumeric=new RegExp("["+unicodeLettersAndMarks+unicodeNumbers+hashtagSpecialChars+"]");twttr.txt.regexen.endHashtagMatch=regexSupplant(/^(?:#{hashSigns}|:\/\/)/);twttr.txt.regexen.hashtagBoundary=new RegExp("(?:^|$|[^&"+unicodeLettersAndMarks+unicodeNumbers+hashtagSpecialChars+"])");twttr.txt.regexen.validHashtag=regexSupplant(/(#{hashtagBoundary})(#{hashSigns})(?!\ufe0f|\u20e3)(#{hashtagAlphaNumeric}*#{hashtagAlpha}#{hashtagAlphaNumeric}*)/gi);twttr.txt.regexen.validMentionPrecedingChars=/(?:^|[^a-zA-Z0-9_!#$%&*@]|(?:^|[^a-zA-Z0-9_+~.-])(?:rt|RT|rT|Rt):?)/;twttr.txt.regexen.atSigns=/[@]/;twttr.txt.regexen.validMentionOrList=regexSupplant("(#{validMentionPrecedingChars})"+"(#{atSigns})"+"([a-zA-Z0-9_]{1,20})"+"(/[a-zA-Z][a-zA-Z0-9_-]{0,24})?","g");twttr.txt.regexen.validReply=regexSupplant(/^(?:#{spaces})*#{atSigns}([a-zA-Z0-9_]{1,20})/);twttr.txt.regexen.endMentionMatch=regexSupplant(/^(?:#{atSigns}|[#{latinAccentChars}]|:\/\/)/);twttr.txt.regexen.validUrlPrecedingChars=regexSupplant(/(?:[^A-Za-z0-9@$##{invalid_chars_group}]|^)/);twttr.txt.regexen.invalidUrlWithoutProtocolPrecedingChars=/[-_.\/]$/;twttr.txt.regexen.invalidDomainChars=stringSupplant("#{punct}#{spaces_group}#{invalid_chars_group}",twttr.txt.regexen);twttr.txt.regexen.validDomainChars=regexSupplant(/[^#{invalidDomainChars}]/);twttr.txt.regexen.validSubdomain=regexSupplant(/(?:(?:#{validDomainChars}(?:[_-]|#{validDomainChars})*)?#{validDomainChars}\.)/);twttr.txt.regexen.validDomainName=regexSupplant(/(?:(?:#{validDomainChars}(?:-|#{validDomainChars})*)?#{validDomainChars}\.)/);twttr.txt.regexen.validGTLD=regexSupplant(RegExp("(?:(?:"+"abb|abbott|abogado|academy|accenture|accountant|accountants|aco|active|actor|ads|adult|aeg|aero|"+"afl|agency|aig|airforce|airtel|allfinanz|alsace|amsterdam|android|apartments|app|aquarelle|"+"archi|army|arpa|asia|associates|attorney|auction|audio|auto|autos|axa|azure|band|bank|bar|"+"barcelona|barclaycard|barclays|bargains|bauhaus|bayern|bbc|bbva|bcn|beer|bentley|berlin|best|"+"bet|bharti|bible|bid|bike|bing|bingo|bio|biz|black|blackfriday|bloomberg|blue|bmw|bnl|"+"bnpparibas|boats|bond|boo|boots|boutique|bradesco|bridgestone|broker|brother|brussels|budapest|"+"build|builders|business|buzz|bzh|cab|cafe|cal|camera|camp|cancerresearch|canon|capetown|capital|"+"caravan|cards|care|career|careers|cars|cartier|casa|cash|casino|cat|catering|cba|cbn|ceb|center|"+"ceo|cern|cfa|cfd|chanel|channel|chat|cheap|chloe|christmas|chrome|church|cisco|citic|city|"+"claims|cleaning|click|clinic|clothing|cloud|club|coach|codes|coffee|college|cologne|com|"+"commbank|community|company|computer|condos|construction|consulting|contractors|cooking|cool|"+"coop|corsica|country|coupons|courses|credit|creditcard|cricket|crown|crs|cruises|cuisinella|"+"cymru|cyou|dabur|dad|dance|date|dating|datsun|day|dclk|deals|degree|delivery|delta|democrat|"+"dental|dentist|desi|design|dev|diamonds|diet|digital|direct|directory|discount|dnp|docs|dog|"+"doha|domains|doosan|download|drive|durban|dvag|earth|eat|edu|education|email|emerck|energy|"+"engineer|engineering|enterprises|epson|equipment|erni|esq|estate|eurovision|eus|events|everbank|"+"exchange|expert|exposed|express|fage|fail|faith|family|fan|fans|farm|fashion|feedback|film|"+"finance|financial|firmdale|fish|fishing|fit|fitness|flights|florist|flowers|flsmidth|fly|foo|"+"football|forex|forsale|forum|foundation|frl|frogans|fund|furniture|futbol|fyi|gal|gallery|game|"+"garden|gbiz|gdn|gent|genting|ggee|gift|gifts|gives|giving|glass|gle|global|globo|gmail|gmo|gmx|"+"gold|goldpoint|golf|goo|goog|google|gop|gov|graphics|gratis|green|gripe|group|guge|guide|"+"guitars|guru|hamburg|hangout|haus|healthcare|help|here|hermes|hiphop|hitachi|hiv|hockey|"+"holdings|holiday|homedepot|homes|honda|horse|host|hosting|hoteles|hotmail|house|how|hsbc|ibm|"+"icbc|ice|icu|ifm|iinet|immo|immobilien|industries|infiniti|info|ing|ink|institute|insure|int|"+"international|investments|ipiranga|irish|ist|istanbul|itau|iwc|java|jcb|jetzt|jewelry|jlc|jll|"+"jobs|joburg|jprs|juegos|kaufen|kddi|kim|kitchen|kiwi|koeln|komatsu|krd|kred|kyoto|lacaixa|"+"lancaster|land|lasalle|lat|latrobe|law|lawyer|lds|lease|leclerc|legal|lexus|lgbt|liaison|lidl|"+"life|lighting|limited|limo|link|live|lixil|loan|loans|lol|london|lotte|lotto|love|ltda|lupin|"+"luxe|luxury|madrid|maif|maison|man|management|mango|market|marketing|markets|marriott|mba|media|"+"meet|melbourne|meme|memorial|men|menu|miami|microsoft|mil|mini|mma|mobi|moda|moe|mom|monash|"+"money|montblanc|mormon|mortgage|moscow|motorcycles|mov|movie|movistar|mtn|mtpc|museum|nadex|"+"nagoya|name|navy|nec|net|netbank|network|neustar|new|news|nexus|ngo|nhk|nico|ninja|nissan|nokia|"+"nra|nrw|ntt|nyc|office|okinawa|omega|one|ong|onl|online|ooo|oracle|orange|org|organic|osaka|"+"otsuka|ovh|page|panerai|paris|partners|parts|party|pet|pharmacy|philips|photo|photography|"+"photos|physio|piaget|pics|pictet|pictures|pink|pizza|place|play|plumbing|plus|pohl|poker|porn|"+"post|praxi|press|pro|prod|productions|prof|properties|property|pub|qpon|quebec|racing|realtor|"+"realty|recipes|red|redstone|rehab|reise|reisen|reit|ren|rent|rentals|repair|report|republican|"+"rest|restaurant|review|reviews|rich|ricoh|rio|rip|rocks|rodeo|rsvp|ruhr|run|ryukyu|saarland|"+"sakura|sale|samsung|sandvik|sandvikcoromant|sanofi|sap|sarl|saxo|sca|scb|schmidt|scholarships|"+"school|schule|schwarz|science|scor|scot|seat|seek|sener|services|sew|sex|sexy|shiksha|shoes|"+"show|shriram|singles|site|ski|sky|skype|sncf|soccer|social|software|sohu|solar|solutions|sony|"+"soy|space|spiegel|spreadbetting|srl|starhub|statoil|studio|study|style|sucks|supplies|supply|"+"support|surf|surgery|suzuki|swatch|swiss|sydney|systems|taipei|tatamotors|tatar|tattoo|tax|taxi|"+"team|tech|technology|tel|telefonica|temasek|tennis|thd|theater|tickets|tienda|tips|tires|tirol|"+"today|tokyo|tools|top|toray|toshiba|tours|town|toyota|toys|trade|trading|training|travel|trust|"+"tui|ubs|university|uno|uol|vacations|vegas|ventures|vermgensberater|vermgensberatung|"+"versicherung|vet|viajes|video|villas|vin|vision|vista|vistaprint|vlaanderen|vodka|vote|voting|"+"voto|voyage|wales|walter|wang|watch|webcam|website|wed|wedding|weir|whoswho|wien|wiki|"+"williamhill|win|windows|wine|wme|work|works|world|wtc|wtf|xbox|xerox|xin|xperia|xxx|xyz|yachts|"+"yandex|yodobashi|yoga|yokohama|youtube|zip|zone|zuerich|||||||||"+"||||||||||||||||||||||||||"+"||||||||||||||||||||||||||onion"+")(?=[^0-9a-zA-Z@]|$))"));twttr.txt.regexen.validCCTLD=regexSupplant(RegExp("(?:(?:"+"ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bl|bm|bn|bo|bq|"+"br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cw|cx|cy|cz|de|dj|dk|dm|do|dz|"+"ec|ee|eg|eh|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|"+"gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|"+"la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mf|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|"+"my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|"+"rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|ss|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|"+"tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|um|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|za|zm|zw||"+"|||||||||||||||||"+"|||||||||||||||"+"||||||||||||"+")(?=[^0-9a-zA-Z@]|$))"));twttr.txt.regexen.validPunycode=regexSupplant(/(?:xn--[0-9a-z]+)/);twttr.txt.regexen.validSpecialCCTLD=regexSupplant(RegExp("(?:(?:co|tv)(?=[^0-9a-zA-Z@]|$))"));twttr.txt.regexen.validDomain=regexSupplant(/(?:#{validSubdomain}*#{validDomainName}(?:#{validGTLD}|#{validCCTLD}|#{validPunycode}))/);twttr.txt.regexen.validAsciiDomain=regexSupplant(/(?:(?:[\-a-z0-9#{latinAccentChars}]+)\.)+(?:#{validGTLD}|#{validCCTLD}|#{validPunycode})/gi);twttr.txt.regexen.invalidShortDomain=regexSupplant(/^#{validDomainName}#{validCCTLD}$/i);twttr.txt.regexen.validSpecialShortDomain=regexSupplant(/^#{validDomainName}#{validSpecialCCTLD}$/i);twttr.txt.regexen.validPortNumber=regexSupplant(/[0-9]+/);twttr.txt.regexen.cyrillicLettersAndMarks=regexSupplant(/\u0400-\u04FF/);twttr.txt.regexen.validGeneralUrlPathChars=regexSupplant(/[a-z#{cyrillicLettersAndMarks}0-9!\*';:=\+,\.\$\/%#\[\]\-_~@\|&#{latinAccentChars}]/i);twttr.txt.regexen.validUrlBalancedParens=regexSupplant("\\("+"(?:"+"#{validGeneralUrlPathChars}+"+"|"+"(?:"+"#{validGeneralUrlPathChars}*"+"\\("+"#{validGeneralUrlPathChars}+"+"\\)"+"#{validGeneralUrlPathChars}*"+")"+")"+"\\)","i");twttr.txt.regexen.validUrlPathEndingChars=regexSupplant(/[\+\-a-z#{cyrillicLettersAndMarks}0-9=_#\/#{latinAccentChars}]|(?:#{validUrlBalancedParens})/i);twttr.txt.regexen.validUrlPath=regexSupplant("(?:"+"(?:"+"#{validGeneralUrlPathChars}*"+"(?:#{validUrlBalancedParens}#{validGeneralUrlPathChars}*)*"+"#{validUrlPathEndingChars}"+")|(?:@#{validGeneralUrlPathChars}+/)"+")","i");twttr.txt.regexen.validUrlQueryChars=/[a-z0-9!?\*'@\(\);:&=\+\$\/%#\[\]\-_\.,~|]/i;twttr.txt.regexen.validUrlQueryEndingChars=/[a-z0-9_&=#\/]/i;twttr.txt.regexen.extractUrl=regexSupplant("("+"(#{validUrlPrecedingChars})"+"("+"(https?:\\/\\/)?"+"(#{validDomain})"+"(?::(#{validPortNumber}))?"+"(\\/#{validUrlPath}*)?"+"(\\?#{validUrlQueryChars}*#{validUrlQueryEndingChars})?"+")"+")","gi");twttr.txt.regexen.validTcoUrl=/^https?:\/\/t\.co\/[a-z0-9]+/i;twttr.txt.regexen.urlHasProtocol=/^https?:\/\//i;twttr.txt.regexen.urlHasHttps=/^https:\/\//i;twttr.txt.regexen.cashtag=/[a-z]{1,6}(?:[._][a-z]{1,2})?/i;twttr.txt.regexen.validCashtag=regexSupplant("(^|#{spaces})(\\$)(#{cashtag})(?=$|\\s|[#{punct}])","gi");twttr.txt.regexen.validateUrlUnreserved=/[a-z\u0400-\u04FF0-9\-._~]/i;twttr.txt.regexen.validateUrlPctEncoded=/(?:%[0-9a-f]{2})/i;twttr.txt.regexen.validateUrlSubDelims=/[!$&'()*+,;=]/i;twttr.txt.regexen.validateUrlPchar=regexSupplant("(?:"+"#{validateUrlUnreserved}|"+"#{validateUrlPctEncoded}|"+"#{validateUrlSubDelims}|"+"[:|@]"+")","i");twttr.txt.regexen.validateUrlScheme=/(?:[a-z][a-z0-9+\-.]*)/i;twttr.txt.regexen.validateUrlUserinfo=regexSupplant("(?:"+"#{validateUrlUnreserved}|"+"#{validateUrlPctEncoded}|"+"#{validateUrlSubDelims}|"+":"+")*","i");twttr.txt.regexen.validateUrlDecOctet=/(?:[0-9]|(?:[1-9][0-9])|(?:1[0-9]{2})|(?:2[0-4][0-9])|(?:25[0-5]))/i;twttr.txt.regexen.validateUrlIpv4=regexSupplant(/(?:#{validateUrlDecOctet}(?:\.#{validateUrlDecOctet}){3})/i);twttr.txt.regexen.validateUrlIpv6=/(?:\[[a-f0-9:\.]+\])/i;twttr.txt.regexen.validateUrlIp=regexSupplant("(?:"+"#{validateUrlIpv4}|"+"#{validateUrlIpv6}"+")","i");twttr.txt.regexen.validateUrlSubDomainSegment=/(?:[a-z0-9](?:[a-z0-9_\-]*[a-z0-9])?)/i;twttr.txt.regexen.validateUrlDomainSegment=/(?:[a-z0-9](?:[a-z0-9\-]*[a-z0-9])?)/i;twttr.txt.regexen.validateUrlDomainTld=/(?:[a-z](?:[a-z0-9\-]*[a-z0-9])?)/i;twttr.txt.regexen.validateUrlDomain=regexSupplant(/(?:(?:#{validateUrlSubDomainSegment]}\.)*(?:#{validateUrlDomainSegment]}\.)#{validateUrlDomainTld})/i);twttr.txt.regexen.validateUrlHost=regexSupplant("(?:"+"#{validateUrlIp}|"+"#{validateUrlDomain}"+")","i");twttr.txt.regexen.validateUrlUnicodeSubDomainSegment=/(?:(?:[a-z0-9]|[^\u0000-\u007f])(?:(?:[a-z0-9_\-]|[^\u0000-\u007f])*(?:[a-z0-9]|[^\u0000-\u007f]))?)/i;twttr.txt.regexen.validateUrlUnicodeDomainSegment=/(?:(?:[a-z0-9]|[^\u0000-\u007f])(?:(?:[a-z0-9\-]|[^\u0000-\u007f])*(?:[a-z0-9]|[^\u0000-\u007f]))?)/i;twttr.txt.regexen.validateUrlUnicodeDomainTld=/(?:(?:[a-z]|[^\u0000-\u007f])(?:(?:[a-z0-9\-]|[^\u0000-\u007f])*(?:[a-z0-9]|[^\u0000-\u007f]))?)/i;twttr.txt.regexen.validateUrlUnicodeDomain=regexSupplant(/(?:(?:#{validateUrlUnicodeSubDomainSegment}\.)*(?:#{validateUrlUnicodeDomainSegment}\.)#{validateUrlUnicodeDomainTld})/i);twttr.txt.regexen.validateUrlUnicodeHost=regexSupplant("(?:"+"#{validateUrlIp}|"+"#{validateUrlUnicodeDomain}"+")","i");twttr.txt.regexen.validateUrlPort=/[0-9]{1,5}/;twttr.txt.regexen.validateUrlUnicodeAuthority=regexSupplant("(?:(#{validateUrlUserinfo})@)?"+"(#{validateUrlUnicodeHost})"+"(?::(#{validateUrlPort}))?","i");twttr.txt.regexen.validateUrlAuthority=regexSupplant("(?:(#{validateUrlUserinfo})@)?"+"(#{validateUrlHost})"+"(?::(#{validateUrlPort}))?","i");twttr.txt.regexen.validateUrlPath=regexSupplant(/(\/#{validateUrlPchar}*)*/i);twttr.txt.regexen.validateUrlQuery=regexSupplant(/(#{validateUrlPchar}|\/|\?)*/i);twttr.txt.regexen.validateUrlFragment=regexSupplant(/(#{validateUrlPchar}|\/|\?)*/i);twttr.txt.regexen.validateUrlUnencoded=regexSupplant("^"+"(?:"+"([^:/?#]+):\\/\\/"+")?"+"([^/?#]*)"+"([^?#]*)"+"(?:"+"\\?([^#]*)"+")?"+"(?:"+"#(.*)"+")?$","i");var DEFAULT_LIST_CLASS="tweet-url list-slug";var DEFAULT_USERNAME_CLASS="tweet-url username";var DEFAULT_HASHTAG_CLASS="tweet-url hashtag";var DEFAULT_CASHTAG_CLASS="tweet-url cashtag";var OPTIONS_NOT_ATTRIBUTES={urlClass:true,listClass:true,usernameClass:true,hashtagClass:true,cashtagClass:true,usernameUrlBase:true,listUrlBase:true,hashtagUrlBase:true,cashtagUrlBase:true,usernameUrlBlock:true,listUrlBlock:true,hashtagUrlBlock:true,linkUrlBlock:true,usernameIncludeSymbol:true,suppressLists:true,suppressNoFollow:true,targetBlank:true,suppressDataScreenName:true,urlEntities:true,symbolTag:true,textWithSymbolTag:true,urlTarget:true,invisibleTagAttrs:true,linkAttributeBlock:true,linkTextBlock:true,htmlEscapeNonEntities:true};var BOOLEAN_ATTRIBUTES={disabled:true,readonly:true,multiple:true,checked:true};function clone(o){var r={};for(var k in o){if(o.hasOwnProperty(k)){r[k]=o[k]}}return r}twttr.txt.tagAttrs=function(attributes){var htmlAttrs="";for(var k in attributes){var v=attributes[k];if(BOOLEAN_ATTRIBUTES[k]){v=v?k:null}if(v==null)continue;htmlAttrs+=" "+twttr.txt.htmlEscape(k)+'="'+twttr.txt.htmlEscape(v.toString())+'"'}return htmlAttrs};twttr.txt.linkToText=function(entity,text,attributes,options){if(!options.suppressNoFollow){attributes.rel="nofollow"}if(options.linkAttributeBlock){options.linkAttributeBlock(entity,attributes)}if(options.linkTextBlock){text=options.linkTextBlock(entity,text)}var d={text:text,attr:twttr.txt.tagAttrs(attributes)};return stringSupplant("<a#{attr}>#{text}</a>",d)};twttr.txt.linkToTextWithSymbol=function(entity,symbol,text,attributes,options){var taggedSymbol=options.symbolTag?"<"+options.symbolTag+">"+symbol+"</"+options.symbolTag+">":symbol;text=twttr.txt.htmlEscape(text);var taggedText=options.textWithSymbolTag?"<"+options.textWithSymbolTag+">"+text+"</"+options.textWithSymbolTag+">":text;if(options.usernameIncludeSymbol||!symbol.match(twttr.txt.regexen.atSigns)){return twttr.txt.linkToText(entity,taggedSymbol+taggedText,attributes,options)}else{return taggedSymbol+twttr.txt.linkToText(entity,taggedText,attributes,options)}};twttr.txt.linkToHashtag=function(entity,text,options){var hash=text.substring(entity.indices[0],entity.indices[0]+1);var hashtag=twttr.txt.htmlEscape(entity.hashtag);var attrs=clone(options.htmlAttrs||{});attrs.href=options.hashtagUrlBase+hashtag;attrs.title="#"+hashtag;attrs["class"]=options.hashtagClass;if(hashtag.charAt(0).match(twttr.txt.regexen.rtl_chars)){attrs["class"]+=" rtl"}if(options.targetBlank){attrs.target="_blank"}return twttr.txt.linkToTextWithSymbol(entity,hash,hashtag,attrs,options)};twttr.txt.linkToCashtag=function(entity,text,options){var cashtag=twttr.txt.htmlEscape(entity.cashtag);var attrs=clone(options.htmlAttrs||{});attrs.href=options.cashtagUrlBase+cashtag;attrs.title="$"+cashtag;attrs["class"]=options.cashtagClass;if(options.targetBlank){attrs.target="_blank"}return twttr.txt.linkToTextWithSymbol(entity,"$",cashtag,attrs,options)};twttr.txt.linkToMentionAndList=function(entity,text,options){var at=text.substring(entity.indices[0],entity.indices[0]+1);var user=twttr.txt.htmlEscape(entity.screenName);var slashListname=twttr.txt.htmlEscape(entity.listSlug);var isList=entity.listSlug&&!options.suppressLists;var attrs=clone(options.htmlAttrs||{});attrs["class"]=isList?options.listClass:options.usernameClass;attrs.href=isList?options.listUrlBase+user+slashListname:options.usernameUrlBase+user;if(!isList&&!options.suppressDataScreenName){attrs["data-screen-name"]=user}if(options.targetBlank){attrs.target="_blank"}return twttr.txt.linkToTextWithSymbol(entity,at,isList?user+slashListname:user,attrs,options)};twttr.txt.linkToUrl=function(entity,text,options){var url=entity.url;var displayUrl=url;var linkText=twttr.txt.htmlEscape(displayUrl);var urlEntity=options.urlEntities&&options.urlEntities[url]||entity;if(urlEntity.display_url){linkText=twttr.txt.linkTextWithEntity(urlEntity,options)}var attrs=clone(options.htmlAttrs||{});if(!url.match(twttr.txt.regexen.urlHasProtocol)){url="http://"+url}attrs.href=url;if(options.targetBlank){attrs.target="_blank"}if(options.urlClass){attrs["class"]=options.urlClass}if(options.urlTarget){attrs.target=options.urlTarget}if(!options.title&&urlEntity.display_url){attrs.title=urlEntity.expanded_url}return twttr.txt.linkToText(entity,linkText,attrs,options)};twttr.txt.linkTextWithEntity=function(entity,options){var displayUrl=entity.display_url;var expandedUrl=entity.expanded_url;var displayUrlSansEllipses=displayUrl.replace(//g,"");if(expandedUrl.indexOf(displayUrlSansEllipses)!=-1){var displayUrlIndex=expandedUrl.indexOf(displayUrlSansEllipses);var v={displayUrlSansEllipses:displayUrlSansEllipses,beforeDisplayUrl:expandedUrl.substr(0,displayUrlIndex),afterDisplayUrl:expandedUrl.substr(displayUrlIndex+displayUrlSansEllipses.length),precedingEllipsis:displayUrl.match(/^/)?"":"",followingEllipsis:displayUrl.match(/$/)?"":""};for(var k in v){if(v.hasOwnProperty(k)){v[k]=twttr.txt.htmlEscape(v[k])}}v["invisible"]=options.invisibleTagAttrs;return stringSupplant("<span class='tco-ellipsis'>#{precedingEllipsis}<span #{invisible}>&nbsp;</span></span><span #{invisible}>#{beforeDisplayUrl}</span><span class='js-display-url'>#{displayUrlSansEllipses}</span><span #{invisible}>#{afterDisplayUrl}</span><span class='tco-ellipsis'><span #{invisible}>&nbsp;</span>#{followingEllipsis}</span>",v)}return displayUrl};twttr.txt.autoLinkEntities=function(text,entities,options){options=clone(options||{});options.hashtagClass=options.hashtagClass||DEFAULT_HASHTAG_CLASS;options.hashtagUrlBase=options.hashtagUrlBase||"https://twitter.com/#!/search?q=%23";options.cashtagClass=options.cashtagClass||DEFAULT_CASHTAG_CLASS;options.cashtagUrlBase=options.cashtagUrlBase||"https://twitter.com/#!/search?q=%24";options.listClass=options.listClass||DEFAULT_LIST_CLASS;options.usernameClass=options.usernameClass||DEFAULT_USERNAME_CLASS;options.usernameUrlBase=options.usernameUrlBase||"https://twitter.com/";options.listUrlBase=options.listUrlBase||"https://twitter.com/";options.htmlAttrs=twttr.txt.extractHtmlAttrsFromOptions(options);options.invisibleTagAttrs=options.invisibleTagAttrs||"style='position:absolute;left:-9999px;'";var urlEntities,i,len;if(options.urlEntities){urlEntities={};for(i=0,len=options.urlEntities.length;i<len;i++){urlEntities[options.urlEntities[i].url]=options.urlEntities[i]}options.urlEntities=urlEntities}var result="";var beginIndex=0;entities.sort(function(a,b){return a.indices[0]-b.indices[0]});var nonEntity=options.htmlEscapeNonEntities?twttr.txt.htmlEscape:function(text){return text};for(var i=0;i<entities.length;i++){var entity=entities[i];result+=nonEntity(text.substring(beginIndex,entity.indices[0]));if(entity.url){result+=twttr.txt.linkToUrl(entity,text,options)}else if(entity.hashtag){result+=twttr.txt.linkToHashtag(entity,text,options)}else if(entity.screenName){result+=twttr.txt.linkToMentionAndList(entity,text,options)}else if(entity.cashtag){result+=twttr.txt.linkToCashtag(entity,text,options)}beginIndex=entity.indices[1]}result+=nonEntity(text.substring(beginIndex,text.length));return result};twttr.txt.autoLinkWithJSON=function(text,json,options){if(json.user_mentions){for(var i=0;i<json.user_mentions.length;i++){json.user_mentions[i].screenName=json.user_mentions[i].screen_name}}if(json.hashtags){for(var i=0;i<json.hashtags.length;i++){json.hashtags[i].hashtag=json.hashtags[i].text}}if(json.symbols){for(var i=0;i<json.symbols.length;i++){json.symbols[i].cashtag=json.symbols[i].text}}var entities=[];for(var key in json){entities=entities.concat(json[key])}twttr.txt.modifyIndicesFromUnicodeToUTF16(text,entities);return twttr.txt.autoLinkEntities(text,entities,options)};twttr.txt.extractHtmlAttrsFromOptions=function(options){var htmlAttrs={};for(var k in options){var v=options[k];if(OPTIONS_NOT_ATTRIBUTES[k])continue;if(BOOLEAN_ATTRIBUTES[k]){v=v?k:null}if(v==null)continue;htmlAttrs[k]=v}return htmlAttrs};twttr.txt.autoLink=function(text,options){var entities=twttr.txt.extractEntitiesWithIndices(text,{extractUrlsWithoutProtocol:false});return twttr.txt.autoLinkEntities(text,entities,options)};twttr.txt.autoLinkUsernamesOrLists=function(text,options){var entities=twttr.txt.extractMentionsOrListsWithIndices(text);return twttr.txt.autoLinkEntities(text,entities,options)};twttr.txt.autoLinkHashtags=function(text,options){var entities=twttr.txt.extractHashtagsWithIndices(text);return twttr.txt.autoLinkEntities(text,entities,options)};twttr.txt.autoLinkCashtags=function(text,options){var entities=twttr.txt.extractCashtagsWithIndices(text);return twttr.txt.autoLinkEntities(text,entities,options)};twttr.txt.autoLinkUrlsCustom=function(text,options){var entities=twttr.txt.extractUrlsWithIndices(text,{extractUrlsWithoutProtocol:false});return twttr.txt.autoLinkEntities(text,entities,options)};twttr.txt.removeOverlappingEntities=function(entities){entities.sort(function(a,b){return a.indices[0]-b.indices[0]});var prev=entities[0];for(var i=1;i<entities.length;i++){if(prev.indices[1]>entities[i].indices[0]){entities.splice(i,1);i--}else{prev=entities[i]}}};twttr.txt.extractEntitiesWithIndices=function(text,options){var entities=twttr.txt.extractUrlsWithIndices(text,options).concat(twttr.txt.extractMentionsOrListsWithIndices(text)).concat(twttr.txt.extractHashtagsWithIndices(text,{checkUrlOverlap:false})).concat(twttr.txt.extractCashtagsWithIndices(text));if(entities.length==0){return[]}twttr.txt.removeOverlappingEntities(entities);return entities};twttr.txt.extractMentions=function(text){var screenNamesOnly=[],screenNamesWithIndices=twttr.txt.extractMentionsWithIndices(text);for(var i=0;i<screenNamesWithIndices.length;i++){var screenName=screenNamesWithIndices[i].screenName;screenNamesOnly.push(screenName)}return screenNamesOnly};twttr.txt.extractMentionsWithIndices=function(text){var mentions=[],mentionOrList,mentionsOrLists=twttr.txt.extractMentionsOrListsWithIndices(text);for(var i=0;i<mentionsOrLists.length;i++){mentionOrList=mentionsOrLists[i];if(mentionOrList.listSlug==""){mentions.push({screenName:mentionOrList.screenName,indices:mentionOrList.indices})}}return mentions};twttr.txt.extractMentionsOrListsWithIndices=function(text){if(!text||!text.match(twttr.txt.regexen.atSigns)){return[]}var possibleNames=[],slashListname;text.replace(twttr.txt.regexen.validMentionOrList,function(match,before,atSign,screenName,slashListname,offset,chunk){var after=chunk.slice(offset+match.length);if(!after.match(twttr.txt.regexen.endMentionMatch)){slashListname=slashListname||"";var startPosition=offset+before.length;var endPosition=startPosition+screenName.length+slashListname.length+1;possibleNames.push({screenName:screenName,listSlug:slashListname,indices:[startPosition,endPosition]})}});return possibleNames};twttr.txt.extractReplies=function(text){if(!text){return null}var possibleScreenName=text.match(twttr.txt.regexen.validReply);if(!possibleScreenName||RegExp.rightContext.match(twttr.txt.regexen.endMentionMatch)){return null}return possibleScreenName[1]};twttr.txt.extractUrls=function(text,options){var urlsOnly=[],urlsWithIndices=twttr.txt.extractUrlsWithIndices(text,options);for(var i=0;i<urlsWithIndices.length;i++){urlsOnly.push(urlsWithIndices[i].url)}return urlsOnly};twttr.txt.extractUrlsWithIndices=function(text,options){if(!options){options={extractUrlsWithoutProtocol:true}}if(!text||(options.extractUrlsWithoutProtocol?!text.match(/\./):!text.match(/:/))){return[]}var urls=[];while(twttr.txt.regexen.extractUrl.exec(text)){var before=RegExp.$2,url=RegExp.$3,protocol=RegExp.$4,domain=RegExp.$5,path=RegExp.$7;var endPosition=twttr.txt.regexen.extractUrl.lastIndex,startPosition=endPosition-url.length;if(!protocol){if(!options.extractUrlsWithoutProtocol||before.match(twttr.txt.regexen.invalidUrlWithoutProtocolPrecedingChars)){continue}var lastUrl=null,asciiEndPosition=0;domain.replace(twttr.txt.regexen.validAsciiDomain,function(asciiDomain){var asciiStartPosition=domain.indexOf(asciiDomain,asciiEndPosition);asciiEndPosition=asciiStartPosition+asciiDomain.length;lastUrl={url:asciiDomain,indices:[startPosition+asciiStartPosition,startPosition+asciiEndPosition]};if(path||asciiDomain.match(twttr.txt.regexen.validSpecialShortDomain)||!asciiDomain.match(twttr.txt.regexen.invalidShortDomain)){urls.push(lastUrl)}});if(lastUrl==null){continue}if(path){lastUrl.url=url.replace(domain,lastUrl.url);lastUrl.indices[1]=endPosition}}else{if(url.match(twttr.txt.regexen.validTcoUrl)){url=RegExp.lastMatch;endPosition=startPosition+url.length}urls.push({url:url,indices:[startPosition,endPosition]})}}return urls};twttr.txt.extractHashtags=function(text){var hashtagsOnly=[],hashtagsWithIndices=twttr.txt.extractHashtagsWithIndices(text);for(var i=0;i<hashtagsWithIndices.length;i++){hashtagsOnly.push(hashtagsWithIndices[i].hashtag)}return hashtagsOnly};twttr.txt.extractHashtagsWithIndices=function(text,options){if(!options){options={checkUrlOverlap:true}}if(!text||!text.match(twttr.txt.regexen.hashSigns)){return[]}var tags=[];text.replace(twttr.txt.regexen.validHashtag,function(match,before,hash,hashText,offset,chunk){var after=chunk.slice(offset+match.length);if(after.match(twttr.txt.regexen.endHashtagMatch))return;var startPosition=offset+before.length;var endPosition=startPosition+hashText.length+1;tags.push({hashtag:hashText,indices:[startPosition,endPosition]})});if(options.checkUrlOverlap){var urls=twttr.txt.extractUrlsWithIndices(text);if(urls.length>0){var entities=tags.concat(urls);twttr.txt.removeOverlappingEntities(entities);tags=[];for(var i=0;i<entities.length;i++){if(entities[i].hashtag){tags.push(entities[i])}}}}return tags};twttr.txt.extractCashtags=function(text){var cashtagsOnly=[],cashtagsWithIndices=twttr.txt.extractCashtagsWithIndices(text);for(var i=0;i<cashtagsWithIndices.length;i++){cashtagsOnly.push(cashtagsWithIndices[i].cashtag)}return cashtagsOnly};twttr.txt.extractCashtagsWithIndices=function(text){if(!text||text.indexOf("$")==-1){return[]}var tags=[];text.replace(twttr.txt.regexen.validCashtag,function(match,before,dollar,cashtag,offset,chunk){var startPosition=offset+before.length;var endPosition=startPosition+cashtag.length+1;tags.push({cashtag:cashtag,indices:[startPosition,endPosition]})});return tags};twttr.txt.modifyIndicesFromUnicodeToUTF16=function(text,entities){twttr.txt.convertUnicodeIndices(text,entities,false)};twttr.txt.modifyIndicesFromUTF16ToUnicode=function(text,entities){twttr.txt.convertUnicodeIndices(text,entities,true)};twttr.txt.getUnicodeTextLength=function(text){return text.replace(twttr.txt.regexen.non_bmp_code_pairs," ").length};twttr.txt.convertUnicodeIndices=function(text,entities,indicesInUTF16){if(entities.length==0){return}var charIndex=0;var codePointIndex=0;entities.sort(function(a,b){return a.indices[0]-b.indices[0]});var entityIndex=0;var entity=entities[0];while(charIndex<text.length){if(entity.indices[0]==(indicesInUTF16?charIndex:codePointIndex)){var len=entity.indices[1]-entity.indices[0];entity.indices[0]=indicesInUTF16?codePointIndex:charIndex;entity.indices[1]=entity.indices[0]+len;entityIndex++;if(entityIndex==entities.length){break}entity=entities[entityIndex]}var c=text.charCodeAt(charIndex);if(55296<=c&&c<=56319&&charIndex<text.length-1){c=text.charCodeAt(charIndex+1);if(56320<=c&&c<=57343){charIndex++}}codePointIndex++;charIndex++}};twttr.txt.splitTags=function(text){var firstSplits=text.split("<"),secondSplits,allSplits=[],split;for(var i=0;i<firstSplits.length;i+=1){split=firstSplits[i];if(!split){allSplits.push("")}else{secondSplits=split.split(">");for(var j=0;j<secondSplits.length;j+=1){allSplits.push(secondSplits[j])}}}return allSplits};twttr.txt.hitHighlight=function(text,hits,options){var defaultHighlightTag="em";hits=hits||[];options=options||{};if(hits.length===0){return text}var tagName=options.tag||defaultHighlightTag,tags=["<"+tagName+">","</"+tagName+">"],chunks=twttr.txt.splitTags(text),i,j,result="",chunkIndex=0,chunk=chunks[0],prevChunksLen=0,chunkCursor=0,startInChunk=false,chunkChars=chunk,flatHits=[],index,hit,tag,placed,hitSpot;for(i=0;i<hits.length;i+=1){for(j=0;j<hits[i].length;j+=1){flatHits.push(hits[i][j])}}for(index=0;index<flatHits.length;index+=1){hit=flatHits[index];tag=tags[index%2];placed=false;while(chunk!=null&&hit>=prevChunksLen+chunk.length){result+=chunkChars.slice(chunkCursor);if(startInChunk&&hit===prevChunksLen+chunkChars.length){result+=tag;placed=true}if(chunks[chunkIndex+1]){result+="<"+chunks[chunkIndex+1]+">"}prevChunksLen+=chunkChars.length;chunkCursor=0;chunkIndex+=2;chunk=chunks[chunkIndex];chunkChars=chunk;startInChunk=false}if(!placed&&chunk!=null){hitSpot=hit-prevChunksLen;result+=chunkChars.slice(chunkCursor,hitSpot)+tag;chunkCursor=hitSpot;if(index%2===0){startInChunk=true}else{startInChunk=false}}else if(!placed){placed=true;result+=tag}}if(chunk!=null){if(chunkCursor<chunkChars.length){result+=chunkChars.slice(chunkCursor)}for(index=chunkIndex+1;index<chunks.length;index+=1){result+=index%2===0?chunks[index]:"<"+chunks[index]+">"}}return result};var MAX_LENGTH=140;var INVALID_CHARACTERS=[fromCode(65534),fromCode(65279),fromCode(65535),fromCode(8234),fromCode(8235),fromCode(8236),fromCode(8237),fromCode(8238)];twttr.txt.getTweetLength=function(text,options){if(!options){options={short_url_length:23,short_url_length_https:23}}var textLength=twttr.txt.getUnicodeTextLength(text),urlsWithIndices=twttr.txt.extractUrlsWithIndices(text);twttr.txt.modifyIndicesFromUTF16ToUnicode(text,urlsWithIndices);for(var i=0;i<urlsWithIndices.length;i++){textLength+=urlsWithIndices[i].indices[0]-urlsWithIndices[i].indices[1];if(urlsWithIndices[i].url.toLowerCase().match(twttr.txt.regexen.urlHasHttps)){textLength+=options.short_url_length_https}else{textLength+=options.short_url_length}}return textLength};twttr.txt.isInvalidTweet=function(text){if(!text){return"empty"}if(twttr.txt.getTweetLength(text)>MAX_LENGTH){return"too_long"}if(twttr.txt.hasInvalidCharacters(text)){return"invalid_characters"}return false};twttr.txt.hasInvalidCharacters=function(text){for(var i=0;i<INVALID_CHARACTERS.length;i++){if(text.indexOf(INVALID_CHARACTERS[i])>=0){return true}}return false};twttr.txt.isValidTweetText=function(text){return!twttr.txt.isInvalidTweet(text)};twttr.txt.isValidUsername=function(username){if(!username){return false}var extracted=twttr.txt.extractMentions(username);return extracted.length===1&&extracted[0]===username.slice(1)};var VALID_LIST_RE=regexSupplant(/^#{validMentionOrList}$/);twttr.txt.isValidList=function(usernameList){var match=usernameList.match(VALID_LIST_RE);return!!(match&&match[1]==""&&match[4])};twttr.txt.isValidHashtag=function(hashtag){if(!hashtag){return false}var extracted=twttr.txt.extractHashtags(hashtag);return extracted.length===1&&extracted[0]===hashtag.slice(1)};twttr.txt.isValidUrl=function(url,unicodeDomains,requireProtocol){if(unicodeDomains==null){unicodeDomains=true}if(requireProtocol==null){requireProtocol=true}if(!url){return false}var urlParts=url.match(twttr.txt.regexen.validateUrlUnencoded);if(!urlParts||urlParts[0]!==url){return false}var scheme=urlParts[1],authority=urlParts[2],path=urlParts[3],query=urlParts[4],fragment=urlParts[5];if(!((!requireProtocol||isValidMatch(scheme,twttr.txt.regexen.validateUrlScheme)&&scheme.match(/^https?$/i))&&isValidMatch(path,twttr.txt.regexen.validateUrlPath)&&isValidMatch(query,twttr.txt.regexen.validateUrlQuery,true)&&isValidMatch(fragment,twttr.txt.regexen.validateUrlFragment,true))){return false}return unicodeDomains&&isValidMatch(authority,twttr.txt.regexen.validateUrlUnicodeAuthority)||!unicodeDomains&&isValidMatch(authority,twttr.txt.regexen.validateUrlAuthority)};function isValidMatch(string,regex,optional){if(!optional){return typeof string==="string"&&string.match(regex)&&RegExp["$&"]===string}return!string||string.match(regex)&&RegExp["$&"]===string}if(typeof module!="undefined"&&module.exports){module.exports=twttr.txt}if(typeof define=="function"&&define.amd){define("twitter-text",[],twttr.txt)}if(typeof window!="undefined"){if(window.twttr){for(var prop in twttr){window.twttr[prop]=twttr[prop]}}else{window.twttr=twttr}}})();(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==="object"&&typeof module==="object")module.exports=factory(require("underscore"),require("twitter-text"));else if(typeof define==="function"&&define.amd)define("bw-fe-helpers/validationHelpers",["underscore","twitter-text"],factory);else{var a=typeof exports==="object"?factory(require("underscore"),require("twitter-text")):factory(root["underscore"],root["twitter-text"]);for(var i in a)(typeof exports==="object"?exports:root)[i]=a[i]}})(this,function(__WEBPACK_EXTERNAL_MODULE__1__,__WEBPACK_EXTERNAL_MODULE__3__){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=47)}({1:function(module,exports){module.exports=__WEBPACK_EXTERNAL_MODULE__1__},3:function(module,exports){module.exports=__WEBPACK_EXTERNAL_MODULE__3__},47:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var underscore__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1);var underscore__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(underscore__WEBPACK_IMPORTED_MODULE_0__);var twitter_text__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3);var twitter_text__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(twitter_text__WEBPACK_IMPORTED_MODULE_1__);__webpack_exports__["default"]={isNumericRegex:/^-?\d+$/,isPositiveNumberRegex:/^[0-9]*$/,emailRegexp:/^((([a-z]|\d|[!#$%&'*+\-=?^_`{|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#$%&'*+-=?^_`{|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i,genericImageUrlRegex:/^([a-z\-_0-9/:.]*\.(jpg|jpeg|png|gif))([:?].*)?$/i,instagramImageUrlRegexp:/^([a-z\-_0-9/:.]*\/p\/?\S+\/media(\/\?size=[t|m|l])?)$/i,isValidEmail:function isValidEmail(emailAddress){return this.emailRegexp.test(emailAddress)},isNullOrEmptyString:function isNullOrEmptyString(str){return!str||!underscore__WEBPACK_IMPORTED_MODULE_0___default.a.isString(str)||!underscore__WEBPACK_IMPORTED_MODULE_0___default()(str).trim()},isInvalidString:function isInvalidString(str){return!this.isNullOrEmptyString(str)&&(str.indexOf("\\")>-1||str.indexOf('"')>-1)},isInvalidAuthorName:function isInvalidAuthorName(str){return!this.isNullOrEmptyString(str)&&str.indexOf("\\")>-1},isNumeric:function isNumeric(num){return this.isNumericRegex.test(num)},isPositiveNumber:function isPositiveNumber(num){return this.isPositiveNumberRegex.test(num)},isNullOrEmptyArray:function isNullOrEmptyArray(array){return!array||!Array.isArray(array)||!array.length},hasImageMediaUrl:function hasImageMediaUrl(mediaUrls){return!this.isNullOrEmptyArray(mediaUrls)&&this.isImageUrl(mediaUrls[0])},isImageUrl:function isImageUrl(url){return this.genericImageUrlRegex.test(url)||this.instagramImageUrlRegexp.test(url)},isGenericImageUrl:function isGenericImageUrl(url){return this.genericImageUrlRegex.test(url)},isInstagramImageUrl:function isInstagramImageUrl(url){return this.instagramImageUrlRegexp.test(url)},isNullOrEmpty:function isNullOrEmpty(value){if(underscore__WEBPACK_IMPORTED_MODULE_0___default.a.isArray(value)){return this.isNullOrEmptyArray(value)}if(underscore__WEBPACK_IMPORTED_MODULE_0___default.a.isString(value)){return this.isNullOrEmptyString(value)}return underscore__WEBPACK_IMPORTED_MODULE_0___default.a.isUndefined(value)||underscore__WEBPACK_IMPORTED_MODULE_0___default.a.isNull(value)},isUrl:function isUrl(url){return twitter_text__WEBPACK_IMPORTED_MODULE_1___default.a.isValidUrl(url,true,false)}}}})["default"]});define("src/models/UserDetails",["backbone","underscore","bw-fe-helpers/validationHelpers"],function(Backbone,_,validationHelpers){"use strict";return Backbone.Model.extend({url:function url(){return"/user"},validate:function validate(attrs){var errors={};if(_.isUndefined(attrs.clientId)){errors.clientId="required"}else if(isNaN(attrs.clientId)){errors.clientId="number"}if(attrs.username&&!validationHelpers.isValidEmail(attrs.username)){errors.username="format"}if(validationHelpers.isNullOrEmptyString(attrs.username)){errors.username="required"}if(attrs.password!==attrs.passwordConfirmation){errors.password="mustmatch"}if(attrs.password&&!attrs.oldPassword){errors.oldPassword="required"}if(validationHelpers.isNullOrEmptyString(attrs.firstName)){errors.firstName="required"}if(validationHelpers.isNullOrEmptyString(attrs.lastName)){errors.lastName="required"}_.each(["password","passwordConfirmation","firstName","lastName","job","department","role","address","phone","mobile"],function(textfield){if(validationHelpers.isInvalidString(attrs[textfield])){errors[textfield]="invalidchar"}});return _.size(errors)?errors:undefined},parse:function parse(response){response.password=undefined;response.passwordConfirmation=undefined;return response}})});define("src/helpers/gravatarHelper",["src/Workbench"],function(Workbench){"use strict";return{getLoggedUserGravatarUrl:function getLoggedUserGravatarUrl(sizePx){return this.getGravatarUrl(Workbench.emailMd5,sizePx)},getGravatarUrl:function getGravatarUrl(emailHash,sizePx){var params=["d=mm"],paramsString;if(sizePx){params=params.concat("s="+sizePx)}paramsString=params.join("&");return["https://www.gravatar.com/avatar/",emailHash,"?",paramsString].join("")}}});define("src/events/administrationEvents",["underscore","backbone"],function(_,Backbone){"use strict";return _.clone(Backbone.Events)});define("text",["module"],function(module){"use strict";var text,fs,Cc,Ci,xpcIsWindows,progIds=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],xmlRegExp=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,bodyRegExp=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,hasLocation=typeof location!=="undefined"&&location.href,defaultProtocol=hasLocation&&location.protocol&&location.protocol.replace(/\:/,""),defaultHostName=hasLocation&&location.hostname,defaultPort=hasLocation&&(location.port||undefined),buildMap={},masterConfig=module.config&&module.config()||{};text={version:"2.0.10",strip:function(content){if(content){content=content.replace(xmlRegExp,"");var matches=content.match(bodyRegExp);if(matches){content=matches[1]}}else{content=""}return content},jsEscape:function(content){return content.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:masterConfig.createXhr||function(){var xhr,i,progId;if(typeof XMLHttpRequest!=="undefined"){return new XMLHttpRequest}else if(typeof ActiveXObject!=="undefined"){for(i=0;i<3;i+=1){progId=progIds[i];try{xhr=new ActiveXObject(progId)}catch(e){}if(xhr){progIds=[progId];break}}}return xhr},parseName:function(name){var modName,ext,temp,strip=false,index=name.indexOf("."),isRelative=name.indexOf("./")===0||name.indexOf("../")===0;if(index!==-1&&(!isRelative||index>1)){modName=name.substring(0,index);ext=name.substring(index+1,name.length)}else{modName=name}temp=ext||modName;index=temp.indexOf("!");if(index!==-1){strip=temp.substring(index+1)==="strip";temp=temp.substring(0,index);if(ext){ext=temp}else{modName=temp}}return{moduleName:modName,ext:ext,strip:strip}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(url,protocol,hostname,port){var uProtocol,uHostName,uPort,match=text.xdRegExp.exec(url);if(!match){return true}uProtocol=match[2];uHostName=match[3];uHostName=uHostName.split(":");uPort=uHostName[1];uHostName=uHostName[0];return(!uProtocol||uProtocol===protocol)&&(!uHostName||uHostName.toLowerCase()===hostname.toLowerCase())&&(!uPort&&!uHostName||uPort===port)},finishLoad:function(name,strip,content,onLoad){content=strip?text.strip(content):content;if(masterConfig.isBuild){buildMap[name]=content}onLoad(content)},load:function(name,req,onLoad,config){if(config.isBuild&&!config.inlineText){onLoad();return}masterConfig.isBuild=config.isBuild;var parsed=text.parseName(name),nonStripName=parsed.moduleName+(parsed.ext?"."+parsed.ext:""),url=req.toUrl(nonStripName),useXhr=masterConfig.useXhr||text.useXhr;if(url.indexOf("empty:")===0){onLoad();return}if(!hasLocation||useXhr(url,defaultProtocol,defaultHostName,defaultPort)){text.get(url,function(content){text.finishLoad(name,parsed.strip,content,onLoad)},function(err){if(onLoad.error){onLoad.error(err)}})}else{req([nonStripName],function(content){text.finishLoad(parsed.moduleName+"."+parsed.ext,parsed.strip,content,onLoad)})}},write:function(pluginName,moduleName,write,config){if(buildMap.hasOwnProperty(moduleName)){var content=text.jsEscape(buildMap[moduleName]);write.asModule(pluginName+"!"+moduleName,"define(function () { return '"+content+"';});\n")}},writeFile:function(pluginName,moduleName,req,write,config){var parsed=text.parseName(moduleName),extPart=parsed.ext?"."+parsed.ext:"",nonStripName=parsed.moduleName+extPart,fileName=req.toUrl(parsed.moduleName+extPart)+".js";text.load(nonStripName,req,function(value){var textWrite=function(contents){return write(fileName,contents)};textWrite.asModule=function(moduleName,contents){return write.asModule(moduleName,fileName,contents)};text.write(pluginName,nonStripName,textWrite,config)},config)}};if(masterConfig.env==="node"||!masterConfig.env&&typeof process!=="undefined"&&process.versions&&!!process.versions.node&&!process.versions["node-webkit"]){fs=require.nodeRequire("fs");text.get=function(url,callback,errback){try{var file=fs.readFileSync(url,"utf8");if(file.indexOf("\ufeff")===0){file=file.substring(1)}callback(file)}catch(e){errback(e)}}}else if(masterConfig.env==="xhr"||!masterConfig.env&&text.createXhr()){text.get=function(url,callback,errback,headers){var xhr=text.createXhr(),header;xhr.open("GET",url,true);if(headers){for(header in headers){if(headers.hasOwnProperty(header)){xhr.setRequestHeader(header.toLowerCase(),headers[header])}}}if(masterConfig.onXhr){masterConfig.onXhr(xhr,url)}xhr.onreadystatechange=function(evt){var status,err;if(xhr.readyState===4){status=xhr.status;if(status>399&&status<600){err=new Error(url+" HTTP status: "+status);err.xhr=xhr;errback(err)}else{callback(xhr.responseText)}if(masterConfig.onXhrComplete){masterConfig.onXhrComplete(xhr,url)}}};xhr.send(null)}}else if(masterConfig.env==="rhino"||!masterConfig.env&&typeof Packages!=="undefined"&&typeof java!=="undefined"){text.get=function(url,callback){var stringBuffer,line,encoding="utf-8",file=new java.io.File(url),lineSeparator=java.lang.System.getProperty("line.separator"),input=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(file),encoding)),content="";try{stringBuffer=new java.lang.StringBuffer;line=input.readLine();if(line&&line.length()&&line.charAt(0)===65279){line=line.substring(1)}if(line!==null){stringBuffer.append(line)}while((line=input.readLine())!==null){stringBuffer.append(lineSeparator);stringBuffer.append(line)}content=String(stringBuffer.toString())}finally{input.close()}callback(content)}}else if(masterConfig.env==="xpconnect"||!masterConfig.env&&typeof Components!=="undefined"&&Components.classes&&Components.interfaces){Cc=Components.classes,Ci=Components.interfaces;Components.utils["import"]("resource://gre/modules/FileUtils.jsm");xpcIsWindows="@mozilla.org/windows-registry-key;1"in Cc;text.get=function(url,callback){var inStream,convertStream,fileObj,readData={};if(xpcIsWindows){url=url.replace(/\//g,"\\")}fileObj=new FileUtils.File(url);try{inStream=Cc["@mozilla.org/network/file-input-stream;1"].createInstance(Ci.nsIFileInputStream);inStream.init(fileObj,1,0,false);convertStream=Cc["@mozilla.org/intl/converter-input-stream;1"].createInstance(Ci.nsIConverterInputStream);convertStream.init(inStream,"utf-8",inStream.available(),Ci.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER);convertStream.readString(inStream.available(),readData);convertStream.close();inStream.close();callback(readData.value)}catch(e){throw new Error((fileObj&&fileObj.path||"")+": "+e)}}}return text});define("mustache-common",[],function(){"use strict";return{getOptions:function(resourceId,config){var split=resourceId.split("!"),name=split[0],ext=config.templateExtension||".template",fullName=require.toUrl(name+ext);return{name:name,fullName:fullName}}}});define("mustache",["text","lib/mustache","./mustache-common"],function(text,mustache,mustacheCommon){"use strict";var templateCache={};return{load:function(resourceId,require,callback,config){var options=mustacheCommon.getOptions(resourceId,config),name=options.name,fullName=options.fullName;function doIt(data,partials,wrapInjQuery){return mustache.render(templateCache[name],data,partials,wrapInjQuery)}if(templateCache[name]){return callback(doIt)}text.get(fullName,function(templateSource){if(!templateCache[name]){templateCache[name]=templateSource}callback(doIt)})},pluginBuilder:"mustacheBuilder"}});define("mustache!templates/editMyAccountDetails",["lib/mustache"],function(mustache){var escapedTemplate='{{#done}}\n<header>\n<h1 class="popuptitletext singlemargin-bottom draggable">Success</h1>\n</header>\n<div class="confirmation">\n<p>{{email}} has been saved</p>\n</div>\n<footer>\n<button class="cancel button">Close</button>\n</footer>\n{{/done}}\n{{^done}}\n<header>\n<h1 class="popuptitletext singlemargin-bottom draggable">Edit Your Details</h1>\n</header>\n<div class="content">\n<form autocomplete="off">\n<div class="errorPane notification-error rounded smallpadding-vertical singlepadding-horizontal singlemargin-bottom hidden"/>\n<div class="form-body">\n<fieldset>\n<h2 class="lightgreybg rounded">User</h2>\n<div class="email singlemargin-top">\n<div class="floatleft fivecol">\n<label for="{{cid}}_email">Email</label><br/>\n<span class="username grey">{{username}}</span>\n</div>\n<a class="js-avatar customtip floatright singlemargin-right" title="Change your avatar at gravatar.com (opens in new tab)" target="_blank" href="https://en.gravatar.com/emails"><img class="avatar" src="{{avatarUrl}}"></a>\n</div>\n<div class="row singlemargin-top">\n<p>\n<label for="{{cid}}_oldPassword">Old Password</label>\n<input class="validation-wrapper field" id="{{cid}}_oldPassword" type="password" name="oldPassword" value=""/>\n</p>\n</div>\n<div class="row two-col singlepadding-top">\n<p>\n<label for="{{cid}}_password">Password</label>\n<input class="validation-wrapper field" data-validation-message-mustmatch="Please make sure your passwords match" id="{{cid}}_password" type="password" name="password" value=""/>\n</p>\n<p>\n<label for="{{cid}}_passwordConfirmation">Confirm Password</label>\n<input class="validation-wrapper field" data-validation-modelkey="password" data-validation-message-mustmatch="Please make sure your passwords match" id="{{cid}}_passwordConfirmation" type="password" name="passwordConfirmation" value=""/>\n</p>\n<p class="password information">\n<em>Leave password empty to keep current password</em>\n</p>\n</div>\n</fieldset>\n<fieldset>\n<h2 class="lightgreybg rounded">User details</h2>\n<div class="row two-col singlepadding-top">\n<p>\n<label for="{{cid}}_firstName">First Name <span class="red">&#42;</span></label>\n<input class="validation-wrapper field" id="{{cid}}_firstName" name="firstName" value="{{firstName}}"/>\n</p>\n<p>\n<label for="{{cid}}_lastName">Last Name <span class="red">&#42;</span></label>\n<input class="validation-wrapper field" id="{{cid}}_lastName" name="lastName" value="{{lastName}}"/>\n</p>\n</div>\n</fieldset>\n<fieldset>\n<h2 class="lightgreybg rounded">Company Information</h2>\n<div class="row two-col singlepadding-top">\n<p>\n<label for="{{cid}}_department">Department</label>\n<input class="validation-wrapper field" id="{{cid}}_department" name="department" value="{{department}}"/>\n</p>\n<p>\n<label for="{{cid}}_job">Job Title</label>\n<input class="validation-wrapper field" id="{{cid}}_job" name="job" value="{{job}}"/>\n</p>\n</div>\n</fieldset>\n<fieldset>\n<h2 class="lightgreybg rounded">Address</h2>\n<p class="singlemargin-top row one-col">\n<label for="{{cid}}_address">Address</label>\n<textarea class="field validation-wrapper" id="{{cid}}_address" name="address" rows="5">{{address}}</textarea>\n</p>\n</fieldset>\n<fieldset>\n<h2 class="lightgreybg rounded">Contact Information</h2>\n<div class="row two-col singlepadding-top">\n<p>\n<label for="{{cid}}_phone">Telephone</label>\n<input class="validation-wrapper field" data-validation-modelkey="phone" id="{{cid}}_phone" name="contactPhone" value="{{phone}}"/>\n</p>\n<p>\n<label for="{{cid}}_mobile">Mobile</label>\n<input class="validation-wrapper field" data-validation-modelkey="mobile" id="{{cid}}_mobile" name="contactMobile" value="{{mobile}}"/>\n</p>\n</div>\n</fieldset>\n</div>\n</form>\n</div>\n{{#canSeeAdminLink}}\n<div class="accountinfo singlepadding-top">\n<span>Looking for <a href="/administration/accountinfo" target="_blank">Account Info (allowance and usage)</a>?\n</div>\n{{/canSeeAdminLink}}\n<footer class="doublemargin-top">\n<button class="save defaultbutton">Save</button>\n<button class="cancel button singlemargin-left">Cancel</button>\n<span class="requiredKey mediumtext floatright grey doublepadding-right smallpadding-top">* required fields</span>\n</footer>\n{{/done}}\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});(function(){"use strict";function getPath(path,config){if(path.indexOf("css/")===0){return config.baseUrl+path}return require.toUrl(path)}define("css",{load:function(resourceId,require,callback,config){var path=resourceId,link=document.createElement("link");link.type="text/css";link.rel="stylesheet";link.href=getPath(path,config);if(config.isBuild){return callback()}link.onload=callback;document.getElementsByTagName("head")[0].appendChild(link)},pluginBuilder:"cssBuilder"})})();define("css!css/clientUserAdminForms.css",["css!css/compiled.css"],function(){});(function(root,factory){if(typeof exports=="object")module.exports=factory();else if(typeof define=="function"&&define.amd)define("spin",factory);else root.Spinner=factory()})(this,function(){"use strict";var prefixes=["webkit","Moz","ms","O"],animations={},useCssAnimations;function createEl(tag,prop){var el=document.createElement(tag||"div"),n;for(n in prop)el[n]=prop[n];return el}function ins(parent){for(var i=1,n=arguments.length;i<n;i++)parent.appendChild(arguments[i]);return parent}var sheet=function(){var el=createEl("style",{type:"text/css"});ins(document.getElementsByTagName("head")[0],el);return el.sheet||el.styleSheet}();function addAnimation(alpha,trail,i,lines){var name=["opacity",trail,~~(alpha*100),i,lines].join("-"),start=.01+i/lines*100,z=Math.max(1-(1-alpha)/trail*(100-start),alpha),prefix=useCssAnimations.substring(0,useCssAnimations.indexOf("Animation")).toLowerCase(),pre=prefix&&"-"+prefix+"-"||"";if(!animations[name]){sheet.insertRule("@"+pre+"keyframes "+name+"{"+"0%{opacity:"+z+"}"+start+"%{opacity:"+alpha+"}"+(start+.01)+"%{opacity:1}"+(start+trail)%100+"%{opacity:"+alpha+"}"+"100%{opacity:"+z+"}"+"}",sheet.cssRules.length);animations[name]=1}return name}function vendor(el,prop){var s=el.style,pp,i;prop=prop.charAt(0).toUpperCase()+prop.slice(1);for(i=0;i<prefixes.length;i++){pp=prefixes[i]+prop;if(s[pp]!==undefined)return pp}if(s[prop]!==undefined)return prop}function css(el,prop){for(var n in prop)el.style[vendor(el,n)||n]=prop[n];return el}function merge(obj){for(var i=1;i<arguments.length;i++){var def=arguments[i];for(var n in def)if(obj[n]===undefined)obj[n]=def[n]}return obj}function pos(el){var o={x:el.offsetLeft,y:el.offsetTop};while(el=el.offsetParent)o.x+=el.offsetLeft,o.y+=el.offsetTop;return o}function getColor(color,idx){return typeof color=="string"?color:color[idx%color.length]}var defaults={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:1/4,fps:20,zIndex:2e9,className:"spinner",top:"auto",left:"auto",position:"relative"};function Spinner(o){if(typeof this=="undefined")return new Spinner(o);this.opts=merge(o||{},Spinner.defaults,defaults)}Spinner.defaults={};merge(Spinner.prototype,{spin:function(target){this.stop();var self=this,o=self.opts,el=self.el=css(createEl(0,{className:o.className}),{position:o.position,width:0,zIndex:o.zIndex}),mid=o.radius+o.length+o.width,ep,tp;if(target){target.insertBefore(el,target.firstChild||null);tp=pos(target);ep=pos(el);css(el,{left:(o.left=="auto"?tp.x-ep.x+(target.offsetWidth>>1):parseInt(o.left,10)+mid)+"px",top:(o.top=="auto"?tp.y-ep.y+(target.offsetHeight>>1):parseInt(o.top,10)+mid)+"px"})}el.setAttribute("role","progressbar");self.lines(el,self.opts);if(!useCssAnimations){var i=0,start=(o.lines-1)*(1-o.direction)/2,alpha,fps=o.fps,f=fps/o.speed,ostep=(1-o.opacity)/(f*o.trail/100),astep=f/o.lines;(function anim(){i++;for(var j=0;j<o.lines;j++){alpha=Math.max(1-(i+(o.lines-j)*astep)%f*ostep,o.opacity);self.opacity(el,j*o.direction+start,alpha,o)}self.timeout=self.el&&setTimeout(anim,~~(1e3/fps))})()}return self},stop:function(){var el=this.el;if(el){clearTimeout(this.timeout);if(el.parentNode)el.parentNode.removeChild(el);this.el=undefined}return this},lines:function(el,o){var i=0,start=(o.lines-1)*(1-o.direction)/2,seg;function fill(color,shadow){return css(createEl(),{position:"absolute",width:o.length+o.width+"px",height:o.width+"px",background:color,boxShadow:shadow,transformOrigin:"left",transform:"rotate("+~~(360/o.lines*i+o.rotate)+"deg) translate("+o.radius+"px"+",0)",borderRadius:(o.corners*o.width>>1)+"px"})}for(;i<o.lines;i++){seg=css(createEl(),{position:"absolute",top:1+~(o.width/2)+"px",transform:o.hwaccel?"translate3d(0,0,0)":"",opacity:o.opacity,animation:useCssAnimations&&addAnimation(o.opacity,o.trail,start+i*o.direction,o.lines)+" "+1/o.speed+"s linear infinite"});if(o.shadow)ins(seg,css(fill("#000","0 0 4px "+"#000"),{top:2+"px"}));ins(el,ins(seg,fill(getColor(o.color,i),"0 0 1px rgba(0,0,0,.1)")))}return el},opacity:function(el,i,val){if(i<el.childNodes.length)el.childNodes[i].style.opacity=val}});function initVML(){function vml(tag,attr){return createEl("<"+tag+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',attr)}sheet.addRule(".spin-vml","behavior:url(#default#VML)");Spinner.prototype.lines=function(el,o){var r=o.length+o.width,s=2*r;function grp(){return css(vml("group",{coordsize:s+" "+s,coordorigin:-r+" "+-r}),{width:s,height:s})}var margin=-(o.width+o.length)*2+"px",g=css(grp(),{position:"absolute",top:margin,left:margin}),i;function seg(i,dx,filter){ins(g,ins(css(grp(),{rotation:360/o.lines*i+"deg",left:~~dx}),ins(css(vml("roundrect",{arcsize:o.corners}),{width:r,height:o.width,left:o.radius,top:-o.width>>1,filter:filter}),vml("fill",{color:getColor(o.color,i),opacity:o.opacity}),vml("stroke",{opacity:0}))))}if(o.shadow)for(i=1;i<=o.lines;i++)seg(i,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(i=1;i<=o.lines;i++)seg(i);return ins(el,g)};Spinner.prototype.opacity=function(el,i,val,o){var c=el.firstChild;o=o.shadow&&o.lines||0;if(c&&i+o<c.childNodes.length){c=c.childNodes[i+o];c=c&&c.firstChild;c=c&&c.firstChild;if(c)c.opacity=val}}}var probe=css(createEl("group"),{behavior:"url(#default#VML)"});if(!vendor(probe,"transform")&&probe.adj)initVML();else useCssAnimations=vendor(probe,"animation");return Spinner});(function(factory){if(typeof exports=="object"){factory(require("jquery"),require("spin"))}else if(typeof define=="function"&&define.amd){define("jquery.spin",["jquery","spin"],factory)}else{if(!window.Spinner)throw new Error("Spin.js not present");factory(window.jQuery,window.Spinner)}})(function($,Spinner){$.fn.spin=function(opts,color){return this.each(function(){var $this=$(this),data=$this.data();if(data.spinner){data.spinner.stop();delete data.spinner}if(opts!==false){opts=$.extend({color:color||$this.css("color")},$.fn.spin.presets[opts]||opts);data.spinner=new Spinner(opts).spin(this)}})};$.fn.spin.presets={tiny:{lines:8,length:2,width:2,radius:3},small:{lines:8,length:4,width:3,radius:5},large:{lines:10,length:8,width:4,radius:8}}});define("src/packages/spin",["spin","jquery.spin"],function(spin){"use strict";spin.defaults={lines:12,length:4,width:2,radius:3,color:"#000",speed:.7,trail:34,shadow:false,hwaccel:false,className:"spinner",zIndex:2e9,top:"auto",left:"auto"};return spin});(function($,_){"use strict";if(!$.waitmask){$.waitmask={}}$.waitmask.defaults={text:"",opacity:.8,className:"",applyPosition:true,minHeight:150,spinOptions:{lines:8,length:5,width:2,radius:5,color:"#4B4949",corners:1,trail:60,speed:1}};function _createWaitmask(options){var $waitmask=$("<div><p/></div>").addClass("waitmask "+options.className);if(options.text){$waitmask.find("p").html(options.text)}return $waitmask}function _modifyElemCss($elem,height,width,options){var oldCssText=$elem.attr("style"),cssPosition=$elem.css("position"),newCss={overflow:"hidden"};if(options.applyPosition&&["relative","absolute"].indexOf(cssPosition)===-1){newCss.position="relative";if(height<options.minHeight){var centerVertOffset=Math.ceil(($elem.parent().height()-options.minHeight)/2);if(centerVertOffset>0){newCss.top=centerVertOffset+"px"}newCss.minHeight=options.minHeight+"px"}}if(!height){newCss.height="100%"}if(!width){newCss.width="100%"}if(!height||!width){newCss.padding="0px"}$elem.css(newCss);return oldCssText}$.fn.showWaitmask=function(config){var $this=$(this),options,originalCssText,$waitmask,defaults=$.waitmask.defaults,height=$this.height(),width=$this.width();if(_.isString(config)){config={text:config}}options=$.extend({},defaults,config);if(config&&config.spinOptions){$.extend(options.spinOptions,config.spinOptions)}$waitmask=$this.find(options.className);if(!$waitmask.length){$waitmask=_createWaitmask(options);$this.append($waitmask)}originalCssText=_modifyElemCss(this,height,width,options);this.data("originalCssText",originalCssText);$waitmask.css({opacity:options.opacity,top:$this.scrollTop(),left:$this.scrollLeft(),right:Math.ceil(height/2),bottom:Math.ceil(width/2)}).spin(options.spinOptions);if(options.text){$waitmask.find(".spinner").addClass("text-offset")}return this};$.fn.setMaskText=function(text){$(this).find("p").text(text)};$.fn.hideWaitmask=function(){var $this=$(this),oldCssText=this.data("originalCssText")||"";$this.attr("style",oldCssText);$this.removeData("originalCss");$this.find(".waitmask").spin(false).remove();return this}})($,_);define("lib/jquery.waitmask",function(){});define("css!css/waitmask.css",["css!css/compiled.css"],function(){});define("src/packages/waitmask",["src/packages/spin","lib/jquery.waitmask","css!css/waitmask.css"],function(){"use strict"});(function($){$.fn.drag=function(str,arg,opts){var type=typeof str=="string"?str:"",fn=$.isFunction(str)?str:$.isFunction(arg)?arg:null;if(type.indexOf("drag")!==0)type="drag"+type;opts=(str==fn?arg:opts)||{};return fn?this.on(type,opts,fn):this.trigger(type)};var $event=$.event,$special=$event.special,drag=$special.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:false,drop:true,click:false},datakey:"dragdata",noBubble:true,add:function add(obj){var data=$.data(this,drag.datakey),opts=obj.data||{};data.related+=1;$.each(drag.defaults,function(key,def){if(opts[key]!==undefined)data[key]=opts[key]})},remove:function remove(){$.data(this,drag.datakey).related-=1},setup:function setup(){if($.data(this,drag.datakey))return;var data=$.extend({related:0},drag.defaults);$.data(this,drag.datakey,data);$event.add(this,"touchstart mousedown",drag.init,data);if(this.attachEvent)this.attachEvent("ondragstart",drag.dontstart)},teardown:function teardown(){var data=$.data(this,drag.datakey)||{};if(data.related)return;$.removeData(this,drag.datakey);$event.remove(this,"touchstart mousedown",drag.init);drag.textselect(true);if(this.detachEvent)this.detachEvent("ondragstart",drag.dontstart)},init:function init(event){if(drag.touched)return;var dd=event.data,results;if(event.which!=0&&dd.which>0&&event.which!=dd.which)return;if($(event.target).is(dd.not))return;if(dd.handle&&!$(event.target).closest(dd.handle,event.currentTarget).length)return;drag.touched=event.type=="touchstart"?this:null;dd.propagates=1;dd.mousedown=this;dd.interactions=[drag.interaction(this,dd)];dd.target=event.target;dd.pageX=event.pageX;dd.pageY=event.pageY;dd.dragging=null;results=drag.hijack(event,"draginit",dd);if(!dd.propagates)return;results=drag.flatten(results);if(results&&results.length){dd.interactions=[];$.each(results,function(){dd.interactions.push(drag.interaction(this,dd))})}dd.propagates=dd.interactions.length;if(dd.drop!==false&&$special.drop)$special.drop.handler(event,dd);drag.textselect(false);if(drag.touched)$event.add(drag.touched,"touchmove touchend",drag.handler,dd);else $event.add(document,"mousemove mouseup",drag.handler,dd);if(!drag.touched||dd.live)return false},interaction:function interaction(elem,dd){var offset=$(elem)[dd.relative?"position":"offset"]()||{top:0,left:0};return{drag:elem,callback:new drag.callback,droppable:[],offset:offset}},handler:function handler(event){var dd=event.data;switch(event.type){case!dd.dragging&&"touchmove":event.preventDefault();case!dd.dragging&&"mousemove":if(Math.pow(event.pageX-dd.pageX,2)+Math.pow(event.pageY-dd.pageY,2)<Math.pow(dd.distance,2))break;event.target=dd.target;drag.hijack(event,"dragstart",dd);if(dd.propagates)dd.dragging=true;case"touchmove":event.preventDefault();case"mousemove":if(dd.dragging){drag.hijack(event,"drag",dd);if(dd.propagates){if(dd.drop!==false&&$special.drop)$special.drop.handler(event,dd);break}event.type="mouseup"}case"touchend":case"mouseup":default:if(drag.touched)$event.remove(drag.touched,"touchmove touchend",drag.handler);else $event.remove(document,"mousemove mouseup",drag.handler);if(dd.dragging){if(dd.drop!==false&&$special.drop)$special.drop.handler(event,dd);drag.hijack(event,"dragend",dd)}drag.textselect(true);if(dd.click===false&&dd.dragging)$.data(dd.mousedown,"suppress.click",(new Date).getTime()+5);dd.dragging=drag.touched=false;break}},hijack:function hijack(event,type,dd,x,elem){if(!dd)return;var orig={event:event.originalEvent,type:event.type},mode=type.indexOf("drop")?"drag":"drop",result,i=x||0,ia,$elems,callback,len=!isNaN(x)?x:dd.interactions.length;event.type=type;var noop=function noop(){};event.originalEvent=new jQuery.Event(orig.event,{preventDefault:noop,stopPropagation:noop,stopImmediatePropagation:noop});dd.results=[];do{if(ia=dd.interactions[i]){if(type!=="dragend"&&ia.cancelled)continue;callback=drag.properties(event,dd,ia);ia.results=[];$(elem||ia[mode]||dd.droppable).each(function(p,subject){callback.target=subject;event.isPropagationStopped=function(){return false};result=subject?$event.dispatch.call(subject,event,callback):null;if(result===false){if(mode=="drag"){ia.cancelled=true;dd.propagates-=1}if(type=="drop"){ia[mode][p]=null}}else if(type=="dropinit")ia.droppable.push(drag.element(result)||subject);if(type=="dragstart")ia.proxy=$(drag.element(result)||ia.drag)[0];ia.results.push(result);delete event.result;if(type!=="dropinit")return result});dd.results[i]=drag.flatten(ia.results);if(type=="dropinit")ia.droppable=drag.flatten(ia.droppable);if(type=="dragstart"&&!ia.cancelled)callback.update()}}while(++i<len);event.type=orig.type;event.originalEvent=orig.event;return drag.flatten(dd.results)},properties:function properties(event,dd,ia){var obj=ia.callback;obj.drag=ia.drag;obj.proxy=ia.proxy||ia.drag;obj.startX=dd.pageX;obj.startY=dd.pageY;obj.deltaX=event.pageX-dd.pageX;obj.deltaY=event.pageY-dd.pageY;obj.originalX=ia.offset.left;obj.originalY=ia.offset.top;obj.offsetX=obj.originalX+obj.deltaX;obj.offsetY=obj.originalY+obj.deltaY;obj.drop=drag.flatten((ia.drop||[]).slice());obj.available=drag.flatten((ia.droppable||[]).slice());return obj},element:function element(arg){if(arg&&(arg.jquery||arg.nodeType==1))return arg},flatten:function flatten(arr){return $.map(arr,function(member){return member&&member.jquery?$.makeArray(member):member&&member.length?drag.flatten(member):member})},textselect:function textselect(bool){$(document)[bool?"off":"on"]("selectstart",drag.dontstart).css("MozUserSelect",bool?"":"none");document.unselectable=bool?"off":"on"},dontstart:function dontstart(){return false},callback:function callback(){}};drag.callback.prototype={update:function update(){if($special.drop&&this.available.length)$.each(this.available,function(i){$special.drop.locate(this,i)})}};var $dispatch=$event.dispatch;$event.dispatch=function(event){if($.data(this,"suppress."+event.type)-(new Date).getTime()>0){$.removeData(this,"suppress."+event.type);return}return $dispatch.apply(this,arguments)};$special.draginit=$special.dragstart=$special.dragend=drag})(jQuery);define("lib/jquery.event.drag-2.2",function(global){return function(){var ret,fn;return ret||global.jQuery.fn.drag}}(this));(function($){$.tools=$.tools||{version:"@VERSION"};$.tools.overlay={addEffect:function(name,loadFn,closeFn){effects[name]=[loadFn,closeFn]},conf:{close:null,closeOnClick:true,closeOnEsc:true,closeSpeed:"fast",effect:"default",fixed:true,left:"center",load:false,mask:null,oneInstance:true,speed:"normal",target:null,top:"10%"}};var instances=[],effects={};$.tools.overlay.addEffect("default",function(pos,onLoad){var conf=this.getConf(),w=$(window);if(!conf.fixed){pos.top+=w.scrollTop();pos.left+=w.scrollLeft()}pos.position=conf.fixed?"fixed":"absolute";this.getOverlay().css(pos).fadeIn(conf.speed,onLoad)},function(onClose){this.getOverlay().fadeOut(this.getConf().closeSpeed,onClose)});function Overlay(trigger,conf){var self=this,fire=trigger.add(self),w=$(window),closers,overlay,opened,maskConf=$.tools.expose&&(conf.mask||conf.expose),uid=Math.random().toString().slice(10);if(maskConf){if(typeof maskConf=="string"){maskConf={color:maskConf}}maskConf.closeOnClick=maskConf.closeOnEsc=false}var jq=conf.target||trigger.attr("rel");overlay=jq?$(jq):null||trigger;if(!overlay.length){throw"Could not find Overlay: "+jq}if(trigger&&trigger.index(overlay)==-1){trigger.click(function(e){self.load(e);return e.preventDefault()})}$.extend(self,{load:function(e){if(self.isOpened()){return self}var eff=effects[conf.effect];if(!eff){throw'Overlay: cannot find effect : "'+conf.effect+'"'}if(conf.oneInstance){$.each(instances,function(){this.close(e)})}e=e||$.Event();e.type="onBeforeLoad";fire.trigger(e);if(e.isDefaultPrevented()){return self}opened=true;if(maskConf){$(overlay).expose(maskConf)}var top=conf.top,left=conf.left,oWidth=overlay.outerWidth(true),oHeight=overlay.outerHeight(true);if(typeof top=="string"){top=top=="center"?Math.max((w.height()-oHeight)/2,0):parseInt(top,10)/100*w.height()}if(left=="center"){left=Math.max((w.width()-oWidth)/2,0)}eff[0].call(self,{top:top,left:left},function(){if(opened){e.type="onLoad";fire.trigger(e)}});if(maskConf&&conf.closeOnClick){$.mask.getMask().one("click",self.close)}if(conf.closeOnClick){$(document).on("click."+uid,function(e){if(!$(e.target).parents(overlay).length){self.close(e)}})}if(conf.closeOnEsc){$(document).on("keydown."+uid,function(e){if(e.keyCode==27){self.close(e)}})}return self},close:function(e){var instanceIndex=instances.indexOf(this);if(instanceIndex>-1){instances.splice(instanceIndex,1)}if(!self.isOpened()){return self}e=e||$.Event();e.type="onBeforeClose";fire.trigger(e);if(e.isDefaultPrevented()){return}opened=false;effects[conf.effect][1].call(self,function(){e.type="onClose";fire.trigger(e)});$(document).off("click."+uid+" keydown."+uid);if(maskConf){$.mask.close()}return self},getOverlay:function(){return overlay},getTrigger:function(){return trigger},getClosers:function(){return closers},isOpened:function(){return opened},getConf:function(){return conf}});$.each("onBeforeLoad,onStart,onLoad,onBeforeClose,onClose".split(","),function(i,name){if($.isFunction(conf[name])){$(self).on(name,conf[name])}self[name]=function(fn){if(fn){$(self).on(name,fn)}return self}});closers=overlay.find(conf.close||".close");if(!closers.length&&!conf.close){closers=$('<a class="close"></a>');overlay.prepend(closers)}closers.click(function(e){self.close(e)});if(conf.load){self.load()}}$.fn.overlay=function(conf){var el=this.data("overlay");if(el){return el}if($.isFunction(conf)){conf={onBeforeLoad:conf}}conf=$.extend(true,{},$.tools.overlay.conf,conf);this.each(function(){el=new Overlay($(this),conf);instances.push(el);$(this).data("overlay",el)});return conf.api?el:this}})(jQuery);define("jquery-tools-overlay",function(){});(function($){$.tools=$.tools||{version:"@VERSION"};var tool;tool=$.tools.expose={conf:{maskId:"exposeMask",loadSpeed:"slow",closeSpeed:"fast",closeOnClick:true,closeOnEsc:true,zIndex:9998,opacity:.8,startOpacity:0,color:"#fff",onLoad:null,onClose:null}};function viewport(){if($("html").hasClass("ie")){var d=$(document).height(),w=$(window).height();return[window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,d-w<20?w:d]}return[$(document).width(),$(document).height()]}function call(fn){if(fn){return fn.call($.mask)}}var mask,exposed,loaded,config,overlayIndex,closingNow=false;$.mask={load:function(conf,els){if(closingNow&&mask){mask.finish()}if(loaded){return this}if(typeof conf=="string"){conf={color:conf}}conf=conf||config;config=conf=$.extend($.extend({},tool.conf),conf);mask=$("#"+conf.maskId);if(!mask.length){mask=$("<div/>").attr("id",conf.maskId);$("body").append(mask)}var size=viewport();mask.css({position:"absolute",top:0,left:0,width:size[0],height:size[1],display:"none",opacity:conf.startOpacity,zIndex:conf.zIndex});if(conf.color){mask.css("backgroundColor",conf.color)}if(call(conf.onBeforeLoad)===false){return this}if(conf.closeOnEsc){$(document).on("keydown.mask",function(e){if(e.keyCode==27){$.mask.close(e)}})}if(conf.closeOnClick){mask.on("click.mask",function(e){$.mask.close(e)})}$(window).on("resize.mask",function(){$.mask.fit()});if(els&&els.length){overlayIndex=els.eq(0).css("zIndex");$.each(els,function(){var el=$(this);if(!/relative|absolute|fixed/i.test(el.css("position"))){el.css("position","relative")}});exposed=els.css({zIndex:Math.max(conf.zIndex+1,overlayIndex=="auto"?0:overlayIndex)})}mask.css({display:"block"}).fadeTo(conf.loadSpeed,conf.opacity,function(){$.mask.fit();call(conf.onLoad);loaded="full"});loaded=true;return this},close:function(){if(loaded){if(call(config.onBeforeClose)===false){return this}closingNow=true;mask.fadeOut(config.closeSpeed,function(){call(config.onClose);if(exposed){exposed.css({zIndex:overlayIndex})}closingNow=false;loaded=false});$(document).off("keydown.mask");mask.off("click.mask");$(window).off("resize.mask")}return this},fit:function(){if(loaded){var size=viewport();mask.css({width:size[0],height:size[1]})}},getMask:function(){return mask},isLoaded:function(fully){return fully?loaded=="full":loaded},getConf:function(){return config},getExposed:function(){return exposed}};$.fn.mask=function(conf){$.mask.load(conf);return this};$.fn.expose=function(conf){$.mask.load(conf,this);return this}})(jQuery);define("jquery-tools-toolbox",function(){});(function($){"use strict";$.fn.makeDraggable=function(options){var $target=$(this);if(!options||!options.dragHandle){throw new Error("options.dragHandle must be specified")}$target.drag("start",function(e,dd){dd.cursor=$(this).css("cursor");dd.offsetTop=parseInt($target.css("marginTop"),10)||0;dd.offsetLeft=parseInt($target.css("marginLeft"),10)||0;dd.limit={top:0};return true},{not:":input,label,li",handle:options.dragHandle,click:true}).drag(function(e,dd){$(this).css({top:Math.max(dd.limit.top,dd.offsetY)-dd.offsetTop,left:dd.offsetX-dd.offsetLeft,cursor:"move"})}).drag("end",function(e,dd){$(this).css({cursor:dd.cursor})})}})($);define("lib/jquery.makeDraggable",function(){});(function($,_){"use strict";var DEFAULT_MODAL_INDEX=9998,currentOverlays=0,currentMasks=0;function zIndex($element){return parseInt($element.css("zIndex"),10)}function getCurrentModal(){var $allModals=$(".modalPlaceholder");var $currentModal=$allModals.eq(0);$allModals.slice(1).each(function(index,modal){var $modal=$(modal);if(zIndex($modal)>zIndex($currentModal)){$currentModal=$modal}});return $currentModal}function closeIf(closeTrigger){var $currentModal=getCurrentModal();var overlay=$currentModal&&$currentModal.data("overlay");if(!overlay){return}if(!overlay.getConf()[closeTrigger]){return}overlay.close()}function closeOnClick(){closeIf("clickToClose")}function closeOnEsc(e){if(e.which!==27){return}closeIf("escToClose")}function calculatePreviousMaskZIndex(){var $prevMask=$.mask.getMask();return $prevMask&&$prevMask.css("zIndex")}function calculateNextPopupZIndex(options,prevMaskZIndex){return options.zIndex||Number(prevMaskZIndex)||DEFAULT_MODAL_INDEX}$.fn.showModal=function(options){options=options||{};var $this=$(this),modalPlaceholder=$('<div class="modalPlaceholder popupframe" />').css({position:"absolute"}),$closeIcon,showMask,minHeight=30,minWidth=30,zIndex=options.zIndex||DEFAULT_MODAL_INDEX,maxHeight,maxWidth,mask,onAfterResize,resize=function resize(){$this.fitToWindow();if(_.isFunction(onAfterResize)){onAfterResize({height:parseInt(modalPlaceholder.height(),10),width:parseInt(modalPlaceholder.width(),10)})}},resizeHandler=_.debounce(function(){if(options.fitToWindow){resize()}if(options.keepCentered||_.isUndefined(options.keepCentered)){$this.centreModal()}if(options.onWindowResize){options.onWindowResize()}}),overlay,prevMaskZIndex;if($this.parent().is(".modalPlaceholder")){return}modalPlaceholder.appendTo("body").html(this);prevMaskZIndex=calculatePreviousMaskZIndex();zIndex=calculateNextPopupZIndex(options,prevMaskZIndex);if(options.className){modalPlaceholder.addClass(options.className)}if(_.isNumber(options.maxHeight)){maxHeight=options.maxHeight}if(_.isNumber(options.maxWidth)){maxWidth=options.maxWidth}if(_.isNumber(options.minHeight)){minHeight=options.minHeight}if(_.isNumber(options.minWidth)){minWidth=options.minWidth}$this.data({minWidth:minWidth,maxWidth:maxWidth,minHeight:minHeight,maxHeight:maxHeight});if(options.fitToWindow===true){resize()}$(window).on("resize",resizeHandler);if(options.draggable){modalPlaceholder.makeDraggable({dragHandle:options.draggable})}if(_.isFunction(options.onAfterResize)){onAfterResize=options.onAfterResize}currentOverlays++;modalPlaceholder.css("zIndex",zIndex+1+currentOverlays);showMask=(!_.isBoolean(options.mask)||options.mask)&&!$.fx.hideMask;if(showMask){mask=_.extend({color:"#000",loadSpeed:$.fn.showModal.loadSpeed||200,closeOnClick:false,closeOnEsc:false,opacity:.6,zIndex:zIndex},options.mask);currentMasks++;$(modalPlaceholder).expose(mask);$.mask.getMask().css("zIndex",zIndex+currentMasks).appendTo("body");$.mask.getMask().off("click.showModal",closeOnClick);$.mask.getMask().on("click.showModal",closeOnClick)}$(document).off("keydown.showModal",closeOnEsc);$(document).on("keydown.showModal",closeOnEsc);overlay=modalPlaceholder.overlay&&modalPlaceholder.overlay({mask:null,close:options.close||undefined,closeOnClick:false,closeOnEsc:false,clickToClose:_.isBoolean(options.closeOnClick)?options.closeOnClick:false,escToClose:_.isBoolean(options.closeOnEsc)?options.closeOnEsc:false,fixed:options.fixed,load:true,oneInstance:options.allowMultipleInstances===false,top:options.top||undefined,left:options.left||undefined,onLoad:function onLoad(){if(options.onLoad){options.onLoad()}},onBeforeClose:function onBeforeClose(){modalPlaceholder.hide()},onClose:function onClose(){if(_.isFunction(resizeHandler)){$(window).off("resize",resizeHandler)}currentOverlays--;if(currentOverlays<1){$(document).off("keydown.showModal",closeOnEsc)}if(mask){currentMasks--;$.mask.getMask().css("zIndex",prevMaskZIndex||zIndex+currentMasks).appendTo("body");if(currentMasks<=0){currentMasks=0;$.mask.getMask().off("click.showModal",closeOnClick);$.mask.close()}}modalPlaceholder.remove();if(options.onClose){options.onClose()}}}).data("overlay");$closeIcon=overlay.getOverlay().children(".close");if(!options.removeCloseIcon){$closeIcon.addClass("popup--close icon-remove singlepadding lightgrey")}else{$closeIcon.remove()}$this.data("overlay",overlay);if(_.isUndefined(options.top)&&_.isUndefined(options.left)){$this.centreModal()}return overlay};$.fn.removeModal=function(callback){var $this=$(this),$placeholder=$this.parent(),overlay=$this.data("overlay");callback=callback||function(){};if(overlay){$placeholder.one("onClose",function(){setTimeout(function(){callback()},210)});overlay.close();$this.removeData("overlay")}else{callback()}};$.fn.centreModal=function(){var $this=$(this),$window=$(window),$modal=$this.parent(),windowHeight=$window.height(),windowWidth=$window.width(),modalHeight=$modal.height(),modalWidth=$modal.width(),windowTop,windowLeft;if(windowHeight>=modalHeight){windowTop=Math.round(windowHeight/2-modalHeight/2)}else{windowTop=0}if(windowWidth>=modalWidth){windowLeft=Math.round(windowWidth/2-modalWidth/2)}else{windowLeft=windowWidth-modalWidth}$this.parent().css({top:windowTop,left:windowLeft})};$.fn.fitToWindow=function(){var modalPlaceholder=this.parent(),$win=$(window),winHeight=$win.height(),winWidth=$win.width(),minHeight=this.data("minHeight")||30,minWidth=this.data("minWidth")||30,maxHeight=this.data("maxHeight"),maxWidth=this.data("maxWidth");winHeight=$win.height();winWidth=$win.width();var availableHeight=parseInt(winHeight*.9,10),availableWidth=parseInt(winWidth*.9,10),h=maxHeight&&maxHeight<availableHeight?maxHeight:availableHeight,w=maxWidth&&maxWidth<availableWidth?maxWidth:availableWidth;h=Math.max(h,minHeight);w=Math.max(w,minWidth);modalPlaceholder.css({height:h+"px",width:w+"px"})};$.fn.fitToContent=function(){var modalPlaceholder=this.parent();modalPlaceholder.css({height:"auto",width:"auto"})}})($,_);define("lib/jquery.showModal",function(){});define("src/packages/modalDialogs",["lib/jquery.event.drag-2.2","jquery-tools-overlay","jquery-tools-toolbox","lib/jquery.makeDraggable","lib/jquery.showModal"],function(){"use strict";return{}});(function($){"use strict";function isEllipsisActive(e){return e.offsetWidth<e.scrollWidth}function hideCustomtips($targetElement){$targetElement.find(".customtip").addBack(".customtip").each(function(){var api=$(this).data("tooltip");if(!api){return}api.hide()});return $targetElement}$.fn.customtip=function(opts){if(opts==="hide"){return hideCustomtips($(this))}opts=opts||{};var optsPosition=opts.position,tipElements,arrowHeight=6,arrowWidth=10,configMap;delete opts.position;configMap={top:{position:"top center",tipClass:"tip-top",arrowTop:function(height){return height-1},arrowLeft:function(width){return(width-arrowWidth)/2}},bottom:{position:"bottom center",tipClass:"tip-bottom",arrowTop:function(){return-arrowHeight+1},arrowLeft:function(width){return(width-arrowWidth)/2}},left:{position:"center left",tipClass:"tip-right",arrowTop:function(height){return(height-arrowWidth)/2},arrowLeft:function(width){return width-1}},right:{position:"center right",tipClass:"tip-left",arrowTop:function(height){return(height-arrowWidth)/2},arrowLeft:function(){return-arrowHeight+1}},"top-left":{position:"top left",tipClass:"tip-top",arrowTop:function(height){return height-1},arrowLeft:function(width){return width-arrowWidth-2},alignRight:true}};return this.each(function(){var $this=$(this),$el=$("#customtip"),$arrow=$('<span id="customtip-arrow"></span>'),oldBeforeShow,oldOnShow;if(!$el.length){$el=$('<div id="customtip" class="tooltip"/>').hide();$el.mouseover(function(){$el.hide()});$("body").on("click.customtip",function(){$el.hide()});$el.appendTo("body")}tipElements=$this.find(".customtip");if($this.hasClass("customtip")){tipElements.push(this)}tipElements.each(function(){var $targetEl=$(this),options,tooltipConfig,title=$targetEl.attr("title"),tipPosition=$targetEl.data("tip-position")||optsPosition;$targetEl.removeData("tooltip");if(title&&!$targetEl.hasClass("customtip-html")){$targetEl.attr("title",_.escape(title))}tooltipConfig=configMap[configMap.hasOwnProperty(tipPosition)?tipPosition:"top"];options=_.extend({position:tooltipConfig.position,tip:$el,delay:0,predelay:150,events:{input:"mouseover, mouseout"},tipClass:tooltipConfig.tipClass,offset:[0,tooltipConfig.alignRight?$targetEl.outerWidth():0]},opts);oldBeforeShow=options.onBeforeShow;options.onBeforeShow=function(e){var $target=$(e.target);this.getTip().css({top:0,left:0});if($target.hasClass("ellipsistooltip")&&!isEllipsisActive(e.target)){return false}$el.removeClass().addClass("tooltip "+options.tipClass);$arrow.css({top:tooltipConfig.arrowTop($el.outerHeight())+"px",left:tooltipConfig.arrowLeft($el.outerWidth())+"px"});$el.wrapInner('<div class="tooltip__content-wrapper" />');$arrow.removeClass().addClass("tip-arrow "+tooltipConfig.tipClass+"-arrow").appendTo($el);if(oldBeforeShow){return oldBeforeShow.apply(this,arguments)}return true};oldOnShow=options.onShow;options.onShow=function(){var newArrowTop=tooltipConfig.arrowTop($el.outerHeight()),actualArrowTop=$arrow.position().top,gap=newArrowTop-actualArrowTop;if(tooltipConfig.position.indexOf("top")>-1&&gap){$arrow.css("top",newArrowTop+"px");$el.css("top",$el.position().top-gap+"px")}if(oldOnShow){return oldOnShow.apply(this,arguments)}return true};$targetEl.tooltip(options)})})}})($);define("customtip",["jquery","jquery-tools-tooltip"],function(global){return function(){var ret,fn;return ret||global.jQuery.fn.customtip}}(this));define("css!customtip-source/src/css/customtip.css",["css!customtip-source/src/css/compiled.css"],function(){});define("src/packages/customtip",["customtip","css!customtip-source/src/css/customtip.css"],function(){"use strict"});(function($,_){"use strict";$.notify=function(options){if(_.isString(options)){options={text:options,duration:_.isNumber(arguments[1])?arguments[1]:5e3}}options=_.defaults({},options,{duration:5e3});var $el=$('<div class="notificationBubble rounded smallpadding-vertical singlepadding-horizontal" />').text(options.text);$el.css({position:"absolute",display:"inline-block",top:-1e3}).addClass(options.className||"notification-info").appendTo("body");$el.css({top:-$el.height(),left:$(window).width()/2-$el.width()/2});$el.animate({top:36},"fast");setTimeout(function(){$el.fadeOut(function(){$el.remove()})},options.duration||5e3);return $el}})($,_);define("lib/jquery.notify",function(){});define("src/views/MyAccountDetailsView",["underscore","jquery","src/permissions","src/views/ValidatingFormView","src/models/UserDetails","src/helpers/gravatarHelper","src/events/administrationEvents","mustache!templates/editMyAccountDetails","css!css/clientUserAdminForms.css","src/packages/waitmask","src/packages/modalDialogs","src/packages/customtip","lib/jquery.notify"],function(_,$,permissions,ValidatingFormView,UserDetails,gravatarHelper,administrationEvents,template){"use strict";var MyAccountDetailsView=ValidatingFormView.extend({className:"myAccountDetails clientUserAdminForm modular",events:{"click .save":"onSave","click .cancel":"onRemove"},initialize:function initialize(options){this.model=this.model||new UserDetails;ValidatingFormView.prototype.initialize.call(this,options)},remove:function remove(){this.$el.removeModal();ValidatingFormView.prototype.remove.call(this)},render:function render(){var self=this,$el=this.$el;this.$el.showWaitmask("Loading...");this.model.fetch({success:function success(){var data=_.extend(self.model.toJSON(),{canSeeAdminLink:permissions.check("see.usageSummary")||permissions.check("see.legacyUsageSummary"),avatarUrl:gravatarHelper.getLoggedUserGravatarUrl(32)});$el.hideWaitmask();$el.html(template(data));$el.centreModal();$el.find(".js-avatar").customtip()},error:function error(){$.notify({text:"Error while loading data.",className:"notification-error"});self.remove()}})},onSave:function onSave(e){e.preventDefault();this.save()},onRemove:function onRemove(){this.remove()},save:function save(){var self=this,model=this.model,saveObj={email:this.$('input[name="email"]').val(),oldPassword:this.$('input[name="oldPassword"]').val(),password:this.$('input[name="password"]').val(),passwordConfirmation:this.$('input[name="passwordConfirmation"]').val(),firstName:this.$('input[name="firstName"]').val(),lastName:this.$('input[name="lastName"]').val(),job:this.$('input[name="job"]').val(),department:this.$('input[name="department"]').val(),address:this.$('textarea[name="address"]').val(),phone:this.$('input[name="contactPhone"]').val(),mobile:this.$('input[name="contactMobile"]').val()};if(_.trim(saveObj.password)===""){saveObj.password=null}if(_.trim(saveObj.passwordConfirmation)===""){saveObj.passwordConfirmation=null}this.$("button.save").prop("disabled",true);this.$("form").showWaitmask({text:"Saving...",opacity:.7});model.save(saveObj,{success:function success(){self.$("form").hideWaitmask();self.remove();if(saveObj.password&&saveObj.passwordConfirmation){administrationEvents.trigger("password-changed")}},error:function error(model,response){self.$("form").hideWaitmask();self.$("button.save").prop("disabled",false);self.onServerError(model,response)}});if(model.validationError){self.$("form").spin(false);self.$("button.save").prop("disabled",false);self.$("form").hideWaitmask()}}},{show:function show(options){var view=new MyAccountDetailsView(options);view.render();view.$el.showModal({draggable:"h1:first",className:"popup smallpopup",allowMultipleInstances:true,onClose:function onClose(){view.remove()}});return view}});return MyAccountDetailsView});define("mustache!templates/navigation/helpMenu",["lib/mustache"],function(mustache){var escapedTemplate='\n<a class="dropdown-toggle link" data-toggle="dropdown">Help and Support<span class="icon-chevron-down"></a>\n<ul class="dropdown-menu context-menu popupframe modular threecol">\n<li><a class="context-menu--item dib fullwidth supportPortal" href="/supportsso?return_to=https%3A%2F%2Fsupport.brandwatch.com%2Fhc%2Fen-us%2Fcategories%2F200197023" target="_blank">Help Center<span class="icon-external-link grey smallpadding-left"></span></a></li>\n<li><a class="context-menu--item dib fullwidth supportRequest" href="/supportsso?return_to=https%3A%2F%2Fsupport.brandwatch.com%2Fhc%2Frequests%2Fnew" target="_blank">Contact Support<span class="icon-external-link grey smallpadding-left"></span></a></li>\n<li><a class="context-menu--item dib fullwidth supportPlatformStatus" href="https://status.brandwatch.com/" target="_blank">Platform Status<span class="icon-external-link grey smallpadding-left"></span></a></li>\n</ul>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});!function($){"use strict";var toggle='[data-toggle="dropdown"]',Dropdown=function Dropdown(element){var $el=$(element).on("click.dropdown.data-api",this.toggle);$("html").on("click.dropdown.data-api",function(){$el.parent().removeClass("open")})};Dropdown.prototype={constructor:Dropdown,toggle:function toggle(e){var $this=$(this),selector=$this.attr("data-target"),$parent,isActive;if(!selector){selector=$this.attr("href");selector=selector&&selector.replace(/.*(?=#[^\s]*$)/,"")}$parent=$(selector);$parent.length||($parent=$this.parent());isActive=$parent.hasClass("open");clearMenus();!isActive&&$parent.toggleClass("open");return false}};function clearMenus(){$(toggle).parent().removeClass("open")}$.fn.dropdown=function(option){return this.each(function(){var $this=$(this),data=$this.data("dropdown");if(!data)$this.data("dropdown",data=new Dropdown(this));if(typeof option=="string")data[option].call($this)})};$.fn.dropdown.Constructor=Dropdown;$(function(){$("html").on("click.dropdown.data-api",clearMenus);$("body").on("click.dropdown.data-api",toggle,Dropdown.prototype.toggle)})}(window.jQuery);define("lib/twitter-bootstrap/bootstrap-dropdown",function(){});define("css!css/dropdownmenu.css",["css!css/compiled.css"],function(){});define("src/packages/dropdownmenus",["lib/twitter-bootstrap/bootstrap-dropdown","css!css/dropdownmenu.css"],function(){"use strict"});define("src/views/navigation/HelpMenuView",["backbone","src/globals/theme","mustache!templates/navigation/helpMenu","src/packages/dropdownmenus"],function(Backbone,theme,helpCenterMenuTemplate){"use strict";return Backbone.View.extend({tagName:"li",className:"headermenu--item support dropdown",constructor:function HelpMenuView(){Backbone.View.apply(this,arguments)},getHelpMenuOptions:function getHelpMenuOptions(){return{mailto:theme.contactEmail||"support@brandwatch.com",productName:theme.productName||"support@brandwatch.com",canSeeFeedbackLink:theme.canSeeFeedbackLink,feedbackUrl:theme.feedbackUrl}},render:function render(){var data=this.getHelpMenuOptions();this.$el.html(helpCenterMenuTemplate(data))}})});define("css!css/reactAppLoader.css",["css!css/compiled.css"],function(){});function _typeof(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}define("src/ReactAppLoader",["backbone","src/analytics/Analytics","src/globals/flags","src/helpers/appSettingsHelper","css!css/reactAppLoader.css"],function(Backbone,Analytics,flags,appSettingsHelper){"use strict";return Backbone.View.extend({className:"ax-wrapper",constructor:function constructor(key){Backbone.View.apply(this,arguments);this.validateAppKey(key)},validateAppKey:function validateAppKey(key){if(_typeof(window.ReactApps)!=="object"){throw new Error("React Apps not loaded!")}this.app=window.ReactApps[key];if(!this.app){throw new Error('There is no react app with name "'.concat(key,'"!'))}},render:function render(){var props=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.app.render({appSettings:appSettingsHelper.json(),el:this.el,flagsClient:flags,tracking:Analytics,props:props})},remove:function remove(){this.app.remove(this.el)}})});define("src/events/facebookCoverageEvents",["backbone","underscore"],function(Backbone,_){"use strict";return _.clone(Backbone.Events)});define("src/mixins/mixin",[],function(){"use strict";return function mixin(Constructor,mixinFn){return mixinFn.call(Constructor.prototype,Constructor)}});define("src/mixins/withPopup",["underscore","src/packages/modalDialogs"],function(_){"use strict";return function withPopup(){this.showAsPopup=function(opts){var options=_.extend({},opts);var oldRemove=this.remove.bind(this);if(options.onClose){options.onClose=function(){oldRemove();opts.onClose()}}var modalOptions=_.extend({draggable:".draggable",className:"popup standardpopup",onClose:oldRemove},options);this.$el.showModal(modalOptions);this.remove=function(){this.$el.removeModal()}}}});(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==="object"&&typeof module==="object")module.exports=factory();else if(typeof define==="function"&&define.amd)define("bw-fe-helpers/windowHelper",[],factory);else{var a=factory();for(var i in a)(typeof exports==="object"?exports:root)[i]=a[i]}})(this,function(){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=48)}({48:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);function _typeof(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}var exportObject={};var hasWindow=(typeof window==="undefined"?"undefined":_typeof(window))==="object"&&window!==null&&window.self===window;if(hasWindow){var windowObject=window;exportObject={_setWindow:function _setWindow(newWindow){windowObject=newWindow||window},getWindow:function getWindow(){return windowObject},open:function open(url,target,options){return windowObject.open(url,target,options)}}}__webpack_exports__["default"]=exportObject}})["default"]});(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==="object"&&typeof module==="object")module.exports=factory(require("underscore"));else if(typeof define==="function"&&define.amd)define("bw-fe-helpers/urlHelper",["underscore"],factory);else{var a=typeof exports==="object"?factory(require("underscore")):factory(root["underscore"]);for(var i in a)(typeof exports==="object"?exports:root)[i]=a[i]}})(this,function(__WEBPACK_EXTERNAL_MODULE__1__){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=46)}({1:function(module,exports){module.exports=__WEBPACK_EXTERNAL_MODULE__1__},46:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var underscore__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1);var underscore__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(underscore__WEBPACK_IMPORTED_MODULE_0__);__webpack_exports__["default"]={getHash:function getHash(url){var hash=url||location.hash,pos=hash.lastIndexOf("#");if(pos>=0){return hash.substr(pos+1)}return""},trimHash:function trimHash(path){if(!path){return path}var pos=path.indexOf("#");if(pos>=0){return path.substr(0,pos)}return path},getSearch:function getSearch(){return window.location.search||window.location.hash.replace(/^[^?]*\?/,"")},parseQuery:function parseQuery(str){return underscore__WEBPACK_IMPORTED_MODULE_0___default()(str.replace(/^\??/,"").split("&")).reduce(function(memo,pair){var parts=pair.split("=");memo[unescape(parts[0])]=unescape(parts.slice(1).join("="));return memo},{})},createQuery:function createQuery(options){var query="";underscore__WEBPACK_IMPORTED_MODULE_0___default.a.each(options,function(value,key){if(!underscore__WEBPACK_IMPORTED_MODULE_0___default.a.isUndefined(value)){if(query.length){query+="&"}if(value===null){value=""}query+=encodeURIComponent(key)+"="+encodeURIComponent(value)}});return query},removeProtocolAndWwwSubdomain:function removeProtocolAndWwwSubdomain(url){return url.replace(/^(https?:\/\/)?(www\d*\.)?/i,"")},trimTrailingSlash:function trimTrailingSlash(url){return url.replace(/\/$/i,"")},buildFullURL:function buildFullURL(pathAndParams){var location=window.location,origin=location.protocol+"//"+location.host;return origin+pathAndParams},reloadURL:function reloadURL(forceReload){window.location.reload(forceReload)},removeProtocol:function removeProtocol(url){return url.replace(/^https?:/i,"")}}}})["default"]});define("src/helpers/fbTokenServiceHelper",["jquery","bw-fe-helpers/windowHelper","bw-fe-helpers/urlHelper","src/globals/me","src/globals/theme","src/helpers/appSettingsHelper"],function($,windowHelper,urlHelper,me,theme,appSettingsHelper){"use strict";function request(options){var method=options.method,path=options.path,data=options.data,_options$callback=options.callback,callback=_options$callback===void 0?function(){}:_options$callback;$.ajax({type:method,dataType:"json",contentType:"application/json",url:"/facebookapi/".concat(path),data:JSON.stringify(data),success:function success(response){callback(undefined,response)},error:function error(_error){callback(_error)}})}function sendInvite(options){var email=options.email,emailBody=options.emailBody,callback=options.callback;var domain=windowHelper.getWindow().location.origin;var isWhitelabel=!theme.isBrandwatchOrGreyLabelTheme();var data={domain:domain,email:email,emailBody:emailBody,isWhitelabel:isWhitelabel};if(options.clientId){data.clientId=options.clientId}request({method:"POST",path:"invite",data:data,callback:callback})}function fetchInviteLink(_callback,customClientId){var clientId=customClientId||me.get("client").id;request({method:"GET",path:"invite/path/".concat(clientId),callback:function callback(err,response){if(err){_callback(err);return}var invitePath=response.invitePath;_callback(undefined,urlHelper.buildFullURL(invitePath))}})}function storeAccessToken(accessToken,facebookAppId){var _me$get=me.get("client"),clientId=_me$get.id;if(appSettingsHelper.get("became")){return}request({method:"POST",path:"clients/".concat(clientId,"/tokens"),data:{accessToken:accessToken,facebookAppId:facebookAppId}})}function fetchPageDetails(pageId,_callback2){request({method:"GET",path:"page/".concat(pageId),callback:function callback(err,response){if(err){_callback2(err);return}_callback2(undefined,response)}})}return{sendInvite:sendInvite,fetchInviteLink:fetchInviteLink,fetchPageDetails:fetchPageDetails,storeAccessToken:storeAccessToken}});(function($,_){"use strict";var buildNotificationItemHtml=function buildNotificationItemHtml(text,hasActions){var actionsContainer=hasActions?'<ul class="actions dib"></ul>':"";return'<li class="notification-item">'+'<span class="notification-item__text">'+text+"</span>"+actionsContainer+"</li>"};var addActionLinksToNotification=function addActionLinksToNotification($notification,actions){var $actions=$notification.find(".actions");actions.forEach(function(action){var $action=$('<a class="action dib">'+action.text+"</a>");$action.on("click",function(e){e.preventDefault();action.action()});$actions.append($action)});$actions.children().wrap('<li class="dib singlemargin-right"/>')};var addDismissAllLink=function addDismissAllLink($notificationsContainer){var isTemporary=$notificationsContainer.hasClass(".temporary-notifications");var hasDismissLink=$notificationsContainer.find(".notifications-dismiss-all").length===1;if(isTemporary||hasDismissLink){return}var $notifications=$notificationsContainer.find(".notification");var hasMoreThanOneNotification=$notifications.length>1;if(hasMoreThanOneNotification){var $dismissAllLink=$('<a class="notifications-dismiss-all smallmargin-bottom">Dismiss All</a>');$dismissAllLink.on("click",function(){$(this).parent().find(".close").click();$dismissAllLink.remove()});$notificationsContainer.prepend($dismissAllLink)}};$.fn.hasSameNotificationHeader=function(headerText){headerText=headerText||"";var $notification=$(this);var $header=$notification.find(".notification-header");return $header.text().trim()===headerText.trim()};$.fn.hasSameNotification=function(headerText,bodyText){var $notificationsContainer=$(this);var $foundNotifications=$notificationsContainer.find(".notification").filter(function(){var $notification=$(this);var $header=$notification.find(".notification-header");var $text=$notification.find(".notification-item__text");var hasHeader=$header.length>0;var hasSameHeader=$header.hasSameNotificationHeader(headerText);var hasSameText=$text.text().trim()===bodyText.trim();return hasHeader?hasSameHeader&&hasSameText:hasSameText});return $foundNotifications.length>0};$.fn.appendNotification=function(options){var $notification=$(this);var $notificationItems=$notification.find(".notification-items");var actions=options.actions;var hasActions=!_.isEmpty(actions);var newNotificationItem=buildNotificationItemHtml(options.text,hasActions);var $newNotificationItem=$(newNotificationItem);hasActions&&addActionLinksToNotification($newNotificationItem,actions);$notificationItems.append($newNotificationItem);var hasOneNotification=$notificationItems.find(".notification-item").length===1;$notificationItems.toggleClass("notification-items--single-line",hasOneNotification)};$.fn.showNotification=function(options){var self=this;var $notificationsContainer=$(this);var text=options.text;var actions=options.actions;var cssClass=options.cssClass||"notification-info";var duration=options.duration;var isTemporary=!!duration;var omitClose=!!options.omitClose;var onShown=_.isFunction(options.onShown)?options.onShown:_.noop;var onRemoved=_.isFunction(options.onRemoved)?options.onRemoved:_.noop;var showDuplicates=options.showDuplicates||false;var headerText=options.headerText||"";var buildNotificationHtml=function buildNotificationHtml(){var cssClasses=cssClass+" bigline notification rounded smallpadding-vertical singlepadding-horizontal relative clearright";var closeButton=omitClose?"":'<a class="close iconsmaller icon-remove absright smallmargin-top singlemargin-right"></a>';var header=headerText?'<div class="notification-header floatleft">'+headerText+"&nbsp;</div>":"";var $notification=$('<div class="'+cssClasses+'">'+header+'<ul class="notification-items notification-items--single-line floatleft"></ul>'+'<div class="clearleft"></div>'+closeButton+"</div>");$notification.appendNotification({text:text,actions:actions});return $notification};var removeNotification=function removeNotification(options){options=options||{};var $notification=options.notification||$notificationsContainer.find(".notification");var callback=options.callback||_.noop;var removeFunc=function removeFunc(){$notification.remove();var $notifications=$notificationsContainer.find(".notification");if($notifications.length===1){$notificationsContainer.find(".notifications-dismiss-all").remove()}onRemoved();callback()};if(!$notification.length){return callback()}if(self._removeNotificationTimeout){clearTimeout(self._removeNotificationTimeout);self._removeNotificationTimeout=undefined}if(options.fadeOut===false){return removeFunc()}return $notification.addClass("fadeOut").one("transitionend webkitTransitionEnd oTransitionEnd",removeFunc)};var addNotification=function addNotification(){var hasSameNotification=$notificationsContainer.hasSameNotification(headerText,text);if(!showDuplicates&&hasSameNotification){return}var $notification=buildNotificationHtml();$notificationsContainer.append($notification);addDismissAllLink($notificationsContainer);$notification.find(".close").on("click",function(e){e.preventDefault();removeNotification({notification:$(e.currentTarget).closest(".notification"),fadeOut:false})});if(isTemporary){self._removeNotificationTimeout=setTimeout(removeNotification,duration)}onShown($notificationsContainer)};if(isTemporary){return removeNotification({fadeOut:false,callback:addNotification})}return addNotification()}})($,_);define("lib/jquery.showNotification",function(){});define("src/helpers/notificationsHelper",["jquery","underscore","lib/jquery.showNotification"],function($,_){"use strict";var findSameAppendableNotification=function findSameAppendableNotification($container,headerText){return $container.find(".notification").filter(function(){var $notification=$(this);return $notification.hasSameNotificationHeader(headerText)})};var helper={showTemporaryNotification:function showTemporaryNotification($element,options){var $notificationsContainer=$element.find(".temporary-notifications");$notificationsContainer.showNotification(_.extend({duration:5e3,cssClass:options.type||"notification-success"},options))},showPermanentNotification:function showPermanentNotification($element,options){var $notificationsContainer=$element.find(".notifications");$notificationsContainer.showNotification(_.extend({cssClass:options.type},options))},showAppendablePermanentNotification:function showAppendablePermanentNotification($element,options){var $notificationsContainer=$element.find(".notifications");var isAppendable=!!options.headerText;if(!isAppendable){console.error("For appendable notifications you need a headerText. Showing a simple notification instead");this.showPermanentNotification($element,options);return}var $foundNotification=findSameAppendableNotification($notificationsContainer,options.headerText);var notificationNotFound=$foundNotification.length===0;if(notificationNotFound){this.showPermanentNotification($element,options);return}$foundNotification.appendNotification(options)}};return helper});define("src/keyCodes",[],function(){"use strict";return{TAB:9,ENTER:13,ESCAPE:27,DELETE:8,COMMA:188,SPACE:32,UP:38,DOWN:40}});define("src/helpers/tagsInputViewHelper",["jquery"],function($){"use strict";function getStyle(el){if(el instanceof $){el=el.get(0)}if(!document.body.contains(el)){throw new Error("el must be attached the to DOM to get the correct style values")}return window.getComputedStyle(el)}function getBoundingClientRect(el){if(el instanceof $){el=el.get(0)}if(!document.body.contains(el)){throw new Error("el must be attached the to DOM to get the correct rect values")}return el.getBoundingClientRect()}function getHorizontalPadding(el){var style=getStyle(el);var lpad=parseInt(style["padding-left"]||style.paddingLeft,10);var rpad=parseInt(style["padding-right"]||style.paddingRight,10);return lpad+rpad}function getRemainingWidthLeft($el,$parent){var elElm=$el.get(0);var parentElm=$parent.get(0);var parentRect=getBoundingClientRect(parentElm);var elRect=getBoundingClientRect(elElm);var leftPos=elRect.left-parentRect.left;var padding=getHorizontalPadding(parentElm);return parentRect.width-leftPos-padding}function listenForEndOfContainer($el,$sizer,$parent){var parentElm=$parent.get(0);var elWidth=getBoundingClientRect($el).width;var sizerWidth=getBoundingClientRect($sizer).width;var fontSize=parseInt(getStyle($el).fontSize,10);var parentWidth=getBoundingClientRect(parentElm).width;var padding=getHorizontalPadding(parentElm);var max=parentWidth-padding;if(sizerWidth+fontSize>elWidth){return max}}function escapeTag(tagName){return tagName.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}return{getRemainingWidthLeft:getRemainingWidthLeft,listenForEndOfContainer:listenForEndOfContainer,escapeTag:escapeTag}});define("src/components/mentions/views/TagsInputView",["backbone","underscore","jquery","src/keyCodes","src/helpers/tagsInputViewHelper","src/helpers/validationTooltipHelper"],function(Backbone,_,$,keyCodes,tagsInputViewHelper,validationTooltipHelper){"use strict";var defaultCallback=function defaultCallback(tagName,callback){callback()};function renderTag(tag){var tagValue=_.escape(tag);return'<li data-tagname="'+tagValue+'" class="tag-item js-tag-item">'+'<a class="remove icon-remove"></a><span>'+tagValue+"</span></li>"}function renderTagInput(){return'<li><input type=text name="tagInput" class="tag-input field validation-wrapper" /></li>'}function showAutoComplete(view){if(!view.hasAutoComplete){return}view.$el.append(view.$autocomplete)}function resizeInputField(view){var width;var $input=view.$("input");var $tagsList=view.$(".tagsList");$input.css("width",0);width=tagsInputViewHelper.getRemainingWidthLeft($input,$tagsList);$input.css("width",width)}function createSizerElement(){return $('<span class="tag-input-hidden-sizer"></span>')}function appendSizerElement(view){if(!view.el.contains(view.$sizer.get(0))){view.$el.append(view.$sizer)}}function listenForEndOfContainer(view){var width;var $input=view.$("input");var $tagsList=view.$(".tagsList");view.$sizer.text($input.val());width=tagsInputViewHelper.listenForEndOfContainer($input,view.$sizer,$tagsList);if(width){$input.css("width",width)}}function updatePlaceholder(view){var isActive=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var placeholder=view.placeholder;if(view.getTags().length>0||!isActive){placeholder=""}view.$("input").attr("placeholder",placeholder)}function updateAutoCompleteWidth(view){if(!view.hasAutoComplete){return}var width=tagsInputViewHelper.getRemainingWidthLeft(view.$autocomplete,view.$(".tagsList"));view.$autocomplete.css("width",width)}function parseOptions(view,options){view.validateInput=typeof options.validateInput==="function"?options.validateInput:function(){};view.placeholder=typeof options.placeholder==="undefined"?"Enter tag":options.placeholder;view.hasAutoComplete=typeof options.hasAutoComplete==="undefined"?true:options.hasAutoComplete;view.autocompleteMatchIfContains=options.autocompleteMatchIfContains;view.canUseBackspace=typeof options.canUseBackspace==="undefined"?true:options.canUseBackspace;view.tagCollection=options.tagCollection;view.tags=options.tags||[];view.onAdd=options.onAdd||defaultCallback;view.onRemove=options.onRemove||defaultCallback;view.duplicateEntryText=options.duplicateEntryText;view.itemType=options.itemType||"tag"}function findTag(view,tagName){var selector='li[data-tagname="'.concat(tagsInputViewHelper.escapeTag(tagName),'"]');return view.$(selector)}function highlightMatch(val,tag){var index=tag.toLowerCase().indexOf(val);return'<li><a class="textellipsis">'+tag.substring(0,index)+"<strong>"+tag.substring(index,index+val.length)+"</strong>"+tag.substring(index+val.length)+"</a></li>"}function renderAllCurrentTags(view){var currentTagsInCollection=view.tagCollection.map(function(tag){return tag.get("name")});var existingTagsInTagsInput=view.getTagsLowerCase();var autocompleteTagsList=_.difference(currentTagsInCollection,existingTagsInTagsInput).sort().map(function(tag){return'<li><a class="textellipsis">'.concat(tag,"</a><li>")});view.$autocomplete.html("<ul>".concat(autocompleteTagsList.join("\n"),"</ul>"))}var TagsInputView=Backbone.View.extend({className:"tagsInput",events:{"click .tagsList":"onComponentClick","click .tagsList li a.remove":"onRemoveTag","focusin input":"onFocusInInput","focusout input":"onFocusOutInput","keyup input":"onKeyupInput","keydown input":"onKeydownInput","click .tagAutocomplete li":"onClickTagName","mousedown .tagAutocomplete":"onMousedownAutocomplete"},onComponentClick:function onComponentClick(){this.$("input").focus()},constructor:function TagsInputView(options){options=options||{};if(options.hasAutoComplete!==false&&!options.tagCollection){throw new TypeError("TagsInputView must be instantiated with a tagCollection option")}if(options.addValueOnBlur){this.events=_.extend({"mousedown .tagsList li a.remove":"beforeOnRemoveTag","mousedown div.tagAutocomplete li":"beforeOnClickTagName","blur input":"onBlur"},this.events)}parseOptions(this,options);this.$autocomplete=$('<div class="tagAutocomplete" />');this.$sizer=createSizerElement();Backbone.View.apply(this,arguments)},remove:function remove(){this.$autocomplete.remove();if(this.$sizer){this.$sizer.remove()}Backbone.View.prototype.remove.call(this)},detach:function detach(){this.$el.detach()},setElement:function setElement(el){Backbone.View.prototype.setElement.call(this,el);showAutoComplete(this)},render:function render(){var $el=this.$el,val=this.$("input").val(),hasFocus=this.$("input").is(":focus");$el.html('<ul class="tagsList field">'+_(this.tags).map(renderTag).join("")+"</ul>");this.$("ul").append(renderTagInput());if(val){this.$("input").val(val)}if(hasFocus){this.$("input").focus()}},setTags:function setTags(tags){if(!_.isArray(tags)){throw new Error("tags must be an array")}this.tags=tags;this.render()},getTags:function getTags(){return this.$(".js-tag-item").map(function(){return $(this).data("tagname").toString()}).get()},getTagsLowerCase:function getTagsLowerCase(){return _(this.getTags()).map(function(tag){return tag.toLowerCase()})},onBlur:function onBlur(){if(this.isRemoveTagInProgress||this.isClickTagNameInProgress){return}this.addCurrentValue()},beforeOnRemoveTag:function beforeOnRemoveTag(){this.isRemoveTagInProgress=true},onRemoveTag:function onRemoveTag(e){e.preventDefault();this.removeTag($(e.target).closest("li").data("tagname").toString());this.isRemoveTagInProgress=false},onFocusInInput:function onFocusInInput(event){event.stopPropagation();event.preventDefault();appendSizerElement(this);updatePlaceholder(this);this.updateAutoComplete();updateAutoCompleteWidth(this);resizeInputField(this);listenForEndOfContainer(this)},onFocusOutInput:function onFocusOutInput(){if(this.ignoreFocusOut){return}updatePlaceholder(this,false);this.$autocomplete.detach()},beforeOnClickTagName:function beforeOnClickTagName(){this.isClickTagNameInProgress=true},onClickTagName:function onClickTagName(e){var originalValue=this.$("input").val();var text=$(e.target).closest("li").text();e.preventDefault();this.ignoreFocusOut=false;this.$("input").val(text);this.addCurrentValue();this.$autocomplete.detach();this.trigger("completionItemAdded",originalValue,text,"click");this.isClickTagNameInProgress=false},onMousedownAutocomplete:function onMousedownAutocomplete(){this.ignoreFocusOut=true},onKeyupInput:function onKeyupInput(e){var view=this;var $autocomplete=view.$autocomplete;var $selected;var value;var tag;value=view.$("input").val().trim();function handleEnter(){var originalValue=value;if(view.hasAutoComplete){$selected=$autocomplete.find("li.selected").removeClass("selected");if($selected.length){value=$selected.text()}tag=view.tagCollection.getByName(value)}view.addTag(tag?tag.get("name"):value);view.trigger("completionItemAdded",originalValue,value,"keyup")}function handleDown(){$selected=$autocomplete.find("li.selected").removeClass("selected");if(!$selected.length||!$selected.next().length){$selected=$autocomplete.find("li").first()}else{$selected=$selected.next()}$selected.addClass("selected");if($selected.length){view.updateScrolling()}}function handleUp(){$selected=$autocomplete.find("li.selected").removeClass("selected");if(!$selected.length||!$selected.prev().length){$selected=$autocomplete.find("li").last()}else{$selected=$selected.prev()}$selected.addClass("selected");if($selected.length){view.updateScrolling()}}if(e.which===keyCodes.ENTER){handleEnter()}else if(this.hasAutoComplete&&e.which===keyCodes.DOWN){handleDown()}else if(this.hasAutoComplete&&e.which===keyCodes.UP){handleUp()}else if(e.which===keyCodes.ESCAPE){this.$("input").blur()}else{view.trigger("inputUpdate",value);this.updateAutoComplete()}},onKeydownInput:function onKeydownInput(e){var view=this;var actionKeys;appendSizerElement(view);function handleDelete(){var lastTagName=view.getLastTagName();if(view.$("input").val().length){return}if(!lastTagName){return}view.removeTag(view.getLastTagName())}actionKeys=[keyCodes.TAB,keyCodes.COMMA];if(actionKeys.indexOf(e.which)>-1){e.preventDefault();view.addCurrentValue()}else if(view.canUseBackspace&&e.which===keyCodes.DELETE){handleDelete()}listenForEndOfContainer(this)},updateScrolling:function updateScrolling(){var $autocomplete=this.$autocomplete,$selected=$autocomplete.find("li.selected"),itemTop=$selected.position().top,scrollOffset=Math.max(itemTop+$autocomplete.scrollTop()-$selected.height()*2,0);$autocomplete.scrollTop(scrollOffset)},updateAutoComplete:function updateAutoComplete(){var val;var view=this;var $input=view.$("input");var $autocomplete=view.$autocomplete;var existingTags=view.getTagsLowerCase();var autocompleteMatcher=view.autocompleteMatchIfContains?_.str.contains:_.startsWith;var autocompleteMatches;if(!view.hasAutoComplete){return}if($input.length){val=$input.val().toLowerCase()}showAutoComplete(this);if(!val){renderAllCurrentTags(this);return}autocompleteMatches=view.tagCollection.map(function(tag){return tag.get("name")}).filter(function(tag){return autocompleteMatcher(tag.toLowerCase(),val)&&!existingTags.includes(tag)}).sort().map(highlightMatch.bind(null,val));if(!autocompleteMatches.length){$autocomplete.html("<p>Press enter to add ".concat(view.itemType,"</p>"));return}$autocomplete.html("<ul>".concat(autocompleteMatches.join("\n"),"</ul>"))},addTag:function addTag(tagName){var $input=this.$("input");var $tagsList=this.$("ul.tagsList");var existing=this.getTagsLowerCase();var validationResult;$input.removeClass("error");validationTooltipHelper.hideError($input);if(!tagName||!tagName.trim().length){return}validationResult=this.validateInput(tagName);if(validationResult){validationTooltipHelper.showError(validationResult,$input);this.$autocomplete.empty();return}if(existing.indexOf(tagName.toLowerCase())===-1){this.$autocomplete.empty();$(renderTag(tagName)).insertBefore($input.parent());$input.val("");resizeInputField(this);updatePlaceholder(this);this.onAdd(tagName,function(err){if(err){$tagsList.find('li[data-tagname="'+tagName+'"]').remove();$input.val(tagName).addClass("error")}})}else{validationTooltipHelper.showError(this.duplicateEntryText||"This tag already exists and has been selected",$input)}},addCurrentValue:function addCurrentValue(){this.addTag(this.$("input").val().trim())},getLastTagName:function getLastTagName(){var $lastTag=this.$("li[data-tagname]").last();if($lastTag.length){return $lastTag.data("tagname").toString()}},removeTag:function removeTag(tagName){var view=this;var $tag=findTag(this,tagName);$tag.removeClass("error").addClass("waiting");this.onRemove(tagName,function(err){if(err){$tag.removeClass("waiting").addClass("error");return}$tag.remove();resizeInputField(view);updatePlaceholder(view)})}},{renderTag:renderTag,renderTagInput:renderTagInput});return TagsInputView});define("mustache!templates/inviteFacebookUsers/emailPreview",["lib/mustache"],function(mustache){var escapedTemplate='<h3 class="fc-preview__headline">E-Mail Preview</h3>\n<div class="fc-preview__text">\n{{#isBrandwatchOrGreyLabelTheme}}\n<img src="/img/facebook-coverage-email-logo.png" class="fc-preview__logo" />\n{{/isBrandwatchOrGreyLabelTheme}}\n<div class="js-emailBody"></div>\n<span class="fc-preview__link"><span class="fc-preview__link-icon"></span><span class="fc-preview__link-text">Click here to Authenticate with Facebook</span></span>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!css/emailPreview.css",["css!css/compiled.css"],function(){});define("src/views/invitefacebookusers/EmailPreviewView",["backbone","underscore","src/globals/theme","mustache!templates/inviteFacebookUsers/emailPreview","css!css/emailPreview.css"],function(Backbone,_,theme,template){"use strict";var VIEW_SELECTORS={EMAIL_BODY:".js-emailBody"};var EmailPreviewView=Backbone.View.extend({className:"fc-emailPreview",constructor:function EmailPreviewView(){Backbone.View.apply(this,arguments)},updatePreview:function updatePreview(value){this.$(VIEW_SELECTORS.EMAIL_BODY).html(_.escape(value).replace(/\n/g,"<br />"))},render:function render(){this.$el.html(template({isBrandwatchOrGreyLabelTheme:theme.isBrandwatchOrGreyLabelTheme()}))}});return EmailPreviewView});define("mustache!templates/inviteFacebookUsers/inviteFacebookUsers",["lib/mustache"],function(mustache){var escapedTemplate='<div class="fc-invite">\n<h1 class="popuptitletext smallmargin-bottom">Invite Facebook Users</h1>\n<div class="js-notifications notifications"></div>\n\n<div class="js-description doublemargin-top">\nTo gather Facebook data we need authentications from Facebook users. <br />\n<strong>The more Facebook authentications you can gather, the better your Facebook Channel coverage will be.</strong>\nWe will not crawl personal posts or data - Authentication is just required to allow us to crawl public pages.\n\nIn addition, authentications from Facebook users with a role on a Facebook page tied to an Instagram Business page will allow you to track more Instagram hashtags.\n</div>\n\n<label class="fc-invite__label dib singlemargin-top bold">From:</label>\n<label class="fc-invite__sublabel db lightgrey smallmargin-bottom robotolightfont">(Not editable)</label>\n<input readonly type="text" value="{{from}}" class="js-from fc-invite__from fullwidth smallmargin-bottom smallpadding-vertical robotolightfont">\n\n<label class="fc-invite__label dib singlemargin-top bold">Emails of Facebook users to invite:</label>\n<label class="fc-invite__sublabel db lightgrey smallmargin-bottom robotolightfont">(Doesn\'t have to be a {{productName}} user)</label>\n<div class="js-email fc-invite__email fullwidth field smallmargin-bottom"></div>\n\n<label>\n<span class="fc-invite__label dib singlemargin-top smallmargin-bottom bold">Your message:</span>\n<textarea class="js-emailBody fc-invite__message field rounded fullwidth db robotolightfont bigtext smallpadding-vertical bigline" rows="6">{{emailBody}}</textarea>\n</label>\n\n<hr class="fc-invite__separator">\n\n<div class="doublemargin-bottom">\n<label class="fc-invite__label dib smallmargin-bottom bold">Or copy link to share:</label>\n<div data-reactapp="copyToClipboard"></div>\n</div>\n\n<button disabled class="js-invite defaultbutton">\n<span class="js-invite-label">Send Invite</span>\n<span class="icon-chevron-right smallpadding-left"></span>\n</button>\n<button class="js-abort button smallmargin-left">Cancel</button>\n</div>\n<div class="fc-preview js-emailPreview"></div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!templates/inviteFacebookUsers/genericEmailTemplate",["lib/mustache"],function(mustache){var escapedTemplate="Hi there,\n\nId like to ask for your help. As you may know, we use a tool called Brandwatch to monitor our companys performance on social media as well as tracking our competitors.The amount of data that the tool can collect is determined by the number of Facebook users that authenticate with it.\n\nIf you login with your Facebook account, we don't get any access to your private Facebook data, posts or conversations and we absolutely cant post anything on your behalf  it simply causes Facebook to give Brandwatch more bandwidth.\nIf youre prepared to help us out, click the button below and login.\n\nKind Regards\n\n{{name}}\n";return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!templates/inviteFacebookUsers/compliantGenericEmailTemplate",["lib/mustache"],function(mustache){var escapedTemplate="Hi there,\n\nI'd like to ask for your help. As you may know, we use a tool called Brandwatch to monitor our company's performance on social media. The amount of data that the tool can collect is determined by the number of Facebook users that authenticate with it.\n\nLogging in with your Facebook account would allow us to gather more public data from Facebook. If the account has a role on a Facebook page linked to an Instagram Business page, it would also allow us to gather more public data from Instagram.\n\nWe don't get any access to your private data, posts or conversations and we can't ever post anything on your behalf. It simply permits Facebook and Instagram to allow us more bandwidth in line with their terms of use for public content access.\n\nIf you're prepared to help us out, click the button below and log in.\n\nKind regards,\n\n{{name}}\n";return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!templates/inviteFacebookUsers/whitelabelEmailTemplate",["lib/mustache"],function(mustache){var escapedTemplate="Hi there,\n\nId like to ask for your help. As you may know, we use a Social Media Intelligence tool to monitor our companys performance on social media as well as tracking our competitors. The amount of data that the tool can collect is determined by the number of Facebook users that authenticate with it.\n\nIf you login with your Facebook account, we don't get any access to your private Facebook data, posts or conversations and we absolutely cant post anything on your behalf  it simply causes Facebook to give the Social Media Intelligence tool more bandwidth.\nIf youre prepared to help us out, click the button below and login.\n\nKind Regards\n\n{{name}}\n";return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!css/inviteFacebookUsers.css",["css!css/compiled.css"],function(){});function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}define("src/views/invitefacebookusers/InviteFacebookUsersView",["jquery","backbone","src/globals/flags","src/globals/flagNames","src/ReactAppLoader","bw-fe-helpers/validationHelpers","src/globals/me","src/globals/theme","src/events/facebookCoverageEvents","src/events/globalEventNames","src/mixins/mixin","src/mixins/withPopup","src/helpers/fbTokenServiceHelper","src/helpers/notificationsHelper","src/components/mentions/views/TagsInputView","src/views/invitefacebookusers/EmailPreviewView","mustache!templates/inviteFacebookUsers/inviteFacebookUsers","mustache!templates/inviteFacebookUsers/genericEmailTemplate","mustache!templates/inviteFacebookUsers/compliantGenericEmailTemplate","mustache!templates/inviteFacebookUsers/whitelabelEmailTemplate","src/packages/waitmask","lib/jquery.notify","css!css/inviteFacebookUsers.css"],function($,Backbone,flags,FLAGS,ReactAppLoader,validationHelpers,me,theme,facebookCoverageEvents,globalEventNames,mixin,withPopup,fbTokenServiceHelper,notificationsHelper,TagsInputView,EmailPreviewView,template,genericEmailTemplate,compliantGenericEmailTemplate,whitelabelEmailTemplate){"use strict";var _events;var FACEBOOK_COVERAGE_EVENTS=globalEventNames.FACEBOOK_COVERAGE;var MAXIMUM_INVITES=1e3;var VIEW_SELECTORS={INVITE:".js-invite",ABORT:".js-abort",INVITE_LABEL:".js-invite-label",EMAIL:".js-email",INVITE_LINK_PLACEHOLDER:"[data-reactapp=copyToClipboard]",NOTIFICATIONS:".js-notifications",EMAIL_BODY:".js-emailBody",EMAIL_PREVIEW:".js-emailPreview"};function getTemplateData(compliant){var firstname=me.get("firstName");var lastname=me.get("lastName");var email=me.get("username");var from=firstname&&lastname?"".concat(firstname," ").concat(lastname," <").concat(email,">"):email;var emailBodyData={name:"".concat(firstname," ").concat(lastname)};var emailBody=theme.isBrandwatchOrGreyLabelTheme()?compliant?compliantGenericEmailTemplate(emailBodyData):genericEmailTemplate(emailBodyData):whitelabelEmailTemplate(emailBodyData);return{from:from,emailBody:emailBody,productName:theme.productName}}function getEmails(view){return view.emailsInputView.getTags()}function getEmailBody(view){return view.$el.find(VIEW_SELECTORS.EMAIL_BODY).val()}function updateInviteButton(view,invitesCount){if(invitesCount===undefined){invitesCount=getEmails(view).length}var $button=view.$(VIEW_SELECTORS.INVITE);var hasEmailBody=view.$el.find(VIEW_SELECTORS.EMAIL_BODY).val().trim()!=="";var canInvite=invitesCount>0&&invitesCount<=MAXIMUM_INVITES&&hasEmailBody;$button.prop("disabled",!canInvite);$button.find(VIEW_SELECTORS.INVITE_LABEL).text(invitesCount<2?"Send Invite":"Send Invites")}function updateMaximumInvitesNotification(view,invitesCount){if(invitesCount<=MAXIMUM_INVITES){view.$(VIEW_SELECTORS.NOTIFICATIONS).empty();return}notificationsHelper.showPermanentNotification(view.$el,{text:"Invites are limited to ".concat(MAXIMUM_INVITES," recipients at a time."),type:"notification-error"})}function renderCopyToClipboardApp(view,copyToClipboardApp){var inviteUrl=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"";copyToClipboardApp.render({value:inviteUrl});copyToClipboardApp.$el.appendTo(view.$(VIEW_SELECTORS.INVITE_LINK_PLACEHOLDER))}function createAndRenderCopyToClipboardApp(view){var copyToClipboardApp=new ReactAppLoader("copyToClipboardApp");renderCopyToClipboardApp(view,copyToClipboardApp);return copyToClipboardApp}function createAndRenderEmailsInput(view){var emailsInputView=new TagsInputView({addValueOnBlur:true,placeholder:"e.g. name@gmail.com",hasAutoComplete:false,itemType:"email",duplicateEntryText:"This email has already been added",validateInput:function validateInput(email){return validationHelpers.isValidEmail(email)?undefined:"Please enter a correct email"},onAdd:function onAdd(addedEmail,done){var invitesCount=getEmails(view).length;updateInviteButton(view,invitesCount);updateMaximumInvitesNotification(view,invitesCount);done()},onRemove:function onRemove(removedEmail,done){var emails=getEmails(view).filter(function(tag){return tag!==removedEmail});updateInviteButton(view,emails.length);updateMaximumInvitesNotification(view,emails.length);done()}});view.$(VIEW_SELECTORS.EMAIL).append(emailsInputView.$el);emailsInputView.render();return emailsInputView}function createAndRenderPreviewInput(view){var emailPreviewView=new EmailPreviewView;view.$(VIEW_SELECTORS.EMAIL_PREVIEW).append(emailPreviewView.$el);emailPreviewView.render();return emailPreviewView}function showInviteSuccessNotification(response){var successMessage=getSuccessMessage(response.email);$.notify({text:successMessage,className:"notification-success"})}function sendInvite(view){view.$el.showWaitmask();view.$(VIEW_SELECTORS.NOTIFICATIONS).empty();var email=getEmails(view);var emailBody=getEmailBody(view);fbTokenServiceHelper.sendInvite({email:email,emailBody:emailBody,callback:function callback(err,response){if(err){view.$el.hideWaitmask();notificationsHelper.showPermanentNotification(view.$el,{text:"There was an unexpected error. Please try again.",type:"notification-error"});facebookCoverageEvents.trigger(FACEBOOK_COVERAGE_EVENTS.INVITE_SENT_FAILED,{email:email,emailBody:emailBody});return}facebookCoverageEvents.trigger(FACEBOOK_COVERAGE_EVENTS.INVITE_SENT,{email:email,emailBody:emailBody});showInviteSuccessNotification(response);view.remove()}})}function fetchInviteLink(view){view.$el.showWaitmask();fbTokenServiceHelper.fetchInviteLink(onInviteLinkResponseReceived.bind(undefined,view))}function onInviteLinkResponseReceived(view,err,inviteUrl){if(err){$.notify({text:"There was an unexpected error creating an invite. Please try again later.",className:"notification-error"});view.remove();return}view.$el.hideWaitmask();renderCopyToClipboardApp(view,view.copyToClipboardApp,inviteUrl)}function onEmailBodyInput(view){var emailBodyTextarea=view.$el.find(VIEW_SELECTORS.EMAIL_BODY);emailBodyTextarea.toggleClass("invalid",emailBodyTextarea.val().trim()==="");updateInviteButton(view);updateEmailPreview(view)}function updateEmailPreview(view){var emailBodyTextarea=view.$el.find(VIEW_SELECTORS.EMAIL_BODY);view.emailPreviewView.updatePreview(emailBodyTextarea.val())}function getSuccessMessage(email){var emailCount=email.length;return"".concat(emailCount," Facebook user").concat(email.length>1?"s":""," invited to authenticate by email.")}var InviteFacebookUsersView=Backbone.View.extend({className:"invite-facebook-users modular",events:(_events={},_defineProperty(_events,"click ".concat(VIEW_SELECTORS.INVITE),function click(){sendInvite(this)}),_defineProperty(_events,"click ".concat(VIEW_SELECTORS.ABORT),"remove"),_defineProperty(_events,"input ".concat(VIEW_SELECTORS.EMAIL_BODY),function input(){onEmailBodyInput(this)}),_events),constructor:function InviteFacebookUsersView(){Backbone.View.apply(this,arguments)},render:function render(){var templateData=getTemplateData(flags.variation(FLAGS.FACEBOOK_COMPLIANCE));this.$el.html(template(templateData));this.copyToClipboardApp=createAndRenderCopyToClipboardApp(this);this.emailsInputView=createAndRenderEmailsInput(this);this.emailPreviewView=createAndRenderPreviewInput(this);updateEmailPreview(this);fetchInviteLink(this)},remove:function remove(){this.$el.removeModal();if(this.copyToClipboardApp){this.copyToClipboardApp.remove()}if(this.emailsInputView){this.emailsInputView.remove()}if(this.emailPreviewView){this.emailPreviewView.remove()}Backbone.View.prototype.remove.apply(this)}},{show:function show(options){var view=new InviteFacebookUsersView(options);view.render();view.showAsPopup({className:"fc-invite__popup",onClose:function onClose(){facebookCoverageEvents.trigger(FACEBOOK_COVERAGE_EVENTS.INVITE_DIALOG_CLOSED)}});if(view.emailsInputView){view.emailsInputView.onComponentClick()}facebookCoverageEvents.trigger(FACEBOOK_COVERAGE_EVENTS.INVITE_DIALOG_OPENED);return view}});mixin(InviteFacebookUsersView,withPopup);return InviteFacebookUsersView});define("src/helpers/FB",["backbone","underscore","jquery","src/globals/theme"],function(Backbone,_,$,theme){"use strict";var FACEBOOK_SEARCH_FIELDS=["id","name","about","category","is_published","username","link"];var _initialized;var _authData;var _fbScope="manage_pages,email,instagram_basic";return _.extend({loadFB:function loadFB(done){var FB=window.FB&&window.FB.init?window.FB:undefined;var trigger=_.bind(this.trigger,this);done=done||function(){};if(!theme.fbAppId){return done(new Error("No FB App Id"))}function onAuthChange(response){if(!response.authResponse){return trigger("authChange",{loggedIn:false})}_authData=response.authResponse;return trigger("authChange",{loggedIn:true,authData:response.authResponse})}function initFB(){var err=new Error("FB library not loaded, maybe it's blocked?");if(FB&&_initialized){return}try{_initialized=true;FB.Event.subscribe("auth.statusChange",onAuthChange);FB.init({appId:theme.fbAppId,status:true,cookie:true,xfbml:true,oauth:true});if(!_authData){FB.getLoginStatus()}err=undefined}catch(e){console.warn("Error loading Facebook SDK - perhaps blocked by local network?",e)}return err}if(FB){if($("#fb-root").length===0){$("body").prepend('<div id="fb-root" />')}var err=initFB();if(!_authData){FB.getLoginStatus(onAuthChange)}return done(!FB?err||new Error("FB library not loaded, maybe it's blocked?"):undefined,FB)}window.fbAsyncInit=function(){var err;FB=window.FB;if(FB){err=initFB()}if(_.isFunction(done)){return done(err,FB)}};(function(d){var js,id="facebook-jssdk",ref=d.getElementsByTagName("script")[0];if(d.getElementById(id)){return}js=d.createElement("script");js.id=id;js.async=true;js.src="//connect.facebook.net/en_US/all.js";ref.parentNode.insertBefore(js,ref)})(document)},likeButton:function likeButton(options,callback){callback=callback||function(){};this.loadFB(function(err){if(err){return callback(err)}options.el.append('<iframe src="http://www.facebook.com/plugins/like.php?href='+encodeURIComponent(options.url)+'&layout=button_count&show_faces=false&width=125&action=like&colorscheme=light&height=21" '+'scrolling="no" frameborder="0" '+'style="border:none; overflow:hidden; width:125px; height:23px;" allowTransparency="true"></iframe>');callback()})},postToWall:function postToWall(options,callback){var publishOptions={method:"feed",display:"popup",link:options.url,name:options.title,description:options.snippet};if(options.url&&options.url.indexOf("video.php")>-1){publishOptions.picture="none.jpg"}callback=callback||function(){};this.loadFB(function(err,FB){if(err){return callback(err)}FB.ui(publishOptions,function(response){var error,postId=response&&response.post_id;if(!postId){error=new Error("Couldn't post to user's wall.")}callback(error,postId)})})},message:function message(options,callback){var self=this;var publishOptions={method:"send",display:"popup",link:options.url,name:options.title,description:options.snippet};callback=callback||function(){};if(!options.url){throw new Error("options.url is required")}if(options.author&&options.author.toString().indexOf(" ")===-1){publishOptions.to=options.author}self.loadFB(function(err,FB){if(err){return callback(err)}FB.ui(publishOptions,function(response){if(response&&response.success){callback()}})})},getUserPageList:function getUserPageList(callback){var fql="select name,type,page_id,page_url,website,company_overview,pic_square,description"+" from page"+" where page_id in "+"(select page_id from page_admin where uid=me())"+" and type != 'APPLICATION'";this.loadFB(function(err,FB){if(err){return callback(err)}FB.api({method:"fql.query",query:fql},function(response){var error;if(!response||response.error){error=response}callback(error,response)})})},login:function login(callback){var self=this;this.loadFB(function(err,FB){if(err){return callback(err)}FB.login(function(response){if(response.authResponse&&response.status==="connected"){self.trigger("login",response)}return callback&&callback()},{scope:_fbScope})})},logout:function logout(callback){var self=this;this.loadFB(function(err,FB){if(err){return callback(err)}FB.logout(function(response){self.trigger("logout",response);return callback&&callback(undefined,{loggedIn:!!response.authResponse})})})},getLoginStatus:function getLoginStatus(){var callback=arguments.length>0&&arguments[0]!==undefined?arguments[0]:function(){};var loggedIn;this.loadFB(function(err,FB){if(err){return callback(err)}FB.getLoginStatus(function(response){loggedIn=response.status==="connected";return callback(undefined,{loggedIn:loggedIn,response:response})})})},getAccessToken:function getAccessToken(){return _authData&&_authData.accessToken?_authData.accessToken:null},getUserID:function getUserID(){return _authData&&_authData.userID?_authData.userID:null},pageSearch:function pageSearch(pageName,callback){if(pageName.indexOf("/")!==0){pageName="/"+pageName}this.loadFB(function(err,FB){if(err){return callback(err)}FB.api(pageName,{fields:FACEBOOK_SEARCH_FIELDS},function(response){if(response.error){return callback(response)}return callback(undefined,response)})})},getPostToWallUrl:function getPostToWallUrl(postId){var userAndPostIds=postId.split("_");return'"http://www.facebook.com/permalink.php?story_fbid='+userAndPostIds[1]+"&id="+userAndPostIds[0]+'"'},parseXFBML:function parseXFBML(container,done){this.loadFB(function(err,FB){done=done||_.noop;if(err){return done(err)}FB.XFBML.parse(container);done()})}},Backbone.Events)});define("mustache!src/extensions/facebookanalytics/templates/facebookLogin",["lib/mustache"],function(mustache){var escapedTemplate='<a{{{ title }}} class="dib smallmargin-bottom colorbutton social-button social-button--facebook facebook {{className}}">\n<span class="icon-bwfacebook smallpadding-right"></span>{{text}}\n</a>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/extensions/facebookanalytics/templates/facebookLoginSpinner",["lib/mustache"],function(mustache){var escapedTemplate='<a class="smallmargin-bottom social-button social-button--facebook facebook"></a>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!templates/navigation/thirdPartyAuthenticationError",["lib/mustache"],function(mustache){var escapedTemplate='<div class="smallmargin-bottom social-button social-button--{{type}} {{type}} {{className}}">\n<span class="{{iconClassName}} smallpadding-right"></span>{{text}}\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!css/socialButtons.css",["css!css/compiled.css"],function(){});define("src/extensions/facebookanalytics/views/FacebookLoginView",["backbone","src/globals/flags","src/globals/flagNames","src/helpers/FB","mustache!src/extensions/facebookanalytics/templates/facebookLogin","mustache!src/extensions/facebookanalytics/templates/facebookLoginSpinner","mustache!templates/navigation/thirdPartyAuthenticationError","src/packages/waitmask","src/packages/customtip","css!css/socialButtons.css"],function(Backbone,flags,FLAGS,FB,facebookLoginTemplate,facebookLoginSpinnerTemplate,thirdPartyAuthenticationErrorTemplate){"use strict";var WAITMASK_HEIGHT=24;function onLoginClick(){FB.login()}function onLogoutClick(){FB.logout()}return Backbone.View.extend({className:"facebookLoginView",events:function events(){return{"click .js-login":onLoginClick,"click .js-logout":onLogoutClick}},initialize:function initialize(){this.listenTo(FB,"login",this.fbLogin);this.listenTo(FB,"logout",this.fbLogout);this.listenTo(FB,"authChange",this.fbAuthChange);this._cacheElements()},_cacheElements:function _cacheElements(){this.$fbLogButton=this.$(".facebook")},render:function render(options){var $el=this.$el,self=this,$socialButton;this.renderOptions=options||{};$el.html(facebookLoginSpinnerTemplate());$socialButton=$el.find(".social-button--facebook");$socialButton.showWaitmask({minHeight:WAITMASK_HEIGHT});FB.loadFB(function(err){self.title="";if(err){self.$el.html(thirdPartyAuthenticationErrorTemplate({className:"social-button--disabled",text:"Currently unavailable",iconClassName:"icon-bwfacebook",type:"facebook"}));return console.error("Error loading FB",err)}$socialButton.hideWaitmask();self._renderFacebookButton()})},fbLogin:function fbLogin(){if(this._isLoggedIn){this.$fbLogButton.addClass("js-logout").removeClass("js-login")}},fbLogout:function fbLogout(){if(!this._isLoggedIn){this.$fbLogButton.addClass("js-login").removeClass("js-logout")}},fbAuthChange:function fbAuthChange(status){this._isLoggedIn=status.loggedIn;if(!flags.variation(FLAGS.HIDE_FB_AND_INSTAGRAM_SETUP)){this._renderFacebookButton()}return this._isLoggedIn?this.fbLogin():this.fbLogout()},_renderFacebookButton:function _renderFacebookButton(){var buttonClassName=this._isLoggedIn?"js-logout":"js-login";if(this.renderOptions&&this.renderOptions.cssClass){buttonClassName+=" "+this.renderOptions.cssClass}if(this.renderOptions&&this.renderOptions.title&&!this._isLoggedIn){buttonClassName+=" customtip"}if(this.renderOptions&&this.renderOptions.title&&!this._isLoggedIn){this.title=' title="'+this.renderOptions.title+'"'}this.$el.find(".social-button--facebook").hideWaitmask();this.$el.html(facebookLoginTemplate({className:buttonClassName,title:this.title,text:this._isLoggedIn?"Unauthenticate with Facebook":"Authenticate with Facebook"}));if(this.title){this.$el.customtip({position:"left"})}this._cacheElements()}})});define("src/helpers/twitterApiHelper",["underscore","jquery","q","bw-fe-helpers/promiseHelper","bw-fe-helpers/windowHelper"],function(_,$,Q,promiseHelper,windowHelper){"use strict";var NO_USER_ERROR_MESSAGE="No user matches for specified terms.";function getDescriptionSegments(rawDescription,urls){var descriptionSegments=[];var currentIndex=0;urls.forEach(function(url){descriptionSegments.push(_.stripTags(rawDescription.slice(currentIndex,url.indices[0])));currentIndex=url.indices[1]});descriptionSegments.push(_.stripTags(rawDescription.slice(currentIndex)));return descriptionSegments}function getLinkMarkup(url){return'<a href="'+_.escape(url.expanded_url)+'" class="js-twitter-handle-link" target="_blank">'+_.stripTags(url.display_url)+'<span class="tinypadding-left icon-external-link"></span>'+"</a>"}function unwrapAllShortUrls(rawDescription,urls){var descriptionSegments=getDescriptionSegments(rawDescription,urls);var description=descriptionSegments[0];var tooltip=descriptionSegments[0];urls.forEach(function(url,index){var descriptionReplacementString=getLinkMarkup(url);var tooltipReplacementString=url.display_url;description+=descriptionReplacementString+descriptionSegments[index+1];tooltip+=tooltipReplacementString+descriptionSegments[index+1]});return{description:description,tooltip:tooltip}}function formatDescriptionAndTooltip(handle){if(!handle.description){return}if(!handle.entities||!handle.entities.description||!handle.entities.description.urls){return{description:handle.description,tooltip:handle.description}}return unwrapAllShortUrls(handle.description,handle.entities.description.urls)}function formatProfileImageUrl(handle){if(!handle.profile_image_url){return}return handle.profile_image_url.replace(/https?:\/\//,"//")}function formatUserData(handles){return handles.map(function(handle){var formattedHandle=_.extend({},handle);var formattedDescriptionData=formatDescriptionAndTooltip(handle);formattedHandle.profile_image_url=formatProfileImageUrl(handle);if(formattedDescriptionData){formattedHandle.description=formattedDescriptionData.description;formattedHandle.tooltip=formattedDescriptionData.tooltip}return formattedHandle})}return{get:function get(url,data,callback){$.ajax({dataType:"json",url:"/twitterapi/"+url,data:data,success:function success(data){callback(undefined,data)},error:function error(_error){return callback(_error)}})},login:function login(callback){var windowObject=windowHelper.getWindow();windowObject.open("/twitterlogin/login_request","twitter_signin","height=300,width=400,location=1,status=1,resizable=1,scrollbars=1");windowObject.twitterLoginError=function(error){delete windowObject.twitterLoginError;callback(error)};windowObject.twitterLoginSuccess=function(){delete windowObject.twitterLoginSuccess;callback()}},getLoginStatus:function getLoginStatus(callback){$.ajax({dataType:"json",url:"/twitterlogin/login_status",success:function success(){return callback(null,true)},error:function error(_error2){return callback(new Error(_error2.responseText),false)}})},logout:function logout(callback){$.ajax({dataType:"json",url:"/twitterlogin/logout",success:function success(){callback()},error:function error(_error3){callback(_error3)}})},usersLookup:function usersLookup(users){return Q.Promise(function(resolve,reject){if(!Array.isArray(users)){throw new Error("users must be an array of screen names")}if(!users.length){return resolve([])}return promiseHelper.ajax({url:"/twitterapi/users/lookup.json",data:{screen_name:users.join()}}).then(function(data){resolve(formatUserData(data))},function(errorData){if(errorData.status===404){try{if(JSON.parse(errorData.responseText).message===NO_USER_ERROR_MESSAGE){resolve([])}}catch(err){if(window.newrelic&&window.newrelic.noticeError){window.newrelic.noticeError(err)}}}return reject(errorData.responseText)})})},usersSearch:function usersSearch(query){return Q.Promise(function(resolve,reject){if(typeof query!=="string"){throw new Error("query must be a query string")}if(!query.length){return resolve([])}return promiseHelper.ajax({url:"/twitterapi/users/search.json",data:{q:query}}).then(function(data){return resolve(formatUserData(data))},function(errorData){return reject(errorData.responseText)})})}}});define("mustache!templates/usageSummaryPopup",["lib/mustache"],function(mustache){var escapedTemplate='<div>\n<h1 class="popuptitletext singlemargin-bottom draggable">Request Usage Report</h1>\n<div class="content">\n<p>\nSelect a month and click the button to request a Usage Report.\n</p>\n<p>\nYour report will be emailed to <b class="useremail">{{email}}</b>.\n</p>\n<label for="{{selectid}}">Month:</label>\n<select id="{{selectid}}" class="selectfield">\n{{#availableMonths}}\n<option value="{{value}}">{{label}}</option>\n{{/availableMonths}}\n</select>\n<p class="doublemargin-top">\n<button class="requestBtn defaultbutton">Request Usage Report</button>\n<button class="cancel button singlemargin-left">Cancel</button>\n</p>\n</div>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!templates/usageSummaryPopupSuccess",["lib/mustache"],function(mustache){var escapedTemplate='<div>\n<h1 class="popuptitletext singlemargin-bottom draggable">Request Usage Report</h1>\n<div class="content success">\n<p>\nThank you, the Usage Report has been successfully emailed to <b class="useremail">{{email}}</b>.\n</p>\n<button class="closeBtn button">Close</button>\n</div>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!templates/usageSummaryPopupError",["lib/mustache"],function(mustache){var escapedTemplate='<div>\n<h1>Request Usage Report</h1>\n<div class="content error">\n<p>\nSorry, the Usage Report could not be sent to <b class="useremail">{{email}}</b> - please <a href="mailto:support@brandwatch.com">let us know</a>\n</p>\n</div>\n</div>';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==="object"&&typeof module==="object")module.exports=factory(require("moment-timezone"),require("underscore"));else if(typeof define==="function"&&define.amd)define("bw-fe-helpers/dateHelper",["moment-timezone","underscore"],factory);else{var a=typeof exports==="object"?factory(require("moment-timezone"),require("underscore")):factory(root["moment-timezone"],root["underscore"]);for(var i in a)(typeof exports==="object"?exports:root)[i]=a[i]}})(this,function(__WEBPACK_EXTERNAL_MODULE__0__,__WEBPACK_EXTERNAL_MODULE__1__){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=2)}([function(module,exports){module.exports=__WEBPACK_EXTERNAL_MODULE__0__},function(module,exports){module.exports=__WEBPACK_EXTERNAL_MODULE__1__},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var moment_timezone__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0);var moment_timezone__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(moment_timezone__WEBPACK_IMPORTED_MODULE_0__);var underscore__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(1);var underscore__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(underscore__WEBPACK_IMPORTED_MODULE_1__);var notADateRegex=/^[0-9]{0,6}$/,ticksSince1970Regex=/^([0-9]{6,})$/,ISODateAndTimeRegex=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})/,yearMonthDayRegex=/^([0-9]{4})-([0-9]{1,2})-([0-9]{1,2})$/,dayMonthYearRegex=/^([0-9]{1,2})-([0-9]{1,2})-([0-9]{4})$/,yearMonthDayWithTimeRegex=/^([0-9]{4})-([0-9]{2})-([0-9]{1,2}).([0-9]{1,2}):([0-9]{1,2}):?([0-9]{1,2})?/,dayMonthYearWithTimeRegex=/^([0-9]{1,2})-([0-9]{2})-([0-9]{4}).([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})/,workbenchTimeRegex=/^([a-z]{3}) ([0-9]{2}), ([0-9]{4})$/i,ieTimeStringRegex=/^[a-z]{3} ([a-z]{3}) ([0-9]{1,2}) ([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2}) UTC([+-][0-9]{4}) ([0-9]{4})$/i,twentyFourHourRegex=/^(\d{2})(?::\d{2})?$/,monthsShort="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),DEFAULT_TIMEZONE="UTC";function today(timezone){var now=timezone?moment_timezone__WEBPACK_IMPORTED_MODULE_0___default.a.tz(timezone):moment_timezone__WEBPACK_IMPORTED_MODULE_0___default()();return now.startOf("day").toDate()}function isIsoDateString(str){var LOOKS_LIKE_ISO8601=new RegExp(/^\d{4}(-\d{2}(-\d{2})?)?((\s|T)\d{2}(:\d{2})(:\d{2})?)?/),isString=typeof str==="string",isIsoDate=isString&&LOOKS_LIKE_ISO8601.test(str);return isIsoDate||false}function isLocaleDateString(str){var localeDateStringRegex=new RegExp("^("+monthsShort.join("|")+") ([0-9]{1,2}),\\s?([0-9]{4})$","i"),isString=typeof str==="string",isLocaleDate=isString&&localeDateStringRegex.test(str);return isLocaleDate||false}function buildMomentInTimezone(arg,timezone){if(timezone){return moment_timezone__WEBPACK_IMPORTED_MODULE_0___default.a.tz(arg,timezone)}else{return moment_timezone__WEBPACK_IMPORTED_MODULE_0___default()(arg)}}function buildDateObject(arg,timezone){return buildMomentInTimezone(arg,timezone).toDate()}__webpack_exports__["default"]={isLocaleDateString:isLocaleDateString,isIsoDateString:isIsoDateString,today:today,monthsShort:monthsShort,fromNow:function fromNow(date,options){options=options||{};var parsedDate=this.parse(date),m=moment_timezone__WEBPACK_IMPORTED_MODULE_0___default()(parsedDate),diff=moment_timezone__WEBPACK_IMPORTED_MODULE_0___default()(new Date).diff(m),format=options.format||"MMM DD, YYYY",timezone=options.timezone;if(!parsedDate){return undefined}if(diff>7*24*60*60*1e3){return timezone?m.tz(options.timezone).format(format):m.format(format)}else if(diff<=3e4){return"Just now"}else if(diff>3e4&&diff<9e4){return"About a minute ago"}return m.from(new Date)},parse:function parse(originalDate,timezone){var date;var execResult;if(underscore__WEBPACK_IMPORTED_MODULE_1___default.a.isDate(originalDate)){return originalDate}else if(underscore__WEBPACK_IMPORTED_MODULE_1___default.a.isUndefined(originalDate)){return}if(notADateRegex.test(originalDate)){return}else if(execResult=ticksSince1970Regex.exec(originalDate)){date=buildDateObject(parseInt(execResult[1],10),timezone)}else if(execResult=ISODateAndTimeRegex.exec(originalDate)){date=buildDateObject(originalDate,timezone)}else if(execResult=yearMonthDayRegex.exec(originalDate)){date=buildDateObject([execResult[1],execResult[2]-1,execResult[3]],timezone)}else if(execResult=dayMonthYearRegex.exec(originalDate)){date=buildDateObject([parseInt(execResult[3],10),parseInt(execResult[2],10)-1,parseInt(execResult[1],10)],timezone)}else if(execResult=yearMonthDayWithTimeRegex.exec(originalDate)){date=buildDateObject([parseInt(execResult[1],10),parseInt(execResult[2],10)-1,parseInt(execResult[3],10),parseInt(execResult[4],10),parseInt(execResult[5],10),parseInt(execResult[6],10)||0],timezone)}else if(execResult=dayMonthYearWithTimeRegex.exec(originalDate)){date=buildDateObject([parseInt(execResult[3],10),parseInt(execResult[2],10)-1,parseInt(execResult[1],10),parseInt(execResult[4],10),parseInt(execResult[5],10),parseInt(execResult[6],10)||0],timezone)}else if(execResult=workbenchTimeRegex.exec(originalDate)){date=buildDateObject([parseInt(execResult[3],10),monthsShort.indexOf(execResult[1]),parseInt(execResult[2],10)],timezone)}else if(execResult=ieTimeStringRegex.exec(originalDate)){date=buildDateObject([parseInt(execResult[7],10),monthsShort.indexOf(execResult[1]),parseInt(execResult[2],10),parseInt(execResult[3],10),parseInt(execResult[4],10),parseInt(execResult[5],10)],timezone)}else{date=buildDateObject(originalDate,timezone)}if(underscore__WEBPACK_IMPORTED_MODULE_1___default.a.isDate(date)&&!isNaN(date)&&!underscore__WEBPACK_IMPORTED_MODULE_1___default.a.isNumber(date)){if(date.getFullYear()===1970){return}return date}return},daysBetween:function daysBetween(dt1,dt2){if(dt1 instanceof Date===false){dt1=this.parse(dt1)}if(dt2 instanceof Date===false){dt2=this.parse(dt2)}var diff=moment_timezone__WEBPACK_IMPORTED_MODULE_0___default()(dt1).diff(moment_timezone__WEBPACK_IMPORTED_MODULE_0___default()(dt2),"days");return diff<0?-diff:diff},isFixedDate:function isFixedDate(date){date=date||"";var split=date.split(" - ");if(split.length===0||split.length>2){return false}return underscore__WEBPACK_IMPORTED_MODULE_1___default()(split).all(function(s){return this.parse(s)},this)},parseRelativeDate:function parseRelativeDate(relativeDate,timezone){var rxDays=/^Last ([0-9]+) Days$/i,daysMatch,output={start:today(timezone),end:today(timezone)};relativeDate=relativeDate.toLowerCase();if(relativeDate==="today"){return output}daysMatch=rxDays.exec(relativeDate);if(!daysMatch){throw new Error("unable to parse relative date "+relativeDate)}output.start=moment_timezone__WEBPACK_IMPORTED_MODULE_0___default()(output.start).add({d:-parseInt(daysMatch[1],10)}).toDate();return output},parseDateRange:function parseDateRange(val,timezone){var startDate,endDate,split;if(underscore__WEBPACK_IMPORTED_MODULE_1___default.a.isString(val)){split=val.split(" - ");if(split.length===2){startDate=this.parse(split[0],timezone);endDate=this.parse(split[1],timezone)}else{return this.parseRelativeDate(val,timezone)}}else if(underscore__WEBPACK_IMPORTED_MODULE_1___default.a.isDate(val.startDate)&&underscore__WEBPACK_IMPORTED_MODULE_1___default.a.isDate(val.endDate)){startDate=val.startDate;endDate=val.endDate}if(endDate&&startDate&&endDate.getTime()<startDate.getTime()){return}return{start:startDate,end:endDate}},formatInterval:function formatInterval(startDate,endDate){var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var timezone=options.timezone||DEFAULT_TIMEZONE;if(!underscore__WEBPACK_IMPORTED_MODULE_1___default.a.isDate(startDate)){throw new TypeError("startDate argument must be a Date")}if(!underscore__WEBPACK_IMPORTED_MODULE_1___default.a.isDate(endDate)){throw new TypeError("endDate argument must be a Date")}return moment_timezone__WEBPACK_IMPORTED_MODULE_0___default.a.tz(startDate,timezone).format("MMM DD, YYYY")+" - "+moment_timezone__WEBPACK_IMPORTED_MODULE_0___default.a.tz(endDate,timezone).format("MMM DD, YYYY")},makeDateRange:function makeDateRange(startDate,endDate,options){options=options||{};var format="MMM DD, YYYY";var timezone=options.timezone;var formatAsRelative=options.formatAsRelative;var parsedStartDate;var parsedEndDate;var days;if(formatAsRelative){days=this.daysBetween(startDate,endDate);return days===0?"Today":"Last "+days+" days"}parsedStartDate=this.parse(startDate);parsedEndDate=this.parse(endDate);if(timezone){return moment_timezone__WEBPACK_IMPORTED_MODULE_0___default.a.tz(parsedStartDate,timezone).format(format)+" - "+moment_timezone__WEBPACK_IMPORTED_MODULE_0___default.a.tz(parsedEndDate,timezone).format(format)}return moment_timezone__WEBPACK_IMPORTED_MODULE_0___default()(parsedStartDate).format(format)+" - "+moment_timezone__WEBPACK_IMPORTED_MODULE_0___default()(parsedEndDate).format(format)},prettifyDate:function prettifyDate(text,params){params=params||{};var timezone=params.timezone;var d=this.parse(text,timezone);var momentForDate=buildMomentInTimezone(d,timezone);var formatOptions={timezone:timezone};if(!d){return text}if(params.format){return this.format(d,params.format,formatOptions)}if(momentForDate.minutes()>0){return this.format(d,"D MMM h:mma",formatOptions)}if(momentForDate.hours()>0){return this.format(d,"D MMM ha",formatOptions)}return this.format(d,"D MMM",formatOptions)},format:function format(date,_format,options){options=options||{};var timezone=options.timezone;if(!date){return undefined}date=this.parse(date,timezone);if(timezone){return moment_timezone__WEBPACK_IMPORTED_MODULE_0___default.a.tz(date,timezone).format(_format)}return moment_timezone__WEBPACK_IMPORTED_MODULE_0___default()(date).format(_format)},getFirstDayOfTheWeek:function getFirstDayOfTheWeek(date,format){var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};if(!date){return undefined}var timezone=options.timezone;date=this.parse(date,timezone);if(timezone){return moment_timezone__WEBPACK_IMPORTED_MODULE_0___default.a.tz(date,timezone).startOf("isoweek").format(format)}return moment_timezone__WEBPACK_IMPORTED_MODULE_0___default()(date).startOf("isoweek").format(format)},getEndOf:function getEndOf(date,unit,timezone){return moment_timezone__WEBPACK_IMPORTED_MODULE_0___default.a.tz(date,timezone).endOf(unit).toISOString()},getStartOf:function getStartOf(date,unit,timezone){return moment_timezone__WEBPACK_IMPORTED_MODULE_0___default.a.tz(date,timezone).startOf(unit).toISOString()},getLastDayOfTheWeek:function getLastDayOfTheWeek(date,format){var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};if(!date){return undefined}var timezone=options.timezone;date=this.parse(date,timezone);if(timezone){return moment_timezone__WEBPACK_IMPORTED_MODULE_0___default.a.tz(date,timezone).endOf("isoweek").format(format)}return moment_timezone__WEBPACK_IMPORTED_MODULE_0___default()(date).endOf("isoweek").format(format)},addUnit:function addUnit(date,duration,unit,timezone){return moment_timezone__WEBPACK_IMPORTED_MODULE_0___default.a.tz(date,timezone).add(duration,unit).toISOString(true)},formatTimeStamp:function formatTimeStamp(timestamp,timezone){var now=moment_timezone__WEBPACK_IMPORTED_MODULE_0___default.a.utc(),date,diffSeconds;if(!timestamp){return undefined}date=moment_timezone__WEBPACK_IMPORTED_MODULE_0___default.a.utc(timestamp);if(now.diff(date,"hours")>23){return date.tz(timezone||DEFAULT_TIMEZONE).format("D MMM")}diffSeconds=now.diff(date,"seconds");if(diffSeconds<60){return diffSeconds+"s"}if(diffSeconds<3600){return now.diff(date,"minutes")+"m"}return now.diff(date,"hours")+"h"},prettifyChartDimensionLabel:function prettifyChartDimensionLabel(text,type){switch(type.toLowerCase()){case"hour":return this.prettifyDate(text,{format:"D MMM ha"});case"day":case"week":return this.prettifyDate(text);case"month":return this.prettifyDate(text,{format:"MMM YYYY"})}return text},formatDateForSync:function formatDateForSync(date){return this.format(date,"YYYY-MM-DDTHH:mm:ss.000\\Z")},formatEndDateForSync:function formatEndDateForSync(date){date=this.parse(date);if(!date){return}date=moment_timezone__WEBPACK_IMPORTED_MODULE_0___default()(date).clone().add({d:1}).toDate();return this.formatDateForSync(date)},remainingDaysThisMonth:function remainingDaysThisMonth(){var now=new Date,nextMonth=moment_timezone__WEBPACK_IMPORTED_MODULE_0___default()([now.getFullYear(),now.getMonth(),1]).add({M:1});return nextMonth.diff(moment_timezone__WEBPACK_IMPORTED_MODULE_0___default()(now),"days")},formatDateForJSON:function formatDateForJSON(date){return this.format(date,"YYYY-MM-DDTHH:mm:ss.000\\Z")},addTimezoneOffset:function addTimezoneOffset(date){date=this.parse(date);return new Date(date.getTime()+date.getTimezoneOffset()*60*1e3)},removeTimezoneOffset:function removeTimezoneOffset(date){date=this.parse(date);if(!date){return undefined}return new Date(date.getTime()-date.getTimezoneOffset()*60*1e3)},formatTwentyFourHourAsTwelveHour:function formatTwentyFourHourAsTwelveHour(val){var hourMatches;hourMatches=twentyFourHourRegex.exec(val);if(!hourMatches||hourMatches[1]>23){throw new Error("invalid twenty four hour value: "+val)}return moment_timezone__WEBPACK_IMPORTED_MODULE_0___default()(val+"","HH").format("ha")},formatNumericDayOfWeekInFull:function formatNumericDayOfWeekInFull(val){var numericDay=underscore__WEBPACK_IMPORTED_MODULE_1___default.a.isNumber(val)?val:parseInt(val,10);if(numericDay<1||numericDay>7){throw new Error("invalid numeric day: "+val)}return moment_timezone__WEBPACK_IMPORTED_MODULE_0___default()().isoWeekday(numericDay).format("dddd")}}}])["default"]});define("css!css/usageSummaryPopup.css",["css!css/compiled.css"],function(){});define("src/views/UsageSummaryPopup",["backbone","underscore","src/globals/me","mustache!templates/usageSummaryPopup","mustache!templates/usageSummaryPopupSuccess","mustache!templates/usageSummaryPopupError","bw-fe-helpers/dateHelper","moment","src/packages/spin","css!css/usageSummaryPopup.css"],function(Backbone,_,me,template,successTemplate,errorTemplate,dateHelper,moment){"use strict";var UsageSummaryPopup;function padNum(n){if(n.toString().length<2){return"0"+n}return n}return UsageSummaryPopup=Backbone.View.extend({className:"usageSummaryPopup",events:{"click .requestBtn":"onClickRequestButton","click .cancel, .closeBtn":"onClickCloseButton"},initialize:function initialize(options){var opts=options||{};if(!opts.email){throw new Error("Usage Summary View requires email to be passed as an option")}if(!opts.model){throw new Error("Usage Summary View requires model to be passed as an option")}this.email=opts.email;Backbone.View.prototype.initialize.call(this,opts)},remove:function remove(){this.$el.spin(false);Backbone.View.prototype.remove.call(this)},requestReport:function requestReport(requestedDate){var self=this;this.showLoading();this.model.set({startDate:dateHelper.formatDateForSync(requestedDate)});this.model.fetch({success:function success(){self.showSuccess()},error:function error(){self.showError()}})},onClickRequestButton:function onClickRequestButton(){this.requestReport(this.$("select").val())},onClickCloseButton:function onClickCloseButton(){this.close();this.remove()},showLoading:function showLoading(){this.$(".content").css({visibility:"hidden"});this.$el.spin()},showSuccess:function showSuccess(){this.showTemplate(successTemplate)},showError:function showError(){this.showTemplate(errorTemplate)},showTemplate:function showTemplate(tmpl){this.$el.spin(false).html(tmpl({email:this.email}))},close:function close(){this.$el.removeModal()},render:function render(){var baseDate=new Date,baseMonth=baseDate.getMonth(),now,availableMonths=[];_(3).times(function(i){now=new Date(baseDate);now.setDate(1);now.setMonth(baseMonth-i);availableMonths.push({value:"01-"+padNum(now.getMonth()+1)+"-"+now.getFullYear(),label:moment(now.getTime()).format("MMMM")+" "+now.getFullYear()})});this.$el.html(template({email:this.email,availableMonths:availableMonths,selectid:_.uniqueId("monthselect")}))}},{show:function show(options){var view=new UsageSummaryPopup({email:me.get("username"),model:options.model});view.render();view.$el.showModal({mask:true,draggable:"h1:first",className:"popup smallpopup"});return view}})});define("mustache!templates/navigation/userMenu",["lib/mustache"],function(mustache){var escapedTemplate='{{#canSeeSupportPortal}}\n<li class="headermenu--item support dropdown" />\n{{/canSeeSupportPortal}}\n{{#canSeeUserGuide}}\n<li class="headermenu--item userGuide">\n<a href="{{userGuidePath}}" class="link" target="_blank"><span\nclass="icon-bwdownload iconmedium link tinypadding-right"></span>User Guide</a>\n</li>\n{{/canSeeUserGuide}}\n{{#canSeeUserPreferences}}\n<li class="headermenu--item preferences dropdown">\n<img class="avatar" src="{{avatarUrl}}">\n<a class="dropdown-toggle link" data-toggle="dropdown" data-at="email-dropdown-menu"><span class="email">{{email}}</span>\n<span class="icon-chevron-down"></span></a>\n<ul class="dropdown-menu context-menu popupframe modular smallmargin-right">\n<li class="context-menu--item editUserDetails customtip" title="Edit contact details & password"><a>Your Details</a></li>\n{{#canAdmin}}\n<li class="hidden adminLink"><a class="context-menu--item dib fullwidth admin customtip" title="Manage Projects & Users, view Account Info" href="/administration" target="_blank">Administration<span class="icon-external-link grey smallpadding-left"></span></a></li>\n{{/canAdmin}}\n{{#canSeeMyBrandwatch}}\n<li class="context-menu--item js-my-brandwatch"><a href="https://my.brandwatch.com/" target="_blank">My Brandwatch<span class="icon-external-link grey smallpadding-left"></span></a></li>\n{{/canSeeMyBrandwatch}}\n{{#canAccessLegacyUsageReport}}\n<li><a class="context-menu--item dib fullwidth request-legacy-usage-report">Request Usage Report</a></li>\n{{/canAccessLegacyUsageReport}}\n<li><a class="context-menu--item dib fullwidth logout" href="/logout">Logout</a></li>\n<li class="context-menu--item separator"></li>\n<li class="context-menu--section-title">Third party Authentication</li>\n<li class="nowrap facebook singlepadding-left singlemargin-right" data-at="facebook-authentication-status"></li>\n<li class="nowrap twitter singlepadding-left singlemargin-right" data-at="twitter-authentication-status"></li>\n<li class="nowrap instagram singlepadding-left singlemargin-right"></li>\n{{#canSeeFacebookButton}}\n<li class="context-menu--item separator"></li>\n<li class="context-menu--section-title">Help improve Facebook Coverage</li>\n<li class="nowrap singlepadding-left singlemargin-right">\n<a class="js-facebook-invite dib smallmargin-bottom colorbutton social-button social-button--facebook fullwidth customtip customtip-html" title="Improve your Facebook data volumes by inviting<br/>Facebook users to authenticate">\n<span class="icon-bwfacebook smallpadding-right"></span>Invite Users to Authenticate <span class="betaIcon"></span>\n</a>\n</li>\n{{/canSeeFacebookButton}}\n{{#canSeeBuildNumber}}\n{{#buildNumber}}\n<li class="context-menu--item separator"></li>\n<li class="buildNumber smallpadding-bottom singlepadding-horizontal grey">{{buildNumber}}</li>\n{{/buildNumber}}\n{{/canSeeBuildNumber}}\n</ul>\n</li>\n{{/canSeeUserPreferences}}\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!css/userMenuView.css",["css!css/compiled.css"],function(){});function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}define("src/views/navigation/UserMenuView",["backbone","underscore","jquery","src/globals/flags","src/globals/flagNames","src/globals/theme","src/Workbench","src/globals/myClient","src/permissions","src/globals/me","src/models/LegacyUsageSummary","src/views/MyAccountDetailsView","src/views/navigation/HelpMenuView","src/views/invitefacebookusers/InviteFacebookUsersView","src/extensions/facebookanalytics/views/FacebookLoginView","src/helpers/twitterApiHelper","src/views/UsageSummaryPopup","src/helpers/gravatarHelper","mustache!templates/navigation/userMenu","src/packages/customtip","src/packages/dropdownmenus","src/packages/waitmask","css!css/userMenuView.css","css!css/socialButtons.css"],function(Backbone,_,$,flags,FLAGS,theme,Workbench,myClient,permissions,me,LegacyUsageSummary,MyAccountDetailsView,HelpMenuView,InviteFacebookUsersView,FacebookLoginView,twitterApiHelper,UsageSummaryPopup,gravatarHelper,userMenuTemplate){"use strict";var WAITMASK_HEIGHT=24;var VIEW_SELECTOR={FACEBOOK_INVITE:".js-facebook-invite"};function removeHelpMenuView(view){if(view.helpMenuView){view.helpMenuView.remove();view.helpMenuView=undefined}}function stopEventPropagation(e){e.stopPropagation()}return Backbone.View.extend({id:"primaryMenu",className:"nav",tagName:"ul",events:function events(){var _ref;return _ref={"click a.request-legacy-usage-report":"onClickRequestLegacyUsageReport","click .preferences .dropdown-toggle":"onClickPreferences","click .support .dropdown-toggle":"onClickSupport","click .twitter-login":"onTwitterLogin","click .editUserDetails":"onClickEditUserDetails","click a.twitter-logout":"onTwitterLogout"},_defineProperty(_ref,"click ".concat(VIEW_SELECTOR.FACEBOOK_INVITE),function click(){InviteFacebookUsersView.show()}),_defineProperty(_ref,"click .social-button--disabled",stopEventPropagation),_defineProperty(_ref,"click .waitmask",stopEventPropagation),_ref},constructor:function UserMenuView(){Backbone.View.apply(this,arguments);this.facebookLoginView=new FacebookLoginView},getButtonTemplate:function getButtonTemplate(options){var title="";if(options.title){title=' title="'+options.title+'"'}return"<a"+title+' class="db colorbutton social-button '+options.className+" "+options.jsClassName+' smallmargin-bottom">'+'<span class="smallpadding-right '+options.iconClassName+'"></span>'+options.text+"</a>"},getUserMenuOptions:function getUserMenuOptions(){return _.extend({},this.getUserGuideData(),{canSeeSupportPortal:theme.canSeeSupportPortal||false,canSeeUserPreferences:permissions.check("see.userPreferenceMenu"),canEditSubscriptions:permissions.check("edit.querySubscriptions"),oldUiUrl:theme.oldUiUrl,canSeeMyBrandwatch:theme.isBrandwatchOrGreyLabelTheme(),email:me.get("username"),avatarUrl:gravatarHelper.getLoggedUserGravatarUrl(16),mailto:theme.contactEmail||"support@brandwatch.com",productName:theme.productName||"support@brandwatch.com",canAccessLegacyUsageReport:myClient.get("isLegacy")&&permissions.check("see.legacyUsageSummary"),canSeeBuildNumber:permissions.check("see.buildNumber"),canSeeFeedbackLink:theme.canSeeFeedbackLink,feedbackUrl:theme.feedbackUrl,canAdmin:permissions.check("see.adminPage"),buildNumber:Workbench.buildNumber,canSeeFacebookButton:!flags.variation(FLAGS.HIDE_FB_AND_INSTAGRAM_SETUP)})},render:function render(){var data=this.getUserMenuOptions(),$html=$(userMenuTemplate(data)),facebookLoginView=this.facebookLoginView;this.$el.html($html);if(data.canSeeSupportPortal){this.helpMenuView=new HelpMenuView;this.helpMenuView.render();this.$(".support").replaceWith(this.helpMenuView.$el)}else{removeHelpMenuView(this)}this.$(".contact").customtip({position:"left"});this.$(".editUserDetails").customtip({position:"left"});this.$(".adminLink").customtip({position:"left"});this.$(VIEW_SELECTOR.FACEBOOK_INVITE).customtip({position:"left"});facebookLoginView.setElement(this.$(".facebook"))},remove:function remove(){var facebookLoginView=this.facebookLoginView;if(facebookLoginView&&_.isFunction(facebookLoginView.remove)){facebookLoginView.remove();this.facebookLoginView=undefined}removeHelpMenuView(this);this.querySubscriptions=undefined},showAdminMode:function showAdminMode(){this.$(".admin").addClass("hidden")},showAppMode:function showAppMode(){this.$(".adminLink").removeClass("hidden")},getUserGuideData:function getUserGuideData(){var userGuidePath=theme.userGuidePath||"/themes/blank/userguide14.pdf";return{canSeeUserGuide:_.isBoolean(theme.canSeeUserGuide)?theme.canSeeUserGuide:true,userGuidePath:userGuidePath}},onClickEditUserDetails:function onClickEditUserDetails(){MyAccountDetailsView.show()},onClickRequestLegacyUsageReport:function onClickRequestLegacyUsageReport(){UsageSummaryPopup.show({model:new LegacyUsageSummary({clientid:me.get("client").id})})},onClickPreferences:function onClickPreferences(){this.renderThirdPartyLoginButtons()},renderThirdPartyLoginButtons:function renderThirdPartyLoginButtons(){if(!flags.variation(FLAGS.HIDE_FB_AND_INSTAGRAM_SETUP)){this.facebookLoginView.render({cssClass:"fullwidth",title:"Authenticate to be able to collect mentions from public Facebook pages"})}this.renderTwitterButton()},renderTwitterButton:function renderTwitterButton(){var self=this;var link;this.$("li.twitter").html('<a class="smallmargin-bottom social-button social-button--twitter"></a>');this.$("li.twitter").find(".social-button--twitter").showWaitmask({minHeight:WAITMASK_HEIGHT});twitterApiHelper.getLoginStatus(function(err,authenticated){self.$("li.twitter").find(".social-button--twitter").hideWaitmask();if(authenticated){link=self.getButtonTemplate({className:"social-button--twitter",jsClassName:"twitter-logout",iconClassName:"icon-bwtwitter",text:"Unauthenticate with Twitter"})}else{link=self.getButtonTemplate({className:"social-button--twitter customtip",jsClassName:"twitter-login",iconClassName:"icon-bwtwitter",text:"Authenticate with Twitter",title:"Authenticate to be able to create Twitter channels"})}self.$("li.twitter").html(link).customtip({position:"left"})})},onTwitterLogout:function onTwitterLogout(){this.$("li.twitter").empty();twitterApiHelper.logout(function(){})},onTwitterLogin:function onTwitterLogin(){var self=this;twitterApiHelper.login(function(err){if(err){return}var link=self.getButtonTemplate({className:"social-button--twitter",jsClassName:"twitter-logout",iconClassName:"icon-bwtwitter",text:"Unauthenticate with Twitter"});self.$("li.twitter").empty();self.$("li.twitter").html(link)})},onFocusSupportSearchInput:function onFocusSupportSearchInput(){this.$(".js-search-button").removeClass("hidden")}})});define("mustache!templates/projectAccessPermission",["lib/mustache"],function(mustache){var escapedTemplate='<h1 class="popuptitletext singlemargin-bottom draggable">Choose Members for Project "{{projectName}}"</h1>\n<div class="body">\n<form>\n<div class="errorPane notification-error rounded smallpadding-vertical singlepadding-horizontal singlemargin-bottom hidden"></div>\n<div class="list">\n</div>\n<div class="note">\nUsers selected above will see the <b>Queries</b> that belong to this project as well as <b>Categories and Tags</b>.\n</div>\n<button class="save defaultbutton" disabled="disabled" data-at="save-project-members-button">Save Project Members</button>\n<button class="cancel button singlemargin-left">{{^projectJustCreated}}Cancel{{/projectJustCreated}}{{#projectJustCreated}}Not Now{{/projectJustCreated}}</button>\n</form>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/models/Workflow",["backbone","underscore"],function(Backbone,_){"use strict";var Workflow=Backbone.Model.extend({constructor:function Workflow(options){Backbone.Model.apply(this,arguments);this.projectId=options&&options.projectId},parse:function parse(data){var parsed=_(data).reduce(function(memo,item){memo[item.name.toLowerCase()]=item;return memo},{});return parsed},url:function url(){return"/projects/"+(this.projectId||"{projectId}")+"/workflow"}});return Workflow});define("src/globals/workflow",["src/globals/currentProject","src/models/Workflow"],function(currentProject,Workflow){"use strict";var workflow=new Workflow;currentProject.onLoad(function(callback){workflow.projectId=currentProject.id;if(!currentProject.id){workflow.reset([],{silent:false});return}workflow.clear({silent:true});workflow.fetch({success:function success(){callback()},error:function error(model,err){callback(err)}})});return workflow});define("src/models/ProjectSharing",["backbone","underscore"],function(Backbone,_){"use strict";var ProjectSharing=Backbone.Collection.extend({initialize:function initialize(models,options){this.projectId=options&&options.projectId;this.sharedOnly=options.sharedOnly;this.changedShares=[]},url:function url(){return"/projects/"+(this.projectId?this.projectId+"/":"")+"sharing"+(this.sharedOnly?"?sharedOnly=true":"")},setSharing:function setSharing(userId,isShared){var self=this,shares=this.where({userId:userId});_(shares).each(function(share){if(!share.get("isAdmin")&&share.get("isShared")!==isShared){share.set({isShared:isShared,canEdit:isShared});self.changedShares=_.filter(self.changedShares,function(changedShare){return changedShare.userId===userId?false:true});self.changedShares.push(share.toJSON())}})},isSharedWith:function isSharedWith(userId){return this.any(function(share){return share.get("userId")===userId&&share.get("isShared")})},save:function save(options){options=options||{};var success,error,projectId=this.projectId;if(!projectId){throw new Error("Cannot save without a projectId")}options.contentType="application/json";options.data=_(this.changedShares).map(function(share){share.projectId=projectId;return share});options.url=_.result(this,"url");success=options.success;error=options.error;options.success=_.bind(function(){this.changedShares=[];if(success){success.apply(this,arguments)}},this);options.error=_.bind(function(){_.each(this.models,function(model){model.set(model.previousAttributes())});if(error){error.apply(this,arguments)}},this);return Backbone.sync("update",this,options)}});return ProjectSharing});define("src/helpers/errorHelper",["src/ApiError"],function(ApiError){"use strict";return{getErrorMessage:function getErrorMessage(res){var apiError=new ApiError(res);return apiError.message}}});define("mustache!templates/projectSharing",["lib/mustache"],function(mustache){var escapedTemplate='<fieldset>\n{{#client}}\n<ul class="clients">\n<li class="client" data-clientid="{{id}}">\n<a class="expand">show users</a>\n<input type="checkbox" name="sharing-client" id="share-{{id}}" value="{{id}}" style="opacity: {{opacity}}" {{checked}} />\n<label for="share-{{id}}" title="{{name}}">\n<span class="grey">Client:</span>\n<span class="darkgrey bold">{{name}}</span>\n</label>\n\n<ul class="users hidden">\n{{#hasUsers}}\n{{#users}}\n<li>\n<input type="checkbox" name="sharing-user" id="user-{{id}}" value="{{id}}" {{checked}} {{disabled}} />\n<label for="user-{{id}}" {{#tooltip}}class="customtip" title="{{tooltip}}"{{/tooltip}}>{{username}}{{#isMe}} (You){{/isMe}}</label>\n</li>\n{{/users}}\n{{/hasUsers}}\n{{^hasUsers}}\n<li>No users exist for this client</li>\n{{/hasUsers}}\n</ul>\n</li>\n{{#subclients}}\n<li class="subclient" data-clientid="{{id}}">\n<a class="expand">show users</a>\n<input type="checkbox" name="sharing-client" id="share-{{id}}" value="{{id}}" style="opacity: {{opacity}}" {{checked}} />\n<label for="share-{{id}}" title="{{name}}">\n<span class="grey">Client:</span>\n<span class="darkgrey bold">{{name}}</span>\n</label>\n\n<ul class="users hidden">\n{{#hasUsers}}\n{{#users}}\n<li>\n<input type="checkbox" name="sharing-user" id="user-{{id}}" value="{{id}}" {{checked}} {{disabled}} />\n<label for="user-{{id}}" {{#tooltip}}class="customtip" title="{{tooltip}}"{{/tooltip}}>{{username}}{{#isMe}} (You){{/isMe}}</label>\n</li>\n{{/users}}\n{{/hasUsers}}\n{{^hasUsers}}\n<li>No users exist for this client</li>\n{{/hasUsers}}\n</ul>\n</li>\n{{/subclients}}\n</ul>\n{{/client}}\n</fieldset>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!css/projectSharingView.css",["css!css/compiled.css"],function(){});(function($,_){"use strict";function getBodyText(text,replaceNewLinesWithBreaks){if(!text){return""}return'<p class="wordellipsis">'+(replaceNewLinesWithBreaks?text.replace(/\n/g,"<br>"):text)+"</p>"}$.confirm=function(options,callback){var title=(_.isString(options)?options:options.title)||"";var text=options.text||"";var buttons=options.buttons||[{text:"OK",className:"ok",value:true,keyCode:13},{text:"Cancel",className:"cancel",value:false,keyCode:27}];var closeButtonClass=options.closeButtonClass||"tinypopup--close";var dialogClass=options.dialogClass||"tinypopup";var defaultButtonClass=options.defaultButtonClass||"defaultbutton";var returnValue=false;var replaceNewLinesWithBreaks=options.replaceNewLinesWithBreaks===false?false:true;var $confirm;var $button;var modal;var titleHtml;if(options.escape||!_.isBoolean(options.escape)){title=_.escape(title);text=_.escape(text)}$(document).on("keydown.confirmModal",function(e){var key=e.which;var btn=_.find(buttons,function(b){return b.keyCode===key});if(btn){returnValue=btn.value;modal.close()}});$confirm=$('<div class="modular">'+'<h1 class="floatleft popuptitletext singlemargin-bottom singlemargin-right">'+title+"</h1>"+'<a class="floatright icon-remove iconsmall lightgrey singlepadding cancel '+closeButtonClass+'"></a>'+'<div class="clearboth">'+getBodyText(text,replaceNewLinesWithBreaks)+'<p class="buttons doublemargin-top"></p>'+"</div>"+"</div>");_.each(buttons,function(btn,index){$button=$('<button class="'+(index===0?defaultButtonClass:"button")+" singlemargin-right "+btn.className+'">'+btn.text+"</button>").data("returnValue",btn.value);$confirm.find("p.buttons").append($button)});$confirm.on("click","button",function(e){e.preventDefault();returnValue=$(this).data("returnValue");modal.close()});modal=$confirm.showModal({className:"confirmModal "+dialogClass,close:"a.cancel",closeOnEsc:true,allowMultipleInstances:true,onClose:function onClose(){$(document).off("keydown.confirmModal");$confirm.off("button","click");if(callback){callback(returnValue)}}})}})($,_);define("lib/jquery.confirm",function(){});define("src/views/ProjectSharingView",["backbone","underscore","jquery","src/globals/myClient","src/globals/me","src/globals/currentProject","src/globals/workflow","src/models/ProjectSharing","src/helpers/errorHelper","mustache!templates/projectSharing","css!css/projectSharingView.css","lib/jquery.confirm","src/packages/customtip"],function(Backbone,_,$,myClient,me,currentProject,globalWorkflow,ProjectSharing,errorHelper,template){"use strict";function getSharedUsers(view){var users=view.$("[name=sharing-user]:checked:not(:disabled)").map(function(i,el){return parseInt(el.value,10)}).get();users.push(me.id);return users}var ProjectSharingView=Backbone.View.extend({className:"projectSharing",events:{"click a.expand":"toggleUsers","change input[name=sharing-client]":"onCheckClient","change input[name=sharing-user]":"onCheckUser"},constructor:function ProjectSharingView(){Backbone.View.apply(this,arguments);this.projectSharing=new ProjectSharing([],{projectId:this.model.id})},render:function render(){var self=this,$el=this.$el;$el.html('<div class="loading">Loading...</div>');self.projectSharing.fetch({success:function success(collection){self.setInitialSelection(collection);$el.html(template(self.getTemplateData(collection)));self.$el.customtip({position:"right"});self.trigger("renderComplete")},error:function error(collection,response){self.$el.showMessage({text:errorHelper.getErrorMessage(response),className:"notification-error"})}})},remove:function remove(){this.projectSharing.off()},setInitialSelection:function setInitialSelection(collection){this.initialSelection=collection.chain().filter(function(share){return share.get("isShared")&&!share.get("isAdmin")}).map(function(share){return share.get("userId")}).value()},getTemplateData:function getTemplateData(collection){var myId=me.id,clients={},client;collection.forEach(function(model){var isShared=model.has("isShared")?model.get("isShared"):model.get("isAdmin"),isMe=model.get("userId")===myId,isAdmin=model.get("isAdmin"),clientName=model.get("clientName"),client=clients[clientName];if(!client){client=clients[clientName]={id:model.get("clientId"),name:clientName,hasUsers:true,users:[]}}var toolTip;if(isAdmin){toolTip="You cannot remove an admin from the project"}else if(isMe){toolTip="You cannot remove yourself from the project"}client.users.push({id:model.get("userId"),username:model.get("username")||"",checked:isShared||isMe?"checked":"",disabled:isAdmin||isMe?"disabled":"",isMe:isMe,tooltip:toolTip})});client=_(clients).chain().sortBy(function(client){return client.name.toLowerCase()}).reduce(function(memo,client){var sharedUsers=0,users=_(client.users).chain().map(function(user){sharedUsers+=user.checked==="checked"?1:0;return user}).sortBy(function(user){return user.username.toLowerCase()}).value(),subclient,clientChecked,clientOpacity;(function determinedCheckedAndOpacity(){if(sharedUsers>0&&sharedUsers===users.length){clientChecked=true;clientOpacity=1}else if(sharedUsers>0){clientChecked=true;clientOpacity=.5}else{clientChecked=false;clientOpacity=1}})();if(client.id===myClient.id){memo.id=client.id;memo.name=client.name;memo.checked=clientChecked?"checked":"";memo.opacity=clientOpacity;memo.hasUsers=users.length>0;memo.users=users}else{subclient=client;subclient.users=users;subclient.checked=clientChecked?"checked":"";subclient.opacity=clientOpacity;memo.subclients.push(subclient)}return memo},{subclients:[]}).value();return{client:client}},isSharedWith:function isSharedWith(userId){return this.projectSharing.isSharedWith(userId)},toggleUsers:function toggleUsers(e){e.preventDefault();var $a=$(e.target).closest(".expand"),$users=$a.parent().find("ul.users");$a.toggleClass("expanded");$users.toggleClass("hidden")},onCheckClient:function onCheckClient(e){var $input=$(e.target),$li=$input.parent(),$users=$li.find("input[name=sharing-user]"),$checkableUsers=$users.filter(":not(:disabled)"),checking=$checkableUsers.filter(":checked").length!==$checkableUsers.length,toggle=$input.prop("checked");if(myClient.allowedMentionBasedSubclients()&&!$li.is(".client")){if(toggle&&$li.siblings(":not(.client)").find("input[name=sharing-client]:checked").length){$input.prop("checked",false);e.preventDefault();alert("You may not share this project with more than one subclient");return}}$input.css("opacity",1);$users.not(":disabled").prop("checked",checking).eq(0).change()},onCheckUser:function onCheckUser(e){var $input=$(e.target),$li=$input.parents("li[data-clientid]"),$clientInput=$li.find("input[name=sharing-client]"),$allUsers=$li.find("input[name=sharing-user]"),$checkedUsers=$allUsers.filter(":checked");if(myClient.allowedMentionBasedSubclients()&&!$li.is(".client")){if($checkedUsers.length&&$li.siblings(":not(.client)").find("input[name=sharing-user]:checked").length){$input.prop("checked",false);e.preventDefault();alert("You may not share this project with more than one subclient");return}}if($checkedUsers.length===0){$clientInput.prop("checked",false).css("opacity",1)}else if($checkedUsers.length!==$allUsers.length){$clientInput.prop("checked",true).css("opacity",.5)}else{$clientInput.prop("checked",true).css("opacity",1)}},canSave:function canSave(callback){var self=this,initialSelection=this.initialSelection,users=getSharedUsers(this);function confirmUnsharingFromUsers(done){if(_.difference(initialSelection,users).length===0){return done(true)}$.confirm({title:"Please Confirm",text:"After unsharing from users, their <b>Alerts</b> for Queries in this Project will also be <b>deleted</b>.",escape:false,buttons:[{text:"Continue",className:"ok",value:true,keyCode:13},{text:"Cancel",className:"cancel",value:false,keyCode:27}]},function(confirmed){done(confirmed)})}self.isAbleToSave=false;confirmUnsharingFromUsers(function(ok){if(!ok){return callback(false)}self.isAbleToSave=true;callback(true)})},save:function save(options){var projectSharing=this.projectSharing,users=getSharedUsers(this),origSuccessCallback;if(!this.model.id){throw new Error("Cannot save sharing for an unsaved project")}if(!this.isAbleToSave){throw new Error("Not able to save shares - please call canSave first and only continue on true")}this.projectSharing.each(function(share){var isShared=users.indexOf(share.get("userId"))>-1;projectSharing.setSharing(share.get("userId"),isShared);return share});if(_.isNumber(currentProject.id)&&currentProject.id===projectSharing.projectId){options=options||{};origSuccessCallback=options.success||function(){};options.success=function(){globalWorkflow.fetch();origSuccessCallback.apply(this,arguments)}}this.projectSharing.projectId=this.model.id;this.projectSharing.save(options)}});return ProjectSharingView});define("css!css/projectAccessPermission.css",["css!css/compiled.css"],function(){});define("src/views/ProjectAccessPermissionView",["underscore","src/permissions","src/views/ValidatingFormView","mustache!templates/projectAccessPermission","src/views/ProjectSharingView","src/ApiError","css!css/projectAccessPermission.css","src/packages/modalDialogs","src/packages/waitmask"],function(_,permissions,ValidatingFormView,template,ProjectSharingView,ApiError){"use strict";var ProjectAccessPermissionView=ValidatingFormView.extend({className:"projectAccessPermission",events:{"click .close":"onClose","click .cancel":"onClose","click .save":"onSubmit"},initialize:function initialize(options){ValidatingFormView.prototype.initialize.apply(this,arguments);if(!this.model){throw new Error("Please give a model/project")}if(!permissions.check("edit.projects")){throw new Error("You do not have permission to create new projects")}this.projectSharingView=new ProjectSharingView({model:this.model,preventUnshareSelf:options.preventUnshareSelf===false?false:true});this.projectJustCreated=!!options.projectJustCreated},remove:function remove(){this.off();this.$el.removeModal();ValidatingFormView.prototype.remove.call(this)},render:function render(){var self=this,$el=this.$el;$el.html(template({projectName:this.model.get("name"),projectJustCreated:this.projectJustCreated}));this.$(".list").append(this.projectSharingView.el);this.projectSharingView.on("renderComplete",function(){self.$("button").prop("disabled",false);self.projectSharingView.off("renderComplete")});this.projectSharingView.render()},onClose:function onClose(e){e.preventDefault();this.trigger("cancelled");this.remove()},onSubmit:function onSubmit(e){e.preventDefault();var self=this;this.projectSharingView.canSave(function(confirmed){if(!confirmed){return}self.$el.showWaitmask("Saving...");self.$(".errorPane").addClass("hidden");self.projectSharingView.save({success:function success(model){self.$el.hideWaitmask();self.trigger("confirmed",model);self.remove()},error:function error(xhr){var jsonError=new ApiError(xhr);self.$el.hideWaitmask();self.$(".errorPane").removeClass("hidden").html(jsonError.message)}})})}},{show:function show(options){options=options||{};var popup=new ProjectAccessPermissionView({model:options.project,projectJustCreated:options.projectJustCreated});popup.render();popup.$el.showModal(_.extend({className:"projectAccessPermissionModal popup smallpopup",draggable:"h1:first",onClose:function onClose(){popup.remove()}},options.modalOpts));return popup}});return ProjectAccessPermissionView});define("mustache!templates/timezoneSelleckt",["lib/mustache"],function(mustache){var escapedTemplate='<select name="timezone-select" class="timezone-select"></select>';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("text!templates/timezoneSellecktItem.template",[],function(){return'<li class="{{itemClass}} smallpadding relative db textellipsis ellipsistooltip customtip" title="{{label}}" data-text="{{label}}" data-value="{{value}}">\n    <span class="timezone-name {{itemTextClass}}">{{label}}</span>\n    <span class="timezone-offset grey">{{offset}}</span>\n</li>'});define("text!src/controls/templates/sellecktMain.template",[],function(){return'<div class="{{className}}" tabindex=1>\n    {{^selectionBottom}}\n    <ul class="{{selectionsClass}} top bwscrollbar-narrow">\n    {{#selections}}\n    {{/selections}}\n    </ul>\n    {{/selectionBottom}}\n    <div class="{{selectedClass}} rounded darkgrey smallpadding-horizontal relative">\n        <span class="{{selectedTextClass}} dib doublepadding-right textellipsis">{{selectedItemText}}</span><i class="icon-chevron-down rounded linkblue absright hugeline smallmargin-right"></i>\n    </div>\n    {{#selectionBottom}}\n        <ul class="selections bottom">\n        {{#selections}}\n            {{{selections}}}\n        {{/selections}}\n        </ul>\n    {{/selectionBottom}}\n</div>\n'});define("text!src/controls/templates/sellecktItem.template",[],function(){return'<li\n    class="{{itemClass}} smallpadding relative db textellipsis ellipsistooltip customtip"\n    title="{{label}}"\n    data-text="{{label}}"\n    data-value="{{value}}">\n    {{#data.typeiconclass}}\n        <span class="{{itemClass}}__icon {{data.typeiconclass}}"></span>\n    {{/data.typeiconclass}}\n    <span class="{{itemTextClass}}">{{label}}</span>\n</li>\n'});define("text!src/controls/templates/sellecktPopup.template",[],function(){return'<div class="{{itemsClass}} keepMinWidth lightshadow">\n    {{#showSearch}}\n    <div class="searchContainer smallpadding relative db">\n        <input class="{{searchInputClass}} rounded"/>\n    </div>\n    {{/showSearch}}\n    <ul class="{{itemslistClass}}">\n        {{#items}}\n            {{> item}}\n        {{/items}}\n        {{^items}}\n        <li class="empty smallpadding relative db textellipsis">\n            <span class="{{itemTextClass}} lightgrey">No items</span>\n        </li>\n        {{/items}}\n    </ul>\n    {{#footer}}\n    <footer class="footer smallpadding relative db">\n        {{{footer}}}\n    </footer>\n    {{/footer}}\n</div>\n'});define("css!css/selleckt.css",["css!css/compiled.css"],function(){});define("src/packages/selleckt",["underscore","jquery","text!src/controls/templates/sellecktMain.template","text!src/controls/templates/sellecktItem.template","text!src/controls/templates/sellecktPopup.template","css!css/selleckt.css","src/packages/sellecktLoader"],function(_,$,mainTemplate,itemTemplate,popupTemplate){"use strict";var originalSelleckt=$.fn.selleckt,defaults={className:"selleckt",mainTemplate:mainTemplate,itemTemplate:itemTemplate,popupTemplate:popupTemplate};$.fn.selleckt=function(options){var finalOptions,settings=_(defaults).clone();options=options||{};if(options.additionalClassName){settings.className=[settings.className,options.additionalClassName].join(" ")}finalOptions=_.extend({},settings,options,{mainTemplateData:_.extend({},settings.mainTemplateData,options.mainTemplateData)});return originalSelleckt.call(this,finalOptions)}});define("css!css/timezoneSelleckt.css",["css!css/compiled.css"],function(){});define("src/views/TimezoneSelleckt",["backbone","underscore","moment-timezone","bw-fe-helpers/timezoneDateHelper","mustache!templates/timezoneSelleckt","text!templates/timezoneSellecktItem.template","src/packages/selleckt","css!css/timezoneSelleckt.css"],function(Backbone,_,moment,timezoneDateHelper,template,timezoneSellecktItem){"use strict";function getDefaultSellecktOptions(){return{placeholderText:"- Select a timezone -",hideSelectedItem:true,enableSearch:true,searchThreshold:-1,additionalClassName:"timezone-selleckt",itemTemplate:timezoneSellecktItem,itemslistClass:"timezones-list"}}return Backbone.View.extend({className:"timezone-selleckt-view",constructor:function TimezoneSelleckt(options){options=options||{};this.sellecktOptions=_.extend(getDefaultSellecktOptions(),options.sellecktOptions);Backbone.View.apply(this,arguments)},render:function render(){var currentTimeZone=moment.tz.guess();var currentTime=moment().unix()*1e3;var timezones=timezoneDateHelper.getSupportedTimezones().map(function(tz){var abbr=moment.tz.zone(tz).abbr(currentTime);var label=tz.replace(/_/g," ");label=abbr?label+" (".concat(abbr,")"):label;return{offset:moment.tz(tz).format("Z"),value:tz,label:label,aliases:abbr?[abbr]:[]}});this.$el.html(template());this.$select=this.$(".timezone-select");this.sellecktInstance=this.$select.selleckt(this.sellecktOptions).data("selleckt");this.sellecktInstance.addItems(timezones);this.selectTimezone(currentTimeZone)},getSelectedTimezone:function getSelectedTimezone(){var pickerSelection=this.sellecktInstance.getSelection();return pickerSelection?pickerSelection.value:null},selectTimezone:function selectTimezone(tz){this.sellecktInstance.selectItemByValue(tz)},remove:function remove(){if(this.sellecktInstance){this.sellecktInstance.destroy()}Backbone.View.prototype.remove.call(this)},disable:function disable(){this.$(".timezone-selleckt").addClass("disabled")},enable:function enable(){this.$(".timezone-selleckt").removeClass("disabled")},isEnabled:function isEnabled(){return!this.$(".timezone-selleckt").hasClass("disabled")}})});define("src/events/dashboardEvents",["underscore","backbone"],function(_,Backbone){"use strict";return _.clone(Backbone.Events)});define("mustache!templates/projectForm",["lib/mustache"],function(mustache){var escapedTemplate='<div>\n<div class="errorPane notification-error rounded smallpadding-vertical singlepadding-horizontal singlemargin-bottom hidden"></div>\n<fieldset class="main">\n<div class="singlemargin-bottom">\n<label for="name" class="db smallmargin-bottom">Name*</label>\n<input type="text" name="name" id="name" class="validation-wrapper field input--block" value="{{name}}" data-at="enter-project-name" placeholder="Enter Project name" autofocus autocomplete="off" />\n</div>\n<div class="singlemargin-bottom">\n<label for="description" class="db smallmargin-bottom">Description</label>\n<textarea class="field input--block" name="description" id="description">{{description}}</textarea>\n</div>\n<div class="singlemargin-bottom">\n<div class="smallmargin-bottom">\n<label>Default timezone* </label>\n<a class="help icon-bwhelp" data-key="{{timezonesHelpKey}}"></a>\n<span class="project-form__reload grey singlemargin-left hidden">requires page reload</span>\n</div>\n<div class="timezone-selleckt-container"></div>\n</div>\n<div class="doublemargin-top relative js-form-controls">\n<span class="mediumtext grey abstop absright">* required</span>\n<button class="submit defaultbutton js-submit" data-at="create-project-button">{{#id}}Save Project{{/id}}{{^id}}Create Project{{/id}}</button>\n{{#canBeCancelled}}\n<button class="cancel button singlemargin-left">Cancel</button>\n{{/canBeCancelled}}\n</div>\n</fieldset>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!css/projectForm.css",["css!css/compiled.css"],function(){});define("css!css/tabs.css",["css!css/compiled.css"],function(){});define("src/views/ProjectForm",["jquery","underscore","q","bw-fe-helpers/urlHelper","src/permissions","src/globals/currentProject","src/views/ValidatingFormView","src/views/ProjectAccessPermissionView","src/views/TimezoneSelleckt","src/analytics/Analytics","src/events/administrationEvents","src/events/dashboardEvents","src/events/globalEventNames","mustache!templates/projectForm","src/packages/waitmask","src/packages/modalDialogs","lib/jquery.notify","css!css/projectForm.css","css!css/tabs.css"],function($,_,Q,urlHelper,permissions,currentProject,ValidatingFormView,ProjectAccessPermissionView,TimezoneSelleckt,Analytics,administrationEvents,dashboardEvents,globalEventNames,template){"use strict";var COULD_NOT_FETCH_PROJECT="Sorry, we couldn't load your Project. Please try again.";function trackProjectSaveEvent(projectId){Analytics.trackEvent({name:"Miscellaneous.Project",action:"Save",origin:"Application",values:{projectId:projectId}})}function fireProjectUpdatedEvent(savedModel){return administrationEvents.trigger(globalEventNames.ADMINISTRATION.PROJECT_UPDATED,savedModel)}return ValidatingFormView.extend({_fetchProjectData:function _fetchProjectData(options){if(this.model.isNew()){options.success(this.model.toJSON())}else{this.model.fetch({success:function success(model){options.success(model.toJSON())},error:options.error})}},_getModelValuesFromDom:function _getModelValuesFromDom(){return{name:this.$("[name=name]").val(),description:this.$("[name=description]").val(),timezone:this.timezoneSelleckt.getSelectedTimezone()}},_handleError:function _handleError(){$.notify({text:COULD_NOT_FETCH_PROJECT,duration:7e3,className:"notification-error"});this.trigger("error")},className:"projectForm modular",events:function events(){return{"click button.submit":"onSubmit","click button.cancel":"onCancel","submit form":"ignoreFormSubmit","change .timezone-selleckt-container":"toggleReloadWarn"}},constructor:function ProjectForm(options){if(!permissions.check("edit.projects")){throw new Error("You do not have permission to create new projects")}this.autoOpen=options.autoOpen!==false;this.inAdmin=options.inAdmin;this.canBeCancelled=options.canBeCancelled;this.timezoneSelleckt=new TimezoneSelleckt;ValidatingFormView.apply(this,arguments);this.initialTimezone=this.model.getTimezone()},remove:function remove(){this.timezoneSelleckt.remove();this.off();ValidatingFormView.prototype.remove.call(this)},render:function render(){this.$el.showWaitmask("Loading...");this._fetchProjectData({success:this.renderForm.bind(this),error:this._handleError.bind(this)})},renderForm:function renderForm(data){data.timezonesHelpKey="timezones-help-tip";data.memberCount=data.users?data.users.length:0;data.canBeCancelled=this.canBeCancelled;this.$el.html(template(data));this._renderTimezoneSelleckt();this.$el.hideWaitmask()},_renderTimezoneSelleckt:function _renderTimezoneSelleckt(){this.timezoneSelleckt.render();this.timezoneSelleckt.sellecktInstance.$sellecktEl.attr("name","timezone");this.timezoneSelleckt.sellecktInstance.$sellecktEl.addClass("validation-wrapper");if(this.model.get("timezone")){this.timezoneSelleckt.selectTimezone(this.model.get("timezone"))}this.$(".timezone-selleckt-container").append(this.timezoneSelleckt.$el)},ignoreFormSubmit:function ignoreFormSubmit(e){e.preventDefault()},onSubmit:function onSubmit(e){e.preventDefault();this.saveProject()},saveProject:function saveProject(){var self=this,isNew=this.model.isNew();this.$el.showWaitmask("Saving...");this.model.save(this._getModelValuesFromDom(),{success:function success(model){return self.handleTimezonePromise(self.initialTimezone,isNew).then(function(){var sharingView;self.$el.hideWaitmask();trackProjectSaveEvent(model.get("id"));fireProjectUpdatedEvent(model);if(model.id===currentProject.id&&_.isNumber(currentProject.id)){currentProject.set(model.toJSON())}if(isNew){sharingView=self.showProjectSharingView(model);sharingView.on("confirmed cancelled",function(){self.trigger("confirmed",model);if(self.autoOpen){var app=require("app");app.navigate("/project/"+model.id,{trigger:true})}})}else{self.trigger("confirmed",model)}})},error:function error(model,response){self.$el.hideWaitmask();self.onServerError(model,response)}});if(this.model.validationError){this.$el.hideWaitmask()}},onCancel:function onCancel(e){e.preventDefault();this.trigger("cancelled")},showProjectSharingView:function showProjectSharingView(model){return ProjectAccessPermissionView.show({project:model,preventUnshareSelf:false,projectJustCreated:true})},toggleReloadWarn:function toggleReloadWarn(){var isHidden=this._getModelValuesFromDom().timezone===this.initialTimezone;this.$(".project-form__reload").toggleClass("hidden",isHidden)},handleTimezonePromise:function handleTimezonePromise(initialTimezone,wasProjectNew){var model=this.model;var eventArgs={source:"project",isHandled:false,action:function action(){urlHelper.reloadURL(true)}};if(model.getTimezone()===initialTimezone||wasProjectNew){return new Q}return Analytics.trackMixpanelEvent(globalEventNames.PROJECTS.NEW_TIMEZONE_CHOSEN,{oldTimezone:initialTimezone||"",newTimezone:model.getTimezone()||"",suggestedByUI:false}).then(function(){dashboardEvents.trigger(globalEventNames.DASHBOARDS.TIMEZONE_UPDATED,eventArgs);if(!eventArgs.isHandled){eventArgs.action()}})}})});define("mustache!templates/projectModalFormView",["lib/mustache"],function(mustache){var escapedTemplate='<h1 class="popuptitletext singlemargin-bottom draggable">\n{{^isNew}}\nEdit Project\n{{/isNew}}\n{{#isNew}}\nCreate New Project\n{{/isNew}}\n</h1>\n<div class="project-form-container" data-at="project-modal-form"></div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!css/projectModalFormView.css",["css!css/compiled.css"],function(){});define("src/views/ProjectModalFormView",["backbone","src/views/ProjectForm","src/models/Project","mustache!templates/projectModalFormView","src/packages/modalDialogs","css!css/projectModalFormView.css","css!css/tabs.css"],function(Backbone,ProjectForm,Project,template){"use strict";var ProjectModalFormView=Backbone.View.extend({className:"project-modal-form-view",constructor:function ProjectModalFormView(options){this.projectForm=new ProjectForm(options);this.listenTo(this.projectForm,"confirmed",function onConfirm(model){this.trigger("confirmed",model);this.remove()});this.listenTo(this.projectForm,"cancelled",function onCancel(){this.remove()});Backbone.View.apply(this,arguments)},remove:function remove(){this.projectForm.remove();Backbone.View.prototype.remove.call(this)},render:function render(){this.$el.html(template({isNew:this.model.isNew()}));this.projectForm.render();this.$(".project-form-container").append(this.projectForm.$el)}},{show:function show(opts){var options=opts||{},view=new ProjectModalFormView({model:options.model||new Project,autoOpen:options.autoOpen,inAdmin:options.inAdmin,canBeCancelled:true,preSelectedBillableClientId:options.clientId}),oldRemove=view.remove;view.remove=function(){view.$el.removeModal();oldRemove.apply(this,arguments)};view.$el.showModal({draggable:".project-modal-form-view > h1:first",className:"popup tinypopup"});view.render();view.$el.centreModal();return view}});return ProjectModalFormView});define("mustache!templates/projectSelectionView",["lib/mustache"],function(mustache){var escapedTemplate='<select class="loadingIndicator selectfield projectSelector" disabled></select>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("text!templates/projectselection/projectSelectorMain.template",[],function(){return'<div class="{{className}}" tabindex=1>\n    <div class="{{selectedClass}} rounded darkgrey smallpadding-horizontal relative" data-at="project-selected-class">\n        <span class="{{selectedTextClass}} dib doublepadding-right fullwidth textellipsis valignmiddle" data-at="project-selected-class-name">{{selectedItemText}}</span><i class="icon-chevron-down rounded linkblue absright hugeline smallmargin-right"></i>\n    </div>\n</div>\n'});define("text!templates/projectselection/projectSelectorItem.template",[],function(){return'<li data-text="{{label}}" data-value="{{value}}" class="{{itemClass}}">\n    <span class="smallmargin-right iconbig icon-folder-close"></span>\n    <p class="name bigtext textellipsis {{itemTextClass}}" data-at="project-list-itemlist-name">{{label}}</p>\n</li>\n'});define("text!templates/projectselection/projectSelectorItemsPopup.template",[],function(){return'<div class="projectSelleckt {{itemsClass}} lightshadow">\n    <div class="searchContainer smallpadding relative db">\n        <input class="{{searchInputClass}} rounded" placeholder="search"></input>\n    </div>\n    <ul class="{{itemslistClass}} " data-at="project-pop-up-list">\n        {{#items}}\n            {{> item}}\n        {{/items}}\n    </ul>\n    {{#showFooter}}\n    <footer class="footer smallpadding relative db">\n        <a class="newProject doublepadding-horizontal customtip" data-at="new-project-tip">\n            <span class="icon-plus singlepadding-left smallpadding-right grey"></span><span>New</span>\n        </a>\n        <a class="manageProjects doublepadding-horizontal" href="/administration/projects" target="admin" tabindex="-1">\n            <span>Manage all Projects</span><span class="icon-external-link smallpadding-left grey"></span>\n        </a>\n    </footer>\n    {{/showFooter}}\n</div>\n'});define("css!css/projectSellecktor.css",["css!css/compiled.css"],function(){});define("src/views/ProjectSelectionView",["jquery","backbone","underscore","src/permissions","src/storageProvider","src/globals/currentProject","src/views/ProjectModalFormView","src/models/Project","src/events/projectEvents","src/events/globalEventNames","mustache!templates/projectSelectionView","text!templates/projectselection/projectSelectorMain.template","text!templates/projectselection/projectSelectorItem.template","text!templates/projectselection/projectSelectorItemsPopup.template","src/packages/selleckt","css!css/projectSellecktor.css","src/packages/customtip"],function($,Backbone,_,permissions,storageProvider,currentProject,ProjectModalFormView,Project,projectEvents,globalEventNames,projectSelectionViewTemplate,projectSelectorMainTemplate,projectSelectorItemTemplate,projectSelectorItemsPopup){"use strict";function prepareCollection(collection,selectedProjectId,projectListToExclude){var projects=getFilteredProjects(collection,projectListToExclude);return projects.map(function(item){return{label:item.get("name"),value:item.id,isSelected:selectedProjectId&&item.id===selectedProjectId}})}function makeCurrentProjectLi(projectName,projectId){return'<li class="item" data-text="'+_.escape(projectName)+'"'+'data-value="'+projectId+'">'+'<span class="smallmargin-right iconbig icon-ok"></span>'+'<span class="smallmargin-right iconbig icon-folder-open"></span>'+'<p class="name bigtext textellipsis currentproject" data-at="project-name-current-project">'+_.escape(projectName)+"</p>"+"</li>"}function addCurrentProject(projectData,$popupEl){if(!!projectData&&projectData.value){var $li=$(makeCurrentProjectLi(projectData.label,projectData.value));$popupEl.find(".itemslist").prepend($li)}}function getFilteredProjects(collection,projectListToExclude){if(!projectListToExclude||projectListToExclude.length===0){return collection}return collection.filter(function(item){return projectListToExclude.indexOf(item.id)===-1})}var PROJECT_EVENT_NAMES=globalEventNames.PROJECTS;return Backbone.View.extend({className:"projectSelectionView",constructor:function ProjectSelectionView(options){Backbone.View.apply(this,arguments);if(!options||!options.collection){throw new Error("ProjectSelectionView must be instantiated with a collection option")}this.allowEdit="allowEdit"in options?Boolean(options.allowEdit):permissions.check("edit.projects");this.currentProject=options.currentProject;this.containerCssClass=options.containerCssClass;this.dropdownCssClass=options.dropdownCssClass;this.projectListToExclude=options.projectListToExclude;this.listenTo(projectEvents,PROJECT_EVENT_NAMES.PROJECT_CREATE,function(project){var sellecktInstance=this.sellecktInstance;this.collection.add(project,{silent:true});if(!sellecktInstance){return}sellecktInstance.addItem({label:project.get("name"),value:project.id,isSelected:true})})},events:{"click .newProject":"onAddProject"},render:function render(){var instantiateDropdown=_.bind(this.instantiateDropdown,this);var currentProjectId=this.currentProject&&this.currentProject.id;var projectListToExclude=this.projectListToExclude;this.$el.html(projectSelectionViewTemplate());if(this.collection.size()){return instantiateDropdown(prepareCollection(this.collection,currentProjectId,projectListToExclude))}this.collection.fetch({success:function success(collection){instantiateDropdown(prepareCollection(collection,currentProjectId,projectListToExclude))}})},remove:function remove(){if(this.sellecktInstance){this.sellecktInstance.destroy()}Backbone.View.prototype.remove.call(this)},instantiateDropdown:function instantiateDropdown(items){var onAddProject=_.bind(this.onAddProject,this),trigger=_.bind(this.trigger,this),selleckt=this.sellecktInstance=this.$(".projectSelector").selleckt({hideSelectedItem:true,enableSearch:true,searchThreshold:-1,mainTemplate:projectSelectorMainTemplate,itemTemplate:projectSelectorItemTemplate,popupTemplate:projectSelectorItemsPopup,popupTemplateData:{showFooter:this.allowEdit}}).data("selleckt");selleckt.on("onPopupCreated",function(popup){var $popupEl=popup.$popup,projectData=this.getSelection();addCurrentProject(projectData,$popupEl);$popupEl.on("click",".newProject",function(){onAddProject()});trigger("open")});selleckt.on("optionsFiltered",function(){var projectData=this.getSelection();addCurrentProject(projectData,selleckt.popup.$popup)});selleckt.addItems(items);selleckt.on("itemSelected",_.bind(this.onProjectChange,this));selleckt.on("close",function(){trigger("close")});if(this.currentProject&&this.currentProject.id){this.selectProject(this.currentProject.id)}},closeSelleckt:function closeSelleckt(){return this.sellecktInstance&&this.sellecktInstance._close()},onProjectChange:function onProjectChange(item){var newProjectId=parseInt(item.value,10);var newProject=this.collection.get(newProjectId);var oldProjectId=this.currentProject&&this.currentProject.id;if(oldProjectId===newProjectId){return}this.currentProject=newProject;storageProvider.set("currentProject",newProject.toJSON());this.trigger(PROJECT_EVENT_NAMES.PROJECT_CHANGE,{newProject:newProject,newProjectId:newProjectId,oldProjectId:oldProjectId})},selectProject:function selectProject(projectId){if(!this.sellecktInstance){this.currentProject=currentProject;return}this.sellecktInstance.selectItemByValue(projectId,{silent:true})},onAddProject:function onAddProject(){var project=new Project,view=ProjectModalFormView.show({model:project});this.listenToOnce(view,"confirmed",function(){projectEvents.trigger(PROJECT_EVENT_NAMES.PROJECT_CREATE,project)})},hasResults:function hasResults(){return this.collection.length>0},setFocus:function setFocus(){return this.sellecktInstance&&this.sellecktInstance.$sellecktEl.focusin()}})});define("mustache!templates/projectSwitcher",["lib/mustache"],function(mustache){var escapedTemplate='<div class="projectSelector smallmargin-left customtip" title="Switch Project"></div>\n{{#canEdit}}\n<div class="extraButtons smallpadding-horizontal">\n<a class="editproject lightgrey smallpadding-horizontal smallpadding-top icon-pencil customtip" title="Edit this Project"></a>\n<a class="editmembers lightgrey smallpadding-horizontal smallpadding-top bwicon icon-bwusers customtip" title="Edit Project Members"></a>\n</div>\n{{/canEdit}}\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!templates/timezoneSelectionRadioButtons",["lib/mustache"],function(mustache){var escapedTemplate='<div class="doublemargin-top default-timezone-section">\n<input name="timezone-radio" id="defaultTimezone" type="radio" value="{{defaultTimezone}}" class="default-timezone-radio">\n<label for="defaultTimezone" class="smallmargin-left">{{ defaultTimezoneLabel }}</label>\n</div>\n\n<div class="singlemargin-top timezone-picker-section">\n<input name="timezone-radio" id="custom-timezone" type="radio" value="selleckt" class="custom-timezone-radio">\n{{#customTimezoneLabel}}\n<label for="custom-timezone" class="smallmargin-left">{{customTimezoneLabel}}</label>\n{{/customTimezoneLabel}}\n<div class="smallmargin-left timezone-selleckt-container"></div>\n</div>';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!css/timezoneSelectionRadioButtons.css",["css!css/compiled.css"],function(){});define("src/views/TimezoneSelectionRadioButtons",["backbone","src/views/TimezoneSelleckt","mustache!templates/timezoneSelectionRadioButtons","css!css/timezoneSelectionRadioButtons.css","src/packages/modalDialogs"],function(Backbone,TimezoneSelleckt,template){"use strict";return Backbone.View.extend({className:"timezone-selection-radio-buttons",events:{"click .default-timezone-radio":"selectDefaultTimezoneOption","click .custom-timezone-radio":"selectCustomTimezoneOption","click .timezone-selleckt":function onTimezoneSellecktClick(){this.$(".custom-timezone-radio").prop("checked",true);this.timezoneSelleckt.enable();this._handleTimezoneChange(this.timezoneSelleckt.getSelectedTimezone())},"change .timezone-select":function onTimezoneSelectChange(ev){this._handleTimezoneChange(ev.target.value)}},constructor:function TimezoneSelectionRadioButtons(options){options=options||{};this.timezoneSelleckt=new TimezoneSelleckt;this.preselectedTimezone=options.preselectedTimezone;this.defaultTimezone=options.defaultTimezone;this.defaultTimezoneLabel=options.defaultTimezoneLabel;this.customTimezoneLabel=options.customTimezoneLabel;this.preferCustomOption=options.preferCustomOption;Backbone.View.apply(this,arguments)},render:function render(){this.timezoneSelleckt.render();this.$el.html(template({defaultTimezone:this.defaultTimezone,defaultTimezoneLabel:this.defaultTimezoneLabel,customTimezoneLabel:this.customTimezoneLabel}));this.$(".timezone-selleckt-container").append(this.timezoneSelleckt.$el);if(this.preselectedTimezone!==this.defaultTimezone||this.preferCustomOption){this.$(".custom-timezone-radio").prop("checked",true);this.timezoneSelleckt.enable();this.timezoneSelleckt.selectTimezone(this.preselectedTimezone)}else{this.$(".default-timezone-radio").prop("checked",true);this.timezoneSelleckt.disable()}},selectDefaultTimezoneOption:function selectDefaultTimezoneOption(){this.$(".default-timezone-radio").prop("checked",true);this.timezoneSelleckt.disable();this._handleTimezoneChange(this.defaultTimezone,true)},selectCustomTimezoneOption:function selectCustomTimezoneOption(){this.$(".custom-timezone-radio").prop("checked",true);this.timezoneSelleckt.enable();this._handleTimezoneChange(this.timezoneSelleckt.getSelectedTimezone())},remove:function remove(){this.timezoneSelleckt.remove();Backbone.View.prototype.remove.call(this)},_handleTimezoneChange:function _handleTimezoneChange(timezone,isDefault){this.trigger("selected-timezone-changed",timezone,!!isDefault)}})});define("mustache!templates/timezoneSelectionView",["lib/mustache"],function(mustache){var escapedTemplate='<div class="timezone-selection-view pagepadding">\n<p class="popuptitletext timezone-selection-view--title">Choose a time zone for this Project</p>\n<p class="singlemargin-top timezone-selection-view--description">\nYou now have the option to select a time zone for this Project. This will mean that everything you view in your\nProject will be displayed in that time zone, including Dashboards and tools such as Alerts. You can edit the time\nzone at any time via the Project settings and can also edit it within individual Dashboards if you wish.\n</p>\n\n{{#isLinkToSupportPortalVisible}}\n<p class="singlemargin-top timezone-selection-view--support-portal-link">\n<a href="{{supportPortalLink}}" target="_blank">\nRead more about how time zones work\n</a>\n</p>\n{{/isLinkToSupportPortalVisible}}\n\n<div class="timezone-radio-buttons-container"></div>\n\n<div class="doublemargin-top">\n<button class="defaultbutton timezone-apply">Apply Time Zone and Reload</button>\n<button class="singlemargin-left button timezone-cancel">Not Now</button>\n</div>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!css/timezoneSelectionView.css",["css!css/compiled.css"],function(){});define("src/views/TimezoneSelectionView",["backbone","src/globals/theme","src/views/TimezoneSelectionRadioButtons","bw-fe-helpers/timezoneDateHelper","src/events/globalEventNames","bw-fe-helpers/urlHelper","src/analytics/Analytics","mustache!templates/timezoneSelectionView","src/packages/selleckt","src/packages/modalDialogs","css!css/timezoneSelectionView.css"],function(Backbone,theme,TimezoneSelectionRadioButtons,timezoneDateHelper,globalEventNames,urlHelper,Analytics,template){"use strict";var SUPPORT_PORTAL_LINK="https://support.brandwatch.com/hc/en-us/articles/207677358";var TimezoneSelectionView=Backbone.View.extend({_selectedTimezone:timezoneDateHelper.DEFAULT_TIMEZONE,events:{"click .timezone-cancel":function onCancelClick(){this.remove()},"click .timezone-apply":function onApplyClick(){var trackTimezoneChange=this.trackTimezoneChange.bind(this),self=this;this.model.set("timezone",this._selectedTimezone);this.model.save().then(trackTimezoneChange).then(function(){self.remove();urlHelper.reloadURL(true)})}},constructor:function TimezoneSelectionView(options){options=options||{};this.model=options.model;this.timezoneRadioButtons=new TimezoneSelectionRadioButtons({preselectedTimezone:this._selectedTimezone,defaultTimezone:this._selectedTimezone,defaultTimezoneLabel:"Keep as UTC",customTimezoneLabel:"Change to"});this.listenTo(this.timezoneRadioButtons,"selected-timezone-changed",this.onSelectedTimezoneChanged);Backbone.View.apply(this,arguments)},render:function render(){this.timezoneRadioButtons.render();this.$el.html(template({supportPortalLink:SUPPORT_PORTAL_LINK,isLinkToSupportPortalVisible:theme.isBrandwatchOrGreyLabelTheme()||theme.canSeeSupportPortal}));this.$(".timezone-radio-buttons-container").append(this.timezoneRadioButtons.$el)},remove:function remove(){this.timezoneRadioButtons.remove();Backbone.View.prototype.remove.call(this)},trackTimezoneChange:function trackTimezoneChange(){return Analytics.trackMixpanelEvent(globalEventNames.PROJECTS.NEW_TIMEZONE_CHOSEN,{oldTimezone:"",newTimezone:this._selectedTimezone||"",suggestedByUI:true})},onSelectedTimezoneChanged:function onSelectedTimezoneChanged(timezone){this._selectedTimezone=timezone;this.$(".timezone-apply").prop("disabled",!timezone)}},{show:function show(model){var view,remove;view=new TimezoneSelectionView({model:model});remove=view.remove;view.remove=function(){this.$el.removeModal();remove.call(this)};view.render();view.$el.showModal({onClose:function onClose(){view.remove()}});return view}});return TimezoneSelectionView});define("css!css/font-awesome.css",["css!css/compiled.css"],function(){});define("css!css/projectSwitcher.css",["css!css/compiled.css"],function(){});define("src/views/ProjectSwitcherView",["backbone","q","src/permissions","src/events/projectEvents","src/events/globalEventNames","src/views/ProjectModalFormView","src/views/ProjectAccessPermissionView","src/views/ProjectSelectionView","mustache!templates/projectSwitcher","src/views/TimezoneSelectionView","src/packages/modalDialogs","src/packages/spin","src/packages/customtip","css!css/font-awesome.css","css!css/projectSwitcher.css"],function(Backbone,Q,permissions,projectEvents,globalEventNames,ProjectModalFormView,ProjectAccessPermissionView,ProjectSelectionView,projectSwitcherTemplate,TimezoneSelectionView){"use strict";var PROJECT_EVENT_NAMES=globalEventNames.PROJECTS;return Backbone.View.extend({className:"projectSwitcher modular",events:{"click .editproject":"onClickEditProject","click .editmembers":"onClickEditMembers"},initialize:function initialize(options){var collection=this.collection=options.collection,projectSelectionView;projectSelectionView=this.projectSelectionView=new ProjectSelectionView({collection:collection,currentProject:this.model.toJSON()});this.listenTo(projectSelectionView,PROJECT_EVENT_NAMES.PROJECT_CHANGE,this.onSelectProject,this);this.listenTo(projectSelectionView,"open",this.onOpenSwitcher,this);this.listenTo(projectSelectionView,"close",this.onCloseSwitcher,this);this.listenTo(this.model,"change",this.onChangeProject);this.listenTo(this.model,"sync",this.onProjectSaved)},render:function render(){var projectSelectionView=this.projectSelectionView,hasProject=!!this.model.id;projectSelectionView.render();this.$el.html(projectSwitcherTemplate({canEdit:permissions.check("edit.projects")})).customtip({position:"bottom"}).find(".projectSelector").toggleClass("vhidden",!hasProject).append(projectSelectionView.$el).toggleClass("hasextrabuttons",permissions.check("edit.projects"))},remove:function remove(){if(this.projectSelectionView){this.projectSelectionView.remove()}Backbone.View.prototype.remove.call(this)},onProjectSaved:function onProjectSaved(){if(this.collection.get(this.model.id)){this.collection.add(this.model,{merge:true})}},onChangeProject:function onChangeProject(){var projectId=this.model.id;if(projectId){this.$(".projectSelector").removeClass("vhidden")}this.projectSelectionView.selectProject(projectId);if(!this.model.get("timezone")){TimezoneSelectionView.show(this.model)}},onClickEditProject:function onClickEditProject(){ProjectModalFormView.show({model:this.model})},onClickEditMembers:function onClickEditMembers(){ProjectAccessPermissionView.show({project:this.model,preventUnshareSelf:false})},onOpenSwitcher:function onOpenSwitcher(){this.$el.addClass("projectSwitcher-active")},onCloseSwitcher:function onCloseSwitcher(){this.$el.removeClass("projectSwitcher-active")},onSelectProject:function onSelectProject(eventData){projectEvents.trigger(PROJECT_EVENT_NAMES.PROJECT_CHANGE,eventData);return Q.promise(function(resolve,reject){require(["app"],resolve,reject)}).then(function(app){app.navigate("/project/"+eventData.newProjectId,{trigger:true})})}})});define("mustache!templates/header",["lib/mustache"],function(mustache){var escapedTemplate='<div class="clearfix">\n<span class="dib doublepadding-left smallpadding-right adminTitle absleft hidden">{{productName}} Administration\n<a class="closeLink customtip icon-remove smallpadding-left" title="Close Admininstration"></a>\n</span>\n<nav class="projectMenu tencolmax hidden">\n<div class="projectLabel floatleft hugeline">Project</div>\n<div class="projectSwitcherContainer"></div>\n<div class="projectTimezone normalfont smalltext hugeline smallpadding-left">\n{{projectTimezone}}\n</div>\n</nav>\n<nav class="navigation"/>\n<div class="temporary-notifications"></div>\n<div class="permanent-notifications"></div>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!css/navigationColors.css",["css!css/compiled.css"],function(){});define("css!css/headerView.css",["css!css/compiled.css"],function(){});define("src/views/HeaderView",["backbone","underscore","jquery","bw-fe-helpers/timezoneDateHelper","src/globals/theme","src/events/projectEvents","src/events/globalEventNames","src/models/ProjectSummaryCollection","src/views/navigation/UserMenuView","src/views/ProjectSwitcherView","mustache!templates/header","src/packages/modalDialogs","src/packages/customtip","css!css/navigationColors.css","css!css/headerView.css","lib/jquery.showNotification"],function(Backbone,_,$,timezoneDateHelper,theme,projectEvents,globalEventNames,ProjectSummaryCollection,UserMenuView,ProjectSwitcherView,headerTemplate){"use strict";var PROJECT_EVENT_NAMES=globalEventNames.PROJECTS;return Backbone.View.extend({_appendProjectSwitcher:function _appendProjectSwitcher(projectSwitcherContainer){var projectSwitcherView=this.projectSwitcherView;projectSwitcherView.render();projectSwitcherContainer.append(projectSwitcherView.el)},events:{"click .closeLink":"onClickCloseLink"},initialize:function initialize(options){if(!options||!options.project){throw new Error("options.project must be set!")}if(!options.notifications){throw new Error("options.notifications must be set!")}this.project=options.project;this.userMenuView=new UserMenuView({notifications:options.notifications});this.initializeProjectSwitcher(options);this.listenTo(projectEvents,PROJECT_EVENT_NAMES.NOTIFICATION_SHOWN,this.enqueueNotification);this.listenTo(this.project,"change",this.updateDisplayedTimezone)},initializeProjectSwitcher:function initializeProjectSwitcher(options){this.projectSwitcherView=new ProjectSwitcherView({collection:options.projects||new ProjectSummaryCollection(undefined,{pagination:false}),model:options.project})},notifications:[],enqueueNotification:function enqueueNotification(options){this.notifications.push(options);if(!this.processingNotificationsQueue){this.processNotificationsQueue()}},processNotificationsQueue:function processNotificationsQueue(){var notification,notificationArea=this.$(".temporary-notifications");this.processingNotificationsQueue=true;if(this.notifications.length===0){this.processingNotificationsQueue=false;return}notification=this.notifications.shift();notification=_(notification).extend({duration:8e3,onRemoved:_.bind(this.processNotificationsQueue,this)});notificationArea.showNotification(notification)},remove:function remove(){this.userMenuView.remove();this.projectSwitcherView.remove();delete this.userMenuView;Backbone.View.prototype.remove.call(this)},updateDisplayedTimezone:function updateDisplayedTimezone(project){var projectTimezone=timezoneDateHelper.getTimezoneNameWithOffset(project.getTimezone());this.$(".projectTimezone").text(projectTimezone)},render:function render(){var initialTimezone=this.project.id?timezoneDateHelper.getTimezoneNameWithOffset(this.project.getTimezone()):"",data={productName:theme.productName,projectTimezone:initialTimezone},$html=$(headerTemplate(data)),nav=$html.find(".navigation"),projectSwitcherContainer=$html.find(".projectSwitcherContainer"),userMenuView;userMenuView=this.userMenuView;userMenuView.render();nav.append(userMenuView.el);this._appendProjectSwitcher(projectSwitcherContainer);this.$el.html($html);this.$(".closeLink").customtip({position:"bottom"})},hideProjectSwitcher:function hideProjectSwitcher(){this.$(".projectMenu").addClass("hidden")},showProjectSwitcher:function showProjectSwitcher(){this.$(".projectMenu").removeClass("hidden")},showAppMode:function showAppMode(){this.$(".adminTitle").addClass("hidden");if(this.userMenuView){this.userMenuView.showAppMode()}},showAdminMode:function showAdminMode(){this.$(".adminTitle").removeClass("hidden");if(this.userMenuView){this.userMenuView.showAdminMode()}},onClickCloseLink:function onClickCloseLink(){window.close()}})});define("mustache!templates/footer",["lib/mustache"],function(mustache){var escapedTemplate='<div class="inner-container">\n{{^logoUrl}}\n<div class="logo"></div>\n{{/logoUrl}}\n{{#logoUrl}}\n<a class="logo db {{#logoTitle}}customtip{{/logoTitle}}" href="{{logoUrl}}" target=\'_blank\' {{#logoTitle}}title="{{logoTitle}}"{{/logoTitle}}></a>\n{{/logoUrl}}\n{{#linkLists}}\n<ul class="{{className}} {{^className}}links{{/className}} pagemargin-top pagemargin-right">\n{{#items}}\n<li class="singlemargin-bottom">\n{{#isTitle}}\n<span class="title">{{name}}</span>\n{{/isTitle}}\n{{^isTitle}}\n<a href="{{link}}" target="{{^target}}_blank{{/target}}{{target}}" class="{{iconClass}} {{#title}}customtip{{/title}}" {{#title}}title="{{title}}"{{/title}}>{{name}}</a>\n{{/isTitle}}\n</li>\n{{/items}}\n</ul>\n{{/linkLists}}\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!css/footer.css",["css!css/compiled.css"],function(){});define("src/views/FooterView",["backbone","src/globals/theme","mustache!templates/footer","src/packages/customtip","css!css/footer.css"],function(Backbone,theme,footerTemplate){"use strict";return Backbone.View.extend({constructor:function FooterView(){var _this=this;var app=require("app");if(theme.isBrandwatchOrGreyLabelTheme()){this.listenTo(app,"route",function(){if(Backbone.history.getFragment().includes("homepage")){_this.$el.addClass("homepage")}else{_this.$el.removeClass("homepage")}})}Backbone.View.apply(this,arguments)},render:function render(){var data=this.getFooterData(),html=footerTemplate(data);this.$el.html(html).customtip()},getFooterData:function getFooterData(){return{linkLists:theme.footerLinks||[],productName:theme.productName,logoUrl:theme.logoUrl,logoTitle:theme.logoTitle}}})});define("src/models/Notification",["backbone"],function(Backbone){"use strict";return Backbone.Model.extend({url:function url(){return"/user/notifications/"+(this.id||"")},markRead:function markRead(){var self=this;if(this.isNew()){throw new Error("Cannot call markRead on an unsaved model")}if(!this.get("read")){this.save({read:true},{patch:true,error:function error(){self.set("read",false)}})}}})});define("src/models/NotificationCollection",["backbone","src/models/Notification","bw-fe-helpers/dateHelper"],function(Backbone,Notification,dateHelper){"use strict";return Backbone.Collection.extend({model:Notification,url:"/user/notifications/",comparator:function comparator(notification){var date=dateHelper.parse(notification.get("creationDate")||new Date);return-(date?date.getTime():0)},getUnreadCount:function getUnreadCount(){return this.filter(function(notification){return!notification.get("read")&&!notification.get("suspended")}).length},parse:function parse(data){return data.results}})});define("src/views/navigation/navigationHelper",["src/permissions","src/globals/flags","src/globals/flagNames"],function(permissions,flags,FLAGS){"use strict";var DASHBOARDS_COLOUR_ID=1;var DATA_COLOUR_ID=2;var TOOLS_COLOUR_ID=3;var ALERTS_COLOUR_ID=4;var SHARABLE_REPORTS_COLOUR_ID=6;var HOMEPAGE_COLOUR_ID=7;function getSidebarColours(){return{DASHBOARDS_COLOUR_ID:DASHBOARDS_COLOUR_ID,DATA_COLOUR_ID:DATA_COLOUR_ID,TOOLS_COLOUR_ID:TOOLS_COLOUR_ID,ALERTS_COLOUR_ID:ALERTS_COLOUR_ID,SHARABLE_REPORTS_COLOUR_ID:SHARABLE_REPORTS_COLOUR_ID,HOMEPAGE_COLOUR_ID:HOMEPAGE_COLOUR_ID}}function getDataSubmenuItems(){if(!permissions.check("see.queries")){return[]}return[{name:"Queries",routeId:"data/queries",colourId:DATA_COLOUR_ID},{name:"Channels",routeId:"data/channels",colourId:DATA_COLOUR_ID},{name:"Logo Queries",routeId:"data/logoqueries",colourId:DATA_COLOUR_ID},{name:"Groups",routeId:"data/groups",colourId:DATA_COLOUR_ID}]}function getToolsSubmenuItems(){if(!permissions.check("see.tools")){return[]}return[{name:"Categories",routeId:"tools/categories",colourId:TOOLS_COLOUR_ID},{name:"Tags",routeId:"tools/tags",colourId:TOOLS_COLOUR_ID},{name:"Rules",routeId:"tools/rules",colourId:TOOLS_COLOUR_ID},{name:"Site Lists",routeId:"tools/sitelists",colourId:TOOLS_COLOUR_ID},{name:"Location Lists",routeId:"tools/locationlists",colourId:TOOLS_COLOUR_ID},{name:"Author Lists",routeId:"tools/authorlists",colourId:TOOLS_COLOUR_ID},{name:"Downloads",routeId:"tools/downloads",colourId:TOOLS_COLOUR_ID},{name:"Mention Finder",routeId:"tools/mentionfinder",colourId:TOOLS_COLOUR_ID}]}function getAlertsSubmenuItems(){var submenuItems=[];if(permissions.check("see.signals")){submenuItems.push({name:"Signals",routeId:"alerts/signals",colourId:ALERTS_COLOUR_ID,dataAt:"signals"})}submenuItems.push({name:"Custom Alerts",routeId:"alerts/custom",colourId:ALERTS_COLOUR_ID,dataAt:"custom"});return submenuItems}function getSubmenuItems(){return{data:getDataSubmenuItems(),tools:getToolsSubmenuItems(),alerts:getAlertsSubmenuItems()}}function getSidebarItems(){var items=[];if(flags.variation(FLAGS.ENABLE_HOMEPAGE)){items.push({routeId:"homepage",name:"Home",icon:"home",colourId:HOMEPAGE_COLOUR_ID,colour:"#8f63a6",dataAt:"homepage"})}items.push({routeId:"dashboards",name:"Dashboards",icon:"bwchart",colourId:DASHBOARDS_COLOUR_ID,colour:"#1691cf",dataAt:"dashboards"});if(permissions.check("see.queries")){items.push({routeId:"data",name:"Data",icon:"bwdata",colourId:DATA_COLOUR_ID,colour:"#73b33e",dataAt:"data"})}if(permissions.check("see.tools")){items.push({routeId:"tools",name:"Tools",icon:"bwtoolbox",colourId:TOOLS_COLOUR_ID,colour:"#ed7c2B",dataAt:"tools"},{routeId:"alerts",name:"Alerts",icon:"bwalert",colourId:ALERTS_COLOUR_ID,colour:"#d64b6b",dataAt:"alerts"})}return items}return{getSidebarColours:getSidebarColours,getSubmenuItems:getSubmenuItems,getSidebarItems:getSidebarItems}});define("css!src/views/navigation/navigation.css",["css!src/views/navigation/compiled.css"],function(){});function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};var ownKeys=Object.keys(source);if(typeof Object.getOwnPropertySymbols==="function"){ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))}ownKeys.forEach(function(key){_defineProperty(target,key,source[key])})}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}define("src/views/navigation/NavigationView",["backbone","src/storageProvider","src/ReactAppLoader","src/globals/currentProject","src/globals/theme","src/views/navigation/navigationHelper","src/views/navigation/localStorageKeys","bw-fe-helpers/windowHelper","css!src/views/navigation/navigation.css"],function(Backbone,storageProvider,ReactAppLoader,currentProject,theme,navigationHelper,localStorageKeys,windowHelper){"use strict";var NAV_STATE_KEY=localStorageKeys.NAVIGATION_COLLAPSED;var LIMIT=1060;var ICONMAP={"bar-chart":"reports",bwchart:"bar-chart",bwdata:"data",bwtoolbox:"tools",bwalert:"analytics-alert"};var ROUTEMAP={dashboard:"dashboards",signals:"alerts"};function toggleNavigation(view,isCollapsed,byUser){view.$el.toggleClass("sidebar--collapsed",isCollapsed);view.trigger("toggleNavigation");if(!byUser){return}storageProvider.set(NAV_STATE_KEY,isCollapsed)}function mapRoute(routeId){return ROUTEMAP[routeId]||routeId}function getItemConfig(){var sidebarItems=navigationHelper.getSidebarItems();return sidebarItems.map(function(item){return _objectSpread({},item,{icon:ICONMAP[item.icon]||item.icon,dataAt:item.dataAt})})}function getSubitemConfig(){return navigationHelper.getSubmenuItems()}var NavigationView=Backbone.View.extend({constructor:function NavigationView(){Backbone.View.apply(this,arguments);this.navigationApp=new ReactAppLoader("navigation");this.messageBus=_objectSpread({},Backbone.Events);this.listenTo(this.messageBus,"collapsed",toggleNavigation.bind(null,this));this.listenToOnce(this.messageBus,"loaded",this.setActiveMenuItem)},render:function render(){var browserSize=windowHelper.getWindow().document.documentElement.clientWidth;var isCollapsed=storageProvider.get(NAV_STATE_KEY)||false;toggleNavigation(this,browserSize<=LIMIT||isCollapsed);this.navigationApp.render({collapsedByUser:isCollapsed,items:getItemConfig(),subitems:getSubitemConfig(),limit:LIMIT,messageBus:this.messageBus,projectId:currentProject.id,themeColor:theme.color});this.$el.html(this.navigationApp.$el)},setActiveMenuItem:function setActiveMenuItem(routeId){this.activeRouteId=mapRoute(routeId)||this.activeRouteId;this.messageBus.trigger("route-changed",this.activeRouteId)}});return NavigationView});(function($){"use strict";var oldOffset=$.fn.offset;$.fn.offset=function(){var elem=this[0];var origin={top:0,left:0};if(!elem||!elem.nodeType){return origin}var docElem=(elem.ownerDocument||document).documentElement;if(!$.contains(docElem,elem)){return origin}return oldOffset.apply(this,arguments)};function isScrollPositionChanged($scrollTarget){if(!$scrollTarget){return true}var prevScrollPosition=$scrollTarget.data("scrollPosition");if($scrollTarget.scrollLeft()===prevScrollPosition.left&&$scrollTarget.scrollTop()===prevScrollPosition.top){return false}return true}function repositionCallback($el){return function(){$el.reposition()}}function removeCallback($el,onRemove){return function(){if(isScrollPositionChanged($el.data("scrollTarget"))){$el.removeRelativeTo();onRemove()}}}function findNearestScrollingParent($el){var $scroller=$(window);$el.parents().each(function(i,el){var $el=$(el);if(["auto","scroll"].indexOf($el.css("overflow-y"))>-1&&el.scrollHeight>el.clientHeight){$scroller=$el;return false}});return $scroller}function elementFitsBelowTarget(cssTop,elementHeight,windowHeight){var elementBottomPosition=cssTop+elementHeight;return elementBottomPosition<windowHeight}function elementFitsAboveTarget(cssTop,elementHeight,targetOuterHeight){var elementTopPosition=cssTop-elementHeight-targetOuterHeight;var topOfScreen=0;return elementTopPosition>=topOfScreen}$.fn.showRelativeTo=function(options){options=options||{};var $this=$(this);var $target=typeof options==="string"?$(options):$(options.target);var $container=$(options.container||"body");var $scrollTarget=findNearestScrollingParent($target);var onRemove=options.onRemove||function(){};var removeOnScroll=options.removeOnScroll!==false;var position=$.isFunction(options.position)?options.position():options.position||"below-left";var containerOffset=$container.offset();var targetOffset=$.isFunction(options.targetOffset)?options.targetOffset():$target.offset();var css;var outerHeight;var targetOuterHeight=$target.outerHeight();var outerWidth;var targetOuterWidth=$target.outerWidth();var windowHeight=$(window).height();var windowWidth=$(window).width();var leftCalc;var topCalc=targetOffset.top+targetOuterHeight;var cssTopCalc;if(!$target||!$target.length){throw new Error("options.target must be set")}targetOffset.left-=containerOffset.left;$this.on("mousedown.showRelativeTo",function onMouseDown(e){e.stopPropagation()}).css({position:"absolute","z-index":options.zIndex||"10010"}).appendTo($container).show();outerHeight=$this.outerHeight();outerWidth=$this.outerWidth();leftCalc=targetOffset.left-outerWidth/2+targetOuterWidth/2;cssTopCalc=windowHeight-outerHeight-10;switch(position){case"above-center":css={left:leftCalc,top:targetOffset.top-outerHeight-targetOuterHeight};$this.removeClass("flipped");if(css.top<0){css.top=topCalc;$this.addClass("flipped")}if(css.top+outerHeight>windowHeight){css.top=cssTopCalc}break;case"below-center":css={left:leftCalc,top:topCalc};$this.removeClass("flipped");if(css.top<0){css.top=topCalc;$this.addClass("flipped")}if(css.top+outerHeight>windowHeight){css.top=cssTopCalc}break;case"below-left":css={top:topCalc,left:Math.min(targetOffset.left,$(window).width()-outerWidth)};$this.removeClass("flipped");if(css.top+outerHeight>windowHeight){if(css.top-outerHeight-targetOuterHeight>=0){css.top=css.top-outerHeight-targetOuterHeight;$this.addClass("flipped")}}break;case"below-left-fit":css={top:topCalc,left:Math.min(targetOffset.left,$(window).width()-outerWidth)};if(!elementFitsBelowTarget(css.top,outerHeight,windowHeight)){if(elementFitsAboveTarget(css.top,outerHeight,targetOuterHeight)){css.top=css.top-outerHeight-targetOuterHeight}else{css.top=cssTopCalc}}break;case"below-right":css={top:topCalc,left:Math.max(0,targetOffset.left+targetOuterWidth-outerWidth)};break;case"below-right-fit":css={top:topCalc,left:Math.max(0,targetOffset.left+targetOuterWidth-outerWidth)};if(!elementFitsBelowTarget(css.top,outerHeight,windowHeight)){if(elementFitsAboveTarget(css.top,outerHeight,targetOuterHeight)){css.top=css.top-outerHeight-targetOuterHeight}else{css.top=cssTopCalc}}break;default:css=position;break}if(css.left+outerWidth>windowWidth-24){css.left=windowWidth-outerWidth-24}$this.css(css);$this.data("showRelativeToOptions",options);$this.data("scrollTarget",$scrollTarget);$this.data("repositionCallback",$this.data("repositionCallback")||repositionCallback($this));$this.data("removeCallback",$this.data("removeCallback")||removeCallback($this,onRemove));$scrollTarget.data("scrollPosition",{left:$scrollTarget.scrollLeft(),top:$scrollTarget.scrollTop()});$(window).off("resize",$this.data("repositionCallback")).on("resize",$this.data("repositionCallback"));$scrollTarget.off("scroll",$this.data("removeCallback"));if(removeOnScroll){$scrollTarget.on("scroll",$this.data("removeCallback"))}return this};$.fn.getRelativeToTarget=function(){return($(this).data("showRelativeToOptions")||{}).target};$.fn.reposition=function(){var $this=$(this);if($this.data("showRelativeToOptions")){$this.showRelativeTo($this.data("showRelativeToOptions"))}return $this};$.fn.removeRelativeTo=function(){var $this=$(this);if($this.data("repositionCallback")){$(window).off("resize",$this.data("repositionCallback"))}if($this.data("removeCallback")){$this.data("scrollTarget").off("scroll",$this.data("removeCallback"))}$this.off("mousedown.showRelativeTo").removeData("showRelativeToOptions").removeData("repositionCallback").hide();return this}})($);define("jquery.showRelativeTo",function(){});define("css!css/help.css",["css!css/compiled.css"],function(){});define("src/views/HelpView",["backbone","jquery","src/globals/theme","jquery.showRelativeTo","css!css/help.css"],function(Backbone,$,theme){"use strict";var HELP_PATHS={};function getHelpPathUrl(keys){if(!HELP_PATHS[keys[0]]){throw new Error("Could not find prefix "+keys[0]+", call HelpView.addPrefix.")}return HELP_PATHS[keys[0]]+keys[1]+".html"}var HelpView=Backbone.View.extend({className:"modular helppopup helptextcolor infoboxbgcolor mediumtext-bigline doublepadding breakword",events:{click:function onClickStopPropagation(e){e.stopPropagation()},"click .icon-remove":function onClickRemove(){this.remove()}},constructor:function HelpView(options){Backbone.View.apply(this,arguments);options=options||{};var key=this.key=options.key,cssClass=options.cssClass||"fivecol";if(!key){throw new Error("HelpView should be initialized with options.key")}this.$el.addClass(cssClass)},render:function render(onHTMLReceived){var url=this.getHelpUrl(),$el=$(this.el);onHTMLReceived=onHTMLReceived||function(){};if(this._ajax){this._ajax.abort()}this._ajax=$.get(url,function(html){var content='<a class="icon-remove iconsmaller floatright doublemargin-left singlemargin-bottom lightgrey"></a>'+html.replace(/\$product/g,theme.productName);$el.append(content);onHTMLReceived()})},remove:function remove(){this.key="";this.$el.removeRelativeTo();$("body").off("click.HelpView");if(this._ajax){this._ajax.abort();this._ajax=null}Backbone.View.prototype.remove.call(this)},getHelpUrl:function getHelpUrl(){var keys=this.key.split(":");if(keys.length>1){return getHelpPathUrl(keys)}return"/help/"+this.key+".html"}},{show:function show(options){var $target=options.$target,helpView=new HelpView({key:options.key,cssClass:options.cssClass});helpView.render(function(){helpView.$el.showRelativeTo({target:$target,position:"below-left-fit"})});$("body").on("click.HelpView",function(){helpView.remove()});return helpView},addPrefix:function addPrefix(key,path){HELP_PATHS[key]=path}});return HelpView});define("src/events/componentEvents",["underscore","backbone"],function(_,Backbone){"use strict";return _.clone(Backbone.Events)});(function($){var guiders=this.guiders={};guiders.version="1.2.8";guiders._defaultSettings={attachTo:null,autoFocus:false,buttons:[{name:"Close"}],buttonCustomHTML:"",classString:null,closeOnEscape:false,description:"Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",highlight:null,isHashable:true,offset:{top:null,left:null},onClose:null,onHide:null,onShow:null,overlay:false,position:0,title:"Sample title goes here",width:400,xButton:false};guiders._htmlSkeleton=["<div class='guider'>","  <div class='guider_content'>","    <h1 class='guider_title'></h1>","    <div class='guider_close'></div>","    <p class='guider_description'></p>","    <div class='guider_buttons'>","    </div>","  </div>","  <div class='guider_arrow'>","  </div>","</div>"].join("");guiders._arrowSize=42;guiders._backButtonTitle="Back";guiders._buttonElement="<a></a>";guiders._buttonAttributes={href:"javascript:void(0);"};guiders._closeButtonTitle="Close";guiders._currentGuiderID=null;guiders._guiders={};guiders._lastCreatedGuiderID=null;guiders._nextButtonTitle="Next";guiders._offsetNameMapping={topLeft:11,top:12,topRight:1,rightTop:2,right:3,rightBottom:4,bottomRight:5,bottom:6,bottomLeft:7,leftBottom:8,left:9,leftTop:10};guiders._windowHeight=0;guiders._addButtons=function(myGuider){var guiderButtonsContainer=myGuider.elem.find(".guider_buttons");if(myGuider.buttons===null||myGuider.buttons.length===0){guiderButtonsContainer.remove();return}for(var i=myGuider.buttons.length-1;i>=0;i--){var thisButton=myGuider.buttons[i];var thisButtonElem=$(guiders._buttonElement,$.extend({class:"guider_button",html:thisButton.name},guiders._buttonAttributes,thisButton.html||{}));if(typeof thisButton.classString!=="undefined"&&thisButton.classString!==null){thisButtonElem.addClass(thisButton.classString)}guiderButtonsContainer.append(thisButtonElem);var thisButtonName=thisButton.name.toLowerCase();if(thisButton.onclick){thisButtonElem.on("click",thisButton.onclick)}else{switch(thisButtonName){case guiders._closeButtonTitle.toLowerCase():thisButtonElem.on("click",function(){guiders.hideAll();if(myGuider.onClose){myGuider.onClose(myGuider,false)}});break;case guiders._nextButtonTitle.toLowerCase():thisButtonElem.on("click",function(){!myGuider.elem.data("locked")&&guiders.next()});break;case guiders._backButtonTitle.toLowerCase():thisButtonElem.on("click",function(){!myGuider.elem.data("locked")&&guiders.prev()});break}}}if(myGuider.buttonCustomHTML!==""){var myCustomHTML=$(myGuider.buttonCustomHTML);myGuider.elem.find(".guider_buttons").append(myCustomHTML)}if(myGuider.buttons.length===0){guiderButtonsContainer.remove()}};guiders._addXButton=function(myGuider){var xButtonContainer=myGuider.elem.find(".guider_close");var xButton=$("<div></div>",{class:"x_button",role:"button"});xButtonContainer.append(xButton);xButton.click(function(){guiders.hideAll();if(myGuider.onClose){myGuider.onClose(myGuider,true)}})};guiders._wireEscape=function(myGuider){$(document).keydown(function(event){if(event.keyCode==27||event.which==27){guiders.hideAll();if(myGuider.onClose){myGuider.onClose(myGuider,true)}return false}})};guiders._unWireEscape=function(myGuider){$(document).off("keydown")};guiders._attach=function(myGuider){var containerOffset;if(typeof myGuider!=="object"){return}var attachTo=$(myGuider.attachTo);var myHeight=myGuider.elem.innerHeight();var myWidth=myGuider.elem.innerWidth();if(myGuider.position===0||attachTo.length===0){myGuider.elem.css("position","fixed");myGuider.elem.css("top",($(window).height()-myHeight)/3+"px");myGuider.elem.css("left",($(window).width()-myWidth)/2+"px");return}var base=attachTo.offset();var top=base.top;var left=base.left;var topMarginOfBody=$("body").outerHeight(true)-$("body").outerHeight(false);top-=topMarginOfBody;if(guiders._offsetNameMapping[myGuider.position]){myGuider.position=guiders._offsetNameMapping[myGuider.position]}var attachToHeight=attachTo.innerHeight();var attachToWidth=attachTo.innerWidth();var bufferOffset=.9*guiders._arrowSize;var offsetMap={1:[-bufferOffset-myHeight,attachToWidth-myWidth],2:[0,bufferOffset+attachToWidth],3:[attachToHeight/2-myHeight/2,bufferOffset+attachToWidth],4:[attachToHeight-myHeight,bufferOffset+attachToWidth],5:[bufferOffset+attachToHeight,attachToWidth-myWidth],6:[bufferOffset+attachToHeight,attachToWidth/2-myWidth/2],7:[bufferOffset+attachToHeight,0],8:[attachToHeight-myHeight,-myWidth-bufferOffset],9:[attachToHeight/2-myHeight/2,-myWidth-bufferOffset],10:[0,-myWidth-bufferOffset],11:[-bufferOffset-myHeight,0],12:[-bufferOffset-myHeight,attachToWidth/2-myWidth/2]};var offset=offsetMap[myGuider.position];top+=offset[0];left+=offset[1];var positionType="absolute";if(attachTo.css("position")=="fixed"){positionType="fixed";top-=$(window).scrollTop();left-=$(window).scrollLeft()}if(myGuider.offset.top!==null){top+=myGuider.offset.top}if(myGuider.offset.left!==null){left+=myGuider.offset.left}if(myGuider.containerSelector){containerOffset=$(myGuider.containerSelector).offset();top-=containerOffset.top;left-=containerOffset.left}return myGuider.elem.css({position:positionType,top:top,left:left})};guiders._guiderById=function(id){if(typeof guiders._guiders[id]==="undefined"){throw"Cannot find guider with id "+id}return guiders._guiders[id]};guiders._showOverlay=function(){$("#guider_overlay").fadeIn("fast",function(){if(this.style.removeAttribute){this.style.removeAttribute("filter")}})};guiders._highlightElement=function(selector){$(selector).addClass("guider_highlight")};guiders._dehighlightElement=function(selector){$(selector).removeClass("guider_highlight")};guiders._hideOverlay=function(){$("#guider_overlay").fadeOut("fast")};guiders._initializeOverlay=function(){if($("#guider_overlay").length===0){$('<div id="guider_overlay"></div>').hide().appendTo("body")}};guiders._styleArrow=function(myGuider){var position=myGuider.position||0;if(!position){return}var myGuiderArrow=$(myGuider.elem.find(".guider_arrow"));var newClass={1:"guider_arrow_down",2:"guider_arrow_left",3:"guider_arrow_left",4:"guider_arrow_left",5:"guider_arrow_up",6:"guider_arrow_up",7:"guider_arrow_up",8:"guider_arrow_right",9:"guider_arrow_right",10:"guider_arrow_right",11:"guider_arrow_down",12:"guider_arrow_down"};myGuiderArrow.addClass(newClass[position]);var myHeight=myGuider.elem.innerHeight();var myWidth=myGuider.elem.innerWidth();var arrowOffset=guiders._arrowSize/2;var positionMap={1:["right",arrowOffset],2:["top",arrowOffset],3:["top",myHeight/2-arrowOffset],4:["bottom",arrowOffset],5:["right",arrowOffset],6:["left",myWidth/2-arrowOffset],7:["left",arrowOffset],8:["bottom",arrowOffset],9:["top",myHeight/2-arrowOffset],10:["top",arrowOffset],11:["left",arrowOffset],12:["left",myWidth/2-arrowOffset]};var position=positionMap[myGuider.position];myGuiderArrow.css(position[0],position[1]+"px")};guiders._showIfHashed=function(myGuider){var GUIDER_HASH_TAG="guider=";var hashIndex=window.location.hash.indexOf(GUIDER_HASH_TAG);if(hashIndex!==-1){var hashGuiderId=window.location.hash.substr(hashIndex+GUIDER_HASH_TAG.length);if(myGuider.id.toLowerCase()===hashGuiderId.toLowerCase()){guiders.show(myGuider.id)}}};guiders._completeShow=function(myGuider,id){guiders._attach(myGuider);guiders._styleArrow(myGuider);myGuider.elem.fadeIn("fast").data("locked",false);guiders._currentGuiderID=id;var windowHeight=guiders._windowHeight=$(window).height();var scrollHeight=$(window).scrollTop();var guiderOffset=myGuider.elem.offset();var guiderElemHeight=myGuider.elem.height();var isGuiderBelow=scrollHeight+windowHeight<guiderOffset.top+guiderElemHeight;var isGuiderAbove=guiderOffset.top<scrollHeight;if(myGuider.autoFocus&&(isGuiderBelow||isGuiderAbove)){setTimeout(guiders.scrollToCurrent,10)}$(myGuider.elem).trigger("guiders.show");return guiders};guiders.reposition=function(){var currentGuider=guiders._guiders[guiders._currentGuiderID];guiders._attach(currentGuider)};guiders.next=function(){var currentGuider=guiders._guiders[guiders._currentGuiderID];if(typeof currentGuider==="undefined"){return}currentGuider.elem.data("locked",true);var nextGuiderId=currentGuider.next||null;if(nextGuiderId!==null&&nextGuiderId!==""){var myGuider=guiders._guiderById(nextGuiderId);var omitHidingOverlay=myGuider.overlay?true:false;guiders.hideAll(omitHidingOverlay,true);if(currentGuider&&currentGuider.highlight){guiders._dehighlightElement(currentGuider.highlight)}guiders.show(nextGuiderId)}};guiders.prev=function(){var currentGuider=guiders._guiders[guiders._currentGuiderID];if(typeof currentGuider==="undefined"){return}if(currentGuider.prev===null){return}var prevGuider=guiders._guiders[currentGuider.prev];prevGuider.elem.data("locked",true);var prevGuiderId=prevGuider.id||null;if(prevGuiderId!==null&&prevGuiderId!==""){var myGuider=guiders._guiderById(prevGuiderId);var omitHidingOverlay=myGuider.overlay?true:false;guiders.hideAll(omitHidingOverlay,true);if(prevGuider&&prevGuider.highlight){guiders._dehighlightElement(prevGuider.highlight)}guiders.show(prevGuiderId)}};guiders.createGuider=function(passedSettings){if(passedSettings===null||passedSettings===undefined){passedSettings={}}myGuider=$.extend({},guiders._defaultSettings,passedSettings);myGuider.id=myGuider.id||String(Math.floor(Math.random()*1e3));var guiderElement=$(guiders._htmlSkeleton);myGuider.elem=guiderElement;if(typeof myGuider.classString!=="undefined"&&myGuider.classString!==null){myGuider.elem.addClass(myGuider.classString)}myGuider.elem.css("width",myGuider.width+"px");var guiderTitleContainer=guiderElement.find(".guider_title");guiderTitleContainer.html(myGuider.title);guiderElement.find(".guider_description").html(myGuider.description);guiders._addButtons(myGuider);if(myGuider.xButton){guiders._addXButton(myGuider)}guiderElement.hide();guiderElement.appendTo(passedSettings.containerSelector||"body");guiderElement.attr("id",myGuider.id);if(typeof myGuider.attachTo!=="undefined"&&myGuider!==null){guiders._attach(myGuider)&&guiders._styleArrow(myGuider)}guiders._initializeOverlay();guiders._guiders[myGuider.id]=myGuider;if(guiders._lastCreatedGuiderID!=null){myGuider.prev=guiders._lastCreatedGuiderID}guiders._lastCreatedGuiderID=myGuider.id;if(myGuider.isHashable){guiders._showIfHashed(myGuider)}return guiders};guiders.hideAll=function(omitHidingOverlay,next){next=next||false;$(".guider:visible").each(function(index,elem){var myGuider=guiders._guiderById($(elem).attr("id"));if(myGuider.onHide){myGuider.onHide(myGuider,next)}});$(".guider").fadeOut("fast");var currentGuider=guiders._guiders[guiders._currentGuiderID];if(currentGuider&&currentGuider.highlight){guiders._dehighlightElement(currentGuider.highlight)}if(typeof omitHidingOverlay!=="undefined"&&omitHidingOverlay===true){}else{guiders._hideOverlay()}return guiders};guiders.show=function(id){var self=this;if(!id&&guiders._lastCreatedGuiderID){id=guiders._lastCreatedGuiderID}var myGuider=guiders._guiderById(id);if(myGuider.overlay){guiders._showOverlay();if(myGuider.highlight){guiders._highlightElement(myGuider.highlight)}}if(myGuider.closeOnEscape){guiders._wireEscape(myGuider)}else{guiders._unWireEscape(myGuider)}if(myGuider.onShow){myGuider.onShow(myGuider,function(){return self._completeShow(myGuider,id)})}else{return this._completeShow(myGuider,id)}};guiders.scrollToCurrent=function(){var currentGuider=guiders._guiders[guiders._currentGuiderID];if(typeof currentGuider==="undefined"){return}var windowHeight=guiders._windowHeight;var scrollHeight=$(window).scrollTop();var guiderOffset=currentGuider.elem.offset();var guiderElemHeight=currentGuider.elem.height();var scrollToHeight=Math.round(Math.max(guiderOffset.top+guiderElemHeight/2-windowHeight/2,0));window.scrollTo(0,scrollToHeight)};var _resizing=undefined;$(window).resize(function(){if(typeof _resizing!=="undefined"){clearTimeout(_resizing)}_resizing=setTimeout(function(){_resizing=undefined;if(typeof guiders!=="undefined"){guiders.reposition()}},20)});return guiders}).call(this,jQuery);define("guiders",function(global){return function(){var ret,fn;return ret||global.guiders}}(this));define("css!guiders-source/guiders.css",["css!guiders-source/compiled.css"],function(){});define("css!css/guiders-brandwatch.css",["css!css/compiled.css"],function(){});define("src/packages/guiders",["jquery","underscore","guiders","css!guiders-source/guiders.css","css!css/guiders-brandwatch.css"],function($,_){"use strict";var guiders=window.guiders;guiders._buttonAttributes["class"]="button";guiders._buttonElement="<button></button>";_.extend(guiders._defaultSettings,{overlay:false,xButton:true,width:500});$("#wrapper").on("scroll",_.throttle(guiders.reposition,100));return guiders});define("mustache!templates/pagetours/canEditInsideDashboard",["lib/mustache"],function(mustache){var escapedTemplate='<div class="relative">\n<div class="threecol">\n<div>You can <b>add</b> and <b>edit</b></div>\n<ul class="smallmargin-vertical">\n<li>Queries &amp; Channels</li>\n<li>Site Lists &amp; Author Lists</li>\n</ul>\n<div>from <b>within</b> a Dashboard too.</div>\n<div class="twocols floatleft singlemargin-top">Look out for\n<i class="tinymargin-left iconsmaller icon-plus"></i> <b>New ...</b> links<br>\nand the <i class="iconsmaller icon-pencil"></i> edit icon in the Filters.\n</div>\n</div>\n<div class="edit-inside-dashboard-image abstop absright"></div>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!templates/pagetours/demographics/dashboardStart",["lib/mustache"],function(mustache){var escapedTemplate='The Demographics Dashboard allows you to easily explore the wealth of data we provide about the people behind your social buzz.\n<a title="More indepth information about Demographics Dashboards in a new tab"\ntarget="_blank" href="//support.brandwatch.com/entries/39302096-Demographics-Dashboard-Components">Learn more...</a><br><br>\nUnlike our standard default Dashboard, in this the numbers you view in charts and tables usually relate to the number\nof <strong>"Unique authors"</strong> rather than the number of "Mentions" they generate.<br><br>\nDemographics data is currently only applied to English speaking Tweeters.<br><br><br>\n<input id="opt-out-checkbox" class="opt-out" type="checkbox">\n<label class="smallmargin-left smalltext" for="opt-out-checkbox">Don\'t show tour again</label>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!templates/pagetours/demographics/summary",["lib/mustache"],function(mustache){var escapedTemplate="An overview of the most common <strong>Demographic Groups</strong> who spoke about your brand or topic.<br><br>\n<strong>Trend lines</strong> let you know whether there was an <strong>increase</strong> or <strong>decrease</strong>\nin people from specific Demographic Groups over the <strong>time period</strong> youre viewing.<br><br>\nAuthors can be linked to more than a single Interest and/or Profession.\n";return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!templates/pagetours/demographics/dontForgetSave",["lib/mustache"],function(mustache){var escapedTemplate='As with all our Dashboards, if youd like to revisit this data, make sure to click <strong>save</strong> and\n<strong>name</strong> your Dashboard. You can even <strong>share</strong> your work with colleagues.<br><br><br>\n<input id="opt-out-checkbox-end" class="opt-out" type="checkbox">\n<label class="smallmargin-left smalltext" for="opt-out-checkbox-end">Don\\\'t show tour again</label>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!templates/pagetours/demographics/genderInterestsProfessions",["lib/mustache"],function(mustache){var escapedTemplate="These tabs allow you to dive into more <strong>detail</strong>. Showing you the\n<strong>similarities</strong> and <strong>differences</strong> between different\n<strong>Demographic Groups</strong>.\n";return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!templates/pagetours/demographics/mentionsMap",["lib/mustache"],function(mustache){var escapedTemplate='Displays the <strong>global distribution</strong> of conversation from authors identified as\nbeing <strong>"Individual"</strong> people as opposed to "Organisations\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!templates/pagetours/demographics/mentions",["lib/mustache"],function(mustache){var escapedTemplate="Look through the mentions filtered by <strong>individual</strong> authors.\nClick into specific mentions to see more metrics.\n";return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!templates/pagetours/demographics/topAuthors",["lib/mustache"],function(mustache){var escapedTemplate="To really get to know the <strong>people</strong> talking about your brand or topic,\nbrowse through the individuals having the <strong>biggest impact</strong>.\nClick on an Author's avatar to see their profiles.\n";return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!templates/pagetours/demographics/topContent",["lib/mustache"],function(mustache){var escapedTemplate="Compare the most <strong>shared links</strong>, most <strong>mentioned authors</strong>, and popular\n<strong>emoticons</strong> and <strong>hashtags</strong> from different Demographic Groups.\nOpen the <strong>Twitter section</strong> of the Filters to view this data <strong>segmented</strong>\nby other Demographic Groups.\n";return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!templates/pagetours/demographics/topicComparison",["lib/mustache"],function(mustache){var escapedTemplate="See the <strong>differences</strong> in the <strong>words and phrases</strong> used\nin the conversations of different <strong>Demographic Groups</strong> (in relation to your Query).<br><br>\n";return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/pageTour",["backbone","underscore","jquery","src/globals/me","src/events/componentEvents","src/events/globalEventNames","src/models/UserDetails","src/packages/guiders","mustache!templates/pagetours/canEditInsideDashboard","mustache!templates/pagetours/demographics/dashboardStart","mustache!templates/pagetours/demographics/summary","mustache!templates/pagetours/demographics/dontForgetSave","mustache!templates/pagetours/demographics/genderInterestsProfessions","mustache!templates/pagetours/demographics/mentionsMap","mustache!templates/pagetours/demographics/mentions","mustache!templates/pagetours/demographics/topAuthors","mustache!templates/pagetours/demographics/topContent","mustache!templates/pagetours/demographics/topicComparison","bw-fe-helpers/urlHelper","lib/jquery.notify"],function(Backbone,_,$,me,componentEvents,globalEventNames,UserDetails,guiders,canEditInsideDashboardTemplate,demographicsDashboardStartTemplate,demographicsSummaryTemplate,demographicsDontForgetSaveTemplate,demographicsGenderInterestProfessionsTemplate,demographicsMentionsMapTemplate,demographicsMentionsTemplate,demographicsTopAuthorsTemplate,demographicsTopContentTemplate,demographicsTopicComparisonTemplate,urlHelper){"use strict";var COMPONENT_EVENT_NAMES=globalEventNames.COMPONENTS;var pageTour;var timer;var currentTour;var userDetails;var optOutStatus=false;var lastGuiderShown=false;var currentTourVisible=false;var shownTours=[];function removeTourQueryString(tour){var app;var nloc=Backbone.history.getFragment();var queryString=urlHelper.getSearch();var query=queryString?urlHelper.parseQuery(queryString):{};if(query&&query.tour===tour){delete query.tour;nloc=nloc.replace(/\?.*/,"");if(_.size(query)){nloc+="?"+urlHelper.createQuery(query)}app=require("app");app.navigate(nloc,{trigger:false})}}function addTourQueryString(tour){var app;var nloc;var fragment=Backbone.history.getFragment();var queryString=urlHelper.getSearch();var query=queryString?urlHelper.parseQuery(queryString):{};if(!query||!query.tour||query.tour!==tour){query.tour=tour;nloc=fragment.replace(/\?.*/,"")+"?"+urlHelper.createQuery(query);app=require("app");app.navigate(nloc,{trigger:false})}}function removeGuiders(){if(timer){clearTimeout(timer);timer=null}currentTour=undefined;currentTourVisible=false;optOutStatus=false;lastGuiderShown=false;_(guiders._guiders).each(function(guider,key){guiders._guiders[key].elem.remove();delete guiders._guiders[key]});window.myGuider=null}function getProgressDots(count,step){if(step>count){step=count-1}var result='<div class="progressdots">';for(var i=1;i<=count;i++){result+='<div class="dib progressdot'+(i===step?" current":"")+'"></div>'}return result+"</div>"}function onShowMoveAbovePopup(popupSelector,guider,done){var $guider=$(guiders._guiderById(guider.id).elem);var newGuiderZIndex=parseInt($(guider.attachTo).closest(popupSelector).css("z-index"),10)+1;var currentStyle=$guider.attr("style");$guider.attr("style",currentStyle+"; z-index: "+newGuiderZIndex+" !important;");done()}function onShowOptOutGuider(guider,done){var $guider=$(guiders._guiderById(guider.id).elem);var $checkbox;if(!$guider){done();return}$checkbox=$guider.find("input.opt-out");if($checkbox.length){if($checkbox.attr("id").indexOf("opt-out-checkbox-end")!==-1&&!lastGuiderShown){$checkbox.prop("checked",true).trigger("change");lastGuiderShown=true}else{$checkbox.prop("checked",optOutStatus).trigger("change")}}done()}function initOptOutEventHandler(guiderId){var $g=$(guiders._guiderById(guiderId).elem);$g.find("input.opt-out").change(function(){if($(this).is(":checked")){optOutStatus=true}else{optOutStatus=false}})}function createTour(tourId,tourSteps){var attachToSelector=tourSteps[0].attachTo;if(tourSteps.length&&attachToSelector&&!$(attachToSelector).is(":visible")){throw new Error("There is no visible element matching "+attachToSelector+", the guider creation will be skipped.")}_(tourSteps).chain().filter(function(tourStep){return _(tourStep.roles).contains(me.get("uiRole"))}).map(function(tourStep,key,list){var guiderIndex=key+1;tourStep=_(tourStep).defaults({next:guiderIndex<list.length?list[guiderIndex].id:undefined,buttonCustomHTML:getProgressDots(list.length,guiderIndex),onClose:function onClose(){pageTour.close(tourId)}});guiders.createGuider(tourStep);initOptOutEventHandler(tourStep.id);if(tourStep.onCreate){tourStep.onCreate()}return tourStep})}function setupCanEditQueryInDashboardTour(attachTo){return[{id:"can-edit-inside-dashboard-start",roles:["admin","superadmin","regular"],title:"Did you know?",description:canEditInsideDashboardTemplate(),position:3,offset:{top:0,left:-24},width:476,attachTo:attachTo,buttons:[{name:"Got it",onclick:function onclick(){pageTour.close("can-edit-inside-dashboard")},classString:"close button singlemargin-right"}],buttonCustomHTML:'<label class="opt-out smalltext dib">\n                        <input id="opt-out-checkbox-end-alt" class="opt-out" type="checkbox">\n                        Don\'t show again\n                    </label>',onCreate:function onCreate(){$(guiders._guiderById("can-edit-inside-dashboard-start").elem).find("#opt-out-checkbox-end-alt").prop("checked",true).change()}}]}function setupSimpleTour(id,options){var tourStep={id:id+"-start",title:"",description:"",roles:["admin","superadmin","regular"],buttons:[{name:"Got it!",onclick:function onclick(){pageTour.close(id);pageTour.disableTour(id)},classString:"defaultbutton"}],classString:"simple-tour",position:1,offset:{top:20,left:30},width:272,buttonCustomHTML:""};tourStep=_.extend(tourStep,options);return[tourStep]}function setupQueryRenameTour(){return setupSimpleTour("queryRename",{attachTo:".js-attach-rename-guider:first",description:'<p class="singlemargin-bottom">New: <strong>Rename Queries</strong> by clicking the pencil.</p>',containerSelector:".js-guider-container",width:326,offset:{top:-1,left:32}})}function setupMentionsDeltaTour(){return setupSimpleTour("mentionsDeltaQueryWizard",{attachTo:".js-mentions-delta-query-wizard-tour",onShow:onShowMoveAbovePopup.bind(null,".popup"),description:'<p class="singlemargin-bottom"><strong>New: See the effect of every change</strong><br/> '+"Click here to see what effect your latest change has had on your preview results.</p>",width:300,position:"bottomRight",offset:{top:-20,left:30}})}function setupLogoQueryInputsTour(attachTo){return setupSimpleTour("logoQueryInputs",{attachTo:attachTo,description:'<p class="singlemargin-bottom"><strong>You can add Logo Queries</strong> to regular<br/> '+"Components just like any other Query.</p>",width:300,position:"topRight",offset:{top:20,left:-120}})}function setupDemographicsDashboardTour(){var allRoles=["admin","superadmin","regular","view","analyst","analystPlus"];var nextButton={name:'Next <span class="singlemargin-left icon-forward">',onclick:guiders.next,classString:"defaultbutton"};var tourSteps=[{id:"demographics-dashboard-start",title:"Take a tour of the Demographic Insights Dashboard",classString:"with-opt-out",onShow:onShowOptOutGuider,description:demographicsDashboardStartTemplate(),buttons:[{name:"Not Now",onclick:function onclick(){pageTour.close("demographics-dashboard")},classString:"button close singlemargin-left"},{name:'Continue Tour <span class="singlemargin-left icon-forward">',onclick:function onclick(){guiders.next()},classString:"defaultbutton"}],position:0},{title:"Twitter Demographics Summary Component",description:demographicsSummaryTemplate(),buttons:[nextButton],offset:{top:-24,left:0}},{title:"Gender, Interests & Professions Tabs",attachTo:"ul.tabs > li:eq(1)",onShow:function onShow(guider,done){$("ul.tabs > li:eq(1) a.open").click();done()},description:demographicsGenderInterestProfessionsTemplate(),buttons:[nextButton],position:7,offset:{top:-24,left:0}},{title:"Twitter Topic Comparison Component",attachTo:"section.tab:eq(1) #topiccomparison header h1",description:demographicsTopicComparisonTemplate(),onHide:function onHide(guider){$(guider.elem).hide()},buttons:[nextButton],position:11,offset:{top:24,left:0},autoFocus:true,scrollContainer:"div#dashboard"},{title:"Switching Between Demographics",attachTo:"section.tab:eq(2) #topiccomparison .topicComparisonControls",onShow:function onShow(guider,done){componentEvents.on(COMPONENT_EVENT_NAMES.COMPONENT_RENDERED,function(context){if(context.type==="topiccomparison"){componentEvents.off(COMPONENT_EVENT_NAMES.COMPONENT_RENDERED);$("section.tab:eq(2) #topiccomparison")[0].scrollIntoView();$("section.tab:eq(2) #topiccomparison a.controls").click();done()}});$("ul.tabs > li:eq(2) a.open").click()},description:"The <strong>Filter</strong> allows you to change which demographics groups are compared.",buttons:[nextButton],position:9,offset:{top:24,left:24}},{title:"Top Authors",attachTo:"section.tab:eq(2) #authorsByInterestBusiness  header h1",onShow:function onShow(guider,done){$(guider.attachTo)[0].scrollIntoView();done()},onHide:function onHide(guider){$(guider.elem).hide()},description:demographicsTopAuthorsTemplate(),buttons:[nextButton],position:7,offset:{top:-24,left:0}},{title:"Mentions Map",attachTo:"section.tab:eq(4) #locationMap header h1",onShow:function onShow(guider,done){componentEvents.on(COMPONENT_EVENT_NAMES.COMPONENT_RENDERED,function(context){if(context.type==="worldoverview"){componentEvents.off(COMPONENT_EVENT_NAMES.COMPONENT_RENDERED);$(guider.attachTo)[0].scrollIntoView();done()}});$("ul.tabs > li:eq(4) a.open").click()},onHide:function onHide(guider){$(guider.elem).hide()},description:demographicsMentionsMapTemplate(),buttons:[nextButton],position:2,offset:{top:-12,left:-24}},{title:"View Mentions",attachTo:"section.tab:eq(5) #mentionsSearch header h1",onShow:function onShow(guider,done){componentEvents.on(COMPONENT_EVENT_NAMES.COMPONENT_RENDERED,function(context){if(context.type==="mentions"){componentEvents.off(COMPONENT_EVENT_NAMES.COMPONENT_RENDERED);done()}});$("ul.tabs > li:eq(5) a.open").click()},onHide:function onHide(guider){$(guider.elem).hide()},description:demographicsMentionsTemplate(),buttons:[nextButton],position:7,offset:{top:-24,left:0}},{title:"Charting by Demographics",attachTo:"section.tab:eq(6) #chart header h1",onShow:function onShow(guider,done){componentEvents.on(COMPONENT_EVENT_NAMES.COMPONENT_RENDERED,function(context){if(context.type==="chart"){componentEvents.off(COMPONENT_EVENT_NAMES.COMPONENT_RENDERED);done()}});$("ul.tabs > li:eq(6) a.open").click()},description:"Use our <strong>versatile</strong> Charts Component to display demographics data in interesting ways.",buttons:[nextButton],position:3,offset:{top:0,left:-24}},{title:"Top Content",attachTo:"section.tab:eq(6) #twitterInsightsMale header h1",onShow:function onShow(guider,done){$(guider.attachTo)[0].scrollIntoView();done()},description:demographicsTopContentTemplate(),buttons:[nextButton],position:7,offset:{top:0,left:0}},{title:"Don't Forget to Click Save!",attachTo:".dashboard header .save",onShow:function onShow(guider,done){$(".dashboard header")[0].scrollIntoView();onShowOptOutGuider(guider,done)},description:demographicsDontForgetSaveTemplate(),classString:"with-opt-out",buttons:[{name:"Close",onclick:function onclick(){pageTour.close("demographics-dashboard");$("ul.tabs > li:eq(0) a.open").click()},classString:"close button"}],position:6,offset:{top:-24,left:0}}];tourSteps.forEach(function(tourStep,i){tourStep.roles=allRoles;tourStep.containerSelector="#projects #dashboard";if(tourStep.id===undefined){tourStep.id="demographics-dashboard-"+i}});return tourSteps}function canShowTour(tour,retake){var enabledAndNotShown=pageTour.isEnabled(tour)&&_(shownTours).indexOf(tour)===-1;return!pageTour.visible()&&currentTour!==tour&&(retake||enabledAndNotShown)}pageTour={setTourMark:function setTourMark(tour){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var steps;if(!canShowTour(tour,options.retake)){return}removeGuiders();try{switch(tour){case"can-edit-inside-dashboard":steps=setupCanEditQueryInDashboardTour(options.attachTo);break;case"queryRename":steps=setupQueryRenameTour();break;case"mentionsDeltaQueryWizard":steps=setupMentionsDeltaTour();break;case"logoQueryInputs":steps=setupLogoQueryInputsTour(options.attachTo);break;case"demographics-dashboard":steps=setupDemographicsDashboardTour();break;default:return}createTour(tour,steps);currentTour=tour;addTourQueryString(tour);this.show(tour);shownTours.push(tour)}catch(e){console.error(e)}},isEnabled:function isEnabled(tour){var disabledTours=this.getDisabledTours();if(tour&&_.indexOf(disabledTours,tour)!==-1){return false}return true},visible:function visible(){return currentTourVisible},show:function show(tour){timer=_.defer(function(){guiders.show(tour+"-start");currentTourVisible=true})},next:function next(){if(!this.visible()){return}guiders.next();return pageTour},prev:function prev(){if(!this.visible()){return}guiders.prev();return pageTour},close:function close(tour){if(tour&&optOutStatus){pageTour.disableTour(tour)}removeTourQueryString(tour);pageTour.remove()},remove:function remove(){removeGuiders()},getDisabledTours:function getDisabledTours(){return me.getDisabledPageTours()},enableTour:function enableTour(tour){var disabledTours=pageTour.getDisabledTours();disabledTours=_(disabledTours).filter(function(t){return t!==tour});pageTour._saveDisabledTours(disabledTours)},disableTour:function disableTour(tour){var disabledTours;tour=_.isString(tour)?tour:currentTour;if(tour){disabledTours=pageTour.getDisabledTours();if(_.indexOf(disabledTours,tour)===-1){disabledTours.push(tour);pageTour._saveDisabledTours(disabledTours)}}removeGuiders()},_saveDisabledTours:function _saveDisabledTours(disabledTours){var saveTag=function saveTag(){var errorMessage;userDetails.save({tags:_.extend(userDetails.get("tags"),{disabledTours:disabledTours.join("&")})},{error:function error(){$.notify({text:"Error saving page tour status.",className:"notification-error"})},success:function success(){me.set("tags",_.extend(userDetails.get("tags"),{disabledTours:userDetails.get("tags").disabledTours}))}});if(userDetails.validationError){errorMessage=["Sorry, couldn't save your preference. Please update ",_(userDetails.validationError).keys().map(function(key){return _(key).capitalize()}).join(", "),' in "Your Details" in the top right user menu.'];$.notify({text:errorMessage.join(""),className:"notification-error",duration:12e3})}};if(!userDetails){userDetails=new UserDetails}userDetails.fetch({success:function success(){saveTag()}})},_resetShownTours:function _resetShownTours(){shownTours=[]}};return pageTour});define("appLayout",["async","backbone","underscore","jquery","src/ApiError","src/globals/currentProject","src/views/HeaderView","src/views/FooterView","src/models/NotificationCollection","src/views/navigation/NavigationView","src/views/HelpView","src/pageTour","lib/jquery.notify","src/packages/modalDialogs"],function(async,Backbone,_,$,ApiError,currentProject,HeaderView,FooterView,NotificationCollection,NavigationView,HelpView,pageTour){"use strict";var COPY_PROJECT_IN_PROGRESS=402;function showLayoutElements(appLayout){appLayout.showHeader();appLayout.showSidebar();appLayout.showProjectContainer();appLayout.showProjectSwitcher()}function toggleFooter(appLayout,showFooter){if(showFooter!==false){appLayout.showFooter()}else{appLayout.hideFooter()}}function AppLayout(){}_.extend(AppLayout.prototype,{load:function load(el){if(!el){throw new Error("appLayout.load requires a DOM element")}this.el=el;this.blocking=0;this.currentPageView=null;this.getPageContainer("dashboard",this.getPageContainer("projects"));this.notifications=new NotificationCollection;this.headerView=new HeaderView({el:$("#main-header"),project:currentProject,notifications:this.notifications});this.headerView.render();this.footerView=new FooterView({el:$("#main-footer")});this.footerView.render();this.notifications.fetch();$("body").on("click.help","a.help",_.bind(this.onHelpClick,this))},unload:function unload(){var self=this;this.off();this.unblockUI();_(["headerView","footerView","navigationView"]).each(function(viewName){if(self[viewName]){self[viewName].remove();delete self[viewName]}});$(this.el).empty().off();if(this.notifications){this.notifications.off();this.notifications=null}if(this.helpView){this.helpView.remove();this.helpView=null}$("body").off("click.help","a.help")},_buildSubViews:function _buildSubViews(){var _this=this;var $container=this.getPageContainer("projects");var sidebarOptions={el:$("#sidebar")};$container.removeClass("page");this.navigationView=new NavigationView(sidebarOptions);this.listenTo(this.navigationView,"toggleNavigation",function(){if(_this.currentPageView&&_this.currentPageView.onResize){_this.currentPageView.onResize()}});this.navigationView.render()},blockUI:function blockUI(message){this.blocking++;if(!$("#blockUI")[0]){$("<div id=blockUI />").appendTo("body")}$("#blockUI").text(message||"Please wait...").showModal({className:"blockUIPlaceholder"})},unblockUI:function unblockUI(){if(--this.blocking<=0){this.blocking=0;$("#blockUI").hide().removeModal()}},getPageContainer:function getPageContainer(id,$parent){var div;$parent=$parent||this.el;div=$parent.find("#"+id);if(!div.length){div=$("<div />").attr("id",id);$parent.append(div)}if(id!=="projects"){div.addClass("page")}return div},showPageContainer:function showPageContainer(id){var div=this.getPageContainer(id);div.removeClass("hidden").siblings().addClass("hidden");if(this.navigationView){this.navigationView.setActiveMenuItem(id)}return div},setCurrentPageView:function setCurrentPageView(view){if(this.currentPageView===view){return}if(this.currentPageView&&_.isFunction(this.currentPageView.hidden)){this.currentPageView.hidden()}if(view&&_.isFunction(view.shown)){view.shown()}this.currentPageView=view},showSpinner:function showSpinner(){var spinner=$("#loadSpinner");if(!spinner.length){spinner=$('<p id="loadSpinner"></p>').appendTo("body")}spinner.show()},hideSpinner:function hideSpinner(){$("#loadSpinner").hide()},showSidebar:function showSidebar(){$("body").addClass("hassidebar")},hideSidebar:function hideSidebar(){$("body").removeClass("hassidebar")},showHeader:function showHeader(){$("#main-header").removeClass("hidden")},hideHeader:function hideHeader(){$("#main-header").addClass("hidden")},showFooter:function showFooter(){$("body").addClass("hasfooter");$("#main-footer").removeClass("hidden")},hideFooter:function hideFooter(){$("body").removeClass("hasfooter");$("#main-footer").addClass("hidden")},hideProjectContainer:function hideProjectContainer(){$("#projects").addClass("hidden")},showProjectContainer:function showProjectContainer(){$("#projects").removeClass("hidden")},showProjectSwitcher:function showProjectSwitcher(){if(this.headerView){this.showAppMode();this.headerView.showProjectSwitcher()}},hideProjectSwitcher:function hideProjectSwitcher(){if(this.headerView){this.headerView.hideProjectSwitcher()}},closePageTour:function closePageTour(){if(pageTour.visible){pageTour.close("welcome")}},showAdminMode:function showAdminMode(){if(this.headerView){this.headerView.showAdminMode()}},showAppMode:function showAppMode(){if(this.headerView){this.headerView.showAppMode()}},animateProjectSwitcher:function animateProjectSwitcher($selector){var $targetEl=this.headerView.$(".projectSelector .projectSelectionView"),$animatedEl,animEvents="transitionend webkitTransitionEnd";$animatedEl=$selector.clone().addClass("looseprojectswitcher animate").css(_.extend({position:"absolute"},$selector.offset()));$("body").append($animatedEl);this.headerView.showProjectSwitcher();async.series([function(callback){$animatedEl.css({left:$targetEl.offset().left,top:0,opacity:0}).one(animEvents,function(){_.defer(callback)})},function(callback){$animatedEl.removeClass("animate").addClass("fadeout").one(animEvents,function(){callback()})}],function(){$animatedEl.remove()})},showProject:function showProject(projectId,options,callback){var self=this;if(_.isFunction(options)){callback=options;options=null}projectId=parseInt(projectId,10);if(!projectId){return callback(new Error("no id"))}$("#projectSelection").addClass("hidden");if(projectId===currentProject.id&&$("#projects").children(".page").length){toggleFooter(self,options&&options.showFooter);return callback(null,currentProject)}self.showSpinner();currentProject.load(projectId).then(function(project){showLayoutElements(self);toggleFooter(self,options&&options.showFooter);self._buildSubViews();if(self.dashboardRoute&&self.dashboardRoute.projectId!==projectId){self.dashboardRoute.unload();self.dashboardRoute=null}self.hideSpinner();callback(null,project)},callback).done(function(err){if(err){console.error("Error showing project",projectId,options,err);throw err}})},showProjectError:function showProjectError(err){var apiError=new ApiError(err);var message=parseInt(apiError.errorCodes[0],10)===COPY_PROJECT_IN_PROGRESS?apiError.message:"Could not load your Project, it may have been moved or deleted.";require("app").navigate("/",{trigger:true});$.notify({text:message,className:"notification-error"})},onHelpClick:function onHelpClick(e){e.preventDefault();e.stopPropagation();this.helpClick($(e.target))},helpClick:function helpClick($target){var helpKey=$target.attr("data-key"),cssClass=$target.attr("data-modal-css-class");if(!helpKey){console.warn("a help click was made on an element without a data-key",$target);return}if(this.helpView){this.helpView.remove()}this.helpView=HelpView.show({$target:$target,key:helpKey,cssClass:cssClass})}},Backbone.Events);return new AppLayout});define("mustache!templates/reAuthForm",["lib/mustache"],function(mustache){var escapedTemplate='<h1 class="popuptitletext singlemargin-bottom draggable">Please login</h1>\n<div class="content">\n<div class="errorPane notification-error rounded smallpadding-vertical singlepadding-horizontal singlemargin-bottom hidden"></div>\n<div class="messagePane notification-info rounded smallpadding-vertical singlepadding-horizontal singlemargin-bottom hint-info {{^hasBecomeUser}}hidden{{/hasBecomeUser}}">\n{{^loginUrl}}\n{{#hasBecomeUser}}\n<span class="hasBecomeMessage">You seem to be using the "become" functionality. Enter <em>your own</em> username and password and we will log you in as <strong>{{username}}</strong></span>\n{{/hasBecomeUser}}\n{{/loginUrl}}\n</div>\n<form>\n{{^loginUrl}}\n<p class="singlemargin-bottom">\n<label class="db smallmargin-bottom smallpadding-top" for="username-{{cid}}">Email</label>\n{{#hasBecomeUser}}\n<input class="username" name="username" id="username-{{cid}}" placeholder="Your email" autocomplete="off" autofocus />\n{{/hasBecomeUser}}\n{{^hasBecomeUser}}\n<span class="username" id="username-{{cid}}">{{username}}</span>\n{{/hasBecomeUser}}\n</p>\n<p class="singlemargin-bottom">\n<label class="db smallmargin-bottom smallpadding-top" for="password-{{cid}}">Password</label>\n{{#hasBecomeUser}}\n<input type="password" id="password-{{cid}}" class="password field" />\n{{/hasBecomeUser}}\n{{^hasBecomeUser}}\n<input type="password" id="password-{{cid}}" class="password field" autofocus />\n{{/hasBecomeUser}}\n</p>\n<p class="buttons doublemargin-top">\n<button class="defaultbutton floatleft">Login</button>\n<a class="js-forgotPassword floatright">Forgot password?</a>\n<div class="clearboth"></div>\n</p>\n{{/loginUrl}}\n{{#loginUrl}}\n<p class="singlemargin-bottom">\n<a href="{{loginUrl}}" class="js-loginUrl">Please log in here</a>\n</p>\n{{/loginUrl}}\n</form>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!css/reAuthenticateForm.css",["css!css/compiled.css"],function(){});define("src/views/ReAuthenticateForm",["backbone","jquery","src/Workbench","src/globals/theme","mustache!templates/reAuthForm","css!css/reAuthenticateForm.css","src/packages/modalDialogs"],function(Backbone,$,Workbench,theme,reauthForm){"use strict";var ReAuthenticateForm;return ReAuthenticateForm=Backbone.View.extend({className:"reAuthenticateForm",events:{"submit form":"onSubmitForm","click .js-forgotPassword":"onForgotPassword","click .js-loginUrl":"onClickLoginUrl"},initialize:function initialize(options){if(!options||!options.username){throw new Error("options.username must be set!")}this.username=options.username;this.hasBecomeUser=options.hasBecomeUser},render:function render(){this.$el.html(reauthForm({cid:this.cid,username:this.username,hasBecomeUser:this.hasBecomeUser,loginUrl:theme.loginUrl}));this.$(".password").focus()},onSubmitForm:function onSubmitForm(){var self=this,became=this.hasBecomeUser,username=became?this.$("[name=username]").val():this.username;if(theme.loginUrl){return}this.$(".messagePane").addClass("hidden");this.$(".errorPane").addClass("hidden").text("Login failed, please retry");this.$("button").prop("disabled",true);$.ajax("/loginXhr",{type:"POST",dataType:"json",data:{username:username,password:this.$(".password").val()},success:function success(){if(became){$.ajax("/become",{dataType:"json",data:{username:self.username},success:function success(){self.trigger("success");self.remove()},error:function error(){self.$(".errorPane").removeClass("hidden");self.$("button").prop("disabled",false)}});return}self.trigger("success");self.remove()},error:function error(){self.$(".errorPane").removeClass("hidden");self.$("button").prop("disabled",false)}});return false},onForgotPassword:function onForgotPassword(){var self=this;if(theme.loginUrl){return}this.$(".errorPane,.messagePane").addClass("hidden");$.ajax(Workbench.buildApiUrl("/forgotpassword"),{type:"POST",dataType:"json",data:{username:this.username},success:function success(){self.$(".messagePane").removeClass("hidden").text("A link to reset your password has been emailed to you")},error:function error(){self.$(".errorPane").removeClass("hidden").text("Could not request a password reset, please try again")}})},onClickLoginUrl:function onClickLoginUrl(e){e.preventDefault();window.open(theme.loginUrl,"login","menubar=0,status=0,toolbar=0,width=770,height=550")}},{isShown:function isShown(){return!!this.view},remove:function remove(){if(!this.view){return}this.view.remove()},show:function show(username,hasBecomeUser){var self=this,view=new ReAuthenticateForm({username:username,hasBecomeUser:hasBecomeUser}),remove=view.remove;if(this.view){return this.view}this.view=view;view.render();view.$el.showModal({draggable:"h1:first",className:"popup tinypopup",onClose:function onClose(){view.remove()}});view.$el.parent().find("a.close").remove();view.remove=function(){this.$el.removeModal();delete self.view;remove.call(this)};return view}})});(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==="object"&&typeof module==="object")module.exports=factory();else if(typeof define==="function"&&define.amd)define("bw-fe-helpers/cookieHelper",[],factory);else{var a=factory();for(var i in a)(typeof exports==="object"?exports:root)[i]=a[i]}})(this,function(){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=17)}({17:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_exports__["default"]={getItem:function getItem(sKey){if(!sKey||!this.hasItem(sKey)){return null}return unescape(document.cookie.replace(new RegExp("(?:^|.*;\\s*)"+escape(sKey).replace(/[-.+*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*"),"$1"))},setItem:function setItem(sKey,sValue,vEnd,sPath,sDomain,bSecure){if(!sKey||/^(?:expires|max-age|path|domain|secure)$/i.test(sKey)){return}var sExpires="";if(vEnd){switch(vEnd.constructor){case Number:sExpires=vEnd===Infinity?"; expires=Tue, 19 Jan 2038 03:14:07 GMT":"; max-age="+vEnd;break;case String:sExpires="; expires="+vEnd;break;case Date:sExpires="; expires="+vEnd.toGMTString();break}}document.cookie=escape(sKey)+"="+escape(sValue)+sExpires+(sDomain?"; domain="+sDomain:"")+(sPath?"; path="+sPath:"")+(bSecure?"; secure":"")},removeItem:function removeItem(sKey,sPath){if(!sKey||!this.hasItem(sKey)){return}document.cookie=escape(sKey)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(sPath?"; path="+sPath:"")},hasItem:function hasItem(sKey){return new RegExp("(?:^|;\\s*)"+escape(sKey).replace(/[-.+*]/g,"\\$&")+"\\s*\\=").test(document.cookie)},keys:function keys(){var aKeys=document.cookie.replace(/((?:^|\s*;)[^=]+)(?=;|$)|^\s*|\s*(?:=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:=[^;]*)?;\s*/);for(var nIdx=0;nIdx<aKeys.length;nIdx++){aKeys[nIdx]=unescape(aKeys[nIdx])}return aKeys}}}})["default"]});define("src/logoutDetector",["underscore","jquery","src/Workbench","src/globals/me","src/views/ReAuthenticateForm","bw-fe-helpers/cookieHelper","src/storageProvider"],function(_,$,Workbench,me,ReAuthenticateForm,cookieHelper,storageProvider){"use strict";var instance;var checkInterval=60*1e3;function LogoutDetector(){_(this).bindAll("onStorageEvent","onVisibilityChange")}function makePingCall(options){return $.ajax(Workbench.buildApiUrl("/ping"),_.extend({cache:false,dataType:"json"},options))}function logoutCurrentUser(){var currentUser=storageProvider.get(instance.usernameLocalStorageKey);if(currentUser&&instance.username===currentUser){storageProvider.set(instance.usernameLocalStorageKey,"")}}function showReAuthForm(){if(ReAuthenticateForm.isShown()){return}var reAuthForm=ReAuthenticateForm.show(instance.username,instance.hasBecomeUser);logoutCurrentUser();reAuthForm.on("success",function restartMonitor(){reAuthForm.off("success",restartMonitor)})}_.extend(LogoutDetector.prototype,{usernameLocalStorageKey:"username",userLoggedOut:function userLoggedOut(){if(ReAuthenticateForm.isShown()){return}return showReAuthForm()},checkLoginStatus:_.throttle(function(){var self=this;makePingCall({success:function success(data){if(!data||!data.username||self.username.toLowerCase()!==data.username.toLowerCase()){return self.userLoggedOut()}if(ReAuthenticateForm.isShown()){ReAuthenticateForm.remove()}storageProvider.set(self.usernameLocalStorageKey,self.username)},error:function error(xhr){if(xhr.status===403||xhr.status===401){return self.userLoggedOut()}self.checkLoginStatus()}})},5e3,{leading:true,trailing:true}),onStorageEvent:function onStorageEvent(e){if(e.key!==this.usernameLocalStorageKey){return}this.checkLoginStatus()},onVisibilityChange:function onVisibilityChange(e){if(e.target.hidden){return}this.checkLoginStatus()},start:function start(){this.running=true;this.monitor();if(!window.addEventListener){return}window.removeEventListener("storage",this.onStorageEvent);window.addEventListener("storage",this.onStorageEvent,false);document.removeEventListener("visibilitychange",this.onVisibilityChange);document.addEventListener("visibilitychange",this.onVisibilityChange,false)},stop:function stop(){if(this.timeout){clearTimeout(this.timeout);delete this.timeout}this.running=false;this.setup=false;if(!window.removeEventListener){return}window.removeEventListener("storage",this.onStorageEvent);document.removeEventListener("visibilitychange",this.onVisibilityChange)},monitor:function monitor(){if(this.timeout){clearTimeout(this.timeout);delete this.timeout}if(!this.running){return}if(!this.setup){this.username=me.get("username");this.hasBecomeUser=cookieHelper.getItem("became")==="true";this.setup=true}this.checkLoginStatus();this.timeout=setTimeout(this.monitor.bind(this),checkInterval)}});instance=new LogoutDetector;return instance});define("src/helpers/logoVersionHelper",[],function(){"use strict";var logograbAssetCdnUrl;var rewriteUrl=function rewriteUrl(logograbUrl){if(!logograbAssetCdnUrl){console.warn("logograbAssetCdnUrl not configured. Using logograb url for logoversion directly.");return logograbUrl}var baseUrl=new URL("".concat(logograbAssetCdnUrl));baseUrl.searchParams.set("url",logograbUrl);return baseUrl.href};function configure(assetCdnUrl){logograbAssetCdnUrl=assetCdnUrl}return{rewriteUrl:rewriteUrl,configure:configure}});define("mustache!templates/appNotification",["lib/mustache"],function(mustache){var escapedTemplate='<div class="modular smallpadding-vertical textcenter notification {{cssClass}} appNotification">\n<span class="messageBody">\n{{{messageHtml}}}\n</span>\n<a class="close icon-remove grey" title="{{closeTipText}}"></a>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!css/appNotifications.css",["css!css/compiled.css"],function(){});define("src/appNotifications",["underscore","jquery","mustache!templates/appNotification","css!css/appNotifications.css"],function(_,$,template){"use strict";var AppNotifications,notificationList=[];function getNotification(key){return _.findWhere(notificationList,{key:key})}function prependToDom(notification){if(!notification||!notification.$element){return}return notification.$element.prependTo("body").animate({marginTop:0,ease:"easeout",duration:200}).on("click",".close",_.partial(AppNotifications.remove,notification.key))}function replaceNotificationOnDom(notification,oldNotification){oldNotification.$element.css("marginTop","-24px").detach();return prependToDom(notification)}function removeNotification(key){if(!key){throw new Error("key must be defined")}var notification=getNotification(key);if(!notification){return}notificationList=_.without(notificationList,notification);notification.$element.animate({marginTop:-24,ease:"easeout",duration:200},function(){notification.$element.remove();notification.$element=undefined;setTimeout(function(){prependToDom(notificationList[0])},1e3)})}function buildElement(options){var data={messageHtml:options.messageHtml,cssClass:options.cssClass||"notification-info",closeTipText:options.closeTipText||"close"},$element=$(template(data)).css({marginTop:-24,zIndex:14});return{key:options.key,$element:$element}}AppNotifications={show:function show(options){if(!options||!options.key){throw new Error("options.key must be defined")}var notification=buildElement(options);notificationList.unshift(notification);if(notificationList.length<=1){prependToDom(notification)}else{replaceNotificationOnDom(notification,notificationList[1])}return notification.$element},get:function get(key){return(getNotification(key)||{}).$element},remove:removeNotification,removeAll:function removeAll(){var notification;while(notification=notificationList.shift()){notification.$element.remove()}}};return AppNotifications});define("src/versionChecker",["underscore","jquery","src/globals/theme","src/Workbench","src/appNotifications"],function(_,$,theme,Workbench,appNotifications){"use strict";var showingNewVersionBanner=false;var NOTIFICATION_KEY="versionChecker";var NEW_VERSION_CHECK_MS=60*1e3;function makeMessageHtml(appName){return'<span>We\'ve upgraded <span class="productName">'+appName+"</span>! "+'<a class="action" onclick="window.location.reload()">Reload now</a> to use the latest version!</span>'}function VersionChecker(){}function getVersionNumber(callback){$.ajax({dataType:"json",url:"/version",success:function success(data){callback(null,data.buildNumber)},error:function error(xhr,status){callback(new Error(status))}})}function checkVersion(callback){getVersionNumber(function(err,buildNumber){if(err){return callback()}if(buildNumber===Workbench.buildNumber){return callback()}if(!Workbench.buildNumber){Workbench.buildNumber=buildNumber;return callback()}if(showingNewVersionBanner){return}showingNewVersionBanner=true;appNotifications.show({key:NOTIFICATION_KEY,messageHtml:makeMessageHtml(theme.productName)});callback()})}function check(){return checkVersion(function(){if(showingNewVersionBanner){return}setTimeout(check,NEW_VERSION_CHECK_MS)})}_.extend(VersionChecker.prototype,{start:function start(){check()},reset:function reset(){showingNewVersionBanner=false}});return new VersionChecker});define("src/idleDetector",["jquery","src/Workbench","src/logoutDetector"],function($,Workbench,logoutDetector){"use strict";var timeout,timer;function logout(){$.get(Workbench.buildApiUrl("/logout")).then(function(){logoutDetector.userLoggedOut()})}function resetIdleTimer(){clearTimeout(timer);timer=setTimeout(logout,timeout*60*1e3)}return{start:function start(options){timeout=options.timeout||1440;resetIdleTimer();$(document).on("mousemove.idleTimeout",resetIdleTimer);$(document).on("keydown.idleTimeout",resetIdleTimer)},stop:function stop(){clearTimeout(timer);$(document).off("mousemove.idleTimeout");$(document).off("keydown.idleTimeout")}}});define("mustache!templates/passwordExpiryMessage",["lib/mustache"],function(mustache){var escapedTemplate='<p>Your password will expire {{expiryMessage}}. Please <a class="linkwhite js-change-password">change your password</a> to prevent your account getting deactivated.</p>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/AutomatedPasswordExpiry",["moment","src/appNotifications","src/events/administrationEvents","mustache!templates/passwordExpiryMessage"],function(moment,appNotifications,administrationEvents,passwordExpiryMessage){"use strict";var NOTIFICATION_CLASS="notification-warning",EXPIRY_WARNING_DAYS=5,NOTIFICATION_KEY="automatedPasswordExpiry";function getExpiryMessage(daysRemaining){if(daysRemaining<=0){return"today"}if(daysRemaining===1){return"tomorrow"}return"in "+daysRemaining+" days"}function daysUntilExpiry(date){var expiryWarningDate,passwordExpiryDate;if(!date){return Infinity}expiryWarningDate=moment.utc();passwordExpiryDate=moment.utc(date);return passwordExpiryDate.diff(expiryWarningDate,"days")}function showAccountDetailsView(e){e.preventDefault();require(["src/views/MyAccountDetailsView"],function(MyAccountDetailsView){MyAccountDetailsView.show();administrationEvents.once("password-changed",function(){appNotifications.remove(NOTIFICATION_KEY)})})}function notifyUser(daysRemaining){appNotifications.show({key:NOTIFICATION_KEY,messageHtml:passwordExpiryMessage({expiryMessage:getExpiryMessage(daysRemaining)}),cssClass:NOTIFICATION_CLASS}).on("click","a.js-change-password",showAccountDetailsView)}function showPasswordExpiryMessage(passwordExpiryDate){var daysRemaining=daysUntilExpiry(passwordExpiryDate);if(daysRemaining>EXPIRY_WARNING_DAYS){return}notifyUser(daysRemaining)}return{apply:function apply(passwordExpiryDate){if(!passwordExpiryDate){return}require("src/Workbench").once("ready",function(){showPasswordExpiryMessage(passwordExpiryDate)})}}});define("src/facebookLoginChecker",["src/globals/theme","src/helpers/FB","src/helpers/fbTokenServiceHelper"],function(theme,FB,fbTokenServiceHelper){"use strict";var AUTH_CHANGE_EVENT="authChange";function onAuthChange(_ref){var loggedIn=_ref.loggedIn,_ref$authData=_ref.authData,authData=_ref$authData===void 0?{}:_ref$authData;if(!loggedIn){return}var facebookAppId=theme.fbAppId;var accessToken=authData.accessToken;if(!accessToken){return}fbTokenServiceHelper.storeAccessToken(accessToken,facebookAppId)}function start(){FB.off(AUTH_CHANGE_EVENT,onAuthChange);FB.on(AUTH_CHANGE_EVENT,onAuthChange);FB.getLoginStatus()}return{start:start}});function _typeof(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}define("src/instagramChannelsRevokedTokenChecker",["moment","src/Workbench","src/appNotifications","src/storageProvider","bw-fe-helpers/promiseHelper"],function(moment,Workbench,appNotifications,storageProvider,promiseHelper){"use strict";var WARNING_CLASS="notification-warning";var HELP_ICON_LINK='<a class="help icon-bwhelp" data-key="instagram-channel-token"></a>';var REVOKED_MESSAGE="To ensure Instagram Channel(s) data is being collected they require authentication. "+'<a class="linkwhite js-login">Please review here</a>. '+HELP_ICON_LINK;var NOTIFICATION_SHOWN_DATE_KEY="instagramChannelsRevokedTokenNotificationShownDate";var NOTIFICATION_SNOOZE_DURATION=1;var NOTIFICATION_KEY="instagramChannelsRevokedToken";function snoozeExpired(datestamp){return moment.utc().diff(moment.utc(datestamp),"days")>=NOTIFICATION_SNOOZE_DURATION}function loginClickHandler(projectId,e){e.preventDefault();require("app").navigate("/project/"+projectId+"/data/channels",{trigger:true});appNotifications.remove(NOTIFICATION_KEY)}function onClose(projectId){var now=moment.utc().toISOString();var lastShown=storageProvider.get(NOTIFICATION_SHOWN_DATE_KEY);if(!lastShown||_typeof(lastShown)!=="object"){lastShown={}}lastShown[projectId]=now;storageProvider.set(NOTIFICATION_SHOWN_DATE_KEY,lastShown)}function snoozeNotification(projectId){var lastShownAll=storageProvider.get(NOTIFICATION_SHOWN_DATE_KEY);var lastShownForProject;if(!lastShownAll||_typeof(lastShownAll)!=="object"){return false}lastShownForProject=lastShownAll[projectId];if(!lastShownForProject){return false}if(snoozeExpired(lastShownForProject)){delete lastShownAll[projectId];storageProvider.set(NOTIFICATION_SHOWN_DATE_KEY,lastShownAll);return false}return true}function showNotification(projectId){appNotifications.show({key:NOTIFICATION_KEY,messageHtml:REVOKED_MESSAGE,cssClass:WARNING_CLASS,closeTipText:"Not now, remind me later"}).one("click",".js-login",loginClickHandler.bind(null,projectId)).one("click",".close",onClose.bind(null,projectId))}return{start:function start(projectId){appNotifications.remove(NOTIFICATION_KEY);if(!projectId||snoozeNotification(projectId)){return}return promiseHelper.ajax({url:Workbench.buildApiUrl("/projects/{projectId}/instagramqueries")}).then(function(data){var results=data?data.results:[];var shouldNotify=results.some(function(item){return item.revoked===true});if(shouldNotify){showNotification(projectId)}})}}});define("src/appStartup",["src/globals/me","src/globals/currentProject","src/versionChecker","src/idleDetector","src/logoutDetector","src/AutomatedPasswordExpiry","src/facebookLoginChecker","src/instagramChannelsRevokedTokenChecker"],function(me,currentProject,versionChecker,idleDetector,logoutDetector,AutomatedPasswordExpiry,facebookLoginChecker,instagramChannelsRevokedTokenChecker){"use strict";var AppStartup={start:function start(){AutomatedPasswordExpiry.apply(me.get("passwordExpiryDate"));versionChecker.start();logoutDetector.start();idleDetector.start({timeout:me.get("client").userInactivityTimeoutMinutes});facebookLoginChecker.start();currentProject.onLoad(function(done){if(currentProject.id){instagramChannelsRevokedTokenChecker.start(currentProject.id)}done()})}};return AppStartup});(function(context){"use strict";var intentRegex=/twitter\.com(\:\d{2,4})?\/intent\/(\w+)/,width=550,height=420;function openWindow(url,window){var screenTop=window.screenTop,screenLeft=window.screenLeft,windowWidth=window.outerWidth||window.document.documentElement.offsetWidth,windowHeight=window.outerHeight||window.document.documentElement.offsetHeight,windowOptions="scrollbars=yes,resizable=yes,toolbar=no,location=yes",left=screenLeft,top=screenTop;left+=Math.round(windowWidth/2-width/2);if(windowHeight>height){top+=Math.round(windowHeight/2-height/2)}window.open(url,"intent",windowOptions+",width="+width+",height="+height+",left="+left+",top="+top)}function TwitterIntents(root,window){var isRegistered=false;window=window||context.window;root=root||window.document;function handleIntent(event){var target=event.target||event.srcElement,match;while(target&&target.nodeName.toLowerCase()!=="a"){target=target.parentNode}if(target&&target.nodeName.toLowerCase()==="a"&&target.href){match=target.href.match(intentRegex);if(match){openWindow(target.href,window);event.returnValue=false;event.preventDefault&&event.preventDefault()}}}this.register=function(){if(isRegistered){return}if(root.addEventListener){root.addEventListener("click",handleIntent,false)}else if(root.attachEvent){root.attachEvent("onclick",handleIntent)}isRegistered=true;return this};this.unregister=function(){if(!isRegistered){return}if(root.removeEventListener){root.removeEventListener("click",handleIntent,false)}else if(root.detachEvent){root.detachEvent("onclick",handleIntent)}isRegistered=false;return this}}if(typeof context.define==="function"&&context.define.amd){context.define("twitter-intents",function(){return TwitterIntents})}else if(context.exports){context.exports=TwitterIntents}else{context.TwitterIntents=TwitterIntents}})(typeof this.module==="object"?this.module:this);define("twitter-intents",function(){});define("src/analytics/trackAppAnalytics",["src/analytics/Analytics","src/events/appEvents","src/events/globalEventNames"],function(Analytics,appEvents,globalEventNames){"use strict";var NAVIGATED=globalEventNames.APP.NAVIGATED;return function trackAppAnalytics(){appEvents.on(NAVIGATED,function trackedNavigated(eventData){Analytics.trackMixpanelEvent(NAVIGATED,eventData)})}});define("src/events/tagEvents",["underscore","backbone"],function(_,Backbone){"use strict";return _.clone(Backbone.Events)});define("src/analytics/trackTagAnalytics",["src/analytics/Analytics","src/events/tagEvents"],function(Analytics,tagEvents){"use strict";return function trackTagEvents(){tagEvents.on("tag:add",function trackTagAddEvent(){Analytics.trackEvent({name:"Miscellaneous.Tags",action:"Add",origin:"Application"})})}});define("src/analytics/trackProjectAnalytics",["src/analytics/Analytics","src/events/projectEvents","src/events/globalEventNames"],function(Analytics,projectEvents,globalEventNames){"use strict";var PROJECT_EVENT_NAMES=globalEventNames.PROJECTS;return function trackProjectEvents(){projectEvents.on(PROJECT_EVENT_NAMES.PROJECT_CHANGE,function trackProjectChangeEvent(data){Analytics.trackMixpanelEvent(PROJECT_EVENT_NAMES.PROJECT_CHANGE,{oldProject:data.oldProjectId,newProject:data.newProjectId});Analytics.logMetric(PROJECT_EVENT_NAMES.PROJECT_CHANGE)})}});define("src/analytics/trackQueryAnalytics",["src/globals/me","src/globals/currentProject","src/analytics/Analytics","src/events/queryEvents","src/events/globalEventNames"],function(me,currentProject,Analytics,queryEvents,globalEventNames){"use strict";var QUERY_EVENT_NAMES=globalEventNames.QUERIES;function buildMixpanelData(query){var client=me.get("client");return{queryId:query.get("id"),queryType:query.get("type"),projectId:query.get("projectId")||currentProject.id,salesForceId:client.salesForceId,theme:client.theme}}return function trackQueryEvents(){queryEvents.on(QUERY_EVENT_NAMES.QUERY_BUILDER_OPEN,function trackQueryBuilderEvent(data){Analytics.trackMixpanelEvent(QUERY_EVENT_NAMES.QUERY_BUILDER_OPEN,data);Analytics.logMetric(QUERY_EVENT_NAMES.QUERY_BUILDER_OPEN)});queryEvents.on(QUERY_EVENT_NAMES.QUERY_BUILDER_CLOSE,function trackQueryBuilderEvent(data){Analytics.trackMixpanelEvent(QUERY_EVENT_NAMES.QUERY_BUILDER_CLOSE,data);Analytics.logMetric(QUERY_EVENT_NAMES.QUERY_BUILDER_CLOSE)});queryEvents.on(QUERY_EVENT_NAMES.QUERY_EXAMPLES_SHOWN,function(data){Analytics.trackMixpanelEvent(QUERY_EVENT_NAMES.QUERY_EXAMPLES_SHOWN,data)});queryEvents.on(QUERY_EVENT_NAMES.QUERY_BUILDER_TAB_SHOWN,function trackQueryBuilderEvent(data){Analytics.trackMixpanelEvent(QUERY_EVENT_NAMES.QUERY_BUILDER_TAB_SHOWN,data);Analytics.logMetric(QUERY_EVENT_NAMES.QUERY_BUILDER_TAB_SHOWN)});queryEvents.on(QUERY_EVENT_NAMES.QUERY_BUILDER_TESTSEARCH_USED,function trackQueryBuilderEvent(data){Analytics.trackMixpanelEvent(QUERY_EVENT_NAMES.QUERY_BUILDER_TESTSEARCH_USED,data);Analytics.logMetric(QUERY_EVENT_NAMES.QUERY_BUILDER_TESTSEARCH_USED)});queryEvents.on(QUERY_EVENT_NAMES.QUERY_BUILDER_TESTSEARCH_TOPICS_VIEW_SWITCHED,function trackQueryBuilderEvent(data){Analytics.trackMixpanelEvent(QUERY_EVENT_NAMES.QUERY_BUILDER_TESTSEARCH_TOPICS_VIEW_SWITCHED,data)});queryEvents.on(QUERY_EVENT_NAMES.QUERY_BUILDER_TESTSEARCH_TOPIC_CLICKED,function trackQueryBuilderEvent(data){Analytics.trackMixpanelEvent(QUERY_EVENT_NAMES.QUERY_BUILDER_TESTSEARCH_TOPIC_CLICKED,data)});queryEvents.on(QUERY_EVENT_NAMES.QUERY_BUILDER_TESTSEARCH_TOPIC_RESULTS_BACK_BUTTON_CLICKED,function trackQueryBuilderEvent(data){Analytics.trackMixpanelEvent(QUERY_EVENT_NAMES.QUERY_BUILDER_TESTSEARCH_TOPIC_RESULTS_BACK_BUTTON_CLICKED,data)});queryEvents.on(QUERY_EVENT_NAMES.QUERY_LOCKED,function trackQueryLockingEvent(data){Analytics.trackMixpanelEvent(QUERY_EVENT_NAMES.QUERY_LOCKED,data);Analytics.logMetric(QUERY_EVENT_NAMES.QUERY_LOCKED)});queryEvents.on(QUERY_EVENT_NAMES.QUERY_UNLOCKED,function trackQueryLockingEvent(data){Analytics.trackMixpanelEvent(QUERY_EVENT_NAMES.QUERY_UNLOCKED,data);Analytics.logMetric(QUERY_EVENT_NAMES.QUERY_UNLOCKED)});queryEvents.on(QUERY_EVENT_NAMES.QUERY_CREATE,function trackQueryChangeEvent(data){Analytics.trackMixpanelEvent(QUERY_EVENT_NAMES.QUERY_CREATE,buildMixpanelData(data));Analytics.logMetric(QUERY_EVENT_NAMES.QUERY_CREATE)});queryEvents.on(QUERY_EVENT_NAMES.QUERY_CHANGE,function trackQueryChangeEvent(data){Analytics.trackMixpanelEvent(QUERY_EVENT_NAMES.QUERY_CHANGE,buildMixpanelData(data));Analytics.logMetric(QUERY_EVENT_NAMES.QUERY_CHANGE)});queryEvents.on(QUERY_EVENT_NAMES.QUERY_DESTROY,function trackQueryDestroyEvent(data){Analytics.trackMixpanelEvent(QUERY_EVENT_NAMES.QUERY_DESTROY,buildMixpanelData(data));Analytics.logMetric(QUERY_EVENT_NAMES.QUERY_DESTROY)});queryEvents.on(QUERY_EVENT_NAMES.QUERY_REAUTH,function trackQueryReauthEvent(data){Analytics.trackMixpanelEvent(QUERY_EVENT_NAMES.QUERY_REAUTH,data);Analytics.logMetric(QUERY_EVENT_NAMES.QUERY_REAUTH)})}});define("src/events/signalsEvents",["underscore","backbone"],function(_,Backbone){"use strict";return _.clone(Backbone.Events)});define("src/analytics/trackSignalsAnalytics",["underscore","src/analytics/Analytics","src/events/signalsEvents","src/events/globalEventNames"],function(_,Analytics,signalsEvents,globalEventNames){"use strict";var SIGNAL_EVENT_NAMES=globalEventNames.SIGNALS;return function trackSignalsEvents(){signalsEvents.on(SIGNAL_EVENT_NAMES.SIGNAL_CREATED,function trackHubCreatedEvent(data){Analytics.trackMixpanelEvent(SIGNAL_EVENT_NAMES.SIGNAL_CREATED,_(data).pick("projectId","hubId","queryIds","subscribersCount"))});signalsEvents.on(SIGNAL_EVENT_NAMES.SIGNAL_DELETED,function trackHubDeletedEvent(data){Analytics.trackMixpanelEvent(SIGNAL_EVENT_NAMES.SIGNAL_DELETED,_(data).pick("projectId","hubId","queryIds","subscribersCount"))});signalsEvents.on(SIGNAL_EVENT_NAMES.SIGNAL_UPDATED,function trackHubUpdatedEvent(data){Analytics.trackMixpanelEvent(SIGNAL_EVENT_NAMES.SIGNAL_UPDATED,_(data).pick("projectId","hubId","queryIds","subscribersCount"))})}});define("src/events/reportsEvents",["backbone","underscore"],function(Backbone,_){"use strict";return _.clone(Backbone.Events)});define("src/extensions/reports/globalReportsEventNames",[],function(){"use strict";return{SCHEDULES:{CREATED:"reports:scheduleCreated",UPDATED:"reports:scheduleUpdated",DELETED:"reports:scheduleDeleted"}}});define("src/analytics/trackReportsAnalytics",["src/analytics/Analytics","src/events/reportsEvents","src/extensions/reports/globalReportsEventNames"],function(Analytics,reportsEvents,globalReportsEventNames){"use strict";return function trackReportsEvents(){var scheduleEventNames=globalReportsEventNames.SCHEDULES;function getMixpanelData(scheduleData){var mixpanelData={};if(!scheduleData){return mixpanelData}mixpanelData.scheduleId=scheduleData.scheduleId;mixpanelData.projectId=scheduleData.projectId;mixpanelData.reportType=scheduleData.reportType;if(scheduleData.queryData){mixpanelData.projectId=scheduleData.queryData.projectId;mixpanelData.queryId=scheduleData.queryData.queryId}if(scheduleData.interval){mixpanelData.intervalType=scheduleData.interval.type;mixpanelData.startDate=scheduleData.interval.startDate}return mixpanelData}function listenToEvent(eventName){reportsEvents.on(eventName,function(data){var mixpanelData=getMixpanelData(data);Analytics.trackMixpanelEvent(eventName,mixpanelData,{ignore:{ignoredKeys:["scheduleId","startDate"]}})})}listenToEvent(scheduleEventNames.CREATED);listenToEvent(scheduleEventNames.UPDATED);listenToEvent(scheduleEventNames.DELETED)}});define("src/models/ComponentModel",["backbone"],function(Backbone){"use strict";return Backbone.Model.extend({constructor:function ComponentModel(){Backbone.Model.apply(this,arguments);var settings=this.get("settings")||{};delete settings.optionsDisplayed}})});define("src/models/ComponentCollection",["backbone","src/models/ComponentModel"],function(Backbone,ComponentModel){"use strict";return Backbone.Collection.extend({model:ComponentModel,removeAllAnnotations:function removeAllAnnotations(){this.models.forEach(function(model){model.unset("annotation")})}})});define("src/models/Tab",["backbone","underscore","src/globals/currentProject","src/models/ComponentCollection"],function(Backbone,_,currentProject,ComponentCollection){"use strict";function keepComponentsAttributeUpdated(){if(this.settingComponents){return}this.settingComponents=true;this.set({components:this.components.toJSON()});this.settingComponents=false}function keepComponentsCollectionUpdated(){var components=this.get("components"),collection=this.components;if(!this.settingComponents&&components&&collection){_(components).forEach(function(tab,i){var tabModel=collection.at(i);if(!tabModel){return collection.add(tab)}tabModel.set(tab)})}while(collection.size()>components.length){collection.remove(collection.last().cid)}}function updateTabSettings(model,attrs){model.set({settings:_.extend({},model.get("settings"),attrs)},{silent:true})}return Backbone.Model.extend({defaults:function defaults(){return{settings:{}}},constructor:function TabModel(attrs){Backbone.Model.apply(this,arguments);this.components=new ComponentCollection(attrs&&attrs.components);this.set({id:attrs&&attrs.id||this.id||"Tab_"+((new Date).getTime()+_.uniqueId())},{silent:true});this.components.on("add remove change reset",keepComponentsAttributeUpdated,this);this.on("change:components",keepComponentsCollectionUpdated,this)},updateGlobalControls:function updateGlobalControls(attrs){this.settingComponents=true;this.components.each(function(component){var settings=component.get("settings");if(settings.start){settings.start=1}component.set({settings:_.extend({},settings,attrs)})});this.settingComponents=false;updateTabSettings(this,attrs);keepComponentsAttributeUpdated.call(this)},validate:function validate(attrs){if(!attrs){return null}var errors={},name=(attrs.name||"").trim();if(!name){errors.name="Tab must have a name"}return _(errors).keys().length?errors:null},getTimezone:function getTimezone(){return this.get("tabTimezone")||currentProject.getTimezone()}})});define("src/models/TabCollection",["backbone","underscore","src/models/Tab"],function(Backbone,_,Tab){"use strict";function usesOldOrdering(tabs){return _(tabs).any(function(tab){return tab.settings&&tab.settings["view.order"]!==undefined})}return Backbone.Collection.extend({model:Tab,parse:function parse(tabs){if(!usesOldOrdering(tabs)){return tabs}return _(tabs).chain().sortBy(function(tab){return tab.settings&&tab.settings["view.order"]||0}).map(function(tab){if(tab.settings&&tab.settings["view.order"]!==undefined){delete tab.settings["view.order"]}return tab}).value()}})});(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==="object"&&typeof module==="object")module.exports=factory(require("moment-timezone"),require("underscore"));else if(typeof define==="function"&&define.amd)define("bw-fe-helpers/isoDateHelper",["moment-timezone","underscore"],factory);else{var a=typeof exports==="object"?factory(require("moment-timezone"),require("underscore")):factory(root["moment-timezone"],root["underscore"]);for(var i in a)(typeof exports==="object"?exports:root)[i]=a[i]}})(this,function(__WEBPACK_EXTERNAL_MODULE__0__,__WEBPACK_EXTERNAL_MODULE__1__){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=5)}([function(module,exports){module.exports=__WEBPACK_EXTERNAL_MODULE__0__},function(module,exports){module.exports=__WEBPACK_EXTERNAL_MODULE__1__},,,,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var underscore__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1);var underscore__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(underscore__WEBPACK_IMPORTED_MODULE_0__);var moment_timezone__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(0);var moment_timezone__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(moment_timezone__WEBPACK_IMPORTED_MODULE_1__);var ISO_DATE_REGEX=/^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}(\.[0-9]{3})?(Z|[+-]\d{2}:?\d{2})$/,ISO_DATE_RANGE_REGEX=/^P([0-9]+Y)?([0-9]+M)?([0-9]+W)?([0-9]+D)?T?([0-9]+H)?([0-9]+M)?([0-9]+S)?$/,UTC_TIMEZONE="UTC";__webpack_exports__["default"]={today:function today(options){options=options||{};var timezone=options.timezone||UTC_TIMEZONE;return moment_timezone__WEBPACK_IMPORTED_MODULE_1___default.a.tz(timezone).startOf("day").toISOString()},isISODate:function isISODate(str){return ISO_DATE_REGEX.test(str)},isISODateRange:function isISODateRange(str){var parts=str&&str.split("/");if(!parts){return false}return parts.length===2&&this.isISODate(parts[0])&&this.isISODate(parts[1])},isISODatePeriod:function isISODatePeriod(str){return ISO_DATE_RANGE_REGEX.test(str)},parseISODateRange:function parseISODateRange(str,options){if(!this.isISODateRange(str)){throw new Error(str+" is not an ISO range string")}var parts=str.split("/");if(options&&options.timezone){return{startDate:moment_timezone__WEBPACK_IMPORTED_MODULE_1___default.a.utc(parts[0]).tz(options.timezone).format(),endDate:moment_timezone__WEBPACK_IMPORTED_MODULE_1___default.a.utc(parts[1]).tz(options.timezone).format()}}return{startDate:moment_timezone__WEBPACK_IMPORTED_MODULE_1___default.a.utc(parts[0]).toISOString(),endDate:moment_timezone__WEBPACK_IMPORTED_MODULE_1___default.a.utc(parts[1]).toISOString()}},parseISODatePeriod:function parseISODatePeriod(str){var period=ISO_DATE_RANGE_REGEX.exec(str);return{y:parseInt(period&&period[1],10)||0,M:parseInt(period&&period[2],10)||0,w:parseInt(period&&period[3],10)||0,d:parseInt(period&&period[4],10)||0,h:parseInt(period&&period[5],10)||0,m:parseInt(period&&period[6],10)||0,s:parseInt(period&&period[7],10)||0}},makeISODateRange:function makeISODateRange(date1,date2,options){if(options&&options.timezone){return moment_timezone__WEBPACK_IMPORTED_MODULE_1___default.a.utc(date1).tz(options.timezone).format()+"/"+moment_timezone__WEBPACK_IMPORTED_MODULE_1___default.a.utc(date2).tz(options.timezone).format()}return moment_timezone__WEBPACK_IMPORTED_MODULE_1___default.a.utc(date1).toISOString()+"/"+moment_timezone__WEBPACK_IMPORTED_MODULE_1___default.a.utc(date2).toISOString()},makeISODatePeriod:function makeISODatePeriod(date1,date2){var daysDiff,hoursDiff,minutesDiff;if(!date2&&underscore__WEBPACK_IMPORTED_MODULE_0___default.a.isNumber(date1)){return"P"+date1+"D"}daysDiff=moment_timezone__WEBPACK_IMPORTED_MODULE_1___default()(date2).diff(date1,"d");hoursDiff=moment_timezone__WEBPACK_IMPORTED_MODULE_1___default()(date2).diff(date1,"h");minutesDiff=moment_timezone__WEBPACK_IMPORTED_MODULE_1___default()(date2).diff(date1,"m");if(daysDiff){return"P"+daysDiff+"D"}if(hoursDiff){return"PT"+hoursDiff+"H"}if(minutesDiff){return"PT"+minutesDiff+"M"}},isLessThanOneDay:function isLessThanOneDay(datePeriod){var period=this.parseISODatePeriod(datePeriod);if(period.y||period.M||period.w||period.d){return false}return true},getStartAndEndDateForPeriod:function getStartAndEndDateForPeriod(period,options){options=options||{};var timezone=options.timezone||UTC_TIMEZONE;var referenceDate=moment_timezone__WEBPACK_IMPORTED_MODULE_1___default.a.tz(timezone);var periodObject=this.parseISODatePeriod(period);if(!this.isLessThanOneDay(period)){referenceDate.startOf("day").add({d:1})}return{startDate:referenceDate.clone().subtract(periodObject).toISOString(),endDate:referenceDate.toISOString()}},extractStartEndDates:function extractStartEndDates(rangeOrPeriod,options){if(this.isISODatePeriod(rangeOrPeriod)){return this.getStartAndEndDateForPeriod(rangeOrPeriod,options)}if(this.isISODateRange(rangeOrPeriod)){return this.parseISODateRange(rangeOrPeriod,options)}throw new Error("Argument is not an ISO8601 date range or period")},convertToISODateRange:function convertToISODateRange(period,options){var timezone=options&&options.timezone;var dates=this.extractStartEndDates(period,options);return this.makeISODateRange(dates.startDate,dates.endDate,timezone==="UTC"?undefined:options)},convertToISODatePeriod:function convertToISODatePeriod(dateRange){var dates=this.extractStartEndDates(dateRange);return this.makeISODatePeriod(dates.startDate,dates.endDate)}}}])["default"]});define("src/controls/lib/validationHelpers",["underscore"],function(_){"use strict";return{isNumericRegex:/^-?\d+$/,isPositiveNumberRegex:/^[0-9]*$/,isNullOrEmptyString:function isNullOrEmptyString(str){return!str||!_.isString(str)||!_(str).trim()},isInvalidString:function isInvalidString(str){return!this.isNullOrEmptyString(str)&&(str.indexOf("\\")>-1||str.indexOf('"')>-1)},isNumeric:function isNumeric(num){return this.isNumericRegex.test(num)},isPositiveNumber:function isPositiveNumber(num){return this.isPositiveNumberRegex.test(num)}}});define("src/controls/Controls",["underscore","backbone","bw-fe-helpers/dateHelper","bw-fe-helpers/isoDateHelper","src/globals/flags","src/globals/flagNames","src/controls/lib/validationHelpers","moment"],function(_,Backbone,dateHelper,isoDateHelper,flags,FLAGS,validationhelpers,moment){"use strict";function isEmpty(value){return value===undefined||value===null||value===""||_.isArray(value)&&!value.length}function validateNumber(valueToValidate){return isEmpty(valueToValidate)||validationhelpers.isNumeric(valueToValidate)}function validatePositiveNumber(valueToValidate){return isEmpty(valueToValidate)||validationhelpers.isPositiveNumber(valueToValidate)}function validateArray(valueToValidate,required){if(!_.isArray(valueToValidate)){return false}if(required&&!valueToValidate.length){return false}return true}function validateItem(valueToValidate,spec,attrs){var required=spec.required,valid=true,typeValidators={number:validateNumber,array:validateArray,positiveNumber:validatePositiveNumber};if(spec.lessThan){valid=valid&&validateMinMaxValues(valueToValidate,attrs[spec.lessThan])}if(spec.greaterThan){valid=valid&&validateMinMaxValues(attrs[spec.greaterThan],valueToValidate)}if(spec.maximumValue){valid=valid&&validateMax(valueToValidate,spec.maximumValue)}if(isEmpty(valueToValidate)&&required){valid=false}if(_.isArray(spec.type)){valid=valid&&spec.type.some(function(type){return typeValidators[type].call(null,valueToValidate,required)});return valid}if(spec.type&&typeValidators[spec.type]){valid=valid&&typeValidators[spec.type].call(null,valueToValidate,required)}return valid}function validateMinMaxValues(min,max){var minValue=parseInt(min,10),maxValue=parseInt(max,10);if(minValue>maxValue){return false}return true}function validateMax(valueToValidate,max){var value=parseInt(valueToValidate,10),maxValue=parseInt(max,10);return value<=maxValue}function validateDateRange(dateRange){if(isoDateHelper.isISODatePeriod(dateRange)){return true}var dateRangeValues=isoDateHelper.extractStartEndDates(dateRange);if(!dateRangeValues||dateRangeValues.startDate>dateRangeValues.endDate){return false}if(moment(dateRangeValues.startDate).unix()<0){return false}if(moment(dateRangeValues.endDate).unix()<0){return false}return true}function addDateRange(data,options){var dateRange;if(isoDateHelper.isISODatePeriod(data.dateRange)){dateRange=isoDateHelper.extractStartEndDates(data.dateRange,{timezone:options.timezone})}else{dateRange=isoDateHelper.extractStartEndDates(data.dateRange)}delete data.dateRange;if(!dateRange){return}data.startDate=dateRange.startDate;data.endDate=dateRange.endDate}function replaceTimezoneOffset(dateTime,newTimezone){var ISOString=moment.parseZone(dateTime).format("YYYY-MM-DDTHH:mm:ss.000");var offset=moment.tz(ISOString,newTimezone).format("Z");if(newTimezone==="UTC"){offset="Z"}return ISOString+offset}function addFilter(options,dimension,timezone){var existingDateRange=isoDateHelper.extractStartEndDates(options.dateRange),startDate,endDate;if(_.isUndefined(dimension.value)||dimension.value===null){return}switch(dimension.name.toLowerCase()){case"day":case"days":case"week":case"weeks":case"month":case"months":case"hour":case"hours":case"minute":case"minutes":startDate=moment.tz(dimension.value,timezone);endDate=moment.tz(dimension.value,timezone);break}switch(dimension.name.toLowerCase()){case"day":case"days":endDate=endDate.add({d:1});break;case"week":case"weeks":endDate=endDate.add({d:7});break;case"month":case"months":endDate=endDate.add({M:1});break;case"hour":case"hours":endDate=endDate.add({h:1});break;case"minute":case"minutes":endDate=endDate.add({m:1});break;case"page type":case"pagetype":case"sitetype":options.pageType=dimension.value.toLowerCase();break;case"account type":options.accountType=dimension.value.toLowerCase();break;case"sentiment":options.sentiment=dimension.value.toLowerCase();break;case"query":options.queryId=parseInt(dimension.value,10);options.queryName="";break;case"querygroupid":options.queryGroupId=parseInt(dimension.value,10);break;case"mozrank":options.mozRankMin=parseInt(dimension.value,10);options.mozRankMax=parseInt(dimension.value,10)+1;break;case"category":if(options.category&&Array.isArray(options.category)){options.category=_(options.category.concat(dimension.value)).map(function(catId){return parseInt(catId,10)})}else{options.category=_([].concat(dimension.value)).map(function(catId){return parseInt(catId,10)})}break;case"parentcategory":options.parentCategory=[].concat(options.parentCategory,dimension.value).filter(Boolean).map(function(catId){return parseInt(catId,10)});break;case"tag":if(options.tag&&Array.isArray(options.tag)){options.tag=_(options.tag.concat(dimension.value)).map(function(tagId){return parseInt(tagId,10)})}else{options.tag=_([].concat(dimension.value)).map(function(tagId){return parseInt(tagId,10)})}break;case"lang":case"langcode":options.language=dimension.value.toLowerCase();break;case"fixeddaterange":case"optionsdisplayed":return;case"cat":options.category=(options.category||[]).concat(dimension.value);break;case"xcat":options.xcategory=(options.xcategory||[]).concat(dimension.value);break;case"followersmin":options.twitterFollowersMin=dimension.value;break;case"facebookrole":options.facebookRole=dimension.value;break;case"resourcetype":options.resourceType=dimension.value;break;case"xresourcetype":options.xresourceType=dimension.value;break;case"facebooksubtype":options.facebookSubtype=dimension.value;break;case"kredinfluencemin":options.influenceMin=dimension.value;break;default:options[dimension.name[0].toLowerCase()+dimension.name.substring(1)]=dimension.value}if(startDate&&endDate){if(existingDateRange&&startDate.diff(existingDateRange.startDate)<0){startDate=moment.utc(existingDateRange.startDate)}if(existingDateRange&&endDate.diff(existingDateRange.endDate)>0){endDate=moment.utc(existingDateRange.endDate)}if(endDate.diff(startDate)<0){endDate=startDate}options.dateRange=isoDateHelper.makeISODateRange(startDate.toISOString(),endDate.toISOString())}}function fixDates(model,attrs){if(!attrs.startDate&&!attrs.endDate&&!attrs.dateRange){return}if(attrs.dateRange&&attrs.dateRange.indexOf(" ")===-1&&attrs.dateRange.toLowerCase()!=="today"){delete attrs.startDate;delete attrs.endDate;delete attrs.fixedDateRange;return}var startDate=model.get("startDate"),endDate=model.get("endDate"),dates,fixedDateRange=_.isBoolean(attrs.fixedDateRange)?attrs.fixedDateRange:model.get("fixedDateRange");if(fixedDateRange!==false){fixedDateRange=true}if(attrs.dateRange){dates=dateHelper.parseDateRange(attrs.dateRange)||{};startDate=dates.start||attrs.startDate;endDate=dates.end||attrs.endDate}else{startDate=dateHelper.parse(attrs.startDate||startDate);endDate=dateHelper.parse(attrs.endDate||endDate)}startDate=moment.utc(startDate);endDate=moment.utc(endDate);delete attrs.startDate;delete attrs.endDate;delete attrs.fixedDateRange;if(startDate.hour()>12){startDate.add({d:1})}if(endDate.hour()>12){endDate.add({d:1})}startDate.hour(0);endDate.hour(0);if(fixedDateRange){attrs.dateRange=isoDateHelper.makeISODateRange(startDate.toISOString(),endDate.add({d:1}).toISOString())}else{attrs.dateRange=isoDateHelper.makeISODatePeriod(startDate.toISOString(),endDate.add({d:1}).toISOString())}}function cleanQueryGroups(attrs){if(attrs.queryGroupId){delete attrs.queryGroupId}if(attrs.currentMode){delete attrs.currentMode}}function generateMinMaxSpec(propName){var config=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var spec={};config.type="positiveNumber";spec[propName+"Max"]=_.extend(config,{greaterThan:propName+"Min"});spec[propName+"Min"]=_.extend(config,{lessThan:propName+"Max"});return spec}return Backbone.Model.extend({constructor:function Controls(attrs,options){options=options||{};this.timezone=options.timezone||"UTC";this.supportsQueryGroups=this.supportsQueryGroups||options.supportsQueryGroups;Backbone.Model.apply(this,arguments)},defaults:function defaults(){return{dateRange:isoDateHelper.makeISODatePeriod(7),specifyTime:false}},clone:function clone(){return new this.constructor(this.attributes,{timezone:this.timezone})},parseQueryId:function parseQueryId(attrs){if(attrs.queryId&&/^[0-9]+$/.test(attrs.queryId)){attrs.queryId=parseInt(attrs.queryId,10)}},set:function set(key,value,options){var attrs;var newTimezone=this.timezone;if(_.isObject(key)||!key){attrs=key;options=value}else{attrs={};attrs[key]=value}fixDates(this,attrs);this.parseQueryId(attrs);if(!this.supportsQueryGroups&&(!options||!options.supportsQueryGroups)){cleanQueryGroups(attrs)}attrs=this.cleanAttributes(attrs);if(attrs.dateRange&&!attrs.specifyTime){attrs.dateRange=attrs.dateRange.split("/").map(function(dateTime){if(/Z$/.test(dateTime)){var date=moment.utc(dateTime);if(date.hours()<12){return date.hours(0).minutes(0).toISOString()}else{return date.add({d:1}).hours(0).minutes(0).toISOString()}}return dateTime}).join("/")}if(attrs.dateRange&&isoDateHelper.isISODateRange(attrs.dateRange)){attrs.dateRange=attrs.dateRange.split("/").map(function(dateTime){return replaceTimezoneOffset(dateTime,newTimezone)}).join("/")}return Backbone.Model.prototype.set.call(this,attrs,options)},cleanAttributes:function cleanAttributes(attrs){return attrs},dataSpec:function dataSpec(){var enableReachMetric=flags.variation(FLAGS.ENABLE_REACH_METRIC);var features={};if(enableReachMetric){features=generateMinMaxSpec("reachEstimate")}var spec=_.extend({},generateMinMaxSpec("averageDurationOfVisit"),generateMinMaxSpec("averageVisits"),generateMinMaxSpec("backlinks"),generateMinMaxSpec("blogComments"),generateMinMaxSpec("forumPosts"),generateMinMaxSpec("forumViews"),generateMinMaxSpec("impact"),generateMinMaxSpec("impressions"),generateMinMaxSpec("influence"),generateMinMaxSpec("monthlyVisitors"),generateMinMaxSpec("mozRank",{max:10,min:0}),generateMinMaxSpec("outreach",{max:12,min:0}),generateMinMaxSpec("pagesPerVisit"),generateMinMaxSpec("reach"),generateMinMaxSpec("twitterFollowers"),generateMinMaxSpec("twitterFollowing"),generateMinMaxSpec("twitterPostCount"),generateMinMaxSpec("twitterRetweets"),generateMinMaxSpec("instagramFollowing"),generateMinMaxSpec("instagramFollowers"),generateMinMaxSpec("instagramPosts"),generateMinMaxSpec("instagramInteractions"),generateMinMaxSpec("instagramComments"),features);spec.dateRange={required:true};spec.twitterVerified={type:"boolean"};if(this.get("currentMode")==="queryGroup"){spec.queryGroupId={required:true}}else{spec.queryId={required:true,type:["positiveNumber","array"]}}return spec},validate:function validate(attrs){var self=this;var errors=[];var dataSpec=this.dataSpec;if(_.isFunction(dataSpec)){dataSpec=dataSpec.call(this,attrs)}_(dataSpec).each(function(spec,key){var valueToValidate=attrs[key];var isKeyMissingFromAttrs=!(key in attrs);if(isKeyMissingFromAttrs){if(!spec.required||!isEmpty(self.get(key))){return}}if(!validateItem(valueToValidate,spec,attrs)){errors.push(key)}});if(attrs.dateRange&&!validateDateRange(attrs.dateRange)){errors.push("dateRange")}return errors.length?errors:null},getQueryDataFieldNames:function getQueryDataFieldNames(){var enableReachMetric=flags.variation(FLAGS.ENABLE_REACH_METRIC);var features=[];if(enableReachMetric){features.push("reachEstimateMin");features.push("reachEstimateMax")}return["queryId","queryGroupId","startDate","endDate","sinceId","untilId","sinceAdded","untilAdded","sourceType","author","xauthor","language","xlanguage","profession","xprofession","interest","xinterest","gender","accountType","exactAuthor","sentiment","classifications","xclassifications","pageType","xpageType","siteGroup","authorGroup","authorLocation","xauthorLocation","authorLocationGroup","xauthorLocationGroup","locationGroup","location","exclusiveLocation","backlinksMax","backlinksMin","blogCommentsMax","blogCommentsMin","pagesPerVisitMax","pagesPerVisitMin","averageVisitsMax","averageVisitsMin","monthlyVisitorsMax","monthlyVisitorsMin","percentFemaleVisitorsMin","percentMaleVisitorsMin","averageDurationOfVisitMin","averageDurationOfVisitMax","twitterFollowersMax","twitterFollowersMin","twitterFollowingMax","twitterFollowingMin","twitterRole","twitterVerified","forumPostsMax","forumPostsMin","forumViewsMax","forumViewsMin","mozRankMax","mozRankMin","twitterRetweetsMax","twitterRetweetsMin","twitterPostCountMax","twitterPostCountMin","impressionsMin","impressionsMax","reachMin","reachMax","influenceMin","influenceMax","outreachMin","outreachMax","xexactAuthor","xsiteGroup","xauthorGroup","xlocationGroup","xlocation","category","xcategory","status","xstatus","priority","xpriority","assigned","xassigned","tag","xtag","parentCategory","xparentCategory","checked","starred","search","language","xlanguage","domain","xdomain","threadId","threadUrl","xthreadUrl","xthreadId","threadEntryType","xthreadEntryType","insightsEmoticon","insightsHashtag","insightsMentioned","insightsUrl","xinsightsEmoticon","xinsightsHashtag","xinsightsMentioned","xinsightsUrl","twitterReplyTo","xtwitterReplyTo","twitterRetweetOf","xtwitterRetweetOf","threadAuthor","xthreadAuthor","twitterAuthorId","xtwitterAuthorId","postByAuthor","xpostByAuthor","shareOfAuthor","xshareOfAuthor","replyToAuthor","xreplyToAuthor","hourOfDay","dayOfWeek","impactMin","impactMax","instagramFollowingMax","instagramFollowingMin","instagramFollowersMax","instagramFollowersMin","instagramPostsMax","instagramPostsMin","instagramInteractionsMax","instagramInteractionsMin","instagramLikesMax","instagramLikesMin","instagramCommentsMax","instagramCommentsMin","instagramInteractionsMax","instagramInteractionsMin","subtype","instagramUserRole","logoVersions","xlogoVersions","resourceType","xresourceType"].concat(features)},getQueryData:function getQueryData(){var modelJson=this.toJSON(),queryData;addDateRange(modelJson,{timezone:this.timezone});queryData=_(this.getQueryDataFieldNames().sort()).reduce(function(memo,key){if(!isEmpty(modelJson[key])){memo[key]=_.clone(modelJson[key])}return memo},{});return queryData},getQueryDataForExport:function getQueryDataForExport(){return this.getQueryData()},toJSONSubset:function toJSONSubset(filters){var json=this.toJSON();var self=this;json.dateRange=isoDateHelper.convertToISODateRange(json.dateRange,{timezone:this.timezone});_(filters).each(function(value,key){addFilter(json,{name:key,value:value},self.timezone)});return json}})});define("src/models/Category",["backbone","underscore","jquery"],function(Backbone,_,$){"use strict";function includesComma(text){return text&&text.indexOf(",")!==-1}function getProjectId(model){var projectId=model.get("projectId");if(!projectId){projectId="{projectId}"}return projectId}return Backbone.Validations.Model.extend({defaults:function defaults(){return{name:"",children:[],multiple:true}},url:function url(){return"/projects/"+getProjectId(this)+"/categories/"+(this.id||"")},validate:function validate(attrs){if(!attrs){return null}var errors={},catname=(attrs.name||"").trim(),childname,subCatUnique,emptySubcats,commaSubcats;emptySubcats=_(attrs.children).any(function(child){childname=(child.name||"").trim();return!childname});commaSubcats=_(attrs.children).any(function(child){return includesComma((child.name||"").trim())});subCatUnique=_(attrs.children).uniq(false,function(child){return child.name.toLowerCase()});if(!catname){errors.name="Category must have a name"}if(includesComma(catname)){errors.name="Category name must not contain commas"}if(!attrs.children.length){errors.subcategories="Category must have at least one Subcategory"}else if(emptySubcats){errors.subcategories="Subcategories must have a name"}else if(commaSubcats){errors.subcategories="Subcategory names must not include commas"}else if(subCatUnique.length!==attrs.children.length){errors.subcategories="Subcategory names must be unique."}return _(errors).keys().length?errors:null},sync:function sync(method,model,options){if(method==="delete"){options.data=model.toJSON()}return Backbone.sync(method,model,options)},copyToProject:function copyToProject(options){var Workbench=require("src/Workbench");if(!this.id){throw new Error("Cannot copy an unsaved category!")}if(!options.destProject){throw new Error("Cannot copy without a target project!")}_.extend(options,{type:"POST",dataType:"json",contentType:"application/json",url:Workbench.buildApiUrl("/projects/"+getProjectId(this)+"/categories/"+this.id+"/copy"),data:JSON.stringify({destinationProjectId:options.destProject})});delete options.destProject;$.ajax(options)}})});define("src/models/CategoryCollection",["backbone","underscore","src/models/Category"],function(Backbone,_,Category){"use strict";function getFlatCategories(collection){collection.flatCategories=collection.flatCategories||flattenCategories(collection);return collection.flatCategories}function invalidateFlatCategories(collection){collection.flatCategories=undefined}function flattenCategories(collection){return collection.reduce(function(memo,element){memo[element.id]=element.toJSON();element.get("children").forEach(function(element){memo[element.id]=element});return memo},{})}return Backbone.Collection.extend({model:Category,initialize:function initialize(options){options=options||{};this.projectId=options.projectId;this.on("all",_.partial(invalidateFlatCategories,this))},url:function url(){if(!this.projectId){throw new Error("Cannot fetch categories without a projectId")}return"/projects/"+(this.projectId||"")+"/categories"},parse:function parse(data){return _(data.results).map(function(result){delete result.order;return result})},getByName:function getByName(name){return this.detect(function(cat){return cat.get("name")===name})},getCategoryOrdering:function getCategoryOrdering(id){return getFlatCategories(this)[id]&&getFlatCategories(this)[id].ordering}})});define("src/globals/categories",["src/globals/currentProject","src/models/CategoryCollection"],function(currentProject,CategoryCollection){"use strict";var categories=new CategoryCollection;currentProject.onLoad(function(callback){categories.projectId=currentProject.id;if(!currentProject.id){categories.reset([],{silent:false});return}categories.reset([],{silent:true});categories.fetch({success:function success(){callback()},error:function error(model,err){callback(err)}})});return categories});define("src/models/Tag",["backbone","underscore"],function(Backbone,_){"use strict";return Backbone.Model.extend({url:function url(){var projectId=this.collection?this.collection.projectId:this.projectId,tagId=this.id;if(!projectId){throw new Error("Cannot fetch tag without a projectId")}return"/projects/{projectId}/tags/"+(tagId?tagId:"")},validate:function validate(attrs){var errors={};if(!attrs.name.trim().length){errors.name="Tag must have a name"}return _(errors).keys().length?errors:null}})});define("src/models/TagCollection",["backbone","underscore","q","src/models/Tag"],function(Backbone,_,Q,Tag){"use strict";function getTagOrderings(collection){if(collection.tagOrderings){return collection.tagOrderings}else{return collection.tagOrderings=orderTags(collection)}}function invalidateTagOrderings(collection){collection.tagOrderings=undefined}function orderTags(collection){var orderedTags=collection.models.sort(function(tagA,tagB){var tagAName=tagA.attributes.name.toString();var tagBName=tagB.attributes.name.toString();return tagAName.toLowerCase()>tagBName.toLowerCase()});return orderedTags.reduce(function(memo,tag,tagIndex){memo[tag.id]=tagIndex;return memo},{})}var TagCollection=Backbone.Collection.extend({model:Tag,initialize:function initialize(){this.on("all",_.partial(invalidateTagOrderings,this))},constructor:function TagCollection(){Backbone.Collection.apply(this,arguments)},url:function url(){if(!this.projectId){throw new Error("Cannot fetch tags without a projectId")}return"/projects/"+this.projectId+"/tags"},parse:function parse(data){return data.results},fetch:function fetch(options){var now=(new Date).getTime(),lastFetch=this._lastFetch;if(!lastFetch||now-lastFetch>1e4){this._lastFetch=now;return Backbone.Collection.prototype.fetch.call(this,options)}if(options){options.success(this,this.toJSON(),options)}return Q(this.toJSON())},reset:function reset(){Backbone.Collection.prototype.reset.apply(this,arguments);if(!this.length){this._lastFetch=undefined}return this},ensureTagExists:function ensureTagExists(tagName,options){var tag=this.getByName(tagName);if(tag){if(options&&options.success){options.success.apply(this,[this,{},options])}return}this.fetch({success:function success(collection){if(!collection.getByName(tagName)){return collection.create({name:tagName},options)}if(options&&options.success){options.success.apply(collection,arguments)}},error:options.error})},getByName:function getByName(tagName){return this.detect(function(tag){return tag.get("name").toLowerCase()===tagName.toLowerCase()})},getTagOrdering:function getTagOrdering(id){return getTagOrderings(this)[id]}});return TagCollection});define("src/globals/tags",["src/globals/currentProject","src/events/tagEvents","src/models/TagCollection"],function(currentProject,tagEvents,TagCollection){"use strict";var tags=new TagCollection;currentProject.onLoad(function(callback){tags.projectId=currentProject.id;if(!currentProject.id){tags.reset([],{silent:false});return}tags.reset([],{silent:true});tags.fetch({success:function success(){callback()},error:function error(model,err){callback(err)}})},tags);tags.on("add",function(model,collection){tagEvents.trigger("tag:add",{model:model,collection:collection})});return tags});define("src/controlsAttributesRewriter",["underscore","src/globals/categories","src/globals/tags","src/globals/workflow"],function(_,categories,globalTags,globalWorkflow){"use strict";var isCategoryRegex=new RegExp("_cat$");function _isEmpty(val){if(val===""||parseInt(val,10)===-1||val===null||_.isUndefined(val)){return true}if(_.isArray(val)&&_.all(val,function(x){return x===""})){return true}return false}function rewriteCatsForApi2(Workbench,cats,attrs){function isCategory(catId){return categories.some(function(category){return category.id===catId||_(category.get("children")).any(function(child){return child.id===catId})})}function isTag(catId){if(catId===-1){return true}return globalTags.some(function(tag){return tag.id===catId})}function getWorkflowChildren(name){return(globalWorkflow.get(name)||{}).children||[]}function isStatus(catId){return _(getWorkflowChildren("status")).any(function(status){return status.id===catId})}function isPriority(catId){return _(getWorkflowChildren("priority")).any(function(cat){return cat.id===catId})}function isAssigned(catId){return _(getWorkflowChildren("assignment")).any(function(cat){return cat.id===catId})}function isChecked(catId){return(globalWorkflow.get("checked")||{}).id===catId||_(getWorkflowChildren("checked")).any(function(cat){return cat.id===catId})}function isParentWorkflow(catId){return _(globalWorkflow.toJSON()).chain().values().pluck("id").value().indexOf(catId)>-1}function getWorkflowChildName(name,catId){return _(getWorkflowChildren(name)).detect(function(child){return child.id===catId}).name}_(cats).chain().unique().reduce(function(attrs,catId){if(isTag(catId)){attrs.tag=(attrs.tag||[]).concat(catId)}else if(isTag(-catId)){attrs.xtag=(attrs.xtag||[]).concat(-catId)}else if(isStatus(catId)){attrs.status=(attrs.status||[]).concat(getWorkflowChildName("status",catId))}else if(isStatus(-catId)){attrs.xstatus=(attrs.xstatus||[]).concat(getWorkflowChildName("status",-catId))}else if(isPriority(catId)){attrs.priority=(attrs.priority||[]).concat(getWorkflowChildName("priority",catId))}else if(isPriority(-catId)){attrs.xpriority=(attrs.xpriority||[]).concat(getWorkflowChildName("priority",-catId))}else if(isAssigned(catId)){attrs.assigned=(attrs.assigned||[]).concat(getWorkflowChildName("assignment",catId))}else if(isAssigned(-catId)){attrs.xassigned=(attrs.xassigned||[]).concat(getWorkflowChildName("assignment",-catId))}else if(isChecked(catId)){attrs.checked=true}else if(isChecked(-catId)){attrs.checked=false}else if(isParentWorkflow(catId)){attrs.parentCategory=(attrs.parentCategory||[]).concat(catId)}else if(isParentWorkflow(-catId)){attrs.xparentCategory=(attrs.xparentCategory||[]).concat(-catId)}else if(isCategory(-catId)){attrs.xcategory=(attrs.xcategory||[]).concat(-catId)}else{attrs.category=(attrs.category||[]).concat(catId)}return attrs},attrs)}function reformatCategories(attrs){var Workbench=require("src/Workbench");var cats=attrs.cat?_([].concat(attrs.cat)).map(function(c){return parseInt(c,10)}):[];var checked=globalWorkflow.get("checked");var anyCatsFound=cats.length;_(attrs).each(function(value,key){if(isCategoryRegex.test(key)){anyCatsFound=true;_([].concat(value)).forEach(function(value){value=parseInt(value,10);if(value===-9999){value=attrs[key.replace(isCategoryRegex,"_xcat")];if(_.isArray(value)){value=value[0]}value=-parseInt(value,10);delete attrs[key.replace(isCategoryRegex,"_xcat")]}if(!isNaN(value)&&!_isEmpty(value)&&cats.indexOf(value)===-1){cats.push(value)}});delete attrs[key]}else if(key==="tags"){anyCatsFound=true;_([].concat(value)).forEach(function(id){var tag=globalTags.detect(function(tag){return tag.get("id")===id});if(id===-1){cats.push(id)}if(tag){anyCatsFound=true;cats.push(tag.id)}});attrs.xtag=attrs.xtag||[];if(attrs.dimension1==="tags"){if(attrs.tags===-1){attrs.xtag=attrs.xtag.concat(attrs.dimension1SelectedTags)}}else if(attrs.dimension2==="tags"){if(attrs.tags===-1){attrs.xtag=attrs.xtag.concat(attrs.dimension2SelectedTags)}}delete attrs[key]}});if(checked&&checked.children&&cats&&cats.length>0){cats=_(cats).map(function(cat){if(cat===-checked.children[0].id){return-checked.id}return cat})}if(!anyCatsFound){return}if(attrs.cat){delete attrs.cat}if(attrs.xcat){delete attrs.xcat}rewriteCatsForApi2(Workbench,cats,attrs)}function fixSortOrder(attrs){if(attrs.direction){attrs.direction=attrs.direction.replace(/ending$/,"")}}function fixExactAuthor(attrs){if(attrs.exactauthor){attrs.exactAuthor=attrs.exactauthor;delete attrs.exactauthor}}function updateOldSiteVisitorsFilters(options){var siteVisitorFilters=["monthlyVisitorsMin","monthlyVisitorsMax","averageVisitsMin","averageVisitsMax","averagePagesMin","averagePagesMax","visitorMinutesMin","visitorMinutesMax","percentMaleMin","percentFemaleMin"];_.each(siteVisitorFilters,function(newFilter){var oldFilter="cs"+newFilter.charAt(0).toUpperCase()+newFilter.slice(1);if(options[oldFilter]){options[newFilter]=options[oldFilter];delete options[oldFilter]}})}function fixOldFilterNames(attrs){if(attrs.siteType){attrs.pageType=attrs.siteType;delete attrs.siteType}if(attrs.exactAuthor===true){attrs.exactAuthor=attrs.author;delete attrs.author}if(attrs.ag){attrs.authorGroup=attrs.ag;delete attrs.ag}if(attrs.xag){attrs.xauthorGroup=attrs.xag;delete attrs.xag}if(attrs.sg){attrs.siteGroup=attrs.sg;delete attrs.sg}if(attrs.xsg){attrs.xsiteGroup=attrs.xsg;delete attrs.xsg}if(attrs.locationgroup){attrs.locationGroup=attrs.locationgroup;delete attrs.locationgroup}if(attrs.xlocationgroup){attrs.xlocationGroup=attrs.xlocationgroup;delete attrs.xlocationgroup}if(attrs.city||attrs.country||attrs.county||attrs.state||attrs.continent){attrs.location=[].concat(attrs.city).concat(attrs.city).concat(attrs.country).concat(attrs.county).concat(attrs.state).concat(attrs.continent);attrs.location=_.unique(_.compact(attrs.location));delete attrs.city;delete attrs.country;delete attrs.county;delete attrs.state;delete attrs.continent}if(attrs.xcity||attrs.xcountry||attrs.xcounty||attrs.xstate||attrs.xcontinent){attrs.xlocation=[].concat(attrs.xcity).concat(attrs.xcity).concat(attrs.xcountry).concat(attrs.xcounty).concat(attrs.xstate).concat(attrs.xcontinent);attrs.xlocation=_.unique(_.compact(attrs.xlocation));delete attrs.xcity;delete attrs.xcountry;delete attrs.xcounty;delete attrs.xstate;delete attrs.xcontinent}if(attrs.averagePagesMax){attrs.pagesPerVisitMax=attrs.averagePagesMax;delete attrs.averagePagesMax}if(attrs.averagePagesMin){attrs.pagesPerVisitMin=attrs.averagePagesMin;delete attrs.averagePagesMin}if(attrs.visitorMinutesMax){attrs.averageDurationOfVisitMax=attrs.visitorMinutesMax;delete attrs.visitorMinutesMax}if(attrs.visitorMinutesMin){attrs.averageDurationOfVisitMin=attrs.visitorMinutesMin;delete attrs.visitorMinutesMin}if(attrs.percentFemaleMin){attrs.percentFemaleVisitorsMin=attrs.percentFemaleMin;delete attrs.percentFemaleMin}if(attrs.percentMaleMin){attrs.percentMaleVisitorsMin=attrs.percentMaleMin;delete attrs.percentMaleMin}if(attrs.followingMin){attrs.twitterFollowingMin=attrs.followingMin;delete attrs.followingMin}if(attrs.followingMax){attrs.twitterFollowingMax=attrs.followingMax;delete attrs.followingMax}if(attrs.followersMin){attrs.twitterFollowersMin=attrs.followersMin;delete attrs.followersMin}if(attrs.followersMax){attrs.twitterFollowersMax=attrs.followersMax;delete attrs.followersMax}if(attrs.mozMin){attrs.mozRankMin=attrs.mozMin;delete attrs.mozMin}if(attrs.mozMax){attrs.mozRankMax=attrs.mozMax;delete attrs.mozMax}if(attrs.retweetsMin){attrs.twitterRetweetsMin=attrs.retweetsMin;delete attrs.retweetsMin}if(attrs.retweetsMax){attrs.twitterRetweetsMax=attrs.retweetsMax;delete attrs.retweetsMax}if(attrs.tweetsMin){attrs.twitterPostCountMin=attrs.tweetsMin;delete attrs.tweetsMin}if(attrs.tweetsMax){attrs.twitterPostCountMax=attrs.tweetsMax;delete attrs.tweetsMax}if(attrs.tagType){attrs["insights"+_.capitalize(attrs.tagType)]=attrs.tagValue;delete attrs.tagType;delete attrs.tagValue}}function fixXCategoryToWorkflowNA(attrs){if(!attrs.xcategory){return attrs}var index,assigned=globalWorkflow.get("assignment")||{},priority=globalWorkflow.get("priority")||{},status=globalWorkflow.get("status")||{};index=attrs.xcategory.indexOf(assigned.id);if(index>=0){attrs.xcategory.splice(index,1);attrs.assigned="na"}index=attrs.xcategory.indexOf(priority.id);if(index>=0){attrs.xcategory.splice(index,1);attrs.priority="na"}index=attrs.xcategory.indexOf(status.id);if(index>=0){attrs.xcategory.splice(index,1);attrs.status="na"}return attrs}function fixTwitterVerified(attrs){if(attrs.twitterVerified==="true"){attrs.twitterVerified=true}else if(attrs.twitterVerified==="false"){attrs.twitterVerified=false}return attrs}function upgradeFBSubtypes(attrs){if(attrs.facebookSubtype!==undefined){if(attrs.subtype===undefined){attrs.subtype=attrs.facebookSubtype}delete attrs.facebookSubtype}return attrs}return{isEmpty:function isEmpty(val){return _isEmpty(val)},cleanAttributes:function cleanAttributes(attrs){updateOldSiteVisitorsFilters(attrs);reformatCategories(attrs);fixXCategoryToWorkflowNA(attrs);fixSortOrder(attrs);fixExactAuthor(attrs);fixTwitterVerified(attrs);fixOldFilterNames(attrs);upgradeFBSubtypes(attrs);return attrs}}});define("src/models/Controls",["underscore","src/controls/Controls","src/controlsAttributesRewriter"],function(_,Controls,controlsAttributesRewriter){"use strict";var FACEBOOK_QUERY_DATA_FIELD_NAMES=["resourceType","facebookRole","subtype","facebookSubtype","facebookAuthorId","xfacebookRole","xfacebookSubtype","xfacebookAuthorId","facebookLikesMin","facebookLikesMax","facebookCommentsMin","facebookCommentsMax","facebookSharesMin","facebookSharesMax","tsFilter"];var FACEBOOK_SPEC_DATA={facebookLikesMin:{type:"positiveNumber",lessThan:"facebookLikesMax"},facebookLikesMax:{type:"positiveNumber",greaterThan:"facebookLikesMin"},facebookCommentsMin:{type:"positiveNumber",lessThan:"facebookCommentsMax"},facebookCommentsMax:{type:"positiveNumber",greaterThan:"facebookCommentsMin"},facebookSharesMin:{type:"positiveNumber",lessThan:"facebookSharesMax"},facebookSharesMax:{type:"positiveNumber",greaterThan:"facebookSharesMin"}};return Controls.extend({cleanAttributes:function cleanAttributes(attrs){return controlsAttributesRewriter.cleanAttributes(attrs)},getQueryDataFieldNames:function getQueryDataFieldNames(){var fieldNames=_(Controls.prototype.getQueryDataFieldNames.apply(this,arguments)).union(FACEBOOK_QUERY_DATA_FIELD_NAMES);return fieldNames},dataSpec:function dataSpec(){return _(Controls.prototype.dataSpec.apply(this,arguments)).extend(FACEBOOK_SPEC_DATA)}})});(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==="object"&&typeof module==="object")module.exports=factory(require("underscore"));else if(typeof define==="function"&&define.amd)define("bw-fe-helpers/arrayHelper",["underscore"],factory);else{var a=typeof exports==="object"?factory(require("underscore")):factory(root["underscore"]);for(var i in a)(typeof exports==="object"?exports:root)[i]=a[i]}})(this,function(__WEBPACK_EXTERNAL_MODULE__1__){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=13)}({1:function(module,exports){module.exports=__WEBPACK_EXTERNAL_MODULE__1__},13:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var underscore__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1);var underscore__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(underscore__WEBPACK_IMPORTED_MODULE_0__);function findIndex(array,identifier){var matchIndex=-1;if(underscore__WEBPACK_IMPORTED_MODULE_0___default()(identifier).isString()){return underscore__WEBPACK_IMPORTED_MODULE_0___default()(array).indexOf(identifier)}underscore__WEBPACK_IMPORTED_MODULE_0___default()(array).find(function(item,index){for(var key in identifier){if(identifier[key]===item[key]){return matchIndex=index}}});return matchIndex}__webpack_exports__["default"]={insertBefore:function insertBefore(array,props){var values=Array.prototype.slice.call(arguments,2),matchIndex=findIndex(array,props);if(matchIndex===-1){throw new Error("Item not found in array")}array.splice.apply(array,[matchIndex,0].concat(values))},insertAfter:function insertAfter(array,props){var values=Array.prototype.slice.call(arguments,2),matchIndex=findIndex(array,props);if(matchIndex===-1){throw new Error("Item not found in array")}array.splice.apply(array,[matchIndex+1,0].concat(values))}}}})["default"]});define("src/DashboardConfiguration",["underscore","jquery","bw-fe-helpers/arrayHelper"],function(_,$,arrayHelper){"use strict";function findTab(tabs,tabId){var tab=_(tabs).find(function(tab){return tab.id===tabId});if(!tab){throw new Error("Invalid tab ID specified")}return tab}function cleanupConfig(config){config.projectId=undefined;config.settings.projectId=undefined;config.settings.queryId=undefined;config.settings.queryName=undefined;_(config.tabs).each(function(tab){_(tab.components).each(function(component){component.settings.queryId=undefined;component.settings.queryName=undefined;component.settings.projectId=undefined;component.settings.queryGroupId=undefined;if(component.settings.currentMode){component.settings.currentMode="query"}})});return config}function DashboardConfiguration(spec,skipValidation){if(!spec){throw new Error("Spec must be defined")}if(skipValidation){this.spec=spec;return}if(!_(spec.tabs).isArray()){throw new Error("Spec must contain an array of tabs")}_(spec.tabs).each(function(tab){if(!tab.id){throw new Error("All tabs in the spec must have an ID")}_(tab.components).each(function(component){if(!component.id){throw new Error("All components in the spec must have an ID")}})});this.spec=spec}_(DashboardConfiguration.prototype).extend({createConfig:function createConfig(options,callback){var config=$.extend(true,{name:options.dashboardName,projectId:options.projectId,settings:_.extend({projectId:options.projectId},options.settings)},this.spec);var showAnnotations=options.showAnnotations;_(config.tabs).each(function(tab){delete tab.id;_(tab.components).each(function(component){if(!showAnnotations){delete component.annotation}component.settings=_.extend({},options.settings,component.settings)})});callback(undefined,config)},createTemplateConfig:function createTemplateConfig(options,callback){this.createConfig(options,function(err,config){callback(undefined,cleanupConfig(config))})},addTab:function addTab(position,newTab){this.spec.tabs.splice(position,0,newTab)},insertTabBefore:function insertTabBefore(tabId,newTab){arrayHelper.insertBefore(this.spec.tabs,{id:tabId},newTab)},insertTabAfter:function insertTabAfter(tabId,newTab){arrayHelper.insertAfter(this.spec.tabs,{id:tabId},newTab)},addComponent:function addComponent(tabId,position,newComponent){findTab(this.spec.tabs,tabId).components.splice(position,0,newComponent)},insertComponentBefore:function insertComponentBefore(tabId,componentId,newComponent){var tab=findTab(this.spec.tabs,tabId);arrayHelper.insertBefore(tab.components,{id:componentId},newComponent)},insertComponentAfter:function insertComponentAfter(tabId,componentId,newComponent){var tab=findTab(this.spec.tabs,tabId);arrayHelper.insertAfter(tab.components,{id:componentId},newComponent)}});return DashboardConfiguration});define("src/DashboardTypeManager",["src/permissions","src/components/imagewall/helpers/logoqueriesEnabledHelper","bw-fe-helpers/arrayHelper"],function(permissions,logoqueriesEnabledHelper,arrayHelper){"use strict";var DASHBOARDS=[{type:"summary",name:"Summary",configurationPath:"src/SummaryDashboardConfiguration",queryTypes:["text","monitor","logo"],text:"Get a general understanding of the conversations that are happening about your brands, "+"competitors or search topics online.",hasAnnotations:true},{type:"publicfacebook",name:"Facebook",configurationPath:"src/extensions/facebookanalytics/configuration/FacebookDashboardConfiguration",queryTypes:["publicfacebook"],text:"Get an overview on the data of a tracked Facebook Page."},{type:"twitter",name:"Twitter",configurationPath:"src/extensions/twitteranalytics/configuration/TwitterDashboardConfiguration",queryTypes:["twitter"],text:"Get an overview on the data of a tracked Twitter account."},{type:"instagram",name:"Instagram",configurationPath:"src/instagramchannel/configuration/InstagramDashboardConfiguration",queryTypes:["instagram"],text:"Get an overview on the data of a tracked Instagram account."},{type:"influencers",name:"Influencers",configurationPath:"src/InfluencersDashboardConfiguration",queryTypes:["text","monitor","logo"],text:"Identify and analyze influencers to optimize your campaigns and reach your target audience.",hasAnnotations:true},{type:"pr",name:"PR",configurationPath:"src/PrDashboardConfiguration",queryTypes:["text","monitor","logo"],text:"Measure your press coverage by analyzing news clippings, news coverage quality, top journalists and key blogs.",hasAnnotations:true},{type:"reputation",name:"Reputation",configurationPath:"src/ReputationDashboardConfiguration",queryTypes:["text","monitor","logo"],text:"Spot trends in negative sentiment that may damage your brand.",hasAnnotations:true},{type:"trends",name:"Trends",configurationPath:"src/TrendsDashboardConfiguration",queryTypes:["text","monitor","twitter","publicfacebook","logo"],text:"Track the trends, conversations and people influencing an important topic or hashtag "+"to discover valuable marketing moments and PR opportunities."},{type:"demographics",configurationPath:"src/extensions/demographicssummary/configuration/DemographicsDashboardConfiguration",queryTypes:["text","monitor","twitter","logo"],name:"Demographics",text:"Analyse author demographics for Twitter, including gender, interests, and geographic location."},{type:"blank",name:"Blank",configurationPath:"src/BlankDashboardConfiguration",queryTypes:["text","monitor","publicfacebook","twitter","logo","instagram"],text:"Build up your Dashboard from scratch by adding Components (experienced users)."},{type:"mentions",configurationPath:"src/components/mentions/MentionsDashboardConfiguration",excludeFromDashboardCreateUI:true}];var DASHBOARD_WIZARDS=[{type:"BRAND_MONITORING",queryTypes:["text"],excludeFromDashboardCreateUI:true},{type:"CAMPAIGN_TRACKING",queryTypes:["text"],excludeFromDashboardCreateUI:true}];function getLogoDashboard(){return{type:"logos",name:"Images",configurationPath:"src/ImageDashboardConfiguration",queryTypes:["logo"],text:"Get an in-depth understanding of the conversations that are happening around images that contain the brand logo. "+"Dig into the stories behind the trending images, categorize them, and take action where needed.",hasAnnotations:true,isNew:true}}function DashboardTypeManager(){}DashboardTypeManager.prototype.defaultDashboardType="summary";DashboardTypeManager.prototype.get=function(typeName){return this.getDashboards().find(function(dashboard){return dashboard.type===typeName})};DashboardTypeManager.prototype.getDashboards=function(){var dashboards=[].concat(DASHBOARDS,DASHBOARD_WIZARDS).map(function(dashboard){return Object.assign({},dashboard)});var logoDashboard=getLogoDashboard();if(logoqueriesEnabledHelper.isEnabled()){dashboards.push(logoDashboard)}else{dashboards.push(Object.assign({isPromo:true},logoDashboard))}if(permissions.check("see.signals")){arrayHelper.insertBefore(dashboards,{type:"blank"},{type:"realtime",configurationPath:"src/signals/RealtimeDashboardConfiguration",excludeFromDashboardCreateUI:true})}return dashboards};DashboardTypeManager.prototype.getConfigurationTypes=function(){return this.getDashboards().map(function(dashboard){return dashboard.type})};return new DashboardTypeManager});define("src/helpers/componentRestrictions",["src/permissions"],function(permissions){"use strict";var MENTION_BASED_COMPONENTS=["facebookposts","facebookcomments","topiccomparison","mentions","topics","compositetopicscontroller","tweets","twittertweets","twitterinsights","wordcloud","topicwheel","topicplot"];return{isRestricted:function isRestricted(componentType){var isRestricted=false;if(!permissions.check("see.mentions")){isRestricted=MENTION_BASED_COMPONENTS.indexOf(componentType)>-1}return isRestricted}}});function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};var ownKeys=Object.keys(source);if(typeof Object.getOwnPropertySymbols==="function"){ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))}ownKeys.forEach(function(key){_defineProperty(target,key,source[key])})}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}define("src/helpers/componentsMappingHelper",[],function(){"use strict";var LEGACY_TYPE_MAPPINGS={brandsummary:"summary",brandtopsites:"topsites",compositetopicscontroller:"topics",brandvolumebreakdown:"volume",HistoryComponent:"history",timeseriesbrandvsgroup:"history",timeseries:"history","history-comparison":"historycomparison",brandgroupvolumebreakdown:"groupvolume",videotracking:"videotracker",geocomponent:"worldoverview",keyInsights:"keyinsights",instagramsummarycharts:"instagramperformanceanalytics",logoimages:"logoimagestwitter",topicmap:"topicwheel"};var LEGACY_SPEC_MAPPINGS={history:function history(spec){return{type:"chart",activeView:"lineChart",settings:Object.assign({},spec.settings,{dimension2:"queries"})}},emojis:function emojis(spec){var orderBy=spec.settings.orderBy==="burst"?"trending":spec.settings.orderBy;return{type:"wordcloud",activeView:"wordCloudView",customizeBarOpen:false,settings:_objectSpread({},spec.settings,{extract:["emojis"],orderBy:orderBy,wordSize:orderBy})}},volume:function volume(spec){return{type:"chart",activeView:"pieCharts",title:"Volume",settings:Object.assign({},spec.settings,{dimension1:"queries",dimension2:"pageTypes"})}},groupvolume:function groupvolume(spec){return{type:"chart",activeView:"pieCharts",settings:Object.assign({},spec.settings,{dimension1:"queryGroups",dimension2:"queries",currentMode:"queryGroup"})}},twittertweets:function twittertweets(spec){return{type:"mentions",settings:Object.assign({},spec.settings,{orderBy:"impact",orderDirection:"desc",visibleColumns:["found","impact","twitterRetweets","twitterReplyCount","twitterFollowers","impressions"]})}},grouptopsites:function grouptopsites(spec){return{type:"topsites",settings:Object.assign({},spec.settings,{currentMode:"queryGroup"})}},sentiment:function sentiment(spec){return{type:"chart",activeView:"pieCharts",settings:Object.assign({},spec.settings,{dimension1:"queries",dimension2:"sentiment",currentMode:"query"})}},uniqueauthors:function uniqueauthors(spec){return{type:"chart",activeView:"lineChart",settings:Object.assign({},spec.settings,{aggregate:"authors",dimension1:"days",dimension2:"queries",currentMode:"query"})}},pagetypes:function pagetypes(spec){return{type:"chart",activeView:"lineChart",settings:Object.assign({},spec.settings,{dimension1:"days",dimension2:"pageTypes",currentMode:"query"})}},summary:function summary(spec){return{type:"keyinsights",settings:spec.settings}},videoshares:function videoshares(spec){return{type:"chart",activeView:"lineChart",settings:Object.assign({},spec.settings,{helpKey:"video-shares",dimension1:"days",dimension2:"queries",currentMode:"query",subtype:"video"})}},logoimagestwitter:function logoimagestwitter(spec){return{type:"imagewall",title:"Image wall",settings:_objectSpread({},spec.settings,{orderBy:"reachEstimate",pageType:["twitter"]})}},logoimagesinstagram:function logoimagesinstagram(spec){return{type:"imagewall",title:"Image wall",settings:_objectSpread({},spec.settings,{orderBy:"reachEstimate",pageType:["instagram"]})}}};function mapWorkbenchType(type){if(type.includes("workbench-object-analysis-component-")){return type.substring("workbench-object-analysis-component-".length).replace(/-/g,"")}return type}function mapLegacyType(type){return LEGACY_TYPE_MAPPINGS[type]||type}function mapLegacySpec(spec){var mapSpec=LEGACY_SPEC_MAPPINGS[spec.type];if(typeof mapSpec==="function"){return Object.assign({},spec,mapSpec(spec))}return spec}return{map:function map(spec){var type=mapLegacyType(mapWorkbenchType(spec.type));var newSpec=Object.assign({},spec,{type:type});return mapLegacySpec(newSpec)}}});function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};var ownKeys=Object.keys(source);if(typeof Object.getOwnPropertySymbols==="function"){ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))}ownKeys.forEach(function(key){_defineProperty(target,key,source[key])})}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}define("src/models/Dashboard",["backbone","underscore","src/globals/me","src/globals/currentProject","src/models/TabCollection","src/models/Controls","src/DashboardConfiguration","src/DashboardTypeManager","src/helpers/componentRestrictions","src/helpers/componentsMappingHelper"],function(Backbone,_,me,currentProject,TabCollection,Controls,DashboardConfiguration,dashboardTypeManager,componentRestrictions,componentsMappingHelper){"use strict";var DELETED_COMPONENTS=["newfollowers"];var DASHBOARD_NAME_MAX_LENGTH=50;function keepTabsAttributeUpdated(){if(this.settingTabs){return}this.settingTabs=true;this.set({tabs:this.tabs.toJSON()});this.settingTabs=false}function keepTabsCollectionUpdated(){var tabs=this.get("tabs"),collection=this.tabs;if(!this.settingTabs&&tabs&&collection){_(tabs).forEach(function(tab,i){var tabModel=collection.at(i);if(!tabModel){return collection.add(tab)}tabModel.set(tab)})}while(collection&&tabs&&collection.size()>tabs.length){collection.remove(collection.last().cid)}}function upgradeSettings(attrs,timezone){var controls=new Controls(attrs.settings,{timezone:attrs.dashboardTimezone||timezone,supportsQueryGroups:true});attrs.settings=controls.toJSON()}function tabIsEmpty(tab){return tab.components===undefined||tab.components.length===0}function componentIsNotRestricted(component){return!componentRestrictions.isRestricted(component.type)}var updateComponentSpec=function updateComponentSpec(component){return componentsMappingHelper.map(component)};var componentIsNotDeleted=function componentIsNotDeleted(component){return!DELETED_COMPONENTS.includes(component.type)};function removeOutdatedAnnotations(dashboard){if(dashboard.dashboardType==="logos"){dashboard.tabs.forEach(function(tab){tab.components.forEach(function(component){if(component.annotation&&component.annotation.author){delete component.annotation}})})}}var Dashboard=Backbone.Model.extend({defaults:function defaults(){return{viewUsers:[],analystUsers:[]}},constructor:function DashboardModel(){Backbone.Model.apply(this,arguments)},initialize:function initialize(){var tabs=this.get("tabs");this.tabs=new TabCollection(tabs);this.tabs.on("add remove change reset",keepTabsAttributeUpdated,this);keepTabsAttributeUpdated.call(this);this.on("change:tabs",keepTabsCollectionUpdated,this)},url:function url(){return"/projects/{projectId}/dashboards/"+(this.id||"")},getTimezone:function getTimezone(){return this.get("dashboardTimezone")||currentProject.getTimezone()},isProjectsTimezoneOverriden:function isProjectsTimezoneOverriden(){return!!this.get("dashboardTimezone")},getApplicableUserRole:function getApplicableUserRole(){var shared=this.get("sharedWith");if(shared==="none"){return}return shared},getShared:function getShared(){var shared=this.get("sharedWith"),viewUsers=this.get("viewUsers")||[],analystUsers=this.get("analystUsers")||[];if(shared!=="user"){return shared}if(!viewUsers.length&&!analystUsers.length){return"none"}return shared||"none"},getOwner:function getOwner(){return parseInt(this.get("userId"),10)||undefined},getQueryId:function getQueryId(){var settings=this.get("settings");return settings&&settings.queryId},updateGlobalControls:function updateGlobalControls(attrs){this.settingTabs=true;this.tabs.each(function(tab){tab.updateGlobalControls(attrs)});this.set({tabs:this.tabs.toJSON(),settings:_.extend({},this.get("settings"),attrs)});this.settingTabs=false},save:function save(attrs,options){attrs=attrs||{};attrs.lastSaved=(new Date).getTime();attrs.arion=true;return Backbone.Model.prototype.save.call(this,attrs,options)},sync:function sync(method,model,options){var onSuccess=options.success;if(method!=="read"&&method!=="delete"){options.success=function(resp,status,xhr){if(onSuccess){onSuccess.call(this,resp,status,xhr)}model.trigger("saved",model,resp,options)};model.trigger("saving",model,options)}return Backbone.sync.call(this,method,model,options)},set:function set(key,value,options){var attrs;if(_.isObject(key)||!key){attrs=key;options=value}else{attrs={};attrs[key]=value}if(attrs&&attrs.settings){upgradeSettings(attrs,this.getTimezone())}return Backbone.Model.prototype.set.call(this,attrs,options)},getGroups:function getGroups(){var settingsArray=_(this.get("tabs")).chain().filter(function hasComponents(tab){return _(tab).has("components")}).pluck("components").flatten().pluck("settings").push(this.get("settings")).value(),siteGroups=[],locationGroups=[],authorGroups=[];function parseIds(val){return parseInt(val,10)}settingsArray.forEach(function(settings){if(!_.isObject(settings)){return}["siteGroup","xsiteGroup"].forEach(function(s){if(_(settings).has(s)){siteGroups=_(siteGroups).union([].concat(settings[s]))}});["locationGroup","xlocationGroup"].forEach(function(s){if(_(settings).has(s)){locationGroups=_(locationGroups).union([].concat(settings[s]))}});["authorGroup","xauthorGroup"].forEach(function(s){if(_(settings).has(s)){authorGroups=_(authorGroups).union([].concat(settings[s]))}})});return{siteGroups:_(siteGroups).chain().map(parseIds).compact().value(),locationGroups:_(locationGroups).chain().map(parseIds).compact().value(),authorGroups:_(authorGroups).chain().map(parseIds).compact().value()}},parse:function parse(response){if(!response.tabs){return response}removeOutdatedAnnotations(response);return _objectSpread({},response,{tabs:response.tabs.reduce(function(memo,tab){if(tabIsEmpty(tab)){return memo.concat([tab])}var displayableComponents=tab.components.map(updateComponentSpec).filter(componentIsNotDeleted).filter(componentIsNotRestricted);if(displayableComponents.length===0&&tab.components.length>0){return memo}return memo.concat([_objectSpread({},tab,{components:displayableComponents})])},[])})},dashboardNameMaxLength:DASHBOARD_NAME_MAX_LENGTH,validateDashboardName:function validateDashboardName(value){var err=[];value=value.trim();if(!value){err.push("Please enter a name")}if(Dashboard.isDefaultName(value)){err.push("Please give this Dashboard a meaningful name")}if(value.length>this.dashboardNameMaxLength){err.push("Sorry, we have limited Dashboard names to "+this.dashboardNameMaxLength+" characters.")}return err}},{defaultName:"Untitled Dashboard",defaultTemplateName:"Untitled Dashboard (from template)",create:function create(options,callback){options=options||{};var query=options.query,dashboardType,projectId,settings={},dashboardTypeIsAvailable;if(query){settings.queryId=query.id;settings.queryName=query.get("name");projectId=query.get("projectId");dashboardType=options.dashboardType||query.get("type")}settings.dateRange=options.dateRange||"P7D";dashboardTypeIsAvailable=dashboardTypeManager.get(dashboardType)!==undefined;if(!dashboardTypeIsAvailable){dashboardType=dashboardTypeManager.defaultDashboardType}Dashboard._doCreate({dashboardType:dashboardType,showAnnotations:options.showAnnotations,projectId:projectId,settings:settings},function(err,dashboard){if(!dashboard){return callback(err,dashboard)}dashboard.set({dashboardType:dashboardType,userId:me.id,username:me.get("username")});return callback(err,dashboard)})},isDefaultName:function isDefaultName(name){return[this.defaultName,this.defaultTemplateName].indexOf(name)>-1},createFromTemplate:function createFromTemplate(template,queryId,projectId,callback){var options={dashboardName:Dashboard.defaultTemplateName,queryId:queryId,projectId:projectId,settings:_.extend(template.settings,{queryId:queryId})},config=new DashboardConfiguration(template,true);config.createConfig(options,function(err,spec){callback(err,new Dashboard(spec))})},_doCreate:function _doCreate(options,callback){options=_({dashboardName:Dashboard.defaultName}).extend(options);Dashboard._getDashboardSettings(options,function(err,dashboardSettings){callback(err,new Dashboard(dashboardSettings,{parse:true}))})},_getDashboardSettings:function _getDashboardSettings(options,callback){var dashboardType=dashboardTypeManager.get(options.dashboardType);if(dashboardType===undefined||dashboardType.configurationPath===undefined){throw new Error("could not load dashboard type "+options.dashboardType)}require([dashboardType.configurationPath],function(dashboardConfiguration){dashboardConfiguration.createConfig(options,callback)})}});return Dashboard});define("src/globals/currentDashboard",["src/globals/currentProject","src/models/Dashboard"],function(currentProject,Dashboard){"use strict";var dashboard=new Dashboard;function clearCache(){dashboard.clear()}currentProject.onLoad(function(done){clearCache();done()});dashboard.reset=function(attrs){this.clear({silent:true}).set(attrs);this.trigger("sync",this)};return dashboard});define("src/analytics/trackDashboardAnalytics",["underscore","src/globals/currentDashboard","src/analytics/Analytics","src/events/dashboardEvents","src/events/globalEventNames"],function(_,currentDashboard,Analytics,dashboardEvents,globalEventNames){"use strict";var DASHBOARD_EVENT_NAMES=globalEventNames.DASHBOARDS;return function trackDashboardEvents(){dashboardEvents.on(DASHBOARD_EVENT_NAMES.DASHBOARD_SHOWN,function trackDashboardShownEvent(data){Analytics.trackMixpanelEvent(DASHBOARD_EVENT_NAMES.DASHBOARD_SHOWN,_(data).pick("dashboardId","projectId","queryId","dashboardType"));Analytics.logMetric([DASHBOARD_EVENT_NAMES.DASHBOARD_SHOWN,data.dashboardType].join(":"))});dashboardEvents.on(DASHBOARD_EVENT_NAMES.DASHBOARD_DELETED,function trackDashboardDeletedEvent(data){Analytics.trackMixpanelEvent(DASHBOARD_EVENT_NAMES.DASHBOARD_DELETED,_(data).pick("dashboardId","projectId","queryId","dashboardType"));Analytics.logMetric([DASHBOARD_EVENT_NAMES.DASHBOARD_DELETED,data.dashboardType].join(":"))});dashboardEvents.on(DASHBOARD_EVENT_NAMES.DASHBOARD_SETUP_DELETED,function trackDashboardSetupDeletedEvent(data){Analytics.trackMixpanelEvent(DASHBOARD_EVENT_NAMES.DASHBOARD_SETUP_DELETED,_(data).pick("dashboardId","projectId","queryId","dashboardType","referrer"));Analytics.logMetric([DASHBOARD_EVENT_NAMES.DASHBOARD_SETUP_DELETED,data.dashboardType].join(":"))});dashboardEvents.on(DASHBOARD_EVENT_NAMES.DASHBOARD_CREATED,function trackDashboardCreatedEvent(data){Analytics.trackMixpanelEvent(DASHBOARD_EVENT_NAMES.DASHBOARD_CREATED,_(data).pick("projectId","queryId","dashboardType","hasAnnotations","queryType"));Analytics.logMetric([DASHBOARD_EVENT_NAMES.DASHBOARD_CREATED,data.dashboardType].join(":"))});dashboardEvents.on(DASHBOARD_EVENT_NAMES.DASHBOARD_SHARED,function trackDashboardSharedEvent(data){Analytics.trackMixpanelEvent(DASHBOARD_EVENT_NAMES.DASHBOARD_SHARED,data);Analytics.logMetric([DASHBOARD_EVENT_NAMES.DASHBOARD_SHARED,currentDashboard.get("dashboardType")].join(":"))});dashboardEvents.on(DASHBOARD_EVENT_NAMES.GLOBAL_SETTINGS_APPLIED,function trackSettingsAppliedEvent(data){Analytics.trackMixpanelEvent(DASHBOARD_EVENT_NAMES.GLOBAL_SETTINGS_APPLIED,data);Analytics.logMetric([DASHBOARD_EVENT_NAMES.GLOBAL_SETTINGS_APPLIED,currentDashboard.get("dashboardType")].join(":"))});dashboardEvents.on(DASHBOARD_EVENT_NAMES.COMPONENTS_COPIED,function trackDashboardComponentsCopiedEvent(data){var eventData=_({projectId:currentDashboard.get("projectId"),dashboardId:currentDashboard.id,dashboardType:currentDashboard.get("dashboardType")}).extend(data);Analytics.trackMixpanelEvent(DASHBOARD_EVENT_NAMES.COMPONENTS_COPIED,eventData);Analytics.logMetric([DASHBOARD_EVENT_NAMES.COMPONENTS_COPIED,eventData.dashboardType].join(":"))});dashboardEvents.on(DASHBOARD_EVENT_NAMES.COMPONENTS_PASTED,function trackDashboardComponentsPastedEvent(data){var eventData=_({projectId:currentDashboard.get("projectId"),dashboardId:currentDashboard.id,dashboardType:currentDashboard.get("dashboardType")}).extend(data);Analytics.trackMixpanelEvent(DASHBOARD_EVENT_NAMES.COMPONENTS_PASTED,eventData);Analytics.logMetric([DASHBOARD_EVENT_NAMES.COMPONENTS_PASTED,eventData.dashboardType].join(":"))})}});define("src/events/dashboardExportEvents",["underscore","backbone"],function(_,Backbone){"use strict";return _.clone(Backbone.Events)});define("src/analytics/trackDashboardExportAnalytics",["src/analytics/Analytics","src/events/dashboardExportEvents","src/events/globalEventNames"],function(Analytics,dashboardExportEvents,globalEventNames){"use strict";var DASHBOARD_EXPORT_EVENT_NAMES=globalEventNames.DASHBOARD_EXPORTS;return function trackDashboardExportEvents(){dashboardExportEvents.on(DASHBOARD_EXPORT_EVENT_NAMES.EXPORT_INITIATED,function trackExportInitiatedEvent(data){Analytics.trackMixpanelEvent(DASHBOARD_EXPORT_EVENT_NAMES.EXPORT_INITIATED,data);Analytics.logMetric([DASHBOARD_EXPORT_EVENT_NAMES.EXPORT_INITIATED,data.dashboardType].join(":"))});dashboardExportEvents.on(DASHBOARD_EXPORT_EVENT_NAMES.EXPORT_REQUESTED,function trackExportRequestedEvent(data){Analytics.trackMixpanelEvent(DASHBOARD_EXPORT_EVENT_NAMES.EXPORT_REQUESTED,data);Analytics.logMetric([DASHBOARD_EXPORT_EVENT_NAMES.EXPORT_REQUESTED,data.dashboardType].join(":"))})}});define("src/analytics/trackComponentAnalytics",["underscore","src/globals/currentDashboard","src/analytics/Analytics","src/events/componentEvents","src/events/globalEventNames"],function(_,currentDashboard,Analytics,componentEvents,globalEventNames){"use strict";var COMPONENT_EVENT_NAMES=globalEventNames.COMPONENTS;function trackEvent(event,data){Analytics.trackMixpanelEvent(event,data)}return function trackComponentEvents(){componentEvents.on(COMPONENT_EVENT_NAMES.COMPONENT_REMOVED,function trackComponentRemovedEvent(data){trackEvent(COMPONENT_EVENT_NAMES.COMPONENT_REMOVED,_(data).pick("componentName","dashboardId","projectId"));Analytics.logMetric(COMPONENT_EVENT_NAMES.COMPONENT_REMOVED)});componentEvents.on(COMPONENT_EVENT_NAMES.COMPONENT_LOADED,function trackComponentShowViewEvent(data){trackEvent(COMPONENT_EVENT_NAMES.COMPONENT_LOADED,_(data).pick(function(value,key){return["componentName","previousView","view","dashboardId","dashboardType","projectId","queryTypes","queryIds","loadingType","modifiedFilters","tabName","insightsSidebarActive","orderBy"].includes(key)||key.startsWith("customizebar_")}));Analytics.logMetric(COMPONENT_EVENT_NAMES.COMPONENT_LOADED)});componentEvents.on(COMPONENT_EVENT_NAMES.COMPONENT_ADDED,function trackComponentAddEvent(data){trackEvent(COMPONENT_EVENT_NAMES.COMPONENT_ADDED,_(data).pick("componentName","dashboardId","projectId"));Analytics.logMetric(COMPONENT_EVENT_NAMES.COMPONENT_ADDED)});componentEvents.on(COMPONENT_EVENT_NAMES.TIMEPICKER_OPENED,function trackTimepickerOpened(data){trackEvent(COMPONENT_EVENT_NAMES.TIMEPICKER_OPENED,_(data).pick("componentName","pickerName","dashboardId","projectId"));Analytics.logMetric(COMPONENT_EVENT_NAMES.TIMEPICKER_OPENED)});componentEvents.on(COMPONENT_EVENT_NAMES.TIMEPICKER_SELECTED,function trackTimepickerSelected(data){trackEvent(COMPONENT_EVENT_NAMES.TIMEPICKER_SELECTED,_(data).pick("componentName","pickerName","selectedTime","dashboardId","projectId"));Analytics.logMetric(COMPONENT_EVENT_NAMES.TIMEPICKER_SELECTED)});componentEvents.on(COMPONENT_EVENT_NAMES.ANNOTATION_REMOVED,function trackCloseAnnotation(data){var eventData={};eventData.componentType=data.type;eventData.componentName=data.componentName;eventData.projectId=currentDashboard.get("projectId");eventData.dashboardId=currentDashboard.id;eventData.dashboardType=currentDashboard.get("dashboardType");Analytics.trackMixpanelEvent(COMPONENT_EVENT_NAMES.ANNOTATION_REMOVED,eventData);Analytics.logMetric(COMPONENT_EVENT_NAMES.ANNOTATION_REMOVED)});componentEvents.on(COMPONENT_EVENT_NAMES.ANNOTATION_REMOVED_ALL,function trackCloseAllAnnotations(){var eventData={};eventData.projectId=currentDashboard.get("projectId");eventData.dashboardId=currentDashboard.id;eventData.dashboardType=currentDashboard.get("dashboardType");Analytics.trackMixpanelEvent(COMPONENT_EVENT_NAMES.ANNOTATION_REMOVED_ALL,eventData);Analytics.logMetric(COMPONENT_EVENT_NAMES.ANNOTATION_REMOVED_ALL)});componentEvents.on(COMPONENT_EVENT_NAMES.SETTINGS_SET,function trackComponentSettingsSetEvent(data){Analytics.trackMixpanelEvent(COMPONENT_EVENT_NAMES.SETTINGS_SET,data)})}});define("src/events/alertEvents",["underscore","backbone"],function(_,Backbone){"use strict";return _.clone(Backbone.Events)});define("src/analytics/trackAlertAnalytics",["src/analytics/Analytics","src/events/alertEvents","src/events/globalEventNames","moment"],function(Analytics,alertEvents,globalEventNames,moment){"use strict";var ALERT_EVENT_NAMES=globalEventNames.ALERTS;function trackEvent(event,data){Analytics.trackMixpanelEvent(event,data)}return function trackAlertEvents(){alertEvents.on(ALERT_EVENT_NAMES.ALERT_SAVED,function trackAlertCreatedEvent(data){trackEvent(ALERT_EVENT_NAMES.ALERT_SAVED,{alertType:data.alertTypes,creationDate:data.createdOn,includesCreator:data.emailCreator,numberOfRecipients:data.recipients.length,updatedDate:moment.utc().toISOString()})})}});define("src/analytics/trackAdministrationAnalytics",["underscore","moment","src/analytics/Analytics","src/events/administrationEvents","src/events/globalEventNames"],function(_,moment,Analytics,administrationEvents,globalEventNames){"use strict";var ADMINISTRATION_EVENT_NAMES=globalEventNames.ADMINISTRATION,startEditingAt=null;function getLastModalDuration(){if(startEditingAt===null){return undefined}return moment().utc().diff(moment(startEditingAt))}function resetModalEventTimes(){startEditingAt=null}function getTrackableData(model){var trackableData={},trackableProperties=["parentId","creatorUserId"];_(trackableData).extend(_(model).pick(trackableProperties));if(model.previous!==undefined){trackableData.isNew=model.previous("id")===undefined}return trackableData}return function trackAdministrationEvents(){administrationEvents.on(ADMINISTRATION_EVENT_NAMES.TAB_CHANGED,function trackAdministrationTabChangeEvent(currentTab){Analytics.trackMixpanelEvent(ADMINISTRATION_EVENT_NAMES.TAB_CHANGED,{selectedTab:currentTab})});administrationEvents.on(ADMINISTRATION_EVENT_NAMES.ACCOUNTINFO_COLUMN_SORTED,function trackAccountInfoColumnSortedEvent(column){Analytics.trackMixpanelEvent(ADMINISTRATION_EVENT_NAMES.ACCOUNTINFO_COLUMN_SORTED,{sortedColumn:column})});administrationEvents.on(ADMINISTRATION_EVENT_NAMES.EXPORT_ACCOUNTINFO_LOGIN,function trackExportLoginAccountInfo(){Analytics.trackMixpanelEvent(ADMINISTRATION_EVENT_NAMES.EXPORT_ACCOUNTINFO_LOGIN)});administrationEvents.on(ADMINISTRATION_EVENT_NAMES.EXPORT_ACCOUNTINFO_USAGE,function trackExportUsageAccountInfo(){Analytics.trackMixpanelEvent(ADMINISTRATION_EVENT_NAMES.EXPORT_ACCOUNTINFO_USAGE)});administrationEvents.on(ADMINISTRATION_EVENT_NAMES.MODAL_OPENED,function trackOpenModal(){startEditingAt=moment.utc()});administrationEvents.on(ADMINISTRATION_EVENT_NAMES.USER_UPDATED,function trackUserUpdatedEvent(data){var trackedData=getTrackableData(data);trackedData.editDuration=getLastModalDuration();Analytics.trackMixpanelEvent(ADMINISTRATION_EVENT_NAMES.USER_UPDATED,trackedData);resetModalEventTimes()});administrationEvents.on(ADMINISTRATION_EVENT_NAMES.CLIENT_UPDATED,function trackClientUpdatedEvent(data){var trackedData=getTrackableData(data);trackedData.editDuration=getLastModalDuration();Analytics.trackMixpanelEvent(ADMINISTRATION_EVENT_NAMES.CLIENT_UPDATED,trackedData);resetModalEventTimes()});administrationEvents.on(ADMINISTRATION_EVENT_NAMES.PROJECT_UPDATED,function trackProjectUpdatedEvent(data){var trackedData=getTrackableData(data);trackedData.editDuration=getLastModalDuration();Analytics.trackMixpanelEvent(ADMINISTRATION_EVENT_NAMES.PROJECT_UPDATED,trackedData);resetModalEventTimes()});administrationEvents.on(ADMINISTRATION_EVENT_NAMES.USER_CREATED,function trackUserCreatedEvent(data){Analytics.trackMixpanelEvent(ADMINISTRATION_EVENT_NAMES.USER_CREATED,data)})}});define("src/events/mentionEvents",["backbone","underscore"],function(Backbone,_){"use strict";return _.clone(Backbone.Events)});define("src/analytics/trackMentionAnalytics",["src/analytics/Analytics","src/events/mentionEvents","src/events/globalEventNames"],function(Analytics,mentionEvents,globalEventNames){"use strict";var MENTION_EVENT_NAMES=globalEventNames.MENTIONS;return function trackQueryEvents(){mentionEvents.on(MENTION_EVENT_NAMES.MENTION_DELETE,function trackMentionDeleteEvents(data){Analytics.trackMixpanelEvent(MENTION_EVENT_NAMES.MENTION_DELETE,data)});mentionEvents.on(MENTION_EVENT_NAMES.MENTION_MARK_AS_SPAM,function trackMentionMarkAsSpamEvents(data){Analytics.trackMixpanelEvent(MENTION_EVENT_NAMES.MENTION_MARK_AS_SPAM,data)});mentionEvents.on(MENTION_EVENT_NAMES.MENTION_VIEWED,function trackMentionViewed(data){Analytics.trackMixpanelEvent(MENTION_EVENT_NAMES.MENTION_VIEWED,data)})}});define("src/events/geotaggedEvents",["backbone","underscore"],function(Backbone,_){"use strict";return _.clone(Backbone.Events)});define("src/extensions/locations/globalGeotaggedEventNames",[],function(){"use strict";return{MAP:{TILES_LOADED:"geotagged:tilesLoaded",PAGE_SIZE_EXCEEDED:"geotagged:pageSizeExceeded"}}});define("src/analytics/trackGeotaggedAnalytics",["src/analytics/Analytics","src/events/geotaggedEvents","src/extensions/locations/globalGeotaggedEventNames"],function(Analytics,geotaggedEvents,globalGeotaggedEventNames){"use strict";return function trackGeotaggedEvents(){var mapEventNames=globalGeotaggedEventNames.MAP;function listenToEvent(eventName){geotaggedEvents.on(eventName,function(data){Analytics.trackMixpanelEvent(eventName,data)})}listenToEvent(mapEventNames.TILES_LOADED);listenToEvent(mapEventNames.PAGE_SIZE_EXCEEDED)}});define("src/events/guiderEvents",["backbone","underscore"],function(Backbone,_){"use strict";return _.clone(Backbone.Events)});define("src/analytics/trackGuiderAnalytics",["src/analytics/Analytics","src/events/guiderEvents","src/events/globalEventNames","src/globals/currentProject"],function(Analytics,guiderEvents,globalEventNames,currentProject){"use strict";var guiderEventNames=globalEventNames.GUIDER;var EVENTS_TO_TRACK=[guiderEventNames.GUIDER_OPENED,guiderEventNames.GUIDER_CLOSED,guiderEventNames.GUIDER_DISMISSED];return function trackGuiderAnalytics(){EVENTS_TO_TRACK.forEach(function(eventName){guiderEvents.on(eventName,function(){var data=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};Analytics.trackMixpanelEvent(eventName,Object.assign(data,{ProjectId:currentProject.id}));Analytics.logMetric(eventName)})})}});define("src/events/insightsCentralEvents",["backbone","underscore"],function(Backbone,_){"use strict";return _.clone(Backbone.Events)});define("src/extensions/insightscentral/events/globalEventNames",[],function(){"use strict";return{insightsCentral:{OPEN_STORE:"researchStore:storeOpened",OPEN_PROJECT:"researchStore:projectOpened",PROJECT_COPY_REQUESTED:"researchStore:projectCopyRequested"}}});define("src/analytics/trackInsightsCentralAnalytics",["src/analytics/Analytics","src/events/insightsCentralEvents","src/extensions/insightscentral/events/globalEventNames"],function(Analytics,insightsCentralEvents,globalEventNames){"use strict";return function trackInsightsCentralEvents(){var insightsCentralEventNames=globalEventNames.insightsCentral;function listenToEvent(eventName){insightsCentralEvents.on(eventName,function(data){Analytics.trackMixpanelEvent(eventName,data)})}listenToEvent(insightsCentralEventNames.OPEN_STORE);listenToEvent(insightsCentralEventNames.OPEN_PROJECT);listenToEvent(insightsCentralEventNames.PROJECT_COPY_REQUESTED)}});define("src/events/rulesEvents",["backbone","underscore"],function(Backbone,_){"use strict";return _.clone(Backbone.Events)});define("src/analytics/trackRulesAnalytics",["underscore","src/analytics/Analytics","src/events/rulesEvents","src/events/globalEventNames"],function(_,Analytics,rulesEvents,globalEventNames){"use strict";var ATTRIBUTES=["projectId","filter","scope"];return function(){rulesEvents.on(globalEventNames.RULES.RULE_ADDED,function(data){Analytics.trackMixpanelEvent(globalEventNames.RULES.RULE_ADDED,_(data).pick(ATTRIBUTES))});rulesEvents.on(globalEventNames.RULES.RULE_UPDATED,function(data){Analytics.trackMixpanelEvent(globalEventNames.RULES.RULE_UPDATED,_(data).pick(ATTRIBUTES))});rulesEvents.on(globalEventNames.RULES.RULE_DELETED,function(data){Analytics.trackMixpanelEvent(globalEventNames.RULES.RULE_DELETED,_(data).pick(ATTRIBUTES))})}});define("src/events/queryWizardEvents",["backbone","underscore"],function(Backbone,_){"use strict";return _.clone(Backbone.Events)});define("src/querywizard/events/globalEventNames",[],function(){"use strict";return{QUERYWIZARD:{QUERYWIZARD_OPENED:"queryWizard:opened",QUERYWIZARD_CLOSED:"queryWizard:closed",QUERYWIZARD_TRANSITED:"queryWizard:transited",QUERYWIZARD_PREVIEW_TOGGLED:"queryWizard:previewToggled",QUERYWIZARD_EDIT_WITHIN_QUERY_EDITOR_REQUESTED:"queryWizard:editWithinQueryEditorRequested",QUERYWIZARD_TESTSEARCH_TAB_CLICKED:"queryWizard:testsearchTabClicked",QUERYWIZARD_TESTSEARCH_TOPICS_VIEW_SWITCHED:"queryWizard:testsearchTopicsViewSwitched",QUERYWIZARD_TESTSEARCH_TOPIC_CLICKED:"queryWizard:testsearchTopicClicked",QUERYWIZARD_TESTSEARCH_TOPIC_RESULTS_BACK_BUTTON_CLICKED:"queryWizard:testsearchTopicResultsBackButtonClicked",QUERYWIZARD_RECOMMENDATION_CLICKED:"queryWizard:recommendationClicked",QUERYWIZARD_COMPLETION_ADDED:"queryWizard:completionAdded"},QUERY_CREATOR_SELECTION:{QUERY_CREATOR_SELECTION_OPENED:"queryCreatorSelection:opened",QUERY_CREATOR_SELECTION_CLOSED:"queryCreatorSelection:closed"}}});define("src/analytics/trackQueryWizardAnalytics",["src/analytics/Analytics","src/events/queryWizardEvents","src/querywizard/events/globalEventNames"],function(Analytics,queryWizardEvents,globalEventNames){"use strict";var queryWizardEventNames=globalEventNames.QUERYWIZARD;var queryCreatorSelectionEventNames=globalEventNames.QUERY_CREATOR_SELECTION;var EVENTS_TO_TRACK=[queryWizardEventNames.QUERYWIZARD_OPENED,queryWizardEventNames.QUERYWIZARD_CLOSED,queryWizardEventNames.QUERYWIZARD_TRANSITED,queryWizardEventNames.QUERYWIZARD_PREVIEW_TOGGLED,queryWizardEventNames.QUERYWIZARD_EDIT_WITHIN_QUERY_EDITOR_REQUESTED,queryWizardEventNames.QUERYWIZARD_TESTSEARCH_TAB_CLICKED,queryWizardEventNames.QUERYWIZARD_TESTSEARCH_TOPICS_VIEW_SWITCHED,queryWizardEventNames.QUERYWIZARD_TESTSEARCH_TOPIC_CLICKED,queryWizardEventNames.QUERYWIZARD_TESTSEARCH_TOPIC_RESULTS_BACK_BUTTON_CLICKED,queryWizardEventNames.QUERYWIZARD_RECOMMENDATION_CLICKED,queryWizardEventNames.QUERYWIZARD_COMPLETION_ADDED,queryCreatorSelectionEventNames.QUERY_CREATOR_SELECTION_OPENED,queryCreatorSelectionEventNames.QUERY_CREATOR_SELECTION_CLOSED];return function trackQueryWizardAnalytics(){EVENTS_TO_TRACK.forEach(function(eventName){queryWizardEvents.on(eventName,function(data){Analytics.trackMixpanelEvent(eventName,data);Analytics.logMetric(eventName)})})}});define("src/events/logoDetectionEvents",["backbone","underscore"],function(Backbone,_){"use strict";return _.clone(Backbone.Events)});define("src/analytics/trackLogoDetectionAnalytics",["src/analytics/Analytics","src/events/logoDetectionEvents","src/events/globalEventNames"],function(Analytics,logoDetectionEvents,globalEventNames){"use strict";var IMAGE_CLASSIFICATION_EVENTS=globalEventNames.IMAGE_CLASSIFICATION;var LOGO_DETECTION_PROMOTION=globalEventNames.LOGO_DETECTION_PROMOTION;var IMAGE_INSIGHTS=globalEventNames.IMAGE_INSIGHTS;var EVENTS_TO_TRACK=[IMAGE_CLASSIFICATION_EVENTS.REPORT,IMAGE_CLASSIFICATION_EVENTS.USER,LOGO_DETECTION_PROMOTION.PROMOTION_SHOWN,LOGO_DETECTION_PROMOTION.PROMOTION_CLOSED,LOGO_DETECTION_PROMOTION.PROMOTION_SIGNUP,LOGO_DETECTION_PROMOTION.PROMOTION_SIGNUP_ERROR,IMAGE_INSIGHTS.IMAGE_LOAD_SUCCESS,IMAGE_INSIGHTS.IMAGE_LOAD_FAILURE];return function trackLogoDetectionAnalytics(){EVENTS_TO_TRACK.forEach(function(eventName){logoDetectionEvents.on(eventName,function(data){Analytics.trackMixpanelEvent(eventName,data);Analytics.logMetric(eventName)})})}});define("src/events/advertPopupEvents",["backbone","underscore"],function(Backbone,_){"use strict";return _.clone(Backbone.Events)});define("src/analytics/trackAdvertPopupAnalytics",["src/analytics/Analytics","src/events/advertPopupEvents","src/events/globalEventNames"],function(Analytics,advertPopupEvents,globalEventNames){"use strict";var advertPopupEventNames=globalEventNames.ADVERT_POPUPS;var EVENTS_TO_TRACK=[advertPopupEventNames.ADVERT_POPUP_SHOWN,advertPopupEventNames.ADVERT_POPUP_CLOSED,advertPopupEventNames.ADVERT_POPUP_POSTPONED,advertPopupEventNames.ADVERT_POPUP_LINK_CLICKED];return function trackQueryWizardAnalytics(){EVENTS_TO_TRACK.forEach(function(eventName){advertPopupEvents.on(eventName,function(data){Analytics.trackMixpanelEvent(eventName,data)})})}});define("src/analytics/trackFacebookCoverageAnalytics",["src/analytics/Analytics","src/events/facebookCoverageEvents","src/events/globalEventNames","src/globals/currentProject"],function(Analytics,facebookCoverageEvents,globalEventNames,currentProject){"use strict";var facebookCoverageEventNames=globalEventNames.FACEBOOK_COVERAGE;var EVENTS_TO_TRACK=[facebookCoverageEventNames.INVITE_SENT,facebookCoverageEventNames.INVITE_SENT_FAILED,facebookCoverageEventNames.INVITE_DIALOG_OPENED,facebookCoverageEventNames.INVITE_DIALOG_CLOSED];return function trackFacebookCoverageAnalytics(){EVENTS_TO_TRACK.forEach(function(eventName){facebookCoverageEvents.on(eventName,function(){var data=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};Analytics.trackMixpanelEvent(eventName,Object.assign(data,{ProjectId:currentProject.id}));Analytics.logMetric(eventName)})})}});define("src/events/instagramCoverageEvents",["backbone","underscore"],function(Backbone,_){"use strict";return _.clone(Backbone.Events)});define("src/analytics/trackInstagramCoverageAnalytics",["src/analytics/Analytics","src/events/instagramCoverageEvents","src/events/globalEventNames","src/globals/currentProject"],function(Analytics,instagramCoverageEvents,globalEventNames,currentProject){"use strict";var instagramCoverageEventNames=globalEventNames.INSTAGRAM_COVERAGE;var EVENTS_TO_TRACK=[instagramCoverageEventNames.INVITE_SENT,instagramCoverageEventNames.INVITE_SENT_FAILED,instagramCoverageEventNames.INVITE_DIALOG_OPENED,instagramCoverageEventNames.INVITE_DIALOG_CLOSED];return function trackFacebookCoverageAnalytics(){EVENTS_TO_TRACK.forEach(function(eventName){instagramCoverageEvents.on(eventName,function(){var data=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};Analytics.trackMixpanelEvent(eventName,Object.assign(data,{ProjectId:currentProject.id}));Analytics.logMetric(eventName)})})}});define("src/events/quickSearchEvents",["underscore","backbone"],function(_,Backbone){"use strict";return _.clone(Backbone.Events)});define("src/analytics/trackQuickSearchAnalytics",["src/analytics/Analytics","src/events/quickSearchEvents","src/events/globalEventNames"],function(Analytics,quickSearchEvents,globalEventNames){"use strict";var QUICK_SEARCH_EVENT_NAMES=globalEventNames.QUICK_SEARCH;return function trackDashboardExportEvents(){quickSearchEvents.on(QUICK_SEARCH_EVENT_NAMES.QUICK_SEARCH_SUBMITTED,function trackExportInitiatedEvent(data){Analytics.trackMixpanelEvent(QUICK_SEARCH_EVENT_NAMES.QUICK_SEARCH_SUBMITTED,data);Analytics.logMetric(QUICK_SEARCH_EVENT_NAMES.QUICK_SEARCH_SUBMITTED)})}});define("app-startup/initializeAnalyticsObservers",["src/analytics/trackAppAnalytics","src/analytics/trackTagAnalytics","src/analytics/trackProjectAnalytics","src/analytics/trackQueryAnalytics","src/analytics/trackSignalsAnalytics","src/analytics/trackReportsAnalytics","src/analytics/trackDashboardAnalytics","src/analytics/trackDashboardExportAnalytics","src/analytics/trackComponentAnalytics","src/analytics/trackAlertAnalytics","src/analytics/trackAdministrationAnalytics","src/analytics/trackMentionAnalytics","src/analytics/trackGeotaggedAnalytics","src/analytics/trackGuiderAnalytics","src/analytics/trackInsightsCentralAnalytics","src/analytics/trackRulesAnalytics","src/analytics/trackQueryWizardAnalytics","src/analytics/trackLogoDetectionAnalytics","src/analytics/trackAdvertPopupAnalytics","src/analytics/trackFacebookCoverageAnalytics","src/analytics/trackInstagramCoverageAnalytics","src/analytics/trackQuickSearchAnalytics"],function(trackAppAnalytics,trackTagAnalytics,trackProjectAnalytics,trackQueryAnalytics,trackSignalsAnalytics,trackReportsAnalytics,trackDashboardAnalytics,trackDashboardExportAnalytics,trackComponentAnalytics,trackAlertAnalytics,trackAdministrationAnalytics,trackMentionAnalytics,trackGeotaggedAnalytics,trackGuiderAnalytics,trackInsightsCentralAnalytics,trackRulesAnalytics,trackQueryWizardAnalytics,trackLogoDetectionAnalytics,trackAdvertPopupAnalytics,trackFacebookCoverageAnalytics,trackInstagramCoverageAnalytics,trackQuickSearchAnalytics){"use strict";var initialized=false;function initializeAnalyticsObservers(){if(initialized){throw new Error("initializeAnalyticsObservers should not be called more than once")}trackAppAnalytics();trackTagAnalytics();trackProjectAnalytics();trackQueryAnalytics();trackSignalsAnalytics();trackReportsAnalytics();trackDashboardAnalytics();trackDashboardExportAnalytics();trackComponentAnalytics();trackMentionAnalytics();trackAlertAnalytics();trackAdministrationAnalytics();trackGeotaggedAnalytics();trackGuiderAnalytics();trackInsightsCentralAnalytics();trackRulesAnalytics();trackQueryWizardAnalytics();trackLogoDetectionAnalytics();trackAdvertPopupAnalytics();trackFacebookCoverageAnalytics();trackInstagramCoverageAnalytics();trackQuickSearchAnalytics();initialized=true}return initializeAnalyticsObservers});define("src/controls/settings",[],function(){"use strict";return{apiUrl:"https://newapi.brandwatch.com"}});define("src/controls/controlsEvents",["underscore","backbone"],function(_,Backbone){"use strict";return _.clone(Backbone.Events)});define("src/models/Group",["backbone","underscore"],function(Backbone,_){"use strict";return Backbone.Validations.Model.extend({isOwn:function isOwn(userId){return _(this.get("user")||this.get("users")).chain().pluck("id").contains(userId).value()},canEdit:function canEdit(userId){return this.isOwn(userId)||this.get("shared")==="public"},getOwner:function getOwner(){var user=this.get("user")||this.get("users");if(user&&user.length){return user[0].username||user[0].name}return"n/a"}})});define("src/models/GroupCollection",["backbone","underscore","src/models/Group"],function(Backbone,_,Group){"use strict";return Backbone.Collection.extend({model:Group,initialize:function initialize(models,options){options=options||{};this.projectId=options.projectId},getUserGroups:function getUserGroups(userId){return this.filter(function(model){return model.isOwn(userId)})},getSharedGroups:function getSharedGroups(userId){return this.filter(function(model){return!model.isOwn(userId)})},getPrivateGroups:function getPrivateGroups(ids){var self=this;return _(_.isArray(ids)?ids:this.pluck("id")).chain().map(function(id){var model=self.get(id);return model&&model.get("shared")==="private"?model:false}).compact().value()},comparator:function comparator(group){return(group.get("name")||"").toLowerCase()}})});define("src/models/SiteGroup",["src/models/Group"],function(Group){"use strict";return Group.extend({defaults:function defaults(){return{domains:[],sharedProjectIds:[]}},url:function url(){return"/projects/{projectId}/group/site/"+(this.id||"")},isOwn:function isOwn(userId){return this.get("userId")===userId},getOwner:function getOwner(){return this.get("userName")||"n/a"}})});define("src/models/SiteGroupCollection",["src/models/GroupCollection","src/models/SiteGroup"],function(GroupCollection,SiteGroup){"use strict";return GroupCollection.extend({model:SiteGroup,url:function url(){return"/projects/{projectId}/group/site/summary"},parse:function parse(data){return data.results}})});define("src/globals/siteGroups",["src/globals/currentProject","src/models/SiteGroupCollection"],function(currentProject,SiteGroupCollection){"use strict";var siteGroups=new SiteGroupCollection;currentProject.onLoad(function(callback){siteGroups.projectId=currentProject.id;if(!currentProject.id){siteGroups.reset([],{silent:false});return}siteGroups.reset([],{silent:true});siteGroups.fetch({success:function success(){callback()},error:function error(model,err){callback(err)}})});return siteGroups});define("src/helpers/instagramApiHelper",["q","underscore","src/globals/flags","src/globals/flagNames","bw-fe-helpers/promiseHelper","bw-fe-helpers/windowHelper"],function(Q,_,flags,FLAGS,promiseHelper,windowHelper){"use strict";var INSTAGRAM_CHANNELS_ENDPOINT_PREFIX="/instagramlogin/channels/";var INSTAGRAM_HASHTAGS_ENDPOINT_PREFIX="/instagramlogin/hashtags/";var INSTAGRAM_USER_SEARCH_COUNT=42;var PROFILE_NOT_FOUND="user-not-found";var PROFILE_NOT_AVAILABLE="account-not-available";var GENERIC_ERROR="failed-fetch";var NO_ACCESSTOKEN="no-accesstoken";var INVALID_TOKEN="invalid-token";var RATE_LIMITED="Too many requests made recently, please try again later";var ERROR_INSTAGRAM_PROFILE_UNAVAILABLE="you cannot view this resource";var CHANNELS_MODE="channels";function helpersFactory(mode){var INSTAGRAM_ENDPOINT_PREFIX=mode===CHANNELS_MODE?INSTAGRAM_CHANNELS_ENDPOINT_PREFIX:INSTAGRAM_HASHTAGS_ENDPOINT_PREFIX;return{PROFILE_NOT_FOUND:PROFILE_NOT_FOUND,PROFILE_NOT_AVAILABLE:PROFILE_NOT_AVAILABLE,GENERIC_ERROR:GENERIC_ERROR,RATE_LIMITED:RATE_LIMITED,NO_ACCESSTOKEN:NO_ACCESSTOKEN,INVALID_TOKEN:INVALID_TOKEN,get:function get(url,data){return promiseHelper.ajax({url:"/instagramapi/"+url,data:data||{}})},getSelf:function getSelf(){var self=this;return self.get("users/self").then(function(response){if(!response.data||response.data.username===undefined){throw new Error(INVALID_TOKEN)}return response.data},function(response){if(response.status===429){throw new Error(RATE_LIMITED)}throw new Error(GENERIC_ERROR)})},getProfileInfo:function getProfileInfo(username){var self=this;var exactUserMatch;return self.get("users/search",{q:username,count:INSTAGRAM_USER_SEARCH_COUNT}).then(function(response){if(!response.data||response.data.length===0){throw new Error(PROFILE_NOT_FOUND)}exactUserMatch=_.findWhere(response.data,{username:username.toLowerCase()});if(!exactUserMatch){throw new Error(PROFILE_NOT_FOUND)}return self.get("users/"+exactUserMatch.id)},function(error){if(error.message===ERROR_INSTAGRAM_PROFILE_UNAVAILABLE){throw new Error(PROFILE_NOT_AVAILABLE)}throw new Error(GENERIC_ERROR)}).then(function(response){_.extend(exactUserMatch,response.data);return exactUserMatch})},login:function login(callback){var windowObject=windowHelper.getWindow();windowHelper.open(INSTAGRAM_ENDPOINT_PREFIX+"login_request","instagram_signin","height=300,width=400,location=1,status=1,resizable=1,scrollbars=1");windowObject.instagramLoginError=function(error){delete windowObject.instagramLoginError;callback(error)};windowObject.instagramLoginSuccess=function(){delete windowObject.instagramLoginSuccess;callback()}},getLoginStatus:function getLoginStatus(){return promiseHelper.ajax({url:INSTAGRAM_ENDPOINT_PREFIX+"login_status"})},logout:function logout(){return promiseHelper.ajax({url:INSTAGRAM_ENDPOINT_PREFIX+"logout"})},reauth:function reauth(callback){var windowObject=windowHelper.getWindow();windowHelper.open(INSTAGRAM_ENDPOINT_PREFIX+"reauth_request","instagram_reauth","height=300,width=400,location=1,status=1,resizable=1,scrollbars=1");windowObject.instagramLoginError=function(error){delete windowObject.instagramLoginError;callback(error)};windowObject.instagramLoginSuccess=function(){delete windowObject.instagramLoginSuccess;callback()}}}}return{getChannelsHelper:function getChannelsHelper(){var api=helpersFactory(CHANNELS_MODE);var TOKEN_STATE={HOT:"HOT",WARM:"WARM",COLD:"COLD"};function getAccessToken(){return promiseHelper.ajax({url:INSTAGRAM_CHANNELS_ENDPOINT_PREFIX+"accessToken"})}function getTokenState(){if(flags.variation(FLAGS.ENABLE_INSTAGRAM_TOKEN_STATUS_CHECK)){return promiseHelper.ajax({url:INSTAGRAM_CHANNELS_ENDPOINT_PREFIX+"token_state"})}return Q.resolve({state:TOKEN_STATE.COLD})}api.TOKEN_STATE=TOKEN_STATE;api.getAccessToken=getAccessToken;api.getTokenState=getTokenState;return api}}});define("mustache!templates/channelTwitterInfo",["lib/mustache"],function(mustache){var escapedTemplate='<p class="smallmargin-bottom">Use a Twitter Channel to monitor all tweets on a Twitter Account. Twitter Channels require you to authorise with Twitter.</p>\n<p>Although it needs to be set up differently from standard Queries, a Twitter Channel is a <strong>Data Source</strong> that can be treated the same.</p>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!templates/channelFacebookInfo",["lib/mustache"],function(mustache){var escapedTemplate='<p class="smallmargin-bottom">Use a Facebook Channel to monitor posts and comments on a public Facebook page. Facebook Channels require you to authenticate with Facebook.</p>\n<p>Although it is set up differently to a standard Query, a Facebook Channel is a <strong>Data Source</strong> and can be used in the same way.</p>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!templates/channelInstagramInfo",["lib/mustache"],function(mustache){var escapedTemplate='<p class="smallmargin-bottom">Use an Instagram Channel to monitor all posts and comments on an owned Instagram account.</p>\n<p>To create an Instagram Channel, you\'ll need to authenticate with the desired account.</p>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(iter){if(Symbol.iterator in Object(iter)||Object.prototype.toString.call(iter)==="[object Arguments]")return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}}define("src/DataSourceManager",["underscore","mustache!templates/channelTwitterInfo","mustache!templates/channelFacebookInfo","mustache!templates/channelInstagramInfo","src/globals/crimsonMode","src/globals/flags","src/globals/flagNames"],function(_,twitterInfoTpl,facebookInfoTpl,instagramInfoTpl,crimsonMode,flags,FLAGS){"use strict";var SUPPORTED_CHANNELS={twitter:{name:"Twitter",description:"Twitter Channel",createNew:"Create a Twitter Channel",successfulCreationMessage:"We are now tracking your Channel. "+"If this is the first time this channel has been tracked, we are only able to collect data from this point onwards.",noAuthHTML:"We need to authenticate you to create a Twitter Channel.<br>Please authenticate with Twitter.",label:"Enter a Twitter profile name or URL",placeholder:"e.g. https://twitter.com/unicef",domain:"twitter.com",text:twitterInfoTpl(),iconClass:"icon-bwtwitter"},publicfacebook:{name:"Facebook",description:"Facebook Channel",createNew:"Create a Facebook Channel",successfulCreationMessage:"We are collecting your historic posts and comments data, this may take a few hours.",noAuthHTML:"We need to authenticate you to create a Facebook Channel.<br>Please authenticate with Facebook.",label:"Enter a Facebook profile name or URL",placeholder:"e.g. https://www.facebook.com/unicef",domain:"facebook.com",text:facebookInfoTpl(),iconClass:"icon-bwfacebook-square"},instagram:{name:"Instagram",description:"Instagram Channel",createNew:"Create an Instagram Channel",successfulCreationMessage:"We are now tracking your Channel. "+"If this is the first time this channel has been tracked, "+"we will gather all new posts made to the channel and collect historical data.",noAuthHTML:"Please use the button below to authenticate with the desired Instagram "+"Channel. You'll need the username and password of the account.",label:"Enter an Instagram profile name or URL",placeholder:"e.g. https://instagram.com/unicef",domain:"instagram.com",text:instagramInfoTpl(),iconClass:"icon-bwinstagram"}};var filteredChannels=function filteredChannels(obj,keys){return Object.assign.apply(Object,[{}].concat(_toConsumableArray(Object.keys(obj).filter(function(k){return!keys.includes(k)}).map(function(k){return _defineProperty({},k,obj[k])}))))};var getSupportedChannels=function getSupportedChannels(){return flags.variation(FLAGS.HIDE_FB_AND_INSTAGRAM_SETUP)?filteredChannels(SUPPORTED_CHANNELS,["publicfacebook","instagram"]):SUPPORTED_CHANNELS};var WEB_QUERY_DEFINITION={text:{name:"Query",description:"Query"}};var MONITOR_QUERY_DEFINITION={monitor:{name:"Monitor",description:"monitor"}};var LOGO_QUERY_DEFINITION={logo:{name:"Logo Query",description:"Logo Query"}};function preparePlaceholder(text){return"-- Select "+text+" --"}return{addChannel:function addChannel(channelName,options){if(getSupportedChannels()[channelName]){throw new Error('Channel "'+channelName+'" already in client.')}getSupportedChannels()[channelName]=options||{}},removeChannel:function removeChannel(channelName){if(!getSupportedChannels||!getSupportedChannels()[channelName]){throw new Error('Channel "'+channelName+'" not found in client.')}delete getSupportedChannels()[channelName]},hasChannels:function hasChannels(){return _.keys(getSupportedChannels()).length>0},hasChannel:function hasChannel(channelName){return!!getSupportedChannels()[channelName]},getChannels:function getChannels(){return _.clone(getSupportedChannels())},getChannelsNames:function getChannelsNames(){return Object.keys(getSupportedChannels())},getSupportedQueryTypes:function getSupportedQueryTypes(){return _.extend({},getSupportedChannels(),LOGO_QUERY_DEFINITION,crimsonMode.enabled()?MONITOR_QUERY_DEFINITION:WEB_QUERY_DEFINITION)},getSelectPlaceHolderForAlternateDataSource:function getSelectPlaceHolderForAlternateDataSource(){return preparePlaceholder("another")},getDataSourceSelectPlaceholder:function getDataSourceSelectPlaceholder(queryTypes){return preparePlaceholder(this.getDataSourceName(queryTypes))},getDataSourceName:function getDataSourceName(queryTypes){var typeConf;if(queryTypes&&queryTypes.length===1){typeConf=this.getSupportedQueryTypes()[queryTypes[0]]}return typeConf&&typeConf.description||"Query / Channel"}}});define("mustache!templates/queryTypeSelection",["lib/mustache"],function(mustache){var escapedTemplate='<h1 class="popuptitletext singlemargin-bottom draggable">Choose Query Type</h1>\n{{#dailyAllowance}}\n<div class="dailyAllowanceWarning notification-warning fullwidth smallpadding-vertical singlepadding-horizontal doublemargin-bottom"><div class="bold">Warning</div> All Queries/Channels will be limited to {{dailyAllowance}} mentions per day</div>\n{{/dailyAllowance}}\n<ul>\n{{#queryTypes}}\n<li class="{{className}} rowBorder{{#isDefault}} selected{{/isDefault}}">\n<input type="radio" {{#isDefault}}checked="checked"{{/isDefault}} name="query-type" id="{{id}}" class="{{className}}" value="{{id}}">\n<label for="{{id}}" class="smallpadding-left">{{name}}{{#isBeta}}<span class="betaIcon"></span>{{/isBeta}}{{#isNew}}<span class="newIcon"></span>{{/isNew}}</label>\n{{#helpKey}}<a class="help icon-bwhelp" data-key="{{helpKey}}"></a>{{/helpKey}}\n</li>\n{{/queryTypes}}\n</ul>\n<p class="submit doublemargin-top">\n<button class="continue defaultbutton" autofocus>Continue</button>\n<button class="cancel button rounded singlemargin-left">Cancel</button>\n</p>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/views/QueryTypeSelectionView",["backbone","underscore","jquery","src/packages/spin","src/DataSourceManager","mustache!templates/queryTypeSelection"],function(Backbone,_,$,spin,DataSourceManager,template){"use strict";var WEB_QUERY_TYPE="text";var QUERY_TYPES={WEB_QUERY:{id:"text",name:"Web Query",className:"create-web-query",helpKey:"query-creation-web-query"},CHANNEL:{id:"channel",name:"Channel",className:"create-channel",helpKey:"query-creation-channel"}};var QueryTypeSelectionView=Backbone.View.extend({className:"queryTypeSelection modular",template:template,events:{"click .cancel":"onCancel","click .continue":"onContinue","click li":"onTypeClicked"},initialize:function initialize(options){this.queryTypes=[];this.defaultQueryType=options&&options.defaultQueryType;if(options&&options.allowedQueryTypes){var allowedQueryTypes=_(options.allowedQueryTypes);var channelQueryTypes=DataSourceManager.getChannelsNames();var areChannelsAllowed=allowedQueryTypes.intersection(channelQueryTypes).length>0;var isWebQueryAllowed=allowedQueryTypes.contains(WEB_QUERY_TYPE);if(isWebQueryAllowed){this.queryTypes.push(QUERY_TYPES.WEB_QUERY)}if(areChannelsAllowed){this.queryTypes.push(QUERY_TYPES.CHANNEL)}}else{this.queryTypes=_.values(QUERY_TYPES)}if(!this.defaultQueryType){this.defaultQueryType=this.queryTypes[0].id}if(options){this.dailyAllowance=options.dailyAllowance}},render:function render(){var defaultQueryType=this.defaultQueryType;var displayedQueryTypes=this.queryTypes.map(function(queryType){return defaultQueryType===queryType.id?_.extend({isDefault:true},queryType):queryType});this.$el.html(this.template({queryTypes:displayedQueryTypes,dailyAllowance:this.dailyAllowance}))},loading:function loading(){this.$el.spin(_.extend({},spin.defaults,{top:150,left:150}))},close:function close(){this.remove()},onCancel:function onCancel(e){e.preventDefault();this.close()},onContinue:function onContinue(e){e.preventDefault();this.trigger("confirmed",this.$('input[name="query-type"]:checked').val())},onTypeClicked:function onTypeClicked(e){var $li=$(e.target).closest("li");$li.siblings().removeClass("selected").find('input[name="query-type"]').prop("checked",false);$li.addClass("selected").find('input[name="query-type"]').prop("checked",true)}},{show:function show(options){var view=new QueryTypeSelectionView(options),oldRemove=view.remove;view.render();view.$el.showModal({draggable:".draggable",className:"popup smallpopup",onClose:function onClose(){oldRemove.call(view);if(options.onClose){options.onClose()}}});view.remove=function(){view.$el.removeModal()};return view}});return QueryTypeSelectionView});(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==="object"&&typeof module==="object")module.exports=factory(require("underscore"),require("jquery"));else if(typeof define==="function"&&define.amd)define("bw-fe-helpers/ModelBackup",["underscore","jquery"],factory);else{var a=typeof exports==="object"?factory(require("underscore"),require("jquery")):factory(root["underscore"],root["jquery"]);for(var i in a)(typeof exports==="object"?exports:root)[i]=a[i]}})(this,function(__WEBPACK_EXTERNAL_MODULE__1__,__WEBPACK_EXTERNAL_MODULE__6__){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=27)}({1:function(module,exports){module.exports=__WEBPACK_EXTERNAL_MODULE__1__},27:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",function(){return ModelBackup});var underscore__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1);var underscore__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(underscore__WEBPACK_IMPORTED_MODULE_0__);var jquery__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(6);var jquery__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_1__);function ModelBackup(model){if(!model){throw new Error("ModelBackup must be initialized with a model")}var backup=jquery__WEBPACK_IMPORTED_MODULE_1___default.a.extend(true,{},model.attributes);this.restore=function(){model.clear({silent:true}).set(backup)};this.hasChanges=function(){return!underscore__WEBPACK_IMPORTED_MODULE_0___default.a.isEqual(backup,model.toJSON())}}},6:function(module,exports){module.exports=__WEBPACK_EXTERNAL_MODULE__6__}})["default"]});define("src/models/Language",["backbone"],function(Backbone){"use strict";return Backbone.Model.extend({initialize:function initialize(options){this.set({id:options.code||options.id})}})});define("src/models/LanguageCollection",["backbone","src/models/Language"],function(Backbone,Language){"use strict";var LanguageCollection=Backbone.Collection.extend({model:Language,url:"/languages/",parse:function parse(data){return data.results}});LanguageCollection.instance=new LanguageCollection;LanguageCollection.instance.fetch=function(options){if(this.fetched){if(options&&options.success){options.success.call(this)}return}this.fetched=true;LanguageCollection.prototype.fetch.call(this,options)};return LanguageCollection});define("src/components/mentions/_testsearch/models/TestSearchResult",["backbone"],function(Backbone){"use strict";return Backbone.Model.extend({})});define("src/querybuilder/queryUsageEstimationHelper",["underscore"],function(_){"use strict";var AVERAGE_PROCESSED_MENTION_RATE=.76;function getEstimate(totalResults,samplePercentage){if(_.isUndefined(totalResults)){return}samplePercentage=samplePercentage||100;return Math.ceil(totalResults*samplePercentage/100*AVERAGE_PROCESSED_MENTION_RATE)}return{getEstimate:getEstimate}});define("src/components/mentions/_testsearch/models/TestSearchResultsCollection",["backbone","underscore","bw-fe-helpers/validationHelpers","src/components/mentions/_testsearch/models/TestSearchResult","bw-fe-helpers/dateHelper","src/querybuilder/queryUsageEstimationHelper"],function(Backbone,_,validationHelpers,TestSearchResult,dateHelper,queryUsageEstimationHelper){"use strict";function validateNotEmpty(options,key){var value=options[key];if(validationHelpers.isNullOrEmpty(value)){throw new Error('TestSearchResultsCollection must have a "'+key+'" property in options passed to fetch()')}}return Backbone.Collection.extend({model:TestSearchResult,url:function url(){return"/projects/{projectId}/testsearch/mentions/"},initialize:function initialize(models,options){var settings=_.defaults(options||{},{page:0,pageSize:20});settings.page=Math.max(settings.page,0);this.page=settings.page;this.pageSize=settings.pageSize},clear:function clear(){this.page=0;this.total=0;this.totalPages=0;delete this.startDate;delete this.endDate;Backbone.Collection.prototype.reset.call(this)},_getRequiredOptionNames:function _getRequiredOptionNames(){return["term","langCode","languageAgnostic"]},_getOptionalOptionNames:function _getOptionalOptionNames(){return["page","pageSize","exclusionSnippetIds","inclusionSnippetIds"]},getRequiredOptions:function getRequiredOptions(){return _.pick(this,this._getRequiredOptionNames())},fetch:function fetch(options){var collection=this;var requiredOptionNames=this._getRequiredOptionNames();var optionalOptionNames=this._getOptionalOptionNames();var optionNames=[].concat(requiredOptionNames,optionalOptionNames);_.extend(this,_.pick(options||{},optionNames));requiredOptionNames.forEach(function(key){validateNotEmpty(collection,key)});return Backbone.Collection.prototype.fetch.call(this,options)},sync:function sync(method,model,options){method="create";return Backbone.sync(method,model,options)},getQueryData:function getQueryData(){var payload={resultsPage:this.page,resultsPageSize:this.pageSize,languages:this.langCode,queryString:this.term,languageAgnostic:this.languageAgnostic};if(this.exclusionSnippetIds){payload.exclusionSnippets=this.exclusionSnippetIds}if(this.inclusionSnippetIds){payload.inclusionSnippets=this.inclusionSnippetIds}return payload},parse:function parse(res){this.total=res.resultsTotal;this.paginationLimit=res.paginationLimit;this.totalPages=Math.ceil(this.total/this.pageSize);this.firstMentionIndex=res.resultsPage*this.pageSize+1;this.lastMentionIndex=res.resultsPage*this.pageSize+res.results.length;this.startDate=res.startDate;this.endDate=res.endDate;return _(res.results).map(function(result){result.id=result.url;if(result.hasOwnProperty("publicationName")&&!(_.isUndefined(result.publicationName)||_.isNull(result.publicationName))){result.isOfflinePublication=true}else{result.isOfflinePublication=false}return result})},nextPage:function nextPage(){this.page++;this.fetch()},previousPage:function previousPage(){var page=this.page-1;this.page=page<0?0:page;this.fetch()},goToPage:function goToPage(index){this.page=index<0?0:index;this.fetch()},pagingInfo:function pagingInfo(){return{page:this.page,hasResults:this.length>0,hasMoreThanOnePage:this.totalPages>1,firstMentionIndex:this.firstMentionIndex,lastMentionIndex:this.lastMentionIndex,total:this.total}},getLimitedTotalResults:function getLimitedTotalResults(){var resultsLimit=this.paginationLimit*this.pageSize;if(this.total>resultsLimit){return resultsLimit}return this.total},resultsMetaData:function resultsMetaData(samplingPercent){var days=dateHelper.daysBetween(this.startDate,this.endDate),averagePerDay=this.total/days,estimatedDailyResults,estimatedMonthlyResults;samplingPercent=samplingPercent||100;estimatedDailyResults=queryUsageEstimationHelper.getEstimate(averagePerDay,samplingPercent);estimatedMonthlyResults=estimatedDailyResults*30;return{estimatedDailyResults:Math.ceil(estimatedDailyResults),estimatedMonthlyResults:Math.ceil(estimatedMonthlyResults)}}})});define("src/models/AlertControls",["underscore","src/models/Controls"],function(_,Controls){"use strict";function updateOldAttributeNames(attrs){if(!_.isUndefined(attrs.count)){attrs.pageSize=attrs.count;delete attrs.count}if(!_.isUndefined(attrs.start)&&!_.isUndefined(attrs.pageSize)){attrs.page=parseInt(attrs.start/attrs.pageSize,10);delete attrs.start}if(!_.isUndefined(attrs.term)){attrs.search=attrs.term;delete attrs.term}}return Controls.extend({defaults:function defaults(){var defaults=Controls.prototype.defaults.apply(this,arguments);return _.defaults(defaults,{sort:"date",direction:"desc",pageSize:20,page:0})},set:function set(attrs){updateOldAttributeNames(attrs);return Controls.prototype.set.apply(this,arguments)},getQueryDataFieldNames:function getQueryDataFieldNames(){return Controls.prototype.getQueryDataFieldNames.apply(this,arguments).concat(["count","page","pageSize","search","projectId"])}})});function _typeof(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}define("src/models/Alert",["jquery","backbone","underscore","src/models/AlertControls"],function($,Backbone,_,AlertControls){"use strict";var ALERT_THRESHOLD_MAX=2147483647;function validateSettings(attrs,modelSettings,errors){var settingsError;if(attrs.settings&&modelSettings){settingsError=modelSettings.validate(attrs.settings);if(settingsError){errors.settings=settingsError}}}function validateAlertThreshold(threshold,errors){var value=""+threshold;if(!/^[0-9]+$/.test(value.trim())||value<=0||value>ALERT_THRESHOLD_MAX){errors.threshold="Threshold must be a non-zero positive integer"}}function validateType(attrs,modelAlertTypes,errors){var alertTypes=(!_.isUndefined(attrs.alertTypes)?attrs.alertTypes:modelAlertTypes)||[];if(!_.isUndefined(attrs.alertTypes)&&(!attrs.alertTypes||!attrs.alertTypes.length)){errors.scheduledAlertEnabled="Please select at least one alert type";errors.thresholdAlertEnabled="Please select at least one alert type"}if(alertTypes.indexOf("threshold")>=0){validateAlertThreshold(attrs.threshold,errors)}}function validateName(attrs,errors){if(!_.isUndefined(attrs.name)&&(!attrs.name||!attrs.name.trim())){errors.name="Alert name is required"}}function validateRecipients(attrs,errors){if(attrs.recipients.length===0&&!attrs.emailCreator){errors.recipient="Please select at least one recipient";return}}function initializeAttributeSettings(attrs){if(!attrs){return}attrs.settings=attrs.settings||{};attrs=_.extend({},attrs);if(attrs.queryId){attrs.settings.queryId=attrs.queryId}if(attrs.queryName){attrs.settings.queryName=attrs.queryName}if(attrs.projectId){attrs.settings.projectId=attrs.projectId}return attrs}function removeUnnecessarySettingsAttrs(attrs){if(!attrs||!attrs.settings){return}delete attrs.settings.queryId;delete attrs.settings.projectId;delete attrs.settings.dateRange;delete attrs.settings.startDate;delete attrs.settings.endDate;delete attrs.settings.fixedDateRange;delete attrs.settings.count;delete attrs.settings.start;delete attrs.settings.page;delete attrs.settings.pageSize;delete attrs.settings.sort;delete attrs.settings.direction;return attrs}var Alert=Backbone.Validations.Model.extend({defaults:function defaults(){return{name:"",enabled:true,scheduledAlertEnabled:false,thresholdAlertEnabled:false,threshold:Alert.DEFAULT_ALERT_THRESHOLD,alertTypes:[],recipients:[],frequency:1440,hourOfDay:8,dayOfWeek:1,queryId:null,mentionsPerAlert:5,settings:{queryId:null}}},url:function url(){return"/alerts/?projectId={projectId}"+(this.id?"&id="+this.id:"")},set:function set(key,val,options){if(key===null){return this}var attrs;if(_typeof(key)==="object"){attrs=key;options=val}else{(attrs={})[key]=val}options||(options={});if(attrs&&!options.unset){if(!this.settings){this.settings=new AlertControls({dateRange:"P31D"})}attrs=initializeAttributeSettings(attrs);if(!this.settings.set(attrs.settings,options)){return false}if(attrs.settings.queryId){attrs.queryId=attrs.settings.queryId}if(attrs.settings.queryName){attrs.queryName=attrs.settings.queryName}attrs.settings=this.settings.getQueryData();attrs=removeUnnecessarySettingsAttrs(attrs)}return Backbone.Validations.Model.prototype.set.call(this,attrs,options)},destroy:function destroy(options){Backbone.Model.prototype.destroy.call(this,_({url:this.url()}).extend(options))},validate:function validate(attrs){if(!attrs||!_(attrs).keys().length){return null}var errors={};validateSettings(attrs,this.settings,errors);validateType(attrs,this.get("alertTypes"),errors);validateName(attrs,errors);validateRecipients(attrs,errors);return _(errors).keys().length?errors:null},parse:function parse(response){response.settings=response.filter||response.settings;delete response.filter;return response},getQueryData:function getQueryData(){var queryData=$.extend(true,{},this.toJSON());queryData.filter=queryData.settings;delete queryData.settings;return queryData}},{DEFAULT_ALERT_THRESHOLD:200,ALERT_THRESHOLD_MAX:ALERT_THRESHOLD_MAX});return Alert});define("src/models/Backfill",["backbone","underscore"],function(Backbone,_){"use strict";return Backbone.Model.extend({initialize:function initialize(options){var projectId=options.projectId;if(!projectId&&this.collection){projectId=this.collection.projectId}if(!projectId){throw new Error("Backfill must be initialized with a projectId")}if(!options.queryId){throw new Error("Backfill must be initialized with a queryId")}this.projectId=projectId;this.queryId=options.queryId},url:function url(){return"/projects/"+this.projectId+"/queries/"+this.queryId+"/backfill/"+(this.id||"")},sync:function sync(method,model,options){if(_(["update","create"]).indexOf(method)!==-1){options=options||{};if(!options.attrs){options.attrs=model.toJSON(options)}if(options.attrs.projectId){delete options.attrs.projectId}}Backbone.sync.call(this,method,model,options)}})});define("src/signals/helpers/signalsGroupValidators",["underscore","bw-fe-helpers/validationHelpers"],function(_,validationHelpers){"use strict";function getUniqueSubscriberEmails(subscribers){return _.uniq(_.pluck(subscribers,"emailAddress"))}return{validate:function validate(attrs){var errors={};if(validationHelpers.isNullOrEmptyString(attrs.name)){errors.name="Signal should have a name"}if(validationHelpers.isNullOrEmptyArray(attrs.subscribers)){errors.subscribers="Signal requires at least one subscriber"}if(validationHelpers.isNullOrEmptyArray(attrs.queryIds)){errors.queryIds="Signal requires a query"}if(attrs.subscribers.length!==getUniqueSubscriberEmails(attrs.subscribers).length){errors.uniqueSubscribers="Subscriber emails should be unique"}return errors}}});define("src/signals/models/SignalsGroup",["underscore","backbone","src/signals/helpers/signalsGroupValidators"],function(_,Backbone,signalsGroupValidators){"use strict";var SUBSCRIBER_NOTIFICATION_THRESHOLD_MAPPING={low:1,med:2,high:3};function mapSubscribersThreshold(subscribers,thresholdMap){return subscribers.map(function(subscriber){return{emailAddress:subscriber.emailAddress,notificationThreshold:thresholdMap[subscriber.notificationThreshold]||subscriber.notificationThreshold}})}return Backbone.Model.extend({validate:function validate(attrs){var errors=signalsGroupValidators.validate(attrs);if(Object.keys(errors).length){return errors}},getQueryData:function getQueryData(){var data=this.toJSON();if(Array.isArray(data.subscribers)){data.subscribers=mapSubscribersThreshold(data.subscribers,SUBSCRIBER_NOTIFICATION_THRESHOLD_MAPPING)}return data},parse:function parse(data){if(data&&Array.isArray(data.subscribers)){data.subscribers=mapSubscribersThreshold(data.subscribers,_(SUBSCRIBER_NOTIFICATION_THRESHOLD_MAPPING).invert())}return data},url:function url(){return"/projects/{projectId}/signals/groups/"+(this.id?this.id:"")}})});define("src/signals/models/SignalsGroupCollection",["backbone","src/signals/models/SignalsGroup"],function(Backbone,SignalsGroup){"use strict";return Backbone.Collection.extend({url:function url(){return"/projects/{projectId}/signals/groups"},model:SignalsGroup,parse:function parse(data){return data.results}})});define("src/signals/helpers/signalsNameHelper",["bw-fe-helpers/promiseHelper","src/signals/models/SignalsGroupCollection"],function(promiseHelper,SignalsGroupCollection){"use strict";function getUniqueSignalsName(signals,proposedName,count){var signalsName;count=count||0;signalsName=count===0?proposedName:proposedName+"-"+count;if(signals.findWhere({name:signalsName})){return getUniqueSignalsName(signals,proposedName,count+1)}return signalsName}function getSignalsName(name){var signalsGroupCollection=new SignalsGroupCollection;return promiseHelper.wrapJqXHR(signalsGroupCollection.fetch()).then(function(){return getUniqueSignalsName(signalsGroupCollection,name)}).catch(function(){return name})}return{getSignalsName:getSignalsName}});define("src/querybuilder/queryFormHelper",["jquery","moment","src/globals/me","src/globals/flags","src/globals/flagNames","src/models/Alert","src/models/Backfill","src/signals/helpers/signalsNameHelper","src/signals/models/SignalsGroup","bw-fe-helpers/promiseHelper","lib/jquery.notify"],function($,moment,me,flags,FLAGS,Alert,Backfill,signalsNameHelper,SignalsGroup,promiseHelper){"use strict";var DEFAULT_BACKFILL_TO_DATE=moment.utc("2010-06-01");var UHD_BACKFILL_MONTHS=36;var queryFormHelper;function generateBackfillValues(pricing,backfillToDate){var numMonths=0,startOfMonth=moment.utc().startOf("month"),to=backfillToDate||DEFAULT_BACKFILL_TO_DATE,values=[],newPricing=pricing.toJSON()||{},mom,maxBackfillMonths=startOfMonth.diff(to,"months");if(newPricing){numMonths=(parseInt(newPricing.availableBackfillMonths,10)||-1)+1}if(numMonths===0||numMonths>maxBackfillMonths){numMonths=maxBackfillMonths}while(--numMonths){mom=startOfMonth.clone().subtract(numMonths,"months");values.unshift({label:mom.format("MMMM YYYY"),value:numMonths,hint:numMonths+" Month"+(numMonths!==1?"s":"")})}return values}function isUnlimitedHistoricalDataBackfill(query){var isExistingQuery;var unlimitedHistoricalData;if(!queryFormHelper.uhdEnabled){return false}isExistingQuery=!!(query&&query.id);unlimitedHistoricalData=query.get("unlimitedHistoricalData")||{};if(isExistingQuery&&!unlimitedHistoricalData.unlimitedHistoricalDataEnabled){return false}return true}function generateResearchQueryBackfillValues(){var startDate=moment.utc("2013-03-01");var endDate=moment.utc().startOf("month");var maxBackfillMonths=endDate.diff(startDate,"months");return new Array(maxBackfillMonths).fill(undefined).map(function(currentValue,index){var backByMonths=index+1;var mom=endDate.clone().subtract(backByMonths,"months");return{label:mom.format("MMMM YYYY"),value:backByMonths,hint:"".concat(backByMonths," Month").concat(backByMonths!==1?"s":"")}})}function getResearchQueriesBackfillData(backfillData){backfillData.allowBackfill=true;backfillData.backfillValues=generateResearchQueryBackfillValues();var firstBackfillValue=backfillData.backfillValues[0];backfillData.initialBackfillValue=firstBackfillValue.value;backfillData.initialBackfillLabel=firstBackfillValue.label;return backfillData}queryFormHelper={uhdEnabled:false,getBackfillData:function getBackfillData(pricing,query,backfillToDate){var availableBackfillMonths=pricing.get("availableBackfillMonths")||1;var isNonLegacyPricing=!pricing.get("isLegacy");var isUhdBackfill=isUnlimitedHistoricalDataBackfill(query);var backfillData={allowBackfill:!isUhdBackfill&&isNonLegacyPricing&&availableBackfillMonths!==1,uhdBackfill:isUhdBackfill};if(flags.variation(FLAGS.ENABLE_RESEARCH_QUERIES)&&query.get("type")==="decahose"){backfillData=getResearchQueriesBackfillData(backfillData)}else if(backfillData.uhdBackfill){backfillData.initialBackfillValue=UHD_BACKFILL_MONTHS;backfillData.initialBackfillLabel=moment().utc().subtract(UHD_BACKFILL_MONTHS,"months").format("MMMM YYYY")}else if(backfillData.allowBackfill){backfillData.backfillValues=generateBackfillValues(pricing,backfillToDate);backfillData.initialBackfillValue=backfillData.backfillValues[0]&&backfillData.backfillValues[0].value;backfillData.initialBackfillLabel=backfillData.backfillValues[0]&&backfillData.backfillValues[0].label}return backfillData},createBackfill:function createBackfill(query,duration,onDone){var minDate=moment.utc().subtract(duration||1,"months"),backfill=new Backfill({projectId:query.projectId,queryId:query.id,minDate:minDate.format("YYYY-MM-DD")});if(!onDone){onDone=function onDone(err){if(!err){return}$.notify({text:err,className:"notification-error"})}}backfill.save({},{success:function success(){onDone(undefined)},error:function error(){onDone("Failed to create Backfill for this Query. Please contact support.")}})},createAlert:function createAlert(options){options=options||{};var query=options.query;var alert;if(!options.query){throw new Error("options.query must be passed")}if(!options.threshold){throw new Error("options.threshold must be passed")}alert=new Alert({queryId:query.get("id"),name:query.get("name")+" Alert",projectId:query.get("projectId"),threshold:options.threshold,alertTypes:["threshold"],emailCreator:true});return promiseHelper.wrapJqXHR(alert.save({validate:true}))},createSignal:function createSignal(options){options=options||{};var query=options.query;var subscribers;var signalData;var signalsGroup=new SignalsGroup;if(!query){throw new Error("options.query must be passed")}subscribers=options.subscribers||[{emailAddress:me.get("username"),notificationThreshold:"high"}];return signalsNameHelper.getSignalsName(query.get("name")+" Signal").then(function(signalsName){signalData={queryIds:[query.get("id")],name:signalsName,subscribers:subscribers};return promiseHelper.wrapJqXHR(signalsGroup.save(signalData))})},isValidAlertThreshold:function isValidAlertThreshold(alertThreshold){return!isNaN(alertThreshold)&&alertThreshold>=1&&alertThreshold<=Alert.ALERT_THRESHOLD_MAX}};return queryFormHelper});define("mustache!templates/queryEditor",["lib/mustache"],function(mustache){var escapedTemplate='<div class="editor validation-wrapper" name="freeText" data-validation-message-required="You need to enter at least one search term"></div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("ace/mode/lucene_highlight_rules",["require","exports","module","../lib/oop","../lib/lang","./text_highlight_rules"],function(require,exports,module){"use strict";var oop=require("../lib/oop");var lang=require("../lib/lang");var TextHighlightRules=require("./text_highlight_rules").TextHighlightRules;var LuceneHighlightRules=function(){this.$rules={start:[{token:"constant.character.negation",regex:"[\\-]"},{token:"constant.character.interro",regex:"[\\?]"},{token:"constant.character.asterisk",regex:"[\\*]"},{token:"constant.character.proximity",regex:"~[0-9]+\\b"},{token:"keyword.operator",regex:"(?:AND|OR|NOT)\\b"},{token:"paren.lparen",regex:"[\\(]"},{token:"paren.rparen",regex:"[\\)]"},{token:"keyword",regex:"[\\S]+:"},{token:"string",regex:'".*?"'},{token:"text",regex:"\\s+"}]}};oop.inherits(LuceneHighlightRules,TextHighlightRules);exports.LuceneHighlightRules=LuceneHighlightRules});define("ace-mode-brandwatch/brandwatch_highlight_rules",["require","exports","module","ace/lib/oop","ace/mode/lucene_highlight_rules"],function(require,exports){"use strict";var oop=require("ace/lib/oop");var LuceneHighlightRules=require("ace/mode/lucene_highlight_rules").LuceneHighlightRules;var BrandwatchHighlightRules=function(){LuceneHighlightRules.call(this);var extendedRules=[{token:"keyword.operator.and",regex:"\\bAND\\b"},{token:"keyword.operator.or",regex:"\\bOR\\b"},{token:"keyword.operator.not",regex:"\\bNOT\\b"},{token:"keyword.operator.near",regex:"\\bNEAR/[0-9]+f?\\b"},{token:"keyword.author",regex:"\\bauthor:"},{token:"keyword.location",regex:"\\b(?:continent|location|country|state|county|city):"},{token:"keyword.raw",regex:"\\braw:"},{token:"keyword.site",regex:"\\bsite:"},{token:"keyword.title",regex:"\\btitle:"},{token:"keyword.url",regex:"\\burl:"},{token:"keyword.hashtags",regex:"\\bhashtags:"},{token:"keyword.at_mentions",regex:"\\bat_mentions:"},{token:"keyword.links",regex:"\\blinks:"}],replacementRules=_(this.$rules.start).chain().reject(function(rule){return rule.token==="keyword.operator"||rule.token==="keyword"}).map(function(rule){if(rule.token==="string"){return _.extend(rule,{regex:'".*?(?:"|$)'})}return rule}).concat(extendedRules).value();this.$rules={start:replacementRules}};oop.inherits(BrandwatchHighlightRules,LuceneHighlightRules);exports.BrandwatchHighlightRules=BrandwatchHighlightRules});define("ace-mode-brandwatch/brandwatch_completions",["require","exports","module","ace/token_iterator"],function(require,exports,module){"use strict";var TokenIterator=require("ace/token_iterator").TokenIterator;var commonOperators=[{name:"author",score:0},{name:"site",score:0},{name:"title",score:0},{name:"url",score:0}],locationOperators=[{name:"country",score:10},{name:"city",score:9},{name:"county",score:8},{name:"state",score:5},{name:"continent",score:2},{name:"location",score:1}],conjunctionOperators=[{name:"AND",score:10},{name:"OR",score:9},{name:"NEAR",score:8},{name:"~",score:7}];var globalOperators=commonOperators.concat(locationOperators);function hasType(token,type){var tokenTypes=token.type.split(".");return type.split(".").every(function(type){return tokenTypes.indexOf(type)!==-1})}function isKeywordOperator(token){return token.type.indexOf("keyword.operator")===0}function getFirstNonEmptyStringToken(session,pos){var iterator=new TokenIterator(session,pos.row,pos.column);var token=iterator.getCurrentToken();while(token&&token.value.indexOf(" ")===0){token=iterator.stepBackward();console.log("back token",token)}return token}function filterByPrefix(operators,prefix){return operators.filter(function(operator){return operator.name.toLowerCase().indexOf(prefix.toLowerCase())===0})}var BrandwatchCompletions=function(){};BrandwatchCompletions.prototype.getCompletions=function(state,session,pos,prefix,cb){var token=session.getTokenAt(pos.row,pos.column),getOperatorCompletions=this.getOperatorCompletions.bind(this),getConjunctionCompletions=this.getConjunctionCompletions.bind(this),getCompletions=function(token){var isString,isText;if(!token){return getOperatorCompletions(state,session,pos,prefix)}isString=hasType(token,"string");isText=hasType(token,"text");if(isString&&token.value==='"'){return[]}if((isString||isText)&&token.value.trim().length===0){return getCompletions(getFirstNonEmptyStringToken(session,pos))}if(isKeywordOperator(token)){return[].concat(getOperatorCompletions(state,session,pos,prefix))}if(isString||isText){return[].concat(getConjunctionCompletions(state,session,pos,prefix),getOperatorCompletions(state,session,pos,prefix))}return[]};return getCompletions(token)};BrandwatchCompletions.prototype.getOperatorCompletions=function(state,session,pos,prefix){var operators=globalOperators.slice(0);if(prefix){operators=filterByPrefix(operators,prefix)}return operators.map(function(operator){return{name:operator.name,value:operator.name+":",meta:"operator",score:operator.score}})};BrandwatchCompletions.prototype.getConjunctionCompletions=function(state,session,pos,prefix){return conjunctionOperators.map(function(operator){return{name:operator.name,value:operator.name,meta:"conjunction",score:9999}})};exports.BrandwatchCompletions=BrandwatchCompletions});define("ace/snippets",["require","exports","module","./lib/oop","./lib/event_emitter","./lib/lang","./range","./anchor","./keyboard/hash_handler","./tokenizer","./lib/dom","./editor"],function(require,exports,module){"use strict";var oop=require("./lib/oop");var EventEmitter=require("./lib/event_emitter").EventEmitter;var lang=require("./lib/lang");var Range=require("./range").Range;var Anchor=require("./anchor").Anchor;var HashHandler=require("./keyboard/hash_handler").HashHandler;var Tokenizer=require("./tokenizer").Tokenizer;var comparePoints=Range.comparePoints;var SnippetManager=function(){this.snippetMap={};this.snippetNameMap={}};(function(){oop.implement(this,EventEmitter);this.getTokenizer=function(){function TabstopToken(str,_,stack){str=str.substr(1);if(/^\d+$/.test(str)&&!stack.inFormatString)return[{tabstopId:parseInt(str,10)}];return[{text:str}]}function escape(ch){return"(?:[^\\\\"+ch+"]|\\\\.)"}SnippetManager.$tokenizer=new Tokenizer({start:[{regex:/:/,onMatch:function(val,state,stack){if(stack.length&&stack[0].expectIf){stack[0].expectIf=false;stack[0].elseBranch=stack[0];return[stack[0]]}return":"}},{regex:/\\./,onMatch:function(val,state,stack){var ch=val[1];if(ch=="}"&&stack.length){val=ch}else if("`$\\".indexOf(ch)!=-1){val=ch}else if(stack.inFormatString){if(ch=="n")val="\n";else if(ch=="t")val="\n";else if("ulULE".indexOf(ch)!=-1){val={changeCase:ch,local:ch>"a"}}}return[val]}},{regex:/}/,onMatch:function(val,state,stack){return[stack.length?stack.shift():val]}},{regex:/\$(?:\d+|\w+)/,onMatch:TabstopToken},{regex:/\$\{[\dA-Z_a-z]+/,onMatch:function(str,state,stack){var t=TabstopToken(str.substr(1),state,stack);stack.unshift(t[0]);return t},next:"snippetVar"},{regex:/\n/,token:"newline",merge:false}],snippetVar:[{regex:"\\|"+escape("\\|")+"*\\|",onMatch:function(val,state,stack){stack[0].choices=val.slice(1,-1).split(",")},next:"start"},{regex:"/("+escape("/")+"+)/(?:("+escape("/")+"*)/)(\\w*):?",onMatch:function(val,state,stack){var ts=stack[0];ts.fmtString=val;val=this.splitRegex.exec(val);ts.guard=val[1];ts.fmt=val[2];ts.flag=val[3];return""},next:"start"},{regex:"`"+escape("`")+"*`",onMatch:function(val,state,stack){stack[0].code=val.splice(1,-1);return""},next:"start"},{regex:"\\?",onMatch:function(val,state,stack){if(stack[0])stack[0].expectIf=true},next:"start"},{regex:"([^:}\\\\]|\\\\.)*:?",token:"",next:"start"}],formatString:[{regex:"/("+escape("/")+"+)/",token:"regex"},{regex:"",onMatch:function(val,state,stack){stack.inFormatString=true},next:"start"}]});SnippetManager.prototype.getTokenizer=function(){return SnippetManager.$tokenizer};return SnippetManager.$tokenizer};this.tokenizeTmSnippet=function(str,startState){return this.getTokenizer().getLineTokens(str,startState).tokens.map(function(x){return x.value||x})};this.$getDefaultValue=function(editor,name){if(/^[A-Z]\d+$/.test(name)){var i=name.substr(1);return(this.variables[name[0]+"__"]||{})[i]}if(/^\d+$/.test(name)){return(this.variables.__||{})[name]}name=name.replace(/^TM_/,"");if(!editor)return;var s=editor.session;switch(name){case"CURRENT_WORD":var r=s.getWordRange();case"SELECTION":case"SELECTED_TEXT":return s.getTextRange(r);case"CURRENT_LINE":return s.getLine(editor.getCursorPosition().row);case"PREV_LINE":return s.getLine(editor.getCursorPosition().row-1);case"LINE_INDEX":return editor.getCursorPosition().column;case"LINE_NUMBER":return editor.getCursorPosition().row+1;case"SOFT_TABS":return s.getUseSoftTabs()?"YES":"NO";case"TAB_SIZE":return s.getTabSize();case"FILENAME":case"FILEPATH":return"";case"FULLNAME":return"Ace"}};this.variables={};this.getVariableValue=function(editor,varName){if(this.variables.hasOwnProperty(varName))return this.variables[varName](editor,varName)||"";return this.$getDefaultValue(editor,varName)||""};this.tmStrFormat=function(str,ch,editor){var flag=ch.flag||"";var re=ch.guard;re=new RegExp(re,flag.replace(/[^gi]/,""));var fmtTokens=this.tokenizeTmSnippet(ch.fmt,"formatString");var _self=this;var formatted=str.replace(re,function(){_self.variables.__=arguments;var fmtParts=_self.resolveVariables(fmtTokens,editor);var gChangeCase="E";for(var i=0;i<fmtParts.length;i++){var ch=fmtParts[i];if(typeof ch=="object"){fmtParts[i]="";if(ch.changeCase&&ch.local){var next=fmtParts[i+1];if(next&&typeof next=="string"){if(ch.changeCase=="u")fmtParts[i]=next[0].toUpperCase();else fmtParts[i]=next[0].toLowerCase();fmtParts[i+1]=next.substr(1)}}else if(ch.changeCase){gChangeCase=ch.changeCase}}else if(gChangeCase=="U"){fmtParts[i]=ch.toUpperCase()}else if(gChangeCase=="L"){fmtParts[i]=ch.toLowerCase()}}return fmtParts.join("")});this.variables.__=null;return formatted};this.resolveVariables=function(snippet,editor){var result=[];for(var i=0;i<snippet.length;i++){var ch=snippet[i];if(typeof ch=="string"){result.push(ch)}else if(typeof ch!="object"){continue}else if(ch.skip){gotoNext(ch)}else if(ch.processed<i){continue}else if(ch.text){var value=this.getVariableValue(editor,ch.text);if(value&&ch.fmtString)value=this.tmStrFormat(value,ch);ch.processed=i;if(ch.expectIf==null){if(value){result.push(value);gotoNext(ch)}}else{if(value){ch.skip=ch.elseBranch}else gotoNext(ch)}}else if(ch.tabstopId!=null){result.push(ch)}else if(ch.changeCase!=null){result.push(ch)}}function gotoNext(ch){var i1=snippet.indexOf(ch,i+1);if(i1!=-1)i=i1}return result};this.insertSnippetForSelection=function(editor,snippetText){var cursor=editor.getCursorPosition();var line=editor.session.getLine(cursor.row);var tabString=editor.session.getTabString();var indentString=line.match(/^\s*/)[0];if(cursor.column<indentString.length)indentString=indentString.slice(0,cursor.column);snippetText=snippetText.replace(/\r/g,"");var tokens=this.tokenizeTmSnippet(snippetText);tokens=this.resolveVariables(tokens,editor);tokens=tokens.map(function(x){if(x=="\n")return x+indentString;if(typeof x=="string")return x.replace(/\t/g,tabString);return x});var tabstops=[];tokens.forEach(function(p,i){if(typeof p!="object")return;var id=p.tabstopId;var ts=tabstops[id];if(!ts){ts=tabstops[id]=[];ts.index=id;ts.value=""}if(ts.indexOf(p)!==-1)return;ts.push(p);var i1=tokens.indexOf(p,i+1);if(i1===-1)return;var value=tokens.slice(i+1,i1);var isNested=value.some(function(t){return typeof t==="object"});if(isNested&&!ts.value){ts.value=value}else if(value.length&&(!ts.value||typeof ts.value!=="string")){ts.value=value.join("")}});tabstops.forEach(function(ts){ts.length=0});var expanding={};function copyValue(val){var copy=[];for(var i=0;i<val.length;i++){var p=val[i];if(typeof p=="object"){if(expanding[p.tabstopId])continue;var j=val.lastIndexOf(p,i-1);p=copy[j]||{tabstopId:p.tabstopId}}copy[i]=p}return copy}for(var i=0;i<tokens.length;i++){var p=tokens[i];if(typeof p!="object")continue;var id=p.tabstopId;var i1=tokens.indexOf(p,i+1);if(expanding[id]){if(expanding[id]===p)expanding[id]=null;continue}var ts=tabstops[id];var arg=typeof ts.value=="string"?[ts.value]:copyValue(ts.value);arg.unshift(i+1,Math.max(0,i1-i));arg.push(p);expanding[id]=p;tokens.splice.apply(tokens,arg);if(ts.indexOf(p)===-1)ts.push(p)}var row=0,column=0;var text="";tokens.forEach(function(t){if(typeof t==="string"){var lines=t.split("\n");if(lines.length>1){column=lines[lines.length-1].length;row+=lines.length-1}else column+=t.length;text+=t}else{if(!t.start)t.start={row:row,column:column};else t.end={row:row,column:column}}});var range=editor.getSelectionRange();var end=editor.session.replace(range,text);var tabstopManager=new TabstopManager(editor);var selectionId=editor.inVirtualSelectionMode&&editor.selection.index;tabstopManager.addTabstops(tabstops,range.start,end,selectionId)};this.insertSnippet=function(editor,snippetText){var self=this;if(editor.inVirtualSelectionMode)return self.insertSnippetForSelection(editor,snippetText);editor.forEachSelection(function(){self.insertSnippetForSelection(editor,snippetText)},null,{keepOrder:true});if(editor.tabstopManager)editor.tabstopManager.tabNext()};this.$getScope=function(editor){var scope=editor.session.$mode.$id||"";scope=scope.split("/").pop();if(scope==="html"||scope==="php"){if(scope==="php"&&!editor.session.$mode.inlinePhp)scope="html";var c=editor.getCursorPosition();var state=editor.session.getState(c.row);if(typeof state==="object"){state=state[0]}if(state.substring){if(state.substring(0,3)=="js-")scope="javascript";else if(state.substring(0,4)=="css-")scope="css";else if(state.substring(0,4)=="php-")scope="php"}}return scope};this.getActiveScopes=function(editor){var scope=this.$getScope(editor);var scopes=[scope];var snippetMap=this.snippetMap;if(snippetMap[scope]&&snippetMap[scope].includeScopes){scopes.push.apply(scopes,snippetMap[scope].includeScopes)}scopes.push("_");return scopes};this.expandWithTab=function(editor,options){var self=this;var result=editor.forEachSelection(function(){return self.expandSnippetForSelection(editor,options)},null,{keepOrder:true});if(result&&editor.tabstopManager)editor.tabstopManager.tabNext();return result};this.expandSnippetForSelection=function(editor,options){var cursor=editor.getCursorPosition();var line=editor.session.getLine(cursor.row);var before=line.substring(0,cursor.column);var after=line.substr(cursor.column);var snippetMap=this.snippetMap;var snippet;this.getActiveScopes(editor).some(function(scope){var snippets=snippetMap[scope];if(snippets)snippet=this.findMatchingSnippet(snippets,before,after);return!!snippet},this);if(!snippet)return false;if(options&&options.dryRun)return true;editor.session.doc.removeInLine(cursor.row,cursor.column-snippet.replaceBefore.length,cursor.column+snippet.replaceAfter.length);this.variables.M__=snippet.matchBefore;this.variables.T__=snippet.matchAfter;this.insertSnippetForSelection(editor,snippet.content);this.variables.M__=this.variables.T__=null;return true};this.findMatchingSnippet=function(snippetList,before,after){for(var i=snippetList.length;i--;){var s=snippetList[i];if(s.startRe&&!s.startRe.test(before))continue;if(s.endRe&&!s.endRe.test(after))continue;if(!s.startRe&&!s.endRe)continue;s.matchBefore=s.startRe?s.startRe.exec(before):[""];s.matchAfter=s.endRe?s.endRe.exec(after):[""];s.replaceBefore=s.triggerRe?s.triggerRe.exec(before)[0]:"";s.replaceAfter=s.endTriggerRe?s.endTriggerRe.exec(after)[0]:"";return s}};this.snippetMap={};this.snippetNameMap={};this.register=function(snippets,scope){var snippetMap=this.snippetMap;var snippetNameMap=this.snippetNameMap;var self=this;if(!snippets)snippets=[];function wrapRegexp(src){if(src&&!/^\^?\(.*\)\$?$|^\\b$/.test(src))src="(?:"+src+")";return src||""}function guardedRegexp(re,guard,opening){re=wrapRegexp(re);guard=wrapRegexp(guard);if(opening){re=guard+re;if(re&&re[re.length-1]!="$")re=re+"$"}else{re=re+guard;if(re&&re[0]!="^")re="^"+re}return new RegExp(re)}function addSnippet(s){if(!s.scope)s.scope=scope||"_";scope=s.scope;if(!snippetMap[scope]){snippetMap[scope]=[];snippetNameMap[scope]={}}var map=snippetNameMap[scope];if(s.name){var old=map[s.name];if(old)self.unregister(old);map[s.name]=s}snippetMap[scope].push(s);if(s.tabTrigger&&!s.trigger){if(!s.guard&&/^\w/.test(s.tabTrigger))s.guard="\\b";s.trigger=lang.escapeRegExp(s.tabTrigger)}if(!s.trigger&&!s.guard&&!s.endTrigger&&!s.endGuard)return;s.startRe=guardedRegexp(s.trigger,s.guard,true);s.triggerRe=new RegExp(s.trigger,"",true);s.endRe=guardedRegexp(s.endTrigger,s.endGuard,true);s.endTriggerRe=new RegExp(s.endTrigger,"",true)}if(snippets&&snippets.content)addSnippet(snippets);else if(Array.isArray(snippets))snippets.forEach(addSnippet);this._signal("registerSnippets",{scope:scope})};this.unregister=function(snippets,scope){var snippetMap=this.snippetMap;var snippetNameMap=this.snippetNameMap;function removeSnippet(s){var nameMap=snippetNameMap[s.scope||scope];if(nameMap&&nameMap[s.name]){delete nameMap[s.name];var map=snippetMap[s.scope||scope];var i=map&&map.indexOf(s);if(i>=0)map.splice(i,1)}}if(snippets.content)removeSnippet(snippets);else if(Array.isArray(snippets))snippets.forEach(removeSnippet)};this.parseSnippetFile=function(str){str=str.replace(/\r/g,"");var list=[],snippet={};var re=/^#.*|^({[\s\S]*})\s*$|^(\S+) (.*)$|^((?:\n*\t.*)+)/gm;var m;while(m=re.exec(str)){if(m[1]){try{snippet=JSON.parse(m[1]);list.push(snippet)}catch(e){}}if(m[4]){snippet.content=m[4].replace(/^\t/gm,"");list.push(snippet);snippet={}}else{var key=m[2],val=m[3];if(key=="regex"){var guardRe=/\/((?:[^\/\\]|\\.)*)|$/g;snippet.guard=guardRe.exec(val)[1];snippet.trigger=guardRe.exec(val)[1];snippet.endTrigger=guardRe.exec(val)[1];snippet.endGuard=guardRe.exec(val)[1]}else if(key=="snippet"){snippet.tabTrigger=val.match(/^\S*/)[0];if(!snippet.name)snippet.name=val}else{snippet[key]=val}}}return list};this.getSnippetByName=function(name,editor){var snippetMap=this.snippetNameMap;var snippet;this.getActiveScopes(editor).some(function(scope){var snippets=snippetMap[scope];if(snippets)snippet=snippets[name];return!!snippet},this);return snippet}}).call(SnippetManager.prototype);var TabstopManager=function(editor){if(editor.tabstopManager)return editor.tabstopManager;editor.tabstopManager=this;this.$onChange=this.onChange.bind(this);this.$onChangeSelection=lang.delayedCall(this.onChangeSelection.bind(this)).schedule;this.$onChangeSession=this.onChangeSession.bind(this);this.$onAfterExec=this.onAfterExec.bind(this);this.attach(editor)};(function(){this.attach=function(editor){this.index=0;this.ranges=[];this.tabstops=[];this.$openTabstops=null;this.selectedTabstop=null;this.editor=editor;this.editor.on("change",this.$onChange);this.editor.on("changeSelection",this.$onChangeSelection);this.editor.on("changeSession",this.$onChangeSession);this.editor.commands.on("afterExec",this.$onAfterExec);this.editor.keyBinding.addKeyboardHandler(this.keyboardHandler)};this.detach=function(){this.tabstops.forEach(this.removeTabstopMarkers,this);this.ranges=null;this.tabstops=null;this.selectedTabstop=null;this.editor.removeListener("change",this.$onChange);this.editor.removeListener("changeSelection",this.$onChangeSelection);this.editor.removeListener("changeSession",this.$onChangeSession);this.editor.commands.removeListener("afterExec",this.$onAfterExec);this.editor.keyBinding.removeKeyboardHandler(this.keyboardHandler);this.editor.tabstopManager=null;this.editor=null};this.onChange=function(delta){var changeRange=delta;var isRemove=delta.action[0]=="r";var start=delta.start;var end=delta.end;var startRow=start.row;var endRow=end.row;var lineDif=endRow-startRow;var colDiff=end.column-start.column;if(isRemove){lineDif=-lineDif;colDiff=-colDiff}if(!this.$inChange&&isRemove){var ts=this.selectedTabstop;var changedOutside=ts&&!ts.some(function(r){return comparePoints(r.start,start)<=0&&comparePoints(r.end,end)>=0});if(changedOutside)return this.detach()}var ranges=this.ranges;for(var i=0;i<ranges.length;i++){var r=ranges[i];if(r.end.row<start.row)continue;if(isRemove&&comparePoints(start,r.start)<0&&comparePoints(end,r.end)>0){this.removeRange(r);i--;continue}if(r.start.row==startRow&&r.start.column>start.column)r.start.column+=colDiff;if(r.end.row==startRow&&r.end.column>=start.column)r.end.column+=colDiff;if(r.start.row>=startRow)r.start.row+=lineDif;if(r.end.row>=startRow)r.end.row+=lineDif;if(comparePoints(r.start,r.end)>0)this.removeRange(r)}if(!ranges.length)this.detach()};this.updateLinkedFields=function(){var ts=this.selectedTabstop;if(!ts||!ts.hasLinkedRanges)return;this.$inChange=true;var session=this.editor.session;var text=session.getTextRange(ts.firstNonLinked);for(var i=ts.length;i--;){var range=ts[i];if(!range.linked)continue;var fmt=exports.snippetManager.tmStrFormat(text,range.original);session.replace(range,fmt)}this.$inChange=false};this.onAfterExec=function(e){if(e.command&&!e.command.readOnly)this.updateLinkedFields()};this.onChangeSelection=function(){if(!this.editor)return;var lead=this.editor.selection.lead;var anchor=this.editor.selection.anchor;var isEmpty=this.editor.selection.isEmpty();for(var i=this.ranges.length;i--;){if(this.ranges[i].linked)continue;var containsLead=this.ranges[i].contains(lead.row,lead.column);var containsAnchor=isEmpty||this.ranges[i].contains(anchor.row,anchor.column);if(containsLead&&containsAnchor)return}this.detach()};this.onChangeSession=function(){this.detach()};this.tabNext=function(dir){var max=this.tabstops.length;var index=this.index+(dir||1);index=Math.min(Math.max(index,1),max);if(index==max)index=0;this.selectTabstop(index);if(index===0)this.detach()};this.selectTabstop=function(index){this.$openTabstops=null;var ts=this.tabstops[this.index];if(ts)this.addTabstopMarkers(ts);this.index=index;ts=this.tabstops[this.index];if(!ts||!ts.length)return;this.selectedTabstop=ts;if(!this.editor.inVirtualSelectionMode){var sel=this.editor.multiSelect;sel.toSingleRange(ts.firstNonLinked.clone());for(var i=ts.length;i--;){if(ts.hasLinkedRanges&&ts[i].linked)continue;sel.addRange(ts[i].clone(),true)}if(sel.ranges[0])sel.addRange(sel.ranges[0].clone())}else{this.editor.selection.setRange(ts.firstNonLinked)}this.editor.keyBinding.addKeyboardHandler(this.keyboardHandler)};this.addTabstops=function(tabstops,start,end){if(!this.$openTabstops)this.$openTabstops=[];if(!tabstops[0]){var p=Range.fromPoints(end,end);moveRelative(p.start,start);moveRelative(p.end,start);tabstops[0]=[p];tabstops[0].index=0}var i=this.index;var arg=[i+1,0];var ranges=this.ranges;tabstops.forEach(function(ts,index){var dest=this.$openTabstops[index]||ts;for(var i=ts.length;i--;){var p=ts[i];var range=Range.fromPoints(p.start,p.end||p.start);movePoint(range.start,start);movePoint(range.end,start);range.original=p;range.tabstop=dest;ranges.push(range);if(dest!=ts)dest.unshift(range);else dest[i]=range;if(p.fmtString){range.linked=true;dest.hasLinkedRanges=true}else if(!dest.firstNonLinked)dest.firstNonLinked=range}if(!dest.firstNonLinked)dest.hasLinkedRanges=false;if(dest===ts){arg.push(dest);this.$openTabstops[index]=dest}this.addTabstopMarkers(dest)},this);if(arg.length>2){if(this.tabstops.length)arg.push(arg.splice(2,1)[0]);this.tabstops.splice.apply(this.tabstops,arg)}};this.addTabstopMarkers=function(ts){var session=this.editor.session;ts.forEach(function(range){if(!range.markerId)range.markerId=session.addMarker(range,"ace_snippet-marker","text")})};this.removeTabstopMarkers=function(ts){var session=this.editor.session;ts.forEach(function(range){session.removeMarker(range.markerId);range.markerId=null})};this.removeRange=function(range){var i=range.tabstop.indexOf(range);range.tabstop.splice(i,1);i=this.ranges.indexOf(range);this.ranges.splice(i,1);this.editor.session.removeMarker(range.markerId);if(!range.tabstop.length){i=this.tabstops.indexOf(range.tabstop);if(i!=-1)this.tabstops.splice(i,1);if(!this.tabstops.length)this.detach()}};this.keyboardHandler=new HashHandler;this.keyboardHandler.bindKeys({Tab:function(ed){if(exports.snippetManager&&exports.snippetManager.expandWithTab(ed)){return}ed.tabstopManager.tabNext(1)},"Shift-Tab":function(ed){ed.tabstopManager.tabNext(-1)},Esc:function(ed){ed.tabstopManager.detach()},Return:function(ed){return false}})}).call(TabstopManager.prototype);var changeTracker={};changeTracker.onChange=Anchor.prototype.onChange;changeTracker.setPosition=function(row,column){this.pos.row=row;this.pos.column=column};changeTracker.update=function(pos,delta,$insertRight){this.$insertRight=$insertRight;this.pos=pos;this.onChange(delta)};var movePoint=function(point,diff){if(point.row==0)point.column+=diff.column;point.row+=diff.row};var moveRelative=function(point,start){if(point.row==start.row)point.column-=start.column;point.row-=start.row};require("./lib/dom").importCssString(".ace_snippet-marker {    -moz-box-sizing: border-box;    box-sizing: border-box;    background: rgba(194, 193, 208, 0.09);    border: 1px dotted rgba(211, 208, 235, 0.62);    position: absolute;}");exports.snippetManager=new SnippetManager;var Editor=require("./editor").Editor;(function(){this.insertSnippet=function(content,options){return exports.snippetManager.insertSnippet(this,content,options)};this.expandSnippet=function(options){return exports.snippetManager.expandWithTab(this,options)}}).call(Editor.prototype)});define("ace/autocomplete/popup",["require","exports","module","../virtual_renderer","../editor","../range","../lib/event","../lib/lang","../lib/dom"],function(require,exports,module){"use strict";var Renderer=require("../virtual_renderer").VirtualRenderer;var Editor=require("../editor").Editor;var Range=require("../range").Range;var event=require("../lib/event");var lang=require("../lib/lang");var dom=require("../lib/dom");var $singleLineEditor=function(el){var renderer=new Renderer(el);renderer.$maxLines=4;var editor=new Editor(renderer);editor.setHighlightActiveLine(false);editor.setShowPrintMargin(false);editor.renderer.setShowGutter(false);editor.renderer.setHighlightGutterLine(false);editor.$mouseHandler.$focusWaitTimout=0;editor.$highlightTagPending=true;return editor};var AcePopup=function(parentNode){var el=dom.createElement("div");var popup=new $singleLineEditor(el);if(parentNode)parentNode.appendChild(el);el.style.display="none";popup.renderer.content.style.cursor="default";popup.renderer.setStyle("ace_autocomplete");popup.setOption("displayIndentGuides",false);popup.setOption("dragDelay",150);var noop=function(){};popup.focus=noop;popup.$isFocused=true;popup.renderer.$cursorLayer.restartTimer=noop;popup.renderer.$cursorLayer.element.style.opacity=0;popup.renderer.$maxLines=8;popup.renderer.$keepTextAreaAtCursor=false;popup.setHighlightActiveLine(false);popup.session.highlight("");popup.session.$searchHighlight.clazz="ace_highlight-marker";popup.on("mousedown",function(e){var pos=e.getDocumentPosition();popup.selection.moveToPosition(pos);selectionMarker.start.row=selectionMarker.end.row=pos.row;e.stop()});var lastMouseEvent;var hoverMarker=new Range(-1,0,-1,Infinity);var selectionMarker=new Range(-1,0,-1,Infinity);selectionMarker.id=popup.session.addMarker(selectionMarker,"ace_active-line","fullLine");popup.setSelectOnHover=function(val){if(!val){hoverMarker.id=popup.session.addMarker(hoverMarker,"ace_line-hover","fullLine")}else if(hoverMarker.id){popup.session.removeMarker(hoverMarker.id);hoverMarker.id=null}};popup.setSelectOnHover(false);popup.on("mousemove",function(e){if(!lastMouseEvent){lastMouseEvent=e;return}if(lastMouseEvent.x==e.x&&lastMouseEvent.y==e.y){return}lastMouseEvent=e;lastMouseEvent.scrollTop=popup.renderer.scrollTop;var row=lastMouseEvent.getDocumentPosition().row;if(hoverMarker.start.row!=row){if(!hoverMarker.id)popup.setRow(row);setHoverMarker(row)}});popup.renderer.on("beforeRender",function(){if(lastMouseEvent&&hoverMarker.start.row!=-1){lastMouseEvent.$pos=null;var row=lastMouseEvent.getDocumentPosition().row;if(!hoverMarker.id)popup.setRow(row);setHoverMarker(row,true)}});popup.renderer.on("afterRender",function(){var row=popup.getRow();var t=popup.renderer.$textLayer;var selected=t.element.childNodes[row-t.config.firstRow];if(selected==t.selectedNode)return;if(t.selectedNode)dom.removeCssClass(t.selectedNode,"ace_selected");t.selectedNode=selected;if(selected)dom.addCssClass(selected,"ace_selected")});var hideHoverMarker=function(){setHoverMarker(-1)};var setHoverMarker=function(row,suppressRedraw){if(row!==hoverMarker.start.row){hoverMarker.start.row=hoverMarker.end.row=row;if(!suppressRedraw)popup.session._emit("changeBackMarker");popup._emit("changeHoverMarker")}};popup.getHoveredRow=function(){return hoverMarker.start.row};event.addListener(popup.container,"mouseout",hideHoverMarker);popup.on("hide",hideHoverMarker);popup.on("changeSelection",hideHoverMarker);popup.session.doc.getLength=function(){return popup.data.length};popup.session.doc.getLine=function(i){var data=popup.data[i];if(typeof data=="string")return data;return data&&data.value||""};var bgTokenizer=popup.session.bgTokenizer;bgTokenizer.$tokenizeRow=function(row){var data=popup.data[row];var tokens=[];if(!data)return tokens;if(typeof data=="string")data={value:data};if(!data.caption)data.caption=data.value||data.name;var last=-1;var flag,c;for(var i=0;i<data.caption.length;i++){c=data.caption[i];flag=data.matchMask&1<<i?1:0;if(last!==flag){tokens.push({type:data.className||""+(flag?"completion-highlight":""),value:c});last=flag}else{tokens[tokens.length-1].value+=c}}if(data.meta){var maxW=popup.renderer.$size.scrollerWidth/popup.renderer.layerConfig.characterWidth;var metaData=data.meta;if(metaData.length+data.caption.length>maxW-2){metaData=metaData.substr(0,maxW-data.caption.length-3)+""}tokens.push({type:"rightAlignedText",value:metaData})}return tokens};bgTokenizer.$updateOnChange=noop;bgTokenizer.start=noop;popup.session.$computeWidth=function(){return this.screenWidth=0};popup.$blockScrolling=Infinity;popup.isOpen=false;popup.isTopdown=false;popup.data=[];popup.setData=function(list){popup.setValue(lang.stringRepeat("\n",list.length),-1);popup.data=list||[];popup.setRow(0)};popup.getData=function(row){return popup.data[row]};popup.getRow=function(){return selectionMarker.start.row};popup.setRow=function(line){line=Math.max(0,Math.min(this.data.length,line));if(selectionMarker.start.row!=line){popup.selection.clearSelection();selectionMarker.start.row=selectionMarker.end.row=line||0;popup.session._emit("changeBackMarker");popup.moveCursorTo(line||0,0);if(popup.isOpen)popup._signal("select")}};popup.on("changeSelection",function(){if(popup.isOpen)popup.setRow(popup.selection.lead.row);popup.renderer.scrollCursorIntoView()});popup.hide=function(){this.container.style.display="none";this._signal("hide");popup.isOpen=false};popup.show=function(pos,lineHeight,topdownOnly){var el=this.container;var screenHeight=window.innerHeight;var screenWidth=window.innerWidth;var renderer=this.renderer;var maxH=renderer.$maxLines*lineHeight*1.4;var top=pos.top+this.$borderSize;var allowTopdown=top>screenHeight/2&&!topdownOnly;if(allowTopdown&&top+lineHeight+maxH>screenHeight){renderer.$maxPixelHeight=top-2*this.$borderSize;el.style.top="";el.style.bottom=screenHeight-top+"px";popup.isTopdown=false}else{top+=lineHeight;renderer.$maxPixelHeight=screenHeight-top-.2*lineHeight;el.style.top=top+"px";el.style.bottom="";popup.isTopdown=true}el.style.display="";this.renderer.$textLayer.checkForSizeChanges();var left=pos.left;if(left+el.offsetWidth>screenWidth)left=screenWidth-el.offsetWidth;el.style.left=left+"px";this._signal("show");lastMouseEvent=null;popup.isOpen=true};popup.getTextLeftOffset=function(){return this.$borderSize+this.renderer.$padding+this.$imageSize};popup.$imageSize=0;popup.$borderSize=1;return popup};dom.importCssString(".ace_editor.ace_autocomplete .ace_marker-layer .ace_active-line {    background-color: #CAD6FA;    z-index: 1;}.ace_editor.ace_autocomplete .ace_line-hover {    border: 1px solid #abbffe;    margin-top: -1px;    background: rgba(233,233,253,0.4);}.ace_editor.ace_autocomplete .ace_line-hover {    position: absolute;    z-index: 2;}.ace_editor.ace_autocomplete .ace_scroller {   background: none;   border: none;   box-shadow: none;}.ace_rightAlignedText {    color: gray;    display: inline-block;    position: absolute;    right: 4px;    text-align: right;    z-index: -1;}.ace_editor.ace_autocomplete .ace_completion-highlight{    color: #000;    text-shadow: 0 0 0.01em;}.ace_editor.ace_autocomplete {    width: 280px;    z-index: 200000;    background: #fbfbfb;    color: #444;    border: 1px lightgray solid;    position: fixed;    box-shadow: 2px 3px 5px rgba(0,0,0,.2);    line-height: 1.4;}");exports.AcePopup=AcePopup});define("ace/autocomplete/util",["require","exports","module"],function(require,exports,module){"use strict";exports.parForEach=function(array,fn,callback){var completed=0;var arLength=array.length;if(arLength===0)callback();for(var i=0;i<arLength;i++){fn(array[i],function(result,err){completed++;if(completed===arLength)callback(result,err)})}};var ID_REGEX=/[a-zA-Z_0-9\$\-\u00A2-\uFFFF]/;exports.retrievePrecedingIdentifier=function(text,pos,regex){regex=regex||ID_REGEX;var buf=[];for(var i=pos-1;i>=0;i--){if(regex.test(text[i]))buf.push(text[i]);else break}return buf.reverse().join("")};exports.retrieveFollowingIdentifier=function(text,pos,regex){regex=regex||ID_REGEX;var buf=[];for(var i=pos;i<text.length;i++){if(regex.test(text[i]))buf.push(text[i]);else break}return buf};exports.getCompletionPrefix=function(editor){var pos=editor.getCursorPosition();var line=editor.session.getLine(pos.row);var prefix;editor.completers.forEach(function(completer){if(completer.identifierRegexps){completer.identifierRegexps.forEach(function(identifierRegex){if(!prefix&&identifierRegex)prefix=this.retrievePrecedingIdentifier(line,pos.column,identifierRegex)}.bind(this))}}.bind(this));return prefix||this.retrievePrecedingIdentifier(line,pos.column)}});define("ace/autocomplete",["require","exports","module","./keyboard/hash_handler","./autocomplete/popup","./autocomplete/util","./lib/event","./lib/lang","./lib/dom","./snippets"],function(require,exports,module){"use strict";var HashHandler=require("./keyboard/hash_handler").HashHandler;var AcePopup=require("./autocomplete/popup").AcePopup;var util=require("./autocomplete/util");var event=require("./lib/event");var lang=require("./lib/lang");var dom=require("./lib/dom");var snippetManager=require("./snippets").snippetManager;var Autocomplete=function(){this.autoInsert=false;this.autoSelect=true;this.exactMatch=false;this.gatherCompletionsId=0;this.keyboardHandler=new HashHandler;this.keyboardHandler.bindKeys(this.commands);this.blurListener=this.blurListener.bind(this);this.changeListener=this.changeListener.bind(this);this.mousedownListener=this.mousedownListener.bind(this);this.mousewheelListener=this.mousewheelListener.bind(this);this.changeTimer=lang.delayedCall(function(){this.updateCompletions(true)}.bind(this));this.tooltipTimer=lang.delayedCall(this.updateDocTooltip.bind(this),50)};(function(){this.$init=function(){this.popup=new AcePopup(document.body||document.documentElement);this.popup.on("click",function(e){this.insertMatch();e.stop()}.bind(this));this.popup.focus=this.editor.focus.bind(this.editor);this.popup.on("show",this.tooltipTimer.bind(null,null));this.popup.on("select",this.tooltipTimer.bind(null,null));this.popup.on("changeHoverMarker",this.tooltipTimer.bind(null,null));return this.popup};this.getPopup=function(){return this.popup||this.$init()};this.openPopup=function(editor,prefix,keepPopupPosition){if(!this.popup)this.$init();this.popup.setData(this.completions.filtered);editor.keyBinding.addKeyboardHandler(this.keyboardHandler);var renderer=editor.renderer;this.popup.setRow(this.autoSelect?0:-1);if(!keepPopupPosition){this.popup.setTheme(editor.getTheme());this.popup.setFontSize(editor.getFontSize());var lineHeight=renderer.layerConfig.lineHeight;var pos=renderer.$cursorLayer.getPixelPosition(this.base,true);pos.left-=this.popup.getTextLeftOffset();var rect=editor.container.getBoundingClientRect();pos.top+=rect.top-renderer.layerConfig.offset;pos.left+=rect.left-editor.renderer.scrollLeft;pos.left+=renderer.gutterWidth;this.popup.show(pos,lineHeight)}else if(keepPopupPosition&&!prefix){this.detach()}};this.detach=function(){this.editor.keyBinding.removeKeyboardHandler(this.keyboardHandler);this.editor.off("changeSelection",this.changeListener);this.editor.off("blur",this.blurListener);this.editor.off("mousedown",this.mousedownListener);this.editor.off("mousewheel",this.mousewheelListener);this.changeTimer.cancel();this.hideDocTooltip();this.gatherCompletionsId+=1;if(this.popup&&this.popup.isOpen)this.popup.hide();if(this.base)this.base.detach();this.activated=false;this.completions=this.base=null};this.changeListener=function(e){var cursor=this.editor.selection.lead;if(cursor.row!=this.base.row||cursor.column<this.base.column){this.detach()}if(this.activated)this.changeTimer.schedule();else this.detach()};this.blurListener=function(e){if(e.relatedTarget&&e.relatedTarget.nodeName=="A"&&e.relatedTarget.href){window.open(e.relatedTarget.href,"_blank")}var el=document.activeElement;var text=this.editor.textInput.getElement();var fromTooltip=e.relatedTarget&&e.relatedTarget==this.tooltipNode;var container=this.popup&&this.popup.container;if(el!=text&&el.parentNode!=container&&!fromTooltip&&el!=this.tooltipNode&&e.relatedTarget!=text){this.detach()}};this.mousedownListener=function(e){this.detach()};this.mousewheelListener=function(e){this.detach()};this.goTo=function(where){var row=this.popup.getRow();var max=this.popup.session.getLength()-1;switch(where){case"up":row=row<=0?max:row-1;break;case"down":row=row>=max?-1:row+1;break;case"start":row=0;break;case"end":row=max;break}this.popup.setRow(row)};this.insertMatch=function(data,options){if(!data)data=this.popup.getData(this.popup.getRow());if(!data)return false;if(data.completer&&data.completer.insertMatch){data.completer.insertMatch(this.editor,data)}else{if(this.completions.filterText){var ranges=this.editor.selection.getAllRanges();for(var i=0,range;range=ranges[i];i++){range.start.column-=this.completions.filterText.length;this.editor.session.remove(range)}}if(data.snippet)snippetManager.insertSnippet(this.editor,data.snippet);else this.editor.execCommand("insertstring",data.value||data)}this.detach()};this.commands={Up:function(editor){editor.completer.goTo("up")},Down:function(editor){editor.completer.goTo("down")},"Ctrl-Up|Ctrl-Home":function(editor){editor.completer.goTo("start")},"Ctrl-Down|Ctrl-End":function(editor){editor.completer.goTo("end")},Esc:function(editor){editor.completer.detach()},Return:function(editor){return editor.completer.insertMatch()},"Shift-Return":function(editor){editor.completer.insertMatch(null,{deleteSuffix:true})},Tab:function(editor){var result=editor.completer.insertMatch();if(!result&&!editor.tabstopManager)editor.completer.goTo("down");else return result},PageUp:function(editor){editor.completer.popup.gotoPageUp()},PageDown:function(editor){editor.completer.popup.gotoPageDown()}};this.gatherCompletions=function(editor,callback){var session=editor.getSession();var pos=editor.getCursorPosition();var line=session.getLine(pos.row);var prefix=util.getCompletionPrefix(editor);this.base=session.doc.createAnchor(pos.row,pos.column-prefix.length);this.base.$insertRight=true;var matches=[];var total=editor.completers.length;editor.completers.forEach(function(completer,i){completer.getCompletions(editor,session,pos,prefix,function(err,results){if(!err&&results)matches=matches.concat(results);var pos=editor.getCursorPosition();var line=session.getLine(pos.row);callback(null,{prefix:prefix,matches:matches,finished:--total===0})})});return true};this.showPopup=function(editor){if(this.editor)this.detach();this.activated=true;this.editor=editor;if(editor.completer!=this){if(editor.completer)editor.completer.detach();editor.completer=this}editor.on("changeSelection",this.changeListener);editor.on("blur",this.blurListener);editor.on("mousedown",this.mousedownListener);editor.on("mousewheel",this.mousewheelListener);this.updateCompletions()};this.updateCompletions=function(keepPopupPosition){if(keepPopupPosition&&this.base&&this.completions){var pos=this.editor.getCursorPosition();var prefix=this.editor.session.getTextRange({start:this.base,end:pos});if(prefix==this.completions.filterText)return;this.completions.setFilter(prefix);if(!this.completions.filtered.length)return this.detach();if(this.completions.filtered.length==1&&this.completions.filtered[0].value==prefix&&!this.completions.filtered[0].snippet)return this.detach();this.openPopup(this.editor,prefix,keepPopupPosition);return}var _id=this.gatherCompletionsId;this.gatherCompletions(this.editor,function(err,results){var detachIfFinished=function(){if(!results.finished)return;return this.detach()}.bind(this);var prefix=results.prefix;var matches=results&&results.matches;if(!matches||!matches.length)return detachIfFinished();if(prefix.indexOf(results.prefix)!==0||_id!=this.gatherCompletionsId)return;this.completions=new FilteredList(matches);if(this.exactMatch)this.completions.exactMatch=true;this.completions.setFilter(prefix);var filtered=this.completions.filtered;if(!filtered.length)return detachIfFinished();if(filtered.length==1&&filtered[0].value==prefix&&!filtered[0].snippet)return detachIfFinished();if(this.autoInsert&&filtered.length==1&&results.finished)return this.insertMatch(filtered[0]);this.openPopup(this.editor,prefix,keepPopupPosition)}.bind(this))};this.cancelContextMenu=function(){this.editor.$mouseHandler.cancelContextMenu()};this.updateDocTooltip=function(){var popup=this.popup;var all=popup.data;var selected=all&&(all[popup.getHoveredRow()]||all[popup.getRow()]);var doc=null;if(!selected||!this.editor||!this.popup.isOpen)return this.hideDocTooltip();this.editor.completers.some(function(completer){if(completer.getDocTooltip)doc=completer.getDocTooltip(selected);return doc});if(!doc)doc=selected;if(typeof doc=="string")doc={docText:doc};if(!doc||!(doc.docHTML||doc.docText))return this.hideDocTooltip();this.showDocTooltip(doc)};this.showDocTooltip=function(item){if(!this.tooltipNode){this.tooltipNode=dom.createElement("div");this.tooltipNode.className="ace_tooltip ace_doc-tooltip";this.tooltipNode.style.margin=0;this.tooltipNode.style.pointerEvents="auto";this.tooltipNode.tabIndex=-1;this.tooltipNode.onblur=this.blurListener.bind(this)}var tooltipNode=this.tooltipNode;if(item.docHTML){tooltipNode.innerHTML=item.docHTML}else if(item.docText){tooltipNode.textContent=item.docText}if(!tooltipNode.parentNode)document.body.appendChild(tooltipNode);var popup=this.popup;var rect=popup.container.getBoundingClientRect();tooltipNode.style.top=popup.container.style.top;tooltipNode.style.bottom=popup.container.style.bottom;if(window.innerWidth-rect.right<320){tooltipNode.style.right=window.innerWidth-rect.left+"px";tooltipNode.style.left=""}else{tooltipNode.style.left=rect.right+1+"px";tooltipNode.style.right=""}tooltipNode.style.display="block"};this.hideDocTooltip=function(){this.tooltipTimer.cancel();if(!this.tooltipNode)return;var el=this.tooltipNode;if(!this.editor.isFocused()&&document.activeElement==el)this.editor.focus();this.tooltipNode=null;if(el.parentNode)el.parentNode.removeChild(el)}}).call(Autocomplete.prototype);Autocomplete.startCommand={name:"startAutocomplete",exec:function(editor){if(!editor.completer)editor.completer=new Autocomplete;editor.completer.autoInsert=false;editor.completer.autoSelect=true;editor.completer.showPopup(editor);editor.completer.cancelContextMenu()},bindKey:"Ctrl-Space|Ctrl-Shift-Space|Alt-Space"};var FilteredList=function(array,filterText){this.all=array;this.filtered=array;this.filterText=filterText||"";this.exactMatch=false};(function(){this.setFilter=function(str){if(str.length>this.filterText&&str.lastIndexOf(this.filterText,0)===0)var matches=this.filtered;else var matches=this.all;this.filterText=str;matches=this.filterCompletions(matches,this.filterText);matches=matches.sort(function(a,b){return b.exactMatch-a.exactMatch||b.score-a.score});var prev=null;matches=matches.filter(function(item){var caption=item.snippet||item.caption||item.value;if(caption===prev)return false;prev=caption;return true});this.filtered=matches};this.filterCompletions=function(items,needle){var results=[];var upper=needle.toUpperCase();var lower=needle.toLowerCase();loop:for(var i=0,item;item=items[i];i++){var caption=item.value||item.caption||item.snippet;if(!caption)continue;var lastIndex=-1;var matchMask=0;var penalty=0;var index,distance;if(this.exactMatch){if(needle!==caption.substr(0,needle.length))continue loop}else{for(var j=0;j<needle.length;j++){var i1=caption.indexOf(lower[j],lastIndex+1);var i2=caption.indexOf(upper[j],lastIndex+1);index=i1>=0?i2<0||i1<i2?i1:i2:i2;if(index<0)continue loop;distance=index-lastIndex-1;if(distance>0){if(lastIndex===-1)penalty+=10;penalty+=distance}matchMask=matchMask|1<<index;lastIndex=index}}item.matchMask=matchMask;item.exactMatch=penalty?0:1;item.score=(item.score||0)-penalty;results.push(item)}return results}}).call(FilteredList.prototype);exports.Autocomplete=Autocomplete;exports.FilteredList=FilteredList});define("ace/autocomplete/text_completer",["require","exports","module","../range"],function(require,exports,module){var Range=require("../range").Range;var splitRegex=/[^a-zA-Z_0-9\$\-\u00C0-\u1FFF\u2C00-\uD7FF\w]+/;function getWordIndex(doc,pos){var textBefore=doc.getTextRange(Range.fromPoints({row:0,column:0},pos));return textBefore.split(splitRegex).length-1}function wordDistance(doc,pos){var prefixPos=getWordIndex(doc,pos);var words=doc.getValue().split(splitRegex);var wordScores=Object.create(null);var currentWord=words[prefixPos];words.forEach(function(word,idx){if(!word||word===currentWord)return;var distance=Math.abs(prefixPos-idx);var score=words.length-distance;if(wordScores[word]){wordScores[word]=Math.max(score,wordScores[word])}else{wordScores[word]=score}});return wordScores}exports.getCompletions=function(editor,session,pos,prefix,callback){var wordScore=wordDistance(session,pos,prefix);var wordList=Object.keys(wordScore);callback(null,wordList.map(function(word){return{caption:word,value:word,score:wordScore[word],meta:"local"}}))}});define("ace/ext/language_tools",["require","exports","module","../snippets","../autocomplete","../config","../lib/lang","../autocomplete/util","../autocomplete/text_completer","../editor","../config"],function(require,exports,module){"use strict";var snippetManager=require("../snippets").snippetManager;var Autocomplete=require("../autocomplete").Autocomplete;var config=require("../config");var lang=require("../lib/lang");var util=require("../autocomplete/util");var textCompleter=require("../autocomplete/text_completer");var keyWordCompleter={getCompletions:function(editor,session,pos,prefix,callback){if(session.$mode.completer){return session.$mode.completer.getCompletions(editor,session,pos,prefix,callback)}var state=editor.session.getState(pos.row);var completions=session.$mode.getCompletions(state,session,pos,prefix);callback(null,completions)}};var snippetCompleter={getCompletions:function(editor,session,pos,prefix,callback){var snippetMap=snippetManager.snippetMap;var completions=[];snippetManager.getActiveScopes(editor).forEach(function(scope){var snippets=snippetMap[scope]||[];for(var i=snippets.length;i--;){var s=snippets[i];var caption=s.name||s.tabTrigger;if(!caption)continue;completions.push({caption:caption,snippet:s.content,meta:s.tabTrigger&&!s.name?s.tabTrigger+" ":"snippet",type:"snippet"})}},this);callback(null,completions)},getDocTooltip:function(item){if(item.type=="snippet"&&!item.docHTML){item.docHTML=["<b>",lang.escapeHTML(item.caption),"</b>","<hr></hr>",lang.escapeHTML(item.snippet)].join("")}}};var completers=[snippetCompleter,textCompleter,keyWordCompleter];exports.setCompleters=function(val){completers.length=0;if(val)completers.push.apply(completers,val)};exports.addCompleter=function(completer){completers.push(completer)};exports.textCompleter=textCompleter;exports.keyWordCompleter=keyWordCompleter;exports.snippetCompleter=snippetCompleter;var expandSnippet={name:"expandSnippet",exec:function(editor){return snippetManager.expandWithTab(editor)},bindKey:"Tab"};var onChangeMode=function(e,editor){loadSnippetsForMode(editor.session.$mode)};var loadSnippetsForMode=function(mode){var id=mode.$id;if(!snippetManager.files)snippetManager.files={};loadSnippetFile(id);if(mode.modes)mode.modes.forEach(loadSnippetsForMode)};var loadSnippetFile=function(id){if(!id||snippetManager.files[id])return;var snippetFilePath=id.replace("mode","snippets");snippetManager.files[id]={};config.loadModule(snippetFilePath,function(m){if(m){snippetManager.files[id]=m;if(!m.snippets&&m.snippetText)m.snippets=snippetManager.parseSnippetFile(m.snippetText);snippetManager.register(m.snippets||[],m.scope);if(m.includeScopes){snippetManager.snippetMap[m.scope].includeScopes=m.includeScopes;m.includeScopes.forEach(function(x){loadSnippetFile("ace/mode/"+x)})}}})};var doLiveAutocomplete=function(e){var editor=e.editor;var hasCompleter=editor.completer&&editor.completer.activated;if(e.command.name==="backspace"){if(hasCompleter&&!util.getCompletionPrefix(editor))editor.completer.detach()}else if(e.command.name==="insertstring"){var prefix=util.getCompletionPrefix(editor);if(prefix&&!hasCompleter){if(!editor.completer){editor.completer=new Autocomplete}editor.completer.autoInsert=false;editor.completer.showPopup(editor)}}};var Editor=require("../editor").Editor;require("../config").defineOptions(Editor.prototype,"editor",{enableBasicAutocompletion:{set:function(val){if(val){if(!this.completers)this.completers=Array.isArray(val)?val:completers;this.commands.addCommand(Autocomplete.startCommand)}else{this.commands.removeCommand(Autocomplete.startCommand)}},value:false},enableLiveAutocompletion:{set:function(val){if(val){if(!this.completers)this.completers=Array.isArray(val)?val:completers;this.commands.on("afterExec",doLiveAutocomplete)}else{this.commands.removeListener("afterExec",doLiveAutocomplete)}},value:false},enableSnippets:{set:function(val){if(val){this.commands.addCommand(expandSnippet);this.on("changeMode",onChangeMode);onChangeMode(null,this)}else{this.commands.removeCommand(expandSnippet);this.off("changeMode",onChangeMode)}},value:false}})});define("ace-mode-brandwatch/location_completer",["require","exports","module","jquery","underscore","ace/token_iterator"],function(require,exports){"use strict";var $=require("jquery");var _=require("underscore");var TokenIterator=require("ace/token_iterator").TokenIterator;function LocationCompleter(options){options=options||{};this.apiUrl=options.apiUrl}LocationCompleter.prototype._getTokenFromSession=function(session,pos){return session.getTokenAt(pos.row,pos.column)};LocationCompleter.prototype._getPreviousToken=function(session,pos){var iterator=new TokenIterator(session,pos.row,pos.column);return iterator.stepBackward()};LocationCompleter.prototype._doApiRequest=function(prefix,type,callback){$.ajax({dataType:"json",url:this.apiUrl,data:{prefix:prefix,type:type}}).done(function(data){return callback(null,data.results)}).fail(function(){console.error("could not get autocomplete locations",arguments);return callback(null,[])})};LocationCompleter.prototype.getCompletions=function(editor,session,pos,prefix,callback){var self=this,token=this._getTokenFromSession(session,pos),results,previousToken,iterator;if(!token||token.type!=="text"){return callback(null,[])}previousToken=this._getPreviousToken(session,pos);if(!previousToken||previousToken.type!=="keyword.location"){return callback(null,[])}this._doApiRequest(token.value,previousToken.value.slice(0,previousToken.value.length-1),function(err,locations){results=locations.map(function(location){return{name:location.name,caption:location.fullName,value:location.name,meta:location.type,id:location.id,completer:self}});return callback(null,results)})};LocationCompleter.prototype.insertMatch=function(editor){var popup=editor.completer.popup,selectedValue=popup.getData(popup.getRow()),pos=editor.getCursorPosition(),session=editor.getSession(),cursorToken=session.getTokenAt(pos.row,pos.column);if(cursorToken.type==="text"){editor.removeWordLeft()}editor.execCommand("insertstring",selectedValue.id)};exports.locationCompleter={create:function(apiUrl){return new LocationCompleter(apiUrl)}}});define("ace-mode-brandwatch/autoclose_behaviour",["require","exports","module","ace/lib/oop","ace/mode/behaviour","ace/token_iterator"],function(require,exports){"use strict";var oop=require("ace/lib/oop"),Behaviour=require("ace/mode/behaviour").Behaviour,TokenIterator=require("ace/token_iterator").TokenIterator,SAFE_INSERT_IN_TOKENS=["text","paren.rparen"],SAFE_INSERT_BEFORE_TOKENS=["text","paren.rparen"],autoSurroundOnSelections,context,contextCache={};function initContext(editor){var id=-1;if(editor.multiSelect){id=editor.selection.id;if(contextCache.rangeCount!==editor.multiSelect.rangeCount){contextCache={rangeCount:editor.multiSelect.rangeCount}}}if(contextCache[id]){return context===contextCache[id]}context=contextCache[id]={autoInsertedBrackets:0,autoInsertedLineEnd:""}}function matchTokenType(token,types){var type=token.type||token;for(var i=0;i<types.length;i++){if(type.indexOf(types[i])===0){return true}}return false}function recordAutoInsert(editor,session,bracket){var cursor=editor.getCursorPosition(),line=session.doc.getLine(cursor.row);if(!isAutoInsertedClosing(cursor,line,context.autoInsertedLineEnd[0])){context.autoInsertedBrackets=0}context.autoInsertedLineEnd=bracket+line.substr(cursor.column);context.autoInsertedBrackets++}function isAutoInsertedClosing(cursor,line,bracket){return context.autoInsertedBrackets>0&&bracket===context.autoInsertedLineEnd[0]&&line.substr(cursor.column)===context.autoInsertedLineEnd}function popAutoInsertedClosing(){context.autoInsertedLineEnd=context.autoInsertedLineEnd.substr(1);context.autoInsertedBrackets--}function shouldAddClosingParenthesis(editor,session){var cursor=editor.getCursorPosition(),iterator=new TokenIterator(session,cursor.row,cursor.column),lookAheadIterator,lookAheadToken,currentToken=iterator.getCurrentToken()||{};if(currentToken.type==="text"&&currentToken.value[cursor.column-currentToken.start]===" "){return true}if(isCursorBeforeWord(editor.getSelectionRange(),currentToken)){return false}lookAheadIterator=new TokenIterator(session,cursor.row,cursor.column+1);lookAheadToken=lookAheadIterator.getCurrentToken();if(isCursorBeforeWord(editor.getSelectionRange(),lookAheadToken)){return false}if(!matchTokenType(currentToken.type||"text",SAFE_INSERT_IN_TOKENS)){if(!matchTokenType(lookAheadToken||"text",SAFE_INSERT_IN_TOKENS)){return false}}iterator.stepForward();return iterator.getCurrentTokenRow()!==cursor.row||matchTokenType(iterator.getCurrentToken()||"text",SAFE_INSERT_BEFORE_TOKENS)}function parenthesisInsertion(state,action,editor,session,text){if(text==="("){return parenthesisInsertionLeft(state,action,editor,session,text)}if(text===")"){return parenthesisInsertionRight(state,action,editor,session,text)}}function isCursorBeforeWord(selection,token){var rightChar;if(token&&token.type==="text"){rightChar=token.value[selection.start.column-token.start];if(rightChar!==" "&&typeof rightChar!=="undefined"){return true}}return false}function isCursorAfterWord(selection,token){var leftChar;if(token&&(token.type==="text"||token.type==="string")){leftChar=token.value[selection.start.column-token.start-1];if(leftChar!==" "&&typeof leftChar!=="undefined"){return true}}return false}function parenthesisInsertionLeft(state,action,editor,session){var selection=editor.getSelectionRange(),selected=session.doc.getTextRange(selection);initContext(editor);if(autoSurroundOnSelections&&selected!==""&&editor.getWrapBehavioursEnabled()){return{text:"("+selected+")",selection:false}}if(shouldAddClosingParenthesis(editor,session)){recordAutoInsert(editor,session,")");return{text:"()",selection:[1,1]}}}function parenthesisInsertionRight(state,action,editor,session,text){var cursor=editor.getCursorPosition(),line=session.doc.getLine(cursor.row),rightChar=line.substring(cursor.column,cursor.column+1),matching;initContext(editor);if(rightChar!==")"){return}matching=session.$findOpeningBracket(")",{column:cursor.column+1,row:cursor.row});if(matching!==null&&isAutoInsertedClosing(cursor,line,text)){popAutoInsertedClosing();return{text:"",selection:[1,1]}}}function parenthesisDeletion(state,action,editor,session,range){var selected=session.doc.getTextRange(range),line,rightChar;if(range.isMultiLine()||selected!=="("){return}initContext(editor);line=session.doc.getLine(range.start.row);rightChar=line.substring(range.start.column+1,range.start.column+2);if(rightChar!==")"){return}range.end.column++;return range}function isClosingStringQuote(selection,token,quote){var rightChar=token.value[selection.start.column-token.start];if(token.type!=="string"){return false}if(rightChar===quote){return true}if(rightChar!==" "&&typeof rightChar!=="undefined"){return true}return false}function addMatchingQuote(editor,quote){var selection=editor.getSelectionRange(),session=editor.getSession(),token=session.getTokenAt(selection.start.row,selection.start.column),nextToken=session.getTokenAt(selection.start.row,selection.start.column+1);if(!token){return true}if(token.type==="paren.lparen"&&(!nextToken||nextToken.type==="paren.rparen")){return true}if(token.type!=="string"&&token.type!=="text"){return false}if(isClosingStringQuote(selection,token,quote)){return false}if(isCursorAfterWord(selection,token)){return false}if(nextToken&&matchTokenType(nextToken,["keyword.operator."])){return false}if(!isCursorBeforeWord(selection,token)){return true}return token.value.lastIndexOf(quote)===token.value.length-1}function quotesInsertion(state,action,editor,session,text){var quote=text,selection=editor.getSelectionRange(),selected=session.doc.getTextRange(selection),cursor,line,leftChar;if(text!=='"'&&text!=='"'){return}initContext(editor);if(autoSurroundOnSelections&&selected!==""&&selected!=='"'&&selected!=='"'&&editor.getWrapBehavioursEnabled()){return{text:quote+selected+quote,selection:false}}cursor=editor.getCursorPosition();line=session.doc.getLine(cursor.row);leftChar=line.substring(cursor.column-1,cursor.column);if(leftChar==="\\"){return null}if(addMatchingQuote(editor,quote)){return{text:quote+quote,selection:[1,1]}}var token=session.getTokenAt(selection.end.row,selection.end.column);if(token.type==="string"){var rightChar=line.substring(cursor.column,cursor.column+1);if(rightChar===quote){return{text:"",selection:[1,1]}}}}function quotesDeletion(state,action,editor,session,range){var selected=session.doc.getTextRange(range),line,rightChar;if(range.isMultiLine()||selected!=='"'&&selected!=="'"){return}initContext(editor);line=session.doc.getLine(range.start.row);rightChar=line.substring(range.start.column+1,range.start.column+2);if(rightChar===selected){range.end.column++;return range}}var AutoCloseBehaviour=function(){this.add("parens","insertion",parenthesisInsertion);this.add("parens","deletion",parenthesisDeletion);this.add("string_dquotes","insertion",quotesInsertion);this.add("string_dquotes","deletion",quotesDeletion);this.setAutoSurroundOnSelections=function(value){autoSurroundOnSelections=!!value}};oop.inherits(AutoCloseBehaviour,Behaviour);exports.AutoCloseBehaviour=AutoCloseBehaviour});define("ace-mode-brandwatch/brandwatch_mode",["require","exports","module","ace/lib/oop","ace/mode/text","ace/tokenizer","./brandwatch_highlight_rules","./brandwatch_completions","ace/ext/language_tools","./location_completer","./autoclose_behaviour"],function(require,exports){"use strict";var oop=require("ace/lib/oop");var TextMode=require("ace/mode/text").Mode;var Tokenizer=require("ace/tokenizer").Tokenizer;var BrandwatchHighlightRules=require("./brandwatch_highlight_rules").BrandwatchHighlightRules;var BrandwatchCompletions=require("./brandwatch_completions").BrandwatchCompletions;var langTools=require("ace/ext/language_tools");var locationCompleter=require("./location_completer").locationCompleter;var Mode=function(options){options=options||{};var highlightRules=this.$highlightRules=new BrandwatchHighlightRules;this.$tokenizer=new Tokenizer(highlightRules.getRules());this.$completer=new BrandwatchCompletions;if(options.locationCompleter){if(!options.locationCompleter.apiUrl){throw new Error("BrandwatchMode must be initialized with locationCompleter.apiUrl")}langTools.addCompleter(locationCompleter.create(options.locationCompleter))}if(options.autoCloseBracketsAndQuotes){var AutoCloseBehaviour=require("./autoclose_behaviour").AutoCloseBehaviour;this.$behaviour=new AutoCloseBehaviour;this.$behaviour.setAutoSurroundOnSelections(!!options.autoSurroundOnSelections)}};oop.inherits(Mode,TextMode);(function(){this.getCompletions=function(state,session,pos,prefix,callback){return this.$completer.getCompletions(state,session,pos,prefix)};this.$createKeywordList=function(){return[]}}).call(Mode.prototype);exports.Mode=Mode});define("ace/requirejs/text!jquery.acify/theme/brandwatch.css",[],function(){return'.ace-bw .ace_gutter {\n  background: #fff;\n  color: #bdbdbd;\n  border-right: 1px solid #d2d1d1;\n}\n\n.ace-bw .ace_print-margin {\n  width: 1px;\n  background: #e8e8e8;\n}\n\n.ace-bw .ace_fold {\n    background-color: #6B72E6;\n}\n\n.ace-bw .ace_scroller {\n  background-color: #FFFFFF;\n}\n\n.ace-bw .ace_cursor {\n  border-left: 2px solid black;\n}\n\n.ace-bw .ace_hidden-cursors .ace_cursor {\n    opacity: 0;\n}\n\n.ace-bw .ace_cursor.ace_overwrite {\n  border-left: 0px;\n  border-bottom: 1px solid black;\n}\n\n.ace-bw .ace_invisible {\n  color: rgb(191, 191, 191);\n}\n\n.ace-bw .ace_storage,\n.ace-bw .ace_keyword {\n  color: #79BDE8;\n}\n\n.ace-bw .ace_constant {\n  color: rgb(197, 6, 11);\n}\n\n.ace-bw .ace_constant.ace_buildin {\n  color: rgb(88, 72, 246);\n}\n\n.ace-bw .ace_constant.ace_language {\n  color: rgb(88, 92, 246);\n}\n\n.ace-bw .ace_constant.ace_library {\n  color: rgb(6, 150, 14);\n}\n\n.ace-bw .ace_invalid {\n  background-color: rgba(255, 0, 0, 0.1);\n  color: red;\n}\n\n.ace-bw .ace_support.ace_function {\n  color: rgb(60, 76, 114);\n}\n\n.ace-bw .ace_support.ace_constant {\n  color: rgb(6, 150, 14);\n}\n\n.ace-bw .ace_support.ace_type,\n.ace-bw .ace_support.ace_class {\n  color: rgb(109, 121, 222);\n}\n\n.ace-bw .ace_comment {\n  color: rgb(76, 136, 107);\n}\n\n.ace-bw .ace_comment.ace_doc {\n  color: rgb(0, 102, 255);\n}\n\n.ace-bw .ace_comment.ace_doc.ace_tag {\n  color: rgb(128, 159, 191);\n}\n\n.ace-bw .ace_constant.ace_numeric {\n  color: rgb(0, 0, 205);\n}\n\n.ace-bw .ace_variable {\n  color: rgb(49, 132, 149);\n}\n\n.ace-bw .ace_xml-pe {\n  color: rgb(104, 104, 91);\n}\n\n.ace-bw .ace_entity.ace_name.ace_function {\n  color: #0000A2;\n}\n\n.ace-bw .ace_markup.ace_heading {\n  color: rgb(12, 7, 255);\n}\n\n.ace-bw .ace_markup.ace_list {\n  color:rgb(185, 6, 144);\n}\n\n.ace-bw .ace_meta.ace_tag {\n  color:rgb(0, 22, 142);\n}\n\n.ace-bw .ace_string.ace_regex {\n  color: rgb(255, 0, 0)\n}\n\n.ace-bw .ace_marker-layer .ace_selection {\n  background: rgba(179, 212, 252, 0.5);\n}\n.ace-bw.ace_multiselect .ace_selection.ace_start {\n  box-shadow: 0 0 3px 0px white;\n  border-radius: 2px;\n}\n.ace-bw .ace_marker-layer .ace_step {\n  background: rgb(252, 255, 0);\n}\n\n.ace-bw .ace_marker-layer .ace_stack {\n  background: rgb(164, 229, 101);\n}\n\n.ace-bw .ace_marker-layer .ace_bracket {\n  margin: -1px 0 0 -1px;\n  background: #BBE3FF;\n}\n\n.ace-bw .ace_gutter-active-line {\n    background-color : #f0f0f0;\n}\n\n.ace-bw .ace_marker-layer .ace_selected-word {\n  background: rgb(250, 250, 255);\n  border: 1px solid rgb(200, 200, 250);\n}\n\n.ace-bw .ace_indent-guide {\n  background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAE0lEQVQImWP4////f4bLly//BwAmVgd1/w11/gAAAABJRU5ErkJggg==") right repeat-y;\n}\n\n.ace_text-layer {\n  color: #606060;\n}\n\n.ace-bw .ace_and,\n.ace-bw .ace_plus {\n  color: #5A8B0D;\n}\n\n.ace-bw .ace_or {\n  color: #2E72D5;\n}\n\n.ace-bw .ace_not {\n  color: #8757AD;\n}\n\n.ace-bw .ace_proximity,\n.ace-bw .ace_near {\n  color: #6CB854;\n}\n\n.ace-bw .ace_string {\n  color: #777;\n}\n\n.ace-bw .ace_raw {\n  color: #000;\n}\n\n.ace-bw .ace_site,\n.ace-bw .ace_url,\n.ace-bw .ace_title,\n.ace-bw .ace_author {\n  color: #1988AC;\n}\n\n.ace-bw .ace_asterisk,\n.ace-bw .ace_interro,\n.ace-bw .ace_keyword.ace_hashtags,\n.ace-bw .ace_keyword.ace_at_mentions,\n.ace-bw .ace_keyword.ace_links {\n  color: #0BAEBE;\n}\n\n.ace-bw .ace_continent,\n.ace-bw .ace_location,\n.ace-bw .ace-country,\n.ace-bw .ace_state,\n.ace-bw .ace_county,\n.ace-bw .ace_city {\n  color: #936E0B;\n}\n\n.ace-bw .ace_lparen,\n.ace-bw .ace_rparen {\n    color: #606060;\n}\n\n.ace-bw .ace_tooltip {\n    padding: 4px 10px 6px 10px;\n\n    border: none;\n    border-radius: 2px;\n    box-shadow: none;\n\n    color: #FFFFFF;\n    background-color: #4b4949;\n    background-image: none;\n    opacity: 0.9;\n\n    font-family: arial, sans-serif, helvetica;\n    font-size: 13px;\n}\n\n.ace-bw .ace_gutter-cell.ace_error,\n.ace-bw .ace_gutter-cell.ace_warning,\n.ace-bw .ace_gutter-cell.ace_information {\n    background-repeat: repeat-y;\n    background-position: right;\n}\n\n.ace-bw .ace_gutter-cell.ace_information {\n    background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAABCAYAAAAb4BS0AAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB94HDg0ADll/wogAAAAQSURBVAjXY4xbfvU/AxQAABz4AtuRMEsmAAAAAElFTkSuQmCC);\n    background-color: rgba(92,166,213,.18);\n    border-bottom: 1px solid #C3D4DF;\n}\n.ace-bw .ace_gutter-cell.ace_warning {\n    background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAABCAYAAAAb4BS0AAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB94HDg0BJnXRWzMAAAAQSURBVAjXY3ywVOI/AxQAABuYAp7AXr4XAAAAAElFTkSuQmCC);\n    background-color: rgba(224,182,81,.18);\n    border-bottom: 1px solid #E2D9C0;\n}\n.ace-bw .ace_gutter-cell.ace_error {\n    background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAABCAYAAAAb4BS0AAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB94HDg0AKfx1d+MAAAAPSURBVAjXY7wVF/efAQoAGv8ClzZm4NIAAAAASUVORK5CYII=);\n    background-color: rgba(218,94,94,.12);\n    border-bottom: 1px solid #E9CECE;\n}\n\n.ace-bw .issue-range-information,\n.ace-bw .issue-range-warning,\n.ace-bw .issue-range-error {\n    position: absolute;\n    display: inline-block;\n    pointer-events: auto;\n}\n.ace-bw .issue-range-information {\n    border-bottom: 1px dotted #5ea7d5;\n    background-color: rgba(92, 166, 213, .2);\n}\n\n.ace-bw .issue-range-warning {\n    border-bottom: 1px dotted #e0a518;\n    background-color: rgba(224, 182, 81, .2);\n}\n\n.ace-bw .issue-range-error {\n    border-bottom: 1px solid #dc6c6c;\n    background-color: rgba(220, 109, 109, .2);\n}\n'});define("jquery.acify/theme/brandwatch",["require","exports","module","ace/requirejs/text!./brandwatch.css","ace/lib/dom"],function(require,exports){"use strict";exports.isDark=false;exports.cssClass="ace-bw";exports.cssText=require("ace/requirejs/text!./brandwatch.css");var dom=require("ace/lib/dom");dom.importCssString(exports.cssText,exports.cssClass)});define("jquery.acify/clean-special-characters",[],function(){"use strict";var replacements=[[/[]/g,'"'],[/[]/g,"'"],[/[]/g,"-"]];return function(event,editor){for(var i=0;i<replacements.length;i++){var pattern=replacements[i][0],substitution=replacements[i][1];editor.replaceAll(substitution,{needle:pattern,regExp:true})}}});(function($){"use strict";$.fn.acify=function(opts){var $this=$(this),options=opts||{},onReady=options.onReady,text=options.text||$this.val(),editor,session,BrandwatchMode;function resizeEditor(force){var writtenRows=editor.getSession().getScreenLength(),visibleRows=Math.round(editor.$getVisibleRowCount());if(force||writtenRows>visibleRows){var lineHeight=parseInt($this.css("line-height"),10)+2,maxHeight=parseInt($this.css("max-height"),10),newHeight=Math.min(writtenRows*lineHeight,maxHeight);$this.height(newHeight);editor.resize()}}require(["ace/ace","ace-mode-brandwatch/brandwatch_mode","jquery.acify/theme/brandwatch","jquery.acify/clean-special-characters"],function(ace,brandwatchMode,theme,cleanSpecialCharacters){editor=ace.edit($this[0]);session=editor.getSession();BrandwatchMode=brandwatchMode.Mode;editor.setTheme(theme);editor.setShowPrintMargin(false);if(options.fontSize){editor.setFontSize(options.fontSize)}editor.renderer.setShowGutter(!!options.showGutter);editor.setAnimatedScroll(!!options.animatedScroll);editor.renderer.setHScrollBarAlwaysVisible(false);session.setUseWrapMode(true);session.setMode(new BrandwatchMode({autoCloseBracketsAndQuotes:options.autoCloseBracketsAndQuotes,autoSurroundOnSelections:options.autoSurroundOnSelections}));if(text){session.setValue(text)}if(options.autoResize===true){editor.on("change",resizeEditor)}if(options.onChange&&typeof options.onChange==="function"){editor.on("change",options.onChange)}if(options.onBlur&&typeof options.onBlur==="function"){editor.on("blur",options.onBlur)}cleanSpecialCharacters({},editor);editor.on("change",cleanSpecialCharacters);editor.fitToContents=resizeEditor;if(onReady&&typeof onReady==="function"){onReady({editor:editor})}});return $this}})($);define("jquery.acify",function(){});define("css!css/queryEditorView.css",["css!css/compiled.css"],function(){});define("css!src/querybuilder/css/queryEditorView.css",["css!src/querybuilder/css/compiled.css"],function(){});(function($,_){"use strict";$.fn.captureMouseOver=function(opts){opts=opts||{};return this.each(function(){var $this=$(this),markers,onMouseMove;function passThrough(e){markers=$this.find(opts.targetSelector);markers.each(function(){var mouseX=e.pageX,mouseY=e.pageY,$marker=$(this),offset=$marker.offset(),width=$marker.width(),height=$marker.height();if(mouseX>offset.left&&mouseX<offset.left+width&&mouseY>offset.top&&mouseY<offset.top+height){$marker.mouseover()}else{$marker.mouseout()}})}onMouseMove=_.debounce(passThrough,50,true);$this.off("mousemove.captureMouseOver");$this.on("mousemove.captureMouseOver",onMouseMove)})}})($,_);define("lib/jquery.captureMouseOver",function(){});define("src/views/QueryEditorView",["jquery","underscore","backbone","src/views/ValidatingFormView","mustache!templates/queryEditor","ace/range","jquery.acify","css!css/queryEditorView.css","css!src/querybuilder/css/queryEditorView.css","src/packages/customtip","lib/jquery.captureMouseOver"],function($,_,Backbone,ValidatingFormView,queryEditorTemplate,editorRange){"use strict";var SCROLLTO_OFFSET=2;function toZeroBasedIndex(num){if(!_.isNumber(num)||num<1){return 0}return num-1}function convertToAceAnnotations(issues){return issues.map(function(issue){return{row:toZeroBasedIndex(issue.startRow),column:toZeroBasedIndex(issue.startColumn),type:issue.type,text:issue.message}})}function getTerms(view){return{includedTerms:[view.getQueryString()]}}function isValid(view){var terms=getTerms(view),model=view.model,validationResult;view.hideErrors();validationResult=model.validateTerms(terms);if(validationResult){_(validationResult).each(function(value,key){var errObj={};errObj[key]=[].concat(validationResult[key]);view.showInputValidation(view.$("[name="+key+"]"),errObj)})}else{model.set(terms,{silent:true})}return!validationResult}function setupAce(view,andThen){var aceOptions;var queryText;var $aceTarget=view.$(".editor");var includedTerms=view.model.get("includedTerms");queryText=includedTerms instanceof Array?includedTerms.join():includedTerms;aceOptions=_.extend(view.getAceOptions(),{text:queryText,onReady:function onReady(opts){andThen(opts.editor)}});$aceTarget.acify(aceOptions)}function onAceDocumentChange(view,e){view.trigger("change",e)}function withoutAnchors(range){var result=range.clone();result.start.column=range.start.column+1;return result}function removeIssueMarker(view,issueMarkerRange){var editorSession=view.editor.getSession();editorSession.removeMarker(issueMarkerRange.id);view.issueMarkerRanges=_.without(view.issueMarkerRanges,issueMarkerRange)}function removeChangedIssueMarkers(view,changedRange){var markersToRemove=(view.issueMarkerRanges||[]).filter(function(issueMarkerRange){var rangeWithoutAnchors=withoutAnchors(issueMarkerRange),comparison=changedRange.compareRange(rangeWithoutAnchors);return comparison>-2&&comparison<2});if(!markersToRemove.length){return}markersToRemove.forEach(function(marker){removeIssueMarker(view,marker)});view.issueMarkerRanges=_.without(view.issueMarkerRanges,markersToRemove)}function sortIssues(issues){var groupByRowLength=[],result;groupByRowLength=_.groupBy(issues,function(issue){return issue.endRow-issue.startRow});function compare(memo,key){var subList=groupByRowLength[key];if(subList.length<2){memo.push(subList[0])}else{var tmp=_.sortBy(subList,function(issue){return issue.endColumn-issue.startColumn});memo=memo.concat(tmp)}return memo}result=_(groupByRowLength).chain().keys().sortBy(function(x){return parseInt(x,10)}).reduce(compare,[]).value();return result.reverse()}function clearIssueMarkers(view){view.issueMarkerRanges=view.issueMarkerRanges||[];if(!view.issueMarkerRanges.length){return}view.issueMarkerRanges.forEach(function(issueMarkerRange){removeIssueMarker(view,issueMarkerRange)})}function setIssueMarkers(view,issues){issues=sortIssues(issues);var editorSession=view.editor.getSession();var Range=editorRange.Range;clearIssueMarkers(view);issues.forEach(function(issue){var range=new Range,startRow=toZeroBasedIndex(issue.startRow),startColumn=toZeroBasedIndex(issue.startColumn),endRow=toZeroBasedIndex(issue.endRow),endColumn=Math.max(0,issue.endColumn),start=editorSession.doc.createAnchor(startRow,startColumn),end=editorSession.doc.createAnchor(endRow,endColumn);range.start=start;range.end=end;range.uniqueClassName=_.uniqueId("issue-range");range.message=issue.message;range.type=issue.type;range.id=editorSession.addMarker(range,range.uniqueClassName+" customtip issue-range-"+issue.type,"text");view.issueMarkerRanges.push(range)})}function getIssueStartRow(issue){return issue.start.row}function getFirstIssue(issues){var sortedIssues=_(issues).sortBy(getIssueStartRow),firstIssue=sortedIssues[0],firstLineIssues,firstLineIssuesSorted;function getIssueStartColumn(issue){return issue.start.column}if(!firstIssue){return}firstLineIssues=_.filter(issues,function(x){return x.start.row===firstIssue.start.row});firstLineIssuesSorted=_.sortBy(firstLineIssues,getIssueStartColumn);if(!firstLineIssuesSorted||firstLineIssuesSorted.length<1){return}return firstLineIssuesSorted[0]}function triggerTooltip(view,uniqueClassName){var $marker,$markers,cancelTooltip;view.autoTooltipTimeoutId=setTimeout(function(){$marker=view.$("."+uniqueClassName).first();$marker.mouseover();$markers=view.$(".issue-range-warning, .issue-range-error");cancelTooltip=function cancelTooltip(){window.clearTimeout(view.autoTooltipTimeoutId);$markers.off("mouseover.autoTooltipTimeout")};$markers.one("mouseover.autoTooltipTimeout",cancelTooltip);view.editor.session.once("changeScrollTop",cancelTooltip);view.autoTooltipTimeoutId=setTimeout(function(){$("#customtip").fadeOut(500,function(){$marker.mouseout()})},2500)},125)}function scrollToFirstError(view){var firstMarker,firstErrorRow,triggerOnFirstError,isOneLineQuery,errorIsNotVisible,editor=view.editor,firstVisibleRow=editor.renderer.getFirstFullyVisibleRow(),lastVisibleRow=editor.getLastVisibleRow();firstMarker=getFirstIssue(view.issueMarkerRanges);if(typeof firstMarker==="undefined"){return}firstErrorRow=firstMarker.start.row;triggerOnFirstError=triggerTooltip.bind(null,view,firstMarker.uniqueClassName);isOneLineQuery=firstErrorRow===0&&lastVisibleRow===0;errorIsNotVisible=firstErrorRow<firstVisibleRow||firstErrorRow>=lastVisibleRow;if(errorIsNotVisible&&!isOneLineQuery){editor.scrollToLine(firstErrorRow-SCROLLTO_OFFSET,false,true,triggerOnFirstError)}else{triggerOnFirstError()}}return ValidatingFormView.extend({className:"queryEditorView",constructor:function QueryEditorView(options){options=options||{};if(!options.model){throw new Error("QueryEditorView must be initialized with a Query model")}Backbone.View.apply(this,arguments)},render:function render(){var view=this;this.$el.html(queryEditorTemplate());setupAce(view,function afterAceSetup(editor){var $editorEl=view.$(".editor");$editorEl.css("line-height",view.getAceOptions().lineHeight||1);editor.resize();editor.focus();editor.on("change",function(e){onAceDocumentChange(view,e)});editor.commands.addCommand({name:"testsearch",bindKey:{win:"Ctrl-Enter",mac:"Cmd-Enter"},exec:function exec(){view.trigger("editor-preview")}});view.editor=editor;view.editorReadyCallback();view.trigger("editor-ready")});this.$(".customtip").customtip()},resize:function resize(){if(this.editor){this.editor.resize()}},showIssuesInEditor:function showIssuesInEditor(issues){var session=this.editor.getSession(),annotations;this.clearIssuesInEditor();if(!issues.length){return}annotations=convertToAceAnnotations(issues);session.setAnnotations(annotations);setIssueMarkers(this,issues);scrollToFirstError(this)},clearIssuesInEditor:function clearIssuesInEditor(){this.editor.getSession().clearAnnotations();clearIssueMarkers(this)},getAceOptions:function getAceOptions(){return{showGutter:true,animatedScroll:true,lineHeight:"15px",autoCloseBracketsAndQuotes:true}},getQueryString:function getQueryString(){return this.editor&&this.editor.getSession().getValue()},validate:function validate(){this.hideErrors();return isValid(this)},getValues:function getValues(){if(!this.validate()){throw new Error("Invalid query term")}return getTerms(this)},remove:function remove(){clearTimeout(this.autoTooltipTimeoutId);ValidatingFormView.prototype.remove.apply(this,arguments)},registerRemoveChangedIssueMarker:function registerRemoveChangedIssueMarker(){var view=this;var Range=editorRange.Range;view.editor.on("change",function removeMarkersChanged(event){var range=new Range(event.start.row,event.start.column,event.end.row,event.end.column);removeChangedIssueMarkers(view,range)})},editorReadyCallback:function editorReadyCallback(){var view=this;if($("html").is(".ie9, .ie10")){view.$(".editor").captureMouseOver({targetSelector:".customtip"})}view.editor.session.on("changeScrollTop",function(){if(view.issueMarkerRanges&&view.issueMarkerRanges.length>0){view.issueMarkerRanges.forEach(function(range){view.$("."+range.uniqueClassName).mouseout()})}});view.editor.setDefaultHandler("guttermousemove",function gutterMousemove(e){var currentRow=e.getDocumentPosition().row,highlightMarkers=_.filter(view.issueMarkerRanges,function(item){return item.start.row===currentRow});_.each(highlightMarkers,function(marker){view.$("."+marker.uniqueClassName).addClass("highlight")})});$(view.editor.renderer.$gutter).on("mouseout",function gutterMouseout(){_.each(view.issueMarkerRanges,function(marker){view.$("."+marker.uniqueClassName).removeClass("highlight")})});view.registerRemoveChangedIssueMarker();view.editor.renderer.on("afterRender",function(){if(view.issueMarkerRanges&&view.issueMarkerRanges.length){view.issueMarkerRanges.forEach(function(range){var marker=view.$("."+range.uniqueClassName);marker.attr("title",range.message);marker.customtip({tipClass:"tip-top customtip-"+range.type})})}})}})});define("src/models/AuthorGroup",["underscore","src/models/Group","bw-fe-helpers/validationHelpers"],function(_,Group,validationHelpers){"use strict";return Group.extend({validate:{name:{required:true,custom:"isValidName"},authors:{custom:"isValidArray"}},defaults:function defaults(){return{sharedProjectIds:[]}},isOwn:function isOwn(userId){return this.get("userId")===userId},url:function url(){return"/projects/{projectId}/group/author/"+(this.id||"")},isValidName:function isValidName(attrName,attrValue){return validationHelpers.isInvalidString(attrValue)?"invalidchar":false},isValidArray:function isValidArray(attrName,attrValue){if(_.isArray(attrValue)&&attrValue.length){if(_.any(attrValue,function(item){return validationHelpers.isInvalidAuthorName(item)})){return"invalidchar"}return false}return _.isUndefined(attrValue)&&this.get(attrName)?false:"required"},getOwner:function getOwner(){return this.get("userName")||"n/a"}})});define("src/models/AuthorGroupCollection",["src/models/GroupCollection","src/models/AuthorGroup"],function(GroupCollection,AuthorGroup){"use strict";return GroupCollection.extend({model:AuthorGroup,url:function url(){return"/projects/{projectId}/group/author/summary"},parse:function parse(data){return data.results}})});define("src/globals/authorGroups",["src/globals/currentProject","src/models/AuthorGroupCollection"],function(currentProject,AuthorGroupCollection){"use strict";var authorGroups=new AuthorGroupCollection;currentProject.onLoad(function(callback){authorGroups.projectId=currentProject.id;if(!currentProject.id){authorGroups.reset([],{silent:false});return}authorGroups.reset([],{silent:true});authorGroups.fetch({success:function success(){callback()},error:function error(model,err){callback(err)}})});return authorGroups});define("src/extensions/locations/mapboxMapIdProvider",[],function(){"use strict";var MAPBOX_MAP_ID="brandwatch.5027e80a";return{getMapId:function getMapId(){return MAPBOX_MAP_ID}}});define("css!vendor/mapbox.js/2.1.8/mapbox.css",["css!vendor/mapbox.js/2.1.8/compiled.css"],function(){});define("src/packages/leafletGlobals",[],function(){"use strict";window.L_PREFER_CANVAS=true});(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){function corslite(n,t,o){function e(n){return n>=200&&300>n||304===n}function i(){void 0===r.status||e(r.status)?t.call(r,null,r):t.call(r,r,null)}var l=!1;if("undefined"==typeof window.XMLHttpRequest)return t(Error("Browser not supported"));if("undefined"==typeof o){var u=n.match(/^\s*https?:\/\/[^\/]*/);o=u&&u[0]!==location.protocol+"//"+location.domain+(location.port?":"+location.port:"")}var r=new window.XMLHttpRequest;if(o&&!("withCredentials"in r)){r=new window.XDomainRequest;var a=t;t=function(){if(l)a.apply(this,arguments);else{var n=this,t=arguments;setTimeout(function(){a.apply(n,t)},0)}}}return"onload"in r?r.onload=i:r.onreadystatechange=function(){4===r.readyState&&i()},r.onerror=function(n){t.call(this,n||!0,null),t=function(){}},r.onprogress=function(){},r.ontimeout=function(n){t.call(this,n,null),t=function(){}},r.onabort=function(n){t.call(this,n,null),t=function(){}},r.open("GET",n,!0),r.send(null),l=!0,r}"undefined"!=typeof module&&(module.exports=corslite)},{}],2:[function(require,module,exports){!function(t,e,i){var n=t.L,o={};o.version="0.7.2","object"==typeof module&&"object"==typeof module.exports?module.exports=o:"function"==typeof define&&define.amd&&define(o),o.noConflict=function(){return t.L=n,this},t.L=o,o.Util={extend:function(t){var e,i,n,o,s=Array.prototype.slice.call(arguments,1);for(i=0,n=s.length;n>i;i++){o=s[i]||{};for(e in o)o.hasOwnProperty(e)&&(t[e]=o[e])}return t},bind:function(t,e){var i=arguments.length>2?Array.prototype.slice.call(arguments,2):null;return function(){return t.apply(e,i||arguments)}},stamp:function(){var t=0,e="_leaflet_id";return function(i){return i[e]=i[e]||++t,i[e]}}(),invokeEach:function(t,e,i){var n,o;if("object"==typeof t){o=Array.prototype.slice.call(arguments,3);for(n in t)e.apply(i,[n,t[n]].concat(o));return!0}return!1},limitExecByInterval:function(t,e,i){var n,o;return function s(){var a=arguments;return n?void(o=!0):(n=!0,setTimeout(function(){n=!1,o&&(s.apply(i,a),o=!1)},e),void t.apply(i,a))}},falseFn:function(){return!1},formatNum:function(t,e){var i=Math.pow(10,e||5);return Math.round(t*i)/i},trim:function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")},splitWords:function(t){return o.Util.trim(t).split(/\s+/)},setOptions:function(t,e){return t.options=o.extend({},t.options,e),t.options},getParamString:function(t,e,i){var n=[];for(var o in t)n.push(encodeURIComponent(i?o.toUpperCase():o)+"="+encodeURIComponent(t[o]));return(e&&-1!==e.indexOf("?")?"&":"?")+n.join("&")},template:function(t,e){return t.replace(/\{ *([\w_]+) *\}/g,function(t,n){var o=e[n];if(o===i)throw new Error("No value provided for variable "+t);return"function"==typeof o&&(o=o(e)),o})},isArray:Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="},function(){function e(e){var i,n,o=["webkit","moz","o","ms"];for(i=0;i<o.length&&!n;i++)n=t[o[i]+e];return n}function i(e){var i=+new Date,o=Math.max(0,16-(i-n));return n=i+o,t.setTimeout(e,o)}var n=0,s=t.requestAnimationFrame||e("RequestAnimationFrame")||i,a=t.cancelAnimationFrame||e("CancelAnimationFrame")||e("CancelRequestAnimationFrame")||function(e){t.clearTimeout(e)};o.Util.requestAnimFrame=function(e,n,a,r){return e=o.bind(e,n),a&&s===i?void e():s.call(t,e,r)},o.Util.cancelAnimFrame=function(e){e&&a.call(t,e)}}(),o.extend=o.Util.extend,o.bind=o.Util.bind,o.stamp=o.Util.stamp,o.setOptions=o.Util.setOptions,o.Class=function(){},o.Class.extend=function(t){var e=function(){this.initialize&&this.initialize.apply(this,arguments),this._initHooks&&this.callInitHooks()},i=function(){};i.prototype=this.prototype;var n=new i;n.constructor=e,e.prototype=n;for(var s in this)this.hasOwnProperty(s)&&"prototype"!==s&&(e[s]=this[s]);t.statics&&(o.extend(e,t.statics),delete t.statics),t.includes&&(o.Util.extend.apply(null,[n].concat(t.includes)),delete t.includes),t.options&&n.options&&(t.options=o.extend({},n.options,t.options)),o.extend(n,t),n._initHooks=[];var a=this;return e.__super__=a.prototype,n.callInitHooks=function(){if(!this._initHooksCalled){a.prototype.callInitHooks&&a.prototype.callInitHooks.call(this),this._initHooksCalled=!0;for(var t=0,e=n._initHooks.length;e>t;t++)n._initHooks[t].call(this)}},e},o.Class.include=function(t){o.extend(this.prototype,t)},o.Class.mergeOptions=function(t){o.extend(this.prototype.options,t)},o.Class.addInitHook=function(t){var e=Array.prototype.slice.call(arguments,1),i="function"==typeof t?t:function(){this[t].apply(this,e)};this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(i)};var s="_leaflet_events";o.Mixin={},o.Mixin.Events={addEventListener:function(t,e,i){if(o.Util.invokeEach(t,this.addEventListener,this,e,i))return this;var n,a,r,h,l,u,c,d=this[s]=this[s]||{},p=i&&i!==this&&o.stamp(i);for(t=o.Util.splitWords(t),n=0,a=t.length;a>n;n++)r={action:e,context:i||this},h=t[n],p?(l=h+"_idx",u=l+"_len",c=d[l]=d[l]||{},c[p]||(c[p]=[],d[u]=(d[u]||0)+1),c[p].push(r)):(d[h]=d[h]||[],d[h].push(r));return this},hasEventListeners:function(t){var e=this[s];return!!e&&(t in e&&e[t].length>0||t+"_idx"in e&&e[t+"_idx_len"]>0)},removeEventListener:function(t,e,i){if(!this[s])return this;if(!t)return this.clearAllEventListeners();if(o.Util.invokeEach(t,this.removeEventListener,this,e,i))return this;var n,a,r,h,l,u,c,d,p,_=this[s],m=i&&i!==this&&o.stamp(i);for(t=o.Util.splitWords(t),n=0,a=t.length;a>n;n++)if(r=t[n],u=r+"_idx",c=u+"_len",d=_[u],e){if(h=m&&d?d[m]:_[r]){for(l=h.length-1;l>=0;l--)h[l].action!==e||i&&h[l].context!==i||(p=h.splice(l,1),p[0].action=o.Util.falseFn);i&&d&&0===h.length&&(delete d[m],_[c]--)}}else delete _[r],delete _[u],delete _[c];return this},clearAllEventListeners:function(){return delete this[s],this},fireEvent:function(t,e){if(!this.hasEventListeners(t))return this;var i,n,a,r,h,l=o.Util.extend({},e,{type:t,target:this}),u=this[s];if(u[t])for(i=u[t].slice(),n=0,a=i.length;a>n;n++)i[n].action.call(i[n].context,l);r=u[t+"_idx"];for(h in r)if(i=r[h].slice())for(n=0,a=i.length;a>n;n++)i[n].action.call(i[n].context,l);return this},addOneTimeEventListener:function(t,e,i){if(o.Util.invokeEach(t,this.addOneTimeEventListener,this,e,i))return this;var n=o.bind(function(){this.removeEventListener(t,e,i).removeEventListener(t,n,i)},this);return this.addEventListener(t,e,i).addEventListener(t,n,i)}},o.Mixin.Events.on=o.Mixin.Events.addEventListener,o.Mixin.Events.off=o.Mixin.Events.removeEventListener,o.Mixin.Events.once=o.Mixin.Events.addOneTimeEventListener,o.Mixin.Events.fire=o.Mixin.Events.fireEvent,function(){var n="ActiveXObject"in t,s=n&&!e.addEventListener,a=navigator.userAgent.toLowerCase(),r=-1!==a.indexOf("webkit"),h=-1!==a.indexOf("chrome"),l=-1!==a.indexOf("phantom"),u=-1!==a.indexOf("android"),c=-1!==a.search("android [23]"),d=-1!==a.indexOf("gecko"),p=typeof orientation!=i+"",_=t.navigator&&t.navigator.msPointerEnabled&&t.navigator.msMaxTouchPoints&&!t.PointerEvent,m=t.PointerEvent&&t.navigator.pointerEnabled&&t.navigator.maxTouchPoints||_,f="devicePixelRatio"in t&&t.devicePixelRatio>1||"matchMedia"in t&&t.matchMedia("(min-resolution:144dpi)")&&t.matchMedia("(min-resolution:144dpi)").matches,g=e.documentElement,v=n&&"transition"in g.style,y="WebKitCSSMatrix"in t&&"m11"in new t.WebKitCSSMatrix&&!c,P="MozPerspective"in g.style,L="OTransition"in g.style,x=!t.L_DISABLE_3D&&(v||y||P||L)&&!l,w=!t.L_NO_TOUCH&&!l&&function(){var t="ontouchstart";if(m||t in g)return!0;var i=e.createElement("div"),n=!1;return i.setAttribute?(i.setAttribute(t,"return;"),"function"==typeof i[t]&&(n=!0),i.removeAttribute(t),i=null,n):!1}();o.Browser={ie:n,ielt9:s,webkit:r,gecko:d&&!r&&!t.opera&&!n,android:u,android23:c,chrome:h,ie3d:v,webkit3d:y,gecko3d:P,opera3d:L,any3d:x,mobile:p,mobileWebkit:p&&r,mobileWebkit3d:p&&y,mobileOpera:p&&t.opera,touch:w,msPointer:_,pointer:m,retina:f}}(),o.Point=function(t,e,i){this.x=i?Math.round(t):t,this.y=i?Math.round(e):e},o.Point.prototype={clone:function(){return new o.Point(this.x,this.y)},add:function(t){return this.clone()._add(o.point(t))},_add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.clone()._subtract(o.point(t))},_subtract:function(t){return this.x-=t.x,this.y-=t.y,this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.x/=t,this.y/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.x*=t,this.y*=t,this},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},distanceTo:function(t){t=o.point(t);var e=t.x-this.x,i=t.y-this.y;return Math.sqrt(e*e+i*i)},equals:function(t){return t=o.point(t),t.x===this.x&&t.y===this.y},contains:function(t){return t=o.point(t),Math.abs(t.x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)},toString:function(){return"Point("+o.Util.formatNum(this.x)+", "+o.Util.formatNum(this.y)+")"}},o.point=function(t,e,n){return t instanceof o.Point?t:o.Util.isArray(t)?new o.Point(t[0],t[1]):t===i||null===t?t:new o.Point(t,e,n)},o.Bounds=function(t,e){if(t)for(var i=e?[t,e]:t,n=0,o=i.length;o>n;n++)this.extend(i[n])},o.Bounds.prototype={extend:function(t){return t=o.point(t),this.min||this.max?(this.min.x=Math.min(t.x,this.min.x),this.max.x=Math.max(t.x,this.max.x),this.min.y=Math.min(t.y,this.min.y),this.max.y=Math.max(t.y,this.max.y)):(this.min=t.clone(),this.max=t.clone()),this},getCenter:function(t){return new o.Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)},getBottomLeft:function(){return new o.Point(this.min.x,this.max.y)},getTopRight:function(){return new o.Point(this.max.x,this.min.y)},getSize:function(){return this.max.subtract(this.min)},contains:function(t){var e,i;return t="number"==typeof t[0]||t instanceof o.Point?o.point(t):o.bounds(t),t instanceof o.Bounds?(e=t.min,i=t.max):e=i=t,e.x>=this.min.x&&i.x<=this.max.x&&e.y>=this.min.y&&i.y<=this.max.y},intersects:function(t){t=o.bounds(t);var e=this.min,i=this.max,n=t.min,s=t.max,a=s.x>=e.x&&n.x<=i.x,r=s.y>=e.y&&n.y<=i.y;return a&&r},isValid:function(){return!(!this.min||!this.max)}},o.bounds=function(t,e){return!t||t instanceof o.Bounds?t:new o.Bounds(t,e)},o.Transformation=function(t,e,i,n){this._a=t,this._b=e,this._c=i,this._d=n},o.Transformation.prototype={transform:function(t,e){return this._transform(t.clone(),e)},_transform:function(t,e){return e=e||1,t.x=e*(this._a*t.x+this._b),t.y=e*(this._c*t.y+this._d),t},untransform:function(t,e){return e=e||1,new o.Point((t.x/e-this._b)/this._a,(t.y/e-this._d)/this._c)}},o.DomUtil={get:function(t){return"string"==typeof t?e.getElementById(t):t},getStyle:function(t,i){var n=t.style[i];if(!n&&t.currentStyle&&(n=t.currentStyle[i]),(!n||"auto"===n)&&e.defaultView){var o=e.defaultView.getComputedStyle(t,null);n=o?o[i]:null}return"auto"===n?null:n},getViewportOffset:function(t){var i,n=0,s=0,a=t,r=e.body,h=e.documentElement;do{if(n+=a.offsetTop||0,s+=a.offsetLeft||0,n+=parseInt(o.DomUtil.getStyle(a,"borderTopWidth"),10)||0,s+=parseInt(o.DomUtil.getStyle(a,"borderLeftWidth"),10)||0,i=o.DomUtil.getStyle(a,"position"),a.offsetParent===r&&"absolute"===i)break;if("fixed"===i){n+=r.scrollTop||h.scrollTop||0,s+=r.scrollLeft||h.scrollLeft||0;break}if("relative"===i&&!a.offsetLeft){var l=o.DomUtil.getStyle(a,"width"),u=o.DomUtil.getStyle(a,"max-width"),c=a.getBoundingClientRect();("none"!==l||"none"!==u)&&(s+=c.left+a.clientLeft),n+=c.top+(r.scrollTop||h.scrollTop||0);break}a=a.offsetParent}while(a);a=t;do{if(a===r)break;n-=a.scrollTop||0,s-=a.scrollLeft||0,a=a.parentNode}while(a);return new o.Point(s,n)},documentIsLtr:function(){return o.DomUtil._docIsLtrCached||(o.DomUtil._docIsLtrCached=!0,o.DomUtil._docIsLtr="ltr"===o.DomUtil.getStyle(e.body,"direction")),o.DomUtil._docIsLtr},create:function(t,i,n){var o=e.createElement(t);return o.className=i,n&&n.appendChild(o),o},hasClass:function(t,e){if(t.classList!==i)return t.classList.contains(e);var n=o.DomUtil._getClass(t);return n.length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(n)},addClass:function(t,e){if(t.classList!==i)for(var n=o.Util.splitWords(e),s=0,a=n.length;a>s;s++)t.classList.add(n[s]);else if(!o.DomUtil.hasClass(t,e)){var r=o.DomUtil._getClass(t);o.DomUtil._setClass(t,(r?r+" ":"")+e)}},removeClass:function(t,e){t.classList!==i?t.classList.remove(e):o.DomUtil._setClass(t,o.Util.trim((" "+o.DomUtil._getClass(t)+" ").replace(" "+e+" "," ")))},_setClass:function(t,e){t.className.baseVal===i?t.className=e:t.className.baseVal=e},_getClass:function(t){return t.className.baseVal===i?t.className:t.className.baseVal},setOpacity:function(t,e){if("opacity"in t.style)t.style.opacity=e;else if("filter"in t.style){var i=!1,n="DXImageTransform.Microsoft.Alpha";try{i=t.filters.item(n)}catch(o){if(1===e)return}e=Math.round(100*e),i?(i.Enabled=100!==e,i.Opacity=e):t.style.filter+=" progid:"+n+"(opacity="+e+")"}},testProp:function(t){for(var i=e.documentElement.style,n=0;n<t.length;n++)if(t[n]in i)return t[n];return!1},getTranslateString:function(t){var e=o.Browser.webkit3d,i="translate"+(e?"3d":"")+"(",n=(e?",0":"")+")";return i+t.x+"px,"+t.y+"px"+n},getScaleString:function(t,e){var i=o.DomUtil.getTranslateString(e.add(e.multiplyBy(-1*t))),n=" scale("+t+") ";return i+n},setPosition:function(t,e,i){t._leaflet_pos=e,!i&&o.Browser.any3d?t.style[o.DomUtil.TRANSFORM]=o.DomUtil.getTranslateString(e):(t.style.left=e.x+"px",t.style.top=e.y+"px")},getPosition:function(t){return t._leaflet_pos}},o.DomUtil.TRANSFORM=o.DomUtil.testProp(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]),o.DomUtil.TRANSITION=o.DomUtil.testProp(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),o.DomUtil.TRANSITION_END="webkitTransition"===o.DomUtil.TRANSITION||"OTransition"===o.DomUtil.TRANSITION?o.DomUtil.TRANSITION+"End":"transitionend",function(){if("onselectstart"in e)o.extend(o.DomUtil,{disableTextSelection:function(){o.DomEvent.on(t,"selectstart",o.DomEvent.preventDefault)},enableTextSelection:function(){o.DomEvent.off(t,"selectstart",o.DomEvent.preventDefault)}});else{var i=o.DomUtil.testProp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);o.extend(o.DomUtil,{disableTextSelection:function(){if(i){var t=e.documentElement.style;this._userSelect=t[i],t[i]="none"}},enableTextSelection:function(){i&&(e.documentElement.style[i]=this._userSelect,delete this._userSelect)}})}o.extend(o.DomUtil,{disableImageDrag:function(){o.DomEvent.on(t,"dragstart",o.DomEvent.preventDefault)},enableImageDrag:function(){o.DomEvent.off(t,"dragstart",o.DomEvent.preventDefault)}})}(),o.LatLng=function(t,e,n){if(t=parseFloat(t),e=parseFloat(e),isNaN(t)||isNaN(e))throw new Error("Invalid LatLng object: ("+t+", "+e+")");this.lat=t,this.lng=e,n!==i&&(this.alt=parseFloat(n))},o.extend(o.LatLng,{DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MAX_MARGIN:1e-9}),o.LatLng.prototype={equals:function(t){if(!t)return!1;t=o.latLng(t);var e=Math.max(Math.abs(this.lat-t.lat),Math.abs(this.lng-t.lng));return e<=o.LatLng.MAX_MARGIN},toString:function(t){return"LatLng("+o.Util.formatNum(this.lat,t)+", "+o.Util.formatNum(this.lng,t)+")"},distanceTo:function(t){t=o.latLng(t);var e=6378137,i=o.LatLng.DEG_TO_RAD,n=(t.lat-this.lat)*i,s=(t.lng-this.lng)*i,a=this.lat*i,r=t.lat*i,h=Math.sin(n/2),l=Math.sin(s/2),u=h*h+l*l*Math.cos(a)*Math.cos(r);return 2*e*Math.atan2(Math.sqrt(u),Math.sqrt(1-u))},wrap:function(t,e){var i=this.lng;return t=t||-180,e=e||180,i=(i+e)%(e-t)+(t>i||i===e?e:t),new o.LatLng(this.lat,i)}},o.latLng=function(t,e){return t instanceof o.LatLng?t:o.Util.isArray(t)?"number"==typeof t[0]||"string"==typeof t[0]?new o.LatLng(t[0],t[1],t[2]):null:t===i||null===t?t:"object"==typeof t&&"lat"in t?new o.LatLng(t.lat,"lng"in t?t.lng:t.lon):e===i?null:new o.LatLng(t,e)},o.LatLngBounds=function(t,e){if(t)for(var i=e?[t,e]:t,n=0,o=i.length;o>n;n++)this.extend(i[n])},o.LatLngBounds.prototype={extend:function(t){if(!t)return this;var e=o.latLng(t);return t=null!==e?e:o.latLngBounds(t),t instanceof o.LatLng?this._southWest||this._northEast?(this._southWest.lat=Math.min(t.lat,this._southWest.lat),this._southWest.lng=Math.min(t.lng,this._southWest.lng),this._northEast.lat=Math.max(t.lat,this._northEast.lat),this._northEast.lng=Math.max(t.lng,this._northEast.lng)):(this._southWest=new o.LatLng(t.lat,t.lng),this._northEast=new o.LatLng(t.lat,t.lng)):t instanceof o.LatLngBounds&&(this.extend(t._southWest),this.extend(t._northEast)),this},pad:function(t){var e=this._southWest,i=this._northEast,n=Math.abs(e.lat-i.lat)*t,s=Math.abs(e.lng-i.lng)*t;return new o.LatLngBounds(new o.LatLng(e.lat-n,e.lng-s),new o.LatLng(i.lat+n,i.lng+s))},getCenter:function(){return new o.LatLng((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new o.LatLng(this.getNorth(),this.getWest())},getSouthEast:function(){return new o.LatLng(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(t){t="number"==typeof t[0]||t instanceof o.LatLng?o.latLng(t):o.latLngBounds(t);var e,i,n=this._southWest,s=this._northEast;return t instanceof o.LatLngBounds?(e=t.getSouthWest(),i=t.getNorthEast()):e=i=t,e.lat>=n.lat&&i.lat<=s.lat&&e.lng>=n.lng&&i.lng<=s.lng},intersects:function(t){t=o.latLngBounds(t);var e=this._southWest,i=this._northEast,n=t.getSouthWest(),s=t.getNorthEast(),a=s.lat>=e.lat&&n.lat<=i.lat,r=s.lng>=e.lng&&n.lng<=i.lng;return a&&r},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(t){return t?(t=o.latLngBounds(t),this._southWest.equals(t.getSouthWest())&&this._northEast.equals(t.getNorthEast())):!1},isValid:function(){return!(!this._southWest||!this._northEast)}},o.latLngBounds=function(t,e){return!t||t instanceof o.LatLngBounds?t:new o.LatLngBounds(t,e)},o.Projection={},o.Projection.SphericalMercator={MAX_LATITUDE:85.0511287798,project:function(t){var e=o.LatLng.DEG_TO_RAD,i=this.MAX_LATITUDE,n=Math.max(Math.min(i,t.lat),-i),s=t.lng*e,a=n*e;return a=Math.log(Math.tan(Math.PI/4+a/2)),new o.Point(s,a)},unproject:function(t){var e=o.LatLng.RAD_TO_DEG,i=t.x*e,n=(2*Math.atan(Math.exp(t.y))-Math.PI/2)*e;return new o.LatLng(n,i)}},o.Projection.LonLat={project:function(t){return new o.Point(t.lng,t.lat)},unproject:function(t){return new o.LatLng(t.y,t.x)}},o.CRS={latLngToPoint:function(t,e){var i=this.projection.project(t),n=this.scale(e);return this.transformation._transform(i,n)},pointToLatLng:function(t,e){var i=this.scale(e),n=this.transformation.untransform(t,i);return this.projection.unproject(n)},project:function(t){return this.projection.project(t)},scale:function(t){return 256*Math.pow(2,t)},getSize:function(t){var e=this.scale(t);return o.point(e,e)}},o.CRS.Simple=o.extend({},o.CRS,{projection:o.Projection.LonLat,transformation:new o.Transformation(1,0,-1,0),scale:function(t){return Math.pow(2,t)}}),o.CRS.EPSG3857=o.extend({},o.CRS,{code:"EPSG:3857",projection:o.Projection.SphericalMercator,transformation:new o.Transformation(.5/Math.PI,.5,-.5/Math.PI,.5),project:function(t){var e=this.projection.project(t),i=6378137;return e.multiplyBy(i)}}),o.CRS.EPSG900913=o.extend({},o.CRS.EPSG3857,{code:"EPSG:900913"}),o.CRS.EPSG4326=o.extend({},o.CRS,{code:"EPSG:4326",projection:o.Projection.LonLat,transformation:new o.Transformation(1/360,.5,-1/360,.5)}),o.Map=o.Class.extend({includes:o.Mixin.Events,options:{crs:o.CRS.EPSG3857,fadeAnimation:o.DomUtil.TRANSITION&&!o.Browser.android23,trackResize:!0,markerZoomAnimation:o.DomUtil.TRANSITION&&o.Browser.any3d},initialize:function(t,e){e=o.setOptions(this,e),this._initContainer(t),this._initLayout(),this._onResize=o.bind(this._onResize,this),this._initEvents(),e.maxBounds&&this.setMaxBounds(e.maxBounds),e.center&&e.zoom!==i&&this.setView(o.latLng(e.center),e.zoom,{reset:!0}),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._tileLayersNum=0,this.callInitHooks(),this._addLayers(e.layers)},setView:function(t,e){return e=e===i?this.getZoom():e,this._resetView(o.latLng(t),this._limitZoom(e)),this},setZoom:function(t,e){return this._loaded?this.setView(this.getCenter(),t,{zoom:e}):(this._zoom=this._limitZoom(t),this)},zoomIn:function(t,e){return this.setZoom(this._zoom+(t||1),e)},zoomOut:function(t,e){return this.setZoom(this._zoom-(t||1),e)},setZoomAround:function(t,e,i){var n=this.getZoomScale(e),s=this.getSize().divideBy(2),a=t instanceof o.Point?t:this.latLngToContainerPoint(t),r=a.subtract(s).multiplyBy(1-1/n),h=this.containerPointToLatLng(s.add(r));return this.setView(h,e,{zoom:i})},fitBounds:function(t,e){e=e||{},t=t.getBounds?t.getBounds():o.latLngBounds(t);var i=o.point(e.paddingTopLeft||e.padding||[0,0]),n=o.point(e.paddingBottomRight||e.padding||[0,0]),s=this.getBoundsZoom(t,!1,i.add(n)),a=n.subtract(i).divideBy(2),r=this.project(t.getSouthWest(),s),h=this.project(t.getNorthEast(),s),l=this.unproject(r.add(h).divideBy(2).add(a),s);return s=e&&e.maxZoom?Math.min(e.maxZoom,s):s,this.setView(l,s,e)},fitWorld:function(t){return this.fitBounds([[-90,-180],[90,180]],t)},panTo:function(t,e){return this.setView(t,this._zoom,{pan:e})},panBy:function(t){return this.fire("movestart"),this._rawPanBy(o.point(t)),this.fire("move"),this.fire("moveend")},setMaxBounds:function(t){return t=o.latLngBounds(t),this.options.maxBounds=t,t?(this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds,this)):this.off("moveend",this._panInsideMaxBounds,this)},panInsideBounds:function(t,e){var i=this.getCenter(),n=this._limitCenter(i,this._zoom,t);return i.equals(n)?this:this.panTo(n,e)},addLayer:function(t){var e=o.stamp(t);return this._layers[e]?this:(this._layers[e]=t,!t.options||isNaN(t.options.maxZoom)&&isNaN(t.options.minZoom)||(this._zoomBoundLayers[e]=t,this._updateZoomLevels()),this.options.zoomAnimation&&o.TileLayer&&t instanceof o.TileLayer&&(this._tileLayersNum++,this._tileLayersToLoad++,t.on("load",this._onTileLayerLoad,this)),this._loaded&&this._layerAdd(t),this)},removeLayer:function(t){var e=o.stamp(t);return this._layers[e]?(this._loaded&&t.onRemove(this),delete this._layers[e],this._loaded&&this.fire("layerremove",{layer:t}),this._zoomBoundLayers[e]&&(delete this._zoomBoundLayers[e],this._updateZoomLevels()),this.options.zoomAnimation&&o.TileLayer&&t instanceof o.TileLayer&&(this._tileLayersNum--,this._tileLayersToLoad--,t.off("load",this._onTileLayerLoad,this)),this):this},hasLayer:function(t){return t?o.stamp(t)in this._layers:!1},eachLayer:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},invalidateSize:function(t){if(!this._loaded)return this;t=o.extend({animate:!1,pan:!0},t===!0?{animate:!0}:t);var e=this.getSize();this._sizeChanged=!0,this._initialCenter=null;var i=this.getSize(),n=e.divideBy(2).round(),s=i.divideBy(2).round(),a=n.subtract(s);return a.x||a.y?(t.animate&&t.pan?this.panBy(a):(t.pan&&this._rawPanBy(a),this.fire("move"),t.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(o.bind(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:e,newSize:i})):this},addHandler:function(t,e){if(!e)return this;var i=this[t]=new e(this);return this._handlers.push(i),this.options[t]&&i.enable(),this},remove:function(){this._loaded&&this.fire("unload"),this._initEvents("off");try{delete this._container._leaflet}catch(t){this._container._leaflet=i}return this._clearPanes(),this._clearControlPos&&this._clearControlPos(),this._clearHandlers(),this},getCenter:function(){return this._checkIfLoaded(),this._initialCenter&&!this._moved()?this._initialCenter:this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var t=this.getPixelBounds(),e=this.unproject(t.getBottomLeft()),i=this.unproject(t.getTopRight());return new o.LatLngBounds(e,i)},getMinZoom:function(){return this.options.minZoom===i?this._layersMinZoom===i?0:this._layersMinZoom:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===i?this._layersMaxZoom===i?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(t,e,i){t=o.latLngBounds(t);var n,s=this.getMinZoom()-(e?1:0),a=this.getMaxZoom(),r=this.getSize(),h=t.getNorthWest(),l=t.getSouthEast(),u=!0;i=o.point(i||[0,0]);do{s++,n=this.project(l,s).subtract(this.project(h,s)).add(i),u=e?n.x<r.x||n.y<r.y:r.contains(n)}while(u&&a>=s);return u&&e?null:e?s:s-1},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new o.Point(this._container.clientWidth,this._container.clientHeight),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(){var t=this._getTopLeftPoint();return new o.Bounds(t,t.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._initialTopLeftPoint},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(t){var e=this.options.crs;return e.scale(t)/e.scale(this._zoom)},getScaleZoom:function(t){return this._zoom+Math.log(t)/Math.LN2},project:function(t,e){return e=e===i?this._zoom:e,this.options.crs.latLngToPoint(o.latLng(t),e)},unproject:function(t,e){return e=e===i?this._zoom:e,this.options.crs.pointToLatLng(o.point(t),e)},layerPointToLatLng:function(t){var e=o.point(t).add(this.getPixelOrigin());return this.unproject(e)},latLngToLayerPoint:function(t){var e=this.project(o.latLng(t))._round();return e._subtract(this.getPixelOrigin())},containerPointToLayerPoint:function(t){return o.point(t).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(t){return o.point(t).add(this._getMapPanePos())},containerPointToLatLng:function(t){var e=this.containerPointToLayerPoint(o.point(t));return this.layerPointToLatLng(e)},latLngToContainerPoint:function(t){return this.layerPointToContainerPoint(this.latLngToLayerPoint(o.latLng(t)))},mouseEventToContainerPoint:function(t){return o.DomEvent.getMousePosition(t,this._container)},mouseEventToLayerPoint:function(t){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(t))},mouseEventToLatLng:function(t){return this.layerPointToLatLng(this.mouseEventToLayerPoint(t))},_initContainer:function(t){var e=this._container=o.DomUtil.get(t);if(!e)throw new Error("Map container not found.");if(e._leaflet)throw new Error("Map container is already initialized.");e._leaflet=!0},_initLayout:function(){var t=this._container;o.DomUtil.addClass(t,"leaflet-container"+(o.Browser.touch?" leaflet-touch":"")+(o.Browser.retina?" leaflet-retina":"")+(o.Browser.ielt9?" leaflet-oldie":"")+(this.options.fadeAnimation?" leaflet-fade-anim":""));var e=o.DomUtil.getStyle(t,"position");"absolute"!==e&&"relative"!==e&&"fixed"!==e&&(t.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var t=this._panes={};this._mapPane=t.mapPane=this._createPane("leaflet-map-pane",this._container),this._tilePane=t.tilePane=this._createPane("leaflet-tile-pane",this._mapPane),t.objectsPane=this._createPane("leaflet-objects-pane",this._mapPane),t.shadowPane=this._createPane("leaflet-shadow-pane"),t.overlayPane=this._createPane("leaflet-overlay-pane"),t.markerPane=this._createPane("leaflet-marker-pane"),t.popupPane=this._createPane("leaflet-popup-pane");var e=" leaflet-zoom-hide";this.options.markerZoomAnimation||(o.DomUtil.addClass(t.markerPane,e),o.DomUtil.addClass(t.shadowPane,e),o.DomUtil.addClass(t.popupPane,e))},_createPane:function(t,e){return o.DomUtil.create("div",t,e||this._panes.objectsPane)},_clearPanes:function(){this._container.removeChild(this._mapPane)},_addLayers:function(t){t=t?o.Util.isArray(t)?t:[t]:[];for(var e=0,i=t.length;i>e;e++)this.addLayer(t[e])},_resetView:function(t,e,i,n){var s=this._zoom!==e;n||(this.fire("movestart"),s&&this.fire("zoomstart")),this._zoom=e,this._initialCenter=t,this._initialTopLeftPoint=this._getNewTopLeftPoint(t),i?this._initialTopLeftPoint._add(this._getMapPanePos()):o.DomUtil.setPosition(this._mapPane,new o.Point(0,0)),this._tileLayersToLoad=this._tileLayersNum;var a=!this._loaded;this._loaded=!0,this.fire("viewreset",{hard:!i}),a&&(this.fire("load"),this.eachLayer(this._layerAdd,this)),this.fire("move"),(s||n)&&this.fire("zoomend"),this.fire("moveend",{hard:!i})},_rawPanBy:function(t){o.DomUtil.setPosition(this._mapPane,this._getMapPanePos().subtract(t))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_updateZoomLevels:function(){var t,e=1/0,n=-(1/0),o=this._getZoomSpan();for(t in this._zoomBoundLayers){var s=this._zoomBoundLayers[t];isNaN(s.options.minZoom)||(e=Math.min(e,s.options.minZoom)),isNaN(s.options.maxZoom)||(n=Math.max(n,s.options.maxZoom))}t===i?this._layersMaxZoom=this._layersMinZoom=i:(this._layersMaxZoom=n,this._layersMinZoom=e),o!==this._getZoomSpan()&&this.fire("zoomlevelschange")},_panInsideMaxBounds:function(){this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(e){if(o.DomEvent){e=e||"on",o.DomEvent[e](this._container,"click",this._onMouseClick,this);var i,n,s=["dblclick","mousedown","mouseup","mouseenter","mouseleave","mousemove","contextmenu"];for(i=0,n=s.length;n>i;i++)o.DomEvent[e](this._container,s[i],this._fireMouseEvent,this);this.options.trackResize&&o.DomEvent[e](t,"resize",this._onResize,this)}},_onResize:function(){o.Util.cancelAnimFrame(this._resizeRequest),this._resizeRequest=o.Util.requestAnimFrame(function(){this.invalidateSize({debounceMoveend:!0})},this,!1,this._container)},_onMouseClick:function(t){!this._loaded||!t._simulated&&(this.dragging&&this.dragging.moved()||this.boxZoom&&this.boxZoom.moved())||o.DomEvent._skipped(t)||(this.fire("preclick"),this._fireMouseEvent(t))},_fireMouseEvent:function(t){if(this._loaded&&!o.DomEvent._skipped(t)){var e=t.type;if(e="mouseenter"===e?"mouseover":"mouseleave"===e?"mouseout":e,this.hasEventListeners(e)){"contextmenu"===e&&o.DomEvent.preventDefault(t);var i=this.mouseEventToContainerPoint(t),n=this.containerPointToLayerPoint(i),s=this.layerPointToLatLng(n);this.fire(e,{latlng:s,layerPoint:n,containerPoint:i,originalEvent:t})}}},_onTileLayerLoad:function(){this._tileLayersToLoad--,this._tileLayersNum&&!this._tileLayersToLoad&&this.fire("tilelayersload")},_clearHandlers:function(){for(var t=0,e=this._handlers.length;e>t;t++)this._handlers[t].disable()},whenReady:function(t,e){return this._loaded?t.call(e||this,this):this.on("load",t,e),this},_layerAdd:function(t){t.onAdd(this),this.fire("layeradd",{layer:t})},_getMapPanePos:function(){return o.DomUtil.getPosition(this._mapPane)},_moved:function(){var t=this._getMapPanePos();return t&&!t.equals([0,0])},_getTopLeftPoint:function(){return this.getPixelOrigin().subtract(this._getMapPanePos())},_getNewTopLeftPoint:function(t,e){var i=this.getSize()._divideBy(2);return this.project(t,e)._subtract(i)._round()},_latLngToNewLayerPoint:function(t,e,i){var n=this._getNewTopLeftPoint(i,e).add(this._getMapPanePos());return this.project(t,e)._subtract(n)},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(t){return this.latLngToLayerPoint(t).subtract(this._getCenterLayerPoint())},_limitCenter:function(t,e,i){if(!i)return t;var n=this.project(t,e),s=this.getSize().divideBy(2),a=new o.Bounds(n.subtract(s),n.add(s)),r=this._getBoundsOffset(a,i,e);return this.unproject(n.add(r),e)},_limitOffset:function(t,e){if(!e)return t;var i=this.getPixelBounds(),n=new o.Bounds(i.min.add(t),i.max.add(t));return t.add(this._getBoundsOffset(n,e))},_getBoundsOffset:function(t,e,i){var n=this.project(e.getNorthWest(),i).subtract(t.min),s=this.project(e.getSouthEast(),i).subtract(t.max),a=this._rebound(n.x,-s.x),r=this._rebound(n.y,-s.y);return new o.Point(a,r)},_rebound:function(t,e){return t+e>0?Math.round(t-e)/2:Math.max(0,Math.ceil(t))-Math.max(0,Math.floor(e))},_limitZoom:function(t){var e=this.getMinZoom(),i=this.getMaxZoom();return Math.max(e,Math.min(i,t))}}),o.map=function(t,e){return new o.Map(t,e)},o.Projection.Mercator={MAX_LATITUDE:85.0840591556,R_MINOR:6356752.314245179,R_MAJOR:6378137,project:function(t){var e=o.LatLng.DEG_TO_RAD,i=this.MAX_LATITUDE,n=Math.max(Math.min(i,t.lat),-i),s=this.R_MAJOR,a=this.R_MINOR,r=t.lng*e*s,h=n*e,l=a/s,u=Math.sqrt(1-l*l),c=u*Math.sin(h);c=Math.pow((1-c)/(1+c),.5*u);var d=Math.tan(.5*(.5*Math.PI-h))/c;return h=-s*Math.log(d),new o.Point(r,h)},unproject:function(t){for(var e,i=o.LatLng.RAD_TO_DEG,n=this.R_MAJOR,s=this.R_MINOR,a=t.x*i/n,r=s/n,h=Math.sqrt(1-r*r),l=Math.exp(-t.y/n),u=Math.PI/2-2*Math.atan(l),c=15,d=1e-7,p=c,_=.1;Math.abs(_)>d&&--p>0;)e=h*Math.sin(u),_=Math.PI/2-2*Math.atan(l*Math.pow((1-e)/(1+e),.5*h))-u,u+=_;return new o.LatLng(u*i,a)}},o.CRS.EPSG3395=o.extend({},o.CRS,{code:"EPSG:3395",projection:o.Projection.Mercator,transformation:function(){var t=o.Projection.Mercator,e=t.R_MAJOR,i=.5/(Math.PI*e);return new o.Transformation(i,.5,-i,.5)}()}),o.TileLayer=o.Class.extend({includes:o.Mixin.Events,options:{minZoom:0,maxZoom:18,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",zoomOffset:0,opacity:1,unloadInvisibleTiles:o.Browser.mobile,updateWhenIdle:o.Browser.mobile},initialize:function(t,e){e=o.setOptions(this,e),e.detectRetina&&o.Browser.retina&&e.maxZoom>0&&(e.tileSize=Math.floor(e.tileSize/2),e.zoomOffset++,e.minZoom>0&&e.minZoom--,this.options.maxZoom--),e.bounds&&(e.bounds=o.latLngBounds(e.bounds)),this._url=t;var i=this.options.subdomains;"string"==typeof i&&(this.options.subdomains=i.split(""))},onAdd:function(t){this._map=t,this._animated=t._zoomAnimated,this._initContainer(),t.on({viewreset:this._reset,moveend:this._update},this),this._animated&&t.on({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this),this.options.updateWhenIdle||(this._limitedUpdate=o.Util.limitExecByInterval(this._update,150,this),t.on("move",this._limitedUpdate,this)),this._reset(),this._update()},addTo:function(t){return t.addLayer(this),this},onRemove:function(t){this._container.parentNode.removeChild(this._container),t.off({viewreset:this._reset,moveend:this._update},this),this._animated&&t.off({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this),this.options.updateWhenIdle||t.off("move",this._limitedUpdate,this),this._container=null,this._map=null},bringToFront:function(){var t=this._map._panes.tilePane;return this._container&&(t.appendChild(this._container),this._setAutoZIndex(t,Math.max)),this},bringToBack:function(){var t=this._map._panes.tilePane;return this._container&&(t.insertBefore(this._container,t.firstChild),this._setAutoZIndex(t,Math.min)),this},getAttribution:function(){return this.options.attribution},getContainer:function(){return this._container},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},setUrl:function(t,e){return this._url=t,e||this.redraw(),this},redraw:function(){return this._map&&(this._reset({hard:!0}),this._update()),this},_updateZIndex:function(){this._container&&this.options.zIndex!==i&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(t,e){var i,n,o,s=t.children,a=-e(1/0,-(1/0));for(n=0,o=s.length;o>n;n++)s[n]!==this._container&&(i=parseInt(s[n].style.zIndex,10),isNaN(i)||(a=e(a,i)));this.options.zIndex=this._container.style.zIndex=(isFinite(a)?a:0)+e(1,-1)},_updateOpacity:function(){var t,e=this._tiles;if(o.Browser.ielt9)for(t in e)o.DomUtil.setOpacity(e[t],this.options.opacity);else o.DomUtil.setOpacity(this._container,this.options.opacity)},_initContainer:function(){var t=this._map._panes.tilePane;if(!this._container){if(this._container=o.DomUtil.create("div","leaflet-layer"),this._updateZIndex(),this._animated){var e="leaflet-tile-container";this._bgBuffer=o.DomUtil.create("div",e,this._container),this._tileContainer=o.DomUtil.create("div",e,this._container)}else this._tileContainer=this._container;t.appendChild(this._container),this.options.opacity<1&&this._updateOpacity()}},_reset:function(t){for(var e in this._tiles)this.fire("tileunload",{tile:this._tiles[e]});this._tiles={},this._tilesToLoad=0,this.options.reuseTiles&&(this._unusedTiles=[]),this._tileContainer.innerHTML="",this._animated&&t&&t.hard&&this._clearBgBuffer(),this._initContainer()},_getTileSize:function(){var t=this._map,e=t.getZoom()+this.options.zoomOffset,i=this.options.maxNativeZoom,n=this.options.tileSize;return i&&e>i&&(n=Math.round(t.getZoomScale(e)/t.getZoomScale(i)*n)),n},_update:function(){if(this._map){var t=this._map,e=t.getPixelBounds(),i=t.getZoom(),n=this._getTileSize();if(!(i>this.options.maxZoom||i<this.options.minZoom)){var s=o.bounds(e.min.divideBy(n)._floor(),e.max.divideBy(n)._floor());this._addTilesFromCenterOut(s),(this.options.unloadInvisibleTiles||this.options.reuseTiles)&&this._removeOtherTiles(s)}}},_addTilesFromCenterOut:function(t){var i,n,s,a=[],r=t.getCenter();for(i=t.min.y;i<=t.max.y;i++)for(n=t.min.x;n<=t.max.x;n++)s=new o.Point(n,i),this._tileShouldBeLoaded(s)&&a.push(s);var h=a.length;if(0!==h){a.sort(function(t,e){return t.distanceTo(r)-e.distanceTo(r)});var l=e.createDocumentFragment();for(this._tilesToLoad||this.fire("loading"),this._tilesToLoad+=h,n=0;h>n;n++)this._addTile(a[n],l);this._tileContainer.appendChild(l)}},_tileShouldBeLoaded:function(t){if(t.x+":"+t.y in this._tiles)return!1;var e=this.options;if(!e.continuousWorld){var i=this._getWrapTileNum();if(e.noWrap&&(t.x<0||t.x>=i.x)||t.y<0||t.y>=i.y)return!1}if(e.bounds){var n=e.tileSize,o=t.multiplyBy(n),s=o.add([n,n]),a=this._map.unproject(o),r=this._map.unproject(s);if(e.continuousWorld||e.noWrap||(a=a.wrap(),r=r.wrap()),!e.bounds.intersects([a,r]))return!1}return!0},_removeOtherTiles:function(t){var e,i,n,o;for(o in this._tiles)e=o.split(":"),i=parseInt(e[0],10),n=parseInt(e[1],10),(i<t.min.x||i>t.max.x||n<t.min.y||n>t.max.y)&&this._removeTile(o)},_removeTile:function(t){var e=this._tiles[t];this.fire("tileunload",{tile:e,url:e.src}),this.options.reuseTiles?(o.DomUtil.removeClass(e,"leaflet-tile-loaded"),this._unusedTiles.push(e)):e.parentNode===this._tileContainer&&this._tileContainer.removeChild(e),o.Browser.android||(e.onload=null,e.src=o.Util.emptyImageUrl),delete this._tiles[t]},_addTile:function(t,e){var i=this._getTilePos(t),n=this._getTile();o.DomUtil.setPosition(n,i,o.Browser.chrome),this._tiles[t.x+":"+t.y]=n,this._loadTile(n,t),n.parentNode!==this._tileContainer&&e.appendChild(n)},_getZoomForUrl:function(){var t=this.options,e=this._map.getZoom();return t.zoomReverse&&(e=t.maxZoom-e),e+=t.zoomOffset,t.maxNativeZoom?Math.min(e,t.maxNativeZoom):e},_getTilePos:function(t){var e=this._map.getPixelOrigin(),i=this._getTileSize();return t.multiplyBy(i).subtract(e)},getTileUrl:function(t){return o.Util.template(this._url,o.extend({s:this._getSubdomain(t),z:t.z,x:t.x,y:t.y},this.options))},_getWrapTileNum:function(){var t=this._map.options.crs,e=t.getSize(this._map.getZoom());return e.divideBy(this._getTileSize())._floor()},_adjustTilePoint:function(t){var e=this._getWrapTileNum();this.options.continuousWorld||this.options.noWrap||(t.x=(t.x%e.x+e.x)%e.x),this.options.tms&&(t.y=e.y-t.y-1),t.z=this._getZoomForUrl()},_getSubdomain:function(t){var e=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[e]},_getTile:function(){if(this.options.reuseTiles&&this._unusedTiles.length>0){var t=this._unusedTiles.pop();return this._resetTile(t),t}return this._createTile()},_resetTile:function(){},_createTile:function(){var t=o.DomUtil.create("img","leaflet-tile");return t.style.width=t.style.height=this._getTileSize()+"px",t.galleryimg="no",t.onselectstart=t.onmousemove=o.Util.falseFn,o.Browser.ielt9&&this.options.opacity!==i&&o.DomUtil.setOpacity(t,this.options.opacity),o.Browser.mobileWebkit3d&&(t.style.WebkitBackfaceVisibility="hidden"),t},_loadTile:function(t,e){t._layer=this,t.onload=this._tileOnLoad,t.onerror=this._tileOnError,this._adjustTilePoint(e),t.src=this.getTileUrl(e),this.fire("tileloadstart",{tile:t,url:t.src})},_tileLoaded:function(){this._tilesToLoad--,this._animated&&o.DomUtil.addClass(this._tileContainer,"leaflet-zoom-animated"),this._tilesToLoad||(this.fire("load"),this._animated&&(clearTimeout(this._clearBgBufferTimer),this._clearBgBufferTimer=setTimeout(o.bind(this._clearBgBuffer,this),500)))},_tileOnLoad:function(){var t=this._layer;this.src!==o.Util.emptyImageUrl&&(o.DomUtil.addClass(this,"leaflet-tile-loaded"),t.fire("tileload",{tile:this,url:this.src})),t._tileLoaded()},_tileOnError:function(){var t=this._layer;t.fire("tileerror",{tile:this,url:this.src});var e=t.options.errorTileUrl;e&&(this.src=e),t._tileLoaded()}}),o.tileLayer=function(t,e){return new o.TileLayer(t,e)},o.TileLayer.WMS=o.TileLayer.extend({defaultWmsParams:{service:"WMS",request:"GetMap",version:"1.1.1",layers:"",styles:"",format:"image/jpeg",transparent:!1},initialize:function(t,e){this._url=t;var i=o.extend({},this.defaultWmsParams),n=e.tileSize||this.options.tileSize;e.detectRetina&&o.Browser.retina?i.width=i.height=2*n:i.width=i.height=n;for(var s in e)this.options.hasOwnProperty(s)||"crs"===s||(i[s]=e[s]);this.wmsParams=i,o.setOptions(this,e)},onAdd:function(t){this._crs=this.options.crs||t.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var e=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[e]=this._crs.code,o.TileLayer.prototype.onAdd.call(this,t)},getTileUrl:function(t){var e=this._map,i=this.options.tileSize,n=t.multiplyBy(i),s=n.add([i,i]),a=this._crs.project(e.unproject(n,t.z)),r=this._crs.project(e.unproject(s,t.z)),h=this._wmsVersion>=1.3&&this._crs===o.CRS.EPSG4326?[r.y,a.x,a.y,r.x].join(","):[a.x,r.y,r.x,a.y].join(","),l=o.Util.template(this._url,{s:this._getSubdomain(t)});return l+o.Util.getParamString(this.wmsParams,l,!0)+"&BBOX="+h},setParams:function(t,e){return o.extend(this.wmsParams,t),e||this.redraw(),this}}),o.tileLayer.wms=function(t,e){return new o.TileLayer.WMS(t,e)},o.TileLayer.Canvas=o.TileLayer.extend({options:{async:!1},initialize:function(t){o.setOptions(this,t)},redraw:function(){this._map&&(this._reset({hard:!0}),this._update());for(var t in this._tiles)this._redrawTile(this._tiles[t]);return this},_redrawTile:function(t){this.drawTile(t,t._tilePoint,this._map._zoom)},_createTile:function(){var t=o.DomUtil.create("canvas","leaflet-tile");return t.width=t.height=this.options.tileSize,t.onselectstart=t.onmousemove=o.Util.falseFn,t},_loadTile:function(t,e){t._layer=this,t._tilePoint=e,this._redrawTile(t),this.options.async||this.tileDrawn(t)},drawTile:function(){},tileDrawn:function(t){this._tileOnLoad.call(t)}}),o.tileLayer.canvas=function(t){return new o.TileLayer.Canvas(t)},o.ImageOverlay=o.Class.extend({includes:o.Mixin.Events,options:{opacity:1},initialize:function(t,e,i){this._url=t,this._bounds=o.latLngBounds(e),o.setOptions(this,i)},onAdd:function(t){this._map=t,this._image||this._initImage(),t._panes.overlayPane.appendChild(this._image),t.on("viewreset",this._reset,this),t.options.zoomAnimation&&o.Browser.any3d&&t.on("zoomanim",this._animateZoom,this),this._reset()},onRemove:function(t){t.getPanes().overlayPane.removeChild(this._image),t.off("viewreset",this._reset,this),t.options.zoomAnimation&&t.off("zoomanim",this._animateZoom,this)},addTo:function(t){return t.addLayer(this),this},setOpacity:function(t){return this.options.opacity=t,this._updateOpacity(),this},bringToFront:function(){return this._image&&this._map._panes.overlayPane.appendChild(this._image),this},bringToBack:function(){var t=this._map._panes.overlayPane;return this._image&&t.insertBefore(this._image,t.firstChild),this},setUrl:function(t){this._url=t,this._image.src=this._url},getAttribution:function(){return this.options.attribution},_initImage:function(){this._image=o.DomUtil.create("img","leaflet-image-layer"),this._map.options.zoomAnimation&&o.Browser.any3d?o.DomUtil.addClass(this._image,"leaflet-zoom-animated"):o.DomUtil.addClass(this._image,"leaflet-zoom-hide"),this._updateOpacity(),o.extend(this._image,{galleryimg:"no",onselectstart:o.Util.falseFn,onmousemove:o.Util.falseFn,onload:o.bind(this._onImageLoad,this),src:this._url})},_animateZoom:function(t){var e=this._map,i=this._image,n=e.getZoomScale(t.zoom),s=this._bounds.getNorthWest(),a=this._bounds.getSouthEast(),r=e._latLngToNewLayerPoint(s,t.zoom,t.center),h=e._latLngToNewLayerPoint(a,t.zoom,t.center)._subtract(r),l=r._add(h._multiplyBy(.5*(1-1/n)));i.style[o.DomUtil.TRANSFORM]=o.DomUtil.getTranslateString(l)+" scale("+n+") "},_reset:function(){var t=this._image,e=this._map.latLngToLayerPoint(this._bounds.getNorthWest()),i=this._map.latLngToLayerPoint(this._bounds.getSouthEast())._subtract(e);o.DomUtil.setPosition(t,e),t.style.width=i.x+"px",t.style.height=i.y+"px"},_onImageLoad:function(){this.fire("load")},_updateOpacity:function(){o.DomUtil.setOpacity(this._image,this.options.opacity)}}),o.imageOverlay=function(t,e,i){return new o.ImageOverlay(t,e,i)},o.Icon=o.Class.extend({options:{className:""},initialize:function(t){o.setOptions(this,t)},createIcon:function(t){return this._createIcon("icon",t)},createShadow:function(t){return this._createIcon("shadow",t)},_createIcon:function(t,e){var i=this._getIconUrl(t);if(!i){if("icon"===t)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var n;return n=e&&"IMG"===e.tagName?this._createImg(i,e):this._createImg(i),this._setIconStyles(n,t),n},_setIconStyles:function(t,e){var i,n=this.options,s=o.point(n[e+"Size"]);i=o.point("shadow"===e?n.shadowAnchor||n.iconAnchor:n.iconAnchor),!i&&s&&(i=s.divideBy(2,!0)),t.className="leaflet-marker-"+e+" "+n.className,i&&(t.style.marginLeft=-i.x+"px",t.style.marginTop=-i.y+"px"),s&&(t.style.width=s.x+"px",t.style.height=s.y+"px")},_createImg:function(t,i){return i=i||e.createElement("img"),i.src=t,i},_getIconUrl:function(t){return o.Browser.retina&&this.options[t+"RetinaUrl"]?this.options[t+"RetinaUrl"]:this.options[t+"Url"]}}),o.icon=function(t){return new o.Icon(t)},o.Icon.Default=o.Icon.extend({options:{iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]},_getIconUrl:function(t){var e=t+"Url";if(this.options[e])return this.options[e];o.Browser.retina&&"icon"===t&&(t+="-2x");var i=o.Icon.Default.imagePath;if(!i)throw new Error("Couldn't autodetect L.Icon.Default.imagePath, set it manually.");return i+"/marker-"+t+".png"}}),o.Icon.Default.imagePath=function(){var t,i,n,o,s,a=e.getElementsByTagName("script"),r=/[\/^]leaflet[\-\._]?([\w\-\._]*)\.js\??/;for(t=0,i=a.length;i>t;t++)if(n=a[t].src,o=n.match(r))return s=n.split(r)[0],(s?s+"/":"")+"images"}(),o.Marker=o.Class.extend({includes:o.Mixin.Events,options:{icon:new o.Icon.Default,title:"",alt:"",clickable:!0,draggable:!1,keyboard:!0,zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250},initialize:function(t,e){o.setOptions(this,e),this._latlng=o.latLng(t)},onAdd:function(t){this._map=t,t.on("viewreset",this.update,this),this._initIcon(),this.update(),this.fire("add"),t.options.zoomAnimation&&t.options.markerZoomAnimation&&t.on("zoomanim",this._animateZoom,this)},addTo:function(t){return t.addLayer(this),this},onRemove:function(t){this.dragging&&this.dragging.disable(),this._removeIcon(),this._removeShadow(),this.fire("remove"),t.off({viewreset:this.update,zoomanim:this._animateZoom},this),this._map=null},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=o.latLng(t),this.update(),this.fire("move",{latlng:this._latlng})},setZIndexOffset:function(t){return this.options.zIndexOffset=t,this.update(),this},setIcon:function(t){return this.options.icon=t,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup),this},update:function(){if(this._icon){var t=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(t)}return this},_initIcon:function(){var t=this.options,e=this._map,i=e.options.zoomAnimation&&e.options.markerZoomAnimation,n=i?"leaflet-zoom-animated":"leaflet-zoom-hide",s=t.icon.createIcon(this._icon),a=!1;s!==this._icon&&(this._icon&&this._removeIcon(),a=!0,t.title&&(s.title=t.title),t.alt&&(s.alt=t.alt)),o.DomUtil.addClass(s,n),t.keyboard&&(s.tabIndex="0"),this._icon=s,this._initInteraction(),t.riseOnHover&&o.DomEvent.on(s,"mouseover",this._bringToFront,this).on(s,"mouseout",this._resetZIndex,this);var r=t.icon.createShadow(this._shadow),h=!1;r!==this._shadow&&(this._removeShadow(),h=!0),r&&o.DomUtil.addClass(r,n),this._shadow=r,t.opacity<1&&this._updateOpacity();var l=this._map._panes;a&&l.markerPane.appendChild(this._icon),r&&h&&l.shadowPane.appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&o.DomEvent.off(this._icon,"mouseover",this._bringToFront).off(this._icon,"mouseout",this._resetZIndex),this._map._panes.markerPane.removeChild(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&this._map._panes.shadowPane.removeChild(this._shadow),this._shadow=null},_setPos:function(t){o.DomUtil.setPosition(this._icon,t),this._shadow&&o.DomUtil.setPosition(this._shadow,t),this._zIndex=t.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(t){this._icon.style.zIndex=this._zIndex+t},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center).round();this._setPos(e)},_initInteraction:function(){if(this.options.clickable){var t=this._icon,e=["dblclick","mousedown","mouseover","mouseout","contextmenu"];o.DomUtil.addClass(t,"leaflet-clickable"),o.DomEvent.on(t,"click",this._onMouseClick,this),o.DomEvent.on(t,"keypress",this._onKeyPress,this);for(var i=0;i<e.length;i++)o.DomEvent.on(t,e[i],this._fireMouseEvent,this);o.Handler.MarkerDrag&&(this.dragging=new o.Handler.MarkerDrag(this),this.options.draggable&&this.dragging.enable())}},_onMouseClick:function(t){var e=this.dragging&&this.dragging.moved();(this.hasEventListeners(t.type)||e)&&o.DomEvent.stopPropagation(t),e||(this.dragging&&this.dragging._enabled||!this._map.dragging||!this._map.dragging.moved())&&this.fire(t.type,{originalEvent:t,latlng:this._latlng})},_onKeyPress:function(t){13===t.keyCode&&this.fire("click",{originalEvent:t,latlng:this._latlng})},_fireMouseEvent:function(t){this.fire(t.type,{originalEvent:t,latlng:this._latlng}),"contextmenu"===t.type&&this.hasEventListeners(t.type)&&o.DomEvent.preventDefault(t),"mousedown"!==t.type?o.DomEvent.stopPropagation(t):o.DomEvent.preventDefault(t)},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},_updateOpacity:function(){o.DomUtil.setOpacity(this._icon,this.options.opacity),this._shadow&&o.DomUtil.setOpacity(this._shadow,this.options.opacity)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)}}),o.marker=function(t,e){return new o.Marker(t,e)},o.DivIcon=o.Icon.extend({options:{iconSize:[12,12],className:"leaflet-div-icon",html:!1},createIcon:function(t){var i=t&&"DIV"===t.tagName?t:e.createElement("div"),n=this.options;return n.html!==!1?i.innerHTML=n.html:i.innerHTML="",n.bgPos&&(i.style.backgroundPosition=-n.bgPos.x+"px "+-n.bgPos.y+"px"),this._setIconStyles(i,"icon"),i},createShadow:function(){return null}}),o.divIcon=function(t){return new o.DivIcon(t)},o.Map.mergeOptions({closePopupOnClick:!0}),o.Popup=o.Class.extend({includes:o.Mixin.Events,options:{minWidth:50,maxWidth:300,autoPan:!0,closeButton:!0,offset:[0,7],autoPanPadding:[5,5],keepInView:!1,className:"",zoomAnimation:!0},initialize:function(t,e){o.setOptions(this,t),this._source=e,this._animated=o.Browser.any3d&&this.options.zoomAnimation,this._isOpen=!1},onAdd:function(t){this._map=t,this._container||this._initLayout();var e=t.options.fadeAnimation;e&&o.DomUtil.setOpacity(this._container,0),t._panes.popupPane.appendChild(this._container),t.on(this._getEvents(),this),this.update(),e&&o.DomUtil.setOpacity(this._container,1),this.fire("open"),t.fire("popupopen",{popup:this}),this._source&&this._source.fire("popupopen",{popup:this})},addTo:function(t){return t.addLayer(this),this},openOn:function(t){return t.openPopup(this),this},onRemove:function(t){t._panes.popupPane.removeChild(this._container),o.Util.falseFn(this._container.offsetWidth),t.off(this._getEvents(),this),t.options.fadeAnimation&&o.DomUtil.setOpacity(this._container,0),this._map=null,this.fire("close"),t.fire("popupclose",{popup:this}),this._source&&this._source.fire("popupclose",{popup:this})},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=o.latLng(t),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(t){return this._content=t,this.update(),this},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},_getEvents:function(){var t={viewreset:this._updatePosition};return this._animated&&(t.zoomanim=this._zoomAnimation),("closeOnClick"in this.options?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(t.preclick=this._close),this.options.keepInView&&(t.moveend=this._adjustPan),t},_close:function(){this._map&&this._map.closePopup(this)},_initLayout:function(){var t,e="leaflet-popup",i=e+" "+this.options.className+" leaflet-zoom-"+(this._animated?"animated":"hide"),n=this._container=o.DomUtil.create("div",i);this.options.closeButton&&(t=this._closeButton=o.DomUtil.create("a",e+"-close-button",n),t.href="#close",t.innerHTML="&#215;",o.DomEvent.disableClickPropagation(t),o.DomEvent.on(t,"click",this._onCloseButtonClick,this));var s=this._wrapper=o.DomUtil.create("div",e+"-content-wrapper",n);o.DomEvent.disableClickPropagation(s),this._contentNode=o.DomUtil.create("div",e+"-content",s),o.DomEvent.disableScrollPropagation(this._contentNode),o.DomEvent.on(s,"contextmenu",o.DomEvent.stopPropagation),this._tipContainer=o.DomUtil.create("div",e+"-tip-container",n),this._tip=o.DomUtil.create("div",e+"-tip",this._tipContainer)},_updateContent:function(){if(this._content){if("string"==typeof this._content)this._contentNode.innerHTML=this._content;else{for(;this._contentNode.hasChildNodes();)this._contentNode.removeChild(this._contentNode.firstChild);this._contentNode.appendChild(this._content)}this.fire("contentupdate")}},_updateLayout:function(){var t=this._contentNode,e=t.style;e.width="",e.whiteSpace="nowrap";var i=t.offsetWidth;i=Math.min(i,this.options.maxWidth),i=Math.max(i,this.options.minWidth),e.width=i+1+"px",e.whiteSpace="",e.height="";var n=t.offsetHeight,s=this.options.maxHeight,a="leaflet-popup-scrolled";s&&n>s?(e.height=s+"px",o.DomUtil.addClass(t,a)):o.DomUtil.removeClass(t,a),this._containerWidth=this._container.offsetWidth},_updatePosition:function(){if(this._map){var t=this._map.latLngToLayerPoint(this._latlng),e=this._animated,i=o.point(this.options.offset);e&&o.DomUtil.setPosition(this._container,t),this._containerBottom=-i.y-(e?0:t.y),this._containerLeft=-Math.round(this._containerWidth/2)+i.x+(e?0:t.x),this._container.style.bottom=this._containerBottom+"px",this._container.style.left=this._containerLeft+"px"}},_zoomAnimation:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);o.DomUtil.setPosition(this._container,e)},_adjustPan:function(){if(this.options.autoPan){var t=this._map,e=this._container.offsetHeight,i=this._containerWidth,n=new o.Point(this._containerLeft,-e-this._containerBottom);this._animated&&n._add(o.DomUtil.getPosition(this._container));var s=t.layerPointToContainerPoint(n),a=o.point(this.options.autoPanPadding),r=o.point(this.options.autoPanPaddingTopLeft||a),h=o.point(this.options.autoPanPaddingBottomRight||a),l=t.getSize(),u=0,c=0;s.x+i+h.x>l.x&&(u=s.x+i-l.x+h.x),s.x-u-r.x<0&&(u=s.x-r.x),s.y+e+h.y>l.y&&(c=s.y+e-l.y+h.y),s.y-c-r.y<0&&(c=s.y-r.y),(u||c)&&t.fire("autopanstart").panBy([u,c])}},_onCloseButtonClick:function(t){this._close(),o.DomEvent.stop(t)}}),o.popup=function(t,e){return new o.Popup(t,e)},o.Map.include({openPopup:function(t,e,i){if(this.closePopup(),!(t instanceof o.Popup)){var n=t;t=new o.Popup(i).setLatLng(e).setContent(n)}return t._isOpen=!0,this._popup=t,this.addLayer(t)},closePopup:function(t){return t&&t!==this._popup||(t=this._popup,this._popup=null),t&&(this.removeLayer(t),t._isOpen=!1),this}}),o.Marker.include({openPopup:function(){return this._popup&&this._map&&!this._map.hasLayer(this._popup)&&(this._popup.setLatLng(this._latlng),this._map.openPopup(this._popup)),this},closePopup:function(){return this._popup&&this._popup._close(),this},togglePopup:function(){return this._popup&&(this._popup._isOpen?this.closePopup():this.openPopup()),this},bindPopup:function(t,e){var i=o.point(this.options.icon.options.popupAnchor||[0,0]);return i=i.add(o.Popup.prototype.options.offset),e&&e.offset&&(i=i.add(e.offset)),e=o.extend({offset:i},e),this._popupHandlersAdded||(this.on("click",this.togglePopup,this).on("remove",this.closePopup,this).on("move",this._movePopup,this),this._popupHandlersAdded=!0),t instanceof o.Popup?(o.setOptions(t,e),this._popup=t):this._popup=new o.Popup(e,this).setContent(t),this},setPopupContent:function(t){return this._popup&&this._popup.setContent(t),this},unbindPopup:function(){return this._popup&&(this._popup=null,this.off("click",this.togglePopup,this).off("remove",this.closePopup,this).off("move",this._movePopup,this),this._popupHandlersAdded=!1),this},getPopup:function(){return this._popup},_movePopup:function(t){this._popup.setLatLng(t.latlng)}}),o.LayerGroup=o.Class.extend({initialize:function(t){this._layers={};var e,i;if(t)for(e=0,i=t.length;i>e;e++)this.addLayer(t[e])},addLayer:function(t){var e=this.getLayerId(t);return this._layers[e]=t,this._map&&this._map.addLayer(t),this},removeLayer:function(t){var e=t in this._layers?t:this.getLayerId(t);return this._map&&this._layers[e]&&this._map.removeLayer(this._layers[e]),delete this._layers[e],this},hasLayer:function(t){return t?t in this._layers||this.getLayerId(t)in this._layers:!1},clearLayers:function(){return this.eachLayer(this.removeLayer,this),this},invoke:function(t){var e,i,n=Array.prototype.slice.call(arguments,1);for(e in this._layers)i=this._layers[e],i[t]&&i[t].apply(i,n);return this},onAdd:function(t){this._map=t,this.eachLayer(t.addLayer,t)},onRemove:function(t){this.eachLayer(t.removeLayer,t),this._map=null},addTo:function(t){return t.addLayer(this),this},eachLayer:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},getLayer:function(t){return this._layers[t]},getLayers:function(){var t=[];for(var e in this._layers)t.push(this._layers[e]);return t},setZIndex:function(t){return this.invoke("setZIndex",t)},getLayerId:function(t){return o.stamp(t)}}),o.layerGroup=function(t){return new o.LayerGroup(t)},o.FeatureGroup=o.LayerGroup.extend({includes:o.Mixin.Events,statics:{EVENTS:"click dblclick mouseover mouseout mousemove contextmenu popupopen popupclose"},addLayer:function(t){return this.hasLayer(t)?this:("on"in t&&t.on(o.FeatureGroup.EVENTS,this._propagateEvent,this),o.LayerGroup.prototype.addLayer.call(this,t),this._popupContent&&t.bindPopup&&t.bindPopup(this._popupContent,this._popupOptions),this.fire("layeradd",{layer:t}))},removeLayer:function(t){return this.hasLayer(t)?(t in this._layers&&(t=this._layers[t]),t.off(o.FeatureGroup.EVENTS,this._propagateEvent,this),o.LayerGroup.prototype.removeLayer.call(this,t),this._popupContent&&this.invoke("unbindPopup"),this.fire("layerremove",{layer:t})):this},bindPopup:function(t,e){return this._popupContent=t,this._popupOptions=e,this.invoke("bindPopup",t,e)},openPopup:function(t){for(var e in this._layers){this._layers[e].openPopup(t);break}return this},setStyle:function(t){return this.invoke("setStyle",t)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var t=new o.LatLngBounds;return this.eachLayer(function(e){t.extend(e instanceof o.Marker?e.getLatLng():e.getBounds())}),t},_propagateEvent:function(t){t=o.extend({layer:t.target,target:this},t),this.fire(t.type,t)}}),o.featureGroup=function(t){return new o.FeatureGroup(t)},o.Path=o.Class.extend({includes:[o.Mixin.Events],statics:{CLIP_PADDING:function(){var e=o.Browser.mobile?1280:2e3,i=(e/Math.max(t.outerWidth,t.outerHeight)-1)/2;return Math.max(0,Math.min(.5,i))}()},options:{stroke:!0,color:"#0033ff",dashArray:null,lineCap:null,lineJoin:null,weight:5,opacity:.5,fill:!1,fillColor:null,fillOpacity:.2,clickable:!0},initialize:function(t){o.setOptions(this,t)},onAdd:function(t){this._map=t,this._container||(this._initElements(),this._initEvents()),this.projectLatlngs(),this._updatePath(),this._container&&this._map._pathRoot.appendChild(this._container),this.fire("add"),t.on({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},addTo:function(t){return t.addLayer(this),this},onRemove:function(t){t._pathRoot.removeChild(this._container),this.fire("remove"),this._map=null,o.Browser.vml&&(this._container=null,this._stroke=null,this._fill=null),t.off({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},projectLatlngs:function(){},setStyle:function(t){return o.setOptions(this,t),this._container&&this._updateStyle(),this},redraw:function(){return this._map&&(this.projectLatlngs(),this._updatePath()),this}}),o.Map.include({_updatePathViewport:function(){var t=o.Path.CLIP_PADDING,e=this.getSize(),i=o.DomUtil.getPosition(this._mapPane),n=i.multiplyBy(-1)._subtract(e.multiplyBy(t)._round()),s=n.add(e.multiplyBy(1+2*t)._round());this._pathViewport=new o.Bounds(n,s)}}),o.Path.SVG_NS="http://www.w3.org/2000/svg",o.Browser.svg=!(!e.createElementNS||!e.createElementNS(o.Path.SVG_NS,"svg").createSVGRect),o.Path=o.Path.extend({statics:{SVG:o.Browser.svg},bringToFront:function(){var t=this._map._pathRoot,e=this._container;return e&&t.lastChild!==e&&t.appendChild(e),this},bringToBack:function(){var t=this._map._pathRoot,e=this._container,i=t.firstChild;return e&&i!==e&&t.insertBefore(e,i),this},getPathString:function(){},_createElement:function(t){return e.createElementNS(o.Path.SVG_NS,t)},_initElements:function(){this._map._initPathRoot(),this._initPath(),this._initStyle()},_initPath:function(){this._container=this._createElement("g"),this._path=this._createElement("path"),this.options.className&&o.DomUtil.addClass(this._path,this.options.className),this._container.appendChild(this._path)},_initStyle:function(){this.options.stroke&&(this._path.setAttribute("stroke-linejoin","round"),this._path.setAttribute("stroke-linecap","round")),this.options.fill&&this._path.setAttribute("fill-rule","evenodd"),this.options.pointerEvents&&this._path.setAttribute("pointer-events",this.options.pointerEvents),this.options.clickable||this.options.pointerEvents||this._path.setAttribute("pointer-events","none"),this._updateStyle()},_updateStyle:function(){this.options.stroke?(this._path.setAttribute("stroke",this.options.color),this._path.setAttribute("stroke-opacity",this.options.opacity),this._path.setAttribute("stroke-width",this.options.weight),this.options.dashArray?this._path.setAttribute("stroke-dasharray",this.options.dashArray):this._path.removeAttribute("stroke-dasharray"),this.options.lineCap&&this._path.setAttribute("stroke-linecap",this.options.lineCap),this.options.lineJoin&&this._path.setAttribute("stroke-linejoin",this.options.lineJoin)):this._path.setAttribute("stroke","none"),this.options.fill?(this._path.setAttribute("fill",this.options.fillColor||this.options.color),this._path.setAttribute("fill-opacity",this.options.fillOpacity)):this._path.setAttribute("fill","none")},_updatePath:function(){var t=this.getPathString();t||(t="M0 0"),this._path.setAttribute("d",t)},_initEvents:function(){if(this.options.clickable){(o.Browser.svg||!o.Browser.vml)&&o.DomUtil.addClass(this._path,"leaflet-clickable"),o.DomEvent.on(this._container,"click",this._onMouseClick,this);for(var t=["dblclick","mousedown","mouseover","mouseout","mousemove","contextmenu"],e=0;e<t.length;e++)o.DomEvent.on(this._container,t[e],this._fireMouseEvent,this)}},_onMouseClick:function(t){this._map.dragging&&this._map.dragging.moved()||this._fireMouseEvent(t)},_fireMouseEvent:function(t){if(this.hasEventListeners(t.type)){var e=this._map,i=e.mouseEventToContainerPoint(t),n=e.containerPointToLayerPoint(i),s=e.layerPointToLatLng(n);this.fire(t.type,{latlng:s,layerPoint:n,containerPoint:i,originalEvent:t}),"contextmenu"===t.type&&o.DomEvent.preventDefault(t),"mousemove"!==t.type&&o.DomEvent.stopPropagation(t)}}}),o.Map.include({_initPathRoot:function(){this._pathRoot||(this._pathRoot=o.Path.prototype._createElement("svg"),this._panes.overlayPane.appendChild(this._pathRoot),this.options.zoomAnimation&&o.Browser.any3d?(o.DomUtil.addClass(this._pathRoot,"leaflet-zoom-animated"),this.on({zoomanim:this._animatePathZoom,zoomend:this._endPathZoom})):o.DomUtil.addClass(this._pathRoot,"leaflet-zoom-hide"),this.on("moveend",this._updateSvgViewport),this._updateSvgViewport())},_animatePathZoom:function(t){var e=this.getZoomScale(t.zoom),i=this._getCenterOffset(t.center)._multiplyBy(-e)._add(this._pathViewport.min);this._pathRoot.style[o.DomUtil.TRANSFORM]=o.DomUtil.getTranslateString(i)+" scale("+e+") ",this._pathZooming=!0},_endPathZoom:function(){this._pathZooming=!1},_updateSvgViewport:function(){if(!this._pathZooming){this._updatePathViewport();var t=this._pathViewport,e=t.min,i=t.max,n=i.x-e.x,s=i.y-e.y,a=this._pathRoot,r=this._panes.overlayPane;o.Browser.mobileWebkit&&r.removeChild(a),o.DomUtil.setPosition(a,e),a.setAttribute("width",n),a.setAttribute("height",s),a.setAttribute("viewBox",[e.x,e.y,n,s].join(" ")),o.Browser.mobileWebkit&&r.appendChild(a)}}}),o.Path.include({bindPopup:function(t,e){return t instanceof o.Popup?this._popup=t:((!this._popup||e)&&(this._popup=new o.Popup(e,this)),this._popup.setContent(t)),this._popupHandlersAdded||(this.on("click",this._openPopup,this).on("remove",this.closePopup,this),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this._popup=null,this.off("click",this._openPopup).off("remove",this.closePopup),this._popupHandlersAdded=!1),this},openPopup:function(t){return this._popup&&(t=t||this._latlng||this._latlngs[Math.floor(this._latlngs.length/2)],this._openPopup({latlng:t})),this},closePopup:function(){return this._popup&&this._popup._close(),this},_openPopup:function(t){this._popup.setLatLng(t.latlng),this._map.openPopup(this._popup)}}),o.Browser.vml=!o.Browser.svg&&function(){try{var t=e.createElement("div");t.innerHTML='<v:shape adj="1"/>';var i=t.firstChild;return i.style.behavior="url(#default#VML)",i&&"object"==typeof i.adj}catch(n){return!1}}(),o.Path=o.Browser.svg||!o.Browser.vml?o.Path:o.Path.extend({statics:{VML:!0,CLIP_PADDING:.02},_createElement:function(){try{return e.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(t){return e.createElement("<lvml:"+t+' class="lvml">')}}catch(t){return function(t){return e.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}(),_initPath:function(){var t=this._container=this._createElement("shape");o.DomUtil.addClass(t,"leaflet-vml-shape"+(this.options.className?" "+this.options.className:"")),this.options.clickable&&o.DomUtil.addClass(t,"leaflet-clickable"),t.coordsize="1 1",this._path=this._createElement("path"),t.appendChild(this._path),this._map._pathRoot.appendChild(t)},_initStyle:function(){this._updateStyle()},_updateStyle:function(){var t=this._stroke,e=this._fill,i=this.options,n=this._container;n.stroked=i.stroke,n.filled=i.fill,i.stroke?(t||(t=this._stroke=this._createElement("stroke"),t.endcap="round",n.appendChild(t)),t.weight=i.weight+"px",t.color=i.color,t.opacity=i.opacity,i.dashArray?t.dashStyle=o.Util.isArray(i.dashArray)?i.dashArray.join(" "):i.dashArray.replace(/( *, *)/g," "):t.dashStyle="",i.lineCap&&(t.endcap=i.lineCap.replace("butt","flat")),i.lineJoin&&(t.joinstyle=i.lineJoin)):t&&(n.removeChild(t),this._stroke=null),i.fill?(e||(e=this._fill=this._createElement("fill"),n.appendChild(e)),e.color=i.fillColor||i.color,e.opacity=i.fillOpacity):e&&(n.removeChild(e),this._fill=null)},_updatePath:function(){var t=this._container.style;t.display="none",this._path.v=this.getPathString()+" ",t.display=""}}),o.Map.include(o.Browser.svg||!o.Browser.vml?{}:{_initPathRoot:function(){if(!this._pathRoot){var t=this._pathRoot=e.createElement("div");t.className="leaflet-vml-container",this._panes.overlayPane.appendChild(t),this.on("moveend",this._updatePathViewport),this._updatePathViewport()}}}),o.Browser.canvas=function(){return!!e.createElement("canvas").getContext}(),o.Path=o.Path.SVG&&!t.L_PREFER_CANVAS||!o.Browser.canvas?o.Path:o.Path.extend({statics:{CANVAS:!0,SVG:!1},redraw:function(){return this._map&&(this.projectLatlngs(),this._requestUpdate()),this},setStyle:function(t){return o.setOptions(this,t),this._map&&(this._updateStyle(),this._requestUpdate()),this},onRemove:function(t){t.off("viewreset",this.projectLatlngs,this).off("moveend",this._updatePath,this),this.options.clickable&&(this._map.off("click",this._onClick,this),this._map.off("mousemove",this._onMouseMove,this)),this._requestUpdate(),this.fire("remove"),this._map=null},_requestUpdate:function(){this._map&&!o.Path._updateRequest&&(o.Path._updateRequest=o.Util.requestAnimFrame(this._fireMapMoveEnd,this._map))},_fireMapMoveEnd:function(){o.Path._updateRequest=null,this.fire("moveend")},_initElements:function(){this._map._initPathRoot(),this._ctx=this._map._canvasCtx},_updateStyle:function(){var t=this.options;t.stroke&&(this._ctx.lineWidth=t.weight,this._ctx.strokeStyle=t.color),t.fill&&(this._ctx.fillStyle=t.fillColor||t.color)},_drawPath:function(){var t,e,i,n,s,a;for(this._ctx.beginPath(),t=0,i=this._parts.length;i>t;t++){for(e=0,n=this._parts[t].length;n>e;e++)s=this._parts[t][e],a=(0===e?"move":"line")+"To",this._ctx[a](s.x,s.y);this instanceof o.Polygon&&this._ctx.closePath()}},_checkIfEmpty:function(){return!this._parts.length},_updatePath:function(){if(!this._checkIfEmpty()){var t=this._ctx,e=this.options;this._drawPath(),t.save(),this._updateStyle(),e.fill&&(t.globalAlpha=e.fillOpacity,t.fill()),e.stroke&&(t.globalAlpha=e.opacity,t.stroke()),t.restore()}},_initEvents:function(){this.options.clickable&&(this._map.on("mousemove",this._onMouseMove,this),this._map.on("click",this._onClick,this))},_onClick:function(t){this._containsPoint(t.layerPoint)&&this.fire("click",t)},_onMouseMove:function(t){this._map&&!this._map._animatingZoom&&(this._containsPoint(t.layerPoint)?(this._ctx.canvas.style.cursor="pointer",this._mouseInside=!0,this.fire("mouseover",t)):this._mouseInside&&(this._ctx.canvas.style.cursor="",this._mouseInside=!1,this.fire("mouseout",t)))}}),o.Map.include(o.Path.SVG&&!t.L_PREFER_CANVAS||!o.Browser.canvas?{}:{_initPathRoot:function(){var t,i=this._pathRoot;i||(i=this._pathRoot=e.createElement("canvas"),i.style.position="absolute",t=this._canvasCtx=i.getContext("2d"),t.lineCap="round",t.lineJoin="round",this._panes.overlayPane.appendChild(i),this.options.zoomAnimation&&(this._pathRoot.className="leaflet-zoom-animated",this.on("zoomanim",this._animatePathZoom),this.on("zoomend",this._endPathZoom)),this.on("moveend",this._updateCanvasViewport),this._updateCanvasViewport())},_updateCanvasViewport:function(){if(!this._pathZooming){this._updatePathViewport();var t=this._pathViewport,e=t.min,i=t.max.subtract(e),n=this._pathRoot;o.DomUtil.setPosition(n,e),n.width=i.x,n.height=i.y,n.getContext("2d").translate(-e.x,-e.y)}}}),o.LineUtil={simplify:function(t,e){if(!e||!t.length)return t.slice();var i=e*e;return t=this._reducePoints(t,i),t=this._simplifyDP(t,i)},pointToSegmentDistance:function(t,e,i){return Math.sqrt(this._sqClosestPointOnSegment(t,e,i,!0))},closestPointOnSegment:function(t,e,i){return this._sqClosestPointOnSegment(t,e,i)},_simplifyDP:function(t,e){var n=t.length,o=typeof Uint8Array!=i+""?Uint8Array:Array,s=new o(n);s[0]=s[n-1]=1,this._simplifyDPStep(t,s,e,0,n-1);var a,r=[];for(a=0;n>a;a++)s[a]&&r.push(t[a]);return r},_simplifyDPStep:function(t,e,i,n,o){var s,a,r,h=0;for(a=n+1;o-1>=a;a++)r=this._sqClosestPointOnSegment(t[a],t[n],t[o],!0),r>h&&(s=a,h=r);h>i&&(e[s]=1,this._simplifyDPStep(t,e,i,n,s),this._simplifyDPStep(t,e,i,s,o))},_reducePoints:function(t,e){for(var i=[t[0]],n=1,o=0,s=t.length;s>n;n++)this._sqDist(t[n],t[o])>e&&(i.push(t[n]),o=n);return s-1>o&&i.push(t[s-1]),i},clipSegment:function(t,e,i,n){var o,s,a,r=n?this._lastCode:this._getBitCode(t,i),h=this._getBitCode(e,i);for(this._lastCode=h;;){if(!(r|h))return[t,e];if(r&h)return!1;o=r||h,s=this._getEdgeIntersection(t,e,o,i),a=this._getBitCode(s,i),o===r?(t=s,r=a):(e=s,h=a)}},_getEdgeIntersection:function(t,e,i,n){var s=e.x-t.x,a=e.y-t.y,r=n.min,h=n.max;return 8&i?new o.Point(t.x+s*(h.y-t.y)/a,h.y):4&i?new o.Point(t.x+s*(r.y-t.y)/a,r.y):2&i?new o.Point(h.x,t.y+a*(h.x-t.x)/s):1&i?new o.Point(r.x,t.y+a*(r.x-t.x)/s):void 0},_getBitCode:function(t,e){var i=0;return t.x<e.min.x?i|=1:t.x>e.max.x&&(i|=2),t.y<e.min.y?i|=4:t.y>e.max.y&&(i|=8),i},_sqDist:function(t,e){var i=e.x-t.x,n=e.y-t.y;return i*i+n*n},_sqClosestPointOnSegment:function(t,e,i,n){var s,a=e.x,r=e.y,h=i.x-a,l=i.y-r,u=h*h+l*l;return u>0&&(s=((t.x-a)*h+(t.y-r)*l)/u,s>1?(a=i.x,r=i.y):s>0&&(a+=h*s,r+=l*s)),h=t.x-a,l=t.y-r,n?h*h+l*l:new o.Point(a,r)}},o.Polyline=o.Path.extend({initialize:function(t,e){o.Path.prototype.initialize.call(this,e),this._latlngs=this._convertLatLngs(t)},options:{smoothFactor:1,noClip:!1},projectLatlngs:function(){this._originalPoints=[];for(var t=0,e=this._latlngs.length;e>t;t++)this._originalPoints[t]=this._map.latLngToLayerPoint(this._latlngs[t])},getPathString:function(){for(var t=0,e=this._parts.length,i="";e>t;t++)i+=this._getPathPartStr(this._parts[t]);return i},getLatLngs:function(){return this._latlngs},setLatLngs:function(t){return this._latlngs=this._convertLatLngs(t),this.redraw()},addLatLng:function(t){return this._latlngs.push(o.latLng(t)),this.redraw()},spliceLatLngs:function(){var t=[].splice.apply(this._latlngs,arguments);return this._convertLatLngs(this._latlngs,!0),this.redraw(),t},closestLayerPoint:function(t){for(var e,i,n=1/0,s=this._parts,a=null,r=0,h=s.length;h>r;r++)for(var l=s[r],u=1,c=l.length;c>u;u++){e=l[u-1],i=l[u];var d=o.LineUtil._sqClosestPointOnSegment(t,e,i,!0);n>d&&(n=d,a=o.LineUtil._sqClosestPointOnSegment(t,e,i))}return a&&(a.distance=Math.sqrt(n)),a},getBounds:function(){return new o.LatLngBounds(this.getLatLngs())},_convertLatLngs:function(t,e){var i,n,s=e?t:[];for(i=0,n=t.length;n>i;i++){if(o.Util.isArray(t[i])&&"number"!=typeof t[i][0])return;s[i]=o.latLng(t[i])}return s},_initEvents:function(){o.Path.prototype._initEvents.call(this)},_getPathPartStr:function(t){for(var e,i=o.Path.VML,n=0,s=t.length,a="";s>n;n++)e=t[n],i&&e._round(),a+=(n?"L":"M")+e.x+" "+e.y;return a},_clipPoints:function(){var t,e,i,n=this._originalPoints,s=n.length;if(this.options.noClip)return void(this._parts=[n]);this._parts=[];var a=this._parts,r=this._map._pathViewport,h=o.LineUtil;for(t=0,e=0;s-1>t;t++)i=h.clipSegment(n[t],n[t+1],r,t),i&&(a[e]=a[e]||[],a[e].push(i[0]),(i[1]!==n[t+1]||t===s-2)&&(a[e].push(i[1]),e++))},_simplifyPoints:function(){for(var t=this._parts,e=o.LineUtil,i=0,n=t.length;n>i;i++)t[i]=e.simplify(t[i],this.options.smoothFactor)},_updatePath:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),o.Path.prototype._updatePath.call(this))}}),o.polyline=function(t,e){return new o.Polyline(t,e)},o.PolyUtil={},o.PolyUtil.clipPolygon=function(t,e){var i,n,s,a,r,h,l,u,c,d=[1,4,2,8],p=o.LineUtil;for(n=0,l=t.length;l>n;n++)t[n]._code=p._getBitCode(t[n],e);for(a=0;4>a;a++){for(u=d[a],i=[],n=0,l=t.length,s=l-1;l>n;s=n++)r=t[n],h=t[s],r._code&u?h._code&u||(c=p._getEdgeIntersection(h,r,u,e),c._code=p._getBitCode(c,e),i.push(c)):(h._code&u&&(c=p._getEdgeIntersection(h,r,u,e),c._code=p._getBitCode(c,e),i.push(c)),i.push(r));t=i}return t},o.Polygon=o.Polyline.extend({options:{fill:!0},initialize:function(t,e){o.Polyline.prototype.initialize.call(this,t,e),this._initWithHoles(t)},_initWithHoles:function(t){var e,i,n;if(t&&o.Util.isArray(t[0])&&"number"!=typeof t[0][0])for(this._latlngs=this._convertLatLngs(t[0]),this._holes=t.slice(1),e=0,i=this._holes.length;i>e;e++)n=this._holes[e]=this._convertLatLngs(this._holes[e]),n[0].equals(n[n.length-1])&&n.pop();t=this._latlngs,t.length>=2&&t[0].equals(t[t.length-1])&&t.pop()},projectLatlngs:function(){if(o.Polyline.prototype.projectLatlngs.call(this),this._holePoints=[],this._holes){var t,e,i,n;for(t=0,i=this._holes.length;i>t;t++)for(this._holePoints[t]=[],e=0,n=this._holes[t].length;n>e;e++)this._holePoints[t][e]=this._map.latLngToLayerPoint(this._holes[t][e])}},setLatLngs:function(t){return t&&o.Util.isArray(t[0])&&"number"!=typeof t[0][0]?(this._initWithHoles(t),this.redraw()):o.Polyline.prototype.setLatLngs.call(this,t)},_clipPoints:function(){var t=this._originalPoints,e=[];if(this._parts=[t].concat(this._holePoints),!this.options.noClip){for(var i=0,n=this._parts.length;n>i;i++){var s=o.PolyUtil.clipPolygon(this._parts[i],this._map._pathViewport);s.length&&e.push(s)}this._parts=e}},_getPathPartStr:function(t){var e=o.Polyline.prototype._getPathPartStr.call(this,t);return e+(o.Browser.svg?"z":"x")}}),o.polygon=function(t,e){return new o.Polygon(t,e)},function(){function t(t){return o.FeatureGroup.extend({initialize:function(t,e){this._layers={},this._options=e,this.setLatLngs(t)},setLatLngs:function(e){var i=0,n=e.length;for(this.eachLayer(function(t){n>i?t.setLatLngs(e[i++]):this.removeLayer(t)},this);n>i;)this.addLayer(new t(e[i++],this._options));return this},getLatLngs:function(){var t=[];return this.eachLayer(function(e){t.push(e.getLatLngs())}),t}})}o.MultiPolyline=t(o.Polyline),o.MultiPolygon=t(o.Polygon),o.multiPolyline=function(t,e){return new o.MultiPolyline(t,e)},o.multiPolygon=function(t,e){return new o.MultiPolygon(t,e)}}(),o.Rectangle=o.Polygon.extend({initialize:function(t,e){o.Polygon.prototype.initialize.call(this,this._boundsToLatLngs(t),e)},setBounds:function(t){this.setLatLngs(this._boundsToLatLngs(t))},_boundsToLatLngs:function(t){return t=o.latLngBounds(t),[t.getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()]}}),o.rectangle=function(t,e){return new o.Rectangle(t,e)},o.Circle=o.Path.extend({initialize:function(t,e,i){o.Path.prototype.initialize.call(this,i),this._latlng=o.latLng(t),this._mRadius=e},options:{fill:!0},setLatLng:function(t){return this._latlng=o.latLng(t),this.redraw()},setRadius:function(t){return this._mRadius=t,this.redraw()},projectLatlngs:function(){var t=this._getLngRadius(),e=this._latlng,i=this._map.latLngToLayerPoint([e.lat,e.lng-t]);this._point=this._map.latLngToLayerPoint(e),this._radius=Math.max(this._point.x-i.x,1)},getBounds:function(){var t=this._getLngRadius(),e=this._mRadius/40075017*360,i=this._latlng;return new o.LatLngBounds([i.lat-e,i.lng-t],[i.lat+e,i.lng+t])},getLatLng:function(){return this._latlng},getPathString:function(){var t=this._point,e=this._radius;return this._checkIfEmpty()?"":o.Browser.svg?"M"+t.x+","+(t.y-e)+"A"+e+","+e+",0,1,1,"+(t.x-.1)+","+(t.y-e)+" z":(t._round(),e=Math.round(e),"AL "+t.x+","+t.y+" "+e+","+e+" 0,23592600")},getRadius:function(){return this._mRadius},_getLatRadius:function(){return this._mRadius/40075017*360},_getLngRadius:function(){return this._getLatRadius()/Math.cos(o.LatLng.DEG_TO_RAD*this._latlng.lat)},_checkIfEmpty:function(){if(!this._map)return!1;var t=this._map._pathViewport,e=this._radius,i=this._point;return i.x-e>t.max.x||i.y-e>t.max.y||i.x+e<t.min.x||i.y+e<t.min.y}}),o.circle=function(t,e,i){return new o.Circle(t,e,i)},o.CircleMarker=o.Circle.extend({options:{radius:10,weight:2},initialize:function(t,e){o.Circle.prototype.initialize.call(this,t,null,e),this._radius=this.options.radius},projectLatlngs:function(){this._point=this._map.latLngToLayerPoint(this._latlng)},_updateStyle:function(){o.Circle.prototype._updateStyle.call(this),this.setRadius(this.options.radius)},setLatLng:function(t){return o.Circle.prototype.setLatLng.call(this,t),this._popup&&this._popup._isOpen&&this._popup.setLatLng(t),this},setRadius:function(t){return this.options.radius=this._radius=t,this.redraw()},getRadius:function(){return this._radius}}),o.circleMarker=function(t,e){return new o.CircleMarker(t,e)},o.Polyline.include(o.Path.CANVAS?{_containsPoint:function(t,e){var i,n,s,a,r,h,l,u=this.options.weight/2;for(o.Browser.touch&&(u+=10),i=0,a=this._parts.length;a>i;i++)for(l=this._parts[i],n=0,r=l.length,s=r-1;r>n;s=n++)if((e||0!==n)&&(h=o.LineUtil.pointToSegmentDistance(t,l[s],l[n]),u>=h))return!0;return!1}}:{}),o.Polygon.include(o.Path.CANVAS?{_containsPoint:function(t){var e,i,n,s,a,r,h,l,u=!1;if(o.Polyline.prototype._containsPoint.call(this,t,!0))return!0;for(s=0,h=this._parts.length;h>s;s++)for(e=this._parts[s],a=0,l=e.length,r=l-1;l>a;r=a++)i=e[a],n=e[r],i.y>t.y!=n.y>t.y&&t.x<(n.x-i.x)*(t.y-i.y)/(n.y-i.y)+i.x&&(u=!u);return u}}:{}),o.Circle.include(o.Path.CANVAS?{_drawPath:function(){var t=this._point;this._ctx.beginPath(),this._ctx.arc(t.x,t.y,this._radius,0,2*Math.PI,!1)},_containsPoint:function(t){var e=this._point,i=this.options.stroke?this.options.weight/2:0;return t.distanceTo(e)<=this._radius+i}}:{}),o.CircleMarker.include(o.Path.CANVAS?{_updateStyle:function(){o.Path.prototype._updateStyle.call(this)}}:{}),o.GeoJSON=o.FeatureGroup.extend({initialize:function(t,e){o.setOptions(this,e),this._layers={},t&&this.addData(t)},addData:function(t){var e,i,n,s=o.Util.isArray(t)?t:t.features;if(s){for(e=0,i=s.length;i>e;e++)n=s[e],(n.geometries||n.geometry||n.features||n.coordinates)&&this.addData(s[e]);return this}var a=this.options;if(!a.filter||a.filter(t)){var r=o.GeoJSON.geometryToLayer(t,a.pointToLayer,a.coordsToLatLng,a);return r.feature=o.GeoJSON.asFeature(t),r.defaultOptions=r.options,this.resetStyle(r),a.onEachFeature&&a.onEachFeature(t,r),this.addLayer(r)}},resetStyle:function(t){var e=this.options.style;e&&(o.Util.extend(t.options,t.defaultOptions),this._setLayerStyle(t,e))},setStyle:function(t){this.eachLayer(function(e){this._setLayerStyle(e,t)},this)},_setLayerStyle:function(t,e){"function"==typeof e&&(e=e(t.feature)),t.setStyle&&t.setStyle(e)}}),o.extend(o.GeoJSON,{geometryToLayer:function(t,e,i,n){var s,a,r,h,l="Feature"===t.type?t.geometry:t,u=l.coordinates,c=[];switch(i=i||this.coordsToLatLng,l.type){case"Point":return s=i(u),e?e(t,s):new o.Marker(s);case"MultiPoint":for(r=0,h=u.length;h>r;r++)s=i(u[r]),c.push(e?e(t,s):new o.Marker(s));return new o.FeatureGroup(c);case"LineString":return a=this.coordsToLatLngs(u,0,i),new o.Polyline(a,n);case"Polygon":if(2===u.length&&!u[1].length)throw new Error("Invalid GeoJSON object.");return a=this.coordsToLatLngs(u,1,i),new o.Polygon(a,n);case"MultiLineString":return a=this.coordsToLatLngs(u,1,i),new o.MultiPolyline(a,n);case"MultiPolygon":return a=this.coordsToLatLngs(u,2,i),new o.MultiPolygon(a,n);case"GeometryCollection":for(r=0,h=l.geometries.length;h>r;r++)c.push(this.geometryToLayer({geometry:l.geometries[r],type:"Feature",properties:t.properties},e,i,n));return new o.FeatureGroup(c);default:throw new Error("Invalid GeoJSON object.")}},coordsToLatLng:function(t){return new o.LatLng(t[1],t[0],t[2])},coordsToLatLngs:function(t,e,i){var n,o,s,a=[];for(o=0,s=t.length;s>o;o++)n=e?this.coordsToLatLngs(t[o],e-1,i):(i||this.coordsToLatLng)(t[o]),a.push(n);return a},latLngToCoords:function(t){var e=[t.lng,t.lat];return t.alt!==i&&e.push(t.alt),e},latLngsToCoords:function(t){for(var e=[],i=0,n=t.length;n>i;i++)e.push(o.GeoJSON.latLngToCoords(t[i]));return e},getFeature:function(t,e){return t.feature?o.extend({},t.feature,{geometry:e}):o.GeoJSON.asFeature(e)},asFeature:function(t){return"Feature"===t.type?t:{type:"Feature",properties:{},geometry:t}}});var a={toGeoJSON:function(){return o.GeoJSON.getFeature(this,{type:"Point",coordinates:o.GeoJSON.latLngToCoords(this.getLatLng())})}};o.Marker.include(a),o.Circle.include(a),o.CircleMarker.include(a),o.Polyline.include({toGeoJSON:function(){return o.GeoJSON.getFeature(this,{type:"LineString",coordinates:o.GeoJSON.latLngsToCoords(this.getLatLngs())})}}),o.Polygon.include({toGeoJSON:function(){var t,e,i,n=[o.GeoJSON.latLngsToCoords(this.getLatLngs())];if(n[0].push(n[0][0]),this._holes)for(t=0,e=this._holes.length;e>t;t++)i=o.GeoJSON.latLngsToCoords(this._holes[t]),i.push(i[0]),n.push(i);return o.GeoJSON.getFeature(this,{type:"Polygon",coordinates:n})}}),function(){function t(t){return function(){var e=[];return this.eachLayer(function(t){e.push(t.toGeoJSON().geometry.coordinates)}),o.GeoJSON.getFeature(this,{type:t,coordinates:e})}}o.MultiPolyline.include({toGeoJSON:t("MultiLineString")}),o.MultiPolygon.include({toGeoJSON:t("MultiPolygon")}),o.LayerGroup.include({toGeoJSON:function(){var e,i=this.feature&&this.feature.geometry,n=[];if(i&&"MultiPoint"===i.type)return t("MultiPoint").call(this);var s=i&&"GeometryCollection"===i.type;return this.eachLayer(function(t){t.toGeoJSON&&(e=t.toGeoJSON(),n.push(s?e.geometry:o.GeoJSON.asFeature(e)))}),s?o.GeoJSON.getFeature(this,{geometries:n,type:"GeometryCollection"}):{type:"FeatureCollection",features:n}}})}(),o.geoJson=function(t,e){return new o.GeoJSON(t,e)},o.DomEvent={addListener:function(t,e,i,n){var s,a,r,h=o.stamp(i),l="_leaflet_"+e+h;return t[l]?this:(s=function(e){return i.call(n||t,e||o.DomEvent._getEvent())},o.Browser.pointer&&0===e.indexOf("touch")?this.addPointerListener(t,e,s,h):(o.Browser.touch&&"dblclick"===e&&this.addDoubleTapListener&&this.addDoubleTapListener(t,s,h),"addEventListener"in t?"mousewheel"===e?(t.addEventListener("DOMMouseScroll",s,!1),t.addEventListener(e,s,!1)):"mouseenter"===e||"mouseleave"===e?(a=s,r="mouseenter"===e?"mouseover":"mouseout",s=function(e){return o.DomEvent._checkMouse(t,e)?a(e):void 0},t.addEventListener(r,s,!1)):"click"===e&&o.Browser.android?(a=s,s=function(t){return o.DomEvent._filterClick(t,a)},t.addEventListener(e,s,!1)):t.addEventListener(e,s,!1):"attachEvent"in t&&t.attachEvent("on"+e,s),t[l]=s,this))},removeListener:function(t,e,i){var n=o.stamp(i),s="_leaflet_"+e+n,a=t[s];return a?(o.Browser.pointer&&0===e.indexOf("touch")?this.removePointerListener(t,e,n):o.Browser.touch&&"dblclick"===e&&this.removeDoubleTapListener?this.removeDoubleTapListener(t,n):"removeEventListener"in t?"mousewheel"===e?(t.removeEventListener("DOMMouseScroll",a,!1),t.removeEventListener(e,a,!1)):"mouseenter"===e||"mouseleave"===e?t.removeEventListener("mouseenter"===e?"mouseover":"mouseout",a,!1):t.removeEventListener(e,a,!1):"detachEvent"in t&&t.detachEvent("on"+e,a),t[s]=null,this):this},stopPropagation:function(t){return t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,o.DomEvent._skipped(t),this},disableScrollPropagation:function(t){var e=o.DomEvent.stopPropagation;return o.DomEvent.on(t,"mousewheel",e).on(t,"MozMousePixelScroll",e)},disableClickPropagation:function(t){for(var e=o.DomEvent.stopPropagation,i=o.Draggable.START.length-1;i>=0;i--)o.DomEvent.on(t,o.Draggable.START[i],e);return o.DomEvent.on(t,"click",o.DomEvent._fakeStop).on(t,"dblclick",e)},preventDefault:function(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this},stop:function(t){return o.DomEvent.preventDefault(t).stopPropagation(t)},getMousePosition:function(t,e){if(!e)return new o.Point(t.clientX,t.clientY);var i=e.getBoundingClientRect();return new o.Point(t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop)},getWheelDelta:function(t){var e=0;return t.wheelDelta&&(e=t.wheelDelta/120),t.detail&&(e=-t.detail/3),e},_skipEvents:{},_fakeStop:function(t){o.DomEvent._skipEvents[t.type]=!0},_skipped:function(t){var e=this._skipEvents[t.type];return this._skipEvents[t.type]=!1,e},_checkMouse:function(t,e){var i=e.relatedTarget;if(!i)return!0;try{for(;i&&i!==t;)i=i.parentNode}catch(n){return!1}return i!==t},_getEvent:function(){var e=t.event;if(!e)for(var i=arguments.callee.caller;i&&(e=i.arguments[0],!e||t.Event!==e.constructor);)i=i.caller;return e},_filterClick:function(t,e){var i=t.timeStamp||t.originalEvent.timeStamp,n=o.DomEvent._lastClick&&i-o.DomEvent._lastClick;return n&&n>100&&500>n||t.target._simulatedClick&&!t._simulated?void o.DomEvent.stop(t):(o.DomEvent._lastClick=i,e(t))}},o.DomEvent.on=o.DomEvent.addListener,o.DomEvent.off=o.DomEvent.removeListener,o.Draggable=o.Class.extend({includes:o.Mixin.Events,statics:{START:o.Browser.touch?["touchstart","mousedown"]:["mousedown"],END:{mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},MOVE:{mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"}},initialize:function(t,e){this._element=t,this._dragStartTarget=e||t},enable:function(){if(!this._enabled){for(var t=o.Draggable.START.length-1;t>=0;t--)o.DomEvent.on(this._dragStartTarget,o.Draggable.START[t],this._onDown,this);this._enabled=!0}},disable:function(){if(this._enabled){for(var t=o.Draggable.START.length-1;t>=0;t--)o.DomEvent.off(this._dragStartTarget,o.Draggable.START[t],this._onDown,this);this._enabled=!1,this._moved=!1}},_onDown:function(t){if(this._moved=!1,!(t.shiftKey||1!==t.which&&1!==t.button&&!t.touches||(o.DomEvent.stopPropagation(t),o.Draggable._disabled||(o.DomUtil.disableImageDrag(),o.DomUtil.disableTextSelection(),this._moving)))){var i=t.touches?t.touches[0]:t;this._startPoint=new o.Point(i.clientX,i.clientY),this._startPos=this._newPos=o.DomUtil.getPosition(this._element),o.DomEvent.on(e,o.Draggable.MOVE[t.type],this._onMove,this).on(e,o.Draggable.END[t.type],this._onUp,this)}},_onMove:function(t){if(t.touches&&t.touches.length>1)return void(this._moved=!0);var i=t.touches&&1===t.touches.length?t.touches[0]:t,n=new o.Point(i.clientX,i.clientY),s=n.subtract(this._startPoint);(s.x||s.y)&&(o.Browser.touch&&Math.abs(s.x)+Math.abs(s.y)<3||(o.DomEvent.preventDefault(t),this._moved||(this.fire("dragstart"),this._moved=!0,this._startPos=o.DomUtil.getPosition(this._element).subtract(s),o.DomUtil.addClass(e.body,"leaflet-dragging"),this._lastTarget=t.target||t.srcElement,o.DomUtil.addClass(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(s),this._moving=!0,o.Util.cancelAnimFrame(this._animRequest),this._animRequest=o.Util.requestAnimFrame(this._updatePosition,this,!0,this._dragStartTarget)))},_updatePosition:function(){this.fire("predrag"),o.DomUtil.setPosition(this._element,this._newPos),this.fire("drag")},_onUp:function(){o.DomUtil.removeClass(e.body,"leaflet-dragging"),this._lastTarget&&(o.DomUtil.removeClass(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null);for(var t in o.Draggable.MOVE)o.DomEvent.off(e,o.Draggable.MOVE[t],this._onMove).off(e,o.Draggable.END[t],this._onUp);o.DomUtil.enableImageDrag(),o.DomUtil.enableTextSelection(),this._moved&&this._moving&&(o.Util.cancelAnimFrame(this._animRequest),this.fire("dragend",{distance:this._newPos.distanceTo(this._startPos)})),this._moving=!1}}),o.Handler=o.Class.extend({initialize:function(t){this._map=t},enable:function(){this._enabled||(this._enabled=!0,this.addHooks())},disable:function(){this._enabled&&(this._enabled=!1,this.removeHooks())},enabled:function(){return!!this._enabled}}),o.Map.mergeOptions({dragging:!0,inertia:!o.Browser.android23,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,inertiaThreshold:o.Browser.touch?32:18,easeLinearity:.25,worldCopyJump:!1}),o.Map.Drag=o.Handler.extend({addHooks:function(){if(!this._draggable){var t=this._map;this._draggable=new o.Draggable(t._mapPane,t._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),t.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDrag,this),t.on("viewreset",this._onViewReset,this),t.whenReady(this._onViewReset,this))}this._draggable.enable()},removeHooks:function(){this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){var t=this._map;t._panAnim&&t._panAnim.stop(),t.fire("movestart").fire("dragstart"),t.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(){if(this._map.options.inertia){var t=this._lastTime=+new Date,e=this._lastPos=this._draggable._newPos;this._positions.push(e),this._times.push(t),t-this._times[0]>200&&(this._positions.shift(),this._times.shift())}this._map.fire("move").fire("drag")},_onViewReset:function(){var t=this._map.getSize()._divideBy(2),e=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=e.subtract(t).x,this._worldWidth=this._map.project([0,180]).x},_onPreDrag:function(){var t=this._worldWidth,e=Math.round(t/2),i=this._initialWorldOffset,n=this._draggable._newPos.x,o=(n-e+i)%t+e-i,s=(n+e+i)%t-e-i,a=Math.abs(o+i)<Math.abs(s+i)?o:s;this._draggable._newPos.x=a},_onDragEnd:function(t){var e=this._map,i=e.options,n=+new Date-this._lastTime,s=!i.inertia||n>i.inertiaThreshold||!this._positions[0];if(e.fire("dragend",t),s)e.fire("moveend");else{var a=this._lastPos.subtract(this._positions[0]),r=(this._lastTime+n-this._times[0])/1e3,h=i.easeLinearity,l=a.multiplyBy(h/r),u=l.distanceTo([0,0]),c=Math.min(i.inertiaMaxSpeed,u),d=l.multiplyBy(c/u),p=c/(i.inertiaDeceleration*h),_=d.multiplyBy(-p/2).round();_.x&&_.y?(_=e._limitOffset(_,e.options.maxBounds),o.Util.requestAnimFrame(function(){e.panBy(_,{duration:p,easeLinearity:h,noMoveStart:!0})})):e.fire("moveend")}}}),o.Map.addInitHook("addHandler","dragging",o.Map.Drag),o.Map.mergeOptions({doubleClickZoom:!0}),o.Map.DoubleClickZoom=o.Handler.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(t){var e=this._map,i=e.getZoom()+(t.originalEvent.shiftKey?-1:1);"center"===e.options.doubleClickZoom?e.setZoom(i):e.setZoomAround(t.containerPoint,i)}}),o.Map.addInitHook("addHandler","doubleClickZoom",o.Map.DoubleClickZoom),o.Map.mergeOptions({scrollWheelZoom:!0}),o.Map.ScrollWheelZoom=o.Handler.extend({addHooks:function(){o.DomEvent.on(this._map._container,"mousewheel",this._onWheelScroll,this),o.DomEvent.on(this._map._container,"MozMousePixelScroll",o.DomEvent.preventDefault),this._delta=0},removeHooks:function(){o.DomEvent.off(this._map._container,"mousewheel",this._onWheelScroll),o.DomEvent.off(this._map._container,"MozMousePixelScroll",o.DomEvent.preventDefault)},_onWheelScroll:function(t){var e=o.DomEvent.getWheelDelta(t);this._delta+=e,this._lastMousePos=this._map.mouseEventToContainerPoint(t),this._startTime||(this._startTime=+new Date);var i=Math.max(40-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(o.bind(this._performZoom,this),i),o.DomEvent.preventDefault(t),o.DomEvent.stopPropagation(t)},_performZoom:function(){var t=this._map,e=this._delta,i=t.getZoom();e=e>0?Math.ceil(e):Math.floor(e),e=Math.max(Math.min(e,4),-4),e=t._limitZoom(i+e)-i,this._delta=0,this._startTime=null,e&&("center"===t.options.scrollWheelZoom?t.setZoom(i+e):t.setZoomAround(this._lastMousePos,i+e))}}),o.Map.addInitHook("addHandler","scrollWheelZoom",o.Map.ScrollWheelZoom),o.extend(o.DomEvent,{_touchstart:o.Browser.msPointer?"MSPointerDown":o.Browser.pointer?"pointerdown":"touchstart",_touchend:o.Browser.msPointer?"MSPointerUp":o.Browser.pointer?"pointerup":"touchend",addDoubleTapListener:function(t,i,n){function s(t){var e;if(o.Browser.pointer?(_.push(t.pointerId),e=_.length):e=t.touches.length,!(e>1)){var i=Date.now(),n=i-(r||i);h=t.touches?t.touches[0]:t,l=n>0&&u>=n,r=i}}function a(t){if(o.Browser.pointer){var e=_.indexOf(t.pointerId);if(-1===e)return;_.splice(e,1)}if(l){if(o.Browser.pointer){var n,s={};for(var a in h)n=h[a],"function"==typeof n?s[a]=n.bind(h):s[a]=n;h=s}h.type="dblclick",i(h),r=null}}var r,h,l=!1,u=250,c="_leaflet_",d=this._touchstart,p=this._touchend,_=[];t[c+d+n]=s,t[c+p+n]=a;var m=o.Browser.pointer?e.documentElement:t;return t.addEventListener(d,s,!1),m.addEventListener(p,a,!1),o.Browser.pointer&&m.addEventListener(o.DomEvent.POINTER_CANCEL,a,!1),this},removeDoubleTapListener:function(t,i){var n="_leaflet_";return t.removeEventListener(this._touchstart,t[n+this._touchstart+i],!1),(o.Browser.pointer?e.documentElement:t).removeEventListener(this._touchend,t[n+this._touchend+i],!1),o.Browser.pointer&&e.documentElement.removeEventListener(o.DomEvent.POINTER_CANCEL,t[n+this._touchend+i],!1),this}}),o.extend(o.DomEvent,{POINTER_DOWN:o.Browser.msPointer?"MSPointerDown":"pointerdown",POINTER_MOVE:o.Browser.msPointer?"MSPointerMove":"pointermove",POINTER_UP:o.Browser.msPointer?"MSPointerUp":"pointerup",POINTER_CANCEL:o.Browser.msPointer?"MSPointerCancel":"pointercancel",_pointers:[],_pointerDocumentListener:!1,addPointerListener:function(t,e,i,n){switch(e){case"touchstart":return this.addPointerListenerStart(t,e,i,n);case"touchend":return this.addPointerListenerEnd(t,e,i,n);case"touchmove":return this.addPointerListenerMove(t,e,i,n);default:throw"Unknown touch event type"}},addPointerListenerStart:function(t,i,n,s){var a="_leaflet_",r=this._pointers,h=function(t){o.DomEvent.preventDefault(t);for(var e=!1,i=0;i<r.length;i++)if(r[i].pointerId===t.pointerId){e=!0;break}e||r.push(t),t.touches=r.slice(),t.changedTouches=[t],n(t)};if(t[a+"touchstart"+s]=h,t.addEventListener(this.POINTER_DOWN,h,!1),!this._pointerDocumentListener){var l=function(t){for(var e=0;e<r.length;e++)if(r[e].pointerId===t.pointerId){r.splice(e,1);break}};e.documentElement.addEventListener(this.POINTER_UP,l,!1),e.documentElement.addEventListener(this.POINTER_CANCEL,l,!1),this._pointerDocumentListener=!0}return this},addPointerListenerMove:function(t,e,i,n){function o(t){if(t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType||0!==t.buttons){for(var e=0;e<a.length;e++)if(a[e].pointerId===t.pointerId){a[e]=t;break}t.touches=a.slice(),t.changedTouches=[t],i(t)}}var s="_leaflet_",a=this._pointers;return t[s+"touchmove"+n]=o,t.addEventListener(this.POINTER_MOVE,o,!1),this},addPointerListenerEnd:function(t,e,i,n){var o="_leaflet_",s=this._pointers,a=function(t){for(var e=0;e<s.length;e++)if(s[e].pointerId===t.pointerId){s.splice(e,1);break}t.touches=s.slice(),t.changedTouches=[t],i(t)};return t[o+"touchend"+n]=a,t.addEventListener(this.POINTER_UP,a,!1),t.addEventListener(this.POINTER_CANCEL,a,!1),this},removePointerListener:function(t,e,i){var n="_leaflet_",o=t[n+e+i];switch(e){case"touchstart":t.removeEventListener(this.POINTER_DOWN,o,!1);break;case"touchmove":t.removeEventListener(this.POINTER_MOVE,o,!1);break;case"touchend":t.removeEventListener(this.POINTER_UP,o,!1),t.removeEventListener(this.POINTER_CANCEL,o,!1)}return this}}),o.Map.mergeOptions({touchZoom:o.Browser.touch&&!o.Browser.android23,bounceAtZoomLimits:!0}),o.Map.TouchZoom=o.Handler.extend({addHooks:function(){o.DomEvent.on(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){o.DomEvent.off(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(t){var i=this._map;if(t.touches&&2===t.touches.length&&!i._animatingZoom&&!this._zooming){var n=i.mouseEventToLayerPoint(t.touches[0]),s=i.mouseEventToLayerPoint(t.touches[1]),a=i._getCenterLayerPoint();this._startCenter=n.add(s)._divideBy(2),this._startDist=n.distanceTo(s),this._moved=!1,this._zooming=!0,this._centerOffset=a.subtract(this._startCenter),i._panAnim&&i._panAnim.stop(),o.DomEvent.on(e,"touchmove",this._onTouchMove,this).on(e,"touchend",this._onTouchEnd,this),o.DomEvent.preventDefault(t)}},_onTouchMove:function(t){var e=this._map;if(t.touches&&2===t.touches.length&&this._zooming){var i=e.mouseEventToLayerPoint(t.touches[0]),n=e.mouseEventToLayerPoint(t.touches[1]);this._scale=i.distanceTo(n)/this._startDist,this._delta=i._add(n)._divideBy(2)._subtract(this._startCenter),1!==this._scale&&(e.options.bounceAtZoomLimits||!(e.getZoom()===e.getMinZoom()&&this._scale<1||e.getZoom()===e.getMaxZoom()&&this._scale>1))&&(this._moved||(o.DomUtil.addClass(e._mapPane,"leaflet-touching"),e.fire("movestart").fire("zoomstart"),this._moved=!0),o.Util.cancelAnimFrame(this._animRequest),this._animRequest=o.Util.requestAnimFrame(this._updateOnMove,this,!0,this._map._container),o.DomEvent.preventDefault(t))}},_updateOnMove:function(){var t=this._map,e=this._getScaleOrigin(),i=t.layerPointToLatLng(e),n=t.getScaleZoom(this._scale);t._animateZoom(i,n,this._startCenter,this._scale,this._delta,!1,!0)},_onTouchEnd:function(){if(!this._moved||!this._zooming)return void(this._zooming=!1);var t=this._map;this._zooming=!1,o.DomUtil.removeClass(t._mapPane,"leaflet-touching"),o.Util.cancelAnimFrame(this._animRequest),o.DomEvent.off(e,"touchmove",this._onTouchMove).off(e,"touchend",this._onTouchEnd);var i=this._getScaleOrigin(),n=t.layerPointToLatLng(i),s=t.getZoom(),a=t.getScaleZoom(this._scale)-s,r=a>0?Math.ceil(a):Math.floor(a),h=t._limitZoom(s+r),l=t.getZoomScale(h)/this._scale;t._animateZoom(n,h,i,l)},_getScaleOrigin:function(){var t=this._centerOffset.subtract(this._delta).divideBy(this._scale);return this._startCenter.add(t)}}),o.Map.addInitHook("addHandler","touchZoom",o.Map.TouchZoom),o.Map.mergeOptions({tap:!0,tapTolerance:15}),o.Map.Tap=o.Handler.extend({addHooks:function(){o.DomEvent.on(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){o.DomEvent.off(this._map._container,"touchstart",this._onDown,this)},_onDown:function(t){if(t.touches){if(o.DomEvent.preventDefault(t),this._fireClick=!0,t.touches.length>1)return this._fireClick=!1,void clearTimeout(this._holdTimeout);var i=t.touches[0],n=i.target;this._startPos=this._newPos=new o.Point(i.clientX,i.clientY),n.tagName&&"a"===n.tagName.toLowerCase()&&o.DomUtil.addClass(n,"leaflet-active"),this._holdTimeout=setTimeout(o.bind(function(){this._isTapValid()&&(this._fireClick=!1,this._onUp(),this._simulateEvent("contextmenu",i))},this),1e3),o.DomEvent.on(e,"touchmove",this._onMove,this).on(e,"touchend",this._onUp,this)}},_onUp:function(t){if(clearTimeout(this._holdTimeout),o.DomEvent.off(e,"touchmove",this._onMove,this).off(e,"touchend",this._onUp,this),this._fireClick&&t&&t.changedTouches){var i=t.changedTouches[0],n=i.target;n&&n.tagName&&"a"===n.tagName.toLowerCase()&&o.DomUtil.removeClass(n,"leaflet-active"),this._isTapValid()&&this._simulateEvent("click",i)}},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_onMove:function(t){var e=t.touches[0];this._newPos=new o.Point(e.clientX,e.clientY)},_simulateEvent:function(i,n){var o=e.createEvent("MouseEvents");o._simulated=!0,n.target._simulatedClick=!0,o.initMouseEvent(i,!0,!0,t,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),n.target.dispatchEvent(o)}}),o.Browser.touch&&!o.Browser.pointer&&o.Map.addInitHook("addHandler","tap",o.Map.Tap),o.Map.mergeOptions({boxZoom:!0}),o.Map.BoxZoom=o.Handler.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane,this._moved=!1},addHooks:function(){o.DomEvent.on(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){o.DomEvent.off(this._container,"mousedown",this._onMouseDown),this._moved=!1},moved:function(){return this._moved},_onMouseDown:function(t){return this._moved=!1,!t.shiftKey||1!==t.which&&1!==t.button?!1:(o.DomUtil.disableTextSelection(),o.DomUtil.disableImageDrag(),this._startLayerPoint=this._map.mouseEventToLayerPoint(t),void o.DomEvent.on(e,"mousemove",this._onMouseMove,this).on(e,"mouseup",this._onMouseUp,this).on(e,"keydown",this._onKeyDown,this))},_onMouseMove:function(t){this._moved||(this._box=o.DomUtil.create("div","leaflet-zoom-box",this._pane),o.DomUtil.setPosition(this._box,this._startLayerPoint),this._container.style.cursor="crosshair",this._map.fire("boxzoomstart"));var e=this._startLayerPoint,i=this._box,n=this._map.mouseEventToLayerPoint(t),s=n.subtract(e),a=new o.Point(Math.min(n.x,e.x),Math.min(n.y,e.y));o.DomUtil.setPosition(i,a),this._moved=!0,i.style.width=Math.max(0,Math.abs(s.x)-4)+"px",i.style.height=Math.max(0,Math.abs(s.y)-4)+"px"},_finish:function(){this._moved&&(this._pane.removeChild(this._box),this._container.style.cursor=""),o.DomUtil.enableTextSelection(),o.DomUtil.enableImageDrag(),o.DomEvent.off(e,"mousemove",this._onMouseMove).off(e,"mouseup",this._onMouseUp).off(e,"keydown",this._onKeyDown)},_onMouseUp:function(t){this._finish();var e=this._map,i=e.mouseEventToLayerPoint(t);if(!this._startLayerPoint.equals(i)){var n=new o.LatLngBounds(e.layerPointToLatLng(this._startLayerPoint),e.layerPointToLatLng(i));e.fitBounds(n),e.fire("boxzoomend",{boxZoomBounds:n})}},_onKeyDown:function(t){27===t.keyCode&&this._finish()}}),o.Map.addInitHook("addHandler","boxZoom",o.Map.BoxZoom),o.Map.mergeOptions({keyboard:!0,keyboardPanOffset:80,keyboardZoomOffset:1}),o.Map.Keyboard=o.Handler.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,173]},initialize:function(t){this._map=t,this._setPanOffset(t.options.keyboardPanOffset),this._setZoomOffset(t.options.keyboardZoomOffset)},addHooks:function(){var t=this._map._container;-1===t.tabIndex&&(t.tabIndex="0"),o.DomEvent.on(t,"focus",this._onFocus,this).on(t,"blur",this._onBlur,this).on(t,"mousedown",this._onMouseDown,this),this._map.on("focus",this._addHooks,this).on("blur",this._removeHooks,this)},removeHooks:function(){this._removeHooks();var t=this._map._container;o.DomEvent.off(t,"focus",this._onFocus,this).off(t,"blur",this._onBlur,this).off(t,"mousedown",this._onMouseDown,this),this._map.off("focus",this._addHooks,this).off("blur",this._removeHooks,this)},_onMouseDown:function(){if(!this._focused){var i=e.body,n=e.documentElement,o=i.scrollTop||n.scrollTop,s=i.scrollLeft||n.scrollLeft;this._map._container.focus(),t.scrollTo(s,o)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanOffset:function(t){var e,i,n=this._panKeys={},o=this.keyCodes;for(e=0,i=o.left.length;i>e;e++)n[o.left[e]]=[-1*t,0];for(e=0,i=o.right.length;i>e;e++)n[o.right[e]]=[t,0];for(e=0,i=o.down.length;i>e;e++)n[o.down[e]]=[0,t];for(e=0,i=o.up.length;i>e;e++)n[o.up[e]]=[0,-1*t]},_setZoomOffset:function(t){var e,i,n=this._zoomKeys={},o=this.keyCodes;for(e=0,i=o.zoomIn.length;i>e;e++)n[o.zoomIn[e]]=t;for(e=0,i=o.zoomOut.length;i>e;e++)n[o.zoomOut[e]]=-t},_addHooks:function(){o.DomEvent.on(e,"keydown",this._onKeyDown,this)},_removeHooks:function(){o.DomEvent.off(e,"keydown",this._onKeyDown,this)},_onKeyDown:function(t){var e=t.keyCode,i=this._map;if(e in this._panKeys){if(i._panAnim&&i._panAnim._inProgress)return;i.panBy(this._panKeys[e]),i.options.maxBounds&&i.panInsideBounds(i.options.maxBounds)}else{if(!(e in this._zoomKeys))return;i.setZoom(i.getZoom()+this._zoomKeys[e])}o.DomEvent.stop(t)}}),o.Map.addInitHook("addHandler","keyboard",o.Map.Keyboard),o.Handler.MarkerDrag=o.Handler.extend({initialize:function(t){this._marker=t},addHooks:function(){var t=this._marker._icon;this._draggable||(this._draggable=new o.Draggable(t,t)),this._draggable.on("dragstart",this._onDragStart,this).on("drag",this._onDrag,this).on("dragend",this._onDragEnd,this),this._draggable.enable(),o.DomUtil.addClass(this._marker._icon,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off("dragstart",this._onDragStart,this).off("drag",this._onDrag,this).off("dragend",this._onDragEnd,this),this._draggable.disable(),o.DomUtil.removeClass(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){this._marker.closePopup().fire("movestart").fire("dragstart")},_onDrag:function(){var t=this._marker,e=t._shadow,i=o.DomUtil.getPosition(t._icon),n=t._map.layerPointToLatLng(i);e&&o.DomUtil.setPosition(e,i),t._latlng=n,t.fire("move",{latlng:n}).fire("drag")},_onDragEnd:function(t){this._marker.fire("moveend").fire("dragend",t)}}),o.Control=o.Class.extend({options:{position:"topright"},initialize:function(t){o.setOptions(this,t)},getPosition:function(){return this.options.position},setPosition:function(t){var e=this._map;return e&&e.removeControl(this),this.options.position=t,e&&e.addControl(this),this},getContainer:function(){return this._container},addTo:function(t){this._map=t;var e=this._container=this.onAdd(t),i=this.getPosition(),n=t._controlCorners[i];return o.DomUtil.addClass(e,"leaflet-control"),-1!==i.indexOf("bottom")?n.insertBefore(e,n.firstChild):n.appendChild(e),this},removeFrom:function(t){var e=this.getPosition(),i=t._controlCorners[e];return i.removeChild(this._container),this._map=null,this.onRemove&&this.onRemove(t),this},_refocusOnMap:function(){this._map&&this._map.getContainer().focus()}}),o.control=function(t){return new o.Control(t)},o.Map.include({addControl:function(t){return t.addTo(this),this},removeControl:function(t){return t.removeFrom(this),this},_initControlPos:function(){function t(t,s){var a=i+t+" "+i+s;e[t+s]=o.DomUtil.create("div",a,n)}var e=this._controlCorners={},i="leaflet-",n=this._controlContainer=o.DomUtil.create("div",i+"control-container",this._container);t("top","left"),t("top","right"),t("bottom","left"),t("bottom","right")},_clearControlPos:function(){this._container.removeChild(this._controlContainer)}}),o.Control.Zoom=o.Control.extend({options:{position:"topleft",zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"-",zoomOutTitle:"Zoom out"},onAdd:function(t){var e="leaflet-control-zoom",i=o.DomUtil.create("div",e+" leaflet-bar");return this._map=t,this._zoomInButton=this._createButton(this.options.zoomInText,this.options.zoomInTitle,e+"-in",i,this._zoomIn,this),this._zoomOutButton=this._createButton(this.options.zoomOutText,this.options.zoomOutTitle,e+"-out",i,this._zoomOut,this),this._updateDisabled(),t.on("zoomend zoomlevelschange",this._updateDisabled,this),i},onRemove:function(t){t.off("zoomend zoomlevelschange",this._updateDisabled,this)},_zoomIn:function(t){this._map.zoomIn(t.shiftKey?3:1)},_zoomOut:function(t){this._map.zoomOut(t.shiftKey?3:1)},_createButton:function(t,e,i,n,s,a){var r=o.DomUtil.create("a",i,n);r.innerHTML=t,r.href="#",r.title=e;var h=o.DomEvent.stopPropagation;return o.DomEvent.on(r,"click",h).on(r,"mousedown",h).on(r,"dblclick",h).on(r,"click",o.DomEvent.preventDefault).on(r,"click",s,a).on(r,"click",this._refocusOnMap,a),r},_updateDisabled:function(){var t=this._map,e="leaflet-disabled";o.DomUtil.removeClass(this._zoomInButton,e),o.DomUtil.removeClass(this._zoomOutButton,e),t._zoom===t.getMinZoom()&&o.DomUtil.addClass(this._zoomOutButton,e),t._zoom===t.getMaxZoom()&&o.DomUtil.addClass(this._zoomInButton,e)}}),o.Map.mergeOptions({zoomControl:!0}),o.Map.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new o.Control.Zoom,this.addControl(this.zoomControl))}),o.control.zoom=function(t){return new o.Control.Zoom(t)},o.Control.Attribution=o.Control.extend({options:{position:"bottomright",prefix:'<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'},initialize:function(t){o.setOptions(this,t),this._attributions={}},onAdd:function(t){this._container=o.DomUtil.create("div","leaflet-control-attribution"),o.DomEvent.disableClickPropagation(this._container);for(var e in t._layers)t._layers[e].getAttribution&&this.addAttribution(t._layers[e].getAttribution());return t.on("layeradd",this._onLayerAdd,this).on("layerremove",this._onLayerRemove,this),this._update(),this._container},onRemove:function(t){t.off("layeradd",this._onLayerAdd).off("layerremove",this._onLayerRemove)},setPrefix:function(t){return this.options.prefix=t,this._update(),this},addAttribution:function(t){return t?(this._attributions[t]||(this._attributions[t]=0),this._attributions[t]++,this._update(),this):void 0},removeAttribution:function(t){return t?(this._attributions[t]&&(this._attributions[t]--,this._update()),this):void 0},_update:function(){if(this._map){var t=[];for(var e in this._attributions)this._attributions[e]&&t.push(e);var i=[];this.options.prefix&&i.push(this.options.prefix),t.length&&i.push(t.join(", ")),this._container.innerHTML=i.join(" | ")}},_onLayerAdd:function(t){t.layer.getAttribution&&this.addAttribution(t.layer.getAttribution())},_onLayerRemove:function(t){t.layer.getAttribution&&this.removeAttribution(t.layer.getAttribution())}}),o.Map.mergeOptions({attributionControl:!0}),o.Map.addInitHook(function(){this.options.attributionControl&&(this.attributionControl=(new o.Control.Attribution).addTo(this))}),o.control.attribution=function(t){return new o.Control.Attribution(t)},o.Control.Scale=o.Control.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0,updateWhenIdle:!1},onAdd:function(t){this._map=t;var e="leaflet-control-scale",i=o.DomUtil.create("div",e),n=this.options;return this._addScales(n,e,i),t.on(n.updateWhenIdle?"moveend":"move",this._update,this),t.whenReady(this._update,this),i},onRemove:function(t){t.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(t,e,i){t.metric&&(this._mScale=o.DomUtil.create("div",e+"-line",i)),t.imperial&&(this._iScale=o.DomUtil.create("div",e+"-line",i))},_update:function(){var t=this._map.getBounds(),e=t.getCenter().lat,i=6378137*Math.PI*Math.cos(e*Math.PI/180),n=i*(t.getNorthEast().lng-t.getSouthWest().lng)/180,o=this._map.getSize(),s=this.options,a=0;o.x>0&&(a=n*(s.maxWidth/o.x)),this._updateScales(s,a)},_updateScales:function(t,e){t.metric&&e&&this._updateMetric(e),t.imperial&&e&&this._updateImperial(e)},_updateMetric:function(t){var e=this._getRoundNum(t);this._mScale.style.width=this._getScaleWidth(e/t)+"px",this._mScale.innerHTML=1e3>e?e+" m":e/1e3+" km"},_updateImperial:function(t){var e,i,n,o=3.2808399*t,s=this._iScale;o>5280?(e=o/5280,i=this._getRoundNum(e),s.style.width=this._getScaleWidth(i/e)+"px",s.innerHTML=i+" mi"):(n=this._getRoundNum(o),s.style.width=this._getScaleWidth(n/o)+"px",s.innerHTML=n+" ft")},_getScaleWidth:function(t){return Math.round(this.options.maxWidth*t)-10},_getRoundNum:function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),i=t/e;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:1,e*i}}),o.control.scale=function(t){return new o.Control.Scale(t)},o.Control.Layers=o.Control.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0},initialize:function(t,e,i){o.setOptions(this,i),this._layers={},this._lastZIndex=0,this._handlingClick=!1;for(var n in t)this._addLayer(t[n],n);for(n in e)this._addLayer(e[n],n,!0)},onAdd:function(t){return this._initLayout(),this._update(),t.on("layeradd",this._onLayerChange,this).on("layerremove",this._onLayerChange,this),this._container},onRemove:function(t){t.off("layeradd",this._onLayerChange,this).off("layerremove",this._onLayerChange,this)},addBaseLayer:function(t,e){return this._addLayer(t,e),this._update(),this},addOverlay:function(t,e){return this._addLayer(t,e,!0),this._update(),this},removeLayer:function(t){var e=o.stamp(t);return delete this._layers[e],this._update(),this},_initLayout:function(){var t="leaflet-control-layers",e=this._container=o.DomUtil.create("div",t);e.setAttribute("aria-haspopup",!0),o.Browser.touch?o.DomEvent.on(e,"click",o.DomEvent.stopPropagation):o.DomEvent.disableClickPropagation(e).disableScrollPropagation(e);var i=this._form=o.DomUtil.create("form",t+"-list");if(this.options.collapsed){o.Browser.android||o.DomEvent.on(e,"mouseover",this._expand,this).on(e,"mouseout",this._collapse,this);var n=this._layersLink=o.DomUtil.create("a",t+"-toggle",e);n.href="#",n.title="Layers",o.Browser.touch?o.DomEvent.on(n,"click",o.DomEvent.stop).on(n,"click",this._expand,this):o.DomEvent.on(n,"focus",this._expand,this),o.DomEvent.on(i,"click",function(){setTimeout(o.bind(this._onInputClick,this),0)},this),this._map.on("click",this._collapse,this)}else this._expand();this._baseLayersList=o.DomUtil.create("div",t+"-base",i),this._separator=o.DomUtil.create("div",t+"-separator",i),this._overlaysList=o.DomUtil.create("div",t+"-overlays",i),e.appendChild(i)},_addLayer:function(t,e,i){var n=o.stamp(t);this._layers[n]={layer:t,name:e,overlay:i},this.options.autoZIndex&&t.setZIndex&&(this._lastZIndex++,t.setZIndex(this._lastZIndex))},_update:function(){if(this._container){this._baseLayersList.innerHTML="",this._overlaysList.innerHTML="";var t,e,i=!1,n=!1;for(t in this._layers)e=this._layers[t],this._addItem(e),n=n||e.overlay,i=i||!e.overlay;this._separator.style.display=n&&i?"":"none"}},_onLayerChange:function(t){var e=this._layers[o.stamp(t.layer)];if(e){this._handlingClick||this._update();var i=e.overlay?"layeradd"===t.type?"overlayadd":"overlayremove":"layeradd"===t.type?"baselayerchange":null;i&&this._map.fire(i,e)}},_createRadioElement:function(t,i){var n='<input type="radio" class="leaflet-control-layers-selector" name="'+t+'"';i&&(n+=' checked="checked"'),n+="/>";var o=e.createElement("div");return o.innerHTML=n,o.firstChild},_addItem:function(t){var i,n=e.createElement("label"),s=this._map.hasLayer(t.layer);t.overlay?(i=e.createElement("input"),i.type="checkbox",i.className="leaflet-control-layers-selector",i.defaultChecked=s):i=this._createRadioElement("leaflet-base-layers",s),i.layerId=o.stamp(t.layer),o.DomEvent.on(i,"click",this._onInputClick,this);var a=e.createElement("span");a.innerHTML=" "+t.name,n.appendChild(i),n.appendChild(a);var r=t.overlay?this._overlaysList:this._baseLayersList;return r.appendChild(n),n},_onInputClick:function(){var t,e,i,n=this._form.getElementsByTagName("input"),o=n.length;for(this._handlingClick=!0,t=0;o>t;t++)e=n[t],i=this._layers[e.layerId],e.checked&&!this._map.hasLayer(i.layer)?this._map.addLayer(i.layer):!e.checked&&this._map.hasLayer(i.layer)&&this._map.removeLayer(i.layer);this._handlingClick=!1,this._refocusOnMap()},_expand:function(){o.DomUtil.addClass(this._container,"leaflet-control-layers-expanded")},_collapse:function(){this._container.className=this._container.className.replace(" leaflet-control-layers-expanded","")}}),o.control.layers=function(t,e,i){return new o.Control.Layers(t,e,i)},o.PosAnimation=o.Class.extend({includes:o.Mixin.Events,run:function(t,e,i,n){this.stop(),this._el=t,this._inProgress=!0,this._newPos=e,this.fire("start"),t.style[o.DomUtil.TRANSITION]="all "+(i||.25)+"s cubic-bezier(0,0,"+(n||.5)+",1)",o.DomEvent.on(t,o.DomUtil.TRANSITION_END,this._onTransitionEnd,this),o.DomUtil.setPosition(t,e),o.Util.falseFn(t.offsetWidth),this._stepTimer=setInterval(o.bind(this._onStep,this),50)},stop:function(){this._inProgress&&(o.DomUtil.setPosition(this._el,this._getPos()),this._onTransitionEnd(),o.Util.falseFn(this._el.offsetWidth))},_onStep:function(){var t=this._getPos();return t?(this._el._leaflet_pos=t,void this.fire("step")):void this._onTransitionEnd()},_transformRe:/([-+]?(?:\d*\.)?\d+)\D*, ([-+]?(?:\d*\.)?\d+)\D*\)/,_getPos:function(){var e,i,n,s=this._el,a=t.getComputedStyle(s);if(o.Browser.any3d){if(n=a[o.DomUtil.TRANSFORM].match(this._transformRe),!n)return;e=parseFloat(n[1]),i=parseFloat(n[2])}else e=parseFloat(a.left),i=parseFloat(a.top);return new o.Point(e,i,!0)},_onTransitionEnd:function(){o.DomEvent.off(this._el,o.DomUtil.TRANSITION_END,this._onTransitionEnd,this),this._inProgress&&(this._inProgress=!1,this._el.style[o.DomUtil.TRANSITION]="",this._el._leaflet_pos=this._newPos,clearInterval(this._stepTimer),this.fire("step").fire("end"))}}),o.Map.include({setView:function(t,e,n){if(e=e===i?this._zoom:this._limitZoom(e),t=this._limitCenter(o.latLng(t),e,this.options.maxBounds),n=n||{},this._panAnim&&this._panAnim.stop(),this._loaded&&!n.reset&&n!==!0){n.animate!==i&&(n.zoom=o.extend({animate:n.animate},n.zoom),n.pan=o.extend({animate:n.animate},n.pan));var s=this._zoom!==e?this._tryAnimatedZoom&&this._tryAnimatedZoom(t,e,n.zoom):this._tryAnimatedPan(t,n.pan);if(s)return clearTimeout(this._sizeTimer),this}return this._resetView(t,e),this},panBy:function(t,e){if(t=o.point(t).round(),e=e||{},!t.x&&!t.y)return this;if(this._panAnim||(this._panAnim=new o.PosAnimation,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),e.noMoveStart||this.fire("movestart"),e.animate!==!1){o.DomUtil.addClass(this._mapPane,"leaflet-pan-anim");var i=this._getMapPanePos().subtract(t);this._panAnim.run(this._mapPane,i,e.duration||.25,e.easeLinearity)}else this._rawPanBy(t),this.fire("move").fire("moveend");return this},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){o.DomUtil.removeClass(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(t,e){var i=this._getCenterOffset(t)._floor();return(e&&e.animate)===!0||this.getSize().contains(i)?(this.panBy(i,e),!0):!1}}),o.PosAnimation=o.DomUtil.TRANSITION?o.PosAnimation:o.PosAnimation.extend({run:function(t,e,i,n){this.stop(),this._el=t,this._inProgress=!0,this._duration=i||.25,this._easeOutPower=1/Math.max(n||.5,.2),this._startPos=o.DomUtil.getPosition(t),this._offset=e.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(),this._complete())},_animate:function(){this._animId=o.Util.requestAnimFrame(this._animate,this),this._step()},_step:function(){var t=+new Date-this._startTime,e=1e3*this._duration;e>t?this._runFrame(this._easeOut(t/e)):(this._runFrame(1),this._complete())},_runFrame:function(t){var e=this._startPos.add(this._offset.multiplyBy(t));o.DomUtil.setPosition(this._el,e),this.fire("step")},_complete:function(){o.Util.cancelAnimFrame(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}}),o.Map.mergeOptions({zoomAnimation:!0,zoomAnimationThreshold:4}),o.DomUtil.TRANSITION&&o.Map.addInitHook(function(){this._zoomAnimated=this.options.zoomAnimation&&o.DomUtil.TRANSITION&&o.Browser.any3d&&!o.Browser.android23&&!o.Browser.mobileOpera,this._zoomAnimated&&o.DomEvent.on(this._mapPane,o.DomUtil.TRANSITION_END,this._catchTransitionEnd,this)}),o.Map.include(o.DomUtil.TRANSITION?{_catchTransitionEnd:function(t){this._animatingZoom&&t.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(t,e,i){if(this._animatingZoom)return!0;if(i=i||{},!this._zoomAnimated||i.animate===!1||this._nothingToAnimate()||Math.abs(e-this._zoom)>this.options.zoomAnimationThreshold)return!1;var n=this.getZoomScale(e),o=this._getCenterOffset(t)._divideBy(1-1/n),s=this._getCenterLayerPoint()._add(o);return i.animate===!0||this.getSize().contains(o)?(this.fire("movestart").fire("zoomstart"),this._animateZoom(t,e,s,n,null,!0),!0):!1},_animateZoom:function(t,e,i,n,s,a,r){r||(this._animatingZoom=!0),o.DomUtil.addClass(this._mapPane,"leaflet-zoom-anim"),this._animateToCenter=t,this._animateToZoom=e,o.Draggable&&(o.Draggable._disabled=!0),o.Util.requestAnimFrame(function(){this.fire("zoomanim",{center:t,zoom:e,origin:i,scale:n,delta:s,backwards:a})},this)},_onZoomTransitionEnd:function(){this._animatingZoom=!1,o.DomUtil.removeClass(this._mapPane,"leaflet-zoom-anim"),this._resetView(this._animateToCenter,this._animateToZoom,!0,!0),o.Draggable&&(o.Draggable._disabled=!1)}}:{}),o.TileLayer.include({_animateZoom:function(t){this._animating||(this._animating=!0,this._prepareBgBuffer());var e=this._bgBuffer,i=o.DomUtil.TRANSFORM,n=t.delta?o.DomUtil.getTranslateString(t.delta):e.style[i],s=o.DomUtil.getScaleString(t.scale,t.origin);e.style[i]=t.backwards?s+" "+n:n+" "+s},_endZoomAnim:function(){var t=this._tileContainer,e=this._bgBuffer;t.style.visibility="",t.parentNode.appendChild(t),o.Util.falseFn(e.offsetWidth),this._animating=!1},_clearBgBuffer:function(){var t=this._map;!t||t._animatingZoom||t.touchZoom._zooming||(this._bgBuffer.innerHTML="",this._bgBuffer.style[o.DomUtil.TRANSFORM]="")},_prepareBgBuffer:function(){var t=this._tileContainer,e=this._bgBuffer,i=this._getLoadedTilesPercentage(e),n=this._getLoadedTilesPercentage(t);return e&&i>.5&&.5>n?(t.style.visibility="hidden",void this._stopLoadingImages(t)):(e.style.visibility="hidden",e.style[o.DomUtil.TRANSFORM]="",this._tileContainer=e,e=this._bgBuffer=t,this._stopLoadingImages(e),void clearTimeout(this._clearBgBufferTimer))},_getLoadedTilesPercentage:function(t){var e,i,n=t.getElementsByTagName("img"),o=0;for(e=0,i=n.length;i>e;e++)n[e].complete&&o++;return o/i},_stopLoadingImages:function(t){var e,i,n,s=Array.prototype.slice.call(t.getElementsByTagName("img"));for(e=0,i=s.length;i>e;e++)n=s[e],n.complete||(n.onload=o.Util.falseFn,n.onerror=o.Util.falseFn,n.src=o.Util.emptyImageUrl,n.parentNode.removeChild(n))}}),o.Map.include({_defaultLocateOptions:{watch:!1,setView:!1,maxZoom:1/0,timeout:1e4,maximumAge:0,enableHighAccuracy:!1},locate:function(t){if(t=this._locateOptions=o.extend(this._defaultLocateOptions,t),!navigator.geolocation)return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var e=o.bind(this._handleGeolocationResponse,this),i=o.bind(this._handleGeolocationError,this);return t.watch?this._locationWatchId=navigator.geolocation.watchPosition(e,i,t):navigator.geolocation.getCurrentPosition(e,i,t),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(t){var e=t.code,i=t.message||(1===e?"permission denied":2===e?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:e,message:"Geolocation error: "+i+"."})},_handleGeolocationResponse:function(t){var e=t.coords.latitude,i=t.coords.longitude,n=new o.LatLng(e,i),s=180*t.coords.accuracy/40075017,a=s/Math.cos(o.LatLng.DEG_TO_RAD*e),r=o.latLngBounds([e-s,i-a],[e+s,i+a]),h=this._locateOptions;if(h.setView){var l=Math.min(this.getBoundsZoom(r),h.maxZoom);this.setView(n,l)}var u={latlng:n,bounds:r,timestamp:t.timestamp};for(var c in t.coords)"number"==typeof t.coords[c]&&(u[c]=t.coords[c]);this.fire("locationfound",u)}})}(window,document)},{}],3:[function(require,module,exports){!function(t,e){if("object"==typeof exports&&exports)e(exports);else{var n={};e(n),"function"==typeof define&&define.amd?define(n):t.Mustache=n}}(this,function(t){function e(t,e){return y.call(t,e)}function n(t){return!e(w,t)}function r(t){return"function"==typeof t}function i(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function a(t){return String(t).replace(/[&<>"'\/]/g,function(t){return _[t]})}function o(t){this.string=t,this.tail=t,this.pos=0}function s(t,e){this.view=null==t?{}:t,this.parent=e,this._cache={".":this.view}}function c(){this.clearCache()}function l(e,n,i,a){function o(t){return n.render(t,i)}for(var s,c,u,p="",h=0,f=e.length;f>h;++h)switch(s=e[h],c=s[1],s[0]){case"#":if(u=i.lookup(c),"object"==typeof u||"string"==typeof u)if(x(u))for(var g=0,v=u.length;v>g;++g)p+=l(s[4],n,i.push(u[g]),a);else u&&(p+=l(s[4],n,i.push(u),a));else if(r(u)){var w=null==a?null:a.slice(s[3],s[5]);u=u.call(i.view,w,o),null!=u&&(p+=u)}else u&&(p+=l(s[4],n,i,a));break;case"^":u=i.lookup(c),(!u||x(u)&&0===u.length)&&(p+=l(s[4],n,i,a));break;case">":u=n.getPartial(c),r(u)&&(p+=u(i));break;case"&":u=i.lookup(c),null!=u&&(p+=u);break;case"name":u=i.lookup(c),null!=u&&(p+=t.escape(u));break;case"text":p+=c}return p}function u(t){for(var e,n=[],r=n,i=[],a=0,o=t.length;o>a;++a)switch(e=t[a],e[0]){case"#":case"^":i.push(e),r.push(e),r=e[4]=[];break;case"/":var s=i.pop();s[5]=e[2],r=i.length>0?i[i.length-1][4]:n;break;default:r.push(e)}return n}function p(t){for(var e,n,r=[],i=0,a=t.length;a>i;++i)e=t[i],e&&("text"===e[0]&&n&&"text"===n[0]?(n[1]+=e[1],n[3]=e[3]):(n=e,r.push(e)));return r}function h(t){return[new RegExp(i(t[0])+"\\s*"),new RegExp("\\s*"+i(t[1]))]}function f(e,r){function a(){if(P&&!C)for(;E.length;)delete U[E.pop()];else E=[];P=!1,C=!1}if(e=e||"",r=r||t.tags,"string"==typeof r&&(r=r.split(v)),2!==r.length)throw new Error("Invalid tags: "+r.join(", "));for(var s,c,l,f,w,y,b=h(r),x=new o(e),_=[],U=[],E=[],P=!1,C=!1;!x.eos();){if(s=x.pos,l=x.scanUntil(b[0]))for(var j=0,A=l.length;A>j;++j)f=l.charAt(j),n(f)?E.push(U.length):C=!0,U.push(["text",f,s,s+1]),s+=1,"\n"==f&&a();if(!x.scan(b[0]))break;if(P=!0,c=x.scan(k)||"name",x.scan(g),"="===c?(l=x.scanUntil(m),x.scan(m),x.scanUntil(b[1])):"{"===c?(l=x.scanUntil(new RegExp("\\s*"+i("}"+r[1]))),x.scan(d),x.scanUntil(b[1]),c="&"):l=x.scanUntil(b[1]),!x.scan(b[1]))throw new Error("Unclosed tag at "+x.pos);if(w=[c,l,s,x.pos],U.push(w),"#"===c||"^"===c)_.push(w);else if("/"===c){if(y=_.pop(),!y)throw new Error('Unopened section "'+l+'" at '+s);if(y[1]!==l)throw new Error('Unclosed section "'+y[1]+'" at '+s)}else if("name"===c||"{"===c||"&"===c)C=!0;else if("="===c){if(r=l.split(v),2!==r.length)throw new Error("Invalid tags at "+s+": "+r.join(", "));b=h(r)}}if(y=_.pop())throw new Error('Unclosed section "'+y[1]+'" at '+x.pos);return u(p(U))}var g=/\s*/,v=/\s+/,w=/\S/,m=/\s*=/,d=/\s*\}/,k=/#|\^|\/|>|\{|&|=|!/,y=RegExp.prototype.test,b=Object.prototype.toString,x=Array.isArray||function(t){return"[object Array]"===b.call(t)},_={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};o.prototype.eos=function(){return""===this.tail},o.prototype.scan=function(t){var e=this.tail.match(t);if(e&&0===e.index){var n=e[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n}return""},o.prototype.scanUntil=function(t){var e,n=this.tail.search(t);switch(n){case-1:e=this.tail,this.tail="";break;case 0:e="";break;default:e=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=e.length,e},s.make=function(t){return t instanceof s?t:new s(t)},s.prototype.push=function(t){return new s(t,this)},s.prototype.lookup=function(t){var e;if(t in this._cache)e=this._cache[t];else{for(var n=this;n;){if(t.indexOf(".")>0){e=n.view;for(var i=t.split("."),a=0;null!=e&&a<i.length;)e=e[i[a++]]}else e=n.view[t];if(null!=e)break;n=n.parent}this._cache[t]=e}return r(e)&&(e=e.call(this.view)),e},c.prototype.clearCache=function(){this._cache={},this._partialCache={}},c.prototype.compile=function(e,n){var r=this._cache[e];if(!r){var i=t.parse(e,n);r=this._cache[e]=this.compileTokens(i,e)}return r},c.prototype.compilePartial=function(t,e,n){var r=this.compile(e,n);return this._partialCache[t]=r,r},c.prototype.getPartial=function(t){return t in this._partialCache||!this._loadPartial||this.compilePartial(t,this._loadPartial(t)),this._partialCache[t]},c.prototype.compileTokens=function(t,e){var n=this;return function(i,a){if(a)if(r(a))n._loadPartial=a;else for(var o in a)n.compilePartial(o,a[o]);return l(t,n,s.make(i),e)}},c.prototype.render=function(t,e,n){return this.compile(t)(e,n)},t.name="mustache.js",t.version="0.7.3",t.tags=["{{","}}"],t.Scanner=o,t.Context=s,t.Writer=c,t.parse=f,t.escape=a;var U=new c;t.clearCache=function(){return U.clearCache()},t.compile=function(t,e){return U.compile(t,e)},t.compilePartial=function(t,e,n){return U.compilePartial(t,e,n)},t.compileTokens=function(t,e){return U.compileTokens(t,e)},t.render=function(t,e,n){return U.render(t,e,n)},t.to_html=function(e,n,i,a){var o=t.render(e,n,i);return r(a)?void a(o):o}})},{}],4:[function(require,module,exports){function cleanUrl(t){"use strict";return/^https?/.test(t.getScheme())?t.toString():/^mailto?/.test(t.getScheme())?t.toString():"data"==t.getScheme()&&/^image/.test(t.getPath())?t.toString():void 0}function cleanId(t){return t}var html_sanitize=require("./sanitizer-bundle.js");module.exports=function(t){return t?html_sanitize(t,cleanUrl,cleanId):""}},{"./sanitizer-bundle.js":5}],5:[function(require,module,exports){var URI=function(){function e(e){var t=(""+e).match(p);return t?new s(c(t[1]),c(t[2]),c(t[3]),c(t[4]),c(t[5]),c(t[6]),c(t[7])):null}function t(e,t,o,i,l,c,m){var u=new s(n(e,d),n(t,d),a(o),i>0?i.toString():null,n(l,f),null,a(m));return c&&("string"==typeof c?u.setRawQuery(c.replace(/[^?&=0-9A-Za-z_\-~.%]/g,r)):u.setAllParameters(c)),u}function a(e){return"string"==typeof e?encodeURIComponent(e):null}function n(e,t){return"string"==typeof e?encodeURI(e).replace(t,r):null}function r(e){var t=e.charCodeAt(0);return"%"+"0123456789ABCDEF".charAt(t>>4&15)+"0123456789ABCDEF".charAt(15&t)}function o(e){return e.replace(/(^|\/)\.(?:\/|$)/g,"$1").replace(/\/{2,}/g,"/")}function i(e){if(null===e)return null;for(var t,a=o(e),n=u;(t=a.replace(n,"$1"))!=a;a=t);return a}function l(e,t){var a=e.clone(),n=t.hasScheme();n?a.setRawScheme(t.getRawScheme()):n=t.hasCredentials(),n?a.setRawCredentials(t.getRawCredentials()):n=t.hasDomain(),n?a.setRawDomain(t.getRawDomain()):n=t.hasPort();var r=t.getRawPath(),o=i(r);if(n)a.setPort(t.getPort()),o=o&&o.replace(h,"");else if(n=!!r){if(47!==o.charCodeAt(0)){var l=i(a.getRawPath()||"").replace(h,""),s=l.lastIndexOf("/")+1;o=i((s?l.substring(0,s):"")+i(r)).replace(h,"")}}else o=o&&o.replace(h,""),o!==r&&a.setRawPath(o);return n?a.setRawPath(o):n=t.hasQuery(),n?a.setRawQuery(t.getRawQuery()):n=t.hasFragment(),n&&a.setRawFragment(t.getRawFragment()),a}function s(e,t,a,n,r,o,i){this.scheme_=e,this.credentials_=t,this.domain_=a,this.port_=n,this.path_=r,this.query_=o,this.fragment_=i,this.paramCache_=null}function c(e){return"string"==typeof e&&e.length>0?e:null}var m=new RegExp("(/|^)(?:[^./][^/]*|\\.{2,}(?:[^./][^/]*)|\\.{3,}[^/]*)/\\.\\.(?:/|$)"),u=new RegExp(m),h=/^(?:\.\.\/)*(?:\.\.$)?/;s.prototype.toString=function(){var e=[];return null!==this.scheme_&&e.push(this.scheme_,":"),null!==this.domain_&&(e.push("//"),null!==this.credentials_&&e.push(this.credentials_,"@"),e.push(this.domain_),null!==this.port_&&e.push(":",this.port_.toString())),null!==this.path_&&e.push(this.path_),null!==this.query_&&e.push("?",this.query_),null!==this.fragment_&&e.push("#",this.fragment_),e.join("")},s.prototype.clone=function(){return new s(this.scheme_,this.credentials_,this.domain_,this.port_,this.path_,this.query_,this.fragment_)},s.prototype.getScheme=function(){return this.scheme_&&decodeURIComponent(this.scheme_).toLowerCase()},s.prototype.getRawScheme=function(){return this.scheme_},s.prototype.setScheme=function(e){return this.scheme_=n(e,d),this},s.prototype.setRawScheme=function(e){return this.scheme_=e?e:null,this},s.prototype.hasScheme=function(){return null!==this.scheme_},s.prototype.getCredentials=function(){return this.credentials_&&decodeURIComponent(this.credentials_)},s.prototype.getRawCredentials=function(){return this.credentials_},s.prototype.setCredentials=function(e){return this.credentials_=n(e,d),this},s.prototype.setRawCredentials=function(e){return this.credentials_=e?e:null,this},s.prototype.hasCredentials=function(){return null!==this.credentials_},s.prototype.getDomain=function(){return this.domain_&&decodeURIComponent(this.domain_)},s.prototype.getRawDomain=function(){return this.domain_},s.prototype.setDomain=function(e){return this.setRawDomain(e&&encodeURIComponent(e))},s.prototype.setRawDomain=function(e){return this.domain_=e?e:null,this.setRawPath(this.path_)},s.prototype.hasDomain=function(){return null!==this.domain_},s.prototype.getPort=function(){return this.port_&&decodeURIComponent(this.port_)},s.prototype.setPort=function(e){if(e){if(e=Number(e),e!==(65535&e))throw new Error("Bad port number "+e);this.port_=""+e}else this.port_=null;return this},s.prototype.hasPort=function(){return null!==this.port_},s.prototype.getPath=function(){return this.path_&&decodeURIComponent(this.path_)},s.prototype.getRawPath=function(){return this.path_},s.prototype.setPath=function(e){return this.setRawPath(n(e,f))},s.prototype.setRawPath=function(e){return e?(e=String(e),this.path_=!this.domain_||/^\//.test(e)?e:"/"+e):this.path_=null,this},s.prototype.hasPath=function(){return null!==this.path_},s.prototype.getQuery=function(){return this.query_&&decodeURIComponent(this.query_).replace(/\+/g," ")},s.prototype.getRawQuery=function(){return this.query_},s.prototype.setQuery=function(e){return this.paramCache_=null,this.query_=a(e),this},s.prototype.setRawQuery=function(e){return this.paramCache_=null,this.query_=e?e:null,this},s.prototype.hasQuery=function(){return null!==this.query_},s.prototype.setAllParameters=function(e){if("object"==typeof e&&!(e instanceof Array)&&(e instanceof Object||"[object Array]"!==Object.prototype.toString.call(e))){var t=[],a=-1;for(var n in e){var r=e[n];"string"==typeof r&&(t[++a]=n,t[++a]=r)}e=t}this.paramCache_=null;for(var o=[],i="",l=0;l<e.length;){var n=e[l++],r=e[l++];o.push(i,encodeURIComponent(n.toString())),i="&",r&&o.push("=",encodeURIComponent(r.toString()))}return this.query_=o.join(""),this},s.prototype.checkParameterCache_=function(){if(!this.paramCache_){var e=this.query_;if(e){for(var t=e.split(/[&\?]/),a=[],n=-1,r=0;r<t.length;++r){var o=t[r].match(/^([^=]*)(?:=(.*))?$/);a[++n]=decodeURIComponent(o[1]).replace(/\+/g," "),a[++n]=decodeURIComponent(o[2]||"").replace(/\+/g," ")}this.paramCache_=a}else this.paramCache_=[]}},s.prototype.setParameterValues=function(e,t){"string"==typeof t&&(t=[t]),this.checkParameterCache_();for(var a=0,n=this.paramCache_,r=[],o=0;o<n.length;o+=2)e===n[o]?a<t.length&&r.push(e,t[a++]):r.push(n[o],n[o+1]);for(;a<t.length;)r.push(e,t[a++]);return this.setAllParameters(r),this},s.prototype.removeParameter=function(e){return this.setParameterValues(e,[])},s.prototype.getAllParameters=function(){return this.checkParameterCache_(),this.paramCache_.slice(0,this.paramCache_.length)},s.prototype.getParameterValues=function(e){this.checkParameterCache_();for(var t=[],a=0;a<this.paramCache_.length;a+=2)e===this.paramCache_[a]&&t.push(this.paramCache_[a+1]);return t},s.prototype.getParameterMap=function(e){this.checkParameterCache_();for(var t={},a=0;a<this.paramCache_.length;a+=2){var n=this.paramCache_[a++],r=this.paramCache_[a++];n in t?t[n].push(r):t[n]=[r]}return t},s.prototype.getParameterValue=function(e){this.checkParameterCache_();for(var t=0;t<this.paramCache_.length;t+=2)if(e===this.paramCache_[t])return this.paramCache_[t+1];return null},s.prototype.getFragment=function(){return this.fragment_&&decodeURIComponent(this.fragment_)},s.prototype.getRawFragment=function(){return this.fragment_},s.prototype.setFragment=function(e){return this.fragment_=e?encodeURIComponent(e):null,this},s.prototype.setRawFragment=function(e){return this.fragment_=e?e:null,this},s.prototype.hasFragment=function(){return null!==this.fragment_};var p=new RegExp("^(?:([^:/?#]+):)?(?://(?:([^/?#]*)@)?([^/?#:@]*)(?::([0-9]+))?)?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$"),d=/[#\/\?@]/g,f=/[\#\?]/g;return s.parse=e,s.create=t,s.resolve=l,s.collapse_dots=i,s.utils={mimeTypeOf:function(t){var a=e(t);return/\.html$/.test(a.getPath())?"text/html":"application/javascript"},resolve:function(t,a){return t?l(e(t),e(a)).toString():""+a}},s}(),html4={};if(html4.atype={NONE:0,URI:1,URI_FRAGMENT:11,SCRIPT:2,STYLE:3,HTML:12,ID:4,IDREF:5,IDREFS:6,GLOBAL_NAME:7,LOCAL_NAME:8,CLASSES:9,FRAME_TARGET:10,MEDIA_QUERY:13},html4.atype=html4.atype,html4.ATTRIBS={"*::class":9,"*::dir":0,"*::draggable":0,"*::hidden":0,"*::id":4,"*::inert":0,"*::itemprop":0,"*::itemref":6,"*::itemscope":0,"*::lang":0,"*::onblur":2,"*::onchange":2,"*::onclick":2,"*::ondblclick":2,"*::onfocus":2,"*::onkeydown":2,"*::onkeypress":2,"*::onkeyup":2,"*::onload":2,"*::onmousedown":2,"*::onmousemove":2,"*::onmouseout":2,"*::onmouseover":2,"*::onmouseup":2,"*::onreset":2,"*::onscroll":2,"*::onselect":2,"*::onsubmit":2,"*::onunload":2,"*::spellcheck":0,"*::style":3,"*::title":0,"*::translate":0,"a::accesskey":0,"a::coords":0,"a::href":1,"a::hreflang":0,"a::name":7,"a::onblur":2,"a::onfocus":2,"a::shape":0,"a::tabindex":0,"a::target":10,"a::type":0,"area::accesskey":0,"area::alt":0,"area::coords":0,"area::href":1,"area::nohref":0,"area::onblur":2,"area::onfocus":2,"area::shape":0,"area::tabindex":0,"area::target":10,"audio::controls":0,"audio::loop":0,"audio::mediagroup":5,"audio::muted":0,"audio::preload":0,"bdo::dir":0,"blockquote::cite":1,"br::clear":0,"button::accesskey":0,"button::disabled":0,"button::name":8,"button::onblur":2,"button::onfocus":2,"button::tabindex":0,"button::type":0,"button::value":0,"canvas::height":0,"canvas::width":0,"caption::align":0,"col::align":0,"col::char":0,"col::charoff":0,"col::span":0,"col::valign":0,"col::width":0,"colgroup::align":0,"colgroup::char":0,"colgroup::charoff":0,"colgroup::span":0,"colgroup::valign":0,"colgroup::width":0,"command::checked":0,"command::command":5,"command::disabled":0,"command::icon":1,"command::label":0,"command::radiogroup":0,"command::type":0,"data::value":0,"del::cite":1,"del::datetime":0,"details::open":0,"dir::compact":0,"div::align":0,"dl::compact":0,"fieldset::disabled":0,"font::color":0,"font::face":0,"font::size":0,"form::accept":0,"form::action":1,"form::autocomplete":0,"form::enctype":0,"form::method":0,"form::name":7,"form::novalidate":0,"form::onreset":2,"form::onsubmit":2,"form::target":10,"h1::align":0,"h2::align":0,"h3::align":0,"h4::align":0,"h5::align":0,"h6::align":0,"hr::align":0,"hr::noshade":0,"hr::size":0,"hr::width":0,"iframe::align":0,"iframe::frameborder":0,"iframe::height":0,"iframe::marginheight":0,"iframe::marginwidth":0,"iframe::width":0,"img::align":0,"img::alt":0,"img::border":0,"img::height":0,"img::hspace":0,"img::ismap":0,"img::name":7,"img::src":1,"img::usemap":11,"img::vspace":0,"img::width":0,"input::accept":0,"input::accesskey":0,"input::align":0,"input::alt":0,"input::autocomplete":0,"input::checked":0,"input::disabled":0,"input::inputmode":0,"input::ismap":0,"input::list":5,"input::max":0,"input::maxlength":0,"input::min":0,"input::multiple":0,"input::name":8,"input::onblur":2,"input::onchange":2,"input::onfocus":2,"input::onselect":2,"input::placeholder":0,"input::readonly":0,"input::required":0,"input::size":0,"input::src":1,"input::step":0,"input::tabindex":0,"input::type":0,"input::usemap":11,"input::value":0,"ins::cite":1,"ins::datetime":0,"label::accesskey":0,"label::for":5,"label::onblur":2,"label::onfocus":2,"legend::accesskey":0,"legend::align":0,"li::type":0,"li::value":0,"map::name":7,"menu::compact":0,"menu::label":0,"menu::type":0,"meter::high":0,"meter::low":0,"meter::max":0,"meter::min":0,"meter::value":0,"ol::compact":0,"ol::reversed":0,"ol::start":0,"ol::type":0,"optgroup::disabled":0,"optgroup::label":0,"option::disabled":0,"option::label":0,"option::selected":0,"option::value":0,"output::for":6,"output::name":8,"p::align":0,"pre::width":0,"progress::max":0,"progress::min":0,"progress::value":0,"q::cite":1,"select::autocomplete":0,"select::disabled":0,"select::multiple":0,"select::name":8,"select::onblur":2,"select::onchange":2,"select::onfocus":2,"select::required":0,"select::size":0,"select::tabindex":0,"source::type":0,"table::align":0,"table::bgcolor":0,"table::border":0,"table::cellpadding":0,"table::cellspacing":0,"table::frame":0,"table::rules":0,"table::summary":0,"table::width":0,"tbody::align":0,"tbody::char":0,"tbody::charoff":0,"tbody::valign":0,"td::abbr":0,"td::align":0,"td::axis":0,"td::bgcolor":0,"td::char":0,"td::charoff":0,"td::colspan":0,"td::headers":6,"td::height":0,"td::nowrap":0,"td::rowspan":0,"td::scope":0,"td::valign":0,"td::width":0,"textarea::accesskey":0,"textarea::autocomplete":0,"textarea::cols":0,"textarea::disabled":0,"textarea::inputmode":0,"textarea::name":8,"textarea::onblur":2,"textarea::onchange":2,"textarea::onfocus":2,"textarea::onselect":2,"textarea::placeholder":0,"textarea::readonly":0,"textarea::required":0,"textarea::rows":0,"textarea::tabindex":0,"textarea::wrap":0,"tfoot::align":0,"tfoot::char":0,"tfoot::charoff":0,"tfoot::valign":0,"th::abbr":0,"th::align":0,"th::axis":0,"th::bgcolor":0,"th::char":0,"th::charoff":0,"th::colspan":0,"th::headers":6,"th::height":0,"th::nowrap":0,"th::rowspan":0,"th::scope":0,"th::valign":0,"th::width":0,"thead::align":0,"thead::char":0,"thead::charoff":0,"thead::valign":0,"tr::align":0,"tr::bgcolor":0,"tr::char":0,"tr::charoff":0,"tr::valign":0,"track::default":0,"track::kind":0,"track::label":0,"track::srclang":0,"ul::compact":0,"ul::type":0,"video::controls":0,"video::height":0,"video::loop":0,"video::mediagroup":5,"video::muted":0,"video::poster":1,"video::preload":0,"video::width":0},html4.ATTRIBS=html4.ATTRIBS,html4.eflags={OPTIONAL_ENDTAG:1,EMPTY:2,CDATA:4,RCDATA:8,UNSAFE:16,FOLDABLE:32,SCRIPT:64,STYLE:128,VIRTUALIZED:256},html4.eflags=html4.eflags,html4.ELEMENTS={a:0,abbr:0,acronym:0,address:0,applet:272,area:2,article:0,aside:0,audio:0,b:0,base:274,basefont:274,bdi:0,bdo:0,big:0,blockquote:0,body:305,br:2,button:0,canvas:0,caption:0,center:0,cite:0,code:0,col:2,colgroup:1,command:2,data:0,datalist:0,dd:1,del:0,details:0,dfn:0,dialog:272,dir:0,div:0,dl:0,dt:1,em:0,fieldset:0,figcaption:0,figure:0,font:0,footer:0,form:0,frame:274,frameset:272,h1:0,h2:0,h3:0,h4:0,h5:0,h6:0,head:305,header:0,hgroup:0,hr:2,html:305,i:0,iframe:16,img:2,input:2,ins:0,isindex:274,kbd:0,keygen:274,label:0,legend:0,li:1,link:274,map:0,mark:0,menu:0,meta:274,meter:0,nav:0,nobr:0,noembed:276,noframes:276,noscript:276,object:272,ol:0,optgroup:0,option:1,output:0,p:1,param:274,pre:0,progress:0,q:0,s:0,samp:0,script:84,section:0,select:0,small:0,source:2,span:0,strike:0,strong:0,style:148,sub:0,summary:0,sup:0,table:0,tbody:1,td:1,textarea:8,tfoot:1,th:1,thead:1,time:0,title:280,tr:1,track:2,tt:0,u:0,ul:0,var:0,video:0,wbr:2},html4.ELEMENTS=html4.ELEMENTS,html4.ELEMENT_DOM_INTERFACES={a:"HTMLAnchorElement",abbr:"HTMLElement",acronym:"HTMLElement",address:"HTMLElement",applet:"HTMLAppletElement",area:"HTMLAreaElement",article:"HTMLElement",aside:"HTMLElement",audio:"HTMLAudioElement",b:"HTMLElement",base:"HTMLBaseElement",basefont:"HTMLBaseFontElement",bdi:"HTMLElement",bdo:"HTMLElement",big:"HTMLElement",blockquote:"HTMLQuoteElement",body:"HTMLBodyElement",br:"HTMLBRElement",button:"HTMLButtonElement",canvas:"HTMLCanvasElement",caption:"HTMLTableCaptionElement",center:"HTMLElement",cite:"HTMLElement",code:"HTMLElement",col:"HTMLTableColElement",colgroup:"HTMLTableColElement",command:"HTMLCommandElement",data:"HTMLElement",datalist:"HTMLDataListElement",dd:"HTMLElement",del:"HTMLModElement",details:"HTMLDetailsElement",dfn:"HTMLElement",dialog:"HTMLDialogElement",dir:"HTMLDirectoryElement",div:"HTMLDivElement",dl:"HTMLDListElement",dt:"HTMLElement",em:"HTMLElement",fieldset:"HTMLFieldSetElement",figcaption:"HTMLElement",figure:"HTMLElement",font:"HTMLFontElement",footer:"HTMLElement",form:"HTMLFormElement",frame:"HTMLFrameElement",frameset:"HTMLFrameSetElement",h1:"HTMLHeadingElement",h2:"HTMLHeadingElement",h3:"HTMLHeadingElement",h4:"HTMLHeadingElement",h5:"HTMLHeadingElement",h6:"HTMLHeadingElement",head:"HTMLHeadElement",header:"HTMLElement",hgroup:"HTMLElement",hr:"HTMLHRElement",html:"HTMLHtmlElement",i:"HTMLElement",iframe:"HTMLIFrameElement",img:"HTMLImageElement",input:"HTMLInputElement",ins:"HTMLModElement",isindex:"HTMLUnknownElement",kbd:"HTMLElement",keygen:"HTMLKeygenElement",label:"HTMLLabelElement",legend:"HTMLLegendElement",li:"HTMLLIElement",link:"HTMLLinkElement",map:"HTMLMapElement",mark:"HTMLElement",menu:"HTMLMenuElement",meta:"HTMLMetaElement",meter:"HTMLMeterElement",nav:"HTMLElement",nobr:"HTMLElement",noembed:"HTMLElement",noframes:"HTMLElement",noscript:"HTMLElement",object:"HTMLObjectElement",ol:"HTMLOListElement",optgroup:"HTMLOptGroupElement",option:"HTMLOptionElement",output:"HTMLOutputElement",p:"HTMLParagraphElement",param:"HTMLParamElement",pre:"HTMLPreElement",progress:"HTMLProgressElement",q:"HTMLQuoteElement",s:"HTMLElement",samp:"HTMLElement",script:"HTMLScriptElement",section:"HTMLElement",select:"HTMLSelectElement",small:"HTMLElement",source:"HTMLSourceElement",span:"HTMLSpanElement",strike:"HTMLElement",strong:"HTMLElement",style:"HTMLStyleElement",sub:"HTMLElement",summary:"HTMLElement",sup:"HTMLElement",table:"HTMLTableElement",tbody:"HTMLTableSectionElement",td:"HTMLTableDataCellElement",textarea:"HTMLTextAreaElement",tfoot:"HTMLTableSectionElement",th:"HTMLTableHeaderCellElement",thead:"HTMLTableSectionElement",time:"HTMLTimeElement",title:"HTMLTitleElement",tr:"HTMLTableRowElement",track:"HTMLTrackElement",tt:"HTMLElement",u:"HTMLElement",ul:"HTMLUListElement",var:"HTMLElement",video:"HTMLVideoElement",wbr:"HTMLElement"},html4.ELEMENT_DOM_INTERFACES=html4.ELEMENT_DOM_INTERFACES,html4.ueffects={NOT_LOADED:0,SAME_DOCUMENT:1,NEW_DOCUMENT:2},html4.ueffects=html4.ueffects,html4.URIEFFECTS={"a::href":2,"area::href":2,"blockquote::cite":0,"command::icon":1,"del::cite":0,"form::action":2,"img::src":1,"input::src":1,"ins::cite":0,"q::cite":0,"video::poster":1},html4.URIEFFECTS=html4.URIEFFECTS,html4.ltypes={UNSANDBOXED:2,SANDBOXED:1,DATA:0},html4.ltypes=html4.ltypes,html4.LOADERTYPES={"a::href":2,"area::href":2,"blockquote::cite":2,"command::icon":1,"del::cite":2,"form::action":2,"img::src":1,"input::src":1,"ins::cite":2,"q::cite":2,"video::poster":1},html4.LOADERTYPES=html4.LOADERTYPES,"i"!=="I".toLowerCase())throw"I/i problem";var html=function(e){function t(e){if(S.hasOwnProperty(e))return S[e];var t=e.match(P);if(t)return String.fromCharCode(parseInt(t[1],10));if(t=e.match(D))return String.fromCharCode(parseInt(t[1],16));if(I&&k.test(e)){I.innerHTML="&"+e+";";var a=I.textContent;return S[e]=a,a}return"&"+e+";"}function a(e,a){return t(a)}function n(e){return e.replace(x,"")}function r(e){return e.replace(N,a)}function o(e){return(""+e).replace(F,"&amp;").replace(B,"&lt;").replace(q,"&gt;").replace(z,"&#34;")}function i(e){return e.replace(U,"&amp;$1").replace(B,"&lt;").replace(q,"&gt;")}function l(e){var t={cdata:e.cdata||e.cdata,comment:e.comment||e.comment,endDoc:e.endDoc||e.endDoc,endTag:e.endTag||e.endTag,pcdata:e.pcdata||e.pcdata,rcdata:e.rcdata||e.rcdata,startDoc:e.startDoc||e.startDoc,startTag:e.startTag||e.startTag};return function(e,a){return s(e,t,a)}}function s(e,t,a){var n=u(e),r={noMoreGT:!1,noMoreEndComments:!1};m(t,n,0,r,a)}function c(e,t,a,n,r){return function(){m(e,t,a,n,r)}}function m(t,a,n,r,o){try{t.startDoc&&0==n&&t.startDoc(o);for(var i,l,s,m=n,u=a.length;u>m;){var f=a[m++],g=a[m];switch(f){case"&":O.test(g)?(t.pcdata&&t.pcdata("&"+g,o,Y,c(t,a,m,r,o)),m++):t.pcdata&&t.pcdata("&amp;",o,Y,c(t,a,m,r,o));break;case"</":(i=/^([-\w:]+)[^\'\"]*/.exec(g))?i[0].length===g.length&&">"===a[m+1]?(m+=2,s=i[1].toLowerCase(),t.endTag&&t.endTag(s,o,Y,c(t,a,m,r,o))):m=h(a,m,t,o,Y,r):t.pcdata&&t.pcdata("&lt;/",o,Y,c(t,a,m,r,o));break;case"<":if(i=/^([-\w:]+)\s*\/?/.exec(g))if(i[0].length===g.length&&">"===a[m+1]){m+=2,s=i[1].toLowerCase(),t.startTag&&t.startTag(s,[],o,Y,c(t,a,m,r,o));var E=e.ELEMENTS[s];if(E&j){var T={name:s,next:m,eflags:E};m=d(a,T,t,o,Y,r)}}else m=p(a,m,t,o,Y,r);else t.pcdata&&t.pcdata("&lt;",o,Y,c(t,a,m,r,o));break;case"\x3c!--":if(!r.noMoreEndComments){for(l=m+1;u>l&&(">"!==a[l]||!/--$/.test(a[l-1]));l++);if(u>l){if(t.comment){var L=a.slice(m,l).join("");t.comment(L.substr(0,L.length-2),o,Y,c(t,a,l+1,r,o))}m=l+1}else r.noMoreEndComments=!0}r.noMoreEndComments&&t.pcdata&&t.pcdata("&lt;!--",o,Y,c(t,a,m,r,o));break;case"<!":if(/^\w/.test(g)){if(!r.noMoreGT){for(l=m+1;u>l&&">"!==a[l];l++);u>l?m=l+1:r.noMoreGT=!0}r.noMoreGT&&t.pcdata&&t.pcdata("&lt;!",o,Y,c(t,a,m,r,o))}else t.pcdata&&t.pcdata("&lt;!",o,Y,c(t,a,m,r,o));break;case"<?":if(!r.noMoreGT){for(l=m+1;u>l&&">"!==a[l];l++);u>l?m=l+1:r.noMoreGT=!0}r.noMoreGT&&t.pcdata&&t.pcdata("&lt;?",o,Y,c(t,a,m,r,o));break;case">":t.pcdata&&t.pcdata("&gt;",o,Y,c(t,a,m,r,o));break;case"":break;default:t.pcdata&&t.pcdata(f,o,Y,c(t,a,m,r,o))}}t.endDoc&&t.endDoc(o)}catch(M){if(M!==Y)throw M}}function u(e){var t=/(<\/|<\!--|<[!?]|[&<>])/g;if(e+="",$)return e.split(t);for(var a,n=[],r=0;null!==(a=t.exec(e));)n.push(e.substring(r,a.index)),n.push(a[0]),r=a.index+a[0].length;return n.push(e.substring(r)),n}function h(e,t,a,n,r,o){var i=f(e,t);return i?(a.endTag&&a.endTag(i.name,n,r,c(a,e,t,o,n)),i.next):e.length}function p(e,t,a,n,r,o){var i=f(e,t);return i?(a.startTag&&a.startTag(i.name,i.attrs,n,r,c(a,e,i.next,o,n)),i.eflags&j?d(e,i,a,n,r,o):i.next):e.length}function d(t,a,n,r,o,l){var s=t.length;Q.hasOwnProperty(a.name)||(Q[a.name]=new RegExp("^"+a.name+"(?:[\\s\\/]|$)","i"));for(var m=Q[a.name],u=a.next,h=a.next+1;s>h&&("</"!==t[h-1]||!m.test(t[h]));h++);s>h&&(h-=1);var p=t.slice(u,h).join("");if(a.eflags&e.eflags.CDATA)n.cdata&&n.cdata(p,r,o,c(n,t,h,l,r));else{if(!(a.eflags&e.eflags.RCDATA))throw new Error("bug");n.rcdata&&n.rcdata(i(p),r,o,c(n,t,h,l,r))}return h}function f(t,a){var n=/^([-\w:]+)/.exec(t[a]),r={};r.name=n[1].toLowerCase(),r.eflags=e.ELEMENTS[r.name];for(var o=t[a].substr(n[0].length),i=a+1,l=t.length;l>i&&">"!==t[i];i++)o+=t[i];if(i>=l)return void 0;for(var s=[];""!==o;)if(n=G.exec(o)){if(n[4]&&!n[5]||n[6]&&!n[7]){for(var c=n[4]||n[6],m=!1,u=[o,t[i++]];l>i;i++){if(m){if(">"===t[i])break}else 0<=t[i].indexOf(c)&&(m=!0);u.push(t[i])}if(i>=l)break;o=u.join("");continue}var h=n[1].toLowerCase(),p=n[2]?g(n[3]):"";s.push(h,p),o=o.substr(n[0].length)}else o=o.replace(/^[\s\S][^a-z\s]*/,"");return r.attrs=s,r.next=i+1,r}function g(e){var t=e.charCodeAt(0);return(34===t||39===t)&&(e=e.substr(1,e.length-2)),r(n(e))}function E(t){var a,n,r=function(e,t){n||t.push(e)};return l({startDoc:function(e){a=[],n=!1},startTag:function(r,i,l){if(!n&&e.ELEMENTS.hasOwnProperty(r)){var s=e.ELEMENTS[r];if(!(s&e.eflags.FOLDABLE)){var c=t(r,i);if(!c)return void(n=!(s&e.eflags.EMPTY));if("object"!=typeof c)throw new Error("tagPolicy did not return object (old API?)");if(!("attribs"in c))throw new Error("tagPolicy gave no attribs");i=c.attribs;var m,u;if("tagName"in c?(u=c.tagName,m=e.ELEMENTS[u]):(u=r,m=s),s&e.eflags.OPTIONAL_ENDTAG){var h=a[a.length-1];!h||h.orig!==r||h.rep===u&&r===u||l.push("</",h.rep,">")}s&e.eflags.EMPTY||a.push({orig:r,rep:u}),l.push("<",u);for(var p=0,d=i.length;d>p;p+=2){var f=i[p],g=i[p+1];null!==g&&void 0!==g&&l.push(" ",f,'="',o(g),'"')}l.push(">"),s&e.eflags.EMPTY&&!(m&e.eflags.EMPTY)&&l.push("</",u,">")}}},endTag:function(t,r){if(n)return void(n=!1);if(e.ELEMENTS.hasOwnProperty(t)){var o=e.ELEMENTS[t];if(!(o&(e.eflags.EMPTY|e.eflags.FOLDABLE))){var i;if(o&e.eflags.OPTIONAL_ENDTAG)for(i=a.length;--i>=0;){var l=a[i].orig;if(l===t)break;if(!(e.ELEMENTS[l]&e.eflags.OPTIONAL_ENDTAG))return}else for(i=a.length;--i>=0&&a[i].orig!==t;);if(0>i)return;for(var s=a.length;--s>i;){var c=a[s].rep;e.ELEMENTS[c]&e.eflags.OPTIONAL_ENDTAG||r.push("</",c,">")}i<a.length&&(t=a[i].rep),a.length=i,r.push("</",t,">")}}},pcdata:r,rcdata:r,cdata:r,endDoc:function(e){for(;a.length;a.length--)e.push("</",a[a.length-1].rep,">")}})}function T(e,t,a,n,r){if(!r)return null;try{var o=URI.parse(""+e);if(o&&(!o.hasScheme()||V.test(o.getScheme()))){var i=r(o,t,a,n);return i?i.toString():null}}catch(l){return null}return null}function L(e,t,a,n,r){if(a||e(t+" removed",{change:"removed",tagName:t}),n!==r){var o="changed";n&&!r?o="removed":!n&&r&&(o="added"),e(t+"."+a+" "+o,{change:o,tagName:t,attribName:a,oldValue:n,newValue:r})}}function M(e,t,a){var n;return n=t+"::"+a,e.hasOwnProperty(n)?e[n]:(n="*::"+a,e.hasOwnProperty(n)?e[n]:void 0)}function b(t,a){return M(e.LOADERTYPES,t,a)}function y(t,a){return M(e.URIEFFECTS,t,a)}function v(t,a,n,r,o){for(var i=0;i<a.length;i+=2){var l,s=a[i],c=a[i+1],m=c,u=null;if(l=t+"::"+s,(e.ATTRIBS.hasOwnProperty(l)||(l="*::"+s,e.ATTRIBS.hasOwnProperty(l)))&&(u=e.ATTRIBS[l]),null!==u)switch(u){case e.atype.NONE:break;case e.atype.SCRIPT:c=null,o&&L(o,t,s,m,c);break;case e.atype.STYLE:if("undefined"==typeof A){c=null,o&&L(o,t,s,m,c);break}var h=[];A(c,{declaration:function(t,a){var r=t.toLowerCase(),o=C[r];o&&(R(r,o,a,n?function(t){return T(t,e.ueffects.SAME_DOCUMENT,e.ltypes.SANDBOXED,{TYPE:"CSS",CSS_PROP:r},n)}:null),h.push(t+": "+a.join(" ")))}}),c=h.length>0?h.join(" ; "):null,o&&L(o,t,s,m,c);break;case e.atype.ID:case e.atype.IDREF:case e.atype.IDREFS:case e.atype.GLOBAL_NAME:case e.atype.LOCAL_NAME:case e.atype.CLASSES:c=r?r(c):c,o&&L(o,t,s,m,c);break;case e.atype.URI:c=T(c,y(t,s),b(t,s),{TYPE:"MARKUP",XML_ATTR:s,XML_TAG:t},n),o&&L(o,t,s,m,c);break;case e.atype.URI_FRAGMENT:c&&"#"===c.charAt(0)?(c=c.substring(1),c=r?r(c):c,null!==c&&void 0!==c&&(c="#"+c)):c=null,o&&L(o,t,s,m,c);break;default:c=null,o&&L(o,t,s,m,c)}else c=null,o&&L(o,t,s,m,c);a[i+1]=c}return a}function H(t,a,n){return function(r,o){return e.ELEMENTS[r]&e.eflags.UNSAFE?void(n&&L(n,r,void 0,void 0,void 0)):{attribs:v(r,o,t,a,n)}}}function _(e,t){var a=[];return E(t)(e,a),a.join("")}function w(e,t,a,n){var r=H(t,a,n);return _(e,r)}var A,R,C;"undefined"!=typeof window&&(A=window.parseCssDeclarations,R=window.sanitizeCssProperty,C=window.cssSchema);var S={lt:"<",LT:"<",gt:">",GT:">",amp:"&",AMP:"&",quot:'"',apos:"'",nbsp:""},P=/^#(\d+)$/,D=/^#x([0-9A-Fa-f]+)$/,k=/^[A-Za-z][A-za-z0-9]+$/,I="undefined"!=typeof window&&window.document?window.document.createElement("textarea"):null,x=/\0/g,N=/&(#[0-9]+|#[xX][0-9A-Fa-f]+|\w+);/g,O=/^(#[0-9]+|#[xX][0-9A-Fa-f]+|\w+);/,F=/&/g,U=/&([^a-z#]|#(?:[^0-9x]|x(?:[^0-9a-f]|$)|$)|$)/gi,B=/[<]/g,q=/>/g,z=/\"/g,G=new RegExp("^\\s*([-.:\\w]+)(?:\\s*(=)\\s*((\")[^\"]*(\"|$)|(')[^']*('|$)|(?=[a-z][-\\w]*\\s*=)|[^\"'\\s]*))?","i"),$=3==="a,b".split(/(,)/).length,j=e.eflags.CDATA|e.eflags.RCDATA,Y={},Q={},V=/^(?:https?|mailto|data)$/i,X={};return X.escapeAttrib=X.escapeAttrib=o,X.makeHtmlSanitizer=X.makeHtmlSanitizer=E,X.makeSaxParser=X.makeSaxParser=l,X.makeTagPolicy=X.makeTagPolicy=H,X.normalizeRCData=X.normalizeRCData=i,X.sanitize=X.sanitize=w,X.sanitizeAttribs=X.sanitizeAttribs=v,X.sanitizeWithPolicy=X.sanitizeWithPolicy=_,X.unescapeEntities=X.unescapeEntities=r,X}(html4),html_sanitize=html.sanitize;html4.ATTRIBS["*::style"]=0,html4.ELEMENTS.style=0,html4.ATTRIBS["a::target"]=0,html4.ELEMENTS.video=0,html4.ATTRIBS["video::src"]=0,html4.ATTRIBS["video::poster"]=0,html4.ATTRIBS["video::controls"]=0,html4.ELEMENTS.audio=0,html4.ATTRIBS["audio::src"]=0,html4.ATTRIBS["video::autoplay"]=0,html4.ATTRIBS["video::controls"]=0,"undefined"!=typeof module&&(module.exports=html_sanitize)},{}],6:[function(require,module,exports){module.exports={author:"Mapbox",name:"mapbox.js",description:"mapbox javascript api",version:"2.1.8",homepage:"http://mapbox.com/",repository:{type:"git",url:"git://github.com/mapbox/mapbox.js.git"},main:"src/index.js",dependencies:{leaflet:"0.7.3",mustache:"0.7.3",corslite:"0.0.6","sanitize-caja":"0.1.3"},scripts:{test:"jshint src/*.js && mocha-phantomjs test/index.html"},devDependencies:{browserify:"^6.3.2","clean-css":"~2.0.7","expect.js":"0.3.1",happen:"0.1.3",jshint:"2.4.4","leaflet-fullscreen":"0.0.4","leaflet-hash":"0.2.1",marked:"~0.3.0",minifyify:"^6.1.0",minimist:"0.0.5",mocha:"1.17.1","mocha-phantomjs":"3.1.6",sinon:"1.10.2"},optionalDependencies:{},engines:{node:"*"}}},{}],7:[function(require,module,exports){"use strict";module.exports={HTTP_URL:"http://a.tiles.mapbox.com/v4",HTTPS_URL:"https://a.tiles.mapbox.com/v4",FORCE_HTTPS:!1,REQUIRE_ACCESS_TOKEN:!0}},{}],8:[function(require,module,exports){"use strict";var util=require("./util"),urlhelper=require("./url"),request=require("./request"),marker=require("./marker"),simplestyle=require("./simplestyle"),FeatureLayer=L.FeatureGroup.extend({options:{filter:function(){return!0},sanitizer:require("sanitize-caja"),style:simplestyle.style,popupOptions:{closeButton:!1}},initialize:function(e,t){L.setOptions(this,t),this._layers={},"string"==typeof e?util.idUrl(e,this):e&&"object"==typeof e&&this.setGeoJSON(e)},setGeoJSON:function(e){return this._geojson=e,this.clearLayers(),this._initialize(e),this},getGeoJSON:function(){return this._geojson},loadURL:function(e){return this._request&&"abort"in this._request&&this._request.abort(),this._request=request(e,L.bind(function(t,i){this._request=null,t&&"abort"!==t.type?(util.log("could not load features at "+e),this.fire("error",{error:t})):i&&(this.setGeoJSON(i),this.fire("ready"))},this)),this},loadID:function(e){return this.loadURL(urlhelper("/"+e+"/features.json",this.options.accessToken))},setFilter:function(e){return this.options.filter=e,this._geojson&&(this.clearLayers(),this._initialize(this._geojson)),this},getFilter:function(){return this.options.filter},_initialize:function(e){var t,i,r=L.Util.isArray(e)?e:e.features;if(r)for(t=0,i=r.length;i>t;t++)(r[t].geometries||r[t].geometry||r[t].features)&&this._initialize(r[t]);else if(this.options.filter(e)){var s={accessToken:this.options.accessToken},o=this.options.pointToLayer||function(e,t){return marker.style(e,t,s)},n=L.GeoJSON.geometryToLayer(e,o),u=marker.createPopup(e,this.options.sanitizer),a=this.options.style;a&&"setStyle"in n&&("function"==typeof a&&(a=a(e)),n.setStyle(a)),n.feature=e,u&&n.bindPopup(u,this.options.popupOptions),this.addLayer(n)}}});module.exports.FeatureLayer=FeatureLayer,module.exports.featureLayer=function(e,t){return new FeatureLayer(e,t)}},{"./marker":23,"./request":24,"./simplestyle":26,"./url":28,"./util":29,"sanitize-caja":4}],9:[function(require,module,exports){"use strict";var Feedback=L.Class.extend({includes:L.Mixin.Events,data:{},record:function(e){L.extend(this.data,e),this.fire("change")}});module.exports=new Feedback},{}],10:[function(require,module,exports){"use strict";var util=require("./util"),urlhelper=require("./url"),feedback=require("./feedback"),request=require("./request");module.exports=function(e,r){var t={};return util.strict(e,"string"),-1===e.indexOf("/")&&(e=urlhelper("/geocode/"+e+"/{query}.json",r&&r.accessToken)),t.getURL=function(){return e},t.queryURL=function(e){var r;if("string"!=typeof e){for(var n=[],u=0;u<e.length;u++)n[u]=encodeURIComponent(e[u]);r=n.join(";")}else r=encodeURIComponent(e);return feedback.record({geocoding:r}),L.Util.template(t.getURL(),{query:r})},t.query=function(e,r){return util.strict(r,"function"),request(t.queryURL(e),function(e,t){if(t&&(t.length||t.features)){var n={results:t};t.features&&t.features.length&&(n.latlng=[t.features[0].center[1],t.features[0].center[0]],t.features[0].bbox&&(n.bounds=t.features[0].bbox,n.lbounds=util.lbounds(n.bounds))),r(null,n)}else r(e||!0)}),t},t.reverseQuery=function(e,r){function n(e){return void 0!==e.lat&&void 0!==e.lng?e.lng+","+e.lat:void 0!==e.lat&&void 0!==e.lon?e.lon+","+e.lat:e[0]+","+e[1]}var u="";if(e.length&&e[0].length){for(var o=0,l=[];o<e.length;o++)l.push(n(e[o]));u=l.join(";")}else u=n(e);return request(t.queryURL(u),function(e,t){r(e,t)}),t},t}},{"./feedback":9,"./request":24,"./url":28,"./util":29}],11:[function(require,module,exports){"use strict";var geocoder=require("./geocoder"),util=require("./util"),GeocoderControl=L.Control.extend({includes:L.Mixin.Events,options:{position:"topleft",pointZoom:16,keepOpen:!1,autocomplete:!1},initialize:function(t,e){L.Util.setOptions(this,e),this.setURL(t),this._updateSubmit=L.bind(this._updateSubmit,this),this._updateAutocomplete=L.bind(this._updateAutocomplete,this),this._chooseResult=L.bind(this._chooseResult,this)},setURL:function(t){return this.geocoder=geocoder(t,{accessToken:this.options.accessToken}),this},getURL:function(){return this.geocoder.getURL()},setID:function(t){return this.setURL(t)},setTileJSON:function(t){return this.setURL(t.geocoder)},_toggle:function(t){t&&L.DomEvent.stop(t),L.DomUtil.hasClass(this._container,"active")?(L.DomUtil.removeClass(this._container,"active"),this._results.innerHTML="",this._input.blur()):(L.DomUtil.addClass(this._container,"active"),this._input.focus(),this._input.select())},_closeIfOpen:function(t){L.DomUtil.hasClass(this._container,"active")&&!this.options.keepOpen&&(L.DomUtil.removeClass(this._container,"active"),this._results.innerHTML="",this._input.blur())},onAdd:function(t){var e=L.DomUtil.create("div","leaflet-control-mapbox-geocoder leaflet-bar leaflet-control"),o=L.DomUtil.create("a","leaflet-control-mapbox-geocoder-toggle mapbox-icon mapbox-icon-geocoder",e),i=L.DomUtil.create("div","leaflet-control-mapbox-geocoder-results",e),s=L.DomUtil.create("div","leaflet-control-mapbox-geocoder-wrap",e),n=L.DomUtil.create("form","leaflet-control-mapbox-geocoder-form",s),r=L.DomUtil.create("input","",n);return o.href="#",o.innerHTML="&nbsp;",r.type="text",r.setAttribute("placeholder","Search"),L.DomEvent.addListener(n,"submit",this._geocode,this),L.DomEvent.addListener(r,"keyup",this._autocomplete,this),L.DomEvent.disableClickPropagation(e),this._map=t,this._results=i,this._input=r,this._form=n,this.options.keepOpen?L.DomUtil.addClass(e,"active"):(this._map.on("click",this._closeIfOpen,this),L.DomEvent.addListener(o,"click",this._toggle,this)),e},_updateSubmit:function(t,e){if(L.DomUtil.removeClass(this._container,"searching"),this._results.innerHTML="",t||!e)this.fire("error",{error:t});else{var o=[];e.results&&e.results.features&&(o=e.results.features),1===o.length?(this.fire("autoselect",{feature:o[0]}),this.fire("found",{results:e.results}),this._chooseResult(o[0]),this._closeIfOpen()):o.length>1?(this.fire("found",{results:e.results}),this._displayResults(o)):this._displayResults(o)}},_updateAutocomplete:function(t,e){if(this._results.innerHTML="",t||!e)this.fire("error",{error:t});else{var o=[];e.results&&e.results.features&&(o=e.results.features),o.length&&this.fire("found",{results:e.results}),this._displayResults(o)}},_displayResults:function(t){for(var e=0,o=Math.min(t.length,5);o>e;e++){var i=t[e],s=i.place_name;if(s.length){var n=L.DomUtil.create("a","",this._results),r="innerText"in n?"innerText":"textContent";n[r]=s,n.href="#",L.bind(function(t){L.DomEvent.addListener(n,"click",function(e){this._chooseResult(t),L.DomEvent.stop(e),this.fire("select",{feature:t})},this)},this)(i)}}if(t.length>5){var l=L.DomUtil.create("span","",this._results);l.innerHTML="Top 5 of "+t.length+"  results"}},_chooseResult:function(t){t.bbox?this._map.fitBounds(util.lbounds(t.bbox)):t.center&&this._map.setView([t.center[1],t.center[0]],void 0===this._map.getZoom()?this.options.pointZoom:Math.max(this._map.getZoom(),this.options.pointZoom))},_geocode:function(t){return L.DomEvent.preventDefault(t),""===this._input.value?this._updateSubmit():(L.DomUtil.addClass(this._container,"searching"),void this.geocoder.query(this._input.value,this._updateSubmit))},_autocomplete:function(t){return this.options.autocomplete?""===this._input.value?this._updateAutocomplete():void this.geocoder.query(this._input.value,this._updateAutocomplete):void 0}});module.exports.GeocoderControl=GeocoderControl,module.exports.geocoderControl=function(t,e){return new GeocoderControl(t,e)}},{"./geocoder":10,"./util":29}],12:[function(require,module,exports){"use strict";function utfDecode(t){return t>=93&&t--,t>=35&&t--,t-32}module.exports=function(t){return function(e,r){if(t){var u=utfDecode(t.grid[r].charCodeAt(e)),n=t.keys[u];return t.data[n]}}}},{}],13:[function(require,module,exports){"use strict";var util=require("./util"),Mustache=require("mustache"),GridControl=L.Control.extend({options:{pinnable:!0,follow:!1,sanitizer:require("sanitize-caja"),touchTeaser:!0,location:!0},_currentContent:"",_pinned:!1,initialize:function(t,o){L.Util.setOptions(this,o),util.strict_instance(t,L.Class,"L.mapbox.gridLayer"),this._layer=t},setTemplate:function(t){return util.strict(t,"string"),this.options.template=t,this},_template:function(t,o){if(o){var i=this.options.template||this._layer.getTileJSON().template;if(i){var e={};return e["__"+t+"__"]=!0,this.options.sanitizer(Mustache.to_html(i,L.extend(e,o)))}}},_show:function(t,o){t!==this._currentContent&&(this._currentContent=t,this.options.follow?(this._popup.setContent(t).setLatLng(o.latLng),this._map._popup!==this._popup&&this._popup.openOn(this._map)):(this._container.style.display="block",this._contentWrapper.innerHTML=t))},hide:function(){return this._pinned=!1,this._currentContent="",this._map.closePopup(),this._container.style.display="none",this._contentWrapper.innerHTML="",L.DomUtil.removeClass(this._container,"closable"),this},_mouseover:function(t){if(t.data?L.DomUtil.addClass(this._map._container,"map-clickable"):L.DomUtil.removeClass(this._map._container,"map-clickable"),!this._pinned){var o=this._template("teaser",t.data);o?this._show(o,t):this.hide()}},_mousemove:function(t){this._pinned||this.options.follow&&this._popup.setLatLng(t.latLng)},_navigateTo:function(t){window.top.location.href=t},_click:function(t){var o=this._template("location",t.data);if(this.options.location&&o&&0===o.search(/^https?:/))return this._navigateTo(this._template("location",t.data));if(this.options.pinnable){var i=this._template("full",t.data);!i&&this.options.touchTeaser&&L.Browser.touch&&(i=this._template("teaser",t.data)),i?(L.DomUtil.addClass(this._container,"closable"),this._pinned=!0,this._show(i,t)):this._pinned&&(L.DomUtil.removeClass(this._container,"closable"),this._pinned=!1,this.hide())}},_onPopupClose:function(){this._currentContent=null,this._pinned=!1},_createClosebutton:function(t,o){var i=L.DomUtil.create("a","close",t);return i.innerHTML="close",i.href="#",i.title="close",L.DomEvent.on(i,"click",L.DomEvent.stopPropagation).on(i,"mousedown",L.DomEvent.stopPropagation).on(i,"dblclick",L.DomEvent.stopPropagation).on(i,"click",L.DomEvent.preventDefault).on(i,"click",o,this),i},onAdd:function(t){this._map=t;var o="leaflet-control-grid map-tooltip",i=L.DomUtil.create("div",o),e=L.DomUtil.create("div","map-tooltip-content");return i.style.display="none",this._createClosebutton(i,this.hide),i.appendChild(e),this._contentWrapper=e,this._popup=new L.Popup({autoPan:!1,closeOnClick:!1}),t.on("popupclose",this._onPopupClose,this),L.DomEvent.disableClickPropagation(i).addListener(i,"mousewheel",L.DomEvent.stopPropagation),this._layer.on("mouseover",this._mouseover,this).on("mousemove",this._mousemove,this).on("click",this._click,this),i},onRemove:function(t){t.off("popupclose",this._onPopupClose,this),this._layer.off("mouseover",this._mouseover,this).off("mousemove",this._mousemove,this).off("click",this._click,this)}});module.exports.GridControl=GridControl,module.exports.gridControl=function(t,o){return new GridControl(t,o)}},{"./util":29,mustache:3,"sanitize-caja":4}],14:[function(require,module,exports){"use strict";var util=require("./util"),request=require("./request"),grid=require("./grid"),GridLayer=L.Class.extend({includes:[L.Mixin.Events,require("./load_tilejson")],options:{template:function(){return""}},_mouseOn:null,_tilejson:{},_cache:{},initialize:function(t,i){L.Util.setOptions(this,i),this._loadTileJSON(t)},_setTileJSON:function(t){return util.strict(t,"object"),L.extend(this.options,{grids:t.grids,minZoom:t.minzoom,maxZoom:t.maxzoom,bounds:t.bounds&&util.lbounds(t.bounds)}),this._tilejson=t,this._cache={},this._update(),this},getTileJSON:function(){return this._tilejson},active:function(){return!!(this._map&&this.options.grids&&this.options.grids.length)},addTo:function(t){return t.addLayer(this),this},onAdd:function(t){this._map=t,this._update(),this._map.on("click",this._click,this).on("mousemove",this._move,this).on("moveend",this._update,this)},onRemove:function(){this._map.off("click",this._click,this).off("mousemove",this._move,this).off("moveend",this._update,this)},getData:function(t,i){if(this.active()){var e=this._map,o=e.project(t.wrap()),s=256,n=4,a=Math.floor(o.x/s),h=Math.floor(o.y/s),r=e.options.crs.scale(e.getZoom())/s;return a=(a+r)%r,h=(h+r)%r,this._getTile(e.getZoom(),a,h,function(t){var e=Math.floor((o.x-a*s)/n),r=Math.floor((o.y-h*s)/n);i(t(e,r))}),this}},_click:function(t){this.getData(t.latlng,L.bind(function(i){this.fire("click",{latLng:t.latlng,data:i})},this))},_move:function(t){this.getData(t.latlng,L.bind(function(i){i!==this._mouseOn?(this._mouseOn&&this.fire("mouseout",{latLng:t.latlng,data:this._mouseOn}),this.fire("mouseover",{latLng:t.latlng,data:i}),this._mouseOn=i):this.fire("mousemove",{latLng:t.latlng,data:i})},this))},_getTileURL:function(t){var i=this.options.grids,e=(t.x+t.y)%i.length,o=i[e];return L.Util.template(o,t)},_update:function(){if(this.active()){var t=this._map.getPixelBounds(),i=this._map.getZoom(),e=256;if(!(i>this.options.maxZoom||i<this.options.minZoom))for(var o=L.bounds(t.min.divideBy(e)._floor(),t.max.divideBy(e)._floor()),s=this._map.options.crs.scale(i)/e,n=o.min.x;n<=o.max.x;n++)for(var a=o.min.y;a<=o.max.y;a++)this._getTile(i,(n%s+s)%s,(a%s+s)%s)}},_getTile:function(t,i,e,o){var s=t+"_"+i+"_"+e,n=L.point(i,e);if(n.z=t,this._tileShouldBeLoaded(n)){if(s in this._cache){if(!o)return;return void("function"==typeof this._cache[s]?o(this._cache[s]):this._cache[s].push(o))}this._cache[s]=[],o&&this._cache[s].push(o),request(this._getTileURL(n),L.bind(function(t,i){var e=this._cache[s];this._cache[s]=grid(i);for(var o=0;o<e.length;++o)e[o](this._cache[s])},this))}},_tileShouldBeLoaded:function(t){if(t.z>this.options.maxZoom||t.z<this.options.minZoom)return!1;if(this.options.bounds){var i=256,e=t.multiplyBy(i),o=e.add(new L.Point(i,i)),s=this._map.unproject(e),n=this._map.unproject(o),a=new L.LatLngBounds([s,n]);if(!this.options.bounds.intersects(a))return!1}return!0}});module.exports.GridLayer=GridLayer,module.exports.gridLayer=function(t,i){return new GridLayer(t,i)}},{"./grid":12,"./load_tilejson":19,"./request":24,"./util":29}],15:[function(require,module,exports){require("./leaflet"),require("./mapbox")},{"./leaflet":17,"./mapbox":21}],16:[function(require,module,exports){"use strict";var InfoControl=L.Control.extend({options:{position:"bottomright",sanitizer:require("sanitize-caja")},initialize:function(t){L.setOptions(this,t),this._info={},console.warn("infoControl has been deprecated and will be removed in mapbox.js v3.0.0. Use the default attribution control instead, which is now responsive.")},onAdd:function(t){this._container=L.DomUtil.create("div","mapbox-control-info mapbox-small"),this._content=L.DomUtil.create("div","map-info-container",this._container);var i=L.DomUtil.create("a","mapbox-info-toggle mapbox-icon mapbox-icon-info",this._container);i.href="#",L.DomEvent.addListener(i,"click",this._showInfo,this),L.DomEvent.disableClickPropagation(this._container);for(var n in t._layers)t._layers[n].getAttribution&&this.addInfo(t._layers[n].getAttribution());return t.on("layeradd",this._onLayerAdd,this).on("layerremove",this._onLayerRemove,this),this._update(),this._container},onRemove:function(t){t.off("layeradd",this._onLayerAdd,this).off("layerremove",this._onLayerRemove,this)},addInfo:function(t){return t?(this._info[t]||(this._info[t]=0),this._info[t]=!0,this._update()):this},removeInfo:function(t){return t?(this._info[t]&&(this._info[t]=!1),this._update()):this},_showInfo:function(t){return L.DomEvent.preventDefault(t),this._active===!0?this._hidecontent():(L.DomUtil.addClass(this._container,"active"),this._active=!0,void this._update())},_hidecontent:function(){this._content.innerHTML="",this._active=!1,L.DomUtil.removeClass(this._container,"active")},_update:function(){if(!this._map)return this;this._content.innerHTML="";var t="none",i=[];for(var n in this._info)this._info.hasOwnProperty(n)&&this._info[n]&&(i.push(this.options.sanitizer(n)),t="block");return this._content.innerHTML+=i.join(" | "),this._container.style.display=t,this},_onLayerAdd:function(t){t.layer.getAttribution&&t.layer.getAttribution()?this.addInfo(t.layer.getAttribution()):"on"in t.layer&&t.layer.getAttribution&&t.layer.on("ready",L.bind(function(){this.addInfo(t.layer.getAttribution())},this))},_onLayerRemove:function(t){t.layer.getAttribution&&this.removeInfo(t.layer.getAttribution())}});module.exports.InfoControl=InfoControl,module.exports.infoControl=function(t){return new InfoControl(t)}},{"sanitize-caja":4}],17:[function(require,module,exports){window.L=require("leaflet/dist/leaflet-src")},{"leaflet/dist/leaflet-src":2}],18:[function(require,module,exports){"use strict";var LegendControl=L.Control.extend({options:{position:"bottomright",sanitizer:require("sanitize-caja")},initialize:function(e){L.setOptions(this,e),this._legends={}},onAdd:function(e){return this._container=L.DomUtil.create("div","map-legends wax-legends"),L.DomEvent.disableClickPropagation(this._container),this._update(),this._container},addLegend:function(e){return e?(this._legends[e]||(this._legends[e]=0),this._legends[e]++,this._update()):this},removeLegend:function(e){return e?(this._legends[e]&&this._legends[e]--,this._update()):this},_update:function(){if(!this._map)return this;this._container.innerHTML="";var e="none";for(var t in this._legends)if(this._legends.hasOwnProperty(t)&&this._legends[t]){var n=L.DomUtil.create("div","map-legend wax-legend",this._container);n.innerHTML=this.options.sanitizer(t),e="block"}return this._container.style.display=e,this}});module.exports.LegendControl=LegendControl,module.exports.legendControl=function(e){return new LegendControl(e)}},{"sanitize-caja":4}],19:[function(require,module,exports){"use strict";var request=require("./request"),url=require("./url"),util=require("./util");module.exports={_loadTileJSON:function(e){"string"==typeof e?(e=url.tileJSON(e,this.options&&this.options.accessToken),request(e,L.bind(function(t,i){t?(util.log("could not load TileJSON at "+e),this.fire("error",{error:t})):i&&(this._setTileJSON(i),this.fire("ready"))},this))):e&&"object"==typeof e&&this._setTileJSON(e)}}},{"./request":24,"./url":28,"./util":29}],20:[function(require,module,exports){"use strict";function withAccessToken(t,o){return!o||t.accessToken?t:L.extend({accessToken:o},t)}var util=require("./util"),tileLayer=require("./tile_layer").tileLayer,featureLayer=require("./feature_layer").featureLayer,gridLayer=require("./grid_layer").gridLayer,gridControl=require("./grid_control").gridControl,infoControl=require("./info_control").infoControl,shareControl=require("./share_control").shareControl,legendControl=require("./legend_control").legendControl,mapboxLogoControl=require("./mapbox_logo").mapboxLogoControl,feedback=require("./feedback"),LMap=L.Map.extend({includes:[require("./load_tilejson")],options:{tileLayer:{},featureLayer:{},gridLayer:{},legendControl:{},gridControl:{},infoControl:!1,shareControl:!1,sanitizer:require("sanitize-caja")},_tilejson:{},initialize:function(t,o,e){if(L.Map.prototype.initialize.call(this,t,L.extend({},L.Map.prototype.options,e)),this.attributionControl){this.attributionControl.setPrefix("");var i=this.options.attributionControl.compact;(i||i!==!1&&this._container.offsetWidth<=640)&&L.DomUtil.addClass(this.attributionControl._container,"leaflet-compact-attribution"),void 0===i&&this.on("resize",function(){this._container.offsetWidth>640?L.DomUtil.removeClass(this.attributionControl._container,"leaflet-compact-attribution"):L.DomUtil.addClass(this.attributionControl._container,"leaflet-compact-attribution")})}this.options.tileLayer&&(this.tileLayer=tileLayer(void 0,withAccessToken(this.options.tileLayer,this.options.accessToken)),this.addLayer(this.tileLayer)),this.options.featureLayer&&(this.featureLayer=featureLayer(void 0,withAccessToken(this.options.featureLayer,this.options.accessToken)),this.addLayer(this.featureLayer)),this.options.gridLayer&&(this.gridLayer=gridLayer(void 0,withAccessToken(this.options.gridLayer,this.options.accessToken)),this.addLayer(this.gridLayer)),this.options.gridLayer&&this.options.gridControl&&(this.gridControl=gridControl(this.gridLayer,this.options.gridControl),this.addControl(this.gridControl)),this.options.infoControl&&(this.infoControl=infoControl(this.options.infoControl),this.addControl(this.infoControl)),this.options.legendControl&&(this.legendControl=legendControl(this.options.legendControl),this.addControl(this.legendControl)),this.options.shareControl&&(this.shareControl=shareControl(void 0,withAccessToken(this.options.shareControl,this.options.accessToken)),this.addControl(this.shareControl)),this._mapboxLogoControl=mapboxLogoControl(this.options.mapboxLogoControl),this.addControl(this._mapboxLogoControl),this._loadTileJSON(o),this.on("layeradd",this._onLayerAdd,this).on("layerremove",this._onLayerRemove,this).on("moveend",this._updateMapFeedbackLink,this),this.whenReady(function(){feedback.on("change",this._updateMapFeedbackLink,this)}),this.on("unload",function(){feedback.off("change",this._updateMapFeedbackLink,this)})},_setTileJSON:function(t){return this._tilejson=t,this._initialize(t),this},getTileJSON:function(){return this._tilejson},_initialize:function(t){if(this.tileLayer&&(this.tileLayer._setTileJSON(t),this._updateLayer(this.tileLayer)),this.featureLayer&&!this.featureLayer.getGeoJSON()&&t.data&&t.data[0]&&this.featureLayer.loadURL(t.data[0]),this.gridLayer&&(this.gridLayer._setTileJSON(t),this._updateLayer(this.gridLayer)),this.infoControl&&t.attribution&&(this.infoControl.addInfo(this.options.sanitizer(t.attribution)),this._updateMapFeedbackLink()),this.legendControl&&t.legend&&this.legendControl.addLegend(t.legend),this.shareControl&&this.shareControl._setTileJSON(t),this._mapboxLogoControl._setTileJSON(t),!this._loaded&&t.center){var o=void 0!==this.getZoom()?this.getZoom():t.center[2],e=L.latLng(t.center[1],t.center[0]);this.setView(e,o)}},_updateMapFeedbackLink:function(){if(this._controlContainer.getElementsByClassName){var t=this._controlContainer.getElementsByClassName("mapbox-improve-map");if(t.length&&this._loaded){var o=this.getCenter().wrap(),e=this._tilejson||{},i=e.id||"",n="#"+i+"/"+o.lng.toFixed(3)+"/"+o.lat.toFixed(3)+"/"+this.getZoom();for(var r in feedback.data)n+="/"+r+"="+feedback.data[r];for(var a=0;a<t.length;a++)t[a].hash=n}}},_onLayerAdd:function(t){"on"in t.layer&&t.layer.on("ready",this._onLayerReady,this),window.setTimeout(L.bind(this._updateMapFeedbackLink,this),0)},_onLayerRemove:function(t){"on"in t.layer&&t.layer.off("ready",this._onLayerReady,this),window.setTimeout(L.bind(this._updateMapFeedbackLink,this),0)},_onLayerReady:function(t){this._updateLayer(t.target)},_updateLayer:function(t){t.options&&(this.infoControl&&this._loaded&&this.infoControl.addInfo(t.options.infoControl),this.attributionControl&&this._loaded&&t.getAttribution&&this.attributionControl.addAttribution(t.getAttribution()),L.stamp(t)in this._zoomBoundLayers||!t.options.maxZoom&&!t.options.minZoom||(this._zoomBoundLayers[L.stamp(t)]=t),this._updateMapFeedbackLink(),this._updateZoomLevels())}});module.exports.Map=LMap,module.exports.map=function(t,o,e){return new LMap(t,o,e)}},{"./feature_layer":8,"./feedback":9,"./grid_control":13,"./grid_layer":14,"./info_control":16,"./legend_control":18,"./load_tilejson":19,"./mapbox_logo":22,"./share_control":25,"./tile_layer":27,"./util":29,"sanitize-caja":4}],21:[function(require,module,exports){"use strict";var geocoderControl=require("./geocoder_control"),gridControl=require("./grid_control"),featureLayer=require("./feature_layer"),legendControl=require("./legend_control"),shareControl=require("./share_control"),tileLayer=require("./tile_layer"),infoControl=require("./info_control"),map=require("./map"),gridLayer=require("./grid_layer");L.mapbox=module.exports={VERSION:require("../package.json").version,geocoder:require("./geocoder"),marker:require("./marker"),simplestyle:require("./simplestyle"),tileLayer:tileLayer.tileLayer,TileLayer:tileLayer.TileLayer,infoControl:infoControl.infoControl,InfoControl:infoControl.InfoControl,shareControl:shareControl.shareControl,ShareControl:shareControl.ShareControl,legendControl:legendControl.legendControl,LegendControl:legendControl.LegendControl,geocoderControl:geocoderControl.geocoderControl,GeocoderControl:geocoderControl.GeocoderControl,gridControl:gridControl.gridControl,GridControl:gridControl.GridControl,gridLayer:gridLayer.gridLayer,GridLayer:gridLayer.GridLayer,featureLayer:featureLayer.featureLayer,FeatureLayer:featureLayer.FeatureLayer,map:map.map,Map:map.Map,config:require("./config"),sanitize:require("sanitize-caja"),template:require("mustache").to_html,feedback:require("./feedback")},window.L.Icon.Default.imagePath=("https:"==document.location.protocol||"http:"==document.location.protocol?"":"https:")+"//api.tiles.mapbox.com/mapbox.js/v"+require("../package.json").version+"/images"},{"../package.json":6,"./config":7,"./feature_layer":8,"./feedback":9,"./geocoder":10,"./geocoder_control":11,"./grid_control":13,"./grid_layer":14,"./info_control":16,"./legend_control":18,"./map":20,"./marker":23,"./share_control":25,"./simplestyle":26,"./tile_layer":27,mustache:3,"sanitize-caja":4}],22:[function(require,module,exports){"use strict";var MapboxLogoControl=L.Control.extend({options:{position:"bottomleft"},initialize:function(o){L.setOptions(this,o)},onAdd:function(o){return this._container=L.DomUtil.create("div","mapbox-logo"),this._container},_setTileJSON:function(o){o.mapbox_logo&&L.DomUtil.addClass(this._container,"mapbox-logo-true")}});module.exports.MapboxLogoControl=MapboxLogoControl,module.exports.mapboxLogoControl=function(o){return new MapboxLogoControl(o)}},{}],23:[function(require,module,exports){"use strict";function icon(e,r){e=e||{};var i={small:[20,50],medium:[30,70],large:[35,90]},t=e["marker-size"]||"medium",o="marker-symbol"in e&&""!==e["marker-symbol"]?"-"+e["marker-symbol"]:"",s=(e["marker-color"]||"7e7e7e").replace("#","");return L.icon({iconUrl:url("/marker/pin-"+t.charAt(0)+o+"+"+s+(L.Browser.retina?"@2x":"")+".png",r&&r.accessToken),iconSize:i[t],iconAnchor:[i[t][0]/2,i[t][1]/2],popupAnchor:[0,-i[t][1]/2]})}function style(e,r,i){return L.marker(r,{icon:icon(e.properties,i),title:util.strip_tags(sanitize(e.properties&&e.properties.title||""))})}function createPopup(e,r){if(!e||!e.properties)return"";var i="";return e.properties.title&&(i+='<div class="marker-title">'+e.properties.title+"</div>"),e.properties.description&&(i+='<div class="marker-description">'+e.properties.description+"</div>"),(r||sanitize)(i)}var url=require("./url"),util=require("./util"),sanitize=require("sanitize-caja");module.exports={icon:icon,style:style,createPopup:createPopup}},{"./url":28,"./util":29,"sanitize-caja":4}],24:[function(require,module,exports){"use strict";var corslite=require("corslite"),strict=require("./util").strict,config=require("./config"),protocol=/^(https?:)?(?=\/\/(.|api)\.tiles\.mapbox\.com\/)/;module.exports=function(t,o){function r(t,r){!t&&r&&(r=JSON.parse(r.responseText)),o(t,r)}return strict(t,"string"),strict(o,"function"),t=t.replace(protocol,function(t,o){return"withCredentials"in new window.XMLHttpRequest?"https:"===o||"https:"===document.location.protocol||config.FORCE_HTTPS?"https:":"http:":document.location.protocol}),corslite(t,r)}},{"./config":7,"./util":29,corslite:1}],25:[function(require,module,exports){"use strict";var urlhelper=require("./url"),ShareControl=L.Control.extend({includes:[require("./load_tilejson")],options:{position:"topleft",url:""},initialize:function(t,e){L.setOptions(this,e),this._loadTileJSON(t)},_setTileJSON:function(t){this._tilejson=t},onAdd:function(t){this._map=t;var e=L.DomUtil.create("div","leaflet-control-mapbox-share leaflet-bar"),o=L.DomUtil.create("a","mapbox-share mapbox-icon mapbox-icon-share",e);return o.href="#",this._modal=L.DomUtil.create("div","mapbox-modal",this._map._container),this._mask=L.DomUtil.create("div","mapbox-modal-mask",this._modal),this._content=L.DomUtil.create("div","mapbox-modal-content",this._modal),L.DomEvent.addListener(o,"click",this._shareClick,this),L.DomEvent.disableClickPropagation(e),this._map.on("mousedown",this._clickOut,this),e},_clickOut:function(t){return this._sharing?(L.DomEvent.preventDefault(t),L.DomUtil.removeClass(this._modal,"active"),this._content.innerHTML="",void(this._sharing=null)):void 0},_shareClick:function(t){if(L.DomEvent.stop(t),this._sharing)return this._clickOut(t);var e=this._tilejson||this._map._tilejson||{},o=encodeURIComponent(this.options.url||e.webpage||window.location),i=encodeURIComponent(e.name),a=urlhelper("/"+e.id+"/"+this._map.getCenter().lng+","+this._map.getCenter().lat+","+this._map.getZoom()+"/600x600.png",this.options.accessToken),n=urlhelper("/"+e.id+".html",this.options.accessToken),s="//twitter.com/intent/tweet?status="+i+" "+o,r="//www.facebook.com/sharer.php?u="+o+"&t="+encodeURIComponent(e.name),l="//www.pinterest.com/pin/create/button/?url="+o+"&media="+a+"&description="+e.name,c="<h3>Share this map</h3><div class='mapbox-share-buttons'><a class='mapbox-button mapbox-button-icon mapbox-icon-facebook' target='_blank' href='{{facebook}}'>Facebook</a><a class='mapbox-button mapbox-button-icon mapbox-icon-twitter' target='_blank' href='{{twitter}}'>Twitter</a><a class='mapbox-button mapbox-button-icon mapbox-icon-pinterest' target='_blank' href='{{pinterest}}'>Pinterest</a></div>".replace("{{twitter}}",s).replace("{{facebook}}",r).replace("{{pinterest}}",l),m='<iframe width="100%" height="500px" frameBorder="0" src="{{embed}}"></iframe>'.replace("{{embed}}",n),h="Copy and paste this <strong>HTML code</strong> into documents to embed this map on web pages.";L.DomUtil.addClass(this._modal,"active"),this._sharing=L.DomUtil.create("div","mapbox-modal-body",this._content),this._sharing.innerHTML=c;var p=L.DomUtil.create("input","mapbox-embed",this._sharing);p.type="text",p.value=m;var d=L.DomUtil.create("label","mapbox-embed-description",this._sharing);d.innerHTML=h;var b=L.DomUtil.create("a","leaflet-popup-close-button",this._sharing);b.href="#",L.DomEvent.disableClickPropagation(this._sharing),L.DomEvent.addListener(b,"click",this._clickOut,this),L.DomEvent.addListener(p,"click",function(t){t.target.focus(),t.target.select()})}});module.exports.ShareControl=ShareControl,module.exports.shareControl=function(t,e){return new ShareControl(t,e)}},{"./load_tilejson":19,"./url":28}],26:[function(require,module,exports){"use strict";function fallback(t,l){var i={};for(var r in l)void 0===t[r]?i[r]=l[r]:i[r]=t[r];return i}function remap(t){for(var l={},i=0;i<mapping.length;i++)l[mapping[i][1]]=t[mapping[i][0]];return l}function style(t){return remap(fallback(t.properties||{},defaults))}var defaults={stroke:"#555555","stroke-width":2,"stroke-opacity":1,fill:"#555555","fill-opacity":.5},mapping=[["stroke","color"],["stroke-width","weight"],["stroke-opacity","opacity"],["fill","fillColor"],["fill-opacity","fillOpacity"]];module.exports={style:style,defaults:defaults}},{}],27:[function(require,module,exports){"use strict";var util=require("./util"),formatPattern=/\.((?:png|jpg)\d*)(?=$|\?)/,TileLayer=L.TileLayer.extend({includes:[require("./load_tilejson")],options:{sanitizer:require("sanitize-caja")},formats:["png","jpg","png32","png64","png128","png256","jpg70","jpg80","jpg90"],scalePrefix:"@2x.",initialize:function(t,i){L.TileLayer.prototype.initialize.call(this,void 0,i),this._tilejson={},i&&i.format&&util.strict_oneof(i.format,this.formats),this._loadTileJSON(t)},setFormat:function(t){return util.strict(t,"string"),this.options.format=t,this.redraw(),this},setUrl:null,_setTileJSON:function(t){return util.strict(t,"object"),this.options.format=this.options.format||t.tiles[0].match(formatPattern)[1],L.extend(this.options,{tiles:t.tiles,attribution:this.options.sanitizer(t.attribution),minZoom:t.minzoom||0,maxZoom:t.maxzoom||18,tms:"tms"===t.scheme,bounds:t.bounds&&util.lbounds(t.bounds)}),this._tilejson=t,this.redraw(),this},getTileJSON:function(){return this._tilejson},getTileUrl:function(t){var i=this.options.tiles,e=Math.floor(Math.abs(t.x+t.y)%i.length),o=i[e],r=L.Util.template(o,t);return r?r.replace(formatPattern,(L.Browser.retina?this.scalePrefix:".")+this.options.format):r},_update:function(){this.options.tiles&&L.TileLayer.prototype._update.call(this)}});module.exports.TileLayer=TileLayer,module.exports.tileLayer=function(t,i){return new TileLayer(t,i)}},{"./load_tilejson":19,"./util":29,"sanitize-caja":4}],28:[function(require,module,exports){"use strict";var config=require("./config"),version=require("../package.json").version;module.exports=function(e,o){if(o=o||L.mapbox.accessToken,!o&&config.REQUIRE_ACCESS_TOKEN)throw new Error("An API access token is required to use Mapbox.js. See https://www.mapbox.com/mapbox.js/api/v"+version+"/api-access-tokens/");var s="https:"===document.location.protocol||config.FORCE_HTTPS?config.HTTPS_URL:config.HTTP_URL;if(s+=e,s+=-1!==s.indexOf("?")?"&access_token=":"?access_token=",config.REQUIRE_ACCESS_TOKEN){if("s"===o[0])throw new Error("Use a public access token (pk.*) with Mapbox.js, not a secret access token (sk.*). See https://www.mapbox.com/mapbox.js/api/v"+version+"/api-access-tokens/");s+=o}return s},module.exports.tileJSON=function(e,o){if(-1!==e.indexOf("/"))return e;var s=module.exports("/"+e+".json",o);return 0===s.indexOf("https")&&(s+="&secure"),s}},{"../package.json":6,"./config":7}],29:[function(require,module,exports){"use strict";function contains(n,t){if(!t||!t.length)return!1;for(var r=0;r<t.length;r++)if(t[r]==n)return!0;return!1}module.exports={idUrl:function(n,t){-1==n.indexOf("/")?t.loadID(n):t.loadURL(n)},log:function(n){"object"==typeof console&&"function"==typeof console.error&&console.error(n)},strict:function(n,t){if(typeof n!==t)throw new Error("Invalid argument: "+t+" expected")},strict_instance:function(n,t,r){if(!(n instanceof t))throw new Error("Invalid argument: "+r+" expected")},strict_oneof:function(n,t){if(!contains(n,t))throw new Error("Invalid argument: "+n+" given, valid values are "+t.join(", "))},strip_tags:function(n){return n.replace(/<[^<]+>/g,"")},lbounds:function(n){return new L.LatLngBounds([[n[1],n[0]],[n[3],n[2]]])}}},{}]},{},[15]);define("mapbox",["css!vendor/mapbox.js/2.1.8/mapbox.css","src/packages/leafletGlobals"],function(global){return function(){var ret,fn;return ret||global.L}}(this));!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define("leaflet-image",[],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.leafletImage=e()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){var queue=require("./queue");module.exports=function leafletImage(map,callback){var dimensions=map.getSize(),layerQueue=new queue(1);var canvas=document.createElement("canvas");canvas.width=dimensions.x;canvas.height=dimensions.y;var ctx=canvas.getContext("2d");map.eachLayer(drawTileLayer);if(map._pathRoot)layerQueue.defer(handlePathRoot,map._pathRoot);map.eachLayer(drawMarkerLayer);layerQueue.awaitAll(layersDone);function drawTileLayer(l){if(l instanceof L.TileLayer)layerQueue.defer(handleTileLayer,l);else if(l._heat)layerQueue.defer(handlePathRoot,l._canvas)}function drawMarkerLayer(l){if(l instanceof L.Marker&&l.options.icon instanceof L.Icon){layerQueue.defer(handleMarkerLayer,l)}}function done(){callback(null,canvas)}function layersDone(err,layers){if(err)throw err;layers.forEach(function(layer){if(layer&&layer.canvas){ctx.drawImage(layer.canvas,0,0)}});done()}function handleTileLayer(layer,callback){var isCanvasLayer=layer instanceof L.TileLayer.Canvas,canvas=document.createElement("canvas");canvas.width=dimensions.x;canvas.height=dimensions.y;var ctx=canvas.getContext("2d"),bounds=map.getPixelBounds(),origin=map.getPixelOrigin(),zoom=map.getZoom(),tileSize=layer.options.tileSize;if(zoom>layer.options.maxZoom||zoom<layer.options.minZoom||layer.options.format&&!layer.options.tiles){return callback()}var offset=new L.Point((origin.x/tileSize-Math.floor(origin.x/tileSize))*tileSize,(origin.y/tileSize-Math.floor(origin.y/tileSize))*tileSize);var tileBounds=L.bounds(bounds.min.divideBy(tileSize)._floor(),bounds.max.divideBy(tileSize)._floor()),tiles=[],center=tileBounds.getCenter(),j,i,point,tileQueue=new queue(1);for(j=tileBounds.min.y;j<=tileBounds.max.y;j++){for(i=tileBounds.min.x;i<=tileBounds.max.x;i++){tiles.push(new L.Point(i,j))}}tiles.forEach(function(tilePoint){var originalTilePoint=tilePoint.clone();layer._adjustTilePoint(tilePoint);var tilePos=layer._getTilePos(originalTilePoint).subtract(bounds.min).add(origin);if(tilePoint.y>=0){if(isCanvasLayer){var tile=layer._tiles[tilePoint.x+":"+tilePoint.y];tileQueue.defer(canvasTile,tile,tilePos,tileSize)}else{var url=addCacheString(layer.getTileUrl(tilePoint));tileQueue.defer(loadTile,url,tilePos,tileSize)}}});tileQueue.awaitAll(tileQueueFinish);function canvasTile(tile,tilePos,tileSize,callback){callback(null,{img:tile,pos:tilePos,size:tileSize})}function loadTile(url,tilePos,tileSize,callback){var im=new Image;im.crossOrigin="";im.onload=function(){callback(null,{img:this,pos:tilePos,size:tileSize})};im.src=url}function tileQueueFinish(err,data){data.forEach(drawTile);callback(null,{canvas:canvas})}function drawTile(d){ctx.drawImage(d.img,Math.floor(d.pos.x),Math.floor(d.pos.y),d.size,d.size)}}function handlePathRoot(root,callback){var bounds=map.getPixelBounds(),origin=map.getPixelOrigin(),canvas=document.createElement("canvas");canvas.width=dimensions.x;canvas.height=dimensions.y;var ctx=canvas.getContext("2d");var pos=L.DomUtil.getPosition(root).subtract(bounds.min).add(origin);ctx.drawImage(root,pos.x,pos.y);callback(null,{canvas:canvas})}function handleMarkerLayer(marker,callback){var canvas=document.createElement("canvas"),ctx=canvas.getContext("2d"),pixelBounds=map.getPixelBounds(),minPoint=new L.Point(pixelBounds.min.x,pixelBounds.min.y),pixelPoint=map.project(marker.getLatLng()),url=addCacheString(marker._icon.src),im=new Image,options=marker.options.icon.options,size=options.iconSize,pos=pixelPoint.subtract(minPoint),anchor=L.point(options.iconAnchor||size&&size.divideBy(2,true)),x=pos.x-size[0]+anchor.x,y=pos.y-anchor.y;canvas.width=dimensions.x;canvas.height=dimensions.y;im.crossOrigin="";im.onload=function(){ctx.drawImage(this,x,y,size[0],size[1]);callback(null,{canvas:canvas})};im.src=url}function addCacheString(url){return url+(url.match(/\?/)?"&":"?")+"cache="+ +new Date}}},{"./queue":2}],2:[function(require,module,exports){(function(){if(typeof module==="undefined")self.queue=queue;else module.exports=queue;queue.version="1.0.4";var slice=[].slice;function queue(parallelism){var q,tasks=[],started=0,active=0,remaining=0,popping,error=null,await=noop,all;if(!parallelism)parallelism=Infinity;function pop(){while(popping=started<tasks.length&&active<parallelism){var i=started++,t=tasks[i],a=slice.call(t,1);a.push(callback(i));++active;t[0].apply(null,a)}}function callback(i){return function(e,r){--active;if(error!=null)return;if(e!=null){error=e;started=remaining=NaN;notify()}else{tasks[i]=r;if(--remaining)popping||pop();else notify()}}}function notify(){if(error!=null)await(error);else if(all)await(error,tasks);else await.apply(null,[error].concat(tasks))}return q={defer:function(){if(!error){tasks.push(arguments);++remaining;pop()}return q},await:function(f){await=f;all=false;if(!remaining)notify();return q},awaitAll:function(f){await=f;all=true;if(!remaining)notify();return q}}}function noop(){}})()},{}]},{},[1])(1)});define("css!vendor/leaflet.markercluster/0.4.0/dist/MarkerCluster.css",["css!vendor/leaflet.markercluster/0.4.0/dist/compiled.css"],function(){});define("css!vendor/leaflet.markercluster/0.4.0/dist/MarkerCluster.Default.css",["css!vendor/leaflet.markercluster/0.4.0/dist/compiled.css"],function(){});!function(t,e){L.MarkerClusterGroup=L.FeatureGroup.extend({options:{maxClusterRadius:80,iconCreateFunction:null,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,singleMarkerMode:!1,disableClusteringAtZoom:null,removeOutsideVisibleBounds:!0,animateAddingMarkers:!1,spiderfyDistanceMultiplier:1,polygonOptions:{}},initialize:function(t){L.Util.setOptions(this,t),this.options.iconCreateFunction||(this.options.iconCreateFunction=this._defaultIconCreateFunction),this._featureGroup=L.featureGroup(),this._featureGroup.on(L.FeatureGroup.EVENTS,this._propagateEvent,this),this._nonPointGroup=L.featureGroup(),this._nonPointGroup.on(L.FeatureGroup.EVENTS,this._propagateEvent,this),this._inZoomAnimation=0,this._needsClustering=[],this._needsRemoving=[],this._currentShownBounds=null,this._queue=[]},addLayer:function(t){if(t instanceof L.LayerGroup){var e=[];for(var i in t._layers)e.push(t._layers[i]);return this.addLayers(e)}if(!t.getLatLng)return this._nonPointGroup.addLayer(t),this;if(!this._map)return this._needsClustering.push(t),this;if(this.hasLayer(t))return this;this._unspiderfy&&this._unspiderfy(),this._addLayer(t,this._maxZoom);var n=t,s=this._map.getZoom();if(t.__parent)for(;n.__parent._zoom>=s;)n=n.__parent;return this._currentShownBounds.contains(n.getLatLng())&&(this.options.animateAddingMarkers?this._animationAddLayer(t,n):this._animationAddLayerNonAnimated(t,n)),this},removeLayer:function(t){if(t instanceof L.LayerGroup){var e=[];for(var i in t._layers)e.push(t._layers[i]);return this.removeLayers(e)}return t.getLatLng?this._map?t.__parent?(this._unspiderfy&&(this._unspiderfy(),this._unspiderfyLayer(t)),this._removeLayer(t,!0),this._featureGroup.hasLayer(t)&&(this._featureGroup.removeLayer(t),t.setOpacity&&t.setOpacity(1)),this):this:(!this._arraySplice(this._needsClustering,t)&&this.hasLayer(t)&&this._needsRemoving.push(t),this):(this._nonPointGroup.removeLayer(t),this)},addLayers:function(t){var e,i,n,s=this._map,r=this._featureGroup,o=this._nonPointGroup;for(e=0,i=t.length;i>e;e++)if(n=t[e],n.getLatLng){if(!this.hasLayer(n))if(s){if(this._addLayer(n,this._maxZoom),n.__parent&&2===n.__parent.getChildCount()){var a=n.__parent.getAllChildMarkers(),h=a[0]===n?a[1]:a[0];r.removeLayer(h)}}else this._needsClustering.push(n)}else o.addLayer(n);return s&&(r.eachLayer(function(t){t instanceof L.MarkerCluster&&t._iconNeedsUpdate&&t._updateIcon()}),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds)),this},removeLayers:function(t){var e,i,n,s=this._featureGroup,r=this._nonPointGroup;if(!this._map){for(e=0,i=t.length;i>e;e++)n=t[e],this._arraySplice(this._needsClustering,n),r.removeLayer(n);return this}for(e=0,i=t.length;i>e;e++)n=t[e],n.__parent?(this._removeLayer(n,!0,!0),s.hasLayer(n)&&(s.removeLayer(n),n.setOpacity&&n.setOpacity(1))):r.removeLayer(n);return this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds),s.eachLayer(function(t){t instanceof L.MarkerCluster&&t._updateIcon()}),this},clearLayers:function(){return this._map||(this._needsClustering=[],delete this._gridClusters,delete this._gridUnclustered),this._noanimationUnspiderfy&&this._noanimationUnspiderfy(),this._featureGroup.clearLayers(),this._nonPointGroup.clearLayers(),this.eachLayer(function(t){delete t.__parent}),this._map&&this._generateInitialClusters(),this},getBounds:function(){var t=new L.LatLngBounds;if(this._topClusterLevel)t.extend(this._topClusterLevel._bounds);else for(var e=this._needsClustering.length-1;e>=0;e--)t.extend(this._needsClustering[e].getLatLng());return t.extend(this._nonPointGroup.getBounds()),t},eachLayer:function(t,e){var i,n=this._needsClustering.slice();for(this._topClusterLevel&&this._topClusterLevel.getAllChildMarkers(n),i=n.length-1;i>=0;i--)t.call(e,n[i]);this._nonPointGroup.eachLayer(t,e)},getLayers:function(){var t=[];return this.eachLayer(function(e){t.push(e)}),t},getLayer:function(t){var e=null;return this.eachLayer(function(i){L.stamp(i)===t&&(e=i)}),e},hasLayer:function(t){if(!t)return!1;var e,i=this._needsClustering;for(e=i.length-1;e>=0;e--)if(i[e]===t)return!0;for(i=this._needsRemoving,e=i.length-1;e>=0;e--)if(i[e]===t)return!1;return!(!t.__parent||t.__parent._group!==this)||this._nonPointGroup.hasLayer(t)},zoomToShowLayer:function(t,e){var i=function(){if((t._icon||t.__parent._icon)&&!this._inZoomAnimation)if(this._map.off("moveend",i,this),this.off("animationend",i,this),t._icon)e();else if(t.__parent._icon){var n=function(){this.off("spiderfied",n,this),e()};this.on("spiderfied",n,this),t.__parent.spiderfy()}};t._icon&&this._map.getBounds().contains(t.getLatLng())?e():t.__parent._zoom<this._map.getZoom()?(this._map.on("moveend",i,this),this._map.panTo(t.getLatLng())):(this._map.on("moveend",i,this),this.on("animationend",i,this),this._map.setView(t.getLatLng(),t.__parent._zoom+1),t.__parent.zoomToBounds())},onAdd:function(t){this._map=t;var e,i,n;if(!isFinite(this._map.getMaxZoom()))throw"Map has no maxZoom specified";for(this._featureGroup.onAdd(t),this._nonPointGroup.onAdd(t),this._gridClusters||this._generateInitialClusters(),e=0,i=this._needsRemoving.length;i>e;e++)n=this._needsRemoving[e],this._removeLayer(n,!0);for(this._needsRemoving=[],e=0,i=this._needsClustering.length;i>e;e++)n=this._needsClustering[e],n.getLatLng?n.__parent||this._addLayer(n,this._maxZoom):this._featureGroup.addLayer(n);this._needsClustering=[],this._map.on("zoomend",this._zoomEnd,this),this._map.on("moveend",this._moveEnd,this),this._spiderfierOnAdd&&this._spiderfierOnAdd(),this._bindEvents(),this._zoom=this._map.getZoom(),this._currentShownBounds=this._getExpandedVisibleBounds(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds)},onRemove:function(t){t.off("zoomend",this._zoomEnd,this),t.off("moveend",this._moveEnd,this),this._unbindEvents(),this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim",""),this._spiderfierOnRemove&&this._spiderfierOnRemove(),this._hideCoverage(),this._featureGroup.onRemove(t),this._nonPointGroup.onRemove(t),this._featureGroup.clearLayers(),this._map=null},getVisibleParent:function(t){for(var e=t;e&&!e._icon;)e=e.__parent;return e||null},_arraySplice:function(t,e){for(var i=t.length-1;i>=0;i--)if(t[i]===e)return t.splice(i,1),!0},_removeLayer:function(t,e,i){var n=this._gridClusters,s=this._gridUnclustered,r=this._featureGroup,o=this._map;if(e)for(var a=this._maxZoom;a>=0&&s[a].removeObject(t,o.project(t.getLatLng(),a));a--);var h,_=t.__parent,u=_._markers;for(this._arraySplice(u,t);_&&(_._childCount--,!(_._zoom<0));)e&&_._childCount<=1?(h=_._markers[0]===t?_._markers[1]:_._markers[0],n[_._zoom].removeObject(_,o.project(_._cLatLng,_._zoom)),s[_._zoom].addObject(h,o.project(h.getLatLng(),_._zoom)),this._arraySplice(_.__parent._childClusters,_),_.__parent._markers.push(h),h.__parent=_.__parent,_._icon&&(r.removeLayer(_),i||r.addLayer(h))):(_._recalculateBounds(),i&&_._icon||_._updateIcon()),_=_.__parent;delete t.__parent},_isOrIsParent:function(t,e){for(;e;){if(t===e)return!0;e=e.parentNode}return!1},_propagateEvent:function(t){if(t.layer instanceof L.MarkerCluster){if(t.originalEvent&&this._isOrIsParent(t.layer._icon,t.originalEvent.relatedTarget))return;t.type="cluster"+t.type}this.fire(t.type,t)},_defaultIconCreateFunction:function(t){var e=t.getChildCount(),i=" marker-cluster-";return i+=10>e?"small":100>e?"medium":"large",new L.DivIcon({html:"<div><span>"+e+"</span></div>",className:"marker-cluster"+i,iconSize:new L.Point(40,40)})},_bindEvents:function(){var t=this._map,e=this.options.spiderfyOnMaxZoom,i=this.options.showCoverageOnHover,n=this.options.zoomToBoundsOnClick;(e||n)&&this.on("clusterclick",this._zoomOrSpiderfy,this),i&&(this.on("clustermouseover",this._showCoverage,this),this.on("clustermouseout",this._hideCoverage,this),t.on("zoomend",this._hideCoverage,this))},_zoomOrSpiderfy:function(t){var e=this._map;e.getMaxZoom()===e.getZoom()?this.options.spiderfyOnMaxZoom&&t.layer.spiderfy():this.options.zoomToBoundsOnClick&&t.layer.zoomToBounds(),t.originalEvent&&13===t.originalEvent.keyCode&&e._container.focus()},_showCoverage:function(t){var e=this._map;this._inZoomAnimation||(this._shownPolygon&&e.removeLayer(this._shownPolygon),t.layer.getChildCount()>2&&t.layer!==this._spiderfied&&(this._shownPolygon=new L.Polygon(t.layer.getConvexHull(),this.options.polygonOptions),e.addLayer(this._shownPolygon)))},_hideCoverage:function(){this._shownPolygon&&(this._map.removeLayer(this._shownPolygon),this._shownPolygon=null)},_unbindEvents:function(){var t=this.options.spiderfyOnMaxZoom,e=this.options.showCoverageOnHover,i=this.options.zoomToBoundsOnClick,n=this._map;(t||i)&&this.off("clusterclick",this._zoomOrSpiderfy,this),e&&(this.off("clustermouseover",this._showCoverage,this),this.off("clustermouseout",this._hideCoverage,this),n.off("zoomend",this._hideCoverage,this))},_zoomEnd:function(){this._map&&(this._mergeSplitClusters(),this._zoom=this._map._zoom,this._currentShownBounds=this._getExpandedVisibleBounds())},_moveEnd:function(){if(!this._inZoomAnimation){var t=this._getExpandedVisibleBounds();this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,this._zoom,t),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._map._zoom,t),this._currentShownBounds=t}},_generateInitialClusters:function(){var t=this._map.getMaxZoom(),e=this.options.maxClusterRadius;this.options.disableClusteringAtZoom&&(t=this.options.disableClusteringAtZoom-1),this._maxZoom=t,this._gridClusters={},this._gridUnclustered={};for(var i=t;i>=0;i--)this._gridClusters[i]=new L.DistanceGrid(e),this._gridUnclustered[i]=new L.DistanceGrid(e);this._topClusterLevel=new L.MarkerCluster(this,-1)},_addLayer:function(t,e){var i,n,s=this._gridClusters,r=this._gridUnclustered;for(this.options.singleMarkerMode&&(t.options.icon=this.options.iconCreateFunction({getChildCount:function(){return 1},getAllChildMarkers:function(){return[t]}}));e>=0;e--){i=this._map.project(t.getLatLng(),e);var o=s[e].getNearObject(i);if(o)return o._addChild(t),t.__parent=o,void 0;if(o=r[e].getNearObject(i)){var a=o.__parent;a&&this._removeLayer(o,!1);var h=new L.MarkerCluster(this,e,o,t);s[e].addObject(h,this._map.project(h._cLatLng,e)),o.__parent=h,t.__parent=h;var _=h;for(n=e-1;n>a._zoom;n--)_=new L.MarkerCluster(this,n,_),s[n].addObject(_,this._map.project(o.getLatLng(),n));for(a._addChild(_),n=e;n>=0&&r[n].removeObject(o,this._map.project(o.getLatLng(),n));n--);return}r[e].addObject(t,i)}this._topClusterLevel._addChild(t),t.__parent=this._topClusterLevel},_enqueue:function(t){this._queue.push(t),this._queueTimeout||(this._queueTimeout=setTimeout(L.bind(this._processQueue,this),300))},_processQueue:function(){for(var t=0;t<this._queue.length;t++)this._queue[t].call(this);this._queue.length=0,clearTimeout(this._queueTimeout),this._queueTimeout=null},_mergeSplitClusters:function(){this._processQueue(),this._zoom<this._map._zoom&&this._currentShownBounds.contains(this._getExpandedVisibleBounds())?(this._animationStart(),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,this._zoom,this._getExpandedVisibleBounds()),this._animationZoomIn(this._zoom,this._map._zoom)):this._zoom>this._map._zoom?(this._animationStart(),this._animationZoomOut(this._zoom,this._map._zoom)):this._moveEnd()},_getExpandedVisibleBounds:function(){if(!this.options.removeOutsideVisibleBounds)return this.getBounds();var t=this._map,e=t.getBounds(),i=e._southWest,n=e._northEast,s=L.Browser.mobile?0:Math.abs(i.lat-n.lat),r=L.Browser.mobile?0:Math.abs(i.lng-n.lng);return new L.LatLngBounds(new L.LatLng(i.lat-s,i.lng-r,!0),new L.LatLng(n.lat+s,n.lng+r,!0))},_animationAddLayerNonAnimated:function(t,e){if(e===t)this._featureGroup.addLayer(t);else if(2===e._childCount){e._addToMap();var i=e.getAllChildMarkers();this._featureGroup.removeLayer(i[0]),this._featureGroup.removeLayer(i[1])}else e._updateIcon()}}),L.MarkerClusterGroup.include(L.DomUtil.TRANSITION?{_animationStart:function(){this._map._mapPane.className+=" leaflet-cluster-anim",this._inZoomAnimation++},_animationEnd:function(){this._map&&(this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim","")),this._inZoomAnimation--,this.fire("animationend")},_animationZoomIn:function(t,e){var i,n=this._getExpandedVisibleBounds(),s=this._featureGroup;this._topClusterLevel._recursively(n,t,0,function(r){var o,a=r._latlng,h=r._markers;for(n.contains(a)||(a=null),r._isSingleParent()&&t+1===e?(s.removeLayer(r),r._recursivelyAddChildrenToMap(null,e,n)):(r.setOpacity(0),r._recursivelyAddChildrenToMap(a,e,n)),i=h.length-1;i>=0;i--)o=h[i],n.contains(o._latlng)||s.removeLayer(o)}),this._forceLayout(),this._topClusterLevel._recursivelyBecomeVisible(n,e),s.eachLayer(function(t){t instanceof L.MarkerCluster||!t._icon||t.setOpacity(1)}),this._topClusterLevel._recursively(n,t,e,function(t){t._recursivelyRestoreChildPositions(e)}),this._enqueue(function(){this._topClusterLevel._recursively(n,t,0,function(t){s.removeLayer(t),t.setOpacity(1)}),this._animationEnd()})},_animationZoomOut:function(t,e){this._animationZoomOutSingle(this._topClusterLevel,t-1,e),this._topClusterLevel._recursivelyAddChildrenToMap(null,e,this._getExpandedVisibleBounds()),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,t,this._getExpandedVisibleBounds())},_animationZoomOutSingle:function(t,e,i){var n=this._getExpandedVisibleBounds();t._recursivelyAnimateChildrenInAndAddSelfToMap(n,e+1,i);var s=this;this._forceLayout(),t._recursivelyBecomeVisible(n,i),this._enqueue(function(){if(1===t._childCount){var r=t._markers[0];r.setLatLng(r.getLatLng()),r.setOpacity(1)}else t._recursively(n,i,0,function(t){t._recursivelyRemoveChildrenFromMap(n,e+1)});s._animationEnd()})},_animationAddLayer:function(t,e){var i=this,n=this._featureGroup;n.addLayer(t),e!==t&&(e._childCount>2?(e._updateIcon(),this._forceLayout(),this._animationStart(),t._setPos(this._map.latLngToLayerPoint(e.getLatLng())),t.setOpacity(0),this._enqueue(function(){n.removeLayer(t),t.setOpacity(1),i._animationEnd()})):(this._forceLayout(),i._animationStart(),i._animationZoomOutSingle(e,this._map.getMaxZoom(),this._map.getZoom())))},_forceLayout:function(){L.Util.falseFn(e.body.offsetWidth)}}:{_animationStart:function(){},_animationZoomIn:function(t,e){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,t),this._topClusterLevel._recursivelyAddChildrenToMap(null,e,this._getExpandedVisibleBounds())},_animationZoomOut:function(t,e){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,t),this._topClusterLevel._recursivelyAddChildrenToMap(null,e,this._getExpandedVisibleBounds())},_animationAddLayer:function(t,e){this._animationAddLayerNonAnimated(t,e)}}),L.markerClusterGroup=function(t){return new L.MarkerClusterGroup(t)},L.MarkerCluster=L.Marker.extend({initialize:function(t,e,i,n){L.Marker.prototype.initialize.call(this,i?i._cLatLng||i.getLatLng():new L.LatLng(0,0),{icon:this}),this._group=t,this._zoom=e,this._markers=[],this._childClusters=[],this._childCount=0,this._iconNeedsUpdate=!0,this._bounds=new L.LatLngBounds,i&&this._addChild(i),n&&this._addChild(n)},getAllChildMarkers:function(t){t=t||[];for(var e=this._childClusters.length-1;e>=0;e--)this._childClusters[e].getAllChildMarkers(t);for(var i=this._markers.length-1;i>=0;i--)t.push(this._markers[i]);return t},getChildCount:function(){return this._childCount},zoomToBounds:function(){for(var t,e=this._childClusters.slice(),i=this._group._map,n=i.getBoundsZoom(this._bounds),s=this._zoom+1,r=i.getZoom();e.length>0&&n>s;){s++;var o=[];for(t=0;t<e.length;t++)o=o.concat(e[t]._childClusters);e=o}n>s?this._group._map.setView(this._latlng,s):r>=n?this._group._map.setView(this._latlng,r+1):this._group._map.fitBounds(this._bounds)},getBounds:function(){var t=new L.LatLngBounds;return t.extend(this._bounds),t},_updateIcon:function(){this._iconNeedsUpdate=!0,this._icon&&this.setIcon(this)},createIcon:function(){return this._iconNeedsUpdate&&(this._iconObj=this._group.options.iconCreateFunction(this),this._iconNeedsUpdate=!1),this._iconObj.createIcon()},createShadow:function(){return this._iconObj.createShadow()},_addChild:function(t,e){this._iconNeedsUpdate=!0,this._expandBounds(t),t instanceof L.MarkerCluster?(e||(this._childClusters.push(t),t.__parent=this),this._childCount+=t._childCount):(e||this._markers.push(t),this._childCount++),this.__parent&&this.__parent._addChild(t,!0)},_expandBounds:function(t){var e,i=t._wLatLng||t._latlng;t instanceof L.MarkerCluster?(this._bounds.extend(t._bounds),e=t._childCount):(this._bounds.extend(i),e=1),this._cLatLng||(this._cLatLng=t._cLatLng||i);var n=this._childCount+e;this._wLatLng?(this._wLatLng.lat=(i.lat*e+this._wLatLng.lat*this._childCount)/n,this._wLatLng.lng=(i.lng*e+this._wLatLng.lng*this._childCount)/n):this._latlng=this._wLatLng=new L.LatLng(i.lat,i.lng)},_addToMap:function(t){t&&(this._backupLatlng=this._latlng,this.setLatLng(t)),this._group._featureGroup.addLayer(this)},_recursivelyAnimateChildrenIn:function(t,e,i){this._recursively(t,0,i-1,function(t){var i,n,s=t._markers;for(i=s.length-1;i>=0;i--)n=s[i],n._icon&&(n._setPos(e),n.setOpacity(0))},function(t){var i,n,s=t._childClusters;for(i=s.length-1;i>=0;i--)n=s[i],n._icon&&(n._setPos(e),n.setOpacity(0))})},_recursivelyAnimateChildrenInAndAddSelfToMap:function(t,e,i){this._recursively(t,i,0,function(n){n._recursivelyAnimateChildrenIn(t,n._group._map.latLngToLayerPoint(n.getLatLng()).round(),e),n._isSingleParent()&&e-1===i?(n.setOpacity(1),n._recursivelyRemoveChildrenFromMap(t,e)):n.setOpacity(0),n._addToMap()})},_recursivelyBecomeVisible:function(t,e){this._recursively(t,0,e,null,function(t){t.setOpacity(1)})},_recursivelyAddChildrenToMap:function(t,e,i){this._recursively(i,-1,e,function(n){if(e!==n._zoom)for(var s=n._markers.length-1;s>=0;s--){var r=n._markers[s];i.contains(r._latlng)&&(t&&(r._backupLatlng=r.getLatLng(),r.setLatLng(t),r.setOpacity&&r.setOpacity(0)),n._group._featureGroup.addLayer(r))}},function(e){e._addToMap(t)})},_recursivelyRestoreChildPositions:function(t){for(var e=this._markers.length-1;e>=0;e--){var i=this._markers[e];i._backupLatlng&&(i.setLatLng(i._backupLatlng),delete i._backupLatlng)}if(t-1===this._zoom)for(var n=this._childClusters.length-1;n>=0;n--)this._childClusters[n]._restorePosition();else for(var s=this._childClusters.length-1;s>=0;s--)this._childClusters[s]._recursivelyRestoreChildPositions(t)},_restorePosition:function(){this._backupLatlng&&(this.setLatLng(this._backupLatlng),delete this._backupLatlng)},_recursivelyRemoveChildrenFromMap:function(t,e,i){var n,s;this._recursively(t,-1,e-1,function(t){for(s=t._markers.length-1;s>=0;s--)n=t._markers[s],i&&i.contains(n._latlng)||(t._group._featureGroup.removeLayer(n),n.setOpacity&&n.setOpacity(1))},function(t){for(s=t._childClusters.length-1;s>=0;s--)n=t._childClusters[s],i&&i.contains(n._latlng)||(t._group._featureGroup.removeLayer(n),n.setOpacity&&n.setOpacity(1))})},_recursively:function(t,e,i,n,s){var r,o,a=this._childClusters,h=this._zoom;if(e>h)for(r=a.length-1;r>=0;r--)o=a[r],t.intersects(o._bounds)&&o._recursively(t,e,i,n,s);else if(n&&n(this),s&&this._zoom===i&&s(this),i>h)for(r=a.length-1;r>=0;r--)o=a[r],t.intersects(o._bounds)&&o._recursively(t,e,i,n,s)},_recalculateBounds:function(){var t,e=this._markers,i=this._childClusters;for(this._bounds=new L.LatLngBounds,delete this._wLatLng,t=e.length-1;t>=0;t--)this._expandBounds(e[t]);for(t=i.length-1;t>=0;t--)this._expandBounds(i[t])},_isSingleParent:function(){return this._childClusters.length>0&&this._childClusters[0]._childCount===this._childCount}}),L.DistanceGrid=function(t){this._cellSize=t,this._sqCellSize=t*t,this._grid={},this._objectPoint={}},L.DistanceGrid.prototype={addObject:function(t,e){var i=this._getCoord(e.x),n=this._getCoord(e.y),s=this._grid,r=s[n]=s[n]||{},o=r[i]=r[i]||[],a=L.Util.stamp(t);this._objectPoint[a]=e,o.push(t)},updateObject:function(t,e){this.removeObject(t),this.addObject(t,e)},removeObject:function(t,e){var i,n,s=this._getCoord(e.x),r=this._getCoord(e.y),o=this._grid,a=o[r]=o[r]||{},h=a[s]=a[s]||[];for(delete this._objectPoint[L.Util.stamp(t)],i=0,n=h.length;n>i;i++)if(h[i]===t)return h.splice(i,1),1===n&&delete a[s],!0},eachObject:function(t,e){var i,n,s,r,o,a,h,_=this._grid;for(i in _){o=_[i];for(n in o)for(a=o[n],s=0,r=a.length;r>s;s++)h=t.call(e,a[s]),h&&(s--,r--)}},getNearObject:function(t){var e,i,n,s,r,o,a,h,_=this._getCoord(t.x),u=this._getCoord(t.y),l=this._objectPoint,d=this._sqCellSize,p=null;for(e=u-1;u+1>=e;e++)if(s=this._grid[e])for(i=_-1;_+1>=i;i++)if(r=s[i])for(n=0,o=r.length;o>n;n++)a=r[n],h=this._sqDist(l[L.Util.stamp(a)],t),d>h&&(d=h,p=a);return p},_getCoord:function(t){return Math.floor(t/this._cellSize)},_sqDist:function(t,e){var i=e.x-t.x,n=e.y-t.y;return i*i+n*n}},function(){L.QuickHull={getDistant:function(t,e){var i=e[1].lat-e[0].lat,n=e[0].lng-e[1].lng;return n*(t.lat-e[0].lat)+i*(t.lng-e[0].lng)},findMostDistantPointFromBaseLine:function(t,e){var i,n,s,r=0,o=null,a=[];for(i=e.length-1;i>=0;i--)n=e[i],s=this.getDistant(n,t),s>0&&(a.push(n),s>r&&(r=s,o=n));return{maxPoint:o,newPoints:a}},buildConvexHull:function(t,e){var i=[],n=this.findMostDistantPointFromBaseLine(t,e);return n.maxPoint?(i=i.concat(this.buildConvexHull([t[0],n.maxPoint],n.newPoints)),i=i.concat(this.buildConvexHull([n.maxPoint,t[1]],n.newPoints))):[t[0]]},getConvexHull:function(t){var e,i=!1,n=!1,s=null,r=null;for(e=t.length-1;e>=0;e--){var o=t[e];(i===!1||o.lat>i)&&(s=o,i=o.lat),(n===!1||o.lat<n)&&(r=o,n=o.lat)}var a=[].concat(this.buildConvexHull([r,s],t),this.buildConvexHull([s,r],t));return a}}}(),L.MarkerCluster.include({getConvexHull:function(){var t,e,i=this.getAllChildMarkers(),n=[];for(e=i.length-1;e>=0;e--)t=i[e].getLatLng(),n.push(t);return L.QuickHull.getConvexHull(n)}}),L.MarkerCluster.include({_2PI:2*Math.PI,_circleFootSeparation:25,_circleStartAngle:Math.PI/6,_spiralFootSeparation:28,_spiralLengthStart:11,_spiralLengthFactor:5,_circleSpiralSwitchover:9,spiderfy:function(){if(this._group._spiderfied!==this&&!this._group._inZoomAnimation){var t,e=this.getAllChildMarkers(),i=this._group,n=i._map,s=n.latLngToLayerPoint(this._latlng);this._group._unspiderfy(),this._group._spiderfied=this,e.length>=this._circleSpiralSwitchover?t=this._generatePointsSpiral(e.length,s):(s.y+=10,t=this._generatePointsCircle(e.length,s)),this._animationSpiderfy(e,t)}},unspiderfy:function(t){this._group._inZoomAnimation||(this._animationUnspiderfy(t),this._group._spiderfied=null)},_generatePointsCircle:function(t,e){var i,n,s=this._group.options.spiderfyDistanceMultiplier*this._circleFootSeparation*(2+t),r=s/this._2PI,o=this._2PI/t,a=[];for(a.length=t,i=t-1;i>=0;i--)n=this._circleStartAngle+i*o,a[i]=new L.Point(e.x+r*Math.cos(n),e.y+r*Math.sin(n))._round();return a},_generatePointsSpiral:function(t,e){var i,n=this._group.options.spiderfyDistanceMultiplier*this._spiralLengthStart,s=this._group.options.spiderfyDistanceMultiplier*this._spiralFootSeparation,r=this._group.options.spiderfyDistanceMultiplier*this._spiralLengthFactor,o=0,a=[];for(a.length=t,i=t-1;i>=0;i--)o+=s/n+5e-4*i,a[i]=new L.Point(e.x+n*Math.cos(o),e.y+n*Math.sin(o))._round(),n+=this._2PI*r/o;return a},_noanimationUnspiderfy:function(){var t,e,i=this._group,n=i._map,s=i._featureGroup,r=this.getAllChildMarkers();for(this.setOpacity(1),e=r.length-1;e>=0;e--)t=r[e],s.removeLayer(t),t._preSpiderfyLatlng&&(t.setLatLng(t._preSpiderfyLatlng),delete t._preSpiderfyLatlng),t.setZIndexOffset&&t.setZIndexOffset(0),t._spiderLeg&&(n.removeLayer(t._spiderLeg),delete t._spiderLeg);i._spiderfied=null}}),L.MarkerCluster.include(L.DomUtil.TRANSITION?{SVG_ANIMATION:function(){return e.createElementNS("http://www.w3.org/2000/svg","animate").toString().indexOf("SVGAnimate")>-1}(),_animationSpiderfy:function(t,i){var n,s,r,o,a=this,h=this._group,_=h._map,u=h._featureGroup,l=_.latLngToLayerPoint(this._latlng);for(n=t.length-1;n>=0;n--)s=t[n],s.setOpacity?(s.setZIndexOffset(1e6),s.setOpacity(0),u.addLayer(s),s._setPos(l)):u.addLayer(s);h._forceLayout(),h._animationStart();var d=L.Path.SVG?0:.3,p=L.Path.SVG_NS;for(n=t.length-1;n>=0;n--)if(o=_.layerPointToLatLng(i[n]),s=t[n],s._preSpiderfyLatlng=s._latlng,s.setLatLng(o),s.setOpacity&&s.setOpacity(1),r=new L.Polyline([a._latlng,o],{weight:1.5,color:"#222",opacity:d}),_.addLayer(r),s._spiderLeg=r,L.Path.SVG&&this.SVG_ANIMATION){var c=r._path.getTotalLength();r._path.setAttribute("stroke-dasharray",c+","+c);var m=e.createElementNS(p,"animate");m.setAttribute("attributeName","stroke-dashoffset"),m.setAttribute("begin","indefinite"),m.setAttribute("from",c),m.setAttribute("to",0),m.setAttribute("dur",.25),r._path.appendChild(m),m.beginElement(),m=e.createElementNS(p,"animate"),m.setAttribute("attributeName","stroke-opacity"),m.setAttribute("attributeName","stroke-opacity"),m.setAttribute("begin","indefinite"),m.setAttribute("from",0),m.setAttribute("to",.5),m.setAttribute("dur",.25),r._path.appendChild(m),m.beginElement()}if(a.setOpacity(.3),L.Path.SVG)for(this._group._forceLayout(),n=t.length-1;n>=0;n--)s=t[n]._spiderLeg,s.options.opacity=.5,s._path.setAttribute("stroke-opacity",.5);setTimeout(function(){h._animationEnd(),h.fire("spiderfied")},200)},_animationUnspiderfy:function(t){var e,i,n,s=this._group,r=s._map,o=s._featureGroup,a=t?r._latLngToNewLayerPoint(this._latlng,t.zoom,t.center):r.latLngToLayerPoint(this._latlng),h=this.getAllChildMarkers(),_=L.Path.SVG&&this.SVG_ANIMATION;for(s._animationStart(),this.setOpacity(1),i=h.length-1;i>=0;i--)e=h[i],e._preSpiderfyLatlng&&(e.setLatLng(e._preSpiderfyLatlng),delete e._preSpiderfyLatlng,e.setOpacity?(e._setPos(a),e.setOpacity(0)):o.removeLayer(e),_&&(n=e._spiderLeg._path.childNodes[0],n.setAttribute("to",n.getAttribute("from")),n.setAttribute("from",0),n.beginElement(),n=e._spiderLeg._path.childNodes[1],n.setAttribute("from",.5),n.setAttribute("to",0),n.setAttribute("stroke-opacity",0),n.beginElement(),e._spiderLeg._path.setAttribute("stroke-opacity",0)));setTimeout(function(){var t=0;for(i=h.length-1;i>=0;i--)e=h[i],e._spiderLeg&&t++;for(i=h.length-1;i>=0;i--)e=h[i],e._spiderLeg&&(e.setOpacity&&(e.setOpacity(1),e.setZIndexOffset(0)),t>1&&o.removeLayer(e),r.removeLayer(e._spiderLeg),delete e._spiderLeg);s._animationEnd()},200)}}:{_animationSpiderfy:function(t,e){var i,n,s,r,o=this._group,a=o._map,h=o._featureGroup;for(i=t.length-1;i>=0;i--)r=a.layerPointToLatLng(e[i]),n=t[i],n._preSpiderfyLatlng=n._latlng,n.setLatLng(r),n.setZIndexOffset&&n.setZIndexOffset(1e6),h.addLayer(n),s=new L.Polyline([this._latlng,r],{weight:1.5,color:"#222"}),a.addLayer(s),n._spiderLeg=s;this.setOpacity(.3),o.fire("spiderfied")},_animationUnspiderfy:function(){this._noanimationUnspiderfy()}}),L.MarkerClusterGroup.include({_spiderfied:null,_spiderfierOnAdd:function(){this._map.on("click",this._unspiderfyWrapper,this),this._map.options.zoomAnimation&&this._map.on("zoomstart",this._unspiderfyZoomStart,this),this._map.on("zoomend",this._noanimationUnspiderfy,this),L.Path.SVG&&!L.Browser.touch&&this._map._initPathRoot()},_spiderfierOnRemove:function(){this._map.off("click",this._unspiderfyWrapper,this),this._map.off("zoomstart",this._unspiderfyZoomStart,this),this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._unspiderfy()},_unspiderfyZoomStart:function(){this._map&&this._map.on("zoomanim",this._unspiderfyZoomAnim,this)},_unspiderfyZoomAnim:function(t){L.DomUtil.hasClass(this._map._mapPane,"leaflet-touching")||(this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._unspiderfy(t))},_unspiderfyWrapper:function(){this._unspiderfy()},_unspiderfy:function(t){this._spiderfied&&this._spiderfied.unspiderfy(t)},_noanimationUnspiderfy:function(){this._spiderfied&&this._spiderfied._noanimationUnspiderfy()},_unspiderfyLayer:function(t){t._spiderLeg&&(this._featureGroup.removeLayer(t),t.setOpacity(1),t.setZIndexOffset(0),this._map.removeLayer(t._spiderLeg),delete t._spiderLeg)}})}(window,document);define("leaflet-markercluster",["mapbox","css!vendor/leaflet.markercluster/0.4.0/dist/MarkerCluster.css","css!vendor/leaflet.markercluster/0.4.0/dist/MarkerCluster.Default.css"],function(){});define("src/packages/leaflet",["mapbox","leaflet-image","leaflet-markercluster"],function(leafletLib,leafletImage){"use strict";leafletLib.leafletImage=leafletImage;return leafletLib});define("src/extensions/locations/mapProviderHelper",["src/helpers/appSettingsHelper","src/extensions/locations/mapboxMapIdProvider","src/packages/leaflet"],function(appSettingsHelper,mapboxMapIdProvider,leaflet){"use strict";var mapboxMapId=mapboxMapIdProvider.getMapId();var mapProviderData=appSettingsHelper.get("mapProvider")||{};var providerName=mapProviderData.name||"osm";var accessToken=mapProviderData.accessToken;var dataForProvider=getDataForProvider(providerName,accessToken);var providerUrlTemplate=dataForProvider.urlTemplate;var providerAttributionString=dataForProvider.attributionString;function getDataForProvider(name,accessToken){var FORMAT="png";if(name==="mapbox"){return{urlTemplate:"//api.tiles.mapbox.com/v4/".concat(mapboxMapId,"/{z}/{x}/{y}.").concat(FORMAT,"?access_token=").concat(accessToken),attributionString:" Mapbox  OpenStreetMap"}}if(name==="osm"){return{urlTemplate:"//{s}.tile.openstreetmap.org/{z}/{x}/{y}.".concat(FORMAT),attributionString:'Map data  <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'}}}return{MIN_ZOOM_LEVEL:2,MAX_ZOOM_LEVEL:20,getTileLayerOptions:function getTileLayerOptions(){return{minZoom:this.MIN_ZOOM_LEVEL,maxZoom:this.MAX_ZOOM_LEVEL,attribution:this.getAttributionString()}},getUrlTemplate:function getUrlTemplate(){return providerUrlTemplate},getGeocoderControl:function getGeocoderControl(){if(providerName==="mapbox"){leaflet.mapbox.accessToken=accessToken;return leaflet.mapbox.geocoderControl("mapbox.places",{autocomplete:true})}},getAttributionString:function getAttributionString(){return providerAttributionString},getGeocoder:function getGeocoder(){if(providerName==="osm"){return function(searchText,callback){require(["geosearch"],function(geosearch){var provider=new geosearch.OpenStreetMapProvider;provider.search({query:searchText}).then(function(result){return callback(null,[Number(result[0].y),Number(result[0].x)])}).catch(callback)})}}if(providerName==="mapbox"){leaflet.mapbox.accessToken=accessToken;var mapboxGeocoder=leaflet.mapbox.geocoder("mapbox.places");return function(searchText,callback){mapboxGeocoder.query(searchText,function(error,result){if(error){return callback(error)}callback(null,result.latlng)})}}}}});define("src/views/LeafletMapView",["backbone","underscore","jquery","src/extensions/locations/mapProviderHelper","src/packages/leaflet","src/packages/spin"],function(Backbone,_,$,mapProviderHelper,leaflet){"use strict";return Backbone.View.extend({initialize:function initialize(options){var height=this.height=options.height;if(!_.isNumber(height)){throw new Error("LeafletMapView must be initialized with a height")}this.geocoder=mapProviderHelper.getGeocoder()},remove:function remove(){this.container=undefined;Backbone.View.prototype.remove.call(this)},render:function render(){if(!this.map){var containerId=this.containerId=_.uniqueId("leafletMap"),container=this.container=$("<div/>",{id:containerId,className:"leafletMapContainer",height:this.height+"px",width:this.width+"px"});this.$el.html(container.spin())}},mapNotAvailable:function mapNotAvailable(reason){this.$el.html("<h3>Unable to render the map</h3><p>"+reason+"</p>")},createMap:function createMap(location){var self=this;if(!location){return this.mapNotAvailable("A location was not supplied.")}self.getLatLng(location,function(error,latLng){if(error||!latLng){self.container.remove();return}self.map=leaflet.map(self.containerId,{scrollWheelZoom:false,center:latLng,zoom:10});leaflet.tileLayer(mapProviderHelper.getUrlTemplate(),mapProviderHelper.getTileLayerOptions()).addTo(self.map);self.marker=leaflet.marker(latLng);self.marker.addTo(self.map);self.container.spin(false)})},getLatLng:function getLatLng(searchText,callback){return this.geocoder(searchText,callback)}})});(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==="object"&&typeof module==="object")module.exports=factory(require("underscore"),require("twitter-text"));else if(typeof define==="function"&&define.amd)define("bw-fe-helpers/autoLinkHelper",["underscore","twitter-text"],factory);else{var a=typeof exports==="object"?factory(require("underscore"),require("twitter-text")):factory(root["underscore"],root["twitter-text"]);for(var i in a)(typeof exports==="object"?exports:root)[i]=a[i]}})(this,function(__WEBPACK_EXTERNAL_MODULE__1__,__WEBPACK_EXTERNAL_MODULE__3__){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=15)}({1:function(module,exports){module.exports=__WEBPACK_EXTERNAL_MODULE__1__},15:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var underscore__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1);var underscore__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(underscore__WEBPACK_IMPORTED_MODULE_0__);var twitter_text__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3);var twitter_text__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(twitter_text__WEBPACK_IMPORTED_MODULE_1__);var ORIGINAL_MENTION_REGEX=twitter_text__WEBPACK_IMPORTED_MODULE_1___default.a.regexen.validMentionOrList;var INSTAGRAM_MENTION_REGEX=twitter_text__WEBPACK_IMPORTED_MODULE_1___default.a.regexSupplant("(#{validMentionPrecedingChars})"+"(#{atSigns})"+"([a-zA-Z0-9_.]{1,30})"+"(/[a-zA-Z][a-zA-Z0-9_-]{0,24})?","g");__webpack_exports__["default"]={textContent:function textContent(text,options){options=underscore__WEBPACK_IMPORTED_MODULE_0___default.a.defaults({},options,{targetBlank:true,htmlEscapeNonEntities:true});return twitter_text__WEBPACK_IMPORTED_MODULE_1___default.a.autoLinkUrlsCustom(text,options)},twitterContent:function twitterContent(text,options){options=underscore__WEBPACK_IMPORTED_MODULE_0___default.a.defaults({},options,{targetBlank:true,usernameClass:"tweet-url username twitter-username",htmlEscapeNonEntities:true,usernameIncludeSymbol:true});if(options.urlEntities&&options.urlEntities.length){underscore__WEBPACK_IMPORTED_MODULE_0___default()(options.urlEntities).each(function(entity){text=text.replace(entity.display_url,entity.url)})}return twitter_text__WEBPACK_IMPORTED_MODULE_1___default.a.autoLink(text,options)},instagramContent:function instagramContent(text,options){if(!text){return text}options=underscore__WEBPACK_IMPORTED_MODULE_0___default.a.defaults({},options,{targetBlank:true,usernameClass:"js-instagram-mention-url username instagram-username",hashtagClass:"js-instagram-mention-url hashtag instagram-hashtag",htmlEscapeNonEntities:true,usernameIncludeSymbol:true,hashtagUrlBase:"https://instagram.com/explore/tags/",usernameUrlBase:"https://instagram.com/"});twitter_text__WEBPACK_IMPORTED_MODULE_1___default.a.regexen.validMentionOrList=INSTAGRAM_MENTION_REGEX;var linkedText=twitter_text__WEBPACK_IMPORTED_MODULE_1___default.a.autoLink(text,options);twitter_text__WEBPACK_IMPORTED_MODULE_1___default.a.regexen.validMentionOrList=ORIGINAL_MENTION_REGEX;return linkedText}}},3:function(module,exports){module.exports=__WEBPACK_EXTERNAL_MODULE__3__}})["default"]});define("mustache!src/components/mentions/_mentionsprofile/templates/twitter",["lib/mustache"],function(mustache){var escapedTemplate='<h1 class="popuptitletext singlemargin-bottom">Twitter Profile</h1>\n{{^authenticated}}\n<div class="twitterLoginContainer hint-info">\n<div class="infoMessage">Please authenticate with Twitter to see this Twitter profile.</div>\n<div class="singlemargin-top">\n<a class="dib social-button social-button--twitter twitter-login">\n<span class="icon-bwtwitter smallpadding-right"></span>Authenticate with Twitter\n</a>\n</div>\n</div>\n{{/authenticated}}\n{{#authenticated}}\n<section class="profileView">\n<header class="doublemargin-bottom singlepadding relative">\n<h1 class="textcenter">Loading profile for @{{username}}...</h1>\n</header>\n<div class="profileData absbottom overflow-vertical pagemargin-bottom pagemargin-rigth">\n{{#canSeeMentions}}\n<h2 class="subtitletext smallmargin-bottom">Latest tweet</h2>\n<div class="latestTweet pagemargin-bottom"></div>\n{{/canSeeMentions}}\n\n<h2 class="subtitletext smallmargin-bottom">Twitter Statistics</h2>\n<div class="twitterStatistics pagemargin-bottom"></div>\n\n<h2 class="subtitletext smallmargin-bottom locationTitle">Location</h2>\n<div class="location pagemargin-bottom"></div>\n</div>\n</section>\n{{/authenticated}}\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/components/mentions/_mentionsprofile/templates/twitterTable",["lib/mustache"],function(mustache){var escapedTemplate='<table summary="Twitter metrics for @{{username}}">\n<tbody>\n<tr>\n<td>Tweets</td>\n<td class="metric">{{tweetCount}}</td>\n</tr>\n<tr>\n<td>Following</td>\n<td class="metric">{{followingCount}}</td>\n</tr>\n<tr>\n<td>Followers</td>\n<td class="metric">{{followersCount}}</td>\n</tr>\n<tr>\n<td>Listed</td>\n<td class="metric">{{listedCount}}</td>\n</tr>\n<tr>\n<td>Favourites</td>\n<td class="metric">{{favouritesCount}}</td>\n</tr>\n<tr>\n<td>Joined</td>\n<td class="metric">{{joined}}</td>\n</tr>\n<tr>\n<td>Retweeted (last 100 tweets)</td>\n<td class="metric">{{retweets}}</td>\n</tr>\n<tbody>\n</table>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/components/mentions/_mentionsprofile/templates/twitterHeader",["lib/mustache"],function(mustache){var escapedTemplate='<a class="customtip" target="_blank" href="http://twitter.com/{{username}}" title="Open Profile on Twitter (in new window)"><img class="avatar floatleft rounded singlemargin-right" src="{{avatar}}"/></a>\n<div class="floatleft">\n<h1 class="biggertext floatleft"><a class="customtip" target="_blank" href="http://twitter.com/{{username}}" title="Open Profile on Twitter (in new window)">{{name}}</a></h1>\n<h2 class="dib smallpadding-left"><a class="mentionUrl customtip" target="_blank" href="http://twitter.com/{{username}}" title="Open Profile on Twitter (in new window)">@{{username}}</a></h2>\n{{#bio}}\n<p class="twitter-bio db sixcolmax">{{{bio}}}</p>\n{{/bio}}\n</div>\n<p class="follow-button absbottom singlemargin-bottom">\n<a class="twitter-follow-button" href="https://twitter.com/intent/follow?screen_name={{username}}" title="Follow @{{username}} on Twitter" target="_blank">\n<span class="twitter-follow-button-icon"></span>\n<span class="twitter-follow-button-label">Follow @{{username}}</span>\n</a>\n</p>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/components/mentions/templates/mentionTweetIntents",["lib/mustache"],function(mustache){var escapedTemplate='<div class="twitterIntents dib">\n<a href="https://twitter.com/intent/tweet?in_reply_to={{tweetId}}" target="_blank" data-tip-position="bottom" title="Reply on Twitter" class="reply floatleft customtip nowrap">\n<span class="twitter-icons icon-bwtwitter-reply"></span>\n<span class="action-text">Reply</span>\n</a>\n<a href="https://twitter.com/intent/retweet?tweet_id={{tweetId}}" target="_blank" data-tip-position="bottom" title="Retweet on Twitter" class="retweet floatleft customtip nowrap">\n<span class="twitter-icons icon-bwtwitter-retweet"></span>\n<span class="action-text">Retweet</span>\n</a>\n<a href="https://twitter.com/intent/favorite?tweet_id={{tweetId}}" target="_blank" data-tip-position="bottom" title="Like on Twitter" class="favourite floatleft customtip nowrap">\n<span class="twitter-icons icon-bwtwitter-like"></span>\n<span class="action-text">Like</span>\n</a>\n{{#showEngageOption}}\n<a href="#" title="Other engagement options" class="engage floatleft customtip nowrap">\n<span class="icon-share-alt"></span>\n<span class="action-text">Engage</span>\n</a>\n{{/showEngageOption}}\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/components/mentions/_mentionsprofile/css/mentionsprofile.css",["css!src/components/mentions/_mentionsprofile/css/compiled.css"],function(){});define("css!src/components/mentions/css/mentionTweetIntents.css",["css!src/components/mentions/css/compiled.css"],function(){});define("src/components/mentions/_mentionsprofile/views/TwitterProfileView",["async","backbone","underscore","jquery","moment","src/permissions","src/globals/currentDashboard","src/views/LeafletMapView","bw-fe-helpers/autoLinkHelper","mustache!src/components/mentions/_mentionsprofile/templates/twitter","mustache!src/components/mentions/_mentionsprofile/templates/twitterTable","mustache!src/components/mentions/_mentionsprofile/templates/twitterHeader","mustache!src/components/mentions/templates/mentionTweetIntents","src/helpers/twitterApiHelper","src/analytics/Analytics","src/packages/spin","src/packages/customtip","css!src/components/mentions/_mentionsprofile/css/mentionsprofile.css","css!src/components/mentions/css/mentionTweetIntents.css","css!css/socialButtons.css"],function(async,Backbone,_,$,moment,permissions,currentDashboard,LeafletMapView,autoLinkHelper,twitterTemplate,twitterTableTemplate,twitterHeaderTemplate,mentionTweetIntents,twitterApiHelper,Analytics){"use strict";var TwitterProfileView;var UNABLE_TO_FETCH_DATA="unable to fetch data";var TWITTER_INVALID_TOKEN_CODE=89;function getMetric(model,metric,formatter){var fetchMsg="fetching...";if(model.fetching){return fetchMsg}if(model.fetchFailed){return UNABLE_TO_FETCH_DATA}if(!formatter){return model.get(metric)}return formatter(model.get(metric))}function trackTwitterProfileView(username){Analytics.trackEvent({name:"Miscellaneous.Twitter_Profile_View",action:"Show",origin:"Application",values:{username:username}})}function isInvalidTokenError(err){if(!err||err.status!==401||!err.responseJSON){return false}return err.responseJSON.code===TWITTER_INVALID_TOKEN_CODE}return TwitterProfileView=Backbone.View.extend({className:"twitterProfileView",events:{"click .twitter-login":"onTwitterLogin"},initialize:function initialize(options){var username=this.username=options.username;if(!username){throw new Error("TwitterProfileView must be instantiated with options.username")}this.twitterUserDataModel=new Backbone.Model({username:username});this.twitterTimelineDataModel=new Backbone.Model({username:username});this.twitterUserDataFetchStatus={};this.twitterTimelineDataFetchStatus={};this.leafletMapView=new LeafletMapView({height:400,width:568});this.twitterUserDataModel.bind("change:location",this.onLocationChanged,this);this.twitterUserDataModel.bind("change",this.onTwitterUserDataChanged,this);this.twitterTimelineDataModel.bind("change",this.onTwitterTimelineDataChanged,this)},renderHeader:function renderHeader(){var twitterUserData=this.twitterUserDataModel.toJSON();var enhancedBio;if(twitterUserData.description){enhancedBio=autoLinkHelper.twitterContent(twitterUserData.description)}this.$("header").html(twitterHeaderTemplate({name:twitterUserData.name,username:twitterUserData.username,bio:enhancedBio,avatar:twitterUserData.profile_image_url_https})).customtip()},renderTwitterMetrics:function renderTwitterMetrics(){var twitterUserData=this.twitterUserDataModel;var timelineData=this.twitterTimelineDataModel;var html=twitterTableTemplate({tweetCount:getMetric(twitterUserData,"statuses_count"),followingCount:getMetric(twitterUserData,"friends_count"),followersCount:getMetric(twitterUserData,"followers_count"),listedCount:getMetric(twitterUserData,"listed_count"),favouritesCount:getMetric(twitterUserData,"favourites_count"),joined:getMetric(twitterUserData,"created_at",function(dateStr){var formatted;try{formatted=moment(dateStr,"ddd MMM DD HH:mm:ss Z YYYY").tz(currentDashboard.getTimezone()).format("Do MMMM YYYY")}catch(e){}return formatted||dateStr}),retweets:getMetric(timelineData,"retweetsForLastHundredTweets")},false);this.$(".twitterStatistics").spin(false).html(html)},renderTimeLineData:function renderTimeLineData(){var timelineData=this.twitterTimelineDataModel.toJSON();var latestTweet="<p>"+autoLinkHelper.twitterContent(timelineData.text)+"</p>";if(permissions.check("see.engagement.twitterIntents",currentDashboard)){latestTweet+=mentionTweetIntents({tweetId:timelineData.id_str},false)}this.$(".latestTweet").spin(false).html(latestTweet).customtip()},renderMap:function renderMap(location){if(location){this.$(".location").prepend($('<h4 class="locationName"/>').text(location))}this.leafletMapView.createMap(location)},renderTwitterLoginButton:function renderTwitterLoginButton(){this.$el.html(twitterTemplate({authenticated:false}));this.$el.fitToContent();this.$el.centreModal()},render:function render(){var self=this;twitterApiHelper.getLoginStatus(function(err,authenticated){if(!authenticated){return self.renderTwitterLoginButton()}trackTwitterProfileView(self.username);self.$el.html(twitterTemplate({username:self.username,authenticated:true,canSeeMentions:permissions.check("see.mentions")}));self.getTwitterData();self.$(".location").append(self.leafletMapView.el);self.leafletMapView.render();self.$(".twitterStatistics,.latestTweet").spin();self.$el.fitToWindow();self.$el.centreModal()})},getTwitterData:function getTwitterData(){var self=this;var twitterOptions={screen_name:escape(this.twitterUserDataModel.get("username"))};async.parallel([function(callback){twitterApiHelper.get("users/show.json",twitterOptions,function(err,data){self.twitterUserDataModel.fetching=false;if(isInvalidTokenError(err)){return callback(new Error("Unauthorised"))}if(err){self.twitterUserDataModel.fetchFailed=true;self.showTwitterUserDataError();self.leafletMapView.remove();self.$(".location").prepend($('<h4 class="locationName"/>').text("Unable to determine the user's location."));return callback()}self.twitterUserDataModel.set(data);callback()})},function(callback){twitterApiHelper.get("statuses/user_timeline.json",{screen_name:escape(self.twitterTimelineDataModel.get("username")),count:100,trim_user:true},function(err,data){self.twitterTimelineDataModel.fetching=false;if(isInvalidTokenError(err)){return callback(new Error("Unauthorised"))}if(err){self.twitterTimelineDataModel.fetchFailed=true;self.showTwitterTimelineDataError();return callback()}var twitterTimelineData=data[0];if(data){twitterTimelineData.retweetsForLastHundredTweets=_.reduce(data,function(memoizer,value){return memoizer+value.retweet_count},0)}self.twitterTimelineDataModel.set(twitterTimelineData);callback()})}],function(err){if(err){self.renderTwitterLoginButton()}})},onTwitterLogin:function onTwitterLogin(){var self=this;twitterApiHelper.login(function(err){if(err){return}self.render()})},onLocationChanged:function onLocationChanged(model,location){this.renderMap(location)},onTwitterUserDataChanged:function onTwitterUserDataChanged(){this.renderHeader();this.renderTwitterMetrics()},onTwitterTimelineDataChanged:function onTwitterTimelineDataChanged(){this.renderTimeLineData();this.renderTwitterMetrics()},showTwitterUserDataError:function showTwitterUserDataError(){this.$("header").html("<h1>We could not fetch the Twitter profile for @"+this.username+" due to an error connecting to Twitter</h1>").addClass("error");this.renderTwitterMetrics()},showTwitterTimelineDataError:function showTwitterTimelineDataError(){this.renderTwitterMetrics();this.$(".latestTweet").spin(false).html("We were unable to fetch data from Twitter.")}},{show:function show(username){var view=new TwitterProfileView({username:username});view.$el.showModal({draggable:".twitterProfileView > h1",className:"popup standardpopup",maxWidth:564,maxHeight:720});view.render();return view}})});define("src/views/ContextMenuView",["backbone","jquery","jquery.showRelativeTo"],function(Backbone,$){"use strict";var menu,onCloseCallback;return Backbone.View.extend({checkDefaultActionConditions:function checkDefaultActionConditions(options){return!!options.openDefault},remove:function remove(){menu=undefined;this.$el.removeRelativeTo();this.trigger("remove");return Backbone.View.prototype.remove.apply(this,arguments)},isShown:function isShown(){return!!menu}},{show:function show(options){var ViewClass=this;options=options||{};onCloseCallback=options.onClose||$.noop;if(!options.$target){throw new Error("options.$target must be set")}if(menu&&menu.$target.is(options.$target)){ViewClass.hide();return}ViewClass.hide();menu=new ViewClass(options);menu.$target=options.$target;if(menu.checkDefaultActionConditions(options)){menu.performDefaultAction();return}menu.render();menu.$el.showRelativeTo({target:options.$target,targetOffset:options.targetOffset,position:menu.position,onRemove:function onRemove(){ViewClass.hide()}});menu.on("remove",function(){$("body").off("click.contextMenu");menu=null;onCloseCallback()});setTimeout(function(){$("body").on("click.contextMenu",function(){ViewClass.hide()})},0);return menu},hide:function hide(){if(menu){menu.remove();menu=null}}})});define("src/components/mentions/_mentionsprofile/models/JsonpModel",["backbone","underscore"],function(Backbone,_){"use strict";return Backbone.Model.extend({fetch:function fetch(options){options=options||{};if(!options.error){return Backbone.Model.prototype.fetch.call(this,options)}var self=this,timeout=options.timeout||5e3,timeoutId=setTimeout(function(){options.error.call(this,"timeout")},timeout),oldSuccess=options.success;options.success=function(model,res){clearTimeout(timeoutId);if(_.isFunction(oldSuccess)){oldSuccess.call(self,model,res)}};return Backbone.Model.prototype.fetch.call(this,options)}})});define("src/components/mentions/_mentionsprofile/models/FacebookProfileData",["backbone","underscore","src/components/mentions/_mentionsprofile/models/JsonpModel"],function(Backbone,_,JsonpModel){"use strict";function buildFql(url){return'select total_count,like_count,comment_count,share_count,click_count from link_stat where url="'+escape(url)+'"'}return JsonpModel.extend({url:function url(){return"https://api.facebook.com/method/fql.query?query="+buildFql(this.mentionUrl)+"&format=json&output=jsonp&callback=?"},initialize:function initialize(options){if(!_.isString(options.mentionUrl)){throw new Error("FacebookProfileData must be initialized with a mentionUrl")}this.mentionUrl=options.mentionUrl},parse:function parse(response){if(_.isArray(response)){if(response.length){return response[0]}return null}return Backbone.Model.prototype.parse.call(this,response)}})});define("mustache!src/components/mentions/_mentionsprofile/templates/popularity",["lib/mustache"],function(mustache){var escapedTemplate='<a class="twitter-share-button" href="https://twitter.com/intent/tweet?url={{mentionUrl}}&via=twitterapi" target="_blank">\n<span class="icon-twitter"></span>\n<span class="action-text">Tweet</span>\n</a>\n<table summary="Popularity of {{mentionUrl}} on various Social Networks">\n<thead>\n</thead>\n<tbody>\n<tr class="facebook">\n<td>Facebook</td>\n<td class="metric" data-metric="likes">{{likes}}</td>\n</tr>\n<tr class="facebook">\n<td>Facebook</td>\n<td class="metric" data-metric="comments">{{comments}}</td>\n</tr>\n<tr class="facebook">\n<td>Facebook</td>\n<td class="metric" data-metric="shares">{{shares}}</td>\n</tr>\n</tbody>\n<tfoot>\n</tfoot>\n</table>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/components/mentions/_mentionsprofile/views/PopularityView",["backbone","underscore","jquery","src/components/mentions/_mentionsprofile/models/FacebookProfileData","mustache!src/components/mentions/_mentionsprofile/templates/popularity","src/packages/spin"],function(Backbone,_,$,FacebookProfileData,popularityTemplate,spin){"use strict";function formatMetric(name,total){return total+" "+(total===1?name:name+"s")}return Backbone.View.extend({className:"popularityView",initialize:function initialize(options){var mentionUrl=this.mentionUrl=options.mentionUrl;this.facebookProfileDataModel=new FacebookProfileData({mentionUrl:mentionUrl});this.listenTo(this.facebookProfileDataModel,"change",this.onFacebookModelChange)},render:function render(){var html=$(popularityTemplate({mentionUrl:this.mentionUrl,escapedUrl:escape(this.mentionUrl)})),self=this,spinnerOptions=_.extend({},spin.defaults,{left:80,top:2});html.find(".metric").spin(spinnerOptions);this.$el.html(html);this.facebookProfileDataModel.fetch({error:function error(){self.updateCell(".facebook .metric","Could not fetch data from Facebook").addClass("error")}})},onFacebookModelChange:function onFacebookModelChange(){var fbModel=this.facebookProfileDataModel,likes=fbModel.get("like_count"),comments=fbModel.get("comment_count"),shares=fbModel.get("share_count");this.updateCell('.facebook .metric[data-metric="likes"]',formatMetric("like",likes));this.updateCell('.facebook .metric[data-metric="comments"]',formatMetric("comment",comments));this.updateCell('.facebook .metric[data-metric="shares"]',formatMetric("share",shares))},updateCell:function updateCell(selector,text){var target=this.$(selector),spinner=target.find(".spinner");if(spinner.length!==0){spinner.remove()}target.text(text);return target}})});(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==="object"&&typeof module==="object")module.exports=factory();else if(typeof define==="function"&&define.amd)define("bw-fe-helpers/facebookLocales",[],factory);else{var a=factory();for(var i in a)(typeof exports==="object"?exports:root)[i]=a[i]}})(this,function(){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=23)}({23:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_exports__["default"]={ar_AR:"Arabic",az_AZ:"Azerbaijani",be_BY:"Belarusian",bg_BG:"Bulgarian",bn_IN:"Bengali",bs_BA:"Bosnian",ca_ES:"Catalan",cs_CZ:"Czech",cy_GB:"Welsh",da_DK:"Danish",de_DE:"German",el_GR:"Greek",en_GB:"English (UK)",en_PI:"English (Pirate)",en_UD:"English (Upside Down)",en_US:"English (US)",eo_EO:"Esperanto",es_ES:"Spanish (Spain)",es_LA:"Spanish",et_EE:"Estonian",eu_ES:"Basque",fa_IR:"Persian",fb_LT:"Leet Speak",fi_FI:"Finnish",fo_FO:"Faroese",fr_CA:"French (Canada)",fr_FR:"French (France)",fy_NL:"Frisian",ga_IE:"Irish",gl_ES:"Galician",he_IL:"Hebrew",hi_IN:"Hindi",hr_HR:"Croatian",hu_HU:"Hungarian",hy_AM:"Armenian",id_ID:"Indonesian",is_IS:"Icelandic",it_IT:"Italian",ja_JP:"Japanese",ka_GE:"Georgian",km_KH:"Khmer",ko_KR:"Korean",ku_TR:"Kurdish",la_VA:"Latin",lt_LT:"Lithuanian",lv_LV:"Latvian",mk_MK:"Macedonian",ml_IN:"Malayalam",ms_MY:"Malay",nb_NO:"Norwegian (bokmal)",ne_NP:"Nepali",nl_NL:"Dutch",nn_NO:"Norwegian (nynorsk)",pa_IN:"Punjabi",pl_PL:"Polish",ps_AF:"Pashto",pt_BR:"Portuguese (Brazil)",pt_PT:"Portuguese (Portugal)",ro_RO:"Romanian",ru_RU:"Russian",sk_SK:"Slovak",sl_SI:"Slovenian",sq_AL:"Albanian",sr_RS:"Serbian",sv_SE:"Swedish",sw_KE:"Swahili",ta_IN:"Tamil",te_IN:"Telugu",th_TH:"Thai",tl_PH:"Filipino",tr_TR:"Turkish",uk_UA:"Ukrainian",vi_VN:"Vietnamese",zh_CN:"Simplified Chinese (China)",zh_HK:"Traditional Chinese (Hong Kong)",zh_TW:"Traditional Chinese (Taiwan)"}}})["default"]});define("src/components/mentions/_mentionsprofile/models/FacebookUserData",["backbone","underscore","src/components/mentions/_mentionsprofile/models/JsonpModel","bw-fe-helpers/facebookLocales","src/helpers/FB"],function(Backbone,_,JsonpModel,facebookLocales,FB){"use strict";function getUserId(mentionUrl){var matchparts;if(mentionUrl.indexOf("permalink.php")>-1||mentionUrl.indexOf("photo.php")>-1){if(mentionUrl.indexOf("&id=")>-1){matchparts=mentionUrl.match(/(&|\?)id=([\d]+)/);if(matchparts.length>1){return matchparts[2]}}if(mentionUrl.indexOf("fbid=")>-1){matchparts=mentionUrl.match(/(&|\?)fbid=([\d]+)/);if(matchparts.length>1){return matchparts[2]}}}if(mentionUrl.indexOf("/posts/")>-1){matchparts=mentionUrl.split("/");if(matchparts.length>2){return matchparts[3]}}throw new Error("FacebookUserData could not extract user id from mentionUrl: "+mentionUrl)}return JsonpModel.extend({url:function url(){return"https://graph.facebook.com/v2.3/"+this.userId+"?access_token="+FB.getAccessToken()+"&callback=?"},initialize:function initialize(options){var mentionUrl=options.mentionUrl,authorId=options.authorId;if(!_.isString(mentionUrl)){throw new Error("FacebookProfileData must be initialized with a mentionUrl")}if(authorId){this.userId=authorId}else{this.mentionUrl=mentionUrl;this.userId=getUserId(mentionUrl)}},parse:function parse(response){if(response.error){return{error:{code:response.error.code,message:response.error.message}}}if(facebookLocales[response.locale]){response.locale=facebookLocales[response.locale]}return Backbone.Model.prototype.parse.call(this,response)}})});define("mustache!src/components/mentions/_mentionsprofile/templates/facebookTable",["lib/mustache"],function(mustache){var escapedTemplate='<table summary="Facebook user metrics">\n{{#items}}\n<tr>\n<td>{{title}}</td>\n<td class="metric">{{{value}}}</td>\n</tr>\n{{/items}}\n</table>';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/components/mentions/_mentionsprofile/views/FacebookUserView",["backbone","underscore","jquery","src/components/mentions/_mentionsprofile/models/FacebookUserData","mustache!src/components/mentions/_mentionsprofile/templates/facebookTable","src/packages/spin"],function(Backbone,_,$,FacebookUserData,facebookTableTemplate){"use strict";var multipleWebsiteLinkRegex=/((ftp|http|https)(:\/\/)(([0-9a-z_-]+\.)+(aero|asia|biz|cat|com|coop|edu|gov|info|int|jobs|mil|mobi|museum|name|net|org|pro|tel|travel|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cx|cy|cz|cz|de|dj|dk|dm|do|dz|ec|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mn|mn|mo|mp|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|nom|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ra|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sj|sk|sl|sm|sn|so|sr|st|su|sv|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw|arpa|xxx)(:[0-9]+)?((\/([~0-9a-zA-Z#+%@./_-]+))?(\?[0-9a-zA-Z+%@/&[\];=_-]+)?)?))\b/gi;function multipleLinkFormatter(val){if(val.match(multipleWebsiteLinkRegex)){return val.replace(multipleWebsiteLinkRegex,'<a href="http://$4" target="_blank">http://$4</a>')}return val}function addressFormatter(val){var addressFields=_.pick(val,"city","state","country");return _(addressFields).values().join(", ")}function includeMetric(viewItems,model,metric,formatter){var value=model.get(metric),title;if(_.isUndefined(value)){return}title=_.capitalize(metric);if(formatter){value=formatter(value)}return viewItems.push({title:title,value:value})}return Backbone.View.extend({className:"facebookUserView",initialize:function initialize(options){var mentionUrl=this.mentionUrl=options.mentionUrl,authorId=this.authorId=options.authorId;if(!mentionUrl){throw new Error("FacebookUserView must be instantiated with options.mentionUrl")}this.model=new FacebookUserData({mentionUrl:mentionUrl,authorId:authorId});this.model.bind("change",this.renderFacebookTable,this)},render:function render(){var model=this.model;var $el=$(this.el);$el.spin();model.fetch()},renderFacebookTable:function renderFacebookTable(){var model=this.model;var error=model.get("error");var viewItems=[];if(!error){includeMetric(viewItems,model,"name");includeMetric(viewItems,model,"gender");includeMetric(viewItems,model,"location",addressFormatter);includeMetric(viewItems,model,"locale");includeMetric(viewItems,model,"category");includeMetric(viewItems,model,"website",multipleLinkFormatter);includeMetric(viewItems,model,"likes");$(this.el).html(facebookTableTemplate({items:viewItems}))}else{this.$el.html("We were unable to fetch data from Facebook.")}}})});define("mustache!src/components/mentions/_mentionsprofile/templates/facebook",["lib/mustache"],function(mustache){var escapedTemplate='<h1 class="popuptitletext singlemargin-bottom">Facebook Profile</h1>\n{{^authenticated}}\n<div class="twitterLoginContainer hint-info">\n<p class="singlemargin-bottom">Please authenticate with Facebook to use this feature.</p>\n<a class="dib social-button social-button--facebook facebook-login">\n<span class="icon-bwfacebook smallpadding-right"></span>Authenticate with Facebook\n</a>\n</div>\n{{/authenticated}}\n{{#authenticated}}\n<section class="profileView">\n<header class="doublemargin-bottom singlepadding relative">\n{{#authorId}}\n<img class="avatar floatleft rounded singlemargin-right" src="http://graph.facebook.com/{{authorId}}/picture" />\n{{/authorId}}\n<div class="floatleft">\n<h1 class="biggertext" title="{{title}}">{{title}}</h1>\n<h2 class="dib">\n<a class="mentionUrl" target="_blank" title="{{url}} (new window)" href="{{url}}">{{formattedUrl}}</a>\n</h2>\n</div>\n</header>\n<section class="profileData pagemargin-bottom">\n{{#showPopularity}}\n<h2 class="subtitletext smallmargin-bottom">Popularity</h2>\n<div class="popularity pagemargin-bottom"/>\n{{/showPopularity}}\n<h2 class="subtitletext smallmargin-bottom">Facebook User Information</h2>\n<div class="facebookUser pagemargin-bottom"/>\n</section>\n</section>\n{{/authenticated}}\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/components/mentions/_mentionsprofile/views/FacebookProfileView",["backbone","underscore","jquery","src/helpers/FB","src/components/mentions/_mentionsprofile/views/PopularityView","src/components/mentions/_mentionsprofile/views/FacebookUserView","mustache!src/components/mentions/_mentionsprofile/templates/facebook","css!src/components/mentions/_mentionsprofile/css/mentionsprofile.css"],function(Backbone,_,$,FB,PopularityView,FacebookUserView,facebookTemplate){"use strict";var FacebookProfileView;return FacebookProfileView=Backbone.View.extend({className:"facebookProfileView profileView",events:{"click .facebook-login":"onFacebookLogin"},initialize:function initialize(options){options=_.extend({showPopularity:true},options);var mentionUrl=this.mentionUrl=options.mentionUrl;var authorName=this.authorName=options.authorName;this.authorId=options.authorId;this.showPopularity=options.showPopularity;if(!mentionUrl){throw new Error("FacebookProfileView must be instantiated with options.mentionUrl")}if(!authorName){throw new Error("FacebookProfileView must be instantiated with options.authorName")}},render:function render(){var self=this;FB.getLoginStatus(function(err,response){var url=self.mentionUrl;var authorId=self.authorId;if(err||!response.loggedIn){return self.renderFacebookLoginButton.call(self)}self.$el.html(facebookTemplate({authenticated:true,title:self.authorName,url:url,formattedUrl:url.length>80?$("<a>",{href:url})[0].hostname+"...":url,showPopularity:self.showPopularity,authorId:authorId}));self.renderFacebookPopularityView.call(self,url);self.renderFacebookUserView.call(self,url,authorId)})},renderFacebookPopularityView:function renderFacebookPopularityView(url){if(this.showPopularity){this.popularityView=new PopularityView({el:this.$(".popularity"),mentionUrl:url});this.popularityView.render()}},renderFacebookUserView:function renderFacebookUserView(url,authorId){this.facebookUserView=new FacebookUserView({el:this.$(".facebookUser"),mentionUrl:url,authorId:authorId});this.facebookUserView.model.bind("change:link",this.setProfileLink,this);this.facebookUserView.model.bind("change",this.alignModal,this);this.facebookUserView.render()},renderFacebookLoginButton:function renderFacebookLoginButton(){this.$el.html(facebookTemplate({authenticated:false}));this.alignModal()},alignModal:function alignModal(){this.$el.centreModal()},onFacebookLogin:function onFacebookLogin(){var self=this;FB.login(function(err){if(err){return}self.render()})},remove:function remove(){if(this.facebookUserView){this.facebookUserView.model.off("change:link",this.setProfileLink,this);this.facebookUserView.remove()}if(this.popularityView){this.popularityView.remove()}Backbone.View.prototype.remove.call(this)},setProfileLink:function setProfileLink(facebookUserDataModel){var model=facebookUserDataModel.toJSON();if(_.isUndefined(model.link)){return}this.$("a.mentionUrl").text(model.link)}},{show:function show(options){var view=new FacebookProfileView(options);var showPopularity=options.showPopularity;view.$el.showModal({draggable:".facebookProfileView > h1",className:"popup standardpopup",fitToWindow:false,maxWidth:600,maxHeight:showPopularity?600:320});view.render();return view}})});define("src/components/mentions/_mentionsprofile/models/InstagramProfileData",["src/components/mentions/_mentionsprofile/models/JsonpModel","src/helpers/instagramApiHelper"],function(JsonpModel,instagramApiHelperFactory){"use strict";var InstagramProfileData=JsonpModel.extend({constructor:function InstagramProfileData(options){JsonpModel.apply(this,arguments);if(!options.authorName){throw new Error("no-authorname")}this.authorName=options.authorName;this.instagramApiHelper=instagramApiHelperFactory.getChannelsHelper()},fetch:function fetch(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var self=this;return this.instagramApiHelper.getProfileInfo(this.authorName).then(function(response){self.set(self.parse(response));return response}).catch(function(error){var messageCode=error.message;if(error.status>=400){messageCode=self.instagramApiHelper.NO_ACCESSTOKEN}self.trigger("error",messageCode);if(options.error){options.error.call(self,messageCode)}throw new Error(messageCode)})},parse:function parse(response){return{fullName:response.full_name,authorName:response.username,avatar:response.profile_picture,bio:response.bio,media:response.counts.media,follows:response.counts.follows,followers:response.counts.followed_by}}});return InstagramProfileData});define("mustache!src/components/mentions/_mentionsprofile/templates/instagram",["lib/mustache"],function(mustache){var escapedTemplate='<h1 class="popuptitletext singlemargin-bottom draggable">Instagram Profile</h1>\n{{^authenticated}}\n<div class="instagramLoginContainer hint-info">\n<p class="singlemargin-bottom">Please authenticate with Instagram to use this feature.</p>\n<a class="dib social-button social-button--instagram instagram-login">\n<span class="icon-bwinstagram smallpadding-right"></span>Authenticate with Instagram\n</a>\n</div>\n{{/authenticated}}\n{{#authenticated}}\n<section class="profileView">\n{{#error}}\n<div class="instagramErrorContainer singlepadding singlemargin-top">\n{{ error }}\n</div>\n{{/error}}\n</section>\n{{/authenticated}}\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/components/mentions/_mentionsprofile/templates/instagramAuthor",["lib/mustache"],function(mustache){var escapedTemplate='<header class="doublemargin-bottom singlepadding relative">\n<a\nclass="customtip"\ntarget="_blank" href="http://instagram.com/{{authorName}}"\ntitle="Open Profile on Instagram (in new window)">\n<img class="avatar floatleft rounded singlemargin-right" src="{{avatar}}"/>\n</a>\n<div class="floatleft">\n<h1 class="biggertext floatleft">\n<a\nclass="customtip"\ntarget="_blank" href="http://instagram.com/{{authorName}}"\ntitle="Open Profile on Instagram (in new window)">{{authorName}}\n</a>\n</h1>\n<h2 class="dib smallpadding-left">\n<a\nclass="mentionUrl customtip"\ntarget="_blank" href="http://instagram.com/{{authorName}}"\ntitle="Open Profile on Instgram (in new window)">@{{authorName}}\n</a>\n</h2>\n{{#bio}}\n<p class="instagram-bio db sixcolmax">{{{bio}}}</p>\n{{/bio}}\n{{^bio}}\n<p class="instagram-bio db sixcolmax">{{authorName}} has not specified a bio.</p>\n{{/bio}}\n</div>\n<p class="follow-button absbottom singlemargin-bottom">\n<a\nclass="social-button social-button--instagram singlepadding-right"\ntarget="_blank" href="http://instagram.com/{{authorName}}"\ntitle="Follow @{{authorName}} on Instagram">\n<span class="icon-bwinstagram"></span>\n<span class="">Follow @{{authorName}}</span>\n</a>\n</p>\n</header>\n<div class="instagramStatistics">\n<table summary="Instagram metrics for @{{authorName}}">\n<tbody>\n<tr>\n<td>Posts</td>\n<td class="metric">{{media}}</td>\n</tr>\n<tr>\n<td>Following</td>\n<td class="metric">{{follows}}</td>\n</tr>\n<tr>\n<td>Followers</td>\n<td class="metric">{{followers}}</td>\n</tr>\n<tbody>\n</table>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/components/mentions/_mentionsprofile/views/InstagramProfileView",["backbone","src/helpers/instagramApiHelper","src/analytics/Analytics","src/mixins/mixin","src/mixins/withPopup","bw-fe-helpers/autoLinkHelper","src/components/mentions/_mentionsprofile/models/InstagramProfileData","mustache!src/components/mentions/_mentionsprofile/templates/instagram","mustache!src/components/mentions/_mentionsprofile/templates/instagramAuthor","css!src/components/mentions/_mentionsprofile/css/mentionsprofile.css"],function(Backbone,instagramApiHelperFactory,Analytics,mixin,withPopup,autoLinkHelper,InstagramProfileData,instagramTemplate,instagramAuthorTemplate){"use strict";var InstagramProfileView;var instagramApiHelper=instagramApiHelperFactory.getChannelsHelper();function trackInstagramProfileView(authorName){Analytics.trackEvent({name:"Miscellaneous.Instagram_Profile_View",action:"Show",origin:"Application",values:{authorName:authorName}})}InstagramProfileView=Backbone.View.extend({className:"instagramProfileView profileView",events:{"click .instagram-login":"onInstagramLogin"},constructor:function InstagramProfileView(options){Backbone.View.apply(this,arguments);var authorName=this.authorName=options.authorName;if(!authorName){throw new Error("no-authorname")}this.model=new InstagramProfileData({authorName:authorName});this.listenTo(this.model,"change",this.renderInstagramAuthor)},getInstagramData:function getInstagramData(){var self=this;return this.model.fetch({error:function error(_error){if(_error===instagramApiHelper.GENERIC_ERROR){return self.renderInstagramError("Profile information could not be retrieved. Please try again later.")}if(_error===instagramApiHelper.PROFILE_NOT_AVAILABLE){return self.renderInstagramError("This account is currently not available. It has been disabled, deleted or marked as private.")}if(_error===instagramApiHelper.NO_ACCESSTOKEN){return self.renderInstagramLoginButton()}}})},onInstagramLogin:function onInstagramLogin(){var self=this;instagramApiHelper.login(function(err){if(err){return}self.render()})},render:function render(){this.getInstagramData()},renderInstagramLoginButton:function renderInstagramLoginButton(){this.$el.html(instagramTemplate({authenticated:false}));this.$el.fitToContent();this.$el.centreModal()},renderInstagramError:function renderInstagramError(message){this.$el.html(instagramTemplate({authenticated:true,error:message}));this.$el.fitToContent();this.$el.centreModal()},renderInstagramAuthor:function renderInstagramAuthor(){trackInstagramProfileView(this.authorName);this.$el.html(instagramTemplate({authenticated:true}));this.$profileEl=this.$(".profileView");this.$profileEl.html(instagramAuthorTemplate({authenticated:true,authorName:this.authorName,avatar:this.model.get("avatar"),bio:autoLinkHelper.instagramContent(this.model.get("bio")),media:this.model.get("media"),follows:this.model.get("follows"),followers:this.model.get("followers")}));this.$el.fitToWindow();this.$el.centreModal()}},{show:function show(options){var view=new InstagramProfileView(options);view.render();view.showAsPopup({fitToWindow:false,maxWidth:564,maxHeight:320});return view}});mixin(InstagramProfileView,withPopup);InstagramProfileView.prototype.ACCOUNT_NOT_AVAILABLE="account-not-available";InstagramProfileView.prototype.FAILED_FETCH="failed-fetch";InstagramProfileView.prototype.NO_ACCESSTOKEN="no-accesstoken";return InstagramProfileView});define("mustache!templates/listViewItem",["lib/mustache"],function(mustache){var escapedTemplate='<li data-id="{{id}}"><span class="sixcolmax dib name">{{name}}{{#status}}<span class="status lightgrey"> ({{status}})</span>{{/status}}</span><a class="remove iconsmall icon-remove floatright singlemargin-right customtip" title="{{title}}"></a></li>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!css/groupListView.css",["css!css/compiled.css"],function(){});define("src/views/ListView",["backbone","underscore","jquery","mustache!templates/listViewItem","src/packages/customtip","css!css/groupListView.css"],function(Backbone,_,$,listViewItemTemplate){"use strict";return Backbone.View.extend({events:{"click a.remove":"onRemoveItem"},initialize:function initialize(options){options=options||{};this.items=options.items||[];if(_.isFunction(options.formatItemForTemplate)){this.formatItemForTemplate=options.formatItemForTemplate}if(_.isFunction(options.itemSorter)){this.itemSorter=options.itemSorter}if(_.isFunction(options.renderItem)){this.renderItem=options.renderItem}_(this).bindAll("renderItem");Backbone.View.prototype.initialize.call(this,options)},getValues:function getValues(){return this.items},render:function render(){var $el=this.$el,listItems=_([].concat(this.items)).chain().map(this.formatItemForTemplate).sortBy(this.itemSorter).value();$el.html(this.renderList(listItems));return this},renderList:function renderList(items){var $list=$('<ul class="groupListView">');this.$el.toggleClass("no-results",!items.length);_(items).chain().map(this.renderItem).each(function($item){$list.append($item)});return $list},renderItem:function renderItem(item){return listViewItemTemplate(item)},itemSorter:function itemSorter(item){return(item.name||"").toLowerCase()},formatItemForTemplate:function formatItemForTemplate(item){return{id:item.id,name:item.name,title:"Remove "+item.name}},addItem:function addItem(item){var formattedItem;this.items.push(item);formattedItem=this.formatItemForTemplate(item);this.$("ul").append(this.renderItem(formattedItem));this.$el.removeClass("no-results");this.trigger("itemAdded",{itemId:item.id});this.trigger("change")},onRemoveItem:function onRemoveItem(e){e.preventDefault();this.removeItem($(e.currentTarget).closest("li").data("id"))},removeItem:function removeItem(itemId){var self=this,$item=this.$('li[data-id="'+itemId+'"]');if($item.hasClass("removed")){return}this.items=_(this.items).reject(function(item){return self.formatItemForTemplate(item).id===itemId});$item.addClass("removed").fadeOut(200,function(){$(this).remove();if(self.$("ul li").length===0){self.$el.addClass("no-results")}self.trigger("change")});this.trigger("itemRemoved",{itemId:itemId})},onRemoveAll:function onRemoveAll(e){e.preventDefault();this.removeAll()},removeAll:function removeAll(){this.$("ul li").remove();this.items.splice(0,this.items.length);this.$el.addClass("no-results");this.trigger("change")}})});define("mustache!templates/multiProjectSelectionView",["lib/mustache"],function(mustache){var escapedTemplate='<div class="multiProjectSelectionView smallpadding-top">\n<select class="multiProjectSelector" multiple>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("text!templates/projectselection/multipleProjectSelectorMain.template",[],function(){return'<div class="{{className}}" tabindex=1>\n    <ul class="{{selectionsClass}}">\n        {{#selections}}\n        {{/selections}}\n    </ul>\n    <div class="{{selectedClass}} rounded darkgrey smallpadding-horizontal relative">\n        <span class="{{selectedTextClass}} dib doublepadding-right fullwidth textellipsis">{{selectedItemText}}</span><i class="icon-chevron-down rounded linkblue absright hugeline smallmargin-right"></i>\n    </div>\n</div>\n'});define("text!templates/projectselection/multipleProjectSelectorSelection.template",[],function(){return'<li class="{{selectionItemClass}}" data-value="{{value}}">\n    <span class="sixcolmax name">{{text}}</span>\n    <a class="{{unselectItemClass}} iconsmall icon-remove floatright singlemargin-right customtip" title="{{title}}"></a>\n</li>\n'});define("css!css/multiProjectSelectionView.css",["css!css/compiled.css"],function(){});define("src/views/MultiProjectSelectionView",["backbone","underscore","src/globals/currentProject","src/helpers/validationTooltipHelper","mustache!templates/multiProjectSelectionView","text!templates/projectselection/multipleProjectSelectorMain.template","text!templates/projectselection/multipleProjectSelectorSelection.template","text!templates/projectselection/projectSelectorItem.template","text!templates/projectselection/projectSelectorItemsPopup.template","src/packages/selleckt","css!css/projectSellecktor.css","css!css/multiProjectSelectionView.css"],function(Backbone,_,currentProject,validationTooltipHelper,template,projectSelectorMainTemplate,projectSelectorSelectionTemplate,projectSelectorItemTemplate,projectSelectorItemsPopup){"use strict";var MultiProjectSelectionView=Backbone.View.extend({className:"multiProjectSelectionView",constructor:function MultiProjectSelectionView(options){Backbone.View.apply(this,arguments);if(!options.collection){throw new Error("options.collection must be set!")}this.preselectedIds=options.preselectedIds||[]},remove:function remove(){if(this.sellecktInstance){this.sellecktInstance.destroy()}Backbone.View.prototype.remove.call(this)},render:function render(filterFunction){var view=this,instantiateDropdown=_.bind(this.instantiateDropdown,this);view.$el.html(template({}));if(view.collection.size()){return instantiateDropdown(view.prepareCollection(view.collection,filterFunction))}view.collection.fetch({success:function success(collection){instantiateDropdown(view.prepareCollection(collection,filterFunction))}})},prepareCollection:function prepareCollection(collection,filterFunction){if(typeof filterFunction==="function"){collection=collection.filter(filterFunction)}return collection.map(function(item){return{label:item.get("name"),value:item.id}})},instantiateDropdown:function instantiateDropdown(items){var selleckt=this.sellecktInstance=this.$(".multiProjectSelector").selleckt({enableSearch:true,searchThreshold:-1,mainTemplate:projectSelectorMainTemplate,selectionTemplate:projectSelectorSelectionTemplate,itemTemplate:projectSelectorItemTemplate,popupTemplate:projectSelectorItemsPopup}).data("selleckt");selleckt.addItems(items);this.preselectedIds.forEach(function(id){selleckt.selectItemByValue(id)});if(_.isNumber(currentProject.id)){selleckt.$sellecktEl.find(".selectionItem[data-value="+currentProject.id+"]").remove()}},getSelectedProjectIds:function getSelectedProjectIds(){if(!this.sellecktInstance){return this.preselectedIds}return this.sellecktInstance.getSelection().map(function(item){return item.value})},showError:function showError(message){if(!this.sellecktInstance){return}var $sellecktEl=this.sellecktInstance.$sellecktEl;$sellecktEl.addClass("invalid");if(message){validationTooltipHelper.showError(message,$sellecktEl)}},hideError:function hideError(){if(!this.sellecktInstance){return}var $sellecktEl=this.sellecktInstance.$sellecktEl;$sellecktEl.removeClass("invalid");validationTooltipHelper.hideError($sellecktEl)},selectProject:function selectProject(projectId){if(!this.sellecktInstance){return}var project=this.sellecktInstance.findItem(projectId+"");if(project){this.sellecktInstance.selectItem(project)}},unselectProject:function unselectProject(projectId){if(!this.sellecktInstance){return}var project=this.sellecktInstance.findItem(projectId+"");if(project){this.sellecktInstance.unselectItem(project)}}});return MultiProjectSelectionView});define("mustache!templates/groupShareView",["lib/mustache"],function(mustache){var escapedTemplate='<div class="modular">\n<table>\n<tbody>\n<tr>\n<td class="twocol cellpadding textright singlepadding-right">\n<strong>{{groupType}} Owner</strong>\n</td>\n<td class="cellpadding">\n<span class="owner">{{owner}}</span>\n</td>\n</tr>\n<tr>\n<td class="textright cellpadding singlepadding-right"><strong>Privacy</strong></td>\n<td class="cellpadding">\n<span class="sharedLabel">{{shared}}</span>\n{{#canEditShared}}\n<span class="smallmargin-left changeShared">\n(<a>change</a>)\n</span>\n{{/canEditShared}}\n<span class="sharedSelection hidden">\n<select class="selectfield"></select>\n</span>\n</td>\n</tr>\n<tr>\n<td class="textright cellpadding singlepadding-right">\n<strong>{{groupNoun}} is shared<br/>with Project{{#canShareWithMultipleProjects}}s{{/canShareWithMultipleProjects}}</strong>\n</td>\n<td class="cellpadding">\n<div class="projectLabel dib floatleft fourcolmax">{{projectNames}}</div>\n{{#canEditProjects}}\n<div class="smallmargin-left changeProjects dib floatleft">\n(<a>change</a>)\n</div>\n{{/canEditProjects}}\n<div class="projectSelection floatleft dib hidden">\n<ul class="itemList currentProject">\n<li class="customtip" title="The currently opened Project cannot be removed.">{{currentProject}}</li>\n</ul>\n<div class="multiProjectSelectionView"></div>\n</div>\n</td>\n</tr>\n<tr>\n<td></td>\n<td class="cellpadding notewrapper">\n</td>\n</tr>\n</tbody>\n</table>\n\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!css/groupShareView.css",["css!css/compiled.css"],function(){});define("src/views/GroupShareView",["backbone","underscore","jquery","src/globals/me","src/globals/currentProject","src/models/ProjectSummaryCollection","src/views/MultiProjectSelectionView","mustache!templates/groupShareView","css!css/groupShareView.css","lib/jquery.notify","src/packages/customtip"],function(Backbone,_,$,me,currentProject,ProjectSummaryCollection,MultiProjectSelectionView,template){"use strict";function getOwner(model){if(model.isNew()){return me.get("username")}return model.getOwner()}var sharedLabelHash={public:"Others can edit",readonly:"Others can view",private:"Private"};function getSharedLabel(model){if(model.isNew()){return sharedLabelHash["public"]}return sharedLabelHash[model.get("shared")]||"n/a"}function getSharedOptions(selectedKey){return _(sharedLabelHash).map(function(v,k){return'<option value="'+k+'"'+(selectedKey===k?" selected":"")+">"+_.escape(v)+"</option>"}).join("")}function getProjectNames(projectId,projects){var currentProjectName=currentProject.get("name"),verylong=_.isArray(projectId)&&projectId.length>15;if(!projectId||projectId.length===0){return currentProjectName}return[currentProjectName].concat(projects.chain().filter(function(p){return p.id!==currentProject.id&&_.contains(projectId,p.id)}).first(14).map(function(p){return p.get("name")}).value()).join(", ")+(verylong?", ...":"")}function isOwn(model){return model.isNew()||model.isOwn(me.id)}return Backbone.View.extend({className:"groupShareView",events:{"click .changeShared a":"onClickChangeShared","click .changeProjects a":"onClickChangeProjects","change .sharedSelection":"onChangeSharedSelection"},noteTexts:{private:"is available <strong>only to you</strong> in the Projects listed above. It <strong>cannot</strong> be seen by other users",readonly:"<strong>can be seen</strong> but not edited by users of the Projects listed above.",public:"<strong>can be edited</strong> by users of the Projects above."},initialize:function initialize(opts){var isOwnGroup;if(!opts||!opts.model){throw new Error("options.model must be set!")}if(!opts.projects){throw new Error("options.projects must be set")}this.groupNoun=opts.groupNoun||"List";this.model=opts.model;this.projects=opts.projects;this.groupType=opts.groupType;this.canShareWithMultipleProjects=opts.canShareWithMultipleProjects===undefined?true:opts.canShareWithMultipleProjects;isOwnGroup=isOwn(this.model);this.canEditShared=isOwnGroup;this.canEditProjects=isOwnGroup&&typeof opts.canEditProjects==="undefined"?true:opts.canEditProjects;this.noteTexts=_.extend({},this.noteTexts,opts.noteTexts||{})},render:function render(){this.$el.html(template({groupNoun:this.groupNoun,groupType:this.groupType,owner:getOwner(this.model),shared:getSharedLabel(this.model),projectNames:getProjectNames(this.model.get("projectId")||this.model.get("sharedProjectIds"),this.projects),currentProject:currentProject.get("name"),canEditShared:this.canEditShared,canEditProjects:this.canEditProjects,canShareWithMultipleProjects:this.canShareWithMultipleProjects}));this.$(".sharedSelection select").empty().html(getSharedOptions(this.model.get("shared")));this.multiProjectSelectionView=new MultiProjectSelectionView({collection:new ProjectSummaryCollection(this.projects.toJSON(),{pagination:false}),el:this.$(".multiProjectSelectionView"),preselectedIds:[].concat(this.model.get("projectId")||this.model.get("sharedProjectIds")||[])});this.multiProjectSelectionView.render();this.updateNote();this.$el.customtip()},getValues:function getValues(){var multiProjectSelectionView=this.multiProjectSelectionView,projectId=_(multiProjectSelectionView.getSelectedProjectIds()).chain().push(currentProject.id).uniq().value();return{shared:this.$(".sharedSelection select").val(),projectId:projectId}},onChangeSharedSelection:function onChangeSharedSelection(e){this.updateNote();this.setSharedSelectionText($(e.target).find("option:selected").text())},setSharedSelectionText:function setSharedSelectionText(newText){this.$(".sharedLabel").text(newText).add(".changeShared").removeClass("hidden");this.$(".sharedSelection").addClass("hidden")},getNoteText:function getNoteText(groupType,privacy){if(!_(this.noteTexts).has(privacy)){return""}return"This "+groupType+" "+this.noteTexts[privacy]},updateNote:function updateNote(){var currVals=this.getValues(),html='<p class="notification-info rounded smallpadding-vertical singlepadding-horizontal fourcol">'+this.getNoteText(this.groupType,currVals.shared)+"</p>";this.$(".notewrapper").html(html)},onClickChangeShared:function onClickChangeShared(){this.$(".changeShared, .sharedLabel, .sharedSelection").toggleClass("hidden")},onClickChangeProjects:function onClickChangeProjects(){this.$(".changeProjects, .projectLabel, .projectSelection").toggleClass("hidden")},remove:function remove(){if(this.multiProjectSelectionView){this.multiProjectSelectionView.remove()}Backbone.View.prototype.remove.call(this)}})});define("mustache!templates/authorsForm",["lib/mustache"],function(mustache){var escapedTemplate='<header>\n{{#name}}\n<h1 class="popuptitletext singlemargin-bottom draggable">Edit Author List "{{name}}"</h1>\n{{/name}}\n{{^name}}\n<h1 class="popuptitletext singlemargin-bottom draggable">Create Author List</h1>\n{{/name}}\n</header>\n<div class="errorPane notification-error rounded smallpadding-vertical singlepadding-horizontal singlemargin-bottom hidden"></div>\n<form>\n<label for="groupName-{{cid}}" class="bold darkgrey db twocol smallmargin-bottom">List Name <a class="help icon-bwhelp dib customtip" data-key="authorgroups-add" title="Learn more about Author Lists"></a></label>\n<input class="fourcol validation-wrapper field" id="groupName-{{cid}}" name="groupName" class="validation-wrapper" maxlength="32" {{#name}}value="{{name}}"{{/name}}/>\n<nav class="singlemargin-top">\n<div class="groupTabs horizontal-navigation">\n<a class="showEditTab active singlepadding-horizontal horizontal-navigation--item navbuttonshade dib">Authors in List</a>\n<a class="showSharingTab singlepadding-horizontal horizontal-navigation--item navbuttonshade dib">Sharing Settings</a>\n</div>\n</nav>\n<div class="editTab">\n<div class="clearboth itemListHeader">\n<a class="removeAll floatright">Remove all</a>\n</div>\n<section class="itemList authorsList bwscrollbar-narrow smallmargin-bottom"/>\n<div>\n<input class="fourcol addAuthor field validation-wrapper" name="addAuthor" value="" placeholder="Type author name and hit enter" />\n<button class="button smallmargin-left js-add-author">Add</button>\n<a class="help icon-bwhelp smallmargin-top floatright dib" data-key="authorgroups-csv"></a>\n<a class="upload floatright smallmargin-top smallmargin-right customtip customtip-html" title="Add authors from a <strong>csv</strong> or <strong>txt</strong> file">Upload authors</a>\n<input type="file" name="file" class="hidden file"></input>\n</div>\n<div class="inputNote hidden floatleft tinymargin-top lightgrey smalltext">Hit enter to add author</div>\n</div>\n<div class="sharingTab singlemargin-top hidden">\n</div>\n<footer class="doublemargin-top">\n<button class="save-group defaultbutton">\n{{#isEdit}}Update Author List{{/isEdit}}\n{{^isEdit}}Create Author List{{/isEdit}}\n</button>\n<button class="cancel button singlemargin-left">Cancel</button>\n</footer>\n</form>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!templates/genericConfirmation",["lib/mustache"],function(mustache){var escapedTemplate='<div class="genericConfirmation">\n<p class="bigtext doublemargin-bottom">{{thing}} Saved!</p>\n<p class="singlemargin-bottom">The {{thing}} <b>"{{name}}"</b> has been {{#wasEdit}}edited{{/wasEdit}}{{^wasEdit}}created{{/wasEdit}}.</p>\n<p>You can edit your {{thing}} from the {{section}} section in the sidebar on the left</p>\n<button class="closeConfirmation button doublemargin-top">Close</button>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==="object"&&typeof module==="object")module.exports=factory(require("underscore"));else if(typeof define==="function"&&define.amd)define("bw-fe-helpers/mimeTypeHelper",["underscore"],factory);else{var a=typeof exports==="object"?factory(require("underscore")):factory(root["underscore"]);for(var i in a)(typeof exports==="object"?exports:root)[i]=a[i]}})(this,function(__WEBPACK_EXTERNAL_MODULE__1__){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=26)}({1:function(module,exports){module.exports=__WEBPACK_EXTERNAL_MODULE__1__},26:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var underscore__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1);var underscore__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(underscore__WEBPACK_IMPORTED_MODULE_0__);function hasExtension(filename,extensions){var name=filename.toLowerCase();return underscore__WEBPACK_IMPORTED_MODULE_0___default()(extensions).some(function(ext){var re=new RegExp("\\."+ext.toLowerCase()+"$");return re.test(name)})}function hasNoExtension(filename){return!!filename.match(/^[^.]+$/)}__webpack_exports__["default"]={isCSV:function isCSV(mimeType,filename){filename=filename&&filename.trim()||"";mimeType=mimeType&&mimeType.trim()||"";if(mimeType===""||mimeType==="application/vnd.ms-excel"){return hasExtension(filename,["csv","txt"])||hasNoExtension(filename)}return!!mimeType.match(/text\/(csv|plain).*/i)}}}})["default"]});define("css!css/groupTabs.css",["css!css/compiled.css"],function(){});define("src/views/AuthorGroupAdministrationView",["underscore","jquery","src/views/ValidatingFormView","src/models/AuthorGroup","src/models/ProjectSummaryCollection","src/views/ListView","src/views/GroupShareView","mustache!templates/authorsForm","mustache!templates/genericConfirmation","bw-fe-helpers/mimeTypeHelper","bw-fe-helpers/validationHelpers","src/packages/modalDialogs","src/packages/customtip","src/packages/waitmask","lib/jquery.notify","lib/jquery.confirm","css!css/font-awesome.css","css!css/groupTabs.css"],function(_,$,ValidatingFormView,AuthorGroup,ProjectSummaryCollection,ListView,GroupShareView,authorsFormTemplate,genericConfirmation,mimeTypeHelper,validationHelpers){"use strict";var AuthorGroupAdministrationView;var KEY_CODES={ENTER:13};function renderListView(options){var listView=options.view;listView.setElement(options.$el);listView.render();listView.removeAll();if(options.prefillAuthor){listView.addItem({name:options.prefillAuthor})}_.each(options.names,function(name){listView.addItem({name:name})})}return AuthorGroupAdministrationView=ValidatingFormView.extend({className:"authorGroupAdministrationView groupAdmin modular",events:function events(){return{"click .showEditTab":"onClickEditTab","click .showSharingTab":"onClickSharingTab","submit form":"onSubmit","click .save-group":"onSaveGroup","click button.cancel":"onCancelled","click button.closeConfirmation":"onClose","click a.removeAll":"onRemoveAll","click .js-add-author":"onClickAddAuthor","keypress .addAuthor":"onAddAuthorKeypress","keyup .addAuthor":"onToggleInputNote","focus .addAuthor":"onToggleInputNote","blur .addAuthor":"hideInputNote","click a.upload":"onClickUpload","change input.file":"onFileSelected"}},initialize:function initialize(options){if(!options||!options.model){throw new Error("AuthorGroupAdministrationView must be initialized with a model")}if(!options.projects){throw new Error("options.projects must be set")}if(!options.collection){throw new Error("AuthorGroupAdministrationView must be initialized with a collection option")}this.projects=options.projects;this.loading=options.loading||false;if(this.loading){this.projects.on("reset",this.onProjectsLoaded,this)}this.prefillAuthor=options.prefillAuthor;this.inputError=false;this.collection=options.collection;this.onModelSaved=options.onModelSaved;this.listView=new ListView({items:[],formatItemForTemplate:function formatItemForTemplate(item){return{id:item.name,name:item.name,status:item.status,title:"Remove "+item.name}}});_(this).bindAll("onFileSelected");ValidatingFormView.prototype.initialize.call(this,options)},remove:function remove(){this.projects.off("reset",this.onProjectsLoaded,this);this.listView.remove();ValidatingFormView.prototype.remove.call(this)},render:function render(){var data=this.model.toJSON(),names=data.authors;data.isEdit=_.isNumber(data.id);data.cid=this.cid;if(names&&names.length){data.hasAuthors=true;data.count=names.length}this.$el.html(authorsFormTemplate(_(data).defaults({hasAuthors:names&&!!names.length,loading:this.loading})));if(this.loading){this.$el.showWaitmask("Loading...");return}renderListView({view:this.listView,prefillAuthor:this.prefillAuthor,names:names,$el:this.$(".authorsList")});this.groupShareView=new GroupShareView({model:this.model,projects:this.projects,groupType:"Author List"});this.groupShareView.render();this.$(".sharingTab").html(this.groupShareView.el);this.$("input[name=groupName]").focus();this.$el.customtip()},onProjectsLoaded:function onProjectsLoaded(){this.projects.off("reset",this.onProjectsLoaded,this);this.loading=false;this.render()},onClickUpload:function onClickUpload(){this.$(".file").val("").click()},onSubmit:function onSubmit(e){e.preventDefault()},onToggleInputNote:function onToggleInputNote(e){if(e.which===KEY_CODES.ENTER){return}if(!$(e.target).val().trim()){this.hideInputNote();return}this.showInputNote()},hideInputNote:function hideInputNote(){this.$(".inputNote").addClass("hidden")},showInputNote:function showInputNote(){this.$(".inputNote").removeClass("hidden")},onClickAddAuthor:function onClickAddAuthor(e){e.preventDefault();this.addAuthorFromField()},onAddAuthorKeypress:function onAddAuthorKeypress(e){if(e.which!==KEY_CODES.ENTER){return}this.addAuthorFromField()},addAuthorFromField:function addAuthorFromField(){var $input=this.$('input[name="addAuthor"]');this.hideErrors();if(!this.addAuthor($input.val())){var validationErrors={addAuthor:{message:"Author name can not contain double quotes or backslashes"}};this.showInputValidation(this.$("[name=addAuthor]"),validationErrors);return false}$input.val("");this.hideInputNote();this.$el.customtip();return true},addAuthor:function addAuthor(name,status){name=name.trim();if(validationHelpers.isInvalidAuthorName(name)){return false}if(name!==""&&!_.any(this.listView.getValues(),function(author){return author.name.toLowerCase()===name.toLowerCase()})){this.listView.addItem({name:name,status:status})}return true},onSaveGroup:function onSaveGroup(e){e.preventDefault();this.saveGroup()},saveGroup:function saveGroup(){var self=this,model=this.model,isEdit=_.isNumber(model.id),data,validationErrors,$authorField=this.$("[name=addAuthor]"),authorInField=$authorField.val().trim(),authorNames,groupName=this.$("[name=groupName]").val(),shareSettings=this.groupShareView.getValues();this.hideErrors();if(authorInField.length&&!this.addAuthorFromField()){return}authorNames=_.pluck(this.listView.getValues(),"name");if(!groupName){validationErrors={groupName:{message:"Please name this Author List (so you can find it easily later)"}};this.showInputValidation(this.$("[name=groupName]"),validationErrors)}if(groupName.length>32){validationErrors={groupName:{message:"Name cannot be longer than 32 characters"}};this.showInputValidation(this.$("[name=groupName]"),validationErrors)}if(!authorNames.length){validationErrors={addAuthor:{message:"Please add at least one author to this Author List"}};this.showInputValidation(this.$("[name=addAuthor]"),validationErrors)}if(!groupName||groupName.length>32||!authorNames.length){return}this.$el.showWaitmask("Saving...");model.save({name:groupName,authors:authorNames,shared:shareSettings.shared,sharedProjectIds:shareSettings.projectId},{success:function success(model){self.$el.hideWaitmask();data=model.toJSON();self.$(".errorPane").addClass("hidden");self.$("form").replaceWith(genericConfirmation({thing:"Author Group",name:data.name,wasEdit:isEdit,section:"Tools"}));if(_.isFunction(self.onModelSaved)){self.onModelSaved(model)}self.collection.add(model)},error:function error(model,response){self.$el.hideWaitmask();self.onServerError(model,response)}});if(model.validationError){this.$el.hideWaitmask()}},onRemoveAll:function onRemoveAll(){this.listView.removeAll()},onFileSelected:function onFileSelected(evt){var self=this,file=evt.target&&evt.target.files&&evt.target.files[0],fileReader;if(!mimeTypeHelper.isCSV(file.type,file.name)){$.notify({text:"Unable to upload file. The file type is not allowed.",duration:2e3});return}fileReader=new FileReader;fileReader.onload=function(evt){self.onFileLoaded(evt.target)};fileReader.readAsText(file)},onFileLoaded:function onFileLoaded(file){var self=this;var messages=[];var existingAuthors=_.map(_.pluck(this.listView.getValues()||[],"name"),function(a){return a.toLowerCase()});var newAuthors=_.compact(file.result.split(/[\n\r,]+/)).map(function(author){author=author.trim();author=_.unquote(author);author=_.unquote(author,"'");return author});var deDupedNewAuthors=_(newAuthors).chain().reduce(function(memo,author){author=author.toLowerCase();if(memo.indexOf(author)===-1&&existingAuthors.indexOf(author)===-1){memo.push(author)}return memo},[]).value();var duplicateAuthorCount=newAuthors.length-deDupedNewAuthors.length,addedAuthorsCount=deDupedNewAuthors.length,invalidAuthorsCount=0;_.each(newAuthors,function(a){if(a&&!self.addAuthor(a,"from file")){invalidAuthorsCount++;addedAuthorsCount--}});if(addedAuthorsCount===0){messages.push("All "+duplicateAuthorCount+" authors from this CSV were already in this Author List")}else{messages.push(addedAuthorsCount+" author(s) added"+(duplicateAuthorCount?", "+duplicateAuthorCount+" author(s) were duplicates":""))}if(invalidAuthorsCount>0){messages.push(invalidAuthorsCount+" author(s) ignored because of invalid characters")}this.$el.customtip();$.notify({text:messages.join(", "),duration:5e3})},onClickEditTab:function onClickEditTab(){this.$(".editTab").removeClass("hidden");this.$(".sharingTab").addClass("hidden");this.$(".showEditTab").addClass("active");this.$(".showSharingTab").removeClass("active")},onClickSharingTab:function onClickSharingTab(){this.$(".sharingTab").removeClass("hidden");this.$(".editTab").addClass("hidden");this.$(".showSharingTab").addClass("active");this.$(".showEditTab").removeClass("active")},onCancelled:function onCancelled(e){e.preventDefault();this.trigger("cancelled",{model:this.model});this.remove()},onClose:function onClose(e){e.preventDefault();this.remove()}},{show:function show(opts){var options=opts||{},view,oldRemove;if(!options.collection){throw new Error("AuthorGroupAdministrationView.show must be passed a collection option")}if(options.projects){options.loading=false}else{options.projects=new ProjectSummaryCollection(undefined,{pagination:false});options.loading=true;options.projects.fetch()}view=new AuthorGroupAdministrationView({model:options.model||new AuthorGroup,projects:options.projects,clients:options.clients,prefillAuthor:options.prefillAuthor,onModelSaved:options.onModelSaved,collection:options.collection,loading:options.loading});oldRemove=view.remove;view.render();view.$el.showModal({draggable:"h1:first",className:"popup standardpopup",onClose:function onClose(){oldRemove.call(view)}});view.$("input[name=groupName]").focus();view.remove=function(){view.$el.removeModal()};return view}})});define("mustache!templates/addToAuthorGroupDialog",["lib/mustache"],function(mustache){var escapedTemplate='<h1 class="popuptitletext singlemargin-bottom">Add to Author List</h1>\n<div>\n<form>\n<label class="smallmargin-bottom db">Add "{{author}}" to Author List</label>\n<fieldset class="doublemargin-bottom">\n{{^hasNoAuthorGroups}}\n<ul class="groups sixcol singlepadding">\n<li class="groupentry">\n<input id="group_none" class="smallmargin-bottom" type="radio" name="authorGroup" value="-1" {{^inGroups}}checked="checked"{{/inGroups}}/><label for="group_none" class="smallmargin-left valigntextbottom">No Author List selected</label>\n</li>\n{{#authorGroups}}\n<li class="groupentry{{#hasAuthor}} hasauthor{{/hasAuthor}}">\n<input id="group_{{id}}" class="smallmargin-bottom" type="radio" name="authorGroup" value="{{id}}" {{#hasAuthor}}disabled="disabled" {{/hasAuthor}}/><label class="fivecol dib textellipsis customtip smallmargin-left valigntextbottom" title="{{#hasAuthor}}This author is already in the list &quot;{{name}}&quot;{{/hasAuthor}}{{^hasAuthor}}{{name}}{{/hasAuthor}} (owned by: {{owner}})" for="group_{{id}}"><span class="name">{{name}}</span><span class="lightgrey owner"> ({{owner}})</span></label>\n</li>\n{{/authorGroups}}\n</ul>\nOr <a class="createAuthorGroup">create a new one</a>\n{{/hasNoAuthorGroups}}\n{{#hasNoAuthorGroups}}\n<p>\nThis project does not have any Author Lists.\n</p>\n<p>\nWould you like to <a class="createAuthorGroup">create a new one?</a>\n</p>\n{{/hasNoAuthorGroups}}\n</fieldset>\n<button class="add defaultbutton"{{#hasNoAuthorGroups}} disabled="disabled"{{/hasNoAuthorGroups}}>Add to Author List</button>\n<button class="cancel-link utility-link button singlemargin-left" title="Close this window and discard all changes">Cancel</button>\n</form>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!templates/addToAuthorGroupSuccess",["lib/mustache"],function(mustache){var escapedTemplate="{{#undone}}\n<p>'<strong>{{authorname}}</strong>' has been removed from the Author group '<strong>{{groupname}}</strong>'</p>\n{{/undone}}\n{{^undone}}\n<p class=\"dib singlepadding-right\">'<strong>{{authorname}}</strong>' was successfully added to the Author group '<strong>{{groupname}}</strong>'</p>\n{{/undone}}";return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!templates/addToAuthorGroupError",["lib/mustache"],function(mustache){var escapedTemplate='<div class="status-message ui-component-state-error">Could not add "{{authorname}}" to "{{groupname}}"</div>';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/views/AddToAuthorGroupDialogView",["backbone","underscore","jquery","src/views/AuthorGroupAdministrationView","mustache!templates/addToAuthorGroupDialog","mustache!templates/addToAuthorGroupSuccess","mustache!templates/addToAuthorGroupError","src/packages/modalDialogs","src/packages/spin","src/packages/customtip"],function(Backbone,_,$,AuthorGroupAdministrationView,addToAuthorGroupDialogTemplate,successTemplate,errorTemplate){"use strict";var AddToAuthorGroupDialogView;return AddToAuthorGroupDialogView=Backbone.View.extend({className:"addToGroup addToAuthorGroupDialogView modular",events:function events(){return{"submit form":"onSubmit","click .groupentry":"onClickGroup","click .add":"onAddAuthorToGroup","click .close":"onClose","click .cancel-link":"onClose","click .createAuthorGroup":"onClickCreateAuthorGroup"}},removeStatusTimer:null,initialize:function initialize(options){options=options||{};var collection=options.collection,authorName=options.authorName,currentUserId=options.currentUserId;if(!collection){throw new Error("AddToAuthorGroupDialogView must be initialized with a AuthorGroupCollection")}if(!authorName){throw new Error("AddToAuthorGroupDialogView must be initialized with an authorName option")}if(!currentUserId){throw new Error("AddToAuthorGroupDialogView must be initialized with a currentUserId option")}this.authorName=authorName;this.currentUserId=currentUserId},render:function render(){var view=this,collection=view.collection,authorName=view.authorName,inGroups=collection.filter(function(aG){return _(aG.get("authors")).any(function(authName){return authName===authorName})}),html=addToAuthorGroupDialogTemplate({author:authorName,authorGroups:collection.map(function(group){return{id:group.id,name:group.get("name"),owner:group.isOwn(view.currentUserId)?"You":group.getOwner(),hasAuthor:_(inGroups).any(function(grp){return grp.id===group.id})}}),hasNoAuthorGroups:collection.length===0});view.$el.html(html).customtip()},onClickGroup:function onClickGroup(e){var $checkbox=$(e.target).find("input[type=radio]:not(:disabled)");if($checkbox.filter(":checked").length){$checkbox.prop("checked",false)}else{$checkbox.prop("checked",true)}$checkbox.trigger("change")},onSubmit:function onSubmit(e){e.preventDefault()},onAddAuthorToGroup:function onAddAuthorToGroup(e){e.preventDefault();this.addAuthorToGroup()},addAuthorToGroup:function addAuthorToGroup(){var targetGroupId=this.$("input[name=authorGroup]:checked").val(),targetModel=this.collection.get(targetGroupId),authors,self=this;if(!targetModel){return}if(targetGroupId==="group_none"){return}this.toggleButtonDisabled();authors=targetModel.get("authors");targetModel.save({authors:authors.concat(this.authorName)},{success:function success(){self.onAddAuthorToGroupSuccess(self.authorName,targetModel);self.remove()},error:function error(){self.toggleButtonDisabled();self.onAddAuthorToGroupError(self.authorName,targetModel)}})},toggleButtonDisabled:function toggleButtonDisabled(){var $button=this.$("button.add");if($button.is(":disabled")){return $button.prop("disabled",false)}return $button.prop("disabled",true)},onAddAuthorToGroupSuccess:function onAddAuthorToGroupSuccess(authName,m){$.notify({text:$(successTemplate({authorname:authName,groupname:m.get("name")})).text()})},onAddAuthorToGroupError:function onAddAuthorToGroupError(authName,m){this.removeStatusMessage();$(this.el).append(errorTemplate({authorname:authName,groupname:m.get("name")}));this.removeStatusAfterDelay()},removeStatusMessage:function removeStatusMessage(){$(this.el).find(".status-message").remove()},removeStatusAfterDelay:function removeStatusAfterDelay(){var self=this;clearTimeout(this.removeStatusTimer);this.removeStatusTimer=setTimeout(function(){self.removeStatusMessage()},8e3)},onClose:function onClose(e){e.preventDefault();this.close()},close:function close(){this.trigger("closed");this.remove()},onClickCreateAuthorGroup:function onClickCreateAuthorGroup(){AuthorGroupAdministrationView.show({prefillAuthor:this.authorName,collection:this.collection});this.close()}},{show:function show(options){options=options||{};if(!options.$target){throw new Error("AddToAuthorGroupDialogView.show must be passed an $target option")}var view=new AddToAuthorGroupDialogView({authorName:options.authorName,collection:options.collection,currentUserId:options.currentUserId}),remove=view.remove,$target=options.$target,offset=$target.offset(),targetOuterHeight=$target.outerHeight(),top=offset.top+targetOuterHeight,left=offset.left,$container,containerHeight;$container=view.$el.showModal({className:"popup smallpopup singlemargin-bottom",draggable:"header:first",mask:false,keepCentered:false}).getOverlay();view.render();containerHeight=$container.outerHeight();if(top+containerHeight>$(window).height()){top=Math.max(0,top-containerHeight-targetOuterHeight)}$container.css("top",top).css("left",left);view.bind("closed",function(){view.$el.removeModal()});view.remove=function(){this.$el.removeModal();remove.call(this);view.remove=remove};return view}})});define("mustache!templates/authorContextMenu",["lib/mustache"],function(mustache){var escapedTemplate='<ul>\n{{^isMentionAuthorline}}\n{{^hidePrimaryLink}}\n<li class="context-menu--item default showMentions" data-author="{{author}}"><a>View Mentions</a></li>\n<li class="context-menu--item separator"></li>\n{{/hidePrimaryLink}}\n{{#canAddToAuthorGroup}}\n<li class="context-menu--item addToAuthorGroup" data-author="{{author}}"><a>Add to an Author List</a></li>\n{{/canAddToAuthorGroup}}\n{{/isMentionAuthorline}}\n{{#isMentionAuthorline}}\n{{#canAddToAuthorGroup}}\n<li class="context-menu--item addToAuthorGroup default" data-author="{{author}}"><a>Add to an Author List</a></li>\n<li class="separator"></li>\n{{/canAddToAuthorGroup}}\n<li class="context-menu--item showMentions {{^canAddToAuthorGroup}}default{{/canAddToAuthorGroup}}" data-author="{{author}}"><a>View Mentions by {{author}}</a></li>\n{{/isMentionAuthorline}}\n{{#isFacebookProfile}}\n<li class="context-menu--item viewFacebookProfile"><a data-author="{{author}}">View Facebook Profile</a></li>\n{{/isFacebookProfile}}\n</ul>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!templates/authorContextMenuTwitter",["lib/mustache"],function(mustache){var escapedTemplate='<ul>\n{{^hidePrimaryLink}}\n<li class="context-menu--item default viewTwitterProfile" data-author="{{author}}"><a>View Twitter Profile</a></li>\n<li class="context-menu--item separator"></li>\n{{/hidePrimaryLink}}\n{{^hideMentions}}\n<li class="context-menu--item showMentions" data-author="{{author}}"><a>View Mentions {{preposition}} @{{author}}</a></li>\n{{/hideMentions}}\n{{#canAddToAuthorGroup}}\n<li class="context-menu--item addToAuthorGroup" data-author="{{author}}"><a>Add to an Author List</a></li>\n{{/canAddToAuthorGroup}}\n</ul>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!templates/authorContextMenuFacebook",["lib/mustache"],function(mustache){var escapedTemplate='<ul>\n{{^hidePrimaryLink}}\n<li class="context-menu--item default viewFacebookProfile" data-author="{{author}}" data-authorId="{{authorId}}"><a>View Facebook Profile</a></li>\n<li class="context-menu--item separator"></li>\n{{/hidePrimaryLink}}\n{{^hideMentions}}\n<li class="context-menu--item showMentions" data-author="{{author}}"><a>View Mentions by {{author}}</a></li>\n{{/hideMentions}}\n{{#canAddToAuthorGroup}}\n<li class="context-menu--item addToAuthorGroup" data-author="{{author}}"><a>Add to an Author List</a></li>\n{{/canAddToAuthorGroup}}\n</ul>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!templates/authorContextMenuInstagram",["lib/mustache"],function(mustache){var escapedTemplate='<ul>\n{{^hidePrimaryLink}}\n<li class="context-menu--item default viewInstagramProfile" data-author="{{author}}"><a>View Instagram Profile</a></li>\n<li class="context-menu--item separator"></li>\n{{/hidePrimaryLink}}\n{{^hideMentions}}\n<li class="context-menu--item showMentions" data-author="{{author}}"><a>View Mentions {{preposition}} @{{author}}</a></li>\n{{/hideMentions}}\n{{#canAddToAuthorGroup}}\n<li class="context-menu--item addToAuthorGroup" data-author="{{author}}"><a>Add to an Author List</a></li>\n{{/canAddToAuthorGroup}}\n</ul>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/views/AuthorContextMenu",["backbone","underscore","jquery","src/permissions","src/globals/me","src/globals/currentDashboard","src/globals/authorGroups","src/components/mentions/_mentionsprofile/views/TwitterProfileView","src/views/ContextMenuView","src/components/mentions/_mentionsprofile/views/FacebookProfileView","src/components/mentions/_mentionsprofile/views/InstagramProfileView","src/views/AddToAuthorGroupDialogView","src/analytics/Analytics","mustache!templates/authorContextMenu","mustache!templates/authorContextMenuTwitter","mustache!templates/authorContextMenuFacebook","mustache!templates/authorContextMenuInstagram","src/packages/modalDialogs"],function(Backbone,_,$,permissions,me,currentDashboard,authorGroups,TwitterProfileView,ContextMenuView,FacebookProfileView,InstagramProfileView,AddToAuthorGroupDialogView,Analytics,template,twitterTemplate,facebookTemplate,instagramTemplate){"use strict";function trackClickTwitterProfile(username){Analytics.trackEvent({name:"Miscellaneous.Author_Context_Menu",action:"Click_Twitter_Profile",origin:"Application",values:{username:username}})}return ContextMenuView.extend({tagName:"nav",className:"authorContextMenu context-menu popupframe",events:function events(){return{"click li.showMentions":"openMentions","click li.addToAuthorGroup":"onAddToAuthorGroup","click .viewTwitterProfile":"onClickViewTwitterProfile","click .viewFacebookProfile":"onClickViewFacebookProfile","click .viewInstagramProfile":"onClickViewInstagramProfile"}},initialize:function initialize(options){_(this).bindAll("render","openMentions","onAddToAuthorGroup");if(!options||!options.settings){throw new Error("options.settings must be defined!")}this.model=this.model||new Backbone.Model({authorId:options.authorId,author:options.author,domain:options.domain,queryId:options.settings.get("queryId"),settings:options.settings});this.settings=options.settings;this.mentionsOptions=options.mentionsOptions;this.openMentionsCallback=options.openMentionsCallback;this.isFacebookProfile=options.isFacebookProfile;this.isTwitterProfile=options.isTwitterProfile;this.isInstagramProfile=options.isInstagramProfile;this.isMentionAuthorline=options.isMentionAuthorline;this.hidePrimaryLink=options.hidePrimaryLink;this.hideMentions=options.hideMentions;this.$target=options.$target;this.preposition=options.preposition||"by";this.model.bind("change",this.render,this)},render:function render(){if(this.isTwitterProfile){this.$el.html(twitterTemplate({author:this.model.get("author"),canAddToAuthorGroup:permissions.check("edit.groups",currentDashboard),isMentionAuthorline:this.isMentionAuthorline,hidePrimaryLink:this.hidePrimaryLink,hideMentions:this.hideMentions,preposition:this.preposition}))}else if(this.isFacebookProfile){this.$el.html(facebookTemplate({authorId:this.model.get("authorId"),author:this.model.get("author"),canAddToAuthorGroup:permissions.check("edit.groups",currentDashboard),isMentionAuthorline:this.isMentionAuthorline,hidePrimaryLink:this.hidePrimaryLink,hideMentions:this.hideMentions}))}else if(this.isInstagramProfile){this.$el.html(instagramTemplate({author:this.model.get("author"),canAddToAuthorGroup:permissions.check("edit.groups",currentDashboard),hidePrimaryLink:this.hidePrimaryLink,hideMentions:this.hideMentions,preposition:this.preposition}))}else{this.$el.html(template({author:this.model.get("author"),canAddToAuthorGroup:permissions.check("edit.groups",currentDashboard),isFacebookProfile:this.isFacebookProfile,isMentionAuthorline:this.isMentionAuthorline,hidePrimaryLink:this.hidePrimaryLink}))}},checkDefaultActionConditions:function checkDefaultActionConditions(options){return options.openDefault||!permissions.check("edit.groups",currentDashboard)},performDefaultAction:function performDefaultAction(){this.openMentions()},onAddToAuthorGroup:function onAddToAuthorGroup(){var pos=this.$el.position();this.addToAuthorGroup(this.model.get("author"),{top:pos.top-20,left:pos.left+20})},addToAuthorGroup:function addToAuthorGroup(author){AddToAuthorGroupDialogView.show({authorName:author,currentUserId:me.id,$target:this.$target,collection:authorGroups})},openMentions:function openMentions(){var authorName=this.model.get("author"),domain=this.model.get("domain"),mentionSettings={},mentionsOptions=this.mentionsOptions||{author:authorName,exactAuthor:true,authorGroup:[]};if(domain){mentionsOptions.site=domain}if(this.isTwitterProfile){mentionsOptions.pageType="twitter";mentionSettings.title="Mentions "+this.preposition+" @"+authorName+" on Twitter"}if(this.isInstagramProfile){mentionsOptions.pageType="instagram";mentionSettings.title="Mentions "+this.preposition+" @"+authorName+" on Instagram"}mentionSettings.settings=this.settings.clone();mentionSettings.additionalOptions=mentionsOptions;mentionSettings.settings.set("page",0);mentionSettings.settings.set("pageSize",20);require("src/components/mentions/views/MentionsPopup").showMentions(mentionSettings);(this.openMentionsCallback||function(){Analytics.trackEvent({name:"Miscellaneous.AuthorContextMenu",action:"ShowMentions",origin:"Application"})})()},onClickViewTwitterProfile:function onClickViewTwitterProfile(e){e.preventDefault();e.stopPropagation();var author=$(e.currentTarget).data("author");if(!author){return}trackClickTwitterProfile(author);this.profileView=TwitterProfileView.show(author);this.remove()},onClickViewFacebookProfile:function onClickViewFacebookProfile(e){var $target=$(e.currentTarget);var authorId=this.model.get("authorId");var author=$target.data("author");e.preventDefault();e.stopPropagation();FacebookProfileView.show({authorId:authorId,authorName:author,mentionUrl:"http://www.facebook.com/"+authorId,showPopularity:false});this.remove()},onClickViewInstagramProfile:function onClickViewInstagramProfile(e){var $target=$(e.currentTarget);var author=$target.data("author");e.preventDefault();e.stopPropagation();InstagramProfileView.show({authorName:author});this.remove()}})});define("mustache!src/components/mentions/templates/addToSiteGroup",["lib/mustache"],function(mustache){var escapedTemplate='<h1 class="popuptitletext singlemargin-bottom">Add to Site List</span></h1>\n<div class="content">\n{{^complete}}\n<label class="smallmargin-bottom db">Add "{{domain}}" to Site List</label>\n<fieldset>\n{{^hasNoGroups}}\n<ul class="sixcol singlepadding groups">\n<li class="selected">\n<input type="radio" class="smallmargin-bottom" name="siteGroup" id="siteGroup-none" value checked /><label class="smallmargin-left valigntextbottom" for="siteGroup-none">No Site List selected</label>\n</li>\n{{#siteGroups}}\n<li{{#hasDomain}} class="hasauthor"{{/hasDomain}}>\n<input type="radio" class="smallmargin-bottom" name="siteGroup" id="siteGroup-{{id}}" value="{{id}}" {{#hasDomain}}disabled {{/hasDomain}}/>\n<label class="fivecol dib textellipsis customtip smallmargin-left valigntextbottom" title="{{#hasDomain}}This site is already in the list &quot;{{name}}&quot;{{/hasDomain}}{{^hasDomain}}{{name}}{{/hasDomain}} (owned by: {{owner}})" for="siteGroup-{{id}}"><span class="name">{{name}}</span><span class="lightgrey owner"> ({{owner}})</label>\n</li>\n{{/siteGroups}}\n</ul>\nOr <a class="createGroup">create a new one</a>\n{{/hasNoGroups}}\n{{#hasNoGroups}}\n<p>\nThis project does not have any Site Lists.\n</p>\n<p>\nWould you like to <a class="createGroup">create a new one</a>?\n</p>\n{{/hasNoGroups}}\n</fieldset>\n<p class="submit doublemargin-top">\n<button disabled class="add defaultbutton">Add to Site List</button>\n<button class="cancel button singlemargin-left">Cancel</button>\n<a class="help icon-bwhelp singlemargin-left" data-key="add-to-site-group"></a>\n</p>\n{{/complete}}\n{{#success}}\n<div class="successMessage">\n<h2>Site added to List!</h2>\n<p>\'<strong>{{domain}}</strong>\' was successfully added to the Site List \'<strong>{{siteGroupName}}</strong>\'.</p>\n<p>(Use the "Site Lists" section in "Tools" to manage your Lists.)</p>\n</div>\n<p class="close">\n<button class="close button">Close</button>\n</p>\n{{/success}}\n{{#error}}\n<div class="errorMessage">\n<h2>An error occurred</h2>\n<p>Please try again soon, or contact support</p>\n</div>\n{{/error}}\n<div class="overlay hidden"></div>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/components/mentions/templates/addToSiteGroupSuccessNotification",["lib/mustache"],function(mustache){var escapedTemplate="{{#undone}}\n<p>'<strong>{{domain}}</strong>' has been removed from the site group '<strong>{{siteGroupName}}</strong>'</p>\n{{/undone}}\n{{^undone}}\n<p class=\"dib singlepadding-right\">'<strong>{{domain}}</strong>' was successfully added to the site group '<strong>{{siteGroupName}}</strong>'</p>\n{{/undone}}";return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/components/mentions/views/AddToSiteGroupView",["backbone","underscore","jquery","src/globals/siteGroups","mustache!src/components/mentions/templates/addToSiteGroup","mustache!src/components/mentions/templates/addToSiteGroupSuccessNotification","lib/jquery.notify","src/packages/customtip"],function(Backbone,_,$,globalSiteGroups,addToSiteGroupTemplate,addToSiteGroupSuccessNotification){"use strict";var singleView;var AddToSiteGroupView=Backbone.View.extend({className:"addToGroup addToSiteGroup modular",events:{"change input[type=radio]":"onChangeSelection","click .groupentry":"onClickGroup","click button.add":"onSubmit","click .cancel,a.close,button.close":"onCancel","click .createGroup":"onClickCreateGroup"},constructor:function AddToSiteGroupView(options){Backbone.View.apply(this,arguments);if(!options||!options.domain){throw new Error("options.domain must be specified!")}if(!options.userId){throw new TypeError("AddToSiteGroupView must be constructed with a userId option")}this.userId=options.userId;this.domain=options.domain},render:function render(){var view=this,viewDomain=view.domain,inGroups=globalSiteGroups.filter(function(sg){return _(sg.get("domains")).any(function(domain){return viewDomain===domain})});if(!view.success){view.$el.html(addToSiteGroupTemplate({domain:viewDomain,error:view.error,complete:view.success||view.error,siteGroupName:view.siteGroup,siteGroups:globalSiteGroups.chain().sortBy(function(sg){return sg.get("name").toLowerCase()}).map(function(sg){return{id:sg.id,name:sg.get("name"),owner:sg.isOwn(view.userId)?"You":sg.getOwner(),hasDomain:_(inGroups).any(function(grp){return grp.id===sg.id})}}).value(),hasNoGroups:globalSiteGroups.size()===0})).customtip()}else{view.notifyConfirmation();view.remove()}},notifyConfirmation:function notifyConfirmation(){$.notify({text:$(addToSiteGroupSuccessNotification({domain:this.domain,siteGroupName:this.siteGroup})).text()})},onClickGroup:function onClickGroup(e){var $checkbox=$(e.target).find("input[type=radio]:not(:disabled)");if($checkbox.filter(":checked").length){$checkbox.prop("checked",false)}else{$checkbox.prop("checked",true)}$checkbox.trigger("change")},onChangeSelection:function onChangeSelection(){var $checked=this.$("input[type=radio]:checked"),noSiteListSelected=$checked.attr("value")==="";this.$("fieldset li").removeClass("selected");$checked.closest("li").addClass("selected");this.$(".add").prop("disabled",noSiteListSelected)},onSubmit:function onSubmit(){var self=this,$checked=this.$("input[type=radio]:checked"),siteGroupId=parseInt($checked.val(),10),siteGroup=globalSiteGroups.get(siteGroupId);if(!siteGroup){return}this.updateSavingMode();siteGroup.save({domains:(siteGroup.get("domains")||[]).concat(this.domain)},{success:function success(){self.siteGroup=siteGroup.get("name");self.success=true;self.error=false;self.savedSiteGroupId=siteGroupId;self.render()},error:function error(){self.success=false;self.error=true;self.render()}})},updateSavingMode:function updateSavingMode(){var button=this.$(".submit button"),overlay=this.$(".overlay");overlay.removeClass("hidden");button.prop("disabled",true).html("Saving...")},onCancel:function onCancel(){this.remove()},onClickCreateGroup:function onClickCreateGroup(){var self=this,CreateEditSiteGroupView=require("src/views/CreateEditSiteGroupView"),SiteGroup=require("src/models/SiteGroup");CreateEditSiteGroupView.show({collection:globalSiteGroups,prefillDomain:self.domain,model:new SiteGroup});self.remove()}},{show:function show(options){if(!options.userId){throw new TypeError("AddToSiteGroupView.show must be called with a userId option")}var view=new AddToSiteGroupView(options),remove=view.remove;if(singleView){singleView.remove()}singleView=view;view.render();view.$el.showModal({className:"popup smallpopup",draggable:"header:first",onClose:function onClose(){view.remove()},mask:false,top:options.top,left:options.left,keepCentered:false});view.remove=function(){this.$el.removeModal();remove.call(this)};return view}});return AddToSiteGroupView});define("src/components/mentions/_bulk/models/BulkAction",["backbone"],function(Backbone){"use strict";return Backbone.Model.extend({})});define("src/components/mentions/_bulk/models/BulkActionCollection",["backbone","underscore","src/globals/currentProject","src/events/projectEvents","src/events/globalEventNames","src/components/mentions/_bulk/models/BulkAction","moment"],function(Backbone,_,currentProject,projectEvents,globalEventNames,BulkAction,moment){"use strict";var PROJECT_EVENT_NAMES=globalEventNames.PROJECTS,POLL_INTERVAL=1e4;return Backbone.Collection.extend({model:BulkAction,initialize:function initialize(){this.isPolling=false;this.on("change",this.onStatusChange,this)},url:"/projects/{projectId}/bulkactions",startPolling:function startPolling(){var self=this;if(this.isPolling){return}this.isPolling=true;this.fetchAndQueue();currentProject.onLoad(function(done){self.stopPolling();done()})},stopPolling:function stopPolling(){if(this.isPolling){clearTimeout(this.timer);this.isPolling=false}},getTimespanForBulkActions:function getTimespanForBulkActions(){return moment.utc(new Date).subtract({h:1}).toJSON()},getQueryData:function getQueryData(){return{sinceDate:this.getTimespanForBulkActions()}},parse:function parse(response){return _(response.results).map(function(result){if(result.metadata){result.authorName=result.metadata.authorName;result.domain=result.metadata.domain;delete result.metadata}return result})},onStatusChange:function onStatusChange(model){var text,actionInProgress;if(model.changedAttributes()&&model.changedAttributes().status==="done"){switch(model.get("type")){case"location":text='Location changes have been applied to mentions. "Reload data" to update your Dashboard.';break;case"author":text="Author changes for @"+model.escape("authorName")+" have been applied. "+"Reload data to update your Dashboard.";break;default:text="Your bulk action setting "+model.get("type")+" has been applied. "+"Reload data to update your Dashboard.";break}if(text){this.triggerNotification(text)}}actionInProgress=this.any(function(model){return model.get("status")!=="done"});if(!actionInProgress){this.stopPolling()}},triggerNotification:function triggerNotification(text){projectEvents.trigger(PROJECT_EVENT_NAMES.NOTIFICATION_SHOWN,{text:text,cssClass:"notification-success"})},queueFetch:function queueFetch(){if(this.timer){clearTimeout(this.timer)}this.timer=null;if(!this.isPolling){return}this.timer=setTimeout(_.bind(this.fetchAndQueue,this),POLL_INTERVAL)},fetchAndQueue:function fetchAndQueue(){this.fetch({set:true,reset:false,success:_.bind(this.queueFetch,this),error:_.bind(this.queueFetch,this)})}})});define("src/globals/bulkActions",["src/components/mentions/_bulk/models/BulkActionCollection"],function(BulkActionCollection){"use strict";return new BulkActionCollection});define("src/models/DataMethods",["backbone","underscore","src/globals/currentDashboard","src/models/Controls"],function(Backbone,_,currentDashboard,Controls){"use strict";function createSettings(settings,ControlsModel){settings=settings||new ControlsModel({},{timezone:currentDashboard.getTimezone()});if(!(settings instanceof ControlsModel)){if(settings instanceof Backbone.Model){throw new Error("options.settings must inherit from this.controlsModel")}settings=new ControlsModel(settings,{timezone:currentDashboard.getTimezone()})}return settings}function isXhrInProgress(xhr){return xhr&&xhr.readyState>0&&xhr.readyState<4}return{controlsModel:Controls,initialize:function initialize(attrs,options){options=options||{};this.initSettings(options.settings)},initSettings:function initSettings(settings){this.settings=createSettings(settings,this.controlsModel);this.settings.on("change",this.onSettingsChanged,this)},onSettingsChanged:function onSettingsChanged(){this.reloadData()},reloadData:function reloadData(){if(!this.settings.set({},{validate:true})){return}var self=this,changedKeys=_.keys(this.settings.changedAttributes()||{}),ignoredKeys=[].concat(_.result(this,"doNotFetchOnSettingsChange")||[]),triggeredChange=false,changeEventName=this.reset?"reset":"change",fetchKeys=_.difference(changedKeys,ignoredKeys);if(fetchKeys.length===0&&changedKeys.length>0||changedKeys.length>1&&fetchKeys.length===1&&fetchKeys[0]==="lastUpdated"){this.trigger("request",this);return _.defer(function(){self.trigger("change",self);self.trigger("sync",self)})}function changeSpy(){triggeredChange=true}this.cancelFetch();this._lastFetchXhr=this.fetch({success:function success(model,options){if(!triggeredChange){self.trigger(changeEventName,self,options)}self.off(changeEventName,changeSpy,self,options)}});this.on(changeEventName,changeSpy,this)},cancelFetch:function cancelFetch(){var xhr=this._lastFetchXhr;if(isXhrInProgress(xhr)){xhr.abort()}},getQueryData:function getQueryData(){return this.settings.getQueryData()},sync:function sync(method,modelOrCollection,options){var originalSuccess=options&&options.success;var originalError=options&&options.error;options.success=function(data,textStatus,jqXHR){modelOrCollection.hasSolrData=jqXHR&&jqXHR.getResponseHeader("x-solr-mentions")==="true";if(originalSuccess){originalSuccess.call(modelOrCollection,data,textStatus,jqXHR)}};options.error=function(jqXHR,textStatus,errorThrown){modelOrCollection.hasSolrData=jqXHR&&jqXHR.getResponseHeader("x-solr-mentions")==="true";if(originalError){originalError.call(modelOrCollection,jqXHR,textStatus,errorThrown)}};return Backbone.sync.call(this,method,modelOrCollection,options)}}});define("src/models/DataModel",["underscore","backbone","src/models/DataMethods"],function(_,Backbone,DataMethods){"use strict";return Backbone.Model.extend(_.extend({},DataMethods,{sync:function sync(method,model,options){var originalSuccess=options&&options.success;options.success=function(data,textStatus,jqXHR){if(typeof data.backfillDetails==="undefined"&&model.has("backfillDetails")){data.backfillDetails=null}if(typeof originalSuccess==="function"){originalSuccess.call(model,data,textStatus,jqXHR)}};return DataMethods.sync.call(this,method,model,options)}}))});define("src/components/mentions/models/Mention",["src/models/DataModel","src/events/mentionEvents","underscore","moment"],function(DataModel,mentionEvents,_,moment){"use strict";function extendPatchAttrs(oldAttrs,newAttrs){var attrs=oldAttrs;_(newAttrs).forEach(function(value,key){if(attrs[key]&&_.isArray(attrs[key])){attrs[key]=_.unique(attrs[key].concat(value))}else{attrs[key]=value}});return attrs}function makePatch(method,model){return function doPatch(){if(model._patching){model.patchTimeout=setTimeout(doPatch,1e3);return}var attrs=model._pendingPatches.attrs,successes=model._pendingPatches.successes,errors=model._pendingPatches.errors,options={attrs:_.extend({date:model.get("date")},attrs),success:function success(data){var args=_.toArray(arguments);model._sentAttributes=attrs;model._sendingAttributes={};data=extendPatchAttrs(data,model.pendingAttributes());model._patching=false;_(successes).forEach(function(success){args[0]=_.clone(data);success.apply(this,args)},this);notifyMentionEventsOfChange(model,attrs)},error:function error(){var args=_.toArray(arguments);model._patching=false;_(errors).forEach(function(error){error.apply(this,args)},this)},patch:true};model._sendingAttributes=attrs;model._pendingPatches.attrs={};model._pendingPatches.successes=[];model._pendingPatches.errors=[];model._patching=true;DataModel.prototype.sync.call(model,method,model,options)}}function notifyMentionEventsOfChange(model,changedAttributes){if(changedAttributes.hasOwnProperty("assignment")){mentionEvents.trigger("assigned",{id:model.id,assignee:changedAttributes.assignment})}if(changedAttributes.hasOwnProperty("removeAssignment")){mentionEvents.trigger("unassigned",{id:model.id})}mentionEvents.trigger("change",model,changedAttributes)}function queuePatch(method,model,options){if(options.success){model._pendingPatches.successes.push(options.success)}if(options.error){model._pendingPatches.errors.push(options.error)}clearTimeout(model.patchTimeout);model.patchTimeout=setTimeout(makePatch(method,model),1e3)}return DataModel.extend({initialize:function initialize(){DataModel.prototype.initialize.apply(this,arguments);this._pendingPatches={};this._pendingPatches.attrs={};this._pendingPatches.successes=[];this._pendingPatches.errors=[]},pendingAttributes:function pendingAttributes(){return _.extend({},this._pendingPatches.attrs,this._sendingAttributes)},sentAttributes:function sentAttributes(){return _.clone(this._sentAttributes)},url:function url(){return"/projects/{projectId}/queries/"+this.get("queryId")+"/mentions/"+(this.get("resourceId")||"")},set:function set(key,value,options){var attrs;if(_.isObject(key)||!key){attrs=key;options=value}else{attrs={};attrs[key]=value}attrs=_.clone(attrs);if(attrs.addCategories){attrs.categories=_.unique((attrs.categories||this.get("categories")||[]).concat(attrs.addCategories));delete attrs.addCategories}if(attrs.removeCategories){attrs.categories=_.difference(attrs.categories||this.get("categories")||[],attrs.removeCategories);delete attrs.removeCategories}if(attrs.addTag){attrs.tags=_.unique((attrs.tags||this.get("tags")||[]).concat(attrs.addTag));delete attrs.addTag}if(attrs.removeTag){attrs.tags=_.difference(attrs.tags||this.get("tags")||[],attrs.removeTag);delete attrs.removeTag}if(attrs.addClassifications){attrs.classifications=_.unique((attrs.classifications||this.get("classifications")||[]).concat(attrs.addClassifications));delete attrs.addClassifications}if(attrs.removeClassifications){attrs.classifications=_.difference(attrs.classifications||this.get("classifications")||[],attrs.removeClassifications);delete attrs.removeClassifications}if(attrs.removeAssignment){attrs.assignment=attrs.assignment||this.get("assignment");if(attrs.assignment===attrs.removeAssignment){attrs.assignment=null}delete attrs.removeAssignment}if(attrs.removePriority){attrs.priority=attrs.priority||this.get("priority");if(attrs.priority===attrs.removePriority){attrs.priority=null}delete attrs.removePriority}if(attrs.removeStatus){attrs.status=attrs.status||this.get("status");if(attrs.status===attrs.removeStatus){attrs.status=null}delete attrs.removeStatus}if(attrs.location){delete attrs.location}return DataModel.prototype.set.call(this,attrs,options)},parse:function parse(resp){if(resp.pageType==="twitter"&&resp.fullname){resp.twitterFullName=resp.fullname}if(resp.pageType==="twitter"&&resp.title){resp.title=resp.title.replace(/^Twitter \/ /,"")}resp.id=resp.resourceId+"-"+resp.queryId;if(resp.lastAssignmentDate){resp.lastAssignmentTick=moment(resp.lastAssignmentDate).valueOf()}if(resp.hasOwnProperty("publicationName")&&!(_.isUndefined(resp.publicationName)||_.isNull(resp.publicationName))){resp.isOfflinePublication=true}else{resp.isOfflinePublication=false}if(!resp.hasOwnProperty("classifications")){resp.classifications=[]}return resp},toJSON:function toJSON(){return _(DataModel.prototype.toJSON.apply(this,arguments)).omit("lastAssignmentTick")},save:function save(attrs,options){if(options&&options.patch){this._pendingPatches.attrs=extendPatchAttrs(this._pendingPatches.attrs,attrs)}DataModel.prototype.save.call(this,attrs,options)},destroy:function destroy(options){options=Object.assign({},options);options.data=Object.assign({},options.data,{date:this.get("date")});return DataModel.prototype.destroy.call(this,options)},sync:function sync(method,model,options){if(!options.patch){return DataModel.prototype.sync.call(this,method,model,options)}return queuePatch(method,model,options)},isFacebook:function isFacebook(){return this.get("pageType")==="facebook"},isInstagram:function isInstagram(){return this.get("pageType")==="instagram"},isTwitter:function isTwitter(){return this.get("pageType")==="twitter"},isGeneric:function isGeneric(){return!(this.isTwitter()||this.isFacebook()||this.isInstagram())}})});define("src/models/CombinedQueryControls",["underscore","src/models/Controls"],function(_,Controls){"use strict";function useIdWhenNoValidQueryId(attrs){var queryId=attrs.queryId,queryIdIsArray=_.isArray(queryId);if(!attrs.id||attrs.queryGroupId){return}if(queryIdIsArray&&!queryId.length||!queryIdIsArray&&!_.isNumber(queryId)){attrs.queryId=parseInt(attrs.id,10)}}return Controls.extend({supportsQueryGroups:true,set:function set(key,value,options){var attrs;if(_.isObject(key)||!key){attrs=key;options=value}else{attrs={};attrs[key]=value}if(attrs.queries&&!attrs.queryId){attrs.queryId=_([].concat(attrs.queries)).map(function(query){return parseInt(query.id,10)})}if(attrs.groupID&&!attrs.queryGroupId){attrs.queryGroupId=parseInt(attrs.groupID,10)}delete attrs.queries;delete attrs.groupID;if(_.isNumber(attrs.queryGroupId)&&attrs.queryGroupId<1&&(!options||!options.unset)){delete attrs.queryGroupId}if(attrs.queryGroupId||attrs.queryId){attrs.currentMode=attrs.currentMode||(attrs.queryGroupId?"queryGroup":"query")}useIdWhenNoValidQueryId(attrs);return Controls.prototype.set.call(this,attrs,options)},getQueryData:function getQueryData(){var currentMode=this.getCurrentMode(),queryGroupId=this.get("queryGroupId"),queryData=Controls.prototype.getQueryData.call(this);if(currentMode==="queryGroup"){delete queryData.queryId;queryData.queryGroupId=queryGroupId}else if(queryData.queryGroupId){delete queryData.queryGroupId}return queryData},getCurrentMode:function getCurrentMode(attrs){attrs=attrs||{};var currentMode=attrs.currentMode||this.get("currentMode");if(!currentMode){currentMode=attrs.queryGroupId||this.get("queryGroupId")?"queryGroup":"query"}return currentMode},parseQueryId:function parseQueryId(attrs){if(attrs.queryId){attrs.queryId=[].concat(attrs.queryId)}},dataSpec:function dataSpec(attrs){var oldSpec=Controls.prototype.dataSpec.apply(this,arguments),currentMode=this.getCurrentMode(attrs);if(currentMode==="queryGroup"){delete oldSpec.queryId;oldSpec.queryGroupId={required:true};attrs.queryGroupId="queryGroupId"in attrs?attrs.queryGroupId:this.get("queryGroupId")||""}else{oldSpec.queryId={type:"array",required:true};attrs.queryId="queryId"in attrs?attrs.queryId:this.get("queryId")||undefined}return oldSpec}})});define("src/components/mentions/models/MentionsControls",["underscore","src/globals/categories","src/globals/workflow","src/models/CombinedQueryControls"],function(_,categories,workflow,CombinedQueryControls){"use strict";var deadColumn="OLD_AND_DEAD",columnNameMap={bwscore:"id",showSummaries:"summary",on:deadColumn,brandSentiment:"sentiment",siteType:"pageType",socialGraph:deadColumn,forum_post_count:"forumPosts",forum_view_count:"forumViews",blog_comment_count:"blogComments",twitter_post_count:"twitterPostCount",twitter_follower_count:"twitterFollowers",twitter_following_count:"twitterFollowing",hosticon:"favicon",hostname:"domain",seomoz_domain_mozrank:"mozRank",seomoz_num_backlinks:"backlinks",location:"location",monthly_visitors:"monthlyVisitors",average_visits:"averageVisits",average_pages:"pagesPerVisit",visitor_minutes:"averageDurationOfVisit",percent_male:"percentMaleVisitors",percent_female:"percentFemaleVisitors",comscore_average_pages:"pagesPerVisit",comscore_average_visits:"averageVisits",comscore_monthly_visitors:"monthlyVisitors",comscore_visitor_minutes:"averageDurationOfVisit",comscore_percent_female:"percentFemaleVisitors",comscore_percent_male:"percentMaleVisitors","categoriesByName.Management Categories.Assignment":"assignment","categoriesByName.Management Categories.Checked":"checked","categoriesByName.Management Categories.Priority":"priority","categoriesByName.Management Categories.Status":"status",visitors:"monthlyVisitors",twitterTweets:"twitterPostCount",averagePages:"pagesPerVisit",percentMale:"percentMaleVisitors",percentFemale:"percentFemaleVisitors",duration:"averageDurationOfVisit",assignee:"assignment",tweets:"twitterPostCount"};function getNewCategoryColumnName(columnName){var categoryName=columnName.substring("category.".length),category=categories.find(function(cat){return cat.get("name")===categoryName});if(!category){return columnName}return"category/"+category.id}function updateOldVisibleColumns(data){if(data.visibleColumns){data.visibleColumns=_(data.visibleColumns).reduce(function(memo,key){var newKey=columnNameMap[key]||key;if(newKey===deadColumn){return memo}newKey=newKey.replace("categoriesByName.Management Categories","category");if(newKey.indexOf("category.")===0){newKey=getNewCategoryColumnName(newKey)}memo.push(newKey);return memo},[])}}function updateSortAttribute(attrs){if(attrs.sort){if(attrs.sort.indexOf("category.")===0){var catName=attrs.sort.substring("category.".length),cat=categories.getByName(catName);attrs.orderBy="date";if(catName&&cat){attrs.orderBy="category/"+cat.id}else if(catName){_(workflow.toJSON()).each(function(value,key){if(value.name===catName){attrs.orderBy=key}})}}else if(attrs.sort==="category"){attrs.orderBy="category/"+attrs.sortCat;attrs.sortCat=parseInt(attrs.sortCat,10);if(!categories.get(attrs.sortCat)){attrs.orderBy="date";_(workflow.toJSON()).each(function(value,key){if(value.id===attrs.sortCat){attrs.orderBy=key}})}}else if(attrs.sort==="timestamp"){attrs.orderBy="date"}else{attrs.orderBy=columnNameMap[attrs.sort]||attrs.sort}delete attrs.sort}if(attrs.sortCat){delete attrs.sortCat}if(attrs.direction){attrs.orderDirection=attrs.direction;delete attrs.direction}if(attrs.orderDirection){attrs.orderDirection=attrs.orderDirection.replace(/ending$/,"")}if(attrs.orderBy){attrs.orderBy=columnNameMap[attrs.orderBy]||attrs.orderBy}}function updateOldAttributeNames(attrs){if(!_.isUndefined(attrs.count)){attrs.pageSize=attrs.count;delete attrs.count}if(!_.isUndefined(attrs.start)&&!_.isUndefined(attrs.pageSize)){attrs.page=parseInt(attrs.start/attrs.pageSize,10);delete attrs.start}if(!_.isUndefined(attrs.term)){attrs.search=attrs.term;delete attrs.term}if(!_.isUndefined(attrs.site)){attrs.domain=attrs.site;delete attrs.site}}return CombinedQueryControls.extend({defaults:function defaults(){var defaults=CombinedQueryControls.prototype.defaults.apply(this,arguments);return _.defaults(defaults,{orderBy:"date",orderDirection:"desc",page:0,pageSize:20,currentMode:"query"})},initialize:function initialize(attrs){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};this.youtubeOnly=options.youtubeOnly||false;CombinedQueryControls.prototype.initialize.call(this,arguments)},set:function set(key,value){var attrs;if(_.isObject(key)||!key){attrs=key}else{attrs={};attrs[key]=value}updateOldVisibleColumns(attrs);updateSortAttribute(attrs);updateOldAttributeNames(attrs);if(this.get("liveStreaming")&&attrs.search){attrs.search=""}return CombinedQueryControls.prototype.set.apply(this,arguments)},getQueryData:function getQueryData(){var queryData=CombinedQueryControls.prototype.getQueryData.call(this);delete queryData.projectId;if(queryData.orderBy&&queryData.orderBy.indexOf("category/")===0){queryData.orderByCategory=queryData.orderBy.substring("category/".length);queryData.orderBy="category"}if(typeof queryData.dayOfWeek!=="undefined"){queryData.timezone=this.timezone}if(typeof queryData.hourOfDay!=="undefined"){queryData.timezone=this.timezone}var logoImagesGroupId=this.get("logoImagesGroupId");if(logoImagesGroupId){queryData.logoImagesGroupId=logoImagesGroupId}if(this.youtubeOnly){return Object.assign({},queryData,{youtubeOnly:true})}return queryData},getQueryDataFieldNames:function getQueryDataFieldNames(){return CombinedQueryControls.prototype.getQueryDataFieldNames.apply(this,arguments).concat(["orderBy","orderByCategory","orderDirection","page","pageSize","emojis"])}},{columnNameMap:columnNameMap})});define("src/models/DataCollection",["backbone","src/models/DataMethods"],function(Backbone,DataMethods){"use strict";return Backbone.Collection.extend(DataMethods)});define("src/components/mentions/models/MentionCollection",["backbone","underscore","jquery","moment","src/globals/bulkActions","src/ApiError","src/Workbench","src/components/mentions/models/Mention","src/components/mentions/models/MentionsControls","src/models/DataCollection","bw-fe-helpers/dateHelper","bw-fe-helpers/promiseHelper"],function(Backbone,_,$,moment,bulkActions,ApiError,Workbench,Mention,MentionsControls,DataCollection,dateHelper,promiseHelper){"use strict";var MentionCollection;return MentionCollection=DataCollection.extend({model:Mention,controlsModel:MentionsControls,constructor:function MentionCollection(){DataCollection.apply(this,arguments)},getQueryData:function getQueryData(){var data=this.settings.getQueryData();if(this.isStreaming()){data.endDate=moment.utc(dateHelper.removeTimezoneOffset(dateHelper.today())).add(2,"days").toISOString();data.orderBy="added";data.orderDirection="desc"}if(this.isPublicationSet()){data.publication=this.settings.get("publication")}Object.assign(data,this.getPagination());return data},url:"/projects/{projectId}/data/mentions",parse:function parse(data){this.backfillDetails=data.backfillDetails;this.archiveDataSize=data.archiveDataSize;this.inflatedArchiveDataSize=data.inflatedArchiveDataSize;this.ongoingDataSize=data.ongoingDataSize;this.inflatedTotalDataSize=data.inflatedTotalDataSize;this.resultsPage=data.resultsPage;this.resultsPageSize=data.resultsPageSize;this.resultsTotal=data.resultsTotal;this.maximumIdInResult=data.maximumIdInResult;this.prevCursor=data.prevCursor;this.nextCursor=data.nextCursor;return data.results},reset:function reset(){this.resultsPage=undefined;this.resultsPageSize=undefined;this.resultsTotal=undefined;this.maximumIdInResult=undefined;this.prevCursor=undefined;this.nextCursor=undefined;this.pagination=undefined;return DataCollection.prototype.reset.apply(this,arguments)},initialize:function initialize(attrs,options){_(this).bindAll("_checkForNewMentions","_resetTimeout","disableStreaming");DataCollection.prototype.initialize.apply(this,arguments);if(options&&options.settings&&options.settings.liveStreaming){this.enableStreaming()}this.on("remove",this.onRemove,this)},doNotFetchOnSettingsChange:["visibleColumns"],_checkForNewMentions:function _checkForNewMentions(){if(!this.isStreaming()){return}if(!this.settings.isValid()){return this._resetTimeout()}var self=this,options=this.getQueryData();options.sourceType="new";var latestAdded=this._findLatestAdded();if(latestAdded){options.sinceAdded=latestAdded}this.trigger("checkingForNewMentions");Backbone.sync("read",self,{data:options,streaming:true,success:function success(resp){if(resp&&resp.results&&resp.results.length){var page=options.page,pageSize=options.pageSize;var total=resp.resultsTotal-page*pageSize;self.trigger("newMentions",total)}self._liveStreamCheckInterval=self._liveStreamCheckInterval*1.5;clearTimeout(self._liveStreamTimeout);self._liveStreamTimeout=setTimeout(self._checkForNewMentions,self._liveStreamCheckInterval)}})},_findLatestAdded:function _findLatestAdded(){var added=this.map(function(model){return model.get("added")});added.sort();if(added.length){return added.pop()}return null},_resetTimeout:function _resetTimeout(){this._liveStreamCheckInterval=3e4;if(this.isStreaming()){clearTimeout(this._liveStreamTimeout);this._liveStreamTimeout=setTimeout(this._checkForNewMentions,this._liveStreamCheckInterval)}},enableStreaming:function enableStreaming(){var oldOrderBy=this.settings.get("oldOrderBy")||this.settings.get("orderBy");var oldOrderDirection=this.settings.get("oldOrderDirection")||this.settings.get("orderDirection");this.streaming=true;this.settings.set({orderBy:"added",orderDirection:"desc",oldOrderBy:oldOrderBy,oldOrderDirection:oldOrderDirection,liveStreaming:true});this.settings.on("change:orderBy",this.disableStreaming);this._resetTimeout()},disableStreaming:function disableStreaming(){clearTimeout(this._liveStreamTimeout);if(!this.streaming){return}this.settings.off("change:orderBy",this.disableStreaming);this.streaming=false;this.settings.set({orderBy:this.settings.get("oldOrderBy"),orderDirection:this.settings.get("oldOrderDirection"),oldOrderBy:"",oldOrderDirection:"",liveStreaming:false})},isStreaming:function isStreaming(){return!!this.streaming},isPublicationSet:function isPublicationSet(){return!!this.settings.get("publication")},isStreamingSet:function isStreamingSet(){return!!this.settings.get("liveStreaming")},nextPage:function nextPage(callback){var pageIndex=this.settings.get("page"),pageSize=this.settings.get("pageSize");this.moveToItem(pageIndex+1,pageSize,callback)},previousPage:function previousPage(callback){var pageIndex=this.settings.get("page"),pageSize=this.settings.get("pageSize");this.moveToItem(pageIndex-1,pageSize,callback)},moveToItem:function moveToItem(page,pageSize,callback){var self=this,pageSizeNow=this.settings.get("pageSize")||20,pageNow=this.settings.get("page")||0;if(page<0){return callback(new Error("Invalid page index: "+page))}if(page*pageSize>=this.resultsTotal){return callback(new Error("Invalid page index: "+page))}if(pageSizeNow!==pageSize||pageNow!==page){this._ignoreFetch=true;self.settings.set({pageSize:pageSize,page:page});this._ignoreFetch=false;this.fetch({success:function success(){callback()},error:function error(self,xhr){var err=new ApiError(xhr);callback(err)}})}else{callback()}},getPagination:function getPagination(){var page=this.settings.get("page"),pageSize=this.settings.get("pageSize"),lastPage=Math.ceil(this.resultsTotal/pageSize)-1;if(page===0||!(this.prevCursor||this.nextCursor)||typeof this.resultsPage==="undefined"){return this.pagination={page:page,pageSize:pageSize}}if(page===lastPage){return this.pagination={page:0,pageSize:pageSize,cursor:"*"}}page=page-this.resultsPage;if(page<0){return this.pagination={page:page+1,pageSize:pageSize,cursor:this.prevCursor}}else if(page>0){return this.pagination={page:page-1,pageSize:pageSize,cursor:this.nextCursor}}return this.pagination},save:function save(ids,attrs,options){var self=this,saveModels=this.chain().filter(function(mention){return ids.indexOf(mention.id)>-1}).map(function(mention){mention.set(attrs);return _.extend({resourceId:mention.get("resourceId"),queryId:mention.get("queryId"),date:mention.get("date")},attrs)}).value(),oldSuccess;options=options||{};options.patch=true;oldSuccess=options.success;options.success=function(updatedMentions){updatedMentions=_(updatedMentions).map(Mention.prototype.parse);self.add(updatedMentions,{merge:true});if(oldSuccess){oldSuccess.apply(this,arguments)}};Backbone.sync("patch",this,_.extend({},options,{url:"/projects/{projectId}/data/mentions",data:saveModels}))},fetch:function fetch(){if(this._ignoreFetch){return}this._resetTimeout();return DataCollection.prototype.fetch.apply(this,arguments)},submitBulkJob:function submitBulkJob(action,options){var self=this,filters=this.settings.getQueryData(),additionalFilters=options.filters||{},sampleAmount=options.sampleAmount,success=options.success,verb="create",data;options=_.clone(options);options.bulkJob=true;delete options.sampleAmount;delete options.filters;delete filters.page;delete filters.pageSize;delete filters.projectId;delete filters.orderBy;delete filters.orderByCategory;delete filters.orderDirection;if(success){options.success=function(resp){success(self,resp,options);bulkActions.startPolling()}}var filter=Object.assign({},filters,additionalFilters);if(action.deleted){verb="delete";data={filter:filter}}else{data={action:action,sampleAmount:sampleAmount,filter:filter}}return Backbone.sync(verb,this,_.extend({},options,{url:"/projects/{projectId}/bulkactions/mentions",data:data}))},bulkDelete:function bulkDelete(data,callback){promiseHelper.ajax({method:"DELETE",url:Workbench.buildApiUrl("/projects/{projectId}/data/mentions"),contentType:"application/json",data:JSON.stringify(data)}).then(function(){callback()}).catch(function(){callback(new Error("Could not delete mentions"))})},onRemove:function onRemove(){this.resultsTotal--},getOldestValue:function getOldestValue(sortingParam){if(this.isEmpty()){return null}return this.sortBy(sortingParam)[0].get(sortingParam)},missingCount:function missingCount(){return Math.max(this.resultsTotal-this.resultsPageSize,0)},getHistoricDataBreakdown:function getHistoricDataBreakdown(){return{archiveDataSize:this.archiveDataSize,inflatedArchiveDataSize:this.inflatedArchiveDataSize,ongoingDataSize:this.ongoingDataSize}}},{fromSearchLite:function fromSearchLite(attrs){var collection=new MentionCollection,clonedAttrs={};$.extend(true,clonedAttrs,attrs);collection.reset({maximumIdInResult:clonedAttrs.maximumResourceId,resultsPage:parseInt(clonedAttrs.start/clonedAttrs.count,10),resultsPageSize:parseInt(clonedAttrs.count,10),resultsTotal:parseInt(clonedAttrs.size,10),results:_.clone(clonedAttrs.items)},{parse:true});return collection}})});define("src/components/mentions/_singlemention/models/SingleMentionFacade",["backbone","underscore","bw-fe-helpers/dateHelper","src/globals/queries","src/components/mentions/models/MentionCollection","src/events/mentionEvents","src/events/globalEventNames"],function(Backbone,_,dateHelper,queries,MentionCollection,mentionEvents,globalEventNames){"use strict";var CHANNELS=[{domain:"facebook.com",pageType:"facebook"},{domain:"instagram.com",pageType:"instagram"},{domain:"twitter.com",pageType:"twitter"}];var CHANNEL_PAGETYPES=_.pluck(CHANNELS,"pageType");var CHANNEL_DOMAINS=_.pluck(CHANNELS,"domain");function SingleMentionFacade(collection,mentionId){if(!collection||!(collection instanceof MentionCollection)){throw new Error("SingleMentionFacade must be instantiated with a MentionCollection")}if(!mentionId){throw new Error("SingleMentionFacade must be instantiated with a mentionId")}this._mentions=collection;this.setMentionId(mentionId);this.listenTo(this._mentions.settings,"change:page",this._fetchCollection);this.listenTo(this._mentions,"change",this.triggerChange);return this}function trackMentionDeleteOrSpam(isSpam,queryId){var eventName;if(isSpam){eventName=globalEventNames.MENTIONS.MENTION_MARK_AS_SPAM}else{eventName=globalEventNames.MENTIONS.MENTION_DELETE}mentionEvents.trigger(eventName,{count:1,queryId:parseInt(queryId,10),queryType:queries.get(queryId).get("type")})}_.extend(SingleMentionFacade.prototype,Backbone.Events,{_fetchCollection:function _fetchCollection(){this._mentions.fetch()},getFormattedDateGivenTimezone:function getFormattedDateGivenTimezone(timezone){return dateHelper.format(this.get("date"),"DD MMM YYYY",{timezone:timezone})},getPageType:function getPageType(){var mention=this.getMentionModel();return mention&&mention.get("pageType")},getQueryId:function getQueryId(){var mention=this.getMentionModel();if(!mention){return null}return mention.get("queryId")},getSettings:function getSettings(){return this._mentions.settings},isChannelMentionGivenType:function isChannelMentionGivenType(channelType){return this.getPageType()===channelType},isChannelMentionGivenDomain:function isChannelMentionGivenDomain(challengeDomain){var channelDomain=this.get("domain");return channelDomain&&channelDomain.indexOf(challengeDomain)>-1},isChannelMention:function isChannelMention(){var hasMatchingChannelType=_.any(CHANNEL_PAGETYPES.map(this.isChannelMentionGivenType.bind(this)));var hasMatchingChannelDomain=_.any(CHANNEL_DOMAINS.map(this.isChannelMentionGivenDomain.bind(this)));return hasMatchingChannelType||hasMatchingChannelDomain},isBlogMention:function isBlogMention(){return this.getPageType()==="blog"},isForumMention:function isForumMention(){return this.getPageType()==="forum"},isNewsMention:function isNewsMention(){return this.getPageType()==="news"},remove:function remove(){},fetch:function fetch(){this._fetchCollection()},triggerChange:function triggerChange(){if(this._suppressChangeEvents){return}this.trigger("change",this)},getMention:function getMention(){var mention=this.getMentionModel();return mention&&mention.toJSON()},getMentionModel:function getMentionModel(){var mentionId=this._mentionId,mention=this._mentions.get(mentionId);while(!mention){mention=this._mentions.at(this._mentionIndex);if(!mention&&this._mentionIndex>0){this._mentionIndex--}else if(mention){this._mentionId=mention.id}else{break}}return mention},setMentionId:function setMentionId(mentionId){this._mentionId=mentionId;this._mentionIndex=this._mentions.chain().pluck("id").indexOf(this._mentionId).value();if(this._mentionIndex===-1){throw new Error("Mention "+mentionId+" not found")}},currentMentionIndex:function currentMentionIndex(){return this._mentionIndex},overallMentionIndex:function overallMentionIndex(){return this._mentions.resultsPage*this._mentions.resultsPageSize+this.currentMentionIndex()||0},canMovePrevious:function canMovePrevious(){return this.overallMentionIndex()>0},canMoveNext:function canMoveNext(){return this.overallMentionIndex()<this._mentions.resultsTotal-1},nextMention:function nextMention(callback){var self=this;var mentions=this._mentions;var end=mentions.resultsPage*mentions.resultsPageSize+mentions.size();var nextItem=mentions.at(this.currentMentionIndex()+1);if(nextItem){this.setMentionId(nextItem.id);this.trigger("change");return callback()}if(end>=mentions.resultsTotal){return callback(new Error("You are at the last mention already"))}if(this.fetchingPage){return callback(new Error("Please wait for the next mention to load"))}this.fetchingPage=true;this._suppressChangeEvents=true;this.nextPage(function(err){if(err){return callback(err)}self._suppressChangeEvents=false;self.setMentionId(mentions.at(0).id);self.triggerChange();self.fetchingPage=false;callback()})},nextPage:function nextPage(callback){return this._mentions.nextPage(callback)},previousPage:function previousPage(callback){return this._mentions.previousPage(callback)},previousMention:function previousMention(callback){var self=this,mentions=this._mentions,items=mentions.toJSON(),previousItem=items[this.currentMentionIndex()-1];if(previousItem){this.setMentionId(previousItem.id);this.trigger("change");return callback()}if(this.overallMentionIndex()<1){return callback(new Error("You are at the first mention already"))}if(this.fetchingPage){return callback(new Error("Please wait for the next mention to load"))}this.fetchingPage=true;self._suppressChangeEvents=true;this.previousPage(function(err){if(err){return callback(err)}items=mentions.toJSON();self._suppressChangeEvents=false;self.setMentionId(_.last(items).id);self.triggerChange();self.fetchingPage=false;return callback()})},get:function get(key){return this._mentions.get(this._mentionId).get(key)},save:function save(attrs,options){var mention=this.getMentionModel();mention.save(attrs,options)},destroy:function destroy(options){var self=this,mentions=this._mentions,mention=this._mentions.get(this._mentionId),queryId=mention.get("queryId"),currentIndex=this.currentMentionIndex(),success=(options=options||{}).success;options.success=function(){var nextMention=mentions.at(currentIndex)||mentions.at(currentIndex-1);if(nextMention){self.setMentionId(nextMention.id);self._suppressChangeEvents=false;self.triggerChange()}mentions.trigger("sync",mentions);trackMentionDeleteOrSpam(options.data.isSpam,queryId);return success&&success.apply(arguments)};options.data=options.data||{};mention.destroy(options)}});return SingleMentionFacade});define("src/components/notes/models/Note",["backbone"],function(Backbone){"use strict";return Backbone.Model.extend({url:function url(){return"/projects/{projectId}/data/mentions/"+this.get("resourceId")+"/notes/"+(this.id||"")},prepend:function prepend(options){var self=this,note=(options.header||"")+"\n"+options.text,data={};if(this.id){data.prependText=note}else{data.text=note}this.save(data,{patch:this.id?true:false,success:function success(){self.unset("prependText",{silent:true});if(options.success){options.success.apply(this,arguments)}},error:function error(){if(options.error){options.error.apply(this,arguments)}}})}})});define("mustache!src/components/notes/templates/notesView",["lib/mustache"],function(mustache){var escapedTemplate='<h1 class="popuptitletext singlemargin-bottom draggable">Add a note{{#mentionTitle}} for: "{{mentionTitle}}"{{/mentionTitle}}</h1>\n<div class="content">\n<p><textarea name="postText" class="field"></textArea></p>\n<p><button class="post button singlemargin-left">Post note</button></p>\n<h2>\nHistory\n{{#hasText}}\n{{#editing}}\n<span>(editing history)</span>\n{{/editing}}\n{{^editing}}\n<span>(<a class="edit link">edit history</a>)</span>\n{{/editing}}\n{{/hasText}}\n</h2>\n{{#editing}}\n<textarea name="editText" class="field">{{{plainText}}}</textarea>\n<p class="singlemargin-top">\n<button class="save defaultbutton">Save Changes</button>\n<button class="cancel button singlemargin-left">Cancel</button>\n</p>\n{{/editing}}\n{{^editing}}\n<pre class="history">\n{{#hasText}}{{{formattedText}}}{{/hasText}}\n{{^hasText}}No history yet. Type into the field above to add a note.{{/hasText}}\n</pre>\n<p>\n<a class="refresh">Refresh history</a>\n<a class="help icon-bwhelp" data-key="notes:notes-why-refresh"></a>\n</p>\n{{/editing}}\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/components/notes/css/notesView.css",["css!src/components/notes/css/compiled.css"],function(){});(function($,_){"use strict";$.fn.showMessage=function(options){if(!this.length){return this}var parent=$(this),self=this,$el=parent.children(".statusMessage"),$mask=parent.children(".statusMessageMask"),position=_.isUndefined(this.data("oldPosition"))?this[0].style.position:this.data("oldPosition"),overflow=_.isUndefined(this.data("oldOverflow"))?this[0].style.overflow:this.data("oldOverflow"),duration=options&&options.duration||null;options=_.isString(options)?{text:options}:options;options.className=options.className||"notification-info";if(!$el.length){$el=$("<div/>")}if(!$mask.length){$mask=$("<div class=statusMessageMask/>")}else{$mask.prop("class","statusMessageMask")}$mask.addClass(options.maskClassName);$el.html(options.text);$el.attr("class","statusMessage rounded smallpadding-vertical singlepadding-horizontal "+options.className);this.append($mask);if(options.text){this.append($el)}this.data("oldPosition",position);if(["relative","absolute"].indexOf(position)===-1){this.css("position","relative")}this.data("oldOverflow",overflow);this.css("overflow","hidden");this.updateMessagePosition(options,$el,$mask);if(duration&&_.isNumber(duration)&&!isNaN(duration)){window.setTimeout(function(){self.hideMessage(options.text)},duration)}return this};$.fn.updateMessagePosition=function(options,$el,$mask){var zIndex=10,offsetTop,offsetLeft,scrollTop,scrollLeft,parent=$(this);options=options||{};$el=$el||parent.children(".statusMessage");$mask=$mask||parent.children(".statusMessageMask");scrollTop=this.scrollTop();scrollLeft=this.scrollLeft();offsetTop=_.isNumber(options.offsetTop)?options.offsetTop:Math.ceil($el.height()/2);offsetLeft=_.isNumber(options.offsetLeft)?options.offsetLeft:Math.ceil($el.width()/2);$mask.css({position:"absolute",top:scrollTop,left:scrollLeft,right:-scrollLeft,bottom:-scrollTop,backgroundColor:"#FFF",opacity:options.opacity||1,zIndex:zIndex});$el.css({position:"absolute",top:48,marginTop:-offsetTop,right:"50%",marginRight:-(scrollLeft+offsetLeft),zIndex:zIndex+1})};$.fn.hideMessage=function(text){if(!text||this.hasMessage(text)){this.css({position:this.data("oldPosition"),overflow:this.data("oldOverflow")}).children().filter(".statusMessage,.statusMessageMask").remove();this.removeData("oldPosition");this.removeData("oldOverflow")}return this};$.fn.getMessage=function(){var msg=this.children(".statusMessage");return msg.text()};$.fn.hasMessage=function(text){var msg=this.children(".statusMessage");return!!(msg.length&&(!text||msg.text()===text))}})($,_);define("lib/jquery.showMessage",function(){});define("src/components/notes/views/NotesView",["backbone","underscore","jquery","src/components/notes/models/Note","mustache!src/components/notes/templates/notesView","css!src/components/notes/css/notesView.css","src/packages/modalDialogs","lib/jquery.showMessage","lib/jquery.notify"],function(Backbone,_,$,Note,noteViewTemplate){"use strict";var NotesView,emailReplacePattern=/(\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*)/g;function formatNoteText(text){return _(text||"").escapeHTML().replace(emailReplacePattern,'<a href="mailto:$1" target="_blank">$1</a>').replace(/\n/g,"<br/>").replace(/\r/g,"").replace(/&apos;/g,"&#39;")}return NotesView=Backbone.View.extend({className:"mentionNotesView modular",events:{"click a.refresh":"onRefresh","click a.edit":"onEdit","click button.save":"onSaveEdit","click button.cancel":"onCancelEdit","click button.post":"onPost"},constructor:function NotesView(){Backbone.View.apply(this,arguments);this.listenTo(this.model,"request",this.waitingForData);this.listenTo(this.model,"sync change",this.render)},waitingForData:function waitingForData(){this.$el.showMessage("Waiting for data...")},render:function render(){var text=_.unescapeHTML(this.model.get("text")||"");this.$el.hideMessage();this.$el.html(noteViewTemplate({editing:!!this.editing,plainText:text,formattedText:formatNoteText(text),hasText:!!text}));if(this.editing){this.$("textarea[name=editText]").val(text)}},onRefresh:function onRefresh(){if(this.model.isNew()){this.render();return}this.model.fetch()},onEdit:function onEdit(){this.editing=true;this.render()},onSaveEdit:function onSaveEdit(){var self=this,$button=this.$("button.save"),$editText=this.$("textarea[name=editText]"),newText=$editText.val();$editText.prop("disabled",true);$button.prop("disabled",true);this.model.save({text:newText},{success:function success(){$button.prop("disabled",false);self.editing=false;self.render()},error:function error(){$.notify("That operation failed. Please try again");$button.prop("disabled",false);self.render()}})},onCancelEdit:function onCancelEdit(){this.editing=false;this.render()},onPost:function onPost(){var $button=this.$("button.post"),$postText=this.$("textarea[name=postText]"),text=$postText.val();if(!text){$postText.addClass("invalid");return}$button.prop("disabled",true);this.model.prepend({text:text,success:function success(){$postText.val("");$button.prop("disabled",false)},error:function error(){$.notify("That operation failed. Please try again");$button.prop("disabled",false)}})}},{show:function show(mention){if(!(mention instanceof Backbone.Model)){throw new Error("mention has to be a Backbone.Model")}var resourceId=mention.get("resourceId"),noteIds=mention.get("noteIds")||[],noteId=noteIds[0],model=new Note({id:noteId,resourceId:resourceId}),view=new NotesView({model:model});view.render();view.$el.showModal({draggable:"h1:first",className:"popup smallpopup",onClose:function onClose(){view.remove()}});function updateMentionNotes(){mention.set({noteIds:[].concat(model.get("noteIds")||[]).concat(model.id)})}var remove=view.remove;view.remove=function(){this.trigger("close");this.$el.removeModal();model.off("sync",updateMentionNotes);remove.call(this);this.remove=remove};if(!model.isNew()){model.fetch()}else{model.once("sync",updateMentionNotes)}return view}})});define("mustache!src/components/mentions/templates/mentionShareMenu",["lib/mustache"],function(mustache){var escapedTemplate='{{^isTwitterChannelMention}}\n<section class="twitter">\n<h3>Twitter</h3>\n<ul>\n<li><a class="tweet" target="_blank" data-id="{{id}}" href="https://twitter.com/intent/tweet?text={{text}}">Tweet this</a></li>\n</ul>\n</section>\n{{/isTwitterChannelMention}}\n<section class="facebook">\n<h3>Facebook</h3>\n<ul>\n<li><a class="post">Post this</a></li>\n<li class="like"></li>\n</ul>\n</section>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/components/mentions/views/MentionShareMenu",["backbone","underscore","jquery","src/helpers/FB","src/globals/me","src/components/notes/models/Note","mustache!src/components/mentions/templates/mentionShareMenu","jquery.showRelativeTo"],function(Backbone,_,$,FB,me,Note,mentionShareMenu){"use strict";var MentionShareMenu;return MentionShareMenu=Backbone.View.extend({className:"mentionShareMenu context-menu popupframe",events:{"click a.post":"onPost"},initialize:function initialize(options){if(!options||!options.mention){throw new Error("options.mention must be set!")}if(!options.target){throw new Error("options.target must be set!")}_(this).bindAll("onDocumentClick");this.target=options.target;this.mention=options.mention},remove:function remove(){$("body").off("click.mentionShareMenu",this.onDocumentClick);this.$el.removeRelativeTo();Backbone.View.prototype.remove.call(this)},render:function render(){var $el=this.$el;var isTwitterChannelMention=this.mention.get("pageType")==="twitter";$el.html(mentionShareMenu({id:this.mention.id,text:this.mention.get("url"),author:this.mention.get("author"),isTwitterChannelMention:isTwitterChannelMention}));FB.likeButton({url:this.mention.get("url"),el:$el.find("li.like")});$el.showRelativeTo({target:this.target});this.clickFired=false;$("body").trigger("click.mentionShareMenu").off("click.mentionShareMenu",this.onDocumentClick).on("click.mentionShareMenu",this.onDocumentClick)},onDocumentClick:function onDocumentClick(){if(!this.clickFired){this.clickFired=true;return}$("body").off("click.mentionShareMenu",this.onDocumentClick);this.remove()},onReply:function onReply(e){e.preventDefault()},onPost:function onPost(e){e.preventDefault();var self=this,mention=this.mention.toJSON(),noteId=_.last(mention.noteIds||[]),userName=me.get("username")||"n/a";FB.postToWall({url:mention.url,title:mention.title,snippet:mention.snippet},function(err,postId){var note=new Note({id:noteId,mentionId:self.mention.id});note.prepend({header:"--- Facebook ---\n"+userName+"\nShared this on Facebook:",text:FB.getPostToWallUrl(postId)})})}},{show:function show(options){var menu=new MentionShareMenu(options);menu.render();return menu}})});define("lib/widgetsInjection",["q","jquery"],function(Q,$){"use strict";function resolveAll(withValue){this.__state__="ready";this.__api__=withValue;this.resolvers.forEach(function(resolver){resolver(withValue)})}var API_CONFIG={instagram:{scriptSrc:"//platform.instagram.com/en_US/embeds.js",ready:function ready(reject){var self=this;window.setTimeout(function(){if(window.instgrm!==undefined){self.resolveAll(window.instgrm)}else{reject("Failed loading Instagram widgets API")}},100)},resolvers:[],resolveAll:resolveAll},twitter:{scriptSrc:"//platform.twitter.com/widgets.js",ready:function ready(){var self=this;window.twttr=function(){var t=window.twttr||{};t._e=t._e||[];t.ready=t.ready||function(f){t._e.push(f)};return t}();window.twttr.ready(function(twttr){self.resolveAll(twttr)})},resolvers:[],resolveAll:resolveAll}};function hasState(config,state){return config.__state__===state}function getConfig(type){return API_CONFIG[type]}function getScript(url){return Q($.ajax({url:url,dataType:"script"}))}function getAPI(type){var self=this;return Q.Promise(function(resolve,reject){var config=self.getConfig(type);if(config===undefined){return reject("API type not supported")}if(self.hasState(config,"ready")){return resolve(config.__api__)}if(self.hasState(config,"loading")){return config.resolvers.push(resolve)}config.resolvers.push(resolve);config.__state__="loading";self.getScript(config.scriptSrc).then(function(){config.ready(reject)},function(){delete config.__state__;reject("Error loading widgets API for "+type)})})}return{getConfig:getConfig,getScript:getScript,getAPI:getAPI,hasState:hasState}});define("mustache!src/components/mentions/_singlemention/templates/singleMentionEmbedViewForGeneric",["lib/mustache"],function(mustache){var escapedTemplate='<div class="iframe-wrapper">\n\x3c!--allow-forms: Let the user submit any forms (eg forum replies)--\x3e\n\x3c!--allow-same-origin: Allows us to interact with the iframe *if* it\'s on the same domain as us--\x3e\n<iframe class="preview" sandbox="allow-forms allow-same-origin allow-popups allow-popups-to-escape-sandbox" src="{{url}}" width="100%" height="100%"/>\n<iframe class="preload" sandbox="allow-forms allow-same-origin allow-popups allow-popups-to-escape-sandbox" src="about:blank" width="100%" height="100%"/>\n</div>\n<div class="iframe-timeout" style="display:none;">\n<h1>Mention failed to load</h1>\n<p>The content for this mention could not be loaded.</p>\n<p>The website may not allow us to save this content offline, or the page may no longer exist in our index</p>\n<p>Click <a class="timeout-rerender">here to try again</a>\nor you can <a target="_blank" href="{{url}}">visit the page directly</a>.</p>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/components/mentions/_singlemention/helpers/mentionContentEmbedHelper",["q","underscore","jquery","src/helpers/FB","lib/widgetsInjection","mustache!src/components/mentions/_singlemention/templates/singleMentionEmbedViewForGeneric","bw-fe-helpers/promiseHelper"],function(Q,_,$,FB,widgetsInjection,singleMentionEmbedViewForGeneric,promiseHelper){"use strict";function isOEmbedSupported(mention){var PAGETYPE_BY_CONSTRAINTS={instagram:{threadEntryType:"post"},facebook:{resourceType:"public-facebook-post"},twitter:false};var pagesTypes=_.keys(PAGETYPE_BY_CONSTRAINTS);var pageType=mention.getPageType();var constraints;var constraintKeys;if(!pageType||!_.contains(pagesTypes,pageType)){return false}constraints=PAGETYPE_BY_CONSTRAINTS[pageType];if(!constraints){return true}constraintKeys=_.keys(constraints);return _.any(constraintKeys,function(constraintKey){return mention.get(constraintKey)===constraints[constraintKey]})}function assembleOpenEmbedUrl(channel,mentionUrl){return"/content-embed/"+"?channel="+channel+"&url="+encodeURIComponent(mentionUrl)}function getGenericIframeTemplateGivenUrl(mentionUrl){return Q.resolve({type:"archive",html:singleMentionEmbedViewForGeneric({url:mentionUrl})})}function getEmbedContentGivenChannel(channel,mentionUrl){var getGenericIframeTemplateGivenUrl=this.getGenericIframeTemplateGivenUrl.bind(this);return promiseHelper.ajax({url:assembleOpenEmbedUrl(channel,mentionUrl)}).then(function(oEmbed){return{type:"oEmbed",html:oEmbed.html}}).catch(function(){return getGenericIframeTemplateGivenUrl(mentionUrl)})}function getEmbedContentGivenFacade(mention){var mentionPageType=mention.get("pageType");var mentionUrl=mention.get("url");if(!isOEmbedSupported(mention)){return this.getGenericIframeTemplateGivenUrl(mentionUrl)}return this.getEmbedContentGivenChannel(mentionPageType,mentionUrl)}function formatEmbeddedContentAfterRender(channel){var mentionContainerEl=$("#mention-content").get(0);switch(channel){case"facebook":return Q.Promise(function(resolve){FB.parseXFBML(mentionContainerEl,resolve)});case"instagram":return widgetsInjection.getAPI("instagram").then(function(instgrm){return Q.resolve(instgrm.Embeds.process(mentionContainerEl))});case"twitter":return widgetsInjection.getAPI("twitter").then(function(twttr){return Q.resolve(twttr.widgets.load(mentionContainerEl))});default:return Q.reject("Can not embed mention of for channel of type: ",channel+".")}}return{assembleOpenEmbedUrl:assembleOpenEmbedUrl,formatEmbeddedContentAfterRender:formatEmbeddedContentAfterRender,getEmbedContentGivenChannel:getEmbedContentGivenChannel,getEmbedContentGivenFacade:getEmbedContentGivenFacade,getGenericIframeTemplateGivenUrl:getGenericIframeTemplateGivenUrl}});define("mustache!templates/categoriesFormView",["lib/mustache"],function(mustache){var escapedTemplate='<div class="top-header">\n<h1 class="popuptitletext singlemargin-bottom draggable">{{title}}{{^title}}Create a New Category{{/title}}</h1>\n</div>\n<div class="categories-form-wrapper">\n<div class="errorPane notification-error rounded smallpadding-vertical singlepadding-horizontal hidden"></div>\n<form>\n<div class="category">\n<label class="smallmargin-bottom db bold">Category name</label>\n<input type="text" class="category-name field validation-wrapper sixcol" name="name" data-validation-message-required="Please enter a category name" placeholder="E.g. Colour" value="{{categoryName}}" />\n</div>\n<div class="subcategories">\n<label class="smallmargin-bottom db bold">Subcategories <a class="subcategories-sort icon-bwsort-alpha-{{subcategorySort}}"></a></label>\n<ul class="subcategories-list itemList bwscrollbar-narrow validation-wrapper" data-validation-message-required="Please enter at least one Subcategory name">\n{{#children}}\n<li class="subcategory-li itemList" data-subcategory-id="{{id}}" >\n<input name="subcategories" type="text" class="subcategory-name field fivecol"  value="{{name}}" />\n<a class="sort-handle icon" title="Drag to reorder Subcategory">i</a>\n<a class="subcategory-delete icon" title="Delete this Subcategory">X</a>\n</li>\n{{/children}}\n<li class="subcategory-li itemList" data-subcategory-id="{{id}}" >\n<input name="subcategories" type="text" class="subcategory-name field fivecol"  value="{{name}}" />\n<a class="sort-handle icon" title="Drag to reorder Subcategory">i</a>\n<a class="subcategory-delete icon" title="Delete this Subcategory">X</a>\n</li>\n</ul>\n</div>\n<div class="subcategories-control">\n{{#showMultiple}}\n<input class="multiple-subcategories" type="checkbox" {{checked}} id="{{multipleSubcatId}}"/><label for="{{multipleSubcatId}}">Allow multiple Subcategories to be applied</label><a class="help icon-bwhelp" data-key="categories-allow-multiple-subcategories"></a>\n<div class="subcategories-warning">\n<p>Please note that you cannot change this setting later</p>\n</div>\n{{/showMultiple}}\n</div>\n<div class="categories-buttons">\n<button class="save-category defaultbutton" type="button">Save Category</button>\n<button class="cancel button singlemargin-left" type="button">Cancel</button>\n</div>\n</form>\n\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!templates/subcategory",["lib/mustache"],function(mustache){var escapedTemplate='<li class="subcategory-li itemList">\n<input name="subcategories" type="text" class="field subcategory-name fivecol"  value="{{name}}" />\n<a class="sort-handle icon" title="Drag to reorder Subcategory">i</a>\n<a class="subcategory-delete icon" title="Delete this Subcategory">X</a>\n</li>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});(function($){var $event=$.event,drag=$event.special.drag,origadd=drag.add,origteardown=drag.teardown;drag.noBubble=false;drag.livekey="livedrag";drag.add=function(obj){origadd.apply(this,arguments);var data=$.data(this,drag.datakey);if(!data.live&&obj.selector){data.live=true;$event.add(this,"draginit."+drag.livekey,drag.delegate)}};drag.teardown=function(){origteardown.apply(this,arguments);var data=$.data(this,drag.datakey)||{};if(data.live){$event.remove(this,"draginit."+drag.livekey,drag.delegate);data.live=false}};drag.delegate=function(event){var elems=[],target,events=$._data(this,"events")||{};$.each(events||[],function(key,arr){if(key.indexOf("drag")!==0)return;$.each(arr||[],function(i,obj){target=$(event.target).closest(obj.selector,event.currentTarget)[0];if(!target)return;$event.add(target,obj.origType+"."+drag.livekey,obj.origHandler||obj.handler,obj.data);if($.inArray(target,elems)<0)elems.push(target)})});if(!elems.length)return false;return $(elems).on("dragend."+drag.livekey,function(){$event.remove(this,"."+drag.livekey)})}})(jQuery);define("lib/jquery.event.drag.live-2.2-patched",function(){});define("src/packages/drag",["lib/jquery.event.drag-2.2","lib/jquery.event.drag.live-2.2-patched"],function(){"use strict"});define("css!css/categoriesFormView.css",["css!css/compiled.css"],function(){});define("src/views/CategoriesFormView",["backbone","underscore","jquery","src/globals/currentProject","src/views/ValidatingFormView","src/models/Category","src/analytics/Analytics","mustache!templates/categoriesFormView","mustache!templates/subcategory","src/packages/drag","src/packages/modalDialogs","src/packages/waitmask","css!css/categoriesFormView.css","lib/jquery.confirm"],function(Backbone,_,$,currentProject,ValidatingFormView,Category,Analytics,formViewTemplate,subcategoryTemplate){"use strict";var ASC="asc";var DESC="desc";var CategoriesFormView=ValidatingFormView.extend({className:"categoriesFormView modular",events:{"keyup .subcategory-name":"onNewSubcategoryChange","click button.cancel":"onDiscardChanges","click a.subcategory-delete":"onDeleteSubcategory","click button.save-category":"onSaveCategory","click a.subcategories-sort":"onSortIcon","click button.close":"onClose","drag a.sort-handle":"onSortDrag","dragstart a.sort-handle":"onSortDragStart","dragend a.sort-handle":"onSortDragEnd"},initialize:function initialize(options){if(!options.model){throw new Error("CategoriesFormView must be initialized with options")}if(!options.collection){throw new Error("CategoriesFormView must be initialized with a collection")}if(options.title){this.title=options.title}this.projectId=options.projectId;this.subcategorySort=ASC;this.listenTo(this.model,"change",this.render);ValidatingFormView.prototype.initialize.call(this)},remove:function remove(){if(this.tooltip){this.tooltip.remove()}ValidatingFormView.prototype.remove.call(this)},delegateEvents:function delegateEvents(){var dragData;Backbone.View.prototype.delegateEvents.call(this);dragData=this.$el.data("dragdata");dragData.relative=true;this.$el.data("dragdata",dragData)},discardChanges:function discardChanges(){if(_(this.initialCategoryData).isEqual(this.getCategoryFromDom())){return this.remove()}this.remove()},onDiscardChanges:function onDiscardChanges(e){e.preventDefault();this.discardChanges()},onSortIcon:function onSortIcon(){var categoryFromDom=this.getCategoryFromDom();var numberOfCategories=categoryFromDom.children.length;var children=_.sortBy(categoryFromDom.children,function(child){return child.name.toLowerCase()}).map(function(subcategory,index){var ordering;if(this.subcategorySort===DESC){ordering=numberOfCategories-index}else{ordering=index+1}subcategory.ordering=ordering;return subcategory},this);this.subcategorySort=this.subcategorySort===ASC?DESC:ASC;this.model.set({children:children,name:categoryFromDom.name})},render:function render(){var templateModel={title:this.title,categoryName:this.model.get("name"),categoryId:this.model.get("id"),projectId:this.model.get("projectId"),children:_.sortBy(this.model.get("children"),"ordering"),multiple:this.model.get("multiple"),multipleSubcatId:_.uniqueId("multiple-subcat-"),showMultiple:this.model.isNew(),subcategorySort:this.subcategorySort};var tooltip=this.tooltip;if(!tooltip){tooltip=this.tooltip=$('<div class="tooltip"/>')}if(!tooltip.parent().length){tooltip.appendTo("body")}tooltip.hide();if(templateModel.multiple){templateModel.checked='checked="true"'}this.$el.html(formViewTemplate(templateModel));this.initialCategoryData=this.getCategoryFromDom();this.applyTooltips()},applyTooltips:function applyTooltips($anchors){var tooltip=this.tooltip;$anchors=$anchors||this.$("a[title]");$anchors.tooltip({tip:tooltip,delay:0,events:{input:"mouseover, mouseout"}})},newSubCategoryChange:function newSubCategoryChange(){var $ul=this.$("ul.subcategories-list");$ul.append(subcategoryTemplate({}));this.applyTooltips($ul.find("li").filter(":last").find("a[title]"))},onNewSubcategoryChange:function onNewSubcategoryChange(e){var subcatVal=$(e.target).val();this.hideErrors();if(!this.hasEmptySubcats()){this.newSubCategoryChange(subcatVal)}},hasEmptySubcats:function hasEmptySubcats(){return _(this.$("ul input")).any(function(input){return!$(input).val().trim().length})},deleteSubcategory:function deleteSubcategory(target){$(target).closest("li").remove()},getEmptySubcats:function getEmptySubcats(){var emptySubcats=_(this.$("ul input")).filter(function(subcat){return $(subcat).val().trim().length===0});return emptySubcats},onDeleteSubcategory:function onDeleteSubcategory(e){if(this.getEmptySubcats().length>1||$(e.target).closest("li").find("input").val().trim().length!==0){this.deleteSubcategory($(e.target))}},onClose:function onClose(){this.remove()},getCategoryFromDom:function getCategoryFromDom(){var subcatVal;var subCats;subCats=_.chain(this.$(".subcategory-li")).filter(function(cat){subcatVal=$(cat).find("input").val();return subcatVal&&subcatVal.trim()}).map(function(cat){return{name:$(cat).find("input").val(),id:$(cat).data("subcategory-id")}}).value();var result={name:this.$(".category-name").val(),children:subCats,id:this.model.get("id")};var $multipleCb=this.$(".multiple-subcategories");if($multipleCb.length){result.multiple=$multipleCb.is(":checked")}return result},saveCategory:function saveCategory(){var self=this;var isNewModel=this.model.isNew();var options=this.getCategoryFromDom();var hasSameName=function hasSameName(category){return category.get("name").toLowerCase()===options.name.toLowerCase()&&category.get("id")!==options.id};this.hideErrors();this.$el.showWaitmask("Saving...");if(this.collection.find(hasSameName)){this.$el.hideWaitmask();this.onModelError(this.model,{name:"Categories must not have the same name"});return}this.model.save(options,{success:function success(){self.$el.hideWaitmask();self.collection.add(self.model);self.trigger("categorySaved",{categoryName:self.model.get("name")});Analytics.trackEvent({name:"Miscellaneous.Categories",action:isNewModel?"Add":"Edit",origin:"Application"});self.remove()},error:function error(model,response){self.$el.hideWaitmask();self.onServerError(model,response)},wait:true});if(this.model.validationError){this.$el.hideWaitmask()}},onSaveCategory:function onSaveCategory(){this.saveCategory()},onSortDrag:function onSortDrag(e,dd){var newStart=dd.startY+dd.deltaY;var newEnd=newStart+dd.elHeight;var toMove;var above;var below;var mid;var collision;collision=_.find(dd.positions,function(cat){above=cat.above;below=cat.below;mid=above+(below-above)/2;if(dd.deltaY<1){return newStart<mid&&newStart<below&&newEnd>below}else{return newStart>mid&&newStart<below}});if(collision){toMove=collision.$cat;if(!toMove.is(dd.hidden)){if(dd.deltaY<1){toMove.before(dd.hidden)}else{toMove.after(dd.hidden)}}}if(newStart<dd.minY||newStart>dd.maxY){return}dd.currentCatEl.css({top:dd.initY+dd.deltaY+this.$el.find("ul.subcategories-list").scrollTop()})},onSortDragStart:function onSortDragStart(e,dd){var currentCatEl=$(e.target).closest("li");return this.sortDragStart(currentCatEl,dd)},sortDragStart:function sortDragStart(currentCatEl,dd){var currentCatElHeight=currentCatEl.outerHeight();var tolerance=10;var $cat;var above;var $cats=this.$(".subcategory-li").not(currentCatEl);var positions;positions=_($cats).map(function(cat){$cat=$(cat);above=$cat.offset().top;return{$cat:$cat,above:above,below:above+$cat.height()}});_(dd).extend({currentCatEl:currentCatEl,positions:positions,minY:Math.min(positions[0].above,currentCatEl.offset().top),maxY:positions[0].below+positions.length*currentCatElHeight-tolerance,elHeight:currentCatElHeight,initY:currentCatEl.position().top,initialIndex:currentCatEl.index(),hidden:currentCatEl.clone()});currentCatEl.after(dd.hidden.css({visibility:"hidden"}).height(currentCatEl.height()).removeClass("current"));currentCatEl.css({position:"absolute",zIndex:12,top:dd.initY+this.$el.find("ul.subcategories-list").scrollTop()})},onSortDragEnd:function onSortDragEnd(e,dd){dd.hidden.replaceWith(dd.currentCatEl.detach().css({top:"",position:"relative",zIndex:"auto"}));var newIndex=dd.currentCatEl.index();var oldIndex=dd.initialIndex;var catList=this.$("ul.subcategory-list");var oldList=catList.eq(oldIndex);var targetCat=catList.eq(newIndex);if(oldIndex===newIndex){return}if(oldIndex<newIndex){return oldList.insertAfter(targetCat)}return oldList.insertBefore(targetCat)}},{show:function show(options){if(!options||!options.collection){throw new TypeError("CategoriesFormView.show must be passed a collection option")}var category;var title;var view;var oldRemove;if(options.model||options.categoryId){category=options.model||options.collection.get(options.categoryId);if(!category.isNew()){title="Edit Category"}}else{category=new Category}view=new CategoriesFormView({model:category,title:title,projectId:options.projectId||currentProject.id,collection:options.collection});view.render();oldRemove=view.remove;view.remove=function(){this.$el.removeModal()};view.$el.showModal({draggable:".top-header h1",className:"popup smallpopup",onClose:function onClose(){oldRemove.call(view)}});view.$("input[name=name]").focus();return view}});return CategoriesFormView});(function($,_){"use strict";$.prompt=function(options,value,callback){var text=_.isString(options)?options:options.text,intro=options.intro||"",okText=options.okText||"OK",errors=options.errors,cancelText=options.cancelText||"Cancel",selectText=options.selectText||false,modal,cancelled=false;function getMaxLength(){return options.maxLength?'maxlength="'+options.maxLength+'"':""}function validate(value){var error=options.validate&&options.validate(value);if(error&&error.length){showValidationErrors(modal,error)}return error}function showValidationErrors(modal,error){var stylingClasses="notification-error rounded smallpadding-vertical singlepadding-horizontal singlemargin-bottom clearboth",errorMessage='<p class="validationError '+stylingClasses+'">'+error+"</p>",$prompt=modal.getOverlay();if($prompt.find("p.validationError").length){$prompt.find("p.validationError").text(error)}else{$prompt.find("input[name=value]").addClass("invalid");$prompt.find(".js-prompt-intro").before(errorMessage)}}function selectTextOrFocusOnInput(){var $input=$(".promptModal input[name=value]");if(selectText){$input.select()}else{$input.focus();$input.val($input.val())}}if(_.isFunction(value)){callback=value;value=undefined}modal=$('<div><h1 class="floatleft popuptitletext singlemargin-bottom">'+_.escape(text)+"</h1>"+'<a class="floatright icon-remove iconsmall lightgrey cancel singlepadding popup--close"></a>'+'<div class="clearboth smallmargin-bottom js-prompt-intro">'+intro+"</div>"+'<p><input type=text name=value class="field" value="'+_.escape(value||"")+'" autofocus '+getMaxLength()+"></input></p>"+'<p><button class="defaultbutton ok">'+_.escape(okText)+"</button>"+'<button class="singlemargin-left button cancel">'+_.escape(cancelText)+"</button></p></div>").on("click","button.cancel,a.cancel",function(e){e.preventDefault();value=undefined;modal.close()}).on("click","button.ok",function(){var validationResult;value=$(this).closest(".promptModal").find("input[name=value]").val();validationResult=validate(value);if(validationResult&&validationResult.length){return}modal.close()}).showModal({className:"promptModal smallpopup",allowMultipleInstances:true,onLoad:selectTextOrFocusOnInput,onClose:function onClose(){var returnValue=cancelled||_.isUndefined(value)?"cancelled":undefined;$(document).off("keydown.prompt");if(callback){callback(returnValue,value)}}});if(errors&&errors.length>0){showValidationErrors(modal,errors)}$(document).on("keydown.prompt",function(e){var validationResult;if(e.which===13){value=modal.getOverlay().find("input[name=value]").val();validationResult=validate(value);if(validationResult&&validationResult.length){return}modal.close()}else if(e.which===27){cancelled=true;modal.close()}});return modal}})($,_);define("lib/jquery.prompt",function(){});define("src/components/mentions/_singlemention/helpers/categoriesSelectionHelper",["underscore","jquery","lib/jquery.prompt"],function(_,$){"use strict";var categoriesSelectionHelper={showNewSubcategoryDialog:function showNewSubcategoryDialog(model,options){options=options||{};$.prompt({text:"New Subcategory",intro:'Enter new Subcategory name for the Category "'+model.escape("name")+'"',errors:options.errors},options.value||"",function(cancelled,name){var newChildren;if(cancelled){if(options.success){options.success(null)}return}newChildren=_(model.get("children")).sortBy("ordering").concat({name:name});model.save({children:newChildren},{validate:true,success:function success(){if(options.success){options.success(model)}},error:function error(){if(options.error){options.error(model)}}});if(model.validationError){categoriesSelectionHelper.showNewSubcategoryDialog(model,_.extend(options,{value:name,errors:_(model.validationError).values()}))}})}};return categoriesSelectionHelper});define("mustache!src/components/mentions/_singlemention/templates/singleSelectCategoryView",["lib/mustache"],function(mustache){var escapedTemplate='<label title="{{name}}">{{name}}</label>\n<a class="selected noTip" title="{{selected}}">{{selected}}</a>\n<ul class="subcategories context-menu popupframe {{isSubCategoriesVisible}}">\n<li class="context-menu--item noSelection"><a>(None)</a></li>\n<li class="context-menu--item separator"></li>\n{{#categories}}\n<li class="context-menu--item textellipsis subcategory noTip" data-id="{{id}}" title="{{name}}"><a>{{name}}</a></li>\n{{/categories}}\n{{#canAddSubcategory}}\n<li class="context-menu--item separator"></li>\n<li class="context-menu--item new"><a>New Subcategory</a></li>\n{{/canAddSubcategory}}\n</ul>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/components/mentions/_singlemention/views/SingleCategorySelectView",["backbone","underscore","jquery","src/permissions","src/components/mentions/_singlemention/helpers/categoriesSelectionHelper","mustache!src/components/mentions/_singlemention/templates/singleSelectCategoryView","src/packages/spin"],function(Backbone,_,$,permissions,categoriesSelectionHelper,singleSelectCategoryTemplate){"use strict";return Backbone.View.extend({className:"singleCategorySelectView categorySelectView",events:{"click a.selected":"onClickSelected","click li.noSelection":"onClickNoSelection","click li.subcategory":"onClickSubcategory","click li.new":"onClickNewSubcategory"},initialize:function initialize(options){if(!options||!options.mention){throw new Error("options.mention must be set!")}this.setMention(options.mention);this.readOnly=!!options.readOnly},remove:function remove(){$("body").off("click.removeSingleCategorySelect");Backbone.View.prototype.remove.call(this)},setMention:function setMention(mention){if(mention===this.mention){return}this.stopWaiting();this.stopListening(this.mention);this.mention=mention;this.listenTo(this.mention,"change",this.mentionChanged);this.render()},mentionChanged:function mentionChanged(){if(!this.hasChanged()){return}return this.render()},hasChanged:function hasChanged(){return!!this.mention.changedAttributes().categories},render:function render(){var selected=this.getSelectedCategory(),selectedChild=_(this.model.get("children")).find(function(child){return child.id===selected})||{};this.$el.html(singleSelectCategoryTemplate({canAddSubcategory:!this.readOnly&&permissions.check("edit.categories"),name:this.model.get("name"),selected:selectedChild.name||"(None)",isSubCategoriesVisible:this.isSubCategoriesVisible?"":"hidden",categories:_(this.model.get("children")).chain().sortBy(function(child){return child.ordering}).map(function(child){return{id:child.id,name:child.name}}).value()}));if(this.waiting){this.startWaiting()}},triggerDelayEvent:function triggerDelayEvent(){this.trigger("delayed")},showError:function showError(){this.$("a.selected").addClass("error");this.trigger("error")},toggleSubCategories:function toggleSubCategories(toogleSwitch){var $ul=this.$("ul.subcategories").toggleClass("hidden",toogleSwitch);this.isSubCategoriesVisible=!$ul.hasClass("hidden");return $ul},onClickSelected:function onClickSelected(){var self=this,clickFired=false;this.toggleSubCategories();$("body").trigger("click.removeSingleCategorySelect").off("click.removeSingleCategorySelect");if(!this.isSubCategoriesVisible){return}$("body").on("click.removeSingleCategorySelect",function(){if(!clickFired){clickFired=true;return}$("body").off("click.removeSingleCategorySelect");self.toggleSubCategories(true)})},startWaiting:function startWaiting(){var $selected=this.$("a.selected");$selected.spin({lines:9,length:3,width:2,radius:3});this.waiting=true},stopWaiting:function stopWaiting(){if(!this.$("a.selected")){return}var $selected=this.$("a.selected");$selected.spin(false);this.waiting=false},handleError:function handleError(){var xhr=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.stopWaiting();if(xhr.status===202){this.triggerDelayEvent()}else{this.showError()}},onClickNoSelection:function onClickNoSelection(){var self=this,selected=this.getSelectedCategory();this.startWaiting();this.removeCategory(selected,{success:function success(){self.stopWaiting()},error:function error(model,xhr){self.handleError(xhr)}})},onClickSubcategory:function onClickSubcategory(e){var self=this,id=$(e.target).closest("li").data("id");this.startWaiting();this.addCategory(id,{success:function success(){self.stopWaiting()},error:function error(model,xhr){self.handleError(xhr)}})},onClickNewSubcategory:function onClickNewSubcategory(){var self=this;categoriesSelectionHelper.showNewSubcategoryDialog(this.model,{error:function error(model,xhr){self.handleError(xhr)}})},getSelectedCategory:function getSelectedCategory(){return _(this.mention.get("categories")||[]).intersection(_(this.model.get("children")).pluck("id"))[0]},addCategory:function addCategory(selected,options){var self=this;this.mention.save({addCategories:[selected]},Object.assign({patch:true,error:function error(model,xhr){self.handleError(xhr)}},options))},removeCategory:function removeCategory(selected,options){var self=this;this.mention.save({removeCategories:[selected]},Object.assign({patch:true,error:function error(model,xhr){self.handleError(xhr)}},options))},closeDropdown:function closeDropdown(){if(!this.isSubCategoriesVisible){return}this.onClickSelected()}})});define("mustache!src/components/mentions/_singlemention/templates/multipleSelectCategoryView",["lib/mustache"],function(mustache){var escapedTemplate='<label title="{{name}}">{{name}}</label>\n<a class="selected noTip" title="{{selected}}">{{selected}}</a>\n<ul class="subcategories context-menu popupframe {{isSubCategoriesVisible}}">\n{{#categories}}\n<li class="context-menu--item subcategory textellipsis">\n<input type="checkbox" value="{{id}}" id="subcat-{{cid}}-{{id}}"{{#checked}} checked{{/checked}} />\n<label for="subcat-{{cid}}-{{id}}" title="{{name}}" class="noTip">{{name}}</label>\n</li>\n{{/categories}}\n{{#canEditCategories}}\n<li class="context-menu--item separator"></li>\n<li class="context-menu--item new"><a>New Subcategory</a></li>\n{{/canEditCategories}}\n</ul>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/components/mentions/_singlemention/views/MultipleCategorySelectView",["backbone","underscore","jquery","src/permissions","src/components/mentions/_singlemention/helpers/categoriesSelectionHelper","mustache!src/components/mentions/_singlemention/templates/multipleSelectCategoryView","src/packages/spin"],function(Backbone,_,$,permissions,categoriesSelectionHelper,multipleSelectCategoryTemplate){"use strict";return Backbone.View.extend({className:"multipleCategorySelectView categorySelectView",events:{"click a.selected":"onClickSelected","click li.new a":"onClickNewSubcategory","click li.subcategory":"onClickSubcategory"},initialize:function initialize(options){if(!options||!options.mention){throw new Error("options.mention must be set!")}this.setMention(options.mention)},remove:function remove(){$("body").off("click.removeMultipleCategorySelect");Backbone.View.prototype.remove.call(this)},setMention:function setMention(mention){if(mention===this.mention){return}this.stopWaiting();this.stopListening(this.mention);this.mention=mention;this.listenTo(this.mention,"change",this.mentionChanged);this.render()},mentionChanged:function mentionChanged(){if(!this.hasChanged()){return}return this.render()},hasChanged:function hasChanged(){return!!this.mention.changedAttributes().categories},render:function render(){var children=this.model.get("children")||[],selectedIds=this.getSelected(),selected=_(selectedIds).map(function(catId){return _(children).find(function(child){return child.id===parseInt(catId,10)})});this.$el.html(multipleSelectCategoryTemplate({cid:this.cid,name:this.model.get("name"),selected:_(selected).pluck("name").join(", ")||"(None)",isSubCategoriesVisible:this.isSubCategoriesVisible?"":"hidden",canEditCategories:permissions.check("edit.categories"),categories:_(children).chain().sortBy(function(child){return child.ordering}).map(function(child){return{id:child.id,name:child.name,checked:selectedIds.indexOf(child.id)>-1}}).value()}));if(this.waiting){this.startWaiting()}},toggleSubCategories:function toggleSubCategories(toogleSwitch){var $ul=this.$("ul.subcategories").toggleClass("hidden",toogleSwitch);this.isSubCategoriesVisible=!$ul.hasClass("hidden");return $ul},onClickSubcategory:function onClickSubcategory(e){var $target=$(e.target),$input;if($target.is("input")||$target.is("label")){return}$input=$target.closest("li").find("input");$input.prop("checked",!$input.is(":checked"))},onClickSelected:function onClickSelected(){var clickFired=false,saveChanges=_.bind(this.saveChanges,this);this.toggleSubCategories();$("body").trigger("click.removeMultipleCategorySelect").off("click.removeMultipleCategorySelect");if(!this.isSubCategoriesVisible){return}$("body").on("click.removeMultipleCategorySelect",function(e){if(!clickFired){clickFired=true;return}if($(e.target).closest("ul.subcategories").length){return}saveChanges()})},closeDropdown:function closeDropdown(){if(!this.isSubCategoriesVisible){return}this.saveChanges();this.toggleSubCategories(true)},startWaiting:function startWaiting(){var $selected=this.$("a.selected");$selected.spin({lines:9,length:3,width:2,radius:3});this.waiting=true},stopWaiting:function stopWaiting(){var $selected=this.$("a.selected");$selected.spin(false);this.waiting=false},handleError:function handleError(xhr){if(xhr.status===202){this.trigger("delayed")}else{this.$("a.selected").addClass("error");this.trigger("error")}},saveChanges:function saveChanges(){var self=this,mention=this.mention,currentSelection=this.getSelected().sort(),$ul=this.toggleSubCategories(),newSelection=$ul.find("input:checked").map(function(i,el){return parseInt(el.value,10)}).get().sort(),attrs={};$("body").off("click.removeMultipleCategorySelect");this.toggleSubCategories(true);if(_.isEqual(newSelection,currentSelection)){return}attrs.addCategories=_(newSelection).difference(currentSelection);attrs.removeCategories=_.without.apply(_,[currentSelection].concat(newSelection));this.startWaiting();mention.save(attrs,{patch:true,success:function success(){self.stopWaiting()},error:function error(model,xhr){self.stopWaiting();self.handleError(xhr)}})},getSelected:function getSelected(){return _(this.mention.get("categories")||[]).intersection(_(this.model.get("children")).pluck("id"))},onClickNewSubcategory:function onClickNewSubcategory(){var self=this;categoriesSelectionHelper.showNewSubcategoryDialog(this.model,{error:function error(model,xhr){self.handleError(xhr)}})}})});define("mustache!src/components/mentions/_singlemention/templates/booleanSelectCategoryView",["lib/mustache"],function(mustache){var escapedTemplate='<label title="{{name}}">{{name}}</label>\n<div class="selected">\n<input type="checkbox" id="{{cid}}-{{id}}"{{#checked}} checked{{/checked}} />\n<label for="{{cid}}-{{id}}" title="{{name}}" class="noTip">{{category}}</label>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/components/mentions/_singlemention/views/BooleanCategorySelectView",["backbone","mustache!src/components/mentions/_singlemention/templates/booleanSelectCategoryView","src/packages/spin"],function(Backbone,booleanSelectCategoryTemplate){"use strict";return Backbone.View.extend({className:"booleanCategorySelectView categorySelectView",events:{"change input[type=checkbox]":"onCheckboxChanged"},initialize:function initialize(options){if(!options||!options.mention){throw new Error("options.mention must be set!")}this.setMention(options.mention)},setMention:function setMention(mention){this.stopListening(this.mention);this.mention=mention;this.listenTo(this.mention,"change",this.mentionChanged);this.render()},mentionChanged:function mentionChanged(){if(!this.hasChanged()){return}return this.render()},hasChanged:function hasChanged(){return!!this.mention.changedAttributes().categories},render:function render(){var checked=(this.mention.get("categories")||[]).indexOf(this.model.get("children")[0].id)>-1;this.$el.html(booleanSelectCategoryTemplate({cid:this.cid,id:this.model.id,name:this.model.get("name"),checked:checked,category:this.model.get("children")[0].name}));if(this.waiting){this.startWaiting()}},startWaiting:function startWaiting(){var $selected=this.$("a.selected");$selected.spin({lines:9,length:3,width:2,radius:3});this.waiting=true},stopWaiting:function stopWaiting(){if(!this.$("a.selected")){return}var $selected=this.$("a.selected");$selected.spin(false);this.waiting=false},handleError:function handleError(){var xhr=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(xhr.status===202){this.trigger("delayed")}else{this.$(".selected").addClass("error");this.trigger("error")}},onCheckboxChanged:function onCheckboxChanged(){var self=this,checked=this.$("input[type=checkbox]").prop("checked"),checkedSubcategoryId=this.model.get("children")[0].id,attrs={};this.startWaiting();if(checked){attrs.addCategories=[checkedSubcategoryId]}else{attrs.removeCategories=[checkedSubcategoryId]}this.mention.save(attrs,{patch:true,success:function success(){self.stopWaiting()},error:function error(model,xhr){self.stopWaiting();self.handleError(xhr)}})}})});define("mustache!src/components/mentions/_singlemention/templates/mentionCategoriesView",["lib/mustache"],function(mustache){var escapedTemplate='<h1>\n<span class="collapsed-status icon-caret-down"></span>Categories\n{{#canEdit}}\n<a class="edit icon-pencil" title="Edit a category"></a>\n<a class="add icon-plus" title="Add a new category"></a>\n{{/canEdit}}\n</h1>\n<ul class="editCategories context-menu popupframe hidden">\n{{#categories}}\n<li class="context-menu--item" data-id="{{id}}"><a>{{name}}</a></li>\n{{/categories}}\n</ul>\n<div class="content">\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/components/mentions/_singlemention/views/MentionCategoriesView",["backbone","underscore","jquery","src/globals/categories","src/permissions","src/views/CategoriesFormView","src/components/mentions/_singlemention/views/SingleCategorySelectView","src/components/mentions/_singlemention/views/MultipleCategorySelectView","src/components/mentions/_singlemention/views/BooleanCategorySelectView","mustache!src/components/mentions/_singlemention/templates/mentionCategoriesView"],function(Backbone,_,$,categories,permissions,CategoriesFormView,SingleCategorySelectView,MultipleCategorySelectView,BooleanCategorySelectView,mentionCategoriesTemplate){"use strict";function createView(category,mention){if((category.get("children")||[]).length===1){return new BooleanCategorySelectView({model:category,mention:mention})}else if(category.get("multiple")){return new MultipleCategorySelectView({model:category,mention:mention})}return new SingleCategorySelectView({model:category,mention:mention})}var MentionCategoriesView=Backbone.View.extend({tagName:"section",className:"mentionCategoriesView rounded",events:{"click h1 .add":"onClickAdd","click h1 .edit":"onClickEdit","click h1":"onClickTitle","click ul.editCategories li":"onClickEditCategory"},constructor:function MentionCategoriesView(options){Backbone.View.apply(this,arguments);if(!options){throw new TypeError("MentionCategoriesView must be instantiated with an options argument")}if(!options.facade){throw new TypeError("MentionCategoriesView must be instantiated with a facade option")}if(!options.layoutManager){throw new TypeError("MentionCategoriesView must be instantiated with a layoutManager option")}if(!options.categories){throw new TypeError("MentionCategoriesView must be instantiated with a categories option")}var view=this;view.facade=options.facade;view.updateMention();view.listenTo(view.facade,"change",view.updateMention);view.layoutManager=options.layoutManager;view.listenTo(view.layoutManager,"hideView:mentionCategoriesView",view.onViewHidden);view.listenTo(view.layoutManager,"showView:mentionCategoriesView",view.onViewShown);view.categories=options.categories;view.categorySelectViews=[];view.categories.forEach(function(cat){view.onCategoryAdded(cat)});view.listenTo(view.categories,"add",view.onCategoryAdded);view.listenTo(view.categories,"remove",view.onCategoryRemoved);view.listenTo(view.categories,"change",view.onCategoryChanged);view.listenTo(view.categories,"reset",view.onCategoriesReset)},remove:function remove(){_(this.categorySelectViews).forEach(function(view){view.remove()});this.categorySelectViews=[];Backbone.View.prototype.remove.call(this)},updateMention:function updateMention(){var mention=this.facade.getMentionModel();this.mention=mention;_(this.categorySelectViews).forEach(function(view){view.setMention(mention)})},render:function render(){var $content;_(this.categorySelectViews).forEach(function(view){view.$el.detach()});this.$el.html(mentionCategoriesTemplate({canEdit:permissions.check("edit.categories"),categories:this.categories.chain().sortBy(function(cat){return cat.get("name").toLowerCase()}).map(function(cat){return{id:cat.id,name:cat.get("name")}}).value()}));$content=this.$(".content");_(this.categorySelectViews).forEach(function(view){$content.append(view.$el);view.render()});if(!this.layoutManager.isVisible("mentionCategoriesView")){this.onViewHidden()}this.$(".edit").toggleClass("hidden",this.categories.size()===0);this.rendered=true},saveChanges:function saveChanges(){_(this.categorySelectViews).each(function(view){if(_.isFunction(view.saveChanges)){view.saveChanges()}})},onClickAdd:function onClickAdd(){if(this.categoryForm){this.categoryForm.remove()}this.categoryForm=CategoriesFormView.show({collection:categories})},onClickEdit:function onClickEdit(){var $ul=this.$("ul.editCategories"),clickFired=false;$ul.toggleClass("hidden");$("body").trigger("click.editMentionCategories").off("click.editMentionCategories");if($ul.hasClass("hidden")){return}$("body").on("click.editMentionCategories",function(){if(!clickFired){clickFired=true;return}$("body").off("click.editMentionCategories");$ul.addClass("hidden")})},onClickTitle:function onClickTitle(e){if($(e.target).is("a")){return}if(this.$el.hasClass("collapsed")){this.layoutManager.showSubView("mentionCategoriesView")}else{this.layoutManager.hideSubView("mentionCategoriesView")}},onClickEditCategory:function onClickEditCategory(e){var categoryId=$(e.target).closest("li").data("id");if(this.categoryForm){this.categoryForm.remove()}this.categoryForm=CategoriesFormView.show({model:this.categories.get(categoryId),collection:categories})},closeAllPopups:function closeAllPopups(){_(this.categorySelectViews).each(function(view){if(_.isFunction(view.closeDropdown)){view.closeDropdown()}})},onViewHidden:function onViewHidden(){this.$el.addClass("collapsed");this.$(".collapsed-status").removeClass("icon-caret-down").addClass("icon-caret-right")},onViewShown:function onViewShown(){this.$el.removeClass("collapsed");this.$(".collapsed-status").addClass("icon-caret-down").removeClass("icon-caret-right")},onSubViewError:function onSubViewError(){this.trigger("error")},onSubViewDelayed:function onSubViewDelayed(){this.trigger("delayed")},onCategoryAdded:function onCategoryAdded(category){var view=createView(category,this.mention),insertIndex;insertIndex=_.sortedIndex(this.categorySelectViews,view,function(view){return view.model.get("name").toLowerCase()});this.categorySelectViews.splice(insertIndex,0,view);view.on("error",this.onSubViewError,this);view.on("delayed",this.onSubViewDelayed,this);if(this.rendered){this.render()}},onCategoryRemoved:function onCategoryRemoved(category){var view=_(this.categorySelectViews).find(function(view){return view.model.id===category.id});view.off("error",this.onSubViewError,this);view.off("delayed",this.onSubViewDelayed,this);view.remove();this.categorySelectViews.splice(this.categorySelectViews.indexOf(view),1);if(this.rendered){this.render()}},onCategoryChanged:function onCategoryChanged(category){var view=_(this.categorySelectViews).find(function(view){return view.model.id===category.id}),insertIndex;this.categorySelectViews.splice(this.categorySelectViews.indexOf(view),1);if(view instanceof BooleanCategorySelectView&&category.get("children").length>1){view.remove();view=createView(category,this.mention)}else if(view instanceof SingleCategorySelectView&&category.get("multiple")){view.remove();view=createView(category,this.mention)}else if(view instanceof SingleCategorySelectView&&category.get("children").length===1){view.remove();view=createView(category,this.mention)}else if(view instanceof MultipleCategorySelectView&&category.get("children").length===1){view.remove();view=createView(category,this.mention)}insertIndex=_.sortedIndex(this.categorySelectViews,view,function(view){return view.model.get("name").toLowerCase()});this.categorySelectViews.splice(insertIndex,0,view);if(this.rendered){this.render()}},onCategoriesReset:function onCategoriesReset(){var self=this;_(this.categorySelectViews).forEach(function(view){view.remove()});this.categorySelectViews=[];this.categories.forEach(function(cat){self.onCategoryAdded(cat)})}});return MentionCategoriesView});define("src/models/Metrics",["backbone"],function(Backbone){"use strict";return Backbone.Model.extend({url:"/metrics/"})});define("src/globals/metrics",["underscore","src/ApiError","src/models/Metrics","q"],function(_,ApiError,Metrics,Q){"use strict";var fetchPromise;var metrics=new Metrics;function loadMetrics(callback){if(!fetchPromise){fetchPromise=metrics.fetch()}fetchPromise.then(function success(){callback(null,metrics)},function error(xhr){callback(new ApiError(xhr))})}function fetchMetric(metric){var supportedMetrics=["sentiments","pageTypes","subTypes"];var promise;if(supportedMetrics.indexOf(metric)===-1){throw new TypeError("fetchMetric only supports:"+supportedMetrics.join(", "))}promise=new Q.Promise(function(resolve,reject){loadMetrics(function callback(err,metrics){if(err){reject(err);return}resolve(metrics.get(metric))})});return promise}return{fetch:fetchMetric,fetchSentiments:_.partial(fetchMetric,"sentiments"),fetchPageTypes:_.partial(fetchMetric,"pageTypes"),fetchSubTypes:_.partial(fetchMetric,"subTypes"),load:loadMetrics}});(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==="object"&&typeof module==="object")module.exports=factory(require("underscore"));else if(typeof define==="function"&&define.amd)define("bw-fe-helpers/numberHelper",["underscore"],factory);else{var a=typeof exports==="object"?factory(require("underscore")):factory(root["underscore"]);for(var i in a)(typeof exports==="object"?exports:root)[i]=a[i]}})(this,function(__WEBPACK_EXTERNAL_MODULE__1__){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=7)}({1:function(module,exports){module.exports=__WEBPACK_EXTERNAL_MODULE__1__},7:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var underscore__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1);var underscore__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(underscore__WEBPACK_IMPORTED_MODULE_0__);function getRoundedNumber(number,options){var multiplier=1;var toFixed=options.toFixed;if(underscore__WEBPACK_IMPORTED_MODULE_0___default.a.isNumber(toFixed)&&!isNaN(toFixed)&&toFixed>=0&&toFixed<=20){multiplier=Math.pow(10,Math.floor(toFixed))}return(Math.round(number*multiplier)/multiplier).toString()}function getFormattedNumber(number,unit,options){if(options.returnProps){return{number:number,unit:unit}}return[number,unit].join("")}__webpack_exports__["default"]={prettyNumber:function prettyNumber(number,options){var parsed=parseFloat(number);var absNumber=Math.abs(parsed);var unit="";var divisor;options=options||{};if(!underscore__WEBPACK_IMPORTED_MODULE_0___default.a.isNumber(parsed)||isNaN(parsed)){return number||""}if(!isFinite(parsed)){return""}if(absNumber>999999){unit="M";divisor=1e6}else if(absNumber>9999){unit="K";divisor=1e3}return getFormattedNumber(getRoundedNumber(divisor?parsed/divisor:parsed,options),unit,options)},formatNaturalNumber:function formatNaturalNumber(number){var parsed=parseFloat(number);if(!underscore__WEBPACK_IMPORTED_MODULE_0___default.a.isNumber(parsed)||isNaN(parsed)){return number||""}if(!isFinite(parsed)){return""}if(parsed<0){return number.toString()}return parsed.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1"+",")},formatSpaceDelimitedNumber:function formatSpaceDelimitedNumber(number){var parsed=parseFloat(number);if(!underscore__WEBPACK_IMPORTED_MODULE_0___default.a.isNumber(parsed)||isNaN(parsed)){return number||""}if(!isFinite(parsed)){return""}if(parsed<0){return number.toString()}return parsed.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1"+"")}}}})["default"]});function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};var ownKeys=Object.keys(source);if(typeof Object.getOwnPropertySymbols==="function"){ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))}ownKeys.forEach(function(key){_defineProperty(target,key,source[key])})}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}define("src/components/mentions/_singlemention/helpers/mentionMetricsHelper",["underscore","bw-fe-helpers/numberHelper","src/globals/flags","src/globals/flagNames"],function(_,numberHelper,flags,FLAGS){"use strict";var CHANNELS=["facebook","instagram","twitter"];var MENTION_KEYS_DEFAULT=["author","domain","mozRank","backlinks","monthlyVisitors","averageVisits","pagesPerVisit","averageDurationOfVisit","percentMaleVisitors","percentFemaleVisitors","resourceType","reach","reachEstimate","pageType"];var MENTION_KEYS_BLOG=["blogComments"];var MENTION_KEYS_OFFLINE_PUBLICATION=["publicationName"];var MENTION_KEYS_FORUM=["forumPosts","forumViews"];var MENTION_KEYS_FACEBOOK=["facebookLikes","facebookShares","facebookComments","subtype","facebookRole"];var MENTION_KEYS_INSTAGRAM=["instagramCommentCount","instagramFollowerCount","instagramFollowingCount","instagramLikeCount","instagramPostCount"];var MENTION_KEYS_TWITTER=["twitterPostCount","twitterFollowers","twitterFollowing","twitterRetweets","twitterTweets","influence","outreach"];function calculateInstagramInteractionsGivenFacade(facade){return facade.get("instagramLikeCount")+facade.get("instagramCommentCount")}function containedInList(list){return function(item){return _.contains(list,item)}}function generateIndicators(value,config){var verifiedValue=_.isString(value)?Number(value):value;var stabilizedValue;var operatingValue;if(!_.isNumber(verifiedValue)||_.isNaN(verifiedValue)){return new Error("A number must be provided as the first argument")}if(config.useLog10){stabilizedValue=Math.log(verifiedValue)/Math.LN10}else{stabilizedValue=verifiedValue}operatingValue=Math.round(stabilizedValue);return _.chain(config.max).range().map(function(i){if(i<operatingValue){return{className:"indicator-on"}}return{className:"indicator-off"}}).value()}function getMetricsGivenFacadeAndMetricsList(facade,metricsList){var metricList=metricsList.reduce(function(metrics,metric){metrics[metric]=facade.get(metric);return metrics},{});Object.assign(metricList,{showReachEstimate:flags.variation(FLAGS.ENABLE_REACH_METRIC)});return metricList}function getChannelPageTypesGivenMetrics(metrics){return _.chain(metrics&&metrics.get("pageTypes")||[]).sortBy().value()}function getPageTypesGivenExclusionList(exclusionList){return function(metrics){return _.chain(getChannelPageTypesGivenMetrics(metrics)).reject(containedInList(exclusionList)).value()}}function getRawDataForGenericGivenFacade(facade){return getMetricsGivenFacadeAndMetricsList(facade,[].concat(MENTION_KEYS_DEFAULT,MENTION_KEYS_BLOG,MENTION_KEYS_FORUM,MENTION_KEYS_OFFLINE_PUBLICATION))}function getDataForGenericGivenFacade(facade){return _.extend(getRawDataForGenericGivenFacade(facade),{backlinksIndicators:generateIndicators(facade.get("backlinks"),{max:8,useLog10:true}),location:facade.get("city")||facade.get("county")||facade.get("state")||facade.get("country")||facade.get("continent"),monthlyVisitors:Number(numberHelper.prettyNumber(facade.get("monthlyVisitors"))),mozRankIndicators:generateIndicators(facade.get("mozRank"),{max:10,useLog10:false}),pageType:_.capitalize(facade.get("pageType")),isOfflinePublication:facade.getMentionModel().get("isOfflinePublication")})}function getRawDataForFacebookGivenFacade(facade){return _objectSpread({},getMetricsGivenFacadeAndMetricsList(facade,MENTION_KEYS_FACEBOOK),{isDarkPost:facade.get("resourceType")==="dark-facebook-post",isDarkComment:facade.get("resourceType")==="dark-facebook-comment"})}function getDataForFacebookGivenFacade(facade){return _.extend(getDataForGenericGivenFacade(facade),getRawDataForFacebookGivenFacade(facade),{subtype:_.capitalize(facade.get("subtype"))})}function getRawDataForInstagramGivenFacade(facade){return getMetricsGivenFacadeAndMetricsList(facade,MENTION_KEYS_INSTAGRAM)}function getDataForInstagramGivenFacade(facade){return _.extend(getDataForGenericGivenFacade(facade),getRawDataForInstagramGivenFacade(facade),{instagramInteractionCount:calculateInstagramInteractionsGivenFacade(facade)})}function getRawDataForTwitterGivenFacade(facade){return getMetricsGivenFacadeAndMetricsList(facade,MENTION_KEYS_TWITTER)}function getDataForTwitterGivenFacade(facade){return _.extend(getDataForGenericGivenFacade(facade),getRawDataForTwitterGivenFacade(facade),{twitterFollowersIndicators:generateIndicators(facade.get("twitterFollowers"),{max:7,useLog10:true}),twitterFollowingIndicators:generateIndicators(facade.get("twitterFollowing"),{max:6,useLog10:true}),twitterPostCountIndicators:generateIndicators(facade.get("twitterPostCount"),{max:7,useLog10:true})})}return{CHANNELS:CHANNELS,MENTION_KEYS_DEFAULT:MENTION_KEYS_DEFAULT,MENTION_KEYS_BLOG:MENTION_KEYS_BLOG,MENTION_KEYS_FORUM:MENTION_KEYS_FORUM,MENTION_KEYS_FACEBOOK:MENTION_KEYS_FACEBOOK,MENTION_KEYS_INSTAGRAM:MENTION_KEYS_INSTAGRAM,MENTION_KEYS_TWITTER:MENTION_KEYS_TWITTER,MENTION_KEYS_OFFLINE_PUBLICATION:MENTION_KEYS_OFFLINE_PUBLICATION,calculateInstagramInteractionsGivenFacade:calculateInstagramInteractionsGivenFacade,containedInList:containedInList,generateIndicators:generateIndicators,getChannelPageTypesGivenMetrics:getChannelPageTypesGivenMetrics,getDataForGenericGivenFacade:getDataForGenericGivenFacade,getDataForFacebookGivenFacade:getDataForFacebookGivenFacade,getDataForInstagramGivenFacade:getDataForInstagramGivenFacade,getDataForTwitterGivenFacade:getDataForTwitterGivenFacade,getMetricsGivenFacadeAndMetricsList:getMetricsGivenFacadeAndMetricsList,getPageTypesGivenExclusionList:getPageTypesGivenExclusionList}});define("mustache!src/components/mentions/_singlemention/templates/mentionSummaryViewForFacebook",["lib/mustache"],function(mustache){var escapedTemplate='<ul>\n<li class="date">{{formattedDate}}</li>\n{{#author}}\n<li class="author">\n<a class="show-authormenu" data-author-name="{{author}}" target="_blank">{{author}}</a>\n</li>\n{{/author}}\n{{^author}}\n<li class="author-unknown">Author Unknown</li>\n{{/author}}\n{{#canEditLocation}}\n<li class="location"><a>{{location}}</a></li>\n{{/canEditLocation}}\n{{^canEditLocation}}\n<li class="location">{{location}}</li>\n{{/canEditLocation}}\n{{#canEditPageType}}\n<li class="pageType">\n<a>{{pageType}}</a>\n<ul class="pageTypeMenu context-menu popupframe hidden">\n{{#pageTypes}}\n<li class="context-menu--item"><a class="{{value}}">{{name}}</a></li>\n{{/pageTypes}}\n</ul>\n</li>\n{{/canEditPageType}}\n{{^canEditPageType}}\n<li class="pageType">\n{{pageType}}\n{{#isDarkPost}}\n(Dark Post)\n{{/isDarkPost}}\n{{#isDarkComment}}\n(Dark Comment)\n{{/isDarkComment}}\n</li>\n{{/canEditPageType}}\n<li class="facebookLikes">\nLikes: <span>{{facebookLikes}}</span>\n</li>\n<li class="facebookComments">\nComments: <span>{{facebookComments}}</span>\n</li>\n<li class="facebookShares">\nShares: <span>{{facebookShares}}</span>\n</li>\n<li class="facebookSubtype">\nMedia Type: <span>{{subtype}}</span>\n</li>\n{{#showReachEstimate}}\n<li class="reachEstimate">\nReach:\n<span>{{reachEstimate}}</span>\n</li>\n{{/showReachEstimate}}\n{{#isMentionMetricsVisible}}\n<li class="hideMetrics">\n<a>\nHide Metrics\n<span class="symbol icon-double-chevron-up"></span>\n</a>\n</li>\n{{/isMentionMetricsVisible}}\n{{^isMentionMetricsVisible}}\n<li class="showMetrics">\n<a>\nShow Metrics\n<span class="symbol icon-double-chevron-down"></span>\n</a>\n</li>\n{{/isMentionMetricsVisible}}\n</ul>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/components/mentions/_singlemention/templates/mentionSummaryViewForInstagram",["lib/mustache"],function(mustache){var escapedTemplate='<ul>\n<li class="date">{{formattedDate}}</li>\n{{#author}}\n<li class="author">\n<a class="show-authormenu" data-author-name="{{author}}" target="_blank">{{author}}</a>\n</li>\n{{/author}}\n{{^author}}\n<li class="author-unknown">Author Unknown</li>\n{{/author}}\n{{#canEditLocation}}\n<li class="location"><a>{{location}}</a></li>\n{{/canEditLocation}}\n{{^canEditLocation}}\n<li class="location">{{location}}</li>\n{{/canEditLocation}}\n{{#canEditPageType}}\n<li class="pageType">\n<a>{{pageType}}</a>\n<ul class="pageTypeMenu context-menu popupframe hidden">\n{{#pageTypes}}\n<li class="context-menu--item"><a class="{{value}}">{{name}}</a></li>\n{{/pageTypes}}\n</ul>\n</li>\n{{/canEditPageType}}\n{{^canEditPageType}}\n<li class="pageType">{{pageType}}</li>\n{{/canEditPageType}}\n<li class="instagramInteractionCount">\n{{#instagramInteractionCount}}\nTotal Interactions: <span>{{instagramInteractionCount}}</span>\n{{/instagramInteractionCount}}\n{{^instagramInteractionCount}}\nTotal Interactions: <span>-</span>\n{{/instagramInteractionCount}}\n</li>\n<li class="instagramLikeCount">\n{{#instagramLikeCount}}\nLikes: <span>{{instagramLikeCount}}</span>\n{{/instagramLikeCount}}\n{{^instagramLikeCount}}\nLikes: <span>-</span>\n{{/instagramLikeCount}}\n</li>\n<li class="instagramCommentCount">\n{{#instagramCommentCount}}\nComments: <span>{{instagramCommentCount}}</span>\n{{/instagramCommentCount}}\n{{^instagramCommentCount}}\nComments: <span>-</span>\n{{/instagramCommentCount}}\n</li>\n{{#showReachEstimate}}\n<li class="reachEstimate">\nReach\n{{#reachEstimate}}<span>{{reachEstimate}}</span>{{/reachEstimate}}\n{{^reachEstimate}}<span class="no-results">-</span>{{/reachEstimate}}\n</li>\n{{/showReachEstimate}}\n{{#isMentionMetricsVisible}}\n<li class="hideMetrics">\n<a>\nHide Metrics\n<span class="symbol icon-double-chevron-up"></span>\n</a>\n</li>\n{{/isMentionMetricsVisible}}\n{{^isMentionMetricsVisible}}\n<li class="showMetrics">\n<a>\nShow Metrics\n<span class="symbol icon-double-chevron-down"></span>\n</a>\n</li>\n{{/isMentionMetricsVisible}}\n</ul>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/components/mentions/_singlemention/templates/mentionSummaryViewForTwitter",["lib/mustache"],function(mustache){var escapedTemplate='<ul>\n<li class="date">{{formattedDate}}</li>\n<li class="author"><a href="http://twitter.com/{{author}}" target="_blank" class="twitter-username" data-author-name="{{author}}">@{{author}}</a></li>\n{{#canEditLocation}}\n<li class="location"><a>{{location}}</a></li>\n{{/canEditLocation}}\n{{^canEditLocation}}\n<li class="location">{{location}}</li>\n{{/canEditLocation}}\n{{#canEditPageType}}\n<li class="pageType">\n<a>{{pageType}}</a>\n<ul class="pageTypeMenu context-menu popupframe hidden">\n{{#pageTypes}}\n<li class="context-menu--item"><a class="{{value}}">{{name}}</a></li>\n{{/pageTypes}}\n</ul>\n</li>\n{{/canEditPageType}}\n{{^canEditPageType}}\n<li class="pageType">{{pageType}}</li>\n{{/canEditPageType}}\n<li class="twitterRetweets">\nRetweets\n{{#twitterRetweets}}<span>{{twitterRetweets}}</span>{{/twitterRetweets}}\n{{^twitterRetweets}}<span class="no-results">-</span>{{/twitterRetweets}}\n</li>\n{{^showReachEstimate}}\n<li class="reach">\nTwitter Reach\n{{#reach}}<span>{{reach}}</span>{{/reach}}\n{{^reach}}<span class="no-results">-</span>{{/reach}}\n</li>\n{{/showReachEstimate}}\n{{#showReachEstimate}}\n<li class="reachEstimate">\nReach\n{{#reachEstimate}}<span>{{reachEstimate}}</span>{{/reachEstimate}}\n{{^reachEstimate}}<span class="no-results">-</span>{{/reachEstimate}}\n</li>\n{{/showReachEstimate}}\n{{#isMentionMetricsVisible}}\n<li class="hideMetrics">\n<a>\nHide Metrics\n<span class="symbol icon-double-chevron-up"></span>\n</a>\n</li>\n{{/isMentionMetricsVisible}}\n{{^isMentionMetricsVisible}}\n<li class="showMetrics">\n<a>\nShow Metrics\n<span class="symbol icon-double-chevron-down"></span>\n</a>\n</li>\n{{/isMentionMetricsVisible}}\n</ul>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/components/mentions/_singlemention/templates/mentionSummaryView",["lib/mustache"],function(mustache){var escapedTemplate='<ul>\n<li class="date">{{formattedDate}}</li>\n{{#author}}\n<li class="author">\n<a class="show-authormenu" data-author-name="{{author}}" target="_blank">{{author}}</a>\n</li>\n{{/author}}\n{{^author}}\n<li class="author-unknown">Author Unknown</li>\n{{/author}}\n{{#canEditLocation}}\n<li class="location"><a>{{location}}</a></li>\n{{/canEditLocation}}\n{{^canEditLocation}}\n<li class="location">{{location}}</li>\n{{/canEditLocation}}\n{{#canEditPageType}}\n<li class="pageType">\n<a>{{pageType}}</a>\n<ul class="pageTypeMenu context-menu popupframe hidden">\n{{#pageTypes}}\n<li class="context-menu--item"><a class="{{value}}">{{name}}</a></li>\n{{/pageTypes}}\n</ul>\n</li>\n{{/canEditPageType}}\n{{^canEditPageType}}\n<li class="pageType">{{pageType}}</li>\n{{/canEditPageType}}\n{{#showReachEstimate}}\n<li class="reachEstimate">\nReach\n{{#reachEstimate}}<span>{{reachEstimate}}</span>{{/reachEstimate}}\n{{^reachEstimate}}<span class="no-results">-</span>{{/reachEstimate}}\n</li>\n{{/showReachEstimate}}\n{{#isForumMention}}\n<li class="forumPosts">\nPosts\n{{#forumPosts}}<span>{{forumPosts}}</span>{{/forumPosts}}\n{{^forumPosts}}<span class="no-results">-</span>{{/forumPosts}}\n</li>\n<li class="forumViews">\nViews\n{{#forumViews}}<span>{{forumViews}}</span>{{/forumViews}}\n{{^forumViews}}<span class="no-results">-</span>{{/forumViews}}\n</li>\n{{#showReachEstimate}}\n<li class="reachEstimate">\nReach\n{{#reachEstimate}}<span>{{reachEstimate}}</span>{{/reachEstimate}}\n{{^reachEstimate}}<span class="no-results">-</span>{{/reachEstimate}}\n</li>\n{{/showReachEstimate}}\n{{/isForumMention}}\n{{#isBlogMention}}\n<li class="blogComments">\nComments\n{{#blogComments}}<span>{{blogComments}}</span>{{/blogComments}}\n{{^blogComments}}<span class="no-results">-</span>{{/blogComments}}\n</li>\n{{#showReachEstimate}}\n<li class="reachEstimate">\nReach\n{{#reachEstimate}}<span>{{reachEstimate}}</span>{{/reachEstimate}}\n{{^reachEstimate}}<span class="no-results">-</span>{{/reachEstimate}}\n</li>\n{{/showReachEstimate}}\n{{/isBlogMention}}\n{{#isMentionMetricsVisible}}\n<li class="hideMetrics">\n<a>\nHide Metrics\n<span class="symbol icon-double-chevron-up"></span>\n</a>\n</li>\n{{/isMentionMetricsVisible}}\n{{^isMentionMetricsVisible}}\n<li class="showMetrics">\n<a>\nShow Metrics\n<span class="symbol icon-double-chevron-down"></span>\n</a>\n</li>\n{{/isMentionMetricsVisible}}\n</ul>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/components/mentions/_singlemention/templates/mentionMetricsViewForFacebook",["lib/mustache"],function(mustache){var escapedTemplate='<ul class="facebook-metrics">\n<li class="domain">\n<label>Site</label>\n<a href="http://{{domain}}/" target="_blank" class="smv-metrics-domain">{{domain}}</a>\n</li>\n{{#mozRank}}\n<li class="mozRank">\n<label>mozRank</label>\n<span class="value">{{mozRank}}</span>\n{{#mozRankIndicators}}\n<span class="{{className}}"></span>\n{{/mozRankIndicators}}\n</li>\n{{/mozRank}}\n{{#backlinks}}\n<li class="backlinks">\n<label>Backlinks</label>\n<span class="value">{{backlinks}}</span>\n{{#backlinksIndicators}}\n<span class="{{className}}"></span>\n{{/backlinksIndicators}}\n</li>\n{{/backlinks}}\n{{#visitors}}\n<li class="visitors">\n<label>Visitors/Month</label>\n<span class="value">{{visitors}}</span>\n</li>\n{{/visitors}}\n{{#averageVisits}}\n<li class="averageVisits">\n<label>Visits/Visitor</label>\n<span class="value">{{averageVisits}}</span>\n</li>\n{{/averageVisits}}\n{{#pagesPerVisit}}\n<li class="pagesPerVisit">\n<label>Page Views</label>\n<span class="value">{{pagesPerVisit}}</span>\n</li>\n{{/pagesPerVisit}}\n{{#averageDurationOfVisit}}\n<li class="averageDurationOfVisit">\n<label>Visit Length</label>\n<span class="value">{{averageDurationOfVisit}} min</span>\n</li>\n{{/averageDurationOfVisit}}\n{{#percentMaleVisitors}}\n<li class="percentMaleVisitors">\n<label>Male</label>\n<span class="value">{{percentMaleVisitors}}%</span>\n</li>\n{{/percentMaleVisitors}}\n{{#percentFemaleVisitors}}\n<li class="percentFemaleVisitors">\n<label>Female</label>\n<span class="value">{{percentFemaleVisitors}}%</span>\n</li>\n{{/percentFemaleVisitors}}\n</ul>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/components/mentions/_singlemention/templates/mentionMetricsViewForInstagram",["lib/mustache"],function(mustache){var escapedTemplate='<ul class="instagram-metrics">\n<li class="domain">\n<label>Site</label>\n<a href="http://{{domain}}/" target="_blank" class="smv-metrics-domain">{{domain}}</a>\n</li>\n<li class="author-name">\n<label>Author</label>\n<span class="value">{{author}}</span>\n</li>\n<li class="instagram-post-followers">\n<label>Followers</label>\n{{#instagramFollowerCount}}\n<span class="value">{{instagramFollowerCount}}</span>\n{{/instagramFollowerCount}}\n{{^instagramFollowerCount}}\n<span class="value">-</span>\n{{/instagramFollowerCount}}\n</li>\n<li class="instagram-post-following">\n<label>Following</label>\n{{#instagramFollowingCount}}\n<span class="value">{{instagramFollowingCount}}</span>\n{{/instagramFollowingCount}}\n{{^instagramFollowingCount}}\n<span class="value">-</span>\n{{/instagramFollowingCount}}\n</li>\n</ul>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/components/mentions/_singlemention/templates/mentionMetricsViewForTwitter",["lib/mustache"],function(mustache){var escapedTemplate='<ul class="twitter-metrics">\n<li class="domain">\n<label>Site</label>\n<a href="http://{{domain}}/" target="_blank" class="smv-metrics-domain">{{domain}}</a>\n</li>\n{{#mozRank}}\n<li class="mozRank">\n<label>mozRank</label>\n<span class="value">{{mozRank}}</span>\n{{#mozRankIndicators}}\n<span class="{{className}}"></span>\n{{/mozRankIndicators}}\n</li>\n{{/mozRank}}\n{{#backlinks}}\n<li class="backlinks">\n<label>Backlinks</label>\n<span class="value">{{backlinks}}</span>\n{{#backlinksIndicators}}\n<span class="{{className}}"></span>\n{{/backlinksIndicators}}\n</li>\n{{/backlinks}}\n{{#visitors}}\n<li class="visitors">\n<label>Visitors/Month</label>\n<span class="value">{{visitors}}</span>\n</li>\n{{/visitors}}\n{{#averageVisits}}\n<li class="averageVisits">\n<label>Visits/Visitor</label>\n<span class="value">{{averageVisits}}</span>\n</li>\n{{/averageVisits}}\n{{#pagesPerVisit}}\n<li class="pagesPerVisit">\n<label>Page Views</label>\n<span class="value">{{pagesPerVisit}}</span>\n</li>\n{{/pagesPerVisit}}\n{{#averageDurationOfVisit}}\n<li class="averageDurationOfVisit">\n<label>Visit Length</label>\n<span class="value">{{averageDurationOfVisit}} min</span>\n</li>\n{{/averageDurationOfVisit}}\n{{#percentMaleVisitors}}\n<li class="percentMaleVisitors">\n<label>Male</label>\n<span class="value">{{percentMaleVisitors}}%</span>\n</li>\n{{/percentMaleVisitors}}\n{{#percentFemaleVisitors}}\n<li class="percentFemaleVisitors">\n<label>Female</label>\n<span class="value">{{percentFemaleVisitors}}%</span>\n</li>\n{{/percentFemaleVisitors}}\n</ul>\n<ul class="author-metrics">\n<li class="author">\n<label>Author</label>\n<a href="http://twitter.com/{{author}}" data-author-name="{{author}}" target="_blank" class="twitter-username">@{{author}}</a>\n</li>\n{{#twitterPostCount}}\n<li class="twitterPostCount">\n<label>Tweets</label>\n<span class="value">{{twitterPostCount}}</span>\n{{#twitterPostCountIndicators}}\n<span class="{{className}}"></span>\n{{/twitterPostCountIndicators}}\n</li>\n{{/twitterPostCount}}\n{{#twitterFollowers}}\n<li class="twitterFollowers">\n<label>Followers</label>\n<span class="value">{{twitterFollowers}}</span>\n{{#twitterFollowersIndicators}}\n<span class="{{className}}"></span>\n{{/twitterFollowersIndicators}}\n</li>\n{{/twitterFollowers}}\n{{#twitterFollowing}}\n<li class="twitterFollowing">\n<label>Following</label>\n<span class="value">{{twitterFollowing}}</span>\n{{#twitterFollowingIndicators}}\n<span class="{{className}}"></span>\n{{/twitterFollowingIndicators}}\n</li>\n{{/twitterFollowing}}\n{{#influence}}\n<li class="influence">\n<label>Influence</label>\n<span class="value">{{influence}}</span>\n</li>\n{{/influence}}\n{{#outreach}}\n<li class="outreach">\n<label>Outreach</label>\n<span class="value">{{outreach}}</span>\n</li>\n{{/outreach}}\n</ul>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/components/mentions/_singlemention/templates/mentionMetricsView",["lib/mustache"],function(mustache){var escapedTemplate='<ul class="generic-metrics">\n\n<li class="domain">\n{{#isOfflinePublication}}\n<label>Publication</label>\n<span>{{publicationName}}</span>\n{{/isOfflinePublication}}\n{{^isOfflinePublication}}\n<label>Site</label>\n<a href="http://{{domain}}/" target="_blank" class="smv-metrics-domain">{{domain}}</a>\n{{/isOfflinePublication}}\n</li>\n{{#mozRank}}\n<li class="mozRank">\n<label>mozRank</label>\n<span class="value">{{mozRank}}</span>\n{{#mozRankIndicators}}\n<span class="{{className}}"></span>\n{{/mozRankIndicators}}\n</li>\n{{/mozRank}}\n{{#backlinks}}\n<li class="backlinks">\n<label>Backlinks</label>\n<span class="value">{{backlinks}}</span>\n{{#backlinksIndicators}}\n<span class="{{className}}"></span>\n{{/backlinksIndicators}}\n</li>\n{{/backlinks}}\n{{#visitors}}\n<li class="visitors">\n<label>Visitors/Month</label>\n<span class="value">{{visitors}}</span>\n</li>\n{{/visitors}}\n{{#averageVisits}}\n<li class="averageVisits">\n<label>Visits/Visitor</label>\n<span class="value">{{averageVisits}}</span>\n</li>\n{{/averageVisits}}\n{{#averagePages}}\n<li class="averagePages">\n<label>Page Views</label>\n<span class="value">{{averagePages}}</span>\n</li>\n{{/averagePages}}\n{{#duration}}\n<li class="duration">\n<label>Visit Length</label>\n<span class="value">{{duration}} min</span>\n</li>\n{{/duration}}\n{{#percentMale}}\n<li class="percentMale">\n<label>Male</label>\n<span class="value">{{percentMale}}%</span>\n</li>\n{{/percentMale}}\n{{#percentFemale}}\n<li class="percentFemale">\n<label>Female</label>\n<span class="value">{{percentFemale}}%</span>\n</li>\n{{/percentFemale}}\n</ul>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/components/mentions/_singlemention/helpers/mentionTemplatesHelper",["underscore","src/components/mentions/_singlemention/helpers/mentionMetricsHelper","mustache!src/components/mentions/_singlemention/templates/mentionSummaryViewForFacebook","mustache!src/components/mentions/_singlemention/templates/mentionSummaryViewForInstagram","mustache!src/components/mentions/_singlemention/templates/mentionSummaryViewForTwitter","mustache!src/components/mentions/_singlemention/templates/mentionSummaryView","mustache!src/components/mentions/_singlemention/templates/mentionMetricsViewForFacebook","mustache!src/components/mentions/_singlemention/templates/mentionMetricsViewForInstagram","mustache!src/components/mentions/_singlemention/templates/mentionMetricsViewForTwitter","mustache!src/components/mentions/_singlemention/templates/mentionMetricsView"],function(_,mentionMetricsHelper,mentionSummaryTemplateForFacebook,mentionSummaryTemplateForInstagram,mentionSummaryTemplateForTwitter,mentionSummaryTemplate,mentionMetricsTemplateForFacebook,mentionMetricsTemplateForInstagram,mentionMetricsTemplateForTwitter,mentionMetricsTemplate){"use strict";var TEMPLATE_KEYS_GENERIC=[].concat(mentionMetricsHelper.MENTION_KEYS_DEFAULT,mentionMetricsHelper.MENTION_KEYS_BLOG,mentionMetricsHelper.MENTION_KEYS_FORUM,mentionMetricsHelper.MENTION_KEYS_OFFLINE_PUBLICATION,["backlinksIndicators","location","mozRankIndicators","isOfflinePublication"]);var TEMPLATE_KEYS_INSTAGRAM=[].concat(TEMPLATE_KEYS_GENERIC,mentionMetricsHelper.MENTION_KEYS_INSTAGRAM,["instagramInteractionCount"]);var TEMPLATE_KEYS_TWITTER=[].concat(TEMPLATE_KEYS_GENERIC,mentionMetricsHelper.MENTION_KEYS_TWITTER,["twitterFollowersIndicators","twitterFollowingIndicators","twitterPostCountIndicators"]);var TEMPLATE_KEYS_FACEBOOK=[].concat(TEMPLATE_KEYS_GENERIC,mentionMetricsHelper.MENTION_KEYS_FACEBOOK);function assembleTemplateDataForFacebookGivenFacade(facade){return _.extend(mentionMetricsHelper.getDataForFacebookGivenFacade(facade))}function assembleTemplateDataForInstagramGivenFacade(facade){return _.extend(mentionMetricsHelper.getDataForInstagramGivenFacade(facade))}function assembleTemplateDataForTwitterGivenFacade(facade){return _.extend(mentionMetricsHelper.getDataForTwitterGivenFacade(facade))}function getMetricsTemplateGivenFacade(facade){switch(facade.get("pageType")){case"facebook":return mentionMetricsTemplateForFacebook(assembleTemplateDataForFacebookGivenFacade(facade));case"instagram":return mentionMetricsTemplateForInstagram(assembleTemplateDataForInstagramGivenFacade(facade));case"twitter":return mentionMetricsTemplateForTwitter(assembleTemplateDataForTwitterGivenFacade(facade));default:return mentionMetricsTemplate(mentionMetricsHelper.getDataForGenericGivenFacade(facade))}}function getPageTypesForSummaryTemplateGivenMetrics(metrics){return mentionMetricsHelper.getPageTypesGivenExclusionList(mentionMetricsHelper.CHANNELS)(metrics).map(function(pageType){return{name:_.capitalize(pageType),value:pageType}})}function getSummaryTemplateDataGivenFacade(facade){switch(facade.get("pageType")){case"facebook":return assembleTemplateDataForFacebookGivenFacade(facade);case"instagram":return assembleTemplateDataForInstagramGivenFacade(facade);case"twitter":return assembleTemplateDataForTwitterGivenFacade(facade);default:return mentionMetricsHelper.getDataForGenericGivenFacade(facade)}}function getSummaryTemplateGivenFacade(facade){switch(facade.get("pageType")){case"facebook":return function execTemplateForFacebookWithData(data){return mentionSummaryTemplateForFacebook(data)};case"instagram":return function execTemplateForInstagramWithData(data){return mentionSummaryTemplateForInstagram(data)};case"twitter":return function execTemplateForTwitterWithData(data){return mentionSummaryTemplateForTwitter(data)};default:return function execTemplateForGenericWithData(data){return mentionSummaryTemplate(data)}}}return{TEMPLATE_KEYS_GENERIC:TEMPLATE_KEYS_GENERIC,TEMPLATE_KEYS_INSTAGRAM:TEMPLATE_KEYS_INSTAGRAM,TEMPLATE_KEYS_TWITTER:TEMPLATE_KEYS_TWITTER,TEMPLATE_KEYS_FACEBOOK:TEMPLATE_KEYS_FACEBOOK,assembleTemplateDataForFacebookGivenFacade:assembleTemplateDataForFacebookGivenFacade,assembleTemplateDataForInstagramGivenFacade:assembleTemplateDataForInstagramGivenFacade,assembleTemplateDataForTwitterGivenFacade:assembleTemplateDataForTwitterGivenFacade,getMetricsTemplateGivenFacade:getMetricsTemplateGivenFacade,getPageTypesForSummaryTemplateGivenMetrics:getPageTypesForSummaryTemplateGivenMetrics,getSummaryTemplateDataGivenFacade:getSummaryTemplateDataGivenFacade,getSummaryTemplateGivenFacade:getSummaryTemplateGivenFacade}});(function($,_){"use strict";var pluginName="autocomplete";var defaults={css:{},clearAfterSelect:true,onFocus:function(){},onBlur:function(){},parseData:function(data){return data.results},sortBy:function(){return true},filterResult:function(){return true},renderResult:function(){},selected:function(){}};function Plugin(element,options){var self=this;if(!options){throw new Error("options is not defined")}if(!options.renderResult){throw new Error("options.renderResult not defined")}this.$element=$(element);this.element=element;this.options=_.defaults(options,defaults);this._defaults=defaults;this._name=pluginName;this._data=[];_(options.plugins).forEach(function(P){var plugin;var options;if(!_.isFunction(P)){options=P.options;P=P.plugin}plugin=new P(options);plugin.attach(self)});this.init()}Plugin.prototype.init=function(){var self=this;this.$results=$('<div class="autocomplete-results" style="display:none;"></div>');this.$element.on({focus:function(){self.focus.apply(self,arguments)},blur:function(){self.blur.apply(self,arguments)},keydown:function(){self.keydown.apply(self,arguments)},keyup:function(){self.keyup.apply(self,arguments)}}).after(this.$results);this.$results.css(_.extend({},{position:"absolute",width:this.$element.width()+"px",zIndex:9999},self.options.css)).on("mouseenter",function(){self.$results.data("dontCancel",true)}).on("mouseleave",function(){self.$results.data("dontCancel",false)}).on("mouseleave","ul",function(){$(this).find("li").removeClass("highlight")}).on("mouseenter mouseleave","li",function(){$(this).addClass("highlight").siblings().removeClass("highlight")}).on("click","a",function(e){self.resultSelected(e,$(e.currentTarget))})};Plugin.prototype.resultSelected=function(e,$anchor){e.preventDefault();var result=this._data[$anchor.closest("li").index()];if(result){this.options.selected.call(this,result);this.afterResultSelected()}};Plugin.prototype.afterResultSelected=function(){var self=this;this._data=[];this.previousPrefix=undefined;if(this.options.clearAfterSelect){_.defer(function(){self.$element.val("").focus()})}this.$results.hide();this.focus()};Plugin.prototype.focus=function(){this.options.onFocus();if(this.hasResults()){this.render()}};Plugin.prototype.blur=function(){if(!this.$results.data("dontCancel")){this.options.onBlur.apply(this,arguments);this.$results.hide();this.previousPrefix=""}};Plugin.prototype.keydown=function(e){if(e.which===9){this.$element.trigger($.Event("blur",{which:e.which}))}else if(e.which===38){e.preventDefault();this.navigateUp()}else if(e.which===40){e.preventDefault();this.navigateDown()}else if(e.which===13){this.resultSelected(e,this.$results.find(".highlight a"));return false}};Plugin.prototype.hasResults=function(){return this._data.length};Plugin.prototype.keyup=function(e){var self=this;if(e.which===38||e.which===40||e.which===13){return}else if(e.which===27){this.$element.trigger($.Event("blur",{which:e.which}))}else{self.prefix=$.trim(self.$element.val()).toLowerCase();if(self.prefix===self.previousPrefix){return}self.previousPrefix=self.prefix;if(self.prefix===""){self._data=[];self.$results.hide();return}self.fetch()}};Plugin.prototype.fetch=function(){this.render()};Plugin.prototype.navigateUp=function(){var $prev=this.$results.find(".highlight").prev();if($prev.length){$prev.addClass("highlight").next().removeClass()}this.scroll("up")};Plugin.prototype.navigateDown=function(){var $next=this.$results.find(".highlight").next();if($next.length){$next.addClass("highlight").prev().removeClass()}this.scroll("down")};Plugin.prototype.scroll=function(){var $results=this.$results;var $highlight=$results.find(".highlight");var itemTop=$highlight.position().top;var totalHeight=$results.prop("scrollHeight");var percentage=($results.scrollTop()+itemTop-$highlight.outerHeight())/totalHeight;var scrollOffset=Math.floor(percentage*totalHeight);$results.scrollTop(scrollOffset)};Plugin.prototype.render=function(){if(this.options.processResults){this.options.processResults.call(this,this._data)}if(this.hasResults()){this.$results.empty().append(this.renderResults.call(this,this._data)).show().find("li").filter(":first").addClass("highlight")}else{this.$results.empty().append(this.renderNoResults.call(this,this.prefix)).show()}};Plugin.prototype.renderNoResults=function(val){if(this.options.renderNoResults){return this.options.renderNoResults.call(this,val)}return'<ul class="no-results"><li>No results match "'+_.escape(val)+'"</li>'};Plugin.prototype.renderResults=function(data){var self=this;var items="";data=data||this._data;_(data).each(function(result){items+='<li><a href="#">'+self.options.renderResult.call(this,result)+"</a></li>"});return"<ul>"+items+"</ul>"};$.fn[pluginName]=function(options){if(options==="get"){return this.data("plugin_"+pluginName)}return this.each(function(){if(!$.data(this,"plugin_"+pluginName)){$.data(this,"plugin_"+pluginName,new Plugin(this,options))}})};return Plugin})($,_);define("jquery.autocomplete/jquery.autocomplete",function(global){return function(){var ret,fn;return ret||global.jQuery.fn.autocomplete}}(this));define("src/components/mentions/_singlemention/views/MentionMetricSummaryView",["backbone","underscore","jquery","src/Workbench","src/permissions","src/globals/metrics","src/globals/currentDashboard","src/views/AuthorContextMenu","src/models/Controls","src/components/mentions/_singlemention/helpers/mentionTemplatesHelper","jquery.autocomplete/jquery.autocomplete","jquery.showRelativeTo"],function(Backbone,_,$,Workbench,permissions,metrics,currentDashboard,AuthorContextMenu,Controls,mentionTemplatesHelper){"use strict";return Backbone.View.extend({className:"mentionMetricSummaryView",events:{"click .location a":"onClickLocation","click .pageType > a":"onClickPageType","click .pageTypeMenu a":"onSelectPageType","click .showMetrics a":"onToggleMetrics","click .author .twitter-username":"onClickTwitterUsername","click .author .show-authormenu":"onClickShowAuthorMenu"},constructor:function MentionMetricSummaryView(options){options=options||{};var facade=options.facade;var layoutManager=options.layoutManager;if(!facade){throw new Error("MentionMetricSummaryView must be initialized with a facade")}if(!layoutManager){throw new Error("MentionMetricSummaryView must be initialized with a layoutManager")}this.facade=facade;this.listenTo(this.facade,"change",this.render);this.layoutManager=layoutManager;this.timezone=options.timezone;this.listenTo(this.layoutManager,"showView:mentionMetricsView",this.handleShowMetricsView);this.listenTo(this.layoutManager,"hideView:mentionMetricsView",this.handleHideMetricsView);Backbone.View.apply(this,arguments)},remove:function remove(){$("body").off("click.removeMentionMetricSummaryView");if(this.autocomplete){this.autocomplete.remove()}Backbone.View.prototype.remove.call(this)},getBaseTemplateDataGivenFacade:function getBaseTemplateDataGivenFacade(facade){var formattedDate=facade.getFormattedDateGivenTimezone(this.timezone);var isChannelMention=facade.isChannelMention();var isBlogMention=facade.isBlogMention();var isForumMention=facade.isForumMention();var isNewsMention=facade.isNewsMention();var isMentionMetricsVisible=this.layoutManager.isVisible("mentionMetricsView")&&!isChannelMention;var canEditMention=permissions.check("edit.mentions",currentDashboard);return{formattedDate:formattedDate,isBlogMention:isBlogMention,isForumMention:isForumMention,isNewsMention:isNewsMention,isMentionMetricsVisible:isMentionMetricsVisible,canEditLocation:canEditMention,canEditPageType:canEditMention&&!isChannelMention}},render:function render(){var $el=this.$el;var facade=this.facade;var baseTemplateData=this.getBaseTemplateDataGivenFacade(facade);var summaryTemplateData=mentionTemplatesHelper.getSummaryTemplateDataGivenFacade(facade);var metricsTimeout=setTimeout(function(){$el.spin()},10);metrics.load(function(err,metrics){clearTimeout(metricsTimeout);var combinedTemplateData=_.extend(baseTemplateData,summaryTemplateData,{pageTypes:mentionTemplatesHelper.getPageTypesForSummaryTemplateGivenMetrics(metrics)});$el.html(mentionTemplatesHelper.getSummaryTemplateGivenFacade(facade)(combinedTemplateData))})},showError:function showError(selector){this.$(selector).addClass("error");this.trigger("error")},onClickTwitterUsername:function onClickTwitterUsername(e){e.preventDefault();e.stopPropagation();var $target=$(e.target);this.showAuthorMenu($target.data("author-name"),$target,true)},onClickShowAuthorMenu:function onClickShowAuthorMenu(e){e.preventDefault();e.stopPropagation();var $target=$(e.target);this.showAuthorMenu($target.data("author-name"),$target,false)},showAuthorMenu:function showAuthorMenu(author,$target,isTwitter){var queryId=this.facade.getQueryId();var settings=this.facade.getSettings();AuthorContextMenu.show({author:author,$target:$target,settings:new Controls({queryId:queryId,startDate:settings.get("startDate"),endDate:settings.get("endDate")}),isTwitterProfile:isTwitter,hidePrimaryLink:true})},onClickLocation:function onClickLocation(){var self=this;var $location=this.$(".location a");var $autocomplete=this.autocomplete=this.autocomplete||$('<div class="LocationFiltersAutocomplete singlepadding lightgreybg rounded">'+'<input type="text" autocomplete="off" class="field autocomplete" '+'name="locations" placeholder="Select Location..."></div>');var $input=$autocomplete.find("input");var facade=this.facade;var locationId=facade.get("location");$autocomplete.appendTo("body").showRelativeTo({target:$location,position:function position(){var locationOffset=$location.offset();return{position:"absolute",top:locationOffset.top-17,left:locationOffset.left-12,zIndex:3e4}}});$input.autocomplete({css:{width:450},renderResult:function renderResult(result){var name=result.fullName;var commaIdx=name.indexOf(",");name="<em>"+name.substring(0,commaIdx>-1?commaIdx:name.length)+"</em>"+(commaIdx>-1?name.substring(commaIdx,name.length):"");return name.length>83?name.substring(0,80)+"...":name},filterResult:function filterResult(result){return result.id!==locationId},parseData:function parseData(data){return data.results},selected:function selected(result){facade.save({location:result.id},{patch:true,error:function error(){self.showError(".location")}});$autocomplete.remove()},plugins:[{plugin:$.fn.autocomplete.ajax,options:{url:Workbench.buildApiUrl("/locations"),params:{pageSize:20,page:0}}}]});$("body").off("click.removeMentionMetricSummaryView").on("click.removeMentionMetricSummaryView",function(e){if($(e.target).closest(".location").length||$(e.target).closest(".LocationFiltersAutocomplete").length){return false}$autocomplete.remove()});$input.val("").focus()},onClickPageType:function onClickPageType(){var pageTypeMenu=this.$(".pageTypeMenu").toggleClass("hidden");if(!pageTypeMenu.hasClass("hidden")){$("body").on("click.pageTypeMenu",function(e){if($(e.target).closest(".pageType").length){return}pageTypeMenu.addClass("hidden");$("body").off("click.pageTypeMenu")})}},onSelectPageType:function onSelectPageType(e){var self=this;var pageType=$(e.target).attr("class");this.facade.save({pageType:pageType},{patch:true,error:function error(){self.showError(".pageType")}});this.$(".pageTypeMenu").addClass("hidden")},onToggleMetrics:function onToggleMetrics(){return this.layoutManager.toggleSubView("mentionMetricsView")},handleShowMetricsView:function handleShowMetricsView(){this.$(".showMetrics a").html('Hide Metrics<span class="symbol icon-double-chevron-up"></span>')},handleHideMetricsView:function handleHideMetricsView(){this.$(".showMetrics a").html('Show Metrics<span class="symbol icon-double-chevron-down"></span>')}})});define("src/components/mentions/_singlemention/views/MentionMetricsView",["backbone","jquery","q","src/views/AuthorContextMenu","src/models/Controls","src/components/mentions/_singlemention/helpers/mentionTemplatesHelper"],function(Backbone,$,Q,AuthorContextMenu,Controls,mentionTemplatesHelper){"use strict";return Backbone.View.extend({className:"mentionMetricsView",events:function events(){return{"click .author .twitter-username":"onClickTwitterUsername","click .smv-metrics-domain":"onClickDomain"}},constructor:function MentionMetricsView(options){options=options||{};var facade=options.facade;var layoutManager=options.layoutManager;if(!facade){throw new Error("MentionMetricsView must be initialized with a facade")}if(!layoutManager){throw new Error("MentionMetricsView must be initialized with a layoutManager")}this.dashboardType=options.dashboardType;this.viewType=options.viewType;this.facade=facade;this.listenTo(this.facade,"change",this.render);this.layoutManager=layoutManager;this.listenTo(this.layoutManager,"showView:mentionMetricsView",this.handleShowMetricsView);this.listenTo(this.layoutManager,"hideView:mentionMetricsView",this.handleHideMetricsView);Backbone.View.apply(this,arguments)},render:function render(){var facade=this.facade;var isChannelMention=facade.isChannelMention();var isMentionMetricsVisible=this.layoutManager.isVisible("mentionMetricsView")&&!isChannelMention;this.$el.html(mentionTemplatesHelper.getMetricsTemplateGivenFacade(facade));if(!isMentionMetricsVisible){this.layoutManager.hideSubView("mentionMetricsView")}},onClickDomain:function onClickDomain(e){e.preventDefault();e.stopPropagation();var $target=$(e.target);var domain=$target.text();return this.showDomainMenu(domain,$target)},onClickTwitterUsername:function onClickTwitterUsername(e){e.preventDefault();e.stopPropagation();var $target=$(e.target);var author=$target.data("author-name");this.showAuthorMenu(author,$target)},showAuthorMenu:function showAuthorMenu(author,$target){var queryId=this.facade.getQueryId();var settings=this.facade.getSettings();AuthorContextMenu.show({author:author,$target:$target,settings:new Controls({queryId:queryId,startDate:settings.get("startDate"),endDate:settings.get("endDate")}),isTwitterProfile:true,hidePrimaryLink:true})},showDomainMenu:function showDomainMenu(domain,$target){var self=this;var queryId=this.facade.getQueryId();return new Q.Promise(function(resolve,reject){require(["src/views/DomainContextMenu"],function(DomainContextMenu){self.contextMenu=DomainContextMenu.show({domain:domain,$target:$target,settings:new Backbone.Model({queryId:queryId}),hidePrimaryLink:true});resolve()},reject)})},handleShowMetricsView:function handleShowMetricsView(){this.$el.removeClass("hidden")},handleHideMetricsView:function handleHideMetricsView(){this.$el.addClass("hidden")}})});define("mustache!src/components/mentions/templates/engageContextMenu",["lib/mustache"],function(mustache){var escapedTemplate='<ul>\n<li class="context-menu--section-title"><span class="facebook-logo"></span>Facebook</li>\n<li class="context-menu--item iconindent js-fb-post"><a>Post this</a></li>\n\n{{#showTweetThis}}\n<li class="context-menu--item iconindent separator"></li>\n<li class="context-menu--section-title"><span class="twitter-logo"></span>Twitter</li>\n<li class="context-menu--item iconindent js-tw-tweet">\n<a class="tweet" target="_blank" data-id="{{id}}" href="https://twitter.com/intent/tweet?text={{text}}">tweet this</a>\n</li>\n{{/showTweetThis}}\n</ul>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/components/mentions/css/engageContextMenu.css",["css!src/components/mentions/css/compiled.css"],function(){});define("src/components/mentions/views/EngageContextMenu",["underscore","src/globals/me","src/helpers/FB","bw-fe-helpers/validationHelpers","src/components/notes/models/Note","src/views/ContextMenuView","mustache!src/components/mentions/templates/engageContextMenu","css!src/components/mentions/css/engageContextMenu.css"],function(_,me,FB,validationHelpers,Note,ContextMenuView,template){"use strict";return ContextMenuView.extend({tagName:"nav",className:"engageContextMenu context-menu popupframe",constructor:function EngageContextMenu(options){ContextMenuView.apply(this,arguments);options=options||{};if(!options||!options.mention){throw new Error("EngageContextMenu must be initialized with options.mention")}this.mention=options.mention},events:function events(){return{"click li.js-fb-post":"onClickFacebookPost"}},onClickFacebookPost:function onClickFacebookPost(e){var mention=this.mention.toJSON(),noteId=_.last(mention.noteIds||[]),userName=me.get("username")||"n/a";e.preventDefault();FB.postToWall({url:mention.url,title:mention.title,snippet:mention.snippet},function(err,postId){var note;if(err){return console.error("Error posting to Facebook",err)}if(validationHelpers.isNullOrEmptyString(postId)){return}note=new Note({id:noteId,mentionId:mention.id});note.prepend({header:"--- Facebook ---\n"+userName+"\nShared this on Facebook:",text:FB.getPostToWallUrl(postId)})})},getTemplateData:function getTemplateData(){return{id:this.mention.id,text:this.mention.get("url"),showTweetThis:!this.mention.isTwitter()}},render:function render(){var templateData=this.getTemplateData();this.$el.html(template(templateData))}})});define("mustache!src/components/mentions/templates/mentionsIntents",["lib/mustache"],function(mustache){var escapedTemplate='<div class="mentionIntents overflow-hidden tinypadding-vertical">\n<a href="#" title="Engagement options" class="engage floatleft customtip nowrap">\n<span class="icon-share-alt tinypadding-right"></span>\n<span class="action-text">Engage</span>\n</a>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/helpers/twitterHelper",["src/globals/queries","src/permissions","src/globals/currentDashboard","mustache!src/components/mentions/templates/mentionTweetIntents"],function(queries,permissions,currentDashboard,renderMentionTweetIntentsTemplate){"use strict";var TWITTER_HANDLE_MAX_LENGTH=15;var twitterHelper={getNameFromQuery:function getNameFromQuery(queryId){var query;if(!queries.length){return}query=queries.get(queryId);if(!query){return}return query.get("name")},getIntentsMarkupFromUrl:function getIntentsMarkupFromUrl(tweetUrl,showEngageOption){var tweetId=twitterHelper.getTweetIdFromTweetUrl(tweetUrl);if(!!tweetId&&permissions.check("see.engagement.twitterIntents",currentDashboard)){return renderMentionTweetIntentsTemplate({tweetId:tweetId,showEngageOption:showEngageOption&&permissions.check("see.engagement",currentDashboard)},false)}else{return undefined}},getTweetIdFromTweetUrl:function getTweetIdFromTweetUrl(url){if(!url){return""}var getTweetIdRegEx=/twitter.*\/status(?:es)?\/([0-9]+).*$/,results=getTweetIdRegEx.exec(url);if(results){return results[1]}return""},makeUrlEntities:function makeUrlEntities(item){var shortUrls=[].concat(item.shortUrls||[]),expandedUrls=[].concat(item.expandedUrls||[]),displayUrls=[].concat(item.displayUrls||[]);if(shortUrls.length===0&&expandedUrls.length===0&&displayUrls.length===0){return}return shortUrls.reduce(function(urlEntities,elem,index){urlEntities.push({url:shortUrls[index],display_url:displayUrls[index],expanded_url:expandedUrls[index]});return urlEntities},[])},validateHandle:function validateHandle(handle){var containsAtSign;var maxHandleLength;if(!handle){return}containsAtSign=handle.charAt(0)==="@";if(containsAtSign&&handle.length===1){return"Twitter handle cannot be empty"}maxHandleLength=containsAtSign?TWITTER_HANDLE_MAX_LENGTH+1:TWITTER_HANDLE_MAX_LENGTH;if(handle.length>maxHandleLength){return"Twitter handle cannot exceed "+TWITTER_HANDLE_MAX_LENGTH+" characters"}if(!/^@?[a-zA-Z0-9_]*$/.test(handle)){return"A Twitter handle can only contain letters, numbers and underscores"}}};return twitterHelper});define("src/helpers/mentionSnippetParser",["underscore"],function(_){"use strict";var HTML_ENTITIES={">":"&gt;","<":"&lt;","&":"&amp;"};function getFirstChar(text,pos){while(pos>0&&text[pos-1]!==" "){pos--}return text[pos]}function escape(text){return text&&text.replace(/[><&]/g,function(character){return HTML_ENTITIES[character]})}return{parse:function parse(text,mentionPositions){text=text||"";var lastMention=0,value=_(mentionPositions).chain().map(function(mention){var beforeMention,mentionText,oldMention=lastMention;lastMention=mention.start+mention.length;beforeMention=text.substring(oldMention,mention.start);mentionText=text.substring(mention.start,lastMention);if(_.indexOf(["#","@"],getFirstChar(text,mention.start))!==-1){return[escape(beforeMention),escape(mentionText)]}return[escape(beforeMention),'<span class="matchedTerm">',escape(mentionText),"</span>"]}).flatten().value().join("")+escape(text.substring(lastMention));return value}}});define("src/components/mentions/_singlemention/views/MentionSnippetView",["backbone","jquery","src/permissions","src/globals/currentDashboard","src/views/AuthorContextMenu","src/components/mentions/_mentionsprofile/views/TwitterProfileView","src/components/mentions/views/EngageContextMenu","mustache!src/components/mentions/templates/mentionsIntents","bw-fe-helpers/autoLinkHelper","src/helpers/twitterHelper","src/helpers/mentionSnippetParser","css!src/components/mentions/css/mentionTweetIntents.css","src/packages/customtip"],function(Backbone,$,permissions,currentDashboard,AuthorContextMenu,TwitterProfileView,EngageContextMenu,mentionsIntents,autoLinkHelper,twitterHelper,mentionSnippetParser){"use strict";function getParsedSnippet(facade){var snippet=mentionSnippetParser.parse(facade.get("snippet"),facade.get("mentions"))||"";if(facade.get("pageType")==="twitter"){snippet=autoLinkHelper.twitterContent(snippet,{urlEntities:twitterHelper.makeUrlEntities(facade.getMention()||{}),htmlEscapeNonEntities:false})}if(facade.get("domain")==="www.instagram.com"){snippet=autoLinkHelper.instagramContent(snippet,{htmlEscapeNonEntities:false})}return snippet}return Backbone.View.extend({events:{"click a.twitter-username":"onClickTwitterUsername","click a.twitter-avatar":"onClickTwitterAvatar","click a.engage":"onClickEngage"},className:"mentionSnippetView",initialize:function initialize(options){options=options||{};var facade=options.facade,layoutManager=options.layoutManager;if(!facade){throw new Error("MentionSnippetView must be initialized with a facade")}if(!layoutManager){throw new Error("MentionSnippetView must be initialized with a layoutManager")}this.facade=facade;facade.on("change",this.render,this);this.layoutManager=layoutManager;this.layoutManager.on("showView:mentionSnippetView",this.onViewShown,this);this.layoutManager.on("hideView:mentionSnippetView",this.onViewHidden,this)},remove:function remove(){this.facade.off("change",this.render,this);this.layoutManager.off("showView:mentionSnippetView",this.onViewShown,this);this.layoutManager.off("hideView:mentionSnippetView",this.onViewHidden,this);Backbone.View.prototype.remove.call(this)},render:function render(){var facade=this.facade;var html="";var mention;var avatarUrl;var isTwitterChannelMention=facade.get("pageType")==="twitter";var showMentionIntents=false;var parsedSnippet=getParsedSnippet(facade);if(permissions.check("see.engagement",currentDashboard)){showMentionIntents=!facade.getMention().isOfflinePublication}if(isTwitterChannelMention){mention=this.facade.getMention();avatarUrl=mention.avatarUrl||"/img/twitter-profile-default.png";html+='<a class="twitter-avatar floatleft smallmargin-right" data-author="'+mention.author+'">'+'<img src="'+avatarUrl+'" alt="Show Profile"></a>';showMentionIntents=false}this.$el.html(html+"<p>"+parsedSnippet+"</p>"+(isTwitterChannelMention?twitterHelper.getIntentsMarkupFromUrl(facade.get("url"),true):"")+(showMentionIntents?mentionsIntents():""));this.$el.customtip();if(!this.layoutManager.isVisible("mentionSnippetView")){this.$el.addClass("hidden")}},onViewShown:function onViewShown(){this.$el.removeClass("hidden")},onViewHidden:function onViewHidden(){this.$el.addClass("hidden")},onClickTwitterAvatar:function onClickTwitterAvatar(e){var $target=$(e.target),$currentTarget=$(e.currentTarget);e.preventDefault();e.stopPropagation();AuthorContextMenu.show({settings:new Backbone.Model(this.facade.getMention()),$target:$target,author:$currentTarget.data("author"),isTwitterProfile:true,hideMentions:true})},onClickTwitterUsername:function onClickTwitterUsername(e){var author=$(e.target).data("screen-name");if(!author){return}e.preventDefault();TwitterProfileView.show(author)},onClickEngage:function onClickEngage(e){e.preventDefault();e.stopPropagation();if(this.engageContextMenu){this.engageContextMenu.remove()}this.engageContextMenu=EngageContextMenu.show({$target:$(e.target),mention:this.facade.getMentionModel()})}})});define("mustache!src/components/mentions/_singlemention/templates/mentionSentimentView",["lib/mustache"],function(mustache){var escapedTemplate='<div class="content">\n<ul class="sentiment">\n<li><button class="positive{{#isPositive}} active{{/isPositive}}">Pos</button></li>\n<li><button class="neutral{{#isNeutral}} active{{/isNeutral}}">Neu</button></li>\n<li><button class="negative{{#isNegative}} active{{/isNegative}}">Neg</button></li>\n</ul>\n<div class="toggle-checked rounded">\n<input type="checkbox" id="checked-{{cid}}" {{#mentionChecked}}checked{{/mentionChecked}}/>\n<label for="checked-{{cid}}">Checked?</label>\n</div>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/components/mentions/_singlemention/views/MentionSentimentView",["backbone","jquery","src/ApiError","mustache!src/components/mentions/_singlemention/templates/mentionSentimentView","src/packages/spin"],function(Backbone,$,ApiError,mentionSentimentView){"use strict";return Backbone.View.extend({tagName:"section",className:"mentionSentimentView rounded",events:{"click .sentiment .positive":"onSentimentPositive","click .sentiment .neutral":"onSentimentNeutral","click .sentiment .negative":"onSentimentNegative","change .toggle-checked input[type=checkbox]":"onToggleChecked"},initialize:function initialize(options){options=options||{};var facade=options.facade,layoutManager=options.layoutManager;if(!facade){throw new Error("MentionSentimentView must be initialized with a facade")}if(!layoutManager){throw new Error("MentionSentimentView must be initialized with a layoutManager")}this.facade=facade;facade.on("change",this.render,this);this.layoutManager=layoutManager},remove:function remove(){this.facade.off("change",this.render,this);Backbone.View.prototype.remove.call(this)},render:function render(){var mention=this.facade.getMention();if(!mention){return this.$el.empty()}this.$el.html(mentionSentimentView({cid:this.cid,mentionChecked:!!mention.checked,isPositive:mention.sentiment==="positive",isNeutral:mention.sentiment==="neutral",isNegative:mention.sentiment==="negative"}))},onSentimentPositive:function onSentimentPositive(){this.changeSentiment("positive")},onSentimentNeutral:function onSentimentNeutral(){this.changeSentiment("neutral")},onSentimentNegative:function onSentimentNegative(){this.changeSentiment("negative")},onToggleChecked:function onToggleChecked(e){this.toggleChecked($(e.target).is(":checked"))},showError:function showError(selector){this.$(selector).addClass("error");this.trigger("error")},triggerDelayEvent:function triggerDelayEvent(){this.trigger("delayed")},handleError:function handleError(){var xhr=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var errorSelector=arguments.length>1?arguments[1]:undefined;if(xhr.status===202){this.triggerDelayEvent()}else{var err=new ApiError(xhr);console.error(err);this.showError(errorSelector)}},changeSentiment:function changeSentiment(sentiment){var self=this,$sentiment=this.$(".sentiment ."+sentiment),facade=this.facade;$sentiment.spin({lines:9,length:3,width:2,radius:3});facade.save({sentiment:sentiment},{patch:true,success:function success(){$sentiment.spin(false)},error:function error(model,xhr){$sentiment.spin(false);self.handleError(xhr,".sentiment")}})},toggleChecked:function toggleChecked(checked){var self=this,$container=this.$(".toggle-checked");$container.spin({lines:9,length:3,width:2,radius:3});this.facade.save({checked:checked},{patch:true,success:function success(){$container.spin(false)},error:function error(model,xhr){self.handleError(xhr,".toggle-checked")}})},setCheckedBox:function setCheckedBox(checked){var checkedEl=this.$('.toggle-checked > input[type="checkbox"]');checkedEl.prop("checked",checked)}})});define("src/controls/lib/controlsViewDataBuilder",["underscore"],function(_){"use strict";function capitaliseText(name){name=(name||"").toString();if(!name||name.length<2){return name}return name[0].toUpperCase()+name.substring(1)}function shouldBeSelected(item,selectedIds){if(!selectedIds){return false}if(_.isArray(selectedIds)){return _(selectedIds).any(function(id){return id==item.id})}return selectedIds==item.id}function defaultIsReadonly(){return false}return{buildOptionsFromObject:function buildOptionsFromObject(items,selectedIds,isReadOnly){var buildOption=this.buildOption;isReadOnly=isReadOnly||defaultIsReadonly;return _(items).map(function(item){if(item.options){return'<optgroup label="'+item.name+'">'+_(item.options).map(function(option){return buildOption({isSelected:shouldBeSelected(option,selectedIds),val:option.id,text:option.name,readonly:isReadOnly(option)})})+"</optgroup>"}else{return buildOption({isSelected:shouldBeSelected(item,selectedIds),val:item.id,text:item.name,readonly:isReadOnly(item)})}})},buildOptionsFromArray:function buildOptionsFromArray(values,selectedValues){var buildOption=this.buildOption;selectedValues=[].concat(selectedValues);return _(values).map(function(value){var selected=_(selectedValues).any(function(selectedValue){return selectedValue==value});return buildOption({isSelected:selected,val:value,text:capitaliseText(value)})})},buildOption:function buildOption(options){var opts=options||{},selectedAttr=opts.isSelected?' selected="selected"':"",readonlyAttr=opts.readonly?' data-readonly="true"':"",text=opts.text,val=opts.val;text=text||val;return"<option"+selectedAttr+readonlyAttr+' value="'+val+'">'+_.escape(text)+"</option>"},mapUserMetrics:function mapUserMetrics(model,metrics){var buildOption=this.buildOption,mappedMetrics={};if(!metrics){return mappedMetrics}var currentSentiments=_([].concat(model.get("sentiment")||[])).map(function(s){return s.toLowerCase()}),currentPageTypes=_([].concat(model.get("pageType")||[])).map(function(s){return s.toLowerCase()}),currentxPageTypes=_([].concat(model.get("xpageType")||[])).map(function(s){return s.toLowerCase()});mappedMetrics.sentimentOptions=_(metrics.sentiments).map(function(sentiment){return buildOption({isSelected:currentSentiments.indexOf(sentiment.toLowerCase())>-1,val:sentiment,text:capitaliseText(sentiment)})});mappedMetrics.pageTypeOptions=_(metrics.pageTypes).map(function(pageType){return buildOption({isSelected:currentPageTypes.indexOf(pageType.toLowerCase())>-1,val:pageType,text:capitaliseText(pageType)})});mappedMetrics.excludedPageTypeOptions=_(metrics.pageTypes).map(function(pageType){return buildOption({isSelected:currentxPageTypes.indexOf(pageType.toLowerCase())>-1,val:pageType,text:capitaliseText(pageType)})});return mappedMetrics}}});function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};var ownKeys=Object.keys(source);if(typeof Object.getOwnPropertySymbols==="function"){ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))}ownKeys.forEach(function(key){_defineProperty(target,key,source[key])})}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}define("src/models/ClassificationCollection",["backbone"],function(Backbone){"use strict";function nameComparator(_ref,_ref2){var _ref$name=_ref.name,nameA=_ref$name===void 0?"":_ref$name;var _ref2$name=_ref2.name,nameB=_ref2$name===void 0?"":_ref2$name;return nameA.localeCompare(nameB)}return Backbone.Collection.extend({constructor:function ClassificationCollection(data,options){Backbone.Collection.apply(this,arguments);this.projectId=options&&options.projectId},url:function url(){var projectId=this.projectId||"{projectId}";return"/projects/".concat(projectId,"/classifications")},parse:function parse(response){var projectId=this.projectId;return(response.results||[]).map(function(classification){return _objectSpread({},classification,{labels:classification.labels.sort(nameComparator),projectId:projectId})})},getEmotionLabels:function getEmotionLabels(){var emotionsClassification=this.models.find(function(classification){return classification.get("classifierId")==="emotions"});return emotionsClassification&&emotionsClassification.get("labels")||[]}})});define("src/globals/classifications",["src/globals/currentProject","src/models/ClassificationCollection"],function(currentProject,ClassificationCollection){"use strict";var classificiations=new ClassificationCollection;currentProject.onLoad(function(callback){classificiations.projectId=currentProject.id;if(!currentProject.id){classificiations.reset([],{silent:false});return}classificiations.reset([],{silent:true});classificiations.fetch().then(function(){return callback()}).catch(function(err){return callback(err)});callback()});return classificiations});define("mustache!src/components/mentions/_singlemention/templates/mentionEmotionsView",["lib/mustache"],function(mustache){var escapedTemplate='<h1>\n<span class="collapsed-status icon-caret-down"></span>Emotions\n</h1>\n<div class="content">\n{{#canEdit}}\n<select class="js-emotions-select" multiple>\n{{{emotionOptions}}}\n</select>\n{{/canEdit}}\n{{^canEdit}}\n{{#emotions.length}}\n<ul class="emotions">\n{{#emotions}}\n<li class="{{id}}">{{name}}</li>\n{{/emotions}}\n</ul>\n{{/emotions.length}}\n{{^emotions.length}}\n<span class="lightgrey">No emotion detected</span>\n{{/emotions.length}}\n{{/canEdit}}\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("text!src/controls/templates/sellecktSelection.template",[],function(){return'<li class="selectionItem rounded relative" data-value="{{value}}">\n    <div class="relative smallpadding-left doublepadding-right textellipsis ellipsistooltip customtip" title="{{text}}">\n        {{text}}<i class="icon-remove remove iconsmaller grey  absright hugeline smallmargin-right customtip" title="Deselect"></i>\n    </div>\n</li>\n'});define("src/components/mentions/_singlemention/views/MentionEmotionsView",["backbone","src/controls/lib/controlsViewDataBuilder","src/globals/flags","src/globals/flagNames","src/globals/classifications","mustache!src/components/mentions/_singlemention/templates/mentionEmotionsView","text!src/controls/templates/sellecktMain.template","text!src/controls/templates/sellecktPopup.template","text!src/controls/templates/sellecktItem.template","text!src/controls/templates/sellecktSelection.template","src/packages/selleckt","src/packages/waitmask"],function(Backbone,controlsViewDataBuilder,flags,FLAGS,globalClassifications,template,sellecktMainTemplate,sellecktPopupTemplate,sellecktItemTemplate,sellecktSelectionTemplate){"use strict";function onAddEmotion(view,_ref){var value=_ref.value,label=_ref.label;onPatchRequest(view);view.facade.save({addClassifications:["emotions:".concat(value)]},{patch:true,success:onSuccess.bind(null,view),error:onError.bind(null,view,"Sorry we <strong>couldn't add the Emotion ".concat(label,"</strong>"))})}function onRemoveEmotion(view,_ref2){var value=_ref2.value,label=_ref2.label;onPatchRequest(view);view.facade.save({removeClassifications:["emotions:".concat(value)]},{patch:true,success:onSuccess.bind(null,view),error:onError.bind(null,view,"Sorry we <strong>couldn't remove the Emotion ".concat(label,"</strong>"))})}function onPatchRequest(view){view.$(".content").showWaitmask({minHeight:0});view._preventRendering=true}function onSuccess(view){view._preventRendering=false;view.$(".content").hideWaitmask()}function onError(view,errorMessage){view._preventRendering=false;view.$(".content").hideWaitmask();view.trigger("error",errorMessage);view.render()}function removeSelleckt(view){if(view.selleckt){view.selleckt.off("itemSelected");view.selleckt.off("itemUnselected");view.selleckt.destroy();view.selleckt=undefined}}return Backbone.View.extend({tagName:"section",className:"mentionEmotionsView rounded",events:{"click h1":"onClickTitle"},constructor:function MentionEmotionsView(){var _this=this;var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var facade=options.facade,layoutManager=options.layoutManager;if(!facade){throw new Error("MentionEmotionsView must be initialized with a facade")}if(!layoutManager){throw new Error("MentionEmotionsView must be initialized with a layoutManager")}this.facade=facade;facade.on("change",function(){return!_this._preventRendering&&_this.render()});this.layoutManager=layoutManager;this.listenTo(this.layoutManager,"hideView:mentionEmotionsView",this.onViewHidden);this.listenTo(this.layoutManager,"showView:mentionEmotionsView",this.onViewShown);Backbone.View.apply(this,arguments)},remove:function remove(){this.facade.off("change",this.render,this);removeSelleckt(this);Backbone.View.prototype.remove.call(this)},render:function render(){var mention=this.facade.getMention();removeSelleckt(this);if(!mention){return this.$el.empty()}var mentionClassifications=mention.classifications||[];var emotions=mentionClassifications.filter(function(classification){return classification.classifierId==="emotions"}).map(function(_ref3){var id=_ref3.labelId,name=_ref3.name;return{id:id,name:name}}).sort(function(emotionA,emotionB){return emotionA.name.localeCompare(emotionB.name)});var globalEmotions=globalClassifications.getEmotionLabels();var canEdit=flags.variation(FLAGS.ENABLE_EMOTIONS_MARKUP);var emotionOptions=controlsViewDataBuilder.buildOptionsFromObject(globalEmotions,emotions.map(function(_ref4){var id=_ref4.id;return id}));this.$el.html(template({canEdit:canEdit,emotions:emotions,emotionOptions:emotionOptions}));if(canEdit){this.selleckt=this.$(".js-emotions-select").selleckt({placeholderText:"Emotions",alternatePlaceholder:"Emotions",mainTemplate:sellecktMainTemplate,itemTemplate:sellecktItemTemplate,popupTemplate:sellecktPopupTemplate,selectionTemplate:sellecktSelectionTemplate,unselectItemClass:"remove",mainTemplateData:{selectionBottom:true}}).data("selleckt");this.selleckt.on("itemSelected",onAddEmotion.bind(null,this));this.selleckt.on("itemUnselected",onRemoveEmotion.bind(null,this))}},onClickTitle:function onClickTitle(){if(this.$el.hasClass("collapsed")){this.layoutManager.showSubView("mentionEmotionsView")}else{this.layoutManager.hideSubView("mentionEmotionsView")}},onViewHidden:function onViewHidden(){this.$el.addClass("collapsed");this.$(".collapsed-status").removeClass("icon-caret-down").addClass("icon-caret-right")},onViewShown:function onViewShown(){this.$el.removeClass("collapsed");this.$(".collapsed-status").addClass("icon-caret-down").removeClass("icon-caret-right")}})});define("src/components/mentions/_singlemention/views/MentionTagsView",["backbone","underscore","src/globals/tags","src/ApiError","src/components/mentions/views/TagsInputView"],function(Backbone,_,globalTags,ApiError,TagsInputView){"use strict";function sortTags(tags){return _(tags).sortBy(function(tag){return(tag||"").toLowerCase()})}return Backbone.View.extend({tagName:"section",className:"mentionTagsView rounded",events:{"click h1":"onClickTitle"},initialize:function initialize(options){var self=this;options=options||{};var facade=options.facade,layoutManager=options.layoutManager;if(!facade){throw new Error("MentionTagsView must be initialized with a facade")}if(!layoutManager){throw new Error("MentionTagsView must be initialized with a layoutManager")}this.facade=facade;facade.on("change",this.updateTags,this);this.layoutManager=layoutManager;this.layoutManager.on("hideView:mentionTagsView",this.onViewHidden,this);this.layoutManager.on("showView:mentionTagsView",this.onViewShown,this);this.tagsInput=new TagsInputView({tagCollection:globalTags,autocompleteMatchIfContains:true,tags:sortTags(this.facade.get("tags")),onAdd:function onAdd(tag,done){globalTags.ensureTagExists(tag,{success:function success(){facade.save({addTag:[tag]},{patch:true,success:function success(){done()},error:function error(model,xhr){self.handleError(xhr,done)}})},error:function error(model,xhr){self.handleError(xhr,done)}})},onRemove:function onRemove(tag,done){facade.save({removeTag:[tag]},{patch:true,success:function success(){done()},error:function error(model,xhr){self.handleError(xhr,done)}})}})},handleError:function handleError(){var xhr=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var done=arguments.length>1?arguments[1]:undefined;if(xhr.status===202){this.triggerDelayEvent();done()}else{var err=new ApiError(xhr);done(err)}},triggerDelayEvent:function triggerDelayEvent(){this.trigger("delayed")},remove:function remove(){this.facade.off("change",this.updateTags,this);this.layoutManager.off("hideView:mentionTagsView",this.onViewHidden,this);this.layoutManager.off("showView:mentionTagsView",this.onViewShown,this);this.tagsInput.remove();Backbone.View.prototype.remove.call(this)},render:function render(){this.updateTags();this.tagsInput.$el.detach();this.$el.html('<h1><a class="collapsed-status icon-caret-down"></a>Tags</h1><div class=content />');this.$(".content").append(this.tagsInput.el);if(!this.layoutManager.isVisible("mentionTagsView")){this.onViewHidden()}},updateTags:function updateTags(){this.tagsInput.tags=sortTags(this.facade.get("tags"));this.tagsInput.render()},setFocus:function setFocus(){this.onViewShown();this.$("input").focus()},onClickTitle:function onClickTitle(){if(this.$el.hasClass("collapsed")){this.layoutManager.showSubView("mentionTagsView")}else{this.layoutManager.hideSubView("mentionTagsView")}},onViewHidden:function onViewHidden(){this.$el.addClass("collapsed");this.$(".collapsed-status").removeClass("icon-caret-down").addClass("icon-caret-right")},onViewShown:function onViewShown(){this.$el.removeClass("collapsed");this.$(".collapsed-status").addClass("icon-caret-down").removeClass("icon-caret-right")}})});define("src/components/mentions/_singlemention/views/MentionWorkflow/AssigneeSelectView",["underscore","src/components/mentions/_singlemention/views/SingleCategorySelectView"],function(_,SingleCategorySelectView){"use strict";var AssigneeSelectView=SingleCategorySelectView.extend({className:"singleCategorySelectView categorySelectView categorySelectViewFullWidth",constructor:function AssigneeSelectView(options){if(!options||!options.workflow){throw new TypeError("AssigneeSelectView must be instantiated with a workflow option")}this.workflow=options.workflow;SingleCategorySelectView.apply(this,arguments)},getSelectedCategory:function getSelectedCategory(){var assignee=this.mention.get("assignment"),assignments=this.workflow.get("assignment")||{},workflow=_(assignments.children||[]).find(function(workflow){return workflow.name===assignee});return workflow&&workflow.id},hasChanged:function hasChanged(){return!!this.mention.changedAttributes().assignment},addCategory:function addCategory(id,options){var self=this;var assignments=this.workflow.get("assignment")||{},workflow=_(assignments.children).find(function(workflow){return workflow.id===id});this.mention.save({assignment:workflow&&workflow.name},Object.assign({patch:true,error:function error(){self.stopWaiting();self.triggerDelayEvent()}},options))},removeCategory:function removeCategory(id,options){var self=this;var assignments=this.workflow.get("assignment")||{},workflow=_(assignments.children).find(function(workflow){return workflow.id===id});this.mention.save({removeAssignment:workflow&&workflow.name},Object.assign({patch:true,error:function error(){self.stopWaiting();self.triggerDelayEvent()}},options))},triggerDelayEvent:function triggerDelayEvent(){this.trigger("delayed")},stopWaiting:function stopWaiting(){if(!this.$("a.selected")){return}var $selected=this.$("a.selected");$selected.spin(false);this.waiting=false}});return AssigneeSelectView});define("src/components/mentions/_singlemention/views/MentionWorkflow/PrioritySelectView",["underscore","src/components/mentions/_singlemention/views/SingleCategorySelectView"],function(_,SingleCategorySelectView){"use strict";var PrioritySelectView=SingleCategorySelectView.extend({constructor:function PrioritySelectView(options){if(!options||!options.workflow){throw new TypeError("PrioritySelectView must be instantiated with a workflow option")}this.workflow=options.workflow;SingleCategorySelectView.apply(this,arguments)},getSelectedCategory:function getSelectedCategory(){var priority=this.mention.get("priority"),priorities=this.workflow.get("priority")||{},workflow=_(priorities.children).find(function(workflow){return workflow.name===priority});return workflow&&workflow.id},hasChanged:function hasChanged(){return!!this.mention.changedAttributes().priority},addCategory:function addCategory(id,options){var priorities=this.workflow.get("priority")||{},workflow=_(priorities.children).find(function(workflow){return workflow.id===id});this.mention.save({priority:workflow&&workflow.name},Object.assign({patch:true,error:function error(){self.stopWaiting();self.triggerDelayEvent()}},options))},removeCategory:function removeCategory(id,options){var priorities=this.workflow.get("priority")||{},workflow=_(priorities.children).find(function(workflow){return workflow.id===id});this.mention.save({removePriority:workflow&&workflow.name},Object.assign({patch:true,error:function error(){self.stopWaiting();self.triggerDelayEvent()}},options))},triggerDelayEvent:function triggerDelayEvent(){this.trigger("delayed")},stopWaiting:function stopWaiting(){if(!this.$("a.selected")){return}var $selected=this.$("a.selected");$selected.spin(false);this.waiting=false}});return PrioritySelectView});define("src/components/mentions/_singlemention/views/MentionWorkflow/StatusSelectView",["underscore","src/components/mentions/_singlemention/views/SingleCategorySelectView"],function(_,SingleCategorySelectView){"use strict";var StatusSelectView=SingleCategorySelectView.extend({constructor:function StatusSelectView(options){if(!options||!options.workflow){throw new TypeError("StatusSelectView must be instantiated with a workflow option")}this.workflow=options.workflow;SingleCategorySelectView.apply(this,arguments)},getSelectedCategory:function getSelectedCategory(){var status=this.mention.get("status"),statuses=this.workflow.get("status")||{},workflow=_(statuses.children).find(function(workflow){return workflow.name===status});return workflow&&workflow.id},hasChanged:function hasChanged(){return!!this.mention.changedAttributes().status},addCategory:function addCategory(id,options){var statuses=this.workflow.get("status")||{},workflow=_(statuses.children).find(function(workflow){return workflow.id===id});this.mention.save({status:workflow&&workflow.name},Object.assign({patch:true,error:function error(){self.stopWaiting();self.triggerDelayEvent()}},options))},removeCategory:function removeCategory(id,options){var statuses=this.workflow.get("status")||{},workflow=_(statuses.children).find(function(workflow){return workflow.id===id});this.mention.save({removeStatus:workflow&&workflow.name},Object.assign({patch:true,error:function error(){self.stopWaiting();self.triggerDelayEvent()}},options))},triggerDelayEvent:function triggerDelayEvent(){this.trigger("delayed")},stopWaiting:function stopWaiting(){if(!this.$("a.selected")){return}var $selected=this.$("a.selected");$selected.spin(false);this.waiting=false}});return StatusSelectView});define("src/components/mentions/_singlemention/views/MentionWorkflow/MentionWorkflowView",["backbone","underscore","src/components/mentions/models/Mention","src/components/mentions/_singlemention/views/MentionWorkflow/AssigneeSelectView","src/components/mentions/_singlemention/views/MentionWorkflow/PrioritySelectView","src/components/mentions/_singlemention/views/MentionWorkflow/StatusSelectView","src/packages/spin"],function(Backbone,_,Mention,AssigneeSelectView,PrioritySelectView,StatusSelectView){"use strict";var MentionWorkflowView=Backbone.View.extend({tagName:"section",className:"mentionWorkflowView rounded",events:{"click h1":"onClickTitle"},constructor:function MentionWorkflowView(options){Backbone.View.apply(this,arguments);if(!options){throw new TypeError("MentionWorkflowView must be instantiated with an options argument")}if(!options.workflow){throw new TypeError("MentionWorkflowView must be instantiated with a workflow option")}this.workflow=options.workflow;if(!options.facade){throw new TypeError("MentionWorkflowView must be instantiated with a facade option")}this.facade=options.facade;this.listenTo(this.facade,"change",this.updateMention);this.listenTo(this.facade,"change",this.render);if(!options.layoutManager){throw new TypeError("MentionWorkflowView must be instantiated with a layoutManager option")}this.layoutManager=options.layoutManager;this.listenTo(this.layoutManager,"hideView:mentionWorkflowView",this.onViewHidden);this.listenTo(this.layoutManager,"showView:mentionWorkflowView",this.onViewShown);this.mention=new Mention;this.assignmentView=new AssigneeSelectView({workflow:options.workflow,readOnly:true,mention:this.mention,model:new Backbone.Model(options.workflow.get("assignment"))});this.assignmentView.on("delayed",this.triggerDelayEvent,this);this.priorityView=new PrioritySelectView({workflow:options.workflow,readOnly:true,mention:this.mention,model:new Backbone.Model(options.workflow.get("priority"))});this.priorityView.on("delayed",this.triggerDelayEvent,this);this.statusView=new StatusSelectView({workflow:options.workflow,readOnly:true,mention:this.mention,model:new Backbone.Model(options.workflow.get("status"))});this.statusView.on("delayed",this.triggerDelayEvent,this);this.updateMention()},remove:function remove(){this.assignmentView.remove();this.priorityView.remove();this.statusView.remove();Backbone.View.prototype.remove.call(this)},updateMention:function updateMention(){this.mention=this.facade.getMentionModel();this.assignmentView.setMention(this.mention);this.priorityView.setMention(this.mention);this.statusView.setMention(this.mention)},render:function render(){this.assignmentView.$el.detach();this.priorityView.$el.detach();this.statusView.$el.detach();this.$el.html('<h1><a class="collapsed-status icon-caret-down"></a>Workflow</h1><div class=content />');this.$(".content").append(this.assignmentView.el);this.assignmentView.render();this.$(".content").append(this.priorityView.el);this.priorityView.render();this.$(".content").append(this.statusView.el);this.statusView.render();if(!this.layoutManager.isVisible("mentionWorkflowView")){this.onViewHidden()}},closeAllPopups:function closeAllPopups(){_([this.assignmentView,this.priorityView,this.statusView]).each(function(view){if(_.isFunction(view.closeDropdown)){view.closeDropdown()}})},onClickTitle:function onClickTitle(){if(this.$el.hasClass("collapsed")){this.layoutManager.showSubView("mentionWorkflowView")}else{this.layoutManager.hideSubView("mentionWorkflowView")}},triggerDelayEvent:function triggerDelayEvent(){this.trigger("delayed")},onViewHidden:function onViewHidden(){this.$el.addClass("collapsed");this.$(".collapsed-status").removeClass("icon-caret-down").addClass("icon-caret-right")},onViewShown:function onViewShown(){this.$el.removeClass("collapsed");this.$(".collapsed-status").addClass("icon-caret-down").removeClass("icon-caret-right")}});return MentionWorkflowView});define("src/components/mentions/_singlemention/views/SearchAndHighlightView",["backbone","underscore","jquery"],function(Backbone,_,$){"use strict";var searchCss={"bw-highlight-term":{"background-color":"#FCFF03",color:"#000","border-radius":"3px",padding:"0 3px"},"bw-highlight-term-current":{"box-shadow":"0px 1px 4px rgba(0, 0, 0, 0.8)","-webkit-box-shadow":"0px 1px 4px rgba(0, 0, 0, 0.8)",color:"#000"},"bw-highlight-search":{background:"#FFA200","border-radius":"3px",padding:"0 3px"},"bw-highlight-search-current":{"box-shadow":"0px 1px 4px rgba(0, 0, 0, 0.8)","-webkit-box-shadow":"0px 1px 4px rgba(0, 0, 0, 0.8)"}},wordBoundaryRegEx="[\\s,.;:<>]",startWordBoundaryRegex=new RegExp("^"+wordBoundaryRegEx);function appendStylesToIframe($iframeContents){if(!$iframeContents.find("style.all-bw-styles").length){$iframeContents.find("head").append($('<style class="all-bw-styles">'+_(searchCss).map(function(val,key){return"."+key+"{"+_(val).map(function(val,key){return key+":"+val}).join(";")+"}"}).join("\n")+"}</style>"))}}function fixLinksInIframe($iframeContents){var $base=$iframeContents.find("base");if(!$base.length){$base=$iframeContents.find("head").append($("<base />"))}$base.attr("target","_blank");$iframeContents.find("a[target]").removeAttr("target")}function formatHighlightTerms(terms){return _([].concat(terms)).map(function(term){return term.replace(/(\.|\^|\$|\*|\+|\?|\\|\[|\]|\(|\)|\{|\})/g,"\\$1").replace(/ /g,".").replace(/"/g,'("||)').replace(/'/g,"('||)")})}function getDocument($iframe){var $iframeBody=$iframe.contents().find("html body");if(!$iframeBody.length){$iframeBody=$iframe}return $iframeBody}function moveToHighlight($iframe,$highlight){if(!$highlight.length){return}var $iframeBody=getDocument($iframe),top=Math.round(Math.max(0,$highlight.offset().top-$iframe.height()/2)||0);$iframeBody.animate({scrollTop:top})}function _canSearch($iframe){if($iframe.attr("src")[0]!=="/"){return false}try{return!!$iframe.contents()}catch(e){return false}}function highlight(node,regexps,nodeName,className){if(node.nodeType===3){_(regexps).each(function(re){var hl,offset,wordNode,wordClone,match=node.data.match(re);if(!match){return}hl=document.createElement(nodeName||"span");offset=startWordBoundaryRegex.test(match[0])?1:0;hl.className=className||"highlight";wordNode=node.splitText(match.index+offset);wordNode.splitText(match[0].length-offset);wordClone=wordNode.cloneNode(true);hl.appendChild(wordClone);wordNode.parentNode.replaceChild(hl,wordNode)})}else if(node.nodeType===1&&node.childNodes&&!/(script|style)/i.test(node.tagName)&&!(node.tagName===nodeName.toUpperCase()&&node.className===className)){for(var i=0;i<node.childNodes.length;i++){highlight(node.childNodes[i],regexps,nodeName,className)}}return 0}function unhighlight($el,options){var className=options.className||"highlight",element=options.element||"span";return $el.find(element+"."+className).each(function(){var parent=this.parentNode;parent.replaceChild(this.firstChild,this);parent.normalize()}).end()}function highlightTerms($iframe,options){var $iframeBody,terms=options.terms,className=options.className,wordsOnly=options.wordsOnly,moveTo=options.moveToHighlight,scrollTop,$firstTermAfterScrollTop,regexps;if($iframe.attr("src")&&$iframe.attr("src")[0]!=="/"){return false}try{$iframeBody=getDocument($iframe)}catch(e){console.error("Error accessing iframe",$iframe.attr("src"),e.message,e);return false}scrollTop=$iframeBody.scrollTop();className=className||"bw-highlight-term";wordsOnly=wordsOnly!==false;unhighlight($iframeBody,{className:className});appendStylesToIframe($iframe.contents());fixLinksInIframe($iframe.contents());if(!wordsOnly&&terms.length<2&&(terms[0]||"").length<2){return}regexps=_(formatHighlightTerms(terms)).map(function(pattern){if(wordsOnly&&!pattern.match(/[\u4E00-\u9FFF]/)){return new RegExp("("+wordBoundaryRegEx+"|^)"+pattern+"(?="+wordBoundaryRegEx+"|$)","i")}return new RegExp(pattern,"i")});$iframeBody.each(function(){highlight(this,regexps,"span",className)});$firstTermAfterScrollTop=$iframeBody.find("."+className+":visible").filter(function(i,el){return $(el).offset().top>=scrollTop}).first();$firstTermAfterScrollTop.addClass(className+"-current");if(moveTo!==false){moveToHighlight($iframe,$firstTermAfterScrollTop,className)}return true}return Backbone.View.extend({canSearch:function canSearch(){return _canSearch(this.$el)},search:function search(_search){highlightTerms(this.$el,{terms:_search,className:"bw-highlight-search",wordsOnly:false})},nextSearch:function nextSearch(){var $iframe=this.$el,$iframeBody=getDocument($iframe),$allHighlights=$iframeBody.find(".bw-highlight-search:visible"),$currentHighlight=$allHighlights.filter(".bw-highlight-search-current:first"),$nextHighlight=$allHighlights.eq($allHighlights.index($currentHighlight)+1);if(!$nextHighlight.length){$nextHighlight=$allHighlights.eq(0)}$currentHighlight.removeClass("bw-highlight-search-current");$nextHighlight.addClass("bw-highlight-search-current");moveToHighlight($iframe,$nextHighlight,"bw-highlight-search")},previousSearch:function previousSearch(){var $iframe=this.$el,$iframeBody=getDocument($iframe),$allHighlights=$iframeBody.find(".bw-highlight-search:visible"),$currentHighlight=$allHighlights.filter(".bw-highlight-search-current:first"),$previousHighlight=$allHighlights.eq($allHighlights.index($currentHighlight)-1);if(!$previousHighlight.length){$previousHighlight=$allHighlights.last()}$currentHighlight.removeClass("bw-highlight-search-current");$previousHighlight.addClass("bw-highlight-search-current");moveToHighlight($iframe,$previousHighlight,"bw-highlight-search")},highlight:function highlight(terms,moveToHighlight){return highlightTerms(this.$el,{terms:terms,className:"bw-highlight-term",moveToHighlight:moveToHighlight})},nextHighlight:function nextHighlight(){var $iframe=this.$el,$iframeBody=getDocument($iframe),$allHighlights=$iframeBody.find(".bw-highlight-term:visible"),$currentHighlight=$allHighlights.filter(".bw-highlight-term-current:first"),$nextHighlight=$allHighlights.eq($allHighlights.index($currentHighlight)+1);if(!$nextHighlight.length){$nextHighlight=$allHighlights.eq(0)}$currentHighlight.removeClass("bw-highlight-term-current");$nextHighlight.addClass("bw-highlight-term-current");moveToHighlight($iframe,$nextHighlight,"bw-highlight-term")},resetScrollPosition:function resetScrollPosition(){try{var iframe=this.el,hash=iframe.contentWindow.location.hash;iframe.contentWindow.location.hash="";if(hash){iframe.contentWindow.location.hash=hash}}catch(e){}}})});define("src/components/imagewall/components/logolist/logolistHelper",[],function(){"use strict";var stripDuplicateLogos=function stripDuplicateLogos(data){return data.reduce(function(memo,value){if(!memo.some(function(obj){return obj.url===value.url})){memo.push(value)}return memo},[])};return{stripDuplicateLogos:stripDuplicateLogos}});define("mustache!src/components/imagewall/components/logolist/logolist",["lib/mustache"],function(mustache){var escapedTemplate='<div class="b-iw-logolist">\n<div class="customtip b-iw-logolist__wrapper b-iw-logolist__wrapper--{{layout}}" title="{{tooltip}}">\n{{#logos}}\n<img class="b-iw-logolist__image" src="{{url}}" />\n{{/logos}}\n</div>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/components/imagewall/components/logolist/logolist.css",["css!src/components/imagewall/components/logolist/compiled.css"],function(){});define("src/components/imagewall/components/logolist/LogoList",["backbone","src/components/imagewall/components/logolist/logolistHelper","src/helpers/logoVersionHelper","mustache!src/components/imagewall/components/logolist/logolist","css!src/components/imagewall/components/logolist/logolist.css","src/packages/customtip"],function(Backbone,logolistHelper,logoVersionHelper,template){"use strict";function getTemplateData(view,data){return{layout:view.layout,logos:logolistHelper.stripDuplicateLogos(data).map(function(logo){return{url:logoVersionHelper.rewriteUrl(logo.url)}}),tooltip:view.tooltip}}var LAYOUTS={VERTICAL:"vertical",HORIZONTAL:"horizontal"};var LogoList=Backbone.View.extend({constructor:function LogoList(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};Backbone.View.apply(this,arguments);var validLayouts=Object.keys(LAYOUTS).map(function(key){return LAYOUTS[key]});if(options.layout&&!validLayouts.includes(options.layout)){throw new Error("options.layout must contain a value of ".concat(validLayouts))}this.layout=options.layout||LAYOUTS.HORIZONTAL;this.tooltip=options.tooltip||"Logo versions detected in this image."},render:function render(data){this.$el.html(template(getTemplateData(this,data))).customtip({predelay:300});return this}},Object.assign({},LAYOUTS));return LogoList});define("mustache!src/components/mentions/_singlemention/templates/mentionLogoListView",["lib/mustache"],function(mustache){var escapedTemplate='<span class="b-smv-logolist__title">Logo{{#plural}}s{{/plural}} detected:</span>\n<div class="js-logolist b-smv-logolist__container"></div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/components/mentions/_singlemention/css/mentionLogoListView.css",["css!src/components/mentions/_singlemention/css/compiled.css"],function(){});define("src/components/mentions/_singlemention/views/MentionLogoListView",["backbone","src/components/imagewall/components/logolist/LogoList","src/components/imagewall/components/logolist/logolistHelper","mustache!src/components/mentions/_singlemention/templates/mentionLogoListView","css!src/components/mentions/_singlemention/css/mentionLogoListView.css"],function(Backbone,LogoList,logolistHelper,template){"use strict";var CLASS_NAMES={ROOT:"b-smv-logolist"};var VIEW_SELECTORS={LOGOS:".js-logolist"};function renderLogoListView(data){var view=new LogoList;view.render(data);return view}var MentionLogoListView=Backbone.View.extend({className:CLASS_NAMES.ROOT,constructor:function MentionLogoListView(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var facade=options.facade;if(!facade){throw new Error("MentionLogoListView must be initialized with a facade")}this.facade=facade;this.listenTo(this.facade,"change",this.render);Backbone.View.apply(this,arguments)},render:function render(){var data=(this.facade.get("logoImages")||[]).reduce(function(memo,logoImage){return memo.concat(logoImage.logos)},[]).filter(function(item){return!!item});if(!data.length){this.$el.empty();return}this.$el.html(template({plural:logolistHelper.stripDuplicateLogos(data).length>1}));this.logosView=renderLogoListView(data);this.$(VIEW_SELECTORS.LOGOS).html(this.logosView.el);return this},remove:function remove(){if(this.logosView){this.logosView.remove();this.logosView=null}Backbone.View.prototype.remove.apply(this)}});return MentionLogoListView});function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};var ownKeys=Object.keys(source);if(typeof Object.getOwnPropertySymbols==="function"){ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))}ownKeys.forEach(function(key){_defineProperty(target,key,source[key])})}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}define("src/LayoutManager",["backbone","underscore","src/storageProvider"],function(Backbone,_,storageProvider){"use strict";var layoutStorageKey="singleMentionViewLayout";function getDefaultLayout(){return{sidebar:{visible:true,width:200},views:{mentionSnippetView:{visible:true},mentionMetricSummaryView:{visible:true},mentionMetricsView:{visible:true},mentionEmotionsView:{visible:true},mentionCategoriesView:{visible:true},mentionTagsView:{visible:true},mentionWorkflowView:{visible:true}}}}function LayoutManager(storage){this.storageProvider=storage||storageProvider;this.currentLayout=this.getLayout()}_.extend(LayoutManager.prototype,Backbone.Events,{getLayout:function getLayout(){var storedLayout=this.storageProvider.get(layoutStorageKey);var defaultLayout=getDefaultLayout();if(!storedLayout){return defaultLayout}return _objectSpread({},storedLayout,{views:_objectSpread({},defaultLayout.views,storedLayout.views)})},setLayout:function setLayout(newLayout){this.storageProvider.set(layoutStorageKey,newLayout);this.currentLayout=newLayout},isVisible:function isVisible(viewName){return!!this.currentLayout.views[viewName].visible},isSidebarVisible:function isSidebarVisible(){return!!this.currentLayout.sidebar.visible},toggleSubView:function toggleSubView(viewName){return this.currentLayout.views[viewName].visible?this.hideSubView(viewName):this.showSubView(viewName)},showSubView:function showSubView(viewName){var layoutObj=this.currentLayout;layoutObj.views[viewName].visible=true;this.setLayout(layoutObj);this.trigger("showView:"+viewName);this.trigger("showView",viewName)},hideSubView:function hideSubView(viewName){var layoutObj=this.currentLayout;layoutObj.views[viewName].visible=false;this.setLayout(layoutObj);this.trigger("hideView:"+viewName);this.trigger("hideView",viewName)},toggleSidebar:function toggleSidebar(){var layoutObj=this.currentLayout,isVisible=layoutObj.sidebar.visible;layoutObj.sidebar.visible=!isVisible;this.setLayout(layoutObj);return this.trigger(layoutObj.sidebar.visible?"showSidebar":"hideSidebar")},getSidebarWidth:function getSidebarWidth(){return this.currentLayout.sidebar.width},setSidebarWidth:function setSidebarWidth(width){var layoutObj=this.currentLayout;layoutObj.sidebar.width=width;return this.setLayout(layoutObj)}});return LayoutManager});(function(global){var k,_handlers={},_mods={16:false,18:false,17:false,91:false},_scope="all",_MODIFIERS={"":16,shift:16,"":18,alt:18,option:18,"":17,ctrl:17,control:17,"":91,command:91},_MAP={backspace:8,tab:9,clear:12,enter:13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220},code=function(x){return _MAP[x]||x.toUpperCase().charCodeAt(0)},_downKeys=[];for(k=1;k<20;k++)_MAP["f"+k]=111+k;function index(array,item){var i=array.length;while(i--)if(array[i]===item)return i;return-1}function compareArray(a1,a2){if(a1.length!=a2.length)return false;for(var i=0;i<a1.length;i++){if(a1[i]!==a2[i])return false}return true}var modifierMap={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"};function updateModifierKey(event){for(k in _mods)_mods[k]=event[modifierMap[k]]}function dispatch(event){var key,handler,k,i,modifiersMatch,scope;key=event.keyCode;if(index(_downKeys,key)==-1){_downKeys.push(key)}if(key==93||key==224)key=91;if(key in _mods){_mods[key]=true;for(k in _MODIFIERS)if(_MODIFIERS[k]==key)assignKey[k]=true;return}updateModifierKey(event);if(!assignKey.filter.call(this,event))return;if(!(key in _handlers))return;scope=getScope();for(i=0;i<_handlers[key].length;i++){handler=_handlers[key][i];if(handler.scope==scope||handler.scope=="all"){modifiersMatch=handler.mods.length>0;for(k in _mods)if(!_mods[k]&&index(handler.mods,+k)>-1||_mods[k]&&index(handler.mods,+k)==-1)modifiersMatch=false;if(handler.mods.length==0&&!_mods[16]&&!_mods[18]&&!_mods[17]&&!_mods[91]||modifiersMatch){if(handler.method(event,handler)===false){if(event.preventDefault)event.preventDefault();else event.returnValue=false;if(event.stopPropagation)event.stopPropagation();if(event.cancelBubble)event.cancelBubble=true}}}}}function clearModifier(event){var key=event.keyCode,k,i=index(_downKeys,key);if(i>=0){_downKeys.splice(i,1)}if(key==93||key==224)key=91;if(key in _mods){_mods[key]=false;for(k in _MODIFIERS)if(_MODIFIERS[k]==key)assignKey[k]=false}}function resetModifiers(){for(k in _mods)_mods[k]=false;for(k in _MODIFIERS)assignKey[k]=false}function assignKey(key,scope,method){var keys,mods;keys=getKeys(key);if(method===undefined){method=scope;scope="all"}for(var i=0;i<keys.length;i++){mods=[];key=keys[i].split("+");if(key.length>1){mods=getMods(key);key=[key[key.length-1]]}key=key[0];key=code(key);if(!(key in _handlers))_handlers[key]=[];_handlers[key].push({shortcut:keys[i],scope:scope,method:method,key:keys[i],mods:mods})}}function unbindKey(key,scope){var multipleKeys,keys,mods=[],i,j,obj;multipleKeys=getKeys(key);for(j=0;j<multipleKeys.length;j++){keys=multipleKeys[j].split("+");if(keys.length>1){mods=getMods(keys)}key=keys[keys.length-1];key=code(key);if(scope===undefined){scope=getScope()}if(!_handlers[key]){return}for(i=0;i<_handlers[key].length;i++){obj=_handlers[key][i];if(obj.scope===scope&&compareArray(obj.mods,mods)){_handlers[key][i]={}}}}}function isPressed(keyCode){if(typeof keyCode=="string"){keyCode=code(keyCode)}return index(_downKeys,keyCode)!=-1}function getPressedKeyCodes(){return _downKeys.slice(0)}function filter(event){var tagName=(event.target||event.srcElement).tagName;return!(tagName=="INPUT"||tagName=="SELECT"||tagName=="TEXTAREA")}for(k in _MODIFIERS)assignKey[k]=false;function setScope(scope){_scope=scope||"all"}function getScope(){return _scope||"all"}function deleteScope(scope){var key,handlers,i;for(key in _handlers){handlers=_handlers[key];for(i=0;i<handlers.length;){if(handlers[i].scope===scope)handlers.splice(i,1);else i++}}}function getKeys(key){var keys;key=key.replace(/\s/g,"");keys=key.split(",");if(keys[keys.length-1]==""){keys[keys.length-2]+=","}return keys}function getMods(key){var mods=key.slice(0,key.length-1);for(var mi=0;mi<mods.length;mi++)mods[mi]=_MODIFIERS[mods[mi]];return mods}function addEvent(object,event,method){if(object.addEventListener)object.addEventListener(event,method,false);else if(object.attachEvent)object.attachEvent("on"+event,function(){method(window.event)})}addEvent(document,"keydown",function(event){dispatch(event)});addEvent(document,"keyup",clearModifier);addEvent(window,"focus",resetModifiers);var previousKey=global.key;function noConflict(){var k=global.key;global.key=previousKey;return k}global.key=assignKey;global.key.setScope=setScope;global.key.getScope=getScope;global.key.deleteScope=deleteScope;global.key.filter=filter;global.key.isPressed=isPressed;global.key.getPressedKeyCodes=getPressedKeyCodes;global.key.noConflict=noConflict;global.key.unbind=unbindKey;if(typeof module!=="undefined")module.exports=assignKey})(this);define("keymaster",function(){});define("src/helpers/keyboardShortcuts",["backbone","underscore","keymaster"],function(Backbone,_){"use strict";var key=window.key;return{delegateShortcuts:function delegateShortcuts(view,scope){if(!view||!(view instanceof Backbone.View)){throw new Error("delegateShortcuts can only be called on an instance of Backbone.View")}if(!view.keyboardShortcuts){return console.warn("delegateShortcuts called on view with no keyboardShortcuts property")}_(view.keyboardShortcuts).each(function(funcName,shortcutKey){var func=view[funcName],method;if(!_.isFunction(func)){throw new Error("Method "+funcName+" does not exist")}method=_.bind(func,view);key(shortcutKey,scope||"all",method)})},undelegateShortcuts:function undelegateShortcuts(view,scope){if(!scope){return}key.deleteScope(scope)},enable:function enable(scope){key.setScope(scope)},disable:function disable(){key.setScope("disabled")}}});define("src/helpers/twitterLinksToIntents",["jquery"],function($){"use strict";var buttonClasses={REPLY_BUTTON_CLASS:"action-reply-container",RETWEET_BUTTON_CLASS:"action-rt-container",FAVOURITE_BUTTON_CLASS:"action-fav-container",MORE_BUTTON_CLASS:"action-more-container",FOLLOW_BUTTON_CLASS:"follow-button"},INTENT_URL="https://twitter.com/intent/";return{intentify:function intentify($iframe){if(!$iframe){throw new Error("intentify must be passed an iframe")}var $content,$tweets,$actionButtons,tweetIds;if(!($iframe instanceof $)){$iframe=$($iframe)}try{$content=$iframe.contents()}catch(e){throw new Error("please make sure you are passing in a loaded iframe to intentify")}function removeButtons(className){$content.find("."+className).remove()}function insertIntent(className,action,param){var $buttons=$actionButtons.find("."+className);$buttons=$buttons.each(function(index){$(this).find("a").attr("href",INTENT_URL+action+"?"+param+"="+tweetIds[index])});return $buttons}$tweets=$content.find(".tweet");tweetIds=$tweets.map(function(){return $(this).attr("data-tweet-id")});$actionButtons=$content.find(".tweet-actions");insertIntent(buttonClasses.REPLY_BUTTON_CLASS,"tweet","in_reply_to");insertIntent(buttonClasses.RETWEET_BUTTON_CLASS,"retweet","tweet_id");insertIntent(buttonClasses.FAVOURITE_BUTTON_CLASS,"favorite","tweet_id");removeButtons(buttonClasses.FOLLOW_BUTTON_CLASS);removeButtons(buttonClasses.MORE_BUTTON_CLASS)}}});define("mustache!src/components/mentions/_singlemention/templates/singleMentionView",["lib/mustache"],function(mustache){var escapedTemplate='<div lang="{{langCode}}">\n<header class="b-smv__header">\n<h1>\n<a class="b-smv__title-link {{#isOfflinePublication}}b-smv__title-link-disabled{{/isOfflinePublication}}" href="{{url}}" target="_blank">{{title}}</a>\n{{^basicMode}}\n<a class="b-smv__toggle-snippet">Snippet<span class="symbol icon-double-chevron-down"></span></a>\n{{/basicMode}}\n</h1>\n<nav class="b-smv-toolbar">\n<ul class="b-smv-toolbar__nav">\n<li>\n<a class="close icon-remove rounded smallpadding"></a>\n</li>\n{{#canEditMentions}}\n<li>\n<button class="checked-and-next button" title="Mark this mention as \'Checked\' and show the next one"{{^canMoveNext}} disabled{{/canMoveNext}}>Set Checked &amp; Next</button>\n</li>\n{{/canEditMentions}}\n{{^basicMode}}\n<li>\n<button class="next icon-arrow-right button" title="Show next mention"{{^canMoveNext}} disabled{{/canMoveNext}}></button>\n</li>\n<li>\n<button class="previous icon-arrow-left button" title="Show previous mention"{{^canMovePrevious}} disabled{{/canMovePrevious}}></button>\n</li>\n{{/basicMode}}\n</ul>\n<ul class="b-smv-toolbar__interaction">\n{{#canEditMentions}}\n<li class="deleting">\n<a title="Delete mention" class="delete symbol icon-trash"></a>\n</li>\n<li class="spam-reporting">\n<a title="Report mention as spam" class="spam symbol icon-ban-circle"></a>\n</li>\n<li class="noting">\n<a title="Note mention" class="note symbol icon-file"></a>\n</li>\n{{/canEditMentions}}\n{{#canEditMentions}}\n<li class="starring">\n<a title="Star/Unstar mention" class="toggle-star symbol icon-star{{^mentionStarred}}-empty{{/mentionStarred}}"></a>\n</li>\n<li class="keyboard">\n<a class="toggle-keyboard {{#kbShortcutsEnabled}}on{{/kbShortcutsEnabled}}" title="{{#kbShortcutsEnabled}}Deactivate keyboard controls{{/kbShortcutsEnabled}}{{^kbShortcutsEnabled}}Activate keyboard controls{{/kbShortcutsEnabled}}"></a>\n</li>\n{{/canEditMentions}}\n<li class="next-term">\n<a title="Find next matched term on this page (highlighted)" class="icon-circle-arrow-down symbol"></a>\n</li>\n</ul>\n</nav>\n</header>\n<div class="b-smv__main">\n<div class="b-smv__row">\n<div class="temporary-notifications"></div>\n<div class="notifications"></div>\n</div>\n<div class="b-smv__row b-smv__row--snippet{{#basicMode}} b-smv__row--basicmode{{/basicMode}}">\n<div class="b-smv__snippet">\n{{^isOfflinePublication}}\n<a class="b-smv__mention-link" href="{{url}}" target="_blank">{{url}}</a>\n{{/isOfflinePublication}}\n</div>\n{{#basicMode}}\n{{> inpageSearch}}\n{{/basicMode}}\n{{^basicMode}}\n<div class="js-logolist"></div>\n{{/basicMode}}\n</div>\n<div class="b-smv__row b-smv__row--metric-summary"></div>\n<div class="b-smv__row b-smv__row--metrics"></div>\n<div id="mention-content" class="b-smv__content {{mentionContentCssClass}}"></div>\n</div>\n<div class="b-smv__sidebar sidebar">\n{{^basicMode}}\n{{> inpageSearch}}\n{{/basicMode}}\n{{#canEditMentions}}\n<div class="grabber">\n<a class="dragHandle"></a>\n</div>\n{{/canEditMentions}}\n</div>\n<div class="b-smv__kb-diagram rounded hidden">\n<img src="/img/smv-keyboard-shortcuts.png" width="779" height="475" />\n</div>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/components/mentions/_singlemention/templates/singleMentionViewInpageSearch",["lib/mustache"],function(mustache){var escapedTemplate='<div class="b-inpage-search{{#basicMode}} b-inpage-search--basicmode{{/basicMode}}">\n<input type="text" class="b-inpage-search__input filterList iconfield search" placeholder="Find in page {{basicMode}}" disabled />\n<button class="b-inpage-search__prev icon-chevron-left" disabled></button>\n<button class="b-inpage-search__next icon-chevron-right" disabled></button>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/components/mentions/_singlemention/css/singlementionview.css",["css!src/components/mentions/_singlemention/css/compiled.css"],function(){});define("src/components/mentions/_singlemention/views/SingleMentionView",["backbone","underscore","jquery","q","src/helpers/notificationsHelper","src/permissions","src/globals/theme","src/globals/categories","src/globals/flags","src/globals/flagNames","src/globals/queries","src/globals/currentProject","src/globals/currentDashboard","src/globals/workflow","src/ApiError","src/analytics/Analytics","src/components/mentions/_singlemention/models/SingleMentionFacade","src/components/mentions/models/MentionCollection","src/components/notes/views/NotesView","src/components/mentions/views/MentionShareMenu","src/components/mentions/_singlemention/helpers/mentionContentEmbedHelper","src/components/mentions/_singlemention/views/MentionCategoriesView","src/components/mentions/_singlemention/views/MentionMetricSummaryView","src/components/mentions/_singlemention/views/MentionMetricsView","src/components/mentions/_singlemention/views/MentionSnippetView","src/components/mentions/_singlemention/views/MentionSentimentView","src/components/mentions/_singlemention/views/MentionEmotionsView","src/components/mentions/_singlemention/views/MentionTagsView","src/components/mentions/_singlemention/views/MentionWorkflow/MentionWorkflowView","src/components/mentions/_singlemention/views/SearchAndHighlightView","src/components/mentions/_singlemention/views/MentionLogoListView","src/storageProvider","src/LayoutManager","src/helpers/keyboardShortcuts","src/helpers/twitterLinksToIntents","mustache!src/components/mentions/_singlemention/templates/singleMentionView","mustache!src/components/mentions/_singlemention/templates/singleMentionViewInpageSearch","src/events/mentionEvents","src/events/globalEventNames","src/packages/drag","src/packages/spin","lib/jquery.notify","lib/jquery.confirm","css!src/components/mentions/_singlemention/css/singlementionview.css","css!css/font-awesome.css"],function(Backbone,_,$,Q,notificationsHelper,permissions,theme,categories,flags,FLAGS,queries,currentProject,currentDashboard,globalWorkflow,ApiError,Analytics,SingleMentionFacade,MentionCollection,NotesView,MentionShareMenu,mentionContentEmbedHelper,MentionCategoriesView,MentionMetricSummaryView,MentionMetricsView,MentionSnippetView,MentionSentimentView,MentionEmotionsView,MentionTagsView,MentionWorkflowView,SearchAndHighlightView,MentionLogoListView,storageProvider,LayoutManager,keyboardShortcuts,twitterLinksToIntents,singleMentionViewTemplate,singleMentionViewInpageSearchTemplate,mentionEvents,globalEventNames){"use strict";var SIDEBAR_MIN_WIDTH=218;var SIDEBAR_MAX_WIDTH=406;var keyboardShortcutsStorageKey="singleMentionViewKeyboardShortcutsEnabled";function getHash(url){var hashIndex=url.indexOf("#");if(hashIndex===-1){return""}return url.substring(hashIndex+1)}function getHighlightedTerms(view,callback){var queryId;var query;if(view.highlightTerms){return callback(null,view.highlightTerms)}queryId=view.facade.getQueryId();if(!queryId){return callback(null,[])}query=queries.get(queryId);if(!query){return callback(new Error("Could not find query "+queryId))}if(query.get("highlightTerms")){return callback(null,query.get("highlightTerms"))}query.fetch().done(function(){callback(null,query.get("highlightTerms"))}).fail(function(xhr){callback(new ApiError(xhr),[])})}function preventDefault(e){if(e&&e.preventDefault){e.preventDefault()}else if(e){e.returnValue=false}}function onShowOverlay(view,overlayView){if(view.getKeyboardShortcutsPreference()){view.disableKeyboardShortcuts();view.keyboardShortcutsWereDisabled=true}view.listenToOnce(overlayView,"close",_.partial(onOverlayClose,view))}function onOverlayClose(view){if(view.keyboardShortcutsWereDisabled){view.enableKeyboardShortcuts();view.keyboardShortcutsWereDisabled=false}}function toggleSpinner(enableSpinner){enableSpinner=!!enableSpinner;return this.$(".b-smv__content").toggleClass("frame-loading",enableSpinner).spin(enableSpinner&&undefined)}function trackMentionViewed(mentionData){mentionEvents.trigger(globalEventNames.MENTIONS.MENTION_VIEWED,{action:"Mention_viewed",pageType:mentionData.pageType,domain:mentionData.domain,url:mentionData.url})}var SingleMentionView=Backbone.View.extend({className:"b-smv",events:function events(){return{"click .b-smv__toggle-snippet":"onToggleSnippet","click .toggle-keyboard":"onToggleKeyboardShortcuts","click .toggle-star":"onToggleStar","click .share":"onShare","click .note":"onNote","click .spam":"onSpam","click .delete":"onDelete","click .previous":"onPrevious","click .next":"onNext","click .checked-and-next":"onSetCheckedAndNext","mouseover li.keyboard":"onOverKeyboardIcon","mouseout li.keyboard":"onOutKeyboardIcon","keyup .b-inpage-search__input":"onSearchKeyUp","click .b-inpage-search__next":"onSearchNextMatch","click .b-inpage-search__prev":"onSearchPreviousMatch","click .next-term":"onNextTerm","drag .grabber":"onDragSidebar","dragstart .grabber":"onDragSidebarStart","dragend .grabber":"onDragSidebarEnd","click .timeout-rerender":"onClickReRender"}},keyboardShortcutsScope:"singleMentionView",keyboardShortcuts:{s:"onSentimentPositive",d:"onSentimentNeutral",f:"onSentimentNegative",r:"onToggleStar",t:"onTag",o:"onDelete",p:"onSpam",n:"onSetCheckedAndNext",space:"onToggleChecked",right:"onNext",left:"onPrevious",esc:"onEscape"},basicModeKeyboardShortcuts:{esc:"onEscape"},keyboardShortcutsWereDisabled:false,initialize:function initialize(options){var mentions=options&&options.mentions;var mentionId=options&&options.mentionId;if(!mentions||!(mentions instanceof MentionCollection)){throw new Error("SingleMentionView should be instantiated with a MentionCollection")}if(!mentionId){throw new Error("SingleMentionView should be instantiated with a mentionId")}this.facade=new SingleMentionFacade(mentions,mentionId);this.listenTo(this.facade,"change",this.onFacadeChange);this.highlightTerms=options&&options.highlightTerms;this.basicMode=options&&options.basicMode;this.searchAndHighlightView=new SearchAndHighlightView;this.setupSubViews();keyboardShortcuts.delegateShortcuts(this,this.basicMode?this.basicModeKeyboardShortcuts:this.keyboardShortcutsScope);this.keyboardShortcutMonitor()},setupSubViews:function setupSubViews(){var facade=this.facade;var layoutManager=this.layoutManager=new LayoutManager;layoutManager.on("hideView:mentionSnippetView",this.onMentionSnippetViewHidden,this);layoutManager.on("showView:mentionSnippetView",this.onMentionSnippetViewShown,this);this.mentionSentimentView=new MentionSentimentView({facade:facade,layoutManager:layoutManager});this.mentionSentimentView.on("error",this.onSubViewError,this);this.mentionSentimentView.on("delayed",this.onSubViewDelayed,this);if(flags.variation(FLAGS.ENABLE_EMOTIONS)){this.mentionEmotionsView=new MentionEmotionsView({facade:facade,layoutManager:layoutManager});this.mentionEmotionsView.on("error",this.onSubViewError,this);this.mentionEmotionsView.on("delayed",this.onSubViewDelayed,this)}this.mentionCategoriesView=new MentionCategoriesView({facade:facade,layoutManager:layoutManager,categories:categories});this.mentionCategoriesView.on("error",this.onSubViewError,this);this.mentionCategoriesView.on("delayed",this.onSubViewDelayed,this);this.mentionMetricSummaryView=new MentionMetricSummaryView({facade:facade,layoutManager:layoutManager,timezone:currentDashboard.getTimezone()});this.mentionMetricSummaryView.on("error",this.onSubViewError,this);this.mentionMetricsView=new MentionMetricsView({dashboardType:currentDashboard.get("dashboardType"),facade:facade,layoutManager:layoutManager});this.mentionMetricsView.on("error",this.onSubViewError,this);this.mentionSnippetView=new MentionSnippetView({facade:facade,layoutManager:layoutManager});this.mentionSnippetView.on("error",this.onSubViewError,this);this.mentionTagsView=new MentionTagsView({facade:facade,layoutManager:layoutManager});this.mentionTagsView.on("error",this.onSubViewError,this);this.mentionTagsView.on("delayed",this.onSubViewDelayed,this);this.mentionWorkflowView=new MentionWorkflowView({workflow:globalWorkflow,facade:facade,layoutManager:layoutManager});this.mentionWorkflowView.on("error",this.onSubViewError,this);this.mentionWorkflowView.on("delayed",this.onSubViewDelayed,this);this.mentionLogoListView=new MentionLogoListView({facade:facade})},removeSubviews:function removeSubviews(){this.mentionSentimentView.remove();this.mentionSentimentView.off("error",this.onSubViewError,this);this.mentionSentimentView.off("delayed",this.onSubViewDelayed,this);if(flags.variation(FLAGS.ENABLE_EMOTIONS)){this.mentionEmotionsView.remove();this.mentionEmotionsView.off("error",this.onSubViewError,this);this.mentionEmotionsView.off("delayed",this.onSubViewDelayed,this)}this.mentionCategoriesView.remove();this.mentionCategoriesView.off("error",this.onSubViewError,this);this.mentionCategoriesView.off("delayed",this.onSubViewDelayed,this);this.mentionMetricSummaryView.remove();this.mentionMetricSummaryView.off("error",this.onSubViewError,this);this.mentionMetricsView.remove();this.mentionMetricsView.off("error",this.onSubViewError,this);this.mentionSnippetView.remove();this.mentionSnippetView.off("error",this.onSubViewError,this);this.mentionTagsView.remove();this.mentionTagsView.off("error",this.onSubViewError,this);this.mentionTagsView.off("delayed",this.onSubViewDelayed,this);this.mentionWorkflowView.remove();this.mentionWorkflowView.off("error",this.onSubViewError,this);this.mentionWorkflowView.off("delayed",this.onSubViewDelayed,this);if(this.mentionLogoListView){this.mentionLogoListView.remove();this.mentionLogoListView=null}},closeSubViewPopups:function closeSubViewPopups(){if(this.mentionCategoriesView){this.mentionCategoriesView.closeAllPopups()}if(this.mentionWorkflowView){this.mentionWorkflowView.closeAllPopups()}},remove:function remove(){keyboardShortcuts.undelegateShortcuts(this,this.keyboardShortcutsScope);this.removeSubviews();if(this.shareMentionMenu){this.shareMentionMenu.remove()}if(this.notesView){this.notesView.remove()}this.searchAndHighlightView.remove();this.$("iframe").off("load");this.facade.remove();this.facade.off();this.layoutManager.off();clearTimeout(this.mentionContentLoadTimeout);clearTimeout(this.preloadFrameTimeout);clearTimeout(this.keyboardStatusTimeout);Backbone.View.prototype.remove.call(this)},makeMentionUrl:function makeMentionUrl(mention){var hash=getHash(mention.url);var id=mention.resourceId||null;var queryId=mention.queryId||null;var date=mention.date||null;var projectId=currentProject.id;var qString="?url="+encodeURIComponent(mention.url)+"&";if(!this.basicMode){if(id){qString+="id="+id+"&"}if(queryId){qString+="queryId="+queryId+"&"}if(projectId){qString+="projectId="+projectId+"&"}}if(date){qString+="date="+encodeURIComponent(date)+"&"}qString=qString.substr(0,qString.length-1);return"/mentions/"+qString+(hash?"#"+hash:"")},makeMentionContainerFragment:function makeMentionContainerFragment(mention){return{url:mention.url,langCode:mention.language,mentionContentUrl:"about:blank",mentionContentCssClass:mention.sentiment,title:mention.title,mentionStarred:!!mention.starred,kbShortcutsEnabled:this.getKeyboardShortcutsPreference(),canEditMentions:!this.basicMode&&permissions.check("edit.mentions",currentDashboard),basicMode:!!this.basicMode,canMovePrevious:this.facade.canMovePrevious(),canMoveNext:this.facade.canMoveNext(),isOfflinePublication:mention.isOfflinePublication}},renderMentionContent:function renderMentionContent(mentionContent){var $mentionContentEl=this.$("#mention-content");var mentionPageType=this.facade.get("pageType");var mentionDomain=this.facade.get("domain");var mentionUrl=this.facade.get("url");var invalidMentionDomains=["www.youtube.com"];var infoText="Sorry, we're not allowed to display the content of this page.<br />"+'Please visit the <a id="nativeMentionLink" href="'+mentionUrl+'" target="_blank">native page</a>'+" to see the full content.";var self=this;if(invalidMentionDomains.includes(mentionDomain)){$mentionContentEl.append('<div class="b-smv__notification test notifications"></div>');notificationsHelper.showPermanentNotification($mentionContentEl,{text:infoText,type:"notification-info"});clearTimeout(this.mentionContentLoadTimeout);this.hideSpinner();return}trackMentionViewed({pageType:mentionPageType,domain:mentionDomain,url:mentionUrl});$mentionContentEl.empty();this.showMentionContentLoader();if(mentionContent.type==="archive"){$mentionContentEl.append(mentionContent.html);this.$("iframe").on("load",this.onMentionContentLoaded.bind(this));this.$("iframe.preview").attr("src",this.makeMentionUrl(this.facade.getMention()));this.searchAndHighlightView.setElement(this.$("iframe.preview").get(0))}else{$mentionContentEl.addClass("b-smv__content--hidden");$mentionContentEl.append(mentionContent.html);return mentionContentEmbedHelper.formatEmbeddedContentAfterRender(mentionPageType).then(function(){$mentionContentEl.removeClass("b-smv__content--hidden");self.searchAndHighlightView.setElement($mentionContentEl.get(0));self.onMentionContentLoaded()})}},hideSpinner:_.partial(toggleSpinner,false),showSpinner:_.partial(toggleSpinner,true),hideSpinnerAndContent:function hideSpinnerAndContent(){this.hideSpinner().hide()},render:function render(){var layoutManager=this.layoutManager;var mention=this.facade.getMention();var $el=this.$el;var $iframeEl=this.$("iframe");var $mainAreaEl;var $sidebarEl;var sidebarWidth;if(!mention){$.notify("Could not find your mention");this.$("iframe.preview").attr("src","about:blank");return Q.reject()}$iframeEl.off("load");var mentionContainerFragment=singleMentionViewTemplate(this.makeMentionContainerFragment(mention),{inpageSearch:singleMentionViewInpageSearchTemplate({basicMode:this.basicMode})});$el.html(this.renderSubviews($(mentionContainerFragment)));if(this.getKeyboardShortcutsPreference()){keyboardShortcuts.enable(this.keyboardShortcutsScope)}$mainAreaEl=this.$(".b-smv__main");$sidebarEl=this.$(".b-smv__sidebar");sidebarWidth=Math.max(layoutManager.getSidebarWidth(),SIDEBAR_MIN_WIDTH);if(this.basicMode||!permissions.check("edit.mentions",currentDashboard)){$sidebarEl.find(".grabber").remove();sidebarWidth=10}$mainAreaEl.css("right",sidebarWidth+"px");$sidebarEl.width(sidebarWidth);this.$("[title]:not(.noTip)").addClass("customtip").customtip({position:"bottom",delay:0,predelay:0});return mentionContentEmbedHelper.getEmbedContentGivenFacade(this.facade).then(this.renderMentionContent.bind(this))},setupIEIframeResizer:function setupIEIframeResizer(){var toggleSnippet=this.toggleSnippet.bind(this);var resizeHeight=_.bind(function(){var $iframeEl=this.$(".b-smv__row iframe.preview");var $parentEl=$iframeEl.parent();$iframeEl.get(0).style.height="0px";$iframeEl.get(0).style.height=$parentEl.height()+"px"},this);this.toggleSnippet=function(){toggleSnippet();resizeHeight()};this.layoutManager.on("showView:mentionMetricsView",resizeHeight);this.layoutManager.on("hideView:mentionMetricsView",resizeHeight);resizeHeight()},renderSubviews:function renderSubviews($mentionContainerFragment){var $sidebar=$mentionContainerFragment.find(".sidebar");var $snippet=$mentionContainerFragment.find(".b-smv__snippet");var $row2=$mentionContainerFragment.find(".b-smv__row--metric-summary");var $row3=$mentionContainerFragment.find(".b-smv__row--metrics");if(this.mentionLogoListView){var $logolist=$mentionContainerFragment.find(".js-logolist");this.mentionLogoListView.$el.appendTo($logolist);this.mentionLogoListView.render()}if(!this.basicMode&&permissions.check("edit.mentions",currentDashboard)){this.mentionSentimentView.$el.appendTo($sidebar);this.mentionSentimentView.render();if(flags.variation(FLAGS.ENABLE_EMOTIONS)){this.mentionEmotionsView.$el.appendTo($sidebar);this.mentionEmotionsView.render()}this.mentionCategoriesView.$el.appendTo($sidebar);this.mentionCategoriesView.render();this.mentionTagsView.$el.appendTo($sidebar);this.mentionTagsView.render();this.mentionWorkflowView.$el.appendTo($sidebar);this.mentionWorkflowView.render()}else{this.mentionSentimentView.remove();if(flags.variation(FLAGS.ENABLE_EMOTIONS)){this.mentionEmotionsView.$el.appendTo($sidebar);this.mentionEmotionsView.render()}this.mentionCategoriesView.remove();this.mentionTagsView.remove();this.mentionWorkflowView.remove()}if(!this.basicMode){this.mentionSnippetView.$el.prependTo($snippet);this.mentionSnippetView.render();$row2.append(this.mentionMetricSummaryView.$el);this.mentionMetricSummaryView.render();$row3.append(this.mentionMetricsView.$el);this.mentionMetricsView.render()}else{this.mentionSnippetView.remove();this.mentionMetricSummaryView.remove();this.mentionMetricsView.remove()}return $mentionContainerFragment},showMentionContentLoader:function showMentionContentLoader(){var self=this;var $bInpageSearchEl=this.$(".b-inpage-search");this.showSpinner();$bInpageSearchEl.find("input").val("Search is unavailable").prop("disabled",true);$bInpageSearchEl.find("button").prop("disabled",true);clearTimeout(this.mentionContentLoadTimeout);this.mentionContentLoadTimeout=setTimeout(function(){var url=self.facade.getMention().url;var pageType=self.facade.getPageType()||"unknown";Analytics.logMetric("smv:load:timeout",{url:url,pageType:pageType});self.showTimeoutWarning(url)},2e4)},showTimeoutWarning:function showTimeoutWarning(url){var $timeoutEl=this.$(".iframe-timeout");this.hideSpinnerAndContent();$timeoutEl.show().find("a").attr("href",url)},onClickReRender:function onClickReRender(e){e&&e.preventDefault();this.$("iframe.preview").removeAttr("src");this.showMentionContentLoader();this.$(".iframe-timeout").hide();this.$(".iframe-wrapper").show();return this.showMention()},onMentionContentLoaded:function onMentionContentLoaded(e){var self=this;var $searchBoxEl=self.$(".b-inpage-search");var $searchInput=$searchBoxEl.find("input");var canSearch=!this.facade.isChannelMention()&&this.searchAndHighlightView.canSearch();var currentMention=this.facade.getMention();clearTimeout(this.preloadFrameTimeout);if(e&&$(e.target).hasClass("preload")){this.preloadFrameLoaded=true;return}this.previewFrameLoaded=true;clearTimeout(this.mentionContentLoadTimeout);if(!this.facade.isChannelMention()){this.prefetchNextMention()}this.hideSpinner();getHighlightedTerms(this,function(err,terms){var moveToHighlight;if(err){return console.error(err)}if(!terms||!terms.length){return console.warn("No terms found for mention")}moveToHighlight=self.facade.get("url").indexOf("#")===-1;self.searchAndHighlightView.highlight(terms,moveToHighlight);if(!moveToHighlight){self.searchAndHighlightView.resetScrollPosition()}});$searchInput.prop("disabled",!canSearch);$searchBoxEl.find("button").prop("disabled",!canSearch);if(canSearch){$searchInput.val("")}if($("html").hasClass("ie9")||$("html").hasClass("ie10")){this.setupIEIframeResizer()}if(currentMention.pageType==="twitter"){twitterLinksToIntents.intentify(this.$("iframe.preview"))}Analytics.logMetric("smv:load:success",{url:this.facade.getMention().url,pageType:this.facade.getPageType()||"unknown"})},disablePagingButtons:function disablePagingButtons(){this.$(".previous,.next,.checked-and-next").prop("disabled",true)},enablePagingButtons:function enablePagingButtons(){this.$(".previous").prop("disabled",!this.facade.canMovePrevious());this.$(".next").prop("disabled",!this.facade.canMoveNext());this.$(".checked-and-next").prop("disabled",false)},prefetchNextMention:function prefetchNextMention(){var facadeMentions=this.facade._mentions;var nextMention=facadeMentions.at(this.facade.currentMentionIndex()+1);if(!nextMention){return}var nextFacade=new SingleMentionFacade(facadeMentions,nextMention.get("id"));if(nextFacade.isChannelMention()){return}var self=this;var nextMentionJson=nextMention.toJSON();var url=this.makeMentionUrl(nextMentionJson);var $preloadFrame=this.$("iframe.preload");this.preloadFrameLoaded=false;this.preloadFrameTimedOut=false;$preloadFrame.attr("src",url);clearTimeout(this.preloadFrameTimeout);this.preloadFrameTimeout=setTimeout(function(){self.preloadFrameTimedOut=true},2e4)},showMention:function showMention(){var mention=this.facade.getMention();if(this.shareMentionMenu){this.shareMentionMenu.remove();delete this.shareMentionMenu}if(!mention){$.notify("Could not find your mention");return}this.showStarred(mention);this.updateLanguage(mention);this.updateMentionExternalUrl(mention);this.updateMentionTitle(mention);this.enablePagingButtons();this.$(".b-smv__content").removeClass("positive neutral negative").addClass(mention.sentiment).empty();this.$(".temporary-notifications").empty();this.$(".notifications").empty();this.$(".b-smv__header .error").removeClass("error");return mentionContentEmbedHelper.getEmbedContentGivenFacade(this.facade).then(this.renderMentionContent.bind(this))},onSubViewError:function onSubViewError(text){var errorText;var supportText;errorText=text||"Sorry we <strong>couldn't save your changes</strong> (marked in red)";supportText='Please <strong>try again</strong> or <a href="mailto:'+theme.contactEmail+'">contact us</a> '+"if the problem persists.";notificationsHelper.showPermanentNotification(this.$el,{text:errorText+". "+supportText,type:"notification-error"})},onSubViewDelayed:function onSubViewDelayed(){var notificationLastShown=storageProvider.get("202NotificationLastShownInSingleMentionView");var tenMinutes=6e5;var tenSeconds=1e4;if(notificationLastShown==null||Date.now()-notificationLastShown>=tenMinutes){storageProvider.set("202NotificationLastShownInSingleMentionView",Date.now());$.notify({text:"Sorry, edits to mentions are taking longer than usual. The changes you've requested will be processed, but might take a while to appear everywhere.",duration:tenSeconds,className:"notification-warning-narrow"})}},onFacadeChange:function onFacadeChange(){this.showMention()},onToggleSnippet:function onToggleSnippet(){return this.toggleSnippet()},toggleSnippet:function toggleSnippet(){return this.layoutManager.toggleSubView("mentionSnippetView")},onToggleSubView:function onToggleSubView(e){var viewName=$(e.target).data("view");return this.layoutManager.toggleSubView(viewName)},keyboardShortcutMonitor:function keyboardShortcutMonitor(){var self=this;if(this.keyboardStatusTimeout){clearTimeout(this.keyboardStatusTimeout)}this.keyboardStatusTimeout=setTimeout(function(){self.checkKeyboardShortcutStatus();self.keyboardShortcutMonitor()},250)},checkKeyboardShortcutStatus:function checkKeyboardShortcutStatus(){if(!this.getKeyboardShortcutsPreference()){return}if(document.activeElement&&document.activeElement.tagName==="IFRAME"){this.$(".toggle-keyboard").removeClass("on")}else{this.$(".toggle-keyboard").addClass("on")}},onToggleKeyboardShortcuts:function onToggleKeyboardShortcuts(){var shortcutsEnabled=this.getKeyboardShortcutsPreference();this.$(".toggle-keyboard").toggleClass("on",!shortcutsEnabled).data("title",!shortcutsEnabled?"Deactivate keyboard controls":"Activate keyboard controls");return shortcutsEnabled?this.disableKeyboardShortcuts():this.enableKeyboardShortcuts()},enableKeyboardShortcuts:function enableKeyboardShortcuts(){keyboardShortcuts.enable(this.keyboardShortcutsScope);this.setKeyboardShortcutsPreference(true)},disableKeyboardShortcuts:function disableKeyboardShortcuts(){keyboardShortcuts.disable(this.keyboardShortcutsScope);this.setKeyboardShortcutsPreference(false)},getKeyboardShortcutsPreference:function getKeyboardShortcutsPreference(){var pref=storageProvider.get(keyboardShortcutsStorageKey);return _.isBoolean(pref)?pref:true},setKeyboardShortcutsPreference:function setKeyboardShortcutsPreference(enabled){storageProvider.set(keyboardShortcutsStorageKey,!!enabled)},ensureCategoryChangesSaved:function ensureCategoryChangesSaved(){this.mentionCategoriesView.saveChanges()},onOverKeyboardIcon:function onOverKeyboardIcon(){var $keyboard=this.$(".keyboard");this.$(".b-smv__kb-diagram").css({position:"absolute",left:$keyboard.offset().left+$keyboard.width()-this.$(".b-smv__kb-diagram").width()+460,top:$keyboard.offset().top+$keyboard.height()}).removeClass("hidden")},onOutKeyboardIcon:function onOutKeyboardIcon(){this.$(".b-smv__kb-diagram").addClass("hidden")},onToggleStar:function onToggleStar(){var self=this;var facade=this.facade;var mention=facade.getMention();var currentlyStarred=mention.starred;facade.save({starred:!currentlyStarred},{patch:true,error:function error(model,xhr){if(xhr.status===202){self.onSubViewDelayed()}else{self.onSubViewError();self.$("li.starring a").addClass("error")}}})},onTag:function onTag(e){preventDefault(e);this.mentionTagsView.setFocus()},onShare:function onShare(e){if(this.shareMentionMenu){this.shareMentionMenu.remove()}this.shareMentionMenu=MentionShareMenu.show({target:$(e.target),mention:this.facade.getMentionModel()});this.shareMentionMenu.$el.css("zIndex",100010)},onNote:function onNote(){if(this.notesView){this.notesView.remove()}this.notesView=NotesView.show(this.facade.getMentionModel());onShowOverlay(this,this.notesView)},onSpam:function onSpam(){var self=this;var facade=this.facade;$.confirm("Are you sure you want to report this mention as spam?",function(result){if(!result){return}self.showMentionContentLoader();facade.destroy({data:{isSpam:true},error:function error(){self.onSubViewError();self.$("li.spam-reporting a").addClass("error")}})})},onDelete:function onDelete(){var self=this;var facade=this.facade;$.confirm("Are you sure you want to delete this mention?",function(result){if(!result){return}self.showMentionContentLoader();facade.destroy({success:function success(){if(facade._mentions.size()<=0){self.remove()}},error:function error(){self.onSubViewError();self.$("li.deleting a").addClass("error")}})})},onPrevious:function onPrevious(e){var self=this;return Q.Promise(function(resolve,reject){var enablePagingButtons=self.enablePagingButtons.bind(self);preventDefault(e);self.ensureCategoryChangesSaved();self.disablePagingButtons();self.showMentionContentLoader();self.facade.previousMention(function(err){enablePagingButtons();if(err){$.notify(err.message);self.onMentionContentLoaded();console.error(err);return reject(err)}});return resolve()})},onNext:function onNext(e){var self=this;return Q.Promise(function(resolve,reject){var enablePagingButtons=self.enablePagingButtons.bind(self);preventDefault(e);self.ensureCategoryChangesSaved();self.disablePagingButtons();self.showMentionContentLoader();self.facade.nextMention(function(err){enablePagingButtons();if(err){self.onMentionContentLoaded();$.notify(err.message);console.error(err);return reject(err)}return resolve()})})},onSentimentPositive:function onSentimentPositive(){this.mentionSentimentView.changeSentiment("positive")},onSentimentNeutral:function onSentimentNeutral(){this.mentionSentimentView.changeSentiment("neutral")},onSentimentNegative:function onSentimentNegative(){this.mentionSentimentView.changeSentiment("negative")},onToggleChecked:function onToggleChecked(){var checkIt=!this.facade.get("checked");this.mentionSentimentView.toggleChecked(checkIt)},onSetCheckedAndNext:function onSetCheckedAndNext(){var self=this;return Q.Promise(function(resolve,reject){var facade=self.facade;var enablePagingButtons=self.enablePagingButtons.bind(self);self.ensureCategoryChangesSaved();self.disablePagingButtons();self.showMentionContentLoader();self.mentionSentimentView.setCheckedBox(true);facade.save({checked:true},{patch:true,silent:true,success:function success(){facade.nextMention(function(err){enablePagingButtons();if(err){$.notify({text:err.message,className:"notification-error"});self.onMentionContentLoaded();console.error(err)}return resolve()})},error:function error(model,xhr){if(xhr.status===202){self.onSubViewDelayed();return resolve()}else{var err=new ApiError(xhr);self.mentionSentimentView.render();$.notify({text:err.message,className:"notification-error"});self.onMentionContentLoaded();console.error(err);return reject()}}})})},onSearchKeyUp:function onSearchKeyUp(e){var search=$(e.target).val();if(search.length===1){return}if(e.which===27){$(e.target).blur()}if(e.which===13){if(e.shiftKey){return this.onSearchPreviousMatch()}else{return this.onSearchNextMatch()}}this.searchAndHighlightView.search(search)},onSearchNextMatch:function onSearchNextMatch(){this.searchAndHighlightView.nextSearch()},onSearchPreviousMatch:function onSearchPreviousMatch(){this.searchAndHighlightView.previousSearch()},onNextTerm:function onNextTerm(){this.searchAndHighlightView.nextHighlight()},onEscape:function onEscape(e){e.stopPropagation();e.preventDefault();this.closeSubViewPopups()},showStarred:function showStarred(mention){var showStar=mention.starred;this.$(".toggle-star").toggleClass("icon-star",showStar).toggleClass("icon-star-empty",!showStar)},onDragSidebarStart:function onDragSidebarStart(ev,dd){var col1=this.$(".b-smv__main");var col2=this.$(".b-smv__sidebar");_.extend(dd,{col1_element:col1,col2_element:col2,col2_initWidth:col2.width()});this.$("iframe.preview").hide()},onDragSidebar:function onDragSidebar(ev,dd){var offset=dd.col2_initWidth-dd.deltaX;if(offset<=SIDEBAR_MIN_WIDTH){offset=SIDEBAR_MIN_WIDTH}if(offset>=SIDEBAR_MAX_WIDTH){offset=SIDEBAR_MAX_WIDTH}dd.col1_element.css("right",offset);dd.col2_element.width(offset)},onDragSidebarEnd:function onDragSidebarEnd(){this.$("iframe.preview").show();return this.layoutManager.setSidebarWidth($(".sidebar").width())},onMentionSnippetViewHidden:function onMentionSnippetViewHidden(){this.$(".b-smv__toggle-snippet").html('Snippet<span class="icon-double-chevron-down"/>')},onMentionSnippetViewShown:function onMentionSnippetViewShown(){this.$(".b-smv__toggle-snippet").html('Snippet<span class="icon-double-chevron-up"/>')},updateLanguage:function updateLanguage(mention){this.$("div[lang]").attr("lang",mention.language)},updateMentionExternalUrl:function updateMentionExternalUrl(mention){if(mention.isOfflinePublication){this.$(".b-smv__mention-link").attr("href",mention.url).text("")}else{this.$(".b-smv__mention-link").attr("href",mention.url).text(mention.url)}},updateMentionTitle:function updateMentionTitle(mention){this.$(".b-smv__title-link").toggleClass("b-smv__title-link-disabled",mention.isOfflinePublication).attr("href",mention.url).text(mention.title)}},{show:function show(options){var mentions=options.mentions;var mentionId=options.mentionId;var view=new SingleMentionView({mentions:mentions,mentionId:mentionId,basicMode:options.basicMode,highlightTerms:options.highlightTerms});var remove=view.remove;var isIE=$("html").hasClass("ie");view.render();view.$el.showModal({mask:isIE?{loadSpeed:0,closeSpeed:0}:undefined,onClose:function onClose(){view.remove();if(options.onClose){options.onClose()}}});view.$el.parent().css({left:20,right:20,top:20,bottom:20}).children("a.close").hide();view.remove=function(){view.$el.removeModal();view.remove=remove;view.remove()};view.showMentionContentLoader();return view},showBasic:function showBasic(options){options.mentions=new MentionCollection([_.extend({id:-1},options.mention.toJSON())]);options.mentions.settings=new Backbone.Model;if(options.highlightTerms){options.highlightTerms=[].concat(options.highlightTerms)}options.mentionId=options.mention.id||-1;options.basicMode=true;return this.show(options)}});return SingleMentionView});define("mustache!src/components/mentions/_mentionsprofile/templates/domain",["lib/mustache"],function(mustache){var escapedTemplate='<h1 class="popuptitletext singlemargin-bottom">Domain Information</h1>\n<section>\n<header class="doublemargin-bottom singlepadding">\n<div class="hgroup">\n<h1 class="subtitletext" title="{{title}}">{{title}}</h1>\n<h2><a class="mentionUrl" target="_blank" title="{{url}} (new window)" href="{{url}}">{{formattedUrl}}</a></h2>\n</div>\n</header>\n<div class="profileData absbottom overflow-vertical pagemargin-bottom">\n<h2 class="subtitletext smallmargin-bottom">Popularity</h2>\n<div class="popularity pagemargin-bottom"/>\n</div>\n</section>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/components/mentions/_mentionsprofile/views/DomainProfileView",["backbone","jquery","src/components/mentions/_mentionsprofile/views/PopularityView","mustache!src/components/mentions/_mentionsprofile/templates/domain","css!src/components/mentions/_mentionsprofile/css/mentionsprofile.css"],function(Backbone,$,PopularityView,domainTemplate){"use strict";var DomainProfileView=Backbone.View.extend({className:"domainProfileView profileView",initialize:function initialize(options){options=options||{};var mentionUrl=this.mentionUrl=options.mentionUrl,mentionTitle=this.mentionTitle=options.mentionTitle;if(!mentionUrl){throw new Error("DomainProfileView must be instantiated with options.mentionUrl")}if(!mentionTitle){throw new Error("DomainProfileView must be instantiated with options.mentionTitle")}},render:function render(){var url=this.mentionUrl,html=domainTemplate({title:this.mentionTitle,url:url,formattedUrl:url.length>80?$("<a>",{href:url})[0].hostname+"...":url});$(this.el).html(html);this.popularityView=new PopularityView({el:this.$(".popularity"),mentionUrl:url});this.popularityView.render()}},{show:function show(mentionUrl,mentionTitle){var view=new DomainProfileView({mentionUrl:mentionUrl,mentionTitle:mentionTitle});$(view.el).showModal({draggable:".domainProfileView > h1",className:"popup standardpopup",fitToWindow:true,maxWidth:564,maxHeight:720});view.render();return view}});return DomainProfileView});define("src/components/mentions/helpers/offlinePublicationHelper",[],function(){"use strict";var lexisNexisUrl="http://www.lexisnexis.co.uk";var lexisNexisDomain="lexisnexislicensed.hostedmedia.net";return{getOnlineUrl:function getOnlineUrl(offlineDomain){if(offlineDomain===lexisNexisDomain){return lexisNexisUrl}return""}}});(function(root,factory){"use strict";if(typeof define==="function"&&define.amd){define("lib/tabler/tabler.pager",["jquery","underscore"],function($,_){return factory($,_)})}else{root.tabler.pager=factory(root.jQuery,root._)}})(this,function($,_){"use strict";function Pager(options){_.extend(this,options||{});this.pageSize=this.pageSize||20;this.currentPage=this.currentPage||0;this.hideWhenOnePage=this.hideWhenOnePage||false}Pager.pluginName="pager";function defaultPager(data,options,callback){var start=options.currentPage*options.pageSize,end=(options.currentPage+1)*options.pageSize;data.items=_(data.items).clone().slice(start,end);callback(data)}_.extend(Pager.prototype,{render:function(data,spec){data=data||{items:[]};data.currentPage=this.currentPage||0;data.pageSize=this.pageSize;data.totalResults=data.totalResults||this.totalResults||0;return this.renderPager({pager:this},data,spec)},renderPager:function(table,data,spec){var pageSize=this.pageSize,currentPage=this.currentPage,totalResults=data.totalResults||data.items.length,totalPages=this.totalPages=Math.ceil(totalResults/pageSize),startAt=Math.max(currentPage-2,0),endAt=Math.min(totalPages,startAt+6),onLastPage=currentPage===totalPages-1,pagerSpec=[],cssClass=this.cssClass?"pager "+this.cssClass:"pager",pagerHtml=(spec?[table.renderFootTr(),'<td colspan="'+spec.length+'">']:[]).concat(['<ol class="'+cssClass+'">']);if(this.hideWhenOnePage&&totalPages<2){return""}if(onLastPage){startAt=Math.max(0,endAt-6)}if(totalPages>5&&!onLastPage&&endAt>=totalPages-1){startAt=Math.max(startAt-1,0);endAt--}if(currentPage>0){pagerSpec.push({pageIndex:currentPage-1,className:"prev",text:"Previous"});if(currentPage>2){if(startAt===0){startAt++}pagerSpec.push({pageIndex:0,className:"first"+(startAt>1?" skipped":""),text:1})}}for(var i=startAt;i<endAt;i++){pagerSpec.push({pageIndex:i,className:(i===currentPage?"current":"")+(i===0?" first":"")+(i===totalPages-1?" last":""),text:i+1})}if(totalPages>5&&!onLastPage){pagerSpec.push({pageIndex:totalPages-1,className:"last"+(endAt<totalPages-1?" skipped":""),text:totalPages})}if(currentPage<totalPages-1){pagerSpec.push({pageIndex:currentPage+1,className:"next",text:"Next"})}_(pagerSpec).each(function(p){pagerHtml.push('<li data-page="'+p.pageIndex+'" class="'+p.className+'"><a href>'+p.text+"</a></li>")});return _.flatten(pagerHtml.concat(["</ol>",spec?["</td>","</tr>"]:[]])).join("\n")},updatePaging:function(pageOptions){if(_.isNumber(pageOptions.currentPage)){this.currentPage=pageOptions.currentPage}if(_.isNumber(pageOptions.pageSize)){this.pageSize=pageOptions.pageSize}this.table.render();if(this.table.trigger){this.table.trigger("paged",{currentPage:this.currentPage,pageSize:this.pageSize})}},attach:function(table){var self=this,renderFoot=this.originalRenderFoot=table.renderFoot,doFetch=table._doFetch;this.table=table;table._doFetch=function(options,callback){var table=this;doFetch.call(table,options,function(data){defaultPager(data,options,function(data){callback(data)})})};var getFetchOptions=table.getFetchOptions;table.getFetchOptions=function(){return _.extend(getFetchOptions.call(this),{currentPage:self.currentPage,pageSize:self.pageSize})};if(!table.render){table.render=function(){this.fetch({currentPage:self.currentPage,pageSize:self.pageSize},function(data){self.render(data)})}}if(table.renderFoot){table.renderFoot=function(data,spec){var html=renderFoot.call(this)||"";return html+self.renderPager(this,data,spec)}}table.$el.on("click","ol.pager li",function(e){e.preventDefault();var page=$(e.target).closest("li").data("page");self.updatePaging({currentPage:page})})},detach:function(table){table.renderFoot=this.originalRenderFoot;this.originalRenderFoot=undefined;table.render=this.originalRender;this.originalRender=undefined;table.$el.off("click","ol.pager li")}});return Pager});(function(root,factory){"use strict";if(typeof define==="function"&&define.amd){define("lib/tabler/tabler.jumpToPage",["jquery","underscore"],function($,_){return factory($,_)})}else{root.tabler.jumpToPage=factory(root.jQuery,root._)}})(this,function($,_){"use strict";function JumpToPage(options){_.extend(this,options||{})}JumpToPage.pluginName="jumpToPage";_.extend(JumpToPage.prototype,{render:function(){var id=_.uniqueId("tabler-jumpToPage"),html=["<p class=jumpToPage>",'<label for="'+id+'">Jump to page</label>','<input id="'+id+'" type="text" />'];html=html.concat(["</select>","<button>Go</button></p>"]);return html.join("\n")},attach:function(table){var self=this;if(!table.pager){throw new Error("jumpToPage plugin cannot be used without the pager plugin")}this.pager=table.pager;var renderPager=this.originalRenderPager=this.pager.renderPager;table.pager.renderPager=function(table,data,spec){var pager=renderPager.apply(this,arguments),html=self.render();if(spec){html=pager.replace("</td>",html+"</td>")}else{html=pager+html}return html};function updatePageIndex(){var $input=table.$("p.jumpToPage input"),val=$input.val();if(!val){return}val=parseInt(val,10);if(_.isNaN(val)||val<1){$input.addClass("invalid");return}$input.removeClass("invalid");val=Math.min(val,table.pager.totalPages)-1;self.pager.updatePaging({currentPage:val})}table.$el.on("click","p.jumpToPage button",function(){updatePageIndex()});table.$el.on("keydown","p.jumpToPage input",function(e){if(e.which===13){e.preventDefault();updatePageIndex()}})},detach:function(table){table.$el.off("click","p.jumpToPage button");table.$el.off("keydown","p.jumpToPage input");this.pager.renderPager=this.originalRenderPager;this.pager=undefined}});return JumpToPage});(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==="object"&&typeof module==="object")module.exports=factory();else if(typeof define==="function"&&define.amd)define("bw-fe-helpers/faviconHelper",[],factory);else{var a=factory();for(var i in a)(typeof exports==="object"?exports:root)[i]=a[i]}})(this,function(){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=24)}({24:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_exports__["default"]={getFaviconUrl:function getFaviconUrl(url){if(!url){return""}var urlBits=url.split("//"),domain;domain=(urlBits[1]||urlBits[0]).split("/")[0].split("?")[0];return"//www.google.com/s2/favicons?domain="+domain}}}})["default"]});define("src/querybuilder/queryNoResultMessageHelper",["moment"],function(moment){"use strict";var DEFAULT_TIMEZONE="UTC";function diffDayString(startDate,endDate,timezone){timezone=timezone||DEFAULT_TIMEZONE;if(!startDate){throw new Error("diffDayString requires a startDate argument")}if(!endDate){throw new Error("diffDayString requires an endDate argument")}var startMoment=moment.utc(startDate),endMoment=moment.utc(endDate),diffDays=endMoment.diff(startMoment,"days");if(diffDays>1){return"the last <b>"+diffDays+"</b> days"}return"<b>"+startMoment.tz(timezone).format("MMM DD")+"</b>"}function noResultMessage(message,startDate,endDate){if(!message){throw new Error("noResultMessage requires a message argument")}var dayString=diffDayString(startDate,endDate);return message+" "+dayString+"."}return{noResultMessage:noResultMessage,diffDayString:diffDayString}});define("mustache!src/components/mentions/_testsearch/templates/searchResults",["lib/mustache"],function(mustache){var escapedTemplate='{{#hasResults}}\n<header class="results-header fullwidth">\n<h1>\n<b>{{firstMentionIndex}}-{{lastMentionIndex}}</b> of about <b>{{total}}</b> unprocessed Mentions {{#showDateRange}}for {{{diffDayString}}}{{/showDateRange}}\n<a class="help icon-bwhelp queryTypeHelp singlemargi-left" data-key="test-search-unprocessed-mentions"></a>\n</h1>\n{{#queryValidationResult}}\n<div class="messages {{cssClass}}">\n{{#messages}}\n<p>{{.}}</p>\n{{/messages}}\n</div>\n{{/queryValidationResult}}\n</header>\n<ol class="results">\n{{#results}}\n{{^twitterMention}}\n<li class="{{languageClass}} highlightrow">\n<article data-url="{{url}}" data-title="{{title}}">\n<div class="mention mention--other">\n<header class="mention__header">\n<span class="mention__header-left">\n<a class="mention__logo smallmargin-right" data-id="{{id}}" data-authorid="{{author_id}}" title="Show Domain Info">\n{{#imageUrl}}\n<img class="mention__favicon" src="{{imageUrl}}">\n{{/imageUrl}}\n</a>\n<a href="{{url}}" target="_blank" class="title-text readMention customtip" title="Read this mention">{{title}}</a>\n</span>\n{{#isOfflinePublication}}\n<a class="mention__date" href="#" target="_blank"><span class="icon-external-link tinymargin-right"></span>{{formattedMentionDate}}</a>\n{{/isOfflinePublication}}\n{{^isOfflinePublication}}\n<span class="mention-date-link">\n<a class="mention__date" href="{{url}}" target="_blank">{{formattedMentionDate}}</a>\n</span>\n{{/isOfflinePublication}}\n</header>\n<p class="summary">\n{{#snippet}}\n<span class="text">{{{snippet}}}</span>\n{{/snippet}}\n</p>\n\n<footer>\n{{^isOfflinePublication}}\n<p class="domain">{{domain}} {{#showAddToSiteGroup}}<a class="addToSiteGroup customtip" data-domain="{{domain}}" title="Add to Site List">add to Site List</a>{{/showAddToSiteGroup}}</p>\n{{/isOfflinePublication}}\n<p class="type">({{typeName}})</p>\n</footer>\n</div>\n</article>\n</li>\n{{/twitterMention}}\n{{#twitterMention}}\n<li class="{{languageClass}} highlightrow">\n<article data-url="{{url}}" class="twitter-article">\n{{{twitterMention}}}\n</article>\n</li>\n{{/twitterMention}}\n{{/results}}\n</ol>\n{{/hasResults}}\n{{^hasResults}}\n{{^isOnPageZero}}\n<header class="results-header fullwidth">\n<h1>\nShowing about <b>{{total}}</b> unprocessed Mentions {{#showDateRange}}for {{{diffDayString}}}{{/showDateRange}}\n<a class="help icon-bwhelp queryTypeHelp singlemargi-left" data-key="test-search-unprocessed-mentions"></a>\n</h1>\n</header>\n<div class="empty-page">\n<span class="lightgrey biggertext">Sorry, there\'s no more results. <br /> Please go back to the previous page.</span>\n</div>\n{{/isOnPageZero}}\n{{/hasResults}}\n{{#hasMoreThanOnePage}}\n<footer class="pager-container clearfix">\n{{{pager}}}\n</footer>\n{{/hasMoreThanOnePage}}\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/components/mentions/templates/twitterMention",["lib/mustache"],function(mustache){var escapedTemplate='<div class="{{prefix}} {{prefix}}--twitter" data-id="{{id}}">\n<a class="twitterAuthor" data-screen-name="{{author}}">\n<img class="twitterAvatar smallmargin-right" title="Show Twitter Profile for @{{author}}" src="{{avatarUrl}}">\n<span class="logo icon-bwtwitter"></span>\n<strong class="twitterFullName darkgrey">{{twitterFullName}}</strong>\n<span class="twitterUsername">@{{author}}</span>\n</a>\n\n{{#twitterVerified}}\n<span class="twitter-verified icon-ok-sign"></span>\n{{/twitterVerified}}\n\n<a class="{{prefix}}__date" href="{{url}}" target="_blank"><span class="externallink icon-external-link tinymargin-right"></span>{{formattedTimestamp}}</a>\n\n<span class="twitterSummary">{{{summary}}}</span>\n\n{{#isLogoMention}}\n<div class="js-passepartout smallmargin-vertical"></div>\n{{/isLogoMention}}\n{{^isLogoMention}}\n{{#mediaImage}}\n{{{mediaImage}}}\n{{/mediaImage}}\n{{/isLogoMention}}\n\n{{^hideStats}}\n<div class="tweetStats smallmargin-right">\n<span class="retweets" data-val="{{retweets}}">Retweets: {{retweets}}</span>\n<span class="replies tinymargin-left" data-val="{{replies}}">Replies: {{replies}}</span>\n<span class="impressions tinymargin-left" data-val="{{impressions}}">Impressions: {{impressions}}</span>\n</div>\n{{/hideStats}}\n\n{{#intents}}\n{{{intents}}}\n{{/intents}}\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/querybuilder/templates/previewTabNoResults",["lib/mustache"],function(mustache){var escapedTemplate='{{#errorMessage}}\n<div class="notification notification-error singlepadding-horizontal smallpadding-vertical rounded">\n<span>{{{errorMessage}}}</span>\n<a class="action js-reload">Please try again</a>\n</div>\n{{/errorMessage}}\n{{^errorMessage}}\n<div>\n<span class="lightgrey biggertext">{{{noResultMessage}}}</span>\n</div>\n{{/errorMessage}}\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/components/mentions/_testsearch/css/testSearchResultsView.css",["css!src/components/mentions/_testsearch/css/compiled.css"],function(){});define("css!src/components/mentions/css/snippets.css",["css!src/components/mentions/css/compiled.css"],function(){});define("css!src/components/mentions/css/mentions.css",["css!src/components/mentions/css/compiled.css"],function(){});define("src/components/mentions/_testsearch/views/TestSearchResultsView",["backbone","underscore","jquery","moment","src/permissions","src/globals/me","src/globals/currentDashboard","src/views/AuthorContextMenu","src/components/mentions/views/AddToSiteGroupView","src/components/mentions/_singlemention/views/SingleMentionView","src/components/mentions/_mentionsprofile/views/DomainProfileView","src/components/mentions/_mentionsprofile/views/TwitterProfileView","src/components/mentions/helpers/offlinePublicationHelper","src/helpers/mentionSnippetParser","src/helpers/twitterHelper","lib/tabler/tabler.pager","lib/tabler/tabler.jumpToPage","bw-fe-helpers/dateHelper","bw-fe-helpers/faviconHelper","src/querybuilder/queryNoResultMessageHelper","mustache!src/components/mentions/_testsearch/templates/searchResults","mustache!src/components/mentions/templates/twitterMention","mustache!src/querybuilder/templates/previewTabNoResults","src/packages/modalDialogs","css!src/components/mentions/_testsearch/css/testSearchResultsView.css","css!src/components/mentions/css/snippets.css","css!src/components/mentions/css/mentions.css"],function(Backbone,_,$,moment,permissions,me,currentDashboard,AuthorContextMenu,AddToSiteGroupView,SingleMentionView,DomainProfileView,TwitterProfileView,offlinePublicationHelper,mentionSnippetParser,twitterHelper,Pager,JumpToPage,dateHelper,faviconHelper,queryNoResultMessageHelper,searchResultsTemplate,twitterMention,renderNoResultsTemplate){"use strict";var NO_RESULT="No Mentions found for";function getPagerData(view){var pagingInfo=view.collection.pagingInfo();return{currentPage:pagingInfo.page,totalResults:view.collection.getLimitedTotalResults(),pageSize:view.collection.pageSize}}function cleanupPager(view){if(view.tablerProxy){view.stopListening(view.tablerProxy);delete view.tablerProxy}delete view.pager;delete view.jumpToPage}function initializePager(view){cleanupPager(view);view.pager=new Pager(getPagerData(view));view.jumpToPage=new JumpToPage;view.tablerProxy=_.extend({$el:view.$el,$:function $(selector){return view.$el.find(selector)},render:function render(){},pager:view.pager},Backbone.Events);view.pager.attach(view.tablerProxy);view.jumpToPage.attach(view.tablerProxy);view.listenTo(view.tablerProxy,"paged",function(pageOptions){view.showPage(pageOptions.currentPage)})}function renderNoResults(view){var noResultMessage=queryNoResultMessageHelper.noResultMessage(NO_RESULT,view.collection.startDate,view.collection.endDate);view.$el.html(renderNoResultsTemplate({noResultMessage:noResultMessage}));view.$el.addClass("noResults")}return Backbone.View.extend({tagName:"section",className:"searchResults snippets mentionSnippets singlepadding-top",events:{"click .results article":"onClickResult","click .twitterAuthor":"onClickTwitterUsername","click .twitterAvatar":"onClickTwitterAvatar","click .mention__logo":"onViewProfile","click a.addToSiteGroup":"onAddToSiteGroup","click .js-reload":"onClickReload"},initialize:function initialize(options){this.showDateRange=_.isUndefined(options.showDateRange)?true:options.showDateRange;this.listenTo(this.collection,"request",this.onRequest,this);this.listenTo(this.collection,"sync",this.onRender,this);this.listenTo(this.collection,"clear",this.onRender,this);this.listenTo(this.collection,"error",this.onShowError,this);this.dataRequested=false},remove:function remove(){if(this.warningView){this.warningView.remove()}cleanupPager(this);Backbone.View.prototype.remove.call(this)},onClickResult:function onClickResult(e){var url=$(e.currentTarget).data("url"),mention=this.collection.get(url);if(this.contextMenu&&this.contextMenu.isShown()){return}if($(e.target).closest(".mention-date-link, .twitterIntents").length){return}e.preventDefault();SingleMentionView.showBasic({mention:mention})},onViewProfile:function onViewProfile(e){var $target=$(e.currentTarget),$article=$target.closest("article"),url=$article.data("url"),title=$article.data("title");e.preventDefault();e.stopPropagation();if(this.profileView){this.profileView.remove()}this.profileView=DomainProfileView.show(url,title)},onAddToSiteGroup:function onAddToSiteGroup(e){e.preventDefault();e.stopPropagation();AddToSiteGroupView.show({userId:me.id,domain:$(e.target).data("domain"),target:$(e.target)})},onClickTwitterUsername:function onClickTwitterUsername(e){var $target=$(e.target),$currentTarget=$(e.currentTarget);e.preventDefault();e.stopPropagation();this.contextMenu=AuthorContextMenu.show({settings:new Backbone.Model,$target:$target,author:$currentTarget.data("screen-name"),isTwitterProfile:true,hideMentions:true})},onClickTwitterAvatar:function onClickTwitterAvatar(e){var $target=$(e.currentTarget),author=$target.closest(".twitterAuthor").data("screen-name");e.preventDefault();e.stopPropagation();if(this.contextMenu){this.contextMenu.remove()}if(!author){return}TwitterProfileView.show(author)},onClickReload:function onClickReload(){this.trigger("reload")},showPage:function showPage(idx){this.collection.goToPage(idx)},onRequest:function onRequest(){this.dataRequested=true;this.showLoader()},showLoader:function showLoader(){$(this.el).addClass("isLoading").removeClass("error noResults").html('<div class="loading">Loading</div>')},onShowError:function onShowError(){this.showError()},showError:function showError(){$(this.el).addClass("error").removeClass("isLoading noResults").html(renderNoResultsTemplate({errorMessage:"Sorry, we were unable to fetch results."}))},onRender:function onRender(){if(!this.collection.length&&!this.collection.page){renderNoResults(this);return}this.render()},render:function render(){var view=this,$el=$(this.el),collection=this.collection,diffDays=moment(this.collection.endDate).diff(moment(this.collection.startDate),"days"),diffDayString,pagingInfo,data,showAddToSiteGroup=permissions.check("edit.groups",currentDashboard)?!this.viewOnly:false;if(view.lastTerm!==view.collection.term){view.shownWarning=false;view.lastTerm=view.collection.term}if(diffDays>1){diffDayString="the last <b>"+diffDays+"</b> days"}else{diffDayString="<b>"+moment(this.collection.startDate).format("MMM DD")+"</b>"}pagingInfo=this.collection.pagingInfo();data=_.extend({results:collection.map(function(result){var text=result.get("snippet"),isTwitterResult=result.get("pageType")==="twitter",url;result=result.toJSON();result.formattedMentionDate=moment.utc(result.date).format("DD MMM YYYY");result.snippet=mentionSnippetParser.parse(text,result.matchPositions);url=result.url;if(result.isOfflinePublication){url=offlinePublicationHelper.getOnlineUrl(result.domain)}result.imageUrl=faviconHelper.getFaviconUrl(url);if(isTwitterResult){result.twitterMention=twitterMention({id:result.id,author:result.author,avatarUrl:"/img/twitter-profile-default.png",twitterFullName:result.twitterFullName,url:result.url,formattedTimestamp:dateHelper.formatTimeStamp(result.date,"UTC"),twitterVerified:result.twitterVerified===true,summary:result.snippet,hideStats:true,intents:twitterHelper.getIntentsMarkupFromUrl(result.url),prefix:"mention"},false)}result.typeName=_.isUndefined(result.pageType)?"General":_.capitalize(result.pageType);result.showAddToSiteGroup=showAddToSiteGroup;return result}),hasResults:!!collection.length,isOnPageZero:!this.collection.page,dataRequested:this.dataRequested,showDateRange:this.showDateRange,diffDayString:diffDayString},pagingInfo);if(pagingInfo.hasMoreThanOnePage){initializePager(this);data.pager=function(){return view.pager.render(getPagerData(view))}}$el.removeClass("error isLoading noResults").html(searchResultsTemplate(data)).customtip();if(!data.results.length){$el.addClass("noResults")}view.delegateEvents()}})});define("mustache!templates/queryCreationWarning",["lib/mustache"],function(mustache){var escapedTemplate='{{#likelyToBreachMonthlyMentionsLimit}}\n<h1 class="popuptitletext doublemargin-bottom likelyToBreachMonthlyMentionsLimit">Likely to Hit Usage Limit</h1>\n<article class="{{cssClass}} rounded lightgreybg doublepadding mediumtext-biglinie">\n<p>\nYour Query will create ~{{estimatedMonthlyResults}} additional {{mentionOrMentions}},\ntaking you over your {{monthlyLimit}} limit: you may incur additional charges.\n</p>\n<p class="singlemargin-top">\nWe recommend you either:\n<ul class="singlemargin-top">\n<li>\nGo back and refine your Query further. {{^isQueryBuilder}}Be careful to indicate if your brand is also a common word,\nand only track uniquely named products. {{/isQueryBuilder}}\n</li>\n<li class="singlemargin-top">\nIf you dont need to see all the mentions, use a sample. You will still be able to spot trends.\n</li>\n<li class="singlemargin-top">\nIf you would like to increase your mention allowance, your account contact will be pleased to help.\n</li>\n</ul>\n</p>\n</article>\n{{/likelyToBreachMonthlyMentionsLimit}}\n\n{{#subclientlikelyToBreachMonthlyMentionsLimit}}\n<h1 class="popuptitletext doublemargin-bottom subclientlikelyToBreachMonthlyMentionsLimit">Likely to Hit Usage Limit</h1>\n<article class="{{cssClass}} rounded lightgreybg doublepadding mediumtext-biglinie">\n<p>\nYour Query will create ~{{estimatedMonthlyResults}} additional {{mentionOrMentions}},\ntaking {{subclient}}\'s\' over their {{monthlyLimit}} limit: you may incur additional charges.\n</p>\n<p class="singlemargin-top">\nWe recommend you either:\n<ul class="singlemargin-top">\n<li>\nGo back and refine your Query further. {{^isQueryBuilder}}Be careful to indicate if your brand is also a common word,\nand only track uniquely named products. {{/isQueryBuilder}}\n</li>\n<li class="singlemargin-top">\nIf you dont need to see all the mentions, use a sample. You will still be able to spot trends.\n</li>\n<li class="singlemargin-top">\nIf you would like to increase your mention allowance, your account contact will be pleased to help.\n</li>\n</ul>\n</p>\n</article>\n{{/subclientlikelyToBreachMonthlyMentionsLimit}}\n\n{{#fairUsage}}\n<h1 class="popuptitletext doublemargin-bottom fairUsage">Likely to Hit Daily Allowance</h1>\n<article class="{{cssClass}} rounded lightgreybg doublepadding mediumtext-biglinie">\n<p>\nYour Query will create ~{{estimatedDailyResults}} {{mentionOrMentions}},\ntaking you over your daily fair usage limit of {{dailyAllowance}}: you may incur additional charges.\n</p>\n<p class="singlemargin-top">\nWe recommend you either:\n<ul class="singlemargin-top">\n<li>\nGo back and refine your Query further. {{^isQueryBuilder}}Be careful to indicate if your brand is also a common word,\nand only track uniquely named products. {{/isQueryBuilder}}\n</li>\n<li class="singlemargin-top">\nIf you dont need to see all the mentions, use a sample. You will still be able to spot trends.\n</li>\n<li class="singlemargin-top">\nIf you would like to increase your mention allowance, your account contact will be pleased to help.\n</li>\n</ul>\n</p>\n</article>\n{{/fairUsage}}\n\n{{#overMonthlyMentionsLimit}}\n<h1 class="popuptitletext doublemargin-bottom overMonthlyMentionsLimit">Mentions Allowance Reached</h1>\n<article class="{{cssClass}} rounded lightgreybg doublepadding mediumtext-biglinie">\n<p>Sorry, but you have reached your mention allowance. Please talk to your account contact to increase this.</p>\n</article>\n{{/overMonthlyMentionsLimit}}\n\n{{#subclientOverMonthlyMentionsLimit}}\n<h1 class="popuptitletext doublemargin-bottom subclientOverMonthlyMentionsLimit">Subclients Mentions Allowance  Reached</h1>\n<article class="{{cssClass}} rounded lightgreybg doublepadding mediumtext-biglinie">\n<p>Sorry, but {{subclient}} has reached their mention allowance. Please talk to your account contact to increase this.</p>\n</article>\n{{/subclientOverMonthlyMentionsLimit}}\n\n{{#atSubscriptionCapacity}}\n<h1 class="popuptitletext doublemargin-bottom atSubscriptionCapacity">Subscription Allowance Reached</h1>\n<article class="{{cssClass}} rounded lightgreybg doublepadding mediumtext-biglinie">\n<p>Before you can create a new Query you need to increase your allowance or remove an existing subscription.\nPlease talk to your account contact who will be happy to assist you.</p>\n</article>\n{{/atSubscriptionCapacity}}\n\n{{#nonLegacyQueryBasedWithoutAutoUpgrade}}\n<h1 class="popuptitletext doublemargin-bottom ">Query Limit Reached</h1>\n<article class="{{cssClass}} rounded lightgreybg doublepadding mediumtext-biglinie">\n<p>\nSorry, but you have reached your Query limit for your current pricing structure.\nPlease talk to your account contact if you wish to increase this.\n</p>\n</article>\n{{/nonLegacyQueryBasedWithoutAutoUpgrade}}\n\n{{#atQueryLimit}}\n<h1 class="popuptitletext doublemargin-bottom">Query Limit Reached</h1>\n<article class="{{cssClass}} rounded lightgreybg doublepadding mediumtext-biglinie">\n<p>\nSorry, but you have reached your Query limit for your current pricing structure.\nPlease talk to your account contact if you wish to increase this.\n</p>\n</article>\n{{/atQueryLimit}}\n\n{{#atMentionLimit}}\n<h1 class="popuptitletext doublemargin-bottom">Mentions Limit Reached</h1>\n<article class="{{cssClass}} rounded lightgreybg doublepadding mediumtext-biglinie">\n<p>\nSorry, but you have reached your mention limit for your current pricing structure.\nPlease talk to your account contact if you wish to increase this.\n</p>\n</article>\n{{/atMentionLimit}}\n\n{{#userDoesNotHavePermission}}\n<h1 class="popuptitletext doublemargin-bottom">Warning</h1>\n<article class="{{cssClass}} rounded lightgreybg doublepadding mediumtext-biglinie">\n<p class="bold singlemargin-bottom">\nYou do not have permission to edit this Query.\n</p>\n<p>\nSorry, but you do not have the required permissions to edit this Query.\nPlease talk to your account contact to resolve this.\n</p>\n</article>\n{{/userDoesNotHavePermission}}\n</article>\n<p class="doublemargin-top">\n<button class="cancel button">Close</button>\n</p>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/views/QueryCreationWarningView",["backbone","underscore","jquery","mustache!templates/queryCreationWarning"],function(Backbone,_,$,template){"use strict";function mentionOrMentions(n){return n===1?"mention":"mentions"}var QueryCreationWarningView=Backbone.View.extend({className:"queryCreationWarningView",events:{"click a.close, .cancel":"onClose"},initialize:function initialize(options){options=options||{};if(!options.reason){throw new Error("WarningView Should be initialized with options.reason set")}if(!options.reasonData){throw new Error("WarningView Should be initialized with options.reasonData set")}this.cssClass=options.cssClass||"warning";this.reason=options.reason;this.reasonData=options.reasonData;this.isQueryBuilder=!!options.isQueryBuilder},render:function render(){var reasonData=this.reasonData,data=_.extend({likelyToBreachMonthlyMentionsLimit:this.reason==="likelyToBreachMonthlyMentionsLimit",fairUsage:this.reason==="fairUsage",overMonthlyMentionsLimit:this.reason==="overMonthlyMentionsLimit",atSubscriptionCapacity:this.reason==="atSubscriptionCapacity",subclientlikelyToBreachMonthlyMentionsLimit:this.reason==="subclientLikelyToBreachMonthlyMentionsLimit",subclientOverMonthlyMentionsLimit:this.reason==="subclientOverMonthlyMentionsLimit",atQueryLimit:this.reason==="atQueryLimit",atMentionLimit:this.reason==="atMentionLimit",userDoesNotHavePermission:this.reason==="userDoesNotHavePermission",isQueryBuilder:this.isQueryBuilder},reasonData,{cssClass:this.cssClass});if(reasonData.estimatedMonthlyResults){data.mentionOrMentions=mentionOrMentions(reasonData.estimatedMonthlyResults)}else if(reasonData.estimatedDailyResults){data.mentionOrMentions=mentionOrMentions(reasonData.estimatedDailyResults)}$(this.el).html(template(data))},remove:function remove(){this.trigger("closed");Backbone.View.prototype.remove.call(this)},onClose:function onClose(){this.remove()}},{show:function show(options){var view=new QueryCreationWarningView(options),oldRemove=view.remove;view.render();view.$el.showModal({draggable:"header h1",className:"popup smallpopup",allowMultipleInstances:true,keepCentred:true,onClose:function onClose(){view.remove()}});view.remove=function(){view.$el.removeModal();oldRemove.call(this)};return view},getNotificationMessage:function getNotificationMessage(reason){if(reason==="likelyToBreachMonthlyMentionsLimit"){return"<b>This Query will take you over your usage allowance.</b> Please either refine your Query, "+"use a sample, or talk to your account contact to increase your allowance."}if(reason==="subclientlikelyToBreachMonthlyMentionsLimit"){return"<b>This Query will take your subclient over their usage allowance.</b> Please either refine your Query, "+"use a sample, or talk to your account contact to increase your allowance."}if(reason==="fairUsage"){return"<b>This Query will take you over your daily allowance.</b> Please either refine your Query, "+"use a sample, or talk to your account contact to increase your allowance."}if(reason==="overMonthlyMentionsLimit"){return"You have reached your mentions allowance."}if(reason==="subclientOverMonthlyMentionsLimit"){return"Your subclient has reached their mentions allowance."}if(reason==="atSubscriptionCapacity"){return"You have reached your subscriptions allowance."}if(reason==="nonLegacyQueryBasedWithoutAutoUpgrade"){return"You have reached your Query limit."}if(reason==="atQueryLimit"){return"You have reached your Query limit."}if(reason==="atMentionLimit"){return"You have reached your mention limit."}if(reason==="userDoesNotHavePermission"){return"You do not have permission to edit this Query."}}});return QueryCreationWarningView});define("mustache!templates/queryFormUserError",["lib/mustache"],function(mustache){var escapedTemplate='<div class="queryFormUserError">\n<header>\n<h1 class="popuptitletext singlemargin-bottom">Error Creating Query</h1>\n</header>\n<p>{{message}}</p>\n<div class="doublemargin-top">\n<button class="cancel button">Close</button>\n</div>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/views/QueryFormUserErrorView",["backbone","underscore","jquery","mustache!templates/queryFormUserError","src/packages/modalDialogs"],function(Backbone,_,$,template){"use strict";return Backbone.View.extend({events:{"click .cancel":"onClose"},initialize:function initialize(options){var self=this;_(this).bindAll("onClose");this.bind("closed",function(){$(self.el).removeModal()});options=options||{};if(!options.message){throw new Error("QueryFormUserErrorView Should be initialized with options.message set")}this.message=options.message;this.render()},render:function render(){var data={message:this.message},$el=$(this.el),self=this;$el.html(template(data));$el.showModal({allowMultipleInstances:true,draggable:"h1:first",className:"popup tinypopup",onClose:function onClose(){self.remove()}})},remove:function remove(){this.trigger("closed");Backbone.View.prototype.remove.call(this)},onClose:function onClose(e){e.preventDefault();this.trigger("closed")}})});define("src/querybuilder/previewFetcher",["underscore"],function(_){"use strict";function doRequest(view){if(view._xhr){view._xhr.abort()}view._xhr=view.collection.fetch(_.extend({complete:function complete(){view._xhr=undefined}},view.requestOptions));view.requestOptions=undefined}return{loadData:function loadData(view,options){view.requestOptions=options;if(!view.$el.is(":visible")){return}doRequest(view)},loadView:function loadView(view){if(!view.requestOptions){return}doRequest(view)}}});define("src/querybuilder/queryExamplesHelper",["bw-fe-helpers/windowHelper","src/events/globalEventNames","src/events/queryEvents"],function(windowHelper,globalEventNames,queryEvents){"use strict";var WINDOW_WIDTH=756;var WINDOW_HEIGHT=718;function showQueryExamples(source){var windowOptions="width="+WINDOW_WIDTH+",height="+WINDOW_HEIGHT+",scrollbars=yes,resizable=yes";windowHelper.open("/query-examples","queryExamples",windowOptions);queryEvents.trigger(globalEventNames.QUERIES.QUERY_EXAMPLES_SHOWN,{source:source})}return{showQueryExamples:showQueryExamples}});define("mustache!templates/locationOperators",["lib/mustache"],function(mustache){var escapedTemplate='<div class="content">\n<h1 class="popuptitletext singlemargin-bottom draggable">Look up locations</h1>\n<a class="tinypopup--close close icon-remove lightgrey singlepadding"></a>\n<form>\n<p>For use in your query <a class="help icon-bwhelp locationOperatorsHelp" data-key="query-creation-location-operators"></a></p>\n<div class="example helptextcolor infoboxbgcolor">E.g. For New York: <span class="query">"yellow cab" AND <b>city:new8</b></span></div>\n<label>Look up location</label>\n<input type="text" class="field autocomplete" placeholder="E.g. California">\n<div class="locationIds">\n<table class="hidden">\n<thead>\n<th class="id">Location</th>\n<th class="location">Description</th>\n</thead>\n<tbody>\n</tbody>\n</table>\n</div>\n</form>\n<p class="tips hidden">Use CTRL + C to copy, then click into the main Free Text field above and use CTRL + V to paste</p>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});(function($,_){"use strict";var defaults={url:"",params:{},ajaxParams:{}};function Ajax(options){this.options=_.defaults(options,defaults)}Ajax.prototype.attach=function(autocomplete){var ajax=this;var ajaxOptions=ajax.options;autocomplete.fetch=function(){var self=this;var params=ajaxOptions.params;if(_.isFunction(params)){params=params.call(this)}params[ajaxOptions.prefixParam||"prefix"]=self.prefix;$.ajax(_.extend({},ajaxOptions.ajaxParams,{url:ajaxOptions.url,dataType:"json",data:params,success:function(){self.ajaxSuccess.apply(self,arguments)}}))};autocomplete.ajaxSuccess=function(data){this._data=_(this.options.parseData(data)).chain().sortBy(this.options.sortBy).filter(this.options.filterResult).value();this.render()}};$.fn.autocomplete.ajax=Ajax;return Ajax})($,_);define("jquery.autocomplete/jquery.autocomplete.ajax",["jquery.autocomplete/jquery.autocomplete"],function(global){return function(){var ret,fn;return ret||global.jQuery.fn.autocomplete.ajax}}(this));define("css!css/locationOperatorsView.css",["css!css/compiled.css"],function(){});define("src/views/LocationOperatorsView",["backbone","underscore","jquery","src/Workbench","mustache!templates/locationOperators","jquery.showRelativeTo","jquery.autocomplete/jquery.autocomplete","jquery.autocomplete/jquery.autocomplete.ajax","css!css/locationOperatorsView.css"],function(Backbone,_,$,Workbench,template){"use strict";return Backbone.View.extend({className:"locationOperatorsView popupframe doublepadding sixcol",events:{"click input.operator":"selectLocationId","click .close":"onClose"},render:function render(){var $el=$(this.el);$el.html(template);this.initAutocomplete();return this},showNextTo:function showNextTo($target){if(!$target){throw new Error("parent must be defined")}$(this.el).showRelativeTo({target:$target});return this},selectLocationId:function selectLocationId(e){$(e.target).select()},refresh:function refresh(params){var location=params.location,$tips=this.$(".tips"),$table=this.$(".locationIds table"),$tbody=$table.find("tbody"),operatorCell='<td class="operator"><input readonly class="field operator" type="text" value="'+location.type+":"+location.id+'">',nameCell='<td class="location">'+this.formatLocationName(location.fullName)+"</td>";$table.removeClass("hidden");$tbody.empty();_.delay(function fadeInRow(){$tbody.prepend("<tr>"+operatorCell+nameCell+"</tr>").hide().fadeIn(200).find("input").select()},300);$tips.removeClass("hidden")},initAutocomplete:function initAutocomplete(options){var self=this,defaults={css:{width:540},renderResult:function renderResult(result){return self.formatLocationName(result.fullName)},selected:function selected(result){self.refresh({location:result})},parseData:function parseData(data){return data.results},plugins:[{plugin:$.fn.autocomplete.ajax,options:{url:Workbench.buildApiUrl("/locations"),params:{pageSize:20,page:0}}}]};options=options||{};this.$(".autocomplete").autocomplete(_.extend({},defaults,options))},formatLocationName:function formatLocationName(name){var commaIdx=name.indexOf(",");name="<em>"+name.substring(0,commaIdx>-1?commaIdx:name.length)+"</em>"+(commaIdx>-1?name.substring(commaIdx,name.length):"");return name.length>83?name.substring(0,80)+"...":name},onClose:function onClose(){this.remove()}})});define("mustache!templates/mixedScriptsWarning",["lib/mustache"],function(mustache){var escapedTemplate="<p>Sorry but you cannot have Latin and CJK (Chinese, Japanese, Korean, Lao,</p>\n<p class=tinymargin-top>and Thai) languages in the same Query. For best results, we suggest that</p>\n<p class=tinymargin-top>you keep Latin and CJK languages in separate Queries.</p>";return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!templates/queryLanguages",["lib/mustache"],function(mustache){var escapedTemplate='<div class="queryLanguagesView bwscrollbar validation-wrapper" data-validation-message-required="Please select at least one language" data-validation-message-unsupported="{{{mixedScriptsWarning}}}">\n<fieldset>\n<h2 class="singlepadding-top smallpadding-bottom">European</h2>\n<ul class="european smallmargin-left singlemargin-bottom">\n{{#european}}\n<li>\n<input type="checkbox" name="languages" id="language-{{code}}" value="{{code}}" {{#isChecked}}{{code}}{{/isChecked}} />\n<label for="language-{{code}}">{{{name}}}</label>\n</li>\n{{/european}}\n</ul>\n<h2 class="singlepadding-top smallpadding-bottom">Scandinavian</h2>\n<ul class="scandinavian smallmargin-left singlemargin-bottom">\n{{#scandinavian}}\n<li>\n<input type="checkbox" name="languages" id="language-{{code}}" value="{{code}}" {{#isChecked}}{{code}}{{/isChecked}} />\n<label for="language-{{code}}">{{{name}}}</label>\n</li>\n{{/scandinavian}}\n</ul>\n<h2 class="singlepadding-top smallpadding-bottom">American</h2>\n<ul class="americas smallmargin-left singlemargin-bottom">\n{{#americas}}\n<li>\n<input type="checkbox" name="languages" id="language-{{code}}" value="{{code}}" {{#isChecked}}{{code}}{{/isChecked}} />\n<label for="language-{{code}}">{{{name}}}</label>\n</li>\n{{/americas}}\n</ul>\n<h2 class="singlepadding-top smallpadding-bottom">Middle Eastern</h2>\n<ul class="asian smallmargin-left singlemargin-bottom">\n{{#middleEast}}\n<li>\n<input type="checkbox" name="languages" id="language-{{code}}" value="{{code}}" {{#isChecked}}{{code}}{{/isChecked}} />\n<label for="language-{{code}}">{{{name}}}</label>\n</li>\n{{/middleEast}}\n</ul>\n<h2 class="singlepadding-top smallpadding-bottom">Asian</h2>\n<ul class="asian smallmargin-left singlemargin-bottom">\n{{#asia}}\n<li>\n<input type="checkbox" name="languages" id="language-{{code}}" value="{{code}}" {{#isChecked}}{{code}}{{/isChecked}} />\n<label for="language-{{code}}">{{{name}}}</label>\n</li>\n{{/asia}}\n</ul>\n{{#newLanguage.length}}\n<h2 class="newLanguage singlepadding-top smallpadding-bottom">Alpha Languages</h2>\n<ul class="newLanguage smallmargin-left singlemargin-bottom">\n{{#newLanguage}}\n<li>\n<input type="checkbox" name="languages" id="language-{{code}}" value="{{code}}" {{#isChecked}}{{code}}{{/isChecked}} />\n<label for="language-{{code}}">{{{name}}}</label>\n</li>\n{{/newLanguage}}\n</ul>\n{{/newLanguage.length}}\n</fieldset>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!css/queryLanguagesView.css",["css!css/compiled.css"],function(){});define("src/views/QueryLanguagesView",["jquery","underscore","backbone","src/views/ValidatingFormView","mustache!templates/mixedScriptsWarning","mustache!templates/queryLanguages","css!css/queryLanguagesView.css"],function($,_,Backbone,ValidatingFormView,mixedScriptsWarningTemplate,queryLanguagesTemplate){"use strict";function getLanguages(view){return view.$("[name=languages]:checked").get().map(function(el){return $(el).val()})}return ValidatingFormView.extend({constructor:function QueryLanguagesView(options){options=options||{};if(!options.model){throw new Error("QueryLanguagesView must be initialized with a Query model")}if(!options.languageGroups){throw new Error("QueryLanguagesView must be initialized with languageGroups option")}this.languageGroups=options.languageGroups;Backbone.View.apply(this,arguments)},render:function render(){var checkedLangs=this.model.get("languages"),templateData=_.extend({isChecked:function isChecked(){return function(langCode,render){if(checkedLangs.indexOf(render(langCode))>-1){return"checked"}return""}}},{mixedScriptsWarning:mixedScriptsWarningTemplate()},this.languageGroups);this.$el.html(queryLanguagesTemplate(templateData))},toggleValidationError:function toggleValidationError(validationResult){this.hideErrors();if(!validationResult){return}this.showInputValidation(this.$('[name="languages"]'),{languages:validationResult});this.trigger("validation-error")},getValue:function getValue(){return{languages:getLanguages(this)}},disableSelection:function disableSelection(){this.currentSelection=this.getValue().languages;this.$('[name="languages"]').prop("disabled",true)},enableSelection:function enableSelection(){var currentSelection=this.currentSelection;this.$('[name="languages"]').prop("disabled",false).filter(function(idx,elem){return currentSelection.indexOf($(elem).val())>-1}).prop("checked",true)}})});define("mustache!src/querybuilder/templates/queryLanguageSelection",["lib/mustache"],function(mustache){var escapedTemplate='<div class="modular popupframe sixcol doublepadding queryLanguageSelection">\n<h1 class="popuptitletext singlemargin-bottom">Set the Language of this Query</h1>\n<a class="js-close icon-remove doublepadding lightgrey abstop absright"></a>\n<div class="js-languages relative">\n<div class="smallmargin-bottom bold">Pick a language <a class="help icon-bwhelp" data-key="query-language"></a></div>\n<div class="languageList bwscrollbar rowborder rowborder-top"></div>\n</div>\n\n<p class="lightgrey">* These languages only have basic support.<a class="help icon-bwhelp smallmargin-left smallmargin-bottom" data-key="filters-language-support"></a></p>\n\n<div class="singlemargin-top">\n<button class="js-apply defaultbutton singlemargin-right">Apply</button>\n<button class="js-close button">Cancel</button>\n</div>\n<div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/querybuilder/templates/languageAgnosticOption",["lib/mustache"],function(mustache){var escapedTemplate='<div class="doublemargin-top">\n<div class="singlepadding-bottom">\n<input type="checkbox" name="agnostic" id="language-agnostic" value="agnostic" {{#languageAgnostic}}checked{{/languageAgnostic}}>\n<label for="language-agnostic">Ignore language and match against every mention</label>\n<a class="help icon-bwhelp" data-key="language-agnostic-query"></a>\n</div>\n<div class="js-volume-warning {{^languageAgnostic}}hidden{{/languageAgnostic}} rounded notification-warning singlepadding-horizontal smallpadding-vertical mediumtext">\n<div class="dib floatleft icon-warning-sign smallpadding-right"></div>\n<div class="dib fivecolmax">This may result in massive data volumes that cannot be previewed</div>\n</div>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/querybuilder/templates/overlay",["lib/mustache"],function(mustache){var escapedTemplate='<div class="js-overlay {{#hidden}}hidden{{/hidden}} overlay"></div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/querybuilder/css/queryLanguageSelection.css",["css!src/querybuilder/css/compiled.css"],function(){});define("src/querybuilder/views/QueryLanguageSelectionView",["jquery","bw-fe-helpers/languageGroupHelper","src/views/ContextMenuView","src/views/QueryLanguagesView","src/models/Query","src/models/LanguageCollection","mustache!src/querybuilder/templates/queryLanguageSelection","mustache!src/querybuilder/templates/languageAgnosticOption","mustache!src/querybuilder/templates/overlay","css!src/querybuilder/css/queryLanguageSelection.css"],function($,languageGroupHelper,ContextMenuView,QueryLanguagesView,Query,LanguageCollection,renderLanguageSelection,renderLanguageAgnosticOptionTemplate,renderOverlayTemplate){"use strict";function applySelection(view){var validationResult,data=view.getValue();validationResult=view.model.validateLanguages(data);view.queryLanguagesView.toggleValidationError(validationResult);if(validationResult){return}view.languagesSelected(data);view.remove()}return ContextMenuView.extend({events:{"click .js-apply":function onClickApply(){applySelection(this)},"click .js-close":function onClickClose(){this.remove()},"click .queryLanguageSelection":function onClickStopPropagation(e){if($(e.target).is(".help")){return}e.stopPropagation()},'change [name="agnostic"]':function onToggleLanguageAgnostic(e){var isLanguageAgnostic=$(e.currentTarget).is(":checked");this.$(".js-volume-warning, .js-overlay").toggleClass("hidden",!isLanguageAgnostic);this.hideLanguageSupportHelper();if(isLanguageAgnostic){return this.queryLanguagesView.disableSelection()}this.queryLanguagesView.enableSelection()}},constructor:function QueryLanguageSelectionView(options){ContextMenuView.apply(this,arguments);options=options||{};if(!(options.model instanceof Query)){throw new Error("QueryLanguageSelectionView expects options.model to be a Query")}if(!(options.languages instanceof LanguageCollection)){throw new Error("QueryLanguageSelectionView expects options.languages to be a LanguageCollection")}var languages=languageGroupHelper.getLanguageData(options.languages);languages=languageGroupHelper.asteriskAlphaLanguages(languages);this.queryLanguagesView=new QueryLanguagesView({model:this.model,languageGroups:languages})},render:function render(){var langView=this.queryLanguagesView;var isLanguageAgnostic=this.model.get("languageAgnostic");this.$el.html(renderLanguageSelection());this.$(".languageList").append(langView.$el);this.$(".js-languages").after(renderLanguageAgnosticOptionTemplate({languageAgnostic:isLanguageAgnostic})).append(renderOverlayTemplate({hidden:!isLanguageAgnostic}));if(isLanguageAgnostic){this.queryLanguagesView.disableSelection()}langView.render()},remove:function remove(){if(this.queryLanguagesView){this.queryLanguagesView.remove()}ContextMenuView.prototype.remove.call(this)},getValue:function getValue(){var result=this.queryLanguagesView.getValue();result.languageAgnostic=this.$('[name="agnostic"]').is(":checked");return result},languagesSelected:function languagesSelected(data){this.trigger("languagesSelected",data)},hideLanguageSupportHelper:function hideLanguageSupportHelper(){var parentNode=this.$('[data-key="filters-language-support"]').parent();if(this.$('[name="agnostic"]').is(":checked")){parentNode.addClass("hidden")}else{parentNode.removeClass("hidden")}}})});define("src/helpers/customtipEffectsHelper",["jquery","underscore","customtip"],function($,_){"use strict";var DEFAULT_EFFECT=$.tools.tooltip.conf.effect;function resetToDefault($trigger){$trigger.customtip()}function withEffect($trigger,effect,callback){var oldEffect,data=$trigger.data("tooltip")||createWithEffect($trigger,effect);if(data){oldEffect=data.getConf().effect;data.getConf().effect=effect||DEFAULT_EFFECT;callback(data);data.getConf().effect=oldEffect}}function createWithEffect($trigger,effect,callback){var data;effect=effect||DEFAULT_EFFECT;data=$trigger.customtip({effect:effect}).data("tooltip");if(_.isFunction(callback)&&data){callback(data)}}function show($trigger,effect){createWithEffect($trigger,effect,function(tooltip){tooltip.show()})}function hide($trigger,effect){withEffect($trigger,effect,function(tooltip){tooltip.hide()});resetToDefault($trigger)}return{show:show,hide:hide}});define("mustache!src/querybuilder/templates/queryLanguageOverview",["lib/mustache"],function(mustache){var escapedTemplate='<label class="relative">{{label}}:</label>\n<a class="js-show-languages customtip relative" title="Set the language of this Query here">\n{{shortList}} {{number}}\n</a>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/querybuilder/views/QueryLanguageOverviewView",["underscore","jquery","backbone","src/models/Query","src/helpers/customtipEffectsHelper","mustache!src/querybuilder/templates/queryLanguageOverview","customtip"],function(_,$,Backbone,Query,customtipEffectsHelper,renderQueryLanguageOverviewTemplate){"use strict";var CHAR_LIMIT=14,SEPARATOR="\n",getFormattedCount,getShortLanguagesList,getLabel;function getLanguageNames(languageCollection,selectedLanguageCodes){if(!(languageCollection instanceof Backbone.Collection)){return[]}return languageCollection.chain().filter(function(language){return _.contains(selectedLanguageCodes,language.get("code"))}).invoke("get","name").value()}function getAllLanguages(view){return getLanguageNames(view.languages,view.languageCodes()).join(SEPARATOR)}function endsWithSeparator(languages){return languages[CHAR_LIMIT-1]===SEPARATOR}function smartCharLimit(languages){return endsWithSeparator(languages)?CHAR_LIMIT-1:CHAR_LIMIT}function removeDisplayedLanguages(languages){return languages.slice(smartCharLimit(languages))}function countLanguages(languages){return _.count(languages,SEPARATOR)}function formatCount(count){return count>0?"+"+count:""}function addEllipsis(languages){return languages.length>CHAR_LIMIT?"...":""}function replaceHiddenLanguagesWithEllipsis(languages){return languages.slice(0,smartCharLimit(languages))+addEllipsis(languages)}function replaceSeparators(languages){return languages.split(SEPARATOR).join(", ")}function generateLabel(count){return count>1?"Languages":"Language"}function validateOptions(options){if(!(options.model instanceof Query)){throw new Error("QueryLanguageOverviewView expects options.model to be a Query")}if(!options.languages){throw new Error("QueryLanguageOverviewView must be initialized with option languages")}}function $tooltip(view){return view.$(".js-show-languages.customtip")}function clearTimeouts(view){clearTimeout(view.timeoutId)}getFormattedCount=_.compose(formatCount,countLanguages,removeDisplayedLanguages,getAllLanguages);getShortLanguagesList=_.compose(replaceSeparators,replaceHiddenLanguagesWithEllipsis,getAllLanguages);getLabel=_.compose(generateLabel,countLanguages,getAllLanguages);return Backbone.View.extend({constructor:function constructor(options){Backbone.View.apply(this,arguments);options=options||{};validateOptions(options);this.languages=options.languages;this.charLimit=options.charLimit||CHAR_LIMIT;$(window).on("resize",{view:this},this.hideTooltipEventHandler)},languageCodes:function languageCodes(){return this.model.get("languages")},render:function render(){var isLanguageAgnostic=this.model.get("languageAgnostic");var templateData;templateData={label:"Language",shortList:"Ignore"};if(!isLanguageAgnostic){templateData.label=getLabel(this);templateData.shortList=getShortLanguagesList(this);templateData.number=getFormattedCount(this)}this.$el.html(renderQueryLanguageOverviewTemplate(templateData));this.$el.customtip()},hideTooltipEventHandler:function hideTooltipEventHandler(e){clearTimeouts(this);customtipEffectsHelper.hide($tooltip(e.data.view))},triggerTooltip:function triggerTooltip(){var view=this;view.timeoutId=setTimeout(function(){customtipEffectsHelper.show($tooltip(view),"fade");view.timeoutId=setTimeout(function(){customtipEffectsHelper.hide($tooltip(view),"fade")},4e3)},1500)},remove:function remove(){clearTimeouts(this);$(window).off("resize",this.hideTooltipEventHandler);customtipEffectsHelper.hide($tooltip(this));Backbone.View.prototype.remove.apply(this,arguments)}})});define("mustache!src/querybuilder/templates/queryEditorHeader",["lib/mustache"],function(mustache){var escapedTemplate='<div class="js-language-overview-container dib"></div>\n{{^crimsonMode}}\n<div class="queryHelp dib floatright">\n<a class="js-query-examples customtip floatleft link-separator" title="Check out some Query Examples">Examples</a>\n<a class="queryOperators customtip floatleft link-separator" title="Help on the operators you can use in Queries">Operators</a>\n<a class="locationOperators customtip floatleft" title="Look up location operators">Locations</a>\n</div>\n{{/crimsonMode}}\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/querybuilder/css/queryEditorHeader.css",["css!src/querybuilder/css/compiled.css"],function(){});define("src/querybuilder/views/QueryEditorHeaderView",["jquery","backbone","src/globals/crimsonMode","src/querybuilder/queryExamplesHelper","src/views/LocationOperatorsView","src/querybuilder/views/QueryLanguageSelectionView","src/querybuilder/views/QueryLanguageOverviewView","mustache!src/querybuilder/templates/queryEditorHeader","src/packages/customtip","css!src/querybuilder/css/queryEditorHeader.css"],function($,Backbone,crimsonMode,queryExamplesHelper,LocationOperatorsView,QueryLanguageSelectionView,QueryLanguageOverviewView,renderEditorHeaderTemplate){"use strict";function initializeLanguageOverview(view){if(view.queryLanguageOverviewView){return}view.queryLanguageOverviewView=new QueryLanguageOverviewView({model:view.model,languages:view.languages})}function renderLanguageOverview(view){initializeLanguageOverview(view);view.$(".js-language-overview-container").html(view.queryLanguageOverviewView.el);view.queryLanguageOverviewView.render()}function showQueryOperators(){window.open("/help/query-operators","queryOperators","width=640,height=640,scrollbars=yes,resizable=yes")}function showLocationOperators(view){view.locationOperatorsView=(new LocationOperatorsView).render();view.locationOperatorsView.$el.appendTo(view.$el);view.locationOperatorsView.showNextTo(view.$(".locationOperators"));view.locationOperatorsView.$(".autocomplete").focus();$("body").on("mousedown.closeLocationOperators",function onCloseLocationOperators(e){view.closeLocationOperators(e)})}function _closeLocationOperators(view){$("body").off("mousedown.closeLocationOperators");if(view.locationOperatorsView){view.locationOperatorsView.$el.removeRelativeTo();view.locationOperatorsView.remove();view.locationOperatorsView=undefined}}function showLanguageSelection($target,view){var queryLanguageSelectionView=QueryLanguageSelectionView.show({$target:$target,model:view.model,languages:view.languages});view.listenToOnce(queryLanguageSelectionView,"languagesSelected",view.onLanguageSelected)}return Backbone.View.extend({className:"queryEditorHeader",events:{"click .js-show-languages":function onClickShowLanguages(e){showLanguageSelection($(e.currentTarget),this)},"click .queryOperators":function onClickQueryOperators(e){e.preventDefault();showQueryOperators()},"click .locationOperators":function onClickLocationOperators(e){e.preventDefault();showLocationOperators(this)},"click .js-query-examples":function onClickQueryExamples(e){e.preventDefault();queryExamplesHelper.showQueryExamples("header")}},constructor:function QueryEditorHeaderView(options){Backbone.View.apply(this,arguments);options=options||{};if(!options.model){throw new Error("QueryEditorHeaderView must be initialized with options.model")}if(!options.languages){throw new Error("QueryEditorHeaderView must be initialized with options.languages")}this.languages=options.languages},onLanguageSelected:function onLanguageSelected(languageData){var languages=languageData.languages;if(languageData.languageAgnostic&&languageData.languages.length===0){languages=["en"]}this.model.set({languages:languages,languageAgnostic:languageData.languageAgnostic});renderLanguageOverview(this)},render:function render(){this.$el.html(renderEditorHeaderTemplate({crimsonMode:crimsonMode.enabled()}));renderLanguageOverview(this);this.$(".customtip").customtip()},remove:function remove(){_closeLocationOperators(this);if(this.queryLanguageOverviewView){this.queryLanguageOverviewView.remove();this.queryLanguageOverviewView=undefined}Backbone.View.prototype.remove.apply(this,arguments)},closeLocationOperators:function closeLocationOperators(){_closeLocationOperators(this)},triggerLanguageOverviewTooltip:function triggerLanguageOverviewTooltip(){if(this.model.isNew()&&this.queryLanguageOverviewView){this.queryLanguageOverviewView.triggerTooltip()}}})});define("src/helpers/queryLengthHelper",["src/models/Query"],function(Query){"use strict";function getIndicatorCssClass(documentLength){if(documentLength<=4e3){return"lightgrey"}if(documentLength<=4033){return"grey"}if(documentLength<=4066){return"darkgrey"}if(documentLength<=Query.queryTextMaxLength){return"warning"}return"limit-reached"}function getAllIndicatorCssClasses(){return"lightgrey grey darkgrey warning limit-reached"}return{getIndicatorCssClass:getIndicatorCssClass,getAllIndicatorCssClasses:getAllIndicatorCssClasses}});define("mustache!src/querybuilder/templates/queryEditorFooter",["lib/mustache"],function(mustache){var escapedTemplate='<div class="singlemargin-horizontal singlemargin-top floatleft textcenter">\n<button class="js-preview defaultbutton" data-at="query-editor-test-query-button">Test Query</button>\n<div class="shortcut-hint grey">{{modifierKey}}+Enter</div>\n</div>\n{{#hasHelpMenu}}\n<div class="js-show-help show-help dib relative singlemargin-top tinypadding-top">\n<a class="smallpadding-vertical">Need help?<span class="smallmargin-left grey icon-chevron-down"></span></a>\n<div class="context-menu popupframe threecol abstop hidden">\n<a class="context-menu--item db js-query-examples">\n<span class="singlepadding-left smallmargin-left">Query Examples</span>\n</a>\n{{#crimsonMode}}\n<a class="context-menu--item db js-query-operators">\n<span class="singlepadding-left smallmargin-left">Operators</span>\n</a>\n{{/crimsonMode}}\n<a class="context-menu--item db js-show-howto" href="/supportsso?return_to=https%3A%2F%2Fsupport.brandwatch.com%2Fforums%2F21165262-Queries" target="_blank">\n<span class="singlepadding-left smallmargin-left">How to write Queries</span>\n<span class="tinypadding-left icon-external-link"></span>\n</a>\n<a class="context-menu--item db js-show-faq" href="/supportsso?return_to=https%3A%2F%2Fsupport.brandwatch.com%2Fhc%2Fen-us%2Fsections%2F200601683-FAQ-Queries" target="_blank">\n<span class="singlepadding-left smallmargin-left">FAQs</span>\n<span class="tinypadding-left icon-external-link"></span>\n</a>\n<span class="context-menu--item separator"></span>\n<a class="context-menu--item db js-show-form">\n<span class="icon-comment"></span>\n<span class="tinypadding-left">Request assistance...</span>\n</a>\n</div>\n</div>\n{{/hasHelpMenu}}\n<div class="query-length dib singlemargin-top singlemargin-right tinypadding-top absright">\n<span class="customtip notice" title="Your Query is too long, please shorten it">Please shorten</span>\n<span class="js-counter customtip dib smallpadding-left" title="Characters left for this Query"></span> characters left\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/querybuilder/css/queryEditorFooter.css",["css!src/querybuilder/css/compiled.css"],function(){});define("src/querybuilder/views/QueryEditorFooterView",["backbone","src/globals/theme","src/globals/crimsonMode","src/helpers/queryLengthHelper","src/querybuilder/queryExamplesHelper","src/models/Query","mustache!src/querybuilder/templates/queryEditorFooter","ace/lib/useragent","src/packages/customtip","css!src/querybuilder/css/queryEditorFooter.css"],function(Backbone,theme,crimsonMode,queryLengthHelper,queryExamplesHelper,Query,renderEditorFooterTemplate,useragent){"use strict";function toggleHelpMenu(view,visible){view.$(".js-show-help .context-menu").toggleClass("hidden",!visible)}function updateIndicator(view,documentLength){var documentLengthLimit=Query.queryTextMaxLength;var $lengthIndicator=view.$(".query-length");var $lengthSpan=$lengthIndicator.find(".js-counter");var allCssClasses=queryLengthHelper.getAllIndicatorCssClasses()+" over-limit";var newCssClass=queryLengthHelper.getIndicatorCssClass(documentLength);if(documentLength>documentLengthLimit){newCssClass+=" over-limit"}$lengthIndicator.removeClass(allCssClasses).addClass(newCssClass);$lengthSpan.text(documentLengthLimit-documentLength);view.toggleFormButtons()}function showQueryOperators(){window.open("/help/query-operators","queryOperators","width=640,height=640,scrollbars=yes,resizable=yes")}return Backbone.View.extend({className:"queryEditorFooter",events:{"click .js-preview":function onClickPreview(e){e.preventDefault();this.trigger("editor-preview")},"mouseover .js-show-help":function onOnMouseOverShowHelp(){toggleHelpMenu(this,true)},"mouseout .js-show-help":function onMouseOutHideHelp(){toggleHelpMenu(this,false)},"click .js-show-form":function onClickShowHelpRequestForm(){this.trigger("editor-help");toggleHelpMenu(this,false)},"click .js-query-examples":function onClickShowQueryExamples(){queryExamplesHelper.showQueryExamples("footer")},"click .js-query-operators":function onClickQueryOperators(e){e.preventDefault();showQueryOperators()}},constructor:function QueryEditorFooterView(){Backbone.View.apply(this,arguments)},render:function render(){this.$el.html(renderEditorFooterTemplate({hasHelpMenu:theme.isBrandwatchOrGreyLabelTheme(),modifierKey:useragent.isMac?"Cmd":"Ctrl",crimsonMode:crimsonMode.enabled()}));this.$(".customtip").customtip()},toggleFormButtons:function toggleFormButtons(){var isQueryStringOverLimit=this.$(".query-length").hasClass("over-limit");if(isQueryStringOverLimit){this.disableTestSearch();return}this.enableTestSearch()},disableTestSearch:function disableTestSearch(){this.$(".js-preview").prop("disabled",true)},enableTestSearch:function enableTestSearch(){this.$(".js-preview").prop("disabled",false)},updateCounter:function updateCounter(currentCount){updateIndicator(this,currentCount)}})});define("mustache!src/querybuilder/templates/queryHelpRequest",["lib/mustache"],function(mustache){var escapedTemplate='<div class="queryHelpRequest relative">\n<section class="infobox infoboxtextcolor infoboxbgcolor mediumtext doublepadding-vertical">\n<header class="infobox--header normal dib doublepadding-horizontal singlemargin-bottom">We\'d like to help you</header>\n<p class="mediumtext-bigline doublepadding-horizontal">\nOur <span class="bold">support team</span> will respond to your request as soon as possible.\n</p>\n<p class="mediumtext-bigline doublepadding-horizontal">\nIf you have started writing a Query it will be included in your request.\n</p>\n</section>\n<label class="purpose-label db bold singlemargin-top tinymargin-bottom">\nWhat is the purpose of your Query? *\n</label>\n<textarea class="js-purpose purpose-field fullwidth" placeholder="e.g. \'The purpose of this Query is to track how many...\'"></textarea>\n<label class="info-label db singlemargin-top tinymargin-bottom">\nAdditional information\n</label>\n<textarea class="js-info info-field fullwidth" placeholder="e.g. tell us where you got stuck when writing the Query"></textarea>\n<footer class="singlepadding-top relative">\n<button class="js-request defaultbutton" disabled>Send Support Request</a>\n<button class="js-cancel button singlemargin-left">Cancel</button>\n<span class="grey tinypadding-bottom absbottom absright">* required fields</span>\n</footer>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/querybuilder/css/queryHelpRequest.css",["css!src/querybuilder/css/compiled.css"],function(){});define("src/querybuilder/views/QueryHelpRequestView",["underscore","jquery","backbone","src/globals/theme","bw-fe-helpers/windowHelper","mustache!src/querybuilder/templates/queryHelpRequest","css!src/querybuilder/css/queryHelpRequest.css"],function(_,$,Backbone,theme,windowHelper,renderHelpRequestTempalte){"use strict";function buildMailToBody(purposeString,infoString,queryString){var body="Query Purpose: "+purposeString;if(infoString){body+="\n\n"+"Additional Info: "+infoString}if(queryString){body+="\n\n"+"Query String: "+queryString}return encodeURIComponent(body+"\n\n")}function buildMailToLink(purposeString,infoString,queryString){var email=theme.contactEmail,mailSubject=encodeURIComponent("Query Writing Help Request"),mailBody=buildMailToBody(purposeString,infoString,queryString);return"mailto:"+email+"?body="+mailBody+"&subject="+mailSubject}return Backbone.View.extend({events:{"click .js-request":function onClickRequestButton(){var purposeString=this.$(".js-purpose").val().trim(),infoString=this.$(".js-info").val().trim();if(!purposeString){return}windowHelper.open(buildMailToLink(purposeString,infoString,this.queryString),"_self");this.trigger("requested")},"click .js-cancel":function onClickCancelButton(){this.trigger("cancelled")},"keyup .js-purpose":_.debounce(function onChangePurposeText(e){var purposeString=$(e.currentTarget).val().trim();this.$(".js-request").prop("disabled",!purposeString)},100)},constructor:function QueryHelpRequestView(options){Backbone.View.apply(this,arguments);this.queryString=options&&options.queryString},render:function render(){this.$el.html(renderHelpRequestTempalte())},setFocus:function setFocus(){this.$(".js-purpose").focus()}})});d3=function(){var d3={version:"3.3.10"};if(!Date.now)Date.now=function(){return+new Date};var d3_arraySlice=[].slice,d3_array=function(list){return d3_arraySlice.call(list)};var d3_document=document,d3_documentElement=d3_document.documentElement,d3_window=window;try{d3_array(d3_documentElement.childNodes)[0].nodeType}catch(e){d3_array=function(list){var i=list.length,array=new Array(i);while(i--)array[i]=list[i];return array}}try{d3_document.createElement("div").style.setProperty("opacity",0,"")}catch(error){var d3_element_prototype=d3_window.Element.prototype,d3_element_setAttribute=d3_element_prototype.setAttribute,d3_element_setAttributeNS=d3_element_prototype.setAttributeNS,d3_style_prototype=d3_window.CSSStyleDeclaration.prototype,d3_style_setProperty=d3_style_prototype.setProperty;d3_element_prototype.setAttribute=function(name,value){d3_element_setAttribute.call(this,name,value+"")};d3_element_prototype.setAttributeNS=function(space,local,value){d3_element_setAttributeNS.call(this,space,local,value+"")};d3_style_prototype.setProperty=function(name,value,priority){d3_style_setProperty.call(this,name,value+"",priority)}}d3.ascending=function(a,b){return a<b?-1:a>b?1:a>=b?0:NaN};d3.descending=function(a,b){return b<a?-1:b>a?1:b>=a?0:NaN};d3.min=function(array,f){var i=-1,n=array.length,a,b;if(arguments.length===1){while(++i<n&&!((a=array[i])!=null&&a<=a))a=undefined;while(++i<n)if((b=array[i])!=null&&a>b)a=b}else{while(++i<n&&!((a=f.call(array,array[i],i))!=null&&a<=a))a=undefined;while(++i<n)if((b=f.call(array,array[i],i))!=null&&a>b)a=b}return a};d3.max=function(array,f){var i=-1,n=array.length,a,b;if(arguments.length===1){while(++i<n&&!((a=array[i])!=null&&a<=a))a=undefined;while(++i<n)if((b=array[i])!=null&&b>a)a=b}else{while(++i<n&&!((a=f.call(array,array[i],i))!=null&&a<=a))a=undefined;while(++i<n)if((b=f.call(array,array[i],i))!=null&&b>a)a=b}return a};d3.extent=function(array,f){var i=-1,n=array.length,a,b,c;if(arguments.length===1){while(++i<n&&!((a=c=array[i])!=null&&a<=a))a=c=undefined;while(++i<n)if((b=array[i])!=null){if(a>b)a=b;if(c<b)c=b}}else{while(++i<n&&!((a=c=f.call(array,array[i],i))!=null&&a<=a))a=undefined;while(++i<n)if((b=f.call(array,array[i],i))!=null){if(a>b)a=b;if(c<b)c=b}}return[a,c]};d3.sum=function(array,f){var s=0,n=array.length,a,i=-1;if(arguments.length===1){while(++i<n)if(!isNaN(a=+array[i]))s+=a}else{while(++i<n)if(!isNaN(a=+f.call(array,array[i],i)))s+=a}return s};function d3_number(x){return x!=null&&!isNaN(x)}d3.mean=function(array,f){var n=array.length,a,m=0,i=-1,j=0;if(arguments.length===1){while(++i<n)if(d3_number(a=array[i]))m+=(a-m)/++j}else{while(++i<n)if(d3_number(a=f.call(array,array[i],i)))m+=(a-m)/++j}return j?m:undefined};d3.quantile=function(values,p){var H=(values.length-1)*p+1,h=Math.floor(H),v=+values[h-1],e=H-h;return e?v+e*(values[h]-v):v};d3.median=function(array,f){if(arguments.length>1)array=array.map(f);array=array.filter(d3_number);return array.length?d3.quantile(array.sort(d3.ascending),.5):undefined};d3.bisector=function(f){return{left:function(a,x,lo,hi){if(arguments.length<3)lo=0;if(arguments.length<4)hi=a.length;while(lo<hi){var mid=lo+hi>>>1;if(f.call(a,a[mid],mid)<x)lo=mid+1;else hi=mid}return lo},right:function(a,x,lo,hi){if(arguments.length<3)lo=0;if(arguments.length<4)hi=a.length;while(lo<hi){var mid=lo+hi>>>1;if(x<f.call(a,a[mid],mid))hi=mid;else lo=mid+1}return lo}}};var d3_bisector=d3.bisector(function(d){return d});d3.bisectLeft=d3_bisector.left;d3.bisect=d3.bisectRight=d3_bisector.right;d3.shuffle=function(array){var m=array.length,t,i;while(m){i=Math.random()*m--|0;t=array[m],array[m]=array[i],array[i]=t}return array};d3.permute=function(array,indexes){var i=indexes.length,permutes=new Array(i);while(i--)permutes[i]=array[indexes[i]];return permutes};d3.pairs=function(array){var i=0,n=array.length-1,p0,p1=array[0],pairs=new Array(n<0?0:n);while(i<n)pairs[i]=[p0=p1,p1=array[++i]];return pairs};d3.zip=function(){if(!(n=arguments.length))return[];for(var i=-1,m=d3.min(arguments,d3_zipLength),zips=new Array(m);++i<m;){for(var j=-1,n,zip=zips[i]=new Array(n);++j<n;){zip[j]=arguments[j][i]}}return zips};function d3_zipLength(d){return d.length}d3.transpose=function(matrix){return d3.zip.apply(d3,matrix)};d3.keys=function(map){var keys=[];for(var key in map)keys.push(key);return keys};d3.values=function(map){var values=[];for(var key in map)values.push(map[key]);return values};d3.entries=function(map){var entries=[];for(var key in map)entries.push({key:key,value:map[key]});return entries};d3.merge=function(arrays){var n=arrays.length,m,i=-1,j=0,merged,array;while(++i<n)j+=arrays[i].length;merged=new Array(j);while(--n>=0){array=arrays[n];m=array.length;while(--m>=0){merged[--j]=array[m]}}return merged};var abs=Math.abs;d3.range=function(start,stop,step){if(arguments.length<3){step=1;if(arguments.length<2){stop=start;start=0}}if((stop-start)/step===Infinity)throw new Error("infinite range");var range=[],k=d3_range_integerScale(abs(step)),i=-1,j;start*=k,stop*=k,step*=k;if(step<0)while((j=start+step*++i)>stop)range.push(j/k);else while((j=start+step*++i)<stop)range.push(j/k);return range};function d3_range_integerScale(x){var k=1;while(x*k%1)k*=10;return k}function d3_class(ctor,properties){try{for(var key in properties){Object.defineProperty(ctor.prototype,key,{value:properties[key],enumerable:false})}}catch(e){ctor.prototype=properties}}d3.map=function(object){var map=new d3_Map;if(object instanceof d3_Map)object.forEach(function(key,value){map.set(key,value)});else for(var key in object)map.set(key,object[key]);return map};function d3_Map(){}d3_class(d3_Map,{has:function(key){return d3_map_prefix+key in this},get:function(key){return this[d3_map_prefix+key]},set:function(key,value){return this[d3_map_prefix+key]=value},remove:function(key){key=d3_map_prefix+key;return key in this&&delete this[key]},keys:function(){var keys=[];this.forEach(function(key){keys.push(key)});return keys},values:function(){var values=[];this.forEach(function(key,value){values.push(value)});return values},entries:function(){var entries=[];this.forEach(function(key,value){entries.push({key:key,value:value})});return entries},forEach:function(f){for(var key in this){if(key.charCodeAt(0)===d3_map_prefixCode){f.call(this,key.substring(1),this[key])}}}});var d3_map_prefix="\0",d3_map_prefixCode=d3_map_prefix.charCodeAt(0);d3.nest=function(){var nest={},keys=[],sortKeys=[],sortValues,rollup;function map(mapType,array,depth){if(depth>=keys.length)return rollup?rollup.call(nest,array):sortValues?array.sort(sortValues):array;var i=-1,n=array.length,key=keys[depth++],keyValue,object,setter,valuesByKey=new d3_Map,values;while(++i<n){if(values=valuesByKey.get(keyValue=key(object=array[i]))){values.push(object)}else{valuesByKey.set(keyValue,[object])}}if(mapType){object=mapType();setter=function(keyValue,values){object.set(keyValue,map(mapType,values,depth))}}else{object={};setter=function(keyValue,values){object[keyValue]=map(mapType,values,depth)}}valuesByKey.forEach(setter);return object}function entries(map,depth){if(depth>=keys.length)return map;var array=[],sortKey=sortKeys[depth++];map.forEach(function(key,keyMap){array.push({key:key,values:entries(keyMap,depth)})});return sortKey?array.sort(function(a,b){return sortKey(a.key,b.key)}):array}nest.map=function(array,mapType){return map(mapType,array,0)};nest.entries=function(array){return entries(map(d3.map,array,0),0)};nest.key=function(d){keys.push(d);return nest};nest.sortKeys=function(order){sortKeys[keys.length-1]=order;return nest};nest.sortValues=function(order){sortValues=order;return nest};nest.rollup=function(f){rollup=f;return nest};return nest};d3.set=function(array){var set=new d3_Set;if(array)for(var i=0,n=array.length;i<n;++i)set.add(array[i]);return set};function d3_Set(){}d3_class(d3_Set,{has:function(value){return d3_map_prefix+value in this},add:function(value){this[d3_map_prefix+value]=true;return value},remove:function(value){value=d3_map_prefix+value;return value in this&&delete this[value]},values:function(){var values=[];this.forEach(function(value){values.push(value)});return values},forEach:function(f){for(var value in this){if(value.charCodeAt(0)===d3_map_prefixCode){f.call(this,value.substring(1))}}}});d3.behavior={};d3.rebind=function(target,source){var i=1,n=arguments.length,method;while(++i<n)target[method=arguments[i]]=d3_rebind(target,source,source[method]);return target};function d3_rebind(target,source,method){return function(){var value=method.apply(source,arguments);return value===source?target:value}}function d3_vendorSymbol(object,name){if(name in object)return name;name=name.charAt(0).toUpperCase()+name.substring(1);for(var i=0,n=d3_vendorPrefixes.length;i<n;++i){var prefixName=d3_vendorPrefixes[i]+name;if(prefixName in object)return prefixName}}var d3_vendorPrefixes=["webkit","ms","moz","Moz","o","O"];function d3_noop(){}d3.dispatch=function(){var dispatch=new d3_dispatch,i=-1,n=arguments.length;while(++i<n)dispatch[arguments[i]]=d3_dispatch_event(dispatch);return dispatch};function d3_dispatch(){}d3_dispatch.prototype.on=function(type,listener){var i=type.indexOf("."),name="";if(i>=0){name=type.substring(i+1);type=type.substring(0,i)}if(type)return arguments.length<2?this[type].on(name):this[type].on(name,listener);if(arguments.length===2){if(listener==null)for(type in this){if(this.hasOwnProperty(type))this[type].on(name,null)}return this}};function d3_dispatch_event(dispatch){var listeners=[],listenerByName=new d3_Map;function event(){var z=listeners,i=-1,n=z.length,l;while(++i<n)if(l=z[i].on)l.apply(this,arguments);return dispatch}event.on=function(name,listener){var l=listenerByName.get(name),i;if(arguments.length<2)return l&&l.on;if(l){l.on=null;listeners=listeners.slice(0,i=listeners.indexOf(l)).concat(listeners.slice(i+1));listenerByName.remove(name)}if(listener)listeners.push(listenerByName.set(name,{on:listener}));return dispatch};return event}d3.event=null;function d3_eventPreventDefault(){d3.event.preventDefault()}function d3_eventSource(){var e=d3.event,s;while(s=e.sourceEvent)e=s;return e}function d3_eventDispatch(target){var dispatch=new d3_dispatch,i=0,n=arguments.length;while(++i<n)dispatch[arguments[i]]=d3_dispatch_event(dispatch);dispatch.of=function(thiz,argumentz){return function(e1){try{var e0=e1.sourceEvent=d3.event;e1.target=target;d3.event=e1;dispatch[e1.type].apply(thiz,argumentz)}finally{d3.event=e0}}};return dispatch}d3.requote=function(s){return s.replace(d3_requote_re,"\\$&")};var d3_requote_re=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g;var d3_subclass={}.__proto__?function(object,prototype){object.__proto__=prototype}:function(object,prototype){for(var property in prototype)object[property]=prototype[property]};function d3_selection(groups){d3_subclass(groups,d3_selectionPrototype);return groups}var d3_select=function(s,n){return n.querySelector(s)},d3_selectAll=function(s,n){return n.querySelectorAll(s)},d3_selectMatcher=d3_documentElement[d3_vendorSymbol(d3_documentElement,"matchesSelector")],d3_selectMatches=function(n,s){return d3_selectMatcher.call(n,s)};if(typeof Sizzle==="function"){d3_select=function(s,n){return Sizzle(s,n)[0]||null};d3_selectAll=function(s,n){return Sizzle.uniqueSort(Sizzle(s,n))};d3_selectMatches=Sizzle.matchesSelector}d3.selection=function(){return d3_selectionRoot};var d3_selectionPrototype=d3.selection.prototype=[];d3_selectionPrototype.select=function(selector){var subgroups=[],subgroup,subnode,group,node;selector=d3_selection_selector(selector);for(var j=-1,m=this.length;++j<m;){subgroups.push(subgroup=[]);subgroup.parentNode=(group=this[j]).parentNode;for(var i=-1,n=group.length;++i<n;){if(node=group[i]){subgroup.push(subnode=selector.call(node,node.__data__,i,j));if(subnode&&"__data__"in node)subnode.__data__=node.__data__}else{subgroup.push(null)}}}return d3_selection(subgroups)};function d3_selection_selector(selector){return typeof selector==="function"?selector:function(){return d3_select(selector,this)}}d3_selectionPrototype.selectAll=function(selector){var subgroups=[],subgroup,node;selector=d3_selection_selectorAll(selector);for(var j=-1,m=this.length;++j<m;){for(var group=this[j],i=-1,n=group.length;++i<n;){if(node=group[i]){subgroups.push(subgroup=d3_array(selector.call(node,node.__data__,i,j)));subgroup.parentNode=node}}}return d3_selection(subgroups)};function d3_selection_selectorAll(selector){return typeof selector==="function"?selector:function(){return d3_selectAll(selector,this)}}var d3_nsPrefix={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};d3.ns={prefix:d3_nsPrefix,qualify:function(name){var i=name.indexOf(":"),prefix=name;if(i>=0){prefix=name.substring(0,i);name=name.substring(i+1)}return d3_nsPrefix.hasOwnProperty(prefix)?{space:d3_nsPrefix[prefix],local:name}:name}};d3_selectionPrototype.attr=function(name,value){if(arguments.length<2){if(typeof name==="string"){var node=this.node();name=d3.ns.qualify(name);return name.local?node.getAttributeNS(name.space,name.local):node.getAttribute(name)}for(value in name)this.each(d3_selection_attr(value,name[value]));return this}return this.each(d3_selection_attr(name,value))};function d3_selection_attr(name,value){name=d3.ns.qualify(name);function attrNull(){this.removeAttribute(name)}function attrNullNS(){this.removeAttributeNS(name.space,name.local)}function attrConstant(){this.setAttribute(name,value)}function attrConstantNS(){this.setAttributeNS(name.space,name.local,value)}function attrFunction(){var x=value.apply(this,arguments);if(x==null)this.removeAttribute(name);else this.setAttribute(name,x)}function attrFunctionNS(){var x=value.apply(this,arguments);if(x==null)this.removeAttributeNS(name.space,name.local);else this.setAttributeNS(name.space,name.local,x)}return value==null?name.local?attrNullNS:attrNull:typeof value==="function"?name.local?attrFunctionNS:attrFunction:name.local?attrConstantNS:attrConstant}function d3_collapse(s){return s.trim().replace(/\s+/g," ")}d3_selectionPrototype.classed=function(name,value){if(arguments.length<2){if(typeof name==="string"){var node=this.node(),n=(name=name.trim().split(/^|\s+/g)).length,i=-1;if(value=node.classList){while(++i<n)if(!value.contains(name[i]))return false}else{value=node.getAttribute("class");while(++i<n)if(!d3_selection_classedRe(name[i]).test(value))return false}return true}for(value in name)this.each(d3_selection_classed(value,name[value]));return this}return this.each(d3_selection_classed(name,value))};function d3_selection_classedRe(name){return new RegExp("(?:^|\\s+)"+d3.requote(name)+"(?:\\s+|$)","g")}function d3_selection_classed(name,value){name=name.trim().split(/\s+/).map(d3_selection_classedName);var n=name.length;function classedConstant(){var i=-1;while(++i<n)name[i](this,value)}function classedFunction(){var i=-1,x=value.apply(this,arguments);while(++i<n)name[i](this,x)}return typeof value==="function"?classedFunction:classedConstant}function d3_selection_classedName(name){var re=d3_selection_classedRe(name);return function(node,value){if(c=node.classList)return value?c.add(name):c.remove(name);var c=node.getAttribute("class")||"";if(value){re.lastIndex=0;if(!re.test(c))node.setAttribute("class",d3_collapse(c+" "+name))}else{node.setAttribute("class",d3_collapse(c.replace(re," ")))}}}d3_selectionPrototype.style=function(name,value,priority){var n=arguments.length;if(n<3){if(typeof name!=="string"){if(n<2)value="";for(priority in name)this.each(d3_selection_style(priority,name[priority],value));return this}if(n<2)return d3_window.getComputedStyle(this.node(),null).getPropertyValue(name);priority=""}return this.each(d3_selection_style(name,value,priority))};function d3_selection_style(name,value,priority){function styleNull(){this.style.removeProperty(name)}function styleConstant(){this.style.setProperty(name,value,priority)}function styleFunction(){var x=value.apply(this,arguments);if(x==null)this.style.removeProperty(name);else this.style.setProperty(name,x,priority)}return value==null?styleNull:typeof value==="function"?styleFunction:styleConstant}d3_selectionPrototype.property=function(name,value){if(arguments.length<2){if(typeof name==="string")return this.node()[name];for(value in name)this.each(d3_selection_property(value,name[value]));return this}return this.each(d3_selection_property(name,value))};function d3_selection_property(name,value){function propertyNull(){delete this[name]}function propertyConstant(){this[name]=value}function propertyFunction(){var x=value.apply(this,arguments);if(x==null)delete this[name];else this[name]=x}return value==null?propertyNull:typeof value==="function"?propertyFunction:propertyConstant}d3_selectionPrototype.text=function(value){return arguments.length?this.each(typeof value==="function"?function(){var v=value.apply(this,arguments);this.textContent=v==null?"":v}:value==null?function(){this.textContent=""}:function(){this.textContent=value}):this.node().textContent};d3_selectionPrototype.html=function(value){return arguments.length?this.each(typeof value==="function"?function(){var v=value.apply(this,arguments);this.innerHTML=v==null?"":v}:value==null?function(){this.innerHTML=""}:function(){this.innerHTML=value}):this.node().innerHTML};d3_selectionPrototype.append=function(name){name=d3_selection_creator(name);return this.select(function(){return this.appendChild(name.apply(this,arguments))})};function d3_selection_creator(name){return typeof name==="function"?name:(name=d3.ns.qualify(name)).local?function(){return this.ownerDocument.createElementNS(name.space,name.local)}:function(){return this.ownerDocument.createElementNS(this.namespaceURI,name)}}d3_selectionPrototype.insert=function(name,before){name=d3_selection_creator(name);before=d3_selection_selector(before);return this.select(function(){return this.insertBefore(name.apply(this,arguments),before.apply(this,arguments)||null)})};d3_selectionPrototype.remove=function(){return this.each(function(){var parent=this.parentNode;if(parent)parent.removeChild(this)})};d3_selectionPrototype.data=function(value,key){var i=-1,n=this.length,group,node;if(!arguments.length){value=new Array(n=(group=this[0]).length);while(++i<n){if(node=group[i]){value[i]=node.__data__}}return value}function bind(group,groupData){var i,n=group.length,m=groupData.length,n0=Math.min(n,m),updateNodes=new Array(m),enterNodes=new Array(m),exitNodes=new Array(n),node,nodeData;if(key){var nodeByKeyValue=new d3_Map,dataByKeyValue=new d3_Map,keyValues=[],keyValue;for(i=-1;++i<n;){keyValue=key.call(node=group[i],node.__data__,i);if(nodeByKeyValue.has(keyValue)){exitNodes[i]=node}else{nodeByKeyValue.set(keyValue,node)}keyValues.push(keyValue)}for(i=-1;++i<m;){keyValue=key.call(groupData,nodeData=groupData[i],i);if(node=nodeByKeyValue.get(keyValue)){updateNodes[i]=node;node.__data__=nodeData}else if(!dataByKeyValue.has(keyValue)){enterNodes[i]=d3_selection_dataNode(nodeData)}dataByKeyValue.set(keyValue,nodeData);nodeByKeyValue.remove(keyValue)}for(i=-1;++i<n;){if(nodeByKeyValue.has(keyValues[i])){exitNodes[i]=group[i]}}}else{for(i=-1;++i<n0;){node=group[i];nodeData=groupData[i];if(node){node.__data__=nodeData;updateNodes[i]=node}else{enterNodes[i]=d3_selection_dataNode(nodeData)}}for(;i<m;++i){enterNodes[i]=d3_selection_dataNode(groupData[i])}for(;i<n;++i){exitNodes[i]=group[i]}}enterNodes.update=updateNodes;enterNodes.parentNode=updateNodes.parentNode=exitNodes.parentNode=group.parentNode;enter.push(enterNodes);update.push(updateNodes);exit.push(exitNodes)}var enter=d3_selection_enter([]),update=d3_selection([]),exit=d3_selection([]);if(typeof value==="function"){while(++i<n){bind(group=this[i],value.call(group,group.parentNode.__data__,i))}}else{while(++i<n){bind(group=this[i],value)}}update.enter=function(){return enter};update.exit=function(){return exit};return update};function d3_selection_dataNode(data){return{__data__:data}}d3_selectionPrototype.datum=function(value){return arguments.length?this.property("__data__",value):this.property("__data__")};d3_selectionPrototype.filter=function(filter){var subgroups=[],subgroup,group,node;if(typeof filter!=="function")filter=d3_selection_filter(filter);for(var j=0,m=this.length;j<m;j++){subgroups.push(subgroup=[]);subgroup.parentNode=(group=this[j]).parentNode;for(var i=0,n=group.length;i<n;i++){if((node=group[i])&&filter.call(node,node.__data__,i,j)){subgroup.push(node)}}}return d3_selection(subgroups)};function d3_selection_filter(selector){return function(){return d3_selectMatches(this,selector)}}d3_selectionPrototype.order=function(){for(var j=-1,m=this.length;++j<m;){for(var group=this[j],i=group.length-1,next=group[i],node;--i>=0;){if(node=group[i]){if(next&&next!==node.nextSibling)next.parentNode.insertBefore(node,next);next=node}}}return this};d3_selectionPrototype.sort=function(comparator){comparator=d3_selection_sortComparator.apply(this,arguments);for(var j=-1,m=this.length;++j<m;)this[j].sort(comparator);return this.order()};function d3_selection_sortComparator(comparator){if(!arguments.length)comparator=d3.ascending;return function(a,b){return a&&b?comparator(a.__data__,b.__data__):!a-!b}}d3_selectionPrototype.each=function(callback){return d3_selection_each(this,function(node,i,j){callback.call(node,node.__data__,i,j)})};function d3_selection_each(groups,callback){for(var j=0,m=groups.length;j<m;j++){for(var group=groups[j],i=0,n=group.length,node;i<n;i++){if(node=group[i])callback(node,i,j)}}return groups}d3_selectionPrototype.call=function(callback){var args=d3_array(arguments);callback.apply(args[0]=this,args);return this};d3_selectionPrototype.empty=function(){return!this.node()};d3_selectionPrototype.node=function(){for(var j=0,m=this.length;j<m;j++){for(var group=this[j],i=0,n=group.length;i<n;i++){var node=group[i];if(node)return node}}return null};d3_selectionPrototype.size=function(){var n=0;this.each(function(){++n});return n};function d3_selection_enter(selection){d3_subclass(selection,d3_selection_enterPrototype);return selection}var d3_selection_enterPrototype=[];d3.selection.enter=d3_selection_enter;d3.selection.enter.prototype=d3_selection_enterPrototype;d3_selection_enterPrototype.append=d3_selectionPrototype.append;d3_selection_enterPrototype.empty=d3_selectionPrototype.empty;d3_selection_enterPrototype.node=d3_selectionPrototype.node;d3_selection_enterPrototype.call=d3_selectionPrototype.call;d3_selection_enterPrototype.size=d3_selectionPrototype.size;d3_selection_enterPrototype.select=function(selector){var subgroups=[],subgroup,subnode,upgroup,group,node;for(var j=-1,m=this.length;++j<m;){upgroup=(group=this[j]).update;subgroups.push(subgroup=[]);subgroup.parentNode=group.parentNode;for(var i=-1,n=group.length;++i<n;){if(node=group[i]){subgroup.push(upgroup[i]=subnode=selector.call(group.parentNode,node.__data__,i,j));subnode.__data__=node.__data__}else{subgroup.push(null)}}}return d3_selection(subgroups)};d3_selection_enterPrototype.insert=function(name,before){if(arguments.length<2)before=d3_selection_enterInsertBefore(this);return d3_selectionPrototype.insert.call(this,name,before)};function d3_selection_enterInsertBefore(enter){var i0,j0;return function(d,i,j){var group=enter[j].update,n=group.length,node;if(j!=j0)j0=j,i0=0;if(i>=i0)i0=i+1;while(!(node=group[i0])&&++i0<n);return node}}d3_selectionPrototype.transition=function(){var id=d3_transitionInheritId||++d3_transitionId,subgroups=[],subgroup,node,transition=d3_transitionInherit||{time:Date.now(),ease:d3_ease_cubicInOut,delay:0,duration:250};for(var j=-1,m=this.length;++j<m;){subgroups.push(subgroup=[]);for(var group=this[j],i=-1,n=group.length;++i<n;){if(node=group[i])d3_transitionNode(node,i,id,transition);subgroup.push(node)}}return d3_transition(subgroups,id)};d3_selectionPrototype.interrupt=function(){return this.each(d3_selection_interrupt)};function d3_selection_interrupt(){var lock=this.__transition__;if(lock)++lock.active}d3.select=function(node){var group=[typeof node==="string"?d3_select(node,d3_document):node];group.parentNode=d3_documentElement;return d3_selection([group])};d3.selectAll=function(nodes){var group=d3_array(typeof nodes==="string"?d3_selectAll(nodes,d3_document):nodes);group.parentNode=d3_documentElement;return d3_selection([group])};var d3_selectionRoot=d3.select(d3_documentElement);d3_selectionPrototype.on=function(type,listener,capture){var n=arguments.length;if(n<3){if(typeof type!=="string"){if(n<2)listener=false;for(capture in type)this.each(d3_selection_on(capture,type[capture],listener));return this}if(n<2)return(n=this.node()["__on"+type])&&n._;capture=false}return this.each(d3_selection_on(type,listener,capture))};function d3_selection_on(type,listener,capture){var name="__on"+type,i=type.indexOf("."),wrap=d3_selection_onListener;if(i>0)type=type.substring(0,i);var filter=d3_selection_onFilters.get(type);if(filter)type=filter,wrap=d3_selection_onFilter;function onRemove(){var l=this[name];if(l){this.removeEventListener(type,l,l.$);delete this[name]}}function onAdd(){var l=wrap(listener,d3_array(arguments));onRemove.call(this);this.addEventListener(type,this[name]=l,l.$=capture);l._=listener}function removeAll(){var re=new RegExp("^__on([^.]+)"+d3.requote(type)+"$"),match;for(var name in this){if(match=name.match(re)){var l=this[name];this.removeEventListener(match[1],l,l.$);delete this[name]}}}return i?listener?onAdd:onRemove:listener?d3_noop:removeAll}var d3_selection_onFilters=d3.map({mouseenter:"mouseover",mouseleave:"mouseout"});d3_selection_onFilters.forEach(function(k){if("on"+k in d3_document)d3_selection_onFilters.remove(k)});function d3_selection_onListener(listener,argumentz){return function(e){var o=d3.event;d3.event=e;argumentz[0]=this.__data__;try{listener.apply(this,argumentz)}finally{d3.event=o}}}function d3_selection_onFilter(listener,argumentz){var l=d3_selection_onListener(listener,argumentz);return function(e){var target=this,related=e.relatedTarget;if(!related||related!==target&&!(related.compareDocumentPosition(target)&8)){l.call(target,e)}}}var d3_event_dragSelect="onselectstart"in d3_document?null:d3_vendorSymbol(d3_documentElement.style,"userSelect"),d3_event_dragId=0;function d3_event_dragSuppress(){var name=".dragsuppress-"+ ++d3_event_dragId,click="click"+name,w=d3.select(d3_window).on("touchmove"+name,d3_eventPreventDefault).on("dragstart"+name,d3_eventPreventDefault).on("selectstart"+name,d3_eventPreventDefault);if(d3_event_dragSelect){var style=d3_documentElement.style,select=style[d3_event_dragSelect];style[d3_event_dragSelect]="none"}return function(suppressClick){w.on(name,null);if(d3_event_dragSelect)style[d3_event_dragSelect]=select;if(suppressClick){function off(){w.on(click,null)}w.on(click,function(){d3_eventPreventDefault();off()},true);setTimeout(off,0)}}}d3.mouse=function(container){return d3_mousePoint(container,d3_eventSource())};var d3_mouse_bug44083=/WebKit/.test(d3_window.navigator.userAgent)?-1:0;function d3_mousePoint(container,e){if(e.changedTouches)e=e.changedTouches[0];var svg=container.ownerSVGElement||container;if(svg.createSVGPoint){var point=svg.createSVGPoint();if(d3_mouse_bug44083<0&&(d3_window.scrollX||d3_window.scrollY)){svg=d3.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important");var ctm=svg[0][0].getScreenCTM();d3_mouse_bug44083=!(ctm.f||ctm.e);svg.remove()}if(d3_mouse_bug44083)point.x=e.pageX,point.y=e.pageY;else point.x=e.clientX,point.y=e.clientY;point=point.matrixTransform(container.getScreenCTM().inverse());return[point.x,point.y]}var rect=container.getBoundingClientRect();return[e.clientX-rect.left-container.clientLeft,e.clientY-rect.top-container.clientTop]}d3.touches=function(container,touches){if(arguments.length<2)touches=d3_eventSource().touches;return touches?d3_array(touches).map(function(touch){var point=d3_mousePoint(container,touch);point.identifier=touch.identifier;return point}):[]};d3.behavior.drag=function(){var event=d3_eventDispatch(drag,"drag","dragstart","dragend"),origin=null,mousedown=dragstart(d3_noop,d3.mouse,"mousemove","mouseup"),touchstart=dragstart(touchid,touchposition,"touchmove","touchend");function drag(){this.on("mousedown.drag",mousedown).on("touchstart.drag",touchstart)}function touchid(){return d3.event.changedTouches[0].identifier}function touchposition(parent,id){return d3.touches(parent).filter(function(p){return p.identifier===id})[0]}function dragstart(id,position,move,end){return function(){var target=this,parent=target.parentNode,event_=event.of(target,arguments),eventTarget=d3.event.target,eventId=id(),drag=eventId==null?"drag":"drag-"+eventId,origin_=position(parent,eventId),dragged=0,offset,w=d3.select(d3_window).on(move+"."+drag,moved).on(end+"."+drag,ended),dragRestore=d3_event_dragSuppress();if(origin){offset=origin.apply(target,arguments);offset=[offset.x-origin_[0],offset.y-origin_[1]]}else{offset=[0,0]}event_({type:"dragstart"});function moved(){var p=position(parent,eventId),dx=p[0]-origin_[0],dy=p[1]-origin_[1];dragged|=dx|dy;origin_=p;event_({type:"drag",x:p[0]+offset[0],y:p[1]+offset[1],dx:dx,dy:dy})}function ended(){w.on(move+"."+drag,null).on(end+"."+drag,null);dragRestore(dragged&&d3.event.target===eventTarget);event_({type:"dragend"})}}}drag.origin=function(x){if(!arguments.length)return origin;origin=x;return drag};return d3.rebind(drag,event,"on")};var =Math.PI,=2*,half=/2,=1e-6,2=*,d3_radians=/180,d3_degrees=180/;function d3_sgn(x){return x>0?1:x<0?-1:0}function d3_acos(x){return x>1?0:x<-1?:Math.acos(x)}function d3_asin(x){return x>1?half:x<-1?-half:Math.asin(x)}function d3_sinh(x){return((x=Math.exp(x))-1/x)/2}function d3_cosh(x){return((x=Math.exp(x))+1/x)/2}function d3_tanh(x){return((x=Math.exp(2*x))-1)/(x+1)}function d3_haversin(x){return(x=Math.sin(x/2))*x}var =Math.SQRT2,2=2,4=4;d3.interpolateZoom=function(p0,p1){var ux0=p0[0],uy0=p0[1],w0=p0[2],ux1=p1[0],uy1=p1[1],w1=p1[2];var dx=ux1-ux0,dy=uy1-uy0,d2=dx*dx+dy*dy,d1=Math.sqrt(d2),b0=(w1*w1-w0*w0+4*d2)/(2*w0*2*d1),b1=(w1*w1-w0*w0-4*d2)/(2*w1*2*d1),r0=Math.log(Math.sqrt(b0*b0+1)-b0),r1=Math.log(Math.sqrt(b1*b1+1)-b1),dr=r1-r0,S=(dr||Math.log(w1/w0))/;function interpolate(t){var s=t*S;if(dr){var coshr0=d3_cosh(r0),u=w0/(2*d1)*(coshr0*d3_tanh(*s+r0)-d3_sinh(r0));return[ux0+u*dx,uy0+u*dy,w0*coshr0/d3_cosh(*s+r0)]}return[ux0+t*dx,uy0+t*dy,w0*Math.exp(*s)]}interpolate.duration=S*1e3;return interpolate};d3.behavior.zoom=function(){var view={x:0,y:0,k:1},translate0,center,size=[960,500],scaleExtent=d3_behavior_zoomInfinity,mousedown="mousedown.zoom",mousemove="mousemove.zoom",mouseup="mouseup.zoom",mousewheelTimer,touchstart="touchstart.zoom",touchtime,event=d3_eventDispatch(zoom,"zoomstart","zoom","zoomend"),x0,x1,y0,y1;function zoom(g){g.on(mousedown,mousedowned).on(d3_behavior_zoomWheel+".zoom",mousewheeled).on(mousemove,mousewheelreset).on("dblclick.zoom",dblclicked).on(touchstart,touchstarted)}zoom.event=function(g){g.each(function(){var event_=event.of(this,arguments),view1=view;if(d3_transitionInheritId){d3.select(this).transition().each("start.zoom",function(){view=this.__chart__||{x:0,y:0,k:1};zoomstarted(event_)}).tween("zoom:zoom",function(){var dx=size[0],dy=size[1],cx=dx/2,cy=dy/2,i=d3.interpolateZoom([(cx-view.x)/view.k,(cy-view.y)/view.k,dx/view.k],[(cx-view1.x)/view1.k,(cy-view1.y)/view1.k,dx/view1.k]);return function(t){var l=i(t),k=dx/l[2];this.__chart__=view={x:cx-l[0]*k,y:cy-l[1]*k,k:k};zoomed(event_)}}).each("end.zoom",function(){zoomended(event_)})}else{this.__chart__=view;zoomstarted(event_);zoomed(event_);zoomended(event_)}})};zoom.translate=function(_){if(!arguments.length)return[view.x,view.y];view={x:+_[0],y:+_[1],k:view.k};rescale();return zoom};zoom.scale=function(_){if(!arguments.length)return view.k;view={x:view.x,y:view.y,k:+_};rescale();return zoom};zoom.scaleExtent=function(_){if(!arguments.length)return scaleExtent;scaleExtent=_==null?d3_behavior_zoomInfinity:[+_[0],+_[1]];return zoom};zoom.center=function(_){if(!arguments.length)return center;center=_&&[+_[0],+_[1]];return zoom};zoom.size=function(_){if(!arguments.length)return size;size=_&&[+_[0],+_[1]];return zoom};zoom.x=function(z){if(!arguments.length)return x1;x1=z;x0=z.copy();view={x:0,y:0,k:1};return zoom};zoom.y=function(z){if(!arguments.length)return y1;y1=z;y0=z.copy();view={x:0,y:0,k:1};return zoom};function location(p){return[(p[0]-view.x)/view.k,(p[1]-view.y)/view.k]}function point(l){return[l[0]*view.k+view.x,l[1]*view.k+view.y]}function scaleTo(s){view.k=Math.max(scaleExtent[0],Math.min(scaleExtent[1],s))}function translateTo(p,l){l=point(l);view.x+=p[0]-l[0];view.y+=p[1]-l[1]}function rescale(){if(x1)x1.domain(x0.range().map(function(x){return(x-view.x)/view.k}).map(x0.invert));if(y1)y1.domain(y0.range().map(function(y){return(y-view.y)/view.k}).map(y0.invert))}function zoomstarted(event){event({type:"zoomstart"})}function zoomed(event){rescale();event({type:"zoom",scale:view.k,translate:[view.x,view.y]})}function zoomended(event){event({type:"zoomend"})}function mousedowned(){var target=this,event_=event.of(target,arguments),eventTarget=d3.event.target,dragged=0,w=d3.select(d3_window).on(mousemove,moved).on(mouseup,ended),l=location(d3.mouse(target)),dragRestore=d3_event_dragSuppress();d3_selection_interrupt.call(target);zoomstarted(event_);function moved(){dragged=1;translateTo(d3.mouse(target),l);zoomed(event_)}function ended(){w.on(mousemove,d3_window===target?mousewheelreset:null).on(mouseup,null);dragRestore(dragged&&d3.event.target===eventTarget);zoomended(event_)}}function touchstarted(){var target=this,event_=event.of(target,arguments),locations0={},distance0=0,scale0,eventId=d3.event.changedTouches[0].identifier,touchmove="touchmove.zoom-"+eventId,touchend="touchend.zoom-"+eventId,w=d3.select(d3_window).on(touchmove,moved).on(touchend,ended),t=d3.select(target).on(mousedown,null).on(touchstart,started),dragRestore=d3_event_dragSuppress();d3_selection_interrupt.call(target);started();zoomstarted(event_);function relocate(){var touches=d3.touches(target);scale0=view.k;touches.forEach(function(t){if(t.identifier in locations0)locations0[t.identifier]=location(t)});return touches}function started(){var changed=d3.event.changedTouches;for(var i=0,n=changed.length;i<n;++i){locations0[changed[i].identifier]=null}var touches=relocate(),now=Date.now();if(touches.length===1){if(now-touchtime<500){var p=touches[0],l=locations0[p.identifier];scaleTo(view.k*2);translateTo(p,l);d3_eventPreventDefault();zoomed(event_)}touchtime=now}else if(touches.length>1){var p=touches[0],q=touches[1],dx=p[0]-q[0],dy=p[1]-q[1];distance0=dx*dx+dy*dy}}function moved(){var touches=d3.touches(target),p0,l0,p1,l1;for(var i=0,n=touches.length;i<n;++i,l1=null){p1=touches[i];if(l1=locations0[p1.identifier]){if(l0)break;p0=p1,l0=l1}}if(l1){var distance1=(distance1=p1[0]-p0[0])*distance1+(distance1=p1[1]-p0[1])*distance1,scale1=distance0&&Math.sqrt(distance1/distance0);p0=[(p0[0]+p1[0])/2,(p0[1]+p1[1])/2];l0=[(l0[0]+l1[0])/2,(l0[1]+l1[1])/2];scaleTo(scale1*scale0)}touchtime=null;translateTo(p0,l0);zoomed(event_)}function ended(){if(d3.event.touches.length){var changed=d3.event.changedTouches;for(var i=0,n=changed.length;i<n;++i){delete locations0[changed[i].identifier]}for(var identifier in locations0){return void relocate()}}w.on(touchmove,null).on(touchend,null);t.on(mousedown,mousedowned).on(touchstart,touchstarted);dragRestore();zoomended(event_)}}function mousewheeled(){var event_=event.of(this,arguments);if(mousewheelTimer)clearTimeout(mousewheelTimer);else d3_selection_interrupt.call(this),zoomstarted(event_);mousewheelTimer=setTimeout(function(){mousewheelTimer=null;zoomended(event_)},50);d3_eventPreventDefault();var point=center||d3.mouse(this);if(!translate0)translate0=location(point);scaleTo(Math.pow(2,d3_behavior_zoomDelta()*.002)*view.k);translateTo(point,translate0);zoomed(event_)}function mousewheelreset(){translate0=null}function dblclicked(){var event_=event.of(this,arguments),p=d3.mouse(this),l=location(p),k=Math.log(view.k)/Math.LN2;zoomstarted(event_);scaleTo(Math.pow(2,d3.event.shiftKey?Math.ceil(k)-1:Math.floor(k)+1));translateTo(p,l);zoomed(event_);zoomended(event_)}return d3.rebind(zoom,event,"on")};var d3_behavior_zoomInfinity=[0,Infinity];var d3_behavior_zoomDelta,d3_behavior_zoomWheel="onwheel"in d3_document?(d3_behavior_zoomDelta=function(){return-d3.event.deltaY*(d3.event.deltaMode?120:1)},"wheel"):"onmousewheel"in d3_document?(d3_behavior_zoomDelta=function(){return d3.event.wheelDelta},"mousewheel"):(d3_behavior_zoomDelta=function(){return-d3.event.detail},"MozMousePixelScroll");function d3_Color(){}d3_Color.prototype.toString=function(){return this.rgb()+""};d3.hsl=function(h,s,l){return arguments.length===1?h instanceof d3_Hsl?d3_hsl(h.h,h.s,h.l):d3_rgb_parse(""+h,d3_rgb_hsl,d3_hsl):d3_hsl(+h,+s,+l)};function d3_hsl(h,s,l){return new d3_Hsl(h,s,l)}function d3_Hsl(h,s,l){this.h=h;this.s=s;this.l=l}var d3_hslPrototype=d3_Hsl.prototype=new d3_Color;d3_hslPrototype.brighter=function(k){k=Math.pow(.7,arguments.length?k:1);return d3_hsl(this.h,this.s,this.l/k)};d3_hslPrototype.darker=function(k){k=Math.pow(.7,arguments.length?k:1);return d3_hsl(this.h,this.s,k*this.l)};d3_hslPrototype.rgb=function(){return d3_hsl_rgb(this.h,this.s,this.l)};function d3_hsl_rgb(h,s,l){var m1,m2;h=isNaN(h)?0:(h%=360)<0?h+360:h;s=isNaN(s)?0:s<0?0:s>1?1:s;l=l<0?0:l>1?1:l;m2=l<=.5?l*(1+s):l+s-l*s;m1=2*l-m2;function v(h){if(h>360)h-=360;else if(h<0)h+=360;if(h<60)return m1+(m2-m1)*h/60;if(h<180)return m2;if(h<240)return m1+(m2-m1)*(240-h)/60;return m1}function vv(h){return Math.round(v(h)*255)}return d3_rgb(vv(h+120),vv(h),vv(h-120))}d3.hcl=function(h,c,l){return arguments.length===1?h instanceof d3_Hcl?d3_hcl(h.h,h.c,h.l):h instanceof d3_Lab?d3_lab_hcl(h.l,h.a,h.b):d3_lab_hcl((h=d3_rgb_lab((h=d3.rgb(h)).r,h.g,h.b)).l,h.a,h.b):d3_hcl(+h,+c,+l)};function d3_hcl(h,c,l){return new d3_Hcl(h,c,l)}function d3_Hcl(h,c,l){this.h=h;this.c=c;this.l=l}var d3_hclPrototype=d3_Hcl.prototype=new d3_Color;d3_hclPrototype.brighter=function(k){return d3_hcl(this.h,this.c,Math.min(100,this.l+d3_lab_K*(arguments.length?k:1)))};d3_hclPrototype.darker=function(k){return d3_hcl(this.h,this.c,Math.max(0,this.l-d3_lab_K*(arguments.length?k:1)))};d3_hclPrototype.rgb=function(){return d3_hcl_lab(this.h,this.c,this.l).rgb()};function d3_hcl_lab(h,c,l){if(isNaN(h))h=0;if(isNaN(c))c=0;return d3_lab(l,Math.cos(h*=d3_radians)*c,Math.sin(h)*c)}d3.lab=function(l,a,b){return arguments.length===1?l instanceof d3_Lab?d3_lab(l.l,l.a,l.b):l instanceof d3_Hcl?d3_hcl_lab(l.l,l.c,l.h):d3_rgb_lab((l=d3.rgb(l)).r,l.g,l.b):d3_lab(+l,+a,+b)};function d3_lab(l,a,b){return new d3_Lab(l,a,b)}function d3_Lab(l,a,b){this.l=l;this.a=a;this.b=b}var d3_lab_K=18;var d3_lab_X=.95047,d3_lab_Y=1,d3_lab_Z=1.08883;var d3_labPrototype=d3_Lab.prototype=new d3_Color;d3_labPrototype.brighter=function(k){return d3_lab(Math.min(100,this.l+d3_lab_K*(arguments.length?k:1)),this.a,this.b)};d3_labPrototype.darker=function(k){return d3_lab(Math.max(0,this.l-d3_lab_K*(arguments.length?k:1)),this.a,this.b)};d3_labPrototype.rgb=function(){return d3_lab_rgb(this.l,this.a,this.b)};function d3_lab_rgb(l,a,b){var y=(l+16)/116,x=y+a/500,z=y-b/200;x=d3_lab_xyz(x)*d3_lab_X;y=d3_lab_xyz(y)*d3_lab_Y;z=d3_lab_xyz(z)*d3_lab_Z;return d3_rgb(d3_xyz_rgb(3.2404542*x-1.5371385*y-.4985314*z),d3_xyz_rgb(-.969266*x+1.8760108*y+.041556*z),d3_xyz_rgb(.0556434*x-.2040259*y+1.0572252*z))}function d3_lab_hcl(l,a,b){return l>0?d3_hcl(Math.atan2(b,a)*d3_degrees,Math.sqrt(a*a+b*b),l):d3_hcl(NaN,NaN,l)}function d3_lab_xyz(x){return x>.206893034?x*x*x:(x-4/29)/7.787037}function d3_xyz_lab(x){return x>.008856?Math.pow(x,1/3):7.787037*x+4/29}function d3_xyz_rgb(r){return Math.round(255*(r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055))}d3.rgb=function(r,g,b){return arguments.length===1?r instanceof d3_Rgb?d3_rgb(r.r,r.g,r.b):d3_rgb_parse(""+r,d3_rgb,d3_hsl_rgb):d3_rgb(~~r,~~g,~~b)};function d3_rgbNumber(value){return d3_rgb(value>>16,value>>8&255,value&255)}function d3_rgbString(value){return d3_rgbNumber(value)+""}function d3_rgb(r,g,b){return new d3_Rgb(r,g,b)}function d3_Rgb(r,g,b){this.r=r;this.g=g;this.b=b}var d3_rgbPrototype=d3_Rgb.prototype=new d3_Color;d3_rgbPrototype.brighter=function(k){k=Math.pow(.7,arguments.length?k:1);var r=this.r,g=this.g,b=this.b,i=30;if(!r&&!g&&!b)return d3_rgb(i,i,i);if(r&&r<i)r=i;if(g&&g<i)g=i;if(b&&b<i)b=i;return d3_rgb(Math.min(255,~~(r/k)),Math.min(255,~~(g/k)),Math.min(255,~~(b/k)))};d3_rgbPrototype.darker=function(k){k=Math.pow(.7,arguments.length?k:1);return d3_rgb(~~(k*this.r),~~(k*this.g),~~(k*this.b))};d3_rgbPrototype.hsl=function(){return d3_rgb_hsl(this.r,this.g,this.b)};d3_rgbPrototype.toString=function(){return"#"+d3_rgb_hex(this.r)+d3_rgb_hex(this.g)+d3_rgb_hex(this.b)};function d3_rgb_hex(v){return v<16?"0"+Math.max(0,v).toString(16):Math.min(255,v).toString(16)}function d3_rgb_parse(format,rgb,hsl){var r=0,g=0,b=0,m1,m2,name;m1=/([a-z]+)\((.*)\)/i.exec(format);if(m1){m2=m1[2].split(",");switch(m1[1]){case"hsl":{return hsl(parseFloat(m2[0]),parseFloat(m2[1])/100,parseFloat(m2[2])/100)}case"rgb":{return rgb(d3_rgb_parseNumber(m2[0]),d3_rgb_parseNumber(m2[1]),d3_rgb_parseNumber(m2[2]))}}}if(name=d3_rgb_names.get(format))return rgb(name.r,name.g,name.b);if(format!=null&&format.charAt(0)==="#"){if(format.length===4){r=format.charAt(1);r+=r;g=format.charAt(2);g+=g;b=format.charAt(3);b+=b}else if(format.length===7){r=format.substring(1,3);g=format.substring(3,5);b=format.substring(5,7)}r=parseInt(r,16);g=parseInt(g,16);b=parseInt(b,16)}return rgb(r,g,b)}function d3_rgb_hsl(r,g,b){var min=Math.min(r/=255,g/=255,b/=255),max=Math.max(r,g,b),d=max-min,h,s,l=(max+min)/2;if(d){s=l<.5?d/(max+min):d/(2-max-min);if(r==max)h=(g-b)/d+(g<b?6:0);else if(g==max)h=(b-r)/d+2;else h=(r-g)/d+4;h*=60}else{h=NaN;s=l>0&&l<1?0:h}return d3_hsl(h,s,l)}function d3_rgb_lab(r,g,b){r=d3_rgb_xyz(r);g=d3_rgb_xyz(g);b=d3_rgb_xyz(b);var x=d3_xyz_lab((.4124564*r+.3575761*g+.1804375*b)/d3_lab_X),y=d3_xyz_lab((.2126729*r+.7151522*g+.072175*b)/d3_lab_Y),z=d3_xyz_lab((.0193339*r+.119192*g+.9503041*b)/d3_lab_Z);return d3_lab(116*y-16,500*(x-y),200*(y-z))}function d3_rgb_xyz(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function d3_rgb_parseNumber(c){var f=parseFloat(c);return c.charAt(c.length-1)==="%"?Math.round(f*2.55):f}var d3_rgb_names=d3.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});d3_rgb_names.forEach(function(key,value){d3_rgb_names.set(key,d3_rgbNumber(value))});function d3_functor(v){return typeof v==="function"?v:function(){return v}}d3.functor=d3_functor;function d3_identity(d){return d}d3.xhr=d3_xhrType(d3_identity);function d3_xhrType(response){return function(url,mimeType,callback){if(arguments.length===2&&typeof mimeType==="function")callback=mimeType,mimeType=null;return d3_xhr(url,mimeType,response,callback)}}function d3_xhr(url,mimeType,response,callback){var xhr={},dispatch=d3.dispatch("beforesend","progress","load","error"),headers={},request=new XMLHttpRequest,responseType=null;if(d3_window.XDomainRequest&&!("withCredentials"in request)&&/^(http(s)?:)?\/\//.test(url))request=new XDomainRequest;"onload"in request?request.onload=request.onerror=respond:request.onreadystatechange=function(){request.readyState>3&&respond()};function respond(){var status=request.status,result;if(!status&&request.responseText||status>=200&&status<300||status===304){try{result=response.call(xhr,request)}catch(e){dispatch.error.call(xhr,e);return}dispatch.load.call(xhr,result)}else{dispatch.error.call(xhr,request)}}request.onprogress=function(event){var o=d3.event;d3.event=event;try{dispatch.progress.call(xhr,request)}finally{d3.event=o}};xhr.header=function(name,value){name=(name+"").toLowerCase();if(arguments.length<2)return headers[name];if(value==null)delete headers[name];else headers[name]=value+"";return xhr};xhr.mimeType=function(value){if(!arguments.length)return mimeType;mimeType=value==null?null:value+"";return xhr};xhr.responseType=function(value){if(!arguments.length)return responseType;responseType=value;return xhr};xhr.response=function(value){response=value;return xhr};["get","post"].forEach(function(method){xhr[method]=function(){return xhr.send.apply(xhr,[method].concat(d3_array(arguments)))}});xhr.send=function(method,data,callback){if(arguments.length===2&&typeof data==="function")callback=data,data=null;request.open(method,url,true);if(mimeType!=null&&!("accept"in headers))headers["accept"]=mimeType+",*/*";if(request.setRequestHeader)for(var name in headers)request.setRequestHeader(name,headers[name]);if(mimeType!=null&&request.overrideMimeType)request.overrideMimeType(mimeType);if(responseType!=null)request.responseType=responseType;if(callback!=null)xhr.on("error",callback).on("load",function(request){callback(null,request)});dispatch.beforesend.call(xhr,request);request.send(data==null?null:data);return xhr};xhr.abort=function(){request.abort();return xhr};d3.rebind(xhr,dispatch,"on");return callback==null?xhr:xhr.get(d3_xhr_fixCallback(callback))}function d3_xhr_fixCallback(callback){return callback.length===1?function(error,request){callback(error==null?request:null)}:callback}d3.dsv=function(delimiter,mimeType){var reFormat=new RegExp('["'+delimiter+"\n]"),delimiterCode=delimiter.charCodeAt(0);function dsv(url,row,callback){if(arguments.length<3)callback=row,row=null;var xhr=d3.xhr(url,mimeType,callback);xhr.row=function(_){return arguments.length?xhr.response((row=_)==null?response:typedResponse(_)):row};return xhr.row(row)}function response(request){return dsv.parse(request.responseText)}function typedResponse(f){return function(request){return dsv.parse(request.responseText,f)}}dsv.parse=function(text,f){var o;return dsv.parseRows(text,function(row,i){if(o)return o(row,i-1);var a=new Function("d","return {"+row.map(function(name,i){return JSON.stringify(name)+": d["+i+"]"}).join(",")+"}");o=f?function(row,i){return f(a(row),i)}:a})};dsv.parseRows=function(text,f){var EOL={},EOF={},rows=[],N=text.length,I=0,n=0,t,eol;function token(){if(I>=N)return EOF;if(eol)return eol=false,EOL;var j=I;if(text.charCodeAt(j)===34){var i=j;while(i++<N){if(text.charCodeAt(i)===34){if(text.charCodeAt(i+1)!==34)break;++i}}I=i+2;var c=text.charCodeAt(i+1);if(c===13){eol=true;if(text.charCodeAt(i+2)===10)++I}else if(c===10){eol=true}return text.substring(j+1,i).replace(/""/g,'"')}while(I<N){var c=text.charCodeAt(I++),k=1;if(c===10)eol=true;else if(c===13){eol=true;if(text.charCodeAt(I)===10)++I,++k}else if(c!==delimiterCode)continue;return text.substring(j,I-k)}return text.substring(j)}while((t=token())!==EOF){var a=[];while(t!==EOL&&t!==EOF){a.push(t);t=token()}if(f&&!(a=f(a,n++)))continue;rows.push(a)}return rows};dsv.format=function(rows){if(Array.isArray(rows[0]))return dsv.formatRows(rows);var fieldSet=new d3_Set,fields=[];rows.forEach(function(row){for(var field in row){if(!fieldSet.has(field)){fields.push(fieldSet.add(field))}}});return[fields.map(formatValue).join(delimiter)].concat(rows.map(function(row){return fields.map(function(field){return formatValue(row[field])}).join(delimiter)})).join("\n")};dsv.formatRows=function(rows){return rows.map(formatRow).join("\n")};function formatRow(row){return row.map(formatValue).join(delimiter)}function formatValue(text){return reFormat.test(text)?'"'+text.replace(/\"/g,'""')+'"':text}return dsv};d3.csv=d3.dsv(",","text/csv");d3.tsv=d3.dsv("\t","text/tab-separated-values");var d3_timer_queueHead,d3_timer_queueTail,d3_timer_interval,d3_timer_timeout,d3_timer_active,d3_timer_frame=d3_window[d3_vendorSymbol(d3_window,"requestAnimationFrame")]||function(callback){setTimeout(callback,17)};d3.timer=function(callback,delay,then){var n=arguments.length;if(n<2)delay=0;if(n<3)then=Date.now();var time=then+delay,timer={c:callback,t:time,f:false,n:null};if(d3_timer_queueTail)d3_timer_queueTail.n=timer;else d3_timer_queueHead=timer;d3_timer_queueTail=timer;if(!d3_timer_interval){d3_timer_timeout=clearTimeout(d3_timer_timeout);d3_timer_interval=1;d3_timer_frame(d3_timer_step)}};function d3_timer_step(){var now=d3_timer_mark(),delay=d3_timer_sweep()-now;if(delay>24){if(isFinite(delay)){clearTimeout(d3_timer_timeout);d3_timer_timeout=setTimeout(d3_timer_step,delay)}d3_timer_interval=0}else{d3_timer_interval=1;d3_timer_frame(d3_timer_step)}}d3.timer.flush=function(){d3_timer_mark();d3_timer_sweep()};function d3_timer_mark(){var now=Date.now();d3_timer_active=d3_timer_queueHead;while(d3_timer_active){if(now>=d3_timer_active.t)d3_timer_active.f=d3_timer_active.c(now-d3_timer_active.t);d3_timer_active=d3_timer_active.n}return now}function d3_timer_sweep(){var t0,t1=d3_timer_queueHead,time=Infinity;while(t1){if(t1.f){t1=t0?t0.n=t1.n:d3_timer_queueHead=t1.n}else{if(t1.t<time)time=t1.t;t1=(t0=t1).n}}d3_timer_queueTail=t0;return time}var d3_format_decimalPoint=".",d3_format_thousandsSeparator=",",d3_format_grouping=[3,3],d3_format_currencySymbol="$";var d3_formatPrefixes=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"].map(d3_formatPrefix);d3.formatPrefix=function(value,precision){var i=0;if(value){if(value<0)value*=-1;if(precision)value=d3.round(value,d3_format_precision(value,precision));i=1+Math.floor(1e-12+Math.log(value)/Math.LN10);i=Math.max(-24,Math.min(24,Math.floor((i<=0?i+1:i-1)/3)*3))}return d3_formatPrefixes[8+i/3]};function d3_formatPrefix(d,i){var k=Math.pow(10,abs(8-i)*3);return{scale:i>8?function(d){return d/k}:function(d){return d*k},symbol:d}}d3.round=function(x,n){return n?Math.round(x*(n=Math.pow(10,n)))/n:Math.round(x)};d3.format=function(specifier){var match=d3_format_re.exec(specifier),fill=match[1]||" ",align=match[2]||">",sign=match[3]||"",symbol=match[4]||"",zfill=match[5],width=+match[6],comma=match[7],precision=match[8],type=match[9],scale=1,suffix="",integer=false;if(precision)precision=+precision.substring(1);if(zfill||fill==="0"&&align==="="){zfill=fill="0";align="=";if(comma)width-=Math.floor((width-1)/4)}switch(type){case"n":comma=true;type="g";break;case"%":scale=100;suffix="%";type="f";break;case"p":scale=100;suffix="%";type="r";break;case"b":case"o":case"x":case"X":if(symbol==="#")symbol="0"+type.toLowerCase();case"c":case"d":integer=true;precision=0;break;case"s":scale=-1;type="r";break}if(symbol==="#")symbol="";else if(symbol==="$")symbol=d3_format_currencySymbol;if(type=="r"&&!precision)type="g";if(precision!=null){if(type=="g")precision=Math.max(1,Math.min(21,precision));else if(type=="e"||type=="f")precision=Math.max(0,Math.min(20,precision))}type=d3_format_types.get(type)||d3_format_typeDefault;var zcomma=zfill&&comma;return function(value){if(integer&&value%1)return"";var negative=value<0||value===0&&1/value<0?(value=-value,"-"):sign;if(scale<0){var prefix=d3.formatPrefix(value,precision);value=prefix.scale(value);suffix=prefix.symbol}else{value*=scale}value=type(value,precision);var i=value.lastIndexOf("."),before=i<0?value:value.substring(0,i),after=i<0?"":d3_format_decimalPoint+value.substring(i+1);if(!zfill&&comma)before=d3_format_group(before);var length=symbol.length+before.length+after.length+(zcomma?0:negative.length),padding=length<width?new Array(length=width-length+1).join(fill):"";if(zcomma)before=d3_format_group(padding+before);negative+=symbol;value=before+after;return(align==="<"?negative+value+padding:align===">"?padding+negative+value:align==="^"?padding.substring(0,length>>=1)+negative+value+padding.substring(length):negative+(zcomma?value:padding+value))+suffix}};var d3_format_re=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i;var d3_format_types=d3.map({b:function(x){return x.toString(2)},c:function(x){return String.fromCharCode(x)},o:function(x){return x.toString(8)},x:function(x){return x.toString(16)},X:function(x){return x.toString(16).toUpperCase()},g:function(x,p){return x.toPrecision(p)},e:function(x,p){return x.toExponential(p)},f:function(x,p){return x.toFixed(p)},r:function(x,p){return(x=d3.round(x,d3_format_precision(x,p))).toFixed(Math.max(0,Math.min(20,d3_format_precision(x*(1+1e-15),p))))}});function d3_format_precision(x,p){return p-(x?Math.ceil(Math.log(x)/Math.LN10):1)}function d3_format_typeDefault(x){return x+""}var d3_format_group=d3_identity;if(d3_format_grouping){var d3_format_groupingLength=d3_format_grouping.length;d3_format_group=function(value){var i=value.length,t=[],j=0,g=d3_format_grouping[0];while(i>0&&g>0){t.push(value.substring(i-=g,i+g));g=d3_format_grouping[j=(j+1)%d3_format_groupingLength]}return t.reverse().join(d3_format_thousandsSeparator)}}d3.geo={};function d3_adder(){}d3_adder.prototype={s:0,t:0,add:function(y){d3_adderSum(y,this.t,d3_adderTemp);d3_adderSum(d3_adderTemp.s,this.s,this);if(this.s)this.t+=d3_adderTemp.t;else this.s=d3_adderTemp.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var d3_adderTemp=new d3_adder;function d3_adderSum(a,b,o){var x=o.s=a+b,bv=x-a,av=x-bv;o.t=a-av+(b-bv)}d3.geo.stream=function(object,listener){if(object&&d3_geo_streamObjectType.hasOwnProperty(object.type)){d3_geo_streamObjectType[object.type](object,listener)}else{d3_geo_streamGeometry(object,listener)}};function d3_geo_streamGeometry(geometry,listener){if(geometry&&d3_geo_streamGeometryType.hasOwnProperty(geometry.type)){d3_geo_streamGeometryType[geometry.type](geometry,listener)}}var d3_geo_streamObjectType={Feature:function(feature,listener){d3_geo_streamGeometry(feature.geometry,listener)},FeatureCollection:function(object,listener){var features=object.features,i=-1,n=features.length;while(++i<n)d3_geo_streamGeometry(features[i].geometry,listener)}};var d3_geo_streamGeometryType={Sphere:function(object,listener){listener.sphere()},Point:function(object,listener){object=object.coordinates;listener.point(object[0],object[1],object[2])},MultiPoint:function(object,listener){var coordinates=object.coordinates,i=-1,n=coordinates.length;while(++i<n)object=coordinates[i],listener.point(object[0],object[1],object[2])},LineString:function(object,listener){d3_geo_streamLine(object.coordinates,listener,0)},MultiLineString:function(object,listener){var coordinates=object.coordinates,i=-1,n=coordinates.length;while(++i<n)d3_geo_streamLine(coordinates[i],listener,0)},Polygon:function(object,listener){d3_geo_streamPolygon(object.coordinates,listener)},MultiPolygon:function(object,listener){var coordinates=object.coordinates,i=-1,n=coordinates.length;while(++i<n)d3_geo_streamPolygon(coordinates[i],listener)},GeometryCollection:function(object,listener){var geometries=object.geometries,i=-1,n=geometries.length;while(++i<n)d3_geo_streamGeometry(geometries[i],listener)}};function d3_geo_streamLine(coordinates,listener,closed){var i=-1,n=coordinates.length-closed,coordinate;listener.lineStart();while(++i<n)coordinate=coordinates[i],listener.point(coordinate[0],coordinate[1],coordinate[2]);listener.lineEnd()}function d3_geo_streamPolygon(coordinates,listener){var i=-1,n=coordinates.length;listener.polygonStart();while(++i<n)d3_geo_streamLine(coordinates[i],listener,1);listener.polygonEnd()}d3.geo.area=function(object){d3_geo_areaSum=0;d3.geo.stream(object,d3_geo_area);return d3_geo_areaSum};var d3_geo_areaSum,d3_geo_areaRingSum=new d3_adder;var d3_geo_area={sphere:function(){d3_geo_areaSum+=4*},point:d3_noop,lineStart:d3_noop,lineEnd:d3_noop,polygonStart:function(){d3_geo_areaRingSum.reset();d3_geo_area.lineStart=d3_geo_areaRingStart},polygonEnd:function(){var area=2*d3_geo_areaRingSum;d3_geo_areaSum+=area<0?4*+area:area;d3_geo_area.lineStart=d3_geo_area.lineEnd=d3_geo_area.point=d3_noop}};function d3_geo_areaRingStart(){var 00,00,0,cos0,sin0;d3_geo_area.point=function(,){d3_geo_area.point=nextPoint;0=(00=)*d3_radians,cos0=Math.cos(=(00=)*d3_radians/2+/4),sin0=Math.sin()};function nextPoint(,){*=d3_radians;=*d3_radians/2+/4;var d=-0,cos=Math.cos(),sin=Math.sin(),k=sin0*sin,u=cos0*cos+k*Math.cos(d),v=k*Math.sin(d);d3_geo_areaRingSum.add(Math.atan2(v,u));0=,cos0=cos,sin0=sin}d3_geo_area.lineEnd=function(){nextPoint(00,00)}}function d3_geo_cartesian(spherical){var =spherical[0],=spherical[1],cos=Math.cos();return[cos*Math.cos(),cos*Math.sin(),Math.sin()]}function d3_geo_cartesianDot(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]}function d3_geo_cartesianCross(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]]}function d3_geo_cartesianAdd(a,b){a[0]+=b[0];a[1]+=b[1];a[2]+=b[2]}function d3_geo_cartesianScale(vector,k){return[vector[0]*k,vector[1]*k,vector[2]*k]}function d3_geo_cartesianNormalize(d){var l=Math.sqrt(d[0]*d[0]+d[1]*d[1]+d[2]*d[2]);d[0]/=l;d[1]/=l;d[2]/=l}function d3_geo_spherical(cartesian){return[Math.atan2(cartesian[1],cartesian[0]),d3_asin(cartesian[2])]}function d3_geo_sphericalEqual(a,b){return abs(a[0]-b[0])<&&abs(a[1]-b[1])<}d3.geo.bounds=function(){var 0,0,1,1,_,__,__,p0,dSum,ranges,range;var bound={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){bound.point=ringPoint;bound.lineStart=ringStart;bound.lineEnd=ringEnd;dSum=0;d3_geo_area.polygonStart()},polygonEnd:function(){d3_geo_area.polygonEnd();bound.point=point;bound.lineStart=lineStart;bound.lineEnd=lineEnd;if(d3_geo_areaRingSum<0)0=-(1=180),0=-(1=90);else if(dSum>)1=90;else if(dSum<-)0=-90;range[0]=0,range[1]=1}};function point(,){ranges.push(range=[0=,1=]);if(<0)0=;if(>1)1=}function linePoint(,){var p=d3_geo_cartesian([*d3_radians,*d3_radians]);if(p0){var normal=d3_geo_cartesianCross(p0,p),equatorial=[normal[1],-normal[0],0],inflection=d3_geo_cartesianCross(equatorial,normal);d3_geo_cartesianNormalize(inflection);inflection=d3_geo_spherical(inflection);var d=-_,s=d>0?1:-1,i=inflection[0]*d3_degrees*s,antimeridian=abs(d)>180;if(antimeridian^(s*_<i&&i<s*)){var i=inflection[1]*d3_degrees;if(i>1)1=i}else if(i=(i+360)%360-180,antimeridian^(s*_<i&&i<s*)){var i=-inflection[1]*d3_degrees;if(i<0)0=i}else{if(<0)0=;if(>1)1=}if(antimeridian){if(<_){if(angle(0,)>angle(0,1))1=}else{if(angle(,1)>angle(0,1))0=}}else{if(1>=0){if(<0)0=;if(>1)1=}else{if(>_){if(angle(0,)>angle(0,1))1=}else{if(angle(,1)>angle(0,1))0=}}}}else{point(,)}p0=p,_=}function lineStart(){bound.point=linePoint}function lineEnd(){range[0]=0,range[1]=1;bound.point=point;p0=null}function ringPoint(,){if(p0){var d=-_;dSum+=abs(d)>180?d+(d>0?360:-360):d}else __=,__=;d3_geo_area.point(,);linePoint(,)}function ringStart(){d3_geo_area.lineStart()}function ringEnd(){ringPoint(__,__);d3_geo_area.lineEnd();if(abs(dSum)>)0=-(1=180);range[0]=0,range[1]=1;p0=null}function angle(0,1){return(1-=0)<0?1+360:1}function compareRanges(a,b){return a[0]-b[0]}function withinRange(x,range){return range[0]<=range[1]?range[0]<=x&&x<=range[1]:x<range[0]||range[1]<x}return function(feature){1=1=-(0=0=Infinity);ranges=[];d3.geo.stream(feature,bound);var n=ranges.length;if(n){ranges.sort(compareRanges);for(var i=1,a=ranges[0],b,merged=[a];i<n;++i){b=ranges[i];if(withinRange(b[0],a)||withinRange(b[1],a)){if(angle(a[0],b[1])>angle(a[0],a[1]))a[1]=b[1];if(angle(b[0],a[1])>angle(a[0],a[1]))a[0]=b[0]}else{merged.push(a=b)}}var best=-Infinity,d;for(var n=merged.length-1,i=0,a=merged[n],b;i<=n;a=b,++i){b=merged[i];if((d=angle(a[1],b[0]))>best)best=d,0=b[0],1=a[1]}}ranges=range=null;return 0===Infinity||0===Infinity?[[NaN,NaN],[NaN,NaN]]:[[0,0],[1,1]]}}();d3.geo.centroid=function(object){d3_geo_centroidW0=d3_geo_centroidW1=d3_geo_centroidX0=d3_geo_centroidY0=d3_geo_centroidZ0=d3_geo_centroidX1=d3_geo_centroidY1=d3_geo_centroidZ1=d3_geo_centroidX2=d3_geo_centroidY2=d3_geo_centroidZ2=0;d3.geo.stream(object,d3_geo_centroid);var x=d3_geo_centroidX2,y=d3_geo_centroidY2,z=d3_geo_centroidZ2,m=x*x+y*y+z*z;if(m<2){x=d3_geo_centroidX1,y=d3_geo_centroidY1,z=d3_geo_centroidZ1;if(d3_geo_centroidW1<)x=d3_geo_centroidX0,y=d3_geo_centroidY0,z=d3_geo_centroidZ0;m=x*x+y*y+z*z;if(m<2)return[NaN,NaN]}return[Math.atan2(y,x)*d3_degrees,d3_asin(z/Math.sqrt(m))*d3_degrees]};var d3_geo_centroidW0,d3_geo_centroidW1,d3_geo_centroidX0,d3_geo_centroidY0,d3_geo_centroidZ0,d3_geo_centroidX1,d3_geo_centroidY1,d3_geo_centroidZ1,d3_geo_centroidX2,d3_geo_centroidY2,d3_geo_centroidZ2;var d3_geo_centroid={sphere:d3_noop,point:d3_geo_centroidPoint,lineStart:d3_geo_centroidLineStart,lineEnd:d3_geo_centroidLineEnd,polygonStart:function(){d3_geo_centroid.lineStart=d3_geo_centroidRingStart},polygonEnd:function(){d3_geo_centroid.lineStart=d3_geo_centroidLineStart}};function d3_geo_centroidPoint(,){*=d3_radians;var cos=Math.cos(*=d3_radians);d3_geo_centroidPointXYZ(cos*Math.cos(),cos*Math.sin(),Math.sin())}function d3_geo_centroidPointXYZ(x,y,z){++d3_geo_centroidW0;d3_geo_centroidX0+=(x-d3_geo_centroidX0)/d3_geo_centroidW0;d3_geo_centroidY0+=(y-d3_geo_centroidY0)/d3_geo_centroidW0;d3_geo_centroidZ0+=(z-d3_geo_centroidZ0)/d3_geo_centroidW0}function d3_geo_centroidLineStart(){var x0,y0,z0;d3_geo_centroid.point=function(,){*=d3_radians;var cos=Math.cos(*=d3_radians);x0=cos*Math.cos();y0=cos*Math.sin();z0=Math.sin();d3_geo_centroid.point=nextPoint;d3_geo_centroidPointXYZ(x0,y0,z0)};function nextPoint(,){*=d3_radians;var cos=Math.cos(*=d3_radians),x=cos*Math.cos(),y=cos*Math.sin(),z=Math.sin(),w=Math.atan2(Math.sqrt((w=y0*z-z0*y)*w+(w=z0*x-x0*z)*w+(w=x0*y-y0*x)*w),x0*x+y0*y+z0*z);d3_geo_centroidW1+=w;d3_geo_centroidX1+=w*(x0+(x0=x));d3_geo_centroidY1+=w*(y0+(y0=y));d3_geo_centroidZ1+=w*(z0+(z0=z));d3_geo_centroidPointXYZ(x0,y0,z0)}}function d3_geo_centroidLineEnd(){d3_geo_centroid.point=d3_geo_centroidPoint}function d3_geo_centroidRingStart(){var 00,00,x0,y0,z0;d3_geo_centroid.point=function(,){00=,00=;d3_geo_centroid.point=nextPoint;*=d3_radians;var cos=Math.cos(*=d3_radians);x0=cos*Math.cos();y0=cos*Math.sin();z0=Math.sin();d3_geo_centroidPointXYZ(x0,y0,z0)};d3_geo_centroid.lineEnd=function(){nextPoint(00,00);d3_geo_centroid.lineEnd=d3_geo_centroidLineEnd;d3_geo_centroid.point=d3_geo_centroidPoint};function nextPoint(,){*=d3_radians;var cos=Math.cos(*=d3_radians),x=cos*Math.cos(),y=cos*Math.sin(),z=Math.sin(),cx=y0*z-z0*y,cy=z0*x-x0*z,cz=x0*y-y0*x,m=Math.sqrt(cx*cx+cy*cy+cz*cz),u=x0*x+y0*y+z0*z,v=m&&-d3_acos(u)/m,w=Math.atan2(m,u);d3_geo_centroidX2+=v*cx;d3_geo_centroidY2+=v*cy;d3_geo_centroidZ2+=v*cz;d3_geo_centroidW1+=w;d3_geo_centroidX1+=w*(x0+(x0=x));d3_geo_centroidY1+=w*(y0+(y0=y));d3_geo_centroidZ1+=w*(z0+(z0=z));d3_geo_centroidPointXYZ(x0,y0,z0)}}function d3_true(){return true}function d3_geo_clipPolygon(segments,compare,clipStartInside,interpolate,listener){var subject=[],clip=[];segments.forEach(function(segment){if((n=segment.length-1)<=0)return;var n,p0=segment[0],p1=segment[n];if(d3_geo_sphericalEqual(p0,p1)){listener.lineStart();for(var i=0;i<n;++i)listener.point((p0=segment[i])[0],p0[1]);listener.lineEnd();return}var a=new d3_geo_clipPolygonIntersection(p0,segment,null,true),b=new d3_geo_clipPolygonIntersection(p0,null,a,false);a.o=b;subject.push(a);clip.push(b);a=new d3_geo_clipPolygonIntersection(p1,segment,null,false);b=new d3_geo_clipPolygonIntersection(p1,null,a,true);a.o=b;subject.push(a);clip.push(b)});clip.sort(compare);d3_geo_clipPolygonLinkCircular(subject);d3_geo_clipPolygonLinkCircular(clip);if(!subject.length)return;for(var i=0,entry=clipStartInside,n=clip.length;i<n;++i){clip[i].e=entry=!entry}var start=subject[0],points,point;while(1){var current=start,isSubject=true;while(current.v)if((current=current.n)===start)return;points=current.z;listener.lineStart();do{current.v=current.o.v=true;if(current.e){if(isSubject){for(var i=0,n=points.length;i<n;++i)listener.point((point=points[i])[0],point[1])}else{interpolate(current.x,current.n.x,1,listener)}current=current.n}else{if(isSubject){points=current.p.z;for(var i=points.length-1;i>=0;--i)listener.point((point=points[i])[0],point[1])}else{interpolate(current.x,current.p.x,-1,listener)}current=current.p}current=current.o;points=current.z;isSubject=!isSubject}while(!current.v);listener.lineEnd()}}function d3_geo_clipPolygonLinkCircular(array){if(!(n=array.length))return;var n,i=0,a=array[0],b;while(++i<n){a.n=b=array[i];b.p=a;a=b}a.n=b=array[0];b.p=a}function d3_geo_clipPolygonIntersection(point,points,other,entry){this.x=point;this.z=points;this.o=other;this.e=entry;this.v=false;this.n=this.p=null}function d3_geo_clip(pointVisible,clipLine,interpolate,clipStart){return function(rotate,listener){var line=clipLine(listener),rotatedClipStart=rotate.invert(clipStart[0],clipStart[1]);var clip={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){clip.point=pointRing;clip.lineStart=ringStart;clip.lineEnd=ringEnd;segments=[];polygon=[];listener.polygonStart()},polygonEnd:function(){clip.point=point;clip.lineStart=lineStart;clip.lineEnd=lineEnd;segments=d3.merge(segments);var clipStartInside=d3_geo_pointInPolygon(rotatedClipStart,polygon);if(segments.length){d3_geo_clipPolygon(segments,d3_geo_clipSort,clipStartInside,interpolate,listener)}else if(clipStartInside){listener.lineStart();interpolate(null,null,1,listener);listener.lineEnd()}listener.polygonEnd();segments=polygon=null},sphere:function(){listener.polygonStart();listener.lineStart();interpolate(null,null,1,listener);listener.lineEnd();listener.polygonEnd()}};function point(,){var point=rotate(,);if(pointVisible(=point[0],=point[1]))listener.point(,)}function pointLine(,){var point=rotate(,);line.point(point[0],point[1])}function lineStart(){clip.point=pointLine;line.lineStart()}function lineEnd(){clip.point=point;line.lineEnd()}var segments;var buffer=d3_geo_clipBufferListener(),ringListener=clipLine(buffer),polygon,ring;function pointRing(,){ring.push([,]);var point=rotate(,);ringListener.point(point[0],point[1])}function ringStart(){ringListener.lineStart();ring=[]}function ringEnd(){pointRing(ring[0][0],ring[0][1]);ringListener.lineEnd();var clean=ringListener.clean(),ringSegments=buffer.buffer(),segment,n=ringSegments.length;ring.pop();polygon.push(ring);ring=null;if(!n)return;if(clean&1){segment=ringSegments[0];var n=segment.length-1,i=-1,point;listener.lineStart();while(++i<n)listener.point((point=segment[i])[0],point[1]);listener.lineEnd();return}if(n>1&&clean&2)ringSegments.push(ringSegments.pop().concat(ringSegments.shift()));segments.push(ringSegments.filter(d3_geo_clipSegmentLength1))}return clip}}function d3_geo_clipSegmentLength1(segment){return segment.length>1}function d3_geo_clipBufferListener(){var lines=[],line;return{lineStart:function(){lines.push(line=[])},point:function(,){line.push([,])},lineEnd:d3_noop,buffer:function(){var buffer=lines;lines=[];line=null;return buffer},rejoin:function(){if(lines.length>1)lines.push(lines.pop().concat(lines.shift()))}}}function d3_geo_clipSort(a,b){return((a=a.x)[0]<0?a[1]-half-:half-a[1])-((b=b.x)[0]<0?b[1]-half-:half-b[1])}function d3_geo_pointInPolygon(point,polygon){var meridian=point[0],parallel=point[1],meridianNormal=[Math.sin(meridian),-Math.cos(meridian),0],polarAngle=0,winding=0;d3_geo_areaRingSum.reset();for(var i=0,n=polygon.length;i<n;++i){var ring=polygon[i],m=ring.length;if(!m)continue;var point0=ring[0],0=point0[0],0=point0[1]/2+/4,sin0=Math.sin(0),cos0=Math.cos(0),j=1;while(true){if(j===m)j=0;point=ring[j];var =point[0],=point[1]/2+/4,sin=Math.sin(),cos=Math.cos(),d=-0,antimeridian=abs(d)>,k=sin0*sin;d3_geo_areaRingSum.add(Math.atan2(k*Math.sin(d),cos0*cos+k*Math.cos(d)));polarAngle+=antimeridian?d+(d>=0?:-):d;if(antimeridian^0>=meridian^>=meridian){var arc=d3_geo_cartesianCross(d3_geo_cartesian(point0),d3_geo_cartesian(point));d3_geo_cartesianNormalize(arc);var intersection=d3_geo_cartesianCross(meridianNormal,arc);d3_geo_cartesianNormalize(intersection);var arc=(antimeridian^d>=0?-1:1)*d3_asin(intersection[2]);if(parallel>arc||parallel===arc&&(arc[0]||arc[1])){winding+=antimeridian^d>=0?1:-1}}if(!j++)break;0=,sin0=sin,cos0=cos,point0=point}}return(polarAngle<-||polarAngle<&&d3_geo_areaRingSum<0)^winding&1}var d3_geo_clipAntimeridian=d3_geo_clip(d3_true,d3_geo_clipAntimeridianLine,d3_geo_clipAntimeridianInterpolate,[-,-/2]);function d3_geo_clipAntimeridianLine(listener){var 0=NaN,0=NaN,s0=NaN,clean;return{lineStart:function(){listener.lineStart();clean=1},point:function(1,1){var s1=1>0?:-,d=abs(1-0);if(abs(d-)<){listener.point(0,0=(0+1)/2>0?half:-half);listener.point(s0,0);listener.lineEnd();listener.lineStart();listener.point(s1,0);listener.point(1,0);clean=0}else if(s0!==s1&&d>=){if(abs(0-s0)<)0-=s0*;if(abs(1-s1)<)1-=s1*;0=d3_geo_clipAntimeridianIntersect(0,0,1,1);listener.point(s0,0);listener.lineEnd();listener.lineStart();listener.point(s1,0);clean=0}listener.point(0=1,0=1);s0=s1},lineEnd:function(){listener.lineEnd();0=0=NaN},clean:function(){return 2-clean}}}function d3_geo_clipAntimeridianIntersect(0,0,1,1){var cos0,cos1,sin0_1=Math.sin(0-1);return abs(sin0_1)>?Math.atan((Math.sin(0)*(cos1=Math.cos(1))*Math.sin(1)-Math.sin(1)*(cos0=Math.cos(0))*Math.sin(0))/(cos0*cos1*sin0_1)):(0+1)/2}function d3_geo_clipAntimeridianInterpolate(from,to,direction,listener){var ;if(from==null){=direction*half;listener.point(-,);listener.point(0,);listener.point(,);listener.point(,0);listener.point(,-);listener.point(0,-);listener.point(-,-);listener.point(-,0);listener.point(-,)}else if(abs(from[0]-to[0])>){var s=from[0]<to[0]?:-;=direction*s/2;listener.point(-s,);listener.point(0,);listener.point(s,)}else{listener.point(to[0],to[1])}}function d3_geo_clipCircle(radius){var cr=Math.cos(radius),smallRadius=cr>0,notHemisphere=abs(cr)>,interpolate=d3_geo_circleInterpolate(radius,6*d3_radians);return d3_geo_clip(visible,clipLine,interpolate,smallRadius?[0,-radius]:[-,radius-]);function visible(,){return Math.cos()*Math.cos()>cr}function clipLine(listener){var point0,c0,v0,v00,clean;return{lineStart:function(){v00=v0=false;clean=1},point:function(,){var point1=[,],point2,v=visible(,),c=smallRadius?v?0:code(,):v?code(+(<0?:-),):0;if(!point0&&(v00=v0=v))listener.lineStart();if(v!==v0){point2=intersect(point0,point1);if(d3_geo_sphericalEqual(point0,point2)||d3_geo_sphericalEqual(point1,point2)){point1[0]+=;point1[1]+=;v=visible(point1[0],point1[1])}}if(v!==v0){clean=0;if(v){listener.lineStart();point2=intersect(point1,point0);listener.point(point2[0],point2[1])}else{point2=intersect(point0,point1);listener.point(point2[0],point2[1]);listener.lineEnd()}point0=point2}else if(notHemisphere&&point0&&smallRadius^v){var t;if(!(c&c0)&&(t=intersect(point1,point0,true))){clean=0;if(smallRadius){listener.lineStart();listener.point(t[0][0],t[0][1]);listener.point(t[1][0],t[1][1]);listener.lineEnd()}else{listener.point(t[1][0],t[1][1]);listener.lineEnd();listener.lineStart();listener.point(t[0][0],t[0][1])}}}if(v&&(!point0||!d3_geo_sphericalEqual(point0,point1))){listener.point(point1[0],point1[1])}point0=point1,v0=v,c0=c},lineEnd:function(){if(v0)listener.lineEnd();point0=null},clean:function(){return clean|(v00&&v0)<<1}}}function intersect(a,b,two){var pa=d3_geo_cartesian(a),pb=d3_geo_cartesian(b);var n1=[1,0,0],n2=d3_geo_cartesianCross(pa,pb),n2n2=d3_geo_cartesianDot(n2,n2),n1n2=n2[0],determinant=n2n2-n1n2*n1n2;if(!determinant)return!two&&a;var c1=cr*n2n2/determinant,c2=-cr*n1n2/determinant,n1xn2=d3_geo_cartesianCross(n1,n2),A=d3_geo_cartesianScale(n1,c1),B=d3_geo_cartesianScale(n2,c2);d3_geo_cartesianAdd(A,B);var u=n1xn2,w=d3_geo_cartesianDot(A,u),uu=d3_geo_cartesianDot(u,u),t2=w*w-uu*(d3_geo_cartesianDot(A,A)-1);if(t2<0)return;var t=Math.sqrt(t2),q=d3_geo_cartesianScale(u,(-w-t)/uu);d3_geo_cartesianAdd(q,A);q=d3_geo_spherical(q);if(!two)return q;var 0=a[0],1=b[0],0=a[1],1=b[1],z;if(1<0)z=0,0=1,1=z;var =1-0,polar=abs(-)<,meridian=polar||<;if(!polar&&1<0)z=0,0=1,1=z;if(meridian?polar?0+1>0^q[1]<(abs(q[0]-0)<?0:1):0<=q[1]&&q[1]<=1:>^(0<=q[0]&&q[0]<=1)){var q1=d3_geo_cartesianScale(u,(-w+t)/uu);d3_geo_cartesianAdd(q1,A);return[q,d3_geo_spherical(q1)]}}function code(,){var r=smallRadius?radius:-radius,code=0;if(<-r)code|=1;else if(>r)code|=2;if(<-r)code|=4;else if(>r)code|=8;return code}}function d3_geom_clipLine(x0,y0,x1,y1){return function(line){var a=line.a,b=line.b,ax=a.x,ay=a.y,bx=b.x,by=b.y,t0=0,t1=1,dx=bx-ax,dy=by-ay,r;r=x0-ax;if(!dx&&r>0)return;r/=dx;if(dx<0){if(r<t0)return;if(r<t1)t1=r}else if(dx>0){if(r>t1)return;if(r>t0)t0=r}r=x1-ax;if(!dx&&r<0)return;r/=dx;if(dx<0){if(r>t1)return;if(r>t0)t0=r}else if(dx>0){if(r<t0)return;if(r<t1)t1=r}r=y0-ay;if(!dy&&r>0)return;r/=dy;if(dy<0){if(r<t0)return;if(r<t1)t1=r}else if(dy>0){if(r>t1)return;if(r>t0)t0=r}r=y1-ay;if(!dy&&r<0)return;r/=dy;if(dy<0){if(r>t1)return;if(r>t0)t0=r}else if(dy>0){if(r<t0)return;if(r<t1)t1=r}if(t0>0)line.a={x:ax+t0*dx,y:ay+t0*dy};if(t1<1)line.b={x:ax+t1*dx,y:ay+t1*dy};return line}}var d3_geo_clipExtentMAX=1e9;d3.geo.clipExtent=function(){var x0,y0,x1,y1,stream,clip,clipExtent={stream:function(output){if(stream)stream.valid=false;stream=clip(output);stream.valid=true;return stream},extent:function(_){if(!arguments.length)return[[x0,y0],[x1,y1]];clip=d3_geo_clipExtent(x0=+_[0][0],y0=+_[0][1],x1=+_[1][0],y1=+_[1][1]);if(stream)stream.valid=false,stream=null;return clipExtent}};return clipExtent.extent([[0,0],[960,500]])};function d3_geo_clipExtent(x0,y0,x1,y1){return function(listener){var listener_=listener,bufferListener=d3_geo_clipBufferListener(),clipLine=d3_geom_clipLine(x0,y0,x1,y1),segments,polygon,ring;var clip={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){listener=bufferListener;segments=[];polygon=[];clean=true},polygonEnd:function(){listener=listener_;segments=d3.merge(segments);var clipStartInside=insidePolygon([x0,y1]),inside=clean&&clipStartInside,visible=segments.length;if(inside||visible){listener.polygonStart();if(inside){listener.lineStart();interpolate(null,null,1,listener);listener.lineEnd()}if(visible){d3_geo_clipPolygon(segments,compare,clipStartInside,interpolate,listener)}listener.polygonEnd()}segments=polygon=ring=null}};function insidePolygon(p){var wn=0,n=polygon.length,y=p[1];for(var i=0;i<n;++i){for(var j=1,v=polygon[i],m=v.length,a=v[0],b;j<m;++j){b=v[j];if(a[1]<=y){if(b[1]>y&&isLeft(a,b,p)>0)++wn}else{if(b[1]<=y&&isLeft(a,b,p)<0)--wn}a=b}}return wn!==0}function isLeft(a,b,c){return(b[0]-a[0])*(c[1]-a[1])-(c[0]-a[0])*(b[1]-a[1])}function interpolate(from,to,direction,listener){var a=0,a1=0;if(from==null||(a=corner(from,direction))!==(a1=corner(to,direction))||comparePoints(from,to)<0^direction>0){do{listener.point(a===0||a===3?x0:x1,a>1?y1:y0)}while((a=(a+direction+4)%4)!==a1)}else{listener.point(to[0],to[1])}}function pointVisible(x,y){return x0<=x&&x<=x1&&y0<=y&&y<=y1}function point(x,y){if(pointVisible(x,y))listener.point(x,y)}var x__,y__,v__,x_,y_,v_,first,clean;function lineStart(){clip.point=linePoint;if(polygon)polygon.push(ring=[]);first=true;v_=false;x_=y_=NaN}function lineEnd(){if(segments){linePoint(x__,y__);if(v__&&v_)bufferListener.rejoin();segments.push(bufferListener.buffer())}clip.point=point;if(v_)listener.lineEnd()}function linePoint(x,y){x=Math.max(-d3_geo_clipExtentMAX,Math.min(d3_geo_clipExtentMAX,x));y=Math.max(-d3_geo_clipExtentMAX,Math.min(d3_geo_clipExtentMAX,y));var v=pointVisible(x,y);if(polygon)ring.push([x,y]);if(first){x__=x,y__=y,v__=v;first=false;if(v){listener.lineStart();listener.point(x,y)}}else{if(v&&v_)listener.point(x,y);else{var l={a:{x:x_,y:y_},b:{x:x,y:y}};if(clipLine(l)){if(!v_){listener.lineStart();listener.point(l.a.x,l.a.y)}listener.point(l.b.x,l.b.y);if(!v)listener.lineEnd();clean=false}else if(v){listener.lineStart();listener.point(x,y);clean=false}}}x_=x,y_=y,v_=v}return clip};function corner(p,direction){return abs(p[0]-x0)<?direction>0?0:3:abs(p[0]-x1)<?direction>0?2:1:abs(p[1]-y0)<?direction>0?1:0:direction>0?3:2}function compare(a,b){return comparePoints(a.x,b.x)}function comparePoints(a,b){var ca=corner(a,1),cb=corner(b,1);return ca!==cb?ca-cb:ca===0?b[1]-a[1]:ca===1?a[0]-b[0]:ca===2?a[1]-b[1]:b[0]-a[0]}}function d3_geo_compose(a,b){function compose(x,y){return x=a(x,y),b(x[0],x[1])}if(a.invert&&b.invert)compose.invert=function(x,y){return x=b.invert(x,y),x&&a.invert(x[0],x[1])};return compose}function d3_geo_conic(projectAt){var 0=0,1=/3,m=d3_geo_projectionMutator(projectAt),p=m(0,1);p.parallels=function(_){if(!arguments.length)return[0/*180,1/*180];return m(0=_[0]*/180,1=_[1]*/180)};return p}function d3_geo_conicEqualArea(0,1){var sin0=Math.sin(0),n=(sin0+Math.sin(1))/2,C=1+sin0*(2*n-sin0),0=Math.sqrt(C)/n;function forward(,){var =Math.sqrt(C-2*n*Math.sin())/n;return[*Math.sin(*=n),0-*Math.cos()]}forward.invert=function(x,y){var 0_y=0-y;return[Math.atan2(x,0_y)/n,d3_asin((C-(x*x+0_y*0_y)*n*n)/(2*n))]};return forward}(d3.geo.conicEqualArea=function(){return d3_geo_conic(d3_geo_conicEqualArea)}).raw=d3_geo_conicEqualArea;d3.geo.albers=function(){return d3.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070)};d3.geo.albersUsa=function(){var lower48=d3.geo.albers();var alaska=d3.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]);var hawaii=d3.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]);var point,pointStream={point:function(x,y){point=[x,y]}},lower48Point,alaskaPoint,hawaiiPoint;function albersUsa(coordinates){var x=coordinates[0],y=coordinates[1];point=null;(lower48Point(x,y),point)||(alaskaPoint(x,y),point)||hawaiiPoint(x,y);return point}albersUsa.invert=function(coordinates){var k=lower48.scale(),t=lower48.translate(),x=(coordinates[0]-t[0])/k,y=(coordinates[1]-t[1])/k;return(y>=.12&&y<.234&&x>=-.425&&x<-.214?alaska:y>=.166&&y<.234&&x>=-.214&&x<-.115?hawaii:lower48).invert(coordinates)};albersUsa.stream=function(stream){var lower48Stream=lower48.stream(stream),alaskaStream=alaska.stream(stream),hawaiiStream=hawaii.stream(stream);return{point:function(x,y){lower48Stream.point(x,y);alaskaStream.point(x,y);hawaiiStream.point(x,y)},sphere:function(){lower48Stream.sphere();alaskaStream.sphere();hawaiiStream.sphere()},lineStart:function(){lower48Stream.lineStart();alaskaStream.lineStart();hawaiiStream.lineStart()},lineEnd:function(){lower48Stream.lineEnd();alaskaStream.lineEnd();hawaiiStream.lineEnd()},polygonStart:function(){lower48Stream.polygonStart();alaskaStream.polygonStart();hawaiiStream.polygonStart()},polygonEnd:function(){lower48Stream.polygonEnd();alaskaStream.polygonEnd();hawaiiStream.polygonEnd()}}};albersUsa.precision=function(_){if(!arguments.length)return lower48.precision();lower48.precision(_);alaska.precision(_);hawaii.precision(_);return albersUsa};albersUsa.scale=function(_){if(!arguments.length)return lower48.scale();lower48.scale(_);alaska.scale(_*.35);hawaii.scale(_);return albersUsa.translate(lower48.translate())};albersUsa.translate=function(_){if(!arguments.length)return lower48.translate();var k=lower48.scale(),x=+_[0],y=+_[1];lower48Point=lower48.translate(_).clipExtent([[x-.455*k,y-.238*k],[x+.455*k,y+.238*k]]).stream(pointStream).point;alaskaPoint=alaska.translate([x-.307*k,y+.201*k]).clipExtent([[x-.425*k+,y+.12*k+],[x-.214*k-,y+.234*k-]]).stream(pointStream).point;hawaiiPoint=hawaii.translate([x-.205*k,y+.212*k]).clipExtent([[x-.214*k+,y+.166*k+],[x-.115*k-,y+.234*k-]]).stream(pointStream).point;return albersUsa};return albersUsa.scale(1070)};var d3_geo_pathAreaSum,d3_geo_pathAreaPolygon,d3_geo_pathArea={point:d3_noop,lineStart:d3_noop,lineEnd:d3_noop,polygonStart:function(){d3_geo_pathAreaPolygon=0;d3_geo_pathArea.lineStart=d3_geo_pathAreaRingStart},polygonEnd:function(){d3_geo_pathArea.lineStart=d3_geo_pathArea.lineEnd=d3_geo_pathArea.point=d3_noop;d3_geo_pathAreaSum+=abs(d3_geo_pathAreaPolygon/2)}};function d3_geo_pathAreaRingStart(){var x00,y00,x0,y0;d3_geo_pathArea.point=function(x,y){d3_geo_pathArea.point=nextPoint;x00=x0=x,y00=y0=y};function nextPoint(x,y){d3_geo_pathAreaPolygon+=y0*x-x0*y;x0=x,y0=y}d3_geo_pathArea.lineEnd=function(){nextPoint(x00,y00)}}var d3_geo_pathBoundsX0,d3_geo_pathBoundsY0,d3_geo_pathBoundsX1,d3_geo_pathBoundsY1;var d3_geo_pathBounds={point:d3_geo_pathBoundsPoint,lineStart:d3_noop,lineEnd:d3_noop,polygonStart:d3_noop,polygonEnd:d3_noop};function d3_geo_pathBoundsPoint(x,y){if(x<d3_geo_pathBoundsX0)d3_geo_pathBoundsX0=x;if(x>d3_geo_pathBoundsX1)d3_geo_pathBoundsX1=x;if(y<d3_geo_pathBoundsY0)d3_geo_pathBoundsY0=y;if(y>d3_geo_pathBoundsY1)d3_geo_pathBoundsY1=y}function d3_geo_pathBuffer(){var pointCircle=d3_geo_pathBufferCircle(4.5),buffer=[];var stream={point:point,lineStart:function(){stream.point=pointLineStart},lineEnd:lineEnd,polygonStart:function(){stream.lineEnd=lineEndPolygon},polygonEnd:function(){stream.lineEnd=lineEnd;stream.point=point},pointRadius:function(_){pointCircle=d3_geo_pathBufferCircle(_);return stream},result:function(){if(buffer.length){var result=buffer.join("");buffer=[];return result}}};function point(x,y){buffer.push("M",x,",",y,pointCircle)}function pointLineStart(x,y){buffer.push("M",x,",",y);stream.point=pointLine}function pointLine(x,y){buffer.push("L",x,",",y)}function lineEnd(){stream.point=point}function lineEndPolygon(){buffer.push("Z")}return stream}function d3_geo_pathBufferCircle(radius){return"m0,"+radius+"a"+radius+","+radius+" 0 1,1 0,"+-2*radius+"a"+radius+","+radius+" 0 1,1 0,"+2*radius+"z"}var d3_geo_pathCentroid={point:d3_geo_pathCentroidPoint,lineStart:d3_geo_pathCentroidLineStart,lineEnd:d3_geo_pathCentroidLineEnd,polygonStart:function(){d3_geo_pathCentroid.lineStart=d3_geo_pathCentroidRingStart},polygonEnd:function(){d3_geo_pathCentroid.point=d3_geo_pathCentroidPoint;d3_geo_pathCentroid.lineStart=d3_geo_pathCentroidLineStart;d3_geo_pathCentroid.lineEnd=d3_geo_pathCentroidLineEnd}};function d3_geo_pathCentroidPoint(x,y){d3_geo_centroidX0+=x;d3_geo_centroidY0+=y;++d3_geo_centroidZ0}function d3_geo_pathCentroidLineStart(){var x0,y0;d3_geo_pathCentroid.point=function(x,y){d3_geo_pathCentroid.point=nextPoint;d3_geo_pathCentroidPoint(x0=x,y0=y)};function nextPoint(x,y){var dx=x-x0,dy=y-y0,z=Math.sqrt(dx*dx+dy*dy);d3_geo_centroidX1+=z*(x0+x)/2;d3_geo_centroidY1+=z*(y0+y)/2;d3_geo_centroidZ1+=z;d3_geo_pathCentroidPoint(x0=x,y0=y)}}function d3_geo_pathCentroidLineEnd(){d3_geo_pathCentroid.point=d3_geo_pathCentroidPoint}function d3_geo_pathCentroidRingStart(){var x00,y00,x0,y0;d3_geo_pathCentroid.point=function(x,y){d3_geo_pathCentroid.point=nextPoint;d3_geo_pathCentroidPoint(x00=x0=x,y00=y0=y)};function nextPoint(x,y){var dx=x-x0,dy=y-y0,z=Math.sqrt(dx*dx+dy*dy);d3_geo_centroidX1+=z*(x0+x)/2;d3_geo_centroidY1+=z*(y0+y)/2;d3_geo_centroidZ1+=z;z=y0*x-x0*y;d3_geo_centroidX2+=z*(x0+x);d3_geo_centroidY2+=z*(y0+y);d3_geo_centroidZ2+=z*3;d3_geo_pathCentroidPoint(x0=x,y0=y)}d3_geo_pathCentroid.lineEnd=function(){nextPoint(x00,y00)}}function d3_geo_pathContext(context){var pointRadius=4.5;var stream={point:point,lineStart:function(){stream.point=pointLineStart},lineEnd:lineEnd,polygonStart:function(){stream.lineEnd=lineEndPolygon},polygonEnd:function(){stream.lineEnd=lineEnd;stream.point=point},pointRadius:function(_){pointRadius=_;return stream},result:d3_noop};function point(x,y){context.moveTo(x,y);context.arc(x,y,pointRadius,0,)}function pointLineStart(x,y){context.moveTo(x,y);stream.point=pointLine}function pointLine(x,y){context.lineTo(x,y)}function lineEnd(){stream.point=point}function lineEndPolygon(){context.closePath()}return stream}function d3_geo_resample(project){var 2=.5,cosMinDistance=Math.cos(30*d3_radians),maxDepth=16;function resample(stream){return(maxDepth?resampleRecursive:resampleNone)(stream)}function resampleNone(stream){return d3_geo_transformPoint(stream,function(x,y){x=project(x,y);stream.point(x[0],x[1])})}function resampleRecursive(stream){var 00,00,x00,y00,a00,b00,c00,0,x0,y0,a0,b0,c0;var resample={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){stream.polygonStart();resample.lineStart=ringStart},polygonEnd:function(){stream.polygonEnd();resample.lineStart=lineStart}};function point(x,y){x=project(x,y);stream.point(x[0],x[1])}function lineStart(){x0=NaN;resample.point=linePoint;stream.lineStart()}function linePoint(,){var c=d3_geo_cartesian([,]),p=project(,);resampleLineTo(x0,y0,0,a0,b0,c0,x0=p[0],y0=p[1],0=,a0=c[0],b0=c[1],c0=c[2],maxDepth,stream);stream.point(x0,y0)}function lineEnd(){resample.point=point;stream.lineEnd()}function ringStart(){lineStart();resample.point=ringPoint;resample.lineEnd=ringEnd}function ringPoint(,){linePoint(00=,00=),x00=x0,y00=y0,a00=a0,b00=b0,c00=c0;resample.point=linePoint}function ringEnd(){resampleLineTo(x0,y0,0,a0,b0,c0,x00,y00,00,a00,b00,c00,maxDepth,stream);resample.lineEnd=lineEnd;lineEnd()}return resample}function resampleLineTo(x0,y0,0,a0,b0,c0,x1,y1,1,a1,b1,c1,depth,stream){var dx=x1-x0,dy=y1-y0,d2=dx*dx+dy*dy;if(d2>4*2&&depth--){var a=a0+a1,b=b0+b1,c=c0+c1,m=Math.sqrt(a*a+b*b+c*c),2=Math.asin(c/=m),2=abs(abs(c)-1)<||abs(0-1)<?(0+1)/2:Math.atan2(b,a),p=project(2,2),x2=p[0],y2=p[1],dx2=x2-x0,dy2=y2-y0,dz=dy*dx2-dx*dy2;if(dz*dz/d2>2||abs((dx*dx2+dy*dy2)/d2-.5)>.3||a0*a1+b0*b1+c0*c1<cosMinDistance){resampleLineTo(x0,y0,0,a0,b0,c0,x2,y2,2,a/=m,b/=m,c,depth,stream);stream.point(x2,y2);resampleLineTo(x2,y2,2,a,b,c,x1,y1,1,a1,b1,c1,depth,stream)}}}resample.precision=function(_){if(!arguments.length)return Math.sqrt(2);maxDepth=(2=_*_)>0&&16;return resample};return resample}d3.geo.path=function(){var pointRadius=4.5,projection,context,projectStream,contextStream,cacheStream;function path(object){if(object){if(typeof pointRadius==="function")contextStream.pointRadius(+pointRadius.apply(this,arguments));if(!cacheStream||!cacheStream.valid)cacheStream=projectStream(contextStream);d3.geo.stream(object,cacheStream)}return contextStream.result()}path.area=function(object){d3_geo_pathAreaSum=0;d3.geo.stream(object,projectStream(d3_geo_pathArea));return d3_geo_pathAreaSum};path.centroid=function(object){d3_geo_centroidX0=d3_geo_centroidY0=d3_geo_centroidZ0=d3_geo_centroidX1=d3_geo_centroidY1=d3_geo_centroidZ1=d3_geo_centroidX2=d3_geo_centroidY2=d3_geo_centroidZ2=0;d3.geo.stream(object,projectStream(d3_geo_pathCentroid));return d3_geo_centroidZ2?[d3_geo_centroidX2/d3_geo_centroidZ2,d3_geo_centroidY2/d3_geo_centroidZ2]:d3_geo_centroidZ1?[d3_geo_centroidX1/d3_geo_centroidZ1,d3_geo_centroidY1/d3_geo_centroidZ1]:d3_geo_centroidZ0?[d3_geo_centroidX0/d3_geo_centroidZ0,d3_geo_centroidY0/d3_geo_centroidZ0]:[NaN,NaN]};path.bounds=function(object){d3_geo_pathBoundsX1=d3_geo_pathBoundsY1=-(d3_geo_pathBoundsX0=d3_geo_pathBoundsY0=Infinity);d3.geo.stream(object,projectStream(d3_geo_pathBounds));return[[d3_geo_pathBoundsX0,d3_geo_pathBoundsY0],[d3_geo_pathBoundsX1,d3_geo_pathBoundsY1]]};path.projection=function(_){if(!arguments.length)return projection;projectStream=(projection=_)?_.stream||d3_geo_pathProjectStream(_):d3_identity;return reset()};path.context=function(_){if(!arguments.length)return context;contextStream=(context=_)==null?new d3_geo_pathBuffer:new d3_geo_pathContext(_);if(typeof pointRadius!=="function")contextStream.pointRadius(pointRadius);return reset()};path.pointRadius=function(_){if(!arguments.length)return pointRadius;pointRadius=typeof _==="function"?_:(contextStream.pointRadius(+_),+_);return path};function reset(){cacheStream=null;return path}return path.projection(d3.geo.albersUsa()).context(null)};function d3_geo_pathProjectStream(project){var resample=d3_geo_resample(function(x,y){return project([x*d3_degrees,y*d3_degrees])});return function(stream){return d3_geo_projectionRadians(resample(stream))}}d3.geo.transform=function(methods){return{stream:function(stream){var transform=new d3_geo_transform(stream);for(var k in methods)transform[k]=methods[k];return transform}}};function d3_geo_transform(stream){this.stream=stream}d3_geo_transform.prototype={point:function(x,y){this.stream.point(x,y)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function d3_geo_transformPoint(stream,point){return{point:point,sphere:function(){stream.sphere()},lineStart:function(){stream.lineStart()},lineEnd:function(){stream.lineEnd()},polygonStart:function(){stream.polygonStart()},polygonEnd:function(){stream.polygonEnd()}}}d3.geo.projection=d3_geo_projection;d3.geo.projectionMutator=d3_geo_projectionMutator;function d3_geo_projection(project){return d3_geo_projectionMutator(function(){return project})()}function d3_geo_projectionMutator(projectAt){var project,rotate,projectRotate,projectResample=d3_geo_resample(function(x,y){x=project(x,y);return[x[0]*k+x,y-x[1]*k]}),k=150,x=480,y=250,=0,=0,=0,=0,=0,x,y,preclip=d3_geo_clipAntimeridian,postclip=d3_identity,clipAngle=null,clipExtent=null,stream;function projection(point){point=projectRotate(point[0]*d3_radians,point[1]*d3_radians);return[point[0]*k+x,y-point[1]*k]}function invert(point){point=projectRotate.invert((point[0]-x)/k,(y-point[1])/k);return point&&[point[0]*d3_degrees,point[1]*d3_degrees]}projection.stream=function(output){if(stream)stream.valid=false;stream=d3_geo_projectionRadians(preclip(rotate,projectResample(postclip(output))));stream.valid=true;return stream};projection.clipAngle=function(_){if(!arguments.length)return clipAngle;preclip=_==null?(clipAngle=_,d3_geo_clipAntimeridian):d3_geo_clipCircle((clipAngle=+_)*d3_radians);return invalidate()};projection.clipExtent=function(_){if(!arguments.length)return clipExtent;clipExtent=_;postclip=_?d3_geo_clipExtent(_[0][0],_[0][1],_[1][0],_[1][1]):d3_identity;return invalidate()};projection.scale=function(_){if(!arguments.length)return k;k=+_;return reset()};projection.translate=function(_){if(!arguments.length)return[x,y];x=+_[0];y=+_[1];return reset()};projection.center=function(_){if(!arguments.length)return[*d3_degrees,*d3_degrees];=_[0]%360*d3_radians;=_[1]%360*d3_radians;return reset()};projection.rotate=function(_){if(!arguments.length)return[*d3_degrees,*d3_degrees,*d3_degrees];=_[0]%360*d3_radians;=_[1]%360*d3_radians;=_.length>2?_[2]%360*d3_radians:0;return reset()};d3.rebind(projection,projectResample,"precision");function reset(){projectRotate=d3_geo_compose(rotate=d3_geo_rotation(,,),project);var center=project(,);x=x-center[0]*k;y=y+center[1]*k;return invalidate()}function invalidate(){if(stream)stream.valid=false,stream=null;return projection}return function(){project=projectAt.apply(this,arguments);projection.invert=project.invert&&invert;return reset()}}function d3_geo_projectionRadians(stream){return d3_geo_transformPoint(stream,function(x,y){stream.point(x*d3_radians,y*d3_radians)})}function d3_geo_equirectangular(,){return[,]}(d3.geo.equirectangular=function(){return d3_geo_projection(d3_geo_equirectangular)}).raw=d3_geo_equirectangular.invert=d3_geo_equirectangular;d3.geo.rotation=function(rotate){rotate=d3_geo_rotation(rotate[0]%360*d3_radians,rotate[1]*d3_radians,rotate.length>2?rotate[2]*d3_radians:0);function forward(coordinates){coordinates=rotate(coordinates[0]*d3_radians,coordinates[1]*d3_radians);return coordinates[0]*=d3_degrees,coordinates[1]*=d3_degrees,coordinates}forward.invert=function(coordinates){coordinates=rotate.invert(coordinates[0]*d3_radians,coordinates[1]*d3_radians);return coordinates[0]*=d3_degrees,coordinates[1]*=d3_degrees,coordinates};return forward};function d3_geo_identityRotation(,){return[>?-:<-?+:,]}d3_geo_identityRotation.invert=d3_geo_equirectangular;function d3_geo_rotation(,,){return ?||?d3_geo_compose(d3_geo_rotation(),d3_geo_rotation(,)):d3_geo_rotation():||?d3_geo_rotation(,):d3_geo_identityRotation}function d3_geo_forwardRotation(){return function(,){return +=,[>?-:<-?+:,]}}function d3_geo_rotation(){var rotation=d3_geo_forwardRotation();rotation.invert=d3_geo_forwardRotation(-);return rotation}function d3_geo_rotation(,){var cos=Math.cos(),sin=Math.sin(),cos=Math.cos(),sin=Math.sin();function rotation(,){var cos=Math.cos(),x=Math.cos()*cos,y=Math.sin()*cos,z=Math.sin(),k=z*cos+x*sin;return[Math.atan2(y*cos-k*sin,x*cos-z*sin),d3_asin(k*cos+y*sin)]}rotation.invert=function(,){var cos=Math.cos(),x=Math.cos()*cos,y=Math.sin()*cos,z=Math.sin(),k=z*cos-y*sin;return[Math.atan2(y*cos+z*sin,x*cos+k*sin),d3_asin(k*cos-x*sin)]};return rotation}d3.geo.circle=function(){var origin=[0,0],angle,precision=6,interpolate;function circle(){var center=typeof origin==="function"?origin.apply(this,arguments):origin,rotate=d3_geo_rotation(-center[0]*d3_radians,-center[1]*d3_radians,0).invert,ring=[];interpolate(null,null,1,{point:function(x,y){ring.push(x=rotate(x,y));x[0]*=d3_degrees,x[1]*=d3_degrees}});return{type:"Polygon",coordinates:[ring]}}circle.origin=function(x){if(!arguments.length)return origin;origin=x;return circle};circle.angle=function(x){if(!arguments.length)return angle;interpolate=d3_geo_circleInterpolate((angle=+x)*d3_radians,precision*d3_radians);return circle};circle.precision=function(_){if(!arguments.length)return precision;interpolate=d3_geo_circleInterpolate(angle*d3_radians,(precision=+_)*d3_radians);return circle};return circle.angle(90)};function d3_geo_circleInterpolate(radius,precision){var cr=Math.cos(radius),sr=Math.sin(radius);return function(from,to,direction,listener){var step=direction*precision;if(from!=null){from=d3_geo_circleAngle(cr,from);to=d3_geo_circleAngle(cr,to);if(direction>0?from<to:from>to)from+=direction*}else{from=radius+direction*;to=radius-.5*step}for(var point,t=from;direction>0?t>to:t<to;t-=step){listener.point((point=d3_geo_spherical([cr,-sr*Math.cos(t),-sr*Math.sin(t)]))[0],point[1])}}}function d3_geo_circleAngle(cr,point){var a=d3_geo_cartesian(point);a[0]-=cr;d3_geo_cartesianNormalize(a);var angle=d3_acos(-a[1]);return((-a[2]<0?-angle:angle)+2*Math.PI-)%(2*Math.PI)}d3.geo.distance=function(a,b){var =(b[0]-a[0])*d3_radians,0=a[1]*d3_radians,1=b[1]*d3_radians,sin=Math.sin(),cos=Math.cos(),sin0=Math.sin(0),cos0=Math.cos(0),sin1=Math.sin(1),cos1=Math.cos(1),t;return Math.atan2(Math.sqrt((t=cos1*sin)*t+(t=cos0*sin1-sin0*cos1*cos)*t),sin0*sin1+cos0*cos1*cos)};d3.geo.graticule=function(){var x1,x0,X1,X0,y1,y0,Y1,Y0,dx=10,dy=dx,DX=90,DY=360,x,y,X,Y,precision=2.5;function graticule(){return{type:"MultiLineString",coordinates:lines()}}function lines(){return d3.range(Math.ceil(X0/DX)*DX,X1,DX).map(X).concat(d3.range(Math.ceil(Y0/DY)*DY,Y1,DY).map(Y)).concat(d3.range(Math.ceil(x0/dx)*dx,x1,dx).filter(function(x){return abs(x%DX)>}).map(x)).concat(d3.range(Math.ceil(y0/dy)*dy,y1,dy).filter(function(y){return abs(y%DY)>}).map(y))}graticule.lines=function(){return lines().map(function(coordinates){return{type:"LineString",coordinates:coordinates}})};graticule.outline=function(){return{type:"Polygon",coordinates:[X(X0).concat(Y(Y1).slice(1),X(X1).reverse().slice(1),Y(Y0).reverse().slice(1))]}};graticule.extent=function(_){if(!arguments.length)return graticule.minorExtent();return graticule.majorExtent(_).minorExtent(_)};graticule.majorExtent=function(_){if(!arguments.length)return[[X0,Y0],[X1,Y1]];X0=+_[0][0],X1=+_[1][0];Y0=+_[0][1],Y1=+_[1][1];if(X0>X1)_=X0,X0=X1,X1=_;if(Y0>Y1)_=Y0,Y0=Y1,Y1=_;return graticule.precision(precision)};graticule.minorExtent=function(_){if(!arguments.length)return[[x0,y0],[x1,y1]];x0=+_[0][0],x1=+_[1][0];y0=+_[0][1],y1=+_[1][1];if(x0>x1)_=x0,x0=x1,x1=_;if(y0>y1)_=y0,y0=y1,y1=_;return graticule.precision(precision)};graticule.step=function(_){if(!arguments.length)return graticule.minorStep();return graticule.majorStep(_).minorStep(_)};graticule.majorStep=function(_){if(!arguments.length)return[DX,DY];DX=+_[0],DY=+_[1];return graticule};graticule.minorStep=function(_){if(!arguments.length)return[dx,dy];dx=+_[0],dy=+_[1];return graticule};graticule.precision=function(_){if(!arguments.length)return precision;precision=+_;x=d3_geo_graticuleX(y0,y1,90);y=d3_geo_graticuleY(x0,x1,precision);X=d3_geo_graticuleX(Y0,Y1,90);Y=d3_geo_graticuleY(X0,X1,precision);return graticule};return graticule.majorExtent([[-180,-90+],[180,90-]]).minorExtent([[-180,-80-],[180,80+]])};function d3_geo_graticuleX(y0,y1,dy){var y=d3.range(y0,y1-,dy).concat(y1);return function(x){return y.map(function(y){return[x,y]})}}function d3_geo_graticuleY(x0,x1,dx){var x=d3.range(x0,x1-,dx).concat(x1);return function(y){return x.map(function(x){return[x,y]})}}function d3_source(d){return d.source}function d3_target(d){return d.target}d3.geo.greatArc=function(){var source=d3_source,source_,target=d3_target,target_;function greatArc(){return{type:"LineString",coordinates:[source_||source.apply(this,arguments),target_||target.apply(this,arguments)]}}greatArc.distance=function(){return d3.geo.distance(source_||source.apply(this,arguments),target_||target.apply(this,arguments))};greatArc.source=function(_){if(!arguments.length)return source;source=_,source_=typeof _==="function"?null:_;return greatArc};greatArc.target=function(_){if(!arguments.length)return target;target=_,target_=typeof _==="function"?null:_;return greatArc};greatArc.precision=function(){return arguments.length?greatArc:0};return greatArc};d3.geo.interpolate=function(source,target){return d3_geo_interpolate(source[0]*d3_radians,source[1]*d3_radians,target[0]*d3_radians,target[1]*d3_radians)};function d3_geo_interpolate(x0,y0,x1,y1){var cy0=Math.cos(y0),sy0=Math.sin(y0),cy1=Math.cos(y1),sy1=Math.sin(y1),kx0=cy0*Math.cos(x0),ky0=cy0*Math.sin(x0),kx1=cy1*Math.cos(x1),ky1=cy1*Math.sin(x1),d=2*Math.asin(Math.sqrt(d3_haversin(y1-y0)+cy0*cy1*d3_haversin(x1-x0))),k=1/Math.sin(d);var interpolate=d?function(t){var B=Math.sin(t*=d)*k,A=Math.sin(d-t)*k,x=A*kx0+B*kx1,y=A*ky0+B*ky1,z=A*sy0+B*sy1;return[Math.atan2(y,x)*d3_degrees,Math.atan2(z,Math.sqrt(x*x+y*y))*d3_degrees]}:function(){return[x0*d3_degrees,y0*d3_degrees]};interpolate.distance=d;return interpolate}d3.geo.length=function(object){d3_geo_lengthSum=0;d3.geo.stream(object,d3_geo_length);return d3_geo_lengthSum};var d3_geo_lengthSum;var d3_geo_length={sphere:d3_noop,point:d3_noop,lineStart:d3_geo_lengthLineStart,lineEnd:d3_noop,polygonStart:d3_noop,polygonEnd:d3_noop};function d3_geo_lengthLineStart(){var 0,sin0,cos0;d3_geo_length.point=function(,){0=*d3_radians,sin0=Math.sin(*=d3_radians),cos0=Math.cos();d3_geo_length.point=nextPoint};d3_geo_length.lineEnd=function(){d3_geo_length.point=d3_geo_length.lineEnd=d3_noop};function nextPoint(,){var sin=Math.sin(*=d3_radians),cos=Math.cos(),t=abs((*=d3_radians)-0),cos=Math.cos(t);d3_geo_lengthSum+=Math.atan2(Math.sqrt((t=cos*Math.sin(t))*t+(t=cos0*sin-sin0*cos*cos)*t),sin0*sin+cos0*cos*cos);0=,sin0=sin,cos0=cos}}function d3_geo_azimuthal(scale,angle){function azimuthal(,){var cos=Math.cos(),cos=Math.cos(),k=scale(cos*cos);return[k*cos*Math.sin(),k*Math.sin()]}azimuthal.invert=function(x,y){var =Math.sqrt(x*x+y*y),c=angle(),sinc=Math.sin(c),cosc=Math.cos(c);return[Math.atan2(x*sinc,*cosc),Math.asin(&&y*sinc/)]};return azimuthal}var d3_geo_azimuthalEqualArea=d3_geo_azimuthal(function(coscos){return Math.sqrt(2/(1+coscos))},function(){return 2*Math.asin(/2)});(d3.geo.azimuthalEqualArea=function(){return d3_geo_projection(d3_geo_azimuthalEqualArea)}).raw=d3_geo_azimuthalEqualArea;var d3_geo_azimuthalEquidistant=d3_geo_azimuthal(function(coscos){var c=Math.acos(coscos);return c&&c/Math.sin(c)},d3_identity);(d3.geo.azimuthalEquidistant=function(){return d3_geo_projection(d3_geo_azimuthalEquidistant)}).raw=d3_geo_azimuthalEquidistant;function d3_geo_conicConformal(0,1){var cos0=Math.cos(0),t=function(){return Math.tan(/4+/2)},n=0===1?Math.sin(0):Math.log(cos0/Math.cos(1))/Math.log(t(1)/t(0)),F=cos0*Math.pow(t(0),n)/n;if(!n)return d3_geo_mercator;function forward(,){var =abs(abs()-half)<?0:F/Math.pow(t(),n);return[*Math.sin(n*),F-*Math.cos(n*)]}forward.invert=function(x,y){var 0_y=F-y,=d3_sgn(n)*Math.sqrt(x*x+0_y*0_y);return[Math.atan2(x,0_y)/n,2*Math.atan(Math.pow(F/,1/n))-half]};return forward}(d3.geo.conicConformal=function(){return d3_geo_conic(d3_geo_conicConformal)}).raw=d3_geo_conicConformal;function d3_geo_conicEquidistant(0,1){var cos0=Math.cos(0),n=0===1?Math.sin(0):(cos0-Math.cos(1))/(1-0),G=cos0/n+0;if(abs(n)<)return d3_geo_equirectangular;function forward(,){var =G-;return[*Math.sin(n*),G-*Math.cos(n*)]}forward.invert=function(x,y){var 0_y=G-y;return[Math.atan2(x,0_y)/n,G-d3_sgn(n)*Math.sqrt(x*x+0_y*0_y)]};return forward}(d3.geo.conicEquidistant=function(){return d3_geo_conic(d3_geo_conicEquidistant)}).raw=d3_geo_conicEquidistant;var d3_geo_gnomonic=d3_geo_azimuthal(function(coscos){return 1/coscos},Math.atan);(d3.geo.gnomonic=function(){return d3_geo_projection(d3_geo_gnomonic)}).raw=d3_geo_gnomonic;function d3_geo_mercator(,){return[,Math.log(Math.tan(/4+/2))]}d3_geo_mercator.invert=function(x,y){return[x,2*Math.atan(Math.exp(y))-half]};function d3_geo_mercatorProjection(project){var m=d3_geo_projection(project),scale=m.scale,translate=m.translate,clipExtent=m.clipExtent,clipAuto;m.scale=function(){var v=scale.apply(m,arguments);return v===m?clipAuto?m.clipExtent(null):m:v};m.translate=function(){var v=translate.apply(m,arguments);return v===m?clipAuto?m.clipExtent(null):m:v};m.clipExtent=function(_){var v=clipExtent.apply(m,arguments);if(v===m){if(clipAuto=_==null){var k=*scale(),t=translate();clipExtent([[t[0]-k,t[1]-k],[t[0]+k,t[1]+k]])}}else if(clipAuto){v=null}return v};return m.clipExtent(null)}(d3.geo.mercator=function(){return d3_geo_mercatorProjection(d3_geo_mercator)}).raw=d3_geo_mercator;var d3_geo_orthographic=d3_geo_azimuthal(function(){return 1},Math.asin);(d3.geo.orthographic=function(){return d3_geo_projection(d3_geo_orthographic)}).raw=d3_geo_orthographic;var d3_geo_stereographic=d3_geo_azimuthal(function(coscos){return 1/(1+coscos)},function(){return 2*Math.atan()});(d3.geo.stereographic=function(){return d3_geo_projection(d3_geo_stereographic)}).raw=d3_geo_stereographic;function d3_geo_transverseMercator(,){var B=Math.cos()*Math.sin();return[Math.log((1+B)/(1-B))/2,Math.atan2(Math.tan(),Math.cos())]}d3_geo_transverseMercator.invert=function(x,y){return[Math.atan2(d3_sinh(x),Math.cos(y)),d3_asin(Math.sin(y)/d3_cosh(x))]};(d3.geo.transverseMercator=function(){return d3_geo_mercatorProjection(d3_geo_transverseMercator)}).raw=d3_geo_transverseMercator;d3.geom={};function d3_geom_pointX(d){return d[0]}function d3_geom_pointY(d){return d[1]}d3.geom.hull=function(vertices){var x=d3_geom_pointX,y=d3_geom_pointY;if(arguments.length)return hull(vertices);function hull(data){if(data.length<3)return[];var fx=d3_functor(x),fy=d3_functor(y),n=data.length,vertices,plen=n-1,points=[],stack=[],d,i,j,h=0,x1,y1,x2,y2,u,v,a,sp;if(fx===d3_geom_pointX&&y===d3_geom_pointY)vertices=data;else for(i=0,vertices=[];i<n;++i){vertices.push([+fx.call(this,d=data[i],i),+fy.call(this,d,i)])}for(i=1;i<n;++i){if(vertices[i][1]<vertices[h][1]||vertices[i][1]==vertices[h][1]&&vertices[i][0]<vertices[h][0])h=i}for(i=0;i<n;++i){if(i===h)continue;y1=vertices[i][1]-vertices[h][1];x1=vertices[i][0]-vertices[h][0];points.push({angle:Math.atan2(y1,x1),index:i})}points.sort(function(a,b){return a.angle-b.angle});a=points[0].angle;v=points[0].index;u=0;for(i=1;i<plen;++i){j=points[i].index;if(a==points[i].angle){x1=vertices[v][0]-vertices[h][0];y1=vertices[v][1]-vertices[h][1];x2=vertices[j][0]-vertices[h][0];y2=vertices[j][1]-vertices[h][1];if(x1*x1+y1*y1>=x2*x2+y2*y2){points[i].index=-1;continue}else{points[u].index=-1}}a=points[i].angle;u=i;v=j}stack.push(h);for(i=0,j=0;i<2;++j){if(points[j].index>-1){stack.push(points[j].index);i++}}sp=stack.length;for(;j<plen;++j){if(points[j].index<0)continue;while(!d3_geom_hullCCW(stack[sp-2],stack[sp-1],points[j].index,vertices)){--sp}stack[sp++]=points[j].index}var poly=[];for(i=sp-1;i>=0;--i)poly.push(data[stack[i]]);return poly}hull.x=function(_){return arguments.length?(x=_,hull):x};hull.y=function(_){return arguments.length?(y=_,hull):y};return hull};function d3_geom_hullCCW(i1,i2,i3,v){var t,a,b,c,d,e,f;t=v[i1];a=t[0];b=t[1];t=v[i2];c=t[0];d=t[1];t=v[i3];e=t[0];f=t[1];return(f-b)*(c-a)-(d-b)*(e-a)>0}d3.geom.polygon=function(coordinates){d3_subclass(coordinates,d3_geom_polygonPrototype);return coordinates};var d3_geom_polygonPrototype=d3.geom.polygon.prototype=[];d3_geom_polygonPrototype.area=function(){var i=-1,n=this.length,a,b=this[n-1],area=0;while(++i<n){a=b;b=this[i];area+=a[1]*b[0]-a[0]*b[1]}return area*.5};d3_geom_polygonPrototype.centroid=function(k){var i=-1,n=this.length,x=0,y=0,a,b=this[n-1],c;if(!arguments.length)k=-1/(6*this.area());while(++i<n){a=b;b=this[i];c=a[0]*b[1]-b[0]*a[1];x+=(a[0]+b[0])*c;y+=(a[1]+b[1])*c}return[x*k,y*k]};d3_geom_polygonPrototype.clip=function(subject){var input,closed=d3_geom_polygonClosed(subject),i=-1,n=this.length-d3_geom_polygonClosed(this),j,m,a=this[n-1],b,c,d;while(++i<n){input=subject.slice();subject.length=0;b=this[i];c=input[(m=input.length-closed)-1];j=-1;while(++j<m){d=input[j];if(d3_geom_polygonInside(d,a,b)){if(!d3_geom_polygonInside(c,a,b)){subject.push(d3_geom_polygonIntersect(c,d,a,b))}subject.push(d)}else if(d3_geom_polygonInside(c,a,b)){subject.push(d3_geom_polygonIntersect(c,d,a,b))}c=d}if(closed)subject.push(subject[0]);a=b}return subject};function d3_geom_polygonInside(p,a,b){return(b[0]-a[0])*(p[1]-a[1])<(b[1]-a[1])*(p[0]-a[0])}function d3_geom_polygonIntersect(c,d,a,b){var x1=c[0],x3=a[0],x21=d[0]-x1,x43=b[0]-x3,y1=c[1],y3=a[1],y21=d[1]-y1,y43=b[1]-y3,ua=(x43*(y1-y3)-y43*(x1-x3))/(y43*x21-x43*y21);return[x1+ua*x21,y1+ua*y21]}function d3_geom_polygonClosed(coordinates){var a=coordinates[0],b=coordinates[coordinates.length-1];return!(a[0]-b[0]||a[1]-b[1])}var d3_geom_voronoiEdges,d3_geom_voronoiCells,d3_geom_voronoiBeaches,d3_geom_voronoiBeachPool=[],d3_geom_voronoiFirstCircle,d3_geom_voronoiCircles,d3_geom_voronoiCirclePool=[];function d3_geom_voronoiBeach(){d3_geom_voronoiRedBlackNode(this);this.edge=this.site=this.circle=null}function d3_geom_voronoiCreateBeach(site){var beach=d3_geom_voronoiBeachPool.pop()||new d3_geom_voronoiBeach;beach.site=site;return beach}function d3_geom_voronoiDetachBeach(beach){d3_geom_voronoiDetachCircle(beach);d3_geom_voronoiBeaches.remove(beach);d3_geom_voronoiBeachPool.push(beach);d3_geom_voronoiRedBlackNode(beach)}function d3_geom_voronoiRemoveBeach(beach){var circle=beach.circle,x=circle.x,y=circle.cy,vertex={x:x,y:y},previous=beach.P,next=beach.N,disappearing=[beach];d3_geom_voronoiDetachBeach(beach);var lArc=previous;while(lArc.circle&&abs(x-lArc.circle.x)<&&abs(y-lArc.circle.cy)<){previous=lArc.P;disappearing.unshift(lArc);d3_geom_voronoiDetachBeach(lArc);lArc=previous}disappearing.unshift(lArc);d3_geom_voronoiDetachCircle(lArc);var rArc=next;while(rArc.circle&&abs(x-rArc.circle.x)<&&abs(y-rArc.circle.cy)<){next=rArc.N;disappearing.push(rArc);d3_geom_voronoiDetachBeach(rArc);rArc=next}disappearing.push(rArc);d3_geom_voronoiDetachCircle(rArc);var nArcs=disappearing.length,iArc;for(iArc=1;iArc<nArcs;++iArc){rArc=disappearing[iArc];lArc=disappearing[iArc-1];d3_geom_voronoiSetEdgeEnd(rArc.edge,lArc.site,rArc.site,vertex)}lArc=disappearing[0];rArc=disappearing[nArcs-1];rArc.edge=d3_geom_voronoiCreateEdge(lArc.site,rArc.site,null,vertex);d3_geom_voronoiAttachCircle(lArc);d3_geom_voronoiAttachCircle(rArc)}function d3_geom_voronoiAddBeach(site){var x=site.x,directrix=site.y,lArc,rArc,dxl,dxr,node=d3_geom_voronoiBeaches._;while(node){dxl=d3_geom_voronoiLeftBreakPoint(node,directrix)-x;if(dxl>)node=node.L;else{dxr=x-d3_geom_voronoiRightBreakPoint(node,directrix);if(dxr>){if(!node.R){lArc=node;break}node=node.R}else{if(dxl>-){lArc=node.P;rArc=node}else if(dxr>-){lArc=node;rArc=node.N}else{lArc=rArc=node}break}}}var newArc=d3_geom_voronoiCreateBeach(site);d3_geom_voronoiBeaches.insert(lArc,newArc);if(!lArc&&!rArc)return;if(lArc===rArc){d3_geom_voronoiDetachCircle(lArc);rArc=d3_geom_voronoiCreateBeach(lArc.site);d3_geom_voronoiBeaches.insert(newArc,rArc);newArc.edge=rArc.edge=d3_geom_voronoiCreateEdge(lArc.site,newArc.site);d3_geom_voronoiAttachCircle(lArc);d3_geom_voronoiAttachCircle(rArc);return}if(!rArc){newArc.edge=d3_geom_voronoiCreateEdge(lArc.site,newArc.site);return}d3_geom_voronoiDetachCircle(lArc);d3_geom_voronoiDetachCircle(rArc);var lSite=lArc.site,ax=lSite.x,ay=lSite.y,bx=site.x-ax,by=site.y-ay,rSite=rArc.site,cx=rSite.x-ax,cy=rSite.y-ay,d=2*(bx*cy-by*cx),hb=bx*bx+by*by,hc=cx*cx+cy*cy,vertex={x:(cy*hb-by*hc)/d+ax,y:(bx*hc-cx*hb)/d+ay};d3_geom_voronoiSetEdgeEnd(rArc.edge,lSite,rSite,vertex);newArc.edge=d3_geom_voronoiCreateEdge(lSite,site,null,vertex);rArc.edge=d3_geom_voronoiCreateEdge(site,rSite,null,vertex);d3_geom_voronoiAttachCircle(lArc);d3_geom_voronoiAttachCircle(rArc)}function d3_geom_voronoiLeftBreakPoint(arc,directrix){var site=arc.site,rfocx=site.x,rfocy=site.y,pby2=rfocy-directrix;if(!pby2)return rfocx;var lArc=arc.P;if(!lArc)return-Infinity;site=lArc.site;var lfocx=site.x,lfocy=site.y,plby2=lfocy-directrix;if(!plby2)return lfocx;var hl=lfocx-rfocx,aby2=1/pby2-1/plby2,b=hl/plby2;if(aby2)return(-b+Math.sqrt(b*b-2*aby2*(hl*hl/(-2*plby2)-lfocy+plby2/2+rfocy-pby2/2)))/aby2+rfocx;return(rfocx+lfocx)/2}function d3_geom_voronoiRightBreakPoint(arc,directrix){var rArc=arc.N;if(rArc)return d3_geom_voronoiLeftBreakPoint(rArc,directrix);var site=arc.site;return site.y===directrix?site.x:Infinity}function d3_geom_voronoiCell(site){this.site=site;this.edges=[]}d3_geom_voronoiCell.prototype.prepare=function(){var halfEdges=this.edges,iHalfEdge=halfEdges.length,edge;while(iHalfEdge--){edge=halfEdges[iHalfEdge].edge;if(!edge.b||!edge.a)halfEdges.splice(iHalfEdge,1)}halfEdges.sort(d3_geom_voronoiHalfEdgeOrder);return halfEdges.length};function d3_geom_voronoiCloseCells(extent){var x0=extent[0][0],x1=extent[1][0],y0=extent[0][1],y1=extent[1][1],x2,y2,x3,y3,cells=d3_geom_voronoiCells,iCell=cells.length,cell,iHalfEdge,halfEdges,nHalfEdges,start,end;while(iCell--){cell=cells[iCell];if(!cell||!cell.prepare())continue;halfEdges=cell.edges;nHalfEdges=halfEdges.length;iHalfEdge=0;while(iHalfEdge<nHalfEdges){end=halfEdges[iHalfEdge].end(),x3=end.x,y3=end.y;start=halfEdges[++iHalfEdge%nHalfEdges].start(),x2=start.x,y2=start.y;if(abs(x3-x2)>||abs(y3-y2)>){halfEdges.splice(iHalfEdge,0,new d3_geom_voronoiHalfEdge(d3_geom_voronoiCreateBorderEdge(cell.site,end,abs(x3-x0)<&&y1-y3>?{x:x0,y:abs(x2-x0)<?y2:y1}:abs(y3-y1)<&&x1-x3>?{x:abs(y2-y1)<?x2:x1,y:y1}:abs(x3-x1)<&&y3-y0>?{x:x1,y:abs(x2-x1)<?y2:y0}:abs(y3-y0)<&&x3-x0>?{x:abs(y2-y0)<?x2:x0,y:y0}:null),cell.site,null));++nHalfEdges}}}}function d3_geom_voronoiHalfEdgeOrder(a,b){return b.angle-a.angle}function d3_geom_voronoiCircle(){d3_geom_voronoiRedBlackNode(this);this.x=this.y=this.arc=this.site=this.cy=null}function d3_geom_voronoiAttachCircle(arc){var lArc=arc.P,rArc=arc.N;if(!lArc||!rArc)return;var lSite=lArc.site,cSite=arc.site,rSite=rArc.site;if(lSite===rSite)return;var bx=cSite.x,by=cSite.y,ax=lSite.x-bx,ay=lSite.y-by,cx=rSite.x-bx,cy=rSite.y-by;var d=2*(ax*cy-ay*cx);if(d>=-2)return;var ha=ax*ax+ay*ay,hc=cx*cx+cy*cy,x=(cy*ha-ay*hc)/d,y=(ax*hc-cx*ha)/d,cy=y+by;var circle=d3_geom_voronoiCirclePool.pop()||new d3_geom_voronoiCircle;circle.arc=arc;circle.site=cSite;circle.x=x+bx;circle.y=cy+Math.sqrt(x*x+y*y);circle.cy=cy;arc.circle=circle;var before=null,node=d3_geom_voronoiCircles._;while(node){if(circle.y<node.y||circle.y===node.y&&circle.x<=node.x){if(node.L)node=node.L;else{before=node.P;break}}else{if(node.R)node=node.R;else{before=node;break}}}d3_geom_voronoiCircles.insert(before,circle);if(!before)d3_geom_voronoiFirstCircle=circle}function d3_geom_voronoiDetachCircle(arc){var circle=arc.circle;if(circle){if(!circle.P)d3_geom_voronoiFirstCircle=circle.N;d3_geom_voronoiCircles.remove(circle);d3_geom_voronoiCirclePool.push(circle);d3_geom_voronoiRedBlackNode(circle);arc.circle=null}}function d3_geom_voronoiClipEdges(extent){var edges=d3_geom_voronoiEdges,clip=d3_geom_clipLine(extent[0][0],extent[0][1],extent[1][0],extent[1][1]),i=edges.length,e;while(i--){e=edges[i];if(!d3_geom_voronoiConnectEdge(e,extent)||!clip(e)||abs(e.a.x-e.b.x)<&&abs(e.a.y-e.b.y)<){e.a=e.b=null;edges.splice(i,1)}}}function d3_geom_voronoiConnectEdge(edge,extent){var vb=edge.b;if(vb)return true;var va=edge.a,x0=extent[0][0],x1=extent[1][0],y0=extent[0][1],y1=extent[1][1],lSite=edge.l,rSite=edge.r,lx=lSite.x,ly=lSite.y,rx=rSite.x,ry=rSite.y,fx=(lx+rx)/2,fy=(ly+ry)/2,fm,fb;if(ry===ly){if(fx<x0||fx>=x1)return;if(lx>rx){if(!va)va={x:fx,y:y0};else if(va.y>=y1)return;vb={x:fx,y:y1}}else{if(!va)va={x:fx,y:y1};else if(va.y<y0)return;vb={x:fx,y:y0}}}else{fm=(lx-rx)/(ry-ly);fb=fy-fm*fx;if(fm<-1||fm>1){if(lx>rx){if(!va)va={x:(y0-fb)/fm,y:y0};else if(va.y>=y1)return;vb={x:(y1-fb)/fm,y:y1}}else{if(!va)va={x:(y1-fb)/fm,y:y1};else if(va.y<y0)return;vb={x:(y0-fb)/fm,y:y0}}}else{if(ly<ry){if(!va)va={x:x0,y:fm*x0+fb};else if(va.x>=x1)return;vb={x:x1,y:fm*x1+fb}}else{if(!va)va={x:x1,y:fm*x1+fb};else if(va.x<x0)return;vb={x:x0,y:fm*x0+fb}}}}edge.a=va;edge.b=vb;return true}function d3_geom_voronoiEdge(lSite,rSite){this.l=lSite;this.r=rSite;this.a=this.b=null}function d3_geom_voronoiCreateEdge(lSite,rSite,va,vb){var edge=new d3_geom_voronoiEdge(lSite,rSite);d3_geom_voronoiEdges.push(edge);if(va)d3_geom_voronoiSetEdgeEnd(edge,lSite,rSite,va);if(vb)d3_geom_voronoiSetEdgeEnd(edge,rSite,lSite,vb);d3_geom_voronoiCells[lSite.i].edges.push(new d3_geom_voronoiHalfEdge(edge,lSite,rSite));d3_geom_voronoiCells[rSite.i].edges.push(new d3_geom_voronoiHalfEdge(edge,rSite,lSite));return edge}function d3_geom_voronoiCreateBorderEdge(lSite,va,vb){var edge=new d3_geom_voronoiEdge(lSite,null);edge.a=va;edge.b=vb;d3_geom_voronoiEdges.push(edge);return edge}function d3_geom_voronoiSetEdgeEnd(edge,lSite,rSite,vertex){if(!edge.a&&!edge.b){edge.a=vertex;edge.l=lSite;edge.r=rSite}else if(edge.l===rSite){edge.b=vertex}else{edge.a=vertex}}function d3_geom_voronoiHalfEdge(edge,lSite,rSite){var va=edge.a,vb=edge.b;this.edge=edge;this.site=lSite;this.angle=rSite?Math.atan2(rSite.y-lSite.y,rSite.x-lSite.x):edge.l===lSite?Math.atan2(vb.x-va.x,va.y-vb.y):Math.atan2(va.x-vb.x,vb.y-va.y)}d3_geom_voronoiHalfEdge.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}};function d3_geom_voronoiRedBlackTree(){this._=null}function d3_geom_voronoiRedBlackNode(node){node.U=node.C=node.L=node.R=node.P=node.N=null}d3_geom_voronoiRedBlackTree.prototype={insert:function(after,node){var parent,grandpa,uncle;if(after){node.P=after;node.N=after.N;if(after.N)after.N.P=node;after.N=node;if(after.R){after=after.R;while(after.L)after=after.L;after.L=node}else{after.R=node}parent=after}else if(this._){after=d3_geom_voronoiRedBlackFirst(this._);node.P=null;node.N=after;after.P=after.L=node;parent=after}else{node.P=node.N=null;this._=node;parent=null}node.L=node.R=null;node.U=parent;node.C=true;after=node;while(parent&&parent.C){grandpa=parent.U;if(parent===grandpa.L){uncle=grandpa.R;if(uncle&&uncle.C){parent.C=uncle.C=false;grandpa.C=true;after=grandpa}else{if(after===parent.R){d3_geom_voronoiRedBlackRotateLeft(this,parent);after=parent;parent=after.U}parent.C=false;grandpa.C=true;d3_geom_voronoiRedBlackRotateRight(this,grandpa)}}else{uncle=grandpa.L;if(uncle&&uncle.C){parent.C=uncle.C=false;grandpa.C=true;after=grandpa}else{if(after===parent.L){d3_geom_voronoiRedBlackRotateRight(this,parent);after=parent;parent=after.U}parent.C=false;grandpa.C=true;d3_geom_voronoiRedBlackRotateLeft(this,grandpa)}}parent=after.U}this._.C=false},remove:function(node){if(node.N)node.N.P=node.P;if(node.P)node.P.N=node.N;node.N=node.P=null;var parent=node.U,sibling,left=node.L,right=node.R,next,red;if(!left)next=right;else if(!right)next=left;else next=d3_geom_voronoiRedBlackFirst(right);if(parent){if(parent.L===node)parent.L=next;else parent.R=next}else{this._=next}if(left&&right){red=next.C;next.C=node.C;next.L=left;left.U=next;if(next!==right){parent=next.U;next.U=node.U;node=next.R;parent.L=node;next.R=right;right.U=next}else{next.U=parent;parent=next;node=next.R}}else{red=node.C;node=next}if(node)node.U=parent;if(red)return;if(node&&node.C){node.C=false;return}do{if(node===this._)break;if(node===parent.L){sibling=parent.R;if(sibling.C){sibling.C=false;parent.C=true;d3_geom_voronoiRedBlackRotateLeft(this,parent);sibling=parent.R}if(sibling.L&&sibling.L.C||sibling.R&&sibling.R.C){if(!sibling.R||!sibling.R.C){sibling.L.C=false;sibling.C=true;d3_geom_voronoiRedBlackRotateRight(this,sibling);sibling=parent.R}sibling.C=parent.C;parent.C=sibling.R.C=false;d3_geom_voronoiRedBlackRotateLeft(this,parent);node=this._;break}}else{sibling=parent.L;if(sibling.C){sibling.C=false;parent.C=true;d3_geom_voronoiRedBlackRotateRight(this,parent);sibling=parent.L}if(sibling.L&&sibling.L.C||sibling.R&&sibling.R.C){if(!sibling.L||!sibling.L.C){sibling.R.C=false;sibling.C=true;d3_geom_voronoiRedBlackRotateLeft(this,sibling);sibling=parent.L}sibling.C=parent.C;parent.C=sibling.L.C=false;d3_geom_voronoiRedBlackRotateRight(this,parent);node=this._;break}}sibling.C=true;node=parent;parent=parent.U}while(!node.C);if(node)node.C=false}};function d3_geom_voronoiRedBlackRotateLeft(tree,node){var p=node,q=node.R,parent=p.U;if(parent){if(parent.L===p)parent.L=q;else parent.R=q}else{tree._=q}q.U=parent;p.U=q;p.R=q.L;if(p.R)p.R.U=p;q.L=p}function d3_geom_voronoiRedBlackRotateRight(tree,node){var p=node,q=node.L,parent=p.U;if(parent){if(parent.L===p)parent.L=q;else parent.R=q}else{tree._=q}q.U=parent;p.U=q;p.L=q.R;if(p.L)p.L.U=p;q.R=p}function d3_geom_voronoiRedBlackFirst(node){while(node.L)node=node.L;return node}function d3_geom_voronoi(sites,bbox){var site=sites.sort(d3_geom_voronoiVertexOrder).pop(),x0,y0,circle;d3_geom_voronoiEdges=[];d3_geom_voronoiCells=new Array(sites.length);d3_geom_voronoiBeaches=new d3_geom_voronoiRedBlackTree;d3_geom_voronoiCircles=new d3_geom_voronoiRedBlackTree;while(true){circle=d3_geom_voronoiFirstCircle;if(site&&(!circle||site.y<circle.y||site.y===circle.y&&site.x<circle.x)){if(site.x!==x0||site.y!==y0){d3_geom_voronoiCells[site.i]=new d3_geom_voronoiCell(site);d3_geom_voronoiAddBeach(site);x0=site.x,y0=site.y}site=sites.pop()}else if(circle){d3_geom_voronoiRemoveBeach(circle.arc)}else{break}}if(bbox)d3_geom_voronoiClipEdges(bbox),d3_geom_voronoiCloseCells(bbox);var diagram={cells:d3_geom_voronoiCells,edges:d3_geom_voronoiEdges};d3_geom_voronoiBeaches=d3_geom_voronoiCircles=d3_geom_voronoiEdges=d3_geom_voronoiCells=null;return diagram}function d3_geom_voronoiVertexOrder(a,b){return b.y-a.y||b.x-a.x}d3.geom.voronoi=function(points){var x=d3_geom_pointX,y=d3_geom_pointY,fx=x,fy=y,clipExtent=d3_geom_voronoiClipExtent;if(points)return voronoi(points);function voronoi(data){var polygons=new Array(data.length),x0=clipExtent[0][0],y0=clipExtent[0][1],x1=clipExtent[1][0],y1=clipExtent[1][1];d3_geom_voronoi(sites(data),clipExtent).cells.forEach(function(cell,i){var edges=cell.edges,site=cell.site,polygon=polygons[i]=edges.length?edges.map(function(e){var s=e.start();return[s.x,s.y]}):site.x>=x0&&site.x<=x1&&site.y>=y0&&site.y<=y1?[[x0,y1],[x1,y1],[x1,y0],[x0,y0]]:[];polygon.point=data[i]});return polygons}function sites(data){return data.map(function(d,i){return{x:Math.round(fx(d,i)/)*,y:Math.round(fy(d,i)/)*,i:i}})}voronoi.links=function(data){return d3_geom_voronoi(sites(data)).edges.filter(function(edge){return edge.l&&edge.r}).map(function(edge){return{source:data[edge.l.i],target:data[edge.r.i]}})};voronoi.triangles=function(data){var triangles=[];d3_geom_voronoi(sites(data)).cells.forEach(function(cell,i){var site=cell.site,edges=cell.edges.sort(d3_geom_voronoiHalfEdgeOrder),j=-1,m=edges.length,e0,s0,e1=edges[m-1].edge,s1=e1.l===site?e1.r:e1.l;while(++j<m){e0=e1;s0=s1;e1=edges[j].edge;s1=e1.l===site?e1.r:e1.l;if(i<s0.i&&i<s1.i&&d3_geom_voronoiTriangleArea(site,s0,s1)<0){triangles.push([data[i],data[s0.i],data[s1.i]])}}});return triangles};voronoi.x=function(_){return arguments.length?(fx=d3_functor(x=_),voronoi):x};voronoi.y=function(_){return arguments.length?(fy=d3_functor(y=_),voronoi):y};voronoi.clipExtent=function(_){if(!arguments.length)return clipExtent===d3_geom_voronoiClipExtent?null:clipExtent;clipExtent=_==null?d3_geom_voronoiClipExtent:_;return voronoi};voronoi.size=function(_){if(!arguments.length)return clipExtent===d3_geom_voronoiClipExtent?null:clipExtent&&clipExtent[1];return voronoi.clipExtent(_&&[[0,0],_])};return voronoi};var d3_geom_voronoiClipExtent=[[-1e6,-1e6],[1e6,1e6]];function d3_geom_voronoiTriangleArea(a,b,c){return(a.x-c.x)*(b.y-a.y)-(a.x-b.x)*(c.y-a.y)}d3.geom.delaunay=function(vertices){return d3.geom.voronoi().triangles(vertices)};d3.geom.quadtree=function(points,x1,y1,x2,y2){var x=d3_geom_pointX,y=d3_geom_pointY,compat;if(compat=arguments.length){x=d3_geom_quadtreeCompatX;y=d3_geom_quadtreeCompatY;if(compat===3){y2=y1;x2=x1;y1=x1=0}return quadtree(points)}function quadtree(data){var d,fx=d3_functor(x),fy=d3_functor(y),xs,ys,i,n,x1_,y1_,x2_,y2_;if(x1!=null){x1_=x1,y1_=y1,x2_=x2,y2_=y2}else{x2_=y2_=-(x1_=y1_=Infinity);xs=[],ys=[];n=data.length;if(compat)for(i=0;i<n;++i){d=data[i];if(d.x<x1_)x1_=d.x;if(d.y<y1_)y1_=d.y;if(d.x>x2_)x2_=d.x;if(d.y>y2_)y2_=d.y;xs.push(d.x);ys.push(d.y)}else for(i=0;i<n;++i){var x_=+fx(d=data[i],i),y_=+fy(d,i);if(x_<x1_)x1_=x_;if(y_<y1_)y1_=y_;if(x_>x2_)x2_=x_;if(y_>y2_)y2_=y_;xs.push(x_);ys.push(y_)}}var dx=x2_-x1_,dy=y2_-y1_;if(dx>dy)y2_=y1_+dx;else x2_=x1_+dy;function insert(n,d,x,y,x1,y1,x2,y2){if(isNaN(x)||isNaN(y))return;if(n.leaf){var nx=n.x,ny=n.y;if(nx!=null){if(abs(nx-x)+abs(ny-y)<.01){insertChild(n,d,x,y,x1,y1,x2,y2)}else{var nPoint=n.point;n.x=n.y=n.point=null;insertChild(n,nPoint,nx,ny,x1,y1,x2,y2);insertChild(n,d,x,y,x1,y1,x2,y2)}}else{n.x=x,n.y=y,n.point=d}}else{insertChild(n,d,x,y,x1,y1,x2,y2)}}function insertChild(n,d,x,y,x1,y1,x2,y2){var sx=(x1+x2)*.5,sy=(y1+y2)*.5,right=x>=sx,bottom=y>=sy,i=(bottom<<1)+right;n.leaf=false;n=n.nodes[i]||(n.nodes[i]=d3_geom_quadtreeNode());if(right)x1=sx;else x2=sx;if(bottom)y1=sy;else y2=sy;insert(n,d,x,y,x1,y1,x2,y2)}var root=d3_geom_quadtreeNode();root.add=function(d){insert(root,d,+fx(d,++i),+fy(d,i),x1_,y1_,x2_,y2_)};root.visit=function(f){d3_geom_quadtreeVisit(f,root,x1_,y1_,x2_,y2_)};i=-1;if(x1==null){while(++i<n){insert(root,data[i],xs[i],ys[i],x1_,y1_,x2_,y2_)}--i}else data.forEach(root.add);xs=ys=data=d=null;return root}quadtree.x=function(_){return arguments.length?(x=_,quadtree):x};quadtree.y=function(_){return arguments.length?(y=_,quadtree):y};quadtree.extent=function(_){if(!arguments.length)return x1==null?null:[[x1,y1],[x2,y2]];if(_==null)x1=y1=x2=y2=null;else x1=+_[0][0],y1=+_[0][1],x2=+_[1][0],y2=+_[1][1];return quadtree};quadtree.size=function(_){if(!arguments.length)return x1==null?null:[x2-x1,y2-y1];if(_==null)x1=y1=x2=y2=null;else x1=y1=0,x2=+_[0],y2=+_[1];return quadtree};return quadtree};function d3_geom_quadtreeCompatX(d){return d.x}function d3_geom_quadtreeCompatY(d){return d.y}function d3_geom_quadtreeNode(){return{leaf:true,nodes:[],point:null,x:null,y:null}}function d3_geom_quadtreeVisit(f,node,x1,y1,x2,y2){if(!f(node,x1,y1,x2,y2)){var sx=(x1+x2)*.5,sy=(y1+y2)*.5,children=node.nodes;if(children[0])d3_geom_quadtreeVisit(f,children[0],x1,y1,sx,sy);if(children[1])d3_geom_quadtreeVisit(f,children[1],sx,y1,x2,sy);if(children[2])d3_geom_quadtreeVisit(f,children[2],x1,sy,sx,y2);if(children[3])d3_geom_quadtreeVisit(f,children[3],sx,sy,x2,y2)}}d3.interpolateRgb=d3_interpolateRgb;function d3_interpolateRgb(a,b){a=d3.rgb(a);b=d3.rgb(b);var ar=a.r,ag=a.g,ab=a.b,br=b.r-ar,bg=b.g-ag,bb=b.b-ab;return function(t){return"#"+d3_rgb_hex(Math.round(ar+br*t))+d3_rgb_hex(Math.round(ag+bg*t))+d3_rgb_hex(Math.round(ab+bb*t))}}d3.interpolateObject=d3_interpolateObject;function d3_interpolateObject(a,b){var i={},c={},k;for(k in a){if(k in b){i[k]=d3_interpolate(a[k],b[k])}else{c[k]=a[k]}}for(k in b){if(!(k in a)){c[k]=b[k]}}return function(t){for(k in i)c[k]=i[k](t);return c}}d3.interpolateNumber=d3_interpolateNumber;function d3_interpolateNumber(a,b){b-=a=+a;return function(t){return a+b*t}}d3.interpolateString=d3_interpolateString;function d3_interpolateString(a,b){var m,i,j,s0=0,s1=0,s=[],q=[],n,o;a=a+"",b=b+"";d3_interpolate_number.lastIndex=0;for(i=0;m=d3_interpolate_number.exec(b);++i){if(m.index)s.push(b.substring(s0,s1=m.index));q.push({i:s.length,x:m[0]});s.push(null);s0=d3_interpolate_number.lastIndex}if(s0<b.length)s.push(b.substring(s0));for(i=0,n=q.length;(m=d3_interpolate_number.exec(a))&&i<n;++i){o=q[i];if(o.x==m[0]){if(o.i){if(s[o.i+1]==null){s[o.i-1]+=o.x;s.splice(o.i,1);for(j=i+1;j<n;++j)q[j].i--}else{s[o.i-1]+=o.x+s[o.i+1];s.splice(o.i,2);for(j=i+1;j<n;++j)q[j].i-=2}}else{if(s[o.i+1]==null){s[o.i]=o.x}else{s[o.i]=o.x+s[o.i+1];s.splice(o.i+1,1);for(j=i+1;j<n;++j)q[j].i--}}q.splice(i,1);n--;i--}else{o.x=d3_interpolateNumber(parseFloat(m[0]),parseFloat(o.x))}}while(i<n){o=q.pop();if(s[o.i+1]==null){s[o.i]=o.x}else{s[o.i]=o.x+s[o.i+1];s.splice(o.i+1,1)}n--}if(s.length===1){return s[0]==null?(o=q[0].x,function(t){return o(t)+""}):function(){return b}}return function(t){for(i=0;i<n;++i)s[(o=q[i]).i]=o.x(t);return s.join("")}}var d3_interpolate_number=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g;d3.interpolate=d3_interpolate;function d3_interpolate(a,b){var i=d3.interpolators.length,f;while(--i>=0&&!(f=d3.interpolators[i](a,b)));return f}d3.interpolators=[function(a,b){var t=typeof b;return(t==="string"?d3_rgb_names.has(b)||/^(#|rgb\(|hsl\()/.test(b)?d3_interpolateRgb:d3_interpolateString:b instanceof d3_Color?d3_interpolateRgb:t==="object"?Array.isArray(b)?d3_interpolateArray:d3_interpolateObject:d3_interpolateNumber)(a,b)}];d3.interpolateArray=d3_interpolateArray;function d3_interpolateArray(a,b){var x=[],c=[],na=a.length,nb=b.length,n0=Math.min(a.length,b.length),i;for(i=0;i<n0;++i)x.push(d3_interpolate(a[i],b[i]));for(;i<na;++i)c[i]=a[i];for(;i<nb;++i)c[i]=b[i];return function(t){for(i=0;i<n0;++i)c[i]=x[i](t);return c}}var d3_ease_default=function(){return d3_identity};var d3_ease=d3.map({linear:d3_ease_default,poly:d3_ease_poly,quad:function(){return d3_ease_quad},cubic:function(){return d3_ease_cubic},sin:function(){return d3_ease_sin},exp:function(){return d3_ease_exp},circle:function(){return d3_ease_circle},elastic:d3_ease_elastic,back:d3_ease_back,bounce:function(){return d3_ease_bounce}});var d3_ease_mode=d3.map({in:d3_identity,out:d3_ease_reverse,"in-out":d3_ease_reflect,"out-in":function(f){return d3_ease_reflect(d3_ease_reverse(f))}});d3.ease=function(name){var i=name.indexOf("-"),t=i>=0?name.substring(0,i):name,m=i>=0?name.substring(i+1):"in";t=d3_ease.get(t)||d3_ease_default;m=d3_ease_mode.get(m)||d3_identity;return d3_ease_clamp(m(t.apply(null,d3_arraySlice.call(arguments,1))))};function d3_ease_clamp(f){return function(t){return t<=0?0:t>=1?1:f(t)}}function d3_ease_reverse(f){return function(t){return 1-f(1-t)}}function d3_ease_reflect(f){return function(t){return.5*(t<.5?f(2*t):2-f(2-2*t))}}function d3_ease_quad(t){return t*t}function d3_ease_cubic(t){return t*t*t}function d3_ease_cubicInOut(t){if(t<=0)return 0;if(t>=1)return 1;var t2=t*t,t3=t2*t;return 4*(t<.5?t3:3*(t-t2)+t3-.75)}function d3_ease_poly(e){return function(t){return Math.pow(t,e)}}function d3_ease_sin(t){return 1-Math.cos(t*half)}function d3_ease_exp(t){return Math.pow(2,10*(t-1))}function d3_ease_circle(t){return 1-Math.sqrt(1-t*t)}function d3_ease_elastic(a,p){var s;if(arguments.length<2)p=.45;if(arguments.length)s=p/*Math.asin(1/a);else a=1,s=p/4;return function(t){return 1+a*Math.pow(2,-10*t)*Math.sin((t-s)*/p)}}function d3_ease_back(s){if(!s)s=1.70158;return function(t){return t*t*((s+1)*t-s)}}function d3_ease_bounce(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}d3.interpolateHcl=d3_interpolateHcl;function d3_interpolateHcl(a,b){a=d3.hcl(a);b=d3.hcl(b);var ah=a.h,ac=a.c,al=a.l,bh=b.h-ah,bc=b.c-ac,bl=b.l-al;if(isNaN(bc))bc=0,ac=isNaN(ac)?b.c:ac;if(isNaN(bh))bh=0,ah=isNaN(ah)?b.h:ah;else if(bh>180)bh-=360;else if(bh<-180)bh+=360;return function(t){return d3_hcl_lab(ah+bh*t,ac+bc*t,al+bl*t)+""}}d3.interpolateHsl=d3_interpolateHsl;function d3_interpolateHsl(a,b){a=d3.hsl(a);b=d3.hsl(b);var ah=a.h,as=a.s,al=a.l,bh=b.h-ah,bs=b.s-as,bl=b.l-al;if(isNaN(bs))bs=0,as=isNaN(as)?b.s:as;if(isNaN(bh))bh=0,ah=isNaN(ah)?b.h:ah;else if(bh>180)bh-=360;else if(bh<-180)bh+=360;return function(t){return d3_hsl_rgb(ah+bh*t,as+bs*t,al+bl*t)+""}}d3.interpolateLab=d3_interpolateLab;function d3_interpolateLab(a,b){a=d3.lab(a);b=d3.lab(b);var al=a.l,aa=a.a,ab=a.b,bl=b.l-al,ba=b.a-aa,bb=b.b-ab;return function(t){return d3_lab_rgb(al+bl*t,aa+ba*t,ab+bb*t)+""}}d3.interpolateRound=d3_interpolateRound;function d3_interpolateRound(a,b){b-=a;return function(t){return Math.round(a+b*t)}}d3.transform=function(string){var g=d3_document.createElementNS(d3.ns.prefix.svg,"g");return(d3.transform=function(string){if(string!=null){g.setAttribute("transform",string);var t=g.transform.baseVal.consolidate()}return new d3_transform(t?t.matrix:d3_transformIdentity)})(string)};function d3_transform(m){var r0=[m.a,m.b],r1=[m.c,m.d],kx=d3_transformNormalize(r0),kz=d3_transformDot(r0,r1),ky=d3_transformNormalize(d3_transformCombine(r1,r0,-kz))||0;if(r0[0]*r1[1]<r1[0]*r0[1]){r0[0]*=-1;r0[1]*=-1;kx*=-1;kz*=-1}this.rotate=(kx?Math.atan2(r0[1],r0[0]):Math.atan2(-r1[0],r1[1]))*d3_degrees;this.translate=[m.e,m.f];this.scale=[kx,ky];this.skew=ky?Math.atan2(kz,ky)*d3_degrees:0}d3_transform.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};function d3_transformDot(a,b){return a[0]*b[0]+a[1]*b[1]}function d3_transformNormalize(a){var k=Math.sqrt(d3_transformDot(a,a));if(k){a[0]/=k;a[1]/=k}return k}function d3_transformCombine(a,b,k){a[0]+=k*b[0];a[1]+=k*b[1];return a}var d3_transformIdentity={a:1,b:0,c:0,d:1,e:0,f:0};d3.interpolateTransform=d3_interpolateTransform;function d3_interpolateTransform(a,b){var s=[],q=[],n,A=d3.transform(a),B=d3.transform(b),ta=A.translate,tb=B.translate,ra=A.rotate,rb=B.rotate,wa=A.skew,wb=B.skew,ka=A.scale,kb=B.scale;if(ta[0]!=tb[0]||ta[1]!=tb[1]){s.push("translate(",null,",",null,")");q.push({i:1,x:d3_interpolateNumber(ta[0],tb[0])},{i:3,x:d3_interpolateNumber(ta[1],tb[1])})}else if(tb[0]||tb[1]){s.push("translate("+tb+")")}else{s.push("")}if(ra!=rb){if(ra-rb>180)rb+=360;else if(rb-ra>180)ra+=360;q.push({i:s.push(s.pop()+"rotate(",null,")")-2,x:d3_interpolateNumber(ra,rb)})}else if(rb){s.push(s.pop()+"rotate("+rb+")")}if(wa!=wb){q.push({i:s.push(s.pop()+"skewX(",null,")")-2,x:d3_interpolateNumber(wa,wb)})}else if(wb){s.push(s.pop()+"skewX("+wb+")")}if(ka[0]!=kb[0]||ka[1]!=kb[1]){n=s.push(s.pop()+"scale(",null,",",null,")");q.push({i:n-4,x:d3_interpolateNumber(ka[0],kb[0])},{i:n-2,x:d3_interpolateNumber(ka[1],kb[1])})}else if(kb[0]!=1||kb[1]!=1){s.push(s.pop()+"scale("+kb+")")}n=q.length;return function(t){var i=-1,o;while(++i<n)s[(o=q[i]).i]=o.x(t);return s.join("")}}function d3_uninterpolateNumber(a,b){b=b-(a=+a)?1/(b-a):0;return function(x){return(x-a)*b}}function d3_uninterpolateClamp(a,b){b=b-(a=+a)?1/(b-a):0;return function(x){return Math.max(0,Math.min(1,(x-a)*b))}}d3.layout={};d3.layout.bundle=function(){return function(links){var paths=[],i=-1,n=links.length;while(++i<n)paths.push(d3_layout_bundlePath(links[i]));return paths}};function d3_layout_bundlePath(link){var start=link.source,end=link.target,lca=d3_layout_bundleLeastCommonAncestor(start,end),points=[start];while(start!==lca){start=start.parent;points.push(start)}var k=points.length;while(end!==lca){points.splice(k,0,end);end=end.parent}return points}function d3_layout_bundleAncestors(node){var ancestors=[],parent=node.parent;while(parent!=null){ancestors.push(node);node=parent;parent=parent.parent}ancestors.push(node);return ancestors}function d3_layout_bundleLeastCommonAncestor(a,b){if(a===b)return a;var aNodes=d3_layout_bundleAncestors(a),bNodes=d3_layout_bundleAncestors(b),aNode=aNodes.pop(),bNode=bNodes.pop(),sharedNode=null;while(aNode===bNode){sharedNode=aNode;aNode=aNodes.pop();bNode=bNodes.pop()}return sharedNode}d3.layout.chord=function(){var chord={},chords,groups,matrix,n,padding=0,sortGroups,sortSubgroups,sortChords;function relayout(){var subgroups={},groupSums=[],groupIndex=d3.range(n),subgroupIndex=[],k,x,x0,i,j;chords=[];groups=[];k=0,i=-1;while(++i<n){x=0,j=-1;while(++j<n){x+=matrix[i][j]}groupSums.push(x);subgroupIndex.push(d3.range(n));k+=x}if(sortGroups){groupIndex.sort(function(a,b){return sortGroups(groupSums[a],groupSums[b])})}if(sortSubgroups){subgroupIndex.forEach(function(d,i){d.sort(function(a,b){return sortSubgroups(matrix[i][a],matrix[i][b])})})}k=(-padding*n)/k;x=0,i=-1;while(++i<n){x0=x,j=-1;while(++j<n){var di=groupIndex[i],dj=subgroupIndex[di][j],v=matrix[di][dj],a0=x,a1=x+=v*k;subgroups[di+"-"+dj]={index:di,subindex:dj,startAngle:a0,endAngle:a1,value:v}}groups[di]={index:di,startAngle:x0,endAngle:x,value:(x-x0)/k};x+=padding}i=-1;while(++i<n){j=i-1;while(++j<n){var source=subgroups[i+"-"+j],target=subgroups[j+"-"+i];if(source.value||target.value){chords.push(source.value<target.value?{source:target,target:source}:{source:source,target:target})}}}if(sortChords)resort()}function resort(){chords.sort(function(a,b){return sortChords((a.source.value+a.target.value)/2,(b.source.value+b.target.value)/2)})}chord.matrix=function(x){if(!arguments.length)return matrix;n=(matrix=x)&&matrix.length;chords=groups=null;return chord};chord.padding=function(x){if(!arguments.length)return padding;padding=x;chords=groups=null;return chord};chord.sortGroups=function(x){if(!arguments.length)return sortGroups;sortGroups=x;chords=groups=null;return chord};chord.sortSubgroups=function(x){if(!arguments.length)return sortSubgroups;sortSubgroups=x;chords=null;return chord};chord.sortChords=function(x){if(!arguments.length)return sortChords;sortChords=x;if(chords)resort();return chord};chord.chords=function(){if(!chords)relayout();return chords};chord.groups=function(){if(!groups)relayout();return groups};return chord};d3.layout.force=function(){var force={},event=d3.dispatch("start","tick","end"),size=[1,1],drag,alpha,friction=.9,linkDistance=d3_layout_forceLinkDistance,linkStrength=d3_layout_forceLinkStrength,charge=-30,gravity=.1,theta=.8,nodes=[],links=[],distances,strengths,charges;function repulse(node){return function(quad,x1,_,x2){if(quad.point!==node){var dx=quad.cx-node.x,dy=quad.cy-node.y,dn=1/Math.sqrt(dx*dx+dy*dy);if((x2-x1)*dn<theta){var k=quad.charge*dn*dn;node.px-=dx*k;node.py-=dy*k;return true}if(quad.point&&isFinite(dn)){var k=quad.pointCharge*dn*dn;node.px-=dx*k;node.py-=dy*k}}return!quad.charge}}force.tick=function(){if((alpha*=.99)<.005){event.end({type:"end",alpha:alpha=0});return true}var n=nodes.length,m=links.length,q,i,o,s,t,l,k,x,y;for(i=0;i<m;++i){o=links[i];s=o.source;t=o.target;x=t.x-s.x;y=t.y-s.y;if(l=x*x+y*y){l=alpha*strengths[i]*((l=Math.sqrt(l))-distances[i])/l;x*=l;y*=l;t.x-=x*(k=s.weight/(t.weight+s.weight));t.y-=y*k;s.x+=x*(k=1-k);s.y+=y*k}}if(k=alpha*gravity){x=size[0]/2;y=size[1]/2;i=-1;if(k)while(++i<n){o=nodes[i];o.x+=(x-o.x)*k;o.y+=(y-o.y)*k}}if(charge){d3_layout_forceAccumulate(q=d3.geom.quadtree(nodes),alpha,charges);i=-1;while(++i<n){if(!(o=nodes[i]).fixed){q.visit(repulse(o))}}}i=-1;while(++i<n){o=nodes[i];if(o.fixed){o.x=o.px;o.y=o.py}else{o.x-=(o.px-(o.px=o.x))*friction;o.y-=(o.py-(o.py=o.y))*friction}}event.tick({type:"tick",alpha:alpha})};force.nodes=function(x){if(!arguments.length)return nodes;nodes=x;return force};force.links=function(x){if(!arguments.length)return links;links=x;return force};force.size=function(x){if(!arguments.length)return size;size=x;return force};force.linkDistance=function(x){if(!arguments.length)return linkDistance;linkDistance=typeof x==="function"?x:+x;return force};force.distance=force.linkDistance;force.linkStrength=function(x){if(!arguments.length)return linkStrength;linkStrength=typeof x==="function"?x:+x;return force};force.friction=function(x){if(!arguments.length)return friction;friction=+x;return force};force.charge=function(x){if(!arguments.length)return charge;charge=typeof x==="function"?x:+x;return force};force.gravity=function(x){if(!arguments.length)return gravity;gravity=+x;return force};force.theta=function(x){if(!arguments.length)return theta;theta=+x;return force};force.alpha=function(x){if(!arguments.length)return alpha;x=+x;if(alpha){if(x>0)alpha=x;else alpha=0}else if(x>0){event.start({type:"start",alpha:alpha=x});d3.timer(force.tick)}return force};force.start=function(){var i,n=nodes.length,m=links.length,w=size[0],h=size[1],neighbors,o;for(i=0;i<n;++i){(o=nodes[i]).index=i;o.weight=0}for(i=0;i<m;++i){o=links[i];if(typeof o.source=="number")o.source=nodes[o.source];if(typeof o.target=="number")o.target=nodes[o.target];++o.source.weight;++o.target.weight}for(i=0;i<n;++i){o=nodes[i];if(isNaN(o.x))o.x=position("x",w);if(isNaN(o.y))o.y=position("y",h);if(isNaN(o.px))o.px=o.x;if(isNaN(o.py))o.py=o.y}distances=[];if(typeof linkDistance==="function")for(i=0;i<m;++i)distances[i]=+linkDistance.call(this,links[i],i);else for(i=0;i<m;++i)distances[i]=linkDistance;strengths=[];if(typeof linkStrength==="function")for(i=0;i<m;++i)strengths[i]=+linkStrength.call(this,links[i],i);else for(i=0;i<m;++i)strengths[i]=linkStrength;charges=[];if(typeof charge==="function")for(i=0;i<n;++i)charges[i]=+charge.call(this,nodes[i],i);else for(i=0;i<n;++i)charges[i]=charge;function position(dimension,size){if(!neighbors){neighbors=new Array(n);for(j=0;j<n;++j){neighbors[j]=[]}for(j=0;j<m;++j){var o=links[j];neighbors[o.source.index].push(o.target);neighbors[o.target.index].push(o.source)}}var candidates=neighbors[i],j=-1,m=candidates.length,x;while(++j<m)if(!isNaN(x=candidates[j][dimension]))return x;return Math.random()*size}return force.resume()};force.resume=function(){return force.alpha(.1)};force.stop=function(){return force.alpha(0)};force.drag=function(){if(!drag)drag=d3.behavior.drag().origin(d3_identity).on("dragstart.force",d3_layout_forceDragstart).on("drag.force",dragmove).on("dragend.force",d3_layout_forceDragend);if(!arguments.length)return drag;this.on("mouseover.force",d3_layout_forceMouseover).on("mouseout.force",d3_layout_forceMouseout).call(drag)};function dragmove(d){d.px=d3.event.x,d.py=d3.event.y;force.resume()}return d3.rebind(force,event,"on")};function d3_layout_forceDragstart(d){d.fixed|=2}function d3_layout_forceDragend(d){d.fixed&=~6}function d3_layout_forceMouseover(d){d.fixed|=4;d.px=d.x,d.py=d.y}function d3_layout_forceMouseout(d){d.fixed&=~4}function d3_layout_forceAccumulate(quad,alpha,charges){var cx=0,cy=0;quad.charge=0;if(!quad.leaf){var nodes=quad.nodes,n=nodes.length,i=-1,c;while(++i<n){c=nodes[i];if(c==null)continue;d3_layout_forceAccumulate(c,alpha,charges);quad.charge+=c.charge;cx+=c.charge*c.cx;cy+=c.charge*c.cy}}if(quad.point){if(!quad.leaf){quad.point.x+=Math.random()-.5;quad.point.y+=Math.random()-.5}var k=alpha*charges[quad.point.index];quad.charge+=quad.pointCharge=k;cx+=k*quad.point.x;cy+=k*quad.point.y}quad.cx=cx/quad.charge;quad.cy=cy/quad.charge}var d3_layout_forceLinkDistance=20,d3_layout_forceLinkStrength=1;d3.layout.hierarchy=function(){var sort=d3_layout_hierarchySort,children=d3_layout_hierarchyChildren,value=d3_layout_hierarchyValue;function recurse(node,depth,nodes){var childs=children.call(hierarchy,node,depth);node.depth=depth;nodes.push(node);if(childs&&(n=childs.length)){var i=-1,n,c=node.children=new Array(n),v=0,j=depth+1,d;while(++i<n){d=c[i]=recurse(childs[i],j,nodes);d.parent=node;v+=d.value}if(sort)c.sort(sort);if(value)node.value=v}else{delete node.children;if(value){node.value=+value.call(hierarchy,node,depth)||0}}return node}function revalue(node,depth){var children=node.children,v=0;if(children&&(n=children.length)){var i=-1,n,j=depth+1;while(++i<n)v+=revalue(children[i],j)}else if(value){v=+value.call(hierarchy,node,depth)||0}if(value)node.value=v;return v}function hierarchy(d){var nodes=[];recurse(d,0,nodes);return nodes}hierarchy.sort=function(x){if(!arguments.length)return sort;sort=x;return hierarchy};hierarchy.children=function(x){if(!arguments.length)return children;children=x;return hierarchy};hierarchy.value=function(x){if(!arguments.length)return value;value=x;return hierarchy};hierarchy.revalue=function(root){revalue(root,0);return root};return hierarchy};function d3_layout_hierarchyRebind(object,hierarchy){d3.rebind(object,hierarchy,"sort","children","value");object.nodes=object;object.links=d3_layout_hierarchyLinks;return object}function d3_layout_hierarchyChildren(d){return d.children}function d3_layout_hierarchyValue(d){return d.value}function d3_layout_hierarchySort(a,b){return b.value-a.value}function d3_layout_hierarchyLinks(nodes){return d3.merge(nodes.map(function(parent){return(parent.children||[]).map(function(child){return{source:parent,target:child}})}))}d3.layout.partition=function(){var hierarchy=d3.layout.hierarchy(),size=[1,1];function position(node,x,dx,dy){var children=node.children;node.x=x;node.y=node.depth*dy;node.dx=dx;node.dy=dy;if(children&&(n=children.length)){var i=-1,n,c,d;dx=node.value?dx/node.value:0;while(++i<n){position(c=children[i],x,d=c.value*dx,dy);x+=d}}}function depth(node){var children=node.children,d=0;if(children&&(n=children.length)){var i=-1,n;while(++i<n)d=Math.max(d,depth(children[i]))}return 1+d}function partition(d,i){var nodes=hierarchy.call(this,d,i);position(nodes[0],0,size[0],size[1]/depth(nodes[0]));return nodes}partition.size=function(x){if(!arguments.length)return size;size=x;return partition};return d3_layout_hierarchyRebind(partition,hierarchy)};d3.layout.pie=function(){var value=Number,sort=d3_layout_pieSortByValue,startAngle=0,endAngle=;function pie(data){var values=data.map(function(d,i){return+value.call(pie,d,i)});var a=+(typeof startAngle==="function"?startAngle.apply(this,arguments):startAngle);var k=((typeof endAngle==="function"?endAngle.apply(this,arguments):endAngle)-a)/d3.sum(values);var index=d3.range(data.length);if(sort!=null)index.sort(sort===d3_layout_pieSortByValue?function(i,j){return values[j]-values[i]}:function(i,j){return sort(data[i],data[j])});var arcs=[];index.forEach(function(i){var d;arcs[i]={data:data[i],value:d=values[i],startAngle:a,endAngle:a+=d*k}});return arcs}pie.value=function(x){if(!arguments.length)return value;value=x;return pie};pie.sort=function(x){if(!arguments.length)return sort;sort=x;return pie};pie.startAngle=function(x){if(!arguments.length)return startAngle;startAngle=x;return pie};pie.endAngle=function(x){if(!arguments.length)return endAngle;endAngle=x;return pie};return pie};var d3_layout_pieSortByValue={};d3.layout.stack=function(){var values=d3_identity,order=d3_layout_stackOrderDefault,offset=d3_layout_stackOffsetZero,out=d3_layout_stackOut,x=d3_layout_stackX,y=d3_layout_stackY;function stack(data,index){var series=data.map(function(d,i){return values.call(stack,d,i)});var points=series.map(function(d){return d.map(function(v,i){return[x.call(stack,v,i),y.call(stack,v,i)]})});var orders=order.call(stack,points,index);series=d3.permute(series,orders);points=d3.permute(points,orders);var offsets=offset.call(stack,points,index);var n=series.length,m=series[0].length,i,j,o;for(j=0;j<m;++j){out.call(stack,series[0][j],o=offsets[j],points[0][j][1]);for(i=1;i<n;++i){out.call(stack,series[i][j],o+=points[i-1][j][1],points[i][j][1])}}return data}stack.values=function(x){if(!arguments.length)return values;values=x;return stack};stack.order=function(x){if(!arguments.length)return order;order=typeof x==="function"?x:d3_layout_stackOrders.get(x)||d3_layout_stackOrderDefault;return stack};stack.offset=function(x){if(!arguments.length)return offset;offset=typeof x==="function"?x:d3_layout_stackOffsets.get(x)||d3_layout_stackOffsetZero;return stack};stack.x=function(z){if(!arguments.length)return x;x=z;return stack};stack.y=function(z){if(!arguments.length)return y;y=z;return stack};stack.out=function(z){if(!arguments.length)return out;out=z;return stack};return stack};function d3_layout_stackX(d){return d.x}function d3_layout_stackY(d){return d.y}function d3_layout_stackOut(d,y0,y){d.y0=y0;d.y=y}var d3_layout_stackOrders=d3.map({"inside-out":function(data){var n=data.length,i,j,max=data.map(d3_layout_stackMaxIndex),sums=data.map(d3_layout_stackReduceSum),index=d3.range(n).sort(function(a,b){return max[a]-max[b]}),top=0,bottom=0,tops=[],bottoms=[];for(i=0;i<n;++i){j=index[i];if(top<bottom){top+=sums[j];tops.push(j)}else{bottom+=sums[j];bottoms.push(j)}}return bottoms.reverse().concat(tops)},reverse:function(data){return d3.range(data.length).reverse()},default:d3_layout_stackOrderDefault});var d3_layout_stackOffsets=d3.map({silhouette:function(data){var n=data.length,m=data[0].length,sums=[],max=0,i,j,o,y0=[];for(j=0;j<m;++j){for(i=0,o=0;i<n;i++)o+=data[i][j][1];if(o>max)max=o;sums.push(o)}for(j=0;j<m;++j){y0[j]=(max-sums[j])/2}return y0},wiggle:function(data){var n=data.length,x=data[0],m=x.length,i,j,k,s1,s2,s3,dx,o,o0,y0=[];y0[0]=o=o0=0;for(j=1;j<m;++j){for(i=0,s1=0;i<n;++i)s1+=data[i][j][1];for(i=0,s2=0,dx=x[j][0]-x[j-1][0];i<n;++i){for(k=0,s3=(data[i][j][1]-data[i][j-1][1])/(2*dx);k<i;++k){s3+=(data[k][j][1]-data[k][j-1][1])/dx}s2+=s3*data[i][j][1]}y0[j]=o-=s1?s2/s1*dx:0;if(o<o0)o0=o}for(j=0;j<m;++j)y0[j]-=o0;return y0},expand:function(data){var n=data.length,m=data[0].length,k=1/n,i,j,o,y0=[];for(j=0;j<m;++j){for(i=0,o=0;i<n;i++)o+=data[i][j][1];if(o)for(i=0;i<n;i++)data[i][j][1]/=o;else for(i=0;i<n;i++)data[i][j][1]=k}for(j=0;j<m;++j)y0[j]=0;return y0},zero:d3_layout_stackOffsetZero});function d3_layout_stackOrderDefault(data){return d3.range(data.length)}function d3_layout_stackOffsetZero(data){var j=-1,m=data[0].length,y0=[];while(++j<m)y0[j]=0;return y0}function d3_layout_stackMaxIndex(array){var i=1,j=0,v=array[0][1],k,n=array.length;for(;i<n;++i){if((k=array[i][1])>v){j=i;v=k}}return j}function d3_layout_stackReduceSum(d){return d.reduce(d3_layout_stackSum,0)}function d3_layout_stackSum(p,d){return p+d[1]}d3.layout.histogram=function(){var frequency=true,valuer=Number,ranger=d3_layout_histogramRange,binner=d3_layout_histogramBinSturges;function histogram(data,i){var bins=[],values=data.map(valuer,this),range=ranger.call(this,values,i),thresholds=binner.call(this,range,values,i),bin,i=-1,n=values.length,m=thresholds.length-1,k=frequency?1:1/n,x;while(++i<m){bin=bins[i]=[];bin.dx=thresholds[i+1]-(bin.x=thresholds[i]);bin.y=0}if(m>0){i=-1;while(++i<n){x=values[i];if(x>=range[0]&&x<=range[1]){bin=bins[d3.bisect(thresholds,x,1,m)-1];bin.y+=k;bin.push(data[i])}}}return bins}histogram.value=function(x){if(!arguments.length)return valuer;valuer=x;return histogram};histogram.range=function(x){if(!arguments.length)return ranger;ranger=d3_functor(x);return histogram};histogram.bins=function(x){if(!arguments.length)return binner;binner=typeof x==="number"?function(range){return d3_layout_histogramBinFixed(range,x)}:d3_functor(x);return histogram};histogram.frequency=function(x){if(!arguments.length)return frequency;frequency=!!x;return histogram};return histogram};function d3_layout_histogramBinSturges(range,values){return d3_layout_histogramBinFixed(range,Math.ceil(Math.log(values.length)/Math.LN2+1))}function d3_layout_histogramBinFixed(range,n){var x=-1,b=+range[0],m=(range[1]-b)/n,f=[];while(++x<=n)f[x]=m*x+b;return f}function d3_layout_histogramRange(values){return[d3.min(values),d3.max(values)]}d3.layout.tree=function(){var hierarchy=d3.layout.hierarchy().sort(null).value(null),separation=d3_layout_treeSeparation,size=[1,1],nodeSize=false;function tree(d,i){var nodes=hierarchy.call(this,d,i),root=nodes[0];function firstWalk(node,previousSibling){var children=node.children,layout=node._tree;if(children&&(n=children.length)){var n,firstChild=children[0],previousChild,ancestor=firstChild,child,i=-1;while(++i<n){child=children[i];firstWalk(child,previousChild);ancestor=apportion(child,previousChild,ancestor);previousChild=child}d3_layout_treeShift(node);var midpoint=.5*(firstChild._tree.prelim+child._tree.prelim);if(previousSibling){layout.prelim=previousSibling._tree.prelim+separation(node,previousSibling);layout.mod=layout.prelim-midpoint}else{layout.prelim=midpoint}}else{if(previousSibling){layout.prelim=previousSibling._tree.prelim+separation(node,previousSibling)}}}function secondWalk(node,x){node.x=node._tree.prelim+x;var children=node.children;if(children&&(n=children.length)){var i=-1,n;x+=node._tree.mod;while(++i<n){secondWalk(children[i],x)}}}function apportion(node,previousSibling,ancestor){if(previousSibling){var vip=node,vop=node,vim=previousSibling,vom=node.parent.children[0],sip=vip._tree.mod,sop=vop._tree.mod,sim=vim._tree.mod,som=vom._tree.mod,shift;while(vim=d3_layout_treeRight(vim),vip=d3_layout_treeLeft(vip),vim&&vip){vom=d3_layout_treeLeft(vom);vop=d3_layout_treeRight(vop);vop._tree.ancestor=node;shift=vim._tree.prelim+sim-vip._tree.prelim-sip+separation(vim,vip);if(shift>0){d3_layout_treeMove(d3_layout_treeAncestor(vim,node,ancestor),node,shift);sip+=shift;sop+=shift}sim+=vim._tree.mod;sip+=vip._tree.mod;som+=vom._tree.mod;sop+=vop._tree.mod}if(vim&&!d3_layout_treeRight(vop)){vop._tree.thread=vim;vop._tree.mod+=sim-sop}if(vip&&!d3_layout_treeLeft(vom)){vom._tree.thread=vip;vom._tree.mod+=sip-som;ancestor=node}}return ancestor}d3_layout_treeVisitAfter(root,function(node,previousSibling){node._tree={ancestor:node,prelim:0,mod:0,change:0,shift:0,number:previousSibling?previousSibling._tree.number+1:0}});firstWalk(root);secondWalk(root,-root._tree.prelim);var left=d3_layout_treeSearch(root,d3_layout_treeLeftmost),right=d3_layout_treeSearch(root,d3_layout_treeRightmost),deep=d3_layout_treeSearch(root,d3_layout_treeDeepest),x0=left.x-separation(left,right)/2,x1=right.x+separation(right,left)/2,y1=deep.depth||1;d3_layout_treeVisitAfter(root,nodeSize?function(node){node.x*=size[0];node.y=node.depth*size[1];delete node._tree}:function(node){node.x=(node.x-x0)/(x1-x0)*size[0];node.y=node.depth/y1*size[1];delete node._tree});return nodes}tree.separation=function(x){if(!arguments.length)return separation;separation=x;return tree};tree.size=function(x){if(!arguments.length)return nodeSize?null:size;nodeSize=(size=x)==null;return tree};tree.nodeSize=function(x){if(!arguments.length)return nodeSize?size:null;nodeSize=(size=x)!=null;return tree};return d3_layout_hierarchyRebind(tree,hierarchy)};function d3_layout_treeSeparation(a,b){return a.parent==b.parent?1:2}function d3_layout_treeLeft(node){var children=node.children;return children&&children.length?children[0]:node._tree.thread}function d3_layout_treeRight(node){var children=node.children,n;return children&&(n=children.length)?children[n-1]:node._tree.thread}function d3_layout_treeSearch(node,compare){var children=node.children;if(children&&(n=children.length)){var child,n,i=-1;while(++i<n){if(compare(child=d3_layout_treeSearch(children[i],compare),node)>0){node=child}}}return node}function d3_layout_treeRightmost(a,b){return a.x-b.x}function d3_layout_treeLeftmost(a,b){return b.x-a.x}function d3_layout_treeDeepest(a,b){return a.depth-b.depth}function d3_layout_treeVisitAfter(node,callback){function visit(node,previousSibling){var children=node.children;if(children&&(n=children.length)){var child,previousChild=null,i=-1,n;while(++i<n){child=children[i];visit(child,previousChild);previousChild=child}}callback(node,previousSibling)}visit(node,null)}function d3_layout_treeShift(node){var shift=0,change=0,children=node.children,i=children.length,child;while(--i>=0){child=children[i]._tree;child.prelim+=shift;child.mod+=shift;shift+=child.shift+(change+=child.change)}}function d3_layout_treeMove(ancestor,node,shift){ancestor=ancestor._tree;node=node._tree;var change=shift/(node.number-ancestor.number);ancestor.change+=change;node.change-=change;node.shift+=shift;node.prelim+=shift;node.mod+=shift}function d3_layout_treeAncestor(vim,node,ancestor){return vim._tree.ancestor.parent==node.parent?vim._tree.ancestor:ancestor}d3.layout.pack=function(){var hierarchy=d3.layout.hierarchy().sort(d3_layout_packSort),padding=0,size=[1,1],radius;function pack(d,i){var nodes=hierarchy.call(this,d,i),root=nodes[0],w=size[0],h=size[1],r=radius==null?Math.sqrt:typeof radius==="function"?radius:function(){return radius};root.x=root.y=0;d3_layout_treeVisitAfter(root,function(d){d.r=+r(d.value)});d3_layout_treeVisitAfter(root,d3_layout_packSiblings);if(padding){var dr=padding*(radius?1:Math.max(2*root.r/w,2*root.r/h))/2;d3_layout_treeVisitAfter(root,function(d){d.r+=dr});d3_layout_treeVisitAfter(root,d3_layout_packSiblings);d3_layout_treeVisitAfter(root,function(d){d.r-=dr})}d3_layout_packTransform(root,w/2,h/2,radius?1:1/Math.max(2*root.r/w,2*root.r/h));return nodes}pack.size=function(_){if(!arguments.length)return size;size=_;return pack};pack.radius=function(_){if(!arguments.length)return radius;radius=_==null||typeof _==="function"?_:+_;return pack};pack.padding=function(_){if(!arguments.length)return padding;padding=+_;return pack};return d3_layout_hierarchyRebind(pack,hierarchy)};function d3_layout_packSort(a,b){return a.value-b.value}function d3_layout_packInsert(a,b){var c=a._pack_next;a._pack_next=b;b._pack_prev=a;b._pack_next=c;c._pack_prev=b}function d3_layout_packSplice(a,b){a._pack_next=b;b._pack_prev=a}function d3_layout_packIntersects(a,b){var dx=b.x-a.x,dy=b.y-a.y,dr=a.r+b.r;return.999*dr*dr>dx*dx+dy*dy}function d3_layout_packSiblings(node){if(!(nodes=node.children)||!(n=nodes.length))return;var nodes,xMin=Infinity,xMax=-Infinity,yMin=Infinity,yMax=-Infinity,a,b,c,i,j,k,n;function bound(node){xMin=Math.min(node.x-node.r,xMin);xMax=Math.max(node.x+node.r,xMax);yMin=Math.min(node.y-node.r,yMin);yMax=Math.max(node.y+node.r,yMax)}nodes.forEach(d3_layout_packLink);a=nodes[0];a.x=-a.r;a.y=0;bound(a);if(n>1){b=nodes[1];b.x=b.r;b.y=0;bound(b);if(n>2){c=nodes[2];d3_layout_packPlace(a,b,c);bound(c);d3_layout_packInsert(a,c);a._pack_prev=c;d3_layout_packInsert(c,b);b=a._pack_next;for(i=3;i<n;i++){d3_layout_packPlace(a,b,c=nodes[i]);var isect=0,s1=1,s2=1;for(j=b._pack_next;j!==b;j=j._pack_next,s1++){if(d3_layout_packIntersects(j,c)){isect=1;break}}if(isect==1){for(k=a._pack_prev;k!==j._pack_prev;k=k._pack_prev,s2++){if(d3_layout_packIntersects(k,c)){break}}}if(isect){if(s1<s2||s1==s2&&b.r<a.r)d3_layout_packSplice(a,b=j);else d3_layout_packSplice(a=k,b);i--}else{d3_layout_packInsert(a,c);b=c;bound(c)}}}}var cx=(xMin+xMax)/2,cy=(yMin+yMax)/2,cr=0;for(i=0;i<n;i++){c=nodes[i];c.x-=cx;c.y-=cy;cr=Math.max(cr,c.r+Math.sqrt(c.x*c.x+c.y*c.y))}node.r=cr;nodes.forEach(d3_layout_packUnlink)}function d3_layout_packLink(node){node._pack_next=node._pack_prev=node}function d3_layout_packUnlink(node){delete node._pack_next;delete node._pack_prev}function d3_layout_packTransform(node,x,y,k){var children=node.children;node.x=x+=k*node.x;node.y=y+=k*node.y;node.r*=k;if(children){var i=-1,n=children.length;while(++i<n)d3_layout_packTransform(children[i],x,y,k)}}function d3_layout_packPlace(a,b,c){var db=a.r+c.r,dx=b.x-a.x,dy=b.y-a.y;if(db&&(dx||dy)){var da=b.r+c.r,dc=dx*dx+dy*dy;da*=da;db*=db;var x=.5+(db-da)/(2*dc),y=Math.sqrt(Math.max(0,2*da*(db+dc)-(db-=dc)*db-da*da))/(2*dc);c.x=a.x+x*dx+y*dy;c.y=a.y+x*dy-y*dx}else{c.x=a.x+db;c.y=a.y}}d3.layout.cluster=function(){var hierarchy=d3.layout.hierarchy().sort(null).value(null),separation=d3_layout_treeSeparation,size=[1,1],nodeSize=false;function cluster(d,i){var nodes=hierarchy.call(this,d,i),root=nodes[0],previousNode,x=0;d3_layout_treeVisitAfter(root,function(node){var children=node.children;if(children&&children.length){node.x=d3_layout_clusterX(children);node.y=d3_layout_clusterY(children)}else{node.x=previousNode?x+=separation(node,previousNode):0;node.y=0;previousNode=node}});var left=d3_layout_clusterLeft(root),right=d3_layout_clusterRight(root),x0=left.x-separation(left,right)/2,x1=right.x+separation(right,left)/2;d3_layout_treeVisitAfter(root,nodeSize?function(node){node.x=(node.x-root.x)*size[0];node.y=(root.y-node.y)*size[1]}:function(node){node.x=(node.x-x0)/(x1-x0)*size[0];node.y=(1-(root.y?node.y/root.y:1))*size[1]});return nodes}cluster.separation=function(x){if(!arguments.length)return separation;separation=x;return cluster};cluster.size=function(x){if(!arguments.length)return nodeSize?null:size;nodeSize=(size=x)==null;return cluster};cluster.nodeSize=function(x){if(!arguments.length)return nodeSize?size:null;nodeSize=(size=x)!=null;return cluster};return d3_layout_hierarchyRebind(cluster,hierarchy)};function d3_layout_clusterY(children){return 1+d3.max(children,function(child){return child.y})}function d3_layout_clusterX(children){return children.reduce(function(x,child){return x+child.x},0)/children.length}function d3_layout_clusterLeft(node){var children=node.children;return children&&children.length?d3_layout_clusterLeft(children[0]):node}function d3_layout_clusterRight(node){var children=node.children,n;return children&&(n=children.length)?d3_layout_clusterRight(children[n-1]):node}d3.layout.treemap=function(){var hierarchy=d3.layout.hierarchy(),round=Math.round,size=[1,1],padding=null,pad=d3_layout_treemapPadNull,sticky=false,stickies,mode="squarify",ratio=.5*(1+Math.sqrt(5));function scale(children,k){var i=-1,n=children.length,child,area;while(++i<n){area=(child=children[i]).value*(k<0?0:k);child.area=isNaN(area)||area<=0?0:area}}function squarify(node){var children=node.children;if(children&&children.length){var rect=pad(node),row=[],remaining=children.slice(),child,best=Infinity,score,u=mode==="slice"?rect.dx:mode==="dice"?rect.dy:mode==="slice-dice"?node.depth&1?rect.dy:rect.dx:Math.min(rect.dx,rect.dy),n;scale(remaining,rect.dx*rect.dy/node.value);row.area=0;while((n=remaining.length)>0){row.push(child=remaining[n-1]);row.area+=child.area;if(mode!=="squarify"||(score=worst(row,u))<=best){remaining.pop();best=score}else{row.area-=row.pop().area;position(row,u,rect,false);u=Math.min(rect.dx,rect.dy);row.length=row.area=0;best=Infinity}}if(row.length){position(row,u,rect,true);row.length=row.area=0}children.forEach(squarify)}}function stickify(node){var children=node.children;if(children&&children.length){var rect=pad(node),remaining=children.slice(),child,row=[];scale(remaining,rect.dx*rect.dy/node.value);row.area=0;while(child=remaining.pop()){row.push(child);row.area+=child.area;if(child.z!=null){position(row,child.z?rect.dx:rect.dy,rect,!remaining.length);row.length=row.area=0}}children.forEach(stickify)}}function worst(row,u){var s=row.area,r,rmax=0,rmin=Infinity,i=-1,n=row.length;while(++i<n){if(!(r=row[i].area))continue;if(r<rmin)rmin=r;if(r>rmax)rmax=r}s*=s;u*=u;return s?Math.max(u*rmax*ratio/s,s/(u*rmin*ratio)):Infinity}function position(row,u,rect,flush){var i=-1,n=row.length,x=rect.x,y=rect.y,v=u?round(row.area/u):0,o;if(u==rect.dx){if(flush||v>rect.dy)v=rect.dy;while(++i<n){o=row[i];o.x=x;o.y=y;o.dy=v;x+=o.dx=Math.min(rect.x+rect.dx-x,v?round(o.area/v):0)}o.z=true;o.dx+=rect.x+rect.dx-x;rect.y+=v;rect.dy-=v}else{if(flush||v>rect.dx)v=rect.dx;while(++i<n){o=row[i];o.x=x;o.y=y;o.dx=v;y+=o.dy=Math.min(rect.y+rect.dy-y,v?round(o.area/v):0)}o.z=false;o.dy+=rect.y+rect.dy-y;rect.x+=v;rect.dx-=v}}function treemap(d){var nodes=stickies||hierarchy(d),root=nodes[0];root.x=0;root.y=0;root.dx=size[0];root.dy=size[1];if(stickies)hierarchy.revalue(root);scale([root],root.dx*root.dy/root.value);(stickies?stickify:squarify)(root);if(sticky)stickies=nodes;return nodes}treemap.size=function(x){if(!arguments.length)return size;size=x;return treemap};treemap.padding=function(x){if(!arguments.length)return padding;function padFunction(node){var p=x.call(treemap,node,node.depth);return p==null?d3_layout_treemapPadNull(node):d3_layout_treemapPad(node,typeof p==="number"?[p,p,p,p]:p)}function padConstant(node){return d3_layout_treemapPad(node,x)}var type;pad=(padding=x)==null?d3_layout_treemapPadNull:(type=typeof x)==="function"?padFunction:type==="number"?(x=[x,x,x,x],padConstant):padConstant;return treemap};treemap.round=function(x){if(!arguments.length)return round!=Number;round=x?Math.round:Number;return treemap};treemap.sticky=function(x){if(!arguments.length)return sticky;sticky=x;stickies=null;return treemap};treemap.ratio=function(x){if(!arguments.length)return ratio;ratio=x;return treemap};treemap.mode=function(x){if(!arguments.length)return mode;mode=x+"";return treemap};return d3_layout_hierarchyRebind(treemap,hierarchy)};function d3_layout_treemapPadNull(node){return{x:node.x,y:node.y,dx:node.dx,dy:node.dy}}function d3_layout_treemapPad(node,padding){var x=node.x+padding[3],y=node.y+padding[0],dx=node.dx-padding[1]-padding[3],dy=node.dy-padding[0]-padding[2];if(dx<0){x+=dx/2;dx=0}if(dy<0){y+=dy/2;dy=0}return{x:x,y:y,dx:dx,dy:dy}}d3.random={normal:function(,){var n=arguments.length;if(n<2)=1;if(n<1)=0;return function(){var x,y,r;do{x=Math.random()*2-1;y=Math.random()*2-1;r=x*x+y*y}while(!r||r>1);return +*x*Math.sqrt(-2*Math.log(r)/r)}},logNormal:function(){var random=d3.random.normal.apply(d3,arguments);return function(){return Math.exp(random())}},irwinHall:function(m){return function(){for(var s=0,j=0;j<m;j++)s+=Math.random();return s/m}}};d3.scale={};function d3_scaleExtent(domain){var start=domain[0],stop=domain[domain.length-1];return start<stop?[start,stop]:[stop,start]}function d3_scaleRange(scale){return scale.rangeExtent?scale.rangeExtent():d3_scaleExtent(scale.range())}function d3_scale_bilinear(domain,range,uninterpolate,interpolate){var u=uninterpolate(domain[0],domain[1]),i=interpolate(range[0],range[1]);return function(x){return i(u(x))}}function d3_scale_nice(domain,nice){var i0=0,i1=domain.length-1,x0=domain[i0],x1=domain[i1],dx;if(x1<x0){dx=i0,i0=i1,i1=dx;dx=x0,x0=x1,x1=dx}domain[i0]=nice.floor(x0);domain[i1]=nice.ceil(x1);return domain}function d3_scale_niceStep(step){return step?{floor:function(x){return Math.floor(x/step)*step},ceil:function(x){return Math.ceil(x/step)*step}}:d3_scale_niceIdentity}var d3_scale_niceIdentity={floor:d3_identity,ceil:d3_identity};function d3_scale_polylinear(domain,range,uninterpolate,interpolate){var u=[],i=[],j=0,k=Math.min(domain.length,range.length)-1;if(domain[k]<domain[0]){domain=domain.slice().reverse();range=range.slice().reverse()}while(++j<=k){u.push(uninterpolate(domain[j-1],domain[j]));i.push(interpolate(range[j-1],range[j]))}return function(x){var j=d3.bisect(domain,x,1,k)-1;return i[j](u[j](x))}}d3.scale.linear=function(){return d3_scale_linear([0,1],[0,1],d3_interpolate,false)};function d3_scale_linear(domain,range,interpolate,clamp){var output,input;function rescale(){var linear=Math.min(domain.length,range.length)>2?d3_scale_polylinear:d3_scale_bilinear,uninterpolate=clamp?d3_uninterpolateClamp:d3_uninterpolateNumber;output=linear(domain,range,uninterpolate,interpolate);input=linear(range,domain,uninterpolate,d3_interpolate);return scale}function scale(x){return output(x)}scale.invert=function(y){return input(y)};scale.domain=function(x){if(!arguments.length)return domain;domain=x.map(Number);return rescale()};scale.range=function(x){if(!arguments.length)return range;range=x;return rescale()};scale.rangeRound=function(x){return scale.range(x).interpolate(d3_interpolateRound)};scale.clamp=function(x){if(!arguments.length)return clamp;clamp=x;return rescale()};scale.interpolate=function(x){if(!arguments.length)return interpolate;interpolate=x;return rescale()};scale.ticks=function(m){return d3_scale_linearTicks(domain,m)};scale.tickFormat=function(m,format){return d3_scale_linearTickFormat(domain,m,format)};scale.nice=function(m){d3_scale_linearNice(domain,m);return rescale()};scale.copy=function(){return d3_scale_linear(domain,range,interpolate,clamp)};return rescale()}function d3_scale_linearRebind(scale,linear){return d3.rebind(scale,linear,"range","rangeRound","interpolate","clamp")}function d3_scale_linearNice(domain,m){return d3_scale_nice(domain,d3_scale_niceStep(d3_scale_linearTickRange(domain,m)[2]))}function d3_scale_linearTickRange(domain,m){if(m==null)m=10;var extent=d3_scaleExtent(domain),span=extent[1]-extent[0],step=Math.pow(10,Math.floor(Math.log(span/m)/Math.LN10)),err=m/span*step;if(err<=.15)step*=10;else if(err<=.35)step*=5;else if(err<=.75)step*=2;extent[0]=Math.ceil(extent[0]/step)*step;extent[1]=Math.floor(extent[1]/step)*step+step*.5;extent[2]=step;return extent}function d3_scale_linearTicks(domain,m){return d3.range.apply(d3,d3_scale_linearTickRange(domain,m))}function d3_scale_linearTickFormat(domain,m,format){var range=d3_scale_linearTickRange(domain,m);return d3.format(format?format.replace(d3_format_re,function(a,b,c,d,e,f,g,h,i,j){return[b,c,d,e,f,g,h,i||"."+d3_scale_linearFormatPrecision(j,range),j].join("")}):",."+d3_scale_linearPrecision(range[2])+"f")}var d3_scale_linearFormatSignificant={s:1,g:1,p:1,r:1,e:1};function d3_scale_linearPrecision(value){return-Math.floor(Math.log(value)/Math.LN10+.01)}function d3_scale_linearFormatPrecision(type,range){var p=d3_scale_linearPrecision(range[2]);return type in d3_scale_linearFormatSignificant?Math.abs(p-d3_scale_linearPrecision(Math.max(Math.abs(range[0]),Math.abs(range[1]))))+ +(type!=="e"):p-(type==="%")*2}d3.scale.log=function(){return d3_scale_log(d3.scale.linear().domain([0,1]),10,true,[1,10])};function d3_scale_log(linear,base,positive,domain){function log(x){return(positive?Math.log(x<0?0:x):-Math.log(x>0?0:-x))/Math.log(base)}function pow(x){return positive?Math.pow(base,x):-Math.pow(base,-x)}function scale(x){return linear(log(x))}scale.invert=function(x){return pow(linear.invert(x))};scale.domain=function(x){if(!arguments.length)return domain;positive=x[0]>=0;linear.domain((domain=x.map(Number)).map(log));return scale};scale.base=function(_){if(!arguments.length)return base;base=+_;linear.domain(domain.map(log));return scale};scale.nice=function(){var niced=d3_scale_nice(domain.map(log),positive?Math:d3_scale_logNiceNegative);linear.domain(niced);domain=niced.map(pow);return scale};scale.ticks=function(){var extent=d3_scaleExtent(domain),ticks=[],u=extent[0],v=extent[1],i=Math.floor(log(u)),j=Math.ceil(log(v)),n=base%1?2:base;if(isFinite(j-i)){if(positive){for(;i<j;i++)for(var k=1;k<n;k++)ticks.push(pow(i)*k);ticks.push(pow(i))}else{ticks.push(pow(i));for(;i++<j;)for(var k=n-1;k>0;k--)ticks.push(pow(i)*k)}for(i=0;ticks[i]<u;i++){}for(j=ticks.length;ticks[j-1]>v;j--){}ticks=ticks.slice(i,j)}return ticks};scale.tickFormat=function(n,format){if(!arguments.length)return d3_scale_logFormat;if(arguments.length<2)format=d3_scale_logFormat;else if(typeof format!=="function")format=d3.format(format);var k=Math.max(.1,n/scale.ticks().length),f=positive?(e=1e-12,Math.ceil):(e=-1e-12,Math.floor),e;return function(d){return d/pow(f(log(d)+e))<=k?format(d):""}};scale.copy=function(){return d3_scale_log(linear.copy(),base,positive,domain)};return d3_scale_linearRebind(scale,linear)}var d3_scale_logFormat=d3.format(".0e"),d3_scale_logNiceNegative={floor:function(x){return-Math.ceil(-x)},ceil:function(x){return-Math.floor(-x)}};d3.scale.pow=function(){return d3_scale_pow(d3.scale.linear(),1,[0,1])};function d3_scale_pow(linear,exponent,domain){var powp=d3_scale_powPow(exponent),powb=d3_scale_powPow(1/exponent);function scale(x){return linear(powp(x))}scale.invert=function(x){return powb(linear.invert(x))};scale.domain=function(x){if(!arguments.length)return domain;linear.domain((domain=x.map(Number)).map(powp));return scale};scale.ticks=function(m){return d3_scale_linearTicks(domain,m)};scale.tickFormat=function(m,format){return d3_scale_linearTickFormat(domain,m,format)};scale.nice=function(m){return scale.domain(d3_scale_linearNice(domain,m))};scale.exponent=function(x){if(!arguments.length)return exponent;powp=d3_scale_powPow(exponent=x);powb=d3_scale_powPow(1/exponent);linear.domain(domain.map(powp));return scale};scale.copy=function(){return d3_scale_pow(linear.copy(),exponent,domain)};return d3_scale_linearRebind(scale,linear)}function d3_scale_powPow(e){return function(x){return x<0?-Math.pow(-x,e):Math.pow(x,e)}}d3.scale.sqrt=function(){return d3.scale.pow().exponent(.5)};d3.scale.ordinal=function(){return d3_scale_ordinal([],{t:"range",a:[[]]})};function d3_scale_ordinal(domain,ranger){var index,range,rangeBand;function scale(x){return range[((index.get(x)||ranger.t==="range"&&index.set(x,domain.push(x)))-1)%range.length]}function steps(start,step){return d3.range(domain.length).map(function(i){return start+step*i})}scale.domain=function(x){if(!arguments.length)return domain;domain=[];index=new d3_Map;var i=-1,n=x.length,xi;while(++i<n)if(!index.has(xi=x[i]))index.set(xi,domain.push(xi));return scale[ranger.t].apply(scale,ranger.a)};scale.range=function(x){if(!arguments.length)return range;range=x;rangeBand=0;ranger={t:"range",a:arguments};return scale};scale.rangePoints=function(x,padding){if(arguments.length<2)padding=0;var start=x[0],stop=x[1],step=(stop-start)/(Math.max(1,domain.length-1)+padding);range=steps(domain.length<2?(start+stop)/2:start+step*padding/2,step);rangeBand=0;ranger={t:"rangePoints",a:arguments};return scale};scale.rangeBands=function(x,padding,outerPadding){if(arguments.length<2)padding=0;if(arguments.length<3)outerPadding=padding;var reverse=x[1]<x[0],start=x[reverse-0],stop=x[1-reverse],step=(stop-start)/(domain.length-padding+2*outerPadding);range=steps(start+step*outerPadding,step);if(reverse)range.reverse();rangeBand=step*(1-padding);ranger={t:"rangeBands",a:arguments};return scale};scale.rangeRoundBands=function(x,padding,outerPadding){if(arguments.length<2)padding=0;if(arguments.length<3)outerPadding=padding;var reverse=x[1]<x[0],start=x[reverse-0],stop=x[1-reverse],step=Math.floor((stop-start)/(domain.length-padding+2*outerPadding)),error=stop-start-(domain.length-padding)*step;range=steps(start+Math.round(error/2),step);if(reverse)range.reverse();rangeBand=Math.round(step*(1-padding));ranger={t:"rangeRoundBands",a:arguments};return scale};scale.rangeBand=function(){return rangeBand};scale.rangeExtent=function(){return d3_scaleExtent(ranger.a[0])};scale.copy=function(){return d3_scale_ordinal(domain,ranger)};return scale.domain(domain)}d3.scale.category10=function(){return d3.scale.ordinal().range(d3_category10)};d3.scale.category20=function(){return d3.scale.ordinal().range(d3_category20)};d3.scale.category20b=function(){return d3.scale.ordinal().range(d3_category20b)};d3.scale.category20c=function(){return d3.scale.ordinal().range(d3_category20c)};var d3_category10=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(d3_rgbString);var d3_category20=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(d3_rgbString);var d3_category20b=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(d3_rgbString);var d3_category20c=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(d3_rgbString);d3.scale.quantile=function(){return d3_scale_quantile([],[])};function d3_scale_quantile(domain,range){var thresholds;function rescale(){var k=0,q=range.length;thresholds=[];while(++k<q)thresholds[k-1]=d3.quantile(domain,k/q);return scale}function scale(x){if(!isNaN(x=+x))return range[d3.bisect(thresholds,x)]}scale.domain=function(x){if(!arguments.length)return domain;domain=x.filter(function(d){return!isNaN(d)}).sort(d3.ascending);return rescale()};scale.range=function(x){if(!arguments.length)return range;range=x;return rescale()};scale.quantiles=function(){return thresholds};scale.invertExtent=function(y){y=range.indexOf(y);return y<0?[NaN,NaN]:[y>0?thresholds[y-1]:domain[0],y<thresholds.length?thresholds[y]:domain[domain.length-1]]};scale.copy=function(){return d3_scale_quantile(domain,range)};return rescale()}d3.scale.quantize=function(){return d3_scale_quantize(0,1,[0,1])};function d3_scale_quantize(x0,x1,range){var kx,i;function scale(x){return range[Math.max(0,Math.min(i,Math.floor(kx*(x-x0))))]}function rescale(){kx=range.length/(x1-x0);i=range.length-1;return scale}scale.domain=function(x){if(!arguments.length)return[x0,x1];x0=+x[0];x1=+x[x.length-1];return rescale()};scale.range=function(x){if(!arguments.length)return range;range=x;return rescale()};scale.invertExtent=function(y){y=range.indexOf(y);y=y<0?NaN:y/kx+x0;return[y,y+1/kx]};scale.copy=function(){return d3_scale_quantize(x0,x1,range)};return rescale()}d3.scale.threshold=function(){return d3_scale_threshold([.5],[0,1])};function d3_scale_threshold(domain,range){function scale(x){if(x<=x)return range[d3.bisect(domain,x)]}scale.domain=function(_){if(!arguments.length)return domain;domain=_;return scale};scale.range=function(_){if(!arguments.length)return range;range=_;return scale};scale.invertExtent=function(y){y=range.indexOf(y);return[domain[y-1],domain[y]]};scale.copy=function(){return d3_scale_threshold(domain,range)};return scale}d3.scale.identity=function(){return d3_scale_identity([0,1])};function d3_scale_identity(domain){function identity(x){return+x}identity.invert=identity;identity.domain=identity.range=function(x){if(!arguments.length)return domain;domain=x.map(identity);return identity};identity.ticks=function(m){return d3_scale_linearTicks(domain,m)};identity.tickFormat=function(m,format){return d3_scale_linearTickFormat(domain,m,format)};identity.copy=function(){return d3_scale_identity(domain)};return identity}d3.svg={};d3.svg.arc=function(){var innerRadius=d3_svg_arcInnerRadius,outerRadius=d3_svg_arcOuterRadius,startAngle=d3_svg_arcStartAngle,endAngle=d3_svg_arcEndAngle;function arc(){var r0=innerRadius.apply(this,arguments),r1=outerRadius.apply(this,arguments),a0=startAngle.apply(this,arguments)+d3_svg_arcOffset,a1=endAngle.apply(this,arguments)+d3_svg_arcOffset,da=(a1<a0&&(da=a0,a0=a1,a1=da),a1-a0),df=da<?"0":"1",c0=Math.cos(a0),s0=Math.sin(a0),c1=Math.cos(a1),s1=Math.sin(a1);return da>=d3_svg_arcMax?r0?"M0,"+r1+"A"+r1+","+r1+" 0 1,1 0,"+-r1+"A"+r1+","+r1+" 0 1,1 0,"+r1+"M0,"+r0+"A"+r0+","+r0+" 0 1,0 0,"+-r0+"A"+r0+","+r0+" 0 1,0 0,"+r0+"Z":"M0,"+r1+"A"+r1+","+r1+" 0 1,1 0,"+-r1+"A"+r1+","+r1+" 0 1,1 0,"+r1+"Z":r0?"M"+r1*c0+","+r1*s0+"A"+r1+","+r1+" 0 "+df+",1 "+r1*c1+","+r1*s1+"L"+r0*c1+","+r0*s1+"A"+r0+","+r0+" 0 "+df+",0 "+r0*c0+","+r0*s0+"Z":"M"+r1*c0+","+r1*s0+"A"+r1+","+r1+" 0 "+df+",1 "+r1*c1+","+r1*s1+"L0,0"+"Z"}arc.innerRadius=function(v){if(!arguments.length)return innerRadius;innerRadius=d3_functor(v);return arc};arc.outerRadius=function(v){if(!arguments.length)return outerRadius;outerRadius=d3_functor(v);return arc};arc.startAngle=function(v){if(!arguments.length)return startAngle;startAngle=d3_functor(v);return arc};arc.endAngle=function(v){if(!arguments.length)return endAngle;endAngle=d3_functor(v);return arc};arc.centroid=function(){var r=(innerRadius.apply(this,arguments)+outerRadius.apply(this,arguments))/2,a=(startAngle.apply(this,arguments)+endAngle.apply(this,arguments))/2+d3_svg_arcOffset;return[Math.cos(a)*r,Math.sin(a)*r]};return arc};var d3_svg_arcOffset=-half,d3_svg_arcMax=-;function d3_svg_arcInnerRadius(d){return d.innerRadius}function d3_svg_arcOuterRadius(d){return d.outerRadius}function d3_svg_arcStartAngle(d){return d.startAngle}function d3_svg_arcEndAngle(d){return d.endAngle}function d3_svg_line(projection){var x=d3_geom_pointX,y=d3_geom_pointY,defined=d3_true,interpolate=d3_svg_lineLinear,interpolateKey=interpolate.key,tension=.7;function line(data){var segments=[],points=[],i=-1,n=data.length,d,fx=d3_functor(x),fy=d3_functor(y);function segment(){segments.push("M",interpolate(projection(points),tension))}while(++i<n){if(defined.call(this,d=data[i],i)){points.push([+fx.call(this,d,i),+fy.call(this,d,i)])}else if(points.length){segment();points=[]}}if(points.length)segment();return segments.length?segments.join(""):null}line.x=function(_){if(!arguments.length)return x;x=_;return line};line.y=function(_){if(!arguments.length)return y;y=_;return line};line.defined=function(_){if(!arguments.length)return defined;defined=_;return line};line.interpolate=function(_){if(!arguments.length)return interpolateKey;if(typeof _==="function")interpolateKey=interpolate=_;else interpolateKey=(interpolate=d3_svg_lineInterpolators.get(_)||d3_svg_lineLinear).key;return line};line.tension=function(_){if(!arguments.length)return tension;tension=_;return line};return line}d3.svg.line=function(){return d3_svg_line(d3_identity)};var d3_svg_lineInterpolators=d3.map({linear:d3_svg_lineLinear,"linear-closed":d3_svg_lineLinearClosed,step:d3_svg_lineStep,"step-before":d3_svg_lineStepBefore,"step-after":d3_svg_lineStepAfter,basis:d3_svg_lineBasis,"basis-open":d3_svg_lineBasisOpen,"basis-closed":d3_svg_lineBasisClosed,bundle:d3_svg_lineBundle,cardinal:d3_svg_lineCardinal,"cardinal-open":d3_svg_lineCardinalOpen,"cardinal-closed":d3_svg_lineCardinalClosed,monotone:d3_svg_lineMonotone});d3_svg_lineInterpolators.forEach(function(key,value){value.key=key;value.closed=/-closed$/.test(key)});function d3_svg_lineLinear(points){return points.join("L")}function d3_svg_lineLinearClosed(points){return d3_svg_lineLinear(points)+"Z"}function d3_svg_lineStep(points){var i=0,n=points.length,p=points[0],path=[p[0],",",p[1]];while(++i<n)path.push("H",(p[0]+(p=points[i])[0])/2,"V",p[1]);if(n>1)path.push("H",p[0]);return path.join("")}function d3_svg_lineStepBefore(points){var i=0,n=points.length,p=points[0],path=[p[0],",",p[1]];while(++i<n)path.push("V",(p=points[i])[1],"H",p[0]);return path.join("")}function d3_svg_lineStepAfter(points){var i=0,n=points.length,p=points[0],path=[p[0],",",p[1]];while(++i<n)path.push("H",(p=points[i])[0],"V",p[1]);return path.join("")}function d3_svg_lineCardinalOpen(points,tension){return points.length<4?d3_svg_lineLinear(points):points[1]+d3_svg_lineHermite(points.slice(1,points.length-1),d3_svg_lineCardinalTangents(points,tension))}function d3_svg_lineCardinalClosed(points,tension){return points.length<3?d3_svg_lineLinear(points):points[0]+d3_svg_lineHermite((points.push(points[0]),points),d3_svg_lineCardinalTangents([points[points.length-2]].concat(points,[points[1]]),tension))}function d3_svg_lineCardinal(points,tension){return points.length<3?d3_svg_lineLinear(points):points[0]+d3_svg_lineHermite(points,d3_svg_lineCardinalTangents(points,tension))}function d3_svg_lineHermite(points,tangents){if(tangents.length<1||points.length!=tangents.length&&points.length!=tangents.length+2){return d3_svg_lineLinear(points)}var quad=points.length!=tangents.length,path="",p0=points[0],p=points[1],t0=tangents[0],t=t0,pi=1;if(quad){path+="Q"+(p[0]-t0[0]*2/3)+","+(p[1]-t0[1]*2/3)+","+p[0]+","+p[1];p0=points[1];pi=2}if(tangents.length>1){t=tangents[1];p=points[pi];pi++;path+="C"+(p0[0]+t0[0])+","+(p0[1]+t0[1])+","+(p[0]-t[0])+","+(p[1]-t[1])+","+p[0]+","+p[1];for(var i=2;i<tangents.length;i++,pi++){p=points[pi];t=tangents[i];path+="S"+(p[0]-t[0])+","+(p[1]-t[1])+","+p[0]+","+p[1]}}if(quad){var lp=points[pi];path+="Q"+(p[0]+t[0]*2/3)+","+(p[1]+t[1]*2/3)+","+lp[0]+","+lp[1]}return path}function d3_svg_lineCardinalTangents(points,tension){var tangents=[],a=(1-tension)/2,p0,p1=points[0],p2=points[1],i=1,n=points.length;while(++i<n){p0=p1;p1=p2;p2=points[i];tangents.push([a*(p2[0]-p0[0]),a*(p2[1]-p0[1])])}return tangents}function d3_svg_lineBasis(points){if(points.length<3)return d3_svg_lineLinear(points);var i=1,n=points.length,pi=points[0],x0=pi[0],y0=pi[1],px=[x0,x0,x0,(pi=points[1])[0]],py=[y0,y0,y0,pi[1]],path=[x0,",",y0,"L",d3_svg_lineDot4(d3_svg_lineBasisBezier3,px),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,py)];points.push(points[n-1]);while(++i<=n){pi=points[i];px.shift();px.push(pi[0]);py.shift();py.push(pi[1]);d3_svg_lineBasisBezier(path,px,py)}points.pop();path.push("L",pi);return path.join("")}function d3_svg_lineBasisOpen(points){if(points.length<4)return d3_svg_lineLinear(points);var path=[],i=-1,n=points.length,pi,px=[0],py=[0];while(++i<3){pi=points[i];px.push(pi[0]);py.push(pi[1])}path.push(d3_svg_lineDot4(d3_svg_lineBasisBezier3,px)+","+d3_svg_lineDot4(d3_svg_lineBasisBezier3,py));--i;while(++i<n){pi=points[i];px.shift();px.push(pi[0]);py.shift();py.push(pi[1]);d3_svg_lineBasisBezier(path,px,py)}return path.join("")}function d3_svg_lineBasisClosed(points){var path,i=-1,n=points.length,m=n+4,pi,px=[],py=[];while(++i<4){pi=points[i%n];px.push(pi[0]);py.push(pi[1])}path=[d3_svg_lineDot4(d3_svg_lineBasisBezier3,px),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,py)];--i;while(++i<m){pi=points[i%n];px.shift();px.push(pi[0]);py.shift();py.push(pi[1]);d3_svg_lineBasisBezier(path,px,py)}return path.join("")}function d3_svg_lineBundle(points,tension){var n=points.length-1;if(n){var x0=points[0][0],y0=points[0][1],dx=points[n][0]-x0,dy=points[n][1]-y0,i=-1,p,t;while(++i<=n){p=points[i];t=i/n;p[0]=tension*p[0]+(1-tension)*(x0+t*dx);p[1]=tension*p[1]+(1-tension)*(y0+t*dy)}}return d3_svg_lineBasis(points)}function d3_svg_lineDot4(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]}var d3_svg_lineBasisBezier1=[0,2/3,1/3,0],d3_svg_lineBasisBezier2=[0,1/3,2/3,0],d3_svg_lineBasisBezier3=[0,1/6,2/3,1/6];function d3_svg_lineBasisBezier(path,x,y){path.push("C",d3_svg_lineDot4(d3_svg_lineBasisBezier1,x),",",d3_svg_lineDot4(d3_svg_lineBasisBezier1,y),",",d3_svg_lineDot4(d3_svg_lineBasisBezier2,x),",",d3_svg_lineDot4(d3_svg_lineBasisBezier2,y),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,x),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,y))}function d3_svg_lineSlope(p0,p1){return(p1[1]-p0[1])/(p1[0]-p0[0])}function d3_svg_lineFiniteDifferences(points){var i=0,j=points.length-1,m=[],p0=points[0],p1=points[1],d=m[0]=d3_svg_lineSlope(p0,p1);while(++i<j){m[i]=(d+(d=d3_svg_lineSlope(p0=p1,p1=points[i+1])))/2}m[i]=d;return m}function d3_svg_lineMonotoneTangents(points){var tangents=[],d,a,b,s,m=d3_svg_lineFiniteDifferences(points),i=-1,j=points.length-1;while(++i<j){d=d3_svg_lineSlope(points[i],points[i+1]);if(abs(d)<){m[i]=m[i+1]=0}else{a=m[i]/d;b=m[i+1]/d;s=a*a+b*b;if(s>9){s=d*3/Math.sqrt(s);m[i]=s*a;m[i+1]=s*b}}}i=-1;while(++i<=j){s=(points[Math.min(j,i+1)][0]-points[Math.max(0,i-1)][0])/(6*(1+m[i]*m[i]));tangents.push([s||0,m[i]*s||0])}return tangents}function d3_svg_lineMonotone(points){return points.length<3?d3_svg_lineLinear(points):points[0]+d3_svg_lineHermite(points,d3_svg_lineMonotoneTangents(points))}d3.svg.line.radial=function(){var line=d3_svg_line(d3_svg_lineRadial);line.radius=line.x,delete line.x;line.angle=line.y,delete line.y;return line};function d3_svg_lineRadial(points){var point,i=-1,n=points.length,r,a;while(++i<n){point=points[i];r=point[0];a=point[1]+d3_svg_arcOffset;point[0]=r*Math.cos(a);point[1]=r*Math.sin(a)}return points}function d3_svg_area(projection){var x0=d3_geom_pointX,x1=d3_geom_pointX,y0=0,y1=d3_geom_pointY,defined=d3_true,interpolate=d3_svg_lineLinear,interpolateKey=interpolate.key,interpolateReverse=interpolate,L="L",tension=.7;function area(data){var segments=[],points0=[],points1=[],i=-1,n=data.length,d,fx0=d3_functor(x0),fy0=d3_functor(y0),fx1=x0===x1?function(){return x}:d3_functor(x1),fy1=y0===y1?function(){return y}:d3_functor(y1),x,y;function segment(){segments.push("M",interpolate(projection(points1),tension),L,interpolateReverse(projection(points0.reverse()),tension),"Z")}while(++i<n){if(defined.call(this,d=data[i],i)){points0.push([x=+fx0.call(this,d,i),y=+fy0.call(this,d,i)]);points1.push([+fx1.call(this,d,i),+fy1.call(this,d,i)])}else if(points0.length){segment();points0=[];points1=[]}}if(points0.length)segment();return segments.length?segments.join(""):null}area.x=function(_){if(!arguments.length)return x1;x0=x1=_;return area};area.x0=function(_){if(!arguments.length)return x0;x0=_;return area};area.x1=function(_){if(!arguments.length)return x1;x1=_;return area};area.y=function(_){if(!arguments.length)return y1;y0=y1=_;return area};area.y0=function(_){if(!arguments.length)return y0;y0=_;return area};area.y1=function(_){if(!arguments.length)return y1;y1=_;return area};area.defined=function(_){if(!arguments.length)return defined;defined=_;return area};area.interpolate=function(_){if(!arguments.length)return interpolateKey;if(typeof _==="function")interpolateKey=interpolate=_;else interpolateKey=(interpolate=d3_svg_lineInterpolators.get(_)||d3_svg_lineLinear).key;interpolateReverse=interpolate.reverse||interpolate;L=interpolate.closed?"M":"L";return area};area.tension=function(_){if(!arguments.length)return tension;tension=_;return area};return area}d3_svg_lineStepBefore.reverse=d3_svg_lineStepAfter;d3_svg_lineStepAfter.reverse=d3_svg_lineStepBefore;d3.svg.area=function(){return d3_svg_area(d3_identity)};d3.svg.area.radial=function(){var area=d3_svg_area(d3_svg_lineRadial);area.radius=area.x,delete area.x;area.innerRadius=area.x0,delete area.x0;area.outerRadius=area.x1,delete area.x1;area.angle=area.y,delete area.y;area.startAngle=area.y0,delete area.y0;area.endAngle=area.y1,delete area.y1;return area};d3.svg.chord=function(){var source=d3_source,target=d3_target,radius=d3_svg_chordRadius,startAngle=d3_svg_arcStartAngle,endAngle=d3_svg_arcEndAngle;function chord(d,i){var s=subgroup(this,source,d,i),t=subgroup(this,target,d,i);return"M"+s.p0+arc(s.r,s.p1,s.a1-s.a0)+(equals(s,t)?curve(s.r,s.p1,s.r,s.p0):curve(s.r,s.p1,t.r,t.p0)+arc(t.r,t.p1,t.a1-t.a0)+curve(t.r,t.p1,s.r,s.p0))+"Z"}function subgroup(self,f,d,i){var subgroup=f.call(self,d,i),r=radius.call(self,subgroup,i),a0=startAngle.call(self,subgroup,i)+d3_svg_arcOffset,a1=endAngle.call(self,subgroup,i)+d3_svg_arcOffset;return{r:r,a0:a0,a1:a1,p0:[r*Math.cos(a0),r*Math.sin(a0)],p1:[r*Math.cos(a1),r*Math.sin(a1)]}}function equals(a,b){return a.a0==b.a0&&a.a1==b.a1}function arc(r,p,a){return"A"+r+","+r+" 0 "+ +(a>)+",1 "+p}function curve(r0,p0,r1,p1){return"Q 0,0 "+p1}chord.radius=function(v){if(!arguments.length)return radius;radius=d3_functor(v);return chord};chord.source=function(v){if(!arguments.length)return source;source=d3_functor(v);return chord};chord.target=function(v){if(!arguments.length)return target;target=d3_functor(v);return chord};chord.startAngle=function(v){if(!arguments.length)return startAngle;startAngle=d3_functor(v);return chord};chord.endAngle=function(v){if(!arguments.length)return endAngle;endAngle=d3_functor(v);return chord};return chord};function d3_svg_chordRadius(d){return d.radius}d3.svg.diagonal=function(){var source=d3_source,target=d3_target,projection=d3_svg_diagonalProjection;function diagonal(d,i){var p0=source.call(this,d,i),p3=target.call(this,d,i),m=(p0.y+p3.y)/2,p=[p0,{x:p0.x,y:m},{x:p3.x,y:m},p3];p=p.map(projection);return"M"+p[0]+"C"+p[1]+" "+p[2]+" "+p[3]}diagonal.source=function(x){if(!arguments.length)return source;source=d3_functor(x);return diagonal};diagonal.target=function(x){if(!arguments.length)return target;target=d3_functor(x);return diagonal};diagonal.projection=function(x){if(!arguments.length)return projection;projection=x;return diagonal};return diagonal};function d3_svg_diagonalProjection(d){return[d.x,d.y]}d3.svg.diagonal.radial=function(){var diagonal=d3.svg.diagonal(),projection=d3_svg_diagonalProjection,projection_=diagonal.projection;diagonal.projection=function(x){return arguments.length?projection_(d3_svg_diagonalRadialProjection(projection=x)):projection};return diagonal};function d3_svg_diagonalRadialProjection(projection){return function(){var d=projection.apply(this,arguments),r=d[0],a=d[1]+d3_svg_arcOffset;return[r*Math.cos(a),r*Math.sin(a)]}}d3.svg.symbol=function(){var type=d3_svg_symbolType,size=d3_svg_symbolSize;function symbol(d,i){return(d3_svg_symbols.get(type.call(this,d,i))||d3_svg_symbolCircle)(size.call(this,d,i))}symbol.type=function(x){if(!arguments.length)return type;type=d3_functor(x);return symbol};symbol.size=function(x){if(!arguments.length)return size;size=d3_functor(x);return symbol};return symbol};function d3_svg_symbolSize(){return 64}function d3_svg_symbolType(){return"circle"}function d3_svg_symbolCircle(size){var r=Math.sqrt(size/);return"M0,"+r+"A"+r+","+r+" 0 1,1 0,"+-r+"A"+r+","+r+" 0 1,1 0,"+r+"Z"}var d3_svg_symbols=d3.map({circle:d3_svg_symbolCircle,cross:function(size){var r=Math.sqrt(size/5)/2;return"M"+-3*r+","+-r+"H"+-r+"V"+-3*r+"H"+r+"V"+-r+"H"+3*r+"V"+r+"H"+r+"V"+3*r+"H"+-r+"V"+r+"H"+-3*r+"Z"},diamond:function(size){var ry=Math.sqrt(size/(2*d3_svg_symbolTan30)),rx=ry*d3_svg_symbolTan30;return"M0,"+-ry+"L"+rx+",0"+" 0,"+ry+" "+-rx+",0"+"Z"},square:function(size){var r=Math.sqrt(size)/2;return"M"+-r+","+-r+"L"+r+","+-r+" "+r+","+r+" "+-r+","+r+"Z"},"triangle-down":function(size){var rx=Math.sqrt(size/d3_svg_symbolSqrt3),ry=rx*d3_svg_symbolSqrt3/2;return"M0,"+ry+"L"+rx+","+-ry+" "+-rx+","+-ry+"Z"},"triangle-up":function(size){var rx=Math.sqrt(size/d3_svg_symbolSqrt3),ry=rx*d3_svg_symbolSqrt3/2;return"M0,"+-ry+"L"+rx+","+ry+" "+-rx+","+ry+"Z"}});d3.svg.symbolTypes=d3_svg_symbols.keys();var d3_svg_symbolSqrt3=Math.sqrt(3),d3_svg_symbolTan30=Math.tan(30*d3_radians);function d3_transition(groups,id){d3_subclass(groups,d3_transitionPrototype);groups.id=id;return groups}var d3_transitionPrototype=[],d3_transitionId=0,d3_transitionInheritId,d3_transitionInherit;d3_transitionPrototype.call=d3_selectionPrototype.call;d3_transitionPrototype.empty=d3_selectionPrototype.empty;d3_transitionPrototype.node=d3_selectionPrototype.node;d3_transitionPrototype.size=d3_selectionPrototype.size;d3.transition=function(selection){return arguments.length?d3_transitionInheritId?selection.transition():selection:d3_selectionRoot.transition()};d3.transition.prototype=d3_transitionPrototype;d3_transitionPrototype.select=function(selector){var id=this.id,subgroups=[],subgroup,subnode,node;selector=d3_selection_selector(selector);for(var j=-1,m=this.length;++j<m;){subgroups.push(subgroup=[]);for(var group=this[j],i=-1,n=group.length;++i<n;){if((node=group[i])&&(subnode=selector.call(node,node.__data__,i,j))){if("__data__"in node)subnode.__data__=node.__data__;d3_transitionNode(subnode,i,id,node.__transition__[id]);subgroup.push(subnode)}else{subgroup.push(null)}}}return d3_transition(subgroups,id)};d3_transitionPrototype.selectAll=function(selector){var id=this.id,subgroups=[],subgroup,subnodes,node,subnode,transition;selector=d3_selection_selectorAll(selector);for(var j=-1,m=this.length;++j<m;){for(var group=this[j],i=-1,n=group.length;++i<n;){if(node=group[i]){transition=node.__transition__[id];subnodes=selector.call(node,node.__data__,i,j);subgroups.push(subgroup=[]);for(var k=-1,o=subnodes.length;++k<o;){if(subnode=subnodes[k])d3_transitionNode(subnode,k,id,transition);subgroup.push(subnode)}}}}return d3_transition(subgroups,id)};d3_transitionPrototype.filter=function(filter){var subgroups=[],subgroup,group,node;if(typeof filter!=="function")filter=d3_selection_filter(filter);for(var j=0,m=this.length;j<m;j++){subgroups.push(subgroup=[]);for(var group=this[j],i=0,n=group.length;i<n;i++){if((node=group[i])&&filter.call(node,node.__data__,i,j)){subgroup.push(node)}}}return d3_transition(subgroups,this.id)};d3_transitionPrototype.tween=function(name,tween){var id=this.id;if(arguments.length<2)return this.node().__transition__[id].tween.get(name);return d3_selection_each(this,tween==null?function(node){node.__transition__[id].tween.remove(name)}:function(node){node.__transition__[id].tween.set(name,tween)})};function d3_transition_tween(groups,name,value,tween){var id=groups.id;return d3_selection_each(groups,typeof value==="function"?function(node,i,j){node.__transition__[id].tween.set(name,tween(value.call(node,node.__data__,i,j)))}:(value=tween(value),function(node){node.__transition__[id].tween.set(name,value)}))}d3_transitionPrototype.attr=function(nameNS,value){if(arguments.length<2){for(value in nameNS)this.attr(value,nameNS[value]);return this}var interpolate=nameNS=="transform"?d3_interpolateTransform:d3_interpolate,name=d3.ns.qualify(nameNS);function attrNull(){this.removeAttribute(name)}function attrNullNS(){this.removeAttributeNS(name.space,name.local)}function attrTween(b){return b==null?attrNull:(b+="",function(){var a=this.getAttribute(name),i;return a!==b&&(i=interpolate(a,b),function(t){this.setAttribute(name,i(t))})})}function attrTweenNS(b){return b==null?attrNullNS:(b+="",function(){var a=this.getAttributeNS(name.space,name.local),i;return a!==b&&(i=interpolate(a,b),function(t){this.setAttributeNS(name.space,name.local,i(t))})})}return d3_transition_tween(this,"attr."+nameNS,value,name.local?attrTweenNS:attrTween)};d3_transitionPrototype.attrTween=function(nameNS,tween){var name=d3.ns.qualify(nameNS);function attrTween(d,i){var f=tween.call(this,d,i,this.getAttribute(name));return f&&function(t){this.setAttribute(name,f(t))}}function attrTweenNS(d,i){var f=tween.call(this,d,i,this.getAttributeNS(name.space,name.local));return f&&function(t){this.setAttributeNS(name.space,name.local,f(t))}}return this.tween("attr."+nameNS,name.local?attrTweenNS:attrTween)};d3_transitionPrototype.style=function(name,value,priority){var n=arguments.length;if(n<3){if(typeof name!=="string"){if(n<2)value="";for(priority in name)this.style(priority,name[priority],value);return this}priority=""}function styleNull(){this.style.removeProperty(name)}function styleString(b){return b==null?styleNull:(b+="",function(){var a=d3_window.getComputedStyle(this,null).getPropertyValue(name),i;return a!==b&&(i=d3_interpolate(a,b),function(t){this.style.setProperty(name,i(t),priority)})})}return d3_transition_tween(this,"style."+name,value,styleString)};d3_transitionPrototype.styleTween=function(name,tween,priority){if(arguments.length<3)priority="";function styleTween(d,i){var f=tween.call(this,d,i,d3_window.getComputedStyle(this,null).getPropertyValue(name));return f&&function(t){this.style.setProperty(name,f(t),priority)}}return this.tween("style."+name,styleTween)};d3_transitionPrototype.text=function(value){return d3_transition_tween(this,"text",value,d3_transition_text)};function d3_transition_text(b){if(b==null)b="";return function(){this.textContent=b}}d3_transitionPrototype.remove=function(){return this.each("end.transition",function(){var p;if(this.__transition__.count<2&&(p=this.parentNode))p.removeChild(this)})};d3_transitionPrototype.ease=function(value){var id=this.id;if(arguments.length<1)return this.node().__transition__[id].ease;if(typeof value!=="function")value=d3.ease.apply(d3,arguments);return d3_selection_each(this,function(node){node.__transition__[id].ease=value})};d3_transitionPrototype.delay=function(value){var id=this.id;return d3_selection_each(this,typeof value==="function"?function(node,i,j){node.__transition__[id].delay=+value.call(node,node.__data__,i,j)}:(value=+value,function(node){node.__transition__[id].delay=value}))};d3_transitionPrototype.duration=function(value){var id=this.id;return d3_selection_each(this,typeof value==="function"?function(node,i,j){node.__transition__[id].duration=Math.max(1,value.call(node,node.__data__,i,j))}:(value=Math.max(1,value),function(node){node.__transition__[id].duration=value}))};d3_transitionPrototype.each=function(type,listener){var id=this.id;if(arguments.length<2){var inherit=d3_transitionInherit,inheritId=d3_transitionInheritId;d3_transitionInheritId=id;d3_selection_each(this,function(node,i,j){d3_transitionInherit=node.__transition__[id];type.call(node,node.__data__,i,j)});d3_transitionInherit=inherit;d3_transitionInheritId=inheritId}else{d3_selection_each(this,function(node){var transition=node.__transition__[id];(transition.event||(transition.event=d3.dispatch("start","end"))).on(type,listener)})}return this};d3_transitionPrototype.transition=function(){var id0=this.id,id1=++d3_transitionId,subgroups=[],subgroup,group,node,transition;for(var j=0,m=this.length;j<m;j++){subgroups.push(subgroup=[]);for(var group=this[j],i=0,n=group.length;i<n;i++){if(node=group[i]){transition=Object.create(node.__transition__[id0]);transition.delay+=transition.duration;d3_transitionNode(node,i,id1,transition)}subgroup.push(node)}}return d3_transition(subgroups,id1)};function d3_transitionNode(node,i,id,inherit){var lock=node.__transition__||(node.__transition__={active:0,count:0}),transition=lock[id];if(!transition){var time=inherit.time;transition=lock[id]={tween:new d3_Map,time:time,ease:inherit.ease,delay:inherit.delay,duration:inherit.duration};++lock.count;d3.timer(function(elapsed){var d=node.__data__,ease=transition.ease,delay=transition.delay,duration=transition.duration,timer=d3_timer_active,tweened=[];timer.t=delay+time;if(delay<=elapsed)return start(elapsed-delay);timer.c=start;function start(elapsed){if(lock.active>id)return stop();lock.active=id;transition.event&&transition.event.start.call(node,d,i);transition.tween.forEach(function(key,value){if(value=value.call(node,d,i)){tweened.push(value)}});d3.timer(function(){timer.c=tick(elapsed||1)?d3_true:tick;return 1},0,time)}function tick(elapsed){if(lock.active!==id)return stop();var t=elapsed/duration,e=ease(t),n=tweened.length;while(n>0){tweened[--n].call(node,e)}if(t>=1){transition.event&&transition.event.end.call(node,d,i);return stop()}}function stop(){if(--lock.count)delete lock[id];else delete node.__transition__;return 1}},0,time)}}d3.svg.axis=function(){var scale=d3.scale.linear(),orient=d3_svg_axisDefaultOrient,innerTickSize=6,outerTickSize=6,tickPadding=3,tickArguments_=[10],tickValues=null,tickFormat_;function axis(g){g.each(function(){var g=d3.select(this);var scale0=this.__chart__||scale,scale1=this.__chart__=scale.copy();var ticks=tickValues==null?scale1.ticks?scale1.ticks.apply(scale1,tickArguments_):scale1.domain():tickValues,tickFormat=tickFormat_==null?scale1.tickFormat?scale1.tickFormat.apply(scale1,tickArguments_):d3_identity:tickFormat_,tick=g.selectAll(".tick").data(ticks,scale1),tickEnter=tick.enter().insert("g",".domain").attr("class","tick").style("opacity",),tickExit=d3.transition(tick.exit()).style("opacity",).remove(),tickUpdate=d3.transition(tick).style("opacity",1),tickTransform;var range=d3_scaleRange(scale1),path=g.selectAll(".domain").data([0]),pathUpdate=(path.enter().append("path").attr("class","domain"),d3.transition(path));tickEnter.append("line");tickEnter.append("text");var lineEnter=tickEnter.select("line"),lineUpdate=tickUpdate.select("line"),text=tick.select("text").text(tickFormat),textEnter=tickEnter.select("text"),textUpdate=tickUpdate.select("text");switch(orient){case"bottom":{tickTransform=d3_svg_axisX;lineEnter.attr("y2",innerTickSize);textEnter.attr("y",Math.max(innerTickSize,0)+tickPadding);lineUpdate.attr("x2",0).attr("y2",innerTickSize);textUpdate.attr("x",0).attr("y",Math.max(innerTickSize,0)+tickPadding);text.attr("dy",".71em").style("text-anchor","middle");pathUpdate.attr("d","M"+range[0]+","+outerTickSize+"V0H"+range[1]+"V"+outerTickSize);break}case"top":{tickTransform=d3_svg_axisX;lineEnter.attr("y2",-innerTickSize);textEnter.attr("y",-(Math.max(innerTickSize,0)+tickPadding));lineUpdate.attr("x2",0).attr("y2",-innerTickSize);textUpdate.attr("x",0).attr("y",-(Math.max(innerTickSize,0)+tickPadding));text.attr("dy","0em").style("text-anchor","middle");pathUpdate.attr("d","M"+range[0]+","+-outerTickSize+"V0H"+range[1]+"V"+-outerTickSize);break}case"left":{tickTransform=d3_svg_axisY;lineEnter.attr("x2",-innerTickSize);textEnter.attr("x",-(Math.max(innerTickSize,0)+tickPadding));lineUpdate.attr("x2",-innerTickSize).attr("y2",0);textUpdate.attr("x",-(Math.max(innerTickSize,0)+tickPadding)).attr("y",0);text.attr("dy",".32em").style("text-anchor","end");pathUpdate.attr("d","M"+-outerTickSize+","+range[0]+"H0V"+range[1]+"H"+-outerTickSize);break}case"right":{tickTransform=d3_svg_axisY;lineEnter.attr("x2",innerTickSize);textEnter.attr("x",Math.max(innerTickSize,0)+tickPadding);lineUpdate.attr("x2",innerTickSize).attr("y2",0);textUpdate.attr("x",Math.max(innerTickSize,0)+tickPadding).attr("y",0);text.attr("dy",".32em").style("text-anchor","start");pathUpdate.attr("d","M"+outerTickSize+","+range[0]+"H0V"+range[1]+"H"+outerTickSize);break}}if(scale1.rangeBand){var x=scale1,dx=x.rangeBand()/2;scale0=scale1=function(d){return x(d)+dx}}else if(scale0.rangeBand){scale0=scale1}else{tickExit.call(tickTransform,scale1)}tickEnter.call(tickTransform,scale0);tickUpdate.call(tickTransform,scale1)})}axis.scale=function(x){if(!arguments.length)return scale;scale=x;return axis};axis.orient=function(x){if(!arguments.length)return orient;orient=x in d3_svg_axisOrients?x+"":d3_svg_axisDefaultOrient;return axis};axis.ticks=function(){if(!arguments.length)return tickArguments_;tickArguments_=arguments;return axis};axis.tickValues=function(x){if(!arguments.length)return tickValues;tickValues=x;return axis};axis.tickFormat=function(x){if(!arguments.length)return tickFormat_;tickFormat_=x;return axis};axis.tickSize=function(x){var n=arguments.length;if(!n)return innerTickSize;innerTickSize=+x;outerTickSize=+arguments[n-1];return axis};axis.innerTickSize=function(x){if(!arguments.length)return innerTickSize;innerTickSize=+x;return axis};axis.outerTickSize=function(x){if(!arguments.length)return outerTickSize;outerTickSize=+x;return axis};axis.tickPadding=function(x){if(!arguments.length)return tickPadding;tickPadding=+x;return axis};axis.tickSubdivide=function(){return arguments.length&&axis};return axis};var d3_svg_axisDefaultOrient="bottom",d3_svg_axisOrients={top:1,right:1,bottom:1,left:1};function d3_svg_axisX(selection,x){selection.attr("transform",function(d){return"translate("+x(d)+",0)"})}function d3_svg_axisY(selection,y){selection.attr("transform",function(d){return"translate(0,"+y(d)+")"})}d3.svg.brush=function(){var event=d3_eventDispatch(brush,"brushstart","brush","brushend"),x=null,y=null,xExtent=[0,0],yExtent=[0,0],xExtentDomain,yExtentDomain,xClamp=true,yClamp=true,resizes=d3_svg_brushResizes[0];function brush(g){g.each(function(){var g=d3.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",brushstart).on("touchstart.brush",brushstart);var background=g.selectAll(".background").data([0]);background.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair");g.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");var resize=g.selectAll(".resize").data(resizes,d3_identity);resize.exit().remove();resize.enter().append("g").attr("class",function(d){return"resize "+d}).style("cursor",function(d){return d3_svg_brushCursor[d]}).append("rect").attr("x",function(d){return/[ew]$/.test(d)?-3:null}).attr("y",function(d){return/^[ns]/.test(d)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden");resize.style("display",brush.empty()?"none":null);var gUpdate=d3.transition(g),backgroundUpdate=d3.transition(background),range;if(x){range=d3_scaleRange(x);backgroundUpdate.attr("x",range[0]).attr("width",range[1]-range[0]);redrawX(gUpdate)}if(y){range=d3_scaleRange(y);backgroundUpdate.attr("y",range[0]).attr("height",range[1]-range[0]);redrawY(gUpdate)}redraw(gUpdate)})}brush.event=function(g){g.each(function(){var event_=event.of(this,arguments),extent1={x:xExtent,y:yExtent,i:xExtentDomain,j:yExtentDomain},extent0=this.__chart__||extent1;this.__chart__=extent1;if(d3_transitionInheritId){d3.select(this).transition().each("start.brush",function(){xExtentDomain=extent0.i;yExtentDomain=extent0.j;xExtent=extent0.x;yExtent=extent0.y;event_({type:"brushstart"})}).tween("brush:brush",function(){var xi=d3_interpolateArray(xExtent,extent1.x),yi=d3_interpolateArray(yExtent,extent1.y);xExtentDomain=yExtentDomain=null;return function(t){xExtent=extent1.x=xi(t);yExtent=extent1.y=yi(t);event_({type:"brush",mode:"resize"})}}).each("end.brush",function(){xExtentDomain=extent1.i;yExtentDomain=extent1.j;event_({type:"brush",mode:"resize"});event_({type:"brushend"})})}else{event_({type:"brushstart"});event_({type:"brush",mode:"resize"});event_({type:"brushend"})}})};function redraw(g){g.selectAll(".resize").attr("transform",function(d){return"translate("+xExtent[+/e$/.test(d)]+","+yExtent[+/^s/.test(d)]+")"})}function redrawX(g){g.select(".extent").attr("x",xExtent[0]);g.selectAll(".extent,.n>rect,.s>rect").attr("width",xExtent[1]-xExtent[0])}function redrawY(g){g.select(".extent").attr("y",yExtent[0]);g.selectAll(".extent,.e>rect,.w>rect").attr("height",yExtent[1]-yExtent[0])}function brushstart(){var target=this,eventTarget=d3.select(d3.event.target),event_=event.of(target,arguments),g=d3.select(target),resizing=eventTarget.datum(),resizingX=!/^(n|s)$/.test(resizing)&&x,resizingY=!/^(e|w)$/.test(resizing)&&y,dragging=eventTarget.classed("extent"),dragRestore=d3_event_dragSuppress(),center,origin=d3.mouse(target),offset;var w=d3.select(d3_window).on("keydown.brush",keydown).on("keyup.brush",keyup);if(d3.event.changedTouches){w.on("touchmove.brush",brushmove).on("touchend.brush",brushend)}else{w.on("mousemove.brush",brushmove).on("mouseup.brush",brushend)}g.interrupt().selectAll("*").interrupt();if(dragging){origin[0]=xExtent[0]-origin[0];origin[1]=yExtent[0]-origin[1]}else if(resizing){var ex=+/w$/.test(resizing),ey=+/^n/.test(resizing);offset=[xExtent[1-ex]-origin[0],yExtent[1-ey]-origin[1]];origin[0]=xExtent[ex];origin[1]=yExtent[ey]}else if(d3.event.altKey)center=origin.slice();g.style("pointer-events","none").selectAll(".resize").style("display",null);d3.select("body").style("cursor",eventTarget.style("cursor"));event_({type:"brushstart"});brushmove();function keydown(){if(d3.event.keyCode==32){if(!dragging){center=null;origin[0]-=xExtent[1];origin[1]-=yExtent[1];dragging=2}d3_eventPreventDefault()}}function keyup(){if(d3.event.keyCode==32&&dragging==2){origin[0]+=xExtent[1];origin[1]+=yExtent[1];dragging=0;d3_eventPreventDefault()}}function brushmove(){var point=d3.mouse(target),moved=false;if(offset){point[0]+=offset[0];point[1]+=offset[1]}if(!dragging){if(d3.event.altKey){if(!center)center=[(xExtent[0]+xExtent[1])/2,(yExtent[0]+yExtent[1])/2];origin[0]=xExtent[+(point[0]<center[0])];origin[1]=yExtent[+(point[1]<center[1])]}else center=null}if(resizingX&&move1(point,x,0)){redrawX(g);moved=true}if(resizingY&&move1(point,y,1)){redrawY(g);moved=true}if(moved){redraw(g);event_({type:"brush",mode:dragging?"move":"resize"})}}function move1(point,scale,i){var range=d3_scaleRange(scale),r0=range[0],r1=range[1],position=origin[i],extent=i?yExtent:xExtent,size=extent[1]-extent[0],min,max;if(dragging){r0-=position;r1-=size+position}min=(i?yClamp:xClamp)?Math.max(r0,Math.min(r1,point[i])):point[i];if(dragging){max=(min+=position)+size}else{if(center)position=Math.max(r0,Math.min(r1,2*center[i]-min));if(position<min){max=min;min=position}else{max=position}}if(extent[0]!=min||extent[1]!=max){if(i)yExtentDomain=null;else xExtentDomain=null;extent[0]=min;extent[1]=max;return true}}function brushend(){brushmove();g.style("pointer-events","all").selectAll(".resize").style("display",brush.empty()?"none":null);d3.select("body").style("cursor",null);w.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null);dragRestore();event_({type:"brushend"})}}brush.x=function(z){if(!arguments.length)return x;x=z;resizes=d3_svg_brushResizes[!x<<1|!y];return brush};brush.y=function(z){if(!arguments.length)return y;y=z;resizes=d3_svg_brushResizes[!x<<1|!y];return brush};brush.clamp=function(z){if(!arguments.length)return x&&y?[xClamp,yClamp]:x?xClamp:y?yClamp:null;if(x&&y)xClamp=!!z[0],yClamp=!!z[1];else if(x)xClamp=!!z;else if(y)yClamp=!!z;return brush};brush.extent=function(z){var x0,x1,y0,y1,t;if(!arguments.length){if(x){if(xExtentDomain){x0=xExtentDomain[0],x1=xExtentDomain[1]}else{x0=xExtent[0],x1=xExtent[1];if(x.invert)x0=x.invert(x0),x1=x.invert(x1);if(x1<x0)t=x0,x0=x1,x1=t}}if(y){if(yExtentDomain){y0=yExtentDomain[0],y1=yExtentDomain[1]}else{y0=yExtent[0],y1=yExtent[1];if(y.invert)y0=y.invert(y0),y1=y.invert(y1);if(y1<y0)t=y0,y0=y1,y1=t}}return x&&y?[[x0,y0],[x1,y1]]:x?[x0,x1]:y&&[y0,y1]}if(x){x0=z[0],x1=z[1];if(y)x0=x0[0],x1=x1[0];xExtentDomain=[x0,x1];if(x.invert)x0=x(x0),x1=x(x1);if(x1<x0)t=x0,x0=x1,x1=t;if(x0!=xExtent[0]||x1!=xExtent[1])xExtent=[x0,x1]}if(y){y0=z[0],y1=z[1];if(x)y0=y0[1],y1=y1[1];yExtentDomain=[y0,y1];if(y.invert)y0=y(y0),y1=y(y1);if(y1<y0)t=y0,y0=y1,y1=t;if(y0!=yExtent[0]||y1!=yExtent[1])yExtent=[y0,y1]}return brush};brush.clear=function(){if(!brush.empty()){xExtent=[0,0],yExtent=[0,0];xExtentDomain=yExtentDomain=null}return brush};brush.empty=function(){return!!x&&xExtent[0]==xExtent[1]||!!y&&yExtent[0]==yExtent[1]};return d3.rebind(brush,event,"on")};var d3_svg_brushCursor={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"};var d3_svg_brushResizes=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]];var d3_time=d3.time={},d3_date=Date,d3_time_daySymbols=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];function d3_date_utc(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}d3_date_utc.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){d3_time_prototype.setUTCDate.apply(this._,arguments)},setDay:function(){d3_time_prototype.setUTCDay.apply(this._,arguments)},setFullYear:function(){d3_time_prototype.setUTCFullYear.apply(this._,arguments)},setHours:function(){d3_time_prototype.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){d3_time_prototype.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){d3_time_prototype.setUTCMinutes.apply(this._,arguments)},setMonth:function(){d3_time_prototype.setUTCMonth.apply(this._,arguments)},setSeconds:function(){d3_time_prototype.setUTCSeconds.apply(this._,arguments)},setTime:function(){d3_time_prototype.setTime.apply(this._,arguments)}};var d3_time_prototype=Date.prototype;var d3_time_formatDateTime="%a %b %e %X %Y",d3_time_formatDate="%m/%d/%Y",d3_time_formatTime="%H:%M:%S";var d3_time_days=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],d3_time_dayAbbreviations=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],d3_time_months=["January","February","March","April","May","June","July","August","September","October","November","December"],d3_time_monthAbbreviations=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function d3_time_interval(local,step,number){function round(date){var d0=local(date),d1=offset(d0,1);return date-d0<d1-date?d0:d1}function ceil(date){step(date=local(new d3_date(date-1)),1);return date}function offset(date,k){step(date=new d3_date(+date),k);return date}function range(t0,t1,dt){var time=ceil(t0),times=[];if(dt>1){while(time<t1){if(!(number(time)%dt))times.push(new Date(+time));step(time,1)}}else{while(time<t1)times.push(new Date(+time)),step(time,1)}return times}function range_utc(t0,t1,dt){try{d3_date=d3_date_utc;var utc=new d3_date_utc;utc._=t0;return range(utc,t1,dt)}finally{d3_date=Date}}local.floor=local;local.round=round;local.ceil=ceil;local.offset=offset;local.range=range;var utc=local.utc=d3_time_interval_utc(local);utc.floor=utc;utc.round=d3_time_interval_utc(round);utc.ceil=d3_time_interval_utc(ceil);utc.offset=d3_time_interval_utc(offset);utc.range=range_utc;return local}function d3_time_interval_utc(method){return function(date,k){try{d3_date=d3_date_utc;var utc=new d3_date_utc;utc._=date;return method(utc,k)._}finally{d3_date=Date}}}d3_time.year=d3_time_interval(function(date){date=d3_time.day(date);date.setMonth(0,1);return date},function(date,offset){date.setFullYear(date.getFullYear()+offset)},function(date){return date.getFullYear()});d3_time.years=d3_time.year.range;d3_time.years.utc=d3_time.year.utc.range;d3_time.day=d3_time_interval(function(date){var day=new d3_date(2e3,0);day.setFullYear(date.getFullYear(),date.getMonth(),date.getDate());return day},function(date,offset){date.setDate(date.getDate()+offset)},function(date){return date.getDate()-1});d3_time.days=d3_time.day.range;d3_time.days.utc=d3_time.day.utc.range;d3_time.dayOfYear=function(date){var year=d3_time.year(date);return Math.floor((date-year-(date.getTimezoneOffset()-year.getTimezoneOffset())*6e4)/864e5)};d3_time_daySymbols.forEach(function(day,i){day=day.toLowerCase();i=7-i;var interval=d3_time[day]=d3_time_interval(function(date){(date=d3_time.day(date)).setDate(date.getDate()-(date.getDay()+i)%7);return date},function(date,offset){date.setDate(date.getDate()+Math.floor(offset)*7)},function(date){var day=d3_time.year(date).getDay();return Math.floor((d3_time.dayOfYear(date)+(day+i)%7)/7)-(day!==i)});d3_time[day+"s"]=interval.range;d3_time[day+"s"].utc=interval.utc.range;d3_time[day+"OfYear"]=function(date){var day=d3_time.year(date).getDay();return Math.floor((d3_time.dayOfYear(date)+(day+i)%7)/7)}});d3_time.week=d3_time.sunday;d3_time.weeks=d3_time.sunday.range;d3_time.weeks.utc=d3_time.sunday.utc.range;d3_time.weekOfYear=d3_time.sundayOfYear;d3_time.format=d3_time_format;function d3_time_format(template){var n=template.length;function format(date){var string=[],i=-1,j=0,c,p,f;while(++i<n){if(template.charCodeAt(i)===37){string.push(template.substring(j,i));if((p=d3_time_formatPads[c=template.charAt(++i)])!=null)c=template.charAt(++i);if(f=d3_time_formats[c])c=f(date,p==null?c==="e"?" ":"0":p);string.push(c);j=i+1}}string.push(template.substring(j,i));return string.join("")}format.parse=function(string){var d={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null},i=d3_time_parse(d,template,string,0);if(i!=string.length)return null;if("p"in d)d.H=d.H%12+d.p*12;var localZ=d.Z!=null&&d3_date!==d3_date_utc,date=new(localZ?d3_date_utc:d3_date);if("j"in d)date.setFullYear(d.y,0,d.j);else if("w"in d&&("W"in d||"U"in d)){date.setFullYear(d.y,0,1);date.setFullYear(d.y,0,"W"in d?(d.w+6)%7+d.W*7-(date.getDay()+5)%7:d.w+d.U*7-(date.getDay()+6)%7)}else date.setFullYear(d.y,d.m,d.d);date.setHours(d.H+Math.floor(d.Z/100),d.M+d.Z%100,d.S,d.L);return localZ?date._:date};format.toString=function(){return template};return format}function d3_time_parse(date,template,string,j){var c,p,t,i=0,n=template.length,m=string.length;while(i<n){if(j>=m)return-1;c=template.charCodeAt(i++);if(c===37){t=template.charAt(i++);p=d3_time_parsers[t in d3_time_formatPads?template.charAt(i++):t];if(!p||(j=p(date,string,j))<0)return-1}else if(c!=string.charCodeAt(j++)){return-1}}return j}function d3_time_formatRe(names){return new RegExp("^(?:"+names.map(d3.requote).join("|")+")","i")}function d3_time_formatLookup(names){var map=new d3_Map,i=-1,n=names.length;while(++i<n)map.set(names[i].toLowerCase(),i);return map}function d3_time_formatPad(value,fill,width){var sign=value<0?"-":"",string=(sign?-value:value)+"",length=string.length;return sign+(length<width?new Array(width-length+1).join(fill)+string:string)}var d3_time_dayRe=d3_time_formatRe(d3_time_days),d3_time_dayLookup=d3_time_formatLookup(d3_time_days),d3_time_dayAbbrevRe=d3_time_formatRe(d3_time_dayAbbreviations),d3_time_dayAbbrevLookup=d3_time_formatLookup(d3_time_dayAbbreviations),d3_time_monthRe=d3_time_formatRe(d3_time_months),d3_time_monthLookup=d3_time_formatLookup(d3_time_months),d3_time_monthAbbrevRe=d3_time_formatRe(d3_time_monthAbbreviations),d3_time_monthAbbrevLookup=d3_time_formatLookup(d3_time_monthAbbreviations),d3_time_percentRe=/^%/;var d3_time_formatPads={"-":"",_:" ",0:"0"};var d3_time_formats={a:function(d){return d3_time_dayAbbreviations[d.getDay()]},A:function(d){return d3_time_days[d.getDay()]},b:function(d){return d3_time_monthAbbreviations[d.getMonth()]},B:function(d){return d3_time_months[d.getMonth()]},c:d3_time_format(d3_time_formatDateTime),d:function(d,p){return d3_time_formatPad(d.getDate(),p,2)},e:function(d,p){return d3_time_formatPad(d.getDate(),p,2)},H:function(d,p){return d3_time_formatPad(d.getHours(),p,2)},I:function(d,p){return d3_time_formatPad(d.getHours()%12||12,p,2)},j:function(d,p){return d3_time_formatPad(1+d3_time.dayOfYear(d),p,3)},L:function(d,p){return d3_time_formatPad(d.getMilliseconds(),p,3)},m:function(d,p){return d3_time_formatPad(d.getMonth()+1,p,2)},M:function(d,p){return d3_time_formatPad(d.getMinutes(),p,2)},p:function(d){return d.getHours()>=12?"PM":"AM"},S:function(d,p){return d3_time_formatPad(d.getSeconds(),p,2)},U:function(d,p){return d3_time_formatPad(d3_time.sundayOfYear(d),p,2)},w:function(d){return d.getDay()},W:function(d,p){return d3_time_formatPad(d3_time.mondayOfYear(d),p,2)},x:d3_time_format(d3_time_formatDate),X:d3_time_format(d3_time_formatTime),y:function(d,p){return d3_time_formatPad(d.getFullYear()%100,p,2)},Y:function(d,p){return d3_time_formatPad(d.getFullYear()%1e4,p,4)},Z:d3_time_zone,"%":function(){return"%"}};var d3_time_parsers={a:d3_time_parseWeekdayAbbrev,A:d3_time_parseWeekday,b:d3_time_parseMonthAbbrev,B:d3_time_parseMonth,c:d3_time_parseLocaleFull,d:d3_time_parseDay,e:d3_time_parseDay,H:d3_time_parseHour24,I:d3_time_parseHour24,j:d3_time_parseDayOfYear,L:d3_time_parseMilliseconds,m:d3_time_parseMonthNumber,M:d3_time_parseMinutes,p:d3_time_parseAmPm,S:d3_time_parseSeconds,U:d3_time_parseWeekNumberSunday,w:d3_time_parseWeekdayNumber,W:d3_time_parseWeekNumberMonday,x:d3_time_parseLocaleDate,X:d3_time_parseLocaleTime,y:d3_time_parseYear,Y:d3_time_parseFullYear,Z:d3_time_parseZone,"%":d3_time_parseLiteralPercent};function d3_time_parseWeekdayAbbrev(date,string,i){d3_time_dayAbbrevRe.lastIndex=0;var n=d3_time_dayAbbrevRe.exec(string.substring(i));return n?(date.w=d3_time_dayAbbrevLookup.get(n[0].toLowerCase()),i+n[0].length):-1}function d3_time_parseWeekday(date,string,i){d3_time_dayRe.lastIndex=0;var n=d3_time_dayRe.exec(string.substring(i));return n?(date.w=d3_time_dayLookup.get(n[0].toLowerCase()),i+n[0].length):-1}function d3_time_parseWeekdayNumber(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.substring(i,i+1));return n?(date.w=+n[0],i+n[0].length):-1}function d3_time_parseWeekNumberSunday(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.substring(i));return n?(date.U=+n[0],i+n[0].length):-1}function d3_time_parseWeekNumberMonday(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.substring(i));return n?(date.W=+n[0],i+n[0].length):-1}function d3_time_parseMonthAbbrev(date,string,i){d3_time_monthAbbrevRe.lastIndex=0;var n=d3_time_monthAbbrevRe.exec(string.substring(i));return n?(date.m=d3_time_monthAbbrevLookup.get(n[0].toLowerCase()),i+n[0].length):-1}function d3_time_parseMonth(date,string,i){d3_time_monthRe.lastIndex=0;var n=d3_time_monthRe.exec(string.substring(i));return n?(date.m=d3_time_monthLookup.get(n[0].toLowerCase()),i+n[0].length):-1}function d3_time_parseLocaleFull(date,string,i){return d3_time_parse(date,d3_time_formats.c.toString(),string,i)}function d3_time_parseLocaleDate(date,string,i){return d3_time_parse(date,d3_time_formats.x.toString(),string,i)}function d3_time_parseLocaleTime(date,string,i){return d3_time_parse(date,d3_time_formats.X.toString(),string,i)}function d3_time_parseFullYear(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.substring(i,i+4));return n?(date.y=+n[0],i+n[0].length):-1}function d3_time_parseYear(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.substring(i,i+2));return n?(date.y=d3_time_expandYear(+n[0]),i+n[0].length):-1}function d3_time_parseZone(date,string,i){return/^[+-]\d{4}$/.test(string=string.substring(i,i+5))?(date.Z=+string,i+5):-1}function d3_time_expandYear(d){return d+(d>68?1900:2e3)}function d3_time_parseMonthNumber(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.substring(i,i+2));return n?(date.m=n[0]-1,i+n[0].length):-1}function d3_time_parseDay(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.substring(i,i+2));return n?(date.d=+n[0],i+n[0].length):-1}function d3_time_parseDayOfYear(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.substring(i,i+3));return n?(date.j=+n[0],i+n[0].length):-1}function d3_time_parseHour24(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.substring(i,i+2));return n?(date.H=+n[0],i+n[0].length):-1}function d3_time_parseMinutes(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.substring(i,i+2));return n?(date.M=+n[0],i+n[0].length):-1}function d3_time_parseSeconds(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.substring(i,i+2));return n?(date.S=+n[0],i+n[0].length):-1}function d3_time_parseMilliseconds(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.substring(i,i+3));return n?(date.L=+n[0],i+n[0].length):-1}var d3_time_numberRe=/^\s*\d+/;function d3_time_parseAmPm(date,string,i){var n=d3_time_amPmLookup.get(string.substring(i,i+=2).toLowerCase());return n==null?-1:(date.p=n,i)}var d3_time_amPmLookup=d3.map({am:0,pm:1});function d3_time_zone(d){var z=d.getTimezoneOffset(),zs=z>0?"-":"+",zh=~~(abs(z)/60),zm=abs(z)%60;return zs+d3_time_formatPad(zh,"0",2)+d3_time_formatPad(zm,"0",2)}function d3_time_parseLiteralPercent(date,string,i){d3_time_percentRe.lastIndex=0;var n=d3_time_percentRe.exec(string.substring(i,i+1));return n?i+n[0].length:-1}d3_time_format.utc=d3_time_formatUtc;function d3_time_formatUtc(template){var local=d3_time_format(template);function format(date){try{d3_date=d3_date_utc;var utc=new d3_date;utc._=date;return local(utc)}finally{d3_date=Date}}format.parse=function(string){try{d3_date=d3_date_utc;var date=local.parse(string);return date&&date._}finally{d3_date=Date}};format.toString=local.toString;return format}var d3_time_formatIso=d3_time_formatUtc("%Y-%m-%dT%H:%M:%S.%LZ");d3_time_format.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?d3_time_formatIsoNative:d3_time_formatIso;function d3_time_formatIsoNative(date){return date.toISOString()}d3_time_formatIsoNative.parse=function(string){var date=new Date(string);return isNaN(date)?null:date};d3_time_formatIsoNative.toString=d3_time_formatIso.toString;d3_time.second=d3_time_interval(function(date){return new d3_date(Math.floor(date/1e3)*1e3)},function(date,offset){date.setTime(date.getTime()+Math.floor(offset)*1e3)},function(date){return date.getSeconds()});d3_time.seconds=d3_time.second.range;d3_time.seconds.utc=d3_time.second.utc.range;d3_time.minute=d3_time_interval(function(date){return new d3_date(Math.floor(date/6e4)*6e4)},function(date,offset){date.setTime(date.getTime()+Math.floor(offset)*6e4)},function(date){return date.getMinutes()});d3_time.minutes=d3_time.minute.range;d3_time.minutes.utc=d3_time.minute.utc.range;d3_time.hour=d3_time_interval(function(date){var timezone=date.getTimezoneOffset()/60;return new d3_date((Math.floor(date/36e5-timezone)+timezone)*36e5)},function(date,offset){date.setTime(date.getTime()+Math.floor(offset)*36e5)},function(date){return date.getHours()});d3_time.hours=d3_time.hour.range;d3_time.hours.utc=d3_time.hour.utc.range;d3_time.month=d3_time_interval(function(date){date=d3_time.day(date);date.setDate(1);return date},function(date,offset){date.setMonth(date.getMonth()+offset)},function(date){return date.getMonth()});d3_time.months=d3_time.month.range;d3_time.months.utc=d3_time.month.utc.range;function d3_time_scale(linear,methods,format){function scale(x){return linear(x)}scale.invert=function(x){return d3_time_scaleDate(linear.invert(x))};scale.domain=function(x){if(!arguments.length)return linear.domain().map(d3_time_scaleDate);linear.domain(x);return scale};function tickMethod(extent,count){var span=extent[1]-extent[0],target=span/count,i=d3.bisect(d3_time_scaleSteps,target);return i==d3_time_scaleSteps.length?[methods.year,d3_scale_linearTickRange(extent.map(function(d){return d/31536e6}),count)[2]]:!i?[d3_time_scaleMilliseconds,d3_scale_linearTickRange(extent,count)[2]]:methods[target/d3_time_scaleSteps[i-1]<d3_time_scaleSteps[i]/target?i-1:i]}scale.nice=function(interval,skip){var domain=scale.domain(),extent=d3_scaleExtent(domain),method=interval==null?tickMethod(extent,10):typeof interval==="number"&&tickMethod(extent,interval);if(method)interval=method[0],skip=method[1];function skipped(date){return!isNaN(date)&&!interval.range(date,d3_time_scaleDate(+date+1),skip).length}return scale.domain(d3_scale_nice(domain,skip>1?{floor:function(date){while(skipped(date=interval.floor(date)))date=d3_time_scaleDate(date-1);return date},ceil:function(date){while(skipped(date=interval.ceil(date)))date=d3_time_scaleDate(+date+1);return date}}:interval))};scale.ticks=function(interval,skip){var extent=d3_scaleExtent(scale.domain()),method=interval==null?tickMethod(extent,10):typeof interval==="number"?tickMethod(extent,interval):!interval.range&&[{range:interval},skip];if(method)interval=method[0],skip=method[1];return interval.range(extent[0],d3_time_scaleDate(+extent[1]+1),skip<1?1:skip)};scale.tickFormat=function(){return format};scale.copy=function(){return d3_time_scale(linear.copy(),methods,format)};return d3_scale_linearRebind(scale,linear)}function d3_time_scaleDate(t){return new Date(t)}function d3_time_scaleFormat(formats){return function(date){var i=formats.length-1,f=formats[i];while(!f[1](date))f=formats[--i];return f[0](date)}}var d3_time_scaleSteps=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6];var d3_time_scaleLocalMethods=[[d3_time.second,1],[d3_time.second,5],[d3_time.second,15],[d3_time.second,30],[d3_time.minute,1],[d3_time.minute,5],[d3_time.minute,15],[d3_time.minute,30],[d3_time.hour,1],[d3_time.hour,3],[d3_time.hour,6],[d3_time.hour,12],[d3_time.day,1],[d3_time.day,2],[d3_time.week,1],[d3_time.month,1],[d3_time.month,3],[d3_time.year,1]];var d3_time_scaleLocalFormats=[[d3_time_format("%Y"),d3_true],[d3_time_format("%B"),function(d){return d.getMonth()}],[d3_time_format("%b %d"),function(d){return d.getDate()!=1}],[d3_time_format("%a %d"),function(d){return d.getDay()&&d.getDate()!=1}],[d3_time_format("%I %p"),function(d){return d.getHours()}],[d3_time_format("%I:%M"),function(d){return d.getMinutes()}],[d3_time_format(":%S"),function(d){return d.getSeconds()}],[d3_time_format(".%L"),function(d){return d.getMilliseconds()}]];var d3_time_scaleLocalFormat=d3_time_scaleFormat(d3_time_scaleLocalFormats);d3_time_scaleLocalMethods.year=d3_time.year;d3_time.scale=function(){return d3_time_scale(d3.scale.linear(),d3_time_scaleLocalMethods,d3_time_scaleLocalFormat)};var d3_time_scaleMilliseconds={range:function(start,stop,step){return d3.range(+start,+stop,step).map(d3_time_scaleDate)}};var d3_time_scaleUTCMethods=d3_time_scaleLocalMethods.map(function(m){return[m[0].utc,m[1]]});var d3_time_scaleUTCFormats=[[d3_time_formatUtc("%Y"),d3_true],[d3_time_formatUtc("%B"),function(d){return d.getUTCMonth()}],[d3_time_formatUtc("%b %d"),function(d){return d.getUTCDate()!=1}],[d3_time_formatUtc("%a %d"),function(d){return d.getUTCDay()&&d.getUTCDate()!=1}],[d3_time_formatUtc("%I %p"),function(d){return d.getUTCHours()}],[d3_time_formatUtc("%I:%M"),function(d){return d.getUTCMinutes()}],[d3_time_formatUtc(":%S"),function(d){return d.getUTCSeconds()}],[d3_time_formatUtc(".%L"),function(d){return d.getUTCMilliseconds()}]];var d3_time_scaleUTCFormat=d3_time_scaleFormat(d3_time_scaleUTCFormats);d3_time_scaleUTCMethods.year=d3_time.year.utc;d3_time.scale.utc=function(){return d3_time_scale(d3.scale.linear(),d3_time_scaleUTCMethods,d3_time_scaleUTCFormat)};d3.text=d3_xhrType(function(request){return request.responseText});d3.json=function(url,callback){return d3_xhr(url,"application/json",d3_json,callback)};function d3_json(request){return JSON.parse(request.responseText)}d3.html=function(url,callback){return d3_xhr(url,"text/html",d3_html,callback)};function d3_html(request){var range=d3_document.createRange();range.selectNode(d3_document.body);return range.createContextualFragment(request.responseText)}d3.xml=d3_xhrType(function(request){return request.responseXML});return d3}();define("d3",function(global){return function(){var ret,fn;return ret||global.d3}}(this));(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define("d3-layout-cloud",[],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g=g.d3||(g.d3={});g=g.layout||(g.layout={});g.cloud=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){var dispatch=require("d3-dispatch").dispatch;var cloudRadians=Math.PI/180,cw=1<<11>>5,ch=1<<11;module.exports=function(){var size=[256,256],text=cloudText,font=cloudFont,fontSize=cloudFontSize,fontStyle=cloudFontNormal,fontWeight=cloudFontNormal,rotate=cloudRotate,padding=cloudPadding,spiral=archimedeanSpiral,words=[],timeInterval=Infinity,event=dispatch("word","end"),timer=null,random=Math.random,cloud={},canvas=cloudCanvas;cloud.canvas=function(_){return arguments.length?(canvas=functor(_),cloud):canvas};cloud.start=function(){var contextAndRatio=getContext(canvas()),board=zeroArray((size[0]>>5)*size[1]),bounds=null,n=words.length,i=-1,tags=[],data=words.map(function(d,i){d.text=text.call(this,d,i);d.font=font.call(this,d,i);d.style=fontStyle.call(this,d,i);d.weight=fontWeight.call(this,d,i);d.rotate=rotate.call(this,d,i);d.size=~~fontSize.call(this,d,i);d.padding=padding.call(this,d,i);return d}).sort(function(a,b){return b.size-a.size});if(timer)clearInterval(timer);timer=setInterval(step,0);step();return cloud;function step(){var start=Date.now();while(Date.now()-start<timeInterval&&++i<n&&timer){var d=data[i];d.x=size[0]*(random()+.5)>>1;d.y=size[1]*(random()+.5)>>1;cloudSprite(contextAndRatio,d,data,i);if(d.hasText&&place(board,d,bounds)){tags.push(d);event.word(d);if(bounds)cloudBounds(bounds,d);else bounds=[{x:d.x+d.x0,y:d.y+d.y0},{x:d.x+d.x1,y:d.y+d.y1}];d.x-=size[0]>>1;d.y-=size[1]>>1}}if(i>=n){cloud.stop();event.end(tags,bounds)}}};cloud.stop=function(){if(timer){clearInterval(timer);timer=null}return cloud};function getContext(canvas){canvas.width=canvas.height=1;var ratio=Math.sqrt(canvas.getContext("2d").getImageData(0,0,1,1).data.length>>2);canvas.width=(cw<<5)/ratio;canvas.height=ch/ratio;var context=canvas.getContext("2d");context.fillStyle=context.strokeStyle="red";context.textAlign="center";return{context:context,ratio:ratio}}function place(board,tag,bounds){var perimeter=[{x:0,y:0},{x:size[0],y:size[1]}],startX=tag.x,startY=tag.y,maxDelta=Math.sqrt(size[0]*size[0]+size[1]*size[1]),s=spiral(size),dt=random()<.5?1:-1,t=-dt,dxdy,dx,dy;while(dxdy=s(t+=dt)){dx=~~dxdy[0];dy=~~dxdy[1];if(Math.min(Math.abs(dx),Math.abs(dy))>=maxDelta)break;tag.x=startX+dx;tag.y=startY+dy;if(tag.x+tag.x0<0||tag.y+tag.y0<0||tag.x+tag.x1>size[0]||tag.y+tag.y1>size[1])continue;if(!bounds||!cloudCollide(tag,board,size[0])){if(!bounds||collideRects(tag,bounds)){var sprite=tag.sprite,w=tag.width>>5,sw=size[0]>>5,lx=tag.x-(w<<4),sx=lx&127,msx=32-sx,h=tag.y1-tag.y0,x=(tag.y+tag.y0)*sw+(lx>>5),last;for(var j=0;j<h;j++){last=0;for(var i=0;i<=w;i++){board[x+i]|=last<<msx|(i<w?(last=sprite[j*w+i])>>>sx:0)}x+=sw}delete tag.sprite;return true}}}return false}cloud.timeInterval=function(_){return arguments.length?(timeInterval=_==null?Infinity:_,cloud):timeInterval};cloud.words=function(_){return arguments.length?(words=_,cloud):words};cloud.size=function(_){return arguments.length?(size=[+_[0],+_[1]],cloud):size};cloud.font=function(_){return arguments.length?(font=functor(_),cloud):font};cloud.fontStyle=function(_){return arguments.length?(fontStyle=functor(_),cloud):fontStyle};cloud.fontWeight=function(_){return arguments.length?(fontWeight=functor(_),cloud):fontWeight};cloud.rotate=function(_){return arguments.length?(rotate=functor(_),cloud):rotate};cloud.text=function(_){return arguments.length?(text=functor(_),cloud):text};cloud.spiral=function(_){return arguments.length?(spiral=spirals[_]||_,cloud):spiral};cloud.fontSize=function(_){return arguments.length?(fontSize=functor(_),cloud):fontSize};cloud.padding=function(_){return arguments.length?(padding=functor(_),cloud):padding};cloud.random=function(_){return arguments.length?(random=_,cloud):random};cloud.on=function(){var value=event.on.apply(event,arguments);return value===event?cloud:value};return cloud};function cloudText(d){return d.text}function cloudFont(){return"serif"}function cloudFontNormal(){return"normal"}function cloudFontSize(d){return Math.sqrt(d.value)}function cloudRotate(){return(~~(Math.random()*6)-3)*30}function cloudPadding(){return 1}function cloudSprite(contextAndRatio,d,data,di){if(d.sprite)return;var c=contextAndRatio.context,ratio=contextAndRatio.ratio;c.clearRect(0,0,(cw<<5)/ratio,ch/ratio);var x=0,y=0,maxh=0,n=data.length;--di;while(++di<n){d=data[di];c.save();c.font=d.style+" "+d.weight+" "+~~((d.size+1)/ratio)+"px "+d.font;var w=c.measureText(d.text+"m").width*ratio,h=d.size<<1;if(d.rotate){var sr=Math.sin(d.rotate*cloudRadians),cr=Math.cos(d.rotate*cloudRadians),wcr=w*cr,wsr=w*sr,hcr=h*cr,hsr=h*sr;w=Math.max(Math.abs(wcr+hsr),Math.abs(wcr-hsr))+31>>5<<5;h=~~Math.max(Math.abs(wsr+hcr),Math.abs(wsr-hcr))}else{w=w+31>>5<<5}if(h>maxh)maxh=h;if(x+w>=cw<<5){x=0;y+=maxh;maxh=0}if(y+h>=ch)break;c.translate((x+(w>>1))/ratio,(y+(h>>1))/ratio);if(d.rotate)c.rotate(d.rotate*cloudRadians);c.fillText(d.text,0,0);if(d.padding)c.lineWidth=2*d.padding,c.strokeText(d.text,0,0);c.restore();d.width=w;d.height=h;d.xoff=x;d.yoff=y;d.x1=w>>1;d.y1=h>>1;d.x0=-d.x1;d.y0=-d.y1;d.hasText=true;x+=w}var pixels=c.getImageData(0,0,(cw<<5)/ratio,ch/ratio).data,sprite=[];while(--di>=0){d=data[di];if(!d.hasText)continue;var w=d.width,w32=w>>5,h=d.y1-d.y0;for(var i=0;i<h*w32;i++)sprite[i]=0;x=d.xoff;if(x==null)return;y=d.yoff;var seen=0,seenRow=-1;for(var j=0;j<h;j++){for(var i=0;i<w;i++){var k=w32*j+(i>>5),m=pixels[(y+j)*(cw<<5)+(x+i)<<2]?1<<31-i%32:0;sprite[k]|=m;seen|=m}if(seen)seenRow=j;else{d.y0++;h--;j--;y++}}d.y1=d.y0+seenRow;d.sprite=sprite.slice(0,(d.y1-d.y0)*w32)}}function cloudCollide(tag,board,sw){sw>>=5;var sprite=tag.sprite,w=tag.width>>5,lx=tag.x-(w<<4),sx=lx&127,msx=32-sx,h=tag.y1-tag.y0,x=(tag.y+tag.y0)*sw+(lx>>5),last;for(var j=0;j<h;j++){last=0;for(var i=0;i<=w;i++){if((last<<msx|(i<w?(last=sprite[j*w+i])>>>sx:0))&board[x+i])return true}x+=sw}return false}function cloudBounds(bounds,d){var b0=bounds[0],b1=bounds[1];if(d.x+d.x0<b0.x)b0.x=d.x+d.x0;if(d.y+d.y0<b0.y)b0.y=d.y+d.y0;if(d.x+d.x1>b1.x)b1.x=d.x+d.x1;if(d.y+d.y1>b1.y)b1.y=d.y+d.y1}function collideRects(a,b){return a.x+a.x1>b[0].x&&a.x+a.x0<b[1].x&&a.y+a.y1>b[0].y&&a.y+a.y0<b[1].y}function archimedeanSpiral(size){var e=size[0]/size[1];return function(t){return[e*(t*=.1)*Math.cos(t),t*Math.sin(t)]}}function rectangularSpiral(size){var dy=4,dx=dy*size[0]/size[1],x=0,y=0;return function(t){var sign=t<0?-1:1;switch(Math.sqrt(1+4*sign*t)-sign&3){case 0:x+=dx;break;case 1:y+=dy;break;case 2:x-=dx;break;default:y-=dy;break}return[x,y]}}function zeroArray(n){var a=[],i=-1;while(++i<n)a[i]=0;return a}function cloudCanvas(){return document.createElement("canvas")}function functor(d){return typeof d==="function"?d:function(){return d}}var spirals={archimedean:archimedeanSpiral,rectangular:rectangularSpiral}},{"d3-dispatch":2}],2:[function(require,module,exports){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports):typeof define==="function"&&define.amd?define(["exports"],factory):factory(global.dispatch={})})(this,function(exports){"use strict";function Dispatch(types){var i=-1,n=types.length,callbacksByType={},callbackByName={},type,that=this;that.on=function(type,callback){type=parseType(type);if(arguments.length<2){return(callback=callbackByName[type.name])&&callback.value}if(type.type){var callbacks=callbacksByType[type.type],callback0=callbackByName[type.name],i;if(callback0){callback0.value=null;i=callbacks.indexOf(callback0);callbacksByType[type.type]=callbacks=callbacks.slice(0,i).concat(callbacks.slice(i+1));delete callbackByName[type.name]}if(callback){callback={value:callback};callbackByName[type.name]=callback;callbacks.push(callback)}}else if(callback==null){for(var otherType in callbacksByType){if(callback=callbackByName[otherType+type.name]){callback.value=null;var callbacks=callbacksByType[otherType],i=callbacks.indexOf(callback);callbacksByType[otherType]=callbacks.slice(0,i).concat(callbacks.slice(i+1));delete callbackByName[callback.name]}}}return that};while(++i<n){type=types[i]+"";if(!type||type in that)throw new Error("illegal or duplicate type: "+type);callbacksByType[type]=[];that[type]=applier(type)}function parseType(type){var i=(type+="").indexOf("."),name=type;if(i>=0)type=type.slice(0,i);else name+=".";if(type&&!callbacksByType.hasOwnProperty(type))throw new Error("unknown type: "+type);return{type:type,name:name}}function applier(type){return function(){var callbacks=callbacksByType[type],callback,callbackValue,i=-1,n=callbacks.length;while(++i<n){if(callbackValue=(callback=callbacks[i]).value){callbackValue.apply(this,arguments)}}return that}}}function dispatch(){return new Dispatch(arguments)}dispatch.prototype=Dispatch.prototype;exports.dispatch=dispatch})},{}]},{},[1])(1)});define("src/helpers/topicsSizingHelper",["underscore","d3"],function(_,d3){"use strict";var DEFAULTS={CONTAINER_WIDTH:700,FONT_SIZE:90,AVERAGE_CHAR_WIDTH:79*.8,MIN_FONT_SIZE:12,MAX_FONT_SIZE:110,FONT_SIZE_DECREMENT:15};function getVolumeAdjustmentScale(wordsToPlace,currentMaxFontSize){var minAdjustment=DEFAULTS.MIN_FONT_SIZE/currentMaxFontSize;var volumeDomain=wordsToPlace.reduce(function(volumeDomain,word){var minVolume=Math.min(word.size,volumeDomain[0]);var maxVolume=Math.max(word.size,volumeDomain[1]);return[minVolume,maxVolume]},[Number.POSITIVE_INFINITY,0]);return d3.scale.linear().domain(volumeDomain).range([minAdjustment,1])}function getCurrentMaxFontSize(widthRatio,retries){var currentDecrement=retries*widthRatio*DEFAULTS.FONT_SIZE_DECREMENT;var maxFontSize=Math.min(widthRatio*DEFAULTS.FONT_SIZE,DEFAULTS.MAX_FONT_SIZE);return maxFontSize-currentDecrement}function getCharacterWidth(currentMaxFontSize){var fontSizeRatio=currentMaxFontSize/DEFAULTS.FONT_SIZE;return fontSizeRatio*DEFAULTS.AVERAGE_CHAR_WIDTH}function getTruncatedWordText(word,wordOverflow,characterWidth){var numOfOverflowChars=Math.ceil(wordOverflow/characterWidth);return word.text.substring(0,word.text.length-(numOfOverflowChars+3))+"..."}function normaliseWordSizes(wordsToPlace,containerWidth,retries){var widthRatio=containerWidth/DEFAULTS.CONTAINER_WIDTH;var currentMaxFontSize=getCurrentMaxFontSize(widthRatio,retries);var volumeAdjustmentScale=getVolumeAdjustmentScale(wordsToPlace,currentMaxFontSize);return wordsToPlace.map(function(word){var characterWidth=getCharacterWidth(currentMaxFontSize);var wordOverflow=characterWidth*word.text.length-containerWidth;var shouldTruncate=wordOverflow>0&&retries>0;return _.extend({},word,{text:shouldTruncate?getTruncatedWordText(word,wordOverflow,characterWidth):word.text,size:volumeAdjustmentScale(word.size)*currentMaxFontSize})})}return{normaliseWordSizes:normaliseWordSizes}});define("src/helpers/topicsCloudRenderer",["underscore","d3","d3-layout-cloud","src/helpers/topicsSizingHelper"],function(_,d3,d3cloud,topicsSizingHelper){"use strict";var FONT_FAMILY="Roboto-Regular,Helvetica,Arial,sans-serif";var MAX_RETRIES=3;function createSvgGroup(container,width,height){container.select("svg").remove();return container.append("svg").attr("width",width).attr("height",height).attr("version",1.1).attr("xmlns","http://www.w3.org/2000/svg").attr("viewBox","0 0 "+width+" "+height).append("g").attr("transform","translate("+width/2+","+height/2+")")}function renderWords(svgGroup,words){return svgGroup.selectAll("text").data(words).enter().append("text").style("fill",function(d){return d.colour}).style("font-size",function(d){return d.size+"px"}).style("font-family",FONT_FAMILY).attr("data-id",function(d){return d.id}).attr("text-anchor","middle").attr("transform",function(d){return"translate("+[d.x,d.y]+")rotate("+d.rotate+")"}).text(function(d){return d.text})}function addWordBehaviours(container,clickHandler,words){words.on("click",clickHandler).on("mouseenter",function(){container.classed("topicHovered",true)}).on("mouseleave",function(){container.classed("topicHovered",false)})}function addTitles(words){words.append("title").text(function(d){return d.title})}function attemptLayout(cloudLayout,normaliseWordSizes,layoutCompleteCallback,retries){var normalisedWords=normaliseWordSizes(retries);retries+=1;cloudLayout.words(normalisedWords);cloudLayout.on("end",function(placedWords){var unplacedWords=_.difference(_.pluck(cloudLayout.words(),"title"),_.pluck(placedWords,"title"));if(unplacedWords.length&&retries<=MAX_RETRIES){console.warn("Could not fit all words. Retrying...",unplacedWords);attemptLayout(cloudLayout,normaliseWordSizes,layoutCompleteCallback,retries)}else{if(unplacedWords.length&&retries>MAX_RETRIES){var errorMessage=["Could not place the following words in topics cloud of width ",cloudLayout.size()[0],"px: ",unplacedWords.join(", ")].join("");console.warn(errorMessage);if(window.newrelic&&window.newrelic.noticeError){window.newrelic.noticeError(errorMessage)}}layoutCompleteCallback(placedWords)}});cloudLayout.start()}function createLayout(width,height){return d3cloud().size([width,height]).padding(4).font(FONT_FAMILY).rotate(0).random(function(){return.5}).fontSize(function(d){return d.size})}function ensureFn(fn){return typeof fn==="function"?fn:function(){}}function renderCloud(options){var $cloudContainer=options.$cloudContainer;var width=$cloudContainer.width();var height=options.height||$cloudContainer.height();var cloudContainerSelection=d3.select($cloudContainer[0]);var cloudLayout=createLayout(width,height);var wordsToPlace=options.words;var clickHandler=ensureFn(options.clickHandler);var callback=ensureFn(options.callback);var svgGroup;var normaliseWordSizes;var layoutCompleteCallback;if(width===0||height===0){throw new Error("Cloud container must have width and height")}if(_.isEmpty(wordsToPlace)){throw new Error("Words must be a non-empty array")}svgGroup=createSvgGroup(cloudContainerSelection,width,height);normaliseWordSizes=topicsSizingHelper.normaliseWordSizes.bind(null,wordsToPlace,width);layoutCompleteCallback=function layoutCompleteCallback(placedWords){var svgWords=renderWords(svgGroup,placedWords);addWordBehaviours(cloudContainerSelection,clickHandler,svgWords);addTitles(svgWords);callback()};attemptLayout(cloudLayout,normaliseWordSizes,layoutCompleteCallback,0)}return{_attemptLayout:attemptLayout,renderCloud:renderCloud}});define("src/graphColourRegister",["underscore","src/globals/currentDashboard","src/globals/theme"],function(_,currentDashboard,theme){"use strict";var DEFAULT_CHART_COLOUR_KEYS=["accountTypes","gender","pageTypes","sentiment","emotions"];var NAMESPACE={AUTHORS:"authors",DATE_RANGES:"dateRanges",DOMAINS:"domains",FACEBOOK_METRICS:"facebookMetrics",INSTAGRAM_INTERACTIONS:"instagramInteractions",INSTAGRAM_FILTERS:"instagramFilters",LANGUAGES:"languages",PAGE_TYPES:"pageTypes",PROJECTS:"projects",QUERIES:"queries",SENTIMENT:"sentiment",TOPICS:"topics",TWITTER_METRICS:"twitterMetrics"};var REGISTER={dashboards:{},defaultChartColours:_.pick(theme.chartColours,DEFAULT_CHART_COLOUR_KEYS),defaultColourPaletteIndex:0};var UNSAVED_DASHBOARD_ID="unsavedDashboard";function getAvailableColours(keysColourMap,options){var colourPalette=options.colourPalette||this._defaultColourPalette;return _.reject(colourPalette,_.contains.bind(null,keysColourMap))}function getColourForKey(namespace,key,options){options=options||{};var namespaceMap;if(REGISTER["defaultChartColours"][namespace]){return REGISTER["defaultChartColours"][namespace][key]}namespaceMap=getNamespaceMap(namespace);if(!(key in namespaceMap)){namespaceMap[key]=nextColour.call(this,namespaceMap,options)}return namespaceMap[key]}function getColoursForKeys(options){var keys=options.keys;var namespace=options.namespace;var normaliseKeys=options.normaliseKeys!==false;if(normaliseKeys){keys=normaliseColourKeys(keys)}return keys.reduce(function(keysColourMap,key){keysColourMap[key]=getColourForKey.call(this,namespace,key,options);return keysColourMap}.bind(this),{})}function getKeysWithClashingColours(keysColourMap){var seenColours=[];return Object.keys(keysColourMap).filter(function(key){var colour=keysColourMap[key];if(seenColours.indexOf(colour)===-1){seenColours.push(colour)}else{return true}})}function getNamespaceMap(namespace){var dashboardMap=registerDashboard();return registerNamespace(dashboardMap,namespace)}function nextColour(namespaceMap,options){var colourPalette=options.colourPalette;var defaultColourPalette=this._defaultColourPalette;if(colourPalette){if(!namespaceMap.__colourPaletteIndex){namespaceMap.__colourPaletteIndex=0}return colourPalette[namespaceMap.__colourPaletteIndex++%colourPalette.length]}return defaultColourPalette[REGISTER.defaultColourPaletteIndex++%defaultColourPalette.length]}function normaliseColourKey(key){if(typeof key!=="string"){return key}return key.toLowerCase()}function normaliseColourKeys(keys){return _.map(keys||[],normaliseColourKey)}function registerDashboard(){var dashboardId=currentDashboard.id||UNSAVED_DASHBOARD_ID;var unsavedDashboard=REGISTER.dashboards.unsavedDashboard||{};var unsavedDashboardKeys=Object.keys(unsavedDashboard);if(dashboardId!==UNSAVED_DASHBOARD_ID&&unsavedDashboardKeys.length){REGISTER["dashboards"][dashboardId]=_.extend({},unsavedDashboard);delete REGISTER.dashboards[UNSAVED_DASHBOARD_ID];return REGISTER["dashboards"][dashboardId]}if(dashboardId in REGISTER["dashboards"]){return REGISTER["dashboards"][dashboardId]}REGISTER["dashboards"][dashboardId]={};return REGISTER["dashboards"][dashboardId]}function registerNamespace(dashboardMap,namespace){if(!(namespace in dashboardMap)){dashboardMap[namespace]={}}return dashboardMap[namespace]}var GraphColourRegister=function GraphColourRegister(){this._defaultColourPalette=[].concat(theme.chartColours.general)};_.extend(GraphColourRegister.prototype,{_getRegister:function _getRegister(){return _.extend({},REGISTER)},getColour:function getColour(namespace,key,options){options=options||{};var normaliseKeys=options.normaliseKeys!==false;if(normaliseKeys){key=normaliseColourKey(key)}return getColourForKey.call(this,namespace,key,options)},getColours:function getColours(options){options=options||{};var keysColourMap=getColoursForKeys.call(this,options);var fixColourClashes=options.fixColourClashes!==false;if(!fixColourClashes){return keysColourMap}var clashingColourKeys=getKeysWithClashingColours(keysColourMap);if(clashingColourKeys.length){var availableColours=getAvailableColours.call(this,keysColourMap,options);if(clashingColourKeys.length<=availableColours.length){clashingColourKeys.forEach(function(key){keysColourMap[key]=availableColours.shift()})}}return keysColourMap},getAuthorColours:function getAuthorColours(keys){return this.getColours({keys:keys,namespace:NAMESPACE.AUTHORS})},getDateRangeColours:function getDateRangeColours(keys){return this.getColours({keys:keys,namespace:NAMESPACE.DATE_RANGES})},getDomainColours:function getDomainColours(keys){return this.getColours({keys:keys,namespace:NAMESPACE.DOMAINS})},getFacebookMetricColours:function getFacebookMetricColours(keys){return this.getColours({keys:keys,namespace:NAMESPACE.FACEBOOK_METRICS,normaliseKeys:false})},getInstagramInteractionColours:function getInstagramInteractionColours(keys){return this.getColours({keys:keys,namespace:NAMESPACE.INSTAGRAM_INTERACTIONS})},getInstagramFiltersColours:function getInstagramFiltersColours(keys){return this.getColours({keys:keys,namespace:NAMESPACE.INSTAGRAM_FILTERS})},getLanguageColours:function getLanguageColours(keys){return this.getColours({keys:keys,namespace:NAMESPACE.LANGUAGES})},getPageTypeColours:function getPageTypeColours(keys){return this.getColours({keys:keys,namespace:NAMESPACE.PAGE_TYPES})},getProjectColours:function getProjectColours(keys){return this.getColours({keys:keys,namespace:NAMESPACE.PROJECTS})},getQueryColours:function getQueryColours(keys){return this.getColours({keys:keys,namespace:NAMESPACE.QUERIES})},getSentimentColours:function getSentimentColours(keys){return this.getColours({keys:keys,namespace:NAMESPACE.SENTIMENT})},getTopicColours:function getTopicColours(keys){return this.getColours({keys:keys,namespace:NAMESPACE.TOPICS})},getTwitterMetricColours:function getTwitterMetricColours(keys){return this.getColours({keys:keys,namespace:NAMESPACE.TWITTER_METRICS,normaliseKeys:false})},lookupColour:function lookupColour(colourMap,key){var normalisedKey=normaliseColourKey(key);return colourMap[normalisedKey]},reset:function reset(){REGISTER.defaultColourPaletteIndex=0;_.each(REGISTER.dashboards,function(value,key){REGISTER.dashboards[key]={}})}});return new GraphColourRegister});define("src/helpers/topicsConverter",["underscore","src/graphColourRegister"],function(_,graphColourRegister){"use strict";var MAX_TOPICS_TO_SHOW=50;var SENTIMENT_COLOURS={veryPositive:"#4cb900",slightlyPositive:"#afda8c",neutral:"#999",slightlyNegative:"#f1c5c6",veryNegative:"#ca272d"};var TYPE_COLOURS={tag:"#DB3581",category:"#3C89E4",topic:"#4B4949",hashtag:"#f68933",mentioned:"#79bde8",emoticon:"#82618f"};function getSentimentColour(sentiment){if(sentiment>80){return SENTIMENT_COLOURS.veryPositive}if(sentiment>60){return SENTIMENT_COLOURS.slightlyPositive}if(sentiment>40){return SENTIMENT_COLOURS.neutral}if(sentiment>20){return SENTIMENT_COLOURS.slightlyNegative}return SENTIMENT_COLOURS.veryNegative}function getColour(topic,colourScheme){if(colourScheme==="sentiment"){return getSentimentColour(topic.sentimentScore)}else if(colourScheme==="theme"){return graphColourRegister.getColour(topic.type,topic.label)}else{return TYPE_COLOURS[topic.type]}}function generateDefaultTitle(topic){return _.capitalize(topic.type)+": "+topic.label+" ("+topic.volume+" mentions)"}function prepareTopicsForCloud(topicsToConvert,colourScheme){var generateTitle=arguments.length>2&&arguments[2]!==undefined?arguments[2]:generateDefaultTitle;return topicsToConvert.slice(0,MAX_TOPICS_TO_SHOW).reduce(function(memo,topic){if(topic.volume===0){return memo}return memo.concat({id:topic.id,type:topic.type,size:topic.volume,text:topic.label,colour:getColour(topic,colourScheme),title:generateTitle(topic)})},[])}return{prepareTopicsForCloud:prepareTopicsForCloud,sentimentColours:_.clone(SENTIMENT_COLOURS),typeColours:_.clone(TYPE_COLOURS)}});define("src/querybuilder/models/TestSearchTopListMentionsCollection",["underscore","src/components/mentions/_testsearch/models/TestSearchResultsCollection"],function(_,TestSearchResultsCollection){"use strict";return TestSearchResultsCollection.extend({constructor:function TestSearchTopListMentionsCollection(models,options){if(!options||!options.mentionType){throw new Error('TestSearchTopListMentionsCollection must have a "mentionType" property in options')}this.mentionType=options.mentionType;TestSearchResultsCollection.apply(this,arguments)},url:function url(){return"/projects/{projectId}/testsearch/"+this.mentionType},fetch:function fetch(options){if(options&&options.mentionTypeValue){this.mentionTypeValue=options.mentionTypeValue}if(!this.mentionTypeValue){throw new Error('TestSearchTopListMentionsCollection must have a "mentionTypeValue" property set')}return TestSearchResultsCollection.prototype.fetch.call(this,options)},getQueryData:function getQueryData(){var additionalQueryData={};additionalQueryData[this.mentionType]=this.mentionTypeValue;return _.extend(additionalQueryData,TestSearchResultsCollection.prototype.getQueryData.call(this))}})});define("mustache!src/querybuilder/templates/testSearchResultsTable",["lib/mustache"],function(mustache){var escapedTemplate='<table class="testsearch-table bwDataTable fullwidth {{cssClass}}">\n<thead>\n{{#notice}}\n<tr class="toggleColumns rowborder">\n<th class="notice grey" colspan="3">{{notice}}</th>\n</tr>\n{{/notice}}\n<tr class="rowborder columnheader">\n<th class="cellborder cellpadding nowrap threecol">{{title}}</th>\n<th class="cellborder cellpadding nowrap onecol textright">Mentions</th>\n<th class="cellborder cellpadding customtip"\ntitle="{{percentageColumnTooltip}}">\n% based on {{resultsTotal}} Mentions found\n</th>\n</tr>\n</thead>\n<tbody>\n{{#results}}\n<tr class="rowborder highlightrow" data-entry="{{label}}">\n<td class="cellborder cellpadding">\n<a class="js-show-mentions label">{{label}}</a>\n</td>\n<td class="cellborder cellpadding textright"><a class="js-show-mentions">{{volume}}</a></td>\n<td class="cellborder cellpadding nowrap">\n<a class="js-show-mentions">\n{{#indicatorSize}}\n<span class="indicator dib tinypadding-right" style="width:{{indicatorSize}}%;"></span>\n{{/indicatorSize}}\n{{^indicatorSize}}\n<span class="indicator-empty dib tinypadding-right"></span>\n{{/indicatorSize}}\n{{percentage}}%\n</a>\n</td>\n</tr>\n{{/results}}\n</tbody>\n</table>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/querybuilder/css/testSearchResultsTable.css",["css!src/querybuilder/css/compiled.css"],function(){});define("src/querybuilder/views/TestSearchResultsTableView",["underscore","backbone","mustache!src/querybuilder/templates/testSearchResultsTable","css!src/querybuilder/css/testSearchResultsTable.css","src/packages/customtip"],function(_,Backbone,renderTestSearchResultsTableTemplate){"use strict";var INDICATOR_MAX_WIDTH=50;function getIndicatorSizeModifier(results,total){var maxVolume=_(results).max(function(result){return result.volume}).volume,maxPercent=100*maxVolume/total;return INDICATOR_MAX_WIDTH/maxPercent}function formatResults(results,total){var indicatorSizeModifier=getIndicatorSizeModifier(results,total);return _(results).map(function(result){var percentage=Math.round(100*result.volume/total);return{label:result.label,volume:result.volume,percentage:percentage,indicatorSize:percentage>0?percentage*indicatorSizeModifier:null}})}return Backbone.View.extend({constructor:function TestSearchResultsTableView(options){Backbone.View.apply(this,arguments);options=options||{};if(!options.results||!options.results.length){throw new Error("TestSearchResultsTableView must be initialized with options.results")}if(!options.resultsTotal){throw new Error("TestSearchResultsTableView must be initialized with options.resultsTotal")}this.results=options.results;this.resultsTotal=options.resultsTotal;this.title=options.title||"Results";this.cssClass=options.cssClass||"";this.notice=options.notice;this.percentageColumnTooltip=options.percentageColumnTooltip},render:function render(){this.$el.html(renderTestSearchResultsTableTemplate({title:this.title,cssClass:this.cssClass,percentageColumnTooltip:this.percentageColumnTooltip,results:formatResults(this.results,this.resultsTotal),resultsTotal:this.resultsTotal,notice:this.notice}));this.$el.customtip()}})});define("mustache!src/querybuilder/templates/topicsPreviewTabContextMenu",["lib/mustache"],function(mustache){var escapedTemplate='<ul>\n<li class="context-menu--item js-switch-view" data-viewkey="cloud">\n<a><span class="icon-bwview-cloud smallpadding-right"></span>Cloud</a>\n</li>\n<li class="context-menu--item js-switch-view" data-viewkey="table">\n<a><span class="icon-bwview-table smallpadding-right"></span>Table</a>\n</li>\n</ul>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/querybuilder/views/TopicsPreviewTabContextMenuView",["jquery","src/views/ContextMenuView","mustache!src/querybuilder/templates/topicsPreviewTabContextMenu"],function($,ContextMenuView,renderTopicsPreviewTabContextMenuTemplate){"use strict";return ContextMenuView.extend({tagName:"nav",position:"below-right",className:"modular context-menu popupframe twocol",events:{"click .js-switch-view":function onClickSwitchView(e){var $target=$(e.currentTarget);if($target.hasClass("disabled")){return}this.callback($target.data("viewkey"))}},constructor:function TopicsPreviewTabContextMenuView(options){ContextMenuView.apply(this,arguments);options=options||{};if(!options.callback){throw new Error("TopicsPreviewTabContextMenuView must be initialized with options.callback")}if(!options.activeViewKey){throw new Error("TopicsPreviewTabContextMenuView must be initialized with options.activeViewKey")}this.callback=options.callback;this.activeViewKey=options.activeViewKey},render:function render(){this.$el.html(renderTopicsPreviewTabContextMenuTemplate());this.$("[data-viewkey="+this.activeViewKey+"]").addClass("disabled")}})});define("mustache!src/querybuilder/templates/topicsPreviewTab",["lib/mustache"],function(mustache){var escapedTemplate='<section class="slide">\n<section class="infobox infoboxtextcolor infoboxbgcolor mediumtext singlepadding-vertical singlemargin-top">\n<p class="mediumtext-bigline doublepadding-horizontal">Check <strong>Topics</strong> to make sure that your results are relevant. They can help you find terms that you may want to <strong>exclude</strong> from your Query.</p>\n</section>\n<div class="rowborder relative singlemargin-top">\n<div class="bold hugeline">Topics based on test Query</div>\n<div class="js-view-menu view-menu absright abstop link customtip">\n<div class="singlepadding-horizontal hugeline">\n<span class="js-view-indicator icon-bwview-table smallpadding-right"></span>View<span class="icon-chevron-down smallpadding-left"></span>\n</div>\n</div>\n</div>\n<div class="js-topics-views">\n<div class="js-cloud-container">\n<div class="cloud basic loaded js-cloud-view"></div>\n</div>\n<div class="hidden js-table-container"></div>\n</div>\n</section>\n<section class="slide second">\n<header class="singlepadding-top fullwidth overflow-horizontal">\n<a class="js-back floatleft singlemargin-right"><span class="icon-chevron-left"></span> Back</a>\n<p class="slide-title absleft">Results for "<span class="js-topic-string topic-string dib textellipsis">topic</span>"</p>\n</header>\n</section>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/components/topics/css/topics.css",["css!src/components/topics/css/compiled.css"],function(){});define("css!src/querybuilder/css/topicsPreviewTab.css",["css!src/querybuilder/css/compiled.css"],function(){});define("src/querybuilder/views/TopicsPreviewTabView",["jquery","underscore","backbone","src/globals/currentProject","src/helpers/topicsCloudRenderer","src/helpers/topicsConverter","src/components/mentions/_testsearch/views/TestSearchResultsView","src/querybuilder/models/TestSearchTopListMentionsCollection","src/querybuilder/views/TestSearchResultsTableView","src/querybuilder/views/TopicsPreviewTabContextMenuView","mustache!src/querybuilder/templates/topicsPreviewTab","mustache!src/querybuilder/templates/previewTabNoResults","css!src/components/topics/css/topics.css","css!src/querybuilder/css/topicsPreviewTab.css","src/packages/customtip"],function($,_,Backbone,currentProject,topicsCloudRenderer,topicsConverter,TestSearchResultsView,TestSearchTopListMentionsCollection,TestSearchResultsTableView,TopicsPreviewTabContextMenuView,renderTopicsPreviewTemplate,renderNoResultsTemplate){"use strict";var CLICKTHROUGH_EVENT="clickThrough";var GO_BACK_EVENT="goBack";var SWITCH_VIEW_EVENT="switchView";function formatTopicData(collection){var topics=collection.map(function(topic){var volume=topic.get("volume");var label=topic.get("label");return _.extend(topic.toJSON(),{id:label,title:"Topic: "+label+" ("+volume+" Mentions)",type:"topic"})});return topicsConverter.prepareTopicsForCloud(topics,"theme")}function formatTableData(collection){return collection.chain().map(function(topic){return{label:topic.get("label"),volume:topic.get("volume")}}).sortBy(function(topic){return topic.volume}).value().reverse()}function renderTopicsCloud(view){if(!view.collection.length){return}var options={$cloudContainer:view.$(".js-cloud-view"),clickHandler:function clickHandler(settings){showTestSearchResultsView(view,settings.id);view.trigger(CLICKTHROUGH_EVENT,"cloud",settings.id)},words:formatTopicData(view.collection),callback:null};if(!options.$cloudContainer.is(":visible")){return}topicsCloudRenderer.renderCloud(options)}function renderTopicsTable(view){var results=formatTableData(view.collection),$tableContainer=view.$(".js-table-container");view.table=new TestSearchResultsTableView({results:results,el:$tableContainer,resultsTotal:view.collection.resultsTotal,title:"Topic",cssClass:"green",percentageColumnTooltip:"The percentages show how big a Topic is compared to all Mentions found for this Query."});view.table.render()}function renderNoResults(view){var noResultMessage="No Topics found based on test Query.";if(view.isDeltaView){noResultMessage="No Topics found based on the added/excluded Mentions."}view.$el.html(renderNoResultsTemplate({noResultMessage:noResultMessage}));view.$el.addClass("noResults")}function switchView(view,viewKey){view.activeViewKey=viewKey;view.$(".js-"+viewKey+"-container").removeClass("hidden").siblings().addClass("hidden");view.$(".js-view-indicator").toggleClass("icon-bwview-cloud",viewKey==="cloud").toggleClass("icon-bwview-table",viewKey==="table").closest(".js-view-menu").attr("title","Current View: "+_.capitalize(viewKey)).customtip();if(viewKey==="cloud"){view.resize()}}function onSync(view){var $el=view.$el;$el.removeClass("loading");if(!view.collection.length){renderNoResults(view);return}$el.find(".slide.second").append(view.testSearchResultsView.$el);renderTopicsCloud(view);renderTopicsTable(view);switchView(view,view.activeViewKey)}function onRequest(view){view.testSearchResultsView.$el.detach();view.$el.html(renderTopicsPreviewTemplate()).removeClass("error noResults showSecondSlide").addClass("loading")}function onError(view){view.$el.empty().removeClass("loading").addClass("error").html(renderNoResultsTemplate({errorMessage:"Sorry, we were unable to fetch results."}))}function toggleMenu(view,$target){$target.addClass("open");TopicsPreviewTabContextMenuView.show({$target:$target,activeViewKey:view.activeViewKey,onClose:function onClose(){$target.removeClass("open")},callback:function callback(viewKey){switchView(view,viewKey);view.trigger(SWITCH_VIEW_EVENT,viewKey)}})}function initializeTestSearchResultsView(view){var options={collection:new TestSearchTopListMentionsCollection(null,{mentionType:"topic"}),project:currentProject.id,showDateRange:false};view.testSearchResultsView=new TestSearchResultsView(options)}function showTestSearchResultsView(view,topic){var fetchOptions=_.extend({mentionTypeValue:topic},view.collection.getRequiredOptions());view.$el.addClass("showSecondSlide");view.$(".js-topic-string").text(topic);view.testSearchResultsView.collection.clear();view.testSearchResultsView.collection.fetch(fetchOptions)}return Backbone.View.extend({tagName:"section",className:"topicsPreviewTab searchResults topicsCloud singlepadding-top",events:{"click .js-view-menu":function onClickToggleMenu(e){toggleMenu(this,$(e.currentTarget))},"click .js-back":function onClickGoBack(){this.$el.removeClass("showSecondSlide");this.trigger(GO_BACK_EVENT,this.activeViewKey)},"click .js-show-mentions":function onClickTableShowMentions(e){var topic=$(e.target).closest("tr").data("entry");showTestSearchResultsView(this,topic);this.trigger(CLICKTHROUGH_EVENT,"table",topic)},"click .js-reload":function clickJsReload(){this.trigger("reload")}},constructor:function TopicsPreviewTabView(options){options=options||{};Backbone.View.apply(this,arguments);if(!this.collection){throw new Error("TopicsPreviewTabView must be initialized with a collection.")}this.listenTo(this.collection,"request",onRequest.bind(null,this));this.listenTo(this.collection,"error",onError.bind(null,this));this.listenTo(this.collection,"sync",onSync.bind(null,this));this.activeViewKey="cloud";this.isDeltaView=!!options.isDeltaView;initializeTestSearchResultsView(this)},remove:function remove(){if(this.table){this.table.remove()}Backbone.View.prototype.remove.call(this)},shown:function shown(){if(this.activeViewKey==="cloud"){renderTopicsCloud(this)}},resize:_.debounce(function(){if(this.activeViewKey==="cloud"){renderTopicsCloud(this)}},100)},{CLICKTHROUGH_EVENT:CLICKTHROUGH_EVENT,GO_BACK_EVENT:GO_BACK_EVENT,SWITCH_VIEW_EVENT:SWITCH_VIEW_EVENT})});define("mustache!src/querybuilder/templates/topListPreviewTab",["lib/mustache"],function(mustache){var escapedTemplate='<section class="slide">\n<section class="infobox infoboxtextcolor infoboxbgcolor mediumtext singlepadding-vertical singlemargin-vertical">\n<p class="mediumtext-bigline doublepadding-horizontal">\nCheck <strong>{{label}}s</strong> to make sure that your results are relevant.\n{{^demonstrative}}They{{/demonstrative}}{{demonstrative}} can also help you find\n{{label}}s that you may want to <strong>exclude</strong> from your Query.\n</p>\n</section>\n<div class="rowborder relative">\n<div class="bold hugeline">{{label}}s based on test Query</div>\n</div>\n<div class="js-table-container"></div>\n</section>\n<section class="slide second">\n<header class="singlepadding-top fullwidth overflow-both">\n<a class="js-back floatleft singlemargin-right"><span class="icon-chevron-left"></span> Back</a>\n<p class="slide-title absleft">Results for "<span class="js-toplist-string toplist-string dib textellipsis"></span>"</p>\n</header>\n</section>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/querybuilder/css/topListPreviewTab.css",["css!src/querybuilder/css/compiled.css"],function(){});define("src/querybuilder/views/TopListPreviewTabView",["jquery","underscore","backbone","src/globals/currentProject","src/components/mentions/_testsearch/views/TestSearchResultsView","src/querybuilder/models/TestSearchTopListMentionsCollection","src/querybuilder/views/TestSearchResultsTableView","mustache!src/querybuilder/templates/topListPreviewTab","mustache!src/querybuilder/templates/previewTabNoResults","css!src/querybuilder/css/topListPreviewTab.css","src/packages/customtip"],function($,_,Backbone,currentProject,TestSearchResultsView,TestSearchTopListMentionsCollection,TestSearchResultsTableView,renderTopListPreviewTemplate,renderNoResultsTemplate){"use strict";function formatTableData(collection){return collection.chain().map(function(topListEntry){return{label:topListEntry.get("name"),volume:topListEntry.get("count")}}).sortBy(function(topListEntry){return topListEntry.volume}).value().reverse()}function renderTopListTable(view){var results=formatTableData(view.collection),$tableContainer=view.$(".js-table-container");view.table=new TestSearchResultsTableView({results:results,el:$tableContainer,resultsTotal:view.collection.resultsTotal,title:view.labelCapitalize,percentageColumnTooltip:view.percentageColumnTooltip,cssClass:view.cssClass});view.table.render()}function renderNoResults(view){var noResultMessage="No "+view.labelCapitalize+"s found based on test Query.";if(view.isDeltaView){noResultMessage="No "+view.labelCapitalize+"s found based on the added/excluded Mentions."}view.$el.html(renderNoResultsTemplate({noResultMessage:noResultMessage}));view.$el.addClass("noResults")}function onSync(view){var $el=view.$el;$el.removeClass("loading");if(!view.collection.length){renderNoResults(view);return}$el.html(renderTopListPreviewTemplate({label:view.labelCapitalize,demonstrative:view.demonstrative}));$el.find(".slide.second").append(view.mentionsView.$el);renderTopListTable(view)}function onRequest(view){view.mentionsView.$el.detach();view.$el.empty().removeClass("error noResults showSecondSlide").addClass("loading")}function onError(view){view.$el.removeClass("loading").addClass("error").html(renderNoResultsTemplate({errorMessage:"Sorry, we were unable to fetch results."}))}function initializeMentionsView(view){var collection=new TestSearchTopListMentionsCollection(null,{mentionType:view.mentionType}),options={collection:collection,project:currentProject.id,showDateRange:false};view.mentionsView=new TestSearchResultsView(options);view.listenTo(collection,"request",function(){view.trigger("resetTabsContainerScrollTop")})}function showMentionsView(view,topListEntry){view.$el.addClass("showSecondSlide");view.$(".js-toplist-string").text(topListEntry);view.mentionsView.collection.clear();var fetchOptions=_.extend({mentionTypeValue:topListEntry},view.collection.getRequiredOptions());view.mentionsView.collection.fetch(fetchOptions);view.trigger("resetTabsContainerScrollTop")}return Backbone.View.extend({tagName:"section",className:function className(){return this.prefixClassName+"PreviewTab topListPreviewTab searchResults singlepadding-top"},events:{"click .js-back":function onClickGoBack(){this.$el.removeClass("showSecondSlide")},"click .js-show-mentions":function onClickShowMentions(e){var topListEntry=$(e.target).closest("tr").data("entry");showMentionsView(this,topListEntry)},"click .js-reload":function onClickReload(){this.trigger("reload")}},constructor:function TopListPreviewTabView(options){if(!options){throw new Error("TopListPreviewTabView must be initialized with options.")}if(!options.collection){throw new Error("TopListPreviewTabView must be initialized with a collection.")}if(!options.mentionType){throw new Error("TopListPreviewTabView must be initialized with a mentionType.")}this.prefixClassName=_.dasherize(options.mentionType)+"s";Backbone.View.apply(this,arguments);this.cssClass=options.cssClass;this.collection=options.collection;this.mentionType=options.mentionType;this.percentageColumnTooltip=options.percentageColumnTooltip;this.demonstrative=options.demonstrative;this.label=options.label||this.mentionType;this.labelCapitalize=_.capitalize(this.label);this.isDeltaView=!!options.isDeltaView;this.listenTo(this.collection,"request",onRequest.bind(null,this));this.listenTo(this.collection,"error",onError.bind(null,this));this.listenTo(this.collection,"sync",onSync.bind(null,this));initializeMentionsView(this)},remove:function remove(){if(this.table){this.table.remove()}Backbone.View.prototype.remove.call(this)}})});(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==="object"&&typeof module==="object")module.exports=factory();else if(typeof define==="function"&&define.amd)define("bw-highcharts",[],factory);else if(typeof exports==="object")exports["bw-highcharts"]=factory();else root["bw-highcharts"]=factory()})(window,function(){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{configurable:false,enumerable:true,get:getter})}};__webpack_require__.r=function(exports){Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s="./src/bw-highcharts.js")}({"./node_modules/highcharts-pattern-fill/pattern-fill-v2.js":function(module,exports){(function(factory){if(typeof module==="object"&&module.exports){module.exports=factory}else{factory(Highcharts)}})(function(Highcharts){"use strict";var idCounter=0,wrap=Highcharts.wrap,each=Highcharts.each;Highcharts.SVGRenderer.prototype.addPattern=function(id,options){var pattern,path,w=options.width||10,h=options.height||10,ren=this;function rect(fill){ren.rect(0,0,w,h).attr({fill:fill}).add(pattern)}if(!id){id="highcharts-pattern-"+idCounter;idCounter+=1}pattern=this.createElement("pattern").attr({id:id,patternUnits:"userSpaceOnUse",width:options.width||10,height:options.height||10}).add(this.defs);pattern.id=pattern.element.id;if(options.path){path=options.path;if(path.fill){rect(path.fill)}this.createElement("path").attr({d:path.d||path,stroke:path.stroke||options.color||"#343434","stroke-width":path.strokeWidth||2}).add(pattern);pattern.color=options.color}else if(options.image){this.image(options.image,0,0,options.width,options.height).add(pattern)}else if(options.color){rect(options.color)}if(options.opacity!==undefined){each(pattern.element.children,function(child){child.setAttribute("opacity",options.opacity)})}return pattern};if(Highcharts.VMLElement){Highcharts.VMLRenderer.prototype.addPattern=function(id,options){var patterns;if(!id){id="highcharts-pattern-"+idCounter;idCounter+=1}patterns=this.patterns||{};patterns[id]=options;this.patterns=patterns};Highcharts.wrap(Highcharts.VMLRenderer.prototype.Element.prototype,"fillSetter",function(proceed,color,prop,elem){if(typeof color==="string"&&color.substring(0,5)==="url(#"){var id=color.substring(5,color.length-1),pattern=this.renderer.patterns[id],markup;if(pattern.image){if(elem.getElementsByTagName("fill").length){elem.removeChild(elem.getElementsByTagName("fill")[0])}markup=this.renderer.prepVML(["<",prop,' type="tile" src="',pattern.image,'" />']);elem.appendChild(document.createElement(markup));if(elem.parentNode.nodeType===1){elem.outerHTML=elem.outerHTML}}else if(pattern.color){proceed.call(this,pattern.color,prop,elem)}else{proceed.call(this,"#A0A0A0",prop,elem)}}else{proceed.call(this,color,prop,elem)}})}function addPredefinedPatterns(renderer){var colors=Highcharts.getOptions().colors;each(["M 0 0 L 10 10 M 9 -1 L 11 1 M -1 9 L 1 11","M 0 10 L 10 0 M -1 1 L 1 -1 M 9 11 L 11 9","M 3 0 L 3 10 M 8 0 L 8 10","M 0 3 L 10 3 M 0 8 L 10 8","M 0 3 L 5 3 L 5 0 M 5 10 L 5 7 L 10 7","M 3 3 L 8 3 L 8 8 L 3 8 Z","M 5 5 m -4 0 a 4 4 0 1 1 8 0 a 4 4 0 1 1 -8 0","M 10 3 L 5 3 L 5 0 M 5 10 L 5 7 L 0 7","M 2 5 L 5 2 L 8 5 L 5 8 Z","M 0 0 L 5 10 L 10 0"],function(pattern,i){renderer.addPattern("highcharts-default-pattern-"+i,{path:pattern,color:colors[i]})})}wrap(Highcharts.Chart.prototype,"getContainer",function(proceed){proceed.apply(this);var chart=this,renderer=chart.renderer,options=chart.options,patterns=options.defs&&options.defs.patterns;addPredefinedPatterns(renderer);if(patterns){each(patterns,function(pattern){renderer.addPattern(pattern.id,pattern)})}})})},"./node_modules/highcharts/highcharts.js":function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_RESULT__;(function(T,K){"object"===typeof module&&module.exports?module.exports=T.document?K(T):K:true?!(__WEBPACK_AMD_DEFINE_RESULT__=function(){return K(T)}.call(exports,__webpack_require__,exports,module),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)):undefined})("undefined"!==typeof window?window:this,function(T){var K=function(){var a="undefined"===typeof T?window:T,C=a.document,D=a.navigator&&a.navigator.userAgent||"",E=C&&C.createElementNS&&!!C.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect,m=/(edge|msie|trident)/i.test(D)&&!a.opera,h=-1!==D.indexOf("Firefox"),f=-1!==D.indexOf("Chrome"),r=h&&4>parseInt(D.split("Firefox/")[1],10);return a.Highcharts?a.Highcharts.error(16,!0):{product:"Highcharts",version:"6.1.2",deg2rad:2*Math.PI/360,doc:C,hasBidiBug:r,hasTouch:C&&void 0!==C.documentElement.ontouchstart,isMS:m,isWebKit:-1!==D.indexOf("AppleWebKit"),isFirefox:h,isChrome:f,isSafari:!f&&-1!==D.indexOf("Safari"),isTouchDevice:/(Mobile|Android|Windows Phone)/.test(D),SVG_NS:"http://www.w3.org/2000/svg",chartCount:0,seriesTypes:{},symbolSizes:{},svg:E,win:a,marginNames:["plotTop","marginRight","marginBottom","plotLeft"],noop:function(){},charts:[]}}();(function(a){a.timers=[];var C=a.charts,D=a.doc,E=a.win;a.error=function(m,h){m=a.isNumber(m)?"Highcharts error #"+m+": www.highcharts.com/errors/"+m:m;if(h)throw Error(m);E.console&&console.log(m)};a.Fx=function(a,h,f){this.options=h;this.elem=a;this.prop=f};a.Fx.prototype={dSetter:function(){var a=this.paths[0],h=this.paths[1],f=[],r=this.now,y=a.length,q;if(1===r)f=this.toD;else if(y===h.length&&1>r)for(;y--;)q=parseFloat(a[y]),f[y]=isNaN(q)?h[y]:r*parseFloat(h[y]-q)+q;else f=h;this.elem.attr("d",f,null,!0)},update:function(){var a=this.elem,h=this.prop,f=this.now,r=this.options.step;if(this[h+"Setter"])this[h+"Setter"]();else a.attr?a.element&&a.attr(h,f,null,!0):a.style[h]=f+this.unit;r&&r.call(a,f,this)},run:function(m,h,f){var r=this,y=r.options,q=function(a){return q.stopped?!1:r.step(a)},w=E.requestAnimationFrame||function(a){setTimeout(a,13)},e=function(){for(var c=0;c<a.timers.length;c++)a.timers[c]()||a.timers.splice(c--,1);a.timers.length&&w(e)};m!==h||this.elem["forceAnimate:"+this.prop]?(this.startTime=+new Date,this.start=m,this.end=h,this.unit=f,this.now=this.start,this.pos=0,q.elem=this.elem,q.prop=this.prop,q()&&1===a.timers.push(q)&&w(e)):(delete y.curAnim[this.prop],y.complete&&0===a.keys(y.curAnim).length&&y.complete.call(this.elem))},step:function(m){var h=+new Date,f,r=this.options,y=this.elem,q=r.complete,w=r.duration,e=r.curAnim;y.attr&&!y.element?m=!1:m||h>=w+this.startTime?(this.now=this.end,this.pos=1,this.update(),f=e[this.prop]=!0,a.objectEach(e,function(a){!0!==a&&(f=!1)}),f&&q&&q.call(y),m=!1):(this.pos=r.easing((h-this.startTime)/w),this.now=this.start+(this.end-this.start)*this.pos,this.update(),m=!0);return m},initPath:function(m,h,f){function r(a){var d,k;for(b=a.length;b--;)d="M"===a[b]||"L"===a[b],k=/[a-zA-Z]/.test(a[b+3]),d&&k&&a.splice(b+1,0,a[b+1],a[b+2],a[b+1],a[b+2])}function y(a,d){for(;a.length<k;){a[0]=d[k-a.length];var c=a.slice(0,z);[].splice.apply(a,[0,0].concat(c));u&&(c=a.slice(a.length-z),[].splice.apply(a,[a.length,0].concat(c)),b--)}a[0]="M"}function q(a,b){for(var c=(k-a.length)/z;0<c&&c--;)d=a.slice().splice(a.length/p-z,z*p),d[0]=b[k-z-c*z],l&&(d[z-6]=d[z-2],d[z-5]=d[z-1]),[].splice.apply(a,[a.length/p,0].concat(d)),u&&c--}h=h||"";var w,e=m.startX,c=m.endX,l=-1<h.indexOf("C"),z=l?7:3,k,d,b;h=h.split(" ");f=f.slice();var u=m.isArea,p=u?2:1,H;l&&(r(h),r(f));if(e&&c){for(b=0;b<e.length;b++)if(e[b]===c[0]){w=b;break}else if(e[0]===c[c.length-e.length+b]){w=b;H=!0;break}void 0===w&&(h=[])}h.length&&a.isNumber(w)&&(k=f.length+w*p*z,H?(y(h,f),q(f,h)):(y(f,h),q(h,f)));return[h,f]},fillSetter:function(){a.Fx.prototype.strokeSetter.apply(this,arguments)},strokeSetter:function(){this.elem.attr(this.prop,a.color(this.start).tweenTo(a.color(this.end),this.pos),null,!0)}};a.merge=function(){var m,h=arguments,f,r={},y=function(f,m){"object"!==typeof f&&(f={});a.objectEach(m,function(e,c){!a.isObject(e,!0)||a.isClass(e)||a.isDOMElement(e)?f[c]=m[c]:f[c]=y(f[c]||{},e)});return f};!0===h[0]&&(r=h[1],h=Array.prototype.slice.call(h,2));f=h.length;for(m=0;m<f;m++)r=y(r,h[m]);return r};a.pInt=function(a,h){return parseInt(a,h||10)};a.isString=function(a){return"string"===typeof a};a.isArray=function(a){a=Object.prototype.toString.call(a);return"[object Array]"===a||"[object Array Iterator]"===a};a.isObject=function(m,h){return!!m&&"object"===typeof m&&(!h||!a.isArray(m))};a.isDOMElement=function(m){return a.isObject(m)&&"number"===typeof m.nodeType};a.isClass=function(m){var h=m&&m.constructor;return!(!a.isObject(m,!0)||a.isDOMElement(m)||!h||!h.name||"Object"===h.name)};a.isNumber=function(a){return"number"===typeof a&&!isNaN(a)&&Infinity>a&&-Infinity<a};a.erase=function(a,h){for(var f=a.length;f--;)if(a[f]===h){a.splice(f,1);break}};a.defined=function(a){return void 0!==a&&null!==a};a.attr=function(m,h,f){var r;a.isString(h)?a.defined(f)?m.setAttribute(h,f):m&&m.getAttribute&&((r=m.getAttribute(h))||"class"!==h||(r=m.getAttribute(h+"Name"))):a.defined(h)&&a.isObject(h)&&a.objectEach(h,function(a,f){m.setAttribute(f,a)});return r};a.splat=function(m){return a.isArray(m)?m:[m]};a.syncTimeout=function(a,h,f){if(h)return setTimeout(a,h,f);a.call(0,f)};a.clearTimeout=function(m){a.defined(m)&&clearTimeout(m)};a.extend=function(a,h){var f;a||(a={});for(f in h)a[f]=h[f];return a};a.pick=function(){var a=arguments,h,f,r=a.length;for(h=0;h<r;h++)if(f=a[h],void 0!==f&&null!==f)return f};a.css=function(m,h){a.isMS&&!a.svg&&h&&void 0!==h.opacity&&(h.filter="alpha(opacity="+100*h.opacity+")");a.extend(m.style,h)};a.createElement=function(m,h,f,r,y){m=D.createElement(m);var q=a.css;h&&a.extend(m,h);y&&q(m,{padding:0,border:"none",margin:0});f&&q(m,f);r&&r.appendChild(m);return m};a.extendClass=function(m,h){var f=function(){};f.prototype=new m;a.extend(f.prototype,h);return f};a.pad=function(a,h,f){return Array((h||2)+1-String(a).replace("-","").length).join(f||0)+a};a.relativeLength=function(a,h,f){return/%$/.test(a)?h*parseFloat(a)/100+(f||0):parseFloat(a)};a.wrap=function(a,h,f){var m=a[h];a[h]=function(){var a=Array.prototype.slice.call(arguments),q=arguments,w=this;w.proceed=function(){m.apply(w,arguments.length?arguments:q)};a.unshift(m);a=f.apply(this,a);w.proceed=null;return a}};a.formatSingle=function(m,h,f){var r=/\.([0-9])/,y=a.defaultOptions.lang;/f$/.test(m)?(f=(f=m.match(r))?f[1]:-1,null!==h&&(h=a.numberFormat(h,f,y.decimalPoint,-1<m.indexOf(",")?y.thousandsSep:""))):h=(f||a.time).dateFormat(m,h);return h};a.format=function(m,h,f){for(var r="{",y=!1,q,w,e,c,l=[],z;m;){r=m.indexOf(r);if(-1===r)break;q=m.slice(0,r);if(y){q=q.split(":");w=q.shift().split(".");c=w.length;z=h;for(e=0;e<c;e++)z&&(z=z[w[e]]);q.length&&(z=a.formatSingle(q.join(":"),z,f));l.push(z)}else l.push(q);m=m.slice(r+1);r=(y=!y)?"}":"{"}l.push(m);return l.join("")};a.getMagnitude=function(a){return Math.pow(10,Math.floor(Math.log(a)/Math.LN10))};a.normalizeTickInterval=function(m,h,f,r,y){var q,w=m;f=a.pick(f,1);q=m/f;h||(h=y?[1,1.2,1.5,2,2.5,3,4,5,6,8,10]:[1,2,2.5,5,10],!1===r&&(1===f?h=a.grep(h,function(a){return 0===a%1}):.1>=f&&(h=[1/f])));for(r=0;r<h.length&&!(w=h[r],y&&w*f>=m||!y&&q<=(h[r]+(h[r+1]||h[r]))/2);r++);return w=a.correctFloat(w*f,-Math.round(Math.log(.001)/Math.LN10))};a.stableSort=function(a,h){var f=a.length,m,y;for(y=0;y<f;y++)a[y].safeI=y;a.sort(function(a,f){m=h(a,f);return 0===m?a.safeI-f.safeI:m});for(y=0;y<f;y++)delete a[y].safeI};a.arrayMin=function(a){for(var h=a.length,f=a[0];h--;)a[h]<f&&(f=a[h]);return f};a.arrayMax=function(a){for(var h=a.length,f=a[0];h--;)a[h]>f&&(f=a[h]);return f};a.destroyObjectProperties=function(m,h){a.objectEach(m,function(a,r){a&&a!==h&&a.destroy&&a.destroy();delete m[r]})};a.discardElement=function(m){var h=a.garbageBin;h||(h=a.createElement("div"));m&&h.appendChild(m);h.innerHTML=""};a.correctFloat=function(a,h){return parseFloat(a.toPrecision(h||14))};a.setAnimation=function(m,h){h.renderer.globalAnimation=a.pick(m,h.options.chart.animation,!0)};a.animObject=function(m){return a.isObject(m)?a.merge(m):{duration:m?500:0}};a.timeUnits={millisecond:1,second:1e3,minute:6e4,hour:36e5,day:864e5,week:6048e5,month:24192e5,year:314496e5};a.numberFormat=function(m,h,f,r){m=+m||0;h=+h;var y=a.defaultOptions.lang,q=(m.toString().split(".")[1]||"").split("e")[0].length,w,e,c=m.toString().split("e");-1===h?h=Math.min(q,20):a.isNumber(h)?h&&c[1]&&0>c[1]&&(w=h+ +c[1],0<=w?(c[0]=(+c[0]).toExponential(w).split("e")[0],h=w):(c[0]=c[0].split(".")[0]||0,m=20>h?(c[0]*Math.pow(10,c[1])).toFixed(h):0,c[1]=0)):h=2;e=(Math.abs(c[1]?c[0]:m)+Math.pow(10,-Math.max(h,q)-1)).toFixed(h);q=String(a.pInt(e));w=3<q.length?q.length%3:0;f=a.pick(f,y.decimalPoint);r=a.pick(r,y.thousandsSep);m=(0>m?"-":"")+(w?q.substr(0,w)+r:"");m+=q.substr(w).replace(/(\d{3})(?=\d)/g,"$1"+r);h&&(m+=f+e.slice(-h));c[1]&&0!==+m&&(m+="e"+c[1]);return m};Math.easeInOutSine=function(a){return-.5*(Math.cos(Math.PI*a)-1)};a.getStyle=function(m,h,f){if("width"===h)return Math.max(0,Math.min(m.offsetWidth,m.scrollWidth)-a.getStyle(m,"padding-left")-a.getStyle(m,"padding-right"));if("height"===h)return Math.max(0,Math.min(m.offsetHeight,m.scrollHeight)-a.getStyle(m,"padding-top")-a.getStyle(m,"padding-bottom"));E.getComputedStyle||a.error(27,!0);if(m=E.getComputedStyle(m,void 0))m=m.getPropertyValue(h),a.pick(f,"opacity"!==h)&&(m=a.pInt(m));return m};a.inArray=function(m,h,f){return(a.indexOfPolyfill||Array.prototype.indexOf).call(h,m,f)};a.grep=function(m,h){return(a.filterPolyfill||Array.prototype.filter).call(m,h)};a.find=Array.prototype.find?function(a,h){return a.find(h)}:function(a,h){var f,r=a.length;for(f=0;f<r;f++)if(h(a[f],f))return a[f]};a.some=function(m,h,f){return(a.somePolyfill||Array.prototype.some).call(m,h,f)};a.map=function(a,h){for(var f=[],r=0,y=a.length;r<y;r++)f[r]=h.call(a[r],a[r],r,a);return f};a.keys=function(m){return(a.keysPolyfill||Object.keys).call(void 0,m)};a.reduce=function(m,h,f){return(a.reducePolyfill||Array.prototype.reduce).apply(m,2<arguments.length?[h,f]:[h])};a.offset=function(a){var h=D.documentElement;a=a.parentElement||a.parentNode?a.getBoundingClientRect():{top:0,left:0};return{top:a.top+(E.pageYOffset||h.scrollTop)-(h.clientTop||0),left:a.left+(E.pageXOffset||h.scrollLeft)-(h.clientLeft||0)}};a.stop=function(m,h){for(var f=a.timers.length;f--;)a.timers[f].elem!==m||h&&h!==a.timers[f].prop||(a.timers[f].stopped=!0)};a.each=function(m,h,f){return(a.forEachPolyfill||Array.prototype.forEach).call(m,h,f)};a.objectEach=function(a,h,f){for(var r in a)a.hasOwnProperty(r)&&h.call(f||a[r],a[r],r,a)};a.addEvent=function(m,h,f,r){var y,q=m.addEventListener||a.addEventListenerPolyfill;y="function"===typeof m&&m.prototype?m.prototype.protoEvents=m.prototype.protoEvents||{}:m.hcEvents=m.hcEvents||{};a.Point&&m instanceof a.Point&&m.series&&m.series.chart&&(m.series.chart.runTrackerClick=!0);q&&q.call(m,h,f,!1);y[h]||(y[h]=[]);y[h].push(f);r&&a.isNumber(r.order)&&(f.order=r.order,y[h].sort(function(a,e){return a.order-e.order}));return function(){a.removeEvent(m,h,f)}};a.removeEvent=function(m,h,f){function r(e,c){var l=m.removeEventListener||a.removeEventListenerPolyfill;l&&l.call(m,e,c,!1)}function y(e){var c,l;m.nodeName&&(h?(c={},c[h]=!0):c=e,a.objectEach(c,function(a,k){if(e[k])for(l=e[k].length;l--;)r(k,e[k][l])}))}var q,w;a.each(["protoEvents","hcEvents"],function(e){var c=m[e];c&&(h?(q=c[h]||[],f?(w=a.inArray(f,q),-1<w&&(q.splice(w,1),c[h]=q),r(h,f)):(y(c),c[h]=[])):(y(c),m[e]={}))})};a.fireEvent=function(m,h,f,r){var y,q,w,e,c;f=f||{};D.createEvent&&(m.dispatchEvent||m.fireEvent)?(y=D.createEvent("Events"),y.initEvent(h,!0,!0),a.extend(y,f),m.dispatchEvent?m.dispatchEvent(y):m.fireEvent(h,y)):a.each(["protoEvents","hcEvents"],function(l){if(m[l])for(q=m[l][h]||[],w=q.length,f.target||a.extend(f,{preventDefault:function(){f.defaultPrevented=!0},target:m,type:h}),e=0;e<w;e++)(c=q[e])&&!1===c.call(m,f)&&f.preventDefault()});r&&!f.defaultPrevented&&r.call(m,f)};a.animate=function(m,h,f){var r,y="",q,w,e;a.isObject(f)||(e=arguments,f={duration:e[2],easing:e[3],complete:e[4]});a.isNumber(f.duration)||(f.duration=400);f.easing="function"===typeof f.easing?f.easing:Math[f.easing]||Math.easeInOutSine;f.curAnim=a.merge(h);a.objectEach(h,function(c,e){a.stop(m,e);w=new a.Fx(m,f,e);q=null;"d"===e?(w.paths=w.initPath(m,m.d,h.d),w.toD=h.d,r=0,q=1):m.attr?r=m.attr(e):(r=parseFloat(a.getStyle(m,e))||0,"opacity"!==e&&(y="px"));q||(q=c);q&&q.match&&q.match("px")&&(q=q.replace(/px/g,""));w.run(r,q,y)})};a.seriesType=function(m,h,f,r,y){var q=a.getOptions(),w=a.seriesTypes;q.plotOptions[m]=a.merge(q.plotOptions[h],f);w[m]=a.extendClass(w[h]||function(){},r);w[m].prototype.type=m;y&&(w[m].prototype.pointClass=a.extendClass(a.Point,y));return w[m]};a.uniqueKey=function(){var a=Math.random().toString(36).substring(2,9),h=0;return function(){return"highcharts-"+a+"-"+h++}}();E.jQuery&&(E.jQuery.fn.highcharts=function(){var m=[].slice.call(arguments);if(this[0])return m[0]?(new(a[a.isString(m[0])?m.shift():"Chart"])(this[0],m[0],m[1]),this):C[a.attr(this[0],"data-highcharts-chart")]})})(K);(function(a){var C=a.each,D=a.isNumber,E=a.map,m=a.merge,h=a.pInt;a.Color=function(f){if(!(this instanceof a.Color))return new a.Color(f);this.init(f)};a.Color.prototype={parsers:[{regex:/rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]?(?:\.[0-9]+)?)\s*\)/,parse:function(a){return[h(a[1]),h(a[2]),h(a[3]),parseFloat(a[4],10)]}},{regex:/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/,parse:function(a){return[h(a[1]),h(a[2]),h(a[3]),1]}}],names:{white:"#ffffff",black:"#000000"},init:function(f){var h,y,q,w;if((this.input=f=this.names[f&&f.toLowerCase?f.toLowerCase():""]||f)&&f.stops)this.stops=E(f.stops,function(e){return new a.Color(e[1])});else if(f&&f.charAt&&"#"===f.charAt()&&(h=f.length,f=parseInt(f.substr(1),16),7===h?y=[(f&16711680)>>16,(f&65280)>>8,f&255,1]:4===h&&(y=[(f&3840)>>4|(f&3840)>>8,(f&240)>>4|f&240,(f&15)<<4|f&15,1])),!y)for(q=this.parsers.length;q--&&!y;)w=this.parsers[q],(h=w.regex.exec(f))&&(y=w.parse(h));this.rgba=y||[]},get:function(a){var f=this.input,h=this.rgba,q;this.stops?(q=m(f),q.stops=[].concat(q.stops),C(this.stops,function(f,e){q.stops[e]=[q.stops[e][0],f.get(a)]})):q=h&&D(h[0])?"rgb"===a||!a&&1===h[3]?"rgb("+h[0]+","+h[1]+","+h[2]+")":"a"===a?h[3]:"rgba("+h.join(",")+")":f;return q},brighten:function(a){var f,y=this.rgba;if(this.stops)C(this.stops,function(f){f.brighten(a)});else if(D(a)&&0!==a)for(f=0;3>f;f++)y[f]+=h(255*a),0>y[f]&&(y[f]=0),255<y[f]&&(y[f]=255);return this},setOpacity:function(a){this.rgba[3]=a;return this},tweenTo:function(a,h){var f=this.rgba,q=a.rgba;q.length&&f&&f.length?(a=1!==q[3]||1!==f[3],h=(a?"rgba(":"rgb(")+Math.round(q[0]+(f[0]-q[0])*(1-h))+","+Math.round(q[1]+(f[1]-q[1])*(1-h))+","+Math.round(q[2]+(f[2]-q[2])*(1-h))+(a?","+(q[3]+(f[3]-q[3])*(1-h)):"")+")"):h=a.input||"none";return h}};a.color=function(f){return new a.Color(f)}})(K);(function(a){var C,D,E=a.addEvent,m=a.animate,h=a.attr,f=a.charts,r=a.color,y=a.css,q=a.createElement,w=a.defined,e=a.deg2rad,c=a.destroyObjectProperties,l=a.doc,z=a.each,k=a.extend,d=a.erase,b=a.grep,u=a.hasTouch,p=a.inArray,H=a.isArray,t=a.isFirefox,L=a.isMS,x=a.isObject,I=a.isString,n=a.isWebKit,G=a.merge,B=a.noop,M=a.objectEach,F=a.pick,g=a.pInt,v=a.removeEvent,P=a.stop,Q=a.svg,J=a.SVG_NS,O=a.symbolSizes,N=a.win;C=a.SVGElement=function(){return this};k(C.prototype,{opacity:1,SVG_NS:J,textProps:"direction fontSize fontWeight fontFamily fontStyle color lineHeight width textAlign textDecoration textOverflow textOutline cursor".split(" "),init:function(a,g){this.element="span"===g?q(g):l.createElementNS(this.SVG_NS,g);this.renderer=a},animate:function(A,g,b){g=a.animObject(F(g,this.renderer.globalAnimation,!0));0!==g.duration?(b&&(g.complete=b),m(this,A,g)):(this.attr(A,null,b),g.step&&g.step.call(this));return this},complexColor:function(A,g,b){var d=this.renderer,v,k,c,n,e,J,l,B,u,R,p,t=[],x;a.fireEvent(this.renderer,"complexColor",{args:arguments},function(){A.radialGradient?k="radialGradient":A.linearGradient&&(k="linearGradient");k&&(c=A[k],e=d.gradients,l=A.stops,R=b.radialReference,H(c)&&(A[k]=c={x1:c[0],y1:c[1],x2:c[2],y2:c[3],gradientUnits:"userSpaceOnUse"}),"radialGradient"===k&&R&&!w(c.gradientUnits)&&(n=c,c=G(c,d.getRadialAttr(R,n),{gradientUnits:"userSpaceOnUse"})),M(c,function(a,A){"id"!==A&&t.push(A,a)}),M(l,function(a){t.push(a)}),t=t.join(","),e[t]?p=e[t].attr("id"):(c.id=p=a.uniqueKey(),e[t]=J=d.createElement(k).attr(c).add(d.defs),J.radAttr=n,J.stops=[],z(l,function(A){0===A[1].indexOf("rgba")?(v=a.color(A[1]),B=v.get("rgb"),u=v.get("a")):(B=A[1],u=1);A=d.createElement("stop").attr({offset:A[0],"stop-color":B,"stop-opacity":u}).add(J);J.stops.push(A)})),x="url("+d.url+"#"+p+")",b.setAttribute(g,x),b.gradient=t,A.toString=function(){return x})})},applyTextOutline:function(A){var g=this.element,b,v,k,c,n;-1!==A.indexOf("contrast")&&(A=A.replace(/contrast/g,this.renderer.getContrast(g.style.fill)));A=A.split(" ");v=A[A.length-1];if((k=A[0])&&"none"!==k&&a.svg){this.fakeTS=!0;A=[].slice.call(g.getElementsByTagName("tspan"));this.ySetter=this.xSetter;k=k.replace(/(^[\d\.]+)(.*?)$/g,function(a,A,g){return 2*A+g});for(n=A.length;n--;)b=A[n],"highcharts-text-outline"===b.getAttribute("class")&&d(A,g.removeChild(b));c=g.firstChild;z(A,function(a,A){0===A&&(a.setAttribute("x",g.getAttribute("x")),A=g.getAttribute("y"),a.setAttribute("y",A||0),null===A&&g.setAttribute("y",0));a=a.cloneNode(1);h(a,{class:"highcharts-text-outline",fill:v,stroke:v,"stroke-width":k,"stroke-linejoin":"round"});g.insertBefore(a,c)})}},attr:function(a,g,b,d){var A,v=this.element,k,c=this,n,J;"string"===typeof a&&void 0!==g&&(A=a,a={},a[A]=g);"string"===typeof a?c=(this[a+"Getter"]||this._defaultGetter).call(this,a,v):(M(a,function(A,g){n=!1;d||P(this,g);this.symbolName&&/^(x|y|width|height|r|start|end|innerR|anchorX|anchorY)$/.test(g)&&(k||(this.symbolAttr(a),k=!0),n=!0);!this.rotation||"x"!==g&&"y"!==g||(this.doTransform=!0);n||(J=this[g+"Setter"]||this._defaultSetter,J.call(this,A,g,v),this.shadows&&/^(width|height|visibility|x|y|d|transform|cx|cy|r)$/.test(g)&&this.updateShadows(g,A,J))},this),this.afterSetters());b&&b.call(this);return c},afterSetters:function(){this.doTransform&&(this.updateTransform(),this.doTransform=!1)},updateShadows:function(a,g,b){for(var A=this.shadows,d=A.length;d--;)b.call(A[d],"height"===a?Math.max(g-(A[d].cutHeight||0),0):"d"===a?this.d:g,a,A[d])},addClass:function(a,g){var A=this.attr("class")||"";-1===A.indexOf(a)&&(g||(a=(A+(A?" ":"")+a).replace("  "," ")),this.attr("class",a));return this},hasClass:function(a){return-1!==p(a,(this.attr("class")||"").split(" "))},removeClass:function(a){return this.attr("class",(this.attr("class")||"").replace(a,""))},symbolAttr:function(a){var A=this;z("x y r start end width height innerR anchorX anchorY".split(" "),function(g){A[g]=F(a[g],A[g])});A.attr({d:A.renderer.symbols[A.symbolName](A.x,A.y,A.width,A.height,A)})},clip:function(a){return this.attr("clip-path",a?"url("+this.renderer.url+"#"+a.id+")":"none")},crisp:function(a,g){var A;g=g||a.strokeWidth||0;A=Math.round(g)%2/2;a.x=Math.floor(a.x||this.x||0)+A;a.y=Math.floor(a.y||this.y||0)+A;a.width=Math.floor((a.width||this.width||0)-2*A);a.height=Math.floor((a.height||this.height||0)-2*A);w(a.strokeWidth)&&(a.strokeWidth=g);return a},css:function(a){var A=this.styles,b={},d=this.element,v,c="",n,J=!A,e=["textOutline","textOverflow","width"];a&&a.color&&(a.fill=a.color);A&&M(a,function(a,g){a!==A[g]&&(b[g]=a,J=!0)});J&&(A&&(a=k(A,b)),a&&(null===a.width||"auto"===a.width?delete this.textWidth:"text"===d.nodeName.toLowerCase()&&a.width&&(v=this.textWidth=g(a.width))),this.styles=a,v&&!Q&&this.renderer.forExport&&delete a.width,d.namespaceURI===this.SVG_NS?(n=function(a,A){return"-"+A.toLowerCase()},M(a,function(a,A){-1===p(A,e)&&(c+=A.replace(/([A-Z])/g,n)+":"+a+";")}),c&&h(d,"style",c)):y(d,a),this.added&&("text"===this.element.nodeName&&this.renderer.buildText(this),a&&a.textOutline&&this.applyTextOutline(a.textOutline)));return this},strokeWidth:function(){return this["stroke-width"]||0},on:function(a,g){var A=this,b=A.element;u&&"click"===a?(b.ontouchstart=function(a){A.touchEventFired=Date.now();a.preventDefault();g.call(b,a)},b.onclick=function(a){(-1===N.navigator.userAgent.indexOf("Android")||1100<Date.now()-(A.touchEventFired||0))&&g.call(b,a)}):b["on"+a]=g;return this},setRadialReference:function(a){var A=this.renderer.gradients[this.element.gradient];this.element.radialReference=a;A&&A.radAttr&&A.animate(this.renderer.getRadialAttr(a,A.radAttr));return this},translate:function(a,g){return this.attr({translateX:a,translateY:g})},invert:function(a){this.inverted=a;this.updateTransform();return this},updateTransform:function(){var a=this.translateX||0,g=this.translateY||0,b=this.scaleX,d=this.scaleY,v=this.inverted,c=this.rotation,k=this.matrix,n=this.element;v&&(a+=this.width,g+=this.height);a=["translate("+a+","+g+")"];w(k)&&a.push("matrix("+k.join(",")+")");v?a.push("rotate(90) scale(-1,1)"):c&&a.push("rotate("+c+" "+F(this.rotationOriginX,n.getAttribute("x"),0)+" "+F(this.rotationOriginY,n.getAttribute("y")||0)+")");(w(b)||w(d))&&a.push("scale("+F(b,1)+" "+F(d,1)+")");a.length&&n.setAttribute("transform",a.join(" "))},toFront:function(){var a=this.element;a.parentNode.appendChild(a);return this},align:function(a,g,b){var A,v,c,k,n={};v=this.renderer;c=v.alignedObjects;var J,e;if(a){if(this.alignOptions=a,this.alignByTranslate=g,!b||I(b))this.alignTo=A=b||"renderer",d(c,this),c.push(this),b=null}else a=this.alignOptions,g=this.alignByTranslate,A=this.alignTo;b=F(b,v[A],v);A=a.align;v=a.verticalAlign;c=(b.x||0)+(a.x||0);k=(b.y||0)+(a.y||0);"right"===A?J=1:"center"===A&&(J=2);J&&(c+=(b.width-(a.width||0))/J);n[g?"translateX":"x"]=Math.round(c);"bottom"===v?e=1:"middle"===v&&(e=2);e&&(k+=(b.height-(a.height||0))/e);n[g?"translateY":"y"]=Math.round(k);this[this.placed?"animate":"attr"](n);this.placed=!0;this.alignAttr=n;return this},getBBox:function(a,g){var A,b=this.renderer,d,v=this.element,c=this.styles,n,J=this.textStr,l,B=b.cache,u=b.cacheKeys,p;g=F(g,this.rotation);d=g*e;n=c&&c.fontSize;w(J)&&(p=J.toString(),-1===p.indexOf("<")&&(p=p.replace(/[0-9]/g,"0")),p+=["",g||0,n,this.textWidth,c&&c.textOverflow].join());p&&!a&&(A=B[p]);if(!A){if(v.namespaceURI===this.SVG_NS||b.forExport){try{(l=this.fakeTS&&function(a){z(v.querySelectorAll(".highcharts-text-outline"),function(A){A.style.display=a})})&&l("none"),A=v.getBBox?k({},v.getBBox()):{width:v.offsetWidth,height:v.offsetHeight},l&&l("")}catch(W){}if(!A||0>A.width)A={width:0,height:0}}else A=this.htmlGetBBox();b.isSVG&&(a=A.width,b=A.height,c&&"11px"===c.fontSize&&17===Math.round(b)&&(A.height=b=14),g&&(A.width=Math.abs(b*Math.sin(d))+Math.abs(a*Math.cos(d)),A.height=Math.abs(b*Math.cos(d))+Math.abs(a*Math.sin(d))));if(p&&0<A.height){for(;250<u.length;)delete B[u.shift()];B[p]||u.push(p);B[p]=A}}return A},show:function(a){return this.attr({visibility:a?"inherit":"visible"})},hide:function(){return this.attr({visibility:"hidden"})},fadeOut:function(a){var A=this;A.animate({opacity:0},{duration:a||150,complete:function(){A.attr({y:-9999})}})},add:function(a){var A=this.renderer,g=this.element,b;a&&(this.parentGroup=a);this.parentInverted=a&&a.inverted;void 0!==this.textStr&&A.buildText(this);this.added=!0;if(!a||a.handleZ||this.zIndex)b=this.zIndexSetter();b||(a?a.element:A.box).appendChild(g);if(this.onAdd)this.onAdd();return this},safeRemoveChild:function(a){var A=a.parentNode;A&&A.removeChild(a)},destroy:function(){var a=this,g=a.element||{},b=a.renderer.isSVG&&"SPAN"===g.nodeName&&a.parentGroup,v=g.ownerSVGElement,c=a.clipPath;g.onclick=g.onmouseout=g.onmouseover=g.onmousemove=g.point=null;P(a);c&&v&&(z(v.querySelectorAll("[clip-path],[CLIP-PATH]"),function(a){var g=a.getAttribute("clip-path"),A=c.element.id;(-1<g.indexOf("(#"+A+")")||-1<g.indexOf('("#'+A+'")'))&&a.removeAttribute("clip-path")}),a.clipPath=c.destroy());if(a.stops){for(v=0;v<a.stops.length;v++)a.stops[v]=a.stops[v].destroy();a.stops=null}a.safeRemoveChild(g);for(a.destroyShadows();b&&b.div&&0===b.div.childNodes.length;)g=b.parentGroup,a.safeRemoveChild(b.div),delete b.div,b=g;a.alignTo&&d(a.renderer.alignedObjects,a);M(a,function(g,A){delete a[A]});return null},shadow:function(a,g,b){var A=[],d,v,c=this.element,k,n,J,e;if(!a)this.destroyShadows();else if(!this.shadows){n=F(a.width,3);J=(a.opacity||.15)/n;e=this.parentInverted?"(-1,-1)":"("+F(a.offsetX,1)+", "+F(a.offsetY,1)+")";for(d=1;d<=n;d++)v=c.cloneNode(0),k=2*n+1-2*d,h(v,{isShadow:"true",stroke:a.color||"#000000","stroke-opacity":J*d,"stroke-width":k,transform:"translate"+e,fill:"none"}),b&&(h(v,"height",Math.max(h(v,"height")-k,0)),v.cutHeight=k),g?g.element.appendChild(v):c.parentNode&&c.parentNode.insertBefore(v,c),A.push(v);this.shadows=A}return this},destroyShadows:function(){z(this.shadows||[],function(a){this.safeRemoveChild(a)},this);this.shadows=void 0},xGetter:function(a){"circle"===this.element.nodeName&&("x"===a?a="cx":"y"===a&&(a="cy"));return this._defaultGetter(a)},_defaultGetter:function(a){a=F(this[a+"Value"],this[a],this.element?this.element.getAttribute(a):null,0);/^[\-0-9\.]+$/.test(a)&&(a=parseFloat(a));return a},dSetter:function(a,g,b){a&&a.join&&(a=a.join(" "));/(NaN| {2}|^$)/.test(a)&&(a="M 0 0");this[g]!==a&&(b.setAttribute(g,a),this[g]=a)},dashstyleSetter:function(a){var b,A=this["stroke-width"];"inherit"===A&&(A=1);if(a=a&&a.toLowerCase()){a=a.replace("shortdashdotdot","3,1,1,1,1,1,").replace("shortdashdot","3,1,1,1").replace("shortdot","1,1,").replace("shortdash","3,1,").replace("longdash","8,3,").replace(/dot/g,"1,3,").replace("dash","4,3,").replace(/,$/,"").split(",");for(b=a.length;b--;)a[b]=g(a[b])*A;a=a.join(",").replace(/NaN/g,"none");this.element.setAttribute("stroke-dasharray",a)}},alignSetter:function(a){this.alignValue=a;this.element.setAttribute("text-anchor",{left:"start",center:"middle",right:"end"}[a])},opacitySetter:function(a,g,b){this[g]=a;b.setAttribute(g,a)},titleSetter:function(a){var g=this.element.getElementsByTagName("title")[0];g||(g=l.createElementNS(this.SVG_NS,"title"),this.element.appendChild(g));g.firstChild&&g.removeChild(g.firstChild);g.appendChild(l.createTextNode(String(F(a),"").replace(/<[^>]*>/g,"").replace(/&lt;/g,"<").replace(/&gt;/g,">")))},textSetter:function(a){a!==this.textStr&&(delete this.bBox,this.textStr=a,this.added&&this.renderer.buildText(this))},fillSetter:function(a,g,b){"string"===typeof a?b.setAttribute(g,a):a&&this.complexColor(a,g,b)},visibilitySetter:function(a,g,b){"inherit"===a?b.removeAttribute(g):this[g]!==a&&b.setAttribute(g,a);this[g]=a},zIndexSetter:function(a,b){var d=this.renderer,v=this.parentGroup,A=(v||d).element||d.box,c,k=this.element,n,J,d=A===d.box;c=this.added;var e;w(a)?(k.setAttribute("data-z-index",a),a=+a,this[b]===a&&(c=!1)):w(this[b])&&k.removeAttribute("data-z-index");this[b]=a;if(c){(a=this.zIndex)&&v&&(v.handleZ=!0);b=A.childNodes;for(e=b.length-1;0<=e&&!n;e--)if(v=b[e],c=v.getAttribute("data-z-index"),J=!w(c),v!==k)if(0>a&&J&&!d&&!e)A.insertBefore(k,b[e]),n=!0;else if(g(c)<=a||J&&(!w(a)||0<=a))A.insertBefore(k,b[e+1]||null),n=!0;n||(A.insertBefore(k,b[d?3:0]||null),n=!0)}return n},_defaultSetter:function(a,g,b){b.setAttribute(g,a)}});C.prototype.yGetter=C.prototype.xGetter;C.prototype.translateXSetter=C.prototype.translateYSetter=C.prototype.rotationSetter=C.prototype.verticalAlignSetter=C.prototype.rotationOriginXSetter=C.prototype.rotationOriginYSetter=C.prototype.scaleXSetter=C.prototype.scaleYSetter=C.prototype.matrixSetter=function(a,g){this[g]=a;this.doTransform=!0};C.prototype["stroke-widthSetter"]=C.prototype.strokeSetter=function(a,g,b){this[g]=a;this.stroke&&this["stroke-width"]?(C.prototype.fillSetter.call(this,this.stroke,"stroke",b),b.setAttribute("stroke-width",this["stroke-width"]),this.hasStroke=!0):"stroke-width"===g&&0===a&&this.hasStroke&&(b.removeAttribute("stroke"),this.hasStroke=!1)};D=a.SVGRenderer=function(){this.init.apply(this,arguments)};k(D.prototype,{Element:C,SVG_NS:J,init:function(a,g,b,d,v,c){var A;d=this.createElement("svg").attr({version:"1.1",class:"highcharts-root"}).css(this.getStyle(d));A=d.element;a.appendChild(A);h(a,"dir","ltr");-1===a.innerHTML.indexOf("xmlns")&&h(A,"xmlns",this.SVG_NS);this.isSVG=!0;this.box=A;this.boxWrapper=d;this.alignedObjects=[];this.url=(t||n)&&l.getElementsByTagName("base").length?N.location.href.split("#")[0].replace(/<[^>]*>/g,"").replace(/([\('\)])/g,"\\$1").replace(/ /g,"%20"):"";this.createElement("desc").add().element.appendChild(l.createTextNode("Created with Highcharts 6.1.2"));this.defs=this.createElement("defs").add();this.allowHTML=c;this.forExport=v;this.gradients={};this.cache={};this.cacheKeys=[];this.imgCount=0;this.setSize(g,b,!1);var k;t&&a.getBoundingClientRect&&(g=function(){y(a,{left:0,top:0});k=a.getBoundingClientRect();y(a,{left:Math.ceil(k.left)-k.left+"px",top:Math.ceil(k.top)-k.top+"px"})},g(),this.unSubPixelFix=E(N,"resize",g))},getStyle:function(a){return this.style=k({fontFamily:'"Lucida Grande", "Lucida Sans Unicode", Arial, Helvetica, sans-serif',fontSize:"12px"},a)},setStyle:function(a){this.boxWrapper.css(this.getStyle(a))},isHidden:function(){return!this.boxWrapper.getBBox().width},destroy:function(){var a=this.defs;this.box=null;this.boxWrapper=this.boxWrapper.destroy();c(this.gradients||{});this.gradients=null;a&&(this.defs=a.destroy());this.unSubPixelFix&&this.unSubPixelFix();return this.alignedObjects=null},createElement:function(a){var g=new this.Element;g.init(this,a);return g},draw:B,getRadialAttr:function(a,g){return{cx:a[0]-a[2]/2+g.cx*a[2],cy:a[1]-a[2]/2+g.cy*a[2],r:g.r*a[2]}},getSpanWidth:function(a){return a.getBBox(!0).width},applyEllipsis:function(a,g,b,d){var v=a.rotation,c=b,k,A=0,n=b.length,J=function(a){g.removeChild(g.firstChild);a&&g.appendChild(l.createTextNode(a))},e;a.rotation=0;c=this.getSpanWidth(a,g);if(e=c>d){for(;A<=n;)k=Math.ceil((A+n)/2),c=b.substring(0,k)+"",J(c),c=this.getSpanWidth(a,g),A===n?A=n+1:c>d?n=k-1:A=k;0===n&&J("")}a.rotation=v;return e},escapes:{"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"},buildText:function(a){var d=a.element,v=this,c=v.forExport,k=F(a.textStr,"").toString(),A=-1!==k.indexOf("<"),n=d.childNodes,e,B=h(d,"x"),u=a.styles,t=a.textWidth,G=u&&u.lineHeight,x=u&&u.textOutline,f=u&&"ellipsis"===u.textOverflow,P=u&&"nowrap"===u.whiteSpace,O=u&&u.fontSize,w,q,H=n.length,u=t&&!a.added&&this.box,I=function(a){var b;b=/(px|em)$/.test(a&&a.style.fontSize)?a.style.fontSize:O||v.style.fontSize||12;return G?g(G):v.fontMetrics(b,a.getAttribute("style")?a:d).h},N=function(a,g){M(v.escapes,function(b,d){g&&-1!==p(b,g)||(a=a.toString().replace(new RegExp(b,"g"),d))});return a},m=function(a,g){var b;b=a.indexOf("<");a=a.substring(b,a.indexOf(">")-b);b=a.indexOf(g+"=");if(-1!==b&&(b=b+g.length+1,g=a.charAt(b),'"'===g||"'"===g))return a=a.substring(b+1),a.substring(0,a.indexOf(g))};w=[k,f,P,G,x,O,t].join();if(w!==a.textCache){for(a.textCache=w;H--;)d.removeChild(n[H]);A||x||f||t||-1!==k.indexOf(" ")?(u&&u.appendChild(d),k=A?k.replace(/<(b|strong)>/g,'<span style="font-weight:bold">').replace(/<(i|em)>/g,'<span style="font-style:italic">').replace(/<a/g,"<span").replace(/<\/(b|strong|i|em|a)>/g,"</span>").split(/<br.*?>/g):[k],k=b(k,function(a){return""!==a}),z(k,function(g,b){var k,A=0;g=g.replace(/^\s+|\s+$/g,"").replace(/<span/g,"|||<span").replace(/<\/span>/g,"</span>|||");k=g.split("|||");z(k,function(g){if(""!==g||1===k.length){var n={},u=l.createElementNS(v.SVG_NS,"tspan"),p,G;(p=m(g,"class"))&&h(u,"class",p);if(p=m(g,"style"))p=p.replace(/(;| |^)color([ :])/,"$1fill$2"),h(u,"style",p);(G=m(g,"href"))&&!c&&(h(u,"onclick",'location.href="'+G+'"'),h(u,"class","highcharts-anchor"),y(u,{cursor:"pointer"}));g=N(g.replace(/<[a-zA-Z\/](.|\n)*?>/g,"")||" ");if(" "!==g){u.appendChild(l.createTextNode(g));A?n.dx=0:b&&null!==B&&(n.x=B);h(u,n);d.appendChild(u);!A&&q&&(!Q&&c&&y(u,{display:"block"}),h(u,"dy",I(u)));if(t){n=g.replace(/([^\^])-/g,"$1- ").split(" ");G=1<k.length||b||1<n.length&&!P;var x=[],z,O=I(u),w=a.rotation;for(f&&(e=v.applyEllipsis(a,u,g,t));!f&&G&&(n.length||x.length);)a.rotation=0,z=v.getSpanWidth(a,u),g=z>t,void 0===e&&(e=g),g&&1!==n.length?(u.removeChild(u.firstChild),x.unshift(n.pop())):(n=x,x=[],n.length&&!P&&(u=l.createElementNS(J,"tspan"),h(u,{dy:O,x:B}),p&&h(u,"style",p),d.appendChild(u)),z>t&&(t=z+1)),n.length&&u.appendChild(l.createTextNode(n.join(" ").replace(/- /g,"-")));a.rotation=w}A++}}});q=q||d.childNodes.length}),f&&e&&a.attr("title",N(a.textStr,["&lt;","&gt;"])),u&&u.removeChild(d),x&&a.applyTextOutline&&a.applyTextOutline(x)):d.appendChild(l.createTextNode(N(k)))}},getContrast:function(a){a=r(a).rgba;a[0]*=1;a[1]*=1.2;a[2]*=.5;return 459<a[0]+a[1]+a[2]?"#000000":"#FFFFFF"},button:function(a,g,b,d,v,c,n,e,J){var A=this.label(a,g,b,J,null,null,null,null,"button"),u=0;A.attr(G({padding:8,r:2},v));var l,B,p,t;v=G({fill:"#f7f7f7",stroke:"#cccccc","stroke-width":1,style:{color:"#333333",cursor:"pointer",fontWeight:"normal"}},v);l=v.style;delete v.style;c=G(v,{fill:"#e6e6e6"},c);B=c.style;delete c.style;n=G(v,{fill:"#e6ebf5",style:{color:"#000000",fontWeight:"bold"}},n);p=n.style;delete n.style;e=G(v,{style:{color:"#cccccc"}},e);t=e.style;delete e.style;E(A.element,L?"mouseover":"mouseenter",function(){3!==u&&A.setState(1)});E(A.element,L?"mouseout":"mouseleave",function(){3!==u&&A.setState(u)});A.setState=function(a){1!==a&&(A.state=u=a);A.removeClass(/highcharts-button-(normal|hover|pressed|disabled)/).addClass("highcharts-button-"+["normal","hover","pressed","disabled"][a||0]);A.attr([v,c,n,e][a||0]).css([l,B,p,t][a||0])};A.attr(v).css(k({cursor:"default"},l));return A.on("click",function(a){3!==u&&d.call(A,a)})},crispLine:function(a,g){a[1]===a[4]&&(a[1]=a[4]=Math.round(a[1])-g%2/2);a[2]===a[5]&&(a[2]=a[5]=Math.round(a[2])+g%2/2);return a},path:function(a){var g={fill:"none"};H(a)?g.d=a:x(a)&&k(g,a);return this.createElement("path").attr(g)},circle:function(a,g,b){a=x(a)?a:{x:a,y:g,r:b};g=this.createElement("circle");g.xSetter=g.ySetter=function(a,g,b){b.setAttribute("c"+g,a)};return g.attr(a)},arc:function(a,g,b,d,v,c){x(a)?(d=a,g=d.y,b=d.r,a=d.x):d={innerR:d,start:v,end:c};a=this.symbol("arc",a,g,b,b,d);a.r=b;return a},rect:function(a,g,b,d,v,c){v=x(a)?a.r:v;var k=this.createElement("rect");a=x(a)?a:void 0===a?{}:{x:a,y:g,width:Math.max(b,0),height:Math.max(d,0)};void 0!==c&&(a.strokeWidth=c,a=k.crisp(a));a.fill="none";v&&(a.r=v);k.rSetter=function(a,g,b){h(b,{rx:a,ry:a})};return k.attr(a)},setSize:function(a,g,b){var d=this.alignedObjects,v=d.length;this.width=a;this.height=g;for(this.boxWrapper.animate({width:a,height:g},{step:function(){this.attr({viewBox:"0 0 "+this.attr("width")+" "+this.attr("height")})},duration:F(b,!0)?void 0:0});v--;)d[v].align()},g:function(a){var g=this.createElement("g");return a?g.attr({class:"highcharts-"+a}):g},image:function(a,g,b,d,v,c){var n={preserveAspectRatio:"none"},e,J=function(a,g){a.setAttributeNS?a.setAttributeNS("http://www.w3.org/1999/xlink","href",g):a.setAttribute("hc-svg-href",g)},A=function(g){J(e.element,a);c.call(e,g)};1<arguments.length&&k(n,{x:g,y:b,width:d,height:v});e=this.createElement("image").attr(n);c?(J(e.element,"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="),n=new N.Image,E(n,"load",A),n.src=a,n.complete&&A({})):J(e.element,a);return e},symbol:function(a,g,b,d,v,c){var n=this,e,J=/^url\((.*?)\)$/,A=J.test(a),u=!A&&(this.symbols[a]?a:"circle"),B=u&&this.symbols[u],p=w(g)&&B&&B.call(this.symbols,Math.round(g),Math.round(b),d,v,c),t,G;B?(e=this.path(p),e.attr("fill","none"),k(e,{symbolName:u,x:g,y:b,width:d,height:v}),c&&k(e,c)):A&&(t=a.match(J)[1],e=this.image(t),e.imgwidth=F(O[t]&&O[t].width,c&&c.width),e.imgheight=F(O[t]&&O[t].height,c&&c.height),G=function(){e.attr({width:e.width,height:e.height})},z(["width","height"],function(a){e[a+"Setter"]=function(a,g){var b={},d=this["img"+g],v="width"===g?"translateX":"translateY";this[g]=a;w(d)&&(this.element&&this.element.setAttribute(g,d),this.alignByTranslate||(b[v]=((this[g]||0)-d)/2,this.attr(b)))}}),w(g)&&e.attr({x:g,y:b}),e.isImg=!0,w(e.imgwidth)&&w(e.imgheight)?G():(e.attr({width:0,height:0}),q("img",{onload:function(){var a=f[n.chartIndex];0===this.width&&(y(this,{position:"absolute",top:"-999em"}),l.body.appendChild(this));O[t]={width:this.width,height:this.height};e.imgwidth=this.width;e.imgheight=this.height;e.element&&G();this.parentNode&&this.parentNode.removeChild(this);n.imgCount--;if(!n.imgCount&&a&&a.onload)a.onload()},src:t}),this.imgCount++));return e},symbols:{circle:function(a,g,b,d){return this.arc(a+b/2,g+d/2,b/2,d/2,{start:0,end:2*Math.PI,open:!1})},square:function(a,g,b,d){return["M",a,g,"L",a+b,g,a+b,g+d,a,g+d,"Z"]},triangle:function(a,g,b,d){return["M",a+b/2,g,"L",a+b,g+d,a,g+d,"Z"]},"triangle-down":function(a,g,b,d){return["M",a,g,"L",a+b,g,a+b/2,g+d,"Z"]},diamond:function(a,g,b,d){return["M",a+b/2,g,"L",a+b,g+d/2,a+b/2,g+d,a,g+d/2,"Z"]},arc:function(a,g,b,d,v){var c=v.start,k=v.r||b,n=v.r||d||b,e=v.end-.001;b=v.innerR;d=F(v.open,.001>Math.abs(v.end-v.start-2*Math.PI));var J=Math.cos(c),u=Math.sin(c),A=Math.cos(e),e=Math.sin(e);v=.001>v.end-c-Math.PI?0:1;k=["M",a+k*J,g+n*u,"A",k,n,0,v,1,a+k*A,g+n*e];w(b)&&k.push(d?"M":"L",a+b*A,g+b*e,"A",b,b,0,v,0,a+b*J,g+b*u);k.push(d?"":"Z");return k},callout:function(a,g,b,d,v){var c=Math.min(v&&v.r||0,b,d),k=c+6,n=v&&v.anchorX;v=v&&v.anchorY;var e;e=["M",a+c,g,"L",a+b-c,g,"C",a+b,g,a+b,g,a+b,g+c,"L",a+b,g+d-c,"C",a+b,g+d,a+b,g+d,a+b-c,g+d,"L",a+c,g+d,"C",a,g+d,a,g+d,a,g+d-c,"L",a,g+c,"C",a,g,a,g,a+c,g];n&&n>b?v>g+k&&v<g+d-k?e.splice(13,3,"L",a+b,v-6,a+b+6,v,a+b,v+6,a+b,g+d-c):e.splice(13,3,"L",a+b,d/2,n,v,a+b,d/2,a+b,g+d-c):n&&0>n?v>g+k&&v<g+d-k?e.splice(33,3,"L",a,v+6,a-6,v,a,v-6,a,g+c):e.splice(33,3,"L",a,d/2,n,v,a,d/2,a,g+c):v&&v>d&&n>a+k&&n<a+b-k?e.splice(23,3,"L",n+6,g+d,n,g+d+6,n-6,g+d,a+c,g+d):v&&0>v&&n>a+k&&n<a+b-k&&e.splice(3,3,"L",n-6,g,n,g-6,n+6,g,b-c,g);return e}},clipRect:function(g,b,d,v){var c=a.uniqueKey(),k=this.createElement("clipPath").attr({id:c}).add(this.defs);g=this.rect(g,b,d,v,0).add(k);g.id=c;g.clipPath=k;g.count=0;return g},text:function(a,g,b,d){var v={};if(d&&(this.allowHTML||!this.forExport))return this.html(a,g,b);v.x=Math.round(g||0);b&&(v.y=Math.round(b));if(a||0===a)v.text=a;a=this.createElement("text").attr(v);d||(a.xSetter=function(a,g,b){var d=b.getElementsByTagName("tspan"),v,c=b.getAttribute(g),k;for(k=0;k<d.length;k++)v=d[k],v.getAttribute(g)===c&&v.setAttribute(g,a);b.setAttribute(g,a)});return a},fontMetrics:function(a,b){a=a||b&&b.style&&b.style.fontSize||this.style&&this.style.fontSize;a=/px/.test(a)?g(a):/em/.test(a)?parseFloat(a)*(b?this.fontMetrics(null,b.parentNode).f:16):12;b=24>a?a+3:Math.round(1.2*a);return{h:b,b:Math.round(.8*b),f:a}},rotCorr:function(a,g,b){var d=a;g&&b&&(d=Math.max(d*Math.cos(g*e),4));return{x:-a/3*Math.sin(g*e),y:d}},label:function(g,b,d,c,n,e,J,u,l){var B=this,p=B.g("button"!==l&&"label"),t=p.text=B.text("",0,0,J).attr({zIndex:1}),A,x,Q=0,f=3,P=0,h,O,q,F,H,I={},N,y,M=/^url\((.*?)\)$/.test(c),m=M,L,r,R,U;l&&p.addClass("highcharts-"+l);m=M;L=function(){return(N||0)%2/2};r=function(){var a=t.element.style,g={};x=(void 0===h||void 0===O||H)&&w(t.textStr)&&t.getBBox();p.width=(h||x.width||0)+2*f+P;p.height=(O||x.height||0)+2*f;y=f+B.fontMetrics(a&&a.fontSize,t).b;m&&(A||(p.box=A=B.symbols[c]||M?B.symbol(c):B.rect(),A.addClass(("button"===l?"":"highcharts-label-box")+(l?" highcharts-"+l+"-box":"")),A.add(p),a=L(),g.x=a,g.y=(u?-y:0)+a),g.width=Math.round(p.width),g.height=Math.round(p.height),A.attr(k(g,I)),I={})};R=function(){var a=P+f,g;g=u?0:y;w(h)&&x&&("center"===H||"right"===H)&&(a+={center:.5,right:1}[H]*(h-x.width));if(a!==t.x||g!==t.y)t.attr("x",a),t.hasBoxWidthChanged&&(x=t.getBBox(!0),r()),void 0!==g&&t.attr("y",g);t.x=a;t.y=g};U=function(a,g){A?A.attr(a,g):I[a]=g};p.onAdd=function(){t.add(p);p.attr({text:g||0===g?g:"",x:b,y:d});A&&w(n)&&p.attr({anchorX:n,anchorY:e})};p.widthSetter=function(g){h=a.isNumber(g)?g:null};p.heightSetter=function(a){O=a};p["text-alignSetter"]=function(a){H=a};p.paddingSetter=function(a){w(a)&&a!==f&&(f=p.padding=a,R())};p.paddingLeftSetter=function(a){w(a)&&a!==P&&(P=a,R())};p.alignSetter=function(a){a={left:0,center:.5,right:1}[a];a!==Q&&(Q=a,x&&p.attr({x:q}))};p.textSetter=function(a){void 0!==a&&t.textSetter(a);r();R()};p["stroke-widthSetter"]=function(a,g){a&&(m=!0);N=this["stroke-width"]=a;U(g,a)};p.strokeSetter=p.fillSetter=p.rSetter=function(a,g){"r"!==g&&("fill"===g&&a&&(m=!0),p[g]=a);U(g,a)};p.anchorXSetter=function(a,g){n=p.anchorX=a;U(g,Math.round(a)-L()-q)};p.anchorYSetter=function(a,g){e=p.anchorY=a;U(g,a-F)};p.xSetter=function(a){p.x=a;Q&&(a-=Q*((h||x.width)+2*f),p["forceAnimate:x"]=!0);q=Math.round(a);p.attr("translateX",q)};p.ySetter=function(a){F=p.y=Math.round(a);p.attr("translateY",F)};var S=p.css;return k(p,{css:function(a){if(a){var g={};a=G(a);z(p.textProps,function(b){void 0!==a[b]&&(g[b]=a[b],delete a[b])});t.css(g);"width"in g&&r()}return S.call(p,a)},getBBox:function(){return{width:x.width+2*f,height:x.height+2*f,x:x.x-f,y:x.y-f}},shadow:function(a){a&&(r(),A&&A.shadow(a));return p},destroy:function(){v(p.element,"mouseenter");v(p.element,"mouseleave");t&&(t=t.destroy());A&&(A=A.destroy());C.prototype.destroy.call(p);p=B=r=R=U=null}})}});a.Renderer=D})(K);(function(a){var C=a.attr,D=a.createElement,E=a.css,m=a.defined,h=a.each,f=a.extend,r=a.isFirefox,y=a.isMS,q=a.isWebKit,w=a.pick,e=a.pInt,c=a.SVGRenderer,l=a.win,z=a.wrap;f(a.SVGElement.prototype,{htmlCss:function(a){var d=this.element;if((d=a&&"SPAN"===d.tagName&&a.width)||this.textWidth&&!d)delete a.width,this.textWidth=d,this.htmlUpdateTransform();a&&"ellipsis"===a.textOverflow&&(a.whiteSpace="nowrap",a.overflow="hidden");this.styles=f(this.styles,a);E(this.element,a);return this},htmlGetBBox:function(){var a=this.element;return{x:a.offsetLeft,y:a.offsetTop,width:a.offsetWidth,height:a.offsetHeight}},htmlUpdateTransform:function(){if(this.added){var a=this.renderer,d=this.element,b=this.translateX||0,c=this.translateY||0,p=this.x||0,l=this.y||0,t=this.textAlign||"left",f={left:0,center:.5,right:1}[t],x=this.styles,z=x&&x.whiteSpace;E(d,{marginLeft:b,marginTop:c});this.shadows&&h(this.shadows,function(a){E(a,{marginLeft:b+1,marginTop:c+1})});this.inverted&&h(d.childNodes,function(b){a.invertChild(b,d)});if("SPAN"===d.tagName){var x=this.rotation,n=this.textWidth&&e(this.textWidth),G=[x,t,d.innerHTML,this.textWidth,this.textAlign].join(),B;(B=n!==this.oldTextWidth)&&!(B=n>this.oldTextWidth)&&((B=this.textPxLength)||(E(d,{width:"",whiteSpace:z||"nowrap"}),B=d.offsetWidth),B=B>n);B&&/[ \-]/.test(d.textContent||d.innerText)?(E(d,{width:n+"px",display:"block",whiteSpace:z||"normal"}),this.oldTextWidth=n,this.hasBoxWidthChanged=!0):this.hasBoxWidthChanged=!1;G!==this.cTT&&(z=a.fontMetrics(d.style.fontSize).b,!m(x)||x===(this.oldRotation||0)&&t===this.oldAlign||this.setSpanRotation(x,f,z),this.getSpanCorrection(!m(x)&&this.textPxLength||d.offsetWidth,z,f,x,t));E(d,{left:p+(this.xCorr||0)+"px",top:l+(this.yCorr||0)+"px"});this.cTT=G;this.oldRotation=x;this.oldAlign=t}}else this.alignOnAdd=!0},setSpanRotation:function(a,d,b){var c={},k=this.renderer.getTransformKey();c[k]=c.transform="rotate("+a+"deg)";c[k+(r?"Origin":"-origin")]=c.transformOrigin=100*d+"% "+b+"px";E(this.element,c)},getSpanCorrection:function(a,d,b){this.xCorr=-a*b;this.yCorr=-d}});f(c.prototype,{getTransformKey:function(){return y&&!/Edge/.test(l.navigator.userAgent)?"-ms-transform":q?"-webkit-transform":r?"MozTransform":l.opera?"-o-transform":""},html:function(a,d,b){var c=this.createElement("span"),k=c.element,e=c.renderer,l=e.isSVG,q=function(a,b){h(["opacity","visibility"],function(d){z(a,d+"Setter",function(a,d,c,k){a.call(this,d,c,k);b[c]=d})});a.addedSetters=!0};c.textSetter=function(a){a!==k.innerHTML&&delete this.bBox;this.textStr=a;k.innerHTML=w(a,"");c.doTransform=!0};l&&q(c,c.element.style);c.xSetter=c.ySetter=c.alignSetter=c.rotationSetter=function(a,b){"align"===b&&(b="textAlign");c[b]=a;c.doTransform=!0};c.afterSetters=function(){this.doTransform&&(this.htmlUpdateTransform(),this.doTransform=!1)};c.attr({text:a,x:Math.round(d),y:Math.round(b)}).css({fontFamily:this.style.fontFamily,fontSize:this.style.fontSize,position:"absolute"});k.style.whiteSpace="nowrap";c.css=c.htmlCss;l&&(c.add=function(a){var b,d=e.box.parentNode,p=[];if(this.parentGroup=a){if(b=a.div,!b){for(;a;)p.push(a),a=a.parentGroup;h(p.reverse(),function(a){function k(g,b){a[b]=g;"translateX"===b?n.left=g+"px":n.top=g+"px";a.doTransform=!0}var n,g=C(a.element,"class");g&&(g={className:g});b=a.div=a.div||D("div",g,{position:"absolute",left:(a.translateX||0)+"px",top:(a.translateY||0)+"px",display:a.display,opacity:a.opacity,pointerEvents:a.styles&&a.styles.pointerEvents},b||d);n=b.style;f(a,{classSetter:function(a){return function(g){this.element.setAttribute("class",g);a.className=g}}(b),on:function(){p[0].div&&c.on.apply({element:p[0].div},arguments);return a},translateXSetter:k,translateYSetter:k});a.addedSetters||q(a,n)})}}else b=d;b.appendChild(k);c.added=!0;c.alignOnAdd&&c.htmlUpdateTransform();return c});return c}})})(K);(function(a){var C=a.defined,D=a.each,E=a.extend,m=a.merge,h=a.pick,f=a.timeUnits,r=a.win;a.Time=function(a){this.update(a,!1)};a.Time.prototype={defaultOptions:{},update:function(a){var f=h(a&&a.useUTC,!0),w=this;this.options=a=m(!0,this.options||{},a);this.Date=a.Date||r.Date;this.timezoneOffset=(this.useUTC=f)&&a.timezoneOffset;this.getTimezoneOffset=this.timezoneOffsetFunction();(this.variableTimezone=!(f&&!a.getTimezoneOffset&&!a.timezone))||this.timezoneOffset?(this.get=function(a,c){var e=c.getTime(),f=e-w.getTimezoneOffset(c);c.setTime(f);a=c["getUTC"+a]();c.setTime(e);return a},this.set=function(a,c,l){var e;if("Milliseconds"===a||"Seconds"===a||"Minutes"===a&&0===c.getTimezoneOffset()%60)c["set"+a](l);else e=w.getTimezoneOffset(c),e=c.getTime()-e,c.setTime(e),c["setUTC"+a](l),a=w.getTimezoneOffset(c),e=c.getTime()+a,c.setTime(e)}):f?(this.get=function(a,c){return c["getUTC"+a]()},this.set=function(a,c,l){return c["setUTC"+a](l)}):(this.get=function(a,c){return c["get"+a]()},this.set=function(a,c,l){return c["set"+a](l)})},makeTime:function(f,q,w,e,c,l){var z,k,d;this.useUTC?(z=this.Date.UTC.apply(0,arguments),k=this.getTimezoneOffset(z),z+=k,d=this.getTimezoneOffset(z),k!==d?z+=d-k:k-36e5!==this.getTimezoneOffset(z-36e5)||a.isSafari||(z-=36e5)):z=new this.Date(f,q,h(w,1),h(e,0),h(c,0),h(l,0)).getTime();return z},timezoneOffsetFunction:function(){var f=this,h=this.options,w=r.moment;if(!this.useUTC)return function(a){return 6e4*new Date(a).getTimezoneOffset()};if(h.timezone){if(w)return function(a){return 6e4*-w.tz(a,h.timezone).utcOffset()};a.error(25)}return this.useUTC&&h.getTimezoneOffset?function(a){return 6e4*h.getTimezoneOffset(a)}:function(){return 6e4*(f.timezoneOffset||0)}},dateFormat:function(f,h,w){if(!a.defined(h)||isNaN(h))return a.defaultOptions.lang.invalidDate||"";f=a.pick(f,"%Y-%m-%d %H:%M:%S");var e=this,c=new this.Date(h),l=this.get("Hours",c),z=this.get("Day",c),k=this.get("Date",c),d=this.get("Month",c),b=this.get("FullYear",c),u=a.defaultOptions.lang,p=u.weekdays,H=u.shortWeekdays,t=a.pad,c=a.extend({a:H?H[z]:p[z].substr(0,3),A:p[z],d:t(k),e:t(k,2," "),w:z,b:u.shortMonths[d],B:u.months[d],m:t(d+1),o:d+1,y:b.toString().substr(2,2),Y:b,H:t(l),k:l,I:t(l%12||12),l:l%12||12,M:t(e.get("Minutes",c)),p:12>l?"AM":"PM",P:12>l?"am":"pm",S:t(c.getSeconds()),L:t(Math.round(h%1e3),3)},a.dateFormats);a.objectEach(c,function(a,b){for(;-1!==f.indexOf("%"+b);)f=f.replace("%"+b,"function"===typeof a?a.call(e,h):a)});return w?f.substr(0,1).toUpperCase()+f.substr(1):f},getTimeTicks:function(a,q,w,e){var c=this,l=[],z={},k,d=new c.Date(q),b=a.unitRange,u=a.count||1,p;if(C(q)){c.set("Milliseconds",d,b>=f.second?0:u*Math.floor(c.get("Milliseconds",d)/u));b>=f.second&&c.set("Seconds",d,b>=f.minute?0:u*Math.floor(c.get("Seconds",d)/u));b>=f.minute&&c.set("Minutes",d,b>=f.hour?0:u*Math.floor(c.get("Minutes",d)/u));b>=f.hour&&c.set("Hours",d,b>=f.day?0:u*Math.floor(c.get("Hours",d)/u));b>=f.day&&c.set("Date",d,b>=f.month?1:u*Math.floor(c.get("Date",d)/u));b>=f.month&&(c.set("Month",d,b>=f.year?0:u*Math.floor(c.get("Month",d)/u)),k=c.get("FullYear",d));b>=f.year&&c.set("FullYear",d,k-k%u);b===f.week&&c.set("Date",d,c.get("Date",d)-c.get("Day",d)+h(e,1));k=c.get("FullYear",d);e=c.get("Month",d);var H=c.get("Date",d),t=c.get("Hours",d);q=d.getTime();c.variableTimezone&&(p=w-q>4*f.month||c.getTimezoneOffset(q)!==c.getTimezoneOffset(w));d=d.getTime();for(q=1;d<w;)l.push(d),d=b===f.year?c.makeTime(k+q*u,0):b===f.month?c.makeTime(k,e+q*u):!p||b!==f.day&&b!==f.week?p&&b===f.hour&&1<u?c.makeTime(k,e,H,t+q*u):d+b*u:c.makeTime(k,e,H+q*u*(b===f.day?1:7)),q++;l.push(d);b<=f.hour&&1e4>l.length&&D(l,function(a){0===a%18e5&&"000000000"===c.dateFormat("%H%M%S%L",a)&&(z[a]="day")})}l.info=E(a,{higherRanks:z,totalRange:b*u});return l}}})(K);(function(a){var C=a.color,D=a.merge;a.defaultOptions={colors:"#7cb5ec #434348 #90ed7d #f7a35c #8085e9 #f15c80 #e4d354 #2b908f #f45b5b #91e8e1".split(" "),symbols:["circle","diamond","square","triangle","triangle-down"],lang:{loading:"Loading...",months:"January February March April May June July August September October November December".split(" "),shortMonths:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),weekdays:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),decimalPoint:".",numericSymbols:"kMGTPE".split(""),resetZoom:"Reset zoom",resetZoomTitle:"Reset zoom level 1:1",thousandsSep:" "},global:{},time:a.Time.prototype.defaultOptions,chart:{borderRadius:0,defaultSeriesType:"line",ignoreHiddenSeries:!0,spacing:[10,10,15,10],resetZoomButton:{theme:{zIndex:6},position:{align:"right",x:-10,y:10}},width:null,height:null,borderColor:"#335cad",backgroundColor:"#ffffff",plotBorderColor:"#cccccc"},title:{text:"Chart title",align:"center",margin:15,widthAdjust:-44},subtitle:{text:"",align:"center",widthAdjust:-44},plotOptions:{},labels:{style:{position:"absolute",color:"#333333"}},legend:{enabled:!0,align:"center",alignColumns:!0,layout:"horizontal",labelFormatter:function(){return this.name},borderColor:"#999999",borderRadius:0,navigation:{activeColor:"#003399",inactiveColor:"#cccccc"},itemStyle:{color:"#333333",fontSize:"12px",fontWeight:"bold",textOverflow:"ellipsis"},itemHoverStyle:{color:"#000000"},itemHiddenStyle:{color:"#cccccc"},shadow:!1,itemCheckboxStyle:{position:"absolute",width:"13px",height:"13px"},squareSymbol:!0,symbolPadding:5,verticalAlign:"bottom",x:0,y:0,title:{style:{fontWeight:"bold"}}},loading:{labelStyle:{fontWeight:"bold",position:"relative",top:"45%"},style:{position:"absolute",backgroundColor:"#ffffff",opacity:.5,textAlign:"center"}},tooltip:{enabled:!0,animation:a.svg,borderRadius:3,dateTimeLabelFormats:{millisecond:"%A, %b %e, %H:%M:%S.%L",second:"%A, %b %e, %H:%M:%S",minute:"%A, %b %e, %H:%M",hour:"%A, %b %e, %H:%M",day:"%A, %b %e, %Y",week:"Week from %A, %b %e, %Y",month:"%B %Y",year:"%Y"},footerFormat:"",padding:8,snap:a.isTouchDevice?25:10,backgroundColor:C("#f7f7f7").setOpacity(.85).get(),borderWidth:1,headerFormat:'<span style="font-size: 10px">{point.key}</span><br/>',pointFormat:'<span style="color:{point.color}"></span> {series.name}: <b>{point.y}</b><br/>',shadow:!0,style:{color:"#333333",cursor:"default",fontSize:"12px",pointerEvents:"none",whiteSpace:"nowrap"}},credits:{enabled:!0,href:"https://www.highcharts.com",position:{align:"right",x:-10,verticalAlign:"bottom",y:-5},style:{cursor:"pointer",color:"#999999",fontSize:"9px"},text:"Highcharts.com"}};a.setOptions=function(C){a.defaultOptions=D(!0,a.defaultOptions,C);a.time.update(D(a.defaultOptions.global,a.defaultOptions.time),!1);return a.defaultOptions};a.getOptions=function(){return a.defaultOptions};a.defaultPlotOptions=a.defaultOptions.plotOptions;a.time=new a.Time(D(a.defaultOptions.global,a.defaultOptions.time));a.dateFormat=function(C,m,h){return a.time.dateFormat(C,m,h)}})(K);(function(a){var C=a.correctFloat,D=a.defined,E=a.destroyObjectProperties,m=a.fireEvent,h=a.isNumber,f=a.merge,r=a.pick,y=a.deg2rad;a.Tick=function(a,f,e,c){this.axis=a;this.pos=f;this.type=e||"";this.isNewLabel=this.isNew=!0;e||c||this.addLabel()};a.Tick.prototype={addLabel:function(){var a=this.axis,h=a.options,e=a.chart,c=a.categories,l=a.names,z=this.pos,k=h.labels,d=a.tickPositions,b=z===d[0],u=z===d[d.length-1],l=c?r(c[z],l[z],z):z,c=this.label,d=d.info,p;a.isDatetimeAxis&&d&&(p=h.dateTimeLabelFormats[d.higherRanks[z]||d.unitName]);this.isFirst=b;this.isLast=u;h={axis:a,chart:e,isFirst:b,isLast:u,dateTimeLabelFormat:p,value:a.isLog?C(a.lin2log(l)):l,pos:z};h=a.labelFormatter.call(h,h);if(D(c))c&&c.attr({text:h});else{if(this.label=c=D(h)&&k.enabled?e.renderer.text(h,0,0,k.useHTML).css(f(k.style)).add(a.labelGroup):null)c.textPxLength=c.getBBox().width;this.rotation=0}},getLabelSize:function(){return this.label?this.label.getBBox()[this.axis.horiz?"height":"width"]:0},handleOverflow:function(a){var f=this.axis,e=f.options.labels,c=a.x,l=f.chart.chartWidth,z=f.chart.spacing,k=r(f.labelLeft,Math.min(f.pos,z[3])),z=r(f.labelRight,Math.max(f.isRadial?0:f.pos+f.len,l-z[1])),d=this.label,b=this.rotation,u={left:0,center:.5,right:1}[f.labelAlign||d.attr("align")],p=d.getBBox().width,h=f.getSlotWidth(this),t=h,q=1,x,I={};if(b||!1===e.overflow)0>b&&c-u*p<k?x=Math.round(c/Math.cos(b*y)-k):0<b&&c+u*p>z&&(x=Math.round((l-c)/Math.cos(b*y)));else if(l=c+(1-u)*p,c-u*p<k?t=a.x+t*(1-u)-k:l>z&&(t=z-a.x+t*u,q=-1),t=Math.min(h,t),t<h&&"center"===f.labelAlign&&(a.x+=q*(h-t-u*(h-Math.min(p,t)))),p>t||f.autoRotation&&(d.styles||{}).width)x=t;x&&(I.width=x,(e.style||{}).textOverflow||(I.textOverflow="ellipsis"),d.css(I))},getPosition:function(f,h,e,c){var l=this.axis,z=l.chart,k=c&&z.oldChartHeight||z.chartHeight;f={x:f?a.correctFloat(l.translate(h+e,null,null,c)+l.transB):l.left+l.offset+(l.opposite?(c&&z.oldChartWidth||z.chartWidth)-l.right-l.left:0),y:f?k-l.bottom+l.offset-(l.opposite?l.height:0):a.correctFloat(k-l.translate(h+e,null,null,c)-l.transB)};m(this,"afterGetPosition",{pos:f});return f},getLabelPosition:function(a,f,e,c,l,h,k,d){var b=this.axis,u=b.transA,p=b.reversed,z=b.staggerLines,t=b.tickRotCorr||{x:0,y:0},w=l.y,x=c||b.reserveSpaceDefault?0:-b.labelOffset*("center"===b.labelAlign?.5:1),q={};D(w)||(w=0===b.side?e.rotation?-8:-e.getBBox().height:2===b.side?t.y+8:Math.cos(e.rotation*y)*(t.y-e.getBBox(!1,0).height/2));a=a+l.x+x+t.x-(h&&c?h*u*(p?-1:1):0);f=f+w-(h&&!c?h*u*(p?1:-1):0);z&&(e=k/(d||1)%z,b.opposite&&(e=z-e-1),f+=b.labelOffset/z*e);q.x=a;q.y=Math.round(f);m(this,"afterGetLabelPosition",{pos:q});return q},getMarkPath:function(a,f,e,c,l,h){return h.crispLine(["M",a,f,"L",a+(l?0:-e),f+(l?e:0)],c)},renderGridLine:function(a,f,e){var c=this.axis,l=c.options,h=this.gridLine,k={},d=this.pos,b=this.type,u=c.tickmarkOffset,p=c.chart.renderer,H=b?b+"Grid":"grid",t=l[H+"LineWidth"],w=l[H+"LineColor"],l=l[H+"LineDashStyle"];h||(k.stroke=w,k["stroke-width"]=t,l&&(k.dashstyle=l),b||(k.zIndex=1),a&&(k.opacity=0),this.gridLine=h=p.path().attr(k).addClass("highcharts-"+(b?b+"-":"")+"grid-line").add(c.gridGroup));if(!a&&h&&(a=c.getPlotLinePath(d+u,h.strokeWidth()*e,a,!0)))h[this.isNew?"attr":"animate"]({d:a,opacity:f})},renderMark:function(a,f,e){var c=this.axis,l=c.options,h=c.chart.renderer,k=this.type,d=k?k+"Tick":"tick",b=c.tickSize(d),u=this.mark,p=!u,H=a.x;a=a.y;var t=r(l[d+"Width"],!k&&c.isXAxis?1:0),l=l[d+"Color"];b&&(c.opposite&&(b[0]=-b[0]),p&&(this.mark=u=h.path().addClass("highcharts-"+(k?k+"-":"")+"tick").add(c.axisGroup),u.attr({stroke:l,"stroke-width":t})),u[p?"attr":"animate"]({d:this.getMarkPath(H,a,b[0],u.strokeWidth()*e,c.horiz,h),opacity:f}))},renderLabel:function(a,f,e,c){var l=this.axis,z=l.horiz,k=l.options,d=this.label,b=k.labels,u=b.step,l=l.tickmarkOffset,p=!0,H=a.x;a=a.y;d&&h(H)&&(d.xy=a=this.getLabelPosition(H,a,d,z,b,l,c,u),this.isFirst&&!this.isLast&&!r(k.showFirstLabel,1)||this.isLast&&!this.isFirst&&!r(k.showLastLabel,1)?p=!1:!z||b.step||b.rotation||f||0===e||this.handleOverflow(a),u&&c%u&&(p=!1),p&&h(a.y)?(a.opacity=e,d[this.isNewLabel?"attr":"animate"](a),this.isNewLabel=!1):(d.attr("y",-9999),this.isNewLabel=!0))},render:function(f,h,e){var c=this.axis,l=c.horiz,z=this.getPosition(l,this.pos,c.tickmarkOffset,h),k=z.x,d=z.y,c=l&&k===c.pos+c.len||!l&&d===c.pos?-1:1;e=r(e,1);this.isActive=!0;this.renderGridLine(h,e,c);this.renderMark(z,e,c);this.renderLabel(z,h,e,f);this.isNew=!1;a.fireEvent(this,"afterRender")},destroy:function(){E(this,this.axis)}}})(K);var V=function(a){var C=a.addEvent,D=a.animObject,E=a.arrayMax,m=a.arrayMin,h=a.color,f=a.correctFloat,r=a.defaultOptions,y=a.defined,q=a.deg2rad,w=a.destroyObjectProperties,e=a.each,c=a.extend,l=a.fireEvent,z=a.format,k=a.getMagnitude,d=a.grep,b=a.inArray,u=a.isArray,p=a.isNumber,H=a.isString,t=a.merge,L=a.normalizeTickInterval,x=a.objectEach,I=a.pick,n=a.removeEvent,G=a.splat,B=a.syncTimeout,M=a.Tick,F=function(){this.init.apply(this,arguments)};a.extend(F.prototype,{defaultOptions:{dateTimeLabelFormats:{millisecond:"%H:%M:%S.%L",second:"%H:%M:%S",minute:"%H:%M",hour:"%H:%M",day:"%e. %b",week:"%e. %b",month:"%b '%y",year:"%Y"},endOnTick:!1,labels:{enabled:!0,x:0,style:{color:"#666666",cursor:"default",fontSize:"11px"}},maxPadding:.01,minorTickLength:2,minorTickPosition:"outside",minPadding:.01,startOfWeek:1,startOnTick:!1,tickLength:10,tickPixelInterval:100,tickmarkPlacement:"between",tickPosition:"outside",title:{align:"middle",style:{color:"#666666"}},type:"linear",minorGridLineColor:"#f2f2f2",minorGridLineWidth:1,minorTickColor:"#999999",lineColor:"#ccd6eb",lineWidth:1,gridLineColor:"#e6e6e6",tickColor:"#ccd6eb"},defaultYAxisOptions:{endOnTick:!0,maxPadding:.05,minPadding:.05,tickPixelInterval:72,showLastLabel:!0,labels:{x:-8},startOnTick:!0,title:{rotation:270,text:"Values"},stackLabels:{allowOverlap:!1,enabled:!1,formatter:function(){return a.numberFormat(this.total,-1)},style:{fontSize:"11px",fontWeight:"bold",color:"#000000",textOutline:"1px contrast"}},gridLineWidth:1,lineWidth:0},defaultLeftAxisOptions:{labels:{x:-15},title:{rotation:270}},defaultRightAxisOptions:{labels:{x:15},title:{rotation:90}},defaultBottomAxisOptions:{labels:{autoRotation:[-45],x:0},title:{rotation:0}},defaultTopAxisOptions:{labels:{autoRotation:[-45],x:0},title:{rotation:0}},init:function(a,d){var g=d.isX,v=this;v.chart=a;v.horiz=a.inverted&&!v.isZAxis?!g:g;v.isXAxis=g;v.coll=v.coll||(g?"xAxis":"yAxis");l(this,"init",{userOptions:d});v.opposite=d.opposite;v.side=d.side||(v.horiz?v.opposite?0:2:v.opposite?1:3);v.setOptions(d);var c=this.options,k=c.type;v.labelFormatter=c.labels.formatter||v.defaultLabelFormatter;v.userOptions=d;v.minPixelPadding=0;v.reversed=c.reversed;v.visible=!1!==c.visible;v.zoomEnabled=!1!==c.zoomEnabled;v.hasNames="category"===k||!0===c.categories;v.categories=c.categories||v.hasNames;v.names||(v.names=[],v.names.keys={});v.plotLinesAndBandsGroups={};v.isLog="logarithmic"===k;v.isDatetimeAxis="datetime"===k;v.positiveValuesOnly=v.isLog&&!v.allowNegativeLog;v.isLinked=y(c.linkedTo);v.ticks={};v.labelEdge=[];v.minorTicks={};v.plotLinesAndBands=[];v.alternateBands={};v.len=0;v.minRange=v.userMinRange=c.minRange||c.maxZoom;v.range=c.range;v.offset=c.offset||0;v.stacks={};v.oldStacks={};v.stacksTouched=0;v.max=null;v.min=null;v.crosshair=I(c.crosshair,G(a.options.tooltip.crosshairs)[g?0:1],!1);d=v.options.events;-1===b(v,a.axes)&&(g?a.axes.splice(a.xAxis.length,0,v):a.axes.push(v),a[v.coll].push(v));v.series=v.series||[];a.inverted&&!v.isZAxis&&g&&void 0===v.reversed&&(v.reversed=!0);x(d,function(a,g){C(v,g,a)});v.lin2log=c.linearToLogConverter||v.lin2log;v.isLog&&(v.val2lin=v.log2lin,v.lin2val=v.lin2log);l(this,"afterInit")},setOptions:function(a){this.options=t(this.defaultOptions,"yAxis"===this.coll&&this.defaultYAxisOptions,[this.defaultTopAxisOptions,this.defaultRightAxisOptions,this.defaultBottomAxisOptions,this.defaultLeftAxisOptions][this.side],t(r[this.coll],a));l(this,"afterSetOptions",{userOptions:a})},defaultLabelFormatter:function(){var g=this.axis,b=this.value,d=g.chart.time,c=g.categories,k=this.dateTimeLabelFormat,n=r.lang,e=n.numericSymbols,n=n.numericSymbolMagnitude||1e3,p=e&&e.length,l,u=g.options.labels.format,g=g.isLog?Math.abs(b):g.tickInterval;if(u)l=z(u,this,d);else if(c)l=b;else if(k)l=d.dateFormat(k,b);else if(p&&1e3<=g)for(;p--&&void 0===l;)d=Math.pow(n,p+1),g>=d&&0===10*b%d&&null!==e[p]&&0!==b&&(l=a.numberFormat(b/d,-1)+e[p]);void 0===l&&(l=1e4<=Math.abs(b)?a.numberFormat(b,-1):a.numberFormat(b,-1,void 0,""));return l},getSeriesExtremes:function(){var a=this,b=a.chart;l(this,"getSeriesExtremes",null,function(){a.hasVisibleSeries=!1;a.dataMin=a.dataMax=a.threshold=null;a.softThreshold=!a.isXAxis;a.buildStacks&&a.buildStacks();e(a.series,function(g){if(g.visible||!b.options.chart.ignoreHiddenSeries){var v=g.options,c=v.threshold,k;a.hasVisibleSeries=!0;a.positiveValuesOnly&&0>=c&&(c=null);if(a.isXAxis)v=g.xData,v.length&&(g=m(v),k=E(v),p(g)||g instanceof Date||(v=d(v,p),g=m(v),k=E(v)),v.length&&(a.dataMin=Math.min(I(a.dataMin,v[0],g),g),a.dataMax=Math.max(I(a.dataMax,v[0],k),k)));else if(g.getExtremes(),k=g.dataMax,g=g.dataMin,y(g)&&y(k)&&(a.dataMin=Math.min(I(a.dataMin,g),g),a.dataMax=Math.max(I(a.dataMax,k),k)),y(c)&&(a.threshold=c),!v.softThreshold||a.positiveValuesOnly)a.softThreshold=!1}})});l(this,"afterGetSeriesExtremes")},translate:function(a,b,d,c,k,n){var g=this.linkedParent||this,v=1,e=0,J=c?g.oldTransA:g.transA;c=c?g.oldMin:g.min;var l=g.minPixelPadding;k=(g.isOrdinal||g.isBroken||g.isLog&&k)&&g.lin2val;J||(J=g.transA);d&&(v*=-1,e=g.len);g.reversed&&(v*=-1,e-=v*(g.sector||g.len));b?(a=(a*v+e-l)/J+c,k&&(a=g.lin2val(a))):(k&&(a=g.val2lin(a)),a=p(c)?v*(a-c)*J+e+v*l+(p(n)?J*n:0):void 0);return a},toPixels:function(a,b){return this.translate(a,!1,!this.horiz,null,!0)+(b?0:this.pos)},toValue:function(a,b){return this.translate(a-(b?0:this.pos),!0,!this.horiz,null,!0)},getPlotLinePath:function(a,b,d,c,k){var g=this.chart,v=this.left,n=this.top,e,J,l=d&&g.oldChartHeight||g.chartHeight,u=d&&g.oldChartWidth||g.chartWidth,B;e=this.transB;var f=function(a,g,b){if(a<g||a>b)c?a=Math.min(Math.max(g,a),b):B=!0;return a};k=I(k,this.translate(a,null,null,d));k=Math.min(Math.max(-1e5,k),1e5);a=d=Math.round(k+e);e=J=Math.round(l-k-e);p(k)?this.horiz?(e=n,J=l-this.bottom,a=d=f(a,v,v+this.width)):(a=v,d=u-this.right,e=J=f(e,n,n+this.height)):(B=!0,c=!1);return B&&!c?null:g.renderer.crispLine(["M",a,e,"L",d,J],b||1)},getLinearTickPositions:function(a,b,d){var g,v=f(Math.floor(b/a)*a);d=f(Math.ceil(d/a)*a);var c=[],k;f(v+a)===v&&(k=20);if(this.single)return[b];for(b=v;b<=d;){c.push(b);b=f(b+a,k);if(b===g)break;g=b}return c},getMinorTickInterval:function(){var a=this.options;return!0===a.minorTicks?I(a.minorTickInterval,"auto"):!1===a.minorTicks?null:a.minorTickInterval},getMinorTickPositions:function(){var a=this,b=a.options,d=a.tickPositions,c=a.minorTickInterval,k=[],n=a.pointRangePadding||0,p=a.min-n,n=a.max+n,l=n-p;if(l&&l/c<a.len/3)if(a.isLog)e(this.paddedTicks,function(g,b,d){b&&k.push.apply(k,a.getLogTickPositions(c,d[b-1],d[b],!0))});else if(a.isDatetimeAxis&&"auto"===this.getMinorTickInterval())k=k.concat(a.getTimeTicks(a.normalizeTimeTickInterval(c),p,n,b.startOfWeek));else for(b=p+(d[0]-p)%c;b<=n&&b!==k[0];b+=c)k.push(b);0!==k.length&&a.trimTicks(k);return k},adjustForMinRange:function(){var a=this.options,b=this.min,d=this.max,c,k,n,p,l,u,B,f;this.isXAxis&&void 0===this.minRange&&!this.isLog&&(y(a.min)||y(a.max)?this.minRange=null:(e(this.series,function(a){u=a.xData;for(p=B=a.xIncrement?1:u.length-1;0<p;p--)if(l=u[p]-u[p-1],void 0===n||l<n)n=l}),this.minRange=Math.min(5*n,this.dataMax-this.dataMin)));d-b<this.minRange&&(k=this.dataMax-this.dataMin>=this.minRange,f=this.minRange,c=(f-d+b)/2,c=[b-c,I(a.min,b-c)],k&&(c[2]=this.isLog?this.log2lin(this.dataMin):this.dataMin),b=E(c),d=[b+f,I(a.max,b+f)],k&&(d[2]=this.isLog?this.log2lin(this.dataMax):this.dataMax),d=m(d),d-b<f&&(c[0]=d-f,c[1]=I(a.min,d-f),b=E(c)));this.min=b;this.max=d},getClosest:function(){var a;this.categories?a=1:e(this.series,function(g){var b=g.closestPointRange,d=g.visible||!g.chart.options.chart.ignoreHiddenSeries;!g.noSharedTooltip&&y(b)&&d&&(a=y(a)?Math.min(a,b):b)});return a},nameToX:function(a){var g=u(this.categories),d=g?this.categories:this.names,c=a.options.x,k;a.series.requireSorting=!1;y(c)||(c=!1===this.options.uniqueNames?a.series.autoIncrement():g?b(a.name,d):I(d.keys[a.name],-1));-1===c?g||(k=d.length):k=c;void 0!==k&&(this.names[k]=a.name,this.names.keys[a.name]=k);return k},updateNames:function(){var b=this,d=this.names;0<d.length&&(e(a.keys(d.keys),function(a){delete d.keys[a]}),d.length=0,this.minRange=this.userMinRange,e(this.series||[],function(a){a.xIncrement=null;if(!a.points||a.isDirtyData)a.processData(),a.generatePoints();e(a.points,function(g,d){var c;g.options&&(c=b.nameToX(g),void 0!==c&&c!==g.x&&(g.x=c,a.xData[d]=c))})}))},setAxisTranslation:function(a){var b=this,g=b.max-b.min,d=b.axisPointRange||0,c,k=0,n=0,p=b.linkedParent,u=!!b.categories,f=b.transA,B=b.isXAxis;if(B||u||d)c=b.getClosest(),p?(k=p.minPointOffset,n=p.pointRangePadding):e(b.series,function(a){var g=u?1:B?I(a.options.pointRange,c,0):b.axisPointRange||0;a=a.options.pointPlacement;d=Math.max(d,g);b.single||(k=Math.max(k,H(a)?0:g/2),n=Math.max(n,"on"===a?0:g))}),p=b.ordinalSlope&&c?b.ordinalSlope/c:1,b.minPointOffset=k*=p,b.pointRangePadding=n*=p,b.pointRange=Math.min(d,g),B&&(b.closestPointRange=c);a&&(b.oldTransA=f);b.translationSlope=b.transA=f=b.options.staticScale||b.len/(g+n||1);b.transB=b.horiz?b.left:b.bottom;b.minPixelPadding=f*k;l(this,"afterSetAxisTranslation")},minFromRange:function(){return this.max-this.range},setTickInterval:function(b){var g=this,d=g.chart,c=g.options,n=g.isLog,u=g.isDatetimeAxis,B=g.isXAxis,t=g.isLinked,h=c.maxPadding,G=c.minPadding,x=c.tickInterval,z=c.tickPixelInterval,F=g.categories,H=p(g.threshold)?g.threshold:null,w=g.softThreshold,q,M,m,r;u||F||t||this.getTickAmount();m=I(g.userMin,c.min);r=I(g.userMax,c.max);t?(g.linkedParent=d[g.coll][c.linkedTo],d=g.linkedParent.getExtremes(),g.min=I(d.min,d.dataMin),g.max=I(d.max,d.dataMax),c.type!==g.linkedParent.options.type&&a.error(11,1)):(!w&&y(H)&&(g.dataMin>=H?(q=H,G=0):g.dataMax<=H&&(M=H,h=0)),g.min=I(m,q,g.dataMin),g.max=I(r,M,g.dataMax));n&&(g.positiveValuesOnly&&!b&&0>=Math.min(g.min,I(g.dataMin,g.min))&&a.error(10,1),g.min=f(g.log2lin(g.min),15),g.max=f(g.log2lin(g.max),15));g.range&&y(g.max)&&(g.userMin=g.min=m=Math.max(g.dataMin,g.minFromRange()),g.userMax=r=g.max,g.range=null);l(g,"foundExtremes");g.beforePadding&&g.beforePadding();g.adjustForMinRange();!(F||g.axisPointRange||g.usePercentage||t)&&y(g.min)&&y(g.max)&&(d=g.max-g.min)&&(!y(m)&&G&&(g.min-=d*G),!y(r)&&h&&(g.max+=d*h));p(c.softMin)&&!p(g.userMin)&&(g.min=Math.min(g.min,c.softMin));p(c.softMax)&&!p(g.userMax)&&(g.max=Math.max(g.max,c.softMax));p(c.floor)&&(g.min=Math.max(g.min,c.floor));p(c.ceiling)&&(g.max=Math.min(g.max,c.ceiling));w&&y(g.dataMin)&&(H=H||0,!y(m)&&g.min<H&&g.dataMin>=H?g.min=H:!y(r)&&g.max>H&&g.dataMax<=H&&(g.max=H));g.tickInterval=g.min===g.max||void 0===g.min||void 0===g.max?1:t&&!x&&z===g.linkedParent.options.tickPixelInterval?x=g.linkedParent.tickInterval:I(x,this.tickAmount?(g.max-g.min)/Math.max(this.tickAmount-1,1):void 0,F?1:(g.max-g.min)*z/Math.max(g.len,z));B&&!b&&e(g.series,function(a){a.processData(g.min!==g.oldMin||g.max!==g.oldMax)});g.setAxisTranslation(!0);g.beforeSetTickPositions&&g.beforeSetTickPositions();g.postProcessTickInterval&&(g.tickInterval=g.postProcessTickInterval(g.tickInterval));g.pointRange&&!x&&(g.tickInterval=Math.max(g.pointRange,g.tickInterval));b=I(c.minTickInterval,g.isDatetimeAxis&&g.closestPointRange);!x&&g.tickInterval<b&&(g.tickInterval=b);u||n||x||(g.tickInterval=L(g.tickInterval,null,k(g.tickInterval),I(c.allowDecimals,!(.5<g.tickInterval&&5>g.tickInterval&&1e3<g.max&&9999>g.max)),!!this.tickAmount));this.tickAmount||(g.tickInterval=g.unsquish());this.setTickPositions()},setTickPositions:function(){var a=this.options,b,d=a.tickPositions;b=this.getMinorTickInterval();var c=a.tickPositioner,k=a.startOnTick,n=a.endOnTick;this.tickmarkOffset=this.categories&&"between"===a.tickmarkPlacement&&1===this.tickInterval?.5:0;this.minorTickInterval="auto"===b&&this.tickInterval?this.tickInterval/5:b;this.single=this.min===this.max&&y(this.min)&&!this.tickAmount&&(parseInt(this.min,10)===this.min||!1!==a.allowDecimals);this.tickPositions=b=d&&d.slice();!b&&(b=this.isDatetimeAxis?this.getTimeTicks(this.normalizeTimeTickInterval(this.tickInterval,a.units),this.min,this.max,a.startOfWeek,this.ordinalPositions,this.closestPointRange,!0):this.isLog?this.getLogTickPositions(this.tickInterval,this.min,this.max):this.getLinearTickPositions(this.tickInterval,this.min,this.max),b.length>this.len&&(b=[b[0],b.pop()],b[0]===b[1]&&(b.length=1)),this.tickPositions=b,c&&(c=c.apply(this,[this.min,this.max])))&&(this.tickPositions=b=c);this.paddedTicks=b.slice(0);this.trimTicks(b,k,n);this.isLinked||(this.single&&2>b.length&&(this.min-=.5,this.max+=.5),d||c||this.adjustTickAmount());l(this,"afterSetTickPositions")},trimTicks:function(a,b,d){var g=a[0],c=a[a.length-1],k=this.minPointOffset||0;if(!this.isLinked){if(b&&-Infinity!==g)this.min=g;else for(;this.min-k>a[0];)a.shift();if(d)this.max=c;else for(;this.max+k<a[a.length-1];)a.pop();0===a.length&&y(g)&&!this.options.tickPositions&&a.push((c+g)/2)}},alignToOthers:function(){var a={},b,d=this.options;!1===this.chart.options.chart.alignTicks||!1===d.alignTicks||!1===d.startOnTick||!1===d.endOnTick||this.isLog||e(this.chart[this.coll],function(g){var d=g.options,d=[g.horiz?d.left:d.top,d.width,d.height,d.pane].join();g.series.length&&(a[d]?b=!0:a[d]=1)});return b},getTickAmount:function(){var a=this.options,b=a.tickAmount,d=a.tickPixelInterval;!y(a.tickInterval)&&this.len<d&&!this.isRadial&&!this.isLog&&a.startOnTick&&a.endOnTick&&(b=2);!b&&this.alignToOthers()&&(b=Math.ceil(this.len/d)+1);4>b&&(this.finalTickAmt=b,b=5);this.tickAmount=b},adjustTickAmount:function(){var a=this.tickInterval,b=this.tickPositions,d=this.tickAmount,c=this.finalTickAmt,k=b&&b.length,n=I(this.threshold,this.softThreshold?0:null);if(this.hasData()){if(k<d){for(;b.length<d;)b.length%2||this.min===n?b.push(f(b[b.length-1]+a)):b.unshift(f(b[0]-a));this.transA*=(k-1)/(d-1);this.min=b[0];this.max=b[b.length-1]}else k>d&&(this.tickInterval*=2,this.setTickPositions());if(y(c)){for(a=d=b.length;a--;)(3===c&&1===a%2||2>=c&&0<a&&a<d-1)&&b.splice(a,1);this.finalTickAmt=void 0}}},setScale:function(){var a,b;this.oldMin=this.min;this.oldMax=this.max;this.oldAxisLength=this.len;this.setAxisSize();b=this.len!==this.oldAxisLength;e(this.series,function(b){if(b.isDirtyData||b.isDirty||b.xAxis.isDirty)a=!0});b||a||this.isLinked||this.forceRedraw||this.userMin!==this.oldUserMin||this.userMax!==this.oldUserMax||this.alignToOthers()?(this.resetStacks&&this.resetStacks(),this.forceRedraw=!1,this.getSeriesExtremes(),this.setTickInterval(),this.oldUserMin=this.userMin,this.oldUserMax=this.userMax,this.isDirty||(this.isDirty=b||this.min!==this.oldMin||this.max!==this.oldMax)):this.cleanStacks&&this.cleanStacks();l(this,"afterSetScale")},setExtremes:function(a,b,d,k,n){var g=this,p=g.chart;d=I(d,!0);e(g.series,function(a){delete a.kdTree});n=c(n,{min:a,max:b});l(g,"setExtremes",n,function(){g.userMin=a;g.userMax=b;g.eventArgs=n;d&&p.redraw(k)})},zoom:function(a,b){var g=this.dataMin,d=this.dataMax,c=this.options,k=Math.min(g,I(c.min,g)),c=Math.max(d,I(c.max,d));if(a!==this.min||b!==this.max)this.allowZoomOutside||(y(g)&&(a<k&&(a=k),a>c&&(a=c)),y(d)&&(b<k&&(b=k),b>c&&(b=c))),this.displayBtn=void 0!==a||void 0!==b,this.setExtremes(a,b,!1,void 0,{trigger:"zoom"});return!0},setAxisSize:function(){var b=this.chart,d=this.options,c=d.offsets||[0,0,0,0],k=this.horiz,n=this.width=Math.round(a.relativeLength(I(d.width,b.plotWidth-c[3]+c[1]),b.plotWidth)),e=this.height=Math.round(a.relativeLength(I(d.height,b.plotHeight-c[0]+c[2]),b.plotHeight)),p=this.top=Math.round(a.relativeLength(I(d.top,b.plotTop+c[0]),b.plotHeight,b.plotTop)),d=this.left=Math.round(a.relativeLength(I(d.left,b.plotLeft+c[3]),b.plotWidth,b.plotLeft));this.bottom=b.chartHeight-e-p;this.right=b.chartWidth-n-d;this.len=Math.max(k?n:e,0);this.pos=k?d:p},getExtremes:function(){var a=this.isLog;return{min:a?f(this.lin2log(this.min)):this.min,max:a?f(this.lin2log(this.max)):this.max,dataMin:this.dataMin,dataMax:this.dataMax,userMin:this.userMin,userMax:this.userMax}},getThreshold:function(a){var b=this.isLog,g=b?this.lin2log(this.min):this.min,b=b?this.lin2log(this.max):this.max;null===a||-Infinity===a?a=g:Infinity===a?a=b:g>a?a=g:b<a&&(a=b);return this.translate(a,0,1,0,1)},autoLabelAlign:function(a){a=(I(a,0)-90*this.side+720)%360;return 15<a&&165>a?"right":195<a&&345>a?"left":"center"},tickSize:function(a){var b=this.options,g=b[a+"Length"],d=I(b[a+"Width"],"tick"===a&&this.isXAxis?1:0);if(d&&g)return"inside"===b[a+"Position"]&&(g=-g),[g,d]},labelMetrics:function(){var a=this.tickPositions&&this.tickPositions[0]||0;return this.chart.renderer.fontMetrics(this.options.labels.style&&this.options.labels.style.fontSize,this.ticks[a]&&this.ticks[a].label)},unsquish:function(){var a=this.options.labels,b=this.horiz,d=this.tickInterval,c=d,k=this.len/(((this.categories?1:0)+this.max-this.min)/d),n,p=a.rotation,l=this.labelMetrics(),u,B=Number.MAX_VALUE,t,h=function(a){a/=k||1;a=1<a?Math.ceil(a):1;return f(a*d)};b?(t=!a.staggerLines&&!a.step&&(y(p)?[p]:k<I(a.autoRotationLimit,80)&&a.autoRotation))&&e(t,function(a){var b;if(a===p||a&&-90<=a&&90>=a)u=h(Math.abs(l.h/Math.sin(q*a))),b=u+Math.abs(a/360),b<B&&(B=b,n=a,c=u)}):a.step||(c=h(l.h));this.autoRotation=t;this.labelRotation=I(n,p);return c},getSlotWidth:function(){var a=this.chart,b=this.horiz,d=this.options.labels,c=Math.max(this.tickPositions.length-(this.categories?0:1),1),k=a.margin[3];return b&&2>(d.step||0)&&!d.rotation&&(this.staggerLines||1)*this.len/c||!b&&(d.style&&parseInt(d.style.width,10)||k&&k-a.spacing[3]||.33*a.chartWidth)},renderUnsquish:function(){var a=this.chart,b=a.renderer,d=this.tickPositions,c=this.ticks,k=this.options.labels,n=k&&k.style||{},p=this.horiz,l=this.getSlotWidth(),u=Math.max(1,Math.round(l-2*(k.padding||5))),B={},f=this.labelMetrics(),t=k.style&&k.style.textOverflow,h,G,x=0,z;H(k.rotation)||(B.rotation=k.rotation||0);e(d,function(a){(a=c[a])&&a.label&&a.label.textPxLength>x&&(x=a.label.textPxLength)});this.maxLabelLength=x;if(this.autoRotation)x>u&&x>f.h?B.rotation=this.labelRotation:this.labelRotation=0;else if(l&&(h=u,!t))for(G="clip",u=d.length;!p&&u--;)if(z=d[u],z=c[z].label)z.styles&&"ellipsis"===z.styles.textOverflow?z.css({textOverflow:"clip"}):z.textPxLength>l&&z.css({width:l+"px"}),z.getBBox().height>this.len/d.length-(f.h-f.f)&&(z.specificTextOverflow="ellipsis");B.rotation&&(h=x>.5*a.chartHeight?.33*a.chartHeight:x,t||(G="ellipsis"));if(this.labelAlign=k.align||this.autoLabelAlign(this.labelRotation))B.align=this.labelAlign;e(d,function(a){var b=(a=c[a])&&a.label,g=n.width,d={};b&&(b.attr(B),h&&!g&&"nowrap"!==n.whiteSpace&&(h<b.textPxLength||"SPAN"===b.element.tagName)?(d.width=h,t||(d.textOverflow=b.specificTextOverflow||G),b.css(d)):b.styles&&b.styles.width&&!d.width&&!g&&b.css({width:null}),delete b.specificTextOverflow,a.rotation=B.rotation)});this.tickRotCorr=b.rotCorr(f.b,this.labelRotation||0,0!==this.side)},hasData:function(){return this.hasVisibleSeries||y(this.min)&&y(this.max)&&this.tickPositions&&0<this.tickPositions.length},addTitle:function(a){var b=this.chart.renderer,g=this.horiz,d=this.opposite,c=this.options.title,k;this.axisTitle||((k=c.textAlign)||(k=(g?{low:"left",middle:"center",high:"right"}:{low:d?"right":"left",middle:"center",high:d?"left":"right"})[c.align]),this.axisTitle=b.text(c.text,0,0,c.useHTML).attr({zIndex:7,rotation:c.rotation||0,align:k}).addClass("highcharts-axis-title").css(t(c.style)).add(this.axisGroup),this.axisTitle.isNew=!0);c.style.width||this.isRadial||this.axisTitle.css({width:this.len});this.axisTitle[a?"show":"hide"](!0)},generateTick:function(a){var b=this.ticks;b[a]?b[a].addLabel():b[a]=new M(this,a)},getOffset:function(){var a=this,b=a.chart,d=b.renderer,c=a.options,k=a.tickPositions,n=a.ticks,p=a.horiz,u=a.side,B=b.inverted&&!a.isZAxis?[1,0,3,2][u]:u,f,t,h=0,G,z=0,H=c.title,F=c.labels,w=0,q=b.axisOffset,b=b.clipOffset,m=[-1,1,1,-1][u],M=c.className,r=a.axisParent,L=this.tickSize("tick");f=a.hasData();a.showAxis=t=f||I(c.showEmpty,!0);a.staggerLines=a.horiz&&F.staggerLines;a.axisGroup||(a.gridGroup=d.g("grid").attr({zIndex:c.gridZIndex||1}).addClass("highcharts-"+this.coll.toLowerCase()+"-grid "+(M||"")).add(r),a.axisGroup=d.g("axis").attr({zIndex:c.zIndex||2}).addClass("highcharts-"+this.coll.toLowerCase()+" "+(M||"")).add(r),a.labelGroup=d.g("axis-labels").attr({zIndex:F.zIndex||7}).addClass("highcharts-"+a.coll.toLowerCase()+"-labels "+(M||"")).add(r));f||a.isLinked?(e(k,function(b,g){a.generateTick(b,g)}),a.renderUnsquish(),a.reserveSpaceDefault=0===u||2===u||{1:"left",3:"right"}[u]===a.labelAlign,I(F.reserveSpace,"center"===a.labelAlign?!0:null,a.reserveSpaceDefault)&&e(k,function(a){w=Math.max(n[a].getLabelSize(),w)}),a.staggerLines&&(w*=a.staggerLines),a.labelOffset=w*(a.opposite?-1:1)):x(n,function(a,b){a.destroy();delete n[b]});H&&H.text&&!1!==H.enabled&&(a.addTitle(t),t&&!1!==H.reserveSpace&&(a.titleOffset=h=a.axisTitle.getBBox()[p?"height":"width"],G=H.offset,z=y(G)?0:I(H.margin,p?5:10)));a.renderLine();a.offset=m*I(c.offset,q[u]);a.tickRotCorr=a.tickRotCorr||{x:0,y:0};d=0===u?-a.labelMetrics().h:2===u?a.tickRotCorr.y:0;z=Math.abs(w)+z;w&&(z=z-d+m*(p?I(F.y,a.tickRotCorr.y+8*m):F.x));a.axisTitleMargin=I(G,z);q[u]=Math.max(q[u],a.axisTitleMargin+h+m*a.offset,z,f&&k.length&&L?L[0]+m*a.offset:0);c=c.offset?0:2*Math.floor(a.axisLine.strokeWidth()/2);b[B]=Math.max(b[B],c);l(this,"afterGetOffset")},getLinePath:function(a){var b=this.chart,g=this.opposite,d=this.offset,c=this.horiz,k=this.left+(g?this.width:0)+d,d=b.chartHeight-this.bottom-(g?this.height:0)+d;g&&(a*=-1);return b.renderer.crispLine(["M",c?this.left:k,c?d:this.top,"L",c?b.chartWidth-this.right:k,c?d:b.chartHeight-this.bottom],a)},renderLine:function(){this.axisLine||(this.axisLine=this.chart.renderer.path().addClass("highcharts-axis-line").add(this.axisGroup),this.axisLine.attr({stroke:this.options.lineColor,"stroke-width":this.options.lineWidth,zIndex:7}))},getTitlePosition:function(){var a=this.horiz,b=this.left,d=this.top,c=this.len,k=this.options.title,n=a?b:d,e=this.opposite,p=this.offset,l=k.x||0,u=k.y||0,B=this.axisTitle,f=this.chart.renderer.fontMetrics(k.style&&k.style.fontSize,B),B=Math.max(B.getBBox(null,0).height-f.h-1,0),c={low:n+(a?0:c),middle:n+c/2,high:n+(a?c:0)}[k.align],b=(a?d+this.height:b)+(a?1:-1)*(e?-1:1)*this.axisTitleMargin+[-B,B,f.f,-B][this.side];return{x:a?c+l:b+(e?this.width:0)+p+l,y:a?b+u-(e?this.height:0)+p:c+u}},renderMinorTick:function(a){var b=this.chart.hasRendered&&p(this.oldMin),d=this.minorTicks;d[a]||(d[a]=new M(this,a,"minor"));b&&d[a].isNew&&d[a].render(null,!0);d[a].render(null,!1,1)},renderTick:function(a,b){var d=this.isLinked,g=this.ticks,c=this.chart.hasRendered&&p(this.oldMin);if(!d||a>=this.min&&a<=this.max)g[a]||(g[a]=new M(this,a)),c&&g[a].isNew&&g[a].render(b,!0,.1),g[a].render(b)},render:function(){var b=this,d=b.chart,c=b.options,k=b.isLog,n=b.isLinked,u=b.tickPositions,f=b.axisTitle,t=b.ticks,h=b.minorTicks,G=b.alternateBands,z=c.stackLabels,H=c.alternateGridColor,F=b.tickmarkOffset,w=b.axisLine,I=b.showAxis,m=D(d.renderer.globalAnimation),q,r;b.labelEdge.length=0;b.overlap=!1;e([t,h,G],function(a){x(a,function(a){a.isActive=!1})});if(b.hasData()||n)b.minorTickInterval&&!b.categories&&e(b.getMinorTickPositions(),function(a){b.renderMinorTick(a)}),u.length&&(e(u,function(a,d){b.renderTick(a,d)}),F&&(0===b.min||b.single)&&(t[-1]||(t[-1]=new M(b,-1,null,!0)),t[-1].render(-1))),H&&e(u,function(c,g){r=void 0!==u[g+1]?u[g+1]+F:b.max-F;0===g%2&&c<b.max&&r<=b.max+(d.polar?-F:F)&&(G[c]||(G[c]=new a.PlotLineOrBand(b)),q=c+F,G[c].options={from:k?b.lin2log(q):q,to:k?b.lin2log(r):r,color:H},G[c].render(),G[c].isActive=!0)}),b._addedPlotLB||(e((c.plotLines||[]).concat(c.plotBands||[]),function(a){b.addPlotBandOrLine(a)}),b._addedPlotLB=!0);e([t,h,G],function(a){var b,c=[],g=m.duration;x(a,function(a,b){a.isActive||(a.render(b,!1,0),a.isActive=!1,c.push(b))});B(function(){for(b=c.length;b--;)a[c[b]]&&!a[c[b]].isActive&&(a[c[b]].destroy(),delete a[c[b]])},a!==G&&d.hasRendered&&g?g:0)});w&&(w[w.isPlaced?"animate":"attr"]({d:this.getLinePath(w.strokeWidth())}),w.isPlaced=!0,w[I?"show":"hide"](!0));f&&I&&(c=b.getTitlePosition(),p(c.y)?(f[f.isNew?"attr":"animate"](c),f.isNew=!1):(f.attr("y",-9999),f.isNew=!0));z&&z.enabled&&b.renderStackTotals();b.isDirty=!1;l(this,"afterRender")},redraw:function(){this.visible&&(this.render(),e(this.plotLinesAndBands,function(a){a.render()}));e(this.series,function(a){a.isDirty=!0})},keepProps:"extKey hcEvents names series userMax userMin".split(" "),destroy:function(a){var d=this,c=d.stacks,g=d.plotLinesAndBands,k;l(this,"destroy",{keepEvents:a});a||n(d);x(c,function(a,b){w(a);c[b]=null});e([d.ticks,d.minorTicks,d.alternateBands],function(a){w(a)});if(g)for(a=g.length;a--;)g[a].destroy();e("stackTotalGroup axisLine axisTitle axisGroup gridGroup labelGroup cross scrollbar".split(" "),function(a){d[a]&&(d[a]=d[a].destroy())});for(k in d.plotLinesAndBandsGroups)d.plotLinesAndBandsGroups[k]=d.plotLinesAndBandsGroups[k].destroy();x(d,function(a,c){-1===b(c,d.keepProps)&&delete d[c]})},drawCrosshair:function(a,b){var d,c=this.crosshair,g=I(c.snap,!0),k,n=this.cross;l(this,"drawCrosshair",{e:a,point:b});a||(a=this.cross&&this.cross.e);if(this.crosshair&&!1!==(y(b)||!g)){g?y(b)&&(k=I(b.crosshairPos,this.isXAxis?b.plotX:this.len-b.plotY)):k=a&&(this.horiz?a.chartX-this.pos:this.len-a.chartY+this.pos);y(k)&&(d=this.getPlotLinePath(b&&(this.isXAxis?b.x:I(b.stackY,b.y)),null,null,null,k)||null);if(!y(d)){this.hideCrosshair();return}g=this.categories&&!this.isRadial;n||(this.cross=n=this.chart.renderer.path().addClass("highcharts-crosshair highcharts-crosshair-"+(g?"category ":"thin ")+c.className).attr({zIndex:I(c.zIndex,2)}).add(),n.attr({stroke:c.color||(g?h("#ccd6eb").setOpacity(.25).get():"#cccccc"),"stroke-width":I(c.width,1)}).css({"pointer-events":"none"}),c.dashStyle&&n.attr({dashstyle:c.dashStyle}));n.show().attr({d:d});g&&!c.width&&n.attr({"stroke-width":this.transA});this.cross.e=a}else this.hideCrosshair();l(this,"afterDrawCrosshair",{e:a,point:b})},hideCrosshair:function(){this.cross&&this.cross.hide()}});return a.Axis=F}(K);(function(a){var C=a.Axis,D=a.getMagnitude,E=a.normalizeTickInterval,m=a.timeUnits;C.prototype.getTimeTicks=function(){return this.chart.time.getTimeTicks.apply(this.chart.time,arguments)};C.prototype.normalizeTimeTickInterval=function(a,f){var h=f||[["millisecond",[1,2,5,10,20,25,50,100,200,500]],["second",[1,2,5,10,15,30]],["minute",[1,2,5,10,15,30]],["hour",[1,2,3,4,6,8,12]],["day",[1,2]],["week",[1,2]],["month",[1,2,3,4,6]],["year",null]];f=h[h.length-1];var y=m[f[0]],q=f[1],w;for(w=0;w<h.length&&!(f=h[w],y=m[f[0]],q=f[1],h[w+1]&&a<=(y*q[q.length-1]+m[h[w+1][0]])/2);w++);y===m.year&&a<5*y&&(q=[1,2,5]);a=E(a/y,q,"year"===f[0]?Math.max(D(a/y),1):1);return{unitRange:y,count:a,unitName:f[0]}}})(K);(function(a){var C=a.Axis,D=a.getMagnitude,E=a.map,m=a.normalizeTickInterval,h=a.pick;C.prototype.getLogTickPositions=function(a,r,y,q){var f=this.options,e=this.len,c=[];q||(this._minorAutoInterval=null);if(.5<=a)a=Math.round(a),c=this.getLinearTickPositions(a,r,y);else if(.08<=a)for(var e=Math.floor(r),l,z,k,d,b,f=.3<a?[1,2,4]:.15<a?[1,2,4,6,8]:[1,2,3,4,5,6,7,8,9];e<y+1&&!b;e++)for(z=f.length,l=0;l<z&&!b;l++)k=this.log2lin(this.lin2log(e)*f[l]),k>r&&(!q||d<=y)&&void 0!==d&&c.push(d),d>y&&(b=!0),d=k;else r=this.lin2log(r),y=this.lin2log(y),a=q?this.getMinorTickInterval():f.tickInterval,a=h("auto"===a?null:a,this._minorAutoInterval,f.tickPixelInterval/(q?5:1)*(y-r)/((q?e/this.tickPositions.length:e)||1)),a=m(a,null,D(a)),c=E(this.getLinearTickPositions(a,r,y),this.log2lin),q||(this._minorAutoInterval=a/5);q||(this.tickInterval=a);return c};C.prototype.log2lin=function(a){return Math.log(a)/Math.LN10};C.prototype.lin2log=function(a){return Math.pow(10,a)}})(K);(function(a,C){var D=a.arrayMax,E=a.arrayMin,m=a.defined,h=a.destroyObjectProperties,f=a.each,r=a.erase,y=a.merge,q=a.pick;a.PlotLineOrBand=function(a,e){this.axis=a;e&&(this.options=e,this.id=e.id)};a.PlotLineOrBand.prototype={render:function(){var f=this,e=f.axis,c=e.horiz,l=f.options,h=l.label,k=f.label,d=l.to,b=l.from,u=l.value,p=m(b)&&m(d),H=m(u),t=f.svgElem,r=!t,x=[],I=l.color,n=q(l.zIndex,0),G=l.events,x={class:"highcharts-plot-"+(p?"band ":"line ")+(l.className||"")},B={},M=e.chart.renderer,F=p?"bands":"lines";e.isLog&&(b=e.log2lin(b),d=e.log2lin(d),u=e.log2lin(u));H?(x.stroke=I,x["stroke-width"]=l.width,l.dashStyle&&(x.dashstyle=l.dashStyle)):p&&(I&&(x.fill=I),l.borderWidth&&(x.stroke=l.borderColor,x["stroke-width"]=l.borderWidth));B.zIndex=n;F+="-"+n;(I=e.plotLinesAndBandsGroups[F])||(e.plotLinesAndBandsGroups[F]=I=M.g("plot-"+F).attr(B).add());r&&(f.svgElem=t=M.path().attr(x).add(I));if(H)x=e.getPlotLinePath(u,t.strokeWidth());else if(p)x=e.getPlotBandPath(b,d,l);else return;r&&x&&x.length?(t.attr({d:x}),G&&a.objectEach(G,function(a,b){t.on(b,function(a){G[b].apply(f,[a])})})):t&&(x?(t.show(),t.animate({d:x})):(t.hide(),k&&(f.label=k=k.destroy())));h&&m(h.text)&&x&&x.length&&0<e.width&&0<e.height&&!x.isFlat?(h=y({align:c&&p&&"center",x:c?!p&&4:10,verticalAlign:!c&&p&&"middle",y:c?p?16:10:p?6:-4,rotation:c&&!p&&90},h),this.renderLabel(h,x,p,n)):k&&k.hide();return f},renderLabel:function(a,e,c,l){var f=this.label,k=this.axis.chart.renderer;f||(f={align:a.textAlign||a.align,rotation:a.rotation,class:"highcharts-plot-"+(c?"band":"line")+"-label "+(a.className||"")},f.zIndex=l,this.label=f=k.text(a.text,0,0,a.useHTML).attr(f).add(),f.css(a.style));l=e.xBounds||[e[1],e[4],c?e[6]:e[1]];e=e.yBounds||[e[2],e[5],c?e[7]:e[2]];c=E(l);k=E(e);f.align(a,!1,{x:c,y:k,width:D(l)-c,height:D(e)-k});f.show()},destroy:function(){r(this.axis.plotLinesAndBands,this);delete this.axis;h(this)}};a.extend(C.prototype,{getPlotBandPath:function(a,e){var c=this.getPlotLinePath(e,null,null,!0),l=this.getPlotLinePath(a,null,null,!0),f=[],k=this.horiz,d=1,b;a=a<this.min&&e<this.min||a>this.max&&e>this.max;if(l&&c)for(a&&(b=l.toString()===c.toString(),d=0),a=0;a<l.length;a+=6)k&&c[a+1]===l[a+1]?(c[a+1]+=d,c[a+4]+=d):k||c[a+2]!==l[a+2]||(c[a+2]+=d,c[a+5]+=d),f.push("M",l[a+1],l[a+2],"L",l[a+4],l[a+5],c[a+4],c[a+5],c[a+1],c[a+2],"z"),f.isFlat=b;return f},addPlotBand:function(a){return this.addPlotBandOrLine(a,"plotBands")},addPlotLine:function(a){return this.addPlotBandOrLine(a,"plotLines")},addPlotBandOrLine:function(f,e){var c=new a.PlotLineOrBand(this,f).render(),l=this.userOptions;c&&(e&&(l[e]=l[e]||[],l[e].push(f)),this.plotLinesAndBands.push(c));return c},removePlotBandOrLine:function(a){for(var e=this.plotLinesAndBands,c=this.options,l=this.userOptions,h=e.length;h--;)e[h].id===a&&e[h].destroy();f([c.plotLines||[],l.plotLines||[],c.plotBands||[],l.plotBands||[]],function(c){for(h=c.length;h--;)c[h].id===a&&r(c,c[h])})},removePlotBand:function(a){this.removePlotBandOrLine(a)},removePlotLine:function(a){this.removePlotBandOrLine(a)}})})(K,V);(function(a){var C=a.doc,D=a.each,E=a.extend,m=a.format,h=a.isNumber,f=a.map,r=a.merge,y=a.pick,q=a.splat,w=a.syncTimeout,e=a.timeUnits;a.Tooltip=function(){this.init.apply(this,arguments)};a.Tooltip.prototype={init:function(a,e){this.chart=a;this.options=e;this.crosshairs=[];this.now={x:0,y:0};this.isHidden=!0;this.split=e.split&&!a.inverted;this.shared=e.shared||this.split;this.outside=e.outside&&!this.split},cleanSplit:function(a){D(this.chart.series,function(c){var e=c&&c.tt;e&&(!e.isActive||a?c.tt=e.destroy():e.isActive=!1)})},getLabel:function(){var c=this.chart.renderer,e=this.options,f;this.label||(this.outside&&(this.container=f=a.doc.createElement("div"),f.className="highcharts-tooltip-container",a.css(f,{position:"absolute",top:"1px",pointerEvents:e.style&&e.style.pointerEvents}),a.doc.body.appendChild(f),this.renderer=c=new a.Renderer(f,0,0)),this.split?this.label=c.g("tooltip"):(this.label=c.label("",0,0,e.shape||"callout",null,null,e.useHTML,null,"tooltip").attr({padding:e.padding,r:e.borderRadius}),this.label.attr({fill:e.backgroundColor,"stroke-width":e.borderWidth}).css(e.style).shadow(e.shadow)),this.outside&&(this.label.attr({x:this.distance,y:this.distance}),this.label.xSetter=function(a){f.style.left=a+"px"},this.label.ySetter=function(a){f.style.top=a+"px"}),this.label.attr({zIndex:8}).add());return this.label},update:function(a){this.destroy();r(!0,this.chart.options.tooltip.userOptions,a);this.init(this.chart,r(!0,this.options,a))},destroy:function(){this.label&&(this.label=this.label.destroy());this.split&&this.tt&&(this.cleanSplit(this.chart,!0),this.tt=this.tt.destroy());this.renderer&&(this.renderer=this.renderer.destroy(),a.discardElement(this.container));a.clearTimeout(this.hideTimer);a.clearTimeout(this.tooltipTimeout)},move:function(c,e,f,k){var d=this,b=d.now,u=!1!==d.options.animation&&!d.isHidden&&(1<Math.abs(c-b.x)||1<Math.abs(e-b.y)),p=d.followPointer||1<d.len;E(b,{x:u?(2*b.x+c)/3:c,y:u?(b.y+e)/2:e,anchorX:p?void 0:u?(2*b.anchorX+f)/3:f,anchorY:p?void 0:u?(b.anchorY+k)/2:k});d.getLabel().attr(b);u&&(a.clearTimeout(this.tooltipTimeout),this.tooltipTimeout=setTimeout(function(){d&&d.move(c,e,f,k)},32))},hide:function(c){var e=this;a.clearTimeout(this.hideTimer);c=y(c,this.options.hideDelay,500);this.isHidden||(this.hideTimer=w(function(){e.getLabel()[c?"fadeOut":"hide"]();e.isHidden=!0},c))},getAnchor:function(a,e){var c=this.chart,k=c.pointer,d=c.inverted,b=c.plotTop,u=c.plotLeft,p=0,l=0,t,h;a=q(a);this.followPointer&&e||k.followTouchMove&&e&&"touchmove"===e.type?(void 0===e.chartX&&(e=k.normalize(e)),a=[e.chartX-c.plotLeft,e.chartY-b]):a[0].tooltipPos?a=a[0].tooltipPos:(D(a,function(a){t=a.series.yAxis;h=a.series.xAxis;p+=a.plotX+(!d&&h?h.left-u:0);l+=(a.plotLow?(a.plotLow+a.plotHigh)/2:a.plotY)+(!d&&t?t.top-b:0)}),p/=a.length,l/=a.length,a=[d?c.plotWidth-l:p,this.shared&&!d&&1<a.length&&e?e.chartY-b:d?c.plotHeight-p:l]);return f(a,Math.round)},getPosition:function(a,e,f){var c=this.chart,d=this.distance,b={},u=c.inverted&&f.h||0,p,l=this.outside,t=l?C.documentElement.clientWidth-2*d:c.chartWidth,h=l?Math.max(C.body.scrollHeight,C.documentElement.scrollHeight,C.body.offsetHeight,C.documentElement.offsetHeight,C.documentElement.clientHeight):c.chartHeight,x=c.pointer.chartPosition,z=["y",h,e,(l?x.top-d:0)+f.plotY+c.plotTop,l?0:c.plotTop,l?h:c.plotTop+c.plotHeight],n=["x",t,a,(l?x.left-d:0)+f.plotX+c.plotLeft,l?0:c.plotLeft,l?t:c.plotLeft+c.plotWidth],G=!this.followPointer&&y(f.ttBelow,!c.inverted===!!f.negative),B=function(a,c,g,k,n,e){var p=g<k-d,f=k+d+g<c,B=k-d-g;k+=d;if(G&&f)b[a]=k;else if(!G&&p)b[a]=B;else if(p)b[a]=Math.min(e-g,0>B-u?B:B-u);else if(f)b[a]=Math.max(n,k+u+g>c?k:k+u);else return!1},q=function(a,c,g,k){var n;k<d||k>c-d?n=!1:b[a]=k<g/2?1:k>c-g/2?c-g-2:k-g/2;return n},F=function(a){var b=z;z=n;n=b;p=a},g=function(){!1!==B.apply(0,z)?!1!==q.apply(0,n)||p||(F(!0),g()):p?b.x=b.y=0:(F(!0),g())};(c.inverted||1<this.len)&&F();g();return b},defaultFormatter:function(a){var c=this.points||q(this),e;e=[a.tooltipFooterHeaderFormatter(c[0])];e=e.concat(a.bodyFormatter(c));e.push(a.tooltipFooterHeaderFormatter(c[0],!0));return e},refresh:function(c,e){var f,k=this.options,d,b=c,u,p={},l=[];f=k.formatter||this.defaultFormatter;var p=this.shared,t;k.enabled&&(a.clearTimeout(this.hideTimer),this.followPointer=q(b)[0].series.tooltipOptions.followPointer,u=this.getAnchor(b,e),e=u[0],d=u[1],!p||b.series&&b.series.noSharedTooltip?p=b.getLabelConfig():(D(b,function(a){a.setState("hover");l.push(a.getLabelConfig())}),p={x:b[0].category,y:b[0].y},p.points=l,b=b[0]),this.len=l.length,p=f.call(p,this),t=b.series,this.distance=y(t.tooltipOptions.distance,16),!1===p?this.hide():(f=this.getLabel(),this.isHidden&&f.attr({opacity:1}).show(),this.split?this.renderSplit(p,q(c)):(k.style.width||f.css({width:this.chart.spacingBox.width}),f.attr({text:p&&p.join?p.join(""):p}),f.removeClass(/highcharts-color-[\d]+/g).addClass("highcharts-color-"+y(b.colorIndex,t.colorIndex)),f.attr({stroke:k.borderColor||b.color||t.color||"#666666"}),this.updatePosition({plotX:e,plotY:d,negative:b.negative,ttBelow:b.ttBelow,h:u[2]||0})),this.isHidden=!1))},renderSplit:function(c,e){var f=this,k=[],d=this.chart,b=d.renderer,u=!0,p=this.options,l=0,t=this.getLabel();a.isString(c)&&(c=[!1,c]);D(c.slice(0,e.length+1),function(a,c){if(!1!==a){c=e[c-1]||{isHeader:!0,plotX:e[0].plotX};var h=c.series||f,n=h.tt,G=c.series||{},B="highcharts-color-"+y(c.colorIndex,G.colorIndex,"none");n||(h.tt=n=b.label(null,null,null,"callout",null,null,p.useHTML).addClass("highcharts-tooltip-box "+B).attr({padding:p.padding,r:p.borderRadius,fill:p.backgroundColor,stroke:p.borderColor||c.color||G.color||"#333333","stroke-width":p.borderWidth}).add(t));n.isActive=!0;n.attr({text:a});n.css(p.style).shadow(p.shadow);a=n.getBBox();G=a.width+n.strokeWidth();c.isHeader?(l=a.height,G=Math.max(0,Math.min(c.plotX+d.plotLeft-G/2,d.chartWidth-G))):G=c.plotX+d.plotLeft-y(p.distance,16)-G;0>G&&(u=!1);a=(c.series&&c.series.yAxis&&c.series.yAxis.pos)+(c.plotY||0);a-=d.plotTop;k.push({target:c.isHeader?d.plotHeight+l:a,rank:c.isHeader?1:0,size:h.tt.getBBox().height+1,point:c,x:G,tt:n})}});this.cleanSplit();a.distribute(k,d.plotHeight+l);D(k,function(a){var b=a.point,c=b.series;a.tt.attr({visibility:void 0===a.pos?"hidden":"inherit",x:u||b.isHeader?a.x:b.plotX+d.plotLeft+y(p.distance,16),y:a.pos+d.plotTop,anchorX:b.isHeader?b.plotX+d.plotLeft:b.plotX+c.xAxis.pos,anchorY:b.isHeader?a.pos+d.plotTop-15:b.plotY+c.yAxis.pos})})},updatePosition:function(a){var c=this.chart,e=this.getLabel(),k=(this.options.positioner||this.getPosition).call(this,e.width,e.height,a),d=a.plotX+c.plotLeft;a=a.plotY+c.plotTop;var b;this.outside&&(b=(this.options.borderWidth||0)+2*this.distance,this.renderer.setSize(e.width+b,e.height+b,!1),d+=c.pointer.chartPosition.left-k.x,a+=c.pointer.chartPosition.top-k.y);this.move(Math.round(k.x),Math.round(k.y||0),d,a)},getDateFormat:function(a,f,h,k){var d=this.chart.time,b=d.dateFormat("%m-%d %H:%M:%S.%L",f),c,p,l={millisecond:15,second:12,minute:9,hour:6,day:3},t="millisecond";for(p in e){if(a===e.week&&+d.dateFormat("%w",f)===h&&"00:00:00.000"===b.substr(6)){p="week";break}if(e[p]>a){p=t;break}if(l[p]&&b.substr(l[p])!=="01-01 00:00:00.000".substr(l[p]))break;"week"!==p&&(t=p)}p&&(c=k[p]);return c},getXDateFormat:function(a,e,f){e=e.dateTimeLabelFormats;var c=f&&f.closestPointRange;return(c?this.getDateFormat(c,a.x,f.options.startOfWeek,e):e.day)||e.year},tooltipFooterHeaderFormatter:function(a,e){e=e?"footer":"header";var c=a.series,k=c.tooltipOptions,d=k.xDateFormat,b=c.xAxis,f=b&&"datetime"===b.options.type&&h(a.key),p=k[e+"Format"];f&&!d&&(d=this.getXDateFormat(a,k,b));f&&d&&D(a.point&&a.point.tooltipDateKeys||["key"],function(a){p=p.replace("{point."+a+"}","{point."+a+":"+d+"}")});return m(p,{point:a,series:c},this.chart.time)},bodyFormatter:function(a){return f(a,function(a){var c=a.series.tooltipOptions;return(c[(a.point.formatPrefix||"point")+"Formatter"]||a.point.tooltipFormatter).call(a.point,c[(a.point.formatPrefix||"point")+"Format"])})}}})(K);(function(a){var C=a.addEvent,D=a.attr,E=a.charts,m=a.color,h=a.css,f=a.defined,r=a.each,y=a.extend,q=a.find,w=a.fireEvent,e=a.isNumber,c=a.isObject,l=a.offset,z=a.pick,k=a.splat,d=a.Tooltip;a.Pointer=function(a,d){this.init(a,d)};a.Pointer.prototype={init:function(a,c){this.options=c;this.chart=a;this.runChartClick=c.chart.events&&!!c.chart.events.click;this.pinchDown=[];this.lastValidTouch={};d&&(a.tooltip=new d(a,c.tooltip),this.followTouchMove=z(c.tooltip.followTouchMove,!0));this.setDOMEvents()},zoomOption:function(a){var b=this.chart,d=b.options.chart,c=d.zoomType||"",b=b.inverted;/touch/.test(a.type)&&(c=z(d.pinchType,c));this.zoomX=a=/x/.test(c);this.zoomY=c=/y/.test(c);this.zoomHor=a&&!b||c&&b;this.zoomVert=c&&!b||a&&b;this.hasZoom=a||c},normalize:function(a,d){var b;b=a.touches?a.touches.length?a.touches.item(0):a.changedTouches[0]:a;d||(this.chartPosition=d=l(this.chart.container));return y(a,{chartX:Math.round(b.pageX-d.left),chartY:Math.round(b.pageY-d.top)})},getCoordinates:function(a){var b={xAxis:[],yAxis:[]};r(this.chart.axes,function(d){b[d.isXAxis?"xAxis":"yAxis"].push({axis:d,value:d.toValue(a[d.horiz?"chartX":"chartY"])})});return b},findNearestKDPoint:function(a,d,k){var b;r(a,function(a){var e=!(a.noSharedTooltip&&d)&&0>a.options.findNearestPointBy.indexOf("y");a=a.searchPoint(k,e);if((e=c(a,!0))&&!(e=!c(b,!0)))var e=b.distX-a.distX,f=b.dist-a.dist,p=(a.series.group&&a.series.group.zIndex)-(b.series.group&&b.series.group.zIndex),e=0<(0!==e&&d?e:0!==f?f:0!==p?p:b.series.index>a.series.index?-1:1);e&&(b=a)});return b},getPointFromEvent:function(a){a=a.target;for(var b;a&&!b;)b=a.point,a=a.parentNode;return b},getChartCoordinatesFromPoint:function(a,d){var b=a.series,c=b.xAxis,b=b.yAxis,k=z(a.clientX,a.plotX),e=a.shapeArgs;if(c&&b)return d?{chartX:c.len+c.pos-k,chartY:b.len+b.pos-a.plotY}:{chartX:k+c.pos,chartY:a.plotY+b.pos};if(e&&e.x&&e.y)return{chartX:e.x,chartY:e.y}},getHoverData:function(b,d,k,e,f,h,l){var p,n=[],u=l&&l.isBoosting;e=!(!e||!b);l=d&&!d.stickyTracking?[d]:a.grep(k,function(a){return a.visible&&!(!f&&a.directTouch)&&z(a.options.enableMouseTracking,!0)&&a.stickyTracking});d=(p=e?b:this.findNearestKDPoint(l,f,h))&&p.series;p&&(f&&!d.noSharedTooltip?(l=a.grep(k,function(a){return a.visible&&!(!f&&a.directTouch)&&z(a.options.enableMouseTracking,!0)&&!a.noSharedTooltip}),r(l,function(a){var b=q(a.points,function(a){return a.x===p.x&&!a.isNull});c(b)&&(u&&(b=a.getPoint(b)),n.push(b))})):n.push(p));return{hoverPoint:p,hoverSeries:d,hoverPoints:n}},runPointActions:function(b,d){var c=this.chart,k=c.tooltip&&c.tooltip.options.enabled?c.tooltip:void 0,e=k?k.shared:!1,f=d||c.hoverPoint,l=f&&f.series||c.hoverSeries,l=this.getHoverData(f,l,c.series,!!d||l&&l.directTouch&&this.isDirectTouch,e,b,{isBoosting:c.isBoosting}),u,f=l.hoverPoint;u=l.hoverPoints;l=l.hoverSeries;d=b&&"touchmove"===b.type?!0===this.followTouchMove:l&&l.tooltipOptions.followPointer;e=e&&l&&!l.noSharedTooltip;if(f&&(f!==c.hoverPoint||k&&k.isHidden)){r(c.hoverPoints||[],function(b){-1===a.inArray(b,u)&&b.setState()});r(u||[],function(a){a.setState("hover")});if(c.hoverSeries!==l)l.onMouseOver();c.hoverPoint&&c.hoverPoint.firePointEvent("mouseOut");if(!f.series)return;f.firePointEvent("mouseOver");c.hoverPoints=u;c.hoverPoint=f;k&&k.refresh(e?u:f,b)}else d&&k&&!k.isHidden&&(f=k.getAnchor([{}],b),k.updatePosition({plotX:f[0],plotY:f[1]}));this.unDocMouseMove||(this.unDocMouseMove=C(c.container.ownerDocument,"mousemove",function(b){var d=E[a.hoverChartIndex];if(d)d.pointer.onDocumentMouseMove(b)}));r(c.axes,function(d){var c=z(d.crosshair.snap,!0),k=c?a.find(u,function(a){return a.series[d.coll]===d}):void 0;k||!c?d.drawCrosshair(b,k):d.hideCrosshair()})},reset:function(a,d){var b=this.chart,c=b.hoverSeries,e=b.hoverPoint,f=b.hoverPoints,l=b.tooltip,u=l&&l.shared?f:e;a&&u&&r(k(u),function(b){b.series.isCartesian&&void 0===b.plotX&&(a=!1)});if(a)l&&u&&(l.refresh(u),l.shared&&f?r(f,function(a){a.setState(a.state,!0);a.series.xAxis.crosshair&&a.series.xAxis.drawCrosshair(null,a);a.series.yAxis.crosshair&&a.series.yAxis.drawCrosshair(null,a)}):e&&(e.setState(e.state,!0),r(b.axes,function(a){a.crosshair&&a.drawCrosshair(null,e)})));else{if(e)e.onMouseOut();f&&r(f,function(a){a.setState()});if(c)c.onMouseOut();l&&l.hide(d);this.unDocMouseMove&&(this.unDocMouseMove=this.unDocMouseMove());r(b.axes,function(a){a.hideCrosshair()});this.hoverX=b.hoverPoints=b.hoverPoint=null}},scaleGroups:function(a,d){var b=this.chart,c;r(b.series,function(k){c=a||k.getPlotBox();k.xAxis&&k.xAxis.zoomEnabled&&k.group&&(k.group.attr(c),k.markerGroup&&(k.markerGroup.attr(c),k.markerGroup.clip(d?b.clipRect:null)),k.dataLabelsGroup&&k.dataLabelsGroup.attr(c))});b.clipRect.attr(d||b.clipBox)},dragStart:function(a){var b=this.chart;b.mouseIsDown=a.type;b.cancelClick=!1;b.mouseDownX=this.mouseDownX=a.chartX;b.mouseDownY=this.mouseDownY=a.chartY},drag:function(a){var b=this.chart,d=b.options.chart,c=a.chartX,k=a.chartY,e=this.zoomHor,f=this.zoomVert,l=b.plotLeft,n=b.plotTop,h=b.plotWidth,B=b.plotHeight,z,F=this.selectionMarker,g=this.mouseDownX,v=this.mouseDownY,q=d.panKey&&a[d.panKey+"Key"];F&&F.touch||(c<l?c=l:c>l+h&&(c=l+h),k<n?k=n:k>n+B&&(k=n+B),this.hasDragged=Math.sqrt(Math.pow(g-c,2)+Math.pow(v-k,2)),10<this.hasDragged&&(z=b.isInsidePlot(g-l,v-n),b.hasCartesianSeries&&(this.zoomX||this.zoomY)&&z&&!q&&!F&&(this.selectionMarker=F=b.renderer.rect(l,n,e?1:h,f?1:B,0).attr({fill:d.selectionMarkerFill||m("#335cad").setOpacity(.25).get(),class:"highcharts-selection-marker",zIndex:7}).add()),F&&e&&(c-=g,F.attr({width:Math.abs(c),x:(0<c?0:c)+g})),F&&f&&(c=k-v,F.attr({height:Math.abs(c),y:(0<c?0:c)+v})),z&&!F&&d.panning&&b.pan(a,d.panning)))},drop:function(a){var b=this,d=this.chart,c=this.hasPinched;if(this.selectionMarker){var k={originalEvent:a,xAxis:[],yAxis:[]},l=this.selectionMarker,x=l.attr?l.attr("x"):l.x,z=l.attr?l.attr("y"):l.y,n=l.attr?l.attr("width"):l.width,G=l.attr?l.attr("height"):l.height,B;if(this.hasDragged||c)r(d.axes,function(d){if(d.zoomEnabled&&f(d.min)&&(c||b[{xAxis:"zoomX",yAxis:"zoomY"}[d.coll]])){var e=d.horiz,g="touchend"===a.type?d.minPixelPadding:0,l=d.toValue((e?x:z)+g),e=d.toValue((e?x+n:z+G)-g);k[d.coll].push({axis:d,min:Math.min(l,e),max:Math.max(l,e)});B=!0}}),B&&w(d,"selection",k,function(a){d.zoom(y(a,c?{animation:!1}:null))});e(d.index)&&(this.selectionMarker=this.selectionMarker.destroy());c&&this.scaleGroups()}d&&e(d.index)&&(h(d.container,{cursor:d._cursor}),d.cancelClick=10<this.hasDragged,d.mouseIsDown=this.hasDragged=this.hasPinched=!1,this.pinchDown=[])},onContainerMouseDown:function(a){a=this.normalize(a);2!==a.button&&(this.zoomOption(a),a.preventDefault&&a.preventDefault(),this.dragStart(a))},onDocumentMouseUp:function(b){E[a.hoverChartIndex]&&E[a.hoverChartIndex].pointer.drop(b)},onDocumentMouseMove:function(a){var b=this.chart,d=this.chartPosition;a=this.normalize(a,d);!d||this.inClass(a.target,"highcharts-tracker")||b.isInsidePlot(a.chartX-b.plotLeft,a.chartY-b.plotTop)||this.reset()},onContainerMouseLeave:function(b){var d=E[a.hoverChartIndex];d&&(b.relatedTarget||b.toElement)&&(d.pointer.reset(),d.pointer.chartPosition=null)},onContainerMouseMove:function(b){var d=this.chart;f(a.hoverChartIndex)&&E[a.hoverChartIndex]&&E[a.hoverChartIndex].mouseIsDown||(a.hoverChartIndex=d.index);b=this.normalize(b);b.returnValue=!1;"mousedown"===d.mouseIsDown&&this.drag(b);!this.inClass(b.target,"highcharts-tracker")&&!d.isInsidePlot(b.chartX-d.plotLeft,b.chartY-d.plotTop)||d.openMenu||this.runPointActions(b)},inClass:function(a,d){for(var b;a;){if(b=D(a,"class")){if(-1!==b.indexOf(d))return!0;if(-1!==b.indexOf("highcharts-container"))return!1}a=a.parentNode}},onTrackerMouseOut:function(a){var b=this.chart.hoverSeries;a=a.relatedTarget||a.toElement;this.isDirectTouch=!1;if(!(!b||!a||b.stickyTracking||this.inClass(a,"highcharts-tooltip")||this.inClass(a,"highcharts-series-"+b.index)&&this.inClass(a,"highcharts-tracker")))b.onMouseOut()},onContainerClick:function(a){var b=this.chart,d=b.hoverPoint,c=b.plotLeft,k=b.plotTop;a=this.normalize(a);b.cancelClick||(d&&this.inClass(a.target,"highcharts-tracker")?(w(d.series,"click",y(a,{point:d})),b.hoverPoint&&d.firePointEvent("click",a)):(y(a,this.getCoordinates(a)),b.isInsidePlot(a.chartX-c,a.chartY-k)&&w(b,"click",a)))},setDOMEvents:function(){var b=this,d=b.chart.container,c=d.ownerDocument;d.onmousedown=function(a){b.onContainerMouseDown(a)};d.onmousemove=function(a){b.onContainerMouseMove(a)};d.onclick=function(a){b.onContainerClick(a)};this.unbindContainerMouseLeave=C(d,"mouseleave",b.onContainerMouseLeave);a.unbindDocumentMouseUp||(a.unbindDocumentMouseUp=C(c,"mouseup",b.onDocumentMouseUp));a.hasTouch&&(d.ontouchstart=function(a){b.onContainerTouchStart(a)},d.ontouchmove=function(a){b.onContainerTouchMove(a)},a.unbindDocumentTouchEnd||(a.unbindDocumentTouchEnd=C(c,"touchend",b.onDocumentTouchEnd)))},destroy:function(){var b=this;b.unDocMouseMove&&b.unDocMouseMove();this.unbindContainerMouseLeave();a.chartCount||(a.unbindDocumentMouseUp&&(a.unbindDocumentMouseUp=a.unbindDocumentMouseUp()),a.unbindDocumentTouchEnd&&(a.unbindDocumentTouchEnd=a.unbindDocumentTouchEnd()));clearInterval(b.tooltipTimeout);a.objectEach(b,function(a,d){b[d]=null})}}})(K);(function(a){var C=a.charts,D=a.each,E=a.extend,m=a.map,h=a.noop,f=a.pick;E(a.Pointer.prototype,{pinchTranslate:function(a,f,h,m,e,c){this.zoomHor&&this.pinchTranslateDirection(!0,a,f,h,m,e,c);this.zoomVert&&this.pinchTranslateDirection(!1,a,f,h,m,e,c)},pinchTranslateDirection:function(a,f,h,m,e,c,l,z){var k=this.chart,d=a?"x":"y",b=a?"X":"Y",u="chart"+b,p=a?"width":"height",q=k["plot"+(a?"Left":"Top")],t,r,x=z||1,y=k.inverted,n=k.bounds[a?"h":"v"],G=1===f.length,B=f[0][u],M=h[0][u],F=!G&&f[1][u],g=!G&&h[1][u],v;h=function(){!G&&20<Math.abs(B-F)&&(x=z||Math.abs(M-g)/Math.abs(B-F));r=(q-M)/x+B;t=k["plot"+(a?"Width":"Height")]/x};h();f=r;f<n.min?(f=n.min,v=!0):f+t>n.max&&(f=n.max-t,v=!0);v?(M-=.8*(M-l[d][0]),G||(g-=.8*(g-l[d][1])),h()):l[d]=[M,g];y||(c[d]=r-q,c[p]=t);c=y?1/x:x;e[p]=t;e[d]=f;m[y?a?"scaleY":"scaleX":"scale"+b]=x;m["translate"+b]=c*q+(M-c*B)},pinch:function(a){var r=this,q=r.chart,w=r.pinchDown,e=a.touches,c=e.length,l=r.lastValidTouch,z=r.hasZoom,k=r.selectionMarker,d={},b=1===c&&(r.inClass(a.target,"highcharts-tracker")&&q.runTrackerClick||r.runChartClick),u={};1<c&&(r.initiated=!0);z&&r.initiated&&!b&&a.preventDefault();m(e,function(a){return r.normalize(a)});"touchstart"===a.type?(D(e,function(a,b){w[b]={chartX:a.chartX,chartY:a.chartY}}),l.x=[w[0].chartX,w[1]&&w[1].chartX],l.y=[w[0].chartY,w[1]&&w[1].chartY],D(q.axes,function(a){if(a.zoomEnabled){var b=q.bounds[a.horiz?"h":"v"],d=a.minPixelPadding,c=a.toPixels(f(a.options.min,a.dataMin)),k=a.toPixels(f(a.options.max,a.dataMax)),e=Math.max(c,k);b.min=Math.min(a.pos,Math.min(c,k)-d);b.max=Math.max(a.pos+a.len,e+d)}}),r.res=!0):r.followTouchMove&&1===c?this.runPointActions(r.normalize(a)):w.length&&(k||(r.selectionMarker=k=E({destroy:h,touch:!0},q.plotBox)),r.pinchTranslate(w,e,d,k,u,l),r.hasPinched=z,r.scaleGroups(d,u),r.res&&(r.res=!1,this.reset(!1,0)))},touch:function(h,m){var q=this.chart,r,e;if(q.index!==a.hoverChartIndex)this.onContainerMouseLeave({relatedTarget:!0});a.hoverChartIndex=q.index;1===h.touches.length?(h=this.normalize(h),(e=q.isInsidePlot(h.chartX-q.plotLeft,h.chartY-q.plotTop))&&!q.openMenu?(m&&this.runPointActions(h),"touchmove"===h.type&&(m=this.pinchDown,r=m[0]?4<=Math.sqrt(Math.pow(m[0].chartX-h.chartX,2)+Math.pow(m[0].chartY-h.chartY,2)):!1),f(r,!0)&&this.pinch(h)):m&&this.reset()):2===h.touches.length&&this.pinch(h)},onContainerTouchStart:function(a){this.zoomOption(a);this.touch(a,!0)},onContainerTouchMove:function(a){this.touch(a)},onDocumentTouchEnd:function(f){C[a.hoverChartIndex]&&C[a.hoverChartIndex].pointer.drop(f)}})})(K);(function(a){var C=a.addEvent,D=a.charts,E=a.css,m=a.doc,h=a.extend,f=a.noop,r=a.Pointer,y=a.removeEvent,q=a.win,w=a.wrap;if(!a.hasTouch&&(q.PointerEvent||q.MSPointerEvent)){var e={},c=!!q.PointerEvent,l=function(){var c=[];c.item=function(a){return this[a]};a.objectEach(e,function(a){c.push({pageX:a.pageX,pageY:a.pageY,target:a.target})});return c},z=function(c,d,b,e){"touch"!==c.pointerType&&c.pointerType!==c.MSPOINTER_TYPE_TOUCH||!D[a.hoverChartIndex]||(e(c),e=D[a.hoverChartIndex].pointer,e[d]({type:b,target:c.currentTarget,preventDefault:f,touches:l()}))};h(r.prototype,{onContainerPointerDown:function(a){z(a,"onContainerTouchStart","touchstart",function(a){e[a.pointerId]={pageX:a.pageX,pageY:a.pageY,target:a.currentTarget}})},onContainerPointerMove:function(a){z(a,"onContainerTouchMove","touchmove",function(a){e[a.pointerId]={pageX:a.pageX,pageY:a.pageY};e[a.pointerId].target||(e[a.pointerId].target=a.currentTarget)})},onDocumentPointerUp:function(a){z(a,"onDocumentTouchEnd","touchend",function(a){delete e[a.pointerId]})},batchMSEvents:function(a){a(this.chart.container,c?"pointerdown":"MSPointerDown",this.onContainerPointerDown);a(this.chart.container,c?"pointermove":"MSPointerMove",this.onContainerPointerMove);a(m,c?"pointerup":"MSPointerUp",this.onDocumentPointerUp)}});w(r.prototype,"init",function(a,d,b){a.call(this,d,b);this.hasZoom&&E(d.container,{"-ms-touch-action":"none","touch-action":"none"})});w(r.prototype,"setDOMEvents",function(a){a.apply(this);(this.hasZoom||this.followTouchMove)&&this.batchMSEvents(C)});w(r.prototype,"destroy",function(a){this.batchMSEvents(y);a.call(this)})}})(K);(function(a){var C=a.addEvent,D=a.css,E=a.discardElement,m=a.defined,h=a.each,f=a.fireEvent,r=a.isFirefox,y=a.marginNames,q=a.merge,w=a.pick,e=a.setAnimation,c=a.stableSort,l=a.win,z=a.wrap;a.Legend=function(a,d){this.init(a,d)};a.Legend.prototype={init:function(a,d){this.chart=a;this.setOptions(d);d.enabled&&(this.render(),C(this.chart,"endResize",function(){this.legend.positionCheckboxes()}),this.proximate?this.unchartrender=C(this.chart,"render",function(){this.legend.proximatePositions();this.legend.positionItems()}):this.unchartrender&&this.unchartrender())},setOptions:function(a){var d=w(a.padding,8);this.options=a;this.itemStyle=a.itemStyle;this.itemHiddenStyle=q(this.itemStyle,a.itemHiddenStyle);this.itemMarginTop=a.itemMarginTop||0;this.padding=d;this.initialItemY=d-5;this.symbolWidth=w(a.symbolWidth,16);this.pages=[];this.proximate="proximate"===a.layout&&!this.chart.inverted},update:function(a,d){var b=this.chart;this.setOptions(q(!0,this.options,a));this.destroy();b.isDirtyLegend=b.isDirtyBox=!0;w(d,!0)&&b.redraw();f(this,"afterUpdate")},colorizeItem:function(a,d){a.legendGroup[d?"removeClass":"addClass"]("highcharts-legend-item-hidden");var b=this.options,c=a.legendItem,k=a.legendLine,e=a.legendSymbol,l=this.itemHiddenStyle.color,b=d?b.itemStyle.color:l,h=d?a.color||l:l,x=a.options&&a.options.marker,z={fill:h};c&&c.css({fill:b,color:b});k&&k.attr({stroke:h});e&&(x&&e.isMarker&&(z=a.pointAttribs(),d||(z.stroke=z.fill=l)),e.attr(z));f(this,"afterColorizeItem",{item:a,visible:d})},positionItems:function(){h(this.allItems,this.positionItem,this);this.chart.isResizing||this.positionCheckboxes()},positionItem:function(a){var d=this.options,b=d.symbolPadding,d=!d.rtl,c=a._legendItemPos,k=c[0],c=c[1],e=a.checkbox;if((a=a.legendGroup)&&a.element)a[m(a.translateY)?"animate":"attr"]({translateX:d?k:this.legendWidth-k-2*b-4,translateY:c});e&&(e.x=k,e.y=c)},destroyItem:function(a){var d=a.checkbox;h(["legendItem","legendLine","legendSymbol","legendGroup"],function(b){a[b]&&(a[b]=a[b].destroy())});d&&E(a.checkbox)},destroy:function(){function a(a){this[a]&&(this[a]=this[a].destroy())}h(this.getAllItems(),function(c){h(["legendItem","legendGroup"],a,c)});h("clipRect up down pager nav box title group".split(" "),a,this);this.display=null},positionCheckboxes:function(){var a=this.group&&this.group.alignAttr,c,b=this.clipHeight||this.legendHeight,e=this.titleHeight;a&&(c=a.translateY,h(this.allItems,function(d){var k=d.checkbox,f;k&&(f=c+e+k.y+(this.scrollOffset||0)+3,D(k,{left:a.translateX+d.checkboxOffset+k.x-20+"px",top:f+"px",display:f>c-6&&f<c+b-6?"":"none"}))},this))},renderTitle:function(){var a=this.options,c=this.padding,b=a.title,e=0;b.text&&(this.title||(this.title=this.chart.renderer.label(b.text,c-3,c-4,null,null,null,a.useHTML,null,"legend-title").attr({zIndex:1}).css(b.style).add(this.group)),a=this.title.getBBox(),e=a.height,this.offsetWidth=a.width,this.contentGroup.attr({translateY:e}));this.titleHeight=e},setText:function(c){var d=this.options;c.legendItem.attr({text:d.labelFormat?a.format(d.labelFormat,c,this.chart.time):d.labelFormatter.call(c)})},renderItem:function(a){var c=this.chart,b=c.renderer,e=this.options,k=this.symbolWidth,f=e.symbolPadding,l=this.itemStyle,h=this.itemHiddenStyle,x="horizontal"===e.layout?w(e.itemDistance,20):0,z=!e.rtl,n=a.legendItem,G=!a.series,B=!G&&a.series.drawLegendSymbol?a.series:a,m=B.options,m=this.createCheckboxForItem&&m&&m.showCheckbox,x=k+f+x+(m?20:0),F=e.useHTML,g=a.options.className;n||(a.legendGroup=b.g("legend-item").addClass("highcharts-"+B.type+"-series highcharts-color-"+a.colorIndex+(g?" "+g:"")+(G?" highcharts-series-"+a.index:"")).attr({zIndex:1}).add(this.scrollGroup),a.legendItem=n=b.text("",z?k+f:-f,this.baseline||0,F).css(q(a.visible?l:h)).attr({align:z?"left":"right",zIndex:2}).add(a.legendGroup),this.baseline||(k=l.fontSize,this.fontMetrics=b.fontMetrics(k,n),this.baseline=this.fontMetrics.f+3+this.itemMarginTop,n.attr("y",this.baseline)),this.symbolHeight=e.symbolHeight||this.fontMetrics.f,B.drawLegendSymbol(this,a),this.setItemEvents&&this.setItemEvents(a,n,F),m&&this.createCheckboxForItem(a));this.colorizeItem(a,a.visible);l.width||n.css({width:(e.itemWidth||e.width||c.spacingBox.width)-x});this.setText(a);c=n.getBBox();a.itemWidth=a.checkboxOffset=e.itemWidth||a.legendItemWidth||c.width+x;this.maxItemWidth=Math.max(this.maxItemWidth,a.itemWidth);this.totalItemWidth+=a.itemWidth;this.itemHeight=a.itemHeight=Math.round(a.legendItemHeight||c.height||this.symbolHeight)},layoutItem:function(a){var c=this.options,b=this.padding,e="horizontal"===c.layout,k=a.itemHeight,f=c.itemMarginBottom||0,l=this.itemMarginTop,h=e?w(c.itemDistance,20):0,x=c.width,z=x||this.chart.spacingBox.width-2*b-c.x,c=c.alignColumns&&this.totalItemWidth>z?this.maxItemWidth:a.itemWidth;e&&this.itemX-b+c>z&&(this.itemX=b,this.itemY+=l+this.lastLineHeight+f,this.lastLineHeight=0);this.lastItemY=l+this.itemY+f;this.lastLineHeight=Math.max(k,this.lastLineHeight);a._legendItemPos=[this.itemX,this.itemY];e?this.itemX+=c:(this.itemY+=l+k+f,this.lastLineHeight=k);this.offsetWidth=x||Math.max((e?this.itemX-b-(a.checkbox?0:h):c)+b,this.offsetWidth)},getAllItems:function(){var a=[];h(this.chart.series,function(c){var b=c&&c.options;c&&w(b.showInLegend,m(b.linkedTo)?!1:void 0,!0)&&(a=a.concat(c.legendItems||("point"===b.legendType?c.data:c)))});f(this,"afterGetAllItems",{allItems:a});return a},getAlignment:function(){var a=this.options;return this.proximate?a.align.charAt(0)+"tv":a.floating?"":a.align.charAt(0)+a.verticalAlign.charAt(0)+a.layout.charAt(0)},adjustMargins:function(a,c){var b=this.chart,d=this.options,e=this.getAlignment();e&&h([/(lth|ct|rth)/,/(rtv|rm|rbv)/,/(rbh|cb|lbh)/,/(lbv|lm|ltv)/],function(k,f){k.test(e)&&!m(a[f])&&(b[y[f]]=Math.max(b[y[f]],b.legend[(f+1)%2?"legendHeight":"legendWidth"]+[1,-1,-1,1][f]*d[f%2?"x":"y"]+w(d.margin,12)+c[f]+(0===f&&void 0!==b.options.title.margin?b.titleOffset+b.options.title.margin:0)))})},proximatePositions:function(){var c=this.chart,d=[],b="left"===this.options.align;h(this.allItems,function(e){var k,f;k=b;e.xAxis&&e.points&&(e.xAxis.options.reversed&&(k=!k),k=a.find(k?e.points:e.points.slice(0).reverse(),function(b){return a.isNumber(b.plotY)}),f=e.legendGroup.getBBox().height,d.push({target:e.visible?(k?k.plotY:e.xAxis.height)-.3*f:c.plotHeight,size:f,item:e}))},this);a.distribute(d,c.plotHeight);h(d,function(a){a.item._legendItemPos[1]=c.plotTop-c.spacing[0]+a.pos})},render:function(){var a=this.chart,d=a.renderer,b=this.group,e,f,l,t=this.box,z=this.options,x=this.padding;this.itemX=x;this.itemY=this.initialItemY;this.lastItemY=this.offsetWidth=0;b||(this.group=b=d.g("legend").attr({zIndex:7}).add(),this.contentGroup=d.g().attr({zIndex:1}).add(b),this.scrollGroup=d.g().add(this.contentGroup));this.renderTitle();e=this.getAllItems();c(e,function(a,b){return(a.options&&a.options.legendIndex||0)-(b.options&&b.options.legendIndex||0)});z.reversed&&e.reverse();this.allItems=e;this.display=f=!!e.length;this.itemHeight=this.totalItemWidth=this.maxItemWidth=this.lastLineHeight=0;h(e,this.renderItem,this);h(e,this.layoutItem,this);e=(z.width||this.offsetWidth)+x;l=this.lastItemY+this.lastLineHeight+this.titleHeight;l=this.handleOverflow(l);l+=x;t||(this.box=t=d.rect().addClass("highcharts-legend-box").attr({r:z.borderRadius}).add(b),t.isNew=!0);t.attr({stroke:z.borderColor,"stroke-width":z.borderWidth||0,fill:z.backgroundColor||"none"}).shadow(z.shadow);0<e&&0<l&&(t[t.isNew?"attr":"animate"](t.crisp.call({},{x:0,y:0,width:e,height:l},t.strokeWidth())),t.isNew=!1);t[f?"show":"hide"]();this.legendWidth=e;this.legendHeight=l;f&&(d=a.spacingBox,/(lth|ct|rth)/.test(this.getAlignment())&&(d=q(d,{y:d.y+a.titleOffset+a.options.title.margin})),b.align(q(z,{width:e,height:l,verticalAlign:this.proximate?"top":z.verticalAlign}),!0,d));this.proximate||this.positionItems()},handleOverflow:function(a){var c=this,b=this.chart,e=b.renderer,k=this.options,f=k.y,l=this.padding,b=b.spacingBox.height+("top"===k.verticalAlign?-f:f)-l,f=k.maxHeight,z,x=this.clipRect,m=k.navigation,n=w(m.animation,!0),G=m.arrowSize||12,B=this.nav,q=this.pages,F,g=this.allItems,v=function(a){"number"===typeof a?x.attr({height:a}):x&&(c.clipRect=x.destroy(),c.contentGroup.clip());c.contentGroup.div&&(c.contentGroup.div.style.clip=a?"rect("+l+"px,9999px,"+(l+a)+"px,0)":"auto")};"horizontal"!==k.layout||"middle"===k.verticalAlign||k.floating||(b/=2);f&&(b=Math.min(b,f));q.length=0;a>b&&!1!==m.enabled?(this.clipHeight=z=Math.max(b-20-this.titleHeight-l,0),this.currentPage=w(this.currentPage,1),this.fullHeight=a,h(g,function(a,b){var c=a._legendItemPos[1],d=Math.round(a.legendItem.getBBox().height),e=q.length;if(!e||c-q[e-1]>z&&(F||c)!==q[e-1])q.push(F||c),e++;a.pageIx=e-1;F&&(g[b-1].pageIx=e-1);b===g.length-1&&c+d-q[e-1]>z&&(q.push(c),a.pageIx=e);c!==F&&(F=c)}),x||(x=c.clipRect=e.clipRect(0,l,9999,0),c.contentGroup.clip(x)),v(z),B||(this.nav=B=e.g().attr({zIndex:1}).add(this.group),this.up=e.symbol("triangle",0,0,G,G).on("click",function(){c.scroll(-1,n)}).add(B),this.pager=e.text("",15,10).addClass("highcharts-legend-navigation").css(m.style).add(B),this.down=e.symbol("triangle-down",0,0,G,G).on("click",function(){c.scroll(1,n)}).add(B)),c.scroll(0),a=b):B&&(v(),this.nav=B.destroy(),this.scrollGroup.attr({translateY:1}),this.clipHeight=0);return a},scroll:function(a,c){var b=this.pages,d=b.length;a=this.currentPage+a;var k=this.clipHeight,f=this.options.navigation,l=this.pager,h=this.padding;a>d&&(a=d);0<a&&(void 0!==c&&e(c,this.chart),this.nav.attr({translateX:h,translateY:k+this.padding+7+this.titleHeight,visibility:"visible"}),this.up.attr({class:1===a?"highcharts-legend-nav-inactive":"highcharts-legend-nav-active"}),l.attr({text:a+"/"+d}),this.down.attr({x:18+this.pager.getBBox().width,class:a===d?"highcharts-legend-nav-inactive":"highcharts-legend-nav-active"}),this.up.attr({fill:1===a?f.inactiveColor:f.activeColor}).css({cursor:1===a?"default":"pointer"}),this.down.attr({fill:a===d?f.inactiveColor:f.activeColor}).css({cursor:a===d?"default":"pointer"}),this.scrollOffset=-b[a-1]+this.initialItemY,this.scrollGroup.animate({translateY:this.scrollOffset}),this.currentPage=a,this.positionCheckboxes())}};a.LegendSymbolMixin={drawRectangle:function(a,c){var b=a.symbolHeight,d=a.options.squareSymbol;c.legendSymbol=this.chart.renderer.rect(d?(a.symbolWidth-b)/2:0,a.baseline-b+1,d?b:a.symbolWidth,b,w(a.options.symbolRadius,b/2)).addClass("highcharts-point").attr({zIndex:3}).add(c.legendGroup)},drawLineMarker:function(a){var c=this.options,b=c.marker,e=a.symbolWidth,k=a.symbolHeight,f=k/2,l=this.chart.renderer,h=this.legendGroup;a=a.baseline-Math.round(.3*a.fontMetrics.b);var z;z={"stroke-width":c.lineWidth||0};c.dashStyle&&(z.dashstyle=c.dashStyle);this.legendLine=l.path(["M",0,a,"L",e,a]).addClass("highcharts-graph").attr(z).add(h);b&&!1!==b.enabled&&e&&(c=Math.min(w(b.radius,f),f),0===this.symbol.indexOf("url")&&(b=q(b,{width:k,height:k}),c=0),this.legendSymbol=b=l.symbol(this.symbol,e/2-c,a-c,2*c,2*c,b).addClass("highcharts-point").add(h),b.isMarker=!0)}};(/Trident\/7\.0/.test(l.navigator.userAgent)||r)&&z(a.Legend.prototype,"positionItem",function(a,c){var b=this,d=function(){c._legendItemPos&&a.call(b,c)};d();setTimeout(d)})})(K);(function(a){var C=a.addEvent,D=a.animate,E=a.animObject,m=a.attr,h=a.doc,f=a.Axis,r=a.createElement,y=a.defaultOptions,q=a.discardElement,w=a.charts,e=a.css,c=a.defined,l=a.each,z=a.extend,k=a.find,d=a.fireEvent,b=a.grep,u=a.isNumber,p=a.isObject,H=a.isString,t=a.Legend,L=a.marginNames,x=a.merge,I=a.objectEach,n=a.Pointer,G=a.pick,B=a.pInt,M=a.removeEvent,F=a.seriesTypes,g=a.splat,v=a.syncTimeout,P=a.win,Q=a.Chart=function(){this.getArgs.apply(this,arguments)};a.chart=function(a,b,c){return new Q(a,b,c)};z(Q.prototype,{callbacks:[],getArgs:function(){var a=[].slice.call(arguments);if(H(a[0])||a[0].nodeName)this.renderTo=a.shift();this.init(a[0],a[1])},init:function(b,c){var g,e,k=b.series,f=b.plotOptions||{};d(this,"init",{args:arguments},function(){b.series=null;g=x(y,b);for(e in g.plotOptions)g.plotOptions[e].tooltip=f[e]&&x(f[e].tooltip)||void 0;g.tooltip.userOptions=b.chart&&b.chart.forExport&&b.tooltip.userOptions||b.tooltip;g.series=b.series=k;this.userOptions=b;var n=g.chart,l=n.events;this.margin=[];this.spacing=[];this.bounds={h:{},v:{}};this.labelCollectors=[];this.callback=c;this.isResizing=0;this.options=g;this.axes=[];this.series=[];this.time=b.time&&a.keys(b.time).length?new a.Time(b.time):a.time;this.hasCartesianSeries=n.showAxes;var h=this;h.index=w.length;w.push(h);a.chartCount++;l&&I(l,function(a,b){C(h,b,a)});h.xAxis=[];h.yAxis=[];h.pointCount=h.colorCounter=h.symbolCounter=0;d(h,"afterInit");h.firstRender()})},initSeries:function(b){var c=this.options.chart;(c=F[b.type||c.type||c.defaultSeriesType])||a.error(17,!0);c=new c;c.init(this,b);return c},orderSeries:function(a){var b=this.series;for(a=a||0;a<b.length;a++)b[a]&&(b[a].index=a,b[a].name=b[a].getName())},isInsidePlot:function(a,b,c){var d=c?b:a;a=c?a:b;return 0<=d&&d<=this.plotWidth&&0<=a&&a<=this.plotHeight},redraw:function(b){d(this,"beforeRedraw");var c=this.axes,g=this.series,e=this.pointer,f=this.legend,k=this.isDirtyLegend,n,h,B=this.hasCartesianSeries,G=this.isDirtyBox,v,p=this.renderer,t=p.isHidden(),x=[];this.setResponsive&&this.setResponsive(!1);a.setAnimation(b,this);t&&this.temporaryDisplay();this.layOutTitles();for(b=g.length;b--;)if(v=g[b],v.options.stacking&&(n=!0,v.isDirty)){h=!0;break}if(h)for(b=g.length;b--;)v=g[b],v.options.stacking&&(v.isDirty=!0);l(g,function(a){a.isDirty&&"point"===a.options.legendType&&(a.updateTotals&&a.updateTotals(),k=!0);a.isDirtyData&&d(a,"updatedData")});k&&f.options.enabled&&(f.render(),this.isDirtyLegend=!1);n&&this.getStacks();B&&l(c,function(a){a.updateNames();a.setScale()});this.getMargins();B&&(l(c,function(a){a.isDirty&&(G=!0)}),l(c,function(a){var b=a.min+","+a.max;a.extKey!==b&&(a.extKey=b,x.push(function(){d(a,"afterSetExtremes",z(a.eventArgs,a.getExtremes()));delete a.eventArgs}));(G||n)&&a.redraw()}));G&&this.drawChartBox();d(this,"predraw");l(g,function(a){(G||a.isDirty)&&a.visible&&a.redraw();a.isDirtyData=!1});e&&e.reset(!0);p.draw();d(this,"redraw");d(this,"render");t&&this.temporaryDisplay(!0);l(x,function(a){a.call()})},get:function(a){function b(b){return b.id===a||b.options&&b.options.id===a}var c,d=this.series,g;c=k(this.axes,b)||k(this.series,b);for(g=0;!c&&g<d.length;g++)c=k(d[g].points||[],b);return c},getAxes:function(){var a=this,b=this.options,c=b.xAxis=g(b.xAxis||{}),b=b.yAxis=g(b.yAxis||{});d(this,"getAxes");l(c,function(a,b){a.index=b;a.isX=!0});l(b,function(a,b){a.index=b});c=c.concat(b);l(c,function(b){new f(a,b)});d(this,"afterGetAxes")},getSelectedPoints:function(){var a=[];l(this.series,function(c){a=a.concat(b(c.data||[],function(a){return a.selected}))});return a},getSelectedSeries:function(){return b(this.series,function(a){return a.selected})},setTitle:function(a,b,c){var d=this,g=d.options,e;e=g.title=x({style:{color:"#333333",fontSize:g.isStock?"16px":"18px"}},g.title,a);g=g.subtitle=x({style:{color:"#666666"}},g.subtitle,b);l([["title",a,e],["subtitle",b,g]],function(a,b){var c=a[0],g=d[c],e=a[1];a=a[2];g&&e&&(d[c]=g=g.destroy());a&&!g&&(d[c]=d.renderer.text(a.text,0,0,a.useHTML).attr({align:a.align,class:"highcharts-"+c,zIndex:a.zIndex||4}).add(),d[c].update=function(a){d.setTitle(!b&&a,b&&a)},d[c].css(a.style))});d.layOutTitles(c)},layOutTitles:function(a){var b=0,c,d=this.renderer,g=this.spacingBox;l(["title","subtitle"],function(a){var c=this[a],e=this.options[a];a="title"===a?-3:e.verticalAlign?0:b+2;var n;c&&(n=e.style.fontSize,n=d.fontMetrics(n,c).b,c.css({width:(e.width||g.width+e.widthAdjust)+"px"}).align(z({y:a+n},e),!1,"spacingBox"),e.floating||e.verticalAlign||(b=Math.ceil(b+c.getBBox(e.useHTML).height)))},this);c=this.titleOffset!==b;this.titleOffset=b;!this.isDirtyBox&&c&&(this.isDirtyBox=this.isDirtyLegend=c,this.hasRendered&&G(a,!0)&&this.isDirtyBox&&this.redraw())},getChartSize:function(){var b=this.options.chart,d=b.width,b=b.height,g=this.renderTo;c(d)||(this.containerWidth=a.getStyle(g,"width"));c(b)||(this.containerHeight=a.getStyle(g,"height"));this.chartWidth=Math.max(0,d||this.containerWidth||600);this.chartHeight=Math.max(0,a.relativeLength(b,this.chartWidth)||(1<this.containerHeight?this.containerHeight:400))},temporaryDisplay:function(b){var c=this.renderTo;if(b)for(;c&&c.style;)c.hcOrigStyle&&(a.css(c,c.hcOrigStyle),delete c.hcOrigStyle),c.hcOrigDetached&&(h.body.removeChild(c),c.hcOrigDetached=!1),c=c.parentNode;else for(;c&&c.style;){h.body.contains(c)||c.parentNode||(c.hcOrigDetached=!0,h.body.appendChild(c));if("none"===a.getStyle(c,"display",!1)||c.hcOricDetached)c.hcOrigStyle={display:c.style.display,height:c.style.height,overflow:c.style.overflow},b={display:"block",overflow:"hidden"},c!==this.renderTo&&(b.height=0),a.css(c,b),c.offsetWidth||c.style.setProperty("display","block","important");c=c.parentNode;if(c===h.body)break}},setClassName:function(a){this.container.className="highcharts-container "+(a||"")},getContainer:function(){var b,c=this.options,g=c.chart,e,n;b=this.renderTo;var f=a.uniqueKey(),k;b||(this.renderTo=b=g.renderTo);H(b)&&(this.renderTo=b=h.getElementById(b));b||a.error(13,!0);e=B(m(b,"data-highcharts-chart"));u(e)&&w[e]&&w[e].hasRendered&&w[e].destroy();m(b,"data-highcharts-chart",this.index);b.innerHTML="";g.skipClone||b.offsetWidth||this.temporaryDisplay();this.getChartSize();e=this.chartWidth;n=this.chartHeight;k=z({position:"relative",overflow:"hidden",width:e+"px",height:n+"px",textAlign:"left",lineHeight:"normal",zIndex:0,"-webkit-tap-highlight-color":"rgba(0,0,0,0)"},g.style);this.container=b=r("div",{id:f},k,b);this._cursor=b.style.cursor;this.renderer=new(a[g.renderer]||a.Renderer)(b,e,n,null,g.forExport,c.exporting&&c.exporting.allowHTML);this.setClassName(g.className);this.renderer.setStyle(g.style);this.renderer.chartIndex=this.index;d(this,"afterGetContainer")},getMargins:function(a){var b=this.spacing,g=this.margin,e=this.titleOffset;this.resetMargins();e&&!c(g[0])&&(this.plotTop=Math.max(this.plotTop,e+this.options.title.margin+b[0]));this.legend&&this.legend.display&&this.legend.adjustMargins(g,b);d(this,"getMargins");a||this.getAxisMargins()},getAxisMargins:function(){var a=this,b=a.axisOffset=[0,0,0,0],d=a.margin;a.hasCartesianSeries&&l(a.axes,function(a){a.visible&&a.getOffset()});l(L,function(g,e){c(d[e])||(a[g]+=b[e])});a.setChartSize()},reflow:function(b){var d=this,g=d.options.chart,e=d.renderTo,n=c(g.width)&&c(g.height),k=g.width||a.getStyle(e,"width"),g=g.height||a.getStyle(e,"height"),e=b?b.target:P;if(!n&&!d.isPrinting&&k&&g&&(e===P||e===h)){if(k!==d.containerWidth||g!==d.containerHeight)a.clearTimeout(d.reflowTimeout),d.reflowTimeout=v(function(){d.container&&d.setSize(void 0,void 0,!1)},b?100:0);d.containerWidth=k;d.containerHeight=g}},setReflow:function(a){var b=this;!1===a||this.unbindReflow?!1===a&&this.unbindReflow&&(this.unbindReflow=this.unbindReflow()):(this.unbindReflow=C(P,"resize",function(a){b.reflow(a)}),C(this,"destroy",this.unbindReflow))},setSize:function(b,c,g){var n=this,k=n.renderer;n.isResizing+=1;a.setAnimation(g,n);n.oldChartHeight=n.chartHeight;n.oldChartWidth=n.chartWidth;void 0!==b&&(n.options.chart.width=b);void 0!==c&&(n.options.chart.height=c);n.getChartSize();b=k.globalAnimation;(b?D:e)(n.container,{width:n.chartWidth+"px",height:n.chartHeight+"px"},b);n.setChartSize(!0);k.setSize(n.chartWidth,n.chartHeight,g);l(n.axes,function(a){a.isDirty=!0;a.setScale()});n.isDirtyLegend=!0;n.isDirtyBox=!0;n.layOutTitles();n.getMargins();n.redraw(g);n.oldChartHeight=null;d(n,"resize");v(function(){n&&d(n,"endResize",null,function(){--n.isResizing})},E(b).duration)},setChartSize:function(a){var b=this.inverted,c=this.renderer,g=this.chartWidth,e=this.chartHeight,n=this.options.chart,k=this.spacing,f=this.clipOffset,h,B,G,v;this.plotLeft=h=Math.round(this.plotLeft);this.plotTop=B=Math.round(this.plotTop);this.plotWidth=G=Math.max(0,Math.round(g-h-this.marginRight));this.plotHeight=v=Math.max(0,Math.round(e-B-this.marginBottom));this.plotSizeX=b?v:G;this.plotSizeY=b?G:v;this.plotBorderWidth=n.plotBorderWidth||0;this.spacingBox=c.spacingBox={x:k[3],y:k[0],width:g-k[3]-k[1],height:e-k[0]-k[2]};this.plotBox=c.plotBox={x:h,y:B,width:G,height:v};g=2*Math.floor(this.plotBorderWidth/2);b=Math.ceil(Math.max(g,f[3])/2);c=Math.ceil(Math.max(g,f[0])/2);this.clipBox={x:b,y:c,width:Math.floor(this.plotSizeX-Math.max(g,f[1])/2-b),height:Math.max(0,Math.floor(this.plotSizeY-Math.max(g,f[2])/2-c))};a||l(this.axes,function(a){a.setAxisSize();a.setAxisTranslation()});d(this,"afterSetChartSize",{skipAxes:a})},resetMargins:function(){var a=this,b=a.options.chart;l(["margin","spacing"],function(c){var d=b[c],g=p(d)?d:[d,d,d,d];l(["Top","Right","Bottom","Left"],function(d,e){a[c][e]=G(b[c+d],g[e])})});l(L,function(b,c){a[b]=G(a.margin[c],a.spacing[c])});a.axisOffset=[0,0,0,0];a.clipOffset=[0,0,0,0]},drawChartBox:function(){var a=this.options.chart,b=this.renderer,c=this.chartWidth,g=this.chartHeight,e=this.chartBackground,n=this.plotBackground,k=this.plotBorder,f,l=this.plotBGImage,h=a.backgroundColor,B=a.plotBackgroundColor,G=a.plotBackgroundImage,v,p=this.plotLeft,t=this.plotTop,z=this.plotWidth,x=this.plotHeight,F=this.plotBox,u=this.clipRect,m=this.clipBox,q="animate";e||(this.chartBackground=e=b.rect().addClass("highcharts-background").add(),q="attr");f=a.borderWidth||0;v=f+(a.shadow?8:0);h={fill:h||"none"};if(f||e["stroke-width"])h.stroke=a.borderColor,h["stroke-width"]=f;e.attr(h).shadow(a.shadow);e[q]({x:v/2,y:v/2,width:c-v-f%2,height:g-v-f%2,r:a.borderRadius});q="animate";n||(q="attr",this.plotBackground=n=b.rect().addClass("highcharts-plot-background").add());n[q](F);n.attr({fill:B||"none"}).shadow(a.plotShadow);G&&(l?l.animate(F):this.plotBGImage=b.image(G,p,t,z,x).add());u?u.animate({width:m.width,height:m.height}):this.clipRect=b.clipRect(m);q="animate";k||(q="attr",this.plotBorder=k=b.rect().addClass("highcharts-plot-border").attr({zIndex:1}).add());k.attr({stroke:a.plotBorderColor,"stroke-width":a.plotBorderWidth||0,fill:"none"});k[q](k.crisp({x:p,y:t,width:z,height:x},-k.strokeWidth()));this.isDirtyBox=!1;d(this,"afterDrawChartBox")},propFromSeries:function(){var a=this,b=a.options.chart,c,d=a.options.series,g,e;l(["inverted","angular","polar"],function(n){c=F[b.type||b.defaultSeriesType];e=b[n]||c&&c.prototype[n];for(g=d&&d.length;!e&&g--;)(c=F[d[g].type])&&c.prototype[n]&&(e=!0);a[n]=e})},linkSeries:function(){var a=this,b=a.series;l(b,function(a){a.linkedSeries.length=0});l(b,function(b){var c=b.options.linkedTo;H(c)&&(c=":previous"===c?a.series[b.index-1]:a.get(c))&&c.linkedParent!==b&&(c.linkedSeries.push(b),b.linkedParent=c,b.visible=G(b.options.visible,c.options.visible,b.visible))});d(this,"afterLinkSeries")},renderSeries:function(){l(this.series,function(a){a.translate();a.render()})},renderLabels:function(){var a=this,b=a.options.labels;b.items&&l(b.items,function(c){var d=z(b.style,c.style),g=B(d.left)+a.plotLeft,e=B(d.top)+a.plotTop+12;delete d.left;delete d.top;a.renderer.text(c.html,g,e).attr({zIndex:2}).css(d).add()})},render:function(){var a=this.axes,b=this.renderer,c=this.options,d,g,e;this.setTitle();this.legend=new t(this,c.legend);this.getStacks&&this.getStacks();this.getMargins(!0);this.setChartSize();c=this.plotWidth;d=this.plotHeight=Math.max(this.plotHeight-21,0);l(a,function(a){a.setScale()});this.getAxisMargins();g=1.1<c/this.plotWidth;e=1.05<d/this.plotHeight;if(g||e)l(a,function(a){(a.horiz&&g||!a.horiz&&e)&&a.setTickInterval(!0)}),this.getMargins();this.drawChartBox();this.hasCartesianSeries&&l(a,function(a){a.visible&&a.render()});this.seriesGroup||(this.seriesGroup=b.g("series-group").attr({zIndex:3}).add());this.renderSeries();this.renderLabels();this.addCredits();this.setResponsive&&this.setResponsive();this.hasRendered=!0},addCredits:function(a){var b=this;a=x(!0,this.options.credits,a);a.enabled&&!this.credits&&(this.credits=this.renderer.text(a.text+(this.mapCredits||""),0,0).addClass("highcharts-credits").on("click",function(){a.href&&(P.location.href=a.href)}).attr({align:a.position.align,zIndex:8}).css(a.style).add().align(a.position),this.credits.update=function(a){b.credits=b.credits.destroy();b.addCredits(a)})},destroy:function(){var b=this,c=b.axes,g=b.series,e=b.container,n,k=e&&e.parentNode;d(b,"destroy");b.renderer.forExport?a.erase(w,b):w[b.index]=void 0;a.chartCount--;b.renderTo.removeAttribute("data-highcharts-chart");M(b);for(n=c.length;n--;)c[n]=c[n].destroy();this.scroller&&this.scroller.destroy&&this.scroller.destroy();for(n=g.length;n--;)g[n]=g[n].destroy();l("title subtitle chartBackground plotBackground plotBGImage plotBorder seriesGroup clipRect credits pointer rangeSelector legend resetZoomButton tooltip renderer".split(" "),function(a){var c=b[a];c&&c.destroy&&(b[a]=c.destroy())});e&&(e.innerHTML="",M(e),k&&q(e));I(b,function(a,c){delete b[c]})},firstRender:function(){var a=this,b=a.options;if(!a.isReadyToRender||a.isReadyToRender()){a.getContainer();a.resetMargins();a.setChartSize();a.propFromSeries();a.getAxes();l(b.series||[],function(b){a.initSeries(b)});a.linkSeries();d(a,"beforeRender");n&&(a.pointer=new n(a,b));a.render();if(!a.renderer.imgCount&&a.onload)a.onload();a.temporaryDisplay(!0)}},onload:function(){l([this.callback].concat(this.callbacks),function(a){a&&void 0!==this.index&&a.apply(this,[this])},this);d(this,"load");d(this,"render");c(this.index)&&this.setReflow(this.options.chart.reflow);this.onload=null}})})(K);(function(a){var C=a.addEvent,D=a.Chart,E=a.each;C(D,"afterSetChartSize",function(m){var h=this.options.chart.scrollablePlotArea;(h=h&&h.minWidth)&&!this.renderer.forExport&&(this.scrollablePixels=h=Math.max(0,h-this.chartWidth))&&(this.plotWidth+=h,this.clipBox.width+=h,m.skipAxes||E(this.axes,function(f){1===f.side?f.getPlotLinePath=function(){var h=this.right,m;this.right=h-f.chart.scrollablePixels;m=a.Axis.prototype.getPlotLinePath.apply(this,arguments);this.right=h;return m}:(f.setAxisSize(),f.setAxisTranslation())}))});C(D,"render",function(){this.scrollablePixels?(this.setUpScrolling&&this.setUpScrolling(),this.applyFixed()):this.fixedDiv&&this.applyFixed()});D.prototype.setUpScrolling=function(){this.scrollingContainer=a.createElement("div",{className:"highcharts-scrolling"},{overflowX:"auto",WebkitOverflowScrolling:"touch"},this.renderTo);this.innerContainer=a.createElement("div",{className:"highcharts-inner-container"},null,this.scrollingContainer);this.innerContainer.appendChild(this.container);this.setUpScrolling=null};D.prototype.applyFixed=function(){var m=this.container,h,f,r=!this.fixedDiv;r&&(this.fixedDiv=a.createElement("div",{className:"highcharts-fixed"},{position:"absolute",overflow:"hidden",pointerEvents:"none",zIndex:2},null,!0),this.renderTo.insertBefore(this.fixedDiv,this.renderTo.firstChild),this.fixedRenderer=h=new a.Renderer(this.fixedDiv,0,0),this.scrollableMask=h.path().attr({fill:a.color(this.options.chart.backgroundColor||"#fff").setOpacity(.85).get(),zIndex:-1}).addClass("highcharts-scrollable-mask").add(),a.each([this.inverted?".highcharts-xaxis":".highcharts-yaxis",this.inverted?".highcharts-xaxis-labels":".highcharts-yaxis-labels",".highcharts-contextbutton",".highcharts-credits",".highcharts-legend",".highcharts-subtitle",".highcharts-title",".highcharts-legend-checkbox"],function(f){a.each(m.querySelectorAll(f),function(a){(a.namespaceURI===h.SVG_NS?h.box:h.box.parentNode).appendChild(a);a.style.pointerEvents="auto"})}));this.fixedRenderer.setSize(this.chartWidth,this.chartHeight);f=this.chartWidth+this.scrollablePixels;a.stop(this.container);this.container.style.width=f+"px";this.renderer.boxWrapper.attr({width:f,height:this.chartHeight,viewBox:[0,0,f,this.chartHeight].join(" ")});this.chartBackground.attr({width:f});r&&(f=this.options.chart.scrollablePlotArea,f.scrollPositionX&&(this.scrollingContainer.scrollLeft=this.scrollablePixels*f.scrollPositionX));r=this.axisOffset;f=this.plotTop-r[0]-1;var r=this.plotTop+this.plotHeight+r[2],y=this.plotLeft+this.plotWidth-this.scrollablePixels;this.scrollableMask.attr({d:this.scrollablePixels?["M",0,f,"L",this.plotLeft-1,f,"L",this.plotLeft-1,r,"L",0,r,"Z","M",y,f,"L",this.chartWidth,f,"L",this.chartWidth,r,"L",y,r,"Z"]:["M",0,0]})}})(K);(function(a){var C,D=a.each,E=a.extend,m=a.erase,h=a.fireEvent,f=a.format,r=a.isArray,y=a.isNumber,q=a.pick,w=a.removeEvent;a.Point=C=function(){};a.Point.prototype={init:function(a,c,f){this.series=a;this.color=a.color;this.applyOptions(c,f);a.options.colorByPoint?(c=a.options.colors||a.chart.options.colors,this.color=this.color||c[a.colorCounter],c=c.length,f=a.colorCounter,a.colorCounter++,a.colorCounter===c&&(a.colorCounter=0)):f=a.colorIndex;this.colorIndex=q(this.colorIndex,f);a.chart.pointCount++;h(this,"afterInit");return this},applyOptions:function(a,c){var e=this.series,f=e.options.pointValKey||e.pointValKey;a=C.prototype.optionsToObject.call(this,a);E(this,a);this.options=this.options?E(this.options,a):a;a.group&&delete this.group;f&&(this.y=this[f]);this.isNull=q(this.isValid&&!this.isValid(),null===this.x||!y(this.y,!0));this.selected&&(this.state="select");"name"in this&&void 0===c&&e.xAxis&&e.xAxis.hasNames&&(this.x=e.xAxis.nameToX(this));void 0===this.x&&e&&(this.x=void 0===c?e.autoIncrement(this):c);return this},setNestedProperty:function(e,c,f){f=f.split(".");a.reduce(f,function(e,f,d,b){e[f]=b.length-1===d?c:a.isObject(e[f],!0)?e[f]:{};return e[f]},e);return e},optionsToObject:function(e){var c={},f=this.series,h=f.options.keys,k=h||f.pointArrayMap||["y"],d=k.length,b=0,u=0;if(y(e)||null===e)c[k[0]]=e;else if(r(e))for(!h&&e.length>d&&(f=typeof e[0],"string"===f?c.name=e[0]:"number"===f&&(c.x=e[0]),b++);u<d;)h&&void 0===e[b]||(0<k[u].indexOf(".")?a.Point.prototype.setNestedProperty(c,e[b],k[u]):c[k[u]]=e[b]),b++,u++;else"object"===typeof e&&(c=e,e.dataLabels&&(f._hasPointLabels=!0),e.marker&&(f._hasPointMarkers=!0));return c},getClassName:function(){return"highcharts-point"+(this.selected?" highcharts-point-select":"")+(this.negative?" highcharts-negative":"")+(this.isNull?" highcharts-null-point":"")+(void 0!==this.colorIndex?" highcharts-color-"+this.colorIndex:"")+(this.options.className?" "+this.options.className:"")+(this.zone&&this.zone.className?" "+this.zone.className.replace("highcharts-negative",""):"")},getZone:function(){var a=this.series,c=a.zones,a=a.zoneAxis||"y",f=0,h;for(h=c[f];this[a]>=h.value;)h=c[++f];this.nonZonedColor||(this.nonZonedColor=this.color);this.color=h&&h.color&&!this.options.color?h.color:this.nonZonedColor;return h},destroy:function(){var a=this.series.chart,c=a.hoverPoints,f;a.pointCount--;c&&(this.setState(),m(c,this),c.length||(a.hoverPoints=null));if(this===a.hoverPoint)this.onMouseOut();if(this.graphic||this.dataLabel)w(this),this.destroyElements();this.legendItem&&a.legend.destroyItem(this);for(f in this)this[f]=null},destroyElements:function(){for(var a=["graphic","dataLabel","dataLabelUpper","connector","shadowGroup"],c,f=6;f--;)c=a[f],this[c]&&(this[c]=this[c].destroy())},getLabelConfig:function(){return{x:this.category,y:this.y,color:this.color,colorIndex:this.colorIndex,key:this.name||this.category,series:this.series,point:this,percentage:this.percentage,total:this.total||this.stackTotal}},tooltipFormatter:function(a){var c=this.series,e=c.tooltipOptions,h=q(e.valueDecimals,""),k=e.valuePrefix||"",d=e.valueSuffix||"";D(c.pointArrayMap||["y"],function(b){b="{point."+b;if(k||d)a=a.replace(RegExp(b+"}","g"),k+b+"}"+d);a=a.replace(RegExp(b+"}","g"),b+":,."+h+"f}")});return f(a,{point:this,series:this.series},c.chart.time)},firePointEvent:function(a,c,f){var e=this,k=this.series.options;(k.point.events[a]||e.options&&e.options.events&&e.options.events[a])&&this.importEvents();"click"===a&&k.allowPointSelect&&(f=function(a){e.select&&e.select(null,a.ctrlKey||a.metaKey||a.shiftKey)});h(this,a,c,f)},visible:!0}})(K);(function(a){var C=a.addEvent,D=a.animObject,E=a.arrayMax,m=a.arrayMin,h=a.correctFloat,f=a.defaultOptions,r=a.defaultPlotOptions,y=a.defined,q=a.each,w=a.erase,e=a.extend,c=a.fireEvent,l=a.grep,z=a.isArray,k=a.isNumber,d=a.isString,b=a.merge,u=a.objectEach,p=a.pick,H=a.removeEvent,t=a.splat,L=a.SVGElement,x=a.syncTimeout,I=a.win;a.Series=a.seriesType("line",null,{lineWidth:2,allowPointSelect:!1,showCheckbox:!1,animation:{duration:1e3},events:{},marker:{lineWidth:0,lineColor:"#ffffff",enabledThreshold:2,radius:4,states:{normal:{animation:!0},hover:{animation:{duration:50},enabled:!0,radiusPlus:2,lineWidthPlus:1},select:{fillColor:"#cccccc",lineColor:"#000000",lineWidth:2}}},point:{events:{}},dataLabels:{align:"center",formatter:function(){return null===this.y?"":a.numberFormat(this.y,-1)},style:{fontSize:"11px",fontWeight:"bold",color:"contrast",textOutline:"1px contrast"},verticalAlign:"bottom",x:0,y:0,padding:5},cropThreshold:300,pointRange:0,softThreshold:!0,states:{normal:{animation:!0},hover:{animation:{duration:50},lineWidthPlus:1,marker:{},halo:{size:10,opacity:.25}},select:{}},stickyTracking:!0,turboThreshold:1e3,findNearestPointBy:"x"},{isCartesian:!0,pointClass:a.Point,sorted:!0,requireSorting:!0,directTouch:!1,axisTypes:["xAxis","yAxis"],colorCounter:0,parallelArrays:["x","y"],coll:"series",init:function(a,b){var d=this,n,f=a.series,g;d.chart=a;d.options=b=d.setOptions(b);d.linkedSeries=[];d.bindAxes();e(d,{name:b.name,state:"",visible:!1!==b.visible,selected:!0===b.selected});n=b.events;u(n,function(a,b){C(d,b,a)});if(n&&n.click||b.point&&b.point.events&&b.point.events.click||b.allowPointSelect)a.runTrackerClick=!0;d.getColor();d.getSymbol();q(d.parallelArrays,function(a){d[a+"Data"]=[]});d.setData(b.data,!1);d.isCartesian&&(a.hasCartesianSeries=!0);f.length&&(g=f[f.length-1]);d._i=p(g&&g._i,-1)+1;a.orderSeries(this.insert(f));c(this,"afterInit")},insert:function(a){var b=this.options.index,c;if(k(b)){for(c=a.length;c--;)if(b>=p(a[c].options.index,a[c]._i)){a.splice(c+1,0,this);break}-1===c&&a.unshift(this);c+=1}else a.push(this);return p(c,a.length-1)},bindAxes:function(){var b=this,c=b.options,d=b.chart,e;q(b.axisTypes||[],function(f){q(d[f],function(a){e=a.options;if(c[f]===e.index||void 0!==c[f]&&c[f]===e.id||void 0===c[f]&&0===e.index)b.insert(a.series),b[f]=a,a.isDirty=!0});b[f]||b.optionalAxis===f||a.error(18,!0)})},updateParallelArrays:function(a,b){var c=a.series,d=arguments,e=k(b)?function(d){var g="y"===d&&c.toYData?c.toYData(a):a[d];c[d+"Data"][b]=g}:function(a){Array.prototype[b].apply(c[a+"Data"],Array.prototype.slice.call(d,2))};q(c.parallelArrays,e)},autoIncrement:function(){var a=this.options,b=this.xIncrement,c,d=a.pointIntervalUnit,e=this.chart.time,b=p(b,a.pointStart,0);this.pointInterval=c=p(this.pointInterval,a.pointInterval,1);d&&(a=new e.Date(b),"day"===d?e.set("Date",a,e.get("Date",a)+c):"month"===d?e.set("Month",a,e.get("Month",a)+c):"year"===d&&e.set("FullYear",a,e.get("FullYear",a)+c),c=a.getTime()-b);this.xIncrement=b+c;return b},setOptions:function(a){var d=this.chart,e=d.options,k=e.plotOptions,n=(d.userOptions||{}).plotOptions||{},g=k[this.type];this.userOptions=a;d=b(g,k.series,a);this.tooltipOptions=b(f.tooltip,f.plotOptions.series&&f.plotOptions.series.tooltip,f.plotOptions[this.type].tooltip,e.tooltip.userOptions,k.series&&k.series.tooltip,k[this.type].tooltip,a.tooltip);this.stickyTracking=p(a.stickyTracking,n[this.type]&&n[this.type].stickyTracking,n.series&&n.series.stickyTracking,this.tooltipOptions.shared&&!this.noSharedTooltip?!0:d.stickyTracking);null===g.marker&&delete d.marker;this.zoneAxis=d.zoneAxis;a=this.zones=(d.zones||[]).slice();!d.negativeColor&&!d.negativeFillColor||d.zones||a.push({value:d[this.zoneAxis+"Threshold"]||d.threshold||0,className:"highcharts-negative",color:d.negativeColor,fillColor:d.negativeFillColor});a.length&&y(a[a.length-1].value)&&a.push({color:this.color,fillColor:this.fillColor});c(this,"afterSetOptions",{options:d});return d},getName:function(){return this.name||"Series "+(this.index+1)},getCyclic:function(a,b,c){var d,e=this.chart,g=this.userOptions,f=a+"Index",k=a+"Counter",n=c?c.length:p(e.options.chart[a+"Count"],e[a+"Count"]);b||(d=p(g[f],g["_"+f]),y(d)||(e.series.length||(e[k]=0),g["_"+f]=d=e[k]%n,e[k]+=1),c&&(b=c[d]));void 0!==d&&(this[f]=d);this[a]=b},getColor:function(){this.options.colorByPoint?this.options.color=null:this.getCyclic("color",this.options.color||r[this.type].color,this.chart.options.colors)},getSymbol:function(){this.getCyclic("symbol",this.options.marker.symbol,this.chart.options.symbols)},drawLegendSymbol:a.LegendSymbolMixin.drawLineMarker,updateData:function(b){var c=this.options,d=this.points,e=[],f,g,n,h=this.requireSorting;q(b,function(b){var g;g=a.defined(b)&&this.pointClass.prototype.optionsToObject.call({series:this},b).x;k(g)&&(g=a.inArray(g,this.xData,n),-1===g?e.push(b):b!==c.data[g]?(d[g].update(b,!1,null,!1),d[g].touched=!0,h&&(n=g)):d[g]&&(d[g].touched=!0),f=!0)},this);if(f)for(b=d.length;b--;)g=d[b],g.touched||g.remove(!1),g.touched=!1;else if(b.length===d.length)q(b,function(a,b){d[b].update&&a!==c.data[b]&&d[b].update(a,!1,null,!1)});else return!1;q(e,function(a){this.addPoint(a,!1)},this);return!0},setData:function(b,c,e,f){var n=this,g=n.points,h=g&&g.length||0,l,B=n.options,G=n.chart,t=null,x=n.xAxis,u=B.turboThreshold,m=this.xData,r=this.yData,w=(l=n.pointArrayMap)&&l.length,y;b=b||[];l=b.length;c=p(c,!0);!1!==f&&l&&h&&!n.cropped&&!n.hasGroupedData&&n.visible&&!n.isSeriesBoosting&&(y=this.updateData(b));if(!y){n.xIncrement=null;n.colorCounter=0;q(this.parallelArrays,function(a){n[a+"Data"].length=0});if(u&&l>u){for(e=0;null===t&&e<l;)t=b[e],e++;if(k(t))for(e=0;e<l;e++)m[e]=this.autoIncrement(),r[e]=b[e];else if(z(t))if(w)for(e=0;e<l;e++)t=b[e],m[e]=t[0],r[e]=t.slice(1,w+1);else for(e=0;e<l;e++)t=b[e],m[e]=t[0],r[e]=t[1];else a.error(12)}else for(e=0;e<l;e++)void 0!==b[e]&&(t={series:n},n.pointClass.prototype.applyOptions.apply(t,[b[e]]),n.updateParallelArrays(t,e));r&&d(r[0])&&a.error(14,!0);n.data=[];n.options.data=n.userOptions.data=b;for(e=h;e--;)g[e]&&g[e].destroy&&g[e].destroy();x&&(x.minRange=x.userMinRange);n.isDirty=G.isDirtyBox=!0;n.isDirtyData=!!g;e=!1}"point"===B.legendType&&(this.processData(),this.generatePoints());c&&G.redraw(e)},processData:function(b){var c=this.xData,d=this.yData,e=c.length,f;f=0;var g,k,n=this.xAxis,h,l=this.options;h=l.cropThreshold;var p=this.getExtremesFromAll||l.getExtremesFromAll,t=this.isCartesian,l=n&&n.val2lin,x=n&&n.isLog,u=this.requireSorting,m,z;if(t&&!this.isDirty&&!n.isDirty&&!this.yAxis.isDirty&&!b)return!1;n&&(b=n.getExtremes(),m=b.min,z=b.max);t&&this.sorted&&!p&&(!h||e>h||this.forceCrop)&&(c[e-1]<m||c[0]>z?(c=[],d=[]):this.yData&&(c[0]<m||c[e-1]>z)&&(f=this.cropData(this.xData,this.yData,m,z),c=f.xData,d=f.yData,f=f.start,g=!0));for(h=c.length||1;--h;)e=x?l(c[h])-l(c[h-1]):c[h]-c[h-1],0<e&&(void 0===k||e<k)?k=e:0>e&&u&&(a.error(15),u=!1);this.cropped=g;this.cropStart=f;this.processedXData=c;this.processedYData=d;this.closestPointRange=k},cropData:function(a,b,c,d,e){var g=a.length,f=0,k=g,n;e=p(e,this.cropShoulder,1);for(n=0;n<g;n++)if(a[n]>=c){f=Math.max(0,n-e);break}for(c=n;c<g;c++)if(a[c]>d){k=c+e;break}return{xData:a.slice(f,k),yData:b.slice(f,k),start:f,end:k}},generatePoints:function(){var a=this.options,b=a.data,c=this.data,d,e=this.processedXData,g=this.processedYData,f=this.pointClass,k=e.length,h=this.cropStart||0,l,p=this.hasGroupedData,a=a.keys,x,u=[],m;c||p||(c=[],c.length=b.length,c=this.data=c);a&&p&&(this.options.keys=!1);for(m=0;m<k;m++)l=h+m,p?(x=(new f).init(this,[e[m]].concat(t(g[m]))),x.dataGroup=this.groupMap[m]):(x=c[l])||void 0===b[l]||(c[l]=x=(new f).init(this,b[l],e[m])),x&&(x.index=l,u[m]=x);this.options.keys=a;if(c&&(k!==(d=c.length)||p))for(m=0;m<d;m++)m!==h||p||(m+=k),c[m]&&(c[m].destroyElements(),c[m].plotX=void 0);this.data=c;this.points=u},getExtremes:function(a){var b=this.yAxis,c=this.processedXData,d,e=[],g=0;d=this.xAxis.getExtremes();var f=d.min,n=d.max,h,l,p=this.requireSorting?1:0,t,x;a=a||this.stackedYData||this.processedYData||[];d=a.length;for(x=0;x<d;x++)if(l=c[x],t=a[x],h=(k(t,!0)||z(t))&&(!b.positiveValuesOnly||t.length||0<t),l=this.getExtremesFromAll||this.options.getExtremesFromAll||this.cropped||(c[x+p]||l)>=f&&(c[x-p]||l)<=n,h&&l)if(h=t.length)for(;h--;)"number"===typeof t[h]&&(e[g++]=t[h]);else e[g++]=t;this.dataMin=m(e);this.dataMax=E(e)},translate:function(){this.processedXData||this.processData();this.generatePoints();var a=this.options,b=a.stacking,d=this.xAxis,e=d.categories,f=this.yAxis,g=this.points,l=g.length,t=!!this.modifyValue,x=a.pointPlacement,m="between"===x||k(x),u=a.threshold,z=a.startFromThreshold?u:0,q,r,w,I,H=Number.MAX_VALUE;"between"===x&&(x=.5);k(x)&&(x*=p(a.pointRange||d.pointRange));for(a=0;a<l;a++){var L=g[a],C=L.x,D=L.y;r=L.low;var E=b&&f.stacks[(this.negStacks&&D<(z?0:u)?"-":"")+this.stackKey],K;f.positiveValuesOnly&&null!==D&&0>=D&&(L.isNull=!0);L.plotX=q=h(Math.min(Math.max(-1e5,d.translate(C,0,0,0,1,x,"flags"===this.type)),1e5));b&&this.visible&&!L.isNull&&E&&E[C]&&(I=this.getStackIndicator(I,C,this.index),K=E[C],D=K.points[I.key],r=D[0],D=D[1],r===z&&I.key===E[C].base&&(r=p(k(u)&&u,f.min)),f.positiveValuesOnly&&0>=r&&(r=null),L.total=L.stackTotal=K.total,L.percentage=K.total&&L.y/K.total*100,L.stackY=D,K.setOffset(this.pointXOffset||0,this.barW||0));L.yBottom=y(r)?Math.min(Math.max(-1e5,f.translate(r,0,1,0,1)),1e5):null;t&&(D=this.modifyValue(D,L));L.plotY=r="number"===typeof D&&Infinity!==D?Math.min(Math.max(-1e5,f.translate(D,0,1,0,1)),1e5):void 0;L.isInside=void 0!==r&&0<=r&&r<=f.len&&0<=q&&q<=d.len;L.clientX=m?h(d.translate(C,0,0,0,1,x)):q;L.negative=L.y<(u||0);L.category=e&&void 0!==e[L.x]?e[L.x]:L.x;L.isNull||(void 0!==w&&(H=Math.min(H,Math.abs(q-w))),w=q);L.zone=this.zones.length&&L.getZone()}this.closestPointRangePx=H;c(this,"afterTranslate")},getValidPoints:function(a,b){var c=this.chart;return l(a||this.points||[],function(a){return b&&!c.isInsidePlot(a.plotX,a.plotY,c.inverted)?!1:!a.isNull})},setClip:function(a){var b=this.chart,c=this.options,d=b.renderer,e=b.inverted,g=this.clipBox,f=g||b.clipBox,k=this.sharedClipKey||["_sharedClip",a&&a.duration,a&&a.easing,f.height,c.xAxis,c.yAxis].join(),n=b[k],h=b[k+"m"];n||(a&&(f.width=0,e&&(f.x=b.plotSizeX),b[k+"m"]=h=d.clipRect(e?b.plotSizeX+99:-99,e?-b.plotLeft:-b.plotTop,99,e?b.chartWidth:b.chartHeight)),b[k]=n=d.clipRect(f),n.count={length:0});a&&!n.count[this.index]&&(n.count[this.index]=!0,n.count.length+=1);!1!==c.clip&&(this.group.clip(a||g?n:b.clipRect),this.markerGroup.clip(h),this.sharedClipKey=k);a||(n.count[this.index]&&(delete n.count[this.index],--n.count.length),0===n.count.length&&k&&b[k]&&(g||(b[k]=b[k].destroy()),b[k+"m"]&&(b[k+"m"]=b[k+"m"].destroy())))},animate:function(a){var b=this.chart,c=D(this.options.animation),d;a?this.setClip(c):(d=this.sharedClipKey,(a=b[d])&&a.animate({width:b.plotSizeX,x:0},c),b[d+"m"]&&b[d+"m"].animate({width:b.plotSizeX+99,x:0},c),this.animate=null)},afterAnimate:function(){this.setClip();c(this,"afterAnimate");this.finishedAnimating=!0},drawPoints:function(){var a=this.points,b=this.chart,c,d,e,g,f=this.options.marker,k,h,l,t=this[this.specialGroup]||this.markerGroup,x,m=p(f.enabled,this.xAxis.isRadial?!0:null,this.closestPointRangePx>=f.enabledThreshold*f.radius);if(!1!==f.enabled||this._hasPointMarkers)for(c=0;c<a.length;c++)d=a[c],g=d.graphic,k=d.marker||{},h=!!d.marker,e=m&&void 0===k.enabled||k.enabled,l=d.isInside,e&&!d.isNull?(e=p(k.symbol,this.symbol),x=this.markerAttribs(d,d.selected&&"select"),g?g[l?"show":"hide"](!0).animate(x):l&&(0<x.width||d.hasImage)&&(d.graphic=g=b.renderer.symbol(e,x.x,x.y,x.width,x.height,h?k:f).add(t)),g&&g.attr(this.pointAttribs(d,d.selected&&"select")),g&&g.addClass(d.getClassName(),!0)):g&&(d.graphic=g.destroy())},markerAttribs:function(a,b){var c=this.options.marker,d=a.marker||{},e=d.symbol||c.symbol,g=p(d.radius,c.radius);b&&(c=c.states[b],b=d.states&&d.states[b],g=p(b&&b.radius,c&&c.radius,g+(c&&c.radiusPlus||0)));a.hasImage=e&&0===e.indexOf("url");a.hasImage&&(g=0);a={x:Math.floor(a.plotX)-g,y:a.plotY-g};g&&(a.width=a.height=2*g);return a},pointAttribs:function(a,b){var c=this.options.marker,d=a&&a.options,e=d&&d.marker||{},g=this.color,f=d&&d.color,k=a&&a.color,d=p(e.lineWidth,c.lineWidth);a=a&&a.zone&&a.zone.color;g=f||a||k||g;a=e.fillColor||c.fillColor||g;g=e.lineColor||c.lineColor||g;b&&(c=c.states[b],b=e.states&&e.states[b]||{},d=p(b.lineWidth,c.lineWidth,d+p(b.lineWidthPlus,c.lineWidthPlus,0)),a=b.fillColor||c.fillColor||a,g=b.lineColor||c.lineColor||g);return{stroke:g,"stroke-width":d,fill:a}},destroy:function(){var b=this,d=b.chart,e=/AppleWebKit\/533/.test(I.navigator.userAgent),f,k,g=b.data||[],h,l;c(b,"destroy");H(b);q(b.axisTypes||[],function(a){(l=b[a])&&l.series&&(w(l.series,b),l.isDirty=l.forceRedraw=!0)});b.legendItem&&b.chart.legend.destroyItem(b);for(k=g.length;k--;)(h=g[k])&&h.destroy&&h.destroy();b.points=null;a.clearTimeout(b.animationTimeout);u(b,function(a,b){a instanceof L&&!a.survive&&(f=e&&"group"===b?"hide":"destroy",a[f]())});d.hoverSeries===b&&(d.hoverSeries=null);w(d.series,b);d.orderSeries();u(b,function(a,c){delete b[c]})},getGraphPath:function(a,b,c){var d=this,e=d.options,g=e.step,f,k=[],n=[],h;a=a||d.points;(f=a.reversed)&&a.reverse();(g={right:1,center:2}[g]||g&&3)&&f&&(g=4-g);!e.connectNulls||b||c||(a=this.getValidPoints(a));q(a,function(f,l){var p=f.plotX,t=f.plotY,x=a[l-1];(f.leftCliff||x&&x.rightCliff)&&!c&&(h=!0);f.isNull&&!y(b)&&0<l?h=!e.connectNulls:f.isNull&&!b?h=!0:(0===l||h?l=["M",f.plotX,f.plotY]:d.getPointSpline?l=d.getPointSpline(a,f,l):g?(l=1===g?["L",x.plotX,t]:2===g?["L",(x.plotX+p)/2,x.plotY,"L",(x.plotX+p)/2,t]:["L",p,x.plotY],l.push("L",p,t)):l=["L",p,t],n.push(f.x),g&&(n.push(f.x),2===g&&n.push(f.x)),k.push.apply(k,l),h=!1)});k.xMap=n;return d.graphPath=k},drawGraph:function(){var a=this,b=this.options,c=(this.gappedPath||this.getGraphPath).call(this),d=[["graph","highcharts-graph",b.lineColor||this.color,b.dashStyle]],d=a.getZonesGraphs(d);q(d,function(d,e){var g=d[0],f=a[g];f?(f.endX=a.preventGraphAnimation?null:c.xMap,f.animate({d:c})):c.length&&(a[g]=a.chart.renderer.path(c).addClass(d[1]).attr({zIndex:1}).add(a.group),f={stroke:d[2],"stroke-width":b.lineWidth,fill:a.fillGraph&&a.color||"none"},d[3]?f.dashstyle=d[3]:"square"!==b.linecap&&(f["stroke-linecap"]=f["stroke-linejoin"]="round"),f=a[g].attr(f).shadow(2>e&&b.shadow));f&&(f.startX=c.xMap,f.isArea=c.isArea)})},getZonesGraphs:function(a){q(this.zones,function(b,c){a.push(["zone-graph-"+c,"highcharts-graph highcharts-zone-graph-"+c+" "+(b.className||""),b.color||this.color,b.dashStyle||this.options.dashStyle])},this);return a},applyZones:function(){var a=this,b=this.chart,c=b.renderer,d=this.zones,e,g,f=this.clips||[],k,h=this.graph,l=this.area,t=Math.max(b.chartWidth,b.chartHeight),x=this[(this.zoneAxis||"y")+"Axis"],m,u,z=b.inverted,r,w,y,I,H=!1;d.length&&(h||l)&&x&&void 0!==x.min&&(u=x.reversed,r=x.horiz,h&&!this.showLine&&h.hide(),l&&l.hide(),m=x.getExtremes(),q(d,function(d,n){e=u?r?b.plotWidth:0:r?0:x.toPixels(m.min);e=Math.min(Math.max(p(g,e),0),t);g=Math.min(Math.max(Math.round(x.toPixels(p(d.value,m.max),!0)),0),t);H&&(e=g=x.toPixels(m.max));w=Math.abs(e-g);y=Math.min(e,g);I=Math.max(e,g);x.isXAxis?(k={x:z?I:y,y:0,width:w,height:t},r||(k.x=b.plotHeight-k.x)):(k={x:0,y:z?I:y,width:t,height:w},r&&(k.y=b.plotWidth-k.y));z&&c.isVML&&(k=x.isXAxis?{x:0,y:u?y:I,height:k.width,width:b.chartWidth}:{x:k.y-b.plotLeft-b.spacingBox.x,y:0,width:k.height,height:b.chartHeight});f[n]?f[n].animate(k):(f[n]=c.clipRect(k),h&&a["zone-graph-"+n].clip(f[n]),l&&a["zone-area-"+n].clip(f[n]));H=d.value>m.max;a.resetZones&&0===g&&(g=void 0)}),this.clips=f)},invertGroups:function(a){function b(){q(["group","markerGroup"],function(b){c[b]&&(d.renderer.isVML&&c[b].attr({width:c.yAxis.len,height:c.xAxis.len}),c[b].width=c.yAxis.len,c[b].height=c.xAxis.len,c[b].invert(a))})}var c=this,d=c.chart,e;c.xAxis&&(e=C(d,"resize",b),C(c,"destroy",e),b(a),c.invertGroups=b)},plotGroup:function(a,b,c,d,e){var g=this[a],f=!g;f&&(this[a]=g=this.chart.renderer.g().attr({zIndex:d||.1}).add(e));g.addClass("highcharts-"+b+" highcharts-series-"+this.index+" highcharts-"+this.type+"-series "+(y(this.colorIndex)?"highcharts-color-"+this.colorIndex+" ":"")+(this.options.className||"")+(g.hasClass("highcharts-tracker")?" highcharts-tracker":""),!0);g.attr({visibility:c})[f?"attr":"animate"](this.getPlotBox());return g},getPlotBox:function(){var a=this.chart,b=this.xAxis,c=this.yAxis;a.inverted&&(b=c,c=this.xAxis);return{translateX:b?b.left:a.plotLeft,translateY:c?c.top:a.plotTop,scaleX:1,scaleY:1}},render:function(){var a=this,b=a.chart,d,e=a.options,f=!!a.animate&&b.renderer.isSVG&&D(e.animation).duration,g=a.visible?"inherit":"hidden",k=e.zIndex,h=a.hasRendered,l=b.seriesGroup,p=b.inverted;d=a.plotGroup("group","series",g,k,l);a.markerGroup=a.plotGroup("markerGroup","markers",g,k,l);f&&a.animate(!0);d.inverted=a.isCartesian?p:!1;a.drawGraph&&(a.drawGraph(),a.applyZones());a.drawDataLabels&&a.drawDataLabels();a.visible&&a.drawPoints();a.drawTracker&&!1!==a.options.enableMouseTracking&&a.drawTracker();a.invertGroups(p);!1===e.clip||a.sharedClipKey||h||d.clip(b.clipRect);f&&a.animate();h||(a.animationTimeout=x(function(){a.afterAnimate()},f));a.isDirty=!1;a.hasRendered=!0;c(a,"afterRender")},redraw:function(){var a=this.chart,b=this.isDirty||this.isDirtyData,c=this.group,d=this.xAxis,e=this.yAxis;c&&(a.inverted&&c.attr({width:a.plotWidth,height:a.plotHeight}),c.animate({translateX:p(d&&d.left,a.plotLeft),translateY:p(e&&e.top,a.plotTop)}));this.translate();this.render();b&&delete this.kdTree},kdAxisArray:["clientX","plotY"],searchPoint:function(a,b){var c=this.xAxis,d=this.yAxis,e=this.chart.inverted;return this.searchKDTree({clientX:e?c.len-a.chartY+c.pos:a.chartX-c.pos,plotY:e?d.len-a.chartX+d.pos:a.chartY-d.pos},b)},buildKDTree:function(){function a(c,d,e){var g,f;if(f=c&&c.length)return g=b.kdAxisArray[d%e],c.sort(function(a,b){return a[g]-b[g]}),f=Math.floor(f/2),{point:c[f],left:a(c.slice(0,f),d+1,e),right:a(c.slice(f+1),d+1,e)}}this.buildingKdTree=!0;var b=this,c=-1<b.options.findNearestPointBy.indexOf("y")?2:1;delete b.kdTree;x(function(){b.kdTree=a(b.getValidPoints(null,!b.directTouch),c,c);b.buildingKdTree=!1},b.options.kdNow?0:1)},searchKDTree:function(a,b){function c(a,b,k,h){var l=b.point,n=d.kdAxisArray[k%h],p,t,x=l;t=y(a[e])&&y(l[e])?Math.pow(a[e]-l[e],2):null;p=y(a[g])&&y(l[g])?Math.pow(a[g]-l[g],2):null;p=(t||0)+(p||0);l.dist=y(p)?Math.sqrt(p):Number.MAX_VALUE;l.distX=y(t)?Math.sqrt(t):Number.MAX_VALUE;n=a[n]-l[n];p=0>n?"left":"right";t=0>n?"right":"left";b[p]&&(p=c(a,b[p],k+1,h),x=p[f]<x[f]?p:l);b[t]&&Math.sqrt(n*n)<x[f]&&(a=c(a,b[t],k+1,h),x=a[f]<x[f]?a:x);return x}var d=this,e=this.kdAxisArray[0],g=this.kdAxisArray[1],f=b?"distX":"dist";b=-1<d.options.findNearestPointBy.indexOf("y")?2:1;this.kdTree||this.buildingKdTree||this.buildKDTree();if(this.kdTree)return c(a,this.kdTree,b,b)}})})(K);(function(a){var C=a.Axis,D=a.Chart,E=a.correctFloat,m=a.defined,h=a.destroyObjectProperties,f=a.each,r=a.format,y=a.objectEach,q=a.pick,w=a.Series;a.StackItem=function(a,c,f,h,k){var d=a.chart.inverted;this.axis=a;this.isNegative=f;this.options=c;this.x=h;this.total=null;this.points={};this.stack=k;this.rightCliff=this.leftCliff=0;this.alignOptions={align:c.align||(d?f?"left":"right":"center"),verticalAlign:c.verticalAlign||(d?"middle":f?"bottom":"top"),y:q(c.y,d?4:f?14:-6),x:q(c.x,d?f?-6:6:0)};this.textAlign=c.textAlign||(d?f?"right":"left":"center")};a.StackItem.prototype={destroy:function(){h(this,this.axis)},render:function(a){var c=this.axis.chart,e=this.options,f=e.format,f=f?r(f,this,c.time):e.formatter.call(this);this.label?this.label.attr({text:f,visibility:"hidden"}):this.label=c.renderer.text(f,null,null,e.useHTML).css(e.style).attr({align:this.textAlign,rotation:e.rotation,visibility:"hidden"}).add(a);this.label.labelrank=c.plotHeight},setOffset:function(a,c){var e=this.axis,f=e.chart,k=e.translate(e.usePercentage?100:this.total,0,0,0,1),d=e.translate(0),d=m(k)&&Math.abs(k-d);a=f.xAxis[0].translate(this.x)+a;e=m(k)&&this.getStackBox(f,this,a,k,c,d,e);(c=this.label)&&e&&(c.align(this.alignOptions,null,e),e=c.alignAttr,c[!1===this.options.crop||f.isInsidePlot(e.x,e.y)?"show":"hide"](!0))},getStackBox:function(a,c,f,h,k,d,b){var e=c.axis.reversed,l=a.inverted;a=b.height+b.pos-(l?a.plotLeft:a.plotTop);c=c.isNegative&&!e||!c.isNegative&&e;return{x:l?c?h:h-d:f,y:l?a-f-k:c?a-h-d:a-h,width:l?d:k,height:l?k:d}}};D.prototype.getStacks=function(){var a=this;f(a.yAxis,function(a){a.stacks&&a.hasVisibleSeries&&(a.oldStacks=a.stacks)});f(a.series,function(c){!c.options.stacking||!0!==c.visible&&!1!==a.options.chart.ignoreHiddenSeries||(c.stackKey=c.type+q(c.options.stack,""))})};C.prototype.buildStacks=function(){var a=this.series,c=q(this.options.reversedStacks,!0),f=a.length,h;if(!this.isXAxis){this.usePercentage=!1;for(h=f;h--;)a[c?h:f-h-1].setStackedPoints();for(h=0;h<f;h++)a[h].modifyStacks()}};C.prototype.renderStackTotals=function(){var a=this.chart,c=a.renderer,f=this.stacks,h=this.stackTotalGroup;h||(this.stackTotalGroup=h=c.g("stack-labels").attr({visibility:"visible",zIndex:6}).add());h.translate(a.plotLeft,a.plotTop);y(f,function(a){y(a,function(a){a.render(h)})})};C.prototype.resetStacks=function(){var a=this,c=a.stacks;a.isXAxis||y(c,function(c){y(c,function(e,f){e.touched<a.stacksTouched?(e.destroy(),delete c[f]):(e.total=null,e.cumulative=null)})})};C.prototype.cleanStacks=function(){var a;this.isXAxis||(this.oldStacks&&(a=this.stacks=this.oldStacks),y(a,function(a){y(a,function(a){a.cumulative=a.total})}))};w.prototype.setStackedPoints=function(){if(this.options.stacking&&(!0===this.visible||!1===this.chart.options.chart.ignoreHiddenSeries)){var e=this.processedXData,c=this.processedYData,f=[],h=c.length,k=this.options,d=k.threshold,b=q(k.startFromThreshold&&d,0),u=k.stack,k=k.stacking,p=this.stackKey,r="-"+p,t=this.negStacks,w=this.yAxis,x=w.stacks,y=w.oldStacks,n,G,B,M,F,g,v;w.stacksTouched+=1;for(F=0;F<h;F++)g=e[F],v=c[F],n=this.getStackIndicator(n,g,this.index),M=n.key,B=(G=t&&v<(b?0:d))?r:p,x[B]||(x[B]={}),x[B][g]||(y[B]&&y[B][g]?(x[B][g]=y[B][g],x[B][g].total=null):x[B][g]=new a.StackItem(w,w.options.stackLabels,G,g,u)),B=x[B][g],null!==v?(B.points[M]=B.points[this.index]=[q(B.cumulative,b)],m(B.cumulative)||(B.base=M),B.touched=w.stacksTouched,0<n.index&&!1===this.singleStacks&&(B.points[M][0]=B.points[this.index+","+g+",0"][0])):B.points[M]=B.points[this.index]=null,"percent"===k?(G=G?p:r,t&&x[G]&&x[G][g]?(G=x[G][g],B.total=G.total=Math.max(G.total,B.total)+Math.abs(v)||0):B.total=E(B.total+(Math.abs(v)||0))):B.total=E(B.total+(v||0)),B.cumulative=q(B.cumulative,b)+(v||0),null!==v&&(B.points[M].push(B.cumulative),f[F]=B.cumulative);"percent"===k&&(w.usePercentage=!0);this.stackedYData=f;w.oldStacks={}}};w.prototype.modifyStacks=function(){var a=this,c=a.stackKey,h=a.yAxis.stacks,m=a.processedXData,k,d=a.options.stacking;a[d+"Stacker"]&&f([c,"-"+c],function(b){for(var c=m.length,e,f;c--;)if(e=m[c],k=a.getStackIndicator(k,e,a.index,b),f=(e=h[b]&&h[b][e])&&e.points[k.key])a[d+"Stacker"](f,e,c)})};w.prototype.percentStacker=function(a,c,f){c=c.total?100/c.total:0;a[0]=E(a[0]*c);a[1]=E(a[1]*c);this.stackedYData[f]=a[1]};w.prototype.getStackIndicator=function(a,c,f,h){!m(a)||a.x!==c||h&&a.key!==h?a={x:c,index:0,key:h}:a.index++;a.key=[f,c,a.index].join();return a}})(K);(function(a){var C=a.addEvent,D=a.animate,E=a.Axis,m=a.createElement,h=a.css,f=a.defined,r=a.each,y=a.erase,q=a.extend,w=a.fireEvent,e=a.inArray,c=a.isNumber,l=a.isObject,z=a.isArray,k=a.merge,d=a.objectEach,b=a.pick,u=a.Point,p=a.Series,H=a.seriesTypes,t=a.setAnimation,L=a.splat;q(a.Chart.prototype,{addSeries:function(a,c,d){var e,f=this;a&&(c=b(c,!0),w(f,"addSeries",{options:a},function(){e=f.initSeries(a);f.isDirtyLegend=!0;f.linkSeries();w(f,"afterAddSeries");c&&f.redraw(d)}));return e},addAxis:function(a,c,d,e){var f=c?"xAxis":"yAxis",h=this.options;a=k(a,{index:this[f].length,isX:c});c=new E(this,a);h[f]=L(h[f]||{});h[f].push(a);b(d,!0)&&this.redraw(e);return c},showLoading:function(a){var b=this,c=b.options,d=b.loadingDiv,e=c.loading,f=function(){d&&h(d,{left:b.plotLeft+"px",top:b.plotTop+"px",width:b.plotWidth+"px",height:b.plotHeight+"px"})};d||(b.loadingDiv=d=m("div",{className:"highcharts-loading highcharts-loading-hidden"},null,b.container),b.loadingSpan=m("span",{className:"highcharts-loading-inner"},null,d),C(b,"redraw",f));d.className="highcharts-loading";b.loadingSpan.innerHTML=a||c.lang.loading;h(d,q(e.style,{zIndex:10}));h(b.loadingSpan,e.labelStyle);b.loadingShown||(h(d,{opacity:0,display:""}),D(d,{opacity:e.style.opacity||.5},{duration:e.showDuration||0}));b.loadingShown=!0;f()},hideLoading:function(){var a=this.options,b=this.loadingDiv;b&&(b.className="highcharts-loading highcharts-loading-hidden",D(b,{opacity:0},{duration:a.loading.hideDuration||100,complete:function(){h(b,{display:"none"})}}));this.loadingShown=!1},propsRequireDirtyBox:"backgroundColor borderColor borderWidth margin marginTop marginRight marginBottom marginLeft spacing spacingTop spacingRight spacingBottom spacingLeft borderRadius plotBackgroundColor plotBackgroundImage plotBorderColor plotBorderWidth plotShadow shadow".split(" "),propsRequireUpdateSeries:"chart.inverted chart.polar chart.ignoreHiddenSeries chart.type colors plotOptions time tooltip".split(" "),update:function(a,h,l,p){var n=this,t={credits:"addCredits",title:"setTitle",subtitle:"setSubtitle"},x=a.chart,g,m,u=[];w(n,"update",{options:a});if(x){k(!0,n.options.chart,x);"className"in x&&n.setClassName(x.className);"reflow"in x&&n.setReflow(x.reflow);if("inverted"in x||"polar"in x||"type"in x)n.propFromSeries(),g=!0;"alignTicks"in x&&(g=!0);d(x,function(a,b){-1!==e("chart."+b,n.propsRequireUpdateSeries)&&(m=!0);-1!==e(b,n.propsRequireDirtyBox)&&(n.isDirtyBox=!0)});"style"in x&&n.renderer.setStyle(x.style)}a.colors&&(this.options.colors=a.colors);a.plotOptions&&k(!0,this.options.plotOptions,a.plotOptions);d(a,function(a,b){if(n[b]&&"function"===typeof n[b].update)n[b].update(a,!1);else if("function"===typeof n[t[b]])n[t[b]](a);"chart"!==b&&-1!==e(b,n.propsRequireUpdateSeries)&&(m=!0)});r("xAxis yAxis zAxis series colorAxis pane".split(" "),function(b){var c;a[b]&&("series"===b&&(c=[],r(n[b],function(a,b){a.options.isInternal||c.push(b)})),r(L(a[b]),function(a,d){(d=f(a.id)&&n.get(a.id)||n[b][c?c[d]:d])&&d.coll===b&&(d.update(a,!1),l&&(d.touched=!0));if(!d&&l)if("series"===b)n.addSeries(a,!1).touched=!0;else if("xAxis"===b||"yAxis"===b)n.addAxis(a,"xAxis"===b,!1).touched=!0}),l&&r(n[b],function(a){a.touched||a.options.isInternal?delete a.touched:u.push(a)}))});r(u,function(a){a.remove(!1)});g&&r(n.axes,function(a){a.update({},!1)});m&&r(n.series,function(a){a.update({},!1)});a.loading&&k(!0,n.options.loading,a.loading);g=x&&x.width;x=x&&x.height;c(g)&&g!==n.chartWidth||c(x)&&x!==n.chartHeight?n.setSize(g,x,p):b(h,!0)&&n.redraw(p);w(n,"afterUpdate",{options:a})},setSubtitle:function(a){this.setTitle(void 0,a)}});q(u.prototype,{update:function(a,c,d,e){function f(){k.applyOptions(a);null===k.y&&g&&(k.graphic=g.destroy());l(a,!0)&&(g&&g.element&&a&&a.marker&&void 0!==a.marker.symbol&&(k.graphic=g.destroy()),a&&a.dataLabels&&k.dataLabel&&(k.dataLabel=k.dataLabel.destroy()),k.connector&&(k.connector=k.connector.destroy()));n=k.index;h.updateParallelArrays(k,n);t.data[n]=l(t.data[n],!0)||l(a,!0)?k.options:b(a,t.data[n]);h.isDirty=h.isDirtyData=!0;!h.fixedBox&&h.hasCartesianSeries&&(p.isDirtyBox=!0);"point"===t.legendType&&(p.isDirtyLegend=!0);c&&p.redraw(d)}var k=this,h=k.series,g=k.graphic,n,p=h.chart,t=h.options;c=b(c,!0);!1===e?f():k.firePointEvent("update",{options:a},f)},remove:function(a,b){this.series.removePoint(e(this,this.series.data),a,b)}});q(p.prototype,{addPoint:function(a,c,d,e){var f=this.options,k=this.data,h=this.chart,g=this.xAxis,g=g&&g.hasNames&&g.names,n=f.data,l,p,t=this.xData,x,m;c=b(c,!0);l={series:this};this.pointClass.prototype.applyOptions.apply(l,[a]);m=l.x;x=t.length;if(this.requireSorting&&m<t[x-1])for(p=!0;x&&t[x-1]>m;)x--;this.updateParallelArrays(l,"splice",x,0,0);this.updateParallelArrays(l,x);g&&l.name&&(g[m]=l.name);n.splice(x,0,a);p&&(this.data.splice(x,0,null),this.processData());"point"===f.legendType&&this.generatePoints();d&&(k[0]&&k[0].remove?k[0].remove(!1):(k.shift(),this.updateParallelArrays(l,"shift"),n.shift()));this.isDirtyData=this.isDirty=!0;c&&h.redraw(e)},removePoint:function(a,c,d){var e=this,f=e.data,k=f[a],h=e.points,g=e.chart,n=function(){h&&h.length===f.length&&h.splice(a,1);f.splice(a,1);e.options.data.splice(a,1);e.updateParallelArrays(k||{series:e},"splice",a,1);k&&k.destroy();e.isDirty=!0;e.isDirtyData=!0;c&&g.redraw()};t(d,g);c=b(c,!0);k?k.firePointEvent("remove",null,n):n()},remove:function(a,c,d){function e(){f.destroy();k.isDirtyLegend=k.isDirtyBox=!0;k.linkSeries();b(a,!0)&&k.redraw(c)}var f=this,k=f.chart;!1!==d?w(f,"remove",null,e):e()},update:function(c,d){var f=this,h=f.chart,l=f.userOptions,p=f.oldType||f.type,t=c.type||l.type||h.options.chart.type,g=H[p].prototype,x,m=["group","markerGroup","dataLabelsGroup"],u=["navigatorSeries","baseSeries"],z=f.finishedAnimating&&{animation:!1},y=["data","name","turboThreshold"],I=a.keys(c),A=0<I.length;r(I,function(a){-1===e(a,y)&&(A=!1)});if(A)c.data&&this.setData(c.data,!1),c.name&&this.setName(c.name,!1);else{u=m.concat(u);r(u,function(a){u[a]=f[a];delete f[a]});c=k(l,z,{index:f.index,pointStart:b(l.pointStart,f.xData[0])},{data:f.options.data},c);f.remove(!1,null,!1);for(x in g)f[x]=void 0;H[t||p]?q(f,H[t||p].prototype):a.error(17,!0);r(u,function(a){f[a]=u[a]});f.init(h,c);c.zIndex!==l.zIndex&&r(m,function(a){f[a]&&f[a].attr({zIndex:c.zIndex})});f.oldType=p;h.linkSeries()}w(this,"afterUpdate");b(d,!0)&&h.redraw(!1)},setName:function(a){this.name=this.options.name=this.userOptions.name=a;this.chart.isDirtyLegend=!0}});q(E.prototype,{update:function(a,c){var e=this.chart,f=a&&a.events||{};a=k(this.userOptions,a);e.options[this.coll].indexOf&&(e.options[this.coll][e.options[this.coll].indexOf(this.userOptions)]=a);d(e.options[this.coll].events,function(a,b){"undefined"===typeof f[b]&&(f[b]=void 0)});this.destroy(!0);this.init(e,q(a,{events:f}));e.isDirtyBox=!0;b(c,!0)&&e.redraw()},remove:function(a){for(var c=this.chart,d=this.coll,e=this.series,f=e.length;f--;)e[f]&&e[f].remove(!1);y(c.axes,this);y(c[d],this);z(c.options[d])?c.options[d].splice(this.options.index,1):delete c.options[d];r(c[d],function(a,b){a.options.index=a.userOptions.index=b});this.destroy();c.isDirtyBox=!0;b(a,!0)&&c.redraw()},setTitle:function(a,b){this.update({title:a},b)},setCategories:function(a,b){this.update({categories:a},b)}})})(K);(function(a){var C=a.color,D=a.each,E=a.map,m=a.pick,h=a.Series,f=a.seriesType;f("area","line",{softThreshold:!1,threshold:0},{singleStacks:!1,getStackPoints:function(f){var h=[],q=[],r=this.xAxis,e=this.yAxis,c=e.stacks[this.stackKey],l={},z=this.index,k=e.series,d=k.length,b,u=m(e.options.reversedStacks,!0)?1:-1,p;f=f||this.points;if(this.options.stacking){for(p=0;p<f.length;p++)f[p].leftNull=f[p].rightNull=null,l[f[p].x]=f[p];a.objectEach(c,function(a,b){null!==a.total&&q.push(b)});q.sort(function(a,b){return a-b});b=E(k,function(){return this.visible});D(q,function(a,f){var k=0,t,m;if(l[a]&&!l[a].isNull)h.push(l[a]),D([-1,1],function(e){var k=1===e?"rightNull":"leftNull",h=0,n=c[q[f+e]];if(n)for(p=z;0<=p&&p<d;)t=n.points[p],t||(p===z?l[a][k]=!0:b[p]&&(m=c[a].points[p])&&(h-=m[1]-m[0])),p+=u;l[a][1===e?"rightCliff":"leftCliff"]=h});else{for(p=z;0<=p&&p<d;){if(t=c[a].points[p]){k=t[1];break}p+=u}k=e.translate(k,0,1,0,1);h.push({isNull:!0,plotX:r.translate(a,0,0,0,1),x:a,plotY:k,yBottom:k})}})}return h},getGraphPath:function(a){var f=h.prototype.getGraphPath,q=this.options,r=q.stacking,e=this.yAxis,c,l,z=[],k=[],d=this.index,b,u=e.stacks[this.stackKey],p=q.threshold,H=e.getThreshold(q.threshold),t,q=q.connectNulls||"percent"===r,L=function(c,f,h){var l=a[c];c=r&&u[l.x].points[d];var n=l[h+"Null"]||0;h=l[h+"Cliff"]||0;var t,m,l=!0;h||n?(t=(n?c[0]:c[1])+h,m=c[0]+h,l=!!n):!r&&a[f]&&a[f].isNull&&(t=m=p);void 0!==t&&(k.push({plotX:b,plotY:null===t?H:e.getThreshold(t),isNull:l,isCliff:!0}),z.push({plotX:b,plotY:null===m?H:e.getThreshold(m),doCurve:!1}))};a=a||this.points;r&&(a=this.getStackPoints(a));for(c=0;c<a.length;c++)if(l=a[c].isNull,b=m(a[c].rectPlotX,a[c].plotX),t=m(a[c].yBottom,H),!l||q)q||L(c,c-1,"left"),l&&!r&&q||(k.push(a[c]),z.push({x:c,plotX:b,plotY:t})),q||L(c,c+1,"right");c=f.call(this,k,!0,!0);z.reversed=!0;l=f.call(this,z,!0,!0);l.length&&(l[0]="L");l=c.concat(l);f=f.call(this,k,!1,q);l.xMap=c.xMap;this.areaPath=l;return f},drawGraph:function(){this.areaPath=[];h.prototype.drawGraph.apply(this);var a=this,f=this.areaPath,q=this.options,w=[["area","highcharts-area",this.color,q.fillColor]];D(this.zones,function(e,c){w.push(["zone-area-"+c,"highcharts-area highcharts-zone-area-"+c+" "+e.className,e.color||a.color,e.fillColor||q.fillColor])});D(w,function(e){var c=e[0],h=a[c];h?(h.endX=a.preventGraphAnimation?null:f.xMap,h.animate({d:f})):(h=a[c]=a.chart.renderer.path(f).addClass(e[1]).attr({fill:m(e[3],C(e[2]).setOpacity(m(q.fillOpacity,.75)).get()),zIndex:0}).add(a.group),h.isArea=!0);h.startX=f.xMap;h.shiftUnit=q.step?2:1})},drawLegendSymbol:a.LegendSymbolMixin.drawRectangle})})(K);(function(a){var C=a.pick;a=a.seriesType;a("spline","line",{},{getPointSpline:function(a,E,m){var h=E.plotX,f=E.plotY,r=a[m-1];m=a[m+1];var y,q,w,e;if(r&&!r.isNull&&!1!==r.doCurve&&!E.isCliff&&m&&!m.isNull&&!1!==m.doCurve&&!E.isCliff){a=r.plotY;w=m.plotX;m=m.plotY;var c=0;y=(1.5*h+r.plotX)/2.5;q=(1.5*f+a)/2.5;w=(1.5*h+w)/2.5;e=(1.5*f+m)/2.5;w!==y&&(c=(e-q)*(w-h)/(w-y)+f-e);q+=c;e+=c;q>a&&q>f?(q=Math.max(a,f),e=2*f-q):q<a&&q<f&&(q=Math.min(a,f),e=2*f-q);e>m&&e>f?(e=Math.max(m,f),q=2*f-e):e<m&&e<f&&(e=Math.min(m,f),q=2*f-e);E.rightContX=w;E.rightContY=e}E=["C",C(r.rightContX,r.plotX),C(r.rightContY,r.plotY),C(y,h),C(q,f),h,f];r.rightContX=r.rightContY=null;return E}})})(K);(function(a){var C=a.seriesTypes.area.prototype,D=a.seriesType;D("areaspline","spline",a.defaultPlotOptions.area,{getStackPoints:C.getStackPoints,getGraphPath:C.getGraphPath,drawGraph:C.drawGraph,drawLegendSymbol:a.LegendSymbolMixin.drawRectangle})})(K);(function(a){var C=a.animObject,D=a.color,E=a.each,m=a.extend,h=a.isNumber,f=a.merge,r=a.pick,y=a.Series,q=a.seriesType,w=a.svg;q("column","line",{borderRadius:0,crisp:!0,groupPadding:.2,marker:null,pointPadding:.1,minPointLength:0,cropThreshold:50,pointRange:null,states:{hover:{halo:!1,brightness:.1},select:{color:"#cccccc",borderColor:"#000000"}},dataLabels:{align:null,verticalAlign:null,y:null},softThreshold:!1,startFromThreshold:!0,stickyTracking:!1,tooltip:{distance:6},threshold:0,borderColor:"#ffffff"},{cropShoulder:0,directTouch:!0,trackerGroups:["group","dataLabelsGroup"],negStacks:!0,init:function(){y.prototype.init.apply(this,arguments);var a=this,c=a.chart;c.hasRendered&&E(c.series,function(c){c.type===a.type&&(c.isDirty=!0)})},getColumnMetrics:function(){var a=this,c=a.options,f=a.xAxis,h=a.yAxis,k=f.options.reversedStacks,k=f.reversed&&!k||!f.reversed&&k,d,b={},m=0;!1===c.grouping?m=1:E(a.chart.series,function(c){var e=c.options,f=c.yAxis,k;c.type!==a.type||!c.visible&&a.chart.options.chart.ignoreHiddenSeries||h.len!==f.len||h.pos!==f.pos||(e.stacking?(d=c.stackKey,void 0===b[d]&&(b[d]=m++),k=b[d]):!1!==e.grouping&&(k=m++),c.columnIndex=k)});var p=Math.min(Math.abs(f.transA)*(f.ordinalSlope||c.pointRange||f.closestPointRange||f.tickInterval||1),f.len),q=p*c.groupPadding,t=(p-2*q)/(m||1),c=Math.min(c.maxPointWidth||f.len,r(c.pointWidth,t*(1-2*c.pointPadding)));a.columnMetrics={width:c,offset:(t-c)/2+(q+((a.columnIndex||0)+(k?1:0))*t-p/2)*(k?-1:1)};return a.columnMetrics},crispCol:function(a,c,f,h){var e=this.chart,d=this.borderWidth,b=-(d%2?.5:0),d=d%2?.5:1;e.inverted&&e.renderer.isVML&&(d+=1);this.options.crisp&&(f=Math.round(a+f)+b,a=Math.round(a)+b,f-=a);h=Math.round(c+h)+d;b=.5>=Math.abs(c)&&.5<h;c=Math.round(c)+d;h-=c;b&&h&&(--c,h+=1);return{x:a,y:c,width:f,height:h}},translate:function(){var a=this,c=a.chart,f=a.options,h=a.dense=2>a.closestPointRange*a.xAxis.transA,h=a.borderWidth=r(f.borderWidth,h?0:1),k=a.yAxis,d=f.threshold,b=a.translatedThreshold=k.getThreshold(d),m=r(f.minPointLength,5),p=a.getColumnMetrics(),q=p.width,t=a.barW=Math.max(q,1+2*h),w=a.pointXOffset=p.offset;c.inverted&&(b-=.5);f.pointPadding&&(t=Math.ceil(t));y.prototype.translate.apply(a);E(a.points,function(e){var f=r(e.yBottom,b),h=999+Math.abs(f),h=Math.min(Math.max(-h,e.plotY),k.len+h),l=e.plotX+w,p=t,u=Math.min(h,f),x,g=Math.max(h,f)-u;m&&Math.abs(g)<m&&(g=m,x=!k.reversed&&!e.negative||k.reversed&&e.negative,e.y===d&&a.dataMax<=d&&k.min<d&&(x=!x),u=Math.abs(u-b)>m?f-m:b-(x?m:0));e.barX=l;e.pointWidth=q;e.tooltipPos=c.inverted?[k.len+k.pos-c.plotLeft-h,a.xAxis.len-l-p/2,g]:[l+p/2,h+k.pos-c.plotTop,g];e.shapeType="rect";e.shapeArgs=a.crispCol.apply(a,e.isNull?[l,b,p,0]:[l,u,p,g])})},getSymbol:a.noop,drawLegendSymbol:a.LegendSymbolMixin.drawRectangle,drawGraph:function(){this.group[this.dense?"addClass":"removeClass"]("highcharts-dense-data")},pointAttribs:function(a,c){var e=this.options,h,k=this.pointAttrToOptions||{};h=k.stroke||"borderColor";var d=k["stroke-width"]||"borderWidth",b=a&&a.color||this.color,m=a&&a[h]||e[h]||this.color||b,p=a&&a[d]||e[d]||this[d]||0,k=e.dashStyle;a&&this.zones.length&&(b=a.getZone(),b=a.options.color||b&&b.color||this.color);c&&(a=f(e.states[c],a.options.states&&a.options.states[c]||{}),c=a.brightness,b=a.color||void 0!==c&&D(b).brighten(a.brightness).get()||b,m=a[h]||m,p=a[d]||p,k=a.dashStyle||k);h={fill:b,stroke:m,"stroke-width":p};k&&(h.dashstyle=k);return h},drawPoints:function(){var a=this,c=this.chart,l=a.options,m=c.renderer,k=l.animationLimit||250,d;E(a.points,function(b){var e=b.graphic,p=e&&c.pointCount<k?"animate":"attr";if(h(b.plotY)&&null!==b.y){d=b.shapeArgs;if(e)e[p](f(d));else b.graphic=e=m[b.shapeType](d).add(b.group||a.group);l.borderRadius&&e.attr({r:l.borderRadius});e[p](a.pointAttribs(b,b.selected&&"select")).shadow(l.shadow,null,l.stacking&&!l.borderRadius);e.addClass(b.getClassName(),!0)}else e&&(b.graphic=e.destroy())})},animate:function(a){var c=this,f=this.yAxis,e=c.options,k=this.chart.inverted,d={},b=k?"translateX":"translateY",h;w&&(a?(d.scaleY=.001,a=Math.min(f.pos+f.len,Math.max(f.pos,f.toPixels(e.threshold))),k?d.translateX=a-f.len:d.translateY=a,c.group.attr(d)):(h=c.group.attr(b),c.group.animate({scaleY:1},m(C(c.options.animation),{step:function(a,e){d[b]=h+e.pos*(f.pos-h);c.group.attr(d)}})),c.animate=null))},remove:function(){var a=this,c=a.chart;c.hasRendered&&E(c.series,function(c){c.type===a.type&&(c.isDirty=!0)});y.prototype.remove.apply(a,arguments)}})})(K);(function(a){a=a.seriesType;a("bar","column",null,{inverted:!0})})(K);(function(a){var C=a.Series;a=a.seriesType;a("scatter","line",{lineWidth:0,findNearestPointBy:"xy",marker:{enabled:!0},tooltip:{headerFormat:'<span style="color:{point.color}"></span> <span style="font-size: 0.85em"> {series.name}</span><br/>',pointFormat:"x: <b>{point.x}</b><br/>y: <b>{point.y}</b><br/>"}},{sorted:!1,requireSorting:!1,noSharedTooltip:!0,trackerGroups:["group","markerGroup","dataLabelsGroup"],takeOrdinalPosition:!1,drawGraph:function(){this.options.lineWidth&&C.prototype.drawGraph.call(this)}})})(K);(function(a){var C=a.deg2rad,D=a.isNumber,E=a.pick,m=a.relativeLength;a.CenteredSeriesMixin={getCenter:function(){var a=this.options,f=this.chart,r=2*(a.slicedOffset||0),y=f.plotWidth-2*r,f=f.plotHeight-2*r,q=a.center,q=[E(q[0],"50%"),E(q[1],"50%"),a.size||"100%",a.innerSize||0],w=Math.min(y,f),e,c;for(e=0;4>e;++e)c=q[e],a=2>e||2===e&&/%$/.test(c),q[e]=m(c,[y,f,w,q[2]][e])+(a?r:0);q[3]>q[2]&&(q[3]=q[2]);return q},getStartAndEndRadians:function(a,f){a=D(a)?a:0;f=D(f)&&f>a&&360>f-a?f:a+360;return{start:C*(a+-90),end:C*(f+-90)}}}})(K);(function(a){var C=a.addEvent,D=a.CenteredSeriesMixin,E=a.defined,m=a.each,h=a.extend,f=D.getStartAndEndRadians,r=a.inArray,y=a.noop,q=a.pick,w=a.Point,e=a.Series,c=a.seriesType,l=a.setAnimation;c("pie","line",{center:[null,null],clip:!1,colorByPoint:!0,dataLabels:{allowOverlap:!0,distance:30,enabled:!0,formatter:function(){return this.point.isNull?void 0:this.point.name},x:0},ignoreHiddenPoint:!0,legendType:"point",marker:null,size:null,showInLegend:!1,slicedOffset:10,stickyTracking:!1,tooltip:{followPointer:!0},borderColor:"#ffffff",borderWidth:1,states:{hover:{brightness:.1}}},{isCartesian:!1,requireSorting:!1,directTouch:!0,noSharedTooltip:!0,trackerGroups:["group","dataLabelsGroup"],axisTypes:[],pointAttribs:a.seriesTypes.column.prototype.pointAttribs,animate:function(a){var c=this,d=c.points,b=c.startAngleRad;a||(m(d,function(a){var d=a.graphic,f=a.shapeArgs;d&&(d.attr({r:a.startR||c.center[3]/2,start:b,end:b}),d.animate({r:f.r,start:f.start,end:f.end},c.options.animation))}),c.animate=null)},updateTotals:function(){var a,c=0,d=this.points,b=d.length,f,e=this.options.ignoreHiddenPoint;for(a=0;a<b;a++)f=d[a],c+=e&&!f.visible?0:f.isNull?0:f.y;this.total=c;for(a=0;a<b;a++)f=d[a],f.percentage=0<c&&(f.visible||!e)?f.y/c*100:0,f.total=c},generatePoints:function(){e.prototype.generatePoints.call(this);this.updateTotals()},translate:function(a){this.generatePoints();var c=0,d=this.options,b=d.slicedOffset,e=b+(d.borderWidth||0),h,l,t,m=f(d.startAngle,d.endAngle),x=this.startAngleRad=m.start,m=(this.endAngleRad=m.end)-x,r=this.points,n,w=d.dataLabels.distance,d=d.ignoreHiddenPoint,z,y=r.length,F;a||(this.center=a=this.getCenter());this.getX=function(b,c,d){t=Math.asin(Math.min((b-a[1])/(a[2]/2+d.labelDistance),1));return a[0]+(c?-1:1)*Math.cos(t)*(a[2]/2+d.labelDistance)};for(z=0;z<y;z++){F=r[z];F.labelDistance=q(F.options.dataLabels&&F.options.dataLabels.distance,w);this.maxLabelDistance=Math.max(this.maxLabelDistance||0,F.labelDistance);h=x+c*m;if(!d||F.visible)c+=F.percentage/100;l=x+c*m;F.shapeType="arc";F.shapeArgs={x:a[0],y:a[1],r:a[2]/2,innerR:a[3]/2,start:Math.round(1e3*h)/1e3,end:Math.round(1e3*l)/1e3};t=(l+h)/2;t>1.5*Math.PI?t-=2*Math.PI:t<-Math.PI/2&&(t+=2*Math.PI);F.slicedTranslation={translateX:Math.round(Math.cos(t)*b),translateY:Math.round(Math.sin(t)*b)};l=Math.cos(t)*a[2]/2;n=Math.sin(t)*a[2]/2;F.tooltipPos=[a[0]+.7*l,a[1]+.7*n];F.half=t<-Math.PI/2||t>Math.PI/2?1:0;F.angle=t;h=Math.min(e,F.labelDistance/5);F.labelPos=[a[0]+l+Math.cos(t)*F.labelDistance,a[1]+n+Math.sin(t)*F.labelDistance,a[0]+l+Math.cos(t)*h,a[1]+n+Math.sin(t)*h,a[0]+l,a[1]+n,0>F.labelDistance?"center":F.half?"right":"left",t]}},drawGraph:null,drawPoints:function(){var a=this,c=a.chart.renderer,d,b,f,e,l=a.options.shadow;l&&!a.shadowGroup&&(a.shadowGroup=c.g("shadow").add(a.group));m(a.points,function(k){b=k.graphic;if(k.isNull)b&&(k.graphic=b.destroy());else{e=k.shapeArgs;d=k.getTranslate();var t=k.shadowGroup;l&&!t&&(t=k.shadowGroup=c.g("shadow").add(a.shadowGroup));t&&t.attr(d);f=a.pointAttribs(k,k.selected&&"select");b?b.setRadialReference(a.center).attr(f).animate(h(e,d)):(k.graphic=b=c[k.shapeType](e).setRadialReference(a.center).attr(d).add(a.group),b.attr(f).attr({"stroke-linejoin":"round"}).shadow(l,t));b.attr({visibility:k.visible?"inherit":"hidden"});b.addClass(k.getClassName())}})},searchPoint:y,sortByAngle:function(a,c){a.sort(function(a,b){return void 0!==a.angle&&(b.angle-a.angle)*c})},drawLegendSymbol:a.LegendSymbolMixin.drawRectangle,getCenter:D.getCenter,getSymbol:y},{init:function(){w.prototype.init.apply(this,arguments);var a=this,c;a.name=q(a.name,"Slice");c=function(c){a.slice("select"===c.type)};C(a,"select",c);C(a,"unselect",c);return a},isValid:function(){return a.isNumber(this.y,!0)&&0<=this.y},setVisible:function(a,c){var d=this,b=d.series,f=b.chart,e=b.options.ignoreHiddenPoint;c=q(c,e);a!==d.visible&&(d.visible=d.options.visible=a=void 0===a?!d.visible:a,b.options.data[r(d,b.data)]=d.options,m(["graphic","dataLabel","connector","shadowGroup"],function(b){if(d[b])d[b][a?"show":"hide"](!0)}),d.legendItem&&f.legend.colorizeItem(d,a),a||"hover"!==d.state||d.setState(""),e&&(b.isDirty=!0),c&&f.redraw())},slice:function(a,c,d){var b=this.series;l(d,b.chart);q(c,!0);this.sliced=this.options.sliced=E(a)?a:!this.sliced;b.options.data[r(this,b.data)]=this.options;this.graphic.animate(this.getTranslate());this.shadowGroup&&this.shadowGroup.animate(this.getTranslate())},getTranslate:function(){return this.sliced?this.slicedTranslation:{translateX:0,translateY:0}},haloPath:function(a){var c=this.shapeArgs;return this.sliced||!this.visible?[]:this.series.chart.renderer.symbols.arc(c.x,c.y,c.r+a,c.r+a,{innerR:this.shapeArgs.r-1,start:c.start,end:c.end})}})})(K);(function(a){var C=a.addEvent,D=a.arrayMax,E=a.defined,m=a.each,h=a.extend,f=a.format,r=a.map,y=a.merge,q=a.noop,w=a.pick,e=a.relativeLength,c=a.Series,l=a.seriesTypes,z=a.some,k=a.stableSort;a.distribute=function(c,b,f){function d(a,b){return a.target-b.target}var e,h=!0,l=c,x=[],q;q=0;var n=l.reducedLen||b;for(e=c.length;e--;)q+=c[e].size;if(q>n){k(c,function(a,b){return(b.rank||0)-(a.rank||0)});for(q=e=0;q<=n;)q+=c[e].size,e++;x=c.splice(e-1,c.length)}k(c,d);for(c=r(c,function(a){return{size:a.size,targets:[a.target],align:w(a.align,.5)}});h;){for(e=c.length;e--;)h=c[e],q=(Math.min.apply(0,h.targets)+Math.max.apply(0,h.targets))/2,h.pos=Math.min(Math.max(0,q-h.size*h.align),b-h.size);e=c.length;for(h=!1;e--;)0<e&&c[e-1].pos+c[e-1].size>c[e].pos&&(c[e-1].size+=c[e].size,c[e-1].targets=c[e-1].targets.concat(c[e].targets),c[e-1].align=.5,c[e-1].pos+c[e-1].size>b&&(c[e-1].pos=b-c[e-1].size),c.splice(e,1),h=!0)}l.push.apply(l,x);e=0;z(c,function(c){var d=0;if(z(c.targets,function(){l[e].pos=c.pos+d;if(Math.abs(l[e].pos-l[e].target)>f)return m(l.slice(0,e+1),function(a){delete a.pos}),l.reducedLen=(l.reducedLen||b)-.1*b,l.reducedLen>.1*b&&a.distribute(l,b,f),!0;d+=l[e].size;e++}))return!0});k(l,d)};c.prototype.drawDataLabels=function(){function c(a,b){var c=b.filter;return c?(b=c.operator,a=a[c.property],c=c.value,">"===b&&a>c||"<"===b&&a<c||">="===b&&a>=c||"<="===b&&a<=c||"=="===b&&a==c||"==="===b&&a===c?!0:!1):!0}var b=this,e=b.chart,k=b.options,h=k.dataLabels,l=b.points,q,x,r=b.hasRendered||0,n,z,B=w(h.defer,!!k.animation),D=e.renderer;if(h.enabled||b._hasPointLabels)b.dlProcessOptions&&b.dlProcessOptions(h),z=b.plotGroup("dataLabelsGroup","data-labels",B&&!r?"hidden":"visible",h.zIndex||6),B&&(z.attr({opacity:+r}),r||C(b,"afterAnimate",function(){b.visible&&z.show(!0);z[k.animation?"animate":"attr"]({opacity:1},{duration:200})})),x=h,m(l,function(d){var g,l=d.dataLabel,t,p,m=d.connector,u=!l,r;q=d.dlOptions||d.options&&d.options.dataLabels;(g=w(q&&q.enabled,x.enabled)&&!d.isNull)&&(g=!0===c(d,q||h));g&&(h=y(x,q),t=d.getLabelConfig(),r=h[d.formatPrefix+"Format"]||h.format,n=E(r)?f(r,t,e.time):(h[d.formatPrefix+"Formatter"]||h.formatter).call(t,h),r=h.style,t=h.rotation,r.color=w(h.color,r.color,b.color,"#000000"),"contrast"===r.color&&(d.contrastColor=D.getContrast(d.color||b.color),r.color=h.inside||0>w(d.labelDistance,h.distance)||k.stacking?d.contrastColor:"#000000"),k.cursor&&(r.cursor=k.cursor),p={fill:h.backgroundColor,stroke:h.borderColor,"stroke-width":h.borderWidth,r:h.borderRadius||0,rotation:t,padding:h.padding,zIndex:1},a.objectEach(p,function(a,b){void 0===a&&delete p[b]}));!l||g&&E(n)?g&&E(n)&&(l?p.text=n:(l=d.dataLabel=t?D.text(n,0,-9999,h.useHTML).addClass("highcharts-data-label"):D.label(n,0,-9999,h.shape,null,null,h.useHTML,null,"data-label"),l.addClass(" highcharts-data-label-color-"+d.colorIndex+" "+(h.className||"")+(h.useHTML?" highcharts-tracker":""))),l.attr(p),l.css(r).shadow(h.shadow),l.added||l.add(z),b.alignDataLabel(d,l,h,null,u)):(d.dataLabel=l=l.destroy(),m&&(d.connector=m.destroy()))});a.fireEvent(this,"afterDrawDataLabels")};c.prototype.alignDataLabel=function(a,b,c,e,f){var d=this.chart,k=d.inverted,l=w(a.dlBox&&a.dlBox.centerX,a.plotX,-9999),m=w(a.plotY,-9999),n=b.getBBox(),p,q=c.rotation,r=c.align,u=this.visible&&(a.series.forceDL||d.isInsidePlot(l,Math.round(m),k)||e&&d.isInsidePlot(l,k?e.x+1:e.y+e.height-1,k)),g="justify"===w(c.overflow,"justify");if(u&&(p=c.style.fontSize,p=d.renderer.fontMetrics(p,b).b,e=h({x:k?this.yAxis.len-m:l,y:Math.round(k?this.xAxis.len-l:m),width:0,height:0},e),h(c,{width:n.width,height:n.height}),q?(g=!1,l=d.renderer.rotCorr(p,q),l={x:e.x+c.x+e.width/2+l.x,y:e.y+c.y+{top:0,middle:.5,bottom:1}[c.verticalAlign]*e.height},b[f?"attr":"animate"](l).attr({align:r}),m=(q+720)%360,m=180<m&&360>m,"left"===r?l.y-=m?n.height:0:"center"===r?(l.x-=n.width/2,l.y-=n.height/2):"right"===r&&(l.x-=n.width,l.y-=m?0:n.height),b.placed=!0,b.alignAttr=l):(b.align(c,null,e),l=b.alignAttr),g&&0<=e.height?a.isLabelJustified=this.justifyDataLabel(b,c,l,n,e,f):w(c.crop,!0)&&(u=d.isInsidePlot(l.x,l.y)&&d.isInsidePlot(l.x+n.width,l.y+n.height)),c.shape&&!q))b[f?"attr":"animate"]({anchorX:k?d.plotWidth-a.plotY:a.plotX,anchorY:k?d.plotHeight-a.plotX:a.plotY});u||(b.attr({y:-9999}),b.placed=!1)};c.prototype.justifyDataLabel=function(a,b,c,e,f,k){var d=this.chart,h=b.align,l=b.verticalAlign,n,m,t=a.box?0:a.padding||0;n=c.x+t;0>n&&("right"===h?b.align="left":b.x=-n,m=!0);n=c.x+e.width-t;n>d.plotWidth&&("left"===h?b.align="right":b.x=d.plotWidth-n,m=!0);n=c.y+t;0>n&&("bottom"===l?b.verticalAlign="top":b.y=-n,m=!0);n=c.y+e.height-t;n>d.plotHeight&&("top"===l?b.verticalAlign="bottom":b.y=d.plotHeight-n,m=!0);m&&(a.placed=!k,a.align(b,null,f));return m};l.pie&&(l.pie.prototype.drawDataLabels=function(){var d=this,b=d.data,e,f=d.chart,k=d.options.dataLabels,h=w(k.connectorPadding,10),l=w(k.connectorWidth,1),q=f.plotWidth,r=f.plotHeight,n=Math.round(f.chartWidth/3),y,z=d.center,C=z[2]/2,F=z[1],g,v,K,Q,J=[[],[]],O,N,A,R,S=[0,0,0,0];d.visible&&(k.enabled||d._hasPointLabels)&&(m(b,function(a){a.dataLabel&&a.visible&&a.dataLabel.shortened&&(a.dataLabel.attr({width:"auto"}).css({width:"auto",textOverflow:"clip"}),a.dataLabel.shortened=!1)}),c.prototype.drawDataLabels.apply(d),m(b,function(a){a.dataLabel&&(a.visible?(J[a.half].push(a),a.dataLabel._pos=null,!E(k.style.width)&&!E(a.options.dataLabels&&a.options.dataLabels.style&&a.options.dataLabels.style.width)&&a.dataLabel.getBBox().width>n&&(a.dataLabel.css({width:.7*n}),a.dataLabel.shortened=!0)):a.dataLabel=a.dataLabel.destroy())}),m(J,function(b,c){var l,n,t=b.length,p=[],x;if(t)for(d.sortByAngle(b,c-.5),0<d.maxLabelDistance&&(l=Math.max(0,F-C-d.maxLabelDistance),n=Math.min(F+C+d.maxLabelDistance,f.plotHeight),m(b,function(a){0<a.labelDistance&&a.dataLabel&&(a.top=Math.max(0,F-C-a.labelDistance),a.bottom=Math.min(F+C+a.labelDistance,f.plotHeight),x=a.dataLabel.getBBox().height||21,a.distributeBox={target:a.labelPos[1]-a.top+x/2,size:x,rank:a.y},p.push(a.distributeBox))}),l=n+x-l,a.distribute(p,l,l/5)),R=0;R<t;R++)e=b[R],K=e.labelPos,g=e.dataLabel,A=!1===e.visible?"hidden":"inherit",N=l=K[1],p&&E(e.distributeBox)&&(void 0===e.distributeBox.pos?A="hidden":(Q=e.distributeBox.size,N=e.top+e.distributeBox.pos)),delete e.positionIndex,O=k.justify?z[0]+(c?-1:1)*(C+e.labelDistance):d.getX(N<e.top+2||N>e.bottom-2?l:N,c,e),g._attr={visibility:A,align:K[6]},g._pos={x:O+k.x+({left:h,right:-h}[K[6]]||0),y:N+k.y-10},K.x=O,K.y=N,w(k.crop,!0)&&(v=g.getBBox().width,l=null,O-v<h&&1===c?(l=Math.round(v-O+h),S[3]=Math.max(l,S[3])):O+v>q-h&&0===c&&(l=Math.round(O+v-q+h),S[1]=Math.max(l,S[1])),0>N-Q/2?S[0]=Math.max(Math.round(-N+Q/2),S[0]):N+Q/2>r&&(S[2]=Math.max(Math.round(N+Q/2-r),S[2])),g.sideOverflow=l)}),0===D(S)||this.verifyDataLabelOverflow(S))&&(this.placeDataLabels(),l&&m(this.points,function(a){var b;y=a.connector;if((g=a.dataLabel)&&g._pos&&a.visible&&0<a.labelDistance){A=g._attr.visibility;if(b=!y)a.connector=y=f.renderer.path().addClass("highcharts-data-label-connector  highcharts-color-"+a.colorIndex+(a.className?" "+a.className:"")).add(d.dataLabelsGroup),y.attr({"stroke-width":l,stroke:k.connectorColor||a.color||"#666666"});y[b?"attr":"animate"]({d:d.connectorPath(a.labelPos)});y.attr("visibility",A)}else y&&(a.connector=y.destroy())}))},l.pie.prototype.connectorPath=function(a){var b=a.x,c=a.y;return w(this.options.dataLabels.softConnector,!0)?["M",b+("left"===a[6]?5:-5),c,"C",b,c,2*a[2]-a[4],2*a[3]-a[5],a[2],a[3],"L",a[4],a[5]]:["M",b+("left"===a[6]?5:-5),c,"L",a[2],a[3],"L",a[4],a[5]]},l.pie.prototype.placeDataLabels=function(){m(this.points,function(a){var b=a.dataLabel;b&&a.visible&&((a=b._pos)?(b.sideOverflow&&(b._attr.width=b.getBBox().width-b.sideOverflow,b.css({width:b._attr.width+"px",textOverflow:(this.options.dataLabels.style||{}).textOverflow||"ellipsis"}),b.shortened=!0),b.attr(b._attr),b[b.moved?"animate":"attr"](a),b.moved=!0):b&&b.attr({y:-9999}))},this)},l.pie.prototype.alignDataLabel=q,l.pie.prototype.verifyDataLabelOverflow=function(a){var b=this.center,c=this.options,d=c.center,f=c.minSize||80,k,h=null!==c.size;h||(null!==d[0]?k=Math.max(b[2]-Math.max(a[1],a[3]),f):(k=Math.max(b[2]-a[1]-a[3],f),b[0]+=(a[3]-a[1])/2),null!==d[1]?k=Math.max(Math.min(k,b[2]-Math.max(a[0],a[2])),f):(k=Math.max(Math.min(k,b[2]-a[0]-a[2]),f),b[1]+=(a[0]-a[2])/2),k<b[2]?(b[2]=k,b[3]=Math.min(e(c.innerSize||0,k),k),this.translate(b),this.drawDataLabels&&this.drawDataLabels()):h=!0);return h});l.column&&(l.column.prototype.alignDataLabel=function(a,b,e,f,k){var d=this.chart.inverted,h=a.series,l=a.dlBox||a.shapeArgs,m=w(a.below,a.plotY>w(this.translatedThreshold,h.yAxis.len)),n=w(e.inside,!!this.options.stacking);l&&(f=y(l),0>f.y&&(f.height+=f.y,f.y=0),l=f.y+f.height-h.yAxis.len,0<l&&(f.height-=l),d&&(f={x:h.yAxis.len-f.y-f.height,y:h.xAxis.len-f.x-f.width,width:f.height,height:f.width}),n||(d?(f.x+=m?0:f.width,f.width=0):(f.y+=m?f.height:0,f.height=0)));e.align=w(e.align,!d||n?"center":m?"right":"left");e.verticalAlign=w(e.verticalAlign,d||n?"middle":m?"top":"bottom");c.prototype.alignDataLabel.call(this,a,b,e,f,k);a.isLabelJustified&&a.contrastColor&&a.dataLabel.css({color:a.contrastColor})})})(K);(function(a){var C=a.Chart,D=a.each,E=a.objectEach,m=a.pick;a=a.addEvent;a(C,"render",function(){var a=[];D(this.labelCollectors||[],function(f){a=a.concat(f())});D(this.yAxis||[],function(f){f.options.stackLabels&&!f.options.stackLabels.allowOverlap&&E(f.stacks,function(f){E(f,function(f){a.push(f.label)})})});D(this.series||[],function(f){var h=f.options.dataLabels,y=f.dataLabelCollections||["dataLabel"];(h.enabled||f._hasPointLabels)&&!h.allowOverlap&&f.visible&&D(y,function(h){D(f.points,function(f){f[h]&&(f[h].labelrank=m(f.labelrank,f.shapeArgs&&f.shapeArgs.height),a.push(f[h]))})})});this.hideOverlappingLabels(a)});C.prototype.hideOverlappingLabels=function(a){var f=a.length,h=this.renderer,m,q,w,e,c,l,z=function(a,c,b,e,f,h,l,m){return!(f>a+b||f+l<a||h>c+e||h+m<c)};w=function(a){var c,b,e,f=2*(a.box?0:a.padding||0);e=0;if(a&&(!a.alignAttr||a.placed))return c=a.alignAttr||{x:a.attr("x"),y:a.attr("y")},b=a.parentGroup,a.width||(e=a.getBBox(),a.width=e.width,a.height=e.height,e=h.fontMetrics(null,a.element).h),{x:c.x+(b.translateX||0),y:c.y+(b.translateY||0)-e,width:a.width-f,height:a.height-f}};for(q=0;q<f;q++)if(m=a[q])m.oldOpacity=m.opacity,m.newOpacity=1,m.absoluteBox=w(m);a.sort(function(a,c){return(c.labelrank||0)-(a.labelrank||0)});for(q=0;q<f;q++)for(l=(w=a[q])&&w.absoluteBox,m=q+1;m<f;++m)if(c=(e=a[m])&&e.absoluteBox,l&&c&&w!==e&&0!==w.newOpacity&&0!==e.newOpacity&&(c=z(l.x,l.y,l.width,l.height,c.x,c.y,c.width,c.height)))(w.labelrank<e.labelrank?w:e).newOpacity=0;D(a,function(a){var c,b;a&&(b=a.newOpacity,a.oldOpacity!==b&&(a.alignAttr&&a.placed?(b?a.show(!0):c=function(){a.hide()},a.alignAttr.opacity=b,a[a.isOld?"animate":"attr"](a.alignAttr,null,c)):a.attr({opacity:b})),a.isOld=!0)})}})(K);(function(a){var C=a.addEvent,D=a.Chart,E=a.createElement,m=a.css,h=a.defaultOptions,f=a.defaultPlotOptions,r=a.each,y=a.extend,q=a.fireEvent,w=a.hasTouch,e=a.inArray,c=a.isObject,l=a.Legend,z=a.merge,k=a.pick,d=a.Point,b=a.Series,u=a.seriesTypes,p=a.svg,H;H=a.TrackerMixin={drawTrackerPoint:function(){var a=this,b=a.chart.pointer,c=function(a){var c=b.getPointFromEvent(a);void 0!==c&&(b.isDirectTouch=!0,c.onMouseOver(a))};r(a.points,function(a){a.graphic&&(a.graphic.element.point=a);a.dataLabel&&(a.dataLabel.div?a.dataLabel.div.point=a:a.dataLabel.element.point=a)});a._hasTracking||(r(a.trackerGroups,function(d){if(a[d]){a[d].addClass("highcharts-tracker").on("mouseover",c).on("mouseout",function(a){b.onTrackerMouseOut(a)});if(w)a[d].on("touchstart",c);a.options.cursor&&a[d].css(m).css({cursor:a.options.cursor})}}),a._hasTracking=!0);q(this,"afterDrawTracker")},drawTrackerGraph:function(){var a=this,b=a.options,c=b.trackByArea,d=[].concat(c?a.areaPath:a.graphPath),e=d.length,f=a.chart,h=f.pointer,k=f.renderer,l=f.options.tooltip.snap,g=a.tracker,m,u=function(){if(f.hoverSeries!==a)a.onMouseOver()},y="rgba(192,192,192,"+(p?1e-4:.002)+")";if(e&&!c)for(m=e+1;m--;)"M"===d[m]&&d.splice(m+1,0,d[m+1]-l,d[m+2],"L"),(m&&"M"===d[m]||m===e)&&d.splice(m,0,"L",d[m-2]+l,d[m-1]);g?g.attr({d:d}):a.graph&&(a.tracker=k.path(d).attr({"stroke-linejoin":"round",visibility:a.visible?"visible":"hidden",stroke:y,fill:c?y:"none","stroke-width":a.graph.strokeWidth()+(c?0:2*l),zIndex:2}).add(a.group),r([a.tracker,a.markerGroup],function(a){a.addClass("highcharts-tracker").on("mouseover",u).on("mouseout",function(a){h.onTrackerMouseOut(a)});b.cursor&&a.css({cursor:b.cursor});if(w)a.on("touchstart",u)}));q(this,"afterDrawTracker")}};u.column&&(u.column.prototype.drawTracker=H.drawTrackerPoint);u.pie&&(u.pie.prototype.drawTracker=H.drawTrackerPoint);u.scatter&&(u.scatter.prototype.drawTracker=H.drawTrackerPoint);y(l.prototype,{setItemEvents:function(a,b,c){var e=this,f=e.chart.renderer.boxWrapper,h="highcharts-legend-"+(a instanceof d?"point":"series")+"-active";(c?b:a.legendGroup).on("mouseover",function(){a.setState("hover");f.addClass(h);b.css(e.options.itemHoverStyle)}).on("mouseout",function(){b.css(z(a.visible?e.itemStyle:e.itemHiddenStyle));f.removeClass(h);a.setState()}).on("click",function(b){var c=function(){a.setVisible&&a.setVisible()};f.removeClass(h);b={browserEvent:b};a.firePointEvent?a.firePointEvent("legendItemClick",b,c):q(a,"legendItemClick",b,c)})},createCheckboxForItem:function(a){a.checkbox=E("input",{type:"checkbox",className:"highcharts-legend-checkbox",checked:a.selected,defaultChecked:a.selected},this.options.itemCheckboxStyle,this.chart.container);C(a.checkbox,"click",function(b){q(a.series||a,"checkboxClick",{checked:b.target.checked,item:a},function(){a.select()})})}});h.legend.itemStyle.cursor="pointer";y(D.prototype,{showResetZoom:function(){function a(){b.zoomOut()}var b=this,c=h.lang,d=b.options.chart.resetZoomButton,e=d.theme,f=e.states,k="chart"===d.relativeTo?null:"plotBox";q(this,"beforeShowResetZoom",null,function(){b.resetZoomButton=b.renderer.button(c.resetZoom,null,null,a,e,f&&f.hover).attr({align:d.position.align,title:c.resetZoomTitle}).addClass("highcharts-reset-zoom").add().align(d.position,!1,k)})},zoomOut:function(){q(this,"selection",{resetSelection:!0},this.zoom)},zoom:function(a){var b,d=this.pointer,e=!1,f;!a||a.resetSelection?(r(this.axes,function(a){b=a.zoom()}),d.initiated=!1):r(a.xAxis.concat(a.yAxis),function(a){var c=a.axis;d[c.isXAxis?"zoomX":"zoomY"]&&(b=c.zoom(a.min,a.max),c.displayBtn&&(e=!0))});f=this.resetZoomButton;e&&!f?this.showResetZoom():!e&&c(f)&&(this.resetZoomButton=f.destroy());b&&this.redraw(k(this.options.chart.animation,a&&a.animation,100>this.pointCount))},pan:function(a,b){var c=this,d=c.hoverPoints,e;d&&r(d,function(a){a.setState()});r("xy"===b?[1,0]:[1],function(b){b=c[b?"xAxis":"yAxis"][0];var d=b.horiz,f=a[d?"chartX":"chartY"],d=d?"mouseDownX":"mouseDownY",h=c[d],g=(b.pointRange||0)/2,k=b.reversed&&!c.inverted||!b.reversed&&c.inverted?-1:1,l=b.getExtremes(),n=b.toValue(h-f,!0)+g*k,k=b.toValue(h+b.len-f,!0)-g*k,m=k<n,h=m?k:n,n=m?n:k,k=Math.min(l.dataMin,g?l.min:b.toValue(b.toPixels(l.min)-b.minPixelPadding)),g=Math.max(l.dataMax,g?l.max:b.toValue(b.toPixels(l.max)+b.minPixelPadding)),m=k-h;0<m&&(n+=m,h=k);m=n-g;0<m&&(n=g,h-=m);b.series.length&&h!==l.min&&n!==l.max&&(b.setExtremes(h,n,!1,!1,{trigger:"pan"}),e=!0);c[d]=f});e&&c.redraw(!1);m(c.container,{cursor:"move"})}});y(d.prototype,{select:function(a,b){var c=this,d=c.series,f=d.chart;a=k(a,!c.selected);c.firePointEvent(a?"select":"unselect",{accumulate:b},function(){c.selected=c.options.selected=a;d.options.data[e(c,d.data)]=c.options;c.setState(a&&"select");b||r(f.getSelectedPoints(),function(a){a.selected&&a!==c&&(a.selected=a.options.selected=!1,d.options.data[e(a,d.data)]=a.options,a.setState(""),a.firePointEvent("unselect"))})})},onMouseOver:function(a){var b=this.series.chart,c=b.pointer;a=a?c.normalize(a):c.getChartCoordinatesFromPoint(this,b.inverted);c.runPointActions(a,this)},onMouseOut:function(){var a=this.series.chart;this.firePointEvent("mouseOut");r(a.hoverPoints||[],function(a){a.setState()});a.hoverPoints=a.hoverPoint=null},importEvents:function(){if(!this.hasImportedEvents){var b=this,c=z(b.series.options.point,b.options).events;b.events=c;a.objectEach(c,function(a,c){C(b,c,a)});this.hasImportedEvents=!0}},setState:function(a,b){var c=Math.floor(this.plotX),d=this.plotY,e=this.series,h=e.options.states[a||"normal"]||{},l=f[e.type].marker&&e.options.marker,m=l&&!1===l.enabled,p=l&&l.states&&l.states[a||"normal"]||{},g=!1===p.enabled,t=e.stateMarkerGraphic,r=this.marker||{},u=e.chart,w=e.halo,z,C=l&&e.markerAttribs;a=a||"";if(!(a===this.state&&!b||this.selected&&"select"!==a||!1===h.enabled||a&&(g||m&&!1===p.enabled)||a&&r.states&&r.states[a]&&!1===r.states[a].enabled)){C&&(z=e.markerAttribs(this,a));if(this.graphic)this.state&&this.graphic.removeClass("highcharts-point-"+this.state),a&&this.graphic.addClass("highcharts-point-"+a),this.graphic.animate(e.pointAttribs(this,a),k(u.options.chart.animation,h.animation)),z&&this.graphic.animate(z,k(u.options.chart.animation,p.animation,l.animation)),t&&t.hide();else{if(a&&p){l=r.symbol||e.symbol;t&&t.currentSymbol!==l&&(t=t.destroy());if(t)t[b?"animate":"attr"]({x:z.x,y:z.y});else l&&(e.stateMarkerGraphic=t=u.renderer.symbol(l,z.x,z.y,z.width,z.height).add(e.markerGroup),t.currentSymbol=l);t&&t.attr(e.pointAttribs(this,a))}t&&(t[a&&u.isInsidePlot(c,d,u.inverted)?"show":"hide"](),t.element.point=this)}(c=h.halo)&&c.size?(w||(e.halo=w=u.renderer.path().add((this.graphic||t).parentGroup)),w.show()[b?"animate":"attr"]({d:this.haloPath(c.size)}),w.attr({class:"highcharts-halo highcharts-color-"+k(this.colorIndex,e.colorIndex)+(this.className?" "+this.className:""),zIndex:-1}),w.point=this,w.attr(y({fill:this.color||e.color,"fill-opacity":c.opacity},c.attributes))):w&&w.point&&w.point.haloPath&&w.animate({d:w.point.haloPath(0)},null,w.hide);this.state=a;q(this,"afterSetState")}},haloPath:function(a){return this.series.chart.renderer.symbols.circle(Math.floor(this.plotX)-a,this.plotY-a,2*a,2*a)}});y(b.prototype,{onMouseOver:function(){var a=this.chart,b=a.hoverSeries;if(b&&b!==this)b.onMouseOut();this.options.events.mouseOver&&q(this,"mouseOver");this.setState("hover");a.hoverSeries=this},onMouseOut:function(){var a=this.options,b=this.chart,c=b.tooltip,d=b.hoverPoint;b.hoverSeries=null;if(d)d.onMouseOut();this&&a.events.mouseOut&&q(this,"mouseOut");!c||this.stickyTracking||c.shared&&!this.noSharedTooltip||c.hide();this.setState()},setState:function(a){var b=this,c=b.options,d=b.graph,e=c.states,f=c.lineWidth,c=0;a=a||"";if(b.state!==a&&(r([b.group,b.markerGroup,b.dataLabelsGroup],function(c){c&&(b.state&&c.removeClass("highcharts-series-"+b.state),a&&c.addClass("highcharts-series-"+a))}),b.state=a,!e[a]||!1!==e[a].enabled)&&(a&&(f=e[a].lineWidth||f+(e[a].lineWidthPlus||0)),d&&!d.dashstyle))for(f={"stroke-width":f},d.animate(f,k(e[a||"normal"]&&e[a||"normal"].animation,b.chart.options.chart.animation));b["zone-graph-"+c];)b["zone-graph-"+c].attr(f),c+=1},setVisible:function(a,b){var c=this,d=c.chart,e=c.legendItem,f,h=d.options.chart.ignoreHiddenSeries,k=c.visible;f=(c.visible=a=c.options.visible=c.userOptions.visible=void 0===a?!k:a)?"show":"hide";r(["group","dataLabelsGroup","markerGroup","tracker","tt"],function(a){if(c[a])c[a][f]()});if(d.hoverSeries===c||(d.hoverPoint&&d.hoverPoint.series)===c)c.onMouseOut();e&&d.legend.colorizeItem(c,a);c.isDirty=!0;c.options.stacking&&r(d.series,function(a){a.options.stacking&&a.visible&&(a.isDirty=!0)});r(c.linkedSeries,function(b){b.setVisible(a,!1)});h&&(d.isDirtyBox=!0);q(c,f);!1!==b&&d.redraw()},show:function(){this.setVisible(!0)},hide:function(){this.setVisible(!1)},select:function(a){this.selected=a=void 0===a?!this.selected:a;this.checkbox&&(this.checkbox.checked=a);q(this,a?"select":"unselect")},drawTracker:H.drawTrackerGraph})})(K);(function(a){var C=a.Chart,D=a.each,E=a.inArray,m=a.isArray,h=a.isObject,f=a.pick,r=a.splat;C.prototype.setResponsive=function(f){var h=this.options.responsive,m=[],e=this.currentResponsive;h&&h.rules&&D(h.rules,function(c){void 0===c._id&&(c._id=a.uniqueKey());this.matchResponsiveRule(c,m,f)},this);var c=a.merge.apply(0,a.map(m,function(c){return a.find(h.rules,function(a){return a._id===c}).chartOptions})),m=m.toString()||void 0;m!==(e&&e.ruleIds)&&(e&&this.update(e.undoOptions,f),m?(this.currentResponsive={ruleIds:m,mergedOptions:c,undoOptions:this.currentOptions(c)},this.update(c,f)):this.currentResponsive=void 0)};C.prototype.matchResponsiveRule=function(a,h){var m=a.condition;(m.callback||function(){return this.chartWidth<=f(m.maxWidth,Number.MAX_VALUE)&&this.chartHeight<=f(m.maxHeight,Number.MAX_VALUE)&&this.chartWidth>=f(m.minWidth,0)&&this.chartHeight>=f(m.minHeight,0)}).call(this)&&h.push(a._id)};C.prototype.currentOptions=function(f){function q(e,c,f,w){var k;a.objectEach(e,function(a,b){if(!w&&-1<E(b,["series","xAxis","yAxis"]))for(a=r(a),f[b]=[],k=0;k<a.length;k++)c[b][k]&&(f[b][k]={},q(a[k],c[b][k],f[b][k],w+1));else h(a)?(f[b]=m(a)?[]:{},q(a,c[b]||{},f[b],w+1)):f[b]=c[b]||null})}var w={};q(f,this.options,w,0);return w}})(K);return K})},"./node_modules/highcharts/modules/exporting.js":function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_RESULT__;(function(g){"object"===typeof module&&module.exports?module.exports=g:true?!(__WEBPACK_AMD_DEFINE_RESULT__=function(){return g}.call(exports,__webpack_require__,exports,module),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)):undefined})(function(g){(function(f){var g=f.defaultOptions,z=f.doc,A=f.Chart,q=f.addEvent,I=f.removeEvent,C=f.fireEvent,r=f.createElement,D=f.discardElement,u=f.css,p=f.merge,B=f.pick,k=f.each,F=f.objectEach,t=f.extend,J=f.isTouchDevice,E=f.win,G=E.navigator.userAgent,K=f.Renderer.prototype.symbols;/Edge\/|Trident\/|MSIE /.test(G);/firefox/i.test(G);t(g.lang,{printChart:"Print chart",downloadPNG:"Download PNG image",downloadJPEG:"Download JPEG image",downloadPDF:"Download PDF document",downloadSVG:"Download SVG vector image",contextButtonTitle:"Chart context menu"});g.navigation={buttonOptions:{theme:{},symbolSize:14,symbolX:12.5,symbolY:10.5,align:"right",buttonSpacing:3,height:22,verticalAlign:"top",width:24}};p(!0,g.navigation,{menuStyle:{border:"1px solid #999999",background:"#ffffff",padding:"5px 0"},menuItemStyle:{padding:"0.5em 1em",background:"none",color:"#333333",fontSize:J?"14px":"11px",transition:"background 250ms, color 250ms"},menuItemHoverStyle:{background:"#335cad",color:"#ffffff"},buttonOptions:{symbolFill:"#666666",symbolStroke:"#666666",symbolStrokeWidth:3,theme:{fill:"#ffffff",stroke:"none",padding:5}}});g.exporting={type:"image/png",url:"https://export.highcharts.com/",printMaxWidth:780,scale:2,buttons:{contextButton:{className:"highcharts-contextbutton",menuClassName:"highcharts-contextmenu",symbol:"menu",_titleKey:"contextButtonTitle",menuItems:"printChart separator downloadPNG downloadJPEG downloadPDF downloadSVG".split(" ")}},menuItemDefinitions:{printChart:{textKey:"printChart",onclick:function(){this.print()}},separator:{separator:!0},downloadPNG:{textKey:"downloadPNG",onclick:function(){this.exportChart()}},downloadJPEG:{textKey:"downloadJPEG",onclick:function(){this.exportChart({type:"image/jpeg"})}},downloadPDF:{textKey:"downloadPDF",onclick:function(){this.exportChart({type:"application/pdf"})}},downloadSVG:{textKey:"downloadSVG",onclick:function(){this.exportChart({type:"image/svg+xml"})}}}};f.post=function(a,b,e){var c=r("form",p({method:"post",action:a,enctype:"multipart/form-data"},e),{display:"none"},z.body);F(b,function(a,b){r("input",{type:"hidden",name:b,value:a},null,c)});c.submit();D(c)};t(A.prototype,{sanitizeSVG:function(a,b){if(b&&b.exporting&&b.exporting.allowHTML){var e=a.match(/<\/svg>(.*?$)/);e&&e[1]&&(e='<foreignObject x="0" y="0" width="'+b.chart.width+'" height="'+b.chart.height+'"><body xmlns="http://www.w3.org/1999/xhtml">'+e[1]+"</body></foreignObject>",a=a.replace("</svg>",e+"</svg>"))}a=a.replace(/zIndex="[^"]+"/g,"").replace(/isShadow="[^"]+"/g,"").replace(/symbolName="[^"]+"/g,"").replace(/jQuery[0-9]+="[^"]+"/g,"").replace(/url\(("|&quot;)(\S+)("|&quot;)\)/g,"url($2)").replace(/url\([^#]+#/g,"url(#").replace(/<svg /,'<svg xmlns:xlink="http://www.w3.org/1999/xlink" ').replace(/ (|NS[0-9]+\:)href=/g," xlink:href=").replace(/\n/," ").replace(/<\/svg>.*?$/,"</svg>").replace(/(fill|stroke)="rgba\(([ 0-9]+,[ 0-9]+,[ 0-9]+),([ 0-9\.]+)\)"/g,'$1="rgb($2)" $1-opacity="$3"').replace(/&nbsp;/g,"").replace(/&shy;/g,"");this.ieSanitizeSVG&&(a=this.ieSanitizeSVG(a));return a},getChartHTML:function(){return this.container.innerHTML},getSVG:function(a){var b,e,c,v,m,h=p(this.options,a);e=r("div",null,{position:"absolute",top:"-9999em",width:this.chartWidth+"px",height:this.chartHeight+"px"},z.body);c=this.renderTo.style.width;m=this.renderTo.style.height;c=h.exporting.sourceWidth||h.chart.width||/px$/.test(c)&&parseInt(c,10)||600;m=h.exporting.sourceHeight||h.chart.height||/px$/.test(m)&&parseInt(m,10)||400;t(h.chart,{animation:!1,renderTo:e,forExport:!0,renderer:"SVGRenderer",width:c,height:m});h.exporting.enabled=!1;delete h.data;h.series=[];k(this.series,function(a){v=p(a.userOptions,{animation:!1,enableMouseTracking:!1,showCheckbox:!1,visible:a.visible});v.isInternal||h.series.push(v)});k(this.axes,function(a){a.userOptions.internalKey||(a.userOptions.internalKey=f.uniqueKey())});b=new f.Chart(h,this.callback);a&&k(["xAxis","yAxis","series"],function(c){var d={};a[c]&&(d[c]=a[c],b.update(d))});k(this.axes,function(a){var c=f.find(b.axes,function(b){return b.options.internalKey===a.userOptions.internalKey}),d=a.getExtremes(),e=d.userMin,d=d.userMax;c&&(void 0!==e&&e!==c.min||void 0!==d&&d!==c.max)&&c.setExtremes(e,d,!0,!1)});c=b.getChartHTML();C(this,"getSVG",{chartCopy:b});c=this.sanitizeSVG(c,h);h=null;b.destroy();D(e);return c},getSVGForExport:function(a,b){var e=this.options.exporting;return this.getSVG(p({chart:{borderRadius:0}},e.chartOptions,b,{exporting:{sourceWidth:a&&a.sourceWidth||e.sourceWidth,sourceHeight:a&&a.sourceHeight||e.sourceHeight}}))},exportChart:function(a,b){b=this.getSVGForExport(a,b);a=p(this.options.exporting,a);f.post(a.url,{filename:a.filename||"chart",type:a.type,width:a.width||0,scale:a.scale,svg:b},a.formAttributes)},print:function(){var a=this,b=a.container,e=[],c=b.parentNode,f=z.body,m=f.childNodes,h=a.options.exporting.printMaxWidth,d,n;if(!a.isPrinting){a.isPrinting=!0;a.pointer.reset(null,0);C(a,"beforePrint");if(n=h&&a.chartWidth>h)d=[a.options.chart.width,void 0,!1],a.setSize(h,void 0,!1);k(m,function(a,b){1===a.nodeType&&(e[b]=a.style.display,a.style.display="none")});f.appendChild(b);setTimeout(function(){E.focus();E.print();setTimeout(function(){c.appendChild(b);k(m,function(a,b){1===a.nodeType&&(a.style.display=e[b])});a.isPrinting=!1;n&&a.setSize.apply(a,d);C(a,"afterPrint")},1e3)},1)}},contextMenu:function(a,b,e,c,v,m,h){var d=this,n=d.options.navigation,g=d.chartWidth,H=d.chartHeight,p="cache-"+a,l=d[p],w=Math.max(v,m),x,y;l||(d[p]=l=r("div",{className:a},{position:"absolute",zIndex:1e3,padding:w+"px",pointerEvents:"auto"},d.fixedDiv||d.container),x=r("div",{className:"highcharts-menu"},null,l),u(x,t({MozBoxShadow:"3px 3px 10px #888",WebkitBoxShadow:"3px 3px 10px #888",boxShadow:"3px 3px 10px #888"},n.menuStyle)),y=function(){u(l,{display:"none"});h&&h.setState(0);d.openMenu=!1},d.exportEvents.push(q(l,"mouseleave",function(){l.hideTimer=setTimeout(y,500)}),q(l,"mouseenter",function(){f.clearTimeout(l.hideTimer)}),q(z,"mouseup",function(b){d.pointer.inClass(b.target,a)||y()}),q(l,"click",function(){d.openMenu&&y()})),k(b,function(a){"string"===typeof a&&(a=d.options.exporting.menuItemDefinitions[a]);if(f.isObject(a,!0)){var b;a.separator?b=r("hr",null,null,x):(b=r("div",{className:"highcharts-menu-item",onclick:function(b){b&&b.stopPropagation();y();a.onclick&&a.onclick.apply(d,arguments)},innerHTML:a.text||d.options.lang[a.textKey]},null,x),b.onmouseover=function(){u(this,n.menuItemHoverStyle)},b.onmouseout=function(){u(this,n.menuItemStyle)},u(b,t({cursor:"pointer"},n.menuItemStyle)));d.exportDivElements.push(b)}}),d.exportDivElements.push(x,l),d.exportMenuWidth=l.offsetWidth,d.exportMenuHeight=l.offsetHeight);b={display:"block"};e+d.exportMenuWidth>g?b.right=g-e-v-w+"px":b.left=e-w+"px";c+m+d.exportMenuHeight>H&&"top"!==h.alignOptions.verticalAlign?b.bottom=H-c-w+"px":b.top=c+m-w+"px";u(l,b);d.openMenu=!0},addButton:function(a){var b=this,e=b.renderer,c=p(b.options.navigation.buttonOptions,a),f=c.onclick,m=c.menuItems,h,d,n=c.symbolSize||12;b.btnCount||(b.btnCount=0);b.exportDivElements||(b.exportDivElements=[],b.exportSVGElements=[]);if(!1!==c.enabled){var g=c.theme,k=g.states,q=k&&k.hover,k=k&&k.select,l;delete g.states;f?l=function(a){a.stopPropagation();f.call(b,a)}:m&&(l=function(){b.contextMenu(d.menuClassName,m,d.translateX,d.translateY,d.width,d.height,d);d.setState(2)});c.text&&c.symbol?g.paddingLeft=B(g.paddingLeft,25):c.text||t(g,{width:c.width,height:c.height,padding:0});d=e.button(c.text,0,0,l,g,q,k).addClass(a.className).attr({"stroke-linecap":"round",title:B(b.options.lang[c._titleKey],"")});d.menuClassName=a.menuClassName||"highcharts-menu-"+b.btnCount++;c.symbol&&(h=e.symbol(c.symbol,c.symbolX-n/2,c.symbolY-n/2,n,n,{width:n,height:n}).addClass("highcharts-button-symbol").attr({zIndex:1}).add(d),h.attr({stroke:c.symbolStroke,fill:c.symbolFill,"stroke-width":c.symbolStrokeWidth||1}));d.add(b.exportingGroup).align(t(c,{width:d.width,x:B(c.x,b.buttonOffset)}),!0,"spacingBox");b.buttonOffset+=(d.width+c.buttonSpacing)*("right"===c.align?-1:1);b.exportSVGElements.push(d,h)}},destroyExport:function(a){var b=a?a.target:this;a=b.exportSVGElements;var e=b.exportDivElements,c=b.exportEvents,g;a&&(k(a,function(a,c){a&&(a.onclick=a.ontouchstart=null,g="cache-"+a.menuClassName,b[g]&&delete b[g],b.exportSVGElements[c]=a.destroy())}),a.length=0);b.exportingGroup&&(b.exportingGroup.destroy(),delete b.exportingGroup);e&&(k(e,function(a,c){f.clearTimeout(a.hideTimer);I(a,"mouseleave");b.exportDivElements[c]=a.onmouseout=a.onmouseover=a.ontouchstart=a.onclick=null;D(a)}),e.length=0);c&&(k(c,function(a){a()}),c.length=0)}});K.menu=function(a,b,e,c){return["M",a,b+2.5,"L",a+e,b+2.5,"M",a,b+c/2+.5,"L",a+e,b+c/2+.5,"M",a,b+c-1.5,"L",a+e,b+c-1.5]};A.prototype.renderExporting=function(){var a=this,b=a.options.exporting,e=b.buttons,c=a.isDirtyExporting||!a.exportSVGElements;a.buttonOffset=0;a.isDirtyExporting&&a.destroyExport();c&&!1!==b.enabled&&(a.exportEvents=[],a.exportingGroup=a.exportingGroup||a.renderer.g("exporting-group").attr({zIndex:3}).add(),F(e,function(b){a.addButton(b)}),a.isDirtyExporting=!1);q(a,"destroy",a.destroyExport)};q(A,"init",function(){var a=this;k(["exporting","navigation"],function(b){a[b]={update:function(e,c){a.isDirtyExporting=!0;p(!0,a.options[b],e);B(c,!0)&&a.redraw()}}})});A.prototype.callbacks.push(function(a){a.renderExporting();q(a,"redraw",a.renderExporting)})})(g)})},"./node_modules/highcharts/modules/heatmap.js":function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_RESULT__;(function(k){"object"===typeof module&&module.exports?module.exports=k:true?!(__WEBPACK_AMD_DEFINE_RESULT__=function(){return k}.call(exports,__webpack_require__,exports,module),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)):undefined})(function(k){(function(b){var t=b.addEvent,g=b.Axis,k=b.Chart,m=b.color,q,h=b.each,r=b.extend,p=b.isNumber,e=b.Legend,c=b.LegendSymbolMixin,x=b.noop,w=b.merge,u=b.pick;b.ColorAxis||(q=b.ColorAxis=function(){this.init.apply(this,arguments)},r(q.prototype,g.prototype),r(q.prototype,{defaultColorAxisOptions:{lineWidth:0,minPadding:0,maxPadding:0,gridLineWidth:1,tickPixelInterval:72,startOnTick:!0,endOnTick:!0,offset:0,marker:{animation:{duration:50},width:.01,color:"#999999"},labels:{overflow:"justify",rotation:0},minColor:"#e6ebf5",maxColor:"#003399",tickLength:5,showInLegend:!0},keepProps:["legendGroup","legendItemHeight","legendItemWidth","legendItem","legendSymbol"].concat(g.prototype.keepProps),init:function(a,d){var f="vertical"!==a.options.legend.layout,n;this.coll="colorAxis";n=w(this.defaultColorAxisOptions,{side:f?2:1,reversed:!f},d,{opposite:!f,showEmpty:!1,title:null,visible:a.options.legend.enabled});g.prototype.init.call(this,a,n);d.dataClasses&&this.initDataClasses(d);this.initStops();this.horiz=f;this.zoomEnabled=!1;this.defaultLegendLength=200},initDataClasses:function(a){var d=this.chart,f,n=0,l=d.options.chart.colorCount,b=this.options,e=a.dataClasses.length;this.dataClasses=f=[];this.legendItems=[];h(a.dataClasses,function(a,c){a=w(a);f.push(a);a.color||("category"===b.dataClassColor?(c=d.options.colors,l=c.length,a.color=c[n],a.colorIndex=n,n++,n===l&&(n=0)):a.color=m(b.minColor).tweenTo(m(b.maxColor),2>e?.5:c/(e-1)))})},setTickPositions:function(){if(!this.dataClasses)return g.prototype.setTickPositions.call(this)},initStops:function(){this.stops=this.options.stops||[[0,this.options.minColor],[1,this.options.maxColor]];h(this.stops,function(a){a.color=m(a[1])})},setOptions:function(a){g.prototype.setOptions.call(this,a);this.options.crosshair=this.options.marker},setAxisSize:function(){var a=this.legendSymbol,d=this.chart,f=d.options.legend||{},n,l;a?(this.left=f=a.attr("x"),this.top=n=a.attr("y"),this.width=l=a.attr("width"),this.height=a=a.attr("height"),this.right=d.chartWidth-f-l,this.bottom=d.chartHeight-n-a,this.len=this.horiz?l:a,this.pos=this.horiz?f:n):this.len=(this.horiz?f.symbolWidth:f.symbolHeight)||this.defaultLegendLength},normalizedValue:function(a){this.isLog&&(a=this.val2lin(a));return 1-(this.max-a)/(this.max-this.min||1)},toColor:function(a,d){var f=this.stops,n,l,b=this.dataClasses,e,c;if(b)for(c=b.length;c--;){if(e=b[c],n=e.from,f=e.to,(void 0===n||a>=n)&&(void 0===f||a<=f)){l=e.color;d&&(d.dataClass=c,d.colorIndex=e.colorIndex);break}}else{a=this.normalizedValue(a);for(c=f.length;c--&&!(a>f[c][0]););n=f[c]||f[c+1];f=f[c+1]||n;a=1-(f[0]-a)/(f[0]-n[0]||1);l=n.color.tweenTo(f.color,a)}return l},getOffset:function(){var a=this.legendGroup,d=this.chart.axisOffset[this.side];a&&(this.axisParent=a,g.prototype.getOffset.call(this),this.added||(this.added=!0,this.labelLeft=0,this.labelRight=this.width),this.chart.axisOffset[this.side]=d)},setLegendColor:function(){var a,d=this.reversed;a=d?1:0;d=d?0:1;a=this.horiz?[a,0,d,0]:[0,d,0,a];this.legendColor={linearGradient:{x1:a[0],y1:a[1],x2:a[2],y2:a[3]},stops:this.stops}},drawLegendSymbol:function(a,d){var f=a.padding,b=a.options,l=this.horiz,c=u(b.symbolWidth,l?this.defaultLegendLength:12),e=u(b.symbolHeight,l?12:this.defaultLegendLength),h=u(b.labelPadding,l?16:30),b=u(b.itemDistance,10);this.setLegendColor();d.legendSymbol=this.chart.renderer.rect(0,a.baseline-11,c,e).attr({zIndex:1}).add(d.legendGroup);this.legendItemWidth=c+f+(l?b:h);this.legendItemHeight=e+f+(l?h:0)},setState:function(a){h(this.series,function(d){d.setState(a)})},visible:!0,setVisible:x,getSeriesExtremes:function(){var a=this.series,d=a.length;this.dataMin=Infinity;for(this.dataMax=-Infinity;d--;)a[d].getExtremes(),void 0!==a[d].valueMin&&(this.dataMin=Math.min(this.dataMin,a[d].valueMin),this.dataMax=Math.max(this.dataMax,a[d].valueMax))},drawCrosshair:function(a,d){var f=d&&d.plotX,b=d&&d.plotY,c,e=this.pos,h=this.len;d&&(c=this.toPixels(d[d.series.colorKey]),c<e?c=e-2:c>e+h&&(c=e+h+2),d.plotX=c,d.plotY=this.len-c,g.prototype.drawCrosshair.call(this,a,d),d.plotX=f,d.plotY=b,this.cross&&!this.cross.addedToColorAxis&&this.legendGroup&&(this.cross.addClass("highcharts-coloraxis-marker").add(this.legendGroup),this.cross.addedToColorAxis=!0,this.cross.attr({fill:this.crosshair.color})))},getPlotLinePath:function(a,d,f,b,c){return p(c)?this.horiz?["M",c-4,this.top-6,"L",c+4,this.top-6,c,this.top,"Z"]:["M",this.left,c,"L",this.left-6,c+6,this.left-6,c-6,"Z"]:g.prototype.getPlotLinePath.call(this,a,d,f,b)},update:function(a,d){var c=this.chart,b=c.legend;h(this.series,function(a){a.isDirtyData=!0});a.dataClasses&&b.allItems&&(h(b.allItems,function(a){a.isDataClass&&a.legendGroup&&a.legendGroup.destroy()}),c.isDirtyLegend=!0);c.options[this.coll]=w(this.userOptions,a);g.prototype.update.call(this,a,d);this.legendItem&&(this.setLegendColor(),b.colorizeItem(this,!0))},remove:function(){this.legendItem&&this.chart.legend.destroyItem(this);g.prototype.remove.call(this)},getDataClassLegendSymbols:function(){var a=this,d=this.chart,f=this.legendItems,e=d.options.legend,l=e.valueDecimals,q=e.valueSuffix||"",g;f.length||h(this.dataClasses,function(e,n){var m=!0,p=e.from,k=e.to;g="";void 0===p?g="< ":void 0===k&&(g="> ");void 0!==p&&(g+=b.numberFormat(p,l)+q);void 0!==p&&void 0!==k&&(g+=" - ");void 0!==k&&(g+=b.numberFormat(k,l)+q);f.push(r({chart:d,name:g,options:{},drawLegendSymbol:c.drawRectangle,visible:!0,setState:x,isDataClass:!0,setVisible:function(){m=this.visible=!m;h(a.series,function(a){h(a.points,function(a){a.dataClass===n&&a.setVisible(m)})});d.legend.colorizeItem(this,m)}},e))});return f},name:""}),h(["fill","stroke"],function(a){b.Fx.prototype[a+"Setter"]=function(){this.elem.attr(a,m(this.start).tweenTo(m(this.end),this.pos),null,!0)}}),t(k,"afterGetAxes",function(){var a=this.options.colorAxis;this.colorAxis=[];a&&new q(this,a)}),t(e,"afterGetAllItems",function(a){var d=[],c=this.chart.colorAxis[0];c&&c.options&&c.options.showInLegend&&(c.options.dataClasses?d=c.getDataClassLegendSymbols():d.push(c),h(c.series,function(c){b.erase(a.allItems,c)}));for(c=d.length;c--;)a.allItems.unshift(d[c])}),t(e,"afterColorizeItem",function(a){a.visible&&a.item.legendColor&&a.item.legendSymbol.attr({fill:a.item.legendColor})}),t(e,"afterUpdate",function(a,c,b){this.chart.colorAxis[0]&&this.chart.colorAxis[0].update({},b)}))})(k);(function(b){var k=b.defined,g=b.each,v=b.noop,m=b.seriesTypes;b.colorPointMixin={isValid:function(){return null!==this.value&&Infinity!==this.value&&-Infinity!==this.value},setVisible:function(b){var h=this,q=b?"show":"hide";g(["graphic","dataLabel"],function(b){if(h[b])h[b][q]()})},setState:function(g){b.Point.prototype.setState.call(this,g);this.graphic&&this.graphic.attr({zIndex:"hover"===g?1:0})}};b.colorSeriesMixin={pointArrayMap:["value"],axisTypes:["xAxis","yAxis","colorAxis"],optionalAxis:"colorAxis",trackerGroups:["group","markerGroup","dataLabelsGroup"],getSymbol:v,parallelArrays:["x","y","value"],colorKey:"value",pointAttribs:m.column.prototype.pointAttribs,translateColors:function(){var b=this,h=this.options.nullColor,k=this.colorAxis,m=this.colorKey;g(this.data,function(e){var c=e[m];if(c=e.options.color||(e.isNull?h:k&&void 0!==c?k.toColor(c,e):e.color||b.color))e.color=c})},colorAttribs:function(b){var g={};k(b.color)&&(g[this.colorProp||"fill"]=b.color);return g}}})(k);(function(b){var k=b.colorPointMixin,g=b.each,v=b.merge,m=b.noop,q=b.pick,h=b.Series,r=b.seriesType,p=b.seriesTypes;r("heatmap","scatter",{animation:!1,borderWidth:0,nullColor:"#f7f7f7",dataLabels:{formatter:function(){return this.point.value},inside:!0,verticalAlign:"middle",crop:!1,overflow:!1,padding:0},marker:null,pointRange:null,tooltip:{pointFormat:"{point.x}, {point.y}: {point.value}<br/>"},states:{hover:{halo:!1,brightness:.2}}},v(b.colorSeriesMixin,{pointArrayMap:["y","value"],hasPointSpecificOptions:!0,getExtremesFromAll:!0,directTouch:!0,init:function(){var b;p.scatter.prototype.init.apply(this,arguments);b=this.options;b.pointRange=q(b.pointRange,b.colsize||1);this.yAxis.axisPointRange=b.rowsize||1},translate:function(){var b=this.options,c=this.xAxis,h=this.yAxis,k=b.pointPadding||0,m=function(a,b,c){return Math.min(Math.max(b,a),c)};this.generatePoints();g(this.points,function(a){var d=(b.colsize||1)/2,e=(b.rowsize||1)/2,g=m(Math.round(c.len-c.translate(a.x-d,0,1,0,1)),-c.len,2*c.len),d=m(Math.round(c.len-c.translate(a.x+d,0,1,0,1)),-c.len,2*c.len),l=m(Math.round(h.translate(a.y-e,0,1,0,1)),-h.len,2*h.len),e=m(Math.round(h.translate(a.y+e,0,1,0,1)),-h.len,2*h.len),p=q(a.pointPadding,k);a.plotX=a.clientX=(g+d)/2;a.plotY=(l+e)/2;a.shapeType="rect";a.shapeArgs={x:Math.min(g,d)+p,y:Math.min(l,e)+p,width:Math.abs(d-g)-2*p,height:Math.abs(e-l)-2*p}});this.translateColors()},drawPoints:function(){p.column.prototype.drawPoints.call(this);g(this.points,function(b){b.graphic.attr(this.colorAttribs(b))},this)},animate:m,getBox:m,drawLegendSymbol:b.LegendSymbolMixin.drawRectangle,alignDataLabel:p.column.prototype.alignDataLabel,getExtremes:function(){h.prototype.getExtremes.call(this,this.valueData);this.valueMin=this.dataMin;this.valueMax=this.dataMax;h.prototype.getExtremes.call(this)}}),b.extend({haloPath:function(b){if(!b)return[];var c=this.shapeArgs;return["M",c.x-b,c.y-b,"L",c.x-b,c.y+c.height+b,c.x+c.width+b,c.y+c.height+b,c.x+c.width+b,c.y-b,"Z"]}},k))})(k)})},"./node_modules/highcharts/modules/offline-exporting.js":function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_RESULT__;(function(h){"object"===typeof module&&module.exports?module.exports=h:true?!(__WEBPACK_AMD_DEFINE_RESULT__=function(){return h}.call(exports,__webpack_require__,exports,module),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)):undefined})(function(h){(function(c){function h(b,f){var d=r.getElementsByTagName("head")[0],a=r.createElement("script");a.type="text/javascript";a.src=b;a.onload=f;a.onerror=function(){c.error("Error loading script "+b)};d.appendChild(a)}var D=c.addEvent,E=c.merge,e=c.win,n=e.navigator,r=e.document,x=c.each,y=e.URL||e.webkitURL||e,B=/Edge\/|Trident\/|MSIE /.test(n.userAgent),F=/Edge\/\d+/.test(n.userAgent),G=B?150:0;c.CanVGRenderer={};c.dataURLtoBlob=function(b){if(e.atob&&e.ArrayBuffer&&e.Uint8Array&&e.Blob&&y.createObjectURL){b=b.match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/);for(var c=e.atob(b[3]),d=new e.ArrayBuffer(c.length),d=new e.Uint8Array(d),a=0;a<d.length;++a)d[a]=c.charCodeAt(a);b=new e.Blob([d],{type:b[1]});return y.createObjectURL(b)}};c.downloadURL=function(b,f){var d=r.createElement("a"),a;if("string"===typeof b||b instanceof String||!n.msSaveOrOpenBlob){if(F||2e6<b.length)if(b=c.dataURLtoBlob(b),!b)throw"Data URL length limit reached";if(void 0!==d.download)d.href=b,d.download=f,r.body.appendChild(d),d.click(),r.body.removeChild(d);else try{if(a=e.open(b,"chart"),void 0===a||null===a)throw"Failed to open window"}catch(t){e.location.href=b}}else n.msSaveOrOpenBlob(b,f)};c.svgToDataUrl=function(b){var c=-1<n.userAgent.indexOf("WebKit")&&0>n.userAgent.indexOf("Chrome");try{if(!c&&0>n.userAgent.toLowerCase().indexOf("firefox"))return y.createObjectURL(new e.Blob([b],{type:"image/svg+xml;charset-utf-16"}))}catch(d){}return"data:image/svg+xml;charset=UTF-8,"+encodeURIComponent(b)};c.imageToDataUrl=function(b,c,d,a,t,m,l,h,p){var g=new e.Image,k,f=function(){setTimeout(function(){var e=r.createElement("canvas"),f=e.getContext&&e.getContext("2d"),w;try{if(f){e.height=g.height*a;e.width=g.width*a;f.drawImage(g,0,0,e.width,e.height);try{w=e.toDataURL(c),t(w,c,d,a)}catch(C){k(b,c,d,a)}}else l(b,c,d,a)}finally{p&&p(b,c,d,a)}},G)},q=function(){h(b,c,d,a);p&&p(b,c,d,a)};k=function(){g=new e.Image;k=m;g.crossOrigin="Anonymous";g.onload=f;g.onerror=q;g.src=b};g.onload=f;g.onerror=q;g.src=b};c.downloadSVGLocal=function(b,f,d,a){function t(a,b){b=new e.jsPDF("l","pt",[a.width.baseVal.value+2*b,a.height.baseVal.value+2*b]);x(a.querySelectorAll('*[visibility="hidden"]'),function(a){a.parentNode.removeChild(a)});e.svg2pdf(a,b,{removeInvalid:!0});return b.output("datauristring")}function m(){z.innerHTML=b;var e=z.getElementsByTagName("text"),f;x(e,function(a){x(["font-family","font-size"],function(b){for(var c=a;c&&c!==z;){if(c.style[b]){a.style[b]=c.style[b];break}c=c.parentNode}});a.style["font-family"]=a.style["font-family"]&&a.style["font-family"].split(" ").splice(-1);f=a.getElementsByTagName("title");x(f,function(b){a.removeChild(b)})});e=t(z.firstChild,0);try{c.downloadURL(e,v),a&&a()}catch(H){d(H)}}var l,u,p=!0,g,k=f.libURL||c.getOptions().exporting.libURL,z=r.createElement("div"),q=f.type||"image/png",v=(f.filename||"chart")+"."+("image/svg+xml"===q?"svg":q.split("/")[1]),A=f.scale||1,k="/"!==k.slice(-1)?k+"/":k;if("image/svg+xml"===q)try{n.msSaveOrOpenBlob?(u=new MSBlobBuilder,u.append(b),l=u.getBlob("image/svg+xml")):l=c.svgToDataUrl(b),c.downloadURL(l,v),a&&a()}catch(w){d(w)}else"application/pdf"===q?e.jsPDF&&e.svg2pdf?m():(p=!0,h(k+"jspdf.js",function(){h(k+"svg2pdf.js",function(){m()})})):(l=c.svgToDataUrl(b),g=function(){try{y.revokeObjectURL(l)}catch(w){}},c.imageToDataUrl(l,q,{},A,function(b){try{c.downloadURL(b,v),a&&a()}catch(C){d(C)}},function(){var f=r.createElement("canvas"),t=f.getContext("2d"),m=b.match(/^<svg[^>]*width\s*=\s*\"?(\d+)\"?[^>]*>/)[1]*A,l=b.match(/^<svg[^>]*height\s*=\s*\"?(\d+)\"?[^>]*>/)[1]*A,u=function(){t.drawSvg(b,0,0,m,l);try{c.downloadURL(n.msSaveOrOpenBlob?f.msToBlob():f.toDataURL(q),v),a&&a()}catch(I){d(I)}finally{g()}};f.width=m;f.height=l;e.canvg?u():(p=!0,h(k+"rgbcolor.js",function(){h(k+"canvg.js",function(){u()})}))},d,d,function(){p&&g()}))};c.Chart.prototype.getSVGForLocalExport=function(b,e,d,a){var f=this,m,l=0,h,p,g,k,n,q=function(b,c,d){++l;d.imageElement.setAttributeNS("http://www.w3.org/1999/xlink","href",b);l===m.length&&a(f.sanitizeSVG(h.innerHTML,p))};f.unbindGetSVG=D(f,"getSVG",function(a){p=a.chartCopy.options;h=a.chartCopy.container.cloneNode(!0)});f.getSVGForExport(b,e);m=h.getElementsByTagName("image");try{if(!m.length){a(f.sanitizeSVG(h.innerHTML,p));return}k=0;for(n=m.length;k<n;++k)g=m[k],c.imageToDataUrl(g.getAttributeNS("http://www.w3.org/1999/xlink","href"),"image/png",{imageElement:g},b.scale,q,d,d,d)}catch(v){d(v)}f.unbindGetSVG()};c.Chart.prototype.exportChartLocal=function(b,e){var d=this,a=c.merge(d.options.exporting,b),f=function(b){!1===a.fallbackToExportServer?a.error?a.error(a,b):c.error(28,!0):d.exportChart(a)};B&&("application/pdf"===a.type||d.container.getElementsByTagName("image").length&&"image/svg+xml"!==a.type)||"application/pdf"===a.type&&d.container.getElementsByTagName("image").length?f("Image type not supported for this chart/browser."):d.getSVGForLocalExport(a,e,f,function(b){-1<b.indexOf("<foreignObject")&&"image/svg+xml"!==a.type?f("Image type not supported for charts with embedded HTML"):c.downloadSVGLocal(b,a,f)})};E(!0,c.getOptions().exporting,{libURL:"https://code.highcharts.com/6.1.2/lib/",menuItemDefinitions:{downloadPNG:{textKey:"downloadPNG",onclick:function(){this.exportChartLocal()}},downloadJPEG:{textKey:"downloadJPEG",onclick:function(){this.exportChartLocal({type:"image/jpeg"})}},downloadSVG:{textKey:"downloadSVG",onclick:function(){this.exportChartLocal({type:"image/svg+xml"})}},downloadPDF:{textKey:"downloadPDF",onclick:function(){this.exportChartLocal({type:"application/pdf"})}}}})})(h)})},"./node_modules/highcharts/modules/sunburst.js":function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_RESULT__;(function(F){"object"===typeof module&&module.exports?module.exports=F:true?!(__WEBPACK_AMD_DEFINE_RESULT__=function(){return F}.call(exports,__webpack_require__,exports,module),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)):undefined})(function(F){var P=function(){return function(c){var t=this,f=t.graphic,y=c.animate,e=c.attr,w=c.onComplete,J=c.css,E=c.group,r=c.renderer,z=c.shapeArgs;c=c.shapeType;t.shouldDraw()?(f||(t.graphic=f=r[c](z).add(E)),f.css(J).attr(e).animate(y,void 0,w)):f&&f.animate(y,void 0,function(){t.graphic=f=f.destroy();"function"===typeof w&&w()});f&&f.addClass(t.getClassName(),!0)}}(),M=function(c){var t=c.each,f=c.extend,y=c.isArray,e=c.isObject,w=c.isNumber,J=c.merge,E=c.pick,r=c.reduce;return{getColor:function(z,v){var x=v.index,m=v.mapOptionsToLevel,f=v.parentColor,w=v.parentColorIndex,r=v.series,l=v.colors,H=v.siblings,C=r.points,e,y,t,A;if(z){C=C[z.i];z=m[z.level]||{};if(e=C&&z.colorByPoint)t=C.index%(l?l.length:r.chart.options.chart.colorCount),y=l&&l[t];l=C&&C.options.color;e=z&&z.color;if(m=f)m=(m=z&&z.colorVariation)&&"brightness"===m.key?c.color(f).brighten(x/H*m.to).get():f;e=E(l,e,y,m,r.color);A=E(C&&C.options.colorIndex,z&&z.colorIndex,t,w,v.colorIndex)}return{color:e,colorIndex:A}},getLevelOptions:function(c){var v=null,x,m,G,t;if(e(c))for(v={},G=w(c.from)?c.from:1,t=c.levels,m={},x=e(c.defaults)?c.defaults:{},y(t)&&(m=r(t,function(c,l){var m,v;e(l)&&w(l.level)&&(v=J({},l),m="boolean"===typeof v.levelIsConstant?v.levelIsConstant:x.levelIsConstant,delete v.levelIsConstant,delete v.level,l=l.level+(m?0:G-1),e(c[l])?f(c[l],v):c[l]=v);return c},{})),t=w(c.to)?c.to:1,c=0;c<=t;c++)v[c]=J({},x,e(m[c])?m[c]:{});return v},setTreeValues:function v(c,m){var r=m.before,e=m.idRoot,w=m.mapIdToNode[e],l=m.points[c.i],x=l&&l.options||{},C=0,y=[];f(c,{levelDynamic:c.level-(("boolean"===typeof m.levelIsConstant?m.levelIsConstant:1)?0:w.level),name:E(l&&l.name,""),visible:e===c.id||("boolean"===typeof m.visible?m.visible:!1)});"function"===typeof r&&(c=r(c,m));t(c.children,function(l,r){var e=f({},m);f(e,{index:r,siblings:c.children.length,visible:c.visible});l=v(l,e);y.push(l);l.visible&&(C+=l.val)});c.visible=0<C||c.visible;r=E(x.value,C);f(c,{children:y,childrenTotal:C,isLeaf:c.visible&&!C,val:r});return c},updateRootId:function(c){var r;e(c)&&(r=e(c.options)?c.options:{},r=E(c.rootNode,r.rootId,""),e(c.userOptions)&&(c.userOptions.rootId=r),c.rootNode=r);return r}}}(F);(function(c,t){var f=c.seriesType,y=c.seriesTypes,e=c.map,w=c.merge,J=c.extend,E=c.noop,r=c.each,z=t.getColor,v=t.getLevelOptions,x=c.grep,m=c.isArray,G=c.isNumber,I=c.isObject,F=c.isString,l=c.pick,H=c.Series,C=c.stableSort,K=c.Color,O=function(a,b,d){d=d||this;c.objectEach(a,function(p,c){b.call(d,p,c,a)})},L=c.reduce,A=function(a,b,d){d=d||this;a=b.call(d,a);!1!==a&&A(a,b,d)},N=t.updateRootId;f("treemap","scatter",{showInLegend:!1,marker:!1,colorByPoint:!1,dataLabels:{enabled:!0,defer:!1,verticalAlign:"middle",formatter:function(){return this.point.name||this.point.id},inside:!0},tooltip:{headerFormat:"",pointFormat:"<b>{point.name}</b>: {point.value}<br/>"},ignoreHiddenPoint:!0,layoutAlgorithm:"sliceAndDice",layoutStartingDirection:"vertical",alternateStartingDirection:!1,levelIsConstant:!0,drillUpButton:{position:{align:"right",x:-10,y:10}},borderColor:"#e6e6e6",borderWidth:1,opacity:.15,states:{hover:{borderColor:"#999999",brightness:y.heatmap?0:.1,halo:!1,opacity:.75,shadow:!1}}},{pointArrayMap:["value"],directTouch:!0,optionalAxis:"colorAxis",getSymbol:E,parallelArrays:["x","y","value","colorValue"],colorKey:"colorValue",trackerGroups:["group","dataLabelsGroup"],getListOfParents:function(a,b){a=m(a)?a:[];var d=m(b)?b:[];b=L(a,function(b,a,d){a=l(a.parent,"");void 0===b[a]&&(b[a]=[]);b[a].push(d);return b},{"":[]});O(b,function(b,a,q){""!==a&&-1===c.inArray(a,d)&&(r(b,function(b){q[""].push(b)}),delete q[a])});return b},getTree:function(){var a=e(this.data,function(b){return b.id}),a=this.getListOfParents(this.data,a);this.nodeMap=[];return this.buildNode("",-1,0,a,null)},init:function(a,b){var d=c.colorSeriesMixin;c.colorSeriesMixin&&(this.translateColors=d.translateColors,this.colorAttribs=d.colorAttribs,this.axisTypes=d.axisTypes);H.prototype.init.call(this,a,b);this.options.allowDrillToNode&&c.addEvent(this,"click",this.onClickDrillToNode)},buildNode:function(a,b,d,c,h){var p=this,g=[],k=p.points[b],u=0,n;r(c[a]||[],function(b){n=p.buildNode(p.points[b].id,b,d+1,c,a);u=Math.max(n.height+1,u);g.push(n)});b={id:a,i:b,children:g,height:u,level:d,parent:h,visible:!1};p.nodeMap[b.id]=b;k&&(k.node=b);return b},setTreeValues:function(a){var b=this,d=b.options,c=b.nodeMap[b.rootNode],d="boolean"===typeof d.levelIsConstant?d.levelIsConstant:!0,h=0,q=[],g,k=b.points[a.i];r(a.children,function(a){a=b.setTreeValues(a);q.push(a);a.ignore||(h+=a.val)});C(q,function(b,a){return b.sortIndex-a.sortIndex});g=l(k&&k.options.value,h);k&&(k.value=g);J(a,{children:q,childrenTotal:h,ignore:!(l(k&&k.visible,!0)&&0<g),isLeaf:a.visible&&!h,levelDynamic:a.level-(d?0:c.level),name:l(k&&k.name,""),sortIndex:l(k&&k.sortIndex,-g),val:g});return a},calculateChildrenAreas:function(a,b){var d=this,c=d.options,h=d.mapOptionsToLevel[a.level+1],q=l(d[h&&h.layoutAlgorithm]&&h.layoutAlgorithm,c.layoutAlgorithm),g=c.alternateStartingDirection,k=[];a=x(a.children,function(b){return!b.ignore});h&&h.layoutStartingDirection&&(b.direction="vertical"===h.layoutStartingDirection?0:1);k=d[q](b,a);r(a,function(a,c){c=k[c];a.values=w(c,{val:a.childrenTotal,direction:g?1-b.direction:b.direction});a.pointValues=w(c,{x:c.x/d.axisRatio,width:c.width/d.axisRatio});a.children.length&&d.calculateChildrenAreas(a,a.values)})},setPointValues:function(){var a=this,b=a.xAxis,d=a.yAxis;r(a.points,function(c){var p=c.node,q=p.pointValues,g,k,u;u=(a.pointAttribs(c)["stroke-width"]||0)%2/2;q&&p.visible?(p=Math.round(b.translate(q.x,0,0,0,1))-u,g=Math.round(b.translate(q.x+q.width,0,0,0,1))-u,k=Math.round(d.translate(q.y,0,0,0,1))-u,q=Math.round(d.translate(q.y+q.height,0,0,0,1))-u,c.shapeType="rect",c.shapeArgs={x:Math.min(p,g),y:Math.min(k,q),width:Math.abs(g-p),height:Math.abs(q-k)},c.plotX=c.shapeArgs.x+c.shapeArgs.width/2,c.plotY=c.shapeArgs.y+c.shapeArgs.height/2):(delete c.plotX,delete c.plotY)})},setColorRecursive:function(a,b,d,c,h){var p=this,g=p&&p.chart,g=g&&g.options&&g.options.colors,k;if(a){k=z(a,{colors:g,index:c,mapOptionsToLevel:p.mapOptionsToLevel,parentColor:b,parentColorIndex:d,series:p,siblings:h});if(b=p.points[a.i])b.color=k.color,b.colorIndex=k.colorIndex;r(a.children||[],function(b,d){p.setColorRecursive(b,k.color,k.colorIndex,d,a.children.length)})}},algorithmGroup:function(a,b,d,c){this.height=a;this.width=b;this.plot=c;this.startDirection=this.direction=d;this.lH=this.nH=this.lW=this.nW=this.total=0;this.elArr=[];this.lP={total:0,lH:0,nH:0,lW:0,nW:0,nR:0,lR:0,aspectRatio:function(b,a){return Math.max(b/a,a/b)}};this.addElement=function(b){this.lP.total=this.elArr[this.elArr.length-1];this.total+=b;0===this.direction?(this.lW=this.nW,this.lP.lH=this.lP.total/this.lW,this.lP.lR=this.lP.aspectRatio(this.lW,this.lP.lH),this.nW=this.total/this.height,this.lP.nH=this.lP.total/this.nW,this.lP.nR=this.lP.aspectRatio(this.nW,this.lP.nH)):(this.lH=this.nH,this.lP.lW=this.lP.total/this.lH,this.lP.lR=this.lP.aspectRatio(this.lP.lW,this.lH),this.nH=this.total/this.width,this.lP.nW=this.lP.total/this.nH,this.lP.nR=this.lP.aspectRatio(this.lP.nW,this.nH));this.elArr.push(b)};this.reset=function(){this.lW=this.nW=0;this.elArr=[];this.total=0}},algorithmCalcPoints:function(a,b,d,c){var p,q,g,k,u=d.lW,n=d.lH,B=d.plot,l,m=0,e=d.elArr.length-1;b?(u=d.nW,n=d.nH):l=d.elArr[d.elArr.length-1];r(d.elArr,function(a){if(b||m<e)0===d.direction?(p=B.x,q=B.y,g=u,k=a/g):(p=B.x,q=B.y,k=n,g=a/k),c.push({x:p,y:q,width:g,height:k}),0===d.direction?B.y+=k:B.x+=g;m+=1});d.reset();0===d.direction?d.width-=u:d.height-=n;B.y=B.parent.y+(B.parent.height-d.height);B.x=B.parent.x+(B.parent.width-d.width);a&&(d.direction=1-d.direction);b||d.addElement(l)},algorithmLowAspectRatio:function(a,b,d){var c=[],h=this,q,g={x:b.x,y:b.y,parent:b},k=0,l=d.length-1,n=new this.algorithmGroup(b.height,b.width,b.direction,g);r(d,function(d){q=d.val/b.val*b.height*b.width;n.addElement(q);n.lP.nR>n.lP.lR&&h.algorithmCalcPoints(a,!1,n,c,g);k===l&&h.algorithmCalcPoints(a,!0,n,c,g);k+=1});return c},algorithmFill:function(a,b,d){var c=[],h,q=b.direction,g=b.x,k=b.y,l=b.width,n=b.height,B,m,e,f;r(d,function(d){h=d.val/b.val*b.height*b.width;B=g;m=k;0===q?(f=n,e=h/f,l-=e,g+=e):(e=l,f=h/e,n-=f,k+=f);c.push({x:B,y:m,width:e,height:f});a&&(q=1-q)});return c},strip:function(a,b){return this.algorithmLowAspectRatio(!1,a,b)},squarified:function(a,b){return this.algorithmLowAspectRatio(!0,a,b)},sliceAndDice:function(a,b){return this.algorithmFill(!0,a,b)},stripes:function(a,b){return this.algorithmFill(!1,a,b)},translate:function(){var a=this,b=a.options,d=N(a),c,h;H.prototype.translate.call(a);h=a.tree=a.getTree();c=a.nodeMap[d];a.mapOptionsToLevel=v({from:c.level+1,levels:b.levels,to:h.height,defaults:{levelIsConstant:a.options.levelIsConstant,colorByPoint:b.colorByPoint}});""===d||c&&c.children.length||(a.drillToNode("",!1),d=a.rootNode,c=a.nodeMap[d]);A(a.nodeMap[a.rootNode],function(b){var d=!1,c=b.parent;b.visible=!0;if(c||""===c)d=a.nodeMap[c];return d});A(a.nodeMap[a.rootNode].children,function(b){var a=!1;r(b,function(b){b.visible=!0;b.children.length&&(a=(a||[]).concat(b.children))});return a});a.setTreeValues(h);a.axisRatio=a.xAxis.len/a.yAxis.len;a.nodeMap[""].pointValues=d={x:0,y:0,width:100,height:100};a.nodeMap[""].values=d=w(d,{width:d.width*a.axisRatio,direction:"vertical"===b.layoutStartingDirection?0:1,val:h.val});a.calculateChildrenAreas(h,d);a.colorAxis?a.translateColors():b.colorByPoint||a.setColorRecursive(a.tree);b.allowDrillToNode&&(b=c.pointValues,a.xAxis.setExtremes(b.x,b.x+b.width,!1),a.yAxis.setExtremes(b.y,b.y+b.height,!1),a.xAxis.setScale(),a.yAxis.setScale());a.setPointValues()},drawDataLabels:function(){var a=this,b=a.mapOptionsToLevel,c=x(a.points,function(b){return b.node.visible}),p,h;r(c,function(c){h=b[c.node.level];p={style:{}};c.node.isLeaf||(p.enabled=!1);h&&h.dataLabels&&(p=w(p,h.dataLabels),a._hasPointLabels=!0);c.shapeArgs&&(p.style.width=c.shapeArgs.width,c.dataLabel&&c.dataLabel.css({width:c.shapeArgs.width+"px"}));c.dlOptions=w(p,c.options.dataLabels)});H.prototype.drawDataLabels.call(this)},alignDataLabel:function(a){y.column.prototype.alignDataLabel.apply(this,arguments);a.dataLabel&&a.dataLabel.attr({zIndex:(a.node.zIndex||0)+1})},pointAttribs:function(a,b){var c=I(this.mapOptionsToLevel)?this.mapOptionsToLevel:{},p=a&&c[a.node.level]||{},c=this.options,h=b&&c.states[b]||{},q=a&&a.getClassName()||"";a={stroke:a&&a.borderColor||p.borderColor||h.borderColor||c.borderColor,"stroke-width":l(a&&a.borderWidth,p.borderWidth,h.borderWidth,c.borderWidth),dashstyle:a&&a.borderDashStyle||p.borderDashStyle||h.borderDashStyle||c.borderDashStyle,fill:a&&a.color||this.color};-1!==q.indexOf("highcharts-above-level")?(a.fill="none",a["stroke-width"]=0):-1!==q.indexOf("highcharts-internal-node-interactive")?(b=l(h.opacity,c.opacity),a.fill=K(a.fill).setOpacity(b).get(),a.cursor="pointer"):-1!==q.indexOf("highcharts-internal-node")?a.fill="none":b&&(a.fill=K(a.fill).brighten(h.brightness).get());return a},drawPoints:function(){var a=this,b=x(a.points,function(b){return b.node.visible});r(b,function(b){var c="level-group-"+b.node.levelDynamic;a[c]||(a[c]=a.chart.renderer.g(c).attr({zIndex:1e3-b.node.levelDynamic}).add(a.group));b.group=a[c]});y.column.prototype.drawPoints.call(this);a.options.allowDrillToNode&&r(b,function(b){b.graphic&&(b.drillId=a.options.interactByLeaf?a.drillToByLeaf(b):a.drillToByGroup(b))})},onClickDrillToNode:function(a){var b=(a=a.point)&&a.drillId;F(b)&&(a.setState(""),this.drillToNode(b))},drillToByGroup:function(a){var b=!1;1!==a.node.level-this.nodeMap[this.rootNode].level||a.node.isLeaf||(b=a.id);return b},drillToByLeaf:function(a){var b=!1;if(a.node.parent!==this.rootNode&&a.node.isLeaf)for(a=a.node;!b;)a=this.nodeMap[a.parent],a.parent===this.rootNode&&(b=a.id);return b},drillUp:function(){var a=this.nodeMap[this.rootNode];a&&F(a.parent)&&this.drillToNode(a.parent)},drillToNode:function(a,b){var c=this.nodeMap[a];this.idPreviousRoot=this.rootNode;this.rootNode=a;""===a?this.drillUpButton=this.drillUpButton.destroy():this.showDrillUpButton(c&&c.name||a);this.isDirty=!0;l(b,!0)&&this.chart.redraw()},showDrillUpButton:function(a){var b=this;a=a||"< Back";var c=b.options.drillUpButton,p,h;c.text&&(a=c.text);this.drillUpButton?(this.drillUpButton.placed=!1,this.drillUpButton.attr({text:a}).align()):(h=(p=c.theme)&&p.states,this.drillUpButton=this.chart.renderer.button(a,null,null,function(){b.drillUp()},p,h&&h.hover,h&&h.select).addClass("highcharts-drillup-button").attr({align:c.position.align,zIndex:7}).add().align(c.position,!1,c.relativeTo||"plotBox"))},buildKDTree:E,drawLegendSymbol:c.LegendSymbolMixin.drawRectangle,getExtremes:function(){H.prototype.getExtremes.call(this,this.colorValueData);this.valueMin=this.dataMin;this.valueMax=this.dataMax;H.prototype.getExtremes.call(this)},getExtremesFromAll:!0,bindAxes:function(){var a={endOnTick:!1,gridLineWidth:0,lineWidth:0,min:0,dataMin:0,minPadding:0,max:100,dataMax:100,maxPadding:0,startOnTick:!1,title:null,tickPositions:[]};H.prototype.bindAxes.call(this);c.extend(this.yAxis.options,a);c.extend(this.xAxis.options,a)},utils:{recursive:A,reduce:L}},{getClassName:function(){var a=c.Point.prototype.getClassName.call(this),b=this.series,d=b.options;this.node.level<=b.nodeMap[b.rootNode].level?a+=" highcharts-above-level":this.node.isLeaf||l(d.interactByLeaf,!d.allowDrillToNode)?this.node.isLeaf||(a+=" highcharts-internal-node"):a+=" highcharts-internal-node-interactive";return a},isValid:function(){return this.id||G(this.value)},setState:function(a){c.Point.prototype.setState.call(this,a);this.graphic&&this.graphic.attr({zIndex:"hover"===a?1:0})},setVisible:y.pie.prototype.pointClass.prototype.setVisible})})(F,M);(function(c,t,f){var y=c.CenteredSeriesMixin,e=c.Series,w=c.each,F=c.extend,E=y.getCenter,r=f.getColor,z=f.getLevelOptions,v=y.getStartAndEndRadians,x=c.grep,m=c.inArray,G=c.isNumber,I=c.isObject,M=c.isString,l=c.keys,H=c.merge,C=180/Math.PI,y=c.seriesType,K=f.setTreeValues,O=c.reduce,L=f.updateRootId,A=function(b,a){var c=[];if(G(b)&&G(a)&&b<=a)for(;b<=a;b++)c.push(b);return c},N=function(b,a){var c;a=I(a)?a:{};var d=0,q,g,k,e;I(b)&&(c=H({},b),b=G(a.from)?a.from:0,e=G(a.to)?a.to:0,g=A(b,e),b=x(l(c),function(b){return-1===m(+b,g)}),q=k=G(a.diffRadius)?a.diffRadius:0,w(g,function(b){b=c[b];var a=b.levelSize.unit,g=b.levelSize.value;"weight"===a?d+=g:"percentage"===a?(b.levelSize={unit:"pixels",value:g/100*q},k-=b.levelSize.value):"pixels"===a&&(k-=g)}),w(g,function(b){var a=c[b];"weight"===a.levelSize.unit&&(a=a.levelSize.value,c[b].levelSize={unit:"pixels",value:a/d*k})}),w(b,function(b){c[b].levelSize={value:0,unit:"pixels"}}));return c},a=function(b,a){var c=a.mapIdToNode[b.parent],d=a.series,q=d.chart,g=d.points[b.i],c=r(b,{colors:q&&q.options&&q.options.colors,colorIndex:d.colorIndex,index:a.index,mapOptionsToLevel:a.mapOptionsToLevel,parentColor:c&&c.color,parentColorIndex:c&&c.colorIndex,series:a.series,siblings:a.siblings});b.color=c.color;b.colorIndex=c.colorIndex;g&&(g.color=b.color,g.colorIndex=b.colorIndex,b.sliced=b.id!==a.idRoot?g.sliced:!1);return b};y("sunburst","treemap",{center:["50%","50%"],colorByPoint:!1,dataLabels:{allowOverlap:!0,defer:!0,style:{textOverflow:"ellipsis"},rotationMode:"auto"},rootId:void 0,levelIsConstant:!0,levelSize:{value:1,unit:"weight"},slicedOffset:10},{drawDataLabels:c.noop,drawPoints:function(){var b=this,a=b.mapOptionsToLevel,c=b.shapeRoot,h=b.group,q=b.hasRendered,g=b.rootNode,k=b.idPreviousRoot,l=b.nodeMap,n=l[k],r=n&&n.shapeArgs,n=b.points,m=b.startAndEndRadians,f=b.chart,f=f&&f.options&&f.options.chart||{},v="boolean"===typeof f.animation?f.animation:!0,t=b.center[3]/2,y=b.chart.renderer,z,x=!1,E=!1;if(f=!!(v&&q&&g!==k&&b.dataLabelsGroup))b.dataLabelsGroup.attr({opacity:0}),z=function(){x=!0;b.dataLabelsGroup&&b.dataLabelsGroup.animate({opacity:1,visibility:"visible"})};w(n,function(d){var p,f,n=d.node,e=a[n.level];p=d.shapeExisting||{};var u=n.shapeArgs||{},B,w=!(!n.visible||!n.shapeArgs);if(q&&v){var x={};f={end:u.end,start:u.start,innerR:u.innerR,r:u.r,x:u.x,y:u.y};w?!d.graphic&&r&&(x=g===d.id?{start:m.start,end:m.end}:r.end<=u.start?{start:m.end,end:m.end}:{start:m.start,end:m.start},x.innerR=x.r=t):d.graphic&&(k===d.id?f={innerR:t,r:t}:c&&(f=c.end<=p.start?{innerR:t,r:t,start:m.end,end:m.end}:{innerR:t,r:t,start:m.start,end:m.start}));p=x}else f=u,p={};var x=[u.plotX,u.plotY],D;d.node.isLeaf||(g===d.id?(D=l[g],D=D.parent):D=d.id);F(d,{shapeExisting:u,tooltipPos:x,drillId:D,name:""+(d.name||d.id||d.index),plotX:u.plotX,plotY:u.plotY,value:n.val,isNull:!w});D=d.options;n=I(u)?u:{};D=I(D)?D.dataLabels:{};var e=I(e)?e.dataLabels:{},e=H({style:{}},e,D),A;D=e.rotationMode;G(e.rotation)||("auto"===D&&(1>d.innerArcLength&&d.outerArcLength>n.radius?A=0:D=1<d.innerArcLength&&d.outerArcLength>1.5*n.radius?"parallel":"perpendicular"),"auto"!==D&&(A=n.end-(n.end-n.start)/2),e.style.width="parallel"===D?Math.min(2.5*n.radius,(d.outerArcLength+d.innerArcLength)/2):n.radius,"perpendicular"===D&&d.series.chart.renderer.fontMetrics(e.style.fontSize).h>d.outerArcLength&&(e.style.width=1),e.style.width=Math.max(e.style.width-2*(e.padding||0),1),A=A*C%180,"parallel"===D&&(A-=90),90<A?A-=180:-90>A&&(A+=180),e.rotation=A);0===e.rotation&&(e.rotation=.001);d.dlOptions=e;!E&&w&&(E=!0,B=z);d.draw({animate:f,attr:F(p,b.pointAttribs&&b.pointAttribs(d,d.selected&&"select")),onComplete:B,group:h,renderer:y,shapeType:"arc",shapeArgs:u})});f&&E?(b.hasRendered=!1,b.options.dataLabels.defer=!0,e.prototype.drawDataLabels.call(b),b.hasRendered=!0,x&&z()):e.prototype.drawDataLabels.call(b)},pointAttribs:c.seriesTypes.column.prototype.pointAttribs,layoutAlgorithm:function(b,a,c){var d=b.start,e=b.end-d,g=b.val,k=b.x,p=b.y,n=c&&I(c.levelSize)&&G(c.levelSize.value)?c.levelSize.value:0,l=b.r,f=l+n,m=c&&G(c.slicedOffset)?c.slicedOffset:0;return O(a||[],function(a,b){var c=1/g*b.val*e,h=d+c/2,q=k+Math.cos(h)*m,h=p+Math.sin(h)*m;b={x:b.sliced?q:k,y:b.sliced?h:p,innerR:l,r:f,radius:n,start:d,end:d+c};a.push(b);d=b.end;return a},[])},setShapeArgs:function(b,a,c){var d=[],e=c[b.level+1];b=x(b.children,function(b){return b.visible});d=this.layoutAlgorithm(a,b,e);w(b,function(b,a){a=d[a];var e=a.start+(a.end-a.start)/2,h=a.innerR+(a.r-a.innerR)/2,g=a.end-a.start,h=0===a.innerR&&6.28<g?{x:a.x,y:a.y}:{x:a.x+Math.cos(e)*h,y:a.y+Math.sin(e)*h},k=b.val?b.childrenTotal>b.val?b.childrenTotal:b.val:b.childrenTotal;this.points[b.i]&&(this.points[b.i].innerArcLength=g*a.innerR,this.points[b.i].outerArcLength=g*a.r);b.shapeArgs=H(a,{plotX:h.x,plotY:h.y+4*Math.abs(Math.cos(e))});b.values=H(a,{val:k});b.children.length&&this.setShapeArgs(b,b.values,c)},this)},translate:function(){var b=this.options,c=this.center=E.call(this),l=this.startAndEndRadians=v(b.startAngle,b.endAngle),h=c[3]/2,m=c[2]/2-h,g=L(this),k=this.nodeMap,f,n=k&&k[g],r,t;this.shapeRoot=n&&n.shapeArgs;e.prototype.translate.call(this);t=this.tree=this.getTree();k=this.nodeMap;n=k[g];f=M(n.parent)?n.parent:"";r=k[f];f=z({from:0<n.level?n.level:1,levels:this.options.levels,to:t.height,defaults:{colorByPoint:b.colorByPoint,dataLabels:b.dataLabels,levelIsConstant:b.levelIsConstant,levelSize:b.levelSize,slicedOffset:b.slicedOffset}});f=N(f,{diffRadius:m,from:0<n.level?n.level:1,to:t.height});K(t,{before:a,idRoot:g,levelIsConstant:b.levelIsConstant,mapOptionsToLevel:f,mapIdToNode:k,points:this.points,series:this});b=k[""].shapeArgs={end:l.end,r:h,start:l.start,val:n.val,x:c[0],y:c[1]};this.setShapeArgs(r,b,f);this.mapOptionsToLevel=f},animate:function(a){var b=this.chart,c=[b.plotWidth/2,b.plotHeight/2],e=b.plotLeft,f=b.plotTop,b=this.group;a?(a={translateX:c[0]+e,translateY:c[1]+f,scaleX:.001,scaleY:.001,rotation:10,opacity:.01},b.attr(a)):(a={translateX:e,translateY:f,scaleX:1,scaleY:1,rotation:0,opacity:1},b.animate(a,this.options.animation),this.animate=null)},utils:{calculateLevelSizes:N,range:A}},{draw:t,shouldDraw:function(){return!this.isNull}})})(F,P,M)})},"./node_modules/jquery/dist/jquery.js":function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;(function(global,factory){"use strict";if(typeof module==="object"&&typeof module.exports==="object"){module.exports=global.document?factory(global,true):function(w){if(!w.document){throw new Error("jQuery requires a window with a document")}return factory(w)}}else{factory(global)}})(typeof window!=="undefined"?window:this,function(window,noGlobal){"use strict";var arr=[];var document=window.document;var getProto=Object.getPrototypeOf;var slice=arr.slice;var concat=arr.concat;var push=arr.push;var indexOf=arr.indexOf;var class2type={};var toString=class2type.toString;var hasOwn=class2type.hasOwnProperty;var fnToString=hasOwn.toString;var ObjectFunctionString=fnToString.call(Object);var support={};var isFunction=function isFunction(obj){return typeof obj==="function"&&typeof obj.nodeType!=="number"};var isWindow=function isWindow(obj){return obj!=null&&obj===obj.window};var preservedScriptAttributes={type:true,src:true,noModule:true};function DOMEval(code,doc,node){doc=doc||document;var i,script=doc.createElement("script");script.text=code;if(node){for(i in preservedScriptAttributes){if(node[i]){script[i]=node[i]}}}doc.head.appendChild(script).parentNode.removeChild(script)}function toType(obj){if(obj==null){return obj+""}return typeof obj==="object"||typeof obj==="function"?class2type[toString.call(obj)]||"object":typeof obj}var version="3.3.1",jQuery=function(selector,context){return new jQuery.fn.init(selector,context)},rtrim=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;jQuery.fn=jQuery.prototype={jquery:version,constructor:jQuery,length:0,toArray:function(){return slice.call(this)},get:function(num){if(num==null){return slice.call(this)}return num<0?this[num+this.length]:this[num]},pushStack:function(elems){var ret=jQuery.merge(this.constructor(),elems);ret.prevObject=this;return ret},each:function(callback){return jQuery.each(this,callback)},map:function(callback){return this.pushStack(jQuery.map(this,function(elem,i){return callback.call(elem,i,elem)}))},slice:function(){return this.pushStack(slice.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(i){var len=this.length,j=+i+(i<0?len:0);return this.pushStack(j>=0&&j<len?[this[j]]:[])},end:function(){return this.prevObject||this.constructor()},push:push,sort:arr.sort,splice:arr.splice};jQuery.extend=jQuery.fn.extend=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=false;if(typeof target==="boolean"){deep=target;target=arguments[i]||{};i++}if(typeof target!=="object"&&!isFunction(target)){target={}}if(i===length){target=this;i--}for(;i<length;i++){if((options=arguments[i])!=null){for(name in options){src=target[name];copy=options[name];if(target===copy){continue}if(deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=Array.isArray(copy)))){if(copyIsArray){copyIsArray=false;clone=src&&Array.isArray(src)?src:[]}else{clone=src&&jQuery.isPlainObject(src)?src:{}}target[name]=jQuery.extend(deep,clone,copy)}else if(copy!==undefined){target[name]=copy}}}}return target};jQuery.extend({expando:"jQuery"+(version+Math.random()).replace(/\D/g,""),isReady:true,error:function(msg){throw new Error(msg)},noop:function(){},isPlainObject:function(obj){var proto,Ctor;if(!obj||toString.call(obj)!=="[object Object]"){return false}proto=getProto(obj);if(!proto){return true}Ctor=hasOwn.call(proto,"constructor")&&proto.constructor;return typeof Ctor==="function"&&fnToString.call(Ctor)===ObjectFunctionString},isEmptyObject:function(obj){var name;for(name in obj){return false}return true},globalEval:function(code){DOMEval(code)},each:function(obj,callback){var length,i=0;if(isArrayLike(obj)){length=obj.length;for(;i<length;i++){if(callback.call(obj[i],i,obj[i])===false){break}}}else{for(i in obj){if(callback.call(obj[i],i,obj[i])===false){break}}}return obj},trim:function(text){return text==null?"":(text+"").replace(rtrim,"")},makeArray:function(arr,results){var ret=results||[];if(arr!=null){if(isArrayLike(Object(arr))){jQuery.merge(ret,typeof arr==="string"?[arr]:arr)}else{push.call(ret,arr)}}return ret},inArray:function(elem,arr,i){return arr==null?-1:indexOf.call(arr,elem,i)},merge:function(first,second){var len=+second.length,j=0,i=first.length;for(;j<len;j++){first[i++]=second[j]}first.length=i;return first},grep:function(elems,callback,invert){var callbackInverse,matches=[],i=0,length=elems.length,callbackExpect=!invert;for(;i<length;i++){callbackInverse=!callback(elems[i],i);if(callbackInverse!==callbackExpect){matches.push(elems[i])}}return matches},map:function(elems,callback,arg){var length,value,i=0,ret=[];if(isArrayLike(elems)){length=elems.length;for(;i<length;i++){value=callback(elems[i],i,arg);if(value!=null){ret.push(value)}}}else{for(i in elems){value=callback(elems[i],i,arg);if(value!=null){ret.push(value)}}}return concat.apply([],ret)},guid:1,support:support});if(typeof Symbol==="function"){jQuery.fn[Symbol.iterator]=arr[Symbol.iterator]}jQuery.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(i,name){class2type["[object "+name+"]"]=name.toLowerCase()});function isArrayLike(obj){var length=!!obj&&"length"in obj&&obj.length,type=toType(obj);if(isFunction(obj)||isWindow(obj)){return false}return type==="array"||length===0||typeof length==="number"&&length>0&&length-1 in obj}var Sizzle=function(window){var i,support,Expr,getText,isXML,tokenize,compile,select,outermostContext,sortInput,hasDuplicate,setDocument,document,docElem,documentIsHTML,rbuggyQSA,rbuggyMatches,matches,contains,expando="sizzle"+1*new Date,preferredDoc=window.document,dirruns=0,done=0,classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),sortOrder=function(a,b){if(a===b){hasDuplicate=true}return 0},hasOwn={}.hasOwnProperty,arr=[],pop=arr.pop,push_native=arr.push,push=arr.push,slice=arr.slice,indexOf=function(list,elem){var i=0,len=list.length;for(;i<len;i++){if(list[i]===elem){return i}}return-1},booleans="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",whitespace="[\\x20\\t\\r\\n\\f]",identifier="(?:\\\\.|[\\w-]|[^\0-\\xa0])+",attributes="\\["+whitespace+"*("+identifier+")(?:"+whitespace+"*([*^$|!~]?=)"+whitespace+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+identifier+"))|)"+whitespace+"*\\]",pseudos=":("+identifier+")(?:\\(("+"('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|"+"((?:\\\\.|[^\\\\()[\\]]|"+attributes+")*)|"+".*"+")\\)|)",rwhitespace=new RegExp(whitespace+"+","g"),rtrim=new RegExp("^"+whitespace+"+|((?:^|[^\\\\])(?:\\\\.)*)"+whitespace+"+$","g"),rcomma=new RegExp("^"+whitespace+"*,"+whitespace+"*"),rcombinators=new RegExp("^"+whitespace+"*([>+~]|"+whitespace+")"+whitespace+"*"),rattributeQuotes=new RegExp("="+whitespace+"*([^\\]'\"]*?)"+whitespace+"*\\]","g"),rpseudo=new RegExp(pseudos),ridentifier=new RegExp("^"+identifier+"$"),matchExpr={ID:new RegExp("^#("+identifier+")"),CLASS:new RegExp("^\\.("+identifier+")"),TAG:new RegExp("^("+identifier+"|[*])"),ATTR:new RegExp("^"+attributes),PSEUDO:new RegExp("^"+pseudos),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+whitespace+"*(even|odd|(([+-]|)(\\d*)n|)"+whitespace+"*(?:([+-]|)"+whitespace+"*(\\d+)|))"+whitespace+"*\\)|)","i"),bool:new RegExp("^(?:"+booleans+")$","i"),needsContext:new RegExp("^"+whitespace+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+whitespace+"*((?:-\\d)?\\d*)"+whitespace+"*\\)|)(?=[^-]|$)","i")},rinputs=/^(?:input|select|textarea|button)$/i,rheader=/^h\d$/i,rnative=/^[^{]+\{\s*\[native \w/,rquickExpr=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,rsibling=/[+~]/,runescape=new RegExp("\\\\([\\da-f]{1,6}"+whitespace+"?|("+whitespace+")|.)","ig"),funescape=function(_,escaped,escapedWhitespace){var high="0x"+escaped-65536;return high!==high||escapedWhitespace?escaped:high<0?String.fromCharCode(high+65536):String.fromCharCode(high>>10|55296,high&1023|56320)},rcssescape=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,fcssescape=function(ch,asCodePoint){if(asCodePoint){if(ch==="\0"){return""}return ch.slice(0,-1)+"\\"+ch.charCodeAt(ch.length-1).toString(16)+" "}return"\\"+ch},unloadHandler=function(){setDocument()},disabledAncestor=addCombinator(function(elem){return elem.disabled===true&&("form"in elem||"label"in elem)},{dir:"parentNode",next:"legend"});try{push.apply(arr=slice.call(preferredDoc.childNodes),preferredDoc.childNodes);arr[preferredDoc.childNodes.length].nodeType}catch(e){push={apply:arr.length?function(target,els){push_native.apply(target,slice.call(els))}:function(target,els){var j=target.length,i=0;while(target[j++]=els[i++]){}target.length=j-1}}}function Sizzle(selector,context,results,seed){var m,i,elem,nid,match,groups,newSelector,newContext=context&&context.ownerDocument,nodeType=context?context.nodeType:9;results=results||[];if(typeof selector!=="string"||!selector||nodeType!==1&&nodeType!==9&&nodeType!==11){return results}if(!seed){if((context?context.ownerDocument||context:preferredDoc)!==document){setDocument(context)}context=context||document;if(documentIsHTML){if(nodeType!==11&&(match=rquickExpr.exec(selector))){if(m=match[1]){if(nodeType===9){if(elem=context.getElementById(m)){if(elem.id===m){results.push(elem);return results}}else{return results}}else{if(newContext&&(elem=newContext.getElementById(m))&&contains(context,elem)&&elem.id===m){results.push(elem);return results}}}else if(match[2]){push.apply(results,context.getElementsByTagName(selector));return results}else if((m=match[3])&&support.getElementsByClassName&&context.getElementsByClassName){push.apply(results,context.getElementsByClassName(m));return results}}if(support.qsa&&!compilerCache[selector+" "]&&(!rbuggyQSA||!rbuggyQSA.test(selector))){if(nodeType!==1){newContext=context;newSelector=selector}else if(context.nodeName.toLowerCase()!=="object"){if(nid=context.getAttribute("id")){nid=nid.replace(rcssescape,fcssescape)}else{context.setAttribute("id",nid=expando)}groups=tokenize(selector);i=groups.length;while(i--){groups[i]="#"+nid+" "+toSelector(groups[i])}newSelector=groups.join(",");newContext=rsibling.test(selector)&&testContext(context.parentNode)||context}if(newSelector){try{push.apply(results,newContext.querySelectorAll(newSelector));return results}catch(qsaError){}finally{if(nid===expando){context.removeAttribute("id")}}}}}}return select(selector.replace(rtrim,"$1"),context,results,seed)}function createCache(){var keys=[];function cache(key,value){if(keys.push(key+" ")>Expr.cacheLength){delete cache[keys.shift()]}return cache[key+" "]=value}return cache}function markFunction(fn){fn[expando]=true;return fn}function assert(fn){var el=document.createElement("fieldset");try{return!!fn(el)}catch(e){return false}finally{if(el.parentNode){el.parentNode.removeChild(el)}el=null}}function addHandle(attrs,handler){var arr=attrs.split("|"),i=arr.length;while(i--){Expr.attrHandle[arr[i]]=handler}}function siblingCheck(a,b){var cur=b&&a,diff=cur&&a.nodeType===1&&b.nodeType===1&&a.sourceIndex-b.sourceIndex;if(diff){return diff}if(cur){while(cur=cur.nextSibling){if(cur===b){return-1}}}return a?1:-1}function createInputPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type===type}}function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return(name==="input"||name==="button")&&elem.type===type}}function createDisabledPseudo(disabled){return function(elem){if("form"in elem){if(elem.parentNode&&elem.disabled===false){if("label"in elem){if("label"in elem.parentNode){return elem.parentNode.disabled===disabled}else{return elem.disabled===disabled}}return elem.isDisabled===disabled||elem.isDisabled!==!disabled&&disabledAncestor(elem)===disabled}return elem.disabled===disabled}else if("label"in elem){return elem.disabled===disabled}return false}}function createPositionalPseudo(fn){return markFunction(function(argument){argument=+argument;return markFunction(function(seed,matches){var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;while(i--){if(seed[j=matchIndexes[i]]){seed[j]=!(matches[j]=seed[j])}}})})}function testContext(context){return context&&typeof context.getElementsByTagName!=="undefined"&&context}support=Sizzle.support={};isXML=Sizzle.isXML=function(elem){var documentElement=elem&&(elem.ownerDocument||elem).documentElement;return documentElement?documentElement.nodeName!=="HTML":false};setDocument=Sizzle.setDocument=function(node){var hasCompare,subWindow,doc=node?node.ownerDocument||node:preferredDoc;if(doc===document||doc.nodeType!==9||!doc.documentElement){return document}document=doc;docElem=document.documentElement;documentIsHTML=!isXML(document);if(preferredDoc!==document&&(subWindow=document.defaultView)&&subWindow.top!==subWindow){if(subWindow.addEventListener){subWindow.addEventListener("unload",unloadHandler,false)}else if(subWindow.attachEvent){subWindow.attachEvent("onunload",unloadHandler)}}support.attributes=assert(function(el){el.className="i";return!el.getAttribute("className")});support.getElementsByTagName=assert(function(el){el.appendChild(document.createComment(""));return!el.getElementsByTagName("*").length});support.getElementsByClassName=rnative.test(document.getElementsByClassName);support.getById=assert(function(el){docElem.appendChild(el).id=expando;return!document.getElementsByName||!document.getElementsByName(expando).length});if(support.getById){Expr.filter["ID"]=function(id){var attrId=id.replace(runescape,funescape);return function(elem){return elem.getAttribute("id")===attrId}};Expr.find["ID"]=function(id,context){if(typeof context.getElementById!=="undefined"&&documentIsHTML){var elem=context.getElementById(id);return elem?[elem]:[]}}}else{Expr.filter["ID"]=function(id){var attrId=id.replace(runescape,funescape);return function(elem){var node=typeof elem.getAttributeNode!=="undefined"&&elem.getAttributeNode("id");return node&&node.value===attrId}};Expr.find["ID"]=function(id,context){if(typeof context.getElementById!=="undefined"&&documentIsHTML){var node,i,elems,elem=context.getElementById(id);if(elem){node=elem.getAttributeNode("id");if(node&&node.value===id){return[elem]}elems=context.getElementsByName(id);i=0;while(elem=elems[i++]){node=elem.getAttributeNode("id");if(node&&node.value===id){return[elem]}}}return[]}}}Expr.find["TAG"]=support.getElementsByTagName?function(tag,context){if(typeof context.getElementsByTagName!=="undefined"){return context.getElementsByTagName(tag)}else if(support.qsa){return context.querySelectorAll(tag)}}:function(tag,context){var elem,tmp=[],i=0,results=context.getElementsByTagName(tag);if(tag==="*"){while(elem=results[i++]){if(elem.nodeType===1){tmp.push(elem)}}return tmp}return results};Expr.find["CLASS"]=support.getElementsByClassName&&function(className,context){if(typeof context.getElementsByClassName!=="undefined"&&documentIsHTML){return context.getElementsByClassName(className)}};rbuggyMatches=[];rbuggyQSA=[];if(support.qsa=rnative.test(document.querySelectorAll)){assert(function(el){docElem.appendChild(el).innerHTML="<a id='"+expando+"'></a>"+"<select id='"+expando+"-\r\\' msallowcapture=''>"+"<option selected=''></option></select>";if(el.querySelectorAll("[msallowcapture^='']").length){rbuggyQSA.push("[*^$]="+whitespace+"*(?:''|\"\")")}if(!el.querySelectorAll("[selected]").length){rbuggyQSA.push("\\["+whitespace+"*(?:value|"+booleans+")")}if(!el.querySelectorAll("[id~="+expando+"-]").length){rbuggyQSA.push("~=")}if(!el.querySelectorAll(":checked").length){rbuggyQSA.push(":checked")}if(!el.querySelectorAll("a#"+expando+"+*").length){rbuggyQSA.push(".#.+[+~]")}});assert(function(el){el.innerHTML="<a href='' disabled='disabled'></a>"+"<select disabled='disabled'><option/></select>";var input=document.createElement("input");input.setAttribute("type","hidden");el.appendChild(input).setAttribute("name","D");if(el.querySelectorAll("[name=d]").length){rbuggyQSA.push("name"+whitespace+"*[*^$|!~]?=")}if(el.querySelectorAll(":enabled").length!==2){rbuggyQSA.push(":enabled",":disabled")}docElem.appendChild(el).disabled=true;if(el.querySelectorAll(":disabled").length!==2){rbuggyQSA.push(":enabled",":disabled")}el.querySelectorAll("*,:x");rbuggyQSA.push(",.*:")})}if(support.matchesSelector=rnative.test(matches=docElem.matches||docElem.webkitMatchesSelector||docElem.mozMatchesSelector||docElem.oMatchesSelector||docElem.msMatchesSelector)){assert(function(el){support.disconnectedMatch=matches.call(el,"*");matches.call(el,"[s!='']:x");rbuggyMatches.push("!=",pseudos)})}rbuggyQSA=rbuggyQSA.length&&new RegExp(rbuggyQSA.join("|"));rbuggyMatches=rbuggyMatches.length&&new RegExp(rbuggyMatches.join("|"));hasCompare=rnative.test(docElem.compareDocumentPosition);contains=hasCompare||rnative.test(docElem.contains)?function(a,b){var adown=a.nodeType===9?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!!(bup&&bup.nodeType===1&&(adown.contains?adown.contains(bup):a.compareDocumentPosition&&a.compareDocumentPosition(bup)&16))}:function(a,b){if(b){while(b=b.parentNode){if(b===a){return true}}}return false};sortOrder=hasCompare?function(a,b){if(a===b){hasDuplicate=true;return 0}var compare=!a.compareDocumentPosition-!b.compareDocumentPosition;if(compare){return compare}compare=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1;if(compare&1||!support.sortDetached&&b.compareDocumentPosition(a)===compare){if(a===document||a.ownerDocument===preferredDoc&&contains(preferredDoc,a)){return-1}if(b===document||b.ownerDocument===preferredDoc&&contains(preferredDoc,b)){return 1}return sortInput?indexOf(sortInput,a)-indexOf(sortInput,b):0}return compare&4?-1:1}:function(a,b){if(a===b){hasDuplicate=true;return 0}var cur,i=0,aup=a.parentNode,bup=b.parentNode,ap=[a],bp=[b];if(!aup||!bup){return a===document?-1:b===document?1:aup?-1:bup?1:sortInput?indexOf(sortInput,a)-indexOf(sortInput,b):0}else if(aup===bup){return siblingCheck(a,b)}cur=a;while(cur=cur.parentNode){ap.unshift(cur)}cur=b;while(cur=cur.parentNode){bp.unshift(cur)}while(ap[i]===bp[i]){i++}return i?siblingCheck(ap[i],bp[i]):ap[i]===preferredDoc?-1:bp[i]===preferredDoc?1:0};return document};Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements)};Sizzle.matchesSelector=function(elem,expr){if((elem.ownerDocument||elem)!==document){setDocument(elem)}expr=expr.replace(rattributeQuotes,"='$1']");if(support.matchesSelector&&documentIsHTML&&!compilerCache[expr+" "]&&(!rbuggyMatches||!rbuggyMatches.test(expr))&&(!rbuggyQSA||!rbuggyQSA.test(expr))){try{var ret=matches.call(elem,expr);if(ret||support.disconnectedMatch||elem.document&&elem.document.nodeType!==11){return ret}}catch(e){}}return Sizzle(expr,document,null,[elem]).length>0};Sizzle.contains=function(context,elem){if((context.ownerDocument||context)!==document){setDocument(context)}return contains(context,elem)};Sizzle.attr=function(elem,name){if((elem.ownerDocument||elem)!==document){setDocument(elem)}var fn=Expr.attrHandle[name.toLowerCase()],val=fn&&hasOwn.call(Expr.attrHandle,name.toLowerCase())?fn(elem,name,!documentIsHTML):undefined;return val!==undefined?val:support.attributes||!documentIsHTML?elem.getAttribute(name):(val=elem.getAttributeNode(name))&&val.specified?val.value:null};Sizzle.escape=function(sel){return(sel+"").replace(rcssescape,fcssescape)};Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg)};Sizzle.uniqueSort=function(results){var elem,duplicates=[],j=0,i=0;hasDuplicate=!support.detectDuplicates;sortInput=!support.sortStable&&results.slice(0);results.sort(sortOrder);if(hasDuplicate){while(elem=results[i++]){if(elem===results[i]){j=duplicates.push(i)}}while(j--){results.splice(duplicates[j],1)}}sortInput=null;return results};getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(!nodeType){while(node=elem[i++]){ret+=getText(node)}}else if(nodeType===1||nodeType===9||nodeType===11){if(typeof elem.textContent==="string"){return elem.textContent}else{for(elem=elem.firstChild;elem;elem=elem.nextSibling){ret+=getText(elem)}}}else if(nodeType===3||nodeType===4){return elem.nodeValue}return ret};Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:true}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:true},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(match){match[1]=match[1].replace(runescape,funescape);match[3]=(match[3]||match[4]||match[5]||"").replace(runescape,funescape);if(match[2]==="~="){match[3]=" "+match[3]+" "}return match.slice(0,4)},CHILD:function(match){match[1]=match[1].toLowerCase();if(match[1].slice(0,3)==="nth"){if(!match[3]){Sizzle.error(match[0])}match[4]=+(match[4]?match[5]+(match[6]||1):2*(match[3]==="even"||match[3]==="odd"));match[5]=+(match[7]+match[8]||match[3]==="odd")}else if(match[3]){Sizzle.error(match[0])}return match},PSEUDO:function(match){var excess,unquoted=!match[6]&&match[2];if(matchExpr["CHILD"].test(match[0])){return null}if(match[3]){match[2]=match[4]||match[5]||""}else if(unquoted&&rpseudo.test(unquoted)&&(excess=tokenize(unquoted,true))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)){match[0]=match[0].slice(0,excess);match[2]=unquoted.slice(0,excess)}return match.slice(0,3)}},filter:{TAG:function(nodeNameSelector){var nodeName=nodeNameSelector.replace(runescape,funescape).toLowerCase();return nodeNameSelector==="*"?function(){return true}:function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName}},CLASS:function(className){var pattern=classCache[className+" "];return pattern||(pattern=new RegExp("(^|"+whitespace+")"+className+"("+whitespace+"|$)"))&&classCache(className,function(elem){return pattern.test(typeof elem.className==="string"&&elem.className||typeof elem.getAttribute!=="undefined"&&elem.getAttribute("class")||"")})},ATTR:function(name,operator,check){return function(elem){var result=Sizzle.attr(elem,name);if(result==null){return operator==="!="}if(!operator){return true}result+="";return operator==="="?result===check:operator==="!="?result!==check:operator==="^="?check&&result.indexOf(check)===0:operator==="*="?check&&result.indexOf(check)>-1:operator==="$="?check&&result.slice(-check.length)===check:operator==="~="?(" "+result.replace(rwhitespace," ")+" ").indexOf(check)>-1:operator==="|="?result===check||result.slice(0,check.length+1)===check+"-":false}},CHILD:function(type,what,argument,first,last){var simple=type.slice(0,3)!=="nth",forward=type.slice(-4)!=="last",ofType=what==="of-type";return first===1&&last===0?function(elem){return!!elem.parentNode}:function(elem,context,xml){var cache,uniqueCache,outerCache,node,nodeIndex,start,dir=simple!==forward?"nextSibling":"previousSibling",parent=elem.parentNode,name=ofType&&elem.nodeName.toLowerCase(),useCache=!xml&&!ofType,diff=false;if(parent){if(simple){while(dir){node=elem;while(node=node[dir]){if(ofType?node.nodeName.toLowerCase()===name:node.nodeType===1){return false}}start=dir=type==="only"&&!start&&"nextSibling"}return true}start=[forward?parent.firstChild:parent.lastChild];if(forward&&useCache){node=parent;outerCache=node[expando]||(node[expando]={});uniqueCache=outerCache[node.uniqueID]||(outerCache[node.uniqueID]={});cache=uniqueCache[type]||[];nodeIndex=cache[0]===dirruns&&cache[1];diff=nodeIndex&&cache[2];node=nodeIndex&&parent.childNodes[nodeIndex];while(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop()){if(node.nodeType===1&&++diff&&node===elem){uniqueCache[type]=[dirruns,nodeIndex,diff];break}}}else{if(useCache){node=elem;outerCache=node[expando]||(node[expando]={});uniqueCache=outerCache[node.uniqueID]||(outerCache[node.uniqueID]={});cache=uniqueCache[type]||[];nodeIndex=cache[0]===dirruns&&cache[1];diff=nodeIndex}if(diff===false){while(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop()){if((ofType?node.nodeName.toLowerCase()===name:node.nodeType===1)&&++diff){if(useCache){outerCache=node[expando]||(node[expando]={});uniqueCache=outerCache[node.uniqueID]||(outerCache[node.uniqueID]={});uniqueCache[type]=[dirruns,diff]}if(node===elem){break}}}}}diff-=last;return diff===first||diff%first===0&&diff/first>=0}}},PSEUDO:function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);if(fn[expando]){return fn(argument)}if(fn.length>1){args=[pseudo,pseudo,"",argument];return Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction(function(seed,matches){var idx,matched=fn(seed,argument),i=matched.length;while(i--){idx=indexOf(seed,matched[i]);seed[idx]=!(matches[idx]=matched[i])}}):function(elem){return fn(elem,0,args)}}return fn}},pseudos:{not:markFunction(function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));return matcher[expando]?markFunction(function(seed,matches,context,xml){var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;while(i--){if(elem=unmatched[i]){seed[i]=!(matches[i]=elem)}}}):function(elem,context,xml){input[0]=elem;matcher(input,null,xml,results);input[0]=null;return!results.pop()}}),has:markFunction(function(selector){return function(elem){return Sizzle(selector,elem).length>0}}),contains:markFunction(function(text){text=text.replace(runescape,funescape);return function(elem){return(elem.textContent||elem.innerText||getText(elem)).indexOf(text)>-1}}),lang:markFunction(function(lang){if(!ridentifier.test(lang||"")){Sizzle.error("unsupported lang: "+lang)}lang=lang.replace(runescape,funescape).toLowerCase();return function(elem){var elemLang;do{if(elemLang=documentIsHTML?elem.lang:elem.getAttribute("xml:lang")||elem.getAttribute("lang")){elemLang=elemLang.toLowerCase();return elemLang===lang||elemLang.indexOf(lang+"-")===0}}while((elem=elem.parentNode)&&elem.nodeType===1);return false}}),target:function(elem){var hash=window.location&&window.location.hash;return hash&&hash.slice(1)===elem.id},root:function(elem){return elem===docElem},focus:function(elem){return elem===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex)},enabled:createDisabledPseudo(false),disabled:createDisabledPseudo(true),checked:function(elem){var nodeName=elem.nodeName.toLowerCase();return nodeName==="input"&&!!elem.checked||nodeName==="option"&&!!elem.selected},selected:function(elem){if(elem.parentNode){elem.parentNode.selectedIndex}return elem.selected===true},empty:function(elem){for(elem=elem.firstChild;elem;elem=elem.nextSibling){if(elem.nodeType<6){return false}}return true},parent:function(elem){return!Expr.pseudos["empty"](elem)},header:function(elem){return rheader.test(elem.nodeName)},input:function(elem){return rinputs.test(elem.nodeName)},button:function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type==="button"||name==="button"},text:function(elem){var attr;return elem.nodeName.toLowerCase()==="input"&&elem.type==="text"&&((attr=elem.getAttribute("type"))==null||attr.toLowerCase()==="text")},first:createPositionalPseudo(function(){return[0]}),last:createPositionalPseudo(function(matchIndexes,length){return[length-1]}),eq:createPositionalPseudo(function(matchIndexes,length,argument){return[argument<0?argument+length:argument]}),even:createPositionalPseudo(function(matchIndexes,length){var i=0;for(;i<length;i+=2){matchIndexes.push(i)}return matchIndexes}),odd:createPositionalPseudo(function(matchIndexes,length){var i=1;for(;i<length;i+=2){matchIndexes.push(i)}return matchIndexes}),lt:createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0?argument+length:argument;for(;--i>=0;){matchIndexes.push(i)}return matchIndexes}),gt:createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0?argument+length:argument;for(;++i<length;){matchIndexes.push(i)}return matchIndexes})}};Expr.pseudos["nth"]=Expr.pseudos["eq"];for(i in{radio:true,checkbox:true,file:true,password:true,image:true}){Expr.pseudos[i]=createInputPseudo(i)}for(i in{submit:true,reset:true}){Expr.pseudos[i]=createButtonPseudo(i)}function setFilters(){}setFilters.prototype=Expr.filters=Expr.pseudos;Expr.setFilters=new setFilters;tokenize=Sizzle.tokenize=function(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[selector+" "];if(cached){return parseOnly?0:cached.slice(0)}soFar=selector;groups=[];preFilters=Expr.preFilter;while(soFar){if(!matched||(match=rcomma.exec(soFar))){if(match){soFar=soFar.slice(match[0].length)||soFar}groups.push(tokens=[])}matched=false;if(match=rcombinators.exec(soFar)){matched=match.shift();tokens.push({value:matched,type:match[0].replace(rtrim," ")});soFar=soFar.slice(matched.length)}for(type in Expr.filter){if((match=matchExpr[type].exec(soFar))&&(!preFilters[type]||(match=preFilters[type](match)))){matched=match.shift();tokens.push({value:matched,type:type,matches:match});soFar=soFar.slice(matched.length)}}if(!matched){break}}return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0)};function toSelector(tokens){var i=0,len=tokens.length,selector="";for(;i<len;i++){selector+=tokens[i].value}return selector}function addCombinator(matcher,combinator,base){var dir=combinator.dir,skip=combinator.next,key=skip||dir,checkNonElements=base&&key==="parentNode",doneName=done++;return combinator.first?function(elem,context,xml){while(elem=elem[dir]){if(elem.nodeType===1||checkNonElements){return matcher(elem,context,xml)}}return false}:function(elem,context,xml){var oldCache,uniqueCache,outerCache,newCache=[dirruns,doneName];if(xml){while(elem=elem[dir]){if(elem.nodeType===1||checkNonElements){if(matcher(elem,context,xml)){return true}}}}else{while(elem=elem[dir]){if(elem.nodeType===1||checkNonElements){outerCache=elem[expando]||(elem[expando]={});uniqueCache=outerCache[elem.uniqueID]||(outerCache[elem.uniqueID]={});if(skip&&skip===elem.nodeName.toLowerCase()){elem=elem[dir]||elem}else if((oldCache=uniqueCache[key])&&oldCache[0]===dirruns&&oldCache[1]===doneName){return newCache[2]=oldCache[2]}else{uniqueCache[key]=newCache;if(newCache[2]=matcher(elem,context,xml)){return true}}}}}return false}}function elementMatcher(matchers){return matchers.length>1?function(elem,context,xml){var i=matchers.length;while(i--){if(!matchers[i](elem,context,xml)){return false}}return true}:matchers[0]}function multipleContexts(selector,contexts,results){var i=0,len=contexts.length;for(;i<len;i++){Sizzle(selector,contexts[i],results)}return results}function condense(unmatched,map,filter,context,xml){var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=map!=null;for(;i<len;i++){if(elem=unmatched[i]){if(!filter||filter(elem,context,xml)){newUnmatched.push(elem);if(mapped){map.push(i)}}}}return newUnmatched}function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){if(postFilter&&!postFilter[expando]){postFilter=setMatcher(postFilter)}if(postFinder&&!postFinder[expando]){postFinder=setMatcher(postFinder,postSelector)}return markFunction(function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||multipleContexts(selector||"*",context.nodeType?[context]:context,[]),matcherIn=preFilter&&(seed||!selector)?condense(elems,preMap,preFilter,context,xml):elems,matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;if(matcher){matcher(matcherIn,matcherOut,context,xml)}if(postFilter){temp=condense(matcherOut,postMap);postFilter(temp,[],context,xml);i=temp.length;while(i--){if(elem=temp[i]){matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem)}}}if(seed){if(postFinder||preFilter){if(postFinder){temp=[];i=matcherOut.length;while(i--){if(elem=matcherOut[i]){temp.push(matcherIn[i]=elem)}}postFinder(null,matcherOut=[],temp,xml)}i=matcherOut.length;while(i--){if((elem=matcherOut[i])&&(temp=postFinder?indexOf(seed,elem):preMap[i])>-1){seed[temp]=!(results[temp]=elem)}}}}else{matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut);if(postFinder){postFinder(null,results,matcherOut,xml)}else{push.apply(results,matcherOut)}}})}function matcherFromTokens(tokens){var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative?1:0,matchContext=addCombinator(function(elem){return elem===checkContext},implicitRelative,true),matchAnyContext=addCombinator(function(elem){return indexOf(checkContext,elem)>-1},implicitRelative,true),matchers=[function(elem,context,xml){var ret=!leadingRelative&&(xml||context!==outermostContext)||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml));checkContext=null;return ret}];for(;i<len;i++){if(matcher=Expr.relative[tokens[i].type]){matchers=[addCombinator(elementMatcher(matchers),matcher)]}else{matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches);if(matcher[expando]){j=++i;for(;j<len;j++){if(Expr.relative[tokens[j].type]){break}}return setMatcher(i>1&&elementMatcher(matchers),i>1&&toSelector(tokens.slice(0,i-1).concat({value:tokens[i-2].type===" "?"*":""})).replace(rtrim,"$1"),matcher,i<j&&matcherFromTokens(tokens.slice(i,j)),j<len&&matcherFromTokens(tokens=tokens.slice(j)),j<len&&toSelector(tokens))}matchers.push(matcher)}}return elementMatcher(matchers)}function matcherFromGroupMatchers(elementMatchers,setMatchers){var bySet=setMatchers.length>0,byElement=elementMatchers.length>0,superMatcher=function(seed,context,xml,results,outermost){var elem,j,matcher,matchedCount=0,i="0",unmatched=seed&&[],setMatched=[],contextBackup=outermostContext,elems=seed||byElement&&Expr.find["TAG"]("*",outermost),dirrunsUnique=dirruns+=contextBackup==null?1:Math.random()||.1,len=elems.length;if(outermost){outermostContext=context===document||context||outermost}for(;i!==len&&(elem=elems[i])!=null;i++){if(byElement&&elem){j=0;if(!context&&elem.ownerDocument!==document){setDocument(elem);xml=!documentIsHTML}while(matcher=elementMatchers[j++]){if(matcher(elem,context||document,xml)){results.push(elem);break}}if(outermost){dirruns=dirrunsUnique}}if(bySet){if(elem=!matcher&&elem){matchedCount--}if(seed){unmatched.push(elem)}}}matchedCount+=i;if(bySet&&i!==matchedCount){j=0;while(matcher=setMatchers[j++]){matcher(unmatched,setMatched,context,xml)}if(seed){if(matchedCount>0){while(i--){if(!(unmatched[i]||setMatched[i])){setMatched[i]=pop.call(results)}}}setMatched=condense(setMatched)}push.apply(results,setMatched);if(outermost&&!seed&&setMatched.length>0&&matchedCount+setMatchers.length>1){Sizzle.uniqueSort(results)}}if(outermost){dirruns=dirrunsUnique;outermostContext=contextBackup}return unmatched};return bySet?markFunction(superMatcher):superMatcher}compile=Sizzle.compile=function(selector,match){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[selector+" "];if(!cached){if(!match){match=tokenize(selector)}i=match.length;while(i--){cached=matcherFromTokens(match[i]);if(cached[expando]){setMatchers.push(cached)}else{elementMatchers.push(cached)}}cached=compilerCache(selector,matcherFromGroupMatchers(elementMatchers,setMatchers));cached.selector=selector}return cached};select=Sizzle.select=function(selector,context,results,seed){var i,tokens,token,type,find,compiled=typeof selector==="function"&&selector,match=!seed&&tokenize(selector=compiled.selector||selector);results=results||[];if(match.length===1){tokens=match[0]=match[0].slice(0);if(tokens.length>2&&(token=tokens[0]).type==="ID"&&context.nodeType===9&&documentIsHTML&&Expr.relative[tokens[1].type]){context=(Expr.find["ID"](token.matches[0].replace(runescape,funescape),context)||[])[0];if(!context){return results}else if(compiled){context=context.parentNode}selector=selector.slice(tokens.shift().value.length)}i=matchExpr["needsContext"].test(selector)?0:tokens.length;while(i--){token=tokens[i];if(Expr.relative[type=token.type]){break}if(find=Expr.find[type]){if(seed=find(token.matches[0].replace(runescape,funescape),rsibling.test(tokens[0].type)&&testContext(context.parentNode)||context)){tokens.splice(i,1);selector=seed.length&&toSelector(tokens);if(!selector){push.apply(results,seed);return results}break}}}}(compiled||compile(selector,match))(seed,context,!documentIsHTML,results,!context||rsibling.test(selector)&&testContext(context.parentNode)||context);return results};support.sortStable=expando.split("").sort(sortOrder).join("")===expando;support.detectDuplicates=!!hasDuplicate;setDocument();support.sortDetached=assert(function(el){return el.compareDocumentPosition(document.createElement("fieldset"))&1});if(!assert(function(el){el.innerHTML="<a href='#'></a>";return el.firstChild.getAttribute("href")==="#"})){addHandle("type|href|height|width",function(elem,name,isXML){if(!isXML){return elem.getAttribute(name,name.toLowerCase()==="type"?1:2)}})}if(!support.attributes||!assert(function(el){el.innerHTML="<input/>";el.firstChild.setAttribute("value","");return el.firstChild.getAttribute("value")===""})){addHandle("value",function(elem,name,isXML){if(!isXML&&elem.nodeName.toLowerCase()==="input"){return elem.defaultValue}})}if(!assert(function(el){return el.getAttribute("disabled")==null})){addHandle(booleans,function(elem,name,isXML){var val;if(!isXML){return elem[name]===true?name.toLowerCase():(val=elem.getAttributeNode(name))&&val.specified?val.value:null}})}return Sizzle}(window);jQuery.find=Sizzle;jQuery.expr=Sizzle.selectors;jQuery.expr[":"]=jQuery.expr.pseudos;jQuery.uniqueSort=jQuery.unique=Sizzle.uniqueSort;jQuery.text=Sizzle.getText;jQuery.isXMLDoc=Sizzle.isXML;jQuery.contains=Sizzle.contains;jQuery.escapeSelector=Sizzle.escape;var dir=function(elem,dir,until){var matched=[],truncate=until!==undefined;while((elem=elem[dir])&&elem.nodeType!==9){if(elem.nodeType===1){if(truncate&&jQuery(elem).is(until)){break}matched.push(elem)}}return matched};var siblings=function(n,elem){var matched=[];for(;n;n=n.nextSibling){if(n.nodeType===1&&n!==elem){matched.push(n)}}return matched};var rneedsContext=jQuery.expr.match.needsContext;function nodeName(elem,name){return elem.nodeName&&elem.nodeName.toLowerCase()===name.toLowerCase()}var rsingleTag=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function winnow(elements,qualifier,not){if(isFunction(qualifier)){return jQuery.grep(elements,function(elem,i){return!!qualifier.call(elem,i,elem)!==not})}if(qualifier.nodeType){return jQuery.grep(elements,function(elem){return elem===qualifier!==not})}if(typeof qualifier!=="string"){return jQuery.grep(elements,function(elem){return indexOf.call(qualifier,elem)>-1!==not})}return jQuery.filter(qualifier,elements,not)}jQuery.filter=function(expr,elems,not){var elem=elems[0];if(not){expr=":not("+expr+")"}if(elems.length===1&&elem.nodeType===1){return jQuery.find.matchesSelector(elem,expr)?[elem]:[]}return jQuery.find.matches(expr,jQuery.grep(elems,function(elem){return elem.nodeType===1}))};jQuery.fn.extend({find:function(selector){var i,ret,len=this.length,self=this;if(typeof selector!=="string"){return this.pushStack(jQuery(selector).filter(function(){for(i=0;i<len;i++){if(jQuery.contains(self[i],this)){return true}}}))}ret=this.pushStack([]);for(i=0;i<len;i++){jQuery.find(selector,self[i],ret)}return len>1?jQuery.uniqueSort(ret):ret},filter:function(selector){return this.pushStack(winnow(this,selector||[],false))},not:function(selector){return this.pushStack(winnow(this,selector||[],true))},is:function(selector){return!!winnow(this,typeof selector==="string"&&rneedsContext.test(selector)?jQuery(selector):selector||[],false).length}});var rootjQuery,rquickExpr=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,init=jQuery.fn.init=function(selector,context,root){var match,elem;if(!selector){return this}root=root||rootjQuery;if(typeof selector==="string"){if(selector[0]==="<"&&selector[selector.length-1]===">"&&selector.length>=3){match=[null,selector,null]}else{match=rquickExpr.exec(selector)}if(match&&(match[1]||!context)){if(match[1]){context=context instanceof jQuery?context[0]:context;jQuery.merge(this,jQuery.parseHTML(match[1],context&&context.nodeType?context.ownerDocument||context:document,true));if(rsingleTag.test(match[1])&&jQuery.isPlainObject(context)){for(match in context){if(isFunction(this[match])){this[match](context[match])}else{this.attr(match,context[match])}}}return this}else{elem=document.getElementById(match[2]);if(elem){this[0]=elem;this.length=1}return this}}else if(!context||context.jquery){return(context||root).find(selector)}else{return this.constructor(context).find(selector)}}else if(selector.nodeType){this[0]=selector;this.length=1;return this}else if(isFunction(selector)){return root.ready!==undefined?root.ready(selector):selector(jQuery)}return jQuery.makeArray(selector,this)};init.prototype=jQuery.fn;rootjQuery=jQuery(document);var rparentsprev=/^(?:parents|prev(?:Until|All))/,guaranteedUnique={children:true,contents:true,next:true,prev:true};jQuery.fn.extend({has:function(target){var targets=jQuery(target,this),l=targets.length;return this.filter(function(){var i=0;for(;i<l;i++){if(jQuery.contains(this,targets[i])){return true}}})},closest:function(selectors,context){var cur,i=0,l=this.length,matched=[],targets=typeof selectors!=="string"&&jQuery(selectors);if(!rneedsContext.test(selectors)){for(;i<l;i++){for(cur=this[i];cur&&cur!==context;cur=cur.parentNode){if(cur.nodeType<11&&(targets?targets.index(cur)>-1:cur.nodeType===1&&jQuery.find.matchesSelector(cur,selectors))){matched.push(cur);break}}}}return this.pushStack(matched.length>1?jQuery.uniqueSort(matched):matched)},index:function(elem){if(!elem){return this[0]&&this[0].parentNode?this.first().prevAll().length:-1}if(typeof elem==="string"){return indexOf.call(jQuery(elem),this[0])}return indexOf.call(this,elem.jquery?elem[0]:elem)},add:function(selector,context){return this.pushStack(jQuery.uniqueSort(jQuery.merge(this.get(),jQuery(selector,context))))},addBack:function(selector){return this.add(selector==null?this.prevObject:this.prevObject.filter(selector))}});function sibling(cur,dir){while((cur=cur[dir])&&cur.nodeType!==1){}return cur}jQuery.each({parent:function(elem){var parent=elem.parentNode;return parent&&parent.nodeType!==11?parent:null},parents:function(elem){return dir(elem,"parentNode")},parentsUntil:function(elem,i,until){return dir(elem,"parentNode",until)},next:function(elem){return sibling(elem,"nextSibling")},prev:function(elem){return sibling(elem,"previousSibling")},nextAll:function(elem){return dir(elem,"nextSibling")},prevAll:function(elem){return dir(elem,"previousSibling")},nextUntil:function(elem,i,until){return dir(elem,"nextSibling",until)},prevUntil:function(elem,i,until){return dir(elem,"previousSibling",until)},siblings:function(elem){return siblings((elem.parentNode||{}).firstChild,elem)},children:function(elem){return siblings(elem.firstChild)},contents:function(elem){if(nodeName(elem,"iframe")){return elem.contentDocument}if(nodeName(elem,"template")){elem=elem.content||elem}return jQuery.merge([],elem.childNodes)}},function(name,fn){jQuery.fn[name]=function(until,selector){var matched=jQuery.map(this,fn,until);if(name.slice(-5)!=="Until"){selector=until}if(selector&&typeof selector==="string"){matched=jQuery.filter(selector,matched)}if(this.length>1){if(!guaranteedUnique[name]){jQuery.uniqueSort(matched)}if(rparentsprev.test(name)){matched.reverse()}}return this.pushStack(matched)}});var rnothtmlwhite=/[^\x20\t\r\n\f]+/g;function createOptions(options){var object={};jQuery.each(options.match(rnothtmlwhite)||[],function(_,flag){object[flag]=true});return object}jQuery.Callbacks=function(options){options=typeof options==="string"?createOptions(options):jQuery.extend({},options);var firing,memory,fired,locked,list=[],queue=[],firingIndex=-1,fire=function(){locked=locked||options.once;fired=firing=true;for(;queue.length;firingIndex=-1){memory=queue.shift();while(++firingIndex<list.length){if(list[firingIndex].apply(memory[0],memory[1])===false&&options.stopOnFalse){firingIndex=list.length;memory=false}}}if(!options.memory){memory=false}firing=false;if(locked){if(memory){list=[]}else{list=""}}},self={add:function(){if(list){if(memory&&!firing){firingIndex=list.length-1;queue.push(memory)}(function add(args){jQuery.each(args,function(_,arg){if(isFunction(arg)){if(!options.unique||!self.has(arg)){list.push(arg)}}else if(arg&&arg.length&&toType(arg)!=="string"){add(arg)}})})(arguments);if(memory&&!firing){fire()}}return this},remove:function(){jQuery.each(arguments,function(_,arg){var index;while((index=jQuery.inArray(arg,list,index))>-1){list.splice(index,1);if(index<=firingIndex){firingIndex--}}});return this},has:function(fn){return fn?jQuery.inArray(fn,list)>-1:list.length>0},empty:function(){if(list){list=[]}return this},disable:function(){locked=queue=[];list=memory="";return this},disabled:function(){return!list},lock:function(){locked=queue=[];if(!memory&&!firing){list=memory=""}return this},locked:function(){return!!locked},fireWith:function(context,args){if(!locked){args=args||[];args=[context,args.slice?args.slice():args];queue.push(args);if(!firing){fire()}}return this},fire:function(){self.fireWith(this,arguments);return this},fired:function(){return!!fired}};return self};function Identity(v){return v}function Thrower(ex){throw ex}function adoptValue(value,resolve,reject,noValue){var method;try{if(value&&isFunction(method=value.promise)){method.call(value).done(resolve).fail(reject)}else if(value&&isFunction(method=value.then)){method.call(value,resolve,reject)}else{resolve.apply(undefined,[value].slice(noValue))}}catch(value){reject.apply(undefined,[value])}}jQuery.extend({Deferred:function(func){var tuples=[["notify","progress",jQuery.Callbacks("memory"),jQuery.Callbacks("memory"),2],["resolve","done",jQuery.Callbacks("once memory"),jQuery.Callbacks("once memory"),0,"resolved"],["reject","fail",jQuery.Callbacks("once memory"),jQuery.Callbacks("once memory"),1,"rejected"]],state="pending",promise={state:function(){return state},always:function(){deferred.done(arguments).fail(arguments);return this},catch:function(fn){return promise.then(null,fn)},pipe:function(){var fns=arguments;return jQuery.Deferred(function(newDefer){jQuery.each(tuples,function(i,tuple){var fn=isFunction(fns[tuple[4]])&&fns[tuple[4]];deferred[tuple[1]](function(){var returned=fn&&fn.apply(this,arguments);if(returned&&isFunction(returned.promise)){returned.promise().progress(newDefer.notify).done(newDefer.resolve).fail(newDefer.reject)}else{newDefer[tuple[0]+"With"](this,fn?[returned]:arguments)}})});fns=null}).promise()},then:function(onFulfilled,onRejected,onProgress){var maxDepth=0;function resolve(depth,deferred,handler,special){return function(){var that=this,args=arguments,mightThrow=function(){var returned,then;if(depth<maxDepth){return}returned=handler.apply(that,args);if(returned===deferred.promise()){throw new TypeError("Thenable self-resolution")}then=returned&&(typeof returned==="object"||typeof returned==="function")&&returned.then;if(isFunction(then)){if(special){then.call(returned,resolve(maxDepth,deferred,Identity,special),resolve(maxDepth,deferred,Thrower,special))}else{maxDepth++;then.call(returned,resolve(maxDepth,deferred,Identity,special),resolve(maxDepth,deferred,Thrower,special),resolve(maxDepth,deferred,Identity,deferred.notifyWith))}}else{if(handler!==Identity){that=undefined;args=[returned]}(special||deferred.resolveWith)(that,args)}},process=special?mightThrow:function(){try{mightThrow()}catch(e){if(jQuery.Deferred.exceptionHook){jQuery.Deferred.exceptionHook(e,process.stackTrace)}if(depth+1>=maxDepth){if(handler!==Thrower){that=undefined;args=[e]}deferred.rejectWith(that,args)}}};if(depth){process()}else{if(jQuery.Deferred.getStackHook){process.stackTrace=jQuery.Deferred.getStackHook()}window.setTimeout(process)}}}return jQuery.Deferred(function(newDefer){tuples[0][3].add(resolve(0,newDefer,isFunction(onProgress)?onProgress:Identity,newDefer.notifyWith));tuples[1][3].add(resolve(0,newDefer,isFunction(onFulfilled)?onFulfilled:Identity));tuples[2][3].add(resolve(0,newDefer,isFunction(onRejected)?onRejected:Thrower))}).promise()},promise:function(obj){return obj!=null?jQuery.extend(obj,promise):promise}},deferred={};jQuery.each(tuples,function(i,tuple){var list=tuple[2],stateString=tuple[5];promise[tuple[1]]=list.add;if(stateString){list.add(function(){state=stateString},tuples[3-i][2].disable,tuples[3-i][3].disable,tuples[0][2].lock,tuples[0][3].lock)}list.add(tuple[3].fire);deferred[tuple[0]]=function(){deferred[tuple[0]+"With"](this===deferred?undefined:this,arguments);return this};deferred[tuple[0]+"With"]=list.fireWith});promise.promise(deferred);if(func){func.call(deferred,deferred)}return deferred},when:function(singleValue){var remaining=arguments.length,i=remaining,resolveContexts=Array(i),resolveValues=slice.call(arguments),master=jQuery.Deferred(),updateFunc=function(i){return function(value){resolveContexts[i]=this;resolveValues[i]=arguments.length>1?slice.call(arguments):value;if(!--remaining){master.resolveWith(resolveContexts,resolveValues)}}};if(remaining<=1){adoptValue(singleValue,master.done(updateFunc(i)).resolve,master.reject,!remaining);if(master.state()==="pending"||isFunction(resolveValues[i]&&resolveValues[i].then)){return master.then()}}while(i--){adoptValue(resolveValues[i],updateFunc(i),master.reject)}return master.promise()}});var rerrorNames=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;jQuery.Deferred.exceptionHook=function(error,stack){if(window.console&&window.console.warn&&error&&rerrorNames.test(error.name)){window.console.warn("jQuery.Deferred exception: "+error.message,error.stack,stack)}};jQuery.readyException=function(error){window.setTimeout(function(){throw error})};var readyList=jQuery.Deferred();jQuery.fn.ready=function(fn){readyList.then(fn).catch(function(error){jQuery.readyException(error)});return this};jQuery.extend({isReady:false,readyWait:1,ready:function(wait){if(wait===true?--jQuery.readyWait:jQuery.isReady){return}jQuery.isReady=true;if(wait!==true&&--jQuery.readyWait>0){return}readyList.resolveWith(document,[jQuery])}});jQuery.ready.then=readyList.then;function completed(){document.removeEventListener("DOMContentLoaded",completed);window.removeEventListener("load",completed);jQuery.ready()}if(document.readyState==="complete"||document.readyState!=="loading"&&!document.documentElement.doScroll){window.setTimeout(jQuery.ready)}else{document.addEventListener("DOMContentLoaded",completed);window.addEventListener("load",completed)}var access=function(elems,fn,key,value,chainable,emptyGet,raw){var i=0,len=elems.length,bulk=key==null;if(toType(key)==="object"){chainable=true;for(i in key){access(elems,fn,i,key[i],true,emptyGet,raw)}}else if(value!==undefined){chainable=true;if(!isFunction(value)){raw=true}if(bulk){if(raw){fn.call(elems,value);fn=null}else{bulk=fn;fn=function(elem,key,value){return bulk.call(jQuery(elem),value)}}}if(fn){for(;i<len;i++){fn(elems[i],key,raw?value:value.call(elems[i],i,fn(elems[i],key)))}}}if(chainable){return elems}if(bulk){return fn.call(elems)}return len?fn(elems[0],key):emptyGet};var rmsPrefix=/^-ms-/,rdashAlpha=/-([a-z])/g;function fcamelCase(all,letter){return letter.toUpperCase()}function camelCase(string){return string.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase)}var acceptData=function(owner){return owner.nodeType===1||owner.nodeType===9||!+owner.nodeType};function Data(){this.expando=jQuery.expando+Data.uid++}Data.uid=1;Data.prototype={cache:function(owner){var value=owner[this.expando];if(!value){value={};if(acceptData(owner)){if(owner.nodeType){owner[this.expando]=value}else{Object.defineProperty(owner,this.expando,{value:value,configurable:true})}}}return value},set:function(owner,data,value){var prop,cache=this.cache(owner);if(typeof data==="string"){cache[camelCase(data)]=value}else{for(prop in data){cache[camelCase(prop)]=data[prop]}}return cache},get:function(owner,key){return key===undefined?this.cache(owner):owner[this.expando]&&owner[this.expando][camelCase(key)]},access:function(owner,key,value){if(key===undefined||key&&typeof key==="string"&&value===undefined){return this.get(owner,key)}this.set(owner,key,value);return value!==undefined?value:key},remove:function(owner,key){var i,cache=owner[this.expando];if(cache===undefined){return}if(key!==undefined){if(Array.isArray(key)){key=key.map(camelCase)}else{key=camelCase(key);key=key in cache?[key]:key.match(rnothtmlwhite)||[]}i=key.length;while(i--){delete cache[key[i]]}}if(key===undefined||jQuery.isEmptyObject(cache)){if(owner.nodeType){owner[this.expando]=undefined}else{delete owner[this.expando]}}},hasData:function(owner){var cache=owner[this.expando];return cache!==undefined&&!jQuery.isEmptyObject(cache)}};var dataPriv=new Data;var dataUser=new Data;var rbrace=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,rmultiDash=/[A-Z]/g;function getData(data){if(data==="true"){return true}if(data==="false"){return false}if(data==="null"){return null}if(data===+data+""){return+data}if(rbrace.test(data)){return JSON.parse(data)}return data}function dataAttr(elem,key,data){var name;if(data===undefined&&elem.nodeType===1){name="data-"+key.replace(rmultiDash,"-$&").toLowerCase();data=elem.getAttribute(name);if(typeof data==="string"){try{data=getData(data)}catch(e){}dataUser.set(elem,key,data)}else{data=undefined}}return data}jQuery.extend({hasData:function(elem){return dataUser.hasData(elem)||dataPriv.hasData(elem)},data:function(elem,name,data){return dataUser.access(elem,name,data)},removeData:function(elem,name){dataUser.remove(elem,name)},_data:function(elem,name,data){return dataPriv.access(elem,name,data)},_removeData:function(elem,name){dataPriv.remove(elem,name)}});jQuery.fn.extend({data:function(key,value){var i,name,data,elem=this[0],attrs=elem&&elem.attributes;if(key===undefined){if(this.length){data=dataUser.get(elem);if(elem.nodeType===1&&!dataPriv.get(elem,"hasDataAttrs")){i=attrs.length;while(i--){if(attrs[i]){name=attrs[i].name;if(name.indexOf("data-")===0){name=camelCase(name.slice(5));dataAttr(elem,name,data[name])}}}dataPriv.set(elem,"hasDataAttrs",true)}}return data}if(typeof key==="object"){return this.each(function(){dataUser.set(this,key)})}return access(this,function(value){var data;if(elem&&value===undefined){data=dataUser.get(elem,key);if(data!==undefined){return data}data=dataAttr(elem,key);if(data!==undefined){return data}return}this.each(function(){dataUser.set(this,key,value)})},null,value,arguments.length>1,null,true)},removeData:function(key){return this.each(function(){dataUser.remove(this,key)})}});jQuery.extend({queue:function(elem,type,data){var queue;if(elem){type=(type||"fx")+"queue";queue=dataPriv.get(elem,type);if(data){if(!queue||Array.isArray(data)){queue=dataPriv.access(elem,type,jQuery.makeArray(data))}else{queue.push(data)}}return queue||[]}},dequeue:function(elem,type){type=type||"fx";var queue=jQuery.queue(elem,type),startLength=queue.length,fn=queue.shift(),hooks=jQuery._queueHooks(elem,type),next=function(){jQuery.dequeue(elem,type)};if(fn==="inprogress"){fn=queue.shift();startLength--}if(fn){if(type==="fx"){queue.unshift("inprogress")}delete hooks.stop;fn.call(elem,next,hooks)}if(!startLength&&hooks){hooks.empty.fire()}},_queueHooks:function(elem,type){var key=type+"queueHooks";return dataPriv.get(elem,key)||dataPriv.access(elem,key,{empty:jQuery.Callbacks("once memory").add(function(){dataPriv.remove(elem,[type+"queue",key])})})}});jQuery.fn.extend({queue:function(type,data){var setter=2;if(typeof type!=="string"){data=type;type="fx";setter--}if(arguments.length<setter){return jQuery.queue(this[0],type)}return data===undefined?this:this.each(function(){var queue=jQuery.queue(this,type,data);jQuery._queueHooks(this,type);if(type==="fx"&&queue[0]!=="inprogress"){jQuery.dequeue(this,type)}})},dequeue:function(type){return this.each(function(){jQuery.dequeue(this,type)})},clearQueue:function(type){return this.queue(type||"fx",[])},promise:function(type,obj){var tmp,count=1,defer=jQuery.Deferred(),elements=this,i=this.length,resolve=function(){if(!--count){defer.resolveWith(elements,[elements])}};if(typeof type!=="string"){obj=type;type=undefined}type=type||"fx";while(i--){tmp=dataPriv.get(elements[i],type+"queueHooks");if(tmp&&tmp.empty){count++;tmp.empty.add(resolve)}}resolve();return defer.promise(obj)}});var pnum=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source;var rcssNum=new RegExp("^(?:([+-])=|)("+pnum+")([a-z%]*)$","i");var cssExpand=["Top","Right","Bottom","Left"];var isHiddenWithinTree=function(elem,el){elem=el||elem;return elem.style.display==="none"||elem.style.display===""&&jQuery.contains(elem.ownerDocument,elem)&&jQuery.css(elem,"display")==="none"};var swap=function(elem,options,callback,args){var ret,name,old={};for(name in options){old[name]=elem.style[name];elem.style[name]=options[name]}ret=callback.apply(elem,args||[]);for(name in options){elem.style[name]=old[name]}return ret};function adjustCSS(elem,prop,valueParts,tween){var adjusted,scale,maxIterations=20,currentValue=tween?function(){return tween.cur()}:function(){return jQuery.css(elem,prop,"")},initial=currentValue(),unit=valueParts&&valueParts[3]||(jQuery.cssNumber[prop]?"":"px"),initialInUnit=(jQuery.cssNumber[prop]||unit!=="px"&&+initial)&&rcssNum.exec(jQuery.css(elem,prop));if(initialInUnit&&initialInUnit[3]!==unit){initial=initial/2;unit=unit||initialInUnit[3];initialInUnit=+initial||1;while(maxIterations--){jQuery.style(elem,prop,initialInUnit+unit);if((1-scale)*(1-(scale=currentValue()/initial||.5))<=0){maxIterations=0}initialInUnit=initialInUnit/scale}initialInUnit=initialInUnit*2;jQuery.style(elem,prop,initialInUnit+unit);valueParts=valueParts||[]}if(valueParts){initialInUnit=+initialInUnit||+initial||0;adjusted=valueParts[1]?initialInUnit+(valueParts[1]+1)*valueParts[2]:+valueParts[2];if(tween){tween.unit=unit;tween.start=initialInUnit;tween.end=adjusted}}return adjusted}var defaultDisplayMap={};function getDefaultDisplay(elem){var temp,doc=elem.ownerDocument,nodeName=elem.nodeName,display=defaultDisplayMap[nodeName];if(display){return display}temp=doc.body.appendChild(doc.createElement(nodeName));display=jQuery.css(temp,"display");temp.parentNode.removeChild(temp);if(display==="none"){display="block"}defaultDisplayMap[nodeName]=display;return display}function showHide(elements,show){var display,elem,values=[],index=0,length=elements.length;for(;index<length;index++){elem=elements[index];if(!elem.style){continue}display=elem.style.display;if(show){if(display==="none"){values[index]=dataPriv.get(elem,"display")||null;if(!values[index]){elem.style.display=""}}if(elem.style.display===""&&isHiddenWithinTree(elem)){values[index]=getDefaultDisplay(elem)}}else{if(display!=="none"){values[index]="none";dataPriv.set(elem,"display",display)}}}for(index=0;index<length;index++){if(values[index]!=null){elements[index].style.display=values[index]}}return elements}jQuery.fn.extend({show:function(){return showHide(this,true)},hide:function(){return showHide(this)},toggle:function(state){if(typeof state==="boolean"){return state?this.show():this.hide()}return this.each(function(){if(isHiddenWithinTree(this)){jQuery(this).show()}else{jQuery(this).hide()}})}});var rcheckableType=/^(?:checkbox|radio)$/i;var rtagName=/<([a-z][^\/\0>\x20\t\r\n\f]+)/i;var rscriptType=/^$|^module$|\/(?:java|ecma)script/i;var wrapMap={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};wrapMap.optgroup=wrapMap.option;wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead;wrapMap.th=wrapMap.td;function getAll(context,tag){var ret;if(typeof context.getElementsByTagName!=="undefined"){ret=context.getElementsByTagName(tag||"*")}else if(typeof context.querySelectorAll!=="undefined"){ret=context.querySelectorAll(tag||"*")}else{ret=[]}if(tag===undefined||tag&&nodeName(context,tag)){return jQuery.merge([context],ret)}return ret}function setGlobalEval(elems,refElements){var i=0,l=elems.length;for(;i<l;i++){dataPriv.set(elems[i],"globalEval",!refElements||dataPriv.get(refElements[i],"globalEval"))}}var rhtml=/<|&#?\w+;/;function buildFragment(elems,context,scripts,selection,ignored){var elem,tmp,tag,wrap,contains,j,fragment=context.createDocumentFragment(),nodes=[],i=0,l=elems.length;for(;i<l;i++){elem=elems[i];if(elem||elem===0){if(toType(elem)==="object"){jQuery.merge(nodes,elem.nodeType?[elem]:elem)}else if(!rhtml.test(elem)){nodes.push(context.createTextNode(elem))}else{tmp=tmp||fragment.appendChild(context.createElement("div"));tag=(rtagName.exec(elem)||["",""])[1].toLowerCase();wrap=wrapMap[tag]||wrapMap._default;tmp.innerHTML=wrap[1]+jQuery.htmlPrefilter(elem)+wrap[2];j=wrap[0];while(j--){tmp=tmp.lastChild}jQuery.merge(nodes,tmp.childNodes);tmp=fragment.firstChild;tmp.textContent=""}}}fragment.textContent="";i=0;while(elem=nodes[i++]){if(selection&&jQuery.inArray(elem,selection)>-1){if(ignored){ignored.push(elem)}continue}contains=jQuery.contains(elem.ownerDocument,elem);tmp=getAll(fragment.appendChild(elem),"script");if(contains){setGlobalEval(tmp)}if(scripts){j=0;while(elem=tmp[j++]){if(rscriptType.test(elem.type||"")){scripts.push(elem)}}}}return fragment}(function(){var fragment=document.createDocumentFragment(),div=fragment.appendChild(document.createElement("div")),input=document.createElement("input");input.setAttribute("type","radio");input.setAttribute("checked","checked");input.setAttribute("name","t");div.appendChild(input);support.checkClone=div.cloneNode(true).cloneNode(true).lastChild.checked;div.innerHTML="<textarea>x</textarea>";support.noCloneChecked=!!div.cloneNode(true).lastChild.defaultValue})();var documentElement=document.documentElement;var rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,rtypenamespace=/^([^.]*)(?:\.(.+)|)/;function returnTrue(){return true}function returnFalse(){return false}function safeActiveElement(){try{return document.activeElement}catch(err){}}function on(elem,types,selector,data,fn,one){var origFn,type;if(typeof types==="object"){if(typeof selector!=="string"){data=data||selector;selector=undefined}for(type in types){on(elem,type,selector,data,types[type],one)}return elem}if(data==null&&fn==null){fn=selector;data=selector=undefined}else if(fn==null){if(typeof selector==="string"){fn=data;data=undefined}else{fn=data;data=selector;selector=undefined}}if(fn===false){fn=returnFalse}else if(!fn){return elem}if(one===1){origFn=fn;fn=function(event){jQuery().off(event);return origFn.apply(this,arguments)};fn.guid=origFn.guid||(origFn.guid=jQuery.guid++)}return elem.each(function(){jQuery.event.add(this,types,fn,data,selector)})}jQuery.event={global:{},add:function(elem,types,handler,data,selector){var handleObjIn,eventHandle,tmp,events,t,handleObj,special,handlers,type,namespaces,origType,elemData=dataPriv.get(elem);if(!elemData){return}if(handler.handler){handleObjIn=handler;handler=handleObjIn.handler;selector=handleObjIn.selector}if(selector){jQuery.find.matchesSelector(documentElement,selector)}if(!handler.guid){handler.guid=jQuery.guid++}if(!(events=elemData.events)){events=elemData.events={}}if(!(eventHandle=elemData.handle)){eventHandle=elemData.handle=function(e){return typeof jQuery!=="undefined"&&jQuery.event.triggered!==e.type?jQuery.event.dispatch.apply(elem,arguments):undefined}}types=(types||"").match(rnothtmlwhite)||[""];t=types.length;while(t--){tmp=rtypenamespace.exec(types[t])||[];type=origType=tmp[1];namespaces=(tmp[2]||"").split(".").sort();if(!type){continue}special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;special=jQuery.event.special[type]||{};handleObj=jQuery.extend({type:type,origType:origType,data:data,handler:handler,guid:handler.guid,selector:selector,needsContext:selector&&jQuery.expr.match.needsContext.test(selector),namespace:namespaces.join(".")},handleObjIn);if(!(handlers=events[type])){handlers=events[type]=[];handlers.delegateCount=0;if(!special.setup||special.setup.call(elem,data,namespaces,eventHandle)===false){if(elem.addEventListener){elem.addEventListener(type,eventHandle)}}}if(special.add){special.add.call(elem,handleObj);if(!handleObj.handler.guid){handleObj.handler.guid=handler.guid}}if(selector){handlers.splice(handlers.delegateCount++,0,handleObj)}else{handlers.push(handleObj)}jQuery.event.global[type]=true}},remove:function(elem,types,handler,selector,mappedTypes){var j,origCount,tmp,events,t,handleObj,special,handlers,type,namespaces,origType,elemData=dataPriv.hasData(elem)&&dataPriv.get(elem);if(!elemData||!(events=elemData.events)){return}types=(types||"").match(rnothtmlwhite)||[""];t=types.length;while(t--){tmp=rtypenamespace.exec(types[t])||[];type=origType=tmp[1];namespaces=(tmp[2]||"").split(".").sort();if(!type){for(type in events){jQuery.event.remove(elem,type+types[t],handler,selector,true)}continue}special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;handlers=events[type]||[];tmp=tmp[2]&&new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)");origCount=j=handlers.length;while(j--){handleObj=handlers[j];if((mappedTypes||origType===handleObj.origType)&&(!handler||handler.guid===handleObj.guid)&&(!tmp||tmp.test(handleObj.namespace))&&(!selector||selector===handleObj.selector||selector==="**"&&handleObj.selector)){handlers.splice(j,1);if(handleObj.selector){handlers.delegateCount--}if(special.remove){special.remove.call(elem,handleObj)}}}if(origCount&&!handlers.length){if(!special.teardown||special.teardown.call(elem,namespaces,elemData.handle)===false){jQuery.removeEvent(elem,type,elemData.handle)}delete events[type]}}if(jQuery.isEmptyObject(events)){dataPriv.remove(elem,"handle events")}},dispatch:function(nativeEvent){var event=jQuery.event.fix(nativeEvent);var i,j,ret,matched,handleObj,handlerQueue,args=new Array(arguments.length),handlers=(dataPriv.get(this,"events")||{})[event.type]||[],special=jQuery.event.special[event.type]||{};args[0]=event;for(i=1;i<arguments.length;i++){args[i]=arguments[i]}event.delegateTarget=this;if(special.preDispatch&&special.preDispatch.call(this,event)===false){return}handlerQueue=jQuery.event.handlers.call(this,event,handlers);i=0;while((matched=handlerQueue[i++])&&!event.isPropagationStopped()){event.currentTarget=matched.elem;j=0;while((handleObj=matched.handlers[j++])&&!event.isImmediatePropagationStopped()){if(!event.rnamespace||event.rnamespace.test(handleObj.namespace)){event.handleObj=handleObj;event.data=handleObj.data;ret=((jQuery.event.special[handleObj.origType]||{}).handle||handleObj.handler).apply(matched.elem,args);if(ret!==undefined){if((event.result=ret)===false){event.preventDefault();event.stopPropagation()}}}}}if(special.postDispatch){special.postDispatch.call(this,event)}return event.result},handlers:function(event,handlers){var i,handleObj,sel,matchedHandlers,matchedSelectors,handlerQueue=[],delegateCount=handlers.delegateCount,cur=event.target;if(delegateCount&&cur.nodeType&&!(event.type==="click"&&event.button>=1)){for(;cur!==this;cur=cur.parentNode||this){if(cur.nodeType===1&&!(event.type==="click"&&cur.disabled===true)){matchedHandlers=[];matchedSelectors={};for(i=0;i<delegateCount;i++){handleObj=handlers[i];sel=handleObj.selector+" ";if(matchedSelectors[sel]===undefined){matchedSelectors[sel]=handleObj.needsContext?jQuery(sel,this).index(cur)>-1:jQuery.find(sel,this,null,[cur]).length}if(matchedSelectors[sel]){matchedHandlers.push(handleObj)}}if(matchedHandlers.length){handlerQueue.push({elem:cur,handlers:matchedHandlers})}}}}cur=this;if(delegateCount<handlers.length){handlerQueue.push({elem:cur,handlers:handlers.slice(delegateCount)})}return handlerQueue},addProp:function(name,hook){Object.defineProperty(jQuery.Event.prototype,name,{enumerable:true,configurable:true,get:isFunction(hook)?function(){if(this.originalEvent){return hook(this.originalEvent)}}:function(){if(this.originalEvent){return this.originalEvent[name]}},set:function(value){Object.defineProperty(this,name,{enumerable:true,configurable:true,writable:true,value:value})}})},fix:function(originalEvent){return originalEvent[jQuery.expando]?originalEvent:new jQuery.Event(originalEvent)},special:{load:{noBubble:true},focus:{trigger:function(){if(this!==safeActiveElement()&&this.focus){this.focus();return false}},delegateType:"focusin"},blur:{trigger:function(){if(this===safeActiveElement()&&this.blur){this.blur();return false}},delegateType:"focusout"},click:{trigger:function(){if(this.type==="checkbox"&&this.click&&nodeName(this,"input")){this.click();return false}},_default:function(event){return nodeName(event.target,"a")}},beforeunload:{postDispatch:function(event){if(event.result!==undefined&&event.originalEvent){event.originalEvent.returnValue=event.result}}}}};jQuery.removeEvent=function(elem,type,handle){if(elem.removeEventListener){elem.removeEventListener(type,handle)}};jQuery.Event=function(src,props){if(!(this instanceof jQuery.Event)){return new jQuery.Event(src,props)}if(src&&src.type){this.originalEvent=src;this.type=src.type;this.isDefaultPrevented=src.defaultPrevented||src.defaultPrevented===undefined&&src.returnValue===false?returnTrue:returnFalse;this.target=src.target&&src.target.nodeType===3?src.target.parentNode:src.target;this.currentTarget=src.currentTarget;this.relatedTarget=src.relatedTarget}else{this.type=src}if(props){jQuery.extend(this,props)}this.timeStamp=src&&src.timeStamp||Date.now();this[jQuery.expando]=true};jQuery.Event.prototype={constructor:jQuery.Event,isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse,isSimulated:false,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=returnTrue;if(e&&!this.isSimulated){e.preventDefault()}},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=returnTrue;if(e&&!this.isSimulated){e.stopPropagation()}},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=returnTrue;if(e&&!this.isSimulated){e.stopImmediatePropagation()}this.stopPropagation()}};jQuery.each({altKey:true,bubbles:true,cancelable:true,changedTouches:true,ctrlKey:true,detail:true,eventPhase:true,metaKey:true,pageX:true,pageY:true,shiftKey:true,view:true,char:true,charCode:true,key:true,keyCode:true,button:true,buttons:true,clientX:true,clientY:true,offsetX:true,offsetY:true,pointerId:true,pointerType:true,screenX:true,screenY:true,targetTouches:true,toElement:true,touches:true,which:function(event){var button=event.button;if(event.which==null&&rkeyEvent.test(event.type)){return event.charCode!=null?event.charCode:event.keyCode}if(!event.which&&button!==undefined&&rmouseEvent.test(event.type)){if(button&1){return 1}if(button&2){return 3}if(button&4){return 2}return 0}return event.which}},jQuery.event.addProp);jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(orig,fix){jQuery.event.special[orig]={delegateType:fix,bindType:fix,handle:function(event){var ret,target=this,related=event.relatedTarget,handleObj=event.handleObj;if(!related||related!==target&&!jQuery.contains(target,related)){event.type=handleObj.origType;ret=handleObj.handler.apply(this,arguments);event.type=fix}return ret}}});jQuery.fn.extend({on:function(types,selector,data,fn){return on(this,types,selector,data,fn)},one:function(types,selector,data,fn){return on(this,types,selector,data,fn,1)},off:function(types,selector,fn){var handleObj,type;if(types&&types.preventDefault&&types.handleObj){handleObj=types.handleObj;jQuery(types.delegateTarget).off(handleObj.namespace?handleObj.origType+"."+handleObj.namespace:handleObj.origType,handleObj.selector,handleObj.handler);return this}if(typeof types==="object"){for(type in types){this.off(type,selector,types[type])}return this}if(selector===false||typeof selector==="function"){fn=selector;selector=undefined}if(fn===false){fn=returnFalse}return this.each(function(){jQuery.event.remove(this,types,fn,selector)})}});var rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,rnoInnerhtml=/<script|<style|<link/i,rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rcleanScript=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function manipulationTarget(elem,content){if(nodeName(elem,"table")&&nodeName(content.nodeType!==11?content:content.firstChild,"tr")){return jQuery(elem).children("tbody")[0]||elem}return elem}function disableScript(elem){elem.type=(elem.getAttribute("type")!==null)+"/"+elem.type;return elem}function restoreScript(elem){if((elem.type||"").slice(0,5)==="true/"){elem.type=elem.type.slice(5)}else{elem.removeAttribute("type")}return elem}function cloneCopyEvent(src,dest){var i,l,type,pdataOld,pdataCur,udataOld,udataCur,events;if(dest.nodeType!==1){return}if(dataPriv.hasData(src)){pdataOld=dataPriv.access(src);pdataCur=dataPriv.set(dest,pdataOld);events=pdataOld.events;if(events){delete pdataCur.handle;pdataCur.events={};for(type in events){for(i=0,l=events[type].length;i<l;i++){jQuery.event.add(dest,type,events[type][i])}}}}if(dataUser.hasData(src)){udataOld=dataUser.access(src);udataCur=jQuery.extend({},udataOld);dataUser.set(dest,udataCur)}}function fixInput(src,dest){var nodeName=dest.nodeName.toLowerCase();if(nodeName==="input"&&rcheckableType.test(src.type)){dest.checked=src.checked}else if(nodeName==="input"||nodeName==="textarea"){dest.defaultValue=src.defaultValue}}function domManip(collection,args,callback,ignored){args=concat.apply([],args);var fragment,first,scripts,hasScripts,node,doc,i=0,l=collection.length,iNoClone=l-1,value=args[0],valueIsFunction=isFunction(value);if(valueIsFunction||l>1&&typeof value==="string"&&!support.checkClone&&rchecked.test(value)){return collection.each(function(index){var self=collection.eq(index);if(valueIsFunction){args[0]=value.call(this,index,self.html())}domManip(self,args,callback,ignored)})}if(l){fragment=buildFragment(args,collection[0].ownerDocument,false,collection,ignored);first=fragment.firstChild;if(fragment.childNodes.length===1){fragment=first}if(first||ignored){scripts=jQuery.map(getAll(fragment,"script"),disableScript);hasScripts=scripts.length;for(;i<l;i++){node=fragment;if(i!==iNoClone){node=jQuery.clone(node,true,true);if(hasScripts){jQuery.merge(scripts,getAll(node,"script"))}}callback.call(collection[i],node,i)}if(hasScripts){doc=scripts[scripts.length-1].ownerDocument;jQuery.map(scripts,restoreScript);for(i=0;i<hasScripts;i++){node=scripts[i];if(rscriptType.test(node.type||"")&&!dataPriv.access(node,"globalEval")&&jQuery.contains(doc,node)){if(node.src&&(node.type||"").toLowerCase()!=="module"){if(jQuery._evalUrl){jQuery._evalUrl(node.src)}}else{DOMEval(node.textContent.replace(rcleanScript,""),doc,node)}}}}}}return collection}function remove(elem,selector,keepData){var node,nodes=selector?jQuery.filter(selector,elem):elem,i=0;for(;(node=nodes[i])!=null;i++){if(!keepData&&node.nodeType===1){jQuery.cleanData(getAll(node))}if(node.parentNode){if(keepData&&jQuery.contains(node.ownerDocument,node)){setGlobalEval(getAll(node,"script"))}node.parentNode.removeChild(node)}}return elem}jQuery.extend({htmlPrefilter:function(html){return html.replace(rxhtmlTag,"<$1></$2>")},clone:function(elem,dataAndEvents,deepDataAndEvents){var i,l,srcElements,destElements,clone=elem.cloneNode(true),inPage=jQuery.contains(elem.ownerDocument,elem);if(!support.noCloneChecked&&(elem.nodeType===1||elem.nodeType===11)&&!jQuery.isXMLDoc(elem)){destElements=getAll(clone);srcElements=getAll(elem);for(i=0,l=srcElements.length;i<l;i++){fixInput(srcElements[i],destElements[i])}}if(dataAndEvents){if(deepDataAndEvents){srcElements=srcElements||getAll(elem);destElements=destElements||getAll(clone);for(i=0,l=srcElements.length;i<l;i++){cloneCopyEvent(srcElements[i],destElements[i])}}else{cloneCopyEvent(elem,clone)}}destElements=getAll(clone,"script");if(destElements.length>0){setGlobalEval(destElements,!inPage&&getAll(elem,"script"))}return clone},cleanData:function(elems){var data,elem,type,special=jQuery.event.special,i=0;for(;(elem=elems[i])!==undefined;i++){if(acceptData(elem)){if(data=elem[dataPriv.expando]){if(data.events){for(type in data.events){if(special[type]){jQuery.event.remove(elem,type)}else{jQuery.removeEvent(elem,type,data.handle)}}}elem[dataPriv.expando]=undefined}if(elem[dataUser.expando]){elem[dataUser.expando]=undefined}}}}});jQuery.fn.extend({detach:function(selector){return remove(this,selector,true)},remove:function(selector){return remove(this,selector)},text:function(value){return access(this,function(value){return value===undefined?jQuery.text(this):this.empty().each(function(){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){this.textContent=value}})},null,value,arguments.length)},append:function(){return domManip(this,arguments,function(elem){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var target=manipulationTarget(this,elem);target.appendChild(elem)}})},prepend:function(){return domManip(this,arguments,function(elem){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var target=manipulationTarget(this,elem);target.insertBefore(elem,target.firstChild)}})},before:function(){return domManip(this,arguments,function(elem){if(this.parentNode){this.parentNode.insertBefore(elem,this)}})},after:function(){return domManip(this,arguments,function(elem){if(this.parentNode){this.parentNode.insertBefore(elem,this.nextSibling)}})},empty:function(){var elem,i=0;for(;(elem=this[i])!=null;i++){if(elem.nodeType===1){jQuery.cleanData(getAll(elem,false));elem.textContent=""}}return this},clone:function(dataAndEvents,deepDataAndEvents){dataAndEvents=dataAndEvents==null?false:dataAndEvents;deepDataAndEvents=deepDataAndEvents==null?dataAndEvents:deepDataAndEvents;return this.map(function(){return jQuery.clone(this,dataAndEvents,deepDataAndEvents)})},html:function(value){return access(this,function(value){var elem=this[0]||{},i=0,l=this.length;if(value===undefined&&elem.nodeType===1){return elem.innerHTML}if(typeof value==="string"&&!rnoInnerhtml.test(value)&&!wrapMap[(rtagName.exec(value)||["",""])[1].toLowerCase()]){value=jQuery.htmlPrefilter(value);try{for(;i<l;i++){elem=this[i]||{};if(elem.nodeType===1){jQuery.cleanData(getAll(elem,false));elem.innerHTML=value}}elem=0}catch(e){}}if(elem){this.empty().append(value)}},null,value,arguments.length)},replaceWith:function(){var ignored=[];return domManip(this,arguments,function(elem){var parent=this.parentNode;if(jQuery.inArray(this,ignored)<0){jQuery.cleanData(getAll(this));if(parent){parent.replaceChild(elem,this)}}},ignored)}});jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){jQuery.fn[name]=function(selector){var elems,ret=[],insert=jQuery(selector),last=insert.length-1,i=0;for(;i<=last;i++){elems=i===last?this:this.clone(true);jQuery(insert[i])[original](elems);push.apply(ret,elems.get())}return this.pushStack(ret)}});var rnumnonpx=new RegExp("^("+pnum+")(?!px)[a-z%]+$","i");var getStyles=function(elem){var view=elem.ownerDocument.defaultView;if(!view||!view.opener){view=window}return view.getComputedStyle(elem)};var rboxStyle=new RegExp(cssExpand.join("|"),"i");(function(){function computeStyleTests(){if(!div){return}container.style.cssText="position:absolute;left:-11111px;width:60px;"+"margin-top:1px;padding:0;border:0";div.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;"+"margin:auto;border:1px;padding:1px;"+"width:60%;top:1%";documentElement.appendChild(container).appendChild(div);var divStyle=window.getComputedStyle(div);pixelPositionVal=divStyle.top!=="1%";reliableMarginLeftVal=roundPixelMeasures(divStyle.marginLeft)===12;div.style.right="60%";pixelBoxStylesVal=roundPixelMeasures(divStyle.right)===36;boxSizingReliableVal=roundPixelMeasures(divStyle.width)===36;div.style.position="absolute";scrollboxSizeVal=div.offsetWidth===36||"absolute";documentElement.removeChild(container);div=null}function roundPixelMeasures(measure){return Math.round(parseFloat(measure))}var pixelPositionVal,boxSizingReliableVal,scrollboxSizeVal,pixelBoxStylesVal,reliableMarginLeftVal,container=document.createElement("div"),div=document.createElement("div");if(!div.style){return}div.style.backgroundClip="content-box";div.cloneNode(true).style.backgroundClip="";support.clearCloneStyle=div.style.backgroundClip==="content-box";jQuery.extend(support,{boxSizingReliable:function(){computeStyleTests();return boxSizingReliableVal},pixelBoxStyles:function(){computeStyleTests();return pixelBoxStylesVal},pixelPosition:function(){computeStyleTests();return pixelPositionVal},reliableMarginLeft:function(){computeStyleTests();return reliableMarginLeftVal},scrollboxSize:function(){computeStyleTests();return scrollboxSizeVal}})})();function curCSS(elem,name,computed){var width,minWidth,maxWidth,ret,style=elem.style;computed=computed||getStyles(elem);if(computed){ret=computed.getPropertyValue(name)||computed[name];if(ret===""&&!jQuery.contains(elem.ownerDocument,elem)){ret=jQuery.style(elem,name)}if(!support.pixelBoxStyles()&&rnumnonpx.test(ret)&&rboxStyle.test(name)){width=style.width;minWidth=style.minWidth;maxWidth=style.maxWidth;style.minWidth=style.maxWidth=style.width=ret;ret=computed.width;style.width=width;style.minWidth=minWidth;style.maxWidth=maxWidth}}return ret!==undefined?ret+"":ret}function addGetHookIf(conditionFn,hookFn){return{get:function(){if(conditionFn()){delete this.get;return}return(this.get=hookFn).apply(this,arguments)}}}var rdisplayswap=/^(none|table(?!-c[ea]).+)/,rcustomProp=/^--/,cssShow={position:"absolute",visibility:"hidden",display:"block"},cssNormalTransform={letterSpacing:"0",fontWeight:"400"},cssPrefixes=["Webkit","Moz","ms"],emptyStyle=document.createElement("div").style;function vendorPropName(name){if(name in emptyStyle){return name}var capName=name[0].toUpperCase()+name.slice(1),i=cssPrefixes.length;while(i--){name=cssPrefixes[i]+capName;if(name in emptyStyle){return name}}}function finalPropName(name){var ret=jQuery.cssProps[name];if(!ret){ret=jQuery.cssProps[name]=vendorPropName(name)||name}return ret}function setPositiveNumber(elem,value,subtract){var matches=rcssNum.exec(value);return matches?Math.max(0,matches[2]-(subtract||0))+(matches[3]||"px"):value}function boxModelAdjustment(elem,dimension,box,isBorderBox,styles,computedVal){var i=dimension==="width"?1:0,extra=0,delta=0;if(box===(isBorderBox?"border":"content")){return 0}for(;i<4;i+=2){if(box==="margin"){delta+=jQuery.css(elem,box+cssExpand[i],true,styles)}if(!isBorderBox){delta+=jQuery.css(elem,"padding"+cssExpand[i],true,styles);if(box!=="padding"){delta+=jQuery.css(elem,"border"+cssExpand[i]+"Width",true,styles)}else{extra+=jQuery.css(elem,"border"+cssExpand[i]+"Width",true,styles)}}else{if(box==="content"){delta-=jQuery.css(elem,"padding"+cssExpand[i],true,styles)}if(box!=="margin"){delta-=jQuery.css(elem,"border"+cssExpand[i]+"Width",true,styles)}}}if(!isBorderBox&&computedVal>=0){delta+=Math.max(0,Math.ceil(elem["offset"+dimension[0].toUpperCase()+dimension.slice(1)]-computedVal-delta-extra-.5))}return delta}function getWidthOrHeight(elem,dimension,extra){var styles=getStyles(elem),val=curCSS(elem,dimension,styles),isBorderBox=jQuery.css(elem,"boxSizing",false,styles)==="border-box",valueIsBorderBox=isBorderBox;if(rnumnonpx.test(val)){if(!extra){return val}val="auto"}valueIsBorderBox=valueIsBorderBox&&(support.boxSizingReliable()||val===elem.style[dimension]);if(val==="auto"||!parseFloat(val)&&jQuery.css(elem,"display",false,styles)==="inline"){val=elem["offset"+dimension[0].toUpperCase()+dimension.slice(1)];valueIsBorderBox=true}val=parseFloat(val)||0;return val+boxModelAdjustment(elem,dimension,extra||(isBorderBox?"border":"content"),valueIsBorderBox,styles,val)+"px"}jQuery.extend({cssHooks:{opacity:{get:function(elem,computed){if(computed){var ret=curCSS(elem,"opacity");return ret===""?"1":ret}}}},cssNumber:{animationIterationCount:true,columnCount:true,fillOpacity:true,flexGrow:true,flexShrink:true,fontWeight:true,lineHeight:true,opacity:true,order:true,orphans:true,widows:true,zIndex:true,zoom:true},cssProps:{},style:function(elem,name,value,extra){if(!elem||elem.nodeType===3||elem.nodeType===8||!elem.style){return}var ret,type,hooks,origName=camelCase(name),isCustomProp=rcustomProp.test(name),style=elem.style;if(!isCustomProp){name=finalPropName(origName)}hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(value!==undefined){type=typeof value;if(type==="string"&&(ret=rcssNum.exec(value))&&ret[1]){value=adjustCSS(elem,name,ret);type="number"}if(value==null||value!==value){return}if(type==="number"){value+=ret&&ret[3]||(jQuery.cssNumber[origName]?"":"px")}if(!support.clearCloneStyle&&value===""&&name.indexOf("background")===0){style[name]="inherit"}if(!hooks||!("set"in hooks)||(value=hooks.set(elem,value,extra))!==undefined){if(isCustomProp){style.setProperty(name,value)}else{style[name]=value}}}else{if(hooks&&"get"in hooks&&(ret=hooks.get(elem,false,extra))!==undefined){return ret}return style[name]}},css:function(elem,name,extra,styles){var val,num,hooks,origName=camelCase(name),isCustomProp=rcustomProp.test(name);if(!isCustomProp){name=finalPropName(origName)}hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(hooks&&"get"in hooks){val=hooks.get(elem,true,extra)}if(val===undefined){val=curCSS(elem,name,styles)}if(val==="normal"&&name in cssNormalTransform){val=cssNormalTransform[name]}if(extra===""||extra){num=parseFloat(val);return extra===true||isFinite(num)?num||0:val}return val}});jQuery.each(["height","width"],function(i,dimension){jQuery.cssHooks[dimension]={get:function(elem,computed,extra){if(computed){return rdisplayswap.test(jQuery.css(elem,"display"))&&(!elem.getClientRects().length||!elem.getBoundingClientRect().width)?swap(elem,cssShow,function(){return getWidthOrHeight(elem,dimension,extra)}):getWidthOrHeight(elem,dimension,extra)}},set:function(elem,value,extra){var matches,styles=getStyles(elem),isBorderBox=jQuery.css(elem,"boxSizing",false,styles)==="border-box",subtract=extra&&boxModelAdjustment(elem,dimension,extra,isBorderBox,styles);if(isBorderBox&&support.scrollboxSize()===styles.position){subtract-=Math.ceil(elem["offset"+dimension[0].toUpperCase()+dimension.slice(1)]-parseFloat(styles[dimension])-boxModelAdjustment(elem,dimension,"border",false,styles)-.5)}if(subtract&&(matches=rcssNum.exec(value))&&(matches[3]||"px")!=="px"){elem.style[dimension]=value;value=jQuery.css(elem,dimension)}return setPositiveNumber(elem,value,subtract)}}});jQuery.cssHooks.marginLeft=addGetHookIf(support.reliableMarginLeft,function(elem,computed){if(computed){return(parseFloat(curCSS(elem,"marginLeft"))||elem.getBoundingClientRect().left-swap(elem,{marginLeft:0},function(){return elem.getBoundingClientRect().left}))+"px"}});jQuery.each({margin:"",padding:"",border:"Width"},function(prefix,suffix){jQuery.cssHooks[prefix+suffix]={expand:function(value){var i=0,expanded={},parts=typeof value==="string"?value.split(" "):[value];for(;i<4;i++){expanded[prefix+cssExpand[i]+suffix]=parts[i]||parts[i-2]||parts[0]}return expanded}};if(prefix!=="margin"){jQuery.cssHooks[prefix+suffix].set=setPositiveNumber}});jQuery.fn.extend({css:function(name,value){return access(this,function(elem,name,value){var styles,len,map={},i=0;if(Array.isArray(name)){styles=getStyles(elem);len=name.length;for(;i<len;i++){map[name[i]]=jQuery.css(elem,name[i],false,styles)}return map}return value!==undefined?jQuery.style(elem,name,value):jQuery.css(elem,name)},name,value,arguments.length>1)}});function Tween(elem,options,prop,end,easing){return new Tween.prototype.init(elem,options,prop,end,easing)}jQuery.Tween=Tween;Tween.prototype={constructor:Tween,init:function(elem,options,prop,end,easing,unit){this.elem=elem;this.prop=prop;this.easing=easing||jQuery.easing._default;this.options=options;this.start=this.now=this.cur();this.end=end;this.unit=unit||(jQuery.cssNumber[prop]?"":"px")},cur:function(){var hooks=Tween.propHooks[this.prop];return hooks&&hooks.get?hooks.get(this):Tween.propHooks._default.get(this)},run:function(percent){var eased,hooks=Tween.propHooks[this.prop];if(this.options.duration){this.pos=eased=jQuery.easing[this.easing](percent,this.options.duration*percent,0,1,this.options.duration)}else{this.pos=eased=percent}this.now=(this.end-this.start)*eased+this.start;if(this.options.step){this.options.step.call(this.elem,this.now,this)}if(hooks&&hooks.set){hooks.set(this)}else{Tween.propHooks._default.set(this)}return this}};Tween.prototype.init.prototype=Tween.prototype;Tween.propHooks={_default:{get:function(tween){var result;if(tween.elem.nodeType!==1||tween.elem[tween.prop]!=null&&tween.elem.style[tween.prop]==null){return tween.elem[tween.prop]}result=jQuery.css(tween.elem,tween.prop,"");return!result||result==="auto"?0:result},set:function(tween){if(jQuery.fx.step[tween.prop]){jQuery.fx.step[tween.prop](tween)}else if(tween.elem.nodeType===1&&(tween.elem.style[jQuery.cssProps[tween.prop]]!=null||jQuery.cssHooks[tween.prop])){jQuery.style(tween.elem,tween.prop,tween.now+tween.unit)}else{tween.elem[tween.prop]=tween.now}}}};Tween.propHooks.scrollTop=Tween.propHooks.scrollLeft={set:function(tween){if(tween.elem.nodeType&&tween.elem.parentNode){tween.elem[tween.prop]=tween.now}}};jQuery.easing={linear:function(p){return p},swing:function(p){return.5-Math.cos(p*Math.PI)/2},_default:"swing"};jQuery.fx=Tween.prototype.init;jQuery.fx.step={};var fxNow,inProgress,rfxtypes=/^(?:toggle|show|hide)$/,rrun=/queueHooks$/;function schedule(){if(inProgress){if(document.hidden===false&&window.requestAnimationFrame){window.requestAnimationFrame(schedule)}else{window.setTimeout(schedule,jQuery.fx.interval)}jQuery.fx.tick()}}function createFxNow(){window.setTimeout(function(){fxNow=undefined});return fxNow=Date.now()}function genFx(type,includeWidth){var which,i=0,attrs={height:type};includeWidth=includeWidth?1:0;for(;i<4;i+=2-includeWidth){which=cssExpand[i];attrs["margin"+which]=attrs["padding"+which]=type}if(includeWidth){attrs.opacity=attrs.width=type}return attrs}function createTween(value,prop,animation){var tween,collection=(Animation.tweeners[prop]||[]).concat(Animation.tweeners["*"]),index=0,length=collection.length;for(;index<length;index++){if(tween=collection[index].call(animation,prop,value)){return tween}}}function defaultPrefilter(elem,props,opts){var prop,value,toggle,hooks,oldfire,propTween,restoreDisplay,display,isBox="width"in props||"height"in props,anim=this,orig={},style=elem.style,hidden=elem.nodeType&&isHiddenWithinTree(elem),dataShow=dataPriv.get(elem,"fxshow");if(!opts.queue){hooks=jQuery._queueHooks(elem,"fx");if(hooks.unqueued==null){hooks.unqueued=0;oldfire=hooks.empty.fire;hooks.empty.fire=function(){if(!hooks.unqueued){oldfire()}}}hooks.unqueued++;anim.always(function(){anim.always(function(){hooks.unqueued--;if(!jQuery.queue(elem,"fx").length){hooks.empty.fire()}})})}for(prop in props){value=props[prop];if(rfxtypes.test(value)){delete props[prop];toggle=toggle||value==="toggle";if(value===(hidden?"hide":"show")){if(value==="show"&&dataShow&&dataShow[prop]!==undefined){hidden=true}else{continue}}orig[prop]=dataShow&&dataShow[prop]||jQuery.style(elem,prop)}}propTween=!jQuery.isEmptyObject(props);if(!propTween&&jQuery.isEmptyObject(orig)){return}if(isBox&&elem.nodeType===1){opts.overflow=[style.overflow,style.overflowX,style.overflowY];restoreDisplay=dataShow&&dataShow.display;if(restoreDisplay==null){restoreDisplay=dataPriv.get(elem,"display")}display=jQuery.css(elem,"display");if(display==="none"){if(restoreDisplay){display=restoreDisplay}else{showHide([elem],true);restoreDisplay=elem.style.display||restoreDisplay;display=jQuery.css(elem,"display");showHide([elem])}}if(display==="inline"||display==="inline-block"&&restoreDisplay!=null){if(jQuery.css(elem,"float")==="none"){if(!propTween){anim.done(function(){style.display=restoreDisplay});if(restoreDisplay==null){display=style.display;restoreDisplay=display==="none"?"":display}}style.display="inline-block"}}}if(opts.overflow){style.overflow="hidden";anim.always(function(){style.overflow=opts.overflow[0];style.overflowX=opts.overflow[1];style.overflowY=opts.overflow[2]})}propTween=false;for(prop in orig){if(!propTween){if(dataShow){if("hidden"in dataShow){hidden=dataShow.hidden}}else{dataShow=dataPriv.access(elem,"fxshow",{display:restoreDisplay})}if(toggle){dataShow.hidden=!hidden}if(hidden){showHide([elem],true)}anim.done(function(){if(!hidden){showHide([elem])}dataPriv.remove(elem,"fxshow");for(prop in orig){jQuery.style(elem,prop,orig[prop])}})}propTween=createTween(hidden?dataShow[prop]:0,prop,anim);if(!(prop in dataShow)){dataShow[prop]=propTween.start;if(hidden){propTween.end=propTween.start;propTween.start=0}}}}function propFilter(props,specialEasing){var index,name,easing,value,hooks;for(index in props){name=camelCase(index);easing=specialEasing[name];value=props[index];if(Array.isArray(value)){easing=value[1];value=props[index]=value[0]}if(index!==name){props[name]=value;delete props[index]}hooks=jQuery.cssHooks[name];if(hooks&&"expand"in hooks){value=hooks.expand(value);delete props[name];for(index in value){if(!(index in props)){props[index]=value[index];specialEasing[index]=easing}}}else{specialEasing[name]=easing}}}function Animation(elem,properties,options){var result,stopped,index=0,length=Animation.prefilters.length,deferred=jQuery.Deferred().always(function(){delete tick.elem}),tick=function(){if(stopped){return false}var currentTime=fxNow||createFxNow(),remaining=Math.max(0,animation.startTime+animation.duration-currentTime),temp=remaining/animation.duration||0,percent=1-temp,index=0,length=animation.tweens.length;for(;index<length;index++){animation.tweens[index].run(percent)}deferred.notifyWith(elem,[animation,percent,remaining]);if(percent<1&&length){return remaining}if(!length){deferred.notifyWith(elem,[animation,1,0])}deferred.resolveWith(elem,[animation]);return false},animation=deferred.promise({elem:elem,props:jQuery.extend({},properties),opts:jQuery.extend(true,{specialEasing:{},easing:jQuery.easing._default},options),originalProperties:properties,originalOptions:options,startTime:fxNow||createFxNow(),duration:options.duration,tweens:[],createTween:function(prop,end){var tween=jQuery.Tween(elem,animation.opts,prop,end,animation.opts.specialEasing[prop]||animation.opts.easing);animation.tweens.push(tween);return tween},stop:function(gotoEnd){var index=0,length=gotoEnd?animation.tweens.length:0;if(stopped){return this}stopped=true;for(;index<length;index++){animation.tweens[index].run(1)}if(gotoEnd){deferred.notifyWith(elem,[animation,1,0]);deferred.resolveWith(elem,[animation,gotoEnd])}else{deferred.rejectWith(elem,[animation,gotoEnd])}return this}}),props=animation.props;propFilter(props,animation.opts.specialEasing);for(;index<length;index++){result=Animation.prefilters[index].call(animation,elem,props,animation.opts);if(result){if(isFunction(result.stop)){jQuery._queueHooks(animation.elem,animation.opts.queue).stop=result.stop.bind(result)}return result}}jQuery.map(props,createTween,animation);if(isFunction(animation.opts.start)){animation.opts.start.call(elem,animation)}animation.progress(animation.opts.progress).done(animation.opts.done,animation.opts.complete).fail(animation.opts.fail).always(animation.opts.always);jQuery.fx.timer(jQuery.extend(tick,{elem:elem,anim:animation,queue:animation.opts.queue}));return animation}jQuery.Animation=jQuery.extend(Animation,{tweeners:{"*":[function(prop,value){var tween=this.createTween(prop,value);adjustCSS(tween.elem,prop,rcssNum.exec(value),tween);return tween}]},tweener:function(props,callback){if(isFunction(props)){callback=props;props=["*"]}else{props=props.match(rnothtmlwhite)}var prop,index=0,length=props.length;for(;index<length;index++){prop=props[index];Animation.tweeners[prop]=Animation.tweeners[prop]||[];Animation.tweeners[prop].unshift(callback)}},prefilters:[defaultPrefilter],prefilter:function(callback,prepend){if(prepend){Animation.prefilters.unshift(callback)}else{Animation.prefilters.push(callback)}}});jQuery.speed=function(speed,easing,fn){var opt=speed&&typeof speed==="object"?jQuery.extend({},speed):{complete:fn||!fn&&easing||isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&!isFunction(easing)&&easing};if(jQuery.fx.off){opt.duration=0}else{if(typeof opt.duration!=="number"){if(opt.duration in jQuery.fx.speeds){opt.duration=jQuery.fx.speeds[opt.duration]}else{opt.duration=jQuery.fx.speeds._default}}}if(opt.queue==null||opt.queue===true){opt.queue="fx"}opt.old=opt.complete;opt.complete=function(){if(isFunction(opt.old)){opt.old.call(this)}if(opt.queue){jQuery.dequeue(this,opt.queue)}};return opt};jQuery.fn.extend({fadeTo:function(speed,to,easing,callback){return this.filter(isHiddenWithinTree).css("opacity",0).show().end().animate({opacity:to},speed,easing,callback)},animate:function(prop,speed,easing,callback){var empty=jQuery.isEmptyObject(prop),optall=jQuery.speed(speed,easing,callback),doAnimation=function(){var anim=Animation(this,jQuery.extend({},prop),optall);if(empty||dataPriv.get(this,"finish")){anim.stop(true)}};doAnimation.finish=doAnimation;return empty||optall.queue===false?this.each(doAnimation):this.queue(optall.queue,doAnimation)},stop:function(type,clearQueue,gotoEnd){var stopQueue=function(hooks){var stop=hooks.stop;delete hooks.stop;stop(gotoEnd)};if(typeof type!=="string"){gotoEnd=clearQueue;clearQueue=type;type=undefined}if(clearQueue&&type!==false){this.queue(type||"fx",[])}return this.each(function(){var dequeue=true,index=type!=null&&type+"queueHooks",timers=jQuery.timers,data=dataPriv.get(this);if(index){if(data[index]&&data[index].stop){stopQueue(data[index])}}else{for(index in data){if(data[index]&&data[index].stop&&rrun.test(index)){stopQueue(data[index])}}}for(index=timers.length;index--;){if(timers[index].elem===this&&(type==null||timers[index].queue===type)){timers[index].anim.stop(gotoEnd);dequeue=false;timers.splice(index,1)}}if(dequeue||!gotoEnd){jQuery.dequeue(this,type)}})},finish:function(type){if(type!==false){type=type||"fx"}return this.each(function(){var index,data=dataPriv.get(this),queue=data[type+"queue"],hooks=data[type+"queueHooks"],timers=jQuery.timers,length=queue?queue.length:0;data.finish=true;jQuery.queue(this,type,[]);if(hooks&&hooks.stop){hooks.stop.call(this,true)}for(index=timers.length;index--;){if(timers[index].elem===this&&timers[index].queue===type){timers[index].anim.stop(true);timers.splice(index,1)}}for(index=0;index<length;index++){if(queue[index]&&queue[index].finish){queue[index].finish.call(this)}}delete data.finish})}});jQuery.each(["toggle","show","hide"],function(i,name){var cssFn=jQuery.fn[name];jQuery.fn[name]=function(speed,easing,callback){return speed==null||typeof speed==="boolean"?cssFn.apply(this,arguments):this.animate(genFx(name,true),speed,easing,callback)}});jQuery.each({slideDown:genFx("show"),slideUp:genFx("hide"),slideToggle:genFx("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(name,props){jQuery.fn[name]=function(speed,easing,callback){return this.animate(props,speed,easing,callback)}});jQuery.timers=[];jQuery.fx.tick=function(){var timer,i=0,timers=jQuery.timers;fxNow=Date.now();for(;i<timers.length;i++){timer=timers[i];if(!timer()&&timers[i]===timer){timers.splice(i--,1)}}if(!timers.length){jQuery.fx.stop()}fxNow=undefined};jQuery.fx.timer=function(timer){jQuery.timers.push(timer);jQuery.fx.start()};jQuery.fx.interval=13;jQuery.fx.start=function(){if(inProgress){return}inProgress=true;schedule()};jQuery.fx.stop=function(){inProgress=null};jQuery.fx.speeds={slow:600,fast:200,_default:400};jQuery.fn.delay=function(time,type){time=jQuery.fx?jQuery.fx.speeds[time]||time:time;type=type||"fx";return this.queue(type,function(next,hooks){var timeout=window.setTimeout(next,time);hooks.stop=function(){window.clearTimeout(timeout)}})};(function(){var input=document.createElement("input"),select=document.createElement("select"),opt=select.appendChild(document.createElement("option"));input.type="checkbox";support.checkOn=input.value!=="";support.optSelected=opt.selected;input=document.createElement("input");input.value="t";input.type="radio";support.radioValue=input.value==="t"})();var boolHook,attrHandle=jQuery.expr.attrHandle;jQuery.fn.extend({attr:function(name,value){return access(this,jQuery.attr,name,value,arguments.length>1)},removeAttr:function(name){return this.each(function(){jQuery.removeAttr(this,name)})}});jQuery.extend({attr:function(elem,name,value){var ret,hooks,nType=elem.nodeType;if(nType===3||nType===8||nType===2){return}if(typeof elem.getAttribute==="undefined"){return jQuery.prop(elem,name,value)}if(nType!==1||!jQuery.isXMLDoc(elem)){hooks=jQuery.attrHooks[name.toLowerCase()]||(jQuery.expr.match.bool.test(name)?boolHook:undefined)}if(value!==undefined){if(value===null){jQuery.removeAttr(elem,name);return}if(hooks&&"set"in hooks&&(ret=hooks.set(elem,value,name))!==undefined){return ret}elem.setAttribute(name,value+"");return value}if(hooks&&"get"in hooks&&(ret=hooks.get(elem,name))!==null){return ret}ret=jQuery.find.attr(elem,name);return ret==null?undefined:ret},attrHooks:{type:{set:function(elem,value){if(!support.radioValue&&value==="radio"&&nodeName(elem,"input")){var val=elem.value;elem.setAttribute("type",value);if(val){elem.value=val}return value}}}},removeAttr:function(elem,value){var name,i=0,attrNames=value&&value.match(rnothtmlwhite);if(attrNames&&elem.nodeType===1){while(name=attrNames[i++]){elem.removeAttribute(name)}}}});boolHook={set:function(elem,value,name){if(value===false){jQuery.removeAttr(elem,name)}else{elem.setAttribute(name,name)}return name}};jQuery.each(jQuery.expr.match.bool.source.match(/\w+/g),function(i,name){var getter=attrHandle[name]||jQuery.find.attr;attrHandle[name]=function(elem,name,isXML){var ret,handle,lowercaseName=name.toLowerCase();if(!isXML){handle=attrHandle[lowercaseName];attrHandle[lowercaseName]=ret;ret=getter(elem,name,isXML)!=null?lowercaseName:null;attrHandle[lowercaseName]=handle}return ret}});var rfocusable=/^(?:input|select|textarea|button)$/i,rclickable=/^(?:a|area)$/i;jQuery.fn.extend({prop:function(name,value){return access(this,jQuery.prop,name,value,arguments.length>1)},removeProp:function(name){return this.each(function(){delete this[jQuery.propFix[name]||name]})}});jQuery.extend({prop:function(elem,name,value){var ret,hooks,nType=elem.nodeType;if(nType===3||nType===8||nType===2){return}if(nType!==1||!jQuery.isXMLDoc(elem)){name=jQuery.propFix[name]||name;hooks=jQuery.propHooks[name]}if(value!==undefined){if(hooks&&"set"in hooks&&(ret=hooks.set(elem,value,name))!==undefined){return ret}return elem[name]=value}if(hooks&&"get"in hooks&&(ret=hooks.get(elem,name))!==null){return ret}return elem[name]},propHooks:{tabIndex:{get:function(elem){var tabindex=jQuery.find.attr(elem,"tabindex");if(tabindex){return parseInt(tabindex,10)}if(rfocusable.test(elem.nodeName)||rclickable.test(elem.nodeName)&&elem.href){return 0}return-1}}},propFix:{for:"htmlFor",class:"className"}});if(!support.optSelected){jQuery.propHooks.selected={get:function(elem){var parent=elem.parentNode;if(parent&&parent.parentNode){parent.parentNode.selectedIndex}return null},set:function(elem){var parent=elem.parentNode;if(parent){parent.selectedIndex;if(parent.parentNode){parent.parentNode.selectedIndex}}}}}jQuery.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){jQuery.propFix[this.toLowerCase()]=this});function stripAndCollapse(value){var tokens=value.match(rnothtmlwhite)||[];return tokens.join(" ")}function getClass(elem){return elem.getAttribute&&elem.getAttribute("class")||""}function classesToArray(value){if(Array.isArray(value)){return value}if(typeof value==="string"){return value.match(rnothtmlwhite)||[]}return[]}jQuery.fn.extend({addClass:function(value){var classes,elem,cur,curValue,clazz,j,finalValue,i=0;if(isFunction(value)){return this.each(function(j){jQuery(this).addClass(value.call(this,j,getClass(this)))})}classes=classesToArray(value);if(classes.length){while(elem=this[i++]){curValue=getClass(elem);cur=elem.nodeType===1&&" "+stripAndCollapse(curValue)+" ";if(cur){j=0;while(clazz=classes[j++]){if(cur.indexOf(" "+clazz+" ")<0){cur+=clazz+" "}}finalValue=stripAndCollapse(cur);if(curValue!==finalValue){elem.setAttribute("class",finalValue)}}}}return this},removeClass:function(value){var classes,elem,cur,curValue,clazz,j,finalValue,i=0;if(isFunction(value)){return this.each(function(j){jQuery(this).removeClass(value.call(this,j,getClass(this)))})}if(!arguments.length){return this.attr("class","")}classes=classesToArray(value);if(classes.length){while(elem=this[i++]){curValue=getClass(elem);cur=elem.nodeType===1&&" "+stripAndCollapse(curValue)+" ";if(cur){j=0;while(clazz=classes[j++]){while(cur.indexOf(" "+clazz+" ")>-1){cur=cur.replace(" "+clazz+" "," ")}}finalValue=stripAndCollapse(cur);if(curValue!==finalValue){elem.setAttribute("class",finalValue)}}}}return this},toggleClass:function(value,stateVal){var type=typeof value,isValidValue=type==="string"||Array.isArray(value);if(typeof stateVal==="boolean"&&isValidValue){return stateVal?this.addClass(value):this.removeClass(value)}if(isFunction(value)){return this.each(function(i){jQuery(this).toggleClass(value.call(this,i,getClass(this),stateVal),stateVal)})}return this.each(function(){var className,i,self,classNames;if(isValidValue){i=0;self=jQuery(this);classNames=classesToArray(value);while(className=classNames[i++]){if(self.hasClass(className)){self.removeClass(className)}else{self.addClass(className)}}}else if(value===undefined||type==="boolean"){className=getClass(this);if(className){dataPriv.set(this,"__className__",className)}if(this.setAttribute){this.setAttribute("class",className||value===false?"":dataPriv.get(this,"__className__")||"")}}})},hasClass:function(selector){var className,elem,i=0;className=" "+selector+" ";while(elem=this[i++]){if(elem.nodeType===1&&(" "+stripAndCollapse(getClass(elem))+" ").indexOf(className)>-1){return true}}return false}});var rreturn=/\r/g;jQuery.fn.extend({val:function(value){var hooks,ret,valueIsFunction,elem=this[0];if(!arguments.length){if(elem){hooks=jQuery.valHooks[elem.type]||jQuery.valHooks[elem.nodeName.toLowerCase()];if(hooks&&"get"in hooks&&(ret=hooks.get(elem,"value"))!==undefined){return ret}ret=elem.value;if(typeof ret==="string"){return ret.replace(rreturn,"")}return ret==null?"":ret}return}valueIsFunction=isFunction(value);return this.each(function(i){var val;if(this.nodeType!==1){return}if(valueIsFunction){val=value.call(this,i,jQuery(this).val())}else{val=value}if(val==null){val=""}else if(typeof val==="number"){val+=""}else if(Array.isArray(val)){val=jQuery.map(val,function(value){return value==null?"":value+""})}hooks=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()];if(!hooks||!("set"in hooks)||hooks.set(this,val,"value")===undefined){this.value=val}})}});jQuery.extend({valHooks:{option:{get:function(elem){var val=jQuery.find.attr(elem,"value");return val!=null?val:stripAndCollapse(jQuery.text(elem))}},select:{get:function(elem){var value,option,i,options=elem.options,index=elem.selectedIndex,one=elem.type==="select-one",values=one?null:[],max=one?index+1:options.length;if(index<0){i=max}else{i=one?index:0}for(;i<max;i++){option=options[i];if((option.selected||i===index)&&!option.disabled&&(!option.parentNode.disabled||!nodeName(option.parentNode,"optgroup"))){value=jQuery(option).val();if(one){return value}values.push(value)}}return values},set:function(elem,value){var optionSet,option,options=elem.options,values=jQuery.makeArray(value),i=options.length;while(i--){option=options[i];if(option.selected=jQuery.inArray(jQuery.valHooks.option.get(option),values)>-1){optionSet=true}}if(!optionSet){elem.selectedIndex=-1}return values}}}});jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={set:function(elem,value){if(Array.isArray(value)){return elem.checked=jQuery.inArray(jQuery(elem).val(),value)>-1}}};if(!support.checkOn){jQuery.valHooks[this].get=function(elem){return elem.getAttribute("value")===null?"on":elem.value}}});support.focusin="onfocusin"in window;var rfocusMorph=/^(?:focusinfocus|focusoutblur)$/,stopPropagationCallback=function(e){e.stopPropagation()};jQuery.extend(jQuery.event,{trigger:function(event,data,elem,onlyHandlers){var i,cur,tmp,bubbleType,ontype,handle,special,lastElement,eventPath=[elem||document],type=hasOwn.call(event,"type")?event.type:event,namespaces=hasOwn.call(event,"namespace")?event.namespace.split("."):[];cur=lastElement=tmp=elem=elem||document;if(elem.nodeType===3||elem.nodeType===8){return}if(rfocusMorph.test(type+jQuery.event.triggered)){return}if(type.indexOf(".")>-1){namespaces=type.split(".");type=namespaces.shift();namespaces.sort()}ontype=type.indexOf(":")<0&&"on"+type;event=event[jQuery.expando]?event:new jQuery.Event(type,typeof event==="object"&&event);event.isTrigger=onlyHandlers?2:3;event.namespace=namespaces.join(".");event.rnamespace=event.namespace?new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"):null;event.result=undefined;if(!event.target){event.target=elem}data=data==null?[event]:jQuery.makeArray(data,[event]);special=jQuery.event.special[type]||{};if(!onlyHandlers&&special.trigger&&special.trigger.apply(elem,data)===false){return}if(!onlyHandlers&&!special.noBubble&&!isWindow(elem)){bubbleType=special.delegateType||type;if(!rfocusMorph.test(bubbleType+type)){cur=cur.parentNode}for(;cur;cur=cur.parentNode){eventPath.push(cur);tmp=cur}if(tmp===(elem.ownerDocument||document)){eventPath.push(tmp.defaultView||tmp.parentWindow||window)}}i=0;while((cur=eventPath[i++])&&!event.isPropagationStopped()){lastElement=cur;event.type=i>1?bubbleType:special.bindType||type;handle=(dataPriv.get(cur,"events")||{})[event.type]&&dataPriv.get(cur,"handle");if(handle){handle.apply(cur,data)}handle=ontype&&cur[ontype];if(handle&&handle.apply&&acceptData(cur)){event.result=handle.apply(cur,data);if(event.result===false){event.preventDefault()}}}event.type=type;if(!onlyHandlers&&!event.isDefaultPrevented()){if((!special._default||special._default.apply(eventPath.pop(),data)===false)&&acceptData(elem)){if(ontype&&isFunction(elem[type])&&!isWindow(elem)){tmp=elem[ontype];if(tmp){elem[ontype]=null}jQuery.event.triggered=type;if(event.isPropagationStopped()){lastElement.addEventListener(type,stopPropagationCallback)}elem[type]();if(event.isPropagationStopped()){lastElement.removeEventListener(type,stopPropagationCallback)}jQuery.event.triggered=undefined;if(tmp){elem[ontype]=tmp}}}}return event.result},simulate:function(type,elem,event){var e=jQuery.extend(new jQuery.Event,event,{type:type,isSimulated:true});jQuery.event.trigger(e,null,elem)}});jQuery.fn.extend({trigger:function(type,data){return this.each(function(){jQuery.event.trigger(type,data,this)})},triggerHandler:function(type,data){var elem=this[0];if(elem){return jQuery.event.trigger(type,data,elem,true)}}});if(!support.focusin){jQuery.each({focus:"focusin",blur:"focusout"},function(orig,fix){var handler=function(event){jQuery.event.simulate(fix,event.target,jQuery.event.fix(event))};jQuery.event.special[fix]={setup:function(){var doc=this.ownerDocument||this,attaches=dataPriv.access(doc,fix);if(!attaches){doc.addEventListener(orig,handler,true)}dataPriv.access(doc,fix,(attaches||0)+1)},teardown:function(){var doc=this.ownerDocument||this,attaches=dataPriv.access(doc,fix)-1;if(!attaches){doc.removeEventListener(orig,handler,true);dataPriv.remove(doc,fix)}else{dataPriv.access(doc,fix,attaches)}}}})}var location=window.location;var nonce=Date.now();var rquery=/\?/;jQuery.parseXML=function(data){var xml;if(!data||typeof data!=="string"){return null}try{xml=(new window.DOMParser).parseFromString(data,"text/xml")}catch(e){xml=undefined}if(!xml||xml.getElementsByTagName("parsererror").length){jQuery.error("Invalid XML: "+data)}return xml};var rbracket=/\[\]$/,rCRLF=/\r?\n/g,rsubmitterTypes=/^(?:submit|button|image|reset|file)$/i,rsubmittable=/^(?:input|select|textarea|keygen)/i;function buildParams(prefix,obj,traditional,add){var name;if(Array.isArray(obj)){jQuery.each(obj,function(i,v){if(traditional||rbracket.test(prefix)){add(prefix,v)}else{buildParams(prefix+"["+(typeof v==="object"&&v!=null?i:"")+"]",v,traditional,add)}})}else if(!traditional&&toType(obj)==="object"){for(name in obj){buildParams(prefix+"["+name+"]",obj[name],traditional,add)}}else{add(prefix,obj)}}jQuery.param=function(a,traditional){var prefix,s=[],add=function(key,valueOrFunction){var value=isFunction(valueOrFunction)?valueOrFunction():valueOrFunction;s[s.length]=encodeURIComponent(key)+"="+encodeURIComponent(value==null?"":value)};if(Array.isArray(a)||a.jquery&&!jQuery.isPlainObject(a)){jQuery.each(a,function(){add(this.name,this.value)})}else{for(prefix in a){buildParams(prefix,a[prefix],traditional,add)}}return s.join("&")};jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var elements=jQuery.prop(this,"elements");return elements?jQuery.makeArray(elements):this}).filter(function(){var type=this.type;return this.name&&!jQuery(this).is(":disabled")&&rsubmittable.test(this.nodeName)&&!rsubmitterTypes.test(type)&&(this.checked||!rcheckableType.test(type))}).map(function(i,elem){var val=jQuery(this).val();if(val==null){return null}if(Array.isArray(val)){return jQuery.map(val,function(val){return{name:elem.name,value:val.replace(rCRLF,"\r\n")}})}return{name:elem.name,value:val.replace(rCRLF,"\r\n")}}).get()}});var r20=/%20/g,rhash=/#.*$/,rantiCache=/([?&])_=[^&]*/,rheaders=/^(.*?):[ \t]*([^\r\n]*)$/gm,rlocalProtocol=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,prefilters={},transports={},allTypes="*/".concat("*"),originAnchor=document.createElement("a");originAnchor.href=location.href;function addToPrefiltersOrTransports(structure){return function(dataTypeExpression,func){if(typeof dataTypeExpression!=="string"){func=dataTypeExpression;dataTypeExpression="*"}var dataType,i=0,dataTypes=dataTypeExpression.toLowerCase().match(rnothtmlwhite)||[];if(isFunction(func)){while(dataType=dataTypes[i++]){if(dataType[0]==="+"){dataType=dataType.slice(1)||"*";(structure[dataType]=structure[dataType]||[]).unshift(func)}else{(structure[dataType]=structure[dataType]||[]).push(func)}}}}}function inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR){var inspected={},seekingTransport=structure===transports;function inspect(dataType){var selected;inspected[dataType]=true;jQuery.each(structure[dataType]||[],function(_,prefilterOrFactory){var dataTypeOrTransport=prefilterOrFactory(options,originalOptions,jqXHR);if(typeof dataTypeOrTransport==="string"&&!seekingTransport&&!inspected[dataTypeOrTransport]){options.dataTypes.unshift(dataTypeOrTransport);inspect(dataTypeOrTransport);return false}else if(seekingTransport){return!(selected=dataTypeOrTransport)}});return selected}return inspect(options.dataTypes[0])||!inspected["*"]&&inspect("*")}function ajaxExtend(target,src){var key,deep,flatOptions=jQuery.ajaxSettings.flatOptions||{};for(key in src){if(src[key]!==undefined){(flatOptions[key]?target:deep||(deep={}))[key]=src[key]}}if(deep){jQuery.extend(true,target,deep)}return target}function ajaxHandleResponses(s,jqXHR,responses){var ct,type,finalDataType,firstDataType,contents=s.contents,dataTypes=s.dataTypes;while(dataTypes[0]==="*"){dataTypes.shift();if(ct===undefined){ct=s.mimeType||jqXHR.getResponseHeader("Content-Type")}}if(ct){for(type in contents){if(contents[type]&&contents[type].test(ct)){dataTypes.unshift(type);break}}}if(dataTypes[0]in responses){finalDataType=dataTypes[0]}else{for(type in responses){if(!dataTypes[0]||s.converters[type+" "+dataTypes[0]]){finalDataType=type;break}if(!firstDataType){firstDataType=type}}finalDataType=finalDataType||firstDataType}if(finalDataType){if(finalDataType!==dataTypes[0]){dataTypes.unshift(finalDataType)}return responses[finalDataType]}}function ajaxConvert(s,response,jqXHR,isSuccess){var conv2,current,conv,tmp,prev,converters={},dataTypes=s.dataTypes.slice();if(dataTypes[1]){for(conv in s.converters){converters[conv.toLowerCase()]=s.converters[conv]}}current=dataTypes.shift();while(current){if(s.responseFields[current]){jqXHR[s.responseFields[current]]=response}if(!prev&&isSuccess&&s.dataFilter){response=s.dataFilter(response,s.dataType)}prev=current;current=dataTypes.shift();if(current){if(current==="*"){current=prev}else if(prev!=="*"&&prev!==current){conv=converters[prev+" "+current]||converters["* "+current];if(!conv){for(conv2 in converters){tmp=conv2.split(" ");if(tmp[1]===current){conv=converters[prev+" "+tmp[0]]||converters["* "+tmp[0]];if(conv){if(conv===true){conv=converters[conv2]}else if(converters[conv2]!==true){current=tmp[0];dataTypes.unshift(tmp[1])}break}}}}if(conv!==true){if(conv&&s.throws){response=conv(response)}else{try{response=conv(response)}catch(e){return{state:"parsererror",error:conv?e:"No conversion from "+prev+" to "+current}}}}}}}return{state:"success",data:response}}jQuery.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:location.href,type:"GET",isLocal:rlocalProtocol.test(location.protocol),global:true,processData:true,async:true,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":allTypes,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":true,"text json":JSON.parse,"text xml":jQuery.parseXML},flatOptions:{url:true,context:true}},ajaxSetup:function(target,settings){return settings?ajaxExtend(ajaxExtend(target,jQuery.ajaxSettings),settings):ajaxExtend(jQuery.ajaxSettings,target)},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(url,options){if(typeof url==="object"){options=url;url=undefined}options=options||{};var transport,cacheURL,responseHeadersString,responseHeaders,timeoutTimer,urlAnchor,completed,fireGlobals,i,uncached,s=jQuery.ajaxSetup({},options),callbackContext=s.context||s,globalEventContext=s.context&&(callbackContext.nodeType||callbackContext.jquery)?jQuery(callbackContext):jQuery.event,deferred=jQuery.Deferred(),completeDeferred=jQuery.Callbacks("once memory"),statusCode=s.statusCode||{},requestHeaders={},requestHeadersNames={},strAbort="canceled",jqXHR={readyState:0,getResponseHeader:function(key){var match;if(completed){if(!responseHeaders){responseHeaders={};while(match=rheaders.exec(responseHeadersString)){responseHeaders[match[1].toLowerCase()]=match[2]}}match=responseHeaders[key.toLowerCase()]}return match==null?null:match},getAllResponseHeaders:function(){return completed?responseHeadersString:null},setRequestHeader:function(name,value){if(completed==null){name=requestHeadersNames[name.toLowerCase()]=requestHeadersNames[name.toLowerCase()]||name;requestHeaders[name]=value}return this},overrideMimeType:function(type){if(completed==null){s.mimeType=type}return this},statusCode:function(map){var code;if(map){if(completed){jqXHR.always(map[jqXHR.status])}else{for(code in map){statusCode[code]=[statusCode[code],map[code]]}}}return this},abort:function(statusText){var finalText=statusText||strAbort;if(transport){transport.abort(finalText)}done(0,finalText);return this}};deferred.promise(jqXHR);s.url=((url||s.url||location.href)+"").replace(rprotocol,location.protocol+"//");s.type=options.method||options.type||s.method||s.type;s.dataTypes=(s.dataType||"*").toLowerCase().match(rnothtmlwhite)||[""];if(s.crossDomain==null){urlAnchor=document.createElement("a");try{urlAnchor.href=s.url;urlAnchor.href=urlAnchor.href;s.crossDomain=originAnchor.protocol+"//"+originAnchor.host!==urlAnchor.protocol+"//"+urlAnchor.host}catch(e){s.crossDomain=true}}if(s.data&&s.processData&&typeof s.data!=="string"){s.data=jQuery.param(s.data,s.traditional)}inspectPrefiltersOrTransports(prefilters,s,options,jqXHR);if(completed){return jqXHR}fireGlobals=jQuery.event&&s.global;if(fireGlobals&&jQuery.active++===0){jQuery.event.trigger("ajaxStart")}s.type=s.type.toUpperCase();s.hasContent=!rnoContent.test(s.type);cacheURL=s.url.replace(rhash,"");if(!s.hasContent){uncached=s.url.slice(cacheURL.length);if(s.data&&(s.processData||typeof s.data==="string")){cacheURL+=(rquery.test(cacheURL)?"&":"?")+s.data;delete s.data}if(s.cache===false){cacheURL=cacheURL.replace(rantiCache,"$1");uncached=(rquery.test(cacheURL)?"&":"?")+"_="+nonce+++uncached}s.url=cacheURL+uncached}else if(s.data&&s.processData&&(s.contentType||"").indexOf("application/x-www-form-urlencoded")===0){s.data=s.data.replace(r20,"+")}if(s.ifModified){if(jQuery.lastModified[cacheURL]){jqXHR.setRequestHeader("If-Modified-Since",jQuery.lastModified[cacheURL])}if(jQuery.etag[cacheURL]){jqXHR.setRequestHeader("If-None-Match",jQuery.etag[cacheURL])}}if(s.data&&s.hasContent&&s.contentType!==false||options.contentType){jqXHR.setRequestHeader("Content-Type",s.contentType)}jqXHR.setRequestHeader("Accept",s.dataTypes[0]&&s.accepts[s.dataTypes[0]]?s.accepts[s.dataTypes[0]]+(s.dataTypes[0]!=="*"?", "+allTypes+"; q=0.01":""):s.accepts["*"]);for(i in s.headers){jqXHR.setRequestHeader(i,s.headers[i])}if(s.beforeSend&&(s.beforeSend.call(callbackContext,jqXHR,s)===false||completed)){return jqXHR.abort()}strAbort="abort";completeDeferred.add(s.complete);jqXHR.done(s.success);jqXHR.fail(s.error);transport=inspectPrefiltersOrTransports(transports,s,options,jqXHR);if(!transport){done(-1,"No Transport")}else{jqXHR.readyState=1;if(fireGlobals){globalEventContext.trigger("ajaxSend",[jqXHR,s])}if(completed){return jqXHR}if(s.async&&s.timeout>0){timeoutTimer=window.setTimeout(function(){jqXHR.abort("timeout")},s.timeout)}try{completed=false;transport.send(requestHeaders,done)}catch(e){if(completed){throw e}done(-1,e)}}function done(status,nativeStatusText,responses,headers){var isSuccess,success,error,response,modified,statusText=nativeStatusText;if(completed){return}completed=true;if(timeoutTimer){window.clearTimeout(timeoutTimer)}transport=undefined;responseHeadersString=headers||"";jqXHR.readyState=status>0?4:0;isSuccess=status>=200&&status<300||status===304;if(responses){response=ajaxHandleResponses(s,jqXHR,responses)}response=ajaxConvert(s,response,jqXHR,isSuccess);if(isSuccess){if(s.ifModified){modified=jqXHR.getResponseHeader("Last-Modified");if(modified){jQuery.lastModified[cacheURL]=modified}modified=jqXHR.getResponseHeader("etag");if(modified){jQuery.etag[cacheURL]=modified}}if(status===204||s.type==="HEAD"){statusText="nocontent"}else if(status===304){statusText="notmodified"}else{statusText=response.state;success=response.data;error=response.error;isSuccess=!error}}else{error=statusText;if(status||!statusText){statusText="error";if(status<0){status=0}}}jqXHR.status=status;jqXHR.statusText=(nativeStatusText||statusText)+"";if(isSuccess){deferred.resolveWith(callbackContext,[success,statusText,jqXHR])}else{deferred.rejectWith(callbackContext,[jqXHR,statusText,error])}jqXHR.statusCode(statusCode);statusCode=undefined;if(fireGlobals){globalEventContext.trigger(isSuccess?"ajaxSuccess":"ajaxError",[jqXHR,s,isSuccess?success:error])}completeDeferred.fireWith(callbackContext,[jqXHR,statusText]);if(fireGlobals){globalEventContext.trigger("ajaxComplete",[jqXHR,s]);if(!--jQuery.active){jQuery.event.trigger("ajaxStop")}}}return jqXHR},getJSON:function(url,data,callback){return jQuery.get(url,data,callback,"json")},getScript:function(url,callback){return jQuery.get(url,undefined,callback,"script")}});jQuery.each(["get","post"],function(i,method){jQuery[method]=function(url,data,callback,type){if(isFunction(data)){type=type||callback;callback=data;data=undefined}return jQuery.ajax(jQuery.extend({url:url,type:method,dataType:type,data:data,success:callback},jQuery.isPlainObject(url)&&url))}});jQuery._evalUrl=function(url){return jQuery.ajax({url:url,type:"GET",dataType:"script",cache:true,async:false,global:false,throws:true})};jQuery.fn.extend({wrapAll:function(html){var wrap;if(this[0]){if(isFunction(html)){html=html.call(this[0])}wrap=jQuery(html,this[0].ownerDocument).eq(0).clone(true);if(this[0].parentNode){wrap.insertBefore(this[0])}wrap.map(function(){var elem=this;while(elem.firstElementChild){elem=elem.firstElementChild}return elem}).append(this)}return this},wrapInner:function(html){if(isFunction(html)){return this.each(function(i){jQuery(this).wrapInner(html.call(this,i))})}return this.each(function(){var self=jQuery(this),contents=self.contents();if(contents.length){contents.wrapAll(html)}else{self.append(html)}})},wrap:function(html){var htmlIsFunction=isFunction(html);return this.each(function(i){jQuery(this).wrapAll(htmlIsFunction?html.call(this,i):html)})},unwrap:function(selector){this.parent(selector).not("body").each(function(){jQuery(this).replaceWith(this.childNodes)});return this}});jQuery.expr.pseudos.hidden=function(elem){return!jQuery.expr.pseudos.visible(elem)};jQuery.expr.pseudos.visible=function(elem){return!!(elem.offsetWidth||elem.offsetHeight||elem.getClientRects().length)};jQuery.ajaxSettings.xhr=function(){try{return new window.XMLHttpRequest}catch(e){}};var xhrSuccessStatus={0:200,1223:204},xhrSupported=jQuery.ajaxSettings.xhr();support.cors=!!xhrSupported&&"withCredentials"in xhrSupported;support.ajax=xhrSupported=!!xhrSupported;jQuery.ajaxTransport(function(options){var callback,errorCallback;if(support.cors||xhrSupported&&!options.crossDomain){return{send:function(headers,complete){var i,xhr=options.xhr();xhr.open(options.type,options.url,options.async,options.username,options.password);if(options.xhrFields){for(i in options.xhrFields){xhr[i]=options.xhrFields[i]}}if(options.mimeType&&xhr.overrideMimeType){xhr.overrideMimeType(options.mimeType)}if(!options.crossDomain&&!headers["X-Requested-With"]){headers["X-Requested-With"]="XMLHttpRequest"}for(i in headers){xhr.setRequestHeader(i,headers[i])}callback=function(type){return function(){if(callback){callback=errorCallback=xhr.onload=xhr.onerror=xhr.onabort=xhr.ontimeout=xhr.onreadystatechange=null;if(type==="abort"){xhr.abort()}else if(type==="error"){if(typeof xhr.status!=="number"){complete(0,"error")}else{complete(xhr.status,xhr.statusText)}}else{complete(xhrSuccessStatus[xhr.status]||xhr.status,xhr.statusText,(xhr.responseType||"text")!=="text"||typeof xhr.responseText!=="string"?{binary:xhr.response}:{text:xhr.responseText},xhr.getAllResponseHeaders())}}}};xhr.onload=callback();errorCallback=xhr.onerror=xhr.ontimeout=callback("error");if(xhr.onabort!==undefined){xhr.onabort=errorCallback}else{xhr.onreadystatechange=function(){if(xhr.readyState===4){window.setTimeout(function(){if(callback){errorCallback()}})}}}callback=callback("abort");try{xhr.send(options.hasContent&&options.data||null)}catch(e){if(callback){throw e}}},abort:function(){if(callback){callback()}}}}});jQuery.ajaxPrefilter(function(s){if(s.crossDomain){s.contents.script=false}});jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, "+"application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(text){jQuery.globalEval(text);return text}}});jQuery.ajaxPrefilter("script",function(s){if(s.cache===undefined){s.cache=false}if(s.crossDomain){s.type="GET"}});jQuery.ajaxTransport("script",function(s){if(s.crossDomain){var script,callback;return{send:function(_,complete){script=jQuery("<script>").prop({charset:s.scriptCharset,src:s.url}).on("load error",callback=function(evt){script.remove();callback=null;if(evt){complete(evt.type==="error"?404:200,evt.type)}});document.head.appendChild(script[0])},abort:function(){if(callback){callback()}}}}});var oldCallbacks=[],rjsonp=/(=)\?(?=&|$)|\?\?/;jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var callback=oldCallbacks.pop()||jQuery.expando+"_"+nonce++;this[callback]=true;return callback}});jQuery.ajaxPrefilter("json jsonp",function(s,originalSettings,jqXHR){var callbackName,overwritten,responseContainer,jsonProp=s.jsonp!==false&&(rjsonp.test(s.url)?"url":typeof s.data==="string"&&(s.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&rjsonp.test(s.data)&&"data");if(jsonProp||s.dataTypes[0]==="jsonp"){callbackName=s.jsonpCallback=isFunction(s.jsonpCallback)?s.jsonpCallback():s.jsonpCallback;if(jsonProp){s[jsonProp]=s[jsonProp].replace(rjsonp,"$1"+callbackName)}else if(s.jsonp!==false){s.url+=(rquery.test(s.url)?"&":"?")+s.jsonp+"="+callbackName}s.converters["script json"]=function(){if(!responseContainer){jQuery.error(callbackName+" was not called")}return responseContainer[0]};s.dataTypes[0]="json";overwritten=window[callbackName];window[callbackName]=function(){responseContainer=arguments};jqXHR.always(function(){if(overwritten===undefined){jQuery(window).removeProp(callbackName)}else{window[callbackName]=overwritten}if(s[callbackName]){s.jsonpCallback=originalSettings.jsonpCallback;oldCallbacks.push(callbackName)}if(responseContainer&&isFunction(overwritten)){overwritten(responseContainer[0])}responseContainer=overwritten=undefined});return"script"}});support.createHTMLDocument=function(){var body=document.implementation.createHTMLDocument("").body;body.innerHTML="<form></form><form></form>";return body.childNodes.length===2}();jQuery.parseHTML=function(data,context,keepScripts){if(typeof data!=="string"){return[]}if(typeof context==="boolean"){keepScripts=context;context=false}var base,parsed,scripts;if(!context){if(support.createHTMLDocument){context=document.implementation.createHTMLDocument("");base=context.createElement("base");base.href=document.location.href;context.head.appendChild(base)}else{context=document}}parsed=rsingleTag.exec(data);scripts=!keepScripts&&[];if(parsed){return[context.createElement(parsed[1])]}parsed=buildFragment([data],context,scripts);if(scripts&&scripts.length){jQuery(scripts).remove()}return jQuery.merge([],parsed.childNodes)};jQuery.fn.load=function(url,params,callback){var selector,type,response,self=this,off=url.indexOf(" ");if(off>-1){selector=stripAndCollapse(url.slice(off));url=url.slice(0,off)}if(isFunction(params)){callback=params;params=undefined}else if(params&&typeof params==="object"){type="POST"}if(self.length>0){jQuery.ajax({url:url,type:type||"GET",dataType:"html",data:params}).done(function(responseText){response=arguments;self.html(selector?jQuery("<div>").append(jQuery.parseHTML(responseText)).find(selector):responseText)}).always(callback&&function(jqXHR,status){self.each(function(){callback.apply(this,response||[jqXHR.responseText,status,jqXHR])})})}return this};jQuery.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(i,type){jQuery.fn[type]=function(fn){return this.on(type,fn)}});jQuery.expr.pseudos.animated=function(elem){return jQuery.grep(jQuery.timers,function(fn){return elem===fn.elem}).length};jQuery.offset={setOffset:function(elem,options,i){var curPosition,curLeft,curCSSTop,curTop,curOffset,curCSSLeft,calculatePosition,position=jQuery.css(elem,"position"),curElem=jQuery(elem),props={};if(position==="static"){elem.style.position="relative"}curOffset=curElem.offset();curCSSTop=jQuery.css(elem,"top");curCSSLeft=jQuery.css(elem,"left");calculatePosition=(position==="absolute"||position==="fixed")&&(curCSSTop+curCSSLeft).indexOf("auto")>-1;if(calculatePosition){curPosition=curElem.position();curTop=curPosition.top;curLeft=curPosition.left}else{curTop=parseFloat(curCSSTop)||0;curLeft=parseFloat(curCSSLeft)||0}if(isFunction(options)){options=options.call(elem,i,jQuery.extend({},curOffset))}if(options.top!=null){props.top=options.top-curOffset.top+curTop}if(options.left!=null){props.left=options.left-curOffset.left+curLeft}if("using"in options){options.using.call(elem,props)}else{curElem.css(props)}}};jQuery.fn.extend({offset:function(options){if(arguments.length){return options===undefined?this:this.each(function(i){jQuery.offset.setOffset(this,options,i)})}var rect,win,elem=this[0];if(!elem){return}if(!elem.getClientRects().length){return{top:0,left:0}}rect=elem.getBoundingClientRect();win=elem.ownerDocument.defaultView;return{top:rect.top+win.pageYOffset,left:rect.left+win.pageXOffset}},position:function(){if(!this[0]){return}var offsetParent,offset,doc,elem=this[0],parentOffset={top:0,left:0};if(jQuery.css(elem,"position")==="fixed"){offset=elem.getBoundingClientRect()}else{offset=this.offset();doc=elem.ownerDocument;offsetParent=elem.offsetParent||doc.documentElement;while(offsetParent&&(offsetParent===doc.body||offsetParent===doc.documentElement)&&jQuery.css(offsetParent,"position")==="static"){offsetParent=offsetParent.parentNode}if(offsetParent&&offsetParent!==elem&&offsetParent.nodeType===1){parentOffset=jQuery(offsetParent).offset();parentOffset.top+=jQuery.css(offsetParent,"borderTopWidth",true);parentOffset.left+=jQuery.css(offsetParent,"borderLeftWidth",true)}}return{top:offset.top-parentOffset.top-jQuery.css(elem,"marginTop",true),left:offset.left-parentOffset.left-jQuery.css(elem,"marginLeft",true)}},offsetParent:function(){return this.map(function(){var offsetParent=this.offsetParent;while(offsetParent&&jQuery.css(offsetParent,"position")==="static"){offsetParent=offsetParent.offsetParent}return offsetParent||documentElement})}});jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(method,prop){var top="pageYOffset"===prop;jQuery.fn[method]=function(val){return access(this,function(elem,method,val){var win;if(isWindow(elem)){win=elem}else if(elem.nodeType===9){win=elem.defaultView}if(val===undefined){return win?win[prop]:elem[method]}if(win){win.scrollTo(!top?val:win.pageXOffset,top?val:win.pageYOffset)}else{elem[method]=val}},method,val,arguments.length)}});jQuery.each(["top","left"],function(i,prop){jQuery.cssHooks[prop]=addGetHookIf(support.pixelPosition,function(elem,computed){if(computed){computed=curCSS(elem,prop);return rnumnonpx.test(computed)?jQuery(elem).position()[prop]+"px":computed}})});jQuery.each({Height:"height",Width:"width"},function(name,type){jQuery.each({padding:"inner"+name,content:type,"":"outer"+name},function(defaultExtra,funcName){jQuery.fn[funcName]=function(margin,value){var chainable=arguments.length&&(defaultExtra||typeof margin!=="boolean"),extra=defaultExtra||(margin===true||value===true?"margin":"border");return access(this,function(elem,type,value){var doc;if(isWindow(elem)){return funcName.indexOf("outer")===0?elem["inner"+name]:elem.document.documentElement["client"+name]}if(elem.nodeType===9){doc=elem.documentElement;return Math.max(elem.body["scroll"+name],doc["scroll"+name],elem.body["offset"+name],doc["offset"+name],doc["client"+name])}return value===undefined?jQuery.css(elem,type,extra):jQuery.style(elem,type,value,extra)},type,chainable?margin:undefined,chainable)}})});jQuery.each(("blur focus focusin focusout resize scroll click dblclick "+"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave "+"change select submit keydown keypress keyup contextmenu").split(" "),function(i,name){jQuery.fn[name]=function(data,fn){return arguments.length>0?this.on(name,null,data,fn):this.trigger(name)}});jQuery.fn.extend({hover:function(fnOver,fnOut){return this.mouseenter(fnOver).mouseleave(fnOut||fnOver)}});jQuery.fn.extend({bind:function(types,data,fn){return this.on(types,null,data,fn)},unbind:function(types,fn){return this.off(types,null,fn)},delegate:function(selector,types,data,fn){return this.on(types,selector,data,fn)},undelegate:function(selector,types,fn){return arguments.length===1?this.off(selector,"**"):this.off(types,selector||"**",fn)}});jQuery.proxy=function(fn,context){var tmp,args,proxy;if(typeof context==="string"){tmp=fn[context];context=fn;fn=tmp}if(!isFunction(fn)){return undefined}args=slice.call(arguments,2);proxy=function(){return fn.apply(context||this,args.concat(slice.call(arguments)))};proxy.guid=fn.guid=fn.guid||jQuery.guid++;return proxy};jQuery.holdReady=function(hold){if(hold){jQuery.readyWait++}else{jQuery.ready(true)}};jQuery.isArray=Array.isArray;jQuery.parseJSON=JSON.parse;jQuery.nodeName=nodeName;jQuery.isFunction=isFunction;jQuery.isWindow=isWindow;jQuery.camelCase=camelCase;jQuery.type=toType;jQuery.now=Date.now;jQuery.isNumeric=function(obj){var type=jQuery.type(obj);return(type==="number"||type==="string")&&!isNaN(obj-parseFloat(obj))};if(true){!(__WEBPACK_AMD_DEFINE_ARRAY__=[],__WEBPACK_AMD_DEFINE_RESULT__=function(){return jQuery}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}var _jQuery=window.jQuery,_$=window.$;jQuery.noConflict=function(deep){if(window.$===jQuery){window.$=_$}if(deep&&window.jQuery===jQuery){window.jQuery=_jQuery}return jQuery};if(!noGlobal){window.jQuery=window.$=jQuery}return jQuery})},"./src/bw-highcharts.js":function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;(function(global,factory){if(true){!(__WEBPACK_AMD_DEFINE_ARRAY__=[exports,__webpack_require__("./node_modules/highcharts/highcharts.js"),__webpack_require__("./src/highcharts-overrides.js")],__WEBPACK_AMD_DEFINE_FACTORY__=factory,__WEBPACK_AMD_DEFINE_RESULT__=typeof __WEBPACK_AMD_DEFINE_FACTORY__==="function"?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}else{var mod}})(this,function(exports,_highcharts,_highchartsOverrides){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _highcharts2=_interopRequireDefault(_highcharts);var _highchartsOverrides2=_interopRequireDefault(_highchartsOverrides);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var BrandwatchHighcharts=(0,_highchartsOverrides2.default)(_highcharts2.default);exports.default=BrandwatchHighcharts})},"./src/highcharts-base-options.js":function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;(function(global,factory){if(true){!(__WEBPACK_AMD_DEFINE_ARRAY__=[exports,__webpack_require__("./node_modules/highcharts/highcharts.js")],__WEBPACK_AMD_DEFINE_FACTORY__=factory,__WEBPACK_AMD_DEFINE_RESULT__=typeof __WEBPACK_AMD_DEFINE_FACTORY__==="function"?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}else{var mod}})(this,function(exports,_highcharts){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _highcharts2=_interopRequireDefault(_highcharts);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var HighchartOptions=_highcharts2.default.getOptions();var numericSymbols=HighchartOptions.lang.numericSymbols.map(function(string){return String(string).toUpperCase()});exports.default={global:{useUTC:true},chart:{reflow:false,spacingLeft:5,spacingRight:5,animation:false,style:{fontFamily:"Arial, Helvetica, sans-serif",fontSize:"12px"}},title:{text:null},credits:{enabled:false},legend:{borderWidth:0,align:"center",symbolWidth:10,symbolHeight:10,symbolPadding:3,padding:12,itemStyle:{color:"#666666",fontSize:"12px",fontWeight:"normal"},itemHoverStyle:{color:"#222222"},legendLine:false},exporting:{enabled:true,buttons:null,fallbackToExportServer:true,url:"/exportchart"},plotOptions:{line:{marker:{radius:2.5}},pie:{dataLabels:{enabled:true,style:{fontSize:"12px"}}},bar:{states:{hover:{enabled:false}},pointPadding:0,groupPadding:0},column:{states:{hover:{enabled:false}},stacking:"normal",pointPadding:.05,groupPadding:0,borderWidth:.1,lineWidth:0},series:{cursor:"pointer",animation:false,shadow:false,marker:{symbol:"circle",radius:2.5,fillColor:null,lineWidth:0}}},tooltip:{backgroundColor:"rgba(255, 255, 255, 0.95)",borderWidth:1,borderRadius:2,shadow:false,headerFormat:'<span style="font-size: 13px">{point.key}</span><br/>',style:{padding:6,color:"#333333",fontSize:"13px"}},xAxis:{gridLineColor:"#EEEEEE",title:{style:{color:"#666",fontWeight:"normal"},text:""},minPadding:.05,maxPadding:.05,startOnTick:false,endOnTick:false,dateTimeLabelFormats:{day:"%e %b",week:"%e %b",month:"%b %Y"},labels:{style:{fontSize:"12px"}},units:[["day",[1,2]],["week",[1,2]],["month",[1,2,3,4,6]],["year",[1]]]},yAxis:{allowDecimals:false,gridLineColor:"#EEEEEE",title:{style:{color:"#666",fontWeight:"normal"},text:""},startOnTick:false,endOnTick:false,min:0,labels:{style:{fontSize:"12px"}}},lang:{resetZoom:"Reset Zoom",numericSymbols:numericSymbols,thousandsSep:"."}}})},"./src/highcharts-overrides.js":function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;(function(global,factory){if(true){!(__WEBPACK_AMD_DEFINE_ARRAY__=[exports,__webpack_require__("./node_modules/highcharts/highcharts.js"),__webpack_require__("./src/highcharts-base-options.js"),__webpack_require__("./node_modules/highcharts/modules/exporting.js"),__webpack_require__("./node_modules/highcharts/modules/offline-exporting.js"),__webpack_require__("./node_modules/highcharts/modules/heatmap.js"),__webpack_require__("./node_modules/highcharts/modules/sunburst.js"),__webpack_require__("./node_modules/highcharts-pattern-fill/pattern-fill-v2.js"),__webpack_require__("./node_modules/jquery/dist/jquery.js")],__WEBPACK_AMD_DEFINE_FACTORY__=factory,__WEBPACK_AMD_DEFINE_RESULT__=typeof __WEBPACK_AMD_DEFINE_FACTORY__==="function"?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}else{var mod}})(this,function(exports,_highcharts,_highchartsBaseOptions,_exporting,_offlineExporting,_heatmap,_sunburst,_highchartsPatternFill,$){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=applyHighchartsOverrides;var _highcharts2=_interopRequireDefault(_highcharts);var _highchartsBaseOptions2=_interopRequireDefault(_highchartsBaseOptions);var _exporting2=_interopRequireDefault(_exporting);var _offlineExporting2=_interopRequireDefault(_offlineExporting);var _heatmap2=_interopRequireDefault(_heatmap);var _sunburst2=_interopRequireDefault(_sunburst);var _highchartsPatternFill2=_interopRequireDefault(_highchartsPatternFill);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(0,_exporting2.default)(_highcharts2.default);(0,_offlineExporting2.default)(_highcharts2.default);(0,_heatmap2.default)(_highcharts2.default);(0,_sunburst2.default)(_highcharts2.default);(0,_highchartsPatternFill2.default)(_highcharts2.default);var oldLineDrawLegendSymbol=void 0;function reflow(force){var parent=$(this.container).parent();var width=parent.width();var height=Math.min(parent.height(),this.options.chart.maxHeight);if(!width||!height){return}if(force||this.chartWidth!==width||this.chartHeight!==height){this.setSize(width,height,false)}}function lineDrawLegendSymbol(legend){var oldLineWidth=this.options.lineWidth;if(!legend.options.legendLine){this.options.lineWidth=0}oldLineDrawLegendSymbol.call(this,legend);this.options.lineWidth=oldLineWidth}function AreaSeriesDrawLegendSymbol(legend,item){item.legendSymbol=this.chart.renderer.rect(0,legend.baseline-legend.options.symbolHeight+1,legend.options.symbolWidth,legend.options.symbolHeight,2).attr({zIndex:3}).add(item.legendGroup)}function applyHighchartsOverrides(highchartsLibrary){oldLineDrawLegendSymbol=highchartsLibrary.seriesTypes.line.prototype.drawLegendSymbol;highchartsLibrary.DEFAULT_CHART_HEIGHT=400;_highchartsBaseOptions2.default.chart.maxHeight=highchartsLibrary.DEFAULT_CHART_HEIGHT;highchartsLibrary.Chart.prototype.reflow=reflow;highchartsLibrary.seriesTypes.line.prototype.drawLegendSymbol=lineDrawLegendSymbol;highchartsLibrary.seriesTypes.column.prototype.drawLegendSymbol=AreaSeriesDrawLegendSymbol;highchartsLibrary.seriesTypes.pie.prototype.drawLegendSymbol=AreaSeriesDrawLegendSymbol;highchartsLibrary.Chart.prototype.destroyExport=function destroyExport(){};highchartsLibrary.setOptions(_highchartsBaseOptions2.default);return highchartsLibrary}})}})["default"]});define("src/components/mentions/_testsearch/models/TestSearchHistoryResultsCollection",["underscore","bw-fe-helpers/isoDateHelper","src/components/mentions/_testsearch/models/TestSearchResultsCollection"],function(_,isoDateHelper,TestSearchResultsCollection){"use strict";function validateDateFormat(day){if(!isoDateHelper.isISODate(day)){throw new Error("Dates have to be in ISO format")}}return TestSearchResultsCollection.extend({url:function url(){return"/projects/{projectId}/testsearch/dailymentions"},clear:function clear(){delete this.day;TestSearchResultsCollection.prototype.clear.call(this)},_getRequiredOptionNames:function _getRequiredOptionNames(){return TestSearchResultsCollection.prototype._getRequiredOptionNames.call(this).concat(["day"])},fetch:function fetch(options){_.extend(this,_.pick(options||{},["day"]));validateDateFormat(this.day);return TestSearchResultsCollection.prototype.fetch.call(this,options)},getQueryData:function getQueryData(){return _.extend(TestSearchResultsCollection.prototype.getQueryData.call(this),{day:this.day})}})});define("mustache!src/querybuilder/templates/historyPreviewTabHasResults",["lib/mustache"],function(mustache){var escapedTemplate='<section class="slide">\n<section class="infobox infoboxtextcolor infoboxbgcolor mediumtext singlemargin-top singlepadding-vertical">\n<p class="mediumtext-bigline doublepadding-horizontal">\nChecking <b>peaks</b> and comparing to events can help you make sure your results are relevant.\nThe dates of preview Mentions are in UTC.\n</p>\n</section>\n<div class="chart-container"></div>\n</section>\n<section class="slide second">\n<header class="singlepadding-top fullwidth overflow-horizontal">\n<a href="#" class="back floatleft singlemargin-right"><span class="icon-chevron-left"></span> Back</a>\n<p class="slide-title absleft">Results for <span class="js-date-string bold">selected Date</span></p>\n</header>\n</section>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/querybuilder/css/historyPreviewTab.css",["css!src/querybuilder/css/compiled.css"],function(){});define("src/querybuilder/views/HistoryPreviewTabView",["underscore","backbone","moment","src/globals/theme","bw-highcharts","src/components/mentions/_testsearch/models/TestSearchHistoryResultsCollection","src/components/mentions/_testsearch/views/TestSearchResultsView","src/querybuilder/queryNoResultMessageHelper","mustache!src/querybuilder/templates/historyPreviewTabHasResults","mustache!src/querybuilder/templates/previewTabNoResults","css!src/querybuilder/css/historyPreviewTab.css"],function(_,Backbone,moment,theme,Highcharts,TestSearchHistoryResultsCollection,TestSearchResultsView,queryNoResultMessageHelper,historyPreviewTabHasResultsTemplate,historyPreviewTabNoResultsTemplate){"use strict";var NO_RESULT="No Mentions found for";function getPreparedData(view){var date,total,data,graphColour=theme.chartColours.general[0];data=view.collection.map(function(historyItem){date=moment(historyItem.get("date")).valueOf();total=historyItem.get("total");return[date,total]});return[{data:data,color:graphColour}]}function getChartOptions(options){var chartOptions={title:null,chart:{renderTo:options.container,defaultSeriesType:"line"},legend:{enabled:false},tooltip:{formatter:function formatter(){var dateString=moment(this.point.x).format("MMM DD"),pluralString=this.y===1?"":"s";return"<b>"+this.y+"</b>Mention"+pluralString+"<br>on <b>"+dateString+"</b>"}},xAxis:{type:"datetime",dateTimeLabelFormats:{day:"%b %e",hour:"%b %e"},gridLineWidth:0,tickmarkPlacement:"on",labels:{y:20}},plotOptions:{series:{cursor:"pointer",events:{click:options.onClick}}},series:options.series};return chartOptions}function showLoader(view){view.mentionsListView.$el.detach();view.$el.addClass("isLoading").removeClass("error noResults").html('<div class="loading">Loading</div>')}function onRequest(view){showLoader(view);view.$el.removeClass("showSecondSlide")}function onError(view){view.collection.reset();view.$el.removeClass("isLoading noResults").addClass("error").html(historyPreviewTabNoResultsTemplate({errorMessage:"Sorry, we were unable to fetch results."}))}function onSync(view){var hasResults=view.collection.length>0;if(view.chart){view.chart.destroy();view.chart=null}if(hasResults){renderResults(view)}else{renderNoResults(view)}}function renderNoResults(view){var noResultMessage=queryNoResultMessageHelper.noResultMessage(NO_RESULT,view.collection.startDate,view.collection.endDate);view.$el.html(historyPreviewTabNoResultsTemplate({noResultMessage:noResultMessage}));view.$el.addClass("noResults")}function showSecondSlide(view,e){var date=moment.utc(e.point.x).toISOString();view.$el.addClass("showSecondSlide");view.$(".js-date-string").text(moment(date).format("MMM DD"));view.mentionsListView.collection.clear();view.mentionsListView.collection.fetch(_.extend({},view.collection.getRequiredOptions(),{day:date}))}function renderResults(view){var chartOptions,$container,series;view.$el.html(historyPreviewTabHasResultsTemplate());view.$(".slide.second").append(view.mentionsListView.$el);$container=view.$(".chart-container");series=getPreparedData(view);chartOptions=getChartOptions({container:$container[0],series:series,onClick:_.partial(showSecondSlide,view)});view.chart=new Highcharts.Chart(chartOptions)}function initializeMentionView(view){var options={collection:new TestSearchHistoryResultsCollection,showDateRange:false};view.mentionsListView=new TestSearchResultsView(options)}return Backbone.View.extend({tagName:"section",className:"historyPreviewTab searchResults singlepadding-top",events:{"click .back":function onClickGoBack(){this.$el.removeClass("showSecondSlide")},"click .js-reload":function onClickReload(){this.trigger("reload")}},constructor:function HistoryPreviewTabView(){Backbone.View.apply(this,arguments);if(!this.collection){throw new Error("HistoryPreviewTabView must be initialized with a collection.")}this.listenTo(this.collection,"sync",_(onSync).partial(this));this.listenTo(this.collection,"request",_(onRequest).partial(this));this.listenTo(this.collection,"error",_(onError).partial(this));initializeMentionView(this)},shown:function shown(){this.resize()},resize:function resize(){if(!this.chart){return}this.chart.reflow()},remove:function remove(){if(this.mentionsListView){this.mentionsListView.remove()}Backbone.View.prototype.remove.call(this)}})});define("src/models/QueryValidation",["underscore","backbone"],function(_,Backbone){"use strict";function isOutOfLowerRange(issue){return issue.startRow<1||issue.startColumn<1||issue.endRow<1||issue.endColumn<1}function rowDoesNotExist(issue,queryLines){var rowCount=queryLines.length;return issue.startRow>rowCount||issue.endRow>rowCount}function columnDoesNotExist(issue,queryLines){var startLineLength=queryLines[issue.startRow-1].length,endLineLength=queryLines[issue.endRow-1].length;return issue.startColumn>startLineLength||issue.endColumn>endLineLength}function startRowAfterEndRow(issue){return issue.startRow>issue.endRow}function startColumnAfterEndColumn(issue){return issue.startRow===issue.endRow&&issue.startColumn>issue.endColumn}function hasValidIssuePosition(queryLines,issue){if(isOutOfLowerRange(issue,queryLines)){return false}if(rowDoesNotExist(issue,queryLines)){return false}if(columnDoesNotExist(issue,queryLines)){return false}if(startRowAfterEndRow(issue)){return false}if(startColumnAfterEndColumn(issue)){return false}return true}function isQueryValid(errors,issueErrorCount){return issueErrorCount===0&&errors.length===0}function getIssueTypeCounts(issues){return["error","warning","information"].reduce(function(memo,type){var typeCountKey="issue"+_.capitalize(type)+"Count",typeIssues=_(issues).where({type:type});memo[typeCountKey]=typeIssues.length;return memo},{})}return Backbone.Model.extend({constructor:function QueryValidation(){Backbone.Model.apply(this,arguments)},url:function url(){var url=["/query-validation?","query=",encodeURIComponent(this.get("query"))],language=this.get("language")||[];language.forEach(function(lang){url.push("&language=");url.push(encodeURIComponent(lang))});return url.join("")},parse:function parse(validationResult){var errors=validationResult.errors||[],issues=validationResult.issues||[],language=validationResult.language||[],queryLines=(validationResult.query||"").split("\n"),issueTypeCounts,result;issues=issues.filter(_.partial(hasValidIssuePosition,queryLines));issueTypeCounts=getIssueTypeCounts(issues);result=_.extend(issueTypeCounts,{valid:isQueryValid(errors,issueTypeCounts.issueErrorCount),query:validationResult.query,language:language,errors:errors,issues:issues});return result},fetch:function fetch(){var query=this.get("query"),language=this.get("language");if(!query||typeof query!=="string"){throw new Error("query must be set on the QueryValidation model as a String")}if(!Array.isArray(language)){throw new Error("language must be set on the QueryValidation model as an Array")}return Backbone.Model.prototype.fetch.apply(this,arguments)}})});define("src/querybuilder/queryTestsearchHelper",["q","underscore","src/models/Query","src/models/QueryValidation"],function(Q,_,Query,QueryValidation){"use strict";var queryValidation=new QueryValidation;var validateXhr;var testsearchXhr;return{validate:function validate(queryModel){if(!queryModel){throw new Error("validate must be called with a queryModel")}return new Q.Promise(function(resolve,reject){queryValidation.clear();queryValidation.set({query:Query.getRawQueryTerm(queryModel.toJSON()),language:queryModel.get("languages")});if(validateXhr){validateXhr.abort()}validateXhr=queryValidation.fetch({success:function success(model){resolve(model)},error:function error(model,response){reject(response)},complete:function complete(){validateXhr=undefined}})})},fetchTestsearch:function fetchTestsearch(options){options=options||{};["collection","queryModel"].forEach(function(param){if(!options[param]){throw new Error("fetchTestsearch must be called with options."+param)}});var deferred=Q.defer();var fetchOptions=_.extend(this.buildFetchOptions(options),{success:deferred.resolve,error:function error(collection,response){deferred.reject(response)},complete:function complete(){testsearchXhr=undefined}});if(testsearchXhr){testsearchXhr.abort()}options.collection.clear();testsearchXhr=options.collection.fetch(fetchOptions);return deferred.promise},buildFetchOptions:function buildFetchOptions(options){return{term:Query.getRawQueryTerm(options.queryModel.toJSON()),projectId:options.queryModel.get("projectId"),langCode:options.queryModel.get("languages"),languageAgnostic:options.queryModel.get("languageAgnostic"),queryType:options.queryModel.get("type")}}}});define("src/querybuilder/models/TestSearchTopicsCollection",["underscore","backbone","bw-fe-helpers/validationHelpers"],function(_,Backbone,validationHelpers){"use strict";function validateNotEmpty(options,key){var value=options[key];if(validationHelpers.isNullOrEmpty(value)){throw new Error('TestSearchTopicsCollection must have a "'+key+'" property in options passed to fetch()')}}return Backbone.Collection.extend({constructor:function TestSearchTopicsCollection(){Backbone.Collection.apply(this,arguments)},url:function url(){return"/projects/{projectId}/testsearch/topics"},fetch:function fetch(options){var requiredOptionNames=this._getRequiredOptionNames();var optionalOptionNames=this._getOptionalOptionNames();var optionNames=[].concat(requiredOptionNames,optionalOptionNames);_.extend(this,_.pick(options||{},optionNames));requiredOptionNames.forEach(function(key){validateNotEmpty(options,key)});return Backbone.Collection.prototype.fetch.call(this,options)},_getRequiredOptionNames:function _getRequiredOptionNames(){return["term","langCode","languageAgnostic"]},getRequiredOptions:function getRequiredOptions(){return _.pick(this,this._getRequiredOptionNames())},_getOptionalOptionNames:function _getOptionalOptionNames(){return["exclusionSnippetIds","inclusionSnippetIds"]},sync:function sync(method,model,options){method="create";return Backbone.sync(method,model,options)},getQueryData:function getQueryData(){var payload={queryString:this.term,languages:this.langCode,languageAgnostic:this.languageAgnostic};if(this.exclusionSnippetIds){payload.exclusionSnippets=this.exclusionSnippetIds}if(this.inclusionSnippetIds){payload.inclusionSnippets=this.inclusionSnippetIds}return payload},parse:function parse(res){this.resultsTotal=res.numberOfMentions;this.startDate=res.startDate;this.endDate=res.endDate;return res.topics}})});define("src/querybuilder/models/TestSearchTopListCollection",["underscore","backbone"],function(_,Backbone){"use strict";return Backbone.Collection.extend({constructor:function TestSearchTopListCollection(models,options){Backbone.Collection.apply(this,arguments);if(!options||!options.mentionType){throw new Error("TestSearchTopListCollection must be called with options.mentionType")}this.mentionType=options.mentionType},url:function url(){return"/projects/{projectId}/testsearch/top"+this.mentionType+"s"},_getRequiredOptionNames:function _getRequiredOptionNames(){return["term","langCode","languageAgnostic"]},_getOptionalOptionNames:function _getOptionalOptionNames(){return["exclusionSnippetIds","inclusionSnippetIds"]},getRequiredOptions:function getRequiredOptions(){return _.pick(this,this._getRequiredOptionNames())},fetch:function fetch(options){var requiredOptionNames=this._getRequiredOptionNames();var optionalOptionNames=this._getOptionalOptionNames();var optionNames=[].concat(requiredOptionNames,optionalOptionNames);options=options||{};requiredOptionNames.forEach(function(property){if(!_.isBoolean(options[property])&&!options[property]){throw new Error("TestSearchTopListCollection.fetch must be called with options."+property)}});_.extend(this,_.pick(options,optionNames));return Backbone.Collection.prototype.fetch.call(this,options)},sync:function sync(method,model,options){method="create";return Backbone.sync(method,model,options)},getQueryData:function getQueryData(){var payload={queryString:this.term,languages:this.langCode,languageAgnostic:this.languageAgnostic};if(this.exclusionSnippetIds){payload.exclusionSnippets=this.exclusionSnippetIds}if(this.inclusionSnippetIds){payload.inclusionSnippets=this.inclusionSnippetIds}return payload},parse:function parse(res){this.resultsTotal=res.totalCount;this.startDate=res.startDate;this.endDate=res.endDate;return res.topResults}})});define("src/components/mentions/_testsearch/models/TestSearchHistoryCollection",["backbone","underscore"],function(Backbone,_){"use strict";function validateNotEmpty(options,key){var value=options[key],isValuePresent;if(_.isArray(value)){isValuePresent=!!value.length}else if(_.isBoolean(value)){isValuePresent=true}else{isValuePresent=!!value}if(isValuePresent){return}throw new Error('TestSearchHistoryCollection must have a "'+key+'" property in options passed to fetch()')}return Backbone.Collection.extend({url:function url(){return"/projects/{projectId}/testsearch/history"},fetch:function fetch(options){var self=this;var requiredOptionNames=this._getRequiredOptionNames();var optionalOptionNames=this._getOptionalOptionNames();var optionNames=[].concat(requiredOptionNames,optionalOptionNames);_.extend(this,_.pick(options||{},optionNames));requiredOptionNames.forEach(function(key){validateNotEmpty(self,key)});return Backbone.Collection.prototype.fetch.call(this,options)},getQueryData:function getQueryData(){var payload={queryString:this.term,languages:this.langCode,projectId:this.projectId,languageAgnostic:this.languageAgnostic};if(this.exclusionSnippetIds){payload.exclusionSnippets=this.exclusionSnippetIds}if(this.inclusionSnippetIds){payload.inclusionSnippets=this.inclusionSnippetIds}return payload},_getRequiredOptionNames:function _getRequiredOptionNames(){return["term","langCode","projectId","languageAgnostic"]},_getOptionalOptionNames:function _getOptionalOptionNames(){return["exclusionSnippetIds","inclusionSnippetIds"]},getRequiredOptions:function getRequiredOptions(){return _.pick(this,this._getRequiredOptionNames())},sync:function sync(method,model,options){method="create";return Backbone.sync(method,model,options)},parse:function parse(res){this.totalResults=res.totalResults;this.startDate=res.startDate;this.endDate=res.endDate;return res.history}})});define("mustache!src/querybuilder/templates/queryBuilderWrite",["lib/mustache"],function(mustache){var escapedTemplate='<div class="js-left-panel left-panel absleft">\n<div class="js-write-view pagemargin-right relative">\n<div class="js-overlay overlay hidden"></div>\n<div class="js-editor-header"></div>\n<div class="js-editor-view rounded overflow-vertical"></div>\n<div class="js-editor-footer absbottom lightgreybg"></div>\n</div>\n<div class="js-drag-handle singlepadding smallmargin absright abstop absbottom"></div>\n</div>\n<div class="js-right-panel right-panel absright">\n<div class="js-results-view rounded relative">\n<div class="js-overlay overlay">\n<span class="overlay-text lightgrey biggertext">\nType your Query on the left.<br>Then \'Test Query\' to see results.\n</span>\n</div>\n<nav class="js-preview-tabs preview-tabs horizontal-navigation">\n{{#tabs}}\n<a class="js-tab horizontal-navigation--item navbuttonshade singlepadding-left singlepadding-right db floatleft" data-view-id="{{id}}">\n{{name}}\n</a>\n{{/tabs}}\n<div class="clearleft"></div>\n</nav>\n<div class="outdated-notice singlepadding overflow-hidden">\n<div class="notification-info rounded smallpadding-vertical singlepadding-horizontal">\nYou\'ve changed your Query. Click <a class="js-preview linkwhite">Test Query</a> to update results.\n</div>\n</div>\n<div class="js-tabs-container tabs-container overflow-vertical bwscrollbar singlepadding-horizontal singlepadding-bottom">\n{{#tabs}}\n<div class="js-tab-container tab-container" data-view-id="{{id}}"></div>\n{{/tabs}}\n</div>\n</div>\n<div class="js-help-view help-view overflow-vertical relative hidden">\n</div>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/querybuilder/css/queryBuilderWrite.css",["css!src/querybuilder/css/compiled.css"],function(){});define("src/querybuilder/views/QueryBuilderWriteView",["jquery","underscore","backbone","src/globals/theme","src/views/QueryEditorView","src/components/mentions/_testsearch/views/TestSearchResultsView","src/views/QueryCreationWarningView","src/views/QueryFormUserErrorView","src/querybuilder/previewFetcher","src/querybuilder/views/QueryEditorHeaderView","src/querybuilder/views/QueryEditorFooterView","src/querybuilder/views/QueryHelpRequestView","src/querybuilder/views/TopicsPreviewTabView","src/querybuilder/views/TopListPreviewTabView","src/querybuilder/views/HistoryPreviewTabView","src/querybuilder/queryTestsearchHelper","src/querybuilder/models/TestSearchTopicsCollection","src/querybuilder/models/TestSearchTopListCollection","src/components/mentions/_testsearch/models/TestSearchHistoryCollection","src/ApiError","src/events/globalEventNames","src/events/queryEvents","mustache!src/querybuilder/templates/queryBuilderWrite","css!src/querybuilder/css/queryBuilderWrite.css","lib/jquery.event.drag-2.2"],function($,_,Backbone,theme,QueryEditorView,TestSearchResultsView,QueryCreationWarningView,QueryFormUserErrorView,previewFetcher,QueryEditorHeaderView,QueryEditorFooterView,QueryHelpRequestView,TopicsPreviewTabView,TopListPreviewTabView,HistoryPreviewTabView,queryTestsearchHelper,TestSearchTopicsCollection,TestSearchTopListCollection,TestSearchHistoryCollection,ApiError,globalEventNames,queryEvents,renderQueryBuilderWriteTemplate){"use strict";var QUERY_EVENT_NAMES=globalEventNames.QUERIES;var INVALID_DATE_RANGE_ERROR=200;function setupDrag(view){var $leftPane=view.$(".js-left-panel"),$rightPane=view.$(".js-right-panel"),leftMinWidth=parseInt($leftPane.css("min-width"),10),rightMinWidth=parseInt($rightPane.css("min-width"),10);$leftPane.drag("start",function(ev,dd){dd.width=$(this).width();view.queryEditorHeaderView.closeLocationOperators()}).drag(function(ev,dd){var requestedWidth=dd.width+dd.deltaX,maxWidth=view.$el.outerWidth()-rightMinWidth,newWidth=Math.min(requestedWidth,maxWidth);updatePaneWidths(view,Math.max(leftMinWidth,newWidth))},{handle:".js-drag-handle"})}function updatePaneWidths(view,leftPaneWidth){var $leftPane=view.$(".js-left-panel"),$rightPane=view.$(".js-right-panel"),availWidth=view.$el.outerWidth(),handleWidth=view.$(".js-drag-handle").outerWidth(),rightPaneWidth,halfWidth;if(leftPaneWidth){rightPaneWidth=Math.max(availWidth-leftPaneWidth,parseInt($rightPane.css("min-width"),10));leftPaneWidth=availWidth-rightPaneWidth}else{halfWidth=(availWidth-handleWidth)/2;leftPaneWidth=Math.max(parseInt($leftPane.css("min-width"),10),halfWidth+handleWidth);rightPaneWidth=availWidth-leftPaneWidth}$leftPane.width(leftPaneWidth);$rightPane.width(rightPaneWidth);if(view.queryEditorView){view.queryEditorView.resize()}_.each(view.tabViews,function(tab){var tabView=tab.instance;if(typeof tabView.resize!=="function"){return}tabView.resize()})}function updateRemainingCharactersCount(view,queryString){queryString=queryString||"";view.queryEditorFooterView.updateCounter(queryString.length)}function validateChange(view,changedSetting,changedValue){var isValid,validValue;if(!view.validatedSettings){return false}validValue=view.validatedSettings[changedSetting];switch(changedSetting){case"languages":isValid=_.isEqual(validValue.sort(),changedValue.sort());break;case"includedTerms":isValid=validValue&&validValue.join()===changedValue;break}view.invalidSettings=_(view.invalidSettings).without(changedSetting);if(!isValid){view.invalidSettings.push(changedSetting)}return!view.invalidSettings.length}function signalValidationStatus(view,valid){if(!valid){view.queryEditorFooterView.toggleFormButtons();return view.trigger("invalid")}view.queryEditorFooterView.disableTestSearch();view.trigger("valid")}function onTestsearchSuccess(view){view.setEstimatedResultsToContext();if(view.resultsCollection.term!==view.queryEditorView.getQueryString()){view.invalidSettings=["includedTerms"];signalValidationStatus(view,false);return}view.invalidSettings=[];view.validatedSettings=_.extend({languages:view.model.get("languages")},view.queryEditorView.getValues());checkForTriggeringNotification(view);signalValidationStatus(view,true)}function onTestsearchError(view,response){var testsearchWasAborted=response.statusText&&response.statusText==="abort",error,errorType,errorMessage;if(testsearchWasAborted){return}error=new ApiError(response);errorType=error.response.errorType;errorMessage=error.message||[].concat(error.nonIssueErrors).join(", ");if(errorType==="user"){showUserError(view,errorMessage);return}if(error.errorMessages[0]&&error.errorMessages[0].code===INVALID_DATE_RANGE_ERROR){errorMessage="Sorry, we are unable to fetch results: "+error.errorMessages[0].message}view.validatedSettings=undefined;signalValidationStatus(view,false);hidePreviewOverlay(view);triggerNotification(view,{text:errorMessage})}function checkForTriggeringNotification(view){var queryCreationRulesResult;var resultsMetaData=view.resultsCollection.resultsMetaData(view.model.get("samplePercent"));if(view.queryCreationRules.isOverDailyMentionLimit(view.context.estimatedDailyResults)){triggerNotification(view,view.getOverDailyMentionLimitNotificationOptions());return}queryCreationRulesResult=view.queryCreationRules.checkCanCreateNewQueryWithTheseSearchResults(resultsMetaData);checkCreationRulesResult(view,queryCreationRulesResult)}function onValidationCompleted(view,validationModel){var hasValidationErrors,hasValidationWarning;if(!validationModel){throw new Error("no validationModel where passed")}hasValidationErrors=!validationModel.get("valid");hasValidationWarning=!!validationModel.get("issueWarningCount");view.queryEditorView.showIssuesInEditor(validationModel.get("issues"));if(hasValidationErrors){view.validatedSettings=undefined;return showValidationErrorAsNotification(view,validationModel.toJSON())}hidePreviewOverlay(view);fetchTabCollections(view);if(hasValidationWarning){return showValidationWarningAsNotification(view,validationModel.toJSON())}removeNotifications(view)}function onValidationRejected(view,response){var validationWasAborted=response.statusText&&response.statusText==="abort";if(validationWasAborted){return}fetchTabCollections(view)}function buildMentionsTabCollectionFetchParameters(view){return _.extend({},{queryModel:view.model,collection:view.resultsCollection})}function buildTabCollectionFetchParameters(queryModel){return _.extend({},queryTestsearchHelper.buildFetchOptions({queryModel:queryModel}))}function fetchTabCollections(view){var fetchMentionsTabOptions=buildMentionsTabCollectionFetchParameters(view),fetchTabCollectionOptions=buildTabCollectionFetchParameters(view.model);queryTestsearchHelper.fetchTestsearch(fetchMentionsTabOptions).then(_.partial(onTestsearchSuccess,view)).catch(_.partial(onTestsearchError,view));_(view.tabViews).reject(function(val,key){return key==="mentions"}).forEach(function(tabView){return previewFetcher.loadData(tabView.instance,fetchTabCollectionOptions)},view)}function hidePreviewOverlay(view){view.$(".js-results-view .overlay").addClass("hidden")}function toggleTestQueryPrompt(view,isValid){var requestMade=!_.isEmpty(view.validatedSettings),showPrompt=requestMade&&!isValid;view.$(".js-results-view").toggleClass("show-test-query-prompt",showPrompt)}function previewResults(view){var queryEditorView=view.queryEditorView,project=view.project,queryLangs=view.model.get("languages")||project.get("defaultLangCodes"),hasValidTerms=queryEditorView.validate(),hasValidLanguages=queryLangs;view.queryEditorView.clearIssuesInEditor();if(!hasValidTerms||!hasValidLanguages){return}view.model.set(_.extend({languages:queryLangs},queryEditorView.getValues()));view.queryEditorFooterView.disableTestSearch();queryTestsearchHelper.validate(view.model).then(_.partial(onValidationCompleted,view)).catch(_.partial(onValidationRejected,view));toggleTestQueryPrompt(view,true)}function renderQueryEditorHeaderView(view){var queryEditorHeaderView=view.queryEditorHeaderView=new QueryEditorHeaderView({model:view.model,languages:view.languages});view.$(".js-editor-header").append(queryEditorHeaderView.$el);queryEditorHeaderView.render()}function renderQueryEditorFooterView(view){var queryEditorFooterView=view.queryEditorFooterView=new QueryEditorFooterView;view.$(".js-editor-footer").append(queryEditorFooterView.$el);view.listenTo(queryEditorFooterView,"editor-preview",function(){triggerTestsearchUsedEvent(view,"mouse");previewResults(view)});view.listenTo(queryEditorFooterView,"editor-help",_.partial(showHelpRequestView,view));queryEditorFooterView.render()}function renderQueryEditorView(view,onEditorReady){var queryEditorView=view.queryEditorView=new QueryEditorView({model:view.model});view.$(".js-editor-view").append(queryEditorView.$el);view.listenToOnce(queryEditorView,"editor-ready",onEditorReady);view.listenTo(queryEditorView,"editor-preview",function(){triggerTestsearchUsedEvent(view,"keyboard");if(view.validatedSettings&&!view.invalidSettings.length){return}previewResults(view)});view.listenTo(queryEditorView,"change",function onQueryEditorChanged(){var value=queryEditorView.getQueryString(),isValid=validateChange(view,"includedTerms",value);signalValidationStatus(view,isValid);toggleTestQueryPrompt(view,isValid);updateRemainingCharactersCount(view,value)});queryEditorView.render()}function cleanUpSubView(view,subviewName){if(view[subviewName]){view[subviewName].remove();view[subviewName]=undefined}}function showUserError(view,message){if(!view.queryFormUserErrorView){view.queryFormUserErrorView=new QueryFormUserErrorView({message:message});view.listenToOnce(view.queryFormUserErrorView,"closed",function(){view.queryFormUserErrorView=undefined})}}function triggerNotification(view,notificationOptions){view.trigger("notification",_.extend({cssClass:"notification-error",text:"An error occurred. Please try again later or contact support",omitClose:true},notificationOptions))}function removeNotifications(view){view.trigger("removeNotification")}function getValidationErrorMessageText(validationResults){var issueErrorCount=validationResults.issueErrorCount,nonIssueErrors=validationResults.errors||[];if(issueErrorCount>0){return"Please fix "+issueErrorCount+" error"+(issueErrorCount>1?"s":"")+'. <a class="help icon-bwhelp dib customtip" '+'data-key="query-error-more-details" title="How to find error details"></a>'}if(nonIssueErrors.length){return"Please fix this error:"+nonIssueErrors.join(",")+". Sorry, in this case we can't detect the position."}}function showValidationErrorAsNotification(view,validationResults){var message=getValidationErrorMessageText(validationResults);if(!message){return}triggerNotification(view,{text:message,onShown:function onShown($notification){$notification.find(".customtip").customtip()}})}function showValidationWarningAsNotification(view,validationResults){var warningCount=validationResults.issueWarningCount;triggerNotification(view,{cssClass:"notification-warning",text:"We've highlighted "+warningCount+(warningCount>1?" issues":" issue")+" that we recommend checking",omitClose:false})}function toggleHelpRequestForm(view){view.$(".js-results-view, .js-help-view, .js-overlay").toggleClass("hidden")}function createHelpView(view,queryString){var helpView=new QueryHelpRequestView({queryString:queryString,el:view.$(".js-help-view")});helpView.render();view.listenTo(helpView,"cancelled",function(){toggleHelpRequestForm(view)});view.listenTo(helpView,"requested",function(){toggleHelpRequestForm(view);triggerNotification(view,{cssClass:"notification-info",text:"We have attempted to create an email message in your <b>defaul email client</b>.",omitClose:false,actions:[{text:"Try again",action:function action(){if(view.$(".js-help-view").hasClass("hidden")){toggleHelpRequestForm(view)}removeNotifications(view)}}]})});return helpView}function showHelpRequestView(view){var currentString=view.queryEditorView.getQueryString(),helpView=view.helpRequestView;if(helpView){helpView.queryString=currentString}else{view.helpRequestView=helpView=createHelpView(view,currentString)}toggleHelpRequestForm(view);helpView.setFocus()}function triggerTabShownEvent(view,tabId){var data=_(view.context.analyticsData||{}).pick("queryId","processId","isNew");queryEvents.trigger(QUERY_EVENT_NAMES.QUERY_BUILDER_TAB_SHOWN,_(data).extend({tabId:tabId}))}function triggerTestsearchUsedEvent(view,source){var data=_(view.context.analyticsData||{}).pick("queryId","processId","isNew");queryEvents.trigger(QUERY_EVENT_NAMES.QUERY_BUILDER_TESTSEARCH_USED,_(data).extend({source:source}))}function triggerTopicClicked(viewType,topic){queryEvents.trigger(QUERY_EVENT_NAMES.QUERY_BUILDER_TESTSEARCH_TOPIC_CLICKED,viewType,topic)}function triggerTopicResultsBackClicked(viewType){queryEvents.trigger(QUERY_EVENT_NAMES.QUERY_BUILDER_TESTSEARCH_TOPIC_RESULTS_BACK_BUTTON_CLICKED,viewType)}function triggerTopicViewSwitched(viewType){queryEvents.trigger(QUERY_EVENT_NAMES.QUERY_BUILDER_TESTSEARCH_TOPICS_VIEW_SWITCHED,viewType)}function initializeTabViews(view){var topicsView;_.each(view.tabViews,function(tab){tab.instance=new tab.ViewClass(tab.options);view.listenTo(tab.instance,"resetTabsContainerScrollTop",function(){view.$(".js-tabs-container").scrollTop(0)});view.listenTo(tab.instance,"reload",function(){previewResults(view)})},view);topicsView=view.tabViews.topics.instance;view.listenTo(topicsView,TopicsPreviewTabView.CLICKTHROUGH_EVENT,triggerTopicClicked);view.listenTo(topicsView,TopicsPreviewTabView.GO_BACK_EVENT,triggerTopicResultsBackClicked);view.listenTo(topicsView,TopicsPreviewTabView.SWITCH_VIEW_EVENT,triggerTopicViewSwitched)}function renderTabViews(view,orderdTabViews){var tabId;orderdTabViews.forEach(function(tab){var $tabContainer=view.$('.js-tab-container[data-view-id="'+tab.id+'"]'),tabView=tab.instance;tabView.render();$tabContainer.html(tabView.$el)});tabId=orderdTabViews[0].id;showTab(view,tabId)}function showTab(view,id){var $tab=view.$('.js-tab[data-view-id="'+id+'"]'),$tabContainer=view.$('.js-tab-container[data-view-id="'+id+'"]'),tabView=(view.tabViews[id]||{}).instance;if(!tabView){return}$tab.addClass("active").siblings().removeClass("active");$tabContainer.removeClass("hidden").siblings().addClass("hidden");if(typeof tabView.shown==="function"){tabView.shown()}previewFetcher.loadView(tabView)}function cleanUpTabViews(view){_.each(view.tabViews,function(tab){tab.instance.remove()});view.tabViews={}}function getOrderedTabViews(tabViews){var tabList=[];_.each(tabViews,function(tab,id){tab.id=id;tabList.push(tab)});return _.sortBy(tabList,"index")}function checkCreationRulesResult(view,rulesResult){var reason=rulesResult.reason,reasonData=rulesResult.data,queryCreationAllowed=rulesResult.isAllowed;if(reason){triggerNotification(view,{cssClass:queryCreationAllowed?"notification-warning":"notification-error",text:QueryCreationWarningView.getNotificationMessage(reason),omitClose:!queryCreationAllowed,actions:[{text:"Show Details",action:function action(){QueryCreationWarningView.show({reason:reason,reasonData:reasonData,isQueryBuilder:true})}}]})}if(!queryCreationAllowed){view.validatedSettings=undefined;signalValidationStatus(view,false)}}function isValid(view){return view.validatedSettings&&!view.invalidSettings.length}return Backbone.View.extend({className:"queryBuilderWriteView clearfix",events:{"click .js-tab":function onClickTab(e){var id=$(e.currentTarget).data("view-id");showTab(this,id);triggerTabShownEvent(this,id)},"click .js-preview":function onClickPreview(){previewResults(this)}},constructor:function QueryBuilderWriteView(options){var model,requiredOptions=["model","context","queryCreationRules","project","languages","resultsCollection"];Backbone.View.apply(this,arguments);options=options||{};requiredOptions.forEach(function(property){if(!options[property]){throw new Error("QueryBuilderWriteView must be initialized with options."+property)}});model=this.model;this._attachModelListeners(model);this.queryCreationRules=options.queryCreationRules;this.project=options.project;this.languages=options.languages;this.resultsCollection=options.resultsCollection;this.context=options.context;this.invalidSettings=[];this.validatedSettings=model.isNew()?undefined:{languages:model.get("languages"),includedTerms:model.get("includedTerms")};this.historyCollection=new TestSearchHistoryCollection;this.topicsCollection=new TestSearchTopicsCollection;this.sitesCollection=new TestSearchTopListCollection(null,{mentionType:"site"});this.authorsCollection=new TestSearchTopListCollection(null,{mentionType:"author"});this.tabViews=this.getTabViewSpec();initializeTabViews(this)},_attachModelListeners:function _attachModelListeners(model){this.listenTo(model,"change:languages",this._onModelAttributeChanged("languages"));this.listenTo(model,"change:languageAgnostic",this._onModelAttributeChanged("languageAgnostic"))},_onModelAttributeChanged:function _onModelAttributeChanged(attributeName){return function(model,changedAttributes){if(isValid(this)){previewResults(this)}signalValidationStatus(this,validateChange(this,attributeName,changedAttributes))}},render:function render(){var view=this,orderdTabViews=getOrderedTabViews(this.tabViews);this.$el.html(renderQueryBuilderWriteTemplate({hasHelpMenu:theme.isBrandwatchOrGreyLabelTheme(),tabs:orderdTabViews}));renderTabViews(view,orderdTabViews);renderQueryEditorHeaderView(view);renderQueryEditorFooterView(view);renderQueryEditorView(this,function onEditorReady(){var isNew=view.model.isNew();setupDrag(view);updatePaneWidths(this);signalValidationStatus(view,!isNew);updateRemainingCharactersCount(view,view.queryEditorView.getQueryString());if(!isNew){hidePreviewOverlay(view);previewResults(this)}if(this.queryEditorHeaderView){this.queryEditorHeaderView.triggerLanguageOverviewTooltip()}this.trigger("rendered")})},remove:function remove(){delete this.resultsCollection;cleanUpSubView(this,"queryEditorView");cleanUpSubView(this,"queryEditorHeaderView");cleanUpSubView(this,"queryEditorFooterView");cleanUpTabViews(this);Backbone.View.prototype.remove.apply(this,arguments)},resize:function resize(){var leftPanelWidth=this.$(".js-left-panel").width();updatePaneWidths(this,leftPanelWidth)},setEstimatedResultsToContext:function setEstimatedResultsToContext(){var samplePercent=this.model.get("samplePercent"),metaData=this.resultsCollection.resultsMetaData(samplePercent);_.extend(this.context,metaData)},getOverDailyMentionLimitNotificationOptions:function getOverDailyMentionLimitNotificationOptions(){var view=this;return{text:"This Query will return more than 1 million mentions per day. Please change your Query or reduce the "+'"Sample of Mentions" in the <a class="action" id="js-go-next">Query set up</a>.',cssClass:"notification-warning",omitClose:true,onShown:function onShown($notification){$notification.find("#js-go-next").click(function(){view.trigger("nextStep")})}}},shown:function shown(){checkForTriggeringNotification(this);this.resize()},getTabViewSpec:function getTabViewSpec(){var view=this;return{mentions:{index:0,name:"Mentions Preview",ViewClass:TestSearchResultsView,options:{collection:view.resultsCollection},instance:null},history:{index:1,name:"History",ViewClass:HistoryPreviewTabView,options:{collection:view.historyCollection},instance:null},topics:{index:2,name:"Topics",ViewClass:TopicsPreviewTabView,options:{collection:view.topicsCollection,mentionType:"topic"},instance:null},sites:{index:3,name:"Sites",ViewClass:TopListPreviewTabView,options:{collection:view.sitesCollection,mentionType:"site",percentageColumnTooltip:"The percentages show how much share of voice a Site has "+"compared to all Mentions found for this Query."},instance:null},authors:{index:4,name:"Authors",ViewClass:TopListPreviewTabView,options:{collection:view.authorsCollection,mentionType:"author",cssClass:"orange",percentageColumnTooltip:"The percentages show how active an "+"Author is compared to all Mentions found for this Query.",demonstrative:"This"},instance:null}}}})});define("mustache!templates/querySamplingSlider",["lib/mustache"],function(mustache){var escapedTemplate='<input class="query-sampling-slider threecol" name="query-sampling-slider" type="range" min="{{min}}" max="{{max}}" step="{{step}}" value="{{value}}">\n<span class="js-query-sampling-value dib textright">{{value}}</span>%\n{{^hideHelpIcon}}\n<a class="help icon-bwhelp queryTypeHelp singlemargin-right" data-key="query-creation-query-sampling"></a>\n{{/hideHelpIcon}}\n<div class="js-estimated-mentions-per-month"></div>\n<div class="js-estimated-mentions-per-day"></div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!templates/querySamplingSliderMentionsNumber",["lib/mustache"],function(mustache){var escapedTemplate='{{#mentionsCount}}<b>estimated</b> <span {{#isOverMentionLimit}}class="negative"{{/isOverMentionLimit}}><b>{{mentionsCount}}</b> Mentions/{{mentionsUnit}}</span>{{/mentionsCount}}\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});(function(factory){"use strict";if(typeof define==="function"&&define.amd){define("rangeslider",["jquery"],factory)}else if(typeof exports==="object"){module.exports=factory(require("jquery"))}else{factory(jQuery)}})(function($){"use strict";Number.isNaN=Number.isNaN||function(value){return typeof value==="number"&&value!==value};function supportsRange(){var input=document.createElement("input");input.setAttribute("type","range");return input.type!=="text"}var pluginName="rangeslider",pluginIdentifier=0,hasInputRangeSupport=supportsRange(),defaults={polyfill:true,orientation:"horizontal",rangeClass:"rangeslider",disabledClass:"rangeslider--disabled",horizontalClass:"rangeslider--horizontal",verticalClass:"rangeslider--vertical",fillClass:"rangeslider__fill",handleClass:"rangeslider__handle",startEvent:["mousedown","touchstart","pointerdown"],moveEvent:["mousemove","touchmove","pointermove"],endEvent:["mouseup","touchend","pointerup"]},constants={orientation:{horizontal:{dimension:"width",direction:"left",directionStyle:"left",coordinate:"x"},vertical:{dimension:"height",direction:"top",directionStyle:"bottom",coordinate:"y"}}};function delay(fn,wait){var args=Array.prototype.slice.call(arguments,2);return setTimeout(function(){return fn.apply(null,args)},wait)}function debounce(fn,debounceDuration){debounceDuration=debounceDuration||100;return function(){if(!fn.debouncing){var args=Array.prototype.slice.apply(arguments);fn.lastReturnVal=fn.apply(window,args);fn.debouncing=true}clearTimeout(fn.debounceTimeout);fn.debounceTimeout=setTimeout(function(){fn.debouncing=false},debounceDuration);return fn.lastReturnVal}}function isHidden(element){return element&&(element.offsetWidth===0||element.offsetHeight===0||element.open===false)}function getHiddenParentNodes(element){var parents=[],node=element.parentNode;while(isHidden(node)){parents.push(node);node=node.parentNode}return parents}function getDimension(element,key){var hiddenParentNodes=getHiddenParentNodes(element),hiddenParentNodesLength=hiddenParentNodes.length,inlineStyle=[],dimension=element[key];function toggleOpenProperty(element){if(typeof element.open!=="undefined"){element.open=element.open?false:true}}if(hiddenParentNodesLength){for(var i=0;i<hiddenParentNodesLength;i++){inlineStyle[i]=hiddenParentNodes[i].style.cssText;if(hiddenParentNodes[i].style.setProperty){hiddenParentNodes[i].style.setProperty("display","block","important")}else{hiddenParentNodes[i].style.cssText+=";display: block !important"}hiddenParentNodes[i].style.height="0";hiddenParentNodes[i].style.overflow="hidden";hiddenParentNodes[i].style.visibility="hidden";toggleOpenProperty(hiddenParentNodes[i])}dimension=element[key];for(var j=0;j<hiddenParentNodesLength;j++){hiddenParentNodes[j].style.cssText=inlineStyle[j];toggleOpenProperty(hiddenParentNodes[j])}}return dimension}function tryParseFloat(str,defaultValue){var value=parseFloat(str);return Number.isNaN(value)?defaultValue:value}function ucfirst(str){return str.charAt(0).toUpperCase()+str.substr(1)}function Plugin(element,options){this.$window=$(window);this.$document=$(document);this.$element=$(element);this.options=$.extend({},defaults,options);this.polyfill=this.options.polyfill;this.orientation=this.$element[0].getAttribute("data-orientation")||this.options.orientation;this.onInit=this.options.onInit;this.onSlide=this.options.onSlide;this.onSlideEnd=this.options.onSlideEnd;this.DIMENSION=constants.orientation[this.orientation].dimension;this.DIRECTION=constants.orientation[this.orientation].direction;this.DIRECTION_STYLE=constants.orientation[this.orientation].directionStyle;this.COORDINATE=constants.orientation[this.orientation].coordinate;if(this.polyfill){if(hasInputRangeSupport){return false}}this.identifier="js-"+pluginName+"-"+pluginIdentifier++;this.startEvent=this.options.startEvent.join("."+this.identifier+" ")+"."+this.identifier;this.moveEvent=this.options.moveEvent.join("."+this.identifier+" ")+"."+this.identifier;this.endEvent=this.options.endEvent.join("."+this.identifier+" ")+"."+this.identifier;this.toFixed=(this.step+"").replace(".","").length-1;this.$fill=$('<div class="'+this.options.fillClass+'" />');this.$handle=$('<div class="'+this.options.handleClass+'" />');this.$range=$('<div class="'+this.options.rangeClass+" "+this.options[this.orientation+"Class"]+'" id="'+this.identifier+'" />').insertAfter(this.$element).prepend(this.$fill,this.$handle);this.$element.css({position:"absolute",width:"1px",height:"1px",overflow:"hidden",opacity:"0"});this.handleDown=$.proxy(this.handleDown,this);this.handleMove=$.proxy(this.handleMove,this);this.handleEnd=$.proxy(this.handleEnd,this);this.init();var _this=this;this.$window.on("resize."+this.identifier,debounce(function(){delay(function(){_this.update(false,false)},300)},20));this.$document.on(this.startEvent,"#"+this.identifier+":not(."+this.options.disabledClass+")",this.handleDown);this.$element.on("change."+this.identifier,function(e,data){if(data&&data.origin===_this.identifier){return}var value=e.target.value,pos=_this.getPositionFromValue(value);_this.setPosition(pos)})}Plugin.prototype.init=function(){this.update(true,false);if(this.onInit&&typeof this.onInit==="function"){this.onInit()}};Plugin.prototype.update=function(updateAttributes,triggerSlide){updateAttributes=updateAttributes||false;if(updateAttributes){this.min=tryParseFloat(this.$element[0].getAttribute("min"),0);this.max=tryParseFloat(this.$element[0].getAttribute("max"),100);this.value=tryParseFloat(this.$element[0].value,Math.round(this.min+(this.max-this.min)/2));this.step=tryParseFloat(this.$element[0].getAttribute("step"),1)}this.handleDimension=getDimension(this.$handle[0],"offset"+ucfirst(this.DIMENSION));this.rangeDimension=getDimension(this.$range[0],"offset"+ucfirst(this.DIMENSION));this.maxHandlePos=this.rangeDimension-this.handleDimension;this.grabPos=this.handleDimension/2;this.position=this.getPositionFromValue(this.value);if(this.$element[0].disabled){this.$range.addClass(this.options.disabledClass)}else{this.$range.removeClass(this.options.disabledClass)}this.setPosition(this.position,triggerSlide)};Plugin.prototype.handleDown=function(e){this.$document.on(this.moveEvent,this.handleMove);this.$document.on(this.endEvent,this.handleEnd);if((" "+e.target.className+" ").replace(/[\n\t]/g," ").indexOf(this.options.handleClass)>-1){return}var pos=this.getRelativePosition(e),rangePos=this.$range[0].getBoundingClientRect()[this.DIRECTION],handlePos=this.getPositionFromNode(this.$handle[0])-rangePos,setPos=this.orientation==="vertical"?this.maxHandlePos-(pos-this.grabPos):pos-this.grabPos;this.setPosition(setPos);if(pos>=handlePos&&pos<handlePos+this.handleDimension){this.grabPos=pos-handlePos}};Plugin.prototype.handleMove=function(e){e.preventDefault();var pos=this.getRelativePosition(e);var setPos=this.orientation==="vertical"?this.maxHandlePos-(pos-this.grabPos):pos-this.grabPos;this.setPosition(setPos)};Plugin.prototype.handleEnd=function(e){e.preventDefault();this.$document.off(this.moveEvent,this.handleMove);this.$document.off(this.endEvent,this.handleEnd);this.$element.trigger("change",{origin:this.identifier});if(this.onSlideEnd&&typeof this.onSlideEnd==="function"){this.onSlideEnd(this.position,this.value)}};Plugin.prototype.cap=function(pos,min,max){if(pos<min){return min}if(pos>max){return max}return pos};Plugin.prototype.setPosition=function(pos,triggerSlide){var value,newPos;if(triggerSlide===undefined){triggerSlide=true}value=this.getValueFromPosition(this.cap(pos,0,this.maxHandlePos));newPos=this.getPositionFromValue(value);this.$fill[0].style[this.DIMENSION]=newPos+this.grabPos+"px";this.$handle[0].style[this.DIRECTION_STYLE]=newPos+"px";this.setValue(value);this.position=newPos;this.value=value;if(triggerSlide&&this.onSlide&&typeof this.onSlide==="function"){this.onSlide(newPos,value)}};Plugin.prototype.getPositionFromNode=function(node){var i=0;while(node!==null){i+=node.offsetLeft;node=node.offsetParent}return i};Plugin.prototype.getRelativePosition=function(e){var ucCoordinate=ucfirst(this.COORDINATE),rangePos=this.$range[0].getBoundingClientRect()[this.DIRECTION],pageCoordinate=0;if(typeof e["page"+ucCoordinate]!=="undefined"){pageCoordinate=e["client"+ucCoordinate]}else if(typeof e.originalEvent["client"+ucCoordinate]!=="undefined"){pageCoordinate=e.originalEvent["client"+ucCoordinate]}else if(e.originalEvent.touches&&e.originalEvent.touches[0]&&typeof e.originalEvent.touches[0]["client"+ucCoordinate]!=="undefined"){pageCoordinate=e.originalEvent.touches[0]["client"+ucCoordinate]}else if(e.currentPoint&&typeof e.currentPoint[this.COORDINATE]!=="undefined"){pageCoordinate=e.currentPoint[this.COORDINATE]}return pageCoordinate-rangePos};Plugin.prototype.getPositionFromValue=function(value){var percentage,pos;percentage=(value-this.min)/(this.max-this.min);pos=!Number.isNaN(percentage)?percentage*this.maxHandlePos:0;return pos};Plugin.prototype.getValueFromPosition=function(pos){var percentage,value;percentage=pos/(this.maxHandlePos||1);value=this.step*Math.round(percentage*(this.max-this.min)/this.step)+this.min;return Number(value.toFixed(this.toFixed))};Plugin.prototype.setValue=function(value){if(value===this.value&&this.$element[0].value!==""){return}this.$element.val(value).trigger("input",{origin:this.identifier})};Plugin.prototype.destroy=function(){this.$document.off("."+this.identifier);this.$window.off("."+this.identifier);this.$element.off("."+this.identifier).removeAttr("style").removeData("plugin_"+pluginName);if(this.$range&&this.$range.length){this.$range[0].parentNode.removeChild(this.$range[0])}};$.fn[pluginName]=function(options){var args=Array.prototype.slice.call(arguments,1);return this.each(function(){var $this=$(this),data=$this.data("plugin_"+pluginName);if(!data){$this.data("plugin_"+pluginName,data=new Plugin(this,options))}if(typeof options==="string"){data[options].apply(data,args)}})};return"rangeslider.js is available in jQuery context e.g $(selector).rangeslider(options);"});define("css!css/bwslider.css",["css!css/compiled.css"],function(){});define("src/packages/bwslider",["jquery","underscore","rangeslider","css!css/bwslider.css"],function($,_){"use strict";var defaults={polyfill:false,rangeClass:"bw-slider",fillClass:"bw-slider__fill",handleClass:"bw-slider__handle"};$.fn.bwslider=function(options){var settings=_(defaults).clone();options=options||{};return $.fn.rangeslider.call(this,_.extend(settings,options))}});define("css!css/querySamplingSliderView.css",["css!css/compiled.css"],function(){});define("src/views/QuerySamplingSliderView",["jquery","underscore","backbone","bw-fe-helpers/numberHelper","mustache!templates/querySamplingSlider","mustache!templates/querySamplingSliderMentionsNumber","src/packages/bwslider","css!css/querySamplingSliderView.css"],function($,_,Backbone,numberHelper,template,mentionsNumberTemplate){"use strict";var SAMPLING_MIN=1,SAMPLING_MAX=100,SAMPLING_STEP=1,DEFAULT_VALUE=SAMPLING_MAX;function softRender(view,data){var estimatedDailyResults=data.estimatedDailyResults;var estimatedMonthlyResults=data.estimatedMonthlyResults;var monthlyHtml=mentionsNumberTemplate({mentionsCount:numberHelper.prettyNumber(estimatedMonthlyResults),mentionsUnit:"month",isOverMentionLimit:data.isOverMonthlyMentionLimit});var dailyHtml=mentionsNumberTemplate({mentionsCount:numberHelper.prettyNumber(estimatedDailyResults),mentionsUnit:"day",isOverMentionLimit:data.isOverDailyMentionLimit});view.$(".js-estimated-mentions-per-month").html(monthlyHtml);if(data.isOverDailyMentionLimit){view.$(".js-estimated-mentions-per-day").html(dailyHtml)}else{view.$(".js-estimated-mentions-per-day").empty()}}function applyValue(view,value){var intValue=parseInt(value,10);if(_.isNaN(intValue)){return false}if(intValue<SAMPLING_MIN||intValue>SAMPLING_MAX){return false}view.value=intValue;view.$(".js-query-sampling-value").text(intValue);view.trigger("change",intValue)}return Backbone.View.extend({events:{"input input[name=query-sampling-slider]":function onSlide(e){var value=$(e.target).val();applyValue(this,value)}},constructor:function QuerySamplingSliderView(options){options=options||{};this.hideHelpIcon=options.hideHelpIcon;Backbone.View.apply(this,arguments)},render:function render(data){this.value=data.samplePercent||DEFAULT_VALUE;_.extend(data,{min:SAMPLING_MIN,max:SAMPLING_MAX,step:SAMPLING_STEP,value:this.value,hideHelpIcon:this.hideHelpIcon});this.$el.html(template(data));this.rangeslider=this.$("input[name=query-sampling-slider]").bwslider().data("plugin_rangeslider");softRender(this,data);this.render=softRender.bind(undefined,this)},remove:function remove(){if(this.rangeslider){this.rangeslider.destroy();this.rangeslider=undefined}},getValue:function getValue(){return this.value}})});define("mustache!src/querybuilder/templates/queryBuilderSetup",["lib/mustache"],function(mustache){var escapedTemplate='<div class="floatleft halfwidth fullheight doublepadding-right relative">\n<div>\n<label for="name" class="db bold smallpadding-bottom">Query name*</label>\n<input id="name" class="js-query-name field validation-wrapper threecol" data-at="query-editor-query-name-input" name="name" value="{{name}}" placeholder="e.g. My TV Campaigns Query" autocomplete="off" maxlength="1024" />\n</div>\n<div class="doublemargin-top">\n<label for="description" class="db smallpadding-bottom">Description / notes <a data-key="query-creation-description" class="help icon-bwhelp"></a></label>\n<textarea name="description" class="js-description field rounded sixcol"\nplaceholder="e.g. the purpose of this Query is"\nmaxlength="{{descriptionMaxLength}}">{{description}}</textarea>\n</div>\n{{^hideSamplingView}}\n<label class="db bold doublemargin-top" for="query-sampling-slider">Sample of Mentions</label>\n<div class="js-query-sampling-view singlemargin-top"></div>\n{{/hideSamplingView}}\n{{#uhdBackfill}}\n<div class="js-uhd-backfill db doublemargin-top">\n<strong>Unlimited Historical Data</strong> will be retrieved back to\n{{initialBackfillLabel}}. <a data-key="query-uhd-backfill" class="help icon-bwhelp"></a>\n</div>\n{{/uhdBackfill}}\n{{#allowBackfill}}\n<div class="backfillContainer db doublemargin-top">\n<label class="backfillLabel">Retrieve mentions back to</label>\n<span class="backfillToggler">{{initialBackfillLabel}} (<a>change</a>)</span>\n<select class="backfillDuration selectfield twocol hidden">\n{{#backfillValues}}\n<option value="{{value}}" data-hint="{{hint}}">{{label}}</option>\n{{/backfillValues}}\n</select>\n<span class="backfillHint hidden"></span>\n</div>\n{{/allowBackfill}}\n{{#queryIsNew}}\n{{^canCreateSignals}}\n{{> alertsWithoutSignals}}\n{{/canCreateSignals}}\n{{#canCreateSignals}}\n{{> alertsAndSignals}}\n{{/canCreateSignals}}\n{{/queryIsNew}}\n<span class="mediumtext grey absbottom absright doublemargin-right">* required fields</span>\n</div>\n<div class="floatleft halfwidth fullheight doublepadding-left">\n<section class="infobox infoboxtextcolor infoboxbgcolor mediumtext doublepadding-vertical doublemargin-bottom">\n<header class="infobox--header normal dib doublepadding-horizontal singlemargin-bottom">Nearly finished</header>\n<p class="mediumtext-bigline doublepadding-horizontal">\nTo complete your Query just enter a name and click "Next".\n</p>\n</section>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("text!src/querybuilder/templates/partials/queryBuilderAlertCheckbox.template",[],function(){return'<label for="createAlert" class="alert doublemargin-top">\n    <input id="createAlert" name="createAlert" type="checkbox"\n        class="js-create-alert dib valignmiddle tinymargin-right mediumtext"{{#createAlert}} checked{{/createAlert}}>\n    <span class="dib valignmiddle mediumtext">Alert me if the volume increases by</span>\n    <input type="text" name="alertThreshold" class="js-alert-threshold field validation-wrapper mediumtext" value="{{alertThreshold}}" disabled> %\n    <a class="help icon-bwhelp valignmiddle" data-key="query-creation-alert-on-increase" tabindex="-1"></a>\n</label>\n'});define("text!src/signals/templates/partials/queryBuilderSignalCheckbox.template",[],function(){return'<section class="infobox infoboxtextcolor infoboxbgcolor mediumtext singlepadding doublemargin-top alerts sixcolmax">\n    <p class="mediumtext-bigline">\n        Send an alert to {{emailAddress}} when...\n        <label class="signal singlemargin-top db" for="createSignal">\n            <input id="createSignal" name="createSignal" type="checkbox"\n                class="js-create-signal dib valignmiddle tinymargin-right mediumtext"{{#createSignal}} checked{{/createSignal}}>\n            <span class="valignmiddle mediumtext">we find a <b>Signal</b> about potential crises or trends</span>\n            <a class="help icon-bwhelp tinymargin-left valignmiddle" data-key="query-creation-signal"></a>\n        </label>\n        <label class="alert singlemargin-top db" for="createAlert">\n            <input id="createAlert" name="createAlert" type="checkbox"\n                class="js-create-alert dib valignmiddle tinymargin-right mediumtext"{{#createAlert}} checked{{/createAlert}}>\n            <span class="valignmiddle mediumtext">the volume of Mentions increases by</span>\n            <input type="text" name="alertThreshold" class="js-alert-threshold field validation-wrapper mediumtext tinymargin-left"\n                value="{{alertThreshold}}" disabled> %\n            <a class="help icon-bwhelp tinymargin-left valignmiddle" data-key="query-creation-alert-on-increase" tabindex="-1"></a>\n        </label>\n    </p>\n</section>\n'});define("css!src/querybuilder/css/queryBuilderSetup.css",["css!src/querybuilder/css/compiled.css"],function(){});define("src/querybuilder/views/QueryBuilderSetupView",["underscore","backbone","moment","src/globals/me","src/globals/crimsonMode","src/models/Alert","src/models/Query","src/permissions","src/views/QuerySamplingSliderView","src/helpers/validationTooltipHelper","src/querybuilder/queryFormHelper","mustache!src/querybuilder/templates/queryBuilderSetup","text!src/querybuilder/templates/partials/queryBuilderAlertCheckbox.template","text!src/signals/templates/partials/queryBuilderSignalCheckbox.template","css!src/querybuilder/css/queryBuilderSetup.css"],function(_,Backbone,moment,me,crimsonMode,Alert,Query,permissions,QuerySamplingSliderView,validationTooltipHelper,queryFormHelper,renderQueryBuilderSetupTemplate,queryBuilderAlertCheckboxPartial,queryBuilderSignalCheckboxPartial){"use strict";var DEFAULT_BACKFILL_DURATION=1;function updateModelWithUIData(view){var name=_.stripTags(view.$(".js-query-name").val().trim());var description=view.$(".js-description").val().trim().slice(0,Query.descriptionMaxLength);view.model.set({name:name,description:description})}function updateBackfillDuration(view){var backfillDuration=view.$("select.backfillDuration").val()||DEFAULT_BACKFILL_DURATION;view.context.backfillDuration=backfillDuration;if(crimsonMode.enabled()){setMonitorStartDate(view,backfillDuration)}}function getQuerySamplingSliderViewData(view){var samplePercent=view.model.get("samplePercent");var sampledTestsearchResultsMetaData=view.resultsCollection.resultsMetaData(samplePercent);var sampledDailyResults=sampledTestsearchResultsMetaData.estimatedDailyResults;var canCreateNewQuery=view.queryCreationRules.checkCanCreateNewQueryWithTheseSearchResults(sampledTestsearchResultsMetaData);var isOverMonthlyMentionLimit=canCreateNewQuery.reason==="likelyToBreachMonthlyMentionsLimit";var isOverDailyMentionLimit=view.queryCreationRules.isOverDailyMentionLimit(sampledDailyResults);var data={samplePercent:samplePercent,isOverDailyMentionLimit:isOverDailyMentionLimit,isOverMonthlyMentionLimit:isOverMonthlyMentionLimit};return _.extend(data,sampledTestsearchResultsMetaData)}function renderQuerySamplingSliderView(view){removeSubView(view,"querySamplingSliderView");view.querySamplingSliderView=new QuerySamplingSliderView({el:view.$(".js-query-sampling-view")});view.querySamplingSliderView.render(getQuerySamplingSliderViewData(view));view.listenTo(view.querySamplingSliderView,"change",_.throttle(function(samplePercent){view.model.set({samplePercent:samplePercent});_.extend(view.context,view.resultsCollection.resultsMetaData(samplePercent));view.querySamplingSliderView.render(getQuerySamplingSliderViewData(view));view.validate()},100))}function removeSubView(view,subview){if(!view[subview]){return}view.stopListening(view[subview]);view[subview].remove();view[subview]=undefined}function updateAlertDataInContext(view){var $thresholdInput=view.$(".js-alert-threshold");var alertChecked=view.$(".js-create-alert").prop("checked");var alertThreshold;if(alertChecked){alertThreshold=+$thresholdInput.val().trim();view.context.createAlert=alertChecked;view.context.alertThreshold=alertThreshold}else{view.context.createAlert=undefined;view.context.alertThreshold=undefined}}function toggleAlertThresholdInput(view){var alertChecked=view.$(".js-create-alert").prop("checked"),$thresholdInput=view.$(".js-alert-threshold");$thresholdInput.prop("disabled",!alertChecked)}function onUIDataChanged(view){updateModelWithUIData(view);view.validate()}function triggerNotification(view,notificationOptions){view.trigger("notification",_.extend({cssClass:"notification-error",text:view.getOverDailyMentionLimitNotificationText(),omitClose:true},notificationOptions))}function removeNotifications(view){view.trigger("removeNotification")}function toggleDailyMentionLimitErrorNotification(view,isOverDailyMentionLimit){if(isOverDailyMentionLimit){triggerNotification(view,{onShown:function onShown($notification){$notification.find("#js-go-prev").click(function(){view.trigger("prevStep")})}});return}removeNotifications(view)}function updateBackfillHint(view){var $backfillDropdown=view.$(".backfillDuration");if(!$backfillDropdown.length){return}view.$(".backfillHint").text("("+$backfillDropdown.find("option:selected").attr("data-hint")+")")}function toggleBackfillDuration(view){view.$(".backfillToggler").addClass("hidden");view.$(".backfillDuration,.backfillHint").removeClass("hidden")}function setMonitorStartDate(view,backfillDuration){var today=moment();var monitorStartDate=today.subtract(backfillDuration,"months").format("YYYY-MM-01");view.model.set({monitorStartDate:monitorStartDate})}return Backbone.View.extend({className:"queryBuilderSetup clearfix",events:function events(){return{"keyup .js-query-name":_.debounce(function(){updateAlertDataInContext(this);onUIDataChanged(this)},100),"keyup .js-description":_.debounce(function(){onUIDataChanged(this)},100),"change .backfillDuration":function onChangeBackfillDuration(){updateBackfillHint(this);updateBackfillDuration(this)},"change .js-create-signal":function changeJsCreateSignal(){this.context.setupSignals=this.$(".js-create-signal").prop("checked")},"click .backfillToggler a":function clickBackfillTogglerA(){toggleBackfillDuration(this)},"change .js-create-alert":function changeJsCreateAlert(){toggleAlertThresholdInput(this);updateAlertDataInContext(this);onUIDataChanged(this)},"keyup .js-alert-threshold":_.debounce(function(){updateAlertDataInContext(this);onUIDataChanged(this)},100)}},constructor:function QueryBuilderSetupView(options){Backbone.View.apply(this,arguments);if(!options.model){throw new Error("QueryBuilderSetupView requires options.model to be set")}if(!options.project){throw new Error("QueryBuilderSetupView requires options.project to be set")}if(!options.queryCreationRules){throw new Error("QueryBuilderSetupView requires options.queryCreationRules to be set")}if(!options.context){throw new Error("QueryBuilderSetupView requires options.context to be set")}if(!options.resultsCollection){throw new Error("QueryBuilderSetupView requires options.resultsCollection to be set")}this.project=options.project;this.queryCreationRules=options.queryCreationRules;this.context=options.context;this.resultsCollection=options.resultsCollection;this.hideSamplingView=options.hideSamplingView;this.backfillData=this.getBackfillData(this.queryCreationRules.projectUsageSummary);if(this.backfillData.initialBackfillValue){this.context.backfillDuration=this.backfillData.initialBackfillValue;if(crimsonMode.enabled()){setMonitorStartDate(this,this.backfillData.initialBackfillValue)}}},getBackfillData:function getBackfillData(pricingData){return queryFormHelper.getBackfillData(pricingData,this.model)},getOverDailyMentionLimitNotificationText:function getOverDailyMentionLimitNotificationText(){return"Sorry, this Query will return more than 1 million mentions per day which is not possible. Please "+'<a class="action" id="js-go-prev">change your Query</a> or reduce the "Sample of mentions".'},validate:function validate(){var isOverDailyMentionLimit=this.queryCreationRules.isOverDailyMentionLimit(this.context.estimatedDailyResults);var isValid=true;var modelValues=this.model.toJSON();var $alertThreshold=this.$(".js-alert-threshold");toggleDailyMentionLimitErrorNotification(this,isOverDailyMentionLimit);if(isOverDailyMentionLimit){isValid=false}if(!modelValues.name||!modelValues.name.length){isValid=false}validationTooltipHelper.hideError($alertThreshold);if(this.context.createAlert){if(!queryFormHelper.isValidAlertThreshold(this.context.alertThreshold)){isValid=false;validationTooltipHelper.showError("Threshold must be a non-zero positive integer",$alertThreshold)}}if(!isValid){this.trigger("invalid");return}this.trigger("valid")},renderSubViews:function renderSubViews(){if(!this.hideSamplingView){renderQuerySamplingSliderView(this)}},render:function render(){var model=this.model;var data=_.extend({name:model.get("name")||"",description:model.get("description"),descriptionMaxLength:Query.descriptionMaxLength,queryIsNew:model.isNew(),canCreateSignals:permissions.check("see.signals"),alertThreshold:Alert.DEFAULT_ALERT_THRESHOLD,cid:this.cid,hideSamplingView:this.hideSamplingView,emailAddress:me.get("username")},this.backfillData);var partials={alertsWithoutSignals:queryBuilderAlertCheckboxPartial,alertsAndSignals:queryBuilderSignalCheckboxPartial};this.$el.html(renderQueryBuilderSetupTemplate(data,partials));this.renderSubViews();this.trigger("rendered")},remove:function remove(){removeSubView(this,"querySamplingSliderView");Backbone.View.prototype.remove.apply(this,arguments)},shown:function shown(){this.validate();this.renderSubViews()}})});define("src/querybuilder/queryBuilderUsageChartConfig",["bw-fe-helpers/numberHelper"],function(numberHelper){"use strict";var tooltipTexts={currentAvailable:"Mentions that weren't used in the last 30 days",currentUsed:"Mentions used by your Queries in the last 30 days",estimateAvailable:"Estimate of remaining mentions after saving this Query",estimateOver:"This shows by how much this Query may exceed your mention limit. If a lot, please check the Query settings.",estimateOk:"Estimated amount of mentions this Query will use up from your allowance",estimateUsed:"We assume the Queries you already have set up will use the same as in the last 30 days"},patterns={"59be9e":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAApCAMAAACfvvDEAAAADFBMVEVrxKddv6BZvp5yxquvhc/FAAAAeElEQVR"+"42o3SIRIDQQzEQHnz/z8HChwYDe6yieDed8fvM6o7onuP6JTDKYdTDqccTjmccjjlcMro3pEd+R75L8Uph1MOpxxOOZyyuPRXSHT3aM6SQ/gkpyzhs5xyOeV"+"yyuWUw7nqDnII5GDIYZEDJIfKcsrllMO5P6u+Dw9fVogzAAAAAElFTkSuQmCC","63bda6":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAApCAMAAACfvvDEAAAADFBMVEVztpxnsZZjsJR6t6AsY7RlAAAAeElEQVR"+"42o3SIRIDQQzEQHnz/z8HChwYDe6yieDed8fvM6o7onuP6JTDKYdTDqccTjmccjjlcMro3pEd+R75L8Uph1MOpxxOOZyyuPRXSHT3aM6SQ/gkpyzhs5xyOeV"+"yyuWUw7nqDnII5GDIYZEDJIfKcsrllMO5P6u+Dw9fVogzAAAAAElFTkSuQmCC","9158af":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAApCAMAAACfvvDEAAAADFBMVEWdabeUXLGRWK+hb7pJ4m8kAAAAeElEQVR"+"42o3SIRIDQQzEQHnz/z8HChwYDe6yieDed8fvM6o7onuP6JTDKYdTDqccTjmccjjlcMro3pEd+R75L8Uph1MOpxxOOZyyuPRXSHT3aM6SQ/gkpyzhs5xyOeV"+"yyuWUw7nqDnII5GDIYZEDJIfKcsrllMO5P6u+Dw9fVogzAAAAAElFTkSuQmCC",f4f4f4:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAApCAMAAACfvvDEAAAACVBMVEX09PT39/f4+Piej8ctAAAAU0lEQVR42u3"+"TIQ4AMAgEwYP/P7pyRcUim4bVE9SRClH11dTVuncdieNghq6R4pDikOqQPuiYQ5pDmkPuI33kMnWFtKFm6JDikOqQPuiYQ5pDiqMDf+QGF2MZxaMAAAAASUV"+"ORK5CYII="};function getPattern(color){if(!patterns[color]){throw new Error('Pattern "'+color+'" does not exist, please create the pattern according to highcharts.patternfill.md')}return patterns[color]}function generateDataLabelFormatter(suffixText){suffixText=suffixText||"";return function(){if(this.y===0){return}return"  "+numberHelper.prettyNumber(this.y)+suffixText}}function getConfig($container,series,defs){var pointWidth=48,borderWidth=2,width=$container.outerWidth(true),marginLeft=pointWidth-width+8;return{chart:{defaultSeriesType:"column",renderTo:$container[0],marginBottom:80,marginLeft:marginLeft,height:300,spacing:0,width:width},defs:defs,xAxis:{labels:{enabled:false},startOnTick:true,maxPadding:0,lineWidth:0,tickLength:0},yAxis:{labels:{enabled:false},gridLineWidth:0},legend:{align:"left",x:-16,verticalAlign:"bottom",y:0,floating:true,shadow:false,width:200,itemWidth:200,itemStyle:{cursor:"default",fontSize:"12px",padding:"8px",color:"#8d8d8d"},itemHoverStyle:{color:"#8d8d8d"},symbolHeight:12,symbolWidth:12,symbolPadding:6},plotOptions:{column:{stacking:"normal",pointWidth:pointWidth,dataLabels:{enabled:true,align:"left",x:pointWidth+borderWidth,y:-3,style:{color:"#8d8d8d",fontSize:"12px",paddingRight:100,borderRight:"100px"},backgroundColor:"white",formatter:generateDataLabelFormatter()},events:{legendItemClick:function legendItemClick(){return false}}},series:{borderWidth:borderWidth,cursor:"default"}},tooltip:{enabled:true,style:{width:width-pointWidth},formatter:function formatter(){var options=this.series&&this.series.options;options=options||{};if(this.y===0){return false}if(tooltipTexts[options._name]){return tooltipTexts[options._name]+" ("+numberHelper.prettyNumber(this.y)+")"}return false}},series:series}}return{getConfig:getConfig,generateDataLabelFormatter:generateDataLabelFormatter,getPattern:getPattern}});define("mustache!src/querybuilder/templates/queryBuilderUsageChart",["lib/mustache"],function(mustache){var escapedTemplate='<div>\n<header class="bold singlepadding-bottom">Data Usage Estimation</header>\n<section class="infobox infoboxtextcolor infoboxbgcolor mediumtext singlepadding-vertical doublemargin-bottom tencolmax">\n<p class="mediumtext-bigline doublepadding-horizontal">\nThis chart shows your total usage for the current month to date and a <span class="bold">rough prediction</span> for the Query that you are setting up right now. Please note that the estimation below does not calculate the total usage across all of your Queries and Channels. It shows a 30 day estimation for the Query youre creating in addition to your current total usage from other Queries and Channels so far this month.\n</p>\n</section>\n<div>\n<div class="halfwidth floatleft">\n<div class="rowborder singlemargin-right tinypadding-bottom">Current month usage</div>\n</div>\n<div class="halfwidth floatleft">\n<div class="rowborder tinypadding-bottom">Estimated for next 30 days</div>\n</div>\n</div>\n<div>\n<div class="js-current-usage-chart halfwidth floatleft"></div>\n<div class="js-estimated-usage-chart halfwidth floatleft"></div>\n</div>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/querybuilder/css/queryBuilderUsageChart.css",["css!src/querybuilder/css/compiled.css"],function(){});define("src/querybuilder/views/QueryBuilderUsageChartView",["underscore","backbone","src/querybuilder/queryBuilderUsageChartConfig","mustache!src/querybuilder/templates/queryBuilderUsageChart","bw-highcharts","bw-fe-helpers/numberHelper","css!src/querybuilder/css/queryBuilderUsageChart.css"],function(_,Backbone,queryUsageChartConfig,renderUsageChartTemplate,Highcharts,numberHelper){"use strict";function renderCurrentUsageChart(view,usageData){var $container=view.$(".js-current-usage-chart"),chartOptions=queryUsageChartConfig.getConfig($container,[{_name:"currentEmptyPlaceholder",data:[usageData.estimatedMentionsOver],color:"white",showInLegend:false,dataLabels:{enabled:false,style:{textShadow:""}}},{_name:"currentAvailable",color:"#f3f3f3",borderColor:"#e7e7e7",name:"Available mentions",data:[usageData.currentMentionsAvailable],dataLabels:{color:"#8d8d8d",style:{textShadow:""}}},{_name:"currentUsed",color:"#9158af",borderColor:"#9158af",name:"Used so far this month",data:[usageData.currentMentionUsage],dataLabels:{color:"#9158af",style:{textShadow:""}}}],null);return new Highcharts.Chart(chartOptions)}function renderEstimatedUsageChart(view,usageData){var $container=view.$(".js-estimated-usage-chart");var defs={patterns:[{id:"pattern-63bda6",image:queryUsageChartConfig.getPattern("63bda6"),width:41,height:41},{id:"pattern-f4f4f4",image:queryUsageChartConfig.getPattern("f4f4f4"),width:41,height:41},{id:"pattern-59be9e",image:queryUsageChartConfig.getPattern("59be9e"),width:41,height:41},{id:"pattern-9158af",image:queryUsageChartConfig.getPattern("9158af"),width:41,height:41}]};var chartOptions=queryUsageChartConfig.getConfig($container,[{_name:"estimateOver",data:[usageData.estimatedMentionsOver],borderColor:"#c4363d",showInLegend:false,dataLabels:{color:"#c4363d",formatter:queryUsageChartConfig.generateDataLabelFormatter(" above allowance"),style:{fontWeight:"bold",style:{textShadow:""}}},color:"url(#pattern-63bda6)"},{_name:"estimateLimitPlaceholder",data:[0],showInLegend:false,dataLabels:{color:"#8d8d8d",formatter:_(getAllowanceLabel).partial(view,usageData),enabled:usageData.isLimitExceeded,fontSize:"11px",style:{textShadow:""}}},{_name:"estimateAvailable",color:"url(#pattern-f4f4f4)",borderColor:"#e7e7e7",showInLegend:false,data:[usageData.estimatedMentionsAvailable],dataLabels:{color:"#8d8d8d",enabled:!usageData.isLimitExceeded,style:{textShadow:""}}},{_name:"estimateOk",color:"url(#pattern-59be9e)",borderColor:"#59be9e",name:getEstimatedMentionUsageLegend(view,usageData),data:[usageData.monthlyEstimate],dataLabels:{color:"#59be9e",zIndex:"7",style:{textShadow:""}}},{_name:"estimateUsed",color:"url(#pattern-9158af)",borderColor:"#9158af",name:"Used so far this month",data:[usageData.currentMentionUsage],dataLabels:{color:"#9158af",style:{textShadow:""}}}],defs);return new Highcharts.Chart(chartOptions)}function getEstimatedMentionUsageLegend(view){return"Estimated usage for "+formatQueryName(view.queryName)}function formatQueryName(queryName){if(!queryName){return"this Query"}return _(queryName).chain().truncate(12).surround('"').value()}function getAllowanceLabel(view,usageData){return"  ALLOWANCE ("+numberHelper.prettyNumber(usageData.currentMentionLimit)+")"}return Backbone.View.extend({className:"queryBuilderUsageChart",constructor:function QueryBuilderUsageChartView(){Backbone.View.apply(this,arguments)},render:function render(usageData){if(!usageData){throw new Error("QueryBuilderUsageChartView.render requires usageData to be set")}this.$el.html(renderUsageChartTemplate());renderCurrentUsageChart(this,usageData);renderEstimatedUsageChart(this,usageData)}})});define("src/querybuilder/QueryBuilderUsageDataHelper",["underscore"],function(_){"use strict";function validateOptions(options){if(_.isUndefined(options.mentionLimit)){throw new Error("QueryBuilderUsageDataHelper requires options.mentionLimit to be set")}if(_.isUndefined(options.mentionUsage)){throw new Error("QueryBuilderUsageDataHelper requires options.mentionUsage to be set")}}function QueryBuilderUsageDataHelper(options){validateOptions(options||{});this.setMonthlyEstimate(options.monthlyEstimate);this.mentionLimit=options.mentionLimit;this.mentionUsage=options.mentionUsage}QueryBuilderUsageDataHelper.prototype.setMonthlyEstimate=function(monthlyEstimate){this.monthlyEstimate=monthlyEstimate||0};QueryBuilderUsageDataHelper.prototype.isLimitExceeded=function(){return this.monthlyEstimate>this.getCurrentMentionsAvailable()};QueryBuilderUsageDataHelper.prototype.getMonthlyEstimate=function(){return this.monthlyEstimate};QueryBuilderUsageDataHelper.prototype.getCurrentMentionUsage=function(){return this.mentionUsage};QueryBuilderUsageDataHelper.prototype.getCurrentMentionLimit=function(){return this.mentionLimit};QueryBuilderUsageDataHelper.prototype.getCurrentMentionsAvailable=function(){return Math.max(this.mentionLimit-this.mentionUsage,0)};QueryBuilderUsageDataHelper.prototype.getEstimatedMentionsAvailable=function(){return this.getCurrentMentionsAvailable()-this.getEstimatedMentionUsage()};QueryBuilderUsageDataHelper.prototype.getEstimatedMentionUsage=function(){return Math.min(this.getCurrentMentionsAvailable(),this.monthlyEstimate)};QueryBuilderUsageDataHelper.prototype.getEstimatedMentionsOver=function(){return Math.max(this.monthlyEstimate-this.getCurrentMentionsAvailable(),0)};QueryBuilderUsageDataHelper.prototype.getAnalyticsData=function(){return{estimateUsed:this.getCurrentMentionUsage(),estimateOk:this.getEstimatedMentionUsage(),estimateOver:this.getEstimatedMentionsOver(),estimateAvailable:this.getEstimatedMentionsAvailable()}};QueryBuilderUsageDataHelper.prototype.getUsageChartData=function(){return{currentMentionLimit:this.getCurrentMentionLimit(),currentMentionUsage:this.getCurrentMentionUsage(),currentMentionsAvailable:this.getCurrentMentionsAvailable(),estimatedMentionsAvailable:this.getEstimatedMentionsAvailable(),estimatedMentionsOver:this.getEstimatedMentionsOver(),monthlyEstimate:this.getMonthlyEstimate(),isLimitExceeded:this.isLimitExceeded()}};return QueryBuilderUsageDataHelper});define("mustache!src/querybuilder/templates/queryBuilderReview",["lib/mustache"],function(mustache){var escapedTemplate='<div class="summary abstop absbottom halfwidth floatleft relative doublepadding-right">\n<div class="row name singlepadding-bottom">\n<label class="bold">Query Name</label>\n<p class="value tinypadding-top">{{name}}</p>\n</div>\n<div class="row description singlepadding-vertical rowborder-top">\n<label class="bold">Description / Notes</label>\n{{#description}}\n<p class="value tinypadding-top">{{description}}</p>\n{{/description}}\n{{^description}}\n<p class="value tinypadding-top grey">None. Descriptions can actually be really helpful.</p>\n{{/description}}\n</div>\n<div class="row languages singlepadding-vertical rowborder-top">\n<label class="bold">{{languageLabel}}</label>\n<p class="value tinypadding-top">{{languages}}</p>\n</div>\n{{#samplePercent}}\n<div class="row samplePercent singlepadding-vertical rowborder-top">\n<label class="bold">Amount of Mentions</label>\n<p class="value tinypadding-top">{{samplePercent}}%{{#estimatedMonthlyResults}}, circa {{estimatedMonthlyResults}} mentions/month{{/estimatedMonthlyResults}}</p>\n</div>\n{{/samplePercent}}\n{{#backfill}}\n<div class="row backfill singlepadding-vertical rowborder-top">\n<label class="bold">Historical Mentions</label>\n<p class="value tinypadding-top">Retrieve mentions back to {{backfill.month}} ({{backfill.duration}} months)</p>\n</div>\n{{/backfill}}\n{{#alert}}\n<div class="row alert singlepadding-vertical rowborder-top">\n<label class="bold">Alert on Increases</label>\n<p class="value tinypadding-top">An Alert will be created which emails you if the volume increases by {{alertThreshold}}%</p>\n</div>\n{{/alert}}\n</div>\n<div class="js-mention-usage fullheight halfwidth floatleft doublepadding-left toolbar--separator"></div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/querybuilder/css/queryBuilderReview.css",["css!src/querybuilder/css/compiled.css"],function(){});define("src/querybuilder/views/QueryBuilderReviewView",["underscore","backbone","moment","bw-fe-helpers/numberHelper","src/querybuilder/views/QueryBuilderUsageChartView","src/querybuilder/QueryBuilderUsageDataHelper","mustache!src/querybuilder/templates/queryBuilderReview","css!src/querybuilder/css/queryBuilderReview.css"],function(_,Backbone,moment,numberHelper,QueryBuilderUsageChartView,QueryBuilderUsageDataHelper,renderQueryBuilderReviewTemplate){"use strict";function getQueryLanguages(queryLangCodes,allLangs){if(!queryLangCodes||!queryLangCodes.length){return}return _(allLangs.toJSON()).chain().filter(function(lang){return queryLangCodes.indexOf(lang.code)>-1}).pluck("name").value().join(", ")}function getQueryBackfillSetting(context){var backfillDuration=context&&context.backfillDuration,today=moment();if(!backfillDuration){return}backfillDuration=parseInt(backfillDuration,10);return{duration:backfillDuration,month:today.subtract(backfillDuration,"months").format("MMMM YYYY")}}function isLegacyClient(view){return view.projectUsageSummary&&view.projectUsageSummary.get("legacy")}function canSeeUsageChart(view){if(!view.model.isNew()){return false}if(isLegacyClient(view)){updateAnalyticsData(view,{pricingModel:"legacy"});return false}return true}function initializeUsageChart(view,projectUsageSummary){if(!projectUsageSummary.isMentionBasedClient()){updateAnalyticsData(view,{pricingModel:"qb"});return}view.queryBuilderUsageChartView=new QueryBuilderUsageChartView;renderUsageChart(view)}function renderUsageChart(view){var usageChartView=view.queryBuilderUsageChartView;if(!usageChartView){return}view.$(".js-mention-usage").html(view.queryBuilderUsageChartView.el);view.usageDataHelper.setMonthlyEstimate(view.context&&view.context.estimatedMonthlyResults);usageChartView.queryName=view.model.get("name");usageChartView.render(view.usageDataHelper.getUsageChartData());updateAnalyticsData(view,_.extend(view.usageDataHelper.getAnalyticsData(),{pricingModel:"mb"}))}function updateAnalyticsData(view,usageData){if(!view.context.analyticsData){view.context.analyticsData={}}view.context.analyticsData.usageData=usageData}function validateOptions(options){if(!options.model){throw new Error("QueryBuilderReviewView requires options.model to be set")}if(!options.languages){throw new Error("QueryBuilderReviewView requires options.languages to be set")}if(!options.project){throw new Error("QueryBuilderReviewView requires options.project to be set")}if(!options.context){throw new Error("QueryBuilderReviewView requires options.context to be set")}if(!options.queryCreationRules){throw new Error("QueryBuilderReviewView requires options.queryCreationRules to be set")}}return Backbone.View.extend({className:"queryBuilderReview",constructor:function QueryBuilderReviewView(options){Backbone.View.apply(this,arguments);options=options||{};validateOptions(options);this.languages=options.languages;this.project=options.project;this.context=options.context;this.projectUsageSummary=options.queryCreationRules.projectUsageSummary;this.usageDataHelper=new QueryBuilderUsageDataHelper({mentionLimit:this.projectUsageSummary.get("mentionLimit"),mentionUsage:this.projectUsageSummary.get("mentionsThisMonth")});if(canSeeUsageChart(this)){initializeUsageChart(this,this.projectUsageSummary)}},getTemplateData:function getTemplateData(){var context=this.context||{};var model=this.model;var queryLangCodes=model.get("languages");var hasAlert=!!context.alert;var alertThreshold;var samplePercent=model.get("samplePercent");var isSample=_.isNumber(samplePercent)&&samplePercent<100;if(hasAlert){alertThreshold=context.alert.get("threshold")}return{name:model.get("name"),languageLabel:queryLangCodes&&queryLangCodes.length>1?"Languages":"Language",languages:model.get("languageAgnostic")?"Ignore":getQueryLanguages(queryLangCodes,this.languages),description:model.get("description"),alert:hasAlert,alertThreshold:alertThreshold,backfill:getQueryBackfillSetting(context),samplePercent:isSample&&samplePercent,estimatedMonthlyResults:numberHelper.prettyNumber(this.context.estimatedMonthlyResults)}},render:function render(){var data=this.getTemplateData();this.$el.html(renderQueryBuilderReviewTemplate(data));if(canSeeUsageChart(this)){renderUsageChart(this)}this.trigger("rendered valid")},remove:function remove(){if(this.queryBuilderUsageChartView){this.queryBuilderUsageChartView.remove();this.queryBuilderUsageChartView=undefined}Backbone.View.prototype.remove.apply(this)},shown:function shown(){this.render()},resize:function resize(){if(this.queryBuilderUsageChartView){this.queryBuilderUsageChartView.render(this.usageDataHelper.getUsageChartData())}}})});define("mustache!src/querybuilder/templates/queryBuilderProgressTracker",["lib/mustache"],function(mustache){var escapedTemplate='<nav class="progress-tracker">\n{{#steps}}\n<a class="js-jump-to jump-to db singlepadding-left smallpadding-vertical tinymargin-top active customtip" title="{{stepLabel}}" data-viewid="{{viewId}}">\n<span class="{{stepIcon}} step-icon smallpadding-right"></span>\n<span class="step-label">{{stepLabel}}</span>\n</a>\n{{/steps}}\n</nav>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/querybuilder/css/queryBuilderProgressTracker.css",["css!src/querybuilder/css/compiled.css"],function(){});define("src/querybuilder/views/QueryBuilderProgressTrackerView",["jquery","backbone","mustache!src/querybuilder/templates/queryBuilderProgressTracker","src/packages/customtip","css!src/querybuilder/css/queryBuilderProgressTracker.css"],function($,Backbone,renderProgressTrackerTemplate){"use strict";function getStepLinkElement(view,viewId){return view.$('.js-jump-to[data-viewid="'+viewId+'"]')}return Backbone.View.extend({events:{"click .js-jump-to":function onClickStep(e){var $target=$(e.currentTarget);if(!$target.hasClass("active")){return}this.trigger("jumpTo",$target.index());this.setCurrent($target.data("viewid"))}},constructor:function QueryBuilderProgressTrackerView(options){Backbone.View.apply(this,arguments);options=options||{};if(!options.steps){throw new Error("QueryBuilderProgressTrackerView requires options.steps to be set")}this.steps=options.steps},render:function render(){this.$el.html(renderProgressTrackerTemplate({steps:this.steps}));this.$el.customtip({position:"right",onBeforeShow:function onBeforeShow(e){return!$(e.target).find(".step-label").is(":visible")}})},setCurrent:function setCurrent(stepId){getStepLinkElement(this,stepId).addClass("current").siblings().removeClass("current")},setActive:function setActive(stepId){getStepLinkElement(this,stepId).addClass("active")},setInactiveFromHere:function setInactiveFromHere(stepId){getStepLinkElement(this,stepId).nextAll().removeClass("active")}})});define("src/querybuilder/QueryBuilderStepHandler",["underscore","backbone","src/querybuilder/views/QueryBuilderWriteView","src/querybuilder/views/QueryBuilderSetupView","src/querybuilder/views/QueryBuilderReviewView","src/querybuilder/views/QueryBuilderProgressTrackerView"],function(_,Backbone,QueryBuilderWriteView,QueryBuilderSetupView,QueryBuilderReviewView,QueryBuilderProgressTrackerView){"use strict";var stepsSpec=[{viewId:"qb-write",stepLabel:"Write",stepIcon:"icon-pencil",ViewClass:QueryBuilderWriteView},{viewId:"qb-setup",stepLabel:"Set up",stepIcon:"icon-cog",ViewClass:QueryBuilderSetupView},{viewId:"qb-review",stepLabel:"Review",stepIcon:"icon-ok",ViewClass:QueryBuilderReviewView}];function getStepIndex(stepHandler,step){return stepHandler.steps.indexOf(step)}function getStepPosition(stepHandler,step){var stepIndex=getStepIndex(stepHandler,step);if(stepIndex===0){return"first"}if(stepIndex===stepHandler.steps.length-1){return"last"}return"intermediate"}function isValid(stepHandler,step){return stepHandler.validSteps.indexOf(step)!==-1}function onStepValid(stepHandler,validatedStep){if(!isValid(stepHandler,validatedStep)){stepHandler.validSteps.push(validatedStep)}if(stepHandler.activeStep!==validatedStep){return}updateProgressTracker(stepHandler,true);stepHandler.trigger("stepChange",getStepPosition(stepHandler,validatedStep),true)}function onStepInvalid(stepHandler,invalidatedStep){stepHandler.validSteps=_.without(stepHandler.validSteps,invalidatedStep);if(stepHandler.activeStep!==invalidatedStep){return}updateProgressTracker(stepHandler,false);stepHandler.trigger("stepChange",getStepPosition(stepHandler,invalidatedStep),false)}function onRenderComplete(stepHandler){var isNew=stepHandler.stepData.model.isNew();if(!isNew){stepHandler.validSteps=[].concat(stepHandler.steps)}jumpTo(stepHandler,stepHandler.steps[0]);updateProgressTracker(stepHandler,!isNew);stepHandler.trigger("ready")}function jumpTo(stepHandler,step){if(!step){return}step.$el.removeClass("hidden").siblings().addClass("hidden");stepHandler.activeStep=step;stepHandler.progressTrackerView.setCurrent(step.id);stepHandler.trigger("removeNotification");stepHandler.trigger("stepChange",getStepPosition(stepHandler,step),isValid(stepHandler,step));if(_.isFunction(step.shown)){step.shown()}}function updateProgressTracker(stepHandler,isCurrentStepValid){var activeStep=stepHandler.activeStep,currentStepIndex=getStepIndex(stepHandler,activeStep),progressTrackerView=stepHandler.progressTrackerView;if(!isCurrentStepValid){return progressTrackerView.setInactiveFromHere(activeStep.id)}stepHandler.steps.every(function(step,stepIndex){var nextStep=stepHandler.steps[stepIndex+1];if(stepIndex<currentStepIndex){return true}if(isValid(stepHandler,step)&&nextStep){progressTrackerView.setActive(nextStep.id);return true}return false})}function bindToStepEvents(stepHandler,step){stepHandler.listenTo(step,"valid",function onStepIsValid(){onStepValid(stepHandler,step)});stepHandler.listenTo(step,"invalid",function onStepIsInvalid(){onStepInvalid(stepHandler,step)});stepHandler.listenTo(step,"notification",function onShowNotification(options){stepHandler.trigger("notification",options)});stepHandler.listenTo(step,"removeNotification",function onRemoveNotification(){stepHandler.trigger("removeNotification")});stepHandler.listenToOnce(step,"rendered",function checkRenderComplete(){if(++stepHandler.renderedStepsCount===stepsSpec.length){onRenderComplete(stepHandler)}});stepHandler.listenTo(step,"nextStep",function onRemoveNotification(){stepHandler.next()});stepHandler.listenTo(step,"prevStep",function onRemoveNotification(){stepHandler.prev()})}function renderProgressTracker(stepHandler){var progressTrackerView=stepHandler.progressTrackerView=new QueryBuilderProgressTrackerView({el:stepHandler.$progressPane,steps:stepsSpec});stepHandler.listenTo(progressTrackerView,"jumpTo",function onJumpTo(stepIndex){jumpTo(stepHandler,stepHandler.steps[stepIndex])});progressTrackerView.render()}function renderStepViews(stepHandler){stepHandler.renderedStepsCount=0;stepsSpec.forEach(function(spec){var step=new spec.ViewClass(_.extend({id:spec.viewId},stepHandler.stepData));bindToStepEvents(stepHandler,step);stepHandler.steps.push(step);stepHandler.$contentPane.append(step.$el);step.render()})}function QueryBuilderStepHandler(options){options=options||{};if(!options.$progressPane){throw new Error("QueryBulderStepHandler requires options.$progressPane must be specified")}if(!options.$contentPane){throw new Error("QueryBulderStepHandler requires options.$contentPane must be specified")}if(!options.stepData){throw new Error("QueryBulderStepHandler requires options.stepData must be specified")}this.$progressPane=options.$progressPane;this.$contentPane=options.$contentPane;this.stepData=options.stepData;this.steps=[];this.validSteps=[]}QueryBuilderStepHandler.prototype.init=function(){renderProgressTracker(this);renderStepViews(this)};QueryBuilderStepHandler.prototype.prev=function(){var stepIndex=getStepIndex(this,this.activeStep),prevStep=this.steps[stepIndex-1];if(stepIndex<1){return}jumpTo(this,prevStep)};QueryBuilderStepHandler.prototype.next=function(){var stepIndex=getStepIndex(this,this.activeStep),nextStep=this.steps[stepIndex+1];if(stepIndex>=this.steps.length-1){return}if(!isValid(this,this.activeStep)){return}jumpTo(this,nextStep)};QueryBuilderStepHandler.prototype.resizeActiveStep=function(){if(this.activeStep&&_.isFunction(this.activeStep.resize)){this.activeStep.resize()}};QueryBuilderStepHandler.prototype.remove=function(){this.stopListening();this.steps.forEach(function(step){step.remove()});this.activeStep=undefined;this.steps=[];this.validSteps=[]};QueryBuilderStepHandler.prototype.hasValidStepsOnly=function(){return this.validSteps.length===this.steps.length};_.extend(QueryBuilderStepHandler.prototype,Backbone.Events);return QueryBuilderStepHandler});define("mustache!src/querybuilder/templates/queryBuilder",["lib/mustache"],function(mustache){var escapedTemplate='<div class="progress-pane lightgreybg rounded"></div>\n<div class="main-pane pagepadding {{#isSampleQueryEdit}}hasSampleQueryWarning{{/isSampleQueryEdit}}">\n<h1 class="popuptitletext singlemargin-bottom">{{#isNew}}Create a New {{dataSourceType}}{{/isNew}}{{^isNew}}Edit {{dataSourceType}} "{{name}}"{{/isNew}}</h1>\n<a class="js-close-querybuilder popup--close icon-remove singlepadding lightgrey abstop absright"></a>\n{{#isSampleQueryEdit}}\n<div class="sample-query-warning notification notification-warning rounded smallpadding-vertical singlepadding-horizontal smallmargin-bottom relative">\n<span>Re-Saving this {{dataSourceType}} will affect your sample of historic data</span>\n<a class="close js-close-sq-warning iconsmaller icon-remove absright smallmargin-top singlemargin-right"></a>\n</div>\n{{/isSampleQueryEdit}}\n<div class="notifications"></div>\n<div class="content"></div>\n<footer class="js-step-buttons absbottom doublemargin-bottom">\n<button class="js-prev singlemargin-right button hidden"><span class="grey icon-chevron-left"></span></button>\n<button class="js-next singlemargin-right defaultbutton" data-at="query-editor-next-button" tabindex="1">Next <span class="tinypadding-left icon-chevron-right"></span></button>\n<button class="js-save singlemargin-right defaultbutton hidden" data-at="query-editor-save-button">Save Query</button>\n<span class="js-save-hint">Saving will start counting towards your <span class="bold">monthly allowance</span> immediately.</span>\n</footer>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/querybuilder/css/queryBuilder.css",["css!src/querybuilder/css/compiled.css"],function(){});define("src/querybuilder/views/QueryBuilderView",["async","backbone","underscore","jquery","src/ApiError","bw-fe-helpers/ModelBackup","src/globals/me","src/globals/crimsonMode","src/models/LanguageCollection","src/components/mentions/_testsearch/models/TestSearchResultsCollection","src/events/queryEvents","src/events/globalEventNames","src/querybuilder/queryFormHelper","src/querybuilder/QueryBuilderStepHandler","mustache!src/querybuilder/templates/queryBuilder","css!src/querybuilder/css/queryBuilder.css","lib/jquery.showNotification","lib/jquery.notify","src/packages/waitmask","lib/jquery.confirm"],function(async,Backbone,_,$,ApiError,ModelBackup,me,crimsonMode,LanguageCollection,TestSearchResultsCollection,queryEvents,globalEventNames,queryFormHelper,QueryBuilderStepHandler,renderQueryBuilderTemplate){"use strict";var QUERY_EVENT_NAMES=globalEventNames.QUERIES,stepPosToFooterElements={first:".js-next",intermediate:".js-prev, .js-next",last:".js-prev, .js-save, .js-save-hint"};var postQueryCreationTasks=[function createBackfill(model,context,done){if(crimsonMode.enabled()){return done()}queryFormHelper.createBackfill(model,context.backfillDuration,function(err){done(err)})},function createAlert(model,context,done){var createAlert=context.createAlert;if(!createAlert){context.analyticsData.createAlert=false;return done()}queryFormHelper.createAlert({query:model,threshold:context.alertThreshold}).then(function(){context.analyticsData.createAlert=true;done()}).catch(function(){done("Failed to create Alert for this Query. You can retry in the Alerts/Custom Alerts section.")})},function createSignal(model,context,done){var setupSignals=context.setupSignals;if(!setupSignals){context.analyticsData.setupSignals=false;return done()}queryFormHelper.createSignal({query:model}).then(function(){context.analyticsData.setupSignals=true;done()}).catch(function(){done("Failed to create Signal for this Query. You can retry in the Alerts/Signals section.")})}];function bindToStepHandlerEvents(view,stepHandler){view.listenTo(stepHandler,"notification",view.showNotification);view.listenTo(stepHandler,"removeNotification",view.removeNotification);view.listenTo(stepHandler,"stepChange",function onStepChange(stepPosition,isValid){updateFooterElements(view,stepPosition,isValid)});view.listenToOnce(stepHandler,"ready",view.onRenderComplete)}function renderStepViews(view){var stepHandler;removeStepViews(view);stepHandler=view.stepHandler=new QueryBuilderStepHandler({$progressPane:view.$(".progress-pane"),$contentPane:view.$(".content"),stepData:{model:view.model,queryCreationRules:view.queryCreationRules,project:view.project,languages:view.languages,resultsCollection:view.resultsCollection,context:view.context,hideSamplingView:view.hideSamplingView}});bindToStepHandlerEvents(view,stepHandler);stepHandler.init()}function removeStepViews(view){if(view.stepHandler){view.stepHandler.remove()}}function fetchLanguages(view,callback){view.languages.fetch({success:function success(){callback()},error:function error(xhr){var err=new ApiError(xhr);callback(err)}})}function save(view){var model=view.model,$el=view.$el,wasConvertedFromStructuredQuery=model.wasConvertedFromStructuredQuery();$el.showWaitmask("Saving...");model.save({},{wait:true,success:function success(model){view.modelBackup=undefined;runPostQueryCreationTasks(view.model,view.context,function(err){if(err){$.notify({text:_.escape(err),className:"notification-error"})}$el.hideWaitmask();view.trigger("confirmed",model);if(wasConvertedFromStructuredQuery){view.context.analyticsData.wasConvertedFromStructuredQuery=true}view.context.analyticsData.queryId=model.id;trackCloseEvent(view,{wasSaved:true});view.remove()})},error:function error(model,response){var error=new ApiError(response);$el.hideWaitmask();view.showNotification({cssClass:"notification-error",text:error.message||error.errors||response})}});if(view.model.validationError){view.showNotification({cssClass:"notification-error",text:getValidationErrorMessages(view.model.validationError),omitClose:true});$el.hideWaitmask()}}function runPostQueryCreationTasks(model,context,callback){var calls=postQueryCreationTasks.map(function(postQueryCreationTask){return postQueryCreationTask.bind(null,model,context)});async.parallel(calls,function(err){callback(err)})}function updateFooterElements(view,stepPosition,isValid){var $allFooterElements=view.$(".js-step-buttons > button, .js-step-buttons > span"),availableElementsSelector=stepPosToFooterElements[stepPosition];$allFooterElements.addClass("hidden").filter(availableElementsSelector).removeClass("hidden");$allFooterElements.filter(".js-next, .js-save").prop("disabled",!isValid)}function getValidationErrorMessages(validationErrors){var errorKeys=_(validationErrors).keys(),errorTexts=errorKeys.map(function(key){return _.capitalize(key)+":"+validationErrors[key]});return errorTexts.join(", ")}function showInitialNotifications(view){var client=me.get("client")||{},dailyAllowance;if(!client.railsEnabled){return}dailyAllowance=view.model.get("dailyLimit")||view.queryCreationRules.projectUsageSummary.get("dailyAllowance");view.showNotification({text:"<b>Warning</b>: This Query will be limited to "+dailyAllowance+" mentions per day",cssClass:"notification-warning",omitClose:false})}function showStructuredQueryConvertedNotification(view){var text;if(!view.model.wasConvertedFromStructuredQuery()){return}text='This Query was automatically translated from a "structured" Query to our more powerful "freetext" format. '+'<a class="help action" data-key="query-structured-query-conversion">Learn More</a>';view.showNotification({text:text,cssClass:"notification-info",omitClose:false})}function close(view){var allStepsValid=view.stepHandler.hasValidStepsOnly(),closeWithoutSavingText='<span class="darkgrey iconsmall icon-warning-sign tinypadding-right"></span>Close without saving',confirmButtons=[{text:closeWithoutSavingText,className:"closeBtn",value:"close"},{text:"Cancel",className:"cancelBtn",value:false,keyCode:27}],queryName=view.model.escape("name"),confirmText,isOverDailyMentionLimit=view.queryCreationRules.isOverDailyMentionLimit(view.context.estimatedDailyMentionResults),isAllowedToSave=allStepsValid&&!isOverDailyMentionLimit;if(allStepsValid&&!view.modelBackup.hasChanges()){trackCloseEvent(view,{wasSaved:false});return view.remove()}if(isAllowedToSave){confirmButtons.unshift({text:"Save Query",className:"confirmBtn",value:"save",keyCode:13})}confirmText="Your Query "+(queryName?'"'+view.model.escape("name")+'" ':"")+"has <b>unsaved changes</b>, do you want to <b>save</b> them?";$.confirm({title:"Unsaved Query",text:confirmText,escape:false,dialogClass:"smallpopup",defaultButtonClass:isAllowedToSave?undefined:"button",buttons:confirmButtons},function(value){if(value==="close"){trackCloseEvent(view,{wasSaved:false});view.remove()}if(value==="save"){save(view)}})}function trackCloseEvent(view,data){queryEvents.trigger(QUERY_EVENT_NAMES.QUERY_BUILDER_CLOSE,_.extend({wasSaved:data.wasSaved,samplePercent:view.model.get("samplePercent")},view.context.analyticsData))}function isSampleQueryEdit(model){var samplePercent=model.get("samplePercent"),isEdit=!model.isNew();return isEdit&&_(samplePercent).isNumber()&&samplePercent<100}var QueryBuilderView=Backbone.View.extend({className:"queryBuilder",dataSourceType:"Query",events:{"click .js-close-querybuilder":function onCloseClick(){close(this)},"click .js-prev":function onClickPrev(){this.stepHandler.prev()},"click .js-next":function onClickNext(){this.stepHandler.next()},"click .js-save":function onClickSave(){save(this)},"click .js-close-sq-warning":function onClickCloseSampleQueryWarning(e){var $warning=$(e.currentTarget).closest(".sample-query-warning");$warning.remove();this.$(".main-pane").removeClass("hasSampleQueryWarning");this.resize()}},constructor:function QueryBuilderView(options){Backbone.View.apply(this,arguments);options=options||{};if(!this.model){throw new Error("QueryBuilderView requires options.model to be set")}if(!options.project){throw new Error("QueryBuilderView requires options.project to be set")}if(!options.queryCreationRules){throw new Error("QueryBuilderView requires options.queryCreationRules to be set")}this.project=options.project;this.queryCreationRules=options.queryCreationRules;this.hideSamplingView=options.hideSamplingView;this.languages=new LanguageCollection;this.resultsCollection=new TestSearchResultsCollection;this.modelBackup=new ModelBackup(this.model);this.init()},init:function init(){this.context={};this.context.analyticsData={projectId:this.project.id,processId:me.id+"_"+(new Date).getTime(),isNew:this.model.isNew(),queryId:this.model.id};queryEvents.trigger(QUERY_EVENT_NAMES.QUERY_BUILDER_OPEN,this.context.analyticsData)},showNotification:function showNotification(options){var $el=this.$el;$el.addClass("hasNotification");this.$(".notifications").empty().showNotification(_.extend({onRemoved:function onRemoved(){$el.removeClass("hasNotification")}},options));this.stepHandler.resizeActiveStep()},removeNotification:function removeNotification(){this.$(".notifications").empty();this.$el.removeClass("hasNotification");this.stepHandler.resizeActiveStep()},getTemplateData:function getTemplateData(){var model=this.model;return{isNew:model.isNew(),name:model.get("name")||"",dataSourceType:this.dataSourceType,isSampleQueryEdit:isSampleQueryEdit(this.model)}},render:function render(){var view=this,$el=view.$el,data=this.getTemplateData();$el.html(renderQueryBuilderTemplate(data));$el.showWaitmask({text:"Loading...",opacity:1});fetchLanguages(view,function(err){if(err){$.notify({text:_.escape(err),className:"notification-error"});view.remove();return}renderStepViews(view)})},onRenderComplete:function onRenderComplete(){showInitialNotifications(this);showStructuredQueryConvertedNotification(this);this.$el.hideWaitmask();this.$(".sample-query-warning").addClass("sample-query-warning-delayed-fadin")},resize:function resize(){this.stepHandler.resizeActiveStep()},remove:function remove(){if(this.modelBackup){this.modelBackup.restore()}removeStepViews(this);Backbone.View.prototype.remove.call(this)}},{show:function show(options){var view=new QueryBuilderView(options),oldRemove=view.remove;view.render();view.$el.showModal({fitToWindow:true,className:"popup modular",minWidth:920,minHeight:636,maxWidth:1920,maxHeight:1080,onAfterResize:function onAfterResize(){view.resize()},close:".not-existent"});view.remove=function(){view.$el.removeModal();view.trigger("closed");oldRemove.call(view)};return view},postQueryCreationTasks:postQueryCreationTasks});return QueryBuilderView});define("src/querywizard/events/QueryWizardEventNames",[],function(){"use strict";return{STATE_CHANGE:"querywizard:state-change",QUERY_CREATE:"querywizard:query-create",TRANSIT:"querywizard:transit",CREATE_SETUP:"querywizard:create-setup",MODEL_SYNC:"querywizard:model-sync",MODEL_REQUEST:"querywizard:model-request",MODEL_ERROR:"querywizard:model-error",REQUEST_EDIT_WITHIN_QUERY_EDITOR:"querywizard:request-edit-within-queryeditor",PREVIEW_RESULTS:"querywizard:preview-results",PREVIEW_TAB_CHANGED:"querywizard:preview-tab-changed",PREVIEW_DELTA_MODE_CHANGED:"querywizard:preview-delta-mode-changed",PREVIEW_DELTA_ANIMATION_CLOSED:"querywizard:test-search-change",TEST_SEARCH_CHANGE:"querywizard:test-search-change",TWITTER_HANDLES_SELECT_CHANGE:"querywizard:twitter-handles-select-change",DISPATCH_ACTION:"querywizard:dispatch-action",OPEN_QUERY_EDITOR:"querywizard:open-query-editor",CLOSE_QUERY_WIZARD:"querywizard:close-query-wizard",TWITTER_AUTH_REQUEST:"querywizard:twitter-auth-request"}});define("src/querywizard/events/QueryCreatorSelectionEventNames",[],function(){"use strict";return{STATE_CHANGE:"querycreatorselection:state-change",CANCEL:"querycreatorselection:cancel",CONTINUE:"querycreatorselection:continue",CONFIRM:"querycreatorselection:confirm"}});define("src/querywizard/models/WizardQuery",["underscore","backbone","src/models/Query","src/globals/currentProject"],function(_,Backbone,Query,currentProject){"use strict";var WIZARD_ATTRIBUTES=["hashtag","hashtagAmbiguous","hashtagContextTerms","hashtagLinks","brandName","brandNameAmbiguous","brandAliases","brandAliasesAmbiguous","productNames","brandContextTerms","termExclusions","twitterHandleExclusions","brandWebsites","brandWebsiteExclusions","brandHashtags","twitterHandles","locations","exclusionSnippets"];var DEFAULT_AGNOSTIC_LANGUAGE="en";function getLanguageSettings(){var settings={languageAgnostic:true,languages:[]};var projectLanguages=currentProject.get("defaultLangCodes");if(projectLanguages&&projectLanguages.length!==0){settings.languageAgnostic=false;settings.languages=settings.languages.concat(projectLanguages);return settings}settings.languages.push(DEFAULT_AGNOSTIC_LANGUAGE);return settings}function defaults(){var languageSettings=getLanguageSettings();return{name:"",hashtag:[],hashtagAmbiguous:false,hashtagContextTerms:[],hashtagLinks:[],brandName:"",brandNameAmbiguous:false,productNames:[],brandAliases:[],brandAliasesAmbiguous:false,brandContextTerms:[],brandHashtags:[],brandWebsites:[],brandWebsiteExclusions:[],termExclusions:[],twitterHandleExclusions:[],exclusionSnippets:[],usecase:"",createdByWizard:true,languageAgnostic:languageSettings.languageAgnostic,languages:languageSettings.languages,locations:[],twitterHandles:[],samplePercent:100,type:"text",includedTerms:[]}}return Query.extend({defaults:defaults,url:function url(){return"/projects/{projectId}/querywizard/"+(this.id||"")},constructor:function WizardQuery(){Backbone.Validations.Model.apply(this,arguments);var model=this;model.projectId=model.get("projectId");if(!model.projectId){model.projectId=currentProject.id}},parse:function parse(response,options){var legacyExclusions=response.queryWizardConfiguration.exclusions;var wizardData=WIZARD_ATTRIBUTES.reduce(function(memo,attr){memo[attr]=response.queryWizardConfiguration[attr];return memo},{});wizardData.hashtag=[].concat(wizardData.hashtag||[]);if(response.queryWizardConfiguration.location&&response.queryWizardConfiguration.locationType){wizardData.locations=[{value:response.queryWizardConfiguration.location,type:response.queryWizardConfiguration.locationType}]}wizardData.termExclusions=[].concat(wizardData.termExclusions||legacyExclusions||[]);var parsedResponse=_.extend(wizardData,response);delete parsedResponse.queryWizardConfiguration;return Query.prototype.parse.call(this,parsedResponse,options)},sync:function sync(method,model,options){options=options||{};if(method==="read"){options.data={}}else{options.attrs=this.getQueryData()}return Query.prototype.sync.call(this,method,model,options)},getQueryData:function getQueryData(){var model=this;var modelAttrs=model.omit(WIZARD_ATTRIBUTES);var wizardAttrs={type:"search string",queryWizardConfiguration:WIZARD_ATTRIBUTES.reduce(function(memo,attr){memo[attr]=model.get(attr);return memo},{})};return _.extend(modelAttrs,wizardAttrs)},toQueryModel:function toQueryModel(){var queryModel=new Query(this.getQueryData());queryModel.set("createdByWizard",false);queryModel.unset("queryWizardConfiguration");queryModel.unset("usecase");return queryModel}},{WIZARD_ATTRIBUTES:WIZARD_ATTRIBUTES,getDefaults:defaults})});define("src/mixins/withRetrigger",["backbone","underscore"],function(Backbone,_){"use strict";return function withRetrigger(){_.extend(this,Backbone.Events);this.retrigger=function(emitter,originalEvent,newEvent){var eventsBus=this;newEvent=newEvent||originalEvent;eventsBus.listenTo(emitter,originalEvent,function(){var originalArgs=Array.prototype.slice.call(arguments);eventsBus.trigger.apply(eventsBus,[newEvent].concat(originalArgs))})}}});define("src/querywizard/QueryCreatorTypesConfig",[],function(){"use strict";return[{name:"Query Wizard",value:"queryWizard",description:"Answer some questions to simply track a brand or a campaign.",automation:"query-creator-select-wizard-radio"},{name:"Query Editor",value:"queryBuilder",description:"Write a Query string using powerful boolean operators (ideal for any topic).",automation:"query-creator-select-editor-radio"}]});define("mustache!src/querywizard/templates/queryCreatorSelectionView",["lib/mustache"],function(mustache){var escapedTemplate='<h1 class="popuptitletext doublemargin-bottom draggable">New Query</h1>\n<div class="mediumtext bold singlemargin-bottom">Choose how to make your Query</div>\n<ul class="qw-creator-selection__creator-list">\n{{#queryCreatorTypes}}\n<li class="qw-creator-selection__creator-box doublepadding rowBorder{{#isSelected}} selected{{/isSelected}}">\n<label for="{{value}}" class="qw-creator-selection__creator-label">\n<input type="radio"{{#isSelected}} checked="checked"{{/isSelected}}\nname="query-creator-type" id="{{value}}" value="{{value}}"\nclass="qw-creator-selection__creator-radio-button smallmargin-right biggertext"\ndata-at="{{automation}}">\n<span class="qw-creator-selection__creator-title biggertext">{{name}}</span>\n{{#isBeta}}<span class="betaIcon"></span>{{/isBeta}}\n</label>\n<div class="qw-creator-selection__creator-description singlemargin-top grey bigline">{{description}}</div>\n</li>\n{{/queryCreatorTypes}}\n</ul>\n<p class="submit doublemargin-top">\n<button class="js-continue defaultbutton"{{^valid}} disabled{{/valid}} data-at="query-creator-select-continue-button">Continue</button>\n<button class="js-cancel button rounded singlemargin-left">Cancel</button>\n</p>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/querywizard/css/queryCreatorSelectionView.css",["css!src/querywizard/css/compiled.css"],function(){});define("src/querywizard/views/QueryCreatorSelectionView",["jquery","backbone","src/querywizard/events/QueryCreatorSelectionEventNames","mustache!src/querywizard/templates/queryCreatorSelectionView","css!src/querywizard/css/queryCreatorSelectionView.css"],function($,Backbone,QueryCreatorSelectionEventNames,template){"use strict";var SET_FOCUS_TIMEOUT=200;function setFocusToContinue(view){view.setFocusTimeout=setTimeout(function(){view.$(".js-continue").focus()},SET_FOCUS_TIMEOUT)}var QueryCreatorSelectionView=Backbone.View.extend({constructor:function QueryCreatorSelectionView(){Backbone.View.apply(this,arguments)},events:{"click .qw-creator-selection__creator-box":"onSelectionChanged","click .js-cancel":"onCancel","click .js-continue":"onContinue"},render:function render(data){this.$el.html(template(data));if(data.valid){setFocusToContinue(this)}},onSelectionChanged:function onSelectionChanged(e){e.preventDefault();var value=$(e.currentTarget).find("input[type=radio]").val();this.trigger(QueryCreatorSelectionEventNames.STATE_CHANGE,{queryCreator:value})},onCancel:function onCancel(){this.trigger(QueryCreatorSelectionEventNames.CANCEL)},onContinue:function onContinue(){this.trigger(QueryCreatorSelectionEventNames.CONTINUE)},remove:function remove(){if(this.setFocusTimeout){clearTimeout(this.setFocusTimeout)}Backbone.View.prototype.remove.apply(this,arguments)}});return QueryCreatorSelectionView});define("src/querywizard/controllers/QueryCreatorSelectionController",["jquery","underscore","moment","src/storageProvider","src/mixins/mixin","src/mixins/withRetrigger","src/mixins/withPopup","src/events/queryWizardEvents","src/querywizard/QueryCreatorTypesConfig","src/querywizard/events/globalEventNames","src/querywizard/events/QueryCreatorSelectionEventNames","src/querywizard/views/QueryCreatorSelectionView","css!src/querywizard/css/queryCreatorSelectionView.css"],function($,_,moment,storageProvider,mixin,withRetrigger,withPopup,queryWizardEvents,QueryCreatorTypesConfig,globalQueryWizardEventNames,QueryCreatorSelectionEventNames,QueryCreatorSelectionView){"use strict";var PREFERRED_QUERY_CREATOR_STORAGE_KEY="queryCreatorSelectionPreferredQueryCreator";var QUERY_CREATOR_SELECTION_EVENTS=globalQueryWizardEventNames.QUERY_CREATOR_SELECTION;function isQueryCreatorKnown(queryCreator){return _.pluck(QueryCreatorTypesConfig,"value").indexOf(queryCreator)>-1}function validate(state){return _.extend(state,{valid:isQueryCreatorKnown(state.queryCreator)})}function getPreferredQueryCreator(){var preferredStorageProvider=storageProvider.get(PREFERRED_QUERY_CREATOR_STORAGE_KEY);if(isQueryCreatorKnown(preferredStorageProvider)){return preferredStorageProvider}}function setPreferredQueryCreator(value){storageProvider.set(PREFERRED_QUERY_CREATOR_STORAGE_KEY,value)}function setState(controller,changedProps){controller.state=_.extend({},controller.state,changedProps);controller.state=_.extend({},controller.state,validate(controller.state));renderView(controller)}function createQueryCreatorSelectionView(controller){var view=new QueryCreatorSelectionView({el:controller.$el});controller.retrigger(view,QueryCreatorSelectionEventNames.CANCEL);controller.retrigger(view,QueryCreatorSelectionEventNames.STATE_CHANGE);controller.retrigger(view,QueryCreatorSelectionEventNames.CONTINUE);return view}function renderView(controller){controller.view.render(controller.state)}function reducer(state,props){var newState={};var queryCreatorTypes=props.queryCreatorTypes||state.queryCreatorTypes;if(props.queryCreator&&props.queryCreator!==state.queryCreator){newState.queryCreatorTypes=queryCreatorTypes.map(function(type){return _.extend({},type,{isSelected:type.value===props.queryCreator})})}return _.extend({},state,props,newState)}function initializeState(){var initialState=reducer({},{queryCreator:getPreferredQueryCreator(),queryCreatorTypes:[].concat(QueryCreatorTypesConfig),timeStamp:+moment.utc(),wasContinued:false});return validate(initialState)}function initialize(controller){controller.$el=$('<div class="qw-query-creator-selection pagepadding">');controller.state=initializeState(controller);controller.view=createQueryCreatorSelectionView(controller);controller.on(QueryCreatorSelectionEventNames.STATE_CHANGE,function(props){var state=controller.state;var reducedProps=reducer(state,props);setState(controller,reducedProps)});controller.on(QueryCreatorSelectionEventNames.CONTINUE,function(){setPreferredQueryCreator(controller.state.queryCreator);setState(controller,{wasContinued:true});controller.trigger(QueryCreatorSelectionEventNames.CONFIRM,controller.state.queryCreator)});renderView(controller)}function QueryCreatorSelectionController(){initialize(this);queryWizardEvents.trigger(QUERY_CREATOR_SELECTION_EVENTS.QUERY_CREATOR_SELECTION_OPENED,this.state)}QueryCreatorSelectionController.prototype.remove=function(){var duration=moment.utc().diff(this.state.timeStamp)/1e3;this.stopListening();this.off();if(this.view){this.view.remove();this.view=undefined}queryWizardEvents.trigger(QUERY_CREATOR_SELECTION_EVENTS.QUERY_CREATOR_SELECTION_CLOSED,_.extend(this.state,{durationInSecs:Math.round(duration),durationInMins:Math.round(duration/60)}))};QueryCreatorSelectionController.show=function(options){var controller;options=options||{};controller=new QueryCreatorSelectionController(options);controller.showAsPopup({className:"popup modular queryCreatorSelection-modal",onClose:options.onClose});return controller};mixin(QueryCreatorSelectionController,withPopup);mixin(QueryCreatorSelectionController,withRetrigger);return QueryCreatorSelectionController});define("src/helpers/rulesHelper",["moment"],function(moment){"use strict";function getBulkActionEarliest(format){var earliest=moment.utc().startOf("month").subtract(37,"months");if(typeof format==="string"){return earliest.format(format)}else{return earliest}}return{getBulkActionEarliest:getBulkActionEarliest}});define("src/models/Rule",["backbone","underscore","jquery","src/Workbench","src/globals/bulkActions","src/helpers/rulesHelper","bw-fe-helpers/urlHelper"],function(Backbone,_,$,Workbench,bulkActions,rulesHelper,urlHelper){"use strict";return Backbone.Validations.Model.extend({defaults:function defaults(){return{enabled:true,filter:{search:""},ruleAction:{}}},getGroups:function getGroups(){var settings=this.get("filter"),siteGroups=[],locationGroups=[],authorGroups=[];function parseIds(val){return parseInt(val,10)}if(_.isObject(settings)){["siteGroup","xsiteGroup"].forEach(function(s){if(_.has(settings,s)){siteGroups=_.union(siteGroups,[].concat(settings[s]))}});["locationGroup","xlocationGroup"].forEach(function(s){if(_.has(settings,s)){locationGroups=_.union(locationGroups,[].concat(settings[s]))}});["authorGroup","xauthorGroup"].forEach(function(s){if(_.has(settings,s)){authorGroups=_.union(authorGroups,[].concat(settings[s]))}})}return{siteGroups:_(siteGroups).chain().map(parseIds).compact().value(),locationGroups:_(locationGroups).chain().map(parseIds).compact().value(),authorGroups:_(authorGroups).chain().map(parseIds).compact().value()}},copyToProject:function copyToProject(options){if(!this.id){throw new Error("Cannot copy an unsaved rule!")}options=_.clone(options);if(!options.copyToProjectId){throw new Error("Cannot copy without a destination project!")}_.extend(options,{type:"POST",dataType:"json",contentType:"application/json",url:Workbench.buildApiUrl("/projects/{projectId}/rules/"+this.id+"/copy"),data:JSON.stringify({copyToProjectId:options.copyToProjectId,scope:options.scope,queryIds:options.queryIds})});delete options.copyToProjectId;delete options.scope;delete options.queryIds;$.ajax(options)},backfill:function backfill(options){if(!this.id){throw new Error("Cannot create a bulkaction for an unsaved rule!")}options=options||{};var query=urlHelper.createQuery({earliest:rulesHelper.getBulkActionEarliest("YYYY-MM-DD")});_.extend(options,{type:"POST",url:Workbench.buildApiUrl("/projects/".concat(this.get("projectId"),"/bulkactions/rule/").concat(this.id,"?").concat(query))});return $.ajax(options).done(function(){bulkActions.startPolling()})},url:function url(){return"/projects/"+(this.get("projectId")||"{projectId}")+"/rules/"+(this.id?this.id:"")},validate:function validate(attrs){if(!attrs.name){return{name:"required"}}return false}})});define("src/models/RuleCollection",["backbone","src/models/Rule"],function(Backbone,Rule){"use strict";return Backbone.Collection.extend({model:Rule,url:function url(){return"/projects/"+(this.projectId||"{projectId}")+"/rules"},constructor:function RuleCollection(attrs,options){this.projectId=options&&options.projectId;this.ruleContains=options&&options.ruleContains;this.pageSize=20;this.page=0;this.orderBy="name";this.orderDirection="asc";return Backbone.Collection.apply(this,arguments)},getQueryData:function getQueryData(){return{page:this.page,pageSize:this.pageSize,ruleContains:this.ruleContains||undefined,enabled:this.showEnabled!==false,orderBy:this.orderBy,orderDirection:this.orderDirection}},setOrdering:function setOrdering(options){this.orderBy=options.orderBy;this.orderDirection=options.orderDirection},setPaging:function setPaging(options){this.page=options.page;this.pageSize=options.pageSize},setFiltering:function setFiltering(options){this.ruleContains=options.ruleContains;this.showEnabled=options.showEnabled},parse:function parse(data){this.resultsTotal=data.resultsTotal;this.page=data.resultsPage;this.pageSize=data.resultsPageSize;return data.results},sync:function sync(method,model,options){options.reset=true;return Backbone.Collection.prototype.sync.apply(this,arguments)}})});define("src/globals/rules",["src/globals/currentProject","src/models/RuleCollection"],function(currentProject,RuleCollection){"use strict";var rules=new RuleCollection;currentProject.onLoad(function(callback){if(!currentProject.id){rules.reset([],{silent:false});return}rules.reset([],{silent:true});rules.fetch({success:callback.bind(null,null),error:function error(model,err){callback(err)}})});return rules});define("src/helpers/dashboard-wizard/dashboardWizardActions",["underscore","bw-fe-helpers/windowHelper","src/globals/currentProject","src/globals/rules","src/globals/categories","src/globals/authorGroups","src/querywizard/models/WizardQuery"],function(_,windowHelper,currentProject,rulesGlobal,categoriesGlobal,authorGroupsGlobal,WizardQuery){"use strict";return{OPEN_QUERY_WIZARD:function OPEN_QUERY_WIZARD(){var eventData=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var QueryFormManager=require("src/QueryFormManager");QueryFormManager.createWebQueryForm({project:currentProject,useWizard:eventData.useWizard,query:new WizardQuery(_.extend({projectId:currentProject.id},eventData.queryProps))})},DASHBOARD_SETUP_COMPLETE:function DASHBOARD_SETUP_COMPLETE(eventData){var projectId;var dashboardId;if(!eventData){return}projectId=eventData.projectId;dashboardId=eventData.dashboardId;var targetUrl="/project/"+projectId+"/dashboards/"+dashboardId;if(windowHelper.getWindow().location.href.indexOf(targetUrl)>-1){require("src/routes/dashboardRoute").loadDashboard(projectId,dashboardId.toString(),true);return}require("app").navigate(targetUrl,{trigger:true})},RULES_GLOBAL_FETCH:function RULES_GLOBAL_FETCH(){rulesGlobal.fetch()},CATEGORIES_GLOBAL_FETCH:function CATEGORIES_GLOBAL_FETCH(){categoriesGlobal.fetch()},AUTHORLISTS_GLOBAL_FETCH:function AUTHORLISTS_GLOBAL_FETCH(){authorGroupsGlobal.fetch()}}});define("src/helpers/dashboard-wizard/dashboardWizardHelper",["jquery","underscore","backbone","src/ReactAppLoader","src/globals/appState","src/helpers/dashboard-wizard/dashboardWizardActions","src/globals/flags","src/globals/flagNames"],function($,_,Backbone,ReactAppLoader,appState,dashboardWizardActions){"use strict";function bindDashboardWizardAppActions(eventBus){Object.keys(dashboardWizardActions).forEach(function(eventName){eventBus.on(eventName,dashboardWizardActions[eventName])})}function start(data){var callback=arguments.length>1&&arguments[1]!==undefined?arguments[1]:function(){};var app=new ReactAppLoader("dashboardWizard");var $target=$("<div />");var eventBus=_.extend({},Backbone.Events);bindDashboardWizardAppActions(eventBus);app.render(Object.assign({el:$target,appState:appState.toJSON(),eventBus:eventBus},data));callback();return app}return{start:start}});define("src/setupstore/setupstoreApiHelper",["jquery"],function($){"use strict";var BASE_URL="/setupstore-api";function fetchJson(url,callback){$.ajax({dataType:"json",url:BASE_URL+url,success:function success(data){callback(null,data)},error:function error(xhr){callback(xhr)}})}var setupstoreApiHelper={fetchSetupTemplates:function fetchSetupTemplates(callback){fetchJson("/setuptemplates",callback)},fetchSetupTemplate:function fetchSetupTemplate(templateId,callback){fetchJson("/setuptemplates/"+templateId,callback)}};return setupstoreApiHelper});define("src/querywizard/helpers/queryWizardConfirmHelper",["jquery","lib/jquery.confirm"],function($){"use strict";function closeQueryWizard(callback){$.confirm({title:"Unsaved Query",text:"Your Query has <strong>unsaved changes</strong>, do you want to <strong>save</strong> them?",escape:false,dialogClass:"smallpopup",defaultButtonClass:"button",buttons:[{text:'<span class="darkgrey iconsmall icon-warning-sign tinypadding-right"></span>Close without saving',className:"cancel",value:true},{text:"Cancel",className:"ok",keyCode:13}]},callback)}function editInQueryEditor(callback){$.confirm({title:"Are you sure you want to edit this Query manually?",text:"Note: once you open this Query in the Query Editor you "+"<strong>will no longer be able to go back and edit the Query in the Query Wizard.</strong>",escape:false,dialogClass:"smallpopup",buttons:[{text:"Stay in Query Wizard",className:"ok",keyCode:13},{text:"Manually Edit in Query Editor",className:"cancel",value:true}]},callback)}return{closeQueryWizard:closeQueryWizard,editInQueryEditor:editInQueryEditor}});define("src/querywizard/QueryWizardSteps",[],function(){"use strict";return{INITIAL:"initial",USECASE_SELECTION:"usecase-selection",HASHTAG_CAMPAIGN:"hashtag-campaign",HASHTAG_CAMPAIGN_EXCLUSIONS:"hashtag-campaign-exclusions",HASHTAG_VOLUME:"hashtag-volume",HASHTAG_CAMPAIGN_QUERYNAME:"hashtag-campaign-queryname",HASHTAG_CAMPAIGN_SETUPSTORE_ENTRY:"hashtag-campaign-setupstore-entry",BRAND_BRANDNAME:"brand-brandname",BRAND_PRODUCTNAMES:"brand-productnames",BRAND_OWNED_MEDIA:"brand-owned-media",BRAND_EXCLUSIONS:"brand-exclusions",BRAND_VOLUME:"brand-volume",BRAND_QUERYNAME:"brand-queryname",BRAND_SETUPSTORE_ENTRY:"brand-setupstore-entry"}});define("src/querywizard/QueryWizardActions",[],function(){"use strict";return{FETCH_LOCATIONS:"fetch-locations",FETCH_EXCLUSION_SNIPPETS:"fetch-exclusion-snippets",FETCH_HASHTAG_RECOMMENDATIONS:"fetchHashtagRecommendations",FETCH_WEBSITE_RECOMMENDATIONS:"fetchWebsiteRecommendations",FETCH_TWITTER_HANDLE_RECOMMENDATIONS:"fetchTwitterHandleRecommendations",FETCH_HASHTAG_COMPLETIONS:"fetchHashtagCompletions",FETCH_WEBSITE_COMPLETIONS:"fetchWebsiteCompletions",FETCH_TWITTER_HANDLE_COMPLETIONS:"fetchTwitterHandleCompletions",FETCH_TWITTER_HANDLES:"fetch-twitter-handles",FETCH_TWITTER_HANDLE_EXCLUSIONS:"fetch-twitter-handle-exclusions",SEARCH_TWITTER_HANDLES:"search-twitter-handles",SEARCH_TWITTER_HANDLE_EXCLUSIONS:"search-twitter-handle-exclusions",RECOMMENDATION_CLICKED:"recommendation-clicked",COMPLETION_ADDED:"completion-added"}});define("src/querywizard/views/elements/SellecktView",["underscore","backbone","src/packages/selleckt"],function(_,Backbone){"use strict";function initializeSelleckt(view){view.$el.selleckt(_.extend({selectedTextClass:"fullwidth"},view.options));view.selleckt=view.$el.data("selleckt");if(view.options.name){view.$el.attr("name",view.options.name)}view.selleckt.on("onPopupCreated",retriggerOnPopupCreatedEvent.bind(null,view));view.selleckt.on("close",retriggerCloseEvent.bind(null,view));view.selleckt.on("itemUnselected",onItemUnselected.bind(null,view));view.selleckt.on("itemSelected",onItemSelected.bind(null,view))}function retriggerOnPopupCreatedEvent(view,popup){view.trigger("onPopupCreated",popup)}function retriggerCloseEvent(view,popup){view.trigger("close",popup)}function onItemUnselected(view,data){view.trigger("itemUnselected",data);view.trigger("selectionChanged")}function onItemSelected(view,data){view.trigger("itemSelected",data);view.trigger("selectionChanged")}function softRender(view,data){data=data||{};if(data.searchItems){renderSearchItems(view,data.searchItems)}renderSelectedItems(view,data.selectedItems)}function renderSearchItems(view,data){if(!hasItemsChanged(view.selleckt.items,data)){return}clearItems(view);addItems(view,data)}function renderSelectedItems(view,val){var selectedItems=[].concat(val||[]);var currentSelection=view.selleckt.getSelection();var itemsToAdd=_.difference(selectedItems,currentSelection);var itemsToRemove=_.difference(currentSelection,selectedItems);itemsToRemove.forEach(function(item){view.selleckt.unselectItem(item,{silent:true})});itemsToAdd.forEach(function(item){view.selleckt.selectItem(item,{silent:true})})}function clearItems(view){view.selleckt.items=[]}function hasItemsChanged(sellecktItems,stateItems){if(sellecktItems.length!==stateItems.length){return true}if(_.intersection(sellecktItems,stateItems).length!==sellecktItems.length){return true}return false}function addItems(view,data){var searchTerm;data.forEach(view.selleckt.addItem.bind(view.selleckt));if(view.selleckt.popup&&view.selleckt.popup.$popup){searchTerm=view.selleckt.popup.$popup.find("."+view.selleckt.searchInputClass).val();view.selleckt._refreshPopupWithSearchHits(searchTerm)}}var SellecktView=Backbone.View.extend({tagName:"select",constructor:function SellecktView(options){this.options=options||{};Backbone.View.apply(this,arguments)},render:function render(data){data=data||{};initializeSelleckt(this);softRender(this,data);this.render=softRender.bind(null,this)},open:function open(){if(!this.selleckt||typeof this.selleckt._open!=="function"){return}this.selleckt._open()},remove:function remove(){if(this.selleckt){this.selleckt.destroy();this.selleckt=undefined}}});return SellecktView});define("mustache!src/querywizard/templates/elements/languageSelectView",["lib/mustache"],function(mustache){var escapedTemplate='<div class="query-wizard-language pagemargin-top pagemargin-bottom">\n<span class="biggertext hugeline db singlepadding-bottom">Track conversations in</span>\n<div class="singlemargin-left qw-radio-select-container">\n<input class="js-specific-languages" id="specific-languages" type="radio" name="language"{{^languageData}} disabled{{/languageData}}>\n<div class="qw-radio-select-container__label smallmargin-left">\n<label for="specific-languages">Specific languages</label>\n<div class="js-languages-container">\n<div class="js-language"></div>\n{{#showSnippetsInfo}}\n<span class="js-exclusions-info db smallpadding-top smalltext lightgrey">If you change the language, you might need to reselect the exclusion topics.</span>\n{{/showSnippetsInfo}}\n</div>\n</div>\n</div>\n<div class="singlemargin-left singlemargin-top">\n<input class="js-ignore-languages" id="ignore-languages" type="radio" name="language"\n{{^languageData}} disabled{{/languageData}}><label class="smallmargin-left dib"\nfor="ignore-languages">Ignore languages (more data)</label><a\nclass="help icon-bwhelp valigntop tinymargin-left" data-key="language-agnostic-query"></a>\n</div>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("text!src/querywizard/templates/elements/popup.template",[],function(){return'<div class="{{itemsClass}} fullwidth lightshadow">\n    {{#showSearch}}\n    <div class="searchContainer smallpadding relative db">\n        <input class="{{searchInputClass}} rounded"></input>\n    </div>\n    {{/showSearch}}\n    <ul class="{{itemslistClass}}">\n        {{#items}}\n            {{> item}}\n        {{/items}}\n        {{^items}}\n        <li class="empty smallpadding relative db textellipsis">\n            <span class="{{itemTextClass}} lightgrey">Start typing a location</span>\n        </li>\n        {{/items}}\n    </ul>\n</div>\n'});define("text!src/querywizard/templates/elements/item.template",[],function(){return'<li class="{{itemClass}} smallpadding relative db textellipsis" data-text="{{data.shortName}}" data-value="{{value}}" data-type="{{type}}">\n    <span class="{{itemTextClass}}">{{label}}</span>\n</li>\n'});define("text!src/querywizard/templates/elements/selection.template",[],function(){return'<li class="selectionItem" data-value="{{value}}">{{data.shortName}}<i class="icon-remove lightgrey iconsmaller smallmargin-left {{unselectItemClass}}"></i></li>\n'});define("src/querywizard/views/elements/LanguageSelectView",["backbone","underscore","bw-fe-helpers/validationHelpers","src/querywizard/QueryWizardActions","src/querywizard/events/QueryWizardEventNames","src/querywizard/views/elements/SellecktView","mustache!src/querywizard/templates/elements/languageSelectView","text!src/querywizard/templates/elements/popup.template","text!src/querywizard/templates/elements/item.template","text!src/querywizard/templates/elements/selection.template"],function(Backbone,_,validationHelpers,QueryWizardActions,QueryWizardEventNames,SellecktView,template,popupTemplate,itemTemplate,selectionTemplate){"use strict";var VIEW_SELECTORS={SELECTION:".js-language",SELECTION_CONTAINER:".js-languages-container",RADIO_IGNORE_LANGUAGES:".js-ignore-languages",RADIO_SPECIFIC_LANGUAGES:".js-specific-languages"};function triggerFetchExclusionSnippets(view){view.trigger(QueryWizardEventNames.DISPATCH_ACTION,{type:QueryWizardActions.FETCH_EXCLUSION_SNIPPETS})}function getLanguageData(view){var languages;var selection=view._languageSelection.selleckt.getSelection();languages=selection.map(function(item){return item.value});return{languages:languages,languagesEdited:true}}function selectionChanged(view){view.trigger(QueryWizardEventNames.STATE_CHANGE,getLanguageData(view));triggerFetchExclusionSnippets(view)}function softRender(view,data){var searchItems;var selectedItems;var $selectionContainer=view.$(VIEW_SELECTORS.SELECTION_CONTAINER);var $radioIgnoreLanguages=view.$(VIEW_SELECTORS.RADIO_IGNORE_LANGUAGES);var $radioSpecificLanguages=view.$(VIEW_SELECTORS.RADIO_SPECIFIC_LANGUAGES);data=data||{};searchItems=[].concat(data.languageData||[]);if(!searchItems.length){$selectionContainer.addClass("hidden");return}selectedItems=(data.languages||[]).map(function(languageId){return _.findWhere(data.languageData,{value:languageId})});view._languageSelection.render({selectedItems:selectedItems,searchItems:searchItems});if(data.languageData){$radioIgnoreLanguages.prop("disabled",false);$radioSpecificLanguages.prop("disabled",false);$selectionContainer.removeClass("hidden")}if(data.languageAgnostic){$selectionContainer.addClass("hidden");$radioIgnoreLanguages.prop("checked",true);return}$selectionContainer.removeClass("hidden");$radioSpecificLanguages.prop("checked",true)}var LanguageSelectView=Backbone.View.extend({constructor:function LanguageSelectView(){Backbone.View.apply(this,arguments)},events:{"click .js-specific-languages":function onSpecificLanguagesClick(){this.trigger(QueryWizardEventNames.STATE_CHANGE,{languageAgnostic:false})},"click .js-ignore-languages":function onIgnoreLanguagesClick(){this.trigger(QueryWizardEventNames.STATE_CHANGE,{languageAgnostic:true})}},render:function render(data){data=data||{};this._languageSelection=new SellecktView({name:"location",multiple:true,enableSearch:true,searchThreshold:-1,placeholderText:"Add a Language",alternatePlaceholder:"Add another Language",popupTemplate:popupTemplate,itemTemplate:itemTemplate,selectionTemplate:selectionTemplate,selectionsClass:"selections"});this.$el.html(template(_.extend({},data,{showSnippetsInfo:!validationHelpers.isNullOrEmptyArray(data.exclusionSnippets)})));this.$(VIEW_SELECTORS.SELECTION).html(this._languageSelection.el);this.listenTo(this._languageSelection,"selectionChanged",selectionChanged.bind(null,this));softRender(this,data);this.render=softRender.bind(null,this)},remove:function remove(){if(this._languageSelection){this._languageSelection.remove();this._languageSelection=undefined}Backbone.View.prototype.remove.call(this)}});return LanguageSelectView});var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(l,k,x){if(x.get||x.set)throw new TypeError("ES3 does not support getters and setters.");l!=Array.prototype&&l!=Object.prototype&&(l[k]=x.value)};$jscomp.getGlobal=function(l){return"undefined"!=typeof window&&window===l?l:"undefined"!=typeof global&&null!=global?global:l};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(l,k,x,B){if(k){x=$jscomp.global;l=l.split(".");for(B=0;B<l.length-1;B++){var q=l[B];q in x||(x[q]={});x=x[q]}l=l[l.length-1];B=x[l];k=k(B);k!=B&&null!=k&&$jscomp.defineProperty(x,l,{configurable:!0,writable:!0,value:k})}};$jscomp.polyfill("Object.setPrototypeOf",function(l){return l?l:"object"!=typeof"".__proto__?null:function(k,l){k.__proto__=l;if(k.__proto__!==l)throw new TypeError(k+" is not extensible");return k}},"es6","es5");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(l){return $jscomp.SYMBOL_PREFIX+(l||"")+$jscomp.symbolCounter_++};$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var l=$jscomp.global.Symbol.iterator;l||(l=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[l]&&$jscomp.defineProperty(Array.prototype,l,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(l){var k=0;return $jscomp.iteratorPrototype(function(){return k<l.length?{done:!1,value:l[k++]}:{done:!0}})};$jscomp.iteratorPrototype=function(l){$jscomp.initSymbolIterator();l={next:l};l[$jscomp.global.Symbol.iterator]=function(){return this};return l};$jscomp.array=$jscomp.array||{};$jscomp.iteratorFromArray=function(l,k){$jscomp.initSymbolIterator();l instanceof String&&(l+="");var x=0,B={next:function(){if(x<l.length){var q=x++;return{value:k(q,l[q]),done:!1}}B.next=function(){return{done:!0,value:void 0}};return B.next()}};B[Symbol.iterator]=function(){return B};return B};$jscomp.polyfill("Array.prototype.values",function(l){return l?l:function(){return $jscomp.iteratorFromArray(this,function(k,l){return l})}},"es6","es3");$jscomp.polyfill("Array.prototype.keys",function(l){return l?l:function(){return $jscomp.iteratorFromArray(this,function(k){return k})}},"es6-impl","es3");(function(l,k){"object"===typeof exports&&"undefined"!==typeof module?k(exports):"function"===typeof define&&define.amd?define("rx",["exports"],k):k(l.Rx=l.Rx||{})})(this,function(l){function k(b,a){function c(){this.constructor=b}hd(b,a);b.prototype=null===a?Object.create(a):(c.prototype=a.prototype,new c)}function x(b){return"function"===typeof b}function B(){try{return za.apply(this,arguments)}catch(b){return n.e=b,n}}function q(b){za=b;return B}function Aa(b){return b.reduce(function(a,c){return a.concat(c instanceof S?c.errors:c)},[])}function id(){}function la(){for(var b=[],a=0;a<arguments.length;a++)b[a-0]=arguments[a];return Ba(b)}function Ba(b){return b?1===b.length?b[0]:function(a){return b.reduce(function(c,a){return a(c)},a)}:id}function Ca(b){var a=b.subject;a.next(b.value);a.complete()}function jd(b){b.subject.error(b.err)}function kd(b){var a=this,c=b.source,e=b.subscriber;b=b.context;var d=c.callbackFunc,f=c.args,h=c.scheduler,g=c.subject;if(!g){var g=c.subject=new P,k=function ld(){for(var c=[],b=0;b<arguments.length;b++)c[b-0]=arguments[b];var e=ld.source,b=e.selector,e=e.subject,d=c.shift();d?a.add(h.schedule(ma,0,{err:d,subject:e})):b?(c=q(b).apply(this,c),c===n?a.add(h.schedule(ma,0,{err:n.e,subject:e})):a.add(h.schedule(Da,0,{value:c,subject:e}))):a.add(h.schedule(Da,0,{value:1>=c.length?c[0]:c,subject:e}))};k.source=c;q(d).apply(b,f.concat(k))===n&&a.add(h.schedule(ma,0,{err:n.e,subject:g}))}a.add(g.subscribe(e))}function Da(b){var a=b.subject;a.next(b.value);a.complete()}function ma(b){b.subject.error(b.err)}function A(b){return b&&"function"===typeof b.schedule}function Ea(b){return b&&"function"!==typeof b.subscribe&&"function"===typeof b.then}function r(b,a,c,e){var d=new Fa(b,c,e);if(d.closed)return null;if(a instanceof g)if(a._isScalar)d.next(a.value),d.complete();else return d.syncErrorThrowable=!0,a.subscribe(d);else if(a&&"number"===typeof a.length){b=0;for(c=a.length;b<c&&!d.closed;b++)d.next(a[b]);d.closed||d.complete()}else{if(Ea(a))return a.then(function(c){d.closed||(d.next(c),d.complete())},function(c){return d.error(c)}).then(null,function(c){p.setTimeout(function(){throw c})}),d;if(a&&"function"===typeof a[C]){a=a[C]();do{b=a.next();if(b.done){d.complete();break}d.next(b.value);if(d.closed)break}while(1)}else if(a&&"function"===typeof a[J])if(a=a[J](),"function"!==typeof a.subscribe)d.error(new TypeError("Provided object does not correctly implement Symbol.observable"));else return a.subscribe(new Fa(b,c,e));else d.error(new TypeError("You provided "+(null!=a&&"object"===typeof a?"an invalid object":"'"+a+"'")+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable."))}return null}function Ga(){for(var b=[],a=0;a<arguments.length;a++)b[a-0]=arguments[a];var c=null;"function"===typeof b[b.length-1]&&(c=b.pop());1===b.length&&E(b[0])&&(b=b[0].slice());return function(a){return a.lift.call(new G([a].concat(b)),new na(c))}}function Ha(b){var a=b.value;b=b.subscriber;b.closed||(b.next(a),b.complete())}function nd(b){var a=b.err;b=b.subscriber;b.closed||b.error(a)}function Ia(b,a){void 0===a&&(a=0);return function(c){return c.lift(new od(b,a))}}function T(b,a,c){void 0===c&&(c=Number.POSITIVE_INFINITY);return function(e){"number"===typeof a&&(c=a,a=null);return e.lift(new pd(b,a,c))}}function Ja(b){return b}function ba(b){void 0===b&&(b=Number.POSITIVE_INFINITY);return T(Ja,null,b)}function oa(){return ba(1)}function U(){for(var b=[],a=0;a<arguments.length;a++)b[a-0]=arguments[a];return 1===b.length||2===b.length&&A(b[1])?Ka(b[0]):oa()(La.apply(void 0,b))}function K(b){return!E(b)&&0<=b-parseFloat(b)+1}function Ma(){for(var b=[],a=0;a<arguments.length;a++)b[a-0]=arguments[a];var a=Number.POSITIVE_INFINITY,c=null,e=b[b.length-1];A(e)?(c=b.pop(),1<b.length&&"number"===typeof b[b.length-1]&&(a=b.pop())):"number"===typeof e&&(a=b.pop());return null===c&&1===b.length&&b[0]instanceof g?b[0]:ba(a)(new G(b,c))}function Na(){for(var b=[],a=0;a<arguments.length;a++)b[a-0]=arguments[a];if(1===b.length)if(E(b[0]))b=b[0];else return b[0];return new G(b).lift(new qd)}function Oa(){for(var b=[],a=0;a<arguments.length;a++)b[a-0]=arguments[a];1===b.length&&E(b[0])&&(b=b[0]);return function(c){return c.lift(new Pa(b))}}function rd(b){var a=b.obj,c=b.keys,e=b.index,d=b.subscriber;e===b.length?d.complete():(c=c[e],d.next([c,a[c]]),b.index=e+1,this.schedule(b))}function ca(b){return b instanceof Date&&!isNaN(+b)}function Qa(){for(var b=[],a=0;a<arguments.length;a++)b[a-0]=arguments[a];return function(c){return c.lift.call(Ra.apply(void 0,[c].concat(b)))}}function Ra(){for(var b=[],a=0;a<arguments.length;a++)b[a-0]=arguments[a];a=b[b.length-1];"function"===typeof a&&b.pop();return new G(b).lift(new Sa(a))}function V(b,a){return function(c){if("function"!==typeof b)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return c.lift(new sd(b,a))}}function td(b,a){void 0===a&&(a=null);return new L({method:"GET",url:b,headers:a})}function ud(b,a,c){return new L({method:"POST",url:b,body:a,headers:c})}function vd(b,a){return new L({method:"DELETE",url:b,headers:a})}function wd(b,a,c){return new L({method:"PUT",url:b,body:a,headers:c})}function xd(b,a,c){return new L({method:"PATCH",url:b,body:a,headers:c})}function yd(b,a){return zd(new L({method:"GET",url:b,responseType:"json",headers:a}))}function Ta(b,a){switch(b){case"json":return"response"in a?a.responseType?a.response:JSON.parse(a.response||a.responseText||"null"):JSON.parse(a.responseText||"null");case"xml":return a.responseXML;default:return"response"in a?a.response:a.responseText}}function Ad(b){for(var a=[],c=1;c<arguments.length;c++)a[c-1]=arguments[c];for(var c=a.length,e=0;e<c;e++){var d=a[e],f;for(f in d)d.hasOwnProperty(f)&&(b[f]=d[f])}return b}function Ua(b){return function(a){return a.lift(new Bd(b))}}function Va(b,a){void 0===a&&(a=null);return function(c){return c.lift(new Cd(b,a))}}function Wa(b){var a=arguments.length,c=u;A(arguments[arguments.length-1])&&(c=arguments[arguments.length-1],a--);var e=null;2<=a&&(e=arguments[1]);var d=Number.POSITIVE_INFINITY;3<=a&&(d=arguments[2]);return function(a){return a.lift(new Dd(b,e,d,c))}}function Xa(b){var a=b.subscriber,c=b.context;c&&a.closeContext(c);a.closed||(b.context=a.openContext(),b.context.closeAction=this.schedule(b,b.bufferTimeSpan))}function Ed(b){var a=b.bufferCreationInterval,c=b.bufferTimeSpan,e=b.subscriber,d=b.scheduler,f=e.openContext();e.closed||(e.add(f.closeAction=d.schedule(Ya,c,{subscriber:e,context:f})),this.schedule(b,a))}function Ya(b){b.subscriber.closeContext(b.context)}function Za(b,a){return function(c){return c.lift(new Fd(b,a))}}function $a(b){return function(a){return a.lift(new Gd(b))}}function ab(b){return function(a){var c=new Hd(b);a=a.lift(c);return c.caught=a}}function bb(b){return ab(b)(this)}function cb(b){return function(a){return a.lift(new na(b))}}function db(){for(var b=[],a=0;a<arguments.length;a++)b[a-0]=arguments[a];return function(c){return c.lift.call(U.apply(void 0,[c].concat(b)))}}function pa(b,a){return T(b,a,1)}function eb(b,a){return pa(function(){return b},a)}function fb(b){return function(a){return a.lift(new Id(b,a))}}function gb(){return function(b){return b.lift(new Jd)}}function hb(b){return function(a){return a.lift(new Kd(b))}}function ib(b,a){void 0===a&&(a=u);return function(c){return c.lift(new Ld(b,a))}}function Md(b){b.debouncedNext()}function qa(b){void 0===b&&(b=null);return function(a){return a.lift(new Nd(b))}}function jb(b,a){void 0===a&&(a=u);var c=ca(b)?+b-a.now():Math.abs(b);return function(b){return b.lift(new Od(c,a))}}function kb(b,a){return a?function(c){return new Pd(c,a).lift(new lb(b))}:function(c){return c.lift(new lb(b))}}function Qd(){return function(){function b(){this._values=[]}b.prototype.add=function(a){this.has(a)||this._values.push(a)};b.prototype.has=function(a){return-1!==this._values.indexOf(a)};Object.defineProperty(b.prototype,"size",{get:function(){return this._values.length},enumerable:!0,configurable:!0});b.prototype.clear=function(){this._values.length=0};return b}()}function mb(b,a){return function(c){return c.lift(new Rd(b,a))}}function ra(b,a){return function(c){return c.lift(new Sd(b,a))}}function nb(b,a){return ra(function(c,e){return a?a(c[b],e[b]):c[b]===e[b]})}function ob(b,a,c){return function(e){return e.lift(new Td(b,a,c))}}function pb(b,a,c){return ob(b,a,c)(this)}function qb(){return function(b){return b.lift(new Ud)}}function rb(b,a){return function(c){return c.lift(new Vd(b,a))}}function sb(b,a,c){void 0===a&&(a=Number.POSITIVE_INFINITY);void 0===c&&(c=void 0);a=1>(a||0)?Number.POSITIVE_INFINITY:a;return function(e){return e.lift(new Wd(b,a,c))}}function tb(b,a){return function(c){return c.lift(new Xd(b,a))}}function da(b,a){return function(c){return c.lift(new Yd(b,a))}}function ub(b){return function(a){return a.lift(new Zd(b))}}function vb(b){return ub(b)(this)}function wb(b,a){if("function"!==typeof b)throw new TypeError("predicate is not a function");return function(c){return c.lift(new xb(b,c,!1,a))}}function yb(b,a){return function(c){return c.lift(new xb(b,c,!0,a))}}function zb(b,a,c){return function(e){return e.lift(new $d(b,a,c,e))}}function Ab(b,a,c,e){return function(d){return d.lift(new ae(b,a,c,e))}}function Bb(){return function(b){return b.lift(new be)}}function Cb(){return function(b){return b.lift(new ce)}}function sa(b){return function(a){return a.lift(new de(b))}}function Db(b,a){void 0===a&&(a=u);return sa(function(){return Eb(b,a)})}function Fb(b,a,c){return function(e){return e.lift(new ee(b,a,c,e))}}function Gb(b){return b(this)}function Hb(b,a){return function(c){return c.lift(new fe(b,a,c))}}function Ib(b){return function(a){return a.lift(new ge(b))}}function Jb(){return function(b){return b.lift(new he)}}function W(b,a){var c=!1;2<=arguments.length&&(c=!0);return function(e){return e.lift(new ie(b,a,c))}}function ea(b){return function(a){return 0===b?new F:a.lift(new je(b))}}function Q(b,a){return 2<=arguments.length?function(c){return la(W(b,a),ea(1),qa(a))(c)}:function(c){return la(W(function(c,a,f){return b(c,a,f+1)}),ea(1))(c)}}function Kb(b){return Q("function"===typeof b?function(a,c){return 0<b(a,c)?a:c}:function(a,c){return a>c?a:c})}function Lb(){for(var b=[],a=0;a<arguments.length;a++)b[a-0]=arguments[a];return function(c){return c.lift.call(Ma.apply(void 0,[c].concat(b)))}}function Mb(b,a,c){void 0===c&&(c=Number.POSITIVE_INFINITY);return T(b,a,c)(this)}function Nb(b,a,c){void 0===c&&(c=Number.POSITIVE_INFINITY);"number"===typeof a&&(c=a,a=null);return function(e){return e.lift(new ke(b,a,c))}}function Ob(b,a,c){void 0===c&&(c=Number.POSITIVE_INFINITY);return Nb(b,a,c)(this)}function Pb(b,a,c){void 0===c&&(c=Number.POSITIVE_INFINITY);return function(e){return e.lift(new le(b,a,c))}}function Qb(b){return Q("function"===typeof b?function(a,c){return 0>b(a,c)?a:c}:function(a,c){return a<c?a:c})}function ta(){return function(b){return b.lift(new me(b))}}function H(b,a){return function(c){var e;e="function"===typeof b?b:function(){return b};if("function"===typeof a)return c.lift(new ne(e,a));var d=Object.create(c,oe);d.source=c;d.subjectFactory=e;return d}}function Rb(){return function(b){return b.lift(new pe)}}function qe(b,a){function c(){return!c.pred.apply(c.thisArg,arguments)}c.pred=b;c.thisArg=a;return c}function Sb(b,a){return function(c){return[da(b,a)(c),da(qe(b,a))(c)]}}function Tb(){for(var b=[],a=0;a<arguments.length;a++)b[a-0]=arguments[a];var c=b.length;if(0===c)throw Error("list of properties cannot be empty.");return function(a){return V(re(b,c))(a)}}function re(b,a){return function(c){var e=c;for(c=0;c<a;c++)if(e=e[b[c]],"undefined"===typeof e)return;return e}}function Ub(b){return b?H(function(){return new w},b):H(new w)}function Vb(b){return function(a){return H(new Wb(b))(a)}}function Xb(b,a,c,e){c&&"function"!==typeof c&&(e=c);var d="function"===typeof c?c:void 0,f=new M(b,a,e);return function(c){return H(function(){return f},d)(c)}}function Yb(){return function(b){return H(new P)(b)}}function Zb(){for(var b=[],a=0;a<arguments.length;a++)b[a-0]=arguments[a];return function(c){1===b.length&&E(b[0])&&(b=b[0]);return c.lift.call(Na.apply(void 0,[c].concat(b)))}}function $b(b){void 0===b&&(b=-1);return function(a){return 0===b?new F:0>b?a.lift(new ac(-1,a)):a.lift(new ac(b-1,a))}}function bc(b){return function(a){return a.lift(new se(b))}}function cc(b){void 0===b&&(b=-1);return function(a){return a.lift(new te(b,a))}}function dc(b){return function(a){return a.lift(new ue(b,a))}}function ec(b){return function(a){return a.lift(new ve(b))}}function fc(b,a){void 0===a&&(a=u);return function(c){return c.lift(new we(b,a))}}function xe(b){var a=b.period;b.subscriber.notifyNext();this.schedule(b,a)}function gc(b,a){return function(c){return c.lift(new ye(b,a))}}function ze(){return new w}function hc(){return function(b){return ta()(H(ze)(b))}}function ic(b,a,c){return function(e){return e.lift(Ae(b,a,c))}}function Ae(b,a,c){var e,d=0,f,h=!1,g=!1;return function(k){d++;if(!e||h)h=!1,e=new M(b,a,c),f=k.subscribe({next:function(c){e.next(c)},error:function(c){h=!0;e.error(c)},complete:function(){g=!0;e.complete()}});var z=e.subscribe(this);return function(){d--;z.unsubscribe();f&&0===d&&g&&f.unsubscribe()}}}function jc(b){return function(a){return a.lift(new Be(b,a))}}function kc(b){return function(a){return a.lift(new Ce(b))}}function lc(b){return function(a){return a.lift(new De(b))}}function mc(b){return function(a){return a.lift(new Ee(b))}}function nc(b){return function(a){return a.lift(new Fe(b))}}function oc(){for(var b=[],a=0;a<arguments.length;a++)b[a-0]=arguments[a];return function(c){var a=b[b.length-1];A(a)?b.pop():a=null;var d=b.length;return 1===d?U(new ua(b[0],a),c):1<d?U(new G(b,a),c):U(new F(a),c)}}function Ge(b,a){void 0===a&&(a=0);return function(c){return c.lift(new He(b,a))}}function va(b,a){return function(c){return c.lift(new Ie(b,a))}}function pc(){return va(Ja)}function qc(){return pc()(this)}function rc(b,a){return function(c){return c.lift(new Je(b,a))}}function sc(b){return function(a){return 0===b?new F:a.lift(new Ke(b))}}function tc(b){return function(a){return a.lift(new Le(b))}}function uc(b){return function(a){return a.lift(new Me(b))}}function vc(b,a){void 0===a&&(a=fa);return function(c){return c.lift(new Ne(b,a.leading,a.trailing))}}function wc(b,a,c){void 0===a&&(a=u);void 0===c&&(c=fa);return function(e){return e.lift(new Oe(b,a,c.leading,c.trailing))}}function Pe(b){b.subscriber.clearThrottle()}function xc(b){void 0===b&&(b=u);return function(a){return a.lift(new Qe(b))}}function yc(b,a){void 0===a&&(a=u);var c=ca(b),e=c?+b-a.now():Math.abs(b);return function(b){return b.lift(new Re(e,c,a,new zc))}}function Ac(b,a,c){void 0===c&&(c=u);return function(e){var d=ca(b),f=d?+b-c.now():Math.abs(b);return e.lift(new Se(f,d,a,c))}}function Bc(b){void 0===b&&(b=u);return V(function(a){return new Cc(a,b.now())})}function Te(b,a,c){if(0===c)return[a];b.push(a);return b}function Dc(){return Q(Te,[])}function Ec(b){return function(a){return a.lift(new Ue(b))}}function Fc(b,a){void 0===a&&(a=0);return function(c){return c.lift(new Ve(b,a))}}function Gc(b,a,c,e){var d=u,f=null,h=Number.POSITIVE_INFINITY;A(e)&&(d=e);A(c)?d=c:K(c)&&(h=c);A(a)?d=a:K(a)&&(f=a);return function(c){return c.lift(new We(b,f,h,d))}}function Xe(b){var a=b.subscriber,c=b.windowTimeSpan,e=b.window;e&&a.closeWindow(e);b.window=a.openWindow();this.schedule(b,c)}function Ye(b){var a=b.windowTimeSpan,c=b.subscriber,e=b.scheduler,d=b.windowCreationInterval,f=c.openWindow(),h={action:this,subscription:null};h.subscription=e.schedule(Hc,a,{subscriber:c,window:f,context:h});this.add(h.subscription);this.schedule(b,d)}function Hc(b){var a=b.subscriber,c=b.window;(b=b.context)&&b.action&&b.subscription&&b.action.remove(b.subscription);a.closeWindow(c)}function Ic(b,a){return function(c){return c.lift(new Ze(b,a))}}function Jc(b){return function(a){return a.lift(new $e(b))}}function Kc(){for(var b=[],a=0;a<arguments.length;a++)b[a-0]=arguments[a];return function(c){var a;"function"===typeof b[b.length-1]&&(a=b.pop());return c.lift(new af(b,a))}}function Lc(b){return function(a){return a.lift(new Sa(b))}}function Mc(b,a){for(var c=0,e=a.length;c<e;c++)for(var d=a[c],f=Object.getOwnPropertyNames(d.prototype),h=0,g=f.length;h<g;h++){var k=f[h];b.prototype[k]=d.prototype[k]}}var hd=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,a){b.__proto__=a}||function(b,a){for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c])},bf="undefined"!==typeof self&&"undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,cf="undefined"!==typeof global&&global,p="undefined"!==typeof window&&window||cf||bf;if(!p)throw Error("RxJS could not find any global context (window, self, global)");var E=Array.isArray||function(b){return b&&"number"===typeof b.length},n={e:{}},za,S=function(b){function a(c){b.call(this);this.errors=c;c=Error.call(this,c?c.length+" errors occurred during unsubscription:\n  "+c.map(function(c,a){return a+1+") "+c.toString()}).join("\n  "):"");this.name=c.name="UnsubscriptionError";this.stack=c.stack;this.message=c.message}k(a,b);return a}(Error),v=function(){function b(a){this.closed=!1;this._subscriptions=this._parents=this._parent=null;a&&(this._unsubscribe=a)}b.prototype.unsubscribe=function(){var a=!1,c;if(!this.closed){var b=this._parent,d=this._parents,f=this._unsubscribe,h=this._subscriptions;this.closed=!0;this._subscriptions=this._parents=this._parent=null;for(var g=-1,k=d?d.length:0;b;)b.remove(this),b=++g<k&&d[g]||null;x(f)&&(b=q(f).call(this),b===n&&(a=!0,c=c||(n.e instanceof S?Aa(n.e.errors):[n.e])));if(E(h))for(g=-1,k=h.length;++g<k;)b=h[g],null!=b&&"object"===typeof b&&(b=q(b.unsubscribe).call(b),b===n&&(a=!0,c=c||[],b=n.e,b instanceof S?c=c.concat(Aa(b.errors)):c.push(b)));if(a)throw new S(c)}};b.prototype.add=function(a){if(!a||a===b.EMPTY)return b.EMPTY;if(a===this)return this;var c=a;switch(typeof a){case"function":c=new b(a);case"object":if(c.closed||"function"!==typeof c.unsubscribe)return c;if(this.closed)return c.unsubscribe(),c;"function"!==typeof c._addParent&&(a=c,c=new b,c._subscriptions=[a]);break;default:throw Error("unrecognized teardown "+a+" added to Subscription.")}(this._subscriptions||(this._subscriptions=[])).push(c);c._addParent(this);return c};b.prototype.remove=function(a){var c=this._subscriptions;c&&(a=c.indexOf(a),-1!==a&&c.splice(a,1))};b.prototype._addParent=function(a){var c=this._parent,b=this._parents;c&&c!==a?b?-1===b.indexOf(a)&&b.push(a):this._parents=[a]:this._parent=a};b.EMPTY=function(a){a.closed=!0;return a}(new b);return b}(),ga={closed:!0,next:function(b){},error:function(b){throw b},complete:function(){}},wa=p.Symbol,O="function"===typeof wa&&"function"===typeof wa.for?wa.for("rxSubscriber"):"@@rxSubscriber",m=function(b){function a(c,a,d){b.call(this);this.syncErrorValue=null;this.isStopped=this.syncErrorThrowable=this.syncErrorThrown=!1;switch(arguments.length){case 0:this.destination=ga;break;case 1:if(!c){this.destination=ga;break}if("object"===typeof c){if(c instanceof m||"syncErrorThrowable"in c&&c[O]){var e=c[O]();this.syncErrorThrowable=e.syncErrorThrowable;this.destination=e;e.add(this)}else this.syncErrorThrowable=!0,this.destination=new Nc(this,c);break}default:this.syncErrorThrowable=!0,this.destination=new Nc(this,c,a,d)}}k(a,b);a.prototype[O]=function(){return this};a.create=function(c,b,d){c=new a(c,b,d);c.syncErrorThrowable=!1;return c};a.prototype.next=function(c){this.isStopped||this._next(c)};a.prototype.error=function(c){this.isStopped||(this.isStopped=!0,this._error(c))};a.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())};a.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,b.prototype.unsubscribe.call(this))};a.prototype._next=function(c){this.destination.next(c)};a.prototype._error=function(c){this.destination.error(c);this.unsubscribe()};a.prototype._complete=function(){this.destination.complete();this.unsubscribe()};a.prototype._unsubscribeAndRecycle=function(){var c=this._parent,a=this._parents;this._parents=this._parent=null;this.unsubscribe();this.isStopped=this.closed=!1;this._parent=c;this._parents=a;return this};return a}(v),Nc=function(b){function a(c,a,d,f){b.call(this);this._parentSubscriber=c;var e;c=this;x(a)?e=a:a&&(e=a.next,d=a.error,f=a.complete,a!==ga&&(c=Object.create(a),x(c.unsubscribe)&&this.add(c.unsubscribe.bind(c)),c.unsubscribe=this.unsubscribe.bind(this)));this._context=c;this._next=e;this._error=d;this._complete=f}k(a,b);a.prototype.next=function(c){if(!this.isStopped&&this._next){var a=this._parentSubscriber;a.syncErrorThrowable?this.__tryOrSetError(a,this._next,c)&&this.unsubscribe():this.__tryOrUnsub(this._next,c)}};a.prototype.error=function(c){if(!this.isStopped){var a=this._parentSubscriber;if(this._error)a.syncErrorThrowable?this.__tryOrSetError(a,this._error,c):this.__tryOrUnsub(this._error,c),this.unsubscribe();else if(a.syncErrorThrowable)a.syncErrorValue=c,a.syncErrorThrown=!0,this.unsubscribe();else throw this.unsubscribe(),c}};a.prototype.complete=function(){var c=this;if(!this.isStopped){var a=this._parentSubscriber;if(this._complete){var b=function(){return c._complete.call(c._context)};a.syncErrorThrowable?this.__tryOrSetError(a,b):this.__tryOrUnsub(b)}this.unsubscribe()}};a.prototype.__tryOrUnsub=function(c,a){try{c.call(this._context,a)}catch(d){throw this.unsubscribe(),d}};a.prototype.__tryOrSetError=function(c,a,b){try{a.call(this._context,b)}catch(f){return c.syncErrorValue=f,c.syncErrorThrown=!0}return!1};a.prototype._unsubscribe=function(){var c=this._parentSubscriber;this._parentSubscriber=this._context=null;c.unsubscribe()};return a}(m),J=function(b){var a=b.Symbol;"function"===typeof a?a.observable?b=a.observable:(b=a("observable"),a.observable=b):b="@@observable";return b}(p),g=function(){function b(a){this._isScalar=!1;a&&(this._subscribe=a)}b.prototype.lift=function(a){var c=new b;c.source=this;c.operator=a;return c};b.prototype.subscribe=function(a,c,b){var e=this.operator;a:{if(a){if(a instanceof m)break a;if(a[O]){a=a[O]();break a}}a=a||c||b?new m(a,c,b):new m(ga)}e?e.call(a,this.source):a.add(this.source||!a.syncErrorThrowable?this._subscribe(a):this._trySubscribe(a));if(a.syncErrorThrowable&&(a.syncErrorThrowable=!1,a.syncErrorThrown))throw a.syncErrorValue;return a};b.prototype._trySubscribe=function(a){try{return this._subscribe(a)}catch(c){a.syncErrorThrown=!0,a.syncErrorValue=c,a.error(c)}};b.prototype.forEach=function(a,c){var b=this;c||(p.Rx&&p.Rx.config&&p.Rx.config.Promise?c=p.Rx.config.Promise:p.Promise&&(c=p.Promise));if(!c)throw Error("no Promise impl found");return new c(function(c,e){var d;d=b.subscribe(function(c){if(d)try{a(c)}catch(D){e(D),d.unsubscribe()}else a(c)},e,c)})};b.prototype._subscribe=function(a){return this.source.subscribe(a)};b.prototype[J]=function(){return this};b.prototype.pipe=function(){for(var a=[],c=0;c<arguments.length;c++)a[c-0]=arguments[c];return 0===a.length?this:Ba(a)(this)};b.prototype.toPromise=function(a){var c=this;a||(p.Rx&&p.Rx.config&&p.Rx.config.Promise?a=p.Rx.config.Promise:p.Promise&&(a=p.Promise));if(!a)throw Error("no Promise impl found");return new a(function(a,b){var e;c.subscribe(function(c){return e=c},function(c){return b(c)},function(){return a(e)})})};b.create=function(a){return new b(a)};return b}(),I=function(b){function a(){var c=b.call(this,"object unsubscribed");this.name=c.name="ObjectUnsubscribedError";this.stack=c.stack;this.message=c.message}k(a,b);return a}(Error),Oc=function(b){function a(c,a){b.call(this);this.subject=c;this.subscriber=a;this.closed=!1}k(a,b);a.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var c=this.subject,a=c.observers;this.subject=null;!a||0===a.length||c.isStopped||c.closed||(c=a.indexOf(this.subscriber),-1!==c&&a.splice(c,1))}};return a}(v),Pc=function(b){function a(c){b.call(this,c);this.destination=c}k(a,b);return a}(m),w=function(b){function a(){b.call(this);this.observers=[];this.hasError=this.isStopped=this.closed=!1;this.thrownError=null}k(a,b);a.prototype[O]=function(){return new Pc(this)};a.prototype.lift=function(c){var a=new ha(this,this);a.operator=c;return a};a.prototype.next=function(c){if(this.closed)throw new I;if(!this.isStopped)for(var a=this.observers,b=a.length,a=a.slice(),f=0;f<b;f++)a[f].next(c)};a.prototype.error=function(c){if(this.closed)throw new I;this.hasError=!0;this.thrownError=c;this.isStopped=!0;for(var a=this.observers,b=a.length,a=a.slice(),f=0;f<b;f++)a[f].error(c);this.observers.length=0};a.prototype.complete=function(){if(this.closed)throw new I;this.isStopped=!0;for(var c=this.observers,a=c.length,c=c.slice(),b=0;b<a;b++)c[b].complete();this.observers.length=0};a.prototype.unsubscribe=function(){this.closed=this.isStopped=!0;this.observers=null};a.prototype._trySubscribe=function(c){if(this.closed)throw new I;return b.prototype._trySubscribe.call(this,c)};a.prototype._subscribe=function(c){if(this.closed)throw new I;if(this.hasError)return c.error(this.thrownError),v.EMPTY;if(this.isStopped)return c.complete(),v.EMPTY;this.observers.push(c);return new Oc(this,c)};a.prototype.asObservable=function(){var c=new g;c.source=this;return c};a.create=function(c,a){return new ha(c,a)};return a}(g),ha=function(b){function a(c,a){b.call(this);this.destination=c;this.source=a}k(a,b);a.prototype.next=function(c){var a=this.destination;a&&a.next&&a.next(c)};a.prototype.error=function(c){var a=this.destination;a&&a.error&&this.destination.error(c)};a.prototype.complete=function(){var c=this.destination;c&&c.complete&&this.destination.complete()};a.prototype._subscribe=function(c){return this.source?this.source.subscribe(c):v.EMPTY};return a}(w),P=function(b){function a(){b.apply(this,arguments);this.value=null;this.hasCompleted=this.hasNext=!1}k(a,b);a.prototype._subscribe=function(c){return this.hasError?(c.error(this.thrownError),v.EMPTY):this.hasCompleted&&this.hasNext?(c.next(this.value),c.complete(),v.EMPTY):b.prototype._subscribe.call(this,c)};a.prototype.next=function(c){this.hasCompleted||(this.value=c,this.hasNext=!0)};a.prototype.error=function(c){this.hasCompleted||b.prototype.error.call(this,c)};a.prototype.complete=function(){this.hasCompleted=!0;this.hasNext&&b.prototype.next.call(this,this.value);b.prototype.complete.call(this)};return a}(w),df=function(b){function a(c,a,d,f,h){b.call(this);this.callbackFunc=c;this.selector=a;this.args=d;this.context=f;this.scheduler=h}k(a,b);a.create=function(c,b,d){void 0===b&&(b=void 0);return function(){for(var e=[],h=0;h<arguments.length;h++)e[h-0]=arguments[h];return new a(c,b,e,this,d)}};a.prototype._subscribe=function(c){var b=this.callbackFunc,d=this.args,f=this.scheduler,h=this.subject;if(f)return f.schedule(a.dispatch,0,{source:this,subscriber:c,context:this.context});h||(h=this.subject=new P,f=function D(){for(var c=[],a=0;a<arguments.length;a++)c[a-0]=arguments[a];var b=D.source,a=b.selector,b=b.subject;a?(c=q(a).apply(this,c),c===n?b.error(n.e):(b.next(c),b.complete())):(b.next(1>=c.length?c[0]:c),b.complete())},f.source=this,q(b).apply(this.context,d.concat(f))===n&&h.error(n.e));return h.subscribe(c)};a.dispatch=function(c){var a=this,b=c.source,f=c.subscriber;c=c.context;var h=b.callbackFunc,g=b.args,k=b.scheduler,l=b.subject;if(!l){var l=b.subject=new P,m=function md(){for(var c=[],b=0;b<arguments.length;b++)c[b-0]=arguments[b];var e=md.source,b=e.selector,e=e.subject;b?(c=q(b).apply(this,c),c===n?a.add(k.schedule(jd,0,{err:n.e,subject:e})):a.add(k.schedule(Ca,0,{value:c,subject:e}))):a.add(k.schedule(Ca,0,{value:1>=c.length?c[0]:c,subject:e}))};m.source=b;q(h).apply(c,g.concat(m))===n&&l.error(n.e)}a.add(l.subscribe(f))};return a}(g).create;g.bindCallback=df;var ef=function(b){function a(c,a,d,f,h){b.call(this);this.callbackFunc=c;this.selector=a;this.args=d;this.context=f;this.scheduler=h}k(a,b);a.create=function(c,b,d){void 0===b&&(b=void 0);return function(){for(var e=[],h=0;h<arguments.length;h++)e[h-0]=arguments[h];return new a(c,b,e,this,d)}};a.prototype._subscribe=function(c){var a=this.callbackFunc,b=this.args,f=this.scheduler,h=this.subject;if(f)return f.schedule(kd,0,{source:this,subscriber:c,context:this.context});h||(h=this.subject=new P,f=function D(){for(var c=[],a=0;a<arguments.length;a++)c[a-0]=arguments[a];var b=D.source,a=b.selector,b=b.subject,e=c.shift();e?b.error(e):a?(c=q(a).apply(this,c),c===n?b.error(n.e):(b.next(c),b.complete())):(b.next(1>=c.length?c[0]:c),b.complete())},f.source=this,q(a).apply(this.context,b.concat(f))===n&&h.error(n.e));return h.subscribe(c)};return a}(g).create;g.bindNodeCallback=ef;var ua=function(b){function a(c,a){b.call(this);this.value=c;this.scheduler=a;this._isScalar=!0;a&&(this._isScalar=!1)}k(a,b);a.create=function(c,b){return new a(c,b)};a.dispatch=function(c){var a=c.value,b=c.subscriber;c.done?b.complete():(b.next(a),b.closed||(c.done=!0,this.schedule(c)))};a.prototype._subscribe=function(c){var b=this.value,d=this.scheduler;if(d)return d.schedule(a.dispatch,0,{done:!1,value:b,subscriber:c});c.next(b);c.closed||c.complete()};return a}(g),F=function(b){function a(c){b.call(this);this.scheduler=c}k(a,b);a.create=function(c){return new a(c)};a.dispatch=function(c){c.subscriber.complete()};a.prototype._subscribe=function(c){var b=this.scheduler;if(b)return b.schedule(a.dispatch,0,{subscriber:c});c.complete()};return a}(g),G=function(b){function a(c,a){b.call(this);this.array=c;this.scheduler=a;a||1!==c.length||(this._isScalar=!0,this.value=c[0])}k(a,b);a.create=function(c,b){return new a(c,b)};a.of=function(){for(var c=[],b=0;b<arguments.length;b++)c[b-0]=arguments[b];b=c[c.length-1];A(b)?c.pop():b=null;var d=c.length;return 1<d?new a(c,b):1===d?new ua(c[0],b):new F(b)};a.dispatch=function(c){var a=c.array,b=c.index,f=c.subscriber;b>=c.count?f.complete():(f.next(a[b]),f.closed||(c.index=b+1,this.schedule(c)))};a.prototype._subscribe=function(c){var b=this.array,d=b.length,f=this.scheduler;if(f)return f.schedule(a.dispatch,0,{array:b,index:0,count:d,subscriber:c});for(f=0;f<d&&!c.closed;f++)c.next(b[f]);c.complete()};return a}(g),t=function(b){function a(){b.apply(this,arguments)}k(a,b);a.prototype.notifyNext=function(c,a,b,f,h){this.destination.next(a)};a.prototype.notifyError=function(c,a){this.destination.error(c)};a.prototype.notifyComplete=function(c){this.destination.complete()};return a}(m),C=function(b){var a=b.Symbol;if("function"===typeof a)return a.iterator||(a.iterator=a("iterator polyfill")),a.iterator;if((a=b.Set)&&"function"===typeof(new a)["@@iterator"])return"@@iterator";if(b=b.Map)for(var a=Object.getOwnPropertyNames(b.prototype),c=0;c<a.length;++c){var e=a[c];if("entries"!==e&&"size"!==e&&b.prototype[e]===b.prototype.entries)return e}return"@@iterator"}(p),Fa=function(b){function a(c,a,d){b.call(this);this.parent=c;this.outerValue=a;this.outerIndex=d;this.index=0}k(a,b);a.prototype._next=function(c){this.parent.notifyNext(this.outerValue,c,this.outerIndex,this.index++,this)};a.prototype._error=function(c){this.parent.notifyError(c,this);this.unsubscribe()};a.prototype._complete=function(){this.parent.notifyComplete(this);this.unsubscribe()};return a}(m),Qc={},na=function(){function b(a){this.project=a}b.prototype.call=function(a,c){return c.subscribe(new ff(a,this.project))};return b}(),ff=function(b){function a(c,a){b.call(this,c);this.project=a;this.active=0;this.values=[];this.observables=[]}k(a,b);a.prototype._next=function(c){this.values.push(Qc);this.observables.push(c)};a.prototype._complete=function(){var c=this.observables,a=c.length;if(0===a)this.destination.complete();else{this.toRespond=this.active=a;for(var b=0;b<a;b++){var f=c[b];this.add(r(this,f,f,b))}}};a.prototype.notifyComplete=function(c){0===--this.active&&this.destination.complete()};a.prototype.notifyNext=function(c,a,b,f,h){c=this.values;f=c[b];f=this.toRespond?f===Qc?--this.toRespond:this.toRespond:0;c[b]=a;0===f&&(this.project?this._tryProject(c):this.destination.next(c.slice()))};a.prototype._tryProject=function(c){var a;try{a=this.project.apply(this,c)}catch(d){this.destination.error(d);return}this.destination.next(a)};return a}(t);g.combineLatest=function(){for(var b=[],a=0;a<arguments.length;a++)b[a-0]=arguments[a];var c=a=null;A(b[b.length-1])&&(c=b.pop());"function"===typeof b[b.length-1]&&(a=b.pop());1===b.length&&E(b[0])&&(b=b[0]);return new G(b,c).lift(new na(a))};var La=G.of,Rc=function(b){function a(c,a){b.call(this);this.promise=c;this.scheduler=a}k(a,b);a.create=function(c,b){return new a(c,b)};a.prototype._subscribe=function(c){var a=this,b=this.promise,f=this.scheduler;if(null==f)this._isScalar?c.closed||(c.next(this.value),c.complete()):b.then(function(b){a.value=b;a._isScalar=!0;c.closed||(c.next(b),c.complete())},function(a){c.closed||c.error(a)}).then(null,function(c){p.setTimeout(function(){throw c})});else if(this._isScalar){if(!c.closed)return f.schedule(Ha,0,{value:this.value,subscriber:c})}else b.then(function(b){a.value=b;a._isScalar=!0;c.closed||c.add(f.schedule(Ha,0,{value:b,subscriber:c}))},function(a){c.closed||c.add(f.schedule(nd,0,{err:a,subscriber:c}))}).then(null,function(c){p.setTimeout(function(){throw c})})};return a}(g),jf=function(b){function a(c,a){b.call(this);this.scheduler=a;if(null==c)throw Error("iterator cannot be null.");if((a=c[C])||"string"!==typeof c)if(a||void 0===c.length){if(!a)throw new TypeError("object is not iterable");c=c[C]()}else c=new gf(c);else c=new hf(c);this.iterator=c}k(a,b);a.create=function(c,b){return new a(c,b)};a.dispatch=function(c){var a=c.index,b=c.iterator,f=c.subscriber;if(c.hasError)f.error(c.error);else{var h=b.next();h.done?f.complete():(f.next(h.value),c.index=a+1,f.closed?"function"===typeof b.return&&b.return():this.schedule(c))}};a.prototype._subscribe=function(c){var b=this.iterator,d=this.scheduler;if(d)return d.schedule(a.dispatch,0,{index:0,iterator:b,subscriber:c});do{d=b.next();if(d.done){c.complete();break}else c.next(d.value);if(c.closed){"function"===typeof b.return&&b.return();break}}while(1)};return a}(g),hf=function(){function b(a,c,b){void 0===c&&(c=0);void 0===b&&(b=a.length);this.str=a;this.idx=c;this.len=b}b.prototype[C]=function(){return this};b.prototype.next=function(){return this.idx<this.len?{done:!1,value:this.str.charAt(this.idx++)}:{done:!0,value:void 0}};return b}(),gf=function(){function b(a,c,b){void 0===c&&(c=0);if(void 0===b)if(b=+a.length,isNaN(b))b=0;else if(0!==b&&"number"===typeof b&&p.isFinite(b)){var e;e=+b;e=0===e?e:isNaN(e)?e:0>e?-1:1;b=e*Math.floor(Math.abs(b));b=0>=b?0:b>Sc?Sc:b}this.arr=a;this.idx=c;this.len=b}b.prototype[C]=function(){return this};b.prototype.next=function(){return this.idx<this.len?{done:!1,value:this.arr[this.idx++]}:{done:!0,value:void 0}};return b}(),Sc=Math.pow(2,53)-1,kf=function(b){function a(c,a){b.call(this);this.arrayLike=c;this.scheduler=a;a||1!==c.length||(this._isScalar=!0,this.value=c[0])}k(a,b);a.create=function(c,b){var e=c.length;return 0===e?new F:1===e?new ua(c[0],b):new a(c,b)};a.dispatch=function(c){var a=c.arrayLike,b=c.index,f=c.subscriber;f.closed||(b>=c.length?f.complete():(f.next(a[b]),c.index=b+1,this.schedule(c)))};a.prototype._subscribe=function(c){var b=this.arrayLike,d=this.scheduler,f=b.length;if(d)return d.schedule(a.dispatch,0,{arrayLike:b,index:0,length:f,subscriber:c});for(d=0;d<f&&!c.closed;d++)c.next(b[d]);c.complete()};return a}(g),y=function(){function b(a,c,b){this.kind=a;this.value=c;this.error=b;this.hasValue="N"===a}b.prototype.observe=function(a){switch(this.kind){case"N":return a.next&&a.next(this.value);case"E":return a.error&&a.error(this.error);case"C":return a.complete&&a.complete()}};b.prototype.do=function(a,c,b){switch(this.kind){case"N":return a&&a(this.value);case"E":return c&&c(this.error);case"C":return b&&b()}};b.prototype.accept=function(a,c,b){return a&&"function"===typeof a.next?this.observe(a):this.do(a,c,b)};b.prototype.toObservable=function(){switch(this.kind){case"N":return g.of(this.value);case"E":return g.throw(this.error);case"C":return g.empty()}throw Error("unexpected notification kind value")};b.createNext=function(a){return"undefined"!==typeof a?new b("N",a):b.undefinedValueNotification};b.createError=function(a){return new b("E",void 0,a)};b.createComplete=function(){return b.completeNotification};b.completeNotification=new b("C");b.undefinedValueNotification=new b("N",void 0);return b}(),od=function(){function b(a,c){void 0===c&&(c=0);this.scheduler=a;this.delay=c}b.prototype.call=function(a,c){return c.subscribe(new xa(a,this.scheduler,this.delay))};return b}(),xa=function(b){function a(c,a,d){void 0===d&&(d=0);b.call(this,c);this.scheduler=a;this.delay=d}k(a,b);a.dispatch=function(c){c.notification.observe(c.destination);this.unsubscribe()};a.prototype.scheduleMessage=function(c){this.add(this.scheduler.schedule(a.dispatch,this.delay,new lf(c,this.destination)))};a.prototype._next=function(c){this.scheduleMessage(y.createNext(c))};a.prototype._error=function(c){this.scheduleMessage(y.createError(c))};a.prototype._complete=function(){this.scheduleMessage(y.createComplete())};return a}(m),lf=function(){return function(b,a){this.notification=b;this.destination=a}}(),Tc=function(b){function a(c,a){b.call(this,null);this.ish=c;this.scheduler=a}k(a,b);a.create=function(c,b){if(null!=c){if("function"===typeof c[J])return c instanceof g&&!b?c:new a(c,b);if(E(c))return new G(c,b);if(Ea(c))return new Rc(c,b);if("function"===typeof c[C]||"string"===typeof c)return new jf(c,b);if(c&&"number"===typeof c.length)return new kf(c,b)}throw new TypeError((null!==c&&typeof c||c)+" is not observable")};a.prototype._subscribe=function(c){var a=this.ish,b=this.scheduler;return null==b?a[J]().subscribe(c):a[J]().subscribe(new xa(c,b,0))};return a}(g),Ka=Tc.create,pd=function(){function b(a,c,b){void 0===b&&(b=Number.POSITIVE_INFINITY);this.project=a;this.resultSelector=c;this.concurrent=b}b.prototype.call=function(a,c){return c.subscribe(new mf(a,this.project,this.resultSelector,this.concurrent))};return b}(),mf=function(b){function a(c,a,d,f){void 0===f&&(f=Number.POSITIVE_INFINITY);b.call(this,c);this.project=a;this.resultSelector=d;this.concurrent=f;this.hasCompleted=!1;this.buffer=[];this.index=this.active=0}k(a,b);a.prototype._next=function(c){this.active<this.concurrent?this._tryNext(c):this.buffer.push(c)};a.prototype._tryNext=function(c){var a,b=this.index++;try{a=this.project(c,b)}catch(f){this.destination.error(f);return}this.active++;this._innerSub(a,c,b)};a.prototype._innerSub=function(c,a,b){this.add(r(this,c,a,b))};a.prototype._complete=function(){this.hasCompleted=!0;0===this.active&&0===this.buffer.length&&this.destination.complete()};a.prototype.notifyNext=function(c,a,b,f,h){this.resultSelector?this._notifyResultSelector(c,a,b,f):this.destination.next(a)};a.prototype._notifyResultSelector=function(c,a,b,f){var e;try{e=this.resultSelector(c,a,b,f)}catch(z){this.destination.error(z);return}this.destination.next(e)};a.prototype.notifyComplete=function(c){var a=this.buffer;this.remove(c);this.active--;0<a.length?this._next(a.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()};return a}(t);g.concat=U;var of=function(b){function a(c){b.call(this);this.observableFactory=c}k(a,b);a.create=function(c){return new a(c)};a.prototype._subscribe=function(c){return new nf(c,this.observableFactory)};return a}(g),nf=function(b){function a(c,a){b.call(this,c);this.factory=a;this.tryDefer()}k(a,b);a.prototype.tryDefer=function(){try{this._callFactory()}catch(c){this._error(c)}};a.prototype._callFactory=function(){var c=this.factory();c&&this.add(r(this,c))};return a}(t);g.defer=of.create;g.empty=F.create;var qf=function(b){function a(c,a){b.call(this);this.sources=c;this.resultSelector=a}k(a,b);a.create=function(){for(var c=[],b=0;b<arguments.length;b++)c[b-0]=arguments[b];if(null===c||0===arguments.length)return new F;b=null;"function"===typeof c[c.length-1]&&(b=c.pop());1===c.length&&E(c[0])&&(c=c[0]);return 0===c.length?new F:new a(c,b)};a.prototype._subscribe=function(c){return new pf(c,this.sources,this.resultSelector)};return a}(g),pf=function(b){function a(c,a,d){b.call(this,c);this.sources=a;this.resultSelector=d;this.haveValues=this.completed=0;this.total=c=a.length;this.values=Array(c);for(d=0;d<c;d++){var e=r(this,a[d],null,d);e&&(e.outerIndex=d,this.add(e))}}k(a,b);a.prototype.notifyNext=function(c,a,b,f,h){this.values[b]=a;h._hasValue||(h._hasValue=!0,this.haveValues++)};a.prototype.notifyComplete=function(c){var a=this.destination,b=this.haveValues,f=this.resultSelector,h=this.values,g=h.length;c._hasValue?(this.completed++,this.completed===g&&(b===g&&(c=f?f.apply(this,h):h,a.next(c)),a.complete())):a.complete()};return a}(t);g.forkJoin=qf.create;g.from=Ka;var Uc=Object.prototype.toString,rf=function(b){function a(c,a,d,f){b.call(this);this.sourceObj=c;this.eventName=a;this.selector=d;this.options=f}k(a,b);a.create=function(c,b,d,f){x(d)&&(f=d,d=void 0);return new a(c,b,f,d)};a.setupSubscription=function(c,b,d,f,h){var e;if(c&&"[object NodeList]"===Uc.call(c)||c&&"[object HTMLCollection]"===Uc.call(c))for(var g=0,k=c.length;g<k;g++)a.setupSubscription(c[g],b,d,f,h);else if(c&&"function"===typeof c.addEventListener&&"function"===typeof c.removeEventListener)c.addEventListener(b,d,h),e=function(){return c.removeEventListener(b,d,h)};else if(c&&"function"===typeof c.on&&"function"===typeof c.off)c.on(b,d),e=function(){return c.off(b,d)};else if(c&&"function"===typeof c.addListener&&"function"===typeof c.removeListener)c.addListener(b,d),e=function(){return c.removeListener(b,d)};else throw new TypeError("Invalid event target");f.add(new v(e))};a.prototype._subscribe=function(c){var b=this.selector;a.setupSubscription(this.sourceObj,this.eventName,b?function(){for(var a=[],e=0;e<arguments.length;e++)a[e-0]=arguments[e];a=q(b).apply(void 0,a);a===n?c.error(n.e):c.next(a)}:function(a){return c.next(a)},c,this.options)};return a}(g).create;g.fromEvent=rf;var sf=function(b){function a(c,a,d){b.call(this);this.addHandler=c;this.removeHandler=a;this.selector=d}k(a,b);a.create=function(c,b,d){return new a(c,b,d)};a.prototype._subscribe=function(c){var a=this,b=this.removeHandler,f=this.selector?function(){for(var b=[],e=0;e<arguments.length;e++)b[e-0]=arguments[e];a._callSelector(c,b)}:function(a){c.next(a)},h=this._callAddHandler(f,c);x(b)&&c.add(new v(function(){b(f,h)}))};a.prototype._callSelector=function(c,a){try{var b=this.selector.apply(this,a);c.next(b)}catch(f){c.error(f)}};a.prototype._callAddHandler=function(c,a){try{return this.addHandler(c)||null}catch(d){a.error(d)}};return a}(g).create;g.fromEventPattern=sf;g.fromPromise=Rc.create;var Vc=function(b){return b},tf=function(b){function a(c,a,d,f,h){b.call(this);this.initialState=c;this.condition=a;this.iterate=d;this.resultSelector=f;this.scheduler=h}k(a,b);a.create=function(c,b,d,f,h){return 1==arguments.length?new a(c.initialState,c.condition,c.iterate,c.resultSelector||Vc,c.scheduler):void 0===f||A(f)?new a(c,b,d,Vc,f):new a(c,b,d,f,h)};a.prototype._subscribe=function(c){var b=this.initialState;if(this.scheduler)return this.scheduler.schedule(a.dispatch,0,{subscriber:c,iterate:this.iterate,condition:this.condition,resultSelector:this.resultSelector,state:b});var d=this.condition,f=this.resultSelector,h=this.iterate;do{if(d){var g=void 0;try{g=d(b)}catch(D){c.error(D);break}if(!g){c.complete();break}}g=void 0;try{g=f(b)}catch(D){c.error(D);break}c.next(g);if(c.closed)break;try{b=h(b)}catch(D){c.error(D);break}}while(1)};a.dispatch=function(c){var a=c.subscriber,b=c.condition;if(!a.closed){if(c.needIterate)try{c.state=c.iterate(c.state)}catch(z){a.error(z);return}else c.needIterate=!0;if(b){var f=void 0;try{f=b(c.state)}catch(z){a.error(z);return}if(!f){a.complete();return}if(a.closed)return}var h;try{h=c.resultSelector(c.state)}catch(z){a.error(z);return}if(!a.closed&&(a.next(h),!a.closed))return this.schedule(c)}};return a}(g).create;g.generate=tf;var vf=function(b){function a(c,a,d){b.call(this);this.condition=c;this.thenSource=a;this.elseSource=d}k(a,b);a.create=function(c,b,d){return new a(c,b,d)};a.prototype._subscribe=function(c){return new uf(c,this.condition,this.thenSource,this.elseSource)};return a}(g),uf=function(b){function a(c,a,d,f){b.call(this,c);this.condition=a;this.thenSource=d;this.elseSource=f;this.tryIf()}k(a,b);a.prototype.tryIf=function(){var c=this.condition,a=this.thenSource,b=this.elseSource,f;try{(c=(f=c())?a:b)?this.add(r(this,c)):this._complete()}catch(h){this._error(h)}};return a}(t);g.if=vf.create;var X=function(b){function a(c,a){b.call(this,c,a);this.scheduler=c;this.work=a;this.pending=!1}k(a,b);a.prototype.schedule=function(c,a){void 0===a&&(a=0);if(this.closed)return this;this.state=c;this.pending=!0;c=this.id;var b=this.scheduler;null!=c&&(this.id=this.recycleAsyncId(b,c,a));this.delay=a;this.id=this.id||this.requestAsyncId(b,this.id,a);return this};a.prototype.requestAsyncId=function(c,a,b){void 0===b&&(b=0);return p.setInterval(c.flush.bind(c,this),b)};a.prototype.recycleAsyncId=function(c,a,b){void 0===b&&(b=0);return null!==b&&this.delay===b&&!1===this.pending?a:(p.clearInterval(a),void 0)};a.prototype.execute=function(c,a){if(this.closed)return Error("executing a cancelled action");this.pending=!1;if(c=this._execute(c,a))return c;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))};a.prototype._execute=function(c,a){a=!1;var b=void 0;try{this.work(c)}catch(f){a=!0,b=!!f&&f||Error(f)}if(a)return this.unsubscribe(),b};a.prototype._unsubscribe=function(){var c=this.id,a=this.scheduler,b=a.actions,f=b.indexOf(this);this.state=this.work=null;this.pending=!1;this.scheduler=null;-1!==f&&b.splice(f,1);null!=c&&(this.id=this.recycleAsyncId(a,c,null));this.delay=null};return a}(function(b){function a(c,a){b.call(this)}k(a,b);a.prototype.schedule=function(c,a){return this};return a}(v)),Y=function(b){function a(){b.apply(this,arguments);this.actions=[];this.active=!1;this.scheduled=void 0}k(a,b);a.prototype.flush=function(c){var a=this.actions;if(this.active)a.push(c);else{var b;this.active=!0;do{if(b=c.execute(c.state,c.delay))break}while(c=a.shift());this.active=!1;if(b){for(;c=a.shift();)c.unsubscribe();throw b}}};return a}(function(){function b(a,c){void 0===c&&(c=b.now);this.SchedulerAction=a;this.now=c}b.prototype.schedule=function(a,c,b){void 0===c&&(c=0);return new this.SchedulerAction(this,a).schedule(b,c)};b.now=Date.now?Date.now:function(){return+new Date};return b}()),u=new Y(X),wf=function(b){function a(c,a){void 0===c&&(c=0);void 0===a&&(a=u);b.call(this);this.period=c;this.scheduler=a;if(!K(c)||0>c)this.period=0;a&&"function"===typeof a.schedule||(this.scheduler=u)}k(a,b);a.create=function(c,b){void 0===c&&(c=0);void 0===b&&(b=u);return new a(c,b)};a.dispatch=function(c){var a=c.subscriber,b=c.period;a.next(c.index);a.closed||(c.index+=1,this.schedule(c,b))};a.prototype._subscribe=function(c){var b=this.period;c.add(this.scheduler.schedule(a.dispatch,b,{index:0,subscriber:c,period:b}))};return a}(g).create;g.interval=wf;g.merge=Ma;var qd=function(){function b(){}b.prototype.call=function(a,c){return c.subscribe(new xf(a))};return b}(),xf=function(b){function a(c){b.call(this,c);this.hasFirst=!1;this.observables=[];this.subscriptions=[]}k(a,b);a.prototype._next=function(c){this.observables.push(c)};a.prototype._complete=function(){var c=this.observables,a=c.length;if(0===a)this.destination.complete();else{for(var b=0;b<a&&!this.hasFirst;b++){var f=c[b],f=r(this,f,f,b);this.subscriptions&&this.subscriptions.push(f);this.add(f)}this.observables=null}};a.prototype.notifyNext=function(c,a,b,f,h){if(!this.hasFirst){this.hasFirst=!0;for(c=0;c<this.subscriptions.length;c++)c!==b&&(f=this.subscriptions[c],f.unsubscribe(),this.remove(f));this.subscriptions=null}this.destination.next(a)};return a}(t);g.race=Na;var yf=function(b){function a(){b.call(this)}k(a,b);a.create=function(){return new a};a.prototype._subscribe=function(c){};return a}(g).create;g.never=yf;g.of=La;var Pa=function(){function b(a){this.nextSources=a}b.prototype.call=function(a,c){return c.subscribe(new zf(a,this.nextSources))};return b}(),zf=function(b){function a(c,a){b.call(this,c);this.destination=c;this.nextSources=a}k(a,b);a.prototype.notifyError=function(c,a){this.subscribeToNextSource()};a.prototype.notifyComplete=function(c){this.subscribeToNextSource()};a.prototype._error=function(c){this.subscribeToNextSource()};a.prototype._complete=function(){this.subscribeToNextSource()};a.prototype.subscribeToNextSource=function(){var c=this.nextSources.shift();c?this.add(r(this,c)):this.destination.complete()};return a}(t);g.onErrorResumeNext=function(){for(var b=[],a=0;a<arguments.length;a++)b[a-0]=arguments[a];1===b.length&&E(b[0])&&(b=b[0]);a=b.shift();return new Tc(a,null).lift(new Pa(b))};var Af=function(b){function a(c,a){b.call(this);this.obj=c;this.scheduler=a;this.keys=Object.keys(c)}k(a,b);a.create=function(c,b){return new a(c,b)};a.prototype._subscribe=function(c){var a=this.keys,b=this.scheduler,f=a.length;if(b)return b.schedule(rd,0,{obj:this.obj,keys:a,length:f,index:0,subscriber:c});for(b=0;b<f;b++){var h=a[b];c.next([h,this.obj[h]])}c.complete()};return a}(g).create;g.pairs=Af;var Bf=function(b){function a(c,a,d){b.call(this);this.start=c;this._count=a;this.scheduler=d}k(a,b);a.create=function(c,b,d){void 0===c&&(c=0);void 0===b&&(b=0);return new a(c,b,d)};a.dispatch=function(c){var a=c.start,b=c.index,f=c.subscriber;b>=c.count?f.complete():(f.next(a),f.closed||(c.index=b+1,c.start=a+1,this.schedule(c)))};a.prototype._subscribe=function(c){var b=0,d=this.start,f=this._count,h=this.scheduler;if(h)return h.schedule(a.dispatch,0,{index:b,count:f,start:d,subscriber:c});do{if(b++>=f){c.complete();break}c.next(d++);if(c.closed)break}while(1)};return a}(g).create;g.range=Bf;var Df=function(b){function a(c,a){b.call(this);this.resourceFactory=c;this.observableFactory=a}k(a,b);a.create=function(c,b){return new a(c,b)};a.prototype._subscribe=function(c){var a=this.resourceFactory,b=this.observableFactory,f;try{return f=a(),new Cf(c,f,b)}catch(h){c.error(h)}};return a}(g),Cf=function(b){function a(c,a,d){b.call(this,c);this.resource=a;this.observableFactory=d;c.add(a);this.tryUse()}k(a,b);a.prototype.tryUse=function(){try{var c=this.observableFactory.call(this,this.resource);c&&this.add(r(this,c))}catch(e){this._error(e)}};return a}(t);g.using=Df.create;var Ef=function(b){function a(c,a){b.call(this);this.error=c;this.scheduler=a}k(a,b);a.create=function(c,b){return new a(c,b)};a.dispatch=function(c){c.subscriber.error(c.error)};a.prototype._subscribe=function(c){var b=this.error,d=this.scheduler;c.syncErrorThrowable=!0;if(d)return d.schedule(a.dispatch,0,{error:b,subscriber:c});c.error(b)};return a}(g).create;g.throw=Ef;var Eb=function(b){function a(c,a,d){void 0===c&&(c=0);b.call(this);this.period=-1;this.dueTime=0;K(a)?this.period=1>Number(a)&&1||Number(a):A(a)&&(d=a);A(d)||(d=u);this.scheduler=d;this.dueTime=ca(c)?+c-this.scheduler.now():c}k(a,b);a.create=function(c,b,d){void 0===c&&(c=0);return new a(c,b,d)};a.dispatch=function(c){var a=c.index,b=c.period,f=c.subscriber;f.next(a);if(!f.closed){if(-1===b)return f.complete();c.index=a+1;this.schedule(c,b)}};a.prototype._subscribe=function(c){return this.scheduler.schedule(a.dispatch,this.dueTime,{index:0,period:this.period,subscriber:c})};return a}(g).create;g.timer=Eb;var Sa=function(){function b(a){this.project=a}b.prototype.call=function(a,c){return c.subscribe(new Ff(a,this.project))};return b}(),Ff=function(b){function a(c,a,d){void 0===d&&(d=Object.create(null));b.call(this,c);this.iterators=[];this.active=0;this.project="function"===typeof a?a:null;this.values=d}k(a,b);a.prototype._next=function(c){var a=this.iterators;E(c)?a.push(new Gf(c)):"function"===typeof c[C]?a.push(new Hf(c[C]())):a.push(new If(this.destination,this,c))};a.prototype._complete=function(){var c=this.iterators,a=c.length;if(0===a)this.destination.complete();else{this.active=a;for(var b=0;b<a;b++){var f=c[b];f.stillUnsubscribed?this.add(f.subscribe(f,b)):this.active--}}};a.prototype.notifyInactive=function(){this.active--;0===this.active&&this.destination.complete()};a.prototype.checkIterators=function(){for(var c=this.iterators,a=c.length,b=this.destination,f=0;f<a;f++){var h=c[f];if("function"===typeof h.hasValue&&!h.hasValue())return}for(var g=!1,k=[],f=0;f<a;f++){var h=c[f],l=h.next();h.hasCompleted()&&(g=!0);if(l.done){b.complete();return}k.push(l.value)}this.project?this._tryProject(k):b.next(k);g&&b.complete()};a.prototype._tryProject=function(c){var a;try{a=this.project.apply(this,c)}catch(d){this.destination.error(d);return}this.destination.next(a)};return a}(m),Hf=function(){function b(a){this.iterator=a;this.nextResult=a.next()}b.prototype.hasValue=function(){return!0};b.prototype.next=function(){var a=this.nextResult;this.nextResult=this.iterator.next();return a};b.prototype.hasCompleted=function(){var a=this.nextResult;return a&&a.done};return b}(),Gf=function(){function b(a){this.array=a;this.length=this.index=0;this.length=a.length}b.prototype[C]=function(){return this};b.prototype.next=function(a){a=this.index++;var c=this.array;return a<this.length?{value:c[a],done:!1}:{value:null,done:!0}};b.prototype.hasValue=function(){return this.array.length>this.index};b.prototype.hasCompleted=function(){return this.array.length===this.index};return b}(),If=function(b){function a(c,a,d){b.call(this,c);this.parent=a;this.observable=d;this.stillUnsubscribed=!0;this.buffer=[];this.isComplete=!1}k(a,b);a.prototype[C]=function(){return this};a.prototype.next=function(){var c=this.buffer;return 0===c.length&&this.isComplete?{value:null,done:!0}:{value:c.shift(),done:!1}};a.prototype.hasValue=function(){return 0<this.buffer.length};a.prototype.hasCompleted=function(){return 0===this.buffer.length&&this.isComplete};a.prototype.notifyComplete=function(){0<this.buffer.length?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()};a.prototype.notifyNext=function(c,a,b,f,h){this.buffer.push(a);this.parent.checkIterators()};a.prototype.subscribe=function(c,a){return r(this,this.observable,this,a)};return a}(t);g.zip=Ra;var sd=function(){function b(a,c){this.project=a;this.thisArg=c}b.prototype.call=function(a,c){return c.subscribe(new Jf(a,this.project,this.thisArg))};return b}(),Jf=function(b){function a(c,a,d){b.call(this,c);this.project=a;this.count=0;this.thisArg=d||this}k(a,b);a.prototype._next=function(c){var a;try{a=this.project.call(this.thisArg,c,this.count++)}catch(d){this.destination.error(d);return}this.destination.next(a)};return a}(m),zd=V(function(b,a){return b.response}),L=function(b){function a(c){b.call(this);var a={async:!0,createXHR:function(){var c;if(this.crossDomain)if(p.XMLHttpRequest)c=new p.XMLHttpRequest;else if(p.XDomainRequest)c=new p.XDomainRequest;else throw Error("CORS is not supported by your browser");else if(p.XMLHttpRequest)c=new p.XMLHttpRequest;else{var a=void 0;try{for(var b=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],e=0;3>e;e++)try{a=b[e];new p.ActiveXObject(a);break}catch(N){}c=new p.ActiveXObject(a)}catch(N){throw Error("XMLHttpRequest is not supported by your browser")}}return c},crossDomain:!1,withCredentials:!1,headers:{},method:"GET",responseType:"json",timeout:0};if("string"===typeof c)a.url=c;else for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d]);this.request=a}k(a,b);a.prototype._subscribe=function(c){return new Kf(c,this.request)};a.create=function(){var c=function(c){return new a(c)};c.get=td;c.post=ud;c.delete=vd;c.put=wd;c.patch=xd;c.getJSON=yd;return c}();return a}(g),Kf=function(b){function a(c,a){b.call(this,c);this.request=a;this.done=!1;c=a.headers=a.headers||{};a.crossDomain||c["X-Requested-With"]||(c["X-Requested-With"]="XMLHttpRequest");"Content-Type"in c||p.FormData&&a.body instanceof p.FormData||"undefined"===typeof a.body||(c["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8");a.body=this.serializeBody(a.body,a.headers["Content-Type"]);this.send()}k(a,b);a.prototype.next=function(c){this.done=!0;var a=this.destination;c=new Wc(c,this.xhr,this.request);a.next(c)};a.prototype.send=function(){var a=this.request,b=this.request,d=b.user,f=b.method,h=b.url,g=b.async,k=b.password,l=b.headers,b=b.body,m=q(a.createXHR).call(a);if(m===n)this.error(n.e);else{this.xhr=m;this.setupEvents(m,a);d=d?q(m.open).call(m,f,h,g,d,k):q(m.open).call(m,f,h,g);if(d===n)return this.error(n.e),null;g&&(m.timeout=a.timeout,m.responseType=a.responseType);"withCredentials"in m&&(m.withCredentials=!!a.withCredentials);this.setHeaders(m,l);d=b?q(m.send).call(m,b):q(m.send).call(m);if(d===n)return this.error(n.e),null}return m};a.prototype.serializeBody=function(a,b){if(!a||"string"===typeof a||p.FormData&&a instanceof p.FormData)return a;if(b){var c=b.indexOf(";");-1!==c&&(b=b.substring(0,c))}switch(b){case"application/x-www-form-urlencoded":return Object.keys(a).map(function(c){return encodeURI(c)+"="+encodeURI(a[c])}).join("&");case"application/json":return JSON.stringify(a);default:return a}};a.prototype.setHeaders=function(a,b){for(var c in b)b.hasOwnProperty(c)&&a.setRequestHeader(c,b[c])};a.prototype.setupEvents=function(a,b){function c(a){var b=c.subscriber,e=c.progressSubscriber,d=c.request;e&&e.error(a);b.error(new Xc(this,d))}function e(a){var c=e.subscriber,b=e.progressSubscriber,d=e.request;if(4===this.readyState){var f=1223===this.status?204:this.status,h="text"===this.responseType?this.response||this.responseText:this.response;0===f&&(f=h?200:0);200<=f&&300>f?(b&&b.complete(),c.next(a),c.complete()):(b&&b.error(a),c.error(new ia("ajax error "+f,this,d)))}}var h=b.progressSubscriber;a.ontimeout=c;c.request=b;c.subscriber=this;c.progressSubscriber=h;if(a.upload&&"withCredentials"in a){if(h){var g;g=function(a){g.progressSubscriber.next(a)};p.XDomainRequest?a.onprogress=g:a.upload.onprogress=g;g.progressSubscriber=h}var k;k=function(a){var c=k.progressSubscriber,b=k.subscriber,e=k.request;c&&c.error(a);b.error(new ia("ajax error",this,e))};a.onerror=k;k.request=b;k.subscriber=this;k.progressSubscriber=h}a.onreadystatechange=e;e.subscriber=this;e.progressSubscriber=h;e.request=b};a.prototype.unsubscribe=function(){var a=this.xhr;!this.done&&a&&4!==a.readyState&&"function"===typeof a.abort&&a.abort();b.prototype.unsubscribe.call(this)};return a}(m),Wc=function(){return function(b,a,c){this.originalEvent=b;this.xhr=a;this.request=c;this.status=a.status;this.responseType=a.responseType||c.responseType;this.response=Ta(this.responseType,a)}}(),ia=function(b){function a(a,e,d){b.call(this,a);this.message=a;this.xhr=e;this.request=d;this.status=e.status;this.responseType=e.responseType||d.responseType;this.response=Ta(this.responseType,e)}k(a,b);return a}(Error),Xc=function(b){function a(a,e){b.call(this,"ajax timeout",a,e)}k(a,b);return a}(ia);g.ajax=L.create;var Lf=function(b){function a(a,e){b.call(this,a,e);this.scheduler=a;this.work=e}k(a,b);a.prototype.schedule=function(a,e){void 0===e&&(e=0);if(0<e)return b.prototype.schedule.call(this,a,e);this.delay=e;this.state=a;this.scheduler.flush(this);return this};a.prototype.execute=function(a,e){return 0<e||this.closed?b.prototype.execute.call(this,a,e):this._execute(a,e)};a.prototype.requestAsyncId=function(a,e,d){void 0===d&&(d=0);return null!==d&&0<d||null===d&&0<this.delay?b.prototype.requestAsyncId.call(this,a,e,d):a.flush(this)};return a}(X),Yc=new(function(b){function a(){b.apply(this,arguments)}k(a,b);return a}(Y))(Lf),M=function(b){function a(a,e,d){void 0===a&&(a=Number.POSITIVE_INFINITY);void 0===e&&(e=Number.POSITIVE_INFINITY);b.call(this);this.scheduler=d;this._events=[];this._bufferSize=1>a?1:a;this._windowTime=1>e?1:e}k(a,b);a.prototype.next=function(a){var c=this._getNow();this._events.push(new Mf(c,a));this._trimBufferThenGetEvents();b.prototype.next.call(this,a)};a.prototype._subscribe=function(a){var c=this._trimBufferThenGetEvents(),b=this.scheduler,f;if(this.closed)throw new I;this.hasError?f=v.EMPTY:this.isStopped?f=v.EMPTY:(this.observers.push(a),f=new Oc(this,a));b&&a.add(a=new xa(a,b));for(var b=c.length,h=0;h<b&&!a.closed;h++)a.next(c[h].value);this.hasError?a.error(this.thrownError):this.isStopped&&a.complete();return f};a.prototype._getNow=function(){return(this.scheduler||Yc).now()};a.prototype._trimBufferThenGetEvents=function(){for(var a=this._getNow(),b=this._bufferSize,d=this._windowTime,f=this._events,h=f.length,g=0;g<h&&!(a-f[g].time<d);)g++;h>b&&(g=Math.max(g,h-b));0<g&&f.splice(0,g);return f};return a}(w),Mf=function(){return function(b,a){this.time=b;this.value=a}}(),Nf=p.Object.assign||Ad,Of=function(b){function a(a,e){if(a instanceof g)b.call(this,e,a);else{b.call(this);this.WebSocketCtor=p.WebSocket;this._output=new w;"string"===typeof a?this.url=a:Nf(this,a);if(!this.WebSocketCtor)throw Error("no WebSocket constructor can be found");this.destination=new M}}k(a,b);a.prototype.resultSelector=function(a){return JSON.parse(a.data)};a.create=function(c){return new a(c)};a.prototype.lift=function(c){var b=new a(this,this.destination);b.operator=c;return b};a.prototype._resetState=function(){this.socket=null;this.source||(this.destination=new M);this._output=new w};a.prototype.multiplex=function(a,b,d){var c=this;return new g(function(e){var f=q(a)();f===n?e.error(n.e):c.next(f);var h=c.subscribe(function(a){var c=q(d)(a);c===n?e.error(n.e):c&&e.next(a)},function(a){return e.error(a)},function(){return e.complete()});return function(){var a=q(b)();a===n?e.error(n.e):c.next(a);h.unsubscribe()}})};a.prototype._connectSocket=function(){var a=this,b=this.WebSocketCtor,d=this._output,f=null;try{this.socket=f=this.protocol?new b(this.url,this.protocol):new b(this.url),this.binaryType&&(this.socket.binaryType=this.binaryType)}catch(z){d.error(z);return}var h=new v(function(){a.socket=null;f&&1===f.readyState&&f.close()});f.onopen=function(c){var b=a.openObserver;b&&b.next(c);c=a.destination;a.destination=m.create(function(a){return 1===f.readyState&&f.send(a)},function(c){var b=a.closingObserver;b&&b.next(void 0);c&&c.code?f.close(c.code,c.reason):d.error(new TypeError("WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }"));a._resetState()},function(){var c=a.closingObserver;c&&c.next(void 0);f.close();a._resetState()});c&&c instanceof M&&h.add(c.subscribe(a.destination))};f.onerror=function(c){a._resetState();d.error(c)};f.onclose=function(c){a._resetState();var b=a.closeObserver;b&&b.next(c);c.wasClean?d.complete():d.error(c)};f.onmessage=function(c){c=q(a.resultSelector)(c);c===n?d.error(n.e):d.next(c)}};a.prototype._subscribe=function(a){var c=this,b=this.source;if(b)return b.subscribe(a);this.socket||this._connectSocket();b=new v;b.add(this._output.subscribe(a));b.add(function(){var a=c.socket;0===c._output.observers.length&&(a&&1===a.readyState&&a.close(),c._resetState())});return b};a.prototype.unsubscribe=function(){var a=this.source,e=this.socket;e&&1===e.readyState&&(e.close(),this._resetState());b.prototype.unsubscribe.call(this);a||(this.destination=new M)};return a}(ha).create;g.webSocket=Of;var Bd=function(){function b(a){this.closingNotifier=a}b.prototype.call=function(a,c){return c.subscribe(new Pf(a,this.closingNotifier))};return b}(),Pf=function(b){function a(a,e){b.call(this,a);this.buffer=[];this.add(r(this,e))}k(a,b);a.prototype._next=function(a){this.buffer.push(a)};a.prototype.notifyNext=function(a,b,d,f,h){a=this.buffer;this.buffer=[];this.destination.next(a)};return a}(t);g.prototype.buffer=function(b){return Ua(b)(this)};var Cd=function(){function b(a,c){this.bufferSize=a;this.subscriberClass=(this.startBufferEvery=c)&&a!==c?Qf:Rf}b.prototype.call=function(a,c){return c.subscribe(new this.subscriberClass(a,this.bufferSize,this.startBufferEvery))};return b}(),Rf=function(b){function a(a,e){b.call(this,a);this.bufferSize=e;this.buffer=[]}k(a,b);a.prototype._next=function(a){var c=this.buffer;c.push(a);c.length==this.bufferSize&&(this.destination.next(c),this.buffer=[])};a.prototype._complete=function(){var a=this.buffer;0<a.length&&this.destination.next(a);b.prototype._complete.call(this)};return a}(m),Qf=function(b){function a(a,e,d){b.call(this,a);this.bufferSize=e;this.startBufferEvery=d;this.buffers=[];this.count=0}k(a,b);a.prototype._next=function(a){var c=this.bufferSize,b=this.startBufferEvery,f=this.buffers,h=this.count;this.count++;0===h%b&&f.push([]);for(b=f.length;b--;)h=f[b],h.push(a),h.length===c&&(f.splice(b,1),this.destination.next(h))};a.prototype._complete=function(){for(var a=this.buffers,e=this.destination;0<a.length;){var d=a.shift();0<d.length&&e.next(d)}b.prototype._complete.call(this)};return a}(m);g.prototype.bufferCount=function(b,a){void 0===a&&(a=null);return Va(b,a)(this)};var Dd=function(){function b(a,c,b,d){this.bufferTimeSpan=a;this.bufferCreationInterval=c;this.maxBufferSize=b;this.scheduler=d}b.prototype.call=function(a,c){return c.subscribe(new Sf(a,this.bufferTimeSpan,this.bufferCreationInterval,this.maxBufferSize,this.scheduler))};return b}(),Tf=function(){return function(){this.buffer=[]}}(),Sf=function(b){function a(a,e,d,f,h){b.call(this,a);this.bufferTimeSpan=e;this.bufferCreationInterval=d;this.maxBufferSize=f;this.scheduler=h;this.contexts=[];a=this.openContext();(this.timespanOnly=null==d||0>d)?this.add(a.closeAction=h.schedule(Xa,e,{subscriber:this,context:a,bufferTimeSpan:e})):(f={bufferTimeSpan:e,bufferCreationInterval:d,subscriber:this,scheduler:h},this.add(a.closeAction=h.schedule(Ya,e,{subscriber:this,context:a})),this.add(h.schedule(Ed,d,f)))}k(a,b);a.prototype._next=function(a){for(var c=this.contexts,b=c.length,f,h=0;h<b;h++){var g=c[h],k=g.buffer;k.push(a);k.length==this.maxBufferSize&&(f=g)}if(f)this.onBufferFull(f)};a.prototype._error=function(a){this.contexts.length=0;b.prototype._error.call(this,a)};a.prototype._complete=function(){for(var a=this.contexts,e=this.destination;0<a.length;){var d=a.shift();e.next(d.buffer)}b.prototype._complete.call(this)};a.prototype._unsubscribe=function(){this.contexts=null};a.prototype.onBufferFull=function(a){this.closeContext(a);a=a.closeAction;a.unsubscribe();this.remove(a);if(!this.closed&&this.timespanOnly){a=this.openContext();var c=this.bufferTimeSpan;this.add(a.closeAction=this.scheduler.schedule(Xa,c,{subscriber:this,context:a,bufferTimeSpan:c}))}};a.prototype.openContext=function(){var a=new Tf;this.contexts.push(a);return a};a.prototype.closeContext=function(a){this.destination.next(a.buffer);var c=this.contexts;0<=(c?c.indexOf(a):-1)&&c.splice(c.indexOf(a),1)};return a}(m);g.prototype.bufferTime=function(b){var a=arguments.length,c=u;A(arguments[arguments.length-1])&&(c=arguments[arguments.length-1],a--);var e=null;2<=a&&(e=arguments[1]);var d=Number.POSITIVE_INFINITY;3<=a&&(d=arguments[2]);return Wa(b,e,d,c)(this)};var Fd=function(){function b(a,c){this.openings=a;this.closingSelector=c}b.prototype.call=function(a,c){return c.subscribe(new Uf(a,this.openings,this.closingSelector))};return b}(),Uf=function(b){function a(a,e,d){b.call(this,a);this.openings=e;this.closingSelector=d;this.contexts=[];this.add(r(this,e))}k(a,b);a.prototype._next=function(a){for(var c=this.contexts,b=c.length,f=0;f<b;f++)c[f].buffer.push(a)};a.prototype._error=function(a){for(var c=this.contexts;0<c.length;){var d=c.shift();d.subscription.unsubscribe();d.buffer=null;d.subscription=null}this.contexts=null;b.prototype._error.call(this,a)};a.prototype._complete=function(){for(var a=this.contexts;0<a.length;){var e=a.shift();this.destination.next(e.buffer);e.subscription.unsubscribe();e.buffer=null;e.subscription=null}this.contexts=null;b.prototype._complete.call(this)};a.prototype.notifyNext=function(a,b,d,f,h){a?this.closeBuffer(a):this.openBuffer(b)};a.prototype.notifyComplete=function(a){this.closeBuffer(a.context)};a.prototype.openBuffer=function(a){try{var c=this.closingSelector.call(this,a);c&&this.trySubscribe(c)}catch(d){this._error(d)}};a.prototype.closeBuffer=function(a){var c=this.contexts;if(c&&a){var b=a.subscription;this.destination.next(a.buffer);c.splice(c.indexOf(a),1);this.remove(b);b.unsubscribe()}};a.prototype.trySubscribe=function(a){var c=this.contexts,b=new v,f={buffer:[],subscription:b};c.push(f);a=r(this,a,f);!a||a.closed?this.closeBuffer(f):(a.context=f,this.add(a),b.add(a))};return a}(t);g.prototype.bufferToggle=function(b,a){return Za(b,a)(this)};var Gd=function(){function b(a){this.closingSelector=a}b.prototype.call=function(a,c){return c.subscribe(new Vf(a,this.closingSelector))};return b}(),Vf=function(b){function a(a,e){b.call(this,a);this.closingSelector=e;this.subscribing=!1;this.openBuffer()}k(a,b);a.prototype._next=function(a){this.buffer.push(a)};a.prototype._complete=function(){var a=this.buffer;a&&this.destination.next(a);b.prototype._complete.call(this)};a.prototype._unsubscribe=function(){this.buffer=null;this.subscribing=!1};a.prototype.notifyNext=function(a,b,d,f,h){this.openBuffer()};a.prototype.notifyComplete=function(){this.subscribing?this.complete():this.openBuffer()};a.prototype.openBuffer=function(){var a=this.closingSubscription;a&&(this.remove(a),a.unsubscribe());(a=this.buffer)&&this.destination.next(a);this.buffer=[];var b=q(this.closingSelector)();b===n?this.error(n.e):(this.closingSubscription=a=new v,this.add(a),this.subscribing=!0,a.add(r(this,b)),this.subscribing=!1)};return a}(t);g.prototype.bufferWhen=function(b){return $a(b)(this)};var Hd=function(){function b(a){this.selector=a}b.prototype.call=function(a,c){return c.subscribe(new Wf(a,this.selector,this.caught))};return b}(),Wf=function(b){function a(a,e,d){b.call(this,a);this.selector=e;this.caught=d}k(a,b);a.prototype.error=function(a){if(!this.isStopped){var c=void 0;try{c=this.selector(a,this.caught)}catch(d){b.prototype.error.call(this,d);return}this._unsubscribeAndRecycle();this.add(r(this,c))}};return a}(t);g.prototype.catch=bb;g.prototype._catch=bb;g.prototype.combineAll=function(b){return cb(b)(this)};g.prototype.combineLatest=function(){for(var b=[],a=0;a<arguments.length;a++)b[a-0]=arguments[a];return Ga.apply(void 0,b)(this)};g.prototype.concat=function(){for(var b=[],a=0;a<arguments.length;a++)b[a-0]=arguments[a];return db.apply(void 0,b)(this)};g.prototype.concatAll=function(){return oa()(this)};g.prototype.concatMap=function(b,a){return pa(b,a)(this)};g.prototype.concatMapTo=function(b,a){return eb(b,a)(this)};var Id=function(){function b(a,c){this.predicate=a;this.source=c}b.prototype.call=function(a,c){return c.subscribe(new Xf(a,this.predicate,this.source))};return b}(),Xf=function(b){function a(a,e,d){b.call(this,a);this.predicate=e;this.source=d;this.index=this.count=0}k(a,b);a.prototype._next=function(a){this.predicate?this._tryPredicate(a):this.count++};a.prototype._tryPredicate=function(a){var c;try{c=this.predicate(a,this.index++,this.source)}catch(d){this.destination.error(d);return}c&&this.count++};a.prototype._complete=function(){this.destination.next(this.count);this.destination.complete()};return a}(m);g.prototype.count=function(b){return fb(b)(this)};var Jd=function(){function b(){}b.prototype.call=function(a,c){return c.subscribe(new Yf(a))};return b}(),Yf=function(b){function a(a){b.call(this,a)}k(a,b);a.prototype._next=function(a){a.observe(this.destination)};return a}(m);g.prototype.dematerialize=function(){return gb()(this)};var Kd=function(){function b(a){this.durationSelector=a}b.prototype.call=function(a,c){return c.subscribe(new Zf(a,this.durationSelector))};return b}(),Zf=function(b){function a(a,e){b.call(this,a);this.durationSelector=e;this.hasValue=!1;this.durationSubscription=null}k(a,b);a.prototype._next=function(a){try{var c=this.durationSelector.call(this,a);c&&this._tryNext(a,c)}catch(d){this.destination.error(d)}};a.prototype._complete=function(){this.emitValue();this.destination.complete()};a.prototype._tryNext=function(a,b){var c=this.durationSubscription;this.value=a;this.hasValue=!0;c&&(c.unsubscribe(),this.remove(c));c=r(this,b);c.closed||this.add(this.durationSubscription=c)};a.prototype.notifyNext=function(a,b,d,f,h){this.emitValue()};a.prototype.notifyComplete=function(){this.emitValue()};a.prototype.emitValue=function(){if(this.hasValue){var a=this.value,e=this.durationSubscription;e&&(this.durationSubscription=null,e.unsubscribe(),this.remove(e));this.value=null;this.hasValue=!1;b.prototype._next.call(this,a)}};return a}(t);g.prototype.debounce=function(b){return hb(b)(this)};var Ld=function(){function b(a,c){this.dueTime=a;this.scheduler=c}b.prototype.call=function(a,c){return c.subscribe(new $f(a,this.dueTime,this.scheduler))};return b}(),$f=function(b){function a(a,e,d){b.call(this,a);this.dueTime=e;this.scheduler=d;this.lastValue=this.debouncedSubscription=null;this.hasValue=!1}k(a,b);a.prototype._next=function(a){this.clearDebounce();this.lastValue=a;this.hasValue=!0;this.add(this.debouncedSubscription=this.scheduler.schedule(Md,this.dueTime,this))};a.prototype._complete=function(){this.debouncedNext();this.destination.complete()};a.prototype.debouncedNext=function(){this.clearDebounce();this.hasValue&&(this.destination.next(this.lastValue),this.lastValue=null,this.hasValue=!1)};a.prototype.clearDebounce=function(){var a=this.debouncedSubscription;null!==a&&(this.remove(a),a.unsubscribe(),this.debouncedSubscription=null)};return a}(m);g.prototype.debounceTime=function(b,a){void 0===a&&(a=u);return ib(b,a)(this)};var Nd=function(){function b(a){this.defaultValue=a}b.prototype.call=function(a,c){return c.subscribe(new ag(a,this.defaultValue))};return b}(),ag=function(b){function a(a,e){b.call(this,a);this.defaultValue=e;this.isEmpty=!0}k(a,b);a.prototype._next=function(a){this.isEmpty=!1;this.destination.next(a)};a.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue);this.destination.complete()};return a}(m);g.prototype.defaultIfEmpty=function(b){void 0===b&&(b=null);return qa(b)(this)};var Od=function(){function b(a,c){this.delay=a;this.scheduler=c}b.prototype.call=function(a,c){return c.subscribe(new bg(a,this.delay,this.scheduler))};return b}(),bg=function(b){function a(a,e,d){b.call(this,a);this.delay=e;this.scheduler=d;this.queue=[];this.errored=this.active=!1}k(a,b);a.dispatch=function(a){for(var c=a.source,b=c.queue,f=a.scheduler,h=a.destination;0<b.length&&0>=b[0].time-f.now();)b.shift().notification.observe(h);0<b.length?(c=Math.max(0,b[0].time-f.now()),this.schedule(a,c)):c.active=!1};a.prototype._schedule=function(c){this.active=!0;this.add(c.schedule(a.dispatch,this.delay,{source:this,destination:this.destination,scheduler:c}))};a.prototype.scheduleNotification=function(a){if(!0!==this.errored){var c=this.scheduler;a=new cg(c.now()+this.delay,a);this.queue.push(a);!1===this.active&&this._schedule(c)}};a.prototype._next=function(a){this.scheduleNotification(y.createNext(a))};a.prototype._error=function(a){this.errored=!0;this.queue=[];this.destination.error(a)};a.prototype._complete=function(){this.scheduleNotification(y.createComplete())};return a}(m),cg=function(){return function(b,a){this.time=b;this.notification=a}}();g.prototype.delay=function(b,a){void 0===a&&(a=u);return jb(b,a)(this)};var lb=function(){function b(a){this.delayDurationSelector=a}b.prototype.call=function(a,c){return c.subscribe(new dg(a,this.delayDurationSelector))};return b}(),dg=function(b){function a(a,e){b.call(this,a);this.delayDurationSelector=e;this.completed=!1;this.delayNotifierSubscriptions=[];this.values=[]}k(a,b);a.prototype.notifyNext=function(a,b,d,f,h){this.destination.next(a);this.removeSubscription(h);this.tryComplete()};a.prototype.notifyError=function(a,b){this._error(a)};a.prototype.notifyComplete=function(a){(a=this.removeSubscription(a))&&this.destination.next(a);this.tryComplete()};a.prototype._next=function(a){try{var c=this.delayDurationSelector(a);c&&this.tryDelay(c,a)}catch(d){this.destination.error(d)}};a.prototype._complete=function(){this.completed=!0;this.tryComplete()};a.prototype.removeSubscription=function(a){a.unsubscribe();a=this.delayNotifierSubscriptions.indexOf(a);var c=null;-1!==a&&(c=this.values[a],this.delayNotifierSubscriptions.splice(a,1),this.values.splice(a,1));return c};a.prototype.tryDelay=function(a,b){(a=r(this,a,b))&&!a.closed&&(this.add(a),this.delayNotifierSubscriptions.push(a));this.values.push(b)};a.prototype.tryComplete=function(){this.completed&&0===this.delayNotifierSubscriptions.length&&this.destination.complete()};return a}(t),Pd=function(b){function a(a,e){b.call(this);this.source=a;this.subscriptionDelay=e}k(a,b);a.prototype._subscribe=function(a){this.subscriptionDelay.subscribe(new eg(a,this.source))};return a}(g),eg=function(b){function a(a,e){b.call(this);this.parent=a;this.source=e;this.sourceSubscribed=!1}k(a,b);a.prototype._next=function(a){this.subscribeToSource()};a.prototype._error=function(a){this.unsubscribe();this.parent.error(a)};a.prototype._complete=function(){this.subscribeToSource()};a.prototype.subscribeToSource=function(){this.sourceSubscribed||(this.sourceSubscribed=!0,this.unsubscribe(),this.source.subscribe(this.parent))};return a}(m);g.prototype.delayWhen=function(b,a){return kb(b,a)(this)};var fg=p.Set||Qd(),Rd=function(){function b(a,c){this.keySelector=a;this.flushes=c}b.prototype.call=function(a,c){return c.subscribe(new gg(a,this.keySelector,this.flushes))};return b}(),gg=function(b){function a(a,e,d){b.call(this,a);this.keySelector=e;this.values=new fg;d&&this.add(r(this,d))}k(a,b);a.prototype.notifyNext=function(a,b,d,f,h){this.values.clear()};a.prototype.notifyError=function(a,b){this._error(a)};a.prototype._next=function(a){this.keySelector?this._useKeySelector(a):this._finalizeNext(a,a)};a.prototype._useKeySelector=function(a){var c,b=this.destination;try{c=this.keySelector(a)}catch(f){b.error(f);return}this._finalizeNext(c,a)};a.prototype._finalizeNext=function(a,b){var c=this.values;c.has(a)||(c.add(a),this.destination.next(b))};return a}(t);g.prototype.distinct=function(b,a){return mb(b,a)(this)};var Sd=function(){function b(a,c){this.compare=a;this.keySelector=c}b.prototype.call=function(a,c){return c.subscribe(new hg(a,this.compare,this.keySelector))};return b}(),hg=function(b){function a(a,e,d){b.call(this,a);this.keySelector=d;this.hasKey=!1;"function"===typeof e&&(this.compare=e)}k(a,b);a.prototype.compare=function(a,b){return a===b};a.prototype._next=function(a){var c=a;if(this.keySelector&&(c=q(this.keySelector)(a),c===n))return this.destination.error(n.e);var b=!1;if(this.hasKey){if(b=q(this.compare)(this.key,c),b===n)return this.destination.error(n.e)}else this.hasKey=!0;!1===!!b&&(this.key=c,this.destination.next(a))};return a}(m);g.prototype.distinctUntilChanged=function(b,a){return ra(b,a)(this)};g.prototype.distinctUntilKeyChanged=function(b,a){return nb(b,a)(this)};var Td=function(){function b(a,c,b){this.nextOrObserver=a;this.error=c;this.complete=b}b.prototype.call=function(a,c){return c.subscribe(new ig(a,this.nextOrObserver,this.error,this.complete))};return b}(),ig=function(b){function a(a,e,d,f){b.call(this,a);a=new m(e,d,f);a.syncErrorThrowable=!0;this.add(a);this.safeSubscriber=a}k(a,b);a.prototype._next=function(a){var c=this.safeSubscriber;c.next(a);c.syncErrorThrown?this.destination.error(c.syncErrorValue):this.destination.next(a)};a.prototype._error=function(a){var c=this.safeSubscriber;c.error(a);c.syncErrorThrown?this.destination.error(c.syncErrorValue):this.destination.error(a)};a.prototype._complete=function(){var a=this.safeSubscriber;a.complete();a.syncErrorThrown?this.destination.error(a.syncErrorValue):this.destination.complete()};return a}(m);g.prototype.do=pb;g.prototype._do=pb;var Ud=function(){function b(){}b.prototype.call=function(a,c){return c.subscribe(new jg(a))};return b}(),jg=function(b){function a(a){b.call(this,a);this.hasSubscription=this.hasCompleted=!1}k(a,b);a.prototype._next=function(a){this.hasSubscription||(this.hasSubscription=!0,this.add(r(this,a)))};a.prototype._complete=function(){this.hasCompleted=!0;this.hasSubscription||this.destination.complete()};a.prototype.notifyComplete=function(a){this.remove(a);this.hasSubscription=!1;this.hasCompleted&&this.destination.complete()};return a}(t);g.prototype.exhaust=function(){return qb()(this)};var Vd=function(){function b(a,c){this.project=a;this.resultSelector=c}b.prototype.call=function(a,c){return c.subscribe(new kg(a,this.project,this.resultSelector))};return b}(),kg=function(b){function a(a,e,d){b.call(this,a);this.project=e;this.resultSelector=d;this.hasCompleted=this.hasSubscription=!1;this.index=0}k(a,b);a.prototype._next=function(a){this.hasSubscription||this.tryNext(a)};a.prototype.tryNext=function(a){var c=this.index++,b=this.destination;try{var f=this.project(a,c);this.hasSubscription=!0;this.add(r(this,f,a,c))}catch(h){b.error(h)}};a.prototype._complete=function(){this.hasCompleted=!0;this.hasSubscription||this.destination.complete()};a.prototype.notifyNext=function(a,b,d,f,h){h=this.destination;this.resultSelector?this.trySelectResult(a,b,d,f):h.next(b)};a.prototype.trySelectResult=function(a,b,d,f){var c=this.resultSelector,e=this.destination;try{var g=c(a,b,d,f);e.next(g)}catch(N){e.error(N)}};a.prototype.notifyError=function(a){this.destination.error(a)};a.prototype.notifyComplete=function(a){this.remove(a);this.hasSubscription=!1;this.hasCompleted&&this.destination.complete()};return a}(t);g.prototype.exhaustMap=function(b,a){return rb(b,a)(this)};var Wd=function(){function b(a,c,b){this.project=a;this.concurrent=c;this.scheduler=b}b.prototype.call=function(a,c){return c.subscribe(new lg(a,this.project,this.concurrent,this.scheduler))};return b}(),lg=function(b){function a(a,e,d,f){b.call(this,a);this.project=e;this.concurrent=d;this.scheduler=f;this.active=this.index=0;this.hasCompleted=!1;d<Number.POSITIVE_INFINITY&&(this.buffer=[])}k(a,b);a.dispatch=function(a){a.subscriber.subscribeToProjection(a.result,a.value,a.index)};a.prototype._next=function(c){var b=this.destination;if(b.closed)this._complete();else{var d=this.index++;if(this.active<this.concurrent){b.next(c);var f=q(this.project)(c,d);f===n?b.error(n.e):this.scheduler?this.add(this.scheduler.schedule(a.dispatch,0,{subscriber:this,result:f,value:c,index:d})):this.subscribeToProjection(f,c,d)}else this.buffer.push(c)}};a.prototype.subscribeToProjection=function(a,b,d){this.active++;this.add(r(this,a,b,d))};a.prototype._complete=function(){(this.hasCompleted=!0,0===this.active)&&this.destination.complete()};a.prototype.notifyNext=function(a,b,d,f,h){this._next(b)};a.prototype.notifyComplete=function(a){var c=this.buffer;this.remove(a);this.active--;c&&0<c.length&&this._next(c.shift());this.hasCompleted&&0===this.active&&this.destination.complete()};return a}(t);g.prototype.expand=function(b,a,c){void 0===a&&(a=Number.POSITIVE_INFINITY);void 0===c&&(c=void 0);a=1>(a||0)?Number.POSITIVE_INFINITY:a;return sb(b,a,c)(this)};var R=function(b){function a(){var a=b.call(this,"argument out of range");this.name=a.name="ArgumentOutOfRangeError";this.stack=a.stack;this.message=a.message}k(a,b);return a}(Error),Xd=function(){function b(a,c){this.index=a;this.defaultValue=c;if(0>a)throw new R}b.prototype.call=function(a,c){return c.subscribe(new mg(a,this.index,this.defaultValue))};return b}(),mg=function(b){function a(a,e,d){b.call(this,a);this.index=e;this.defaultValue=d}k(a,b);a.prototype._next=function(a){0===this.index--&&(this.destination.next(a),this.destination.complete())};a.prototype._complete=function(){var a=this.destination;0<=this.index&&("undefined"!==typeof this.defaultValue?a.next(this.defaultValue):a.error(new R));a.complete()};return a}(m);g.prototype.elementAt=function(b,a){return tb(b,a)(this)};var Yd=function(){function b(a,c){this.predicate=a;this.thisArg=c}b.prototype.call=function(a,c){return c.subscribe(new ng(a,this.predicate,this.thisArg))};return b}(),ng=function(b){function a(a,e,d){b.call(this,a);this.predicate=e;this.thisArg=d;this.count=0}k(a,b);a.prototype._next=function(a){var c;try{c=this.predicate.call(this.thisArg,a,this.count++)}catch(d){this.destination.error(d);return}c&&this.destination.next(a)};return a}(m);g.prototype.filter=function(b,a){return da(b,a)(this)};var Zd=function(){function b(a){this.callback=a}b.prototype.call=function(a,c){return c.subscribe(new og(a,this.callback))};return b}(),og=function(b){function a(a,e){b.call(this,a);this.add(new v(e))}k(a,b);return a}(m);g.prototype.finally=vb;g.prototype._finally=vb;var xb=function(){function b(a,c,b,d){this.predicate=a;this.source=c;this.yieldIndex=b;this.thisArg=d}b.prototype.call=function(a,c){return c.subscribe(new pg(a,this.predicate,this.source,this.yieldIndex,this.thisArg))};return b}(),pg=function(b){function a(a,e,d,f,h){b.call(this,a);this.predicate=e;this.source=d;this.yieldIndex=f;this.thisArg=h;this.index=0}k(a,b);a.prototype.notifyComplete=function(a){var c=this.destination;c.next(a);c.complete()};a.prototype._next=function(a){var c=this.predicate,b=this.thisArg,f=this.index++;try{c.call(b||this,a,f,this.source)&&this.notifyComplete(this.yieldIndex?f:a)}catch(h){this.destination.error(h)}};a.prototype._complete=function(){this.notifyComplete(this.yieldIndex?-1:void 0)};return a}(m);g.prototype.find=function(b,a){return wb(b,a)(this)};g.prototype.findIndex=function(b,a){return yb(b,a)(this)};var ja=function(b){function a(){var a=b.call(this,"no elements in sequence");this.name=a.name="EmptyError";this.stack=a.stack;this.message=a.message}k(a,b);return a}(Error),$d=function(){function b(a,c,b,d){this.predicate=a;this.resultSelector=c;this.defaultValue=b;this.source=d}b.prototype.call=function(a,c){return c.subscribe(new qg(a,this.predicate,this.resultSelector,this.defaultValue,this.source))};return b}(),qg=function(b){function a(a,e,d,f,h){b.call(this,a);this.predicate=e;this.resultSelector=d;this.defaultValue=f;this.source=h;this.index=0;this._emitted=this.hasCompleted=!1}k(a,b);a.prototype._next=function(a){var c=this.index++;this.predicate?this._tryPredicate(a,c):this._emit(a,c)};a.prototype._tryPredicate=function(a,b){var c;try{c=this.predicate(a,b,this.source)}catch(f){this.destination.error(f);return}c&&this._emit(a,b)};a.prototype._emit=function(a,b){this.resultSelector?this._tryResultSelector(a,b):this._emitFinal(a)};a.prototype._tryResultSelector=function(a,b){var c;try{c=this.resultSelector(a,b)}catch(f){this.destination.error(f);return}this._emitFinal(c)};a.prototype._emitFinal=function(a){var c=this.destination;this._emitted||(this._emitted=!0,c.next(a),c.complete(),this.hasCompleted=!0)};a.prototype._complete=function(){var a=this.destination;this.hasCompleted||"undefined"===typeof this.defaultValue?this.hasCompleted||a.error(new ja):(a.next(this.defaultValue),a.complete())};return a}(m);g.prototype.first=function(b,a,c){return zb(b,a,c)(this)};var rg=function(){function b(){this.size=0;this._values=[];this._keys=[]}b.prototype.get=function(a){a=this._keys.indexOf(a);return-1===a?void 0:this._values[a]};b.prototype.set=function(a,c){var b=this._keys.indexOf(a);-1===b?(this._keys.push(a),this._values.push(c),this.size++):this._values[b]=c;return this};b.prototype.delete=function(a){a=this._keys.indexOf(a);if(-1===a)return!1;this._values.splice(a,1);this._keys.splice(a,1);this.size--;return!0};b.prototype.clear=function(){this._keys.length=0;this.size=this._values.length=0};b.prototype.forEach=function(a,c){for(var b=0;b<this.size;b++)a.call(c,this._values[b],this._keys[b])};return b}(),sg=p.Map||rg,tg=function(){function b(){this.values={}}b.prototype.delete=function(a){this.values[a]=null;return!0};b.prototype.set=function(a,c){this.values[a]=c;return this};b.prototype.get=function(a){return this.values[a]};b.prototype.forEach=function(a,c){var b=this.values,d;for(d in b)b.hasOwnProperty(d)&&null!==b[d]&&a.call(c,b[d],d)};b.prototype.clear=function(){this.values={}};return b}(),ae=function(){function b(a,c,b,d){this.keySelector=a;this.elementSelector=c;this.durationSelector=b;this.subjectSelector=d}b.prototype.call=function(a,c){return c.subscribe(new ug(a,this.keySelector,this.elementSelector,this.durationSelector,this.subjectSelector))};return b}(),ug=function(b){function a(a,e,d,f,h){b.call(this,a);this.keySelector=e;this.elementSelector=d;this.durationSelector=f;this.subjectSelector=h;this.groups=null;this.attemptedToUnsubscribe=!1;this.count=0}k(a,b);a.prototype._next=function(a){var c;try{c=this.keySelector(a)}catch(d){this.error(d);return}this._group(a,c)};a.prototype._group=function(a,b){var c=this.groups;c||(c=this.groups="string"===typeof b?new tg:new sg);var e=c.get(b),h;if(this.elementSelector)try{h=this.elementSelector(a)}catch(z){this.error(z)}else h=a;if(!e&&(e=this.subjectSelector?this.subjectSelector():new w,c.set(b,e),a=new Zc(b,e,this),this.destination.next(a),this.durationSelector)){a=void 0;try{a=this.durationSelector(new Zc(b,e))}catch(z){this.error(z);return}this.add(a.subscribe(new vg(b,e,this)))}e.closed||e.next(h)};a.prototype._error=function(a){var c=this.groups;c&&(c.forEach(function(c,b){c.error(a)}),c.clear());this.destination.error(a)};a.prototype._complete=function(){var a=this.groups;a&&(a.forEach(function(a,c){a.complete()}),a.clear());this.destination.complete()};a.prototype.removeGroup=function(a){this.groups.delete(a)};a.prototype.unsubscribe=function(){this.closed||(this.attemptedToUnsubscribe=!0,0===this.count&&b.prototype.unsubscribe.call(this))};return a}(m),vg=function(b){function a(a,e,d){b.call(this,e);this.key=a;this.group=e;this.parent=d}k(a,b);a.prototype._next=function(a){this.complete()};a.prototype._unsubscribe=function(){var a=this.parent,b=this.key;this.key=this.parent=null;a&&a.removeGroup(b)};return a}(m),Zc=function(b){function a(a,e,d){b.call(this);this.key=a;this.groupSubject=e;this.refCountSubscription=d}k(a,b);a.prototype._subscribe=function(a){var c=new v,b=this.refCountSubscription,f=this.groupSubject;b&&!b.closed&&c.add(new wg(b));c.add(f.subscribe(a));return c};return a}(g),wg=function(b){function a(a){b.call(this);this.parent=a;a.count++}k(a,b);a.prototype.unsubscribe=function(){var a=this.parent;a.closed||this.closed||(b.prototype.unsubscribe.call(this),--a.count,0===a.count&&a.attemptedToUnsubscribe&&a.unsubscribe())};return a}(v);g.prototype.groupBy=function(b,a,c,e){return Ab(b,a,c,e)(this)};var be=function(){function b(){}b.prototype.call=function(a,c){return c.subscribe(new xg(a))};return b}(),xg=function(b){function a(){b.apply(this,arguments)}k(a,b);a.prototype._next=function(a){};return a}(m);g.prototype.ignoreElements=function(){return Bb()(this)};var ce=function(){function b(){}b.prototype.call=function(a,c){return c.subscribe(new yg(a))};return b}(),yg=function(b){function a(a){b.call(this,a)}k(a,b);a.prototype.notifyComplete=function(a){var c=this.destination;c.next(a);c.complete()};a.prototype._next=function(a){this.notifyComplete(!1)};a.prototype._complete=function(){this.notifyComplete(!0)};return a}(m);g.prototype.isEmpty=function(){return Cb()(this)};var de=function(){function b(a){this.durationSelector=a}b.prototype.call=function(a,c){return c.subscribe(new zg(a,this.durationSelector))};return b}(),zg=function(b){function a(a,e){b.call(this,a);this.durationSelector=e;this.hasValue=!1}k(a,b);a.prototype._next=function(a){this.value=a;this.hasValue=!0;this.throttled||(a=q(this.durationSelector)(a),a===n?this.destination.error(n.e):(a=r(this,a),a.closed?this.clearThrottle():this.add(this.throttled=a)))};a.prototype.clearThrottle=function(){var a=this.value,b=this.hasValue,d=this.throttled;d&&(this.remove(d),this.throttled=null,d.unsubscribe());b&&(this.value=null,this.hasValue=!1,this.destination.next(a))};a.prototype.notifyNext=function(a,b,d,f){this.clearThrottle()};a.prototype.notifyComplete=function(){this.clearThrottle()};return a}(t);g.prototype.audit=function(b){return sa(b)(this)};g.prototype.auditTime=function(b,a){void 0===a&&(a=u);return Db(b,a)(this)};var ee=function(){function b(a,c,b,d){this.predicate=a;this.resultSelector=c;this.defaultValue=b;this.source=d}b.prototype.call=function(a,c){return c.subscribe(new Ag(a,this.predicate,this.resultSelector,this.defaultValue,this.source))};return b}(),Ag=function(b){function a(a,e,d,f,h){b.call(this,a);this.predicate=e;this.resultSelector=d;this.defaultValue=f;this.source=h;this.hasValue=!1;this.index=0;"undefined"!==typeof f&&(this.lastValue=f,this.hasValue=!0)}k(a,b);a.prototype._next=function(a){var c=this.index++;this.predicate?this._tryPredicate(a,c):this.resultSelector?this._tryResultSelector(a,c):(this.lastValue=a,this.hasValue=!0)};a.prototype._tryPredicate=function(a,b){var c;try{c=this.predicate(a,b,this.source)}catch(f){this.destination.error(f);return}c&&(this.resultSelector?this._tryResultSelector(a,b):(this.lastValue=a,this.hasValue=!0))};a.prototype._tryResultSelector=function(a,b){var c;try{c=this.resultSelector(a,b)}catch(f){this.destination.error(f);return}this.lastValue=c;this.hasValue=!0};a.prototype._complete=function(){var a=this.destination;this.hasValue?(a.next(this.lastValue),a.complete()):a.error(new ja)};return a}(m);g.prototype.last=function(b,a,c){return Fb(b,a,c)(this)};g.prototype.let=Gb;g.prototype.letBind=Gb;var fe=function(){function b(a,c,b){this.predicate=a;this.thisArg=c;this.source=b}b.prototype.call=function(a,c){return c.subscribe(new Bg(a,this.predicate,this.thisArg,this.source))};return b}(),Bg=function(b){function a(a,e,d,f){b.call(this,a);this.predicate=e;this.thisArg=d;this.source=f;this.index=0;this.thisArg=d||this}k(a,b);a.prototype.notifyComplete=function(a){this.destination.next(a);this.destination.complete()};a.prototype._next=function(a){var c=!1;try{c=this.predicate.call(this.thisArg,a,this.index++,this.source)}catch(d){this.destination.error(d);return}c||this.notifyComplete(!1)};a.prototype._complete=function(){this.notifyComplete(!0)};return a}(m);g.prototype.every=function(b,a){return Hb(b,a)(this)};g.prototype.map=function(b,a){return V(b,a)(this)};var ge=function(){function b(a){this.value=a}b.prototype.call=function(a,c){return c.subscribe(new Cg(a,this.value))};return b}(),Cg=function(b){function a(a,e){b.call(this,a);this.value=e}k(a,b);a.prototype._next=function(a){this.destination.next(this.value)};return a}(m);g.prototype.mapTo=function(b){return Ib(b)(this)};var he=function(){function b(){}b.prototype.call=function(a,c){return c.subscribe(new Dg(a))};return b}(),Dg=function(b){function a(a){b.call(this,a)}k(a,b);a.prototype._next=function(a){this.destination.next(y.createNext(a))};a.prototype._error=function(a){var c=this.destination;c.next(y.createError(a));c.complete()};a.prototype._complete=function(){var a=this.destination;a.next(y.createComplete());a.complete()};return a}(m);g.prototype.materialize=function(){return Jb()(this)};var ie=function(){function b(a,c,b){void 0===b&&(b=!1);this.accumulator=a;this.seed=c;this.hasSeed=b}b.prototype.call=function(a,c){return c.subscribe(new Eg(a,this.accumulator,this.seed,this.hasSeed))};return b}(),Eg=function(b){function a(a,e,d,f){b.call(this,a);this.accumulator=e;this._seed=d;this.hasSeed=f;this.index=0}k(a,b);Object.defineProperty(a.prototype,"seed",{get:function(){return this._seed},set:function(a){this.hasSeed=!0;this._seed=a},enumerable:!0,configurable:!0});a.prototype._next=function(a){if(this.hasSeed)return this._tryNext(a);this.seed=a;this.destination.next(a)};a.prototype._tryNext=function(a){var c=this.index++,b;try{b=this.accumulator(this.seed,a,c)}catch(f){this.destination.error(f)}this.seed=b;this.destination.next(b)};return a}(m),je=function(){function b(a){this.total=a;if(0>this.total)throw new R}b.prototype.call=function(a,c){return c.subscribe(new Fg(a,this.total))};return b}(),Fg=function(b){function a(a,e){b.call(this,a);this.total=e;this.ring=[];this.count=0}k(a,b);a.prototype._next=function(a){var c=this.ring,b=this.total,f=this.count++;c.length<b?c.push(a):c[f%b]=a};a.prototype._complete=function(){var a=this.destination,b=this.count;if(0<b)for(var d=this.count>=this.total?this.total:this.count,f=this.ring,h=0;h<d;h++){var g=b++%d;a.next(f[g])}a.complete()};return a}(m);g.prototype.max=function(b){return Kb(b)(this)};g.prototype.merge=function(){for(var b=[],a=0;a<arguments.length;a++)b[a-0]=arguments[a];return Lb.apply(void 0,b)(this)};g.prototype.mergeAll=function(b){void 0===b&&(b=Number.POSITIVE_INFINITY);return ba(b)(this)};g.prototype.mergeMap=Mb;g.prototype.flatMap=Mb;var ke=function(){function b(a,c,b){void 0===b&&(b=Number.POSITIVE_INFINITY);this.ish=a;this.resultSelector=c;this.concurrent=b}b.prototype.call=function(a,c){return c.subscribe(new Gg(a,this.ish,this.resultSelector,this.concurrent))};return b}(),Gg=function(b){function a(a,e,d,f){void 0===f&&(f=Number.POSITIVE_INFINITY);b.call(this,a);this.ish=e;this.resultSelector=d;this.concurrent=f;this.hasCompleted=!1;this.buffer=[];this.index=this.active=0}k(a,b);a.prototype._next=function(a){if(this.active<this.concurrent){var c=this.resultSelector,b=this.index++,f=this.ish,h=this.destination;this.active++;this._innerSub(f,h,c,a,b)}else this.buffer.push(a)};a.prototype._innerSub=function(a,b,d,f,h){this.add(r(this,a,f,h))};a.prototype._complete=function(){this.hasCompleted=!0;0===this.active&&0===this.buffer.length&&this.destination.complete()};a.prototype.notifyNext=function(a,b,d,f,h){h=this.destination;this.resultSelector?this.trySelectResult(a,b,d,f):h.next(b)};a.prototype.trySelectResult=function(a,b,d,f){var c=this.resultSelector,e=this.destination,g;try{g=c(a,b,d,f)}catch(N){e.error(N);return}e.next(g)};a.prototype.notifyError=function(a){this.destination.error(a)};a.prototype.notifyComplete=function(a){var c=this.buffer;this.remove(a);this.active--;0<c.length?this._next(c.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()};return a}(t);g.prototype.flatMapTo=Ob;g.prototype.mergeMapTo=Ob;var le=function(){function b(a,c,b){this.accumulator=a;this.seed=c;this.concurrent=b}b.prototype.call=function(a,c){return c.subscribe(new Hg(a,this.accumulator,this.seed,this.concurrent))};return b}(),Hg=function(b){function a(a,e,d,f){b.call(this,a);this.accumulator=e;this.acc=d;this.concurrent=f;this.hasCompleted=this.hasValue=!1;this.buffer=[];this.index=this.active=0}k(a,b);a.prototype._next=function(a){if(this.active<this.concurrent){var b=this.index++,c=q(this.accumulator)(this.acc,a),f=this.destination;c===n?f.error(n.e):(this.active++,this._innerSub(c,a,b))}else this.buffer.push(a)};a.prototype._innerSub=function(a,b,d){this.add(r(this,a,b,d))};a.prototype._complete=function(){this.hasCompleted=!0;0===this.active&&0===this.buffer.length&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete())};a.prototype.notifyNext=function(a,b,d,f,h){a=this.destination;this.acc=b;this.hasValue=!0;a.next(b)};a.prototype.notifyComplete=function(a){var b=this.buffer;this.remove(a);this.active--;0<b.length?this._next(b.shift()):0===this.active&&this.hasCompleted&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete())};return a}(t);g.prototype.mergeScan=function(b,a,c){void 0===c&&(c=Number.POSITIVE_INFINITY);return Pb(b,a,c)(this)};g.prototype.min=function(b){return Qb(b)(this)};var me=function(){function b(a){this.connectable=a}b.prototype.call=function(a,b){var c=this.connectable;c._refCount++;a=new Ig(a,c);b=b.subscribe(a);a.closed||(a.connection=c.connect());return b};return b}(),Ig=function(b){function a(a,e){b.call(this,a);this.connectable=e}k(a,b);a.prototype._unsubscribe=function(){var a=this.connectable;if(a){this.connectable=null;var b=a._refCount;0>=b?this.connection=null:(a._refCount=b-1,1<b?this.connection=null:(b=this.connection,a=a._connection,this.connection=null,!a||b&&a!==b||a.unsubscribe()))}else this.connection=null};return a}(m),$c=function(b){function a(a,e){b.call(this);this.source=a;this.subjectFactory=e;this._refCount=0;this._isComplete=!1}k(a,b);a.prototype._subscribe=function(a){return this.getSubject().subscribe(a)};a.prototype.getSubject=function(){var a=this._subject;if(!a||a.isStopped)this._subject=this.subjectFactory();return this._subject};a.prototype.connect=function(){var a=this._connection;a||(this._isComplete=!1,a=this._connection=new v,a.add(this.source.subscribe(new Jg(this.getSubject(),this))),a.closed?(this._connection=null,a=v.EMPTY):this._connection=a);return a};a.prototype.refCount=function(){return ta()(this)};return a}(g),Z=$c.prototype,oe={operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:Z._subscribe},_isComplete:{value:Z._isComplete,writable:!0},getSubject:{value:Z.getSubject},connect:{value:Z.connect},refCount:{value:Z.refCount}},Jg=function(b){function a(a,e){b.call(this,a);this.connectable=e}k(a,b);a.prototype._error=function(a){this._unsubscribe();b.prototype._error.call(this,a)};a.prototype._complete=function(){this.connectable._isComplete=!0;this._unsubscribe();b.prototype._complete.call(this)};a.prototype._unsubscribe=function(){var a=this.connectable;if(a){this.connectable=null;var b=a._connection;a._refCount=0;a._subject=null;a._connection=null;b&&b.unsubscribe()}};return a}(Pc);(function(b){function a(a,e){b.call(this,a);this.connectable=e}k(a,b);a.prototype._unsubscribe=function(){var a=this.connectable;if(a){this.connectable=null;var b=a._refCount;0>=b?this.connection=null:(a._refCount=b-1,1<b?this.connection=null:(b=this.connection,a=a._connection,this.connection=null,!a||b&&a!==b||a.unsubscribe()))}else this.connection=null};return a})(m);var ne=function(){function b(a,b){this.subjectFactory=a;this.selector=b}b.prototype.call=function(a,b){var c=this.selector,d=this.subjectFactory();a=c(d).subscribe(a);a.add(b.subscribe(d));return a};return b}();g.prototype.multicast=function(b,a){return H(b,a)(this)};g.prototype.observeOn=function(b,a){void 0===a&&(a=0);return Ia(b,a)(this)};g.prototype.onErrorResumeNext=function(){for(var b=[],a=0;a<arguments.length;a++)b[a-0]=arguments[a];return Oa.apply(void 0,b)(this)};var pe=function(){function b(){}b.prototype.call=function(a,b){return b.subscribe(new Kg(a))};return b}(),Kg=function(b){function a(a){b.call(this,a);this.hasPrev=!1}k(a,b);a.prototype._next=function(a){this.hasPrev?this.destination.next([this.prev,a]):this.hasPrev=!0;this.prev=a};return a}(m);g.prototype.pairwise=function(){return Rb()(this)};g.prototype.partition=function(b,a){return Sb(b,a)(this)};g.prototype.pluck=function(){for(var b=[],a=0;a<arguments.length;a++)b[a-0]=arguments[a];return Tb.apply(void 0,b)(this)};g.prototype.publish=function(b){return Ub(b)(this)};var Wb=function(b){function a(a){b.call(this);this._value=a}k(a,b);Object.defineProperty(a.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0});a.prototype._subscribe=function(a){var c=b.prototype._subscribe.call(this,a);c&&!c.closed&&a.next(this._value);return c};a.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new I;return this._value};a.prototype.next=function(a){b.prototype.next.call(this,this._value=a)};return a}(w);g.prototype.publishBehavior=function(b){return Vb(b)(this)};g.prototype.publishReplay=function(b,a,c,e){return Xb(b,a,c,e)(this)};g.prototype.publishLast=function(){return Yb()(this)};g.prototype.race=function(){for(var b=[],a=0;a<arguments.length;a++)b[a-0]=arguments[a];return Zb.apply(void 0,b)(this)};g.prototype.reduce=function(b,a){return 2<=arguments.length?Q(b,a)(this):Q(b)(this)};var ac=function(){function b(a,b){this.count=a;this.source=b}b.prototype.call=function(a,b){return b.subscribe(new Lg(a,this.count,this.source))};return b}(),Lg=function(b){function a(a,e,d){b.call(this,a);this.count=e;this.source=d}k(a,b);a.prototype.complete=function(){if(!this.isStopped){var a=this.source,e=this.count;if(0===e)return b.prototype.complete.call(this);-1<e&&(this.count=e-1);a.subscribe(this._unsubscribeAndRecycle())}};return a}(m);g.prototype.repeat=function(b){void 0===b&&(b=-1);return $b(b)(this)};var se=function(){function b(a){this.notifier=a}b.prototype.call=function(a,b){return b.subscribe(new Mg(a,this.notifier,b))};return b}(),Mg=function(b){function a(a,e,d){b.call(this,a);this.notifier=e;this.source=d;this.sourceIsBeingSubscribedTo=!0}k(a,b);a.prototype.notifyNext=function(a,b,d,f,h){this.sourceIsBeingSubscribedTo=!0;this.source.subscribe(this)};a.prototype.notifyComplete=function(a){if(!1===this.sourceIsBeingSubscribedTo)return b.prototype.complete.call(this)};a.prototype.complete=function(){this.sourceIsBeingSubscribedTo=!1;if(!this.isStopped){this.retries||this.subscribeToRetries();if(!this.retriesSubscription||this.retriesSubscription.closed)return b.prototype.complete.call(this);this._unsubscribeAndRecycle();this.notifications.next()}};a.prototype._unsubscribe=function(){var a=this.notifications,b=this.retriesSubscription;a&&(a.unsubscribe(),this.notifications=null);b&&(b.unsubscribe(),this.retriesSubscription=null);this.retries=null};a.prototype._unsubscribeAndRecycle=function(){var a=this.notifications,e=this.retries,d=this.retriesSubscription;this.retriesSubscription=this.retries=this.notifications=null;b.prototype._unsubscribeAndRecycle.call(this);this.notifications=a;this.retries=e;this.retriesSubscription=d;return this};a.prototype.subscribeToRetries=function(){this.notifications=new w;var a=q(this.notifier)(this.notifications);if(a===n)return b.prototype.complete.call(this);this.retries=a;this.retriesSubscription=r(this,a)};return a}(t);g.prototype.repeatWhen=function(b){return bc(b)(this)};var te=function(){function b(a,b){this.count=a;this.source=b}b.prototype.call=function(a,b){return b.subscribe(new Ng(a,this.count,this.source))};return b}(),Ng=function(b){function a(a,e,d){b.call(this,a);this.count=e;this.source=d}k(a,b);a.prototype.error=function(a){if(!this.isStopped){var c=this.source,d=this.count;if(0===d)return b.prototype.error.call(this,a);-1<d&&(this.count=d-1);c.subscribe(this._unsubscribeAndRecycle())}};return a}(m);g.prototype.retry=function(b){void 0===b&&(b=-1);return cc(b)(this)};var ue=function(){function b(a,b){this.notifier=a;this.source=b}b.prototype.call=function(a,b){return b.subscribe(new Og(a,this.notifier,this.source))};return b}(),Og=function(b){function a(a,e,d){b.call(this,a);this.notifier=e;this.source=d}k(a,b);a.prototype.error=function(a){if(!this.isStopped){var c=this.errors,d=this.retries,f=this.retriesSubscription;if(d)this.retriesSubscription=this.errors=null;else{c=new w;d=q(this.notifier)(c);if(d===n)return b.prototype.error.call(this,n.e);f=r(this,d)}this._unsubscribeAndRecycle();this.errors=c;this.retries=d;this.retriesSubscription=f;c.next(a)}};a.prototype._unsubscribe=function(){var a=this.errors,b=this.retriesSubscription;a&&(a.unsubscribe(),this.errors=null);b&&(b.unsubscribe(),this.retriesSubscription=null);this.retries=null};a.prototype.notifyNext=function(a,b,d,f,h){a=this.errors;b=this.retries;d=this.retriesSubscription;this.retriesSubscription=this.retries=this.errors=null;this._unsubscribeAndRecycle();this.errors=a;this.retries=b;this.retriesSubscription=d;this.source.subscribe(this)};return a}(t);g.prototype.retryWhen=function(b){return dc(b)(this)};var ve=function(){function b(a){this.notifier=a}b.prototype.call=function(a,b){a=new Pg(a);b=b.subscribe(a);b.add(r(a,this.notifier));return b};return b}(),Pg=function(b){function a(){b.apply(this,arguments);this.hasValue=!1}k(a,b);a.prototype._next=function(a){this.value=a;this.hasValue=!0};a.prototype.notifyNext=function(a,b,d,f,h){this.emitValue()};a.prototype.notifyComplete=function(){this.emitValue()};a.prototype.emitValue=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.value))};return a}(t);g.prototype.sample=function(b){return ec(b)(this)};var we=function(){function b(a,b){this.period=a;this.scheduler=b}b.prototype.call=function(a,b){return b.subscribe(new Qg(a,this.period,this.scheduler))};return b}(),Qg=function(b){function a(a,e,d){b.call(this,a);this.period=e;this.scheduler=d;this.hasValue=!1;this.add(d.schedule(xe,e,{subscriber:this,period:e}))}k(a,b);a.prototype._next=function(a){this.lastValue=a;this.hasValue=!0};a.prototype.notifyNext=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.lastValue))};return a}(m);g.prototype.sampleTime=function(b,a){void 0===a&&(a=u);return fc(b,a)(this)};g.prototype.scan=function(b,a){return 2<=arguments.length?W(b,a)(this):W(b)(this)};var ye=function(){function b(a,b){this.compareTo=a;this.comparor=b}b.prototype.call=function(a,b){return b.subscribe(new Rg(a,this.compareTo,this.comparor))};return b}(),Rg=function(b){function a(a,e,d){b.call(this,a);this.compareTo=e;this.comparor=d;this._a=[];this._b=[];this._oneComplete=!1;this.add(e.subscribe(new Sg(a,this)))}k(a,b);a.prototype._next=function(a){this._oneComplete&&0===this._b.length?this.emit(!1):(this._a.push(a),this.checkValues())};a.prototype._complete=function(){this._oneComplete?this.emit(0===this._a.length&&0===this._b.length):this._oneComplete=!0};a.prototype.checkValues=function(){for(var a=this._a,b=this._b,d=this.comparor;0<a.length&&0<b.length;){var f=a.shift(),h=b.shift();d?(f=q(d)(f,h),f===n&&this.destination.error(n.e)):f=f===h;f||this.emit(!1)}};a.prototype.emit=function(a){var b=this.destination;b.next(a);b.complete()};a.prototype.nextB=function(a){this._oneComplete&&0===this._a.length?this.emit(!1):(this._b.push(a),this.checkValues())};return a}(m),Sg=function(b){function a(a,e){b.call(this,a);this.parent=e}k(a,b);a.prototype._next=function(a){this.parent.nextB(a)};a.prototype._error=function(a){this.parent.error(a)};a.prototype._complete=function(){this.parent._complete()};return a}(m);g.prototype.sequenceEqual=function(b,a){return gc(b,a)(this)};g.prototype.share=function(){return hc()(this)};g.prototype.shareReplay=function(b,a,c){return ic(b,a,c)(this)};var Be=function(){function b(a,b){this.predicate=a;this.source=b}b.prototype.call=function(a,b){return b.subscribe(new Tg(a,this.predicate,this.source))};return b}(),Tg=function(b){function a(a,e,d){b.call(this,a);this.predicate=e;this.source=d;this.seenValue=!1;this.index=0}k(a,b);a.prototype.applySingleValue=function(a){this.seenValue?this.destination.error("Sequence contains more than one element"):(this.seenValue=!0,this.singleValue=a)};a.prototype._next=function(a){var b=this.index++;this.predicate?this.tryNext(a,b):this.applySingleValue(a)};a.prototype.tryNext=function(a,b){try{this.predicate(a,b,this.source)&&this.applySingleValue(a)}catch(d){this.destination.error(d)}};a.prototype._complete=function(){var a=this.destination;0<this.index?(a.next(this.seenValue?this.singleValue:void 0),a.complete()):a.error(new ja)};return a}(m);g.prototype.single=function(b){return jc(b)(this)};var Ce=function(){function b(a){this.total=a}b.prototype.call=function(a,b){return b.subscribe(new Ug(a,this.total))};return b}(),Ug=function(b){function a(a,e){b.call(this,a);this.total=e;this.count=0}k(a,b);a.prototype._next=function(a){++this.count>this.total&&this.destination.next(a)};return a}(m);g.prototype.skip=function(b){return kc(b)(this)};var De=function(){function b(a){this._skipCount=a;if(0>this._skipCount)throw new R}b.prototype.call=function(a,b){return 0===this._skipCount?b.subscribe(new m(a)):b.subscribe(new Vg(a,this._skipCount))};return b}(),Vg=function(b){function a(a,e){b.call(this,a);this._skipCount=e;this._count=0;this._ring=Array(e)}k(a,b);a.prototype._next=function(a){var b=this._skipCount,c=this._count++;if(c<b)this._ring[c]=a;else{var b=c%b,c=this._ring,f=c[b];c[b]=a;this.destination.next(f)}};return a}(m);g.prototype.skipLast=function(b){return lc(b)(this)};var Ee=function(){function b(a){this.notifier=a}b.prototype.call=function(a,b){return b.subscribe(new Wg(a,this.notifier))};return b}(),Wg=function(b){function a(a,e){b.call(this,a);this.isInnerStopped=this.hasValue=!1;this.add(r(this,e))}k(a,b);a.prototype._next=function(a){this.hasValue&&b.prototype._next.call(this,a)};a.prototype._complete=function(){this.isInnerStopped?b.prototype._complete.call(this):this.unsubscribe()};a.prototype.notifyNext=function(a,b,d,f,h){this.hasValue=!0};a.prototype.notifyComplete=function(){this.isInnerStopped=!0;this.isStopped&&b.prototype._complete.call(this)};return a}(t);g.prototype.skipUntil=function(b){return mc(b)(this)};var Fe=function(){function b(a){this.predicate=a}b.prototype.call=function(a,b){return b.subscribe(new Xg(a,this.predicate))};return b}(),Xg=function(b){function a(a,e){b.call(this,a);this.predicate=e;this.skipping=!0;this.index=0}k(a,b);a.prototype._next=function(a){var b=this.destination;this.skipping&&this.tryCallPredicate(a);this.skipping||b.next(a)};a.prototype.tryCallPredicate=function(a){try{this.skipping=!!this.predicate(a,this.index++)}catch(e){this.destination.error(e)}};return a}(m);g.prototype.skipWhile=function(b){return nc(b)(this)};g.prototype.startWith=function(){for(var b=[],a=0;a<arguments.length;a++)b[a-0]=arguments[a];return oc.apply(void 0,b)(this)};var ad=new(function(){function b(a){this.root=a;a.setImmediate&&"function"===typeof a.setImmediate?(this.setImmediate=a.setImmediate.bind(a),this.clearImmediate=a.clearImmediate.bind(a)):(this.nextHandle=1,this.tasksByHandle={},this.currentlyRunningATask=!1,this.canUseProcessNextTick()?this.setImmediate=this.createProcessNextTickSetImmediate():this.canUsePostMessage()?this.setImmediate=this.createPostMessageSetImmediate():this.canUseMessageChannel()?this.setImmediate=this.createMessageChannelSetImmediate():this.canUseReadyStateChange()?this.setImmediate=this.createReadyStateChangeSetImmediate():this.setImmediate=this.createSetTimeoutSetImmediate(),a=function e(a){delete e.instance.tasksByHandle[a]},a.instance=this,this.clearImmediate=a)}b.prototype.identify=function(a){return this.root.Object.prototype.toString.call(a)};b.prototype.canUseProcessNextTick=function(){return"[object process]"===this.identify(this.root.process)};b.prototype.canUseMessageChannel=function(){return!!this.root.MessageChannel};b.prototype.canUseReadyStateChange=function(){var a=this.root.document;return!!(a&&"onreadystatechange"in a.createElement("script"))};b.prototype.canUsePostMessage=function(){var a=this.root;if(a.postMessage&&!a.importScripts){var b=!0,e=a.onmessage;a.onmessage=function(){b=!1};a.postMessage("","*");a.onmessage=e;return b}return!1};b.prototype.partiallyApplied=function(a){for(var b=[],e=1;e<arguments.length;e++)b[e-1]=arguments[e];e=function f(){var a=f.handler,b=f.args;"function"===typeof a?a.apply(void 0,b):new Function(""+a)()};e.handler=a;e.args=b;return e};b.prototype.addFromSetImmediateArguments=function(a){this.tasksByHandle[this.nextHandle]=this.partiallyApplied.apply(void 0,a);return this.nextHandle++};b.prototype.createProcessNextTickSetImmediate=function(){var a=function e(){var a=e.instance,b=a.addFromSetImmediateArguments(arguments);a.root.process.nextTick(a.partiallyApplied(a.runIfPresent,b));return b};a.instance=this;return a};b.prototype.createPostMessageSetImmediate=function(){var a=this.root,b="setImmediate$"+a.Math.random()+"$",e=function f(c){var e=f.instance;c.source===a&&"string"===typeof c.data&&0===c.data.indexOf(b)&&e.runIfPresent(+c.data.slice(b.length))};e.instance=this;a.addEventListener("message",e,!1);e=function h(){var a=h,b=a.messagePrefix,a=a.instance,c=a.addFromSetImmediateArguments(arguments);a.root.postMessage(b+c,"*");return c};e.instance=this;e.messagePrefix=b;return e};b.prototype.runIfPresent=function(a){if(this.currentlyRunningATask)this.root.setTimeout(this.partiallyApplied(this.runIfPresent,a),0);else{var b=this.tasksByHandle[a];if(b){this.currentlyRunningATask=!0;try{b()}finally{this.clearImmediate(a),this.currentlyRunningATask=!1}}}};b.prototype.createMessageChannelSetImmediate=function(){var a=this,b=new this.root.MessageChannel;b.port1.onmessage=function(b){a.runIfPresent(b.data)};var e=function f(){var a=f,b=a.channel,a=a.instance.addFromSetImmediateArguments(arguments);b.port2.postMessage(a);return a};e.channel=b;e.instance=this;return e};b.prototype.createReadyStateChangeSetImmediate=function(){var a=function e(){var a=e.instance,b=a.root.document,h=b.documentElement,g=a.addFromSetImmediateArguments(arguments),k=b.createElement("script");k.onreadystatechange=function(){a.runIfPresent(g);k.onreadystatechange=null;h.removeChild(k);k=null};h.appendChild(k);return g};a.instance=this;return a};b.prototype.createSetTimeoutSetImmediate=function(){var a=function e(){var a=e.instance,b=a.addFromSetImmediateArguments(arguments);a.root.setTimeout(a.partiallyApplied(a.runIfPresent,b),0);return b};a.instance=this;return a};return b}())(p),Yg=function(b){function a(a,e){b.call(this,a,e);this.scheduler=a;this.work=e}k(a,b);a.prototype.requestAsyncId=function(a,e,d){void 0===d&&(d=0);if(null!==d&&0<d)return b.prototype.requestAsyncId.call(this,a,e,d);a.actions.push(this);return a.scheduled||(a.scheduled=ad.setImmediate(a.flush.bind(a,null)))};a.prototype.recycleAsyncId=function(a,e,d){void 0===d&&(d=0);if(null!==d&&0<d||null===d&&0<this.delay)return b.prototype.recycleAsyncId.call(this,a,e,d);0===a.actions.length&&(ad.clearImmediate(e),a.scheduled=void 0)};return a}(X),ka=new(function(b){function a(){b.apply(this,arguments)}k(a,b);a.prototype.flush=function(a){this.active=!0;this.scheduled=void 0;var b=this.actions,c,f=-1,h=b.length;a=a||b.shift();do{if(c=a.execute(a.state,a.delay))break}while(++f<h&&(a=b.shift()));this.active=!1;if(c){for(;++f<h&&(a=b.shift());)a.unsubscribe();throw c}};return a}(Y))(Yg),Zg=function(b){function a(a,e,d){void 0===e&&(e=0);void 0===d&&(d=ka);b.call(this);this.source=a;this.delayTime=e;this.scheduler=d;if(!K(e)||0>e)this.delayTime=0;d&&"function"===typeof d.schedule||(this.scheduler=ka)}k(a,b);a.create=function(b,e,d){void 0===e&&(e=0);void 0===d&&(d=ka);return new a(b,e,d)};a.dispatch=function(a){return this.add(a.source.subscribe(a.subscriber))};a.prototype._subscribe=function(b){return this.scheduler.schedule(a.dispatch,this.delayTime,{source:this.source,subscriber:b})};return a}(g),He=function(){function b(a,b){this.scheduler=a;this.delay=b}b.prototype.call=function(a,b){return new Zg(b,this.delay,this.scheduler).subscribe(a)};return b}();g.prototype.subscribeOn=function(b,a){void 0===a&&(a=0);return Ge(b,a)(this)};var Ie=function(){function b(a,b){this.project=a;this.resultSelector=b}b.prototype.call=function(a,b){return b.subscribe(new $g(a,this.project,this.resultSelector))};return b}(),$g=function(b){function a(a,e,d){b.call(this,a);this.project=e;this.resultSelector=d;this.index=0}k(a,b);a.prototype._next=function(a){var b,c=this.index++;try{b=this.project(a,c)}catch(f){this.destination.error(f);return}this._innerSub(b,a,c)};a.prototype._innerSub=function(a,b,d){var c=this.innerSubscription;c&&c.unsubscribe();this.add(this.innerSubscription=r(this,a,b,d))};a.prototype._complete=function(){var a=this.innerSubscription;a&&!a.closed||b.prototype._complete.call(this)};a.prototype._unsubscribe=function(){this.innerSubscription=null};a.prototype.notifyComplete=function(a){this.remove(a);this.innerSubscription=null;this.isStopped&&b.prototype._complete.call(this)};a.prototype.notifyNext=function(a,b,d,f,h){this.resultSelector?this._tryNotifyNext(a,b,d,f):this.destination.next(b)};a.prototype._tryNotifyNext=function(a,b,d,f){var c;try{c=this.resultSelector(a,b,d,f)}catch(z){this.destination.error(z);return}this.destination.next(c)};return a}(t);g.prototype.switch=qc;g.prototype._switch=qc;g.prototype.switchMap=function(b,a){return va(b,a)(this)};var Je=function(){function b(a,b){this.observable=a;this.resultSelector=b}b.prototype.call=function(a,b){return b.subscribe(new ah(a,this.observable,this.resultSelector))};return b}(),ah=function(b){function a(a,e,d){b.call(this,a);this.inner=e;this.resultSelector=d;this.index=0}k(a,b);a.prototype._next=function(a){var b=this.innerSubscription;b&&b.unsubscribe();this.add(this.innerSubscription=r(this,this.inner,a,this.index++))};a.prototype._complete=function(){var a=this.innerSubscription;a&&!a.closed||b.prototype._complete.call(this)};a.prototype._unsubscribe=function(){this.innerSubscription=null};a.prototype.notifyComplete=function(a){this.remove(a);this.innerSubscription=null;this.isStopped&&b.prototype._complete.call(this)};a.prototype.notifyNext=function(a,b,d,f,h){h=this.destination;this.resultSelector?this.tryResultSelector(a,b,d,f):h.next(b)};a.prototype.tryResultSelector=function(a,b,d,f){var c=this.resultSelector,e=this.destination,g;try{g=c(a,b,d,f)}catch(N){e.error(N);return}e.next(g)};return a}(t);g.prototype.switchMapTo=function(b,a){return rc(b,a)(this)};var Ke=function(){function b(a){this.total=a;if(0>this.total)throw new R}b.prototype.call=function(a,b){return b.subscribe(new bh(a,this.total))};return b}(),bh=function(b){function a(a,e){b.call(this,a);this.total=e;this.count=0}k(a,b);a.prototype._next=function(a){var b=this.total,c=++this.count;c<=b&&(this.destination.next(a),c===b&&(this.destination.complete(),this.unsubscribe()))};return a}(m);g.prototype.take=function(b){return sc(b)(this)};g.prototype.takeLast=function(b){return ea(b)(this)};var Le=function(){function b(a){this.notifier=a}b.prototype.call=function(a,b){return b.subscribe(new ch(a,this.notifier))};return b}(),ch=function(b){function a(a,e){b.call(this,a);this.notifier=e;this.add(r(this,e))}k(a,b);a.prototype.notifyNext=function(a,b,d,f,h){this.complete()};a.prototype.notifyComplete=function(){};return a}(t);g.prototype.takeUntil=function(b){return tc(b)(this)};var Me=function(){function b(a){this.predicate=a}b.prototype.call=function(a,b){return b.subscribe(new dh(a,this.predicate))};return b}(),dh=function(b){function a(a,e){b.call(this,a);this.predicate=e;this.index=0}k(a,b);a.prototype._next=function(a){var b=this.destination,c;try{c=this.predicate(a,this.index++)}catch(f){b.error(f);return}this.nextOrComplete(a,c)};a.prototype.nextOrComplete=function(a,b){var c=this.destination;b?c.next(a):c.complete()};return a}(m);g.prototype.takeWhile=function(b){return uc(b)(this)};var fa={leading:!0,trailing:!1},Ne=function(){function b(a,b,e){this.durationSelector=a;this.leading=b;this.trailing=e}b.prototype.call=function(a,b){return b.subscribe(new eh(a,this.durationSelector,this.leading,this.trailing))};return b}(),eh=function(b){function a(a,e,d,f){b.call(this,a);this.destination=a;this.durationSelector=e;this._leading=d;this._trailing=f;this._hasTrailingValue=!1}k(a,b);a.prototype._next=function(a){if(this.throttled)this._trailing&&(this._hasTrailingValue=!0,this._trailingValue=a);else{var b=this.tryDurationSelector(a);b&&this.add(this.throttled=r(this,b));this._leading&&(this.destination.next(a),this._trailing&&(this._hasTrailingValue=!0,this._trailingValue=a))}};a.prototype.tryDurationSelector=function(a){try{return this.durationSelector(a)}catch(e){return this.destination.error(e),null}};a.prototype._unsubscribe=function(){var a=this.throttled;this._trailingValue=null;this._hasTrailingValue=!1;a&&(this.remove(a),this.throttled=null,a.unsubscribe())};a.prototype._sendTrailing=function(){var a=this.destination,b=this._trailing,d=this._trailingValue,f=this._hasTrailingValue;this.throttled&&b&&f&&(a.next(d),this._trailingValue=null,this._hasTrailingValue=!1)};a.prototype.notifyNext=function(a,b,d,f,h){this._sendTrailing();this._unsubscribe()};a.prototype.notifyComplete=function(){this._sendTrailing();this._unsubscribe()};return a}(t);g.prototype.throttle=function(b,a){void 0===a&&(a=fa);return vc(b,a)(this)};var Oe=function(){function b(a,b,e,d){this.duration=a;this.scheduler=b;this.leading=e;this.trailing=d}b.prototype.call=function(a,b){return b.subscribe(new fh(a,this.duration,this.scheduler,this.leading,this.trailing))};return b}(),fh=function(b){function a(a,e,d,f,h){b.call(this,a);this.duration=e;this.scheduler=d;this.leading=f;this.trailing=h;this._hasTrailingValue=!1;this._trailingValue=null}k(a,b);a.prototype._next=function(a){this.throttled?this.trailing&&(this._trailingValue=a,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(Pe,this.duration,{subscriber:this})),this.leading&&this.destination.next(a))};a.prototype.clearThrottle=function(){var a=this.throttled;a&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),a.unsubscribe(),this.remove(a),this.throttled=null)};return a}(m);g.prototype.throttleTime=function(b,a,c){void 0===a&&(a=u);void 0===c&&(c=fa);return wc(b,a,c)(this)};var bd=function(){return function(b,a){this.value=b;this.interval=a}}(),Qe=function(){function b(a){this.scheduler=a}b.prototype.call=function(a,b){return b.subscribe(new gh(a,this.scheduler))};return b}(),gh=function(b){function a(a,e){b.call(this,a);this.scheduler=e;this.lastTime=0;this.lastTime=e.now()}k(a,b);a.prototype._next=function(a){var b=this.scheduler.now(),c=b-this.lastTime;this.lastTime=b;this.destination.next(new bd(a,c))};return a}(m);g.prototype.timeInterval=function(b){void 0===b&&(b=u);return xc(b)(this)};var zc=function(b){function a(){var a=b.call(this,"Timeout has occurred");this.name=a.name="TimeoutError";this.stack=a.stack;this.message=a.message}k(a,b);return a}(Error),Re=function(){function b(a,b,e,d){this.waitFor=a;this.absoluteTimeout=b;this.scheduler=e;this.errorInstance=d}b.prototype.call=function(a,b){return b.subscribe(new hh(a,this.absoluteTimeout,this.waitFor,this.scheduler,this.errorInstance))};return b}(),hh=function(b){function a(a,e,d,f,h){b.call(this,a);this.absoluteTimeout=e;this.waitFor=d;this.scheduler=f;this.errorInstance=h;this.action=null;this.scheduleTimeout()}k(a,b);a.dispatchTimeout=function(a){a.error(a.errorInstance)};a.prototype.scheduleTimeout=function(){var b=this.action;b?this.action=b.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(a.dispatchTimeout,this.waitFor,this))};a.prototype._next=function(a){this.absoluteTimeout||this.scheduleTimeout();b.prototype._next.call(this,a)};a.prototype._unsubscribe=function(){this.errorInstance=this.scheduler=this.action=null};return a}(m);g.prototype.timeout=function(b,a){void 0===a&&(a=u);return yc(b,a)(this)};var Se=function(){function b(a,b,e,d){this.waitFor=a;this.absoluteTimeout=b;this.withObservable=e;this.scheduler=d}b.prototype.call=function(a,b){return b.subscribe(new ih(a,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))};return b}(),ih=function(b){function a(a,e,d,f,h){b.call(this,a);this.absoluteTimeout=e;this.waitFor=d;this.withObservable=f;this.scheduler=h;this.action=null;this.scheduleTimeout()}k(a,b);a.dispatchTimeout=function(a){var b=a.withObservable;a._unsubscribeAndRecycle();a.add(r(a,b))};a.prototype.scheduleTimeout=function(){var b=this.action;b?this.action=b.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(a.dispatchTimeout,this.waitFor,this))};a.prototype._next=function(a){this.absoluteTimeout||this.scheduleTimeout();b.prototype._next.call(this,a)};a.prototype._unsubscribe=function(){this.withObservable=this.scheduler=this.action=null};return a}(t);g.prototype.timeoutWith=function(b,a,c){void 0===c&&(c=u);return Ac(b,a,c)(this)};var Cc=function(){return function(b,a){this.value=b;this.timestamp=a}}();g.prototype.timestamp=function(b){void 0===b&&(b=u);return Bc(b)(this)};g.prototype.toArray=function(){return Dc()(this)};var Ue=function(){function b(a){this.windowBoundaries=a}b.prototype.call=function(a,b){a=new jh(a);b=b.subscribe(a);b.closed||a.add(r(a,this.windowBoundaries));return b};return b}(),jh=function(b){function a(a){b.call(this,a);this.window=new w;a.next(this.window)}k(a,b);a.prototype.notifyNext=function(a,b,d,f,h){this.openWindow()};a.prototype.notifyError=function(a,b){this._error(a)};a.prototype.notifyComplete=function(a){this._complete()};a.prototype._next=function(a){this.window.next(a)};a.prototype._error=function(a){this.window.error(a);this.destination.error(a)};a.prototype._complete=function(){this.window.complete();this.destination.complete()};a.prototype._unsubscribe=function(){this.window=null};a.prototype.openWindow=function(){var a=this.window;a&&a.complete();var a=this.destination,b=this.window=new w;a.next(b)};return a}(t);g.prototype.window=function(b){return Ec(b)(this)};var Ve=function(){function b(a,b){this.windowSize=a;this.startWindowEvery=b}b.prototype.call=function(a,b){return b.subscribe(new kh(a,this.windowSize,this.startWindowEvery))};return b}(),kh=function(b){function a(a,e,d){b.call(this,a);this.destination=a;this.windowSize=e;this.startWindowEvery=d;this.windows=[new w];this.count=0;a.next(this.windows[0])}k(a,b);a.prototype._next=function(a){for(var b=0<this.startWindowEvery?this.startWindowEvery:this.windowSize,c=this.destination,f=this.windowSize,h=this.windows,g=h.length,k=0;k<g&&!this.closed;k++)h[k].next(a);a=this.count-f+1;0<=a&&0===a%b&&!this.closed&&h.shift().complete();0!==++this.count%b||this.closed||(b=new w,h.push(b),c.next(b))};a.prototype._error=function(a){var b=this.windows;if(b)for(;0<b.length&&!this.closed;)b.shift().error(a);this.destination.error(a)};a.prototype._complete=function(){var a=this.windows;if(a)for(;0<a.length&&!this.closed;)a.shift().complete();this.destination.complete()};a.prototype._unsubscribe=function(){this.count=0;this.windows=null};return a}(m);g.prototype.windowCount=function(b,a){void 0===a&&(a=0);return Fc(b,a)(this)};var We=function(){function b(a,b,e,d){this.windowTimeSpan=a;this.windowCreationInterval=b;this.maxWindowSize=e;this.scheduler=d}b.prototype.call=function(a,b){return b.subscribe(new lh(a,this.windowTimeSpan,this.windowCreationInterval,this.maxWindowSize,this.scheduler))};return b}(),mh=function(b){function a(){b.apply(this,arguments);this._numberOfNextedValues=0}k(a,b);a.prototype.next=function(a){this._numberOfNextedValues++;b.prototype.next.call(this,a)};Object.defineProperty(a.prototype,"numberOfNextedValues",{get:function(){return this._numberOfNextedValues},enumerable:!0,configurable:!0});return a}(w),lh=function(b){function a(a,e,d,f,h){b.call(this,a);this.destination=a;this.windowTimeSpan=e;this.windowCreationInterval=d;this.maxWindowSize=f;this.scheduler=h;this.windows=[];a=this.openWindow();null!==d&&0<=d?(f={windowTimeSpan:e,windowCreationInterval:d,subscriber:this,scheduler:h},this.add(h.schedule(Hc,e,{subscriber:this,window:a,context:null})),this.add(h.schedule(Ye,d,f))):this.add(h.schedule(Xe,e,{subscriber:this,window:a,windowTimeSpan:e}))}k(a,b);a.prototype._next=function(a){for(var b=this.windows,c=b.length,f=0;f<c;f++){var h=b[f];h.closed||(h.next(a),h.numberOfNextedValues>=this.maxWindowSize&&this.closeWindow(h))}};a.prototype._error=function(a){for(var b=this.windows;0<b.length;)b.shift().error(a);this.destination.error(a)};a.prototype._complete=function(){for(var a=this.windows;0<a.length;){var b=a.shift();b.closed||b.complete()}this.destination.complete()};a.prototype.openWindow=function(){var a=new mh;this.windows.push(a);this.destination.next(a);return a};a.prototype.closeWindow=function(a){a.complete();var b=this.windows;b.splice(b.indexOf(a),1)};return a}(m);g.prototype.windowTime=function(b,a,c,e){var d=u,f=null,h=Number.POSITIVE_INFINITY;A(e)&&(d=e);A(c)?d=c:K(c)&&(h=c);A(a)?d=a:K(a)&&(f=a);return Gc(b,f,h,d)(this)};var Ze=function(){function b(a,b){this.openings=a;this.closingSelector=b}b.prototype.call=function(a,b){return b.subscribe(new nh(a,this.openings,this.closingSelector))};return b}(),nh=function(b){function a(a,e,d){b.call(this,a);this.openings=e;this.closingSelector=d;this.contexts=[];this.add(this.openSubscription=r(this,e,e))}k(a,b);a.prototype._next=function(a){var b=this.contexts;if(b)for(var c=b.length,f=0;f<c;f++)b[f].window.next(a)};a.prototype._error=function(a){var c=this.contexts;this.contexts=null;if(c)for(var d=c.length,f=-1;++f<d;){var h=c[f];h.window.error(a);h.subscription.unsubscribe()}b.prototype._error.call(this,a)};a.prototype._complete=function(){var a=this.contexts;this.contexts=null;if(a)for(var e=a.length,d=-1;++d<e;){var f=a[d];f.window.complete();f.subscription.unsubscribe()}b.prototype._complete.call(this)};a.prototype._unsubscribe=function(){var a=this.contexts;this.contexts=null;if(a)for(var b=a.length,d=-1;++d<b;){var f=a[d];f.window.unsubscribe();f.subscription.unsubscribe()}};a.prototype.notifyNext=function(a,b,d,f,h){if(a===this.openings){f=q(this.closingSelector)(b);if(f===n)return this.error(n.e);a=new w;b=new v;d={window:a,subscription:b};this.contexts.push(d);f=r(this,f,d);f.closed?this.closeWindow(this.contexts.length-1):(f.context=d,b.add(f));this.destination.next(a)}else this.closeWindow(this.contexts.indexOf(a))};a.prototype.notifyError=function(a){this.error(a)};a.prototype.notifyComplete=function(a){a!==this.openSubscription&&this.closeWindow(this.contexts.indexOf(a.context))};a.prototype.closeWindow=function(a){if(-1!==a){var b=this.contexts,c=b[a],f=c.window,c=c.subscription;b.splice(a,1);f.complete();c.unsubscribe()}};return a}(t);g.prototype.windowToggle=function(b,a){return Ic(b,a)(this)};var $e=function(){function b(a){this.closingSelector=a}b.prototype.call=function(a,b){return b.subscribe(new oh(a,this.closingSelector))};return b}(),oh=function(b){function a(a,e){b.call(this,a);this.destination=a;this.closingSelector=e;this.openWindow()}k(a,b);a.prototype.notifyNext=function(a,b,d,f,h){this.openWindow(h)};a.prototype.notifyError=function(a,b){this._error(a)};a.prototype.notifyComplete=function(a){this.openWindow(a)};a.prototype._next=function(a){this.window.next(a)};a.prototype._error=function(a){this.window.error(a);this.destination.error(a);this.unsubscribeClosingNotification()};a.prototype._complete=function(){this.window.complete();this.destination.complete();this.unsubscribeClosingNotification()};a.prototype.unsubscribeClosingNotification=function(){this.closingNotification&&this.closingNotification.unsubscribe()};a.prototype.openWindow=function(a){void 0===a&&(a=null);a&&(this.remove(a),a.unsubscribe());(a=this.window)&&a.complete();a=this.window=new w;this.destination.next(a);a=q(this.closingSelector)();a===n?(a=n.e,this.destination.error(a),this.window.error(a)):this.add(this.closingNotification=r(this,a))};return a}(t);g.prototype.windowWhen=function(b){return Jc(b)(this)};var af=function(){function b(a,b){this.observables=a;this.project=b}b.prototype.call=function(a,b){return b.subscribe(new ph(a,this.observables,this.project))};return b}(),ph=function(b){function a(a,e,d){b.call(this,a);this.observables=e;this.project=d;this.toRespond=[];a=e.length;this.values=Array(a);for(d=0;d<a;d++)this.toRespond.push(d);for(d=0;d<a;d++){var c=e[d];this.add(r(this,c,c,d))}}k(a,b);a.prototype.notifyNext=function(a,b,d,f,h){this.values[d]=b;a=this.toRespond;0<a.length&&(d=a.indexOf(d),-1!==d&&a.splice(d,1))};a.prototype.notifyComplete=function(){};a.prototype._next=function(a){0===this.toRespond.length&&(a=[a].concat(this.values),this.project?this._tryProject(a):this.destination.next(a))};a.prototype._tryProject=function(a){var b;try{b=this.project.apply(this,a)}catch(d){this.destination.error(d);return}this.destination.next(b)};return a}(t);g.prototype.withLatestFrom=function(){for(var b=[],a=0;a<arguments.length;a++)b[a-0]=arguments[a];return Kc.apply(void 0,b)(this)};g.prototype.zip=function(){for(var b=[],a=0;a<arguments.length;a++)b[a-0]=arguments[a];return Qa.apply(void 0,b)(this)};g.prototype.zipAll=function(b){return Lc(b)(this)};var aa=function(){return function(b,a){void 0===a&&(a=Number.POSITIVE_INFINITY);this.subscribedFrame=b;this.unsubscribedFrame=a}}(),cd=function(){function b(){this.subscriptions=[]}b.prototype.logSubscribedFrame=function(){this.subscriptions.push(new aa(this.scheduler.now()));return this.subscriptions.length-1};b.prototype.logUnsubscribedFrame=function(a){var b=this.subscriptions;b[a]=new aa(b[a].subscribedFrame,this.scheduler.now())};return b}(),ya=function(b){function a(a,e){b.call(this,function(a){var b=this,c=b.logSubscribedFrame();a.add(new v(function(){b.logUnsubscribedFrame(c)}));b.scheduleMessages(a);return a});this.messages=a;this.subscriptions=[];this.scheduler=e}k(a,b);a.prototype.scheduleMessages=function(a){for(var b=this.messages.length,c=0;c<b;c++){var f=this.messages[c];a.add(this.scheduler.schedule(function(a){a.message.notification.observe(a.subscriber)},f.frame,{message:f,subscriber:a}))}};return a}(g);Mc(ya,[cd]);var dd=function(b){function a(a,e){b.call(this);this.messages=a;this.subscriptions=[];this.scheduler=e}k(a,b);a.prototype._subscribe=function(a){var c=this,d=c.logSubscribedFrame();a.add(new v(function(){c.logUnsubscribedFrame(d)}));return b.prototype._subscribe.call(this,a)};a.prototype.setup=function(){for(var a=this,b=a.messages.length,d=0;d<b;d++)(function(){var b=a.messages[d];a.scheduler.schedule(function(){b.notification.observe(a)},b.frame)})()};return a}(w);Mc(dd,[cd]);var fd=function(b){function a(a,e){var c=this;void 0===a&&(a=ed);void 0===e&&(e=Number.POSITIVE_INFINITY);b.call(this,a,function(){return c.frame});this.maxFrames=e;this.frame=0;this.index=-1}k(a,b);a.prototype.flush=function(){for(var a=this.actions,b=this.maxFrames,d,f;(f=a.shift())&&(this.frame=f.delay)<=b&&!(d=f.execute(f.state,f.delay)););if(d){for(;f=a.shift();)f.unsubscribe();throw d}};a.frameTimeFactor=10;return a}(Y),ed=function(b){function a(a,e,d){void 0===d&&(d=a.index+=1);b.call(this,a,e);this.scheduler=a;this.work=e;this.index=d;this.active=!0;this.index=a.index=d}k(a,b);a.prototype.schedule=function(c,e){void 0===e&&(e=0);if(!this.id)return b.prototype.schedule.call(this,c,e);this.active=!1;var d=new a(this.scheduler,this.work);this.add(d);return d.schedule(c,e)};a.prototype.requestAsyncId=function(b,e,d){void 0===d&&(d=0);this.delay=b.frame+d;b=b.actions;b.push(this);b.sort(a.sortActions);return!0};a.prototype.recycleAsyncId=function(a,b,d){};a.prototype._execute=function(a,e){if(!0===this.active)return b.prototype._execute.call(this,a,e)};a.sortActions=function(a,b){return a.delay===b.delay?a.index===b.index?0:a.index>b.index?1:-1:a.delay>b.delay?1:-1};return a}(X),qh=function(b){function a(a){b.call(this,ed,750);this.assertDeepEqual=a;this.hotObservables=[];this.coldObservables=[];this.flushTests=[]}k(a,b);a.prototype.createTime=function(b){b=b.indexOf("|");if(-1===b)throw Error('marble diagram for time should have a completion marker "|"');return b*a.frameTimeFactor};a.prototype.createColdObservable=function(b,e,d){if(-1!==b.indexOf("^"))throw Error('cold observable cannot have subscription offset "^"');if(-1!==b.indexOf("!"))throw Error('cold observable cannot have unsubscription marker "!"');b=a.parseMarbles(b,e,d);b=new ya(b,this);this.coldObservables.push(b);return b};a.prototype.createHotObservable=function(b,e,d){if(-1!==b.indexOf("!"))throw Error('hot observable cannot have unsubscription marker "!"');b=a.parseMarbles(b,e,d);b=new dd(b,this);this.hotObservables.push(b);return b};a.prototype.materializeInnerObservable=function(a,b){var c=this,e=[];a.subscribe(function(a){e.push({frame:c.frame-b,notification:y.createNext(a)})},function(a){e.push({frame:c.frame-b,notification:y.createError(a)})},function(){e.push({frame:c.frame-b,notification:y.createComplete()})});return e};a.prototype.expectObservable=function(b,e){var c=this;void 0===e&&(e=null);var f=[],h={actual:f,ready:!1};e=a.parseMarblesAsSubscriptions(e).unsubscribedFrame;var k;this.schedule(function(){k=b.subscribe(function(a){var b=a;a instanceof g&&(b=c.materializeInnerObservable(b,c.frame));f.push({frame:c.frame,notification:y.createNext(b)})},function(a){f.push({frame:c.frame,notification:y.createError(a)})},function(){f.push({frame:c.frame,notification:y.createComplete()})})},0);e!==Number.POSITIVE_INFINITY&&this.schedule(function(){return k.unsubscribe()},e);this.flushTests.push(h);return{toBe:function(b,c,d){h.ready=!0;h.expected=a.parseMarbles(b,c,d,!0)}}};a.prototype.expectSubscriptions=function(b){var c={actual:b,ready:!1};this.flushTests.push(c);return{toBe:function(b){b="string"===typeof b?[b]:b;c.ready=!0;c.expected=b.map(function(b){return a.parseMarblesAsSubscriptions(b)})}}};a.prototype.flush=function(){for(var a=this.hotObservables;0<a.length;)a.shift().setup();b.prototype.flush.call(this);for(a=this.flushTests.filter(function(a){return a.ready});0<a.length;){var e=a.shift();this.assertDeepEqual(e.actual,e.expected)}};a.parseMarblesAsSubscriptions=function(a){if("string"!==typeof a)return new aa(Number.POSITIVE_INFINITY);for(var b=a.length,c=-1,f=Number.POSITIVE_INFINITY,g=Number.POSITIVE_INFINITY,k=0;k<b;k++){var l=k*this.frameTimeFactor,m=a[k];switch(m){case"-":case" ":break;case"(":c=l;break;case")":c=-1;break;case"^":if(f!==Number.POSITIVE_INFINITY)throw Error("found a second subscription point '^' in a subscription marble diagram. There can only be one.");f=-1<c?c:l;break;case"!":if(g!==Number.POSITIVE_INFINITY)throw Error("found a second subscription point '^' in a subscription marble diagram. There can only be one.");g=-1<c?c:l;break;default:throw Error("there can only be '^' and '!' markers in a subscription marble diagram. Found instead '"+m+"'.")}}return 0>g?new aa(f):new aa(f,g)};a.parseMarbles=function(a,b,d,f){void 0===f&&(f=!1);if(-1!==a.indexOf("!"))throw Error('conventional marble diagrams cannot have the unsubscription marker "!"');for(var c=a.length,e=[],g=a.indexOf("^"),g=-1===g?0:g*-this.frameTimeFactor,k="object"!==typeof b?function(a){return a}:function(a){return f&&b[a]instanceof ya?b[a].messages:b[a]},l=-1,m=0;m<c;m++){var n=m*this.frameTimeFactor+g,p=void 0,q=a[m];switch(q){case"-":case" ":break;case"(":l=n;break;case")":l=-1;break;case"|":p=y.createComplete();break;case"^":break;case"#":p=y.createError(d||"error");break;default:p=y.createNext(k(q))}p&&e.push({frame:-1<l?l:n,notification:p})}return e};return a}(fd),gd=new(function(){return function(b){b.requestAnimationFrame?(this.cancelAnimationFrame=b.cancelAnimationFrame.bind(b),this.requestAnimationFrame=b.requestAnimationFrame.bind(b)):b.mozRequestAnimationFrame?(this.cancelAnimationFrame=b.mozCancelAnimationFrame.bind(b),this.requestAnimationFrame=b.mozRequestAnimationFrame.bind(b)):b.webkitRequestAnimationFrame?(this.cancelAnimationFrame=b.webkitCancelAnimationFrame.bind(b),this.requestAnimationFrame=b.webkitRequestAnimationFrame.bind(b)):b.msRequestAnimationFrame?(this.cancelAnimationFrame=b.msCancelAnimationFrame.bind(b),this.requestAnimationFrame=b.msRequestAnimationFrame.bind(b)):b.oRequestAnimationFrame?(this.cancelAnimationFrame=b.oCancelAnimationFrame.bind(b),this.requestAnimationFrame=b.oRequestAnimationFrame.bind(b)):(this.cancelAnimationFrame=b.clearTimeout.bind(b),this.requestAnimationFrame=function(a){return b.setTimeout(a,1e3/60)})}}())(p),rh=function(b){function a(a,e){b.call(this,a,e);this.scheduler=a;this.work=e}k(a,b);a.prototype.requestAsyncId=function(a,e,d){void 0===d&&(d=0);if(null!==d&&0<d)return b.prototype.requestAsyncId.call(this,a,e,d);a.actions.push(this);return a.scheduled||(a.scheduled=gd.requestAnimationFrame(a.flush.bind(a,null)))};a.prototype.recycleAsyncId=function(a,e,d){void 0===d&&(d=0);if(null!==d&&0<d||null===d&&0<this.delay)return b.prototype.recycleAsyncId.call(this,a,e,d);0===a.actions.length&&(gd.cancelAnimationFrame(e),a.scheduled=void 0)};return a}(X),sh=new(function(b){function a(){b.apply(this,arguments)}k(a,b);a.prototype.flush=function(a){this.active=!0;this.scheduled=void 0;var b=this.actions,c,f=-1,g=b.length;a=a||b.shift();do{if(c=a.execute(a.state,a.delay))break}while(++f<g&&(a=b.shift()));this.active=!1;if(c){for(;++f<g&&(a=b.shift());)a.unsubscribe();throw c}};return a}(Y))(rh),th=Object.freeze({audit:sa,auditTime:Db,buffer:Ua,bufferCount:Va,bufferTime:Wa,bufferToggle:Za,bufferWhen:$a,catchError:ab,combineAll:cb,combineLatest:Ga,concat:db,concatAll:oa,concatMap:pa,concatMapTo:eb,count:fb,debounce:hb,debounceTime:ib,defaultIfEmpty:qa,delay:jb,delayWhen:kb,dematerialize:gb,distinct:mb,distinctUntilChanged:ra,distinctUntilKeyChanged:nb,elementAt:tb,every:Hb,exhaust:qb,exhaustMap:rb,expand:sb,filter:da,finalize:ub,find:wb,findIndex:yb,first:zb,groupBy:Ab,ignoreElements:Bb,isEmpty:Cb,last:Fb,map:V,mapTo:Ib,materialize:Jb,max:Kb,merge:Lb,mergeAll:ba,mergeMap:T,flatMap:T,mergeMapTo:Nb,mergeScan:Pb,min:Qb,multicast:H,observeOn:Ia,onErrorResumeNext:Oa,pairwise:Rb,partition:Sb,pluck:Tb,publish:Ub,publishBehavior:Vb,publishLast:Yb,publishReplay:Xb,race:Zb,reduce:Q,repeat:$b,repeatWhen:bc,retry:cc,retryWhen:dc,refCount:ta,sample:ec,sampleTime:fc,scan:W,sequenceEqual:gc,share:hc,shareReplay:ic,single:jc,skip:kc,skipLast:lc,skipUntil:mc,skipWhile:nc,startWith:oc,switchAll:pc,switchMap:va,switchMapTo:rc,take:sc,takeLast:ea,takeUntil:tc,takeWhile:uc,tap:ob,throttle:vc,throttleTime:wc,timeInterval:xc,timeout:yc,timeoutWith:Ac,timestamp:Bc,toArray:Dc,window:Ec,windowCount:Fc,windowTime:Gc,windowToggle:Ic,windowWhen:Jc,withLatestFrom:Kc,zip:Qa,zipAll:Lc}),uh={asap:ka,queue:Yc,animationFrame:sh,async:u},vh={rxSubscriber:O,observable:J,iterator:C};l.operators=th;l.Scheduler=uh;l.Symbol=vh;l.Subject=w;l.AnonymousSubject=ha;l.Observable=g;l.Subscription=v;l.Subscriber=m;l.AsyncSubject=P;l.ReplaySubject=M;l.BehaviorSubject=Wb;l.ConnectableObservable=$c;l.Notification=y;l.EmptyError=ja;l.ArgumentOutOfRangeError=R;l.ObjectUnsubscribedError=I;l.TimeoutError=zc;l.UnsubscriptionError=S;l.TimeInterval=bd;l.Timestamp=Cc;l.TestScheduler=qh;l.VirtualTimeScheduler=fd;l.AjaxResponse=Wc;l.AjaxError=ia;l.AjaxTimeoutError=Xc;l.pipe=la;Object.defineProperty(l,"__esModule",{value:!0})});(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==="object"&&typeof module==="object")module.exports=factory(require("rx"));else if(typeof define==="function"&&define.amd)define("bw-fe-helpers/autoCompleteHelper",["rx"],factory);else{var a=typeof exports==="object"?factory(require("rx")):factory(root["rx"]);for(var i in a)(typeof exports==="object"?exports:root)[i]=a[i]}})(this,function(__WEBPACK_EXTERNAL_MODULE__8__){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=14)}({14:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var rxjs__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(8);var rxjs__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(rxjs__WEBPACK_IMPORTED_MODULE_0__);var DEFAULT_DEBOUNCE_TIME=300;function keyupObserver(keyUp$){var debounceTime=arguments.length>1&&arguments[1]!==undefined?arguments[1]:DEFAULT_DEBOUNCE_TIME;var scheduler=arguments.length>2?arguments[2]:undefined;scheduler=scheduler||rxjs__WEBPACK_IMPORTED_MODULE_0__["Scheduler"].asap;return keyUp$.map(function(e){return e.target.value}).filter(function(text){return text.length>2}).debounceTime(debounceTime,scheduler).distinctUntilChanged()}function keyupObserverWithFetch(keyUp$,fetchFn,scheduler){scheduler=scheduler||rxjs__WEBPACK_IMPORTED_MODULE_0__["Scheduler"].asap;return keyupObserver(keyUp$,scheduler).switchMap(function(text){return rxjs__WEBPACK_IMPORTED_MODULE_0__["Observable"].fromPromise(fetchFn(text),scheduler)})}__webpack_exports__["default"]={keyupObserver:keyupObserver,keyupObserverWithFetch:keyupObserverWithFetch}},8:function(module,exports){module.exports=__WEBPACK_EXTERNAL_MODULE__8__}})["default"]});define("mustache!src/querywizard/templates/elements/locationSelectView",["lib/mustache"],function(mustache){var escapedTemplate='<span class="biggertext hugeline db singlepadding-bottom">Track conversations from</span>\n<div class="singlemargin-left singlemargin-bottom">\n<input class="js-everywhere" id="everywhere" type="radio" name="location"><label class="smallmargin-left" for="everywhere">Everywhere</label>\n</div>\n<div class="singlemargin-left qw-radio-select-container">\n<input class="js-specific-locations" id="specific-locations" type="radio" name="location">\n<div class="qw-radio-select-container__label smallmargin-left">\n<label for="specific-locations">Specific locations</label><a\nclass="help icon-bwhelp tinymargin-left" data-key="location-agnostic-query"></a>\n<div class="js-locations-container">\n<div class="js-location"></div>\n</div>\n</div>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/querywizard/views/elements/LocationSelectView",["backbone","rx","src/keyCodes","bw-fe-helpers/autoCompleteHelper","src/querywizard/QueryWizardActions","src/querywizard/events/QueryWizardEventNames","src/querywizard/views/elements/SellecktView","mustache!src/querywizard/templates/elements/locationSelectView","text!src/querywizard/templates/elements/popup.template","text!src/querywizard/templates/elements/item.template","text!src/querywizard/templates/elements/selection.template"],function(Backbone,Rx,keyCodes,autoCompleteHelper,QueryWizardActions,QueryWizardEventNames,SellecktView,template,popupTemplate,itemTemplate,selectionTemplate){"use strict";var VIEW_SELECTORS={SELECTION:".js-location",SELECTION_CONTAINER:".js-locations-container",RADIO_EVERYWHERE:".js-everywhere",RADIO_SPECIFIC_LOCATIONS:".js-specific-locations"};function getLocationData(view){var locations;var selectedLocationData=view._locationSelection.selleckt.getSelection();locations=selectedLocationData.map(function(item){return{value:item.value,type:item.data.type}});return{locations:locations,selectedLocationData:selectedLocationData,locationsEdited:true}}function onPopupCreated(view,popup){var search;var $popupEl=popup.$popup;var $input=$popupEl.find("input");var $itemsList=$popupEl.find(".itemslist");$input.on("keydown",onKeydown.bind(null,view,$itemsList));search=autoCompleteHelper.keyupObserver(Rx.Observable.fromEvent($input,"keyup"));search.subscribe(function(searchTerm){view.trigger(QueryWizardEventNames.DISPATCH_ACTION,{type:QueryWizardActions.FETCH_LOCATIONS,payload:searchTerm})})}function onPopupClose(view){view.trigger(QueryWizardEventNames.STATE_CHANGE,{showLocationSelectPopup:false})}function selectionChanged(view){view.trigger(QueryWizardEventNames.STATE_CHANGE,getLocationData(view))}function onKeydown(view,$itemsList,e){if([keyCodes.UP,keyCodes.DOWN].indexOf(e.which)>-1){return}$itemsList.empty();view._locationSelection.selleckt.items=[];view.trigger(QueryWizardEventNames.STATE_CHANGE,{searchLocationData:undefined})}function softRenderLocationSelection(view,data){var selectedItems=[].concat(data.selectedLocationData||[]);var searchItems=[].concat(data.searchLocationData||[]);view._locationSelection.render({selectedItems:selectedItems,searchItems:searchItems});if(view._locationSelection.selleckt&&data.showLocationSelectPopup){view._locationSelection.selleckt._open()}}function softRender(view,data){var locationAgnostic;var $selectionContainer=view.$(VIEW_SELECTORS.SELECTION_CONTAINER);data=data||{};if(data.locationIsLoading){return}if(data.locationAgnostic!==undefined){locationAgnostic=data.locationAgnostic}else{locationAgnostic=data.locations&&!data.locations.length}if(locationAgnostic){$selectionContainer.addClass("hidden");view.$(VIEW_SELECTORS.RADIO_EVERYWHERE).prop("checked",true);return}$selectionContainer.removeClass("hidden");view.$(VIEW_SELECTORS.RADIO_SPECIFIC_LOCATIONS).prop("checked",true);softRenderLocationSelection(view,data)}var LocationSelectView=Backbone.View.extend({constructor:function LocationSelectView(){Backbone.View.apply(this,arguments)},events:{"click .js-everywhere":function onEverywhereClick(){this.trigger(QueryWizardEventNames.STATE_CHANGE,{locationAgnostic:true})},"click .js-specific-locations":function onSpecificLocationsClick(e){e.stopPropagation();this.trigger(QueryWizardEventNames.STATE_CHANGE,{locationAgnostic:false,showLocationSelectPopup:true})}},render:function render(data){data=data||{};this.$el.html(template());this._locationSelection=new SellecktView({name:"location",multiple:true,enableSearch:true,searchThreshold:-1,showEmptyList:true,placeholderText:"Add a Location",alternatePlaceholder:"Add another Location",popupTemplate:popupTemplate,itemTemplate:itemTemplate,selectionTemplate:selectionTemplate,selectionsClass:"selections",maxHeightPopupPositioning:true});this.$(VIEW_SELECTORS.SELECTION).html(this._locationSelection.el);this.listenTo(this._locationSelection,"onPopupCreated",onPopupCreated.bind(null,this));this.listenTo(this._locationSelection,"close",onPopupClose.bind(null,this));this.listenTo(this._locationSelection,"selectionChanged",selectionChanged.bind(null,this));softRender(this,data);this.render=softRender.bind(null,this)},remove:function remove(){if(this._locationSelection){this._locationSelection.remove();this._locationSelection=undefined}Backbone.View.prototype.remove.call(this)}});return LocationSelectView});define("mustache!src/querywizard/templates/elements/usecaseSelectionView",["lib/mustache"],function(mustache){var escapedTemplate='<label class="biggertext hugeline db singlepadding-bottom">What would you like to track?</label>\n<div class="singlepadding-left">\n{{#usecases}}\n<p class="singlemargin-bottom{{#id}} lightgrey{{/id}}">\n<label for="usecase-{{value}}">\n<input id="usecase-{{value}}" class="js-usecase smallmargin-right" name="usecase" type="radio" value="{{value}}" data-at="{{automation}}" {{#selected}}checked="checked"{{/selected}} {{#id}}disabled{{/id}}>{{name}}\n</label>\n<a class="help icon-bwhelp valigntop" data-key="querywizard-selection-{{value}}"></a>\n</p>\n{{/usecases}}\n{{#id}}\n<hr />\n<a class="js-edit-in-query-editor">Edit this Query manually</a>\n{{/id}}\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/querywizard/views/elements/UsecaseSelectionView",["backbone","underscore","src/querywizard/helpers/queryWizardConfirmHelper","mustache!src/querywizard/templates/elements/usecaseSelectionView"],function(Backbone,_,queryWizardConfirmHelper,template){"use strict";var USECASES=[{value:"brand",name:"A brand",automation:"query-wizard-select-brand-radio"},{value:"hashtag",name:"A campaign",automation:"query-wizard-select-hashtag-radio"}];function getTemplateData(data){return _.extend({usecases:USECASES.map(function(usecase){return{value:usecase.value,name:usecase.name,automation:usecase.automation,selected:usecase.value===data.usecase}})},data)}var UsecaseSelectionView=Backbone.View.extend({events:{"click .js-usecase":function clickJsUsecase(e){this.trigger(UsecaseSelectionView.SELECTION_CHANGE,{usecase:e.target.value,usecaseEdited:true})},"click .js-edit-in-query-editor":function clickJsEditInQueryEditor(){var view=this;queryWizardConfirmHelper.editInQueryEditor(function(result){if(!result){return}view.trigger(UsecaseSelectionView.EDIT_IN_QUERY_EDITOR,{linkType:"Usecase Selection"})})}},constructor:function UsecaseSelectionView(){Backbone.View.apply(this,arguments)},render:function render(data){data=data||{};this.$el.html(template(getTemplateData(data)))}});UsecaseSelectionView.EDIT_IN_QUERY_EDITOR="UsecaseSelectionView:edit-in-query-editor";UsecaseSelectionView.SELECTION_CHANGE="UsecaseSelectionView:selection-change";return UsecaseSelectionView});define("mustache!src/querywizard/templates/selectionStepView",["lib/mustache"],function(mustache){var escapedTemplate='<div class="js-usecase-selection-container"></div>\n<div class="js-language"></div>\n<div class="js-location"></div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/querywizard/views/SelectionStepView",["backbone","src/mixins/mixin","src/mixins/withRetrigger","src/querywizard/events/QueryWizardEventNames","src/querywizard/views/elements/LanguageSelectView","src/querywizard/views/elements/LocationSelectView","src/querywizard/views/elements/UsecaseSelectionView","mustache!src/querywizard/templates/selectionStepView"],function(Backbone,mixin,withRetrigger,QueryWizardEventNames,LanguageSelectView,LocationSelectView,UsecaseSelectionView,template){"use strict";var VIEW_SELECTORS={USECASE_CONTAINER:".js-usecase-selection-container",SELECT_LANGUAGE:".js-language",SELECT_LOCATION:".js-location"};function softRender(view,data){data=data||{};view.usecaseSelectView.render(data);if(data.usecase){view.languageSelectView.render(data);view.locationSelectView.render(data);if(data.usecaseChanged){view.languageSelectView.$el.removeClass("fadein");view.languageSelectView.el.offsetWidth;view.languageSelectView.$el.addClass("fadein");view.locationSelectView.$el.removeClass("fadein");view.locationSelectView.el.offsetWidth;view.locationSelectView.$el.addClass("fadein")}}}var SelectionStepView=Backbone.View.extend({constructor:function SelectionStepView(){Backbone.View.apply(this,arguments);this.languageSelectView=new LanguageSelectView;this.usecaseSelectView=new UsecaseSelectionView;this.locationSelectView=new LocationSelectView;this.retrigger(this.locationSelectView,QueryWizardEventNames.STATE_CHANGE);this.retrigger(this.locationSelectView,QueryWizardEventNames.DISPATCH_ACTION);this.retrigger(this.languageSelectView,QueryWizardEventNames.STATE_CHANGE);this.retrigger(this.languageSelectView,QueryWizardEventNames.DISPATCH_ACTION);this.retrigger(this.usecaseSelectView,UsecaseSelectionView.EDIT_IN_QUERY_EDITOR,QueryWizardEventNames.REQUEST_EDIT_WITHIN_QUERY_EDITOR);this.retrigger(this.usecaseSelectView,UsecaseSelectionView.SELECTION_CHANGE,QueryWizardEventNames.STATE_CHANGE);this.retrigger(this.usecaseSelectView,QueryWizardEventNames.DISPATCH_ACTION)},render:function render(data){this.$el.html(template(data));softRender(this,data);this.$(VIEW_SELECTORS.USECASE_CONTAINER).append(this.usecaseSelectView.$el);this.$(VIEW_SELECTORS.SELECT_LANGUAGE).append(this.languageSelectView.$el);this.$(VIEW_SELECTORS.SELECT_LOCATION).append(this.locationSelectView.$el);this.render=softRender.bind(null,this)},remove:function remove(){if(this.usecaseSelectView){this.usecaseSelectView.remove();this.usecaseSelectView=undefined}if(this.languageSelectView){this.languageSelectView.remove();this.languageSelectView=undefined}if(this.locationSelectView){this.locationSelectView.remove();this.locationSelectView=undefined}Backbone.View.prototype.remove.call(this)}});mixin(SelectionStepView,withRetrigger);return SelectionStepView});define("src/querywizard/helpers/hashtagHelper",[],function(){"use strict";var HASHTAG_PATTERN_ERROR="A hashtag can only contain letters and numbers. Please review your hashtag.";var HASHTAG_PATTERN=/^#?[^\s!@#$%^&*()`~=+./,[{\]\-};:?><]+$/;return{validateHashtag:function validateHashtag(hashtag){if(!HASHTAG_PATTERN.test(hashtag)){return HASHTAG_PATTERN_ERROR}}}});define("src/querywizard/helpers/queryWizardEventHelper",["jquery","underscore","src/querywizard/events/QueryWizardEventNames","src/keyCodes"],function($,_,QueryWizardEventNames,keyCodes){"use strict";function getValue($target){if($target.attr("type")==="checkbox"){return $target.is(":checked")}return $target.val().trim()}function dispatchChange(view,event,processValue,previewOptions){var $target=event instanceof $?event:$(event.target);var key=_.camelize($target.attr("name"));var value=getValue($target);var props={};if(event.which===keyCodes.TAB){return}if(!key){throw new Error('A "name" attribute is required in order to dispatch events for this field')}if(typeof processValue==="function"){value=processValue(value,key)}props[key]=value;props[key+"Edited"]=true;view.trigger(QueryWizardEventNames.STATE_CHANGE,props,previewOptions)}return{dispatchChange:dispatchChange}});define("src/querywizard/helpers/websiteHelper",["bw-fe-helpers/urlHelper","bw-fe-helpers/validationHelpers"],function(urlHelper,validationHelpers){"use strict";var DOMAIN_REGEXPR=/^(?=.{1,255}$)[0-9a-z](?:[0-9a-z-]{0,61}[0-9a-z])?(?:\.[a-z](?:[0-9a-z-]{0,61}[0-9a-z])?)+$/i;var PARTIAL_DOMAIN_REGEXPR=/^[0-9a-z][0-9a-z-]{0,61}[0-9a-z]$/i;var DOMAIN_PARTIAL_DOMAIN_ERROR_MESSAGE="Please enter a valid domain or a part of a domain";var DOMAIN_PARTIAL_DOMAIN_URL_ERROR_MESSAGE="Please enter a valid URL, domain or a part of a domain";var URL_ERROR_MESSAGE="Please enter a valid URL";function normalizeUrl(text){var withoutProtocolAndWwwSubdomain=urlHelper.removeProtocolAndWwwSubdomain(text);return urlHelper.trimTrailingSlash(withoutProtocolAndWwwSubdomain)}function isDomain(text){return DOMAIN_REGEXPR.test(normalizeUrl(text))}function isPartialDomain(text){return PARTIAL_DOMAIN_REGEXPR.test(normalizeUrl(text))}function validateUrl(url){if(validationHelpers.isUrl(url)){return}return URL_ERROR_MESSAGE}function validateDomainOrPartialDomain(text){if(isDomain(text)||isPartialDomain(text)){return}return DOMAIN_PARTIAL_DOMAIN_ERROR_MESSAGE}function validateDomainOrPartialDomainOrUrl(text){if(isDomain(text)||isPartialDomain(text)||validationHelpers.isUrl(text)){return}return DOMAIN_PARTIAL_DOMAIN_URL_ERROR_MESSAGE}return{isDomain:isDomain,isPartialDomain:isPartialDomain,validateDomainOrPartialDomain:validateDomainOrPartialDomain,validateUrl:validateUrl,validateDomainOrPartialDomainOrUrl:validateDomainOrPartialDomainOrUrl}});define("mustache!src/querywizard/templates/elements/recommendationsView",["lib/mustache"],function(mustache){var escapedTemplate='<div class="querywizard-recommendations tinymargin-top singlemargin-bottom">\nThese {{itemType}}s could also be interesting. Click to add them.{{#recommendations}} <a href="#" class="js-recommendation tinymargin-right" data-value="{{.}}">{{itemPrefix}}{{.}}</a> {{/recommendations}}\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/querywizard/views/elements/RecommendationsView",["jquery","backbone","src/querywizard/events/QueryWizardEventNames","src/querywizard/QueryWizardActions","mustache!src/querywizard/templates/elements/recommendationsView"],function($,Backbone,QueryWizardEventNames,QueryWizardActions,template){"use strict";var RecommendationsView=Backbone.View.extend({events:{"click .js-recommendation":"onClickRecommendation"},constructor:function RecommendationsView(options){if(!options||!options.name){throw new Error("must be instantiated with options.name")}this.name=options.name;this.itemPrefix=options&&options.itemPrefix||"";this.itemType=options&&options.itemType||"recommendation";Backbone.View.apply(this,arguments)},render:function render(recommendations){var recommendationsData=recommendations&&recommendations.data;var data={itemPrefix:this.itemPrefix,itemType:this.itemType,recommendations:recommendationsData?recommendationsData.slice(0,3):[]};if(!data.recommendations.length){this.$el.empty();return}this.$el.html(template(data))},onClickRecommendation:function onClickRecommendation(e){var value=$(e.currentTarget).data("value");this.trigger(QueryWizardEventNames.DISPATCH_ACTION,{type:QueryWizardActions.RECOMMENDATION_CLICKED,payload:{name:this.name,value:value,sources:["brandwatchRecommendationsAPI"]}})}});return RecommendationsView});define("src/querywizard/views/MultipleTextInputView",["underscore","backbone","src/mixins/mixin","src/mixins/withRetrigger","src/querywizard/QueryWizardActions","src/querywizard/events/QueryWizardEventNames","src/components/mentions/views/TagsInputView","src/models/TagCollection","src/querywizard/views/elements/RecommendationsView"],function(_,Backbone,mixin,withRetrigger,QueryWizardActions,QueryWizardEventNames,TagsInputView,TagCollection,RecommendationsView){"use strict";var AUTOCOMPLETE_DEBOUNCE_TIME=50;function formatEventData(view,tags){var data={};data[view.name]=tags;data[view.name+"Edited"]=true;return data}function getEventData(view,exclude){var tags=view.tagsInputView.getTags();tags=exclude?_.without(tags,exclude):tags;return formatEventData(view,tags)}function validateInput(inputValue){var err;['"',"\\"].some(function(character){if(inputValue.indexOf(character)>-1){err='"'+character+'" is not a valid character';return true}});return err}function softRender(view,data){var newValues=data&&data.values||[];var currentValues=view.tagsInputView.getTags();var intersection=_.intersection(newValues,currentValues);if(intersection.length!==newValues.length||intersection.length!==currentValues.length){view.tagsInputView.setTags(newValues)}if(view.hasAutoComplete&&data.completions&&data.completions.data){view.autocompleteCollection.reset(data.completions.data.map(function(item){return{name:item}}));view.tagsInputView.updateAutoComplete()}if(data&&data.recommendations&&data.recommendations.data&&data.recommendations.data.length){if(!view.recommendationsView){view.recommendationsView=new RecommendationsView({name:view.name,itemPrefix:view.itemPrefix,itemType:view.itemType});view.retrigger(view.recommendationsView,QueryWizardEventNames.DISPATCH_ACTION);view.$el.append(view.recommendationsView.$el)}}if(view.recommendationsView){view.recommendationsView.render(data.recommendations)}}function onInputUpdate(view,value){if(value&&value.trim().length===0){return}var actionTypes={hashtag:QueryWizardActions.FETCH_HASHTAG_COMPLETIONS,website:QueryWizardActions.FETCH_WEBSITE_COMPLETIONS,handle:QueryWizardActions.FETCH_TWITTER_HANDLE_COMPLETIONS};view.trigger(QueryWizardEventNames.DISPATCH_ACTION,{type:actionTypes[view.itemType],payload:value})}var MultipleTextInputView=Backbone.View.extend({constructor:function MultipleTextInputView(options){if(!options||!options.name){throw new Error('A "name" option is required for this view')}this.name=options.name;this.validateInput=options.validateInput;this.duplicateEntryText=options.duplicateEntryText||"This term already exists";this.itemPrefix=options.itemPrefix;this.itemType=options.itemType;this.hasAutoComplete=options.hasAutoComplete;Backbone.View.apply(this,arguments)},render:function render(data){var view=this;var values=data&&data.values||[];view.autocompleteCollection=new TagCollection;this.tagsInputView=new TagsInputView({addValueOnBlur:true,hasAutoComplete:!!this.hasAutoComplete,autocompleteMatchIfContains:true,placeholder:"",duplicateEntryText:this.duplicateEntryText,tagCollection:view.autocompleteCollection,tags:values,validateInput:this.validateInput||validateInput,onAdd:function onAdd(tag,done){view.trigger("change",getEventData(view));done()},onRemove:function onRemove(tag,done){view.trigger("change",getEventData(view,tag));done()},itemType:this.itemType});view.listenTo(view.tagsInputView,"completionItemAdded",function(originalValue,value,eventType){view.trigger(QueryWizardEventNames.DISPATCH_ACTION,{type:QueryWizardActions.COMPLETION_ADDED,payload:{eventType:eventType,name:view.name,originalValue:originalValue,value:value}})});this.tagsInputView.render();this.$el.append(this.tagsInputView.$el);this.tagsInputView.on("inputUpdate",_.debounce(onInputUpdate.bind(null,view),AUTOCOMPLETE_DEBOUNCE_TIME));softRender(this,data);this.render=softRender.bind(null,this)},remove:function remove(){if(this.tagsInputView){this.tagsInputView.remove();this.tagsInputView=undefined}if(this.recommendationsView){this.recommendationsView.remove();this.recommendationsView=undefined}Backbone.View.prototype.remove.apply(this,arguments)}});mixin(MultipleTextInputView,withRetrigger);return MultipleTextInputView});define("mustache!src/querywizard/templates/hashtagCampaignStepView",["lib/mustache"],function(mustache){var escapedTemplate='<div class="pagemargin-bottom">\n<label for="hashtag" class="biggertext hugeline db smallpadding-bottom">Which hashtags would you like to track? <a class="help icon-bwhelp" data-key="querywizard-selection-hashtag"></a></label>\n<div class="js-hashtag"></div>\n<label for="hashtag-ambiguous" class="dib singlepadding-top qw-input-label">\n<input class="js-hashtag-ambiguous smallmargin-right" type="checkbox" id="hashtag-ambiguous" name="hashtag-ambiguous" {{#hashtagAmbiguous}}checked{{/hashtagAmbiguous}} />\n<div class="qw-input-label-containment">\n<span class="qw-input-label-text mediumtext">Refine your search further, useful for broad hashtags e.g. #food</span>\n<a class="help icon-bwhelp tinypadding-left" data-key="querywizard-hashtag-campaign-ambiguous"></a>\n</div>\n</label>\n</div>\n<div class="js-hashtag-ambiguous-container pagemargin-bottom">\n<label for="hashtagContextTerms" class="biggertext hugeline db smallpadding-bottom">If one of your hashtags is widely used, what words would show that a mention is on-topic?</label>\n<div class="js-hashtag-context-terms"></div>\n</div>\n<div class="pagemargin-bottom">\n<label for="links" class="biggertext hugeline db smallpadding-bottom">List any links that refer to your campaign <a class="help icon-bwhelp" data-key="querywizard-hashtag-campaign-links"></a></label>\n<div class="js-links"></div>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/querywizard/views/HashtagCampaignStepView",["backbone","src/mixins/mixin","src/mixins/withRetrigger","src/querywizard/helpers/hashtagHelper","src/querywizard/helpers/queryWizardEventHelper","src/querywizard/helpers/websiteHelper","src/querywizard/events/QueryWizardEventNames","src/querywizard/views/MultipleTextInputView","mustache!src/querywizard/templates/hashtagCampaignStepView"],function(Backbone,mixin,withRetrigger,hashtagHelper,queryWizardEventHelper,websiteHelper,QueryWizardEventNames,MultipleTextInputView,template){"use strict";var VIEW_SELECTORS={HASHTAG_CONTEXT_TERMS_CONTAINER:".js-hashtag-ambiguous-container",INPUT_HASHTAGS:".js-hashtag",INPUT_HASHTAGS_CONTEXT_TERMS:".js-hashtag-context-terms",INPUT_LINKS:".js-links"};function softRender(view,data){var $hashtagContextTermsContainer;var showHashtagContextTermsContainer;$hashtagContextTermsContainer=view.$(VIEW_SELECTORS.HASHTAG_CONTEXT_TERMS_CONTAINER);showHashtagContextTermsContainer=data.hashtagAmbiguous||data.hashtagContextTerms&&data.hashtagContextTerms.length;view.hashtagInputView.render({values:data.hashtag});if(showHashtagContextTermsContainer){view.hashtagContextTermsInputView.render({values:data.hashtagContextTerms});return $hashtagContextTermsContainer.removeClass("hidden")}$hashtagContextTermsContainer.addClass("hidden");view.linksInputView.render({values:data.hashtagLinks})}var HashtagCampaignStepView=Backbone.View.extend({events:{"change .js-hashtag-ambiguous":function changeJsHashtagAmbiguous(e){queryWizardEventHelper.dispatchChange(this,e)}},constructor:function HashtagCampaignStepView(){Backbone.View.apply(this,arguments);this.hashtagInputView=new MultipleTextInputView({name:"hashtag",validateInput:hashtagHelper.validateHashtag,duplicateEntryText:"This hashtag already exists"});this.hashtagContextTermsInputView=new MultipleTextInputView({name:"hashtagContextTerms"});this.linksInputView=new MultipleTextInputView({name:"hashtagLinks",validateInput:websiteHelper.validateUrl,duplicateEntryText:"This link already exists"});this.retrigger(this.hashtagInputView,"change",QueryWizardEventNames.STATE_CHANGE);this.retrigger(this.hashtagContextTermsInputView,"change",QueryWizardEventNames.STATE_CHANGE);this.retrigger(this.linksInputView,"change",QueryWizardEventNames.STATE_CHANGE)},render:function render(data){data=data||{};this.$el.html(template(data));this.$(VIEW_SELECTORS.INPUT_HASHTAGS).append(this.hashtagInputView.$el);this.$(VIEW_SELECTORS.INPUT_HASHTAGS_CONTEXT_TERMS).append(this.hashtagContextTermsInputView.$el);this.$(VIEW_SELECTORS.INPUT_LINKS).append(this.linksInputView.$el);softRender(this,data);this.render=softRender.bind(null,this)}});mixin(HashtagCampaignStepView,withRetrigger);return HashtagCampaignStepView});define("mustache!src/querywizard/templates/hashtagCampaignExclusionsStepView",["lib/mustache"],function(mustache){var escapedTemplate='<div class="pagemargin-bottom">\n<label for="exclusions" class="biggertext hugeline db">List any words that show that a mention is off-topic</label>\n<a class="querywizard-help-link dib smallpadding-top smallpadding-bottom help" data-key="querywizard-hashtag-campaign-term-exclusions">Why is this useful?\n<span class="help icon-bwhelp" data-key="querywizard-hashtag-campaign-term-exclusions"></span>\n</a>\n<div class="js-exclusions"></div>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/querywizard/views/HashtagCampaignExclusionsStepView",["backbone","src/mixins/mixin","src/mixins/withRetrigger","src/querywizard/events/QueryWizardEventNames","src/querywizard/views/MultipleTextInputView","mustache!src/querywizard/templates/hashtagCampaignExclusionsStepView"],function(Backbone,mixin,withRetrigger,QueryWizardEventNames,MultipleTextInputView,template){"use strict";var VIEW_SELECTORS={INPUT_EXCLUSIONS:".js-exclusions"};function softRender(view,data){var termExclusions=data&&data.termExclusions;view.multipleTextInputView.render({values:termExclusions})}var HashtagCampaignExclusionsStepView=Backbone.View.extend({constructor:function HashtagCampaignExclusionsStepView(){Backbone.View.apply(this,arguments);this.multipleTextInputView=new MultipleTextInputView({name:"termExclusions"});this.retrigger(this.multipleTextInputView,"change",QueryWizardEventNames.STATE_CHANGE)},render:function render(data){data=data||{};this.$el.html(template(data));this.$(VIEW_SELECTORS.INPUT_EXCLUSIONS).append(this.multipleTextInputView.$el);softRender(this,data);this.render=softRender.bind(null,this)}});mixin(HashtagCampaignExclusionsStepView,withRetrigger);return HashtagCampaignExclusionsStepView});define("mustache!src/querywizard/templates/brandNameView",["lib/mustache"],function(mustache){var escapedTemplate='<div class="pagemargin-bottom">\n<label for="brand-name" class="biggertext hugeline db smallmargin-bottom">What brand would you like to track?</label>\n<input class="js-brand-name field fourcol db" id="brand-name" value="{{brandName}}" name="brand-name" data-at="query-wizard-brand-name-input" />\n<label for="brand-name-ambiguous" class="dib singlepadding-top qw-input-label">\n<input class="js-ambiguous-term smallmargin-right" type="checkbox" id="brand-name-ambiguous" name="brand-name-ambiguous" data-at="query-wizard-brand-ambiguous-checkbox" {{#brandNameAmbiguous}}checked{{/brandNameAmbiguous}} />\n<div class="qw-input-label-containment">\n<span class="qw-input-label-text mediumtext">The brand\'s name is also a common word, e.g. Fox</span>\n<a class="help icon-bwhelp tinypadding-left" data-key="querywizard-ambiguous-terms"></a>\n</div>\n</label>\n</div>\n<div class="pagemargin-bottom">\n<label for="brand-aliases" class="biggertext hugeline db smallpadding-bottom">List any brand nicknames, e.g. Coke</label>\n<div class="js-brand-aliases"></div>\n<label for="brand-aliases-ambiguous" class="dib singlepadding-top qw-input-label">\n<input class="js-ambiguous-term smallmargin-right" type="checkbox" id="brand-aliases-ambiguous" name="brand-aliases-ambiguous" data-at="query-wizard-brand-aliases-ambiguous-checkbox" {{#brandAliasesAmbiguous}}checked{{/brandAliasesAmbiguous}} />\n<div class="qw-input-label-containment">\n<span class="qw-input-label-text mediumtext">One or more of the brand\'s nicknames is a common word e.g. Bud</span>\n<a class="help icon-bwhelp tinypadding-left" data-key="querywizard-ambiguous-terms"></a>\n</div>\n</label>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/querywizard/views/BrandNameStepView",["backbone","src/mixins/mixin","src/mixins/withRetrigger","src/querywizard/events/QueryWizardEventNames","src/querywizard/helpers/queryWizardEventHelper","src/querywizard/views/MultipleTextInputView","src/helpers/validationTooltipHelper","mustache!src/querywizard/templates/brandNameView"],function(Backbone,mixin,withRetrigger,QueryWizardEventNames,queryWizardEventHelper,MultipleTextInputView,validationTooltipHelper,template){"use strict";var VIEW_SELECTORS={INPUT_BRAND_NAME:".js-brand-name",INPUT_BRAND_ALIASES:".js-brand-aliases"};function softRender(view,data){var $brandNameInput=view.$(VIEW_SELECTORS.INPUT_BRAND_NAME);var brandName=data&&data.brandName;var brandAliases=data&&data.brandAliases;validationTooltipHelper.showErrorsForForm(data.errors,view.$el);if($brandNameInput.val().trim()!==brandName){$brandNameInput.val(brandName)}view.multipleTextInputView.render({values:brandAliases})}var BrandNameStepView=Backbone.View.extend({events:{"input .js-brand-name":function inputJsBrandName(e){queryWizardEventHelper.dispatchChange(this,e,null,{needsDebouncing:true})},"change .js-ambiguous-term":function changeJsAmbiguousTerm(e){queryWizardEventHelper.dispatchChange(this,e)}},constructor:function BrandNameStepView(){Backbone.View.apply(this,arguments);this.multipleTextInputView=new MultipleTextInputView({name:"brandAliases"});this.retrigger(this.multipleTextInputView,"change",QueryWizardEventNames.STATE_CHANGE)},render:function render(data){data=data||{};this.$el.html(template(data));this.multipleTextInputView.render({values:data.brandAliases});this.$(VIEW_SELECTORS.INPUT_BRAND_ALIASES).append(this.multipleTextInputView.$el);validationTooltipHelper.showErrorsForForm(data.errors,this.$el);this.render=softRender.bind(null,this)}});mixin(BrandNameStepView,withRetrigger);return BrandNameStepView});define("mustache!src/querywizard/templates/brandProductNamesView",["lib/mustache"],function(mustache){var escapedTemplate='<div class="pagemargin-bottom">\n<label for="product-names" class="biggertext hugeline db smallpadding-bottom">List any products you want to track, e.g. iPhone.<br/>Don\'t add products which are also common words</label>\n<div class="js-product-names"></div>\n</div>\n{{#showBrandContextTerms}}\n<div class="pagemargin-bottom">\n<label for="brand-context-terms" class="biggertext hugeline db smallpadding-bottom">\nIf the brand is a common word, e.g. Apple, what words would you expect to find near it, e.g. computer, USB, hard drive\n<a class="help icon-bwhelp" data-key="querywizard-brand-context-terms"></a>\n</label>\n<div class="js-brand-context-terms"></div>\n</div>\n{{/showBrandContextTerms}}\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/querywizard/views/BrandProductNamesStepView",["backbone","underscore","src/mixins/mixin","src/mixins/withRetrigger","src/querywizard/events/QueryWizardEventNames","src/querywizard/views/MultipleTextInputView","mustache!src/querywizard/templates/brandProductNamesView"],function(Backbone,_,mixin,withRetrigger,QueryWizardEventNames,MultipleTextInputView,template){"use strict";var VIEW_SELECTORS={INPUT_PRODUCT_NAMES:".js-product-names",INPUT_BRAND_CONTEXT_TERMS:".js-brand-context-terms"};function softRender(view,data){data=data||{};view.productNamesInputView.render({values:data.productNames});view.brandContextTermsInputView.render({values:data.brandContextTerms})}var BrandProductNamesStepView=Backbone.View.extend({constructor:function BrandProductNamesStepView(){Backbone.View.apply(this,arguments);this.productNamesInputView=new MultipleTextInputView({name:"productNames"});this.retrigger(this.productNamesInputView,"change",QueryWizardEventNames.STATE_CHANGE);this.brandContextTermsInputView=new MultipleTextInputView({name:"brandContextTerms"});this.retrigger(this.brandContextTermsInputView,"change",QueryWizardEventNames.STATE_CHANGE)},render:function render(data){var showBrandContextTerms;var brandAliases;data=data||{};brandAliases=data.brandAliases||[];showBrandContextTerms=data.brandNameAmbiguous||data.brandAliasesAmbiguous&&brandAliases.length;this.$el.html(template(_.extend({},data,{showBrandContextTerms:showBrandContextTerms})));this.productNamesInputView.render({values:data.productNames});this.$(VIEW_SELECTORS.INPUT_PRODUCT_NAMES).append(this.productNamesInputView.$el);if(showBrandContextTerms){this.brandContextTermsInputView.render({values:data.brandContextTerms});this.$(VIEW_SELECTORS.INPUT_BRAND_CONTEXT_TERMS).append(this.brandContextTermsInputView.$el)}this.render=softRender.bind(null,this)}});mixin(BrandProductNamesStepView,withRetrigger);return BrandProductNamesStepView});define("src/mixins/showWaitmaskViewMixin",["underscore","src/packages/waitmask"],function(_){"use strict";var defaultOptions={text:undefined,applyPosition:false};return{showWaitmask:function showWaitmask(text,options){var waitmaskOptions;options=_.omit(options||{},"text");waitmaskOptions=_.defaults({},options,defaultOptions,{text:text});this.$el.showWaitmask(waitmaskOptions)},hideWaitmask:function hideWaitmask(){this.$el.hideWaitmask()}}});define("mustache!src/querywizard/templates/elements/twitterHandlesSelectView",["lib/mustache"],function(mustache){var escapedTemplate='<div class="js-twitter-handle-suggestions-container">\n<div class="js-twitter-handle-suggestions"></div>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("text!src/querywizard/templates/elements/twitterHandleMain.template",[],function(){return'<div class="{{className}}" tabindex=1>\n    {{^selectionBottom}}\n    <ul class="{{selectionsClass}} top bwscrollbar-narrow">\n    {{#selections}}\n    {{/selections}}\n    </ul>\n    <div class="js-suggestion-explanation tinypadding-top smallpadding-bottom smalltext lightgrey"></div>\n    {{/selectionBottom}}\n    <div class="{{selectedClass}} rounded darkgrey smallpadding-horizontal relative">\n        <span class="{{selectedTextClass}} dib doublepadding-right textellipsis">{{selectedItemText}}</span><i class="icon-chevron-down rounded linkblue absright hugeline smallmargin-right"></i>\n    </div>\n    {{#selectionBottom}}\n        <ul class="selections bottom">\n        {{#selections}}\n        {{/selections}}\n        </ul>\n    {{/selectionBottom}}\n</div>\n'});define("text!src/querywizard/templates/elements/twitterHandlePopup.template",[],function(){return'<div class="{{itemsClass}} lightshadow qw-twitter-handle-items">\n    {{#showSearch}}\n    <div class="searchContainer smallpadding relative db">\n        <input class="{{searchInputClass}} rounded"></input>\n    </div>\n    {{/showSearch}}\n    <ul class="{{itemslistClass}}">\n        {{#items}}\n        {{> item}}\n        {{/items}}\n    </ul>\n</div>\n'});define("text!src/querywizard/templates/elements/twitterHandleItem.template",[],function(){return'<li class="{{itemClass}} smallpadding relative db qw-twitter-handle-item" data-text="{{label}}" data-value="{{value}}">\n    <img class="rounded" src="{{data.imgSrc}}">\n    <div class="smallmargin-left">\n        <div class="tinymargin-bottom">\n            <span class="bigtext bold">{{label}}</span>\n            {{#data.verified}}\n            <span class="icon-bwtwitter-verified twitter-verified-color"></span>\n            {{/data.verified}}\n            <a href="//www.twitter.com/{{value}}" class="qw-twitter-handle-username js-twitter-handle-link" target="_blank">\n                @{{value}}\n                <span class="tinypadding-left icon-external-link"></span>\n            </a>\n        </div>\n        <div class="grey fade-clamp twitter-description">{{{data.description}}}</div>\n    </div>\n</li>\n'});define("text!src/querywizard/templates/elements/twitterHandleSelection.template",[],function(){return'<li class="selectionItem qw-twitter-handle-selection{{#data.isUnknown}} qw-twitter-handle-selection__unknown{{/data.isUnknown}}" data-value="{{value}}">\n    <span class="customtip js-customtip" title="{{data.tooltip}}"{{#data.isUnknown}} data-isunknown="true"{{/data.isUnknown}}>\n        {{#data.imgSrc}}\n        <img class="valignmiddle" alt="" src="{{data.imgSrc}}">\n        {{/data.imgSrc}}\n        <span class="valignmiddle{{^data.imgSrc}} smallpadding-left{{/data.imgSrc}}">\n        {{#data.verified}}\n        <span class="icon-bwtwitter-verified twitter-verified-color"></span>\n        {{/data.verified}}\n        <a href="//www.twitter.com/{{value}}" target="_blank" class="js-twitter-handle-link">\n            <span class="username">@{{value}}</span>\n        </a>\n        </span>\n    </span>\n    <i class="icon-remove lightgrey iconsmall smallmargin-left {{unselectItemClass}}"></i>\n</li>\n\n'});define("css!src/querywizard/css/querywizardTwitterHandles.css",["css!src/querywizard/css/compiled.css"],function(){});define("src/querywizard/views/elements/TwitterHandlesSelectView",["underscore","backbone","jquery","rx","src/keyCodes","src/mixins/showWaitmaskViewMixin","bw-fe-helpers/autoCompleteHelper","src/querywizard/QueryWizardActions","src/querywizard/events/QueryWizardEventNames","src/querywizard/views/elements/SellecktView","mustache!src/querywizard/templates/elements/twitterHandlesSelectView","text!src/querywizard/templates/elements/twitterHandleMain.template","text!src/querywizard/templates/elements/twitterHandlePopup.template","text!src/querywizard/templates/elements/twitterHandleItem.template","text!src/querywizard/templates/elements/twitterHandleSelection.template","src/packages/customtip","css!src/querywizard/css/querywizardTwitterHandles.css"],function(_,Backbone,$,Rx,keyCodes,showWaitmaskViewMixin,autoCompleteHelper,QueryWizardActions,QueryWizardEventNames,SellecktView,template,mainTemplate,popupTemplate,itemTemplate,selectionTemplate){"use strict";var SELLECKT_SELECTIONS_CLASS="selections";var VIEW_SELECTORS={SELECTION:".js-twitter-handle-suggestions",SELECTION_CONTAINER:".js-twitter-handle-suggestions-container",SELECTION_CUSTOMTIP:".js-customtip",SELECTION_TWITTER_HANDLE_LINKS:".js-twitter-handle-link",SUGGESTION_EXPLANATION:".js-suggestion-explanation",SELECTION_SELLECKT_SELECTIONS:".js-twitter-handle-suggestions ."+SELLECKT_SELECTIONS_CLASS};function getTwitterHandlesData(view){var selectedTwitterHandleData=view._twitterHandlesSelection.selleckt.getSelection();return{values:selectedTwitterHandleData.map(function(item){return item.value}),selectedData:selectedTwitterHandleData}}function onPopupCreated(view,popup){var search;var $popupEl=popup.$popup;var $input=$popupEl.find("input");var $itemsList=$popupEl.find(".itemslist");$input.on("keydown",onKeydown.bind(null,view,$itemsList));search=autoCompleteHelper.keyupObserver(Rx.Observable.fromEvent($input,"keyup"));search.subscribe(function(searchTerm){view.trigger(QueryWizardEventNames.DISPATCH_ACTION,{type:view.searchAction,payload:searchTerm})});$itemsList.on("click",VIEW_SELECTORS.SELECTION_TWITTER_HANDLE_LINKS,function(e){e.stopPropagation()})}function selectionChanged(view){view.trigger(QueryWizardEventNames.TWITTER_HANDLES_SELECT_CHANGE,getTwitterHandlesData(view))}function onItemSelected(view,data){view.trigger(QueryWizardEventNames.DISPATCH_ACTION,{type:QueryWizardActions.RECOMMENDATION_CLICKED,payload:{name:view.name,value:data.value,sources:data.sources,doNotUpdateState:true}})}function onKeydown(view,$itemsList,e){if([keyCodes.UP,keyCodes.DOWN].indexOf(e.which)>-1){return}$itemsList.empty();view._twitterHandlesSelection.selleckt.items=[]}function softRender(view,data){var selectedItems;var searchItems;data=data||{};selectedItems=[].concat(data.selectedData||[]);searchItems=[].concat(data.searchData||[]);view.hideWaitmask();if(data.isSearchCollectionLoading){return}view._twitterHandlesSelection.render({selectedItems:selectedItems,searchItems:searchItems});view.$(VIEW_SELECTORS.SUGGESTION_EXPLANATION).text(data.suggestionExplanationText||"");view.$(VIEW_SELECTORS.SELECTION_CUSTOMTIP).each(function(){var $this=$(this);$this.customtip({tipClass:$this.data("isunknown")?"validation-tip notification-error":""})})}var TwitterHandlesSelectView=Backbone.View.extend({constructor:function TwitterHandlesSelectView(options){if(!options.searchAction){throw new Error("TwitterHandlesSelectView needs to be initialized with options.searchAction")}this.name=options.name;this.searchAction=options.searchAction;Backbone.View.apply(this,arguments)},className:"relative",events:function events(){var events={};events["click "+VIEW_SELECTORS.SELECTION_SELLECKT_SELECTIONS]="onClickSelectionsContainer";events["click "+VIEW_SELECTORS.SELECTION_TWITTER_HANDLE_LINKS]="onClickTwitterHandleLinks";return events},render:function render(data){data=data||{};this.$el.html(template());this._twitterHandlesSelection=new SellecktView({name:"twitter-handles",multiple:true,enableSearch:true,searchThreshold:-1,defaultSearchTerm:data.defaultSearchTerm,showEmptyList:true,selectionClass:SELLECKT_SELECTIONS_CLASS,placeholderText:"Add a Twitter Handle",alternatePlaceholder:"Add another Twitter Handle",mainTemplate:mainTemplate,popupTemplate:popupTemplate,itemTemplate:itemTemplate,selectionTemplate:selectionTemplate});this.$(VIEW_SELECTORS.SELECTION).html(this._twitterHandlesSelection.el);this.listenTo(this._twitterHandlesSelection,"itemSelected",onItemSelected.bind(null,this));this.listenTo(this._twitterHandlesSelection,"selectionChanged",selectionChanged.bind(null,this));this.listenTo(this._twitterHandlesSelection,"onPopupCreated",onPopupCreated.bind(null,this));if(data.showWaitmask){this.showWaitmask();return}softRender(this,data);this.render=softRender.bind(null,this)},onClickTwitterHandleLinks:function onClickTwitterHandleLinks(e){e.stopPropagation()},onClickSelectionsContainer:function onClickSelectionsContainer(e){e.preventDefault();e.stopPropagation();this._twitterHandlesSelection.open()},remove:function remove(){if(this._twitterHandlesSelection){this._twitterHandlesSelection.remove();this._twitterHandlesSelection=undefined}Backbone.View.prototype.remove.call(this)}});_.extend(TwitterHandlesSelectView.prototype,showWaitmaskViewMixin);return TwitterHandlesSelectView});define("mustache!src/querywizard/templates/twitterHandlesInputContainerView",["lib/mustache"],function(mustache){var escapedTemplate='<div class="js-twitter-handles-container">\n<div class="js-twitter-handles"></div>\n<span class="js-twitter-handle-message"></span>\n</div>\n<div class="js-twitter-handle-suggestions"></div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/querywizard/templates/elements/twitterHandlesInputContainerViewMessage",["lib/mustache"],function(mustache){var escapedTemplate='{{^serverError}}\n{{^twitterAuthenticationError}}\n<a class="js-twitter-auth dib smallmargin-top">\nSign in with Twitter to check @handles as you type.\n</a><a class="help icon-bwhelp tinypadding-left" data-key="querywizard-twitter-authentication"></a>\n{{/twitterAuthenticationError}}\n{{#twitterAuthenticationError}}\n<a class="js-twitter-auth db smallmargin-top">Sorry, you could not authenticate with Twitter. Please try again.</a>\n{{/twitterAuthenticationError}}\n{{/serverError}}\n{{#lookupError}}\n<span class="notification-warning db smallmargin-top smallpadding">Sorry, your Twitter handles can\'t be verified at the moment.</span>\n{{/lookupError}}\n{{#searchError}}\n<span class="notification-warning db smallmargin-top smallpadding">Sorry, Twitter handles can\'t be searched at the moment.</span>\n{{/searchError}}\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/querywizard/views/elements/TwitterHandlesInputContainerView",["backbone","src/mixins/mixin","src/mixins/withRetrigger","src/helpers/twitterHelper","src/querywizard/events/QueryWizardEventNames","src/querywizard/views/MultipleTextInputView","src/querywizard/views/elements/TwitterHandlesSelectView","mustache!src/querywizard/templates/twitterHandlesInputContainerView","mustache!src/querywizard/templates/elements/twitterHandlesInputContainerViewMessage"],function(Backbone,mixin,withRetrigger,twitterHelper,QueryWizardEventNames,MultipleTextInputView,TwitterHandlesSelectView,template,messageTemplate){"use strict";var VIEW_SELECTORS={INPUT_TWITTER_HANDLES_CONTAINER:".js-twitter-handles-container",INPUT_TWITTER_HANDLES:".js-twitter-handles",INPUT_TWITTER_HANDLES_MESSAGE:".js-twitter-handle-message",INPUT_TWITTER_HANDLE_SUGGESTIONS:".js-twitter-handle-suggestions"};function softRender(view,data){data=data||{};var showTwitterHandleSuggestion=data.loggedIntoTwitter&&!data.serverError;view.$(VIEW_SELECTORS.INPUT_TWITTER_HANDLES_MESSAGE).html(messageTemplate(data));view.twitterHandlesTextInputView.render({values:data.tagValues,recommendations:data.recommendations,completions:data.completions});if(showTwitterHandleSuggestion){view.twitterHandlesSelectView.render(data)}view.$(VIEW_SELECTORS.INPUT_TWITTER_HANDLE_SUGGESTIONS).toggleClass("hidden",!showTwitterHandleSuggestion);view.$(VIEW_SELECTORS.INPUT_TWITTER_HANDLES_CONTAINER).toggleClass("hidden",showTwitterHandleSuggestion)}var TwitterHandlesInputContainerView=Backbone.View.extend({events:{"click .js-twitter-auth":function clickJsTwitterAuth(){this.trigger(QueryWizardEventNames.TWITTER_AUTH_REQUEST)}},constructor:function TwitterHandlesInputContainerView(options){Backbone.View.apply(this,arguments);if(!options||!options.name){throw new Error('A "name" option is required for this view')}if(!options||!options.searchAction){throw new Error('A "searchAction" option is required for this view')}this.name=options.name;this.searchAction=options.searchAction;this.twitterHandlesTextInputView=new MultipleTextInputView({name:this.name,itemPrefix:"@",itemType:"handle",validateInput:twitterHelper.validateHandle,duplicateEntryText:"This Twitter handle already exists",hasAutoComplete:options.hasAutoComplete});this.retrigger(this.twitterHandlesTextInputView,"change",QueryWizardEventNames.STATE_CHANGE);this.retrigger(this.twitterHandlesTextInputView,QueryWizardEventNames.DISPATCH_ACTION);this.twitterHandlesSelectView=new TwitterHandlesSelectView({name:this.name,searchAction:this.searchAction});this.retrigger(this.twitterHandlesSelectView,QueryWizardEventNames.TWITTER_HANDLES_SELECT_CHANGE);this.retrigger(this.twitterHandlesSelectView,QueryWizardEventNames.DISPATCH_ACTION)},render:function render(data){data=data||{};this.$el.html(template());this.$(VIEW_SELECTORS.INPUT_TWITTER_HANDLES).append(this.twitterHandlesTextInputView.$el);this.$(VIEW_SELECTORS.INPUT_TWITTER_HANDLE_SUGGESTIONS).append(this.twitterHandlesSelectView.$el);softRender(this,data);this.render=softRender.bind(null,this)},remove:function remove(){if(this.twitterHandlesTextInputView){this.twitterHandlesTextInputView.remove();this.twitterHandlesTextInputView=undefined}if(this.twitterHandlesSelectView){this.twitterHandlesSelectView.remove();this.twitterHandlesSelectView=undefined}Backbone.View.prototype.remove.call(this)}});mixin(TwitterHandlesInputContainerView,withRetrigger);return TwitterHandlesInputContainerView});define("mustache!src/querywizard/templates/brandOwnedMediaStepView",["lib/mustache"],function(mustache){var escapedTemplate='<div class="pagemargin-bottom">\n<label for="brand-websites" class="biggertext hugeline db">List any brand websites you would like to track, e.g. apple.com</label>\n<a class="querywizard-help-link dib smallpadding-top smallpadding-bottom help" data-key="querywizard-brand-websites">Why is this useful?\n<span class="help icon-bwhelp" data-key="querywizard-brand-websites"\ndata-modal-css-class="sixcol"></span>\n</a>\n<div class="js-brand-websites"></div>\n</div>\n\n<div class="pagemargin-bottom">\n<label for="brand-hashtags" class="biggertext hugeline db smallpadding-bottom">List any hashtags which refer to the brand, e.g. OreoHorrorStories</label>\n<div class="js-brand-hashtags"></div>\n</div>\n\n<div class="">\n<label class="biggertext hugeline db">Choose any Twitter handles you would like to track, e.g. cocacolaco</label>\n<a class="querywizard-help-link dib smallpadding-top smallpadding-bottom help" data-key="querywizard-twitter-handle-suggestions">What does this do?\n<span class="help icon-bwhelp" data-key="querywizard-twitter-handle-suggestions"></span>\n</a>\n<div class="js-brand-twitter-handles pagemargin-bottom"></div>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/querywizard/views/BrandOwnedMediaStepView",["underscore","backbone","src/globals/flags","src/globals/flagNames","src/mixins/mixin","src/mixins/withRetrigger","src/querywizard/QueryWizardActions","src/querywizard/events/QueryWizardEventNames","src/querywizard/helpers/hashtagHelper","src/querywizard/helpers/websiteHelper","src/querywizard/views/MultipleTextInputView","src/querywizard/views/elements/TwitterHandlesInputContainerView","mustache!src/querywizard/templates/brandOwnedMediaStepView"],function(_,Backbone,flags,FLAGS,mixin,withRetrigger,QueryWizardActions,QueryWizardEventNames,hashtagHelper,websiteHelper,MultipleTextInputView,TwitterHandlesInputContainerView,template){"use strict";var VIEW_SELECTORS={INPUT_BRAND_WEBSITES:".js-brand-websites",INPUT_BRAND_HASHTAGS:".js-brand-hashtags",INPUT_BRAND_TWITTER_HANDLES:".js-brand-twitter-handles"};function softRender(view,data){var suggestionExplanationText="";data=data||{};view.brandWebsitesInputView.render({values:data.brandWebsites,recommendations:data.websiteRecommendations,completions:data.websiteCompletions});view.brandHashtagsInputView.render({values:data.brandHashtags,recommendations:data.hashtagRecommendations,completions:data.hashtagCompletions});if(data.twitterHandleData){data.twitterHandleData.recommendations=data.twitterHandleRecommendations;data.twitterHandleData.completions=data.twitterHandleCompletions}if(!data.id&&!data.twitterHandlesEdited&&data.twitterHandles&&data.twitterHandles.length===1){suggestionExplanationText="This suggestion is based on your brand name."}view.brandTwitterHandlesInputContainerView.render(_.extend({suggestionExplanationText:suggestionExplanationText},data.twitterHandleData))}function twitterHandleSelectionChanged(view,data){view.trigger(QueryWizardEventNames.STATE_CHANGE,{twitterHandles:data.values,twitterHandlesEdited:true,twitterHandleData:{selectedData:data.selectedData}})}var BrandOwnedMediaStepView=Backbone.View.extend({constructor:function BrandWebsitesStepView(){Backbone.View.apply(this,arguments);var hasAutoComplete=flags.variation(FLAGS.ENABLE_QUERYWIZARD_COMPLETIONS);this.brandWebsitesInputView=new MultipleTextInputView({name:"brandWebsites",itemType:"website",validateInput:websiteHelper.validateDomainOrPartialDomainOrUrl,duplicateEntryText:"This URL or domain already exists",hasAutoComplete:hasAutoComplete});this.retrigger(this.brandWebsitesInputView,"change",QueryWizardEventNames.STATE_CHANGE);this.retrigger(this.brandWebsitesInputView,QueryWizardEventNames.DISPATCH_ACTION);this.brandHashtagsInputView=new MultipleTextInputView({name:"brandHashtags",itemPrefix:"#",itemType:"hashtag",validateInput:hashtagHelper.validateHashtag,duplicateEntryText:"This hashtag already exists",hasAutoComplete:hasAutoComplete});this.retrigger(this.brandHashtagsInputView,"change",QueryWizardEventNames.STATE_CHANGE);this.retrigger(this.brandHashtagsInputView,QueryWizardEventNames.DISPATCH_ACTION);this.brandTwitterHandlesInputContainerView=new TwitterHandlesInputContainerView({name:"twitterHandles",searchAction:QueryWizardActions.SEARCH_TWITTER_HANDLES,hasAutoComplete:hasAutoComplete});this.retrigger(this.brandTwitterHandlesInputContainerView,QueryWizardEventNames.STATE_CHANGE);this.retrigger(this.brandTwitterHandlesInputContainerView,QueryWizardEventNames.DISPATCH_ACTION);this.retrigger(this.brandTwitterHandlesInputContainerView,QueryWizardEventNames.TWITTER_AUTH_REQUEST);this.listenTo(this.brandTwitterHandlesInputContainerView,QueryWizardEventNames.TWITTER_HANDLES_SELECT_CHANGE,twitterHandleSelectionChanged.bind(null,this))},render:function render(data){data=data||{};this.$el.html(template(data));this.$(VIEW_SELECTORS.INPUT_BRAND_WEBSITES).append(this.brandWebsitesInputView.$el);this.$(VIEW_SELECTORS.INPUT_BRAND_HASHTAGS).append(this.brandHashtagsInputView.$el);this.$(VIEW_SELECTORS.INPUT_BRAND_TWITTER_HANDLES).append(this.brandTwitterHandlesInputContainerView.$el);softRender(this,data);this.render=softRender.bind(null,this)},remove:function remove(){if(this.brandWebsitesInputView){this.brandWebsitesInputView.remove();this.brandWebsitesInputView=undefined}if(this.brandHashtagsInputView){this.brandHashtagsInputView.remove();this.brandHashtagsInputView=undefined}if(this.brandTwitterHandlesInputContainerView){this.brandTwitterHandlesInputContainerView.remove();this.brandTwitterHandlesInputContainerView=undefined}Backbone.View.prototype.remove.call(this)}});mixin(BrandOwnedMediaStepView,withRetrigger);return BrandOwnedMediaStepView});define("mustache!src/querywizard/templates/exclusionSnippetDescription",["lib/mustache"],function(mustache){var escapedTemplate='<div class="grey">\n<div class="singlepadding-bottom">{{description}}</div>\nThis uses {{length}} of your {{maxLength}} character limit.\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/querywizard/helpers/queryWizardExclusionSnippetHelper",["src/models/Query","mustache!src/querywizard/templates/exclusionSnippetDescription"],function(Query,exclusionSnippetDescriptionTemplate){"use strict";function getDescription(snippetData,snippetKey){var snippet=snippetData[snippetKey];if(!snippet){throw new Error("no snippet found for snippetKey "+snippetKey)}return exclusionSnippetDescriptionTemplate({description:snippet.description,maxLength:Query.queryTextMaxLength,length:snippet.query.length+5},false)}return{getDescription:getDescription}});define("src/querywizard/TermNode",[],function(){"use strict";var OPERATORS={OR:" OR ",AND:" AND ",NEAR:" NEAR/10 ",NOT:" NOT "};function identity(item){return item}function wrapWithBrackets(string){if(!string){return""}return"("+string+")"}function joinAndWrapWithBrackets(array,joinBy){if(array.length===1){return array[0]}return wrapWithBrackets(array.join(joinBy))}function isTermNode(termNode){return typeof termNode!=="string"}function hasChildren(termNode){return termNode.children.length!==0}function isChildOnlyNode(termNode){var children=termNode.children;return children.length===1&&isTermNode(children[0])}function getChildrenAsString(termNode){var nodeOperator=termNode.operator;return termNode.children.map(function(child){if(!isTermNode(child)){return child}if(child.operator===OPERATORS.NEAR){return child.toResultWithBrackets()}if(child.operator===nodeOperator&&!isChildOnlyNode(child)){return child.toResult()}return child.toResultWithBrackets()}).filter(identity)}function TermNode(children,operator){if(!Array.isArray(children)){throw new Error("Children argument is not array")}if(typeof operator!=="string"){throw new Error("Operator argument is not string")}this.children=children.filter(identity).filter(function(child){return isTermNode(child)?hasChildren(child):child});this.operator=operator}TermNode.prototype.toResult=function(){if(isChildOnlyNode(this)){return this.children[0].toResult()}return getChildrenAsString(this).join(this.operator)};TermNode.prototype.toResultWithBrackets=function(){if(isChildOnlyNode(this)){return this.children[0].toResultWithBrackets()}return joinAndWrapWithBrackets(getChildrenAsString(this),this.operator)};TermNode.OPERATORS=OPERATORS;return TermNode});define("src/querywizard/helpers/queryWizardQueryHelper",["underscore","src/models/Query","src/querywizard/TermNode","src/querywizard/helpers/websiteHelper"],function(_,Query,TermNode,websiteHelper){"use strict";var OPERATORS=TermNode.OPERATORS;var MAX_QUERY_LENGTH=Query.queryTextMaxLength;function isSingleTerm(string){return/^[\w?*]+$/.test(string)}function wrapWithQuotes(string){if(!string){return""}if(isSingleTerm(string)){return string}return'"'+string+'"'}function getExclusionSnippets(snippetData,exclusionSnippetIds){var snippetKeys=exclusionSnippetIds||[];if(!snippetKeys.length){return[]}if(_.isEmpty(snippetData)){return[]}return snippetKeys.map(function(snippetKey){var snippet=snippetData[snippetKey];if(!snippet){throw new Error("no snippet found for snippetKey "+snippetKey)}return snippet.query})}function groupField(fieldName,node){var result;if(!node){return}if(node.toResultWithBrackets){result=node.toResultWithBrackets()}else{result=node}if(!result){return""}return fieldName+":"+result}function buildBrandAliasesAndContextsNode(options){var brandName=wrapWithQuotes(options.brandName);var brandAliases=options.brandAliases||[];var brandContextTerms=options.brandContextTerms||[];var brandAliasesNode=new TermNode(brandAliases.map(wrapWithQuotes),OPERATORS.OR);var brandContextTermsNode=new TermNode(brandContextTerms.map(wrapWithQuotes),OPERATORS.OR);var brandNameOrAliasesNode=new TermNode([brandName,brandAliasesNode],OPERATORS.OR);var brandNameNearContextTermsNode;var brandAliasesNearContextTermsNode;if(!brandContextTerms.length||!(options.brandNameAmbiguous||options.brandAliasesAmbiguous)){return brandNameOrAliasesNode}if(options.brandNameAmbiguous&&options.brandAliasesAmbiguous){return new TermNode([brandNameOrAliasesNode,brandContextTermsNode],OPERATORS.NEAR)}if(options.brandNameAmbiguous){brandNameNearContextTermsNode=new TermNode([brandName,brandContextTermsNode],OPERATORS.NEAR);return new TermNode([brandNameNearContextTermsNode,brandAliasesNode],OPERATORS.OR)}brandAliasesNearContextTermsNode=new TermNode([brandAliasesNode,brandContextTermsNode],OPERATORS.NEAR);return new TermNode([brandName,brandAliasesNearContextTermsNode],OPERATORS.OR)}function buildProductNamesNode(options){var productNames=options.productNames||[];return new TermNode(productNames.map(wrapWithQuotes),OPERATORS.OR)}function buildBrandWebsitesNode(options){var brandWebsites=options.brandWebsites||[];var brandDomainsOrPartialDomains=brandWebsites.filter(function(brandWebsite){return websiteHelper.isDomain(brandWebsite)||websiteHelper.isPartialDomain(brandWebsite)});var brandWebsitesNode=new TermNode(brandWebsites.map(wrapWithQuotes),OPERATORS.OR);var brandDomainsOrPartialDomainNode=new TermNode(brandDomainsOrPartialDomains.map(wrapWithQuotes),OPERATORS.OR);return new TermNode([brandWebsitesNode,groupField("site",brandDomainsOrPartialDomainNode),groupField("links",brandWebsitesNode)],OPERATORS.OR)}function buildBrandWebsiteExclusionsNode(brandWebsiteExclusions){brandWebsiteExclusions=brandWebsiteExclusions||[];var brandWebsitesNode=new TermNode(brandWebsiteExclusions.map(wrapWithQuotes),OPERATORS.OR);return new TermNode([groupField("site",brandWebsitesNode)],OPERATORS.OR)}function buildBrandHashtagsNode(options){var brandHashtags=options.brandHashtags||[];var brandHashtagsNode=new TermNode(brandHashtags.map(wrapWithQuotes),OPERATORS.OR);return new TermNode([groupField("hashtags",brandHashtagsNode)],OPERATORS.OR)}function buildBrandTwitterHandlesNode(options){var twitterHandles=options.twitterHandles||[];var twitterHandlesNode=new TermNode(twitterHandles.map(wrapWithQuotes),OPERATORS.OR);var twitterHandlesAuthorNode=twitterHandles.length&&new TermNode([groupField("author",twitterHandlesNode),groupField("site","twitter.com")],OPERATORS.AND);return new TermNode([twitterHandlesAuthorNode,groupField("at_mentions",twitterHandlesNode)],OPERATORS.OR)}function buildBrandTwitterHandlesExclusionNode(options){var twitterHandles=options.twitterHandleExclusions||[];var twitterHandlesNode=new TermNode(twitterHandles.map(wrapWithQuotes),OPERATORS.OR);var twitterSiteNode=new TermNode(["twitter.com"],OPERATORS.AND);return twitterHandles.length&&new TermNode([groupField("author",twitterHandlesNode),groupField("site",twitterSiteNode)],OPERATORS.AND)}function buildHashtagCampaignNode(options){var hashtagsAndContextTermsNode=buildHashtagsAndContextTermsNode(options);var hashtagLinksNode=buildHashtagLinksNode(options);return new TermNode([hashtagsAndContextTermsNode,hashtagLinksNode],OPERATORS.OR)}function buildHashtagsAndContextTermsNode(options){var hashtagsNode=buildHashtags(options);var hashtagsContextTermsNode=buildHashtagContextTermsNode(options);return new TermNode([hashtagsNode,hashtagsContextTermsNode],OPERATORS.AND)}function buildHashtags(options){var hashtag=options.hashtag||[];var hashtagsNode=new TermNode(hashtag.map(wrapWithQuotes),OPERATORS.OR);return new TermNode([groupField("hashtags",hashtagsNode)],OPERATORS.OR)}function buildHashtagContextTermsNode(options){var hashtagContextTerms=options.hashtagContextTerms||[];return new TermNode(hashtagContextTerms.map(wrapWithQuotes),OPERATORS.OR)}function buildHashtagLinksNode(options){var hashtagLinks=options.hashtagLinks||[];var hashtagLinksNode=new TermNode(hashtagLinks.map(wrapWithQuotes),OPERATORS.OR);return new TermNode([groupField("links",hashtagLinksNode)],OPERATORS.OR)}function buildLocationsNode(options){var locationAgnostic=options.locationAgnostic;var locations=options.locations||[];if(locationAgnostic){return}return new TermNode(locations.map(function(location){return groupField(location.type,location.value)}),OPERATORS.OR)}function buildInclusionNode(options){var brandAliasesAndContextsNode=buildBrandAliasesAndContextsNode(options);var brandProductNamesNode=buildProductNamesNode(options);var brandWebsitesNode=buildBrandWebsitesNode(options);var brandHashtagsNode=buildBrandHashtagsNode(options);var brandTwitterHandlesNode=buildBrandTwitterHandlesNode(options);var hashtagCampaignNode=buildHashtagCampaignNode(options);var inclusionsNode=new TermNode([brandAliasesAndContextsNode,brandProductNamesNode,brandWebsitesNode,brandHashtagsNode,brandTwitterHandlesNode,hashtagCampaignNode],OPERATORS.OR);var locationsNode=buildLocationsNode(options);return new TermNode([inclusionsNode,locationsNode],OPERATORS.AND)}function buildExclusionNode(options){var termExclusions=options.termExclusions||[];var twitterHandleExclusionsNode=buildBrandTwitterHandlesExclusionNode(options);var brandWebsiteExclusionsNode=buildBrandWebsiteExclusionsNode(options.brandWebsiteExclusions);var exclusionSnippets=getExclusionSnippets(options.exclusionSnippetData,options.exclusionSnippets);return new TermNode(termExclusions.map(wrapWithQuotes).concat(twitterHandleExclusionsNode).concat(brandWebsiteExclusionsNode).concat(exclusionSnippets),OPERATORS.OR)}function buildOptimisedExclusionNode(options){var termExclusions=options.termExclusions||[];var twitterHandleExclusionsNode=buildBrandTwitterHandlesExclusionNode(options);var brandWebsiteExclusionsNode=buildBrandWebsiteExclusionsNode(options.brandWebsiteExclusions);return new TermNode(termExclusions.map(wrapWithQuotes).concat(twitterHandleExclusionsNode).concat(brandWebsiteExclusionsNode),OPERATORS.OR)}function buildOptimisedQueryTermNode(options){options=options||{};var inclusionsNode=buildInclusionNode(options);var exclusionsNode=buildOptimisedExclusionNode(options);return new TermNode([inclusionsNode,exclusionsNode],OPERATORS.NOT)}function buildOptimisedQueryString(options){return buildOptimisedQueryTermNode(options).toResult()}function buildQueryTermNode(options){options=options||{};var inclusionsNode=buildInclusionNode(options);var exclusionsNode=buildExclusionNode(options);return new TermNode([inclusionsNode,exclusionsNode],OPERATORS.NOT)}function buildQueryString(options){return buildQueryTermNode(options).toResult()}function isOverLengthLimit(options){return buildQueryString(options).length>MAX_QUERY_LENGTH}function removeHashtagSign(str){if(str.charAt(0)==="#"){return str.slice(1)}return str}function getSnippetIds(exclusionSnippets,exclusionSnippetData){if(!exclusionSnippets||_.isEmpty(exclusionSnippetData)){return[]}return exclusionSnippets.map(function(snippetKey){var snippet=exclusionSnippetData[snippetKey];if(!snippet){throw new Error("no snippet found for snippetKey "+snippetKey)}return snippet.id})}function getTestSearchOptions(qwState){var exclusionSnippetIds;var optimisedTermNodeTree=buildOptimisedQueryTermNode(qwState);var testSearchOptions={term:qwState.optimisedIncludedTerms,optimisedTermNodeTree:optimisedTermNodeTree,langCode:qwState.languages,languageAgnostic:qwState.languageAgnostic,page:0,queryType:qwState.type,projectId:qwState.projectId,exclusionSnippetIds:[],inclusionSnippetIds:[]};if(!qwState.exclusionSnippets){return testSearchOptions}exclusionSnippetIds=getSnippetIds(qwState.exclusionSnippets,qwState.exclusionSnippetData);testSearchOptions.exclusionSnippetIds=exclusionSnippetIds;return testSearchOptions}return{removeHashtagSign:removeHashtagSign,buildOptimisedQueryTermNode:buildOptimisedQueryTermNode,buildQueryString:buildQueryString,buildOptimisedQueryString:buildOptimisedQueryString,isOverLengthLimit:isOverLengthLimit,wrapWithQuotes:wrapWithQuotes,getTestSearchOptions:getTestSearchOptions,getSnippetIds:getSnippetIds}});define("mustache!src/querywizard/templates/brandExclusionsView",["lib/mustache"],function(mustache){var escapedTemplate='<div class="pagemargin-bottom">\n<label class="biggertext hugeline db">List any words that show that a mention is off-topic</label>\n<a class="querywizard-help-link dib smallpadding-top smallpadding-bottom help" data-key="querywizard-brand-term-exclusions">Why is this useful?\n<span class="help icon-bwhelp" data-key="querywizard-brand-term-exclusions"></span>\n</a>\n<div class="js-term-exclusions"></div>\n</div>\n<div class="pagemargin-bottom">\n<label class="biggertext hugeline db">Exclude results from these websites</label>\n<a class="querywizard-help-link dib smallpadding-top smallpadding-bottom help" data-key="querywizard-brand-website-exclusions">Why is this useful?\n<span class="help icon-bwhelp" data-key="querywizard-brand-website-exclusions"></span>\n</a>\n<div class="js-website-exclusions"></div>\n</div>\n<div class="pagemargin-bottom">\n<label class="biggertext hugeline db">Exclude results from these Twitter handles</label>\n<a class="querywizard-help-link dib smallpadding-top smallpadding-bottom help" data-key="querywizard-twitter-handle-exclusions">Why is this useful?\n<span class="help icon-bwhelp" data-key="querywizard-twitter-handle-exclusions"></span>\n</a>\n<div class="js-twitter-handle-exclusions"></div>\n</div>\n{{#snippets.length}}\n<div class="pagemargin-bottom">\n<label for="exclusion-snippets" class="biggertext hugeline dib singlepadding-bottom">\nTypes of mention to remove\n<a class="help icon-bwhelp" data-key="querywizard-exclusion-snippets"></a>\n</label>\n<div>\n{{#snippets}}\n<div class="js-snippet exclusion-snippet halfwidth textellipsis smallpadding-vertical " data-key="{{key}}">\n<label for="snippet-{{key}}" class="dib qw-input-label">\n<input name="exclusion-snippets" class="js-exclusion-snippets smallmargin-right" id="snippet-{{key}}" type="checkbox" value="{{key}}" {{#checked}}checked{{/checked}}>\n<div class="qw-input-label-containment">\n<span class="qw-input-label-text mediumtext">{{title}}</span>\n<a class="help icon-bwhelp tinypadding-left" data-key="querywizard-exclusion-snippet-unavailable"></a>\n</div>\n</label>\n</div>\n{{/snippets}}\n</div>\n</div>\n{{/snippets.length}}\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/querywizard/views/BrandExclusionsStepView",["jquery","underscore","backbone","src/mixins/mixin","src/mixins/withRetrigger","src/packages/guiders","src/querywizard/QueryWizardActions","src/querywizard/events/QueryWizardEventNames","src/querywizard/views/MultipleTextInputView","src/querywizard/views/elements/TwitterHandlesInputContainerView","src/querywizard/helpers/queryWizardEventHelper","src/querywizard/helpers/queryWizardExclusionSnippetHelper","src/querywizard/helpers/queryWizardQueryHelper","src/querywizard/helpers/websiteHelper","mustache!src/querywizard/templates/brandExclusionsView"],function($,_,Backbone,mixin,withRetrigger,guiders,QueryWizardActions,QueryWizardEventNames,MultipleTextInputView,TwitterHandlesInputContainerView,queryWizardEventHelper,queryWizardExclusionSnippetHelper,queryWizardQueryHelper,websiteHelper,template){"use strict";var VIEW_SELECTORS={TERM_INPUT_EXCLUSIONS:".js-term-exclusions",WEBSITE_INPUT_EXCLUSIONS:".js-website-exclusions",TWITTER_HANDLE_INPUT_EXCLUSIONS:".js-twitter-handle-exclusions",CHECKBOX_SNIPPETS:".js-exclusion-snippets"};function showTooltip(view,e){var $target=$(e.currentTarget);var key=$target.data("key");var snippet=view.snippetData[key];if(!snippet){throw new Error("no snippet found for snippetKey "+key)}hideTooltip(view);view._tooltip=guiders.createGuider({attachTo:'.js-snippet[data-key="'+key+'"]',classString:"querywizard",title:snippet.title,description:queryWizardExclusionSnippetHelper.getDescription(view.snippetData,key),xButton:false,position:3,buttons:[],width:276}).show()}function hideTooltip(view){var tooltipId;if(!view._tooltip){return}tooltipId=view._tooltip._currentGuiderID;if(guiders._guiders[tooltipId]){guiders._guiders[tooltipId].elem.remove();delete guiders._guiders[tooltipId]}view._tooltip=undefined}function getSelection(view){var $selection=view.$(VIEW_SELECTORS.CHECKBOX_SNIPPETS+":checked");var exclusionSnippets=[];$selection.each(function(){exclusionSnippets.push($(this).val())});return exclusionSnippets}function compareSnippetTitle(snippetA,snippetB){return snippetA.title>snippetB.title?1:snippetA.title<snippetB.title?-1:0}function getTemplateData(data){var exclusionSnippets=data.exclusionSnippets||[];var languageAgnostic=data.languageAgnostic;var snippets;var languageHasSnippets=data.exclusionSnippetData&&Object.keys(data.exclusionSnippetData).length;if(!languageHasSnippets||languageAgnostic){return data}snippets=Object.keys(data.exclusionSnippetData).map(function(key){var snippet=data.exclusionSnippetData[key];return{key:snippet.name,title:snippet.title,checked:exclusionSnippets.indexOf(snippet.id)>-1}});return _.extend({},data,{snippets:snippets.sort(compareSnippetTitle)})}function updateSnippetSelection(view,data){var exclusionSnippets=data&&data.exclusionSnippets||[];view.$(VIEW_SELECTORS.CHECKBOX_SNIPPETS).prop("checked",false);if(!exclusionSnippets.length){return}exclusionSnippets.forEach(function(key){view.$(VIEW_SELECTORS.CHECKBOX_SNIPPETS+'[value="'+key+'"]').prop("checked",true)})}function toggleTooLargeSnippets(view,data){data=data||{};var allSnippets=_(view.snippetData).pluck("name");var uncheckedSnippets=_(allSnippets).difference(data.exclusionSnippets);uncheckedSnippets.forEach(function(snippetKey){var dataWithNewSnippet=_.extend({},data,{exclusionSnippets:[snippetKey].concat(data.exclusionSnippets||[])});var $snippetCheckbox=view.$(VIEW_SELECTORS.CHECKBOX_SNIPPETS+'[id="snippet-'+snippetKey+'"]');var overLimit=queryWizardQueryHelper.isOverLengthLimit(dataWithNewSnippet);$snippetCheckbox.prop("disabled",overLimit).closest(".js-snippet").toggleClass("showHelp",overLimit)})}function softRender(view,data){var termExclusions=data&&data.termExclusions;var brandWebsiteExclusions=data&&data.brandWebsiteExclusions;view.termExclusionsInputView.render({values:termExclusions});view.brandWebsiteExclusionsInputView.render({values:brandWebsiteExclusions});view.twitterHandleExclusionsInputContainerView.render(data.twitterHandleExclusionData);if(!_.isEmpty(data.exclusionSnippetData)){updateSnippetSelection(view,data);toggleTooLargeSnippets(view,data)}}function twitterHandleSelectionChanged(view,data){view.trigger(QueryWizardEventNames.STATE_CHANGE,{twitterHandleExclusions:data.values,twitterHandleExclusionsEdited:true,twitterHandleExclusionData:{selectedData:data.selectedData}})}var BrandExclusionsStepView=Backbone.View.extend({events:{"change .js-exclusion-snippets":function changeJsExclusionSnippets(e){queryWizardEventHelper.dispatchChange(this,e,getSelection.bind(null,this))},"mouseover .js-snippet":function mouseoverJsSnippet(e){showTooltip(this,e)},"mouseout .js-snippet":function mouseoutJsSnippet(){hideTooltip(this)}},constructor:function BrandExclusionsStepView(){Backbone.View.apply(this,arguments);this.termExclusionsInputView=new MultipleTextInputView({name:"termExclusions"});this.retrigger(this.termExclusionsInputView,"change",QueryWizardEventNames.STATE_CHANGE);this.brandWebsiteExclusionsInputView=new MultipleTextInputView({name:"brandWebsiteExclusions",validateInput:websiteHelper.validateDomainOrPartialDomain,duplicateEntryText:"This website exclusion already exists"});this.retrigger(this.brandWebsiteExclusionsInputView,"change",QueryWizardEventNames.STATE_CHANGE);this.twitterHandleExclusionsInputContainerView=new TwitterHandlesInputContainerView({name:"twitterHandleExclusions",searchAction:QueryWizardActions.SEARCH_TWITTER_HANDLE_EXCLUSIONS});this.retrigger(this.twitterHandleExclusionsInputContainerView,QueryWizardEventNames.STATE_CHANGE);this.retrigger(this.twitterHandleExclusionsInputContainerView,QueryWizardEventNames.DISPATCH_ACTION);this.retrigger(this.twitterHandleExclusionsInputContainerView,QueryWizardEventNames.TWITTER_AUTH_REQUEST);this.listenTo(this.twitterHandleExclusionsInputContainerView,QueryWizardEventNames.TWITTER_HANDLES_SELECT_CHANGE,twitterHandleSelectionChanged.bind(null,this))},render:function render(data){var templateData=getTemplateData(data);this.snippetData=data.exclusionSnippetData||[];this.$el.html(template(templateData));this.$(VIEW_SELECTORS.TERM_INPUT_EXCLUSIONS).append(this.termExclusionsInputView.$el);this.$(VIEW_SELECTORS.WEBSITE_INPUT_EXCLUSIONS).append(this.brandWebsiteExclusionsInputView.$el);this.$(VIEW_SELECTORS.TWITTER_HANDLE_INPUT_EXCLUSIONS).append(this.twitterHandleExclusionsInputContainerView.$el);softRender(this,data);this.render=softRender.bind(null,this)},remove:function remove(){hideTooltip(this);if(this.termExclusionsInputView){this.termExclusionsInputView.remove();this.termExclusionsInputView=undefined}if(this.brandWebsiteExclusionsInputView){this.brandWebsiteExclusionsInputView.remove();this.brandWebsiteExclusionsInputView=undefined}if(this.twitterHandleExclusionsInputContainerView){this.twitterHandleExclusionsInputContainerView.remove();this.twitterHandleExclusionsInputContainerView=undefined}Backbone.View.prototype.remove.apply(this,arguments)}});mixin(BrandExclusionsStepView,withRetrigger);return BrandExclusionsStepView});define("mustache!src/querywizard/templates/queryVolumeView",["lib/mustache"],function(mustache){var escapedTemplate='<div class="qw-query-volume-step fullheight">\n<div class="query-sampling halfwidth dib mediumtext doublepadding-right">\n<label class="biggertext hugeline db">\nWould you like a smaller sample of mentions?\n</label>\n<a class="querywizard-help-link dib smallpadding-top singlepadding-bottom help" data-key="query-creation-query-sampling">Why is this useful?\n<span class="help icon-bwhelp" data-key="query-creation-query-sampling"></span>\n</a>\n<div class="js-query-sampling"></div>\n</div>\n{{#canSeeUsageChart}}\n<div class="js-usage-chart halfwidth fullheight dib mediumtext doublepadding-left valigntop toolbar--separator"></div>\n{{/canSeeUsageChart}}\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/querywizard/css/queryVolumeStep.css",["css!src/querywizard/css/compiled.css"],function(){});define("src/querywizard/views/QueryVolumeStepView",["underscore","backbone","src/views/QuerySamplingSliderView","src/querybuilder/views/QueryBuilderUsageChartView","src/querywizard/events/QueryWizardEventNames","mustache!src/querywizard/templates/queryVolumeView","css!src/querywizard/css/queryVolumeStep.css","src/packages/waitmask"],function(_,Backbone,QuerySamplingSliderView,QueryBuilderUsageChartView,QueryWizardEventNames,template){"use strict";var VIEW_SELECTORS={USAGE_CHART:".js-usage-chart",QUERY_SAMPLING:".js-query-sampling"};function renderUsageChart(view){var usageChartView=view.usageChartView;if(!usageChartView){return}view.$(VIEW_SELECTORS.USAGE_CHART).html(view.usageChartView.el)}function renderQuerySamplingSliderView(view){view.$(VIEW_SELECTORS.QUERY_SAMPLING).html(view.querySamplingSliderView.el)}function softRenderUsageChart(view,data){if(data.canSeeUsageChart){view.$(VIEW_SELECTORS.USAGE_CHART).hideWaitmask();if(!data.usageChartData){view.$(VIEW_SELECTORS.USAGE_CHART).showWaitmask()}else{view.usageChartView.render(data.usageChartData)}}}function softRenderQuerySamplingSliderView(view,data){var samplingSliderData;var sampledTestsearchResultsMetaData=data.sampledTestsearchResultsMetaData||{};samplingSliderData=_.extend({samplePercent:data.samplePercent},sampledTestsearchResultsMetaData);view.querySamplingSliderView.render(samplingSliderData)}function softRender(view,data){softRenderUsageChart(view,data);softRenderQuerySamplingSliderView(view,data)}var QueryVolumeStepView=Backbone.View.extend({className:"fullheight",constructor:function QueryVolumeStepView(options){var view=this;Backbone.View.apply(this,arguments);this.usageChartView=new QueryBuilderUsageChartView(options);this.querySamplingSliderView=new QuerySamplingSliderView({hideLabel:true,hideHelpIcon:true});this.querySamplingSliderView.on("change",_.throttle(function(value){view.trigger(QueryWizardEventNames.STATE_CHANGE,{samplePercent:value})},100))},render:function render(data){data=data||{};this.$el.html(template(data));if(data.canSeeUsageChart){renderUsageChart(this)}renderQuerySamplingSliderView(this);softRender(this,data);this.render=softRender.bind(null,this)},remove:function remove(){if(this.usageChartView){this.usageChartView.remove();this.usageChartView=undefined}if(this.querySamplingSliderView){this.querySamplingSliderView.remove();this.querySamplingSliderView=undefined}Backbone.View.prototype.remove.call(this)},resize:function resize(data){softRenderUsageChart(this,data)}});return QueryVolumeStepView});define("mustache!src/querywizard/templates/backfillSelectionView",["lib/mustache"],function(mustache){var escapedTemplate='{{#uhdBackfill}}\n<div class="uhd-backfill doublemargin-top">\n<span class="biggertext hugeline">\n<strong>Unlimited Historical Data</strong> will be retrieved back to\n{{initialBackfillLabel}}.\n</span> <a data-key="query-uhd-backfill" class="help icon-bwhelp"></a>\n</div>\n{{/uhdBackfill}}\n{{#allowBackfill}}\n<div class="backfill-selection doublemargin-top">\n<label class="tinymargin-right biggertext hugeline">Retrieve mentions back to</label>\n{{#backfillSelectionToggled}}\n<div class="dib nowrap">\n<select class="js-backfill-duration selectfield twocol tinymargin-right" name="backfillDuration">\n{{#backfillValues}}\n<option value="{{value}}" {{#selected}}selected{{/selected}}>{{label}}</option>\n{{/backfillValues}}\n</select>\n<span class="backfill-hint">({{hint}})</span>\n</div>\n{{/backfillSelectionToggled}}\n{{^backfillSelectionToggled}}\n<span class="js-backfill-toggler" name="backfillSelectionToggled"> {{initialBackfillLabel}} (<a>change</a>)</span>\n{{/backfillSelectionToggled}}\n</div>\n{{/allowBackfill}}\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/querywizard/views/elements/BackfillSelectionView",["underscore","backbone","src/querywizard/helpers/queryWizardEventHelper","mustache!src/querywizard/templates/backfillSelectionView"],function(_,Backbone,queryWizardEventHelper,template){"use strict";var VIEW_SELECTORS={BACKFILL_TOGGLER:".js-backfill-toggler"};function getBackfillHint(backfillDuration){if(!backfillDuration||backfillDuration===1){return"1 Month"}return backfillDuration+" Months"}var BackfillSelectionView=Backbone.View.extend({events:{"click .js-backfill-toggler a":function clickJsBackfillTogglerA(){queryWizardEventHelper.dispatchChange(this,this.$(VIEW_SELECTORS.BACKFILL_TOGGLER),function(){return true})},"change .js-backfill-duration":function changeJsBackfillDuration(e){queryWizardEventHelper.dispatchChange(this,e)}},render:function render(data){data=data||{};var backfillDuration=parseInt(data.backfillDuration,10);this.$el.html(template(_.extend({},data,{selected:function selected(){return this.value===backfillDuration},hint:getBackfillHint(backfillDuration)})))}});return BackfillSelectionView});define("mustache!src/querywizard/templates/brandQueryNameView",["lib/mustache"],function(mustache){var escapedTemplate='<div class="pagemargin-bottom">\n<div class="doublemargin-bottom">\n<label for="queryname" class="biggertext hugeline db smallpadding-bottom">Save as</label>\n<input class="js-query-name field fourcol" type="text" id="queryname" value="{{name}}" name="name" maxlength="1024" data-at="query-wizard-query-name-input"/>\n</div>\n{{^isEdit}}\n{{^canCreateSignals}}\n{{> alertsWithoutSignals}}\n{{/canCreateSignals}}\n{{#canCreateSignals}}\n{{> alertsAndSignals}}\n{{/canCreateSignals}}\n{{/isEdit}}\n<div class="js-backfill-selection"></div>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/querywizard/views/QueryNameStepView",["backbone","src/mixins/mixin","src/mixins/withRetrigger","src/querywizard/helpers/queryWizardEventHelper","src/querywizard/events/QueryWizardEventNames","src/helpers/validationTooltipHelper","src/querywizard/views/elements/BackfillSelectionView","mustache!src/querywizard/templates/brandQueryNameView","text!src/querybuilder/templates/partials/queryBuilderAlertCheckbox.template","text!src/signals/templates/partials/queryBuilderSignalCheckbox.template"],function(Backbone,mixin,withRetrigger,queryWizardEventHelper,QueryWizardEventNames,validationTooltipHelper,BackfillSelectionView,template,queryBuilderAlertCheckboxPartial,queryBuilderSignalCheckboxPartial){"use strict";var VIEW_SELECTORS={BACKFILL_SELECTION:".js-backfill-selection"};function softRender(view,data){view.$(".js-alert-threshold").prop("disabled",!data.createAlert);validationTooltipHelper.showErrorsForForm(data.errors,view.$el);view.backfillSelectionView.render(data)}var QueryNameStepView=Backbone.View.extend({events:{"keyup .js-query-name,.js-alert-threshold":function keyupJsQueryNameJsAlertThreshold(e){queryWizardEventHelper.dispatchChange(this,e)},"change .js-create-alert,.js-create-signal":function changeJsCreateAlertJsCreateSignal(e){queryWizardEventHelper.dispatchChange(this,e)}},constructor:function BrandnameStepView(){Backbone.View.apply(this,arguments);this.backfillSelectionView=new BackfillSelectionView;this.retrigger(this.backfillSelectionView,QueryWizardEventNames.STATE_CHANGE)},render:function render(data){var partials;data=data||{};partials={alertsWithoutSignals:queryBuilderAlertCheckboxPartial,alertsAndSignals:queryBuilderSignalCheckboxPartial};this.$el.html(template(data,partials));this.$(VIEW_SELECTORS.BACKFILL_SELECTION).append(this.backfillSelectionView.$el);softRender(this,data);this.render=softRender.bind(null,this)}});mixin(QueryNameStepView,withRetrigger);return QueryNameStepView});define("mustache!templates/templateIcon",["lib/mustache"],function(mustache){var escapedTemplate='<li class="templateType type dib singlemargin-left singlemargin-top{{#imported}} customtip{{/imported}}" data-type="{{type}}" {{#imported}}title="{{filename}}"{{/imported}}>\n<div class="typeIcon type-icon type-icon-{{type}}" data-at="channels-choose-{{type}}">\n{{#isNew}}\n<span class="newIcon"></span>\n{{/isNew}}\n{{#isAlpha}}\n<span class="alphaIcon"></span>\n{{/isAlpha}}\n{{#isBeta}}\n<span class="betaIcon"></span>\n{{/isBeta}}\n</div>\n<div class="typeNameAndIcon">\n<span class="typeName dib">{{typeName}}</span>\n<span class="js-selected-icon darkgrey iconsmaller"></span>\n</div>\n</li>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!templates/templateSelectionView",["lib/mustache"],function(mustache){var escapedTemplate='<div class="{{bgColorClass}}">\n<ul class="typelist dib singlepadding-horizontal singlepadding-top doublepadding-bottom">\n</ul>\n<div class="footer"></div>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!css/templateSelectionView.css",["css!css/compiled.css"],function(){});define("src/views/TemplateSelectionView",["underscore","jquery","backbone","mustache!templates/templateIcon","mustache!templates/templateSelectionView","css!css/templateSelectionView.css","src/packages/customtip"],function(_,$,Backbone,templateIcon,template){"use strict";function renderTemplateIcon(typeData){var data={imported:typeData.type==="imported",filename:typeData.filename,type:typeData.type,typeName:typeData.name,isNew:typeData.isNew,isAlpha:typeData.isAlpha,isBeta:typeData.isBeta};return templateIcon(data,false)}function getTypeThatGeneratedEvent(e){return $(e.target).closest(".type").data("type")}var DEFAULT_BG_COLOR_CLASS="lightgreybg";var TemplateSelectionView=Backbone.View.extend({className:"template-selection-view",selectedType:null,currentType:null,events:{"click .type":"_onClickSetType","mouseenter .type":"_onMouseEnterType","mouseleave .type":"_onMouseLeaveType"},constructor:function TemplateSelectionView(options){Backbone.View.apply(this,arguments);this.selectedType=options.selectedType;this.types=options.types;this.footer=options.footer;this.palette=options.palette;this.bgColorClass=options.bgColorClass||DEFAULT_BG_COLOR_CLASS},render:function render(){this.$el.html(template({bgColorClass:this.bgColorClass}));this._appendToTemplateList(this.types);this._renderSelectedTemplate(this.selectedType);if(this.footer){this.$(".footer").append(this.footer)}if(this.palette){this.$el.addClass(this.className+"--"+this.palette)}},_renderSelectedTemplate:function _renderSelectedTemplate(type){this.resetSelection();this.$(".type").filter("[data-type="+type+"]").addClass("selected").find(".js-selected-icon").addClass("icon-ok")},selectTemplate:function selectTemplate(type){var dashboardConfig=_(this.types).findWhere({type:type});if(dashboardConfig.isPromo){this.trigger("selectedPromotedType",{type:type});return}this._renderSelectedTemplate(type);this.trigger("selectedTypeChanged",{type:type,hasAnnotations:dashboardConfig.hasAnnotations})},resetSelection:function resetSelection(){this.$(".type .js-selected-icon").removeClass("icon-ok");this.$(".type").removeClass("selected")},appendTemplate:function appendTemplate(typeData){this.types=this.types.concat([typeData]);this.render();this.$(".type[data-type="+typeData.type+"]").customtip()},removeTemplate:function removeTemplate(typeToRemove){this.$(".type[data-type="+typeToRemove+"]").remove();this.types=this.types.filter(function(t){return t.type!==typeToRemove})},_appendToTemplateList:function _appendToTemplateList(types){var $listMarkup=$(types.map(renderTemplateIcon).join("\n"));this.$(".typelist").append($listMarkup);return $listMarkup},_onClickSetType:function _onClickSetType(e){this.selectTemplate(getTypeThatGeneratedEvent(e))},_onMouseEnterType:function _onMouseEnterType(e){var type=getTypeThatGeneratedEvent(e);this.trigger("mouseEnteredTemplate",type)},_onMouseLeaveType:function _onMouseLeaveType(){this.trigger("mouseLeftTemplate")}});return TemplateSelectionView});define("src/querywizard/QueryWizardSetups",[],function(){"use strict";var setupTypes={BRAND_MONITORING:"BRAND_MONITORING",CAMPAIGN_TRACKING:"CAMPAIGN_TRACKING"};var allowedTypesByUsecase={brand:[setupTypes.BRAND_MONITORING],hashtag:[setupTypes.CAMPAIGN_TRACKING]};var defaultTypeByUsecase={brand:setupTypes.BRAND_MONITORING,hashtag:setupTypes.CAMPAIGN_TRACKING};return{types:setupTypes,allowedTypesByUsecase:allowedTypesByUsecase,defaultTypeByUsecase:defaultTypeByUsecase}});define("mustache!src/querywizard/templates/setupStoreEntryView",["lib/mustache"],function(mustache){var escapedTemplate='<div class="doublepadding halfwidth lightgreybg">\n<div class=" dib biggertext hugeline doublepadding-bottom">Build a custom {{templateName}} Dashboard</div>\n\n{{#hasAllowedSetupTemplates}}\n<div class="setup-template-container">\n<div class="js-setup-selection template-selection-view valignmiddle dib"></div>\n<section class="js-type-info singlepadding-horizontal mediumtext-bigline valignmiddle dib">{{{templateDescription}}}</section>\n</div>\n{{/hasAllowedSetupTemplates}}\n\n<button type="button" class="js-create-setup defaultbutton doublemargin-top singlemargin-bottom"{{^valid}} disabled{{/valid}}>Yes, continue with Dashboard Wizard</button>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/querywizard/views/QuerySetupStoreEntryStepView",["backbone","underscore","src/views/TemplateSelectionView","src/querywizard/QueryWizardSetups","src/querywizard/events/QueryWizardEventNames","mustache!src/querywizard/templates/setupStoreEntryView"],function(Backbone,_,TemplateSelectionView,QueryWizardSetups,QueryWizardEventNames,template){"use strict";var VIEW_SELECTORS={SETUP_SELECTION:".js-setup-selection",TYPE_INFO:".js-type-info"};function getSetupTypes(setupTemplates,allowedSetupTypes){if(!setupTemplates||!setupTemplates.length||!allowedSetupTypes){return[]}setupTemplates=setupTemplates.filter(function(template){return allowedSetupTypes.indexOf(template.templateType)>-1});return setupTemplates.map(function(template){return{type:template.templateType,name:template.name||_.titleize(template.templateType)}})}function onSelectionTypeChanged(view,props){view.trigger(QueryWizardEventNames.STATE_CHANGE,{setupType:props.type})}var QuerySetupStoreEntryStepView=Backbone.View.extend({events:{"click .js-create-setup":function clickJsCreateSetup(){this.trigger(QueryWizardEventNames.CREATE_SETUP)}},render:function render(data){var allowedSetupTypes=QueryWizardSetups.allowedTypesByUsecase[data.usecase];var selectedTemplate=_(data.setupTemplates).findWhere({templateType:data.setupType});var templateDescription=selectedTemplate?selectedTemplate.description:"";var templateName=selectedTemplate?selectedTemplate.name:"";var setupTypes=getSetupTypes(data.setupTemplates,allowedSetupTypes);var templateData=_.extend({},data,{templateName:templateName,templateDescription:templateDescription,hasAllowedSetupTemplates:!!setupTypes.length});this.$el.html(template(templateData));if(!setupTypes.length){return}this.setupTemplateSelectionView=new TemplateSelectionView({types:setupTypes,selectedType:data.setupType,palette:"setups"});this.listenTo(this.setupTemplateSelectionView,"selectedTypeChanged",onSelectionTypeChanged.bind(null,this));this.setupTemplateSelectionView.render();this.$(VIEW_SELECTORS.SETUP_SELECTION).append(this.setupTemplateSelectionView.$el)}});return QuerySetupStoreEntryStepView});(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==="object"&&typeof module==="object")module.exports=factory(require("underscore"));else if(typeof define==="function"&&define.amd)define("bw-fe-helpers/possessionHelper",["underscore"],factory);else{var a=typeof exports==="object"?factory(require("underscore")):factory(root["underscore"]);for(var i in a)(typeof exports==="object"?exports:root)[i]=a[i]}})(this,function(__WEBPACK_EXTERNAL_MODULE__1__){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=28)}({1:function(module,exports){module.exports=__WEBPACK_EXTERNAL_MODULE__1__},28:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var underscore__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1);var underscore__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(underscore__WEBPACK_IMPORTED_MODULE_0__);function addApostrophe(string){var characters=string.slice(-2).split("");if(characters[1]==="'"){return string}if(underscore__WEBPACK_IMPORTED_MODULE_0___default.a.contains(["'","","`"],characters[0])&&characters[1]==="s"){return string}if(characters[1]==="s"){return string+"'"}return string+"'s"}__webpack_exports__["default"]={addApostrophe:addApostrophe}}})["default"]});define("src/querywizard/QueryWizardStepConfig",["underscore","src/querywizard/QueryWizardSteps","src/querywizard/views/SelectionStepView","src/querywizard/views/HashtagCampaignStepView","src/querywizard/views/HashtagCampaignExclusionsStepView","src/querywizard/views/BrandNameStepView","src/querywizard/views/BrandProductNamesStepView","src/querywizard/views/BrandOwnedMediaStepView","src/querywizard/views/BrandExclusionsStepView","src/querywizard/views/QueryVolumeStepView","src/querywizard/views/QueryNameStepView","src/querywizard/views/QuerySetupStoreEntryStepView","bw-fe-helpers/possessionHelper"],function(_,QueryWizardSteps,SelectionStepView,HashtagCampaignStepView,HashtagCampaignExclusionsStepView,BrandNameStepView,BrandProductNamesStepView,BrandOwnedMediaStepView,BrandExclusionsStepView,QueryVolumeStepView,QueryNameStepView,QuerySetupStoreEntryStepView,possessionHelper){"use strict";var config={};function applyStepConfigDefaults(config){var stepConfigDefaults={hasTestSearch:true,fetchTwitterHandlesOnStepExit:false,fetchRecommendationsOnStepExit:false,hasQuerySummaryView:false,hasQuerySneakView:false,progressTrackerTitle:false,isSaveStep:false};Object.keys(config).forEach(function(key){_.defaults(config[key],stepConfigDefaults)})}function getConfig(property,stepKey,state){if(typeof config[stepKey]==="undefined"){throw new Error('Step "'+stepKey+'" not defined in View Config. Please add View config.')}if(typeof config[stepKey][property]==="undefined"){throw new Error('Property "'+property+'" not defined in View Config for step "'+stepKey+'". Please add View config.')}if(["stepTitleNew","stepTitleEdit"].indexOf(property)>-1&&typeof config[stepKey][property]==="function"){return config[stepKey][property](state)}return config[stepKey][property]}function stepTitleNew(brandName){var newBrandName=brandName;return _.capitalize(possessionHelper.addApostrophe(newBrandName))+" Products"}function stepTitleEdit(brandName){return"Edit "+stepTitleNew(brandName)}config[QueryWizardSteps.USECASE_SELECTION]={stepTitleNew:"New Query",stepTitleEdit:"Edit your Query",progressTrackerTitle:"Start",view:SelectionStepView,hasQuerySneakView:true,hasTestSearch:false};config[QueryWizardSteps.HASHTAG_CAMPAIGN]={stepTitleNew:"About the Campaign",stepTitleEdit:"Edit the Campaign",progressTrackerTitle:"Campaign",view:HashtagCampaignStepView,hasQuerySneakView:true};config[QueryWizardSteps.HASHTAG_CAMPAIGN_EXCLUSIONS]={stepTitleNew:"Refine your Campaign Query",stepTitleEdit:"Refine your Campaign Query",progressTrackerTitle:"Refine",view:HashtagCampaignExclusionsStepView,hasQuerySneakView:true};config[QueryWizardSteps.HASHTAG_VOLUME]={stepTitleNew:"Check your Data Usage",stepTitleEdit:"Check your Data Usage",progressTrackerTitle:"Volume",view:QueryVolumeStepView,hasTestSearch:false,hasQuerySneakView:true};config[QueryWizardSteps.HASHTAG_CAMPAIGN_QUERYNAME]={stepTitleNew:"Name your Campaign Query",stepTitleEdit:"Edit your Campaign Query Name",progressTrackerTitle:"Save",view:QueryNameStepView,hasTestSearch:false,hasQuerySummaryView:true,isSaveStep:true};config[QueryWizardSteps.HASHTAG_CAMPAIGN_SETUPSTORE_ENTRY]={stepTitleNew:"Your Campaign Query has been saved. What's next?",stepTitleEdit:"",view:QuerySetupStoreEntryStepView,hasTestSearch:false,hasQuerySummaryView:false};config[QueryWizardSteps.BRAND_BRANDNAME]={stepTitleNew:"About the Brand",stepTitleEdit:"Edit the Brand",progressTrackerTitle:"Brand",view:BrandNameStepView,fetchTwitterHandlesOnStepExit:true,fetchRecommendationsOnStepExit:true,hasQuerySneakView:true};config[QueryWizardSteps.BRAND_PRODUCTNAMES]={stepTitleNew:stepTitleNew,stepTitleEdit:stepTitleEdit,progressTrackerTitle:"Products",view:BrandProductNamesStepView,hasQuerySneakView:true};config[QueryWizardSteps.BRAND_OWNED_MEDIA]={stepTitleNew:"Media References",stepTitleEdit:"Edit Media References",progressTrackerTitle:"Media",view:BrandOwnedMediaStepView,hasQuerySneakView:true};config[QueryWizardSteps.BRAND_EXCLUSIONS]={stepTitleNew:"Refine your Brand Query",stepTitleEdit:"Refine your Brand Query",progressTrackerTitle:"Refine",view:BrandExclusionsStepView,hasQuerySneakView:true};config[QueryWizardSteps.BRAND_VOLUME]={stepTitleNew:"Check your Data Usage",stepTitleEdit:"Check your Data Usage",progressTrackerTitle:"Volume",view:QueryVolumeStepView,hasTestSearch:false,hasQuerySneakView:true};config[QueryWizardSteps.BRAND_QUERYNAME]={stepTitleNew:"Name your Brand Query",stepTitleEdit:"Edit your Brand Query Name",progressTrackerTitle:"Save",view:QueryNameStepView,hasTestSearch:false,hasQuerySummaryView:true,isSaveStep:true};config[QueryWizardSteps.BRAND_SETUPSTORE_ENTRY]={stepTitleNew:"Your Brand Query has been saved. What's next?",stepTitleEdit:"",view:QuerySetupStoreEntryStepView,hasTestSearch:false,hasQuerySummaryView:false};applyStepConfigDefaults(config);return{getView:getConfig.bind(null,"view"),getStepTitleNew:getConfig.bind(null,"stepTitleNew"),getStepTitleEdit:getConfig.bind(null,"stepTitleEdit"),getProgressTrackerTitle:getConfig.bind(null,"progressTrackerTitle"),hasQuerySneakView:getConfig.bind(null,"hasQuerySneakView"),hasQuerySummaryView:getConfig.bind(null,"hasQuerySummaryView"),fetchTwitterHandlesOnStepExit:getConfig.bind(null,"fetchTwitterHandlesOnStepExit"),fetchRecommendationsOnStepExit:getConfig.bind(null,"fetchRecommendationsOnStepExit"),hasTestSearch:getConfig.bind(null,"hasTestSearch"),isSaveStep:getConfig.bind(null,"isSaveStep")}});define("src/querywizard/QueryWizardFlow",["src/querywizard/QueryWizardStepConfig"],function(QueryWizardStepConfig){"use strict";function isSaveStep(step){return!!QueryWizardStepConfig.isSaveStep(step)}function isBeforeSetupStoreEntryStep(step,direction){return direction==="next"&&isSaveStep(step)}function getNewStep(transitions,state,direction,currentStep){var currentStepTransition=transitions[currentStep];var newStep;if(!direction){throw new Error("direction must be defined")}if(!currentStepTransition){throw new Error('Cannot find step "'+currentStep+'"')}newStep=currentStepTransition[direction];if(typeof newStep==="function"){newStep=newStep(state)}return newStep}return{init:function init(transitions,state){var initialStep=transitions.initial;if(!initialStep){throw new Error('Transitions do not specify "initial" step')}if(typeof initialStep==="function"){initialStep=initialStep(state)}if(!transitions[initialStep]){throw new Error('step "'+initialStep+'" does not exist')}return{stepKey:initialStep,isFirst:true,isSetupStoreEntryStep:false,isSaveStep:false,hasConfirmStepNext:false}},transit:function transit(transitions,state,direction){var currentStep=state.stepKey;var newStep;var afterNewStep;if(!state){throw new Error("state must be defined")}newStep=getNewStep(transitions,state,direction,currentStep);if(!newStep){throw new Error('Cannot transition from "'+currentStep+'" to direction "'+direction+'"')}afterNewStep=getNewStep(transitions,state,"next",newStep);return{stepKey:newStep,isFirst:!transitions[newStep].prev&&!isBeforeSetupStoreEntryStep(currentStep,direction),isSetupStoreEntryStep:isBeforeSetupStoreEntryStep(currentStep,direction),isSaveStep:isSaveStep(newStep),hasConfirmStepNext:isSaveStep(newStep)&&!!afterNewStep}}}});define("src/querywizard/QueryWizardTransitions",["src/querywizard/QueryWizardSetups","src/querywizard/QueryWizardSteps"],function(QueryWizardSetups,QueryWizardSteps){"use strict";var transitions={};var initialStep=function initialStep(){return QueryWizardSteps["USECASE_SELECTION"]};var nextUsecase=function nextUsecase(state){var usecase=state.usecase;if(usecase==="hashtag"){return QueryWizardSteps.HASHTAG_CAMPAIGN}if(usecase==="brand"){return QueryWizardSteps.BRAND_BRANDNAME}throw new Error('Unknown usecase "'+usecase+'". Please add usecase transitions')};var getStepAfterSaving=function getStepAfterSaving(setupstoreEntryStep,state){var isNew=!state.id;var allowedSetupTypes=QueryWizardSetups.allowedTypesByUsecase[state.usecase];var allowedSetupTemplates;if(!allowedSetupTypes){return undefined}allowedSetupTemplates=state.setupTemplates.filter(function(template){return allowedSetupTypes.indexOf(template.templateType)>-1});if(!isNew||!allowedSetupTemplates.length){return undefined}return setupstoreEntryStep};transitions[QueryWizardSteps.INITIAL]=initialStep;transitions[QueryWizardSteps.USECASE_SELECTION]={prev:undefined,next:nextUsecase};transitions[QueryWizardSteps.HASHTAG_CAMPAIGN]={prev:initialStep,next:QueryWizardSteps.HASHTAG_CAMPAIGN_EXCLUSIONS};transitions[QueryWizardSteps.HASHTAG_CAMPAIGN_EXCLUSIONS]={prev:QueryWizardSteps.HASHTAG_CAMPAIGN,next:QueryWizardSteps.HASHTAG_VOLUME};transitions[QueryWizardSteps.HASHTAG_VOLUME]={prev:QueryWizardSteps.HASHTAG_CAMPAIGN_EXCLUSIONS,next:QueryWizardSteps.HASHTAG_CAMPAIGN_QUERYNAME};transitions[QueryWizardSteps.HASHTAG_CAMPAIGN_QUERYNAME]={prev:QueryWizardSteps.HASHTAG_VOLUME,next:getStepAfterSaving.bind(null,QueryWizardSteps.HASHTAG_CAMPAIGN_SETUPSTORE_ENTRY)};transitions[QueryWizardSteps.HASHTAG_CAMPAIGN_SETUPSTORE_ENTRY]={prev:undefined,next:undefined};transitions[QueryWizardSteps.BRAND_BRANDNAME]={prev:initialStep,next:QueryWizardSteps.BRAND_PRODUCTNAMES};transitions[QueryWizardSteps.BRAND_PRODUCTNAMES]={prev:QueryWizardSteps.BRAND_BRANDNAME,next:QueryWizardSteps.BRAND_OWNED_MEDIA};transitions[QueryWizardSteps.BRAND_OWNED_MEDIA]={prev:QueryWizardSteps.BRAND_PRODUCTNAMES,next:QueryWizardSteps.BRAND_EXCLUSIONS};transitions[QueryWizardSteps.BRAND_EXCLUSIONS]={prev:QueryWizardSteps.BRAND_OWNED_MEDIA,next:QueryWizardSteps.BRAND_VOLUME};transitions[QueryWizardSteps.BRAND_VOLUME]={prev:QueryWizardSteps.BRAND_EXCLUSIONS,next:QueryWizardSteps.BRAND_QUERYNAME};transitions[QueryWizardSteps.BRAND_QUERYNAME]={prev:QueryWizardSteps.BRAND_VOLUME,next:getStepAfterSaving.bind(null,QueryWizardSteps.BRAND_SETUPSTORE_ENTRY)};transitions[QueryWizardSteps.BRAND_SETUPSTORE_ENTRY]={prev:undefined,next:undefined};return transitions});define("src/querywizard/QueryWizardReducers",["underscore","bw-fe-helpers/urlHelper","bw-fe-helpers/validationHelpers","src/ApiError","src/models/Query","src/querybuilder/QueryBuilderUsageDataHelper","src/querywizard/QueryWizardSetups","src/querywizard/QueryWizardSteps","src/querywizard/QueryWizardStepConfig","src/querywizard/QueryWizardTransitions","src/querywizard/QueryWizardFlow","src/querywizard/models/WizardQuery","src/querywizard/helpers/queryWizardQueryHelper"],function(_,urlHelper,validationHelpers,ApiError,Query,QueryBuilderUsageDataHelper,QueryWizardSetups,QueryWizardSteps,QueryWizardStepConfig,QueryWizardTransitions,QueryWizardFlow,WizardQuery,queryWizardQueryHelper){"use strict";var reducers={};var DEFAULT_PROGRESS_TRACKER_STEPS=[{title:"Start",isActive:true,isVisited:true,isFirst:true},{title:"Save",isActive:false,isVisited:false,isFirst:false}];function byLabel(itemA,itemB){if(itemA.label<itemB.label){return-1}if(itemA.label>itemB.label){return 1}return 0}function getPropsToReset(){var inputProps=WizardQuery.WIZARD_ATTRIBUTES.concat("name").map(function(propName){return[propName,propName+"Edited"]});return _.flatten(inputProps).concat("includedTerms","languageAgnostic","languages")}function stripAtSignFormTwitterHandle(handle){if(handle.charAt(0)==="@"){return handle.slice(1)}return handle}function hasLanguageListChanged(stateLang,propsLang){stateLang=stateLang||[];propsLang=propsLang||[];if(stateLang.length!==propsLang.length){return true}if(_.intersection(stateLang,propsLang).length!==stateLang.length){return true}return false}function haveLanguagesChanged(state,props,newState){var haveLanguagesPropsChanged=props.languages&&hasLanguageListChanged(state.languages,props.languages);var haveLanguagesNewStateChanged=newState.languages&&hasLanguageListChanged(state.languages,newState.languages);var haveLanguagesChanged=haveLanguagesPropsChanged||haveLanguagesNewStateChanged;var hasLanguageAgnosticPropsChanged=props.languageAgnostic!==undefined&&state.languageAgnostic!==props.languageAgnostic;var hasLanguageAgnosticNewStateChanged=newState.languageAgnostic!==undefined&&state.languageAgnostic!==newState.languageAgnostic;var hasLanguageAgnosticChanged=hasLanguageAgnosticPropsChanged||hasLanguageAgnosticNewStateChanged;return!!(haveLanguagesChanged||hasLanguageAgnosticChanged)}function getLanguageLabel(state){var langCode=Array.isArray(state.languages)?state.languages[0]:state.languages;var language=_(state.languageData).find(function(language){return language.value===langCode});if(!language){return"your selected language"}return language.label}function getExclusionSnippetsNotification(state){var hasMultipleLanguages=!validationHelpers.isNullOrEmptyArray(state.languages)&&state.languages.length>1;var languageLabel=getLanguageLabel(state);if(hasMultipleLanguages&&!state.topicsExclusionOnlyAvailableForSingleLanguageShown){return{reason:"Please note: Topic exclusion are only available for single languages.",type:"warning",stateDataOnRemove:{topicsExclusionOnlyAvailableForSingleLanguageShown:true}}}if(state.exclusionSnippetsIsLoading){return}if(!state.exclusionSnippetsReset){return}if(!validationHelpers.isNullOrEmptyArray(state.exclusionSnippets)){return}if(hasMultipleLanguages||!state.exclusionSnippetData||!Object.keys(state.exclusionSnippetData).length){return}if(state.topicsExclusionsNeedToBeReselectedShown){return}return{reason:"We've translated your selected topic exclusions into "+languageLabel+" but they were exceeding your Query character limit. "+"You can reselect topic exclusions for "+languageLabel+" in the Refine step.",type:"warning",stateDataOnRemove:{topicsExclusionsNeedToBeReselectedShown:true}}}function getUniqueHashtags(hashtags){return _.uniq(hashtags.map(function(hashtag){return queryWizardQueryHelper.removeHashtagSign(hashtag.toLowerCase())}))}function getNormalizedUrls(urls){var normalizedLinks=(urls||[]).map(function(link){return link.toLowerCase()}).map(urlHelper.removeProtocolAndWwwSubdomain).map(urlHelper.trimTrailingSlash);return _.uniq(normalizedLinks)}function hasQueryChanged(state,reducedProps){return state.includedTerms!==reducedProps.includedTerms}function getProgressTrackerSteps(state){var currentStep=QueryWizardFlow.init(QueryWizardTransitions,state);var currentStepTitle;var steps=[];var isActive;var isVisited=true;if(!state.usecase){return DEFAULT_PROGRESS_TRACKER_STEPS}while(currentStep){isActive=currentStep.stepKey===state.stepKey;currentStepTitle=QueryWizardStepConfig.getProgressTrackerTitle(currentStep.stepKey);if(currentStepTitle){steps.push({title:currentStepTitle,isActive:isActive,isVisited:isVisited,isFirst:false})}if(currentStep.stepKey===state.stepKey){isVisited=false}try{var fakedStep={id:state.id,stepKey:currentStep.stepKey,usecase:state.usecase,setupTemplates:state.setupTemplates};currentStep=QueryWizardFlow.transit(QueryWizardTransitions,fakedStep,"next")}catch(e){currentStep=undefined}}steps[0].isFirst=true;return steps}function canSeeUsageChart(state){if(!!state.id||state.projectUsageSummary&&state.projectUsageSummary.legacy){return false}return true}function joinInvalidNotificationsMessages(notifications){return _(notifications).filter(function(notification){return notification&&notification.type==="error"}).map(function(notification){return notification.reason}).join(" ")}function getGlobalNotificationsProps(state){var newState={notifications:{sample:null,queryLength:null}};if(!state.reSavingSampleQueryWarningShown&&state.id&&state.samplePercent<100){newState.notifications.sample={reason:"Re-Saving this Query will affect your sample of historic data",type:"warning",keepOnTransit:true,stateDataOnRemove:{reSavingSampleQueryWarningShown:true}}}if(!state.queryLengthExceededWarningShown||QueryWizardStepConfig.isSaveStep(state.stepKey)){if(queryWizardQueryHelper.isOverLengthLimit(state)){newState.notifications.queryLength={reason:"Your Query exceeds the "+Query.queryTextMaxLength+" character limit. "+"Please review your inputs to save it.",type:QueryWizardStepConfig.isSaveStep(state.stepKey)?"error":"warning",keepOnTransit:true,stateDataOnRemove:{queryLengthExceededWarningShown:true}}}}if(QueryWizardStepConfig.isSaveStep(state.stepKey)){newState.invalidNotificationsSummary=joinInvalidNotificationsMessages(newState.notifications)}return newState}function getTestsearchResultsProps(state,queryCreationRules){var newState={};var samplePercent=state.samplePercent||100;var sampledEstimates;var canCreateNewQueryResults;if(!state.isLoadingTestsearchResults){newState.hasLoadingNotificationTimedOut=false}if(state.isLoadingTestsearchResults||!state.testsearchResultsMetaData){newState.sampledTestsearchResultsMetaData=null;return newState}sampledEstimates={estimatedDailyResults:Math.floor(state.testsearchResultsMetaData.estimatedDailyResults*samplePercent/100),estimatedMonthlyResults:Math.floor(state.testsearchResultsMetaData.estimatedMonthlyResults*samplePercent/100)};canCreateNewQueryResults=queryCreationRules.checkCanCreateNewQueryWithTheseSearchResults(sampledEstimates);newState.sampledTestsearchResultsMetaData=_.extend({},sampledEstimates,{canCreateNewQueryResults:canCreateNewQueryResults,isOverDailyMentionLimit:queryCreationRules.isOverDailyMentionLimit(sampledEstimates.estimatedDailyResults),isOverMonthlyMentionLimit:canCreateNewQueryResults.reason==="likelyToBreachMonthlyMentionsLimit"});return newState}function getTestsearchNotificationsProps(state){var newState={};var canCreateNewQueryResults;var stateDataOnRemove={};if(state.isLoadingTestsearchResults&&state.hasLoadingNotificationTimedOut&&state.showTestsearchNotification){newState.notifications={testsearch:{reason:"Estimating your Mentions volume&hellip;",type:"info",keepOnTransit:true}};return newState}if(state.isLoadingTestsearchResults||!state.sampledTestsearchResultsMetaData||!state.showTestsearchNotification){newState.notifications={testsearch:null};return newState}if(state.sampledTestsearchResultsMetaData.isOverDailyMentionLimit){newState.notifications={testsearch:{reason:"This Query will return more than 1 million mentions per day. "+'Please change your Query or reduce the "Sample of mentions".',type:"error",keepOnTransit:true}};return newState}canCreateNewQueryResults=state.sampledTestsearchResultsMetaData.canCreateNewQueryResults||{};if(canCreateNewQueryResults.reason&&!state[canCreateNewQueryResults.reason+"Shown"]){if(canCreateNewQueryResults.isAllowed){stateDataOnRemove[canCreateNewQueryResults.reason+"Shown"]=true}newState.notifications={testsearch:{reason:canCreateNewQueryResults.reason,reasonData:canCreateNewQueryResults.data,type:canCreateNewQueryResults.isAllowed?"warning":"error",keepOnTransit:true,stateDataOnRemove:stateDataOnRemove}};return newState}return{notifications:{testsearch:null}}}function getUsageChartDataProps(state){var usageDataHelper;var newState={};newState.canSeeUsageChart=canSeeUsageChart(state);if(state.sampledTestsearchResultsMetaData&&newState.canSeeUsageChart){usageDataHelper=new QueryBuilderUsageDataHelper(state.projectUsageSummary);usageDataHelper.setMonthlyEstimate(state.sampledTestsearchResultsMetaData.estimatedMonthlyResults);newState.usageChartData=usageDataHelper.getUsageChartData();newState.analyticsData=usageDataHelper.getAnalyticsData()}else{newState.usageChartData=null}return newState}function getTwitterHandleDataProps(state){var newState={twitterHandleData:state.twitterHandleData,twitterHandleExclusionData:state.twitterHandleExclusionData};var twitterHandleData;var waitForSuggestion;if(newState.twitterHandleData){twitterHandleData=newState.twitterHandleData;newState.twitterHandleData.serverError=twitterHandleData.lookupError||twitterHandleData.searchError;waitForSuggestion=twitterHandleData.isSearchCollectionLoading&&!state.isEdit&&!state.twitterHandlesEdited;newState.twitterHandleData.showWaitmask=twitterHandleData.isSelectedCollectionLoading||waitForSuggestion}if(newState.twitterHandleExclusionData){twitterHandleData=newState.twitterHandleExclusionData;newState.twitterHandleExclusionData.serverError=twitterHandleData.lookupError||twitterHandleData.searchError;newState.twitterHandleExclusionData.showWaitmask=twitterHandleData.isSelectedCollectionLoading}return newState}function defaultReducer(state,props){return _.extend({},state,props)}function reduceStateWithNotifications(state,props){var stateNotifications=state.notifications||{};var propsNotifications=props.notifications||{};return _.extend(state,props,{notifications:_.extend({},stateNotifications,propsNotifications)})}function appReducer(state,queryCreationRules){var newState={};var reducedProps={};reducedProps.includedTerms=queryWizardQueryHelper.buildQueryString(state);reducedProps.optimisedIncludedTerms=queryWizardQueryHelper.buildOptimisedQueryString(state);reducedProps.querySneakViewVisible=QueryWizardStepConfig.hasQuerySneakView(state.stepKey)&&!!reducedProps.includedTerms;reducedProps.testSearchVisible=QueryWizardStepConfig.hasTestSearch(state.stepKey);reducedProps.querySummaryVisible=QueryWizardStepConfig.hasQuerySummaryView(state.stepKey);reducedProps.hasQueryChanged=hasQueryChanged(state,reducedProps);reducedProps.isEdit=!!state.id;reducedProps.isSampleQueryEdit=reducedProps.isEdit&&state.samplePercent<100;reducedProps.progressTrackerSteps=getProgressTrackerSteps(state);newState=_.extend(newState,state,reducedProps);newState=reduceStateWithNotifications(newState,getGlobalNotificationsProps(newState));newState=reduceStateWithNotifications(newState,getTestsearchResultsProps(newState,queryCreationRules));newState=reduceStateWithNotifications(newState,getTestsearchNotificationsProps(newState));newState=reduceStateWithNotifications(newState,getUsageChartDataProps(newState));newState=reduceStateWithNotifications(newState,getTwitterHandleDataProps(newState));return newState}function getNewLocationProps(state,props){var newState={};if(state.locationAgnostic===undefined&&props.locationAgnostic===undefined){newState.locationAgnostic=!state.locations||!state.locations.length}if(props.locationAgnostic){newState.locations=[];newState.searchLocationData=[];newState.selectedLocationData=[]}if(props.locationError){newState.serverError=new ApiError(props.locationError).message}return newState}function getNewLanguageProps(state,props){var newState={};if(props.languageAgnostic){newState.exclusionSnippets=undefined;newState.exclusionSnippetsReset=undefined;newState.languages=WizardQuery.getDefaults().languages}if(props.exclusionSnippetData){if(!validationHelpers.isNullOrEmptyArray(state.exclusionSnippets)){if(queryWizardQueryHelper.isOverLengthLimit(_.extend({},state,newState,props))){newState.exclusionSnippets=undefined;newState.exclusionSnippetsReset=true}}}if(props.languageData&&state.languageData!==props.languageData){newState.languageData=props.languageData.map(function(item){return{label:item.name,value:item.code,data:{shortName:item.name}}});newState.languageData.sort(byLabel)}newState.notifications={exclusionSnippets:getExclusionSnippetsNotification(_.extend({},state,props,newState))};newState.haveLanguagesChanged=haveLanguagesChanged(state,props,newState);return newState}function usecaseSelectionViewReducer(state,props){var newState={};var locationState;var languageState;if(props.usecase&&state.usecase!==props.usecase){var defaults=WizardQuery.getDefaults();newState.usecaseChanged=true;getPropsToReset().forEach(function(propName){newState[propName]=defaults[propName]});newState.languageAgnostic=newState.languageAgnostic||props.usecase==="hashtag";newState.locationAgnostic=true}else{newState.usecaseChanged=false}newState.setupType=QueryWizardSetups.defaultTypeByUsecase[props.usecase||state.usecase];locationState=getNewLocationProps(state,_.extend({},props,newState));languageState=getNewLanguageProps(state,_.extend({},props,newState));return _.extend({},state,props,newState,locationState,languageState)}function hashtagCampaignViewReducer(state,props){var newState=_.extend({},state,props);if(props.hashtag){newState.hashtag=getUniqueHashtags(props.hashtag)}if(!props.hashtagAmbiguous&&props.hashtagAmbiguousEdited){newState.hashtagContextTerms=[]}if(props.hashtagLinks){newState.hashtagLinks=getNormalizedUrls(props.hashtagLinks)}return newState}function getTwitterHandleSuggestionData(state,props){var newState=_.clone(props);var twitterHandleData=props.twitterHandleData;var searchData=twitterHandleData.searchData;var isSearchDataEmpty=!searchData||!searchData.length;var isTwitterHandlesEmpty=!props.twitterHandles||!props.twitterHandles.length;var firstTwitterHandleResult;if(!state.id&&!isSearchDataEmpty&&!props.twitterHandlesEdited&&isTwitterHandlesEmpty){firstTwitterHandleResult=_(searchData).find(function(handle){return handle.sources.indexOf("twitterAPI")>-1});newState.twitterHandles=[firstTwitterHandleResult.value];newState.twitterHandleData.selectedData=[firstTwitterHandleResult]}return _.extend({},state,props,newState)}function getTwitterHandleSearchData(twitterHandleData){var count=0;if(!twitterHandleData.sourceData){return twitterHandleData.searchData}return twitterHandleData.sourceData.filter(function(handle,index){var isFromRecommendationsAPI=handle.sources.indexOf("brandwatchRecommendationsAPI")>-1;var isHandleSelected;handle.originalIndex=index;if(isFromRecommendationsAPI){isHandleSelected=_(twitterHandleData.selectedData).findWhere({value:handle.value});if(!isHandleSelected&&count<3){count+=1;return true}}return handle.sources.indexOf("twitterAPI")>-1})}function sortTwitterHandleSearchData(twitterHandleSearchData){return twitterHandleSearchData.sort(function(handleA,handleB){if(handleA.sources.length!==handleB.sources.length){return handleB.sources.length-handleA.sources.length}if(_.union(handleA.sources,handleB.sources).length===handleA.sources.length){return handleA.originalIndex-handleB.originalIndex}if(handleA.sources.length&&handleA.sources[0]!=="brandwatchRecommendationsAPI"){return 1}return-1})}function getTwitterHandleProps(state,props){var newState={twitterHandleData:_.extend({},state.twitterHandleData,props.twitterHandleData)};if(props.twitterHandles){if(newState.twitterHandleData){newState.twitterHandleData.tagValues=props.twitterHandles}else{newState.twitterHandleData={tagValues:props.twitterHandles}}}if(newState.twitterHandleData.sourceData){newState.twitterHandleData.searchData=sortTwitterHandleSearchData(getTwitterHandleSearchData(newState.twitterHandleData))}if(props.twitterHandleData){newState=_.extend({},newState,getTwitterHandleSuggestionData(state,_.extend({},props,newState)))}return newState}function brandOwnedMediaReducer(state,props){var newState=_.extend({},state,props);var twitterHandleState;if(props.brandWebsites){newState.brandWebsites=getNormalizedUrls(props.brandWebsites)}if(newState.websiteRecommendations){newState.websiteRecommendations.data=_.difference(newState.websiteRecommendations.data,newState.brandWebsites)}if(props.brandHashtags){newState.brandHashtags=getUniqueHashtags(props.brandHashtags)}if(newState.hashtagRecommendations){newState.hashtagRecommendations.data=_.difference(newState.hashtagRecommendations.data,newState.brandHashtags)}if(props.twitterHandles){newState.twitterHandles=_.uniq(props.twitterHandles.map(stripAtSignFormTwitterHandle))}if(newState.twitterHandleRecommendations){newState.twitterHandleRecommendations.data=_.difference(newState.twitterHandleRecommendations.data,newState.twitterHandles)}twitterHandleState=getTwitterHandleProps(state,_.extend({},props,newState));return _.extend({},newState,twitterHandleState)}function volumeReducer(state,props){var newState=_.extend({},state,props);newState.showTestsearchNotification=true;return newState}function getTwitterHandleExclusionProps(state,props){var newState={twitterHandleExclusionData:_.extend({},state.twitterHandleExclusionData,props.twitterHandleExclusionData)};if(props.twitterHandleExclusions){if(newState.twitterHandleExclusionData){newState.twitterHandleExclusionData.tagValues=props.twitterHandleExclusions}else{newState.twitterHandleExclusionData={tagValues:props.twitterHandleExclusions}}}return newState}function brandExclusionsReducer(state,props){var newState=_.extend({},state,props);var twitterHandleExclusionState;if(props.exclusionSnippetError){newState.serverError=new ApiError(props.exclusionSnippetError).message}if(props.brandWebsiteExclusions){newState.brandWebsiteExclusions=getNormalizedUrls(props.brandWebsiteExclusions)}if(props.twitterHandleExclusions){newState.twitterHandleExclusions=_.uniq(props.twitterHandleExclusions.map(stripAtSignFormTwitterHandle))}twitterHandleExclusionState=getTwitterHandleExclusionProps(state,_.extend({},props,newState));return _.extend({},newState,twitterHandleExclusionState)}reducers[QueryWizardSteps.USECASE_SELECTION]=usecaseSelectionViewReducer;reducers[QueryWizardSteps.HASHTAG_CAMPAIGN]=hashtagCampaignViewReducer;reducers[QueryWizardSteps.HASHTAG_VOLUME]=volumeReducer;reducers[QueryWizardSteps.BRAND_OWNED_MEDIA]=brandOwnedMediaReducer;reducers[QueryWizardSteps.BRAND_EXCLUSIONS]=brandExclusionsReducer;reducers[QueryWizardSteps.BRAND_VOLUME]=volumeReducer;reducers.app=appReducer;return{get:function get(stepKey){return reducers[stepKey]||defaultReducer}}});define("src/querywizard/QueryWizardValidators",["underscore","bw-fe-helpers/languageGroupHelper","src/querybuilder/queryFormHelper","src/querywizard/QueryWizardSteps"],function(_,languageGroupHelper,queryFormHelper,QueryWizardSteps){"use strict";var validators={};function invalidateWithNoMessage(){return{valid:false,errors:{}}}function validateViewProps(){return filterErrorMessages({})}function validateLanguageCombinations(languages){var hasIdeographicLanguage=_.some(languages,languageGroupHelper.isIdeographic);var hasNonIdeographicLanguage=_.some(languages,function(language){return!languageGroupHelper.isIdeographic(language)});return!(hasNonIdeographicLanguage&&hasIdeographicLanguage)}function areNotificationsValid(notifications){return _(notifications).every(function(notification){return!notification||notification.type!=="error"})}function validateUseCaseSelectionViewProps(props){var newProps;var errors={};if(!props.usecase){errors.usecase=["Query usecase is required."]}if((!props.languages||!props.languages.length)&&!props.languageAgnostic){errors.languages=["Please specify at least one language."]}if(!props.languageAgnostic&&props.languages&&props.languages.length>1&&!validateLanguageCombinations(props.languages)){errors.languages=["Sorry but you cannot have Latin and CJK (Chinese, Japanese, Korean, Lao and Thai) languages in the same Query."]}if((!props.locations||!props.locations.length)&&!props.locationAgnostic){errors.locations=["Please specify at least one location."]}newProps=filterErrorMessages(props,errors);return newProps}function validateHashtagCampaignViewProps(props){var newProps;var errors={};if(!props.hashtag||props.hashtag.length===0){if(!props.hashtagLinks||props.hashtagLinks.length===0){return invalidateWithNoMessage()}}newProps=filterErrorMessages(props,errors);return newProps}function validateBrandnameViewProps(props){var errors={};if(!props.brandName){return invalidateWithNoMessage()}return filterErrorMessages(props,errors)}function validateVolumeProps(props){var errors={};var newProps=filterErrorMessages(props,errors);if(props.isLoadingTestsearchResults){newProps.valid=false;return newProps}if(props.notifications){newProps.valid=areNotificationsValid(props.notifications);return newProps}return newProps}function validateNameViewProps(props){var newProps;var errors={};if(!props.name){errors.name=["Please specify a query name."]}if(props.createAlert&&!queryFormHelper.isValidAlertThreshold(props.alertThreshold)){errors.alertThreshold=["Please specify a non-zero positive integer."]}newProps=filterErrorMessages(props,errors);if(!newProps.valid){return newProps}if(props.isLoadingTestsearchResults){newProps.valid=false;return newProps}if(props.notifications){newProps.valid=areNotificationsValid(props.notifications);return newProps}return newProps}function validateSetupstoreEntryProps(props){var errors={};if(!props.setupTemplates||!props.setupTemplates.length){errors.setupTemplates=["Sorry, we were unable to load Dashboard Wizard templates."]}return{valid:!_.size(errors),errors:errors}}function filterErrorMessages(state,errors){var valid=!_.size(errors);var filteredErrors=_(errors).reduce(function(memo,value,key){if(state[key+"Edited"]){memo[key]=value}return memo},{});return{valid:valid,errors:filteredErrors}}validators[QueryWizardSteps.USECASE_SELECTION]=validateUseCaseSelectionViewProps;validators[QueryWizardSteps.HASHTAG_CAMPAIGN]=validateHashtagCampaignViewProps;validators[QueryWizardSteps.HASHTAG_CAMPAIGN_EXCLUSIONS]=validateViewProps;validators[QueryWizardSteps.HASHTAG_VOLUME]=validateVolumeProps;validators[QueryWizardSteps.HASHTAG_CAMPAIGN_QUERYNAME]=validateNameViewProps;validators[QueryWizardSteps.HASHTAG_CAMPAIGN_SETUPSTORE_ENTRY]=validateSetupstoreEntryProps;validators[QueryWizardSteps.BRAND_BRANDNAME]=validateBrandnameViewProps;validators[QueryWizardSteps.BRAND_PRODUCTNAMES]=validateViewProps;validators[QueryWizardSteps.BRAND_OWNED_MEDIA]=validateViewProps;validators[QueryWizardSteps.BRAND_EXCLUSIONS]=validateViewProps;validators[QueryWizardSteps.BRAND_VOLUME]=validateVolumeProps;validators[QueryWizardSteps.BRAND_QUERYNAME]=validateNameViewProps;validators[QueryWizardSteps.BRAND_SETUPSTORE_ENTRY]=validateSetupstoreEntryProps;return{get:function get(stepKey){var validator=validators[stepKey];if(!validator){throw new Error('Validator for step "'+stepKey+'" is not defined')}return validator}}});define("src/querywizard/helpers/queryWizardDefaultValuesHelper",["src/querywizard/QueryWizardSteps","src/globals/queries"],function(QueryWizardSteps,queries){"use strict";function getUniqueName(proposedName,count){var queryName;count=count||0;queryName=count===0?proposedName:proposedName+"-"+count;if(queries.findWhere({name:queryName})){return getUniqueName(proposedName,count+1)}return queryName}function getQueryName(state){if(state.name){return state.name}if(state.stepKey===QueryWizardSteps.BRAND_BRANDNAME&&state.brandName){return getUniqueName(state.brandName)}if(state.stepKey===QueryWizardSteps.HASHTAG_CAMPAIGN&&state.hashtag&&state.hashtag.length){return getUniqueName(state.hashtag[0])}return""}return{getQueryName:getQueryName}});define("src/querywizard/models/LocationCollection",["backbone"],function(Backbone){"use strict";var LocationCollection=Backbone.Collection.extend({constructor:function LocationCollection(){Backbone.Collection.apply(this,arguments)},url:function url(){return"/locations"},fetch:function fetch(options){options=options||{};this.prefix=options.locationPayload;this.locations=options.locations;this.exactMatch=!this.prefix;return Backbone.Collection.prototype.fetch.call(this)},getQueryData:function getQueryData(){if(this.exactMatch){return{locationIds:this.locations.map(function(location){return location.value})}}return{prefix:this.prefix,pageSize:20,page:0}},parse:function parse(data){return data.results.map(function(location){return{label:location.fullName,value:location.id,data:{type:location.type,shortName:location.name}}})}});return LocationCollection});define("src/querywizard/models/ExclusionSnippetCollection",["backbone"],function(Backbone){"use strict";var LocationCollection=Backbone.Collection.extend({defaults:{results:[]},url:function url(){return"/exclusionsnippets"},fetch:function fetch(options){options=options||{};if(!options.languages||options.languages.length!==1){this.reset([]);this.trigger("sync",this);return}this.language=options.languages[0];return Backbone.Collection.prototype.fetch.call(this)},getQueryData:function getQueryData(){return{language:this.language}},parse:function parse(data){return data.results.map(function(exclusionSnippet){return{id:exclusionSnippet.id,name:exclusionSnippet.name,title:exclusionSnippet.title,language:exclusionSnippet.language,description:exclusionSnippet.description,query:exclusionSnippet.query}})}});return LocationCollection});define("src/mixins/showNotificationViewMixin",["underscore","lib/jquery.showNotification"],function(_){"use strict";var ELEMENT_CLASS_NAME="has-notification",CONTAINER_SELECTOR=".notifications",ERROR_MESSAGE="An error has occurred, please try again later or contact support.";function getSelector(options){options=options||{};return options.selector||CONTAINER_SELECTOR}function removeNotificationClass(view){view.$el.removeClass(ELEMENT_CLASS_NAME)}return{removeNotification:function removeNotification(options){var view=this;removeNotificationClass(view);this.$(getSelector(options)).empty()},showNotification:function showNotification(options){var view=this;var $container=view.$(getSelector(options));view.$el.addClass(ELEMENT_CLASS_NAME);if(!options.append){$container.empty()}$container.showNotification(_.extend({onRemoved:_.partial(removeNotificationClass,view)},options))},showErrorNotification:function showErrorNotification(text,options){options=options||{};this.showNotification(_.extend(options,{cssClass:"notification-error",text:text||ERROR_MESSAGE}))}}});define("mustache!src/querywizard/templates/progressTrackerView",["lib/mustache"],function(mustache){var escapedTemplate='<div class="qw-progress-tracker pagepadding-horizontal">\n<div class="qw-progress-tracker__start-spacer"></div>\n{{#progressTrackerSteps}}\n<div class="qw-progress-tracker__bar{{#isFirst}} qw-progress-tracker__bar_first{{/isFirst}}{{#isVisited}} qw-progress-tracker__bar_visited{{/isVisited}}"></div>\n<div class="qw-progress-tracker__step">\n<div class="qw-progress-tracker__customtip customtip js-progress-step" title="{{title}}">\n</div>\n<div class="qw-progress-tracker__circle{{#isVisited}} qw-progress-tracker__circle_visited{{/isVisited}}{{#isActive}} qw-progress-tracker__circle_active{{/isActive}}">\n<span class="qw-progress-tracker__title-container">\n<span class="qw-progress-tracker__title{{#isVisited}} grey{{/isVisited}}{{^isVisited}} lightgrey{{/isVisited}}">{{title}}</span>\n</span>\n</div>\n</div>\n{{/progressTrackerSteps}}\n<div class="qw-progress-tracker__end-spacer"></div>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/querywizard/css/queryProgressTrackerView.css",["css!src/querywizard/css/compiled.css"],function(){});define("src/querywizard/views/ProgressTrackerView",["backbone","mustache!src/querywizard/templates/progressTrackerView","css!src/querywizard/css/queryProgressTrackerView.css","src/packages/customtip"],function(Backbone,template){"use strict";var VIEW_SELECTORS={TOOLTIP_CONTAINER:".js-progress-step"};var ProgressTrackerView=Backbone.View.extend({constructor:function ProgressTrackerView(){Backbone.View.apply(this,arguments)},render:function render(data){this.$el.html(template(data));this.$(VIEW_SELECTORS.TOOLTIP_CONTAINER).customtip({position:"bottom",tipClass:"qw-progress-tracker__tip"})}});return ProgressTrackerView});define("mustache!src/querywizard/templates/stepNavigationView",["lib/mustache"],function(mustache){var escapedTemplate='{{#isFirst}}\n<button type="button" class="js-close button smallmargin-right">Cancel</button>\n{{/isFirst}}\n{{^isFirst}}\n{{^isSetupStoreEntryStep}}\n<button type="button" class="js-transit button smallmargin-right" data-action="prev"><span class="icon-chevron-left"></span></button>\n{{/isSetupStoreEntryStep}}\n{{/isFirst}}\n\n{{#isSaveStep}}\n<div class="js-save-button-container customtip dib"{{^valid}} title="{{invalidNotificationsSummary}}"{{/valid}}>\n\n{{^hasConfirmStepNext}}\n<button type="button" class="js-save defaultbutton smallmargin-right"{{^valid}} disabled{{/valid}}>Save Query</button>\n{{/hasConfirmStepNext}}\n\n{{#hasConfirmStepNext}}\n<button type="button" class="js-save-and-transit defaultbutton smallmargin-right" data-at="query-wizard-save-button"{{^valid}} disabled{{/valid}}>Save Query</button>\n{{/hasConfirmStepNext}}\n\n</div>\n{{/isSaveStep}}\n\n{{^isSaveStep}}\n\n{{^isSetupStoreEntryStep}}\n<button type="button" class="js-transit defaultbutton smallmargin-right" data-at="query-wizard-next-button" data-action="next"{{^valid}} disabled{{/valid}}>Next<span class="icon-chevron-right smallpadding-left"></span></button>\n{{/isSetupStoreEntryStep}}\n\n{{#isSetupStoreEntryStep}}\n<button type="button" class="js-close button smallmargin-right" data-at="query-wizard-close-button">No, maybe later</button>\n{{/isSetupStoreEntryStep}}\n\n{{/isSaveStep}}\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/querywizard/views/StepNavigationView",["jquery","backbone","mustache!src/querywizard/templates/stepNavigationView"],function($,Backbone,template){"use strict";var SAVE_BUTTON_CONTAINER_SELECTOR=".js-save-button-container";var StepNavigationView=Backbone.View.extend({events:{"mouseup .js-transit:enabled":function mouseupJsTransitEnabled(e){this.trigger(StepNavigationView.TRANSIT_CLICK,$(e.currentTarget).data("action"))},"mouseup .js-save:enabled":function mouseupJsSaveEnabled(){this.trigger(StepNavigationView.SAVE_CLICK)},"mouseup .js-save-and-transit:enabled":function mouseupJsSaveAndTransitEnabled(){this.trigger(StepNavigationView.SAVE_CLICK,{needsTransit:true})},"mouseup .js-close:enabled":function mouseupJsCloseEnabled(){this.trigger(StepNavigationView.CLOSE_CLICK)}},constructor:function StepNavigationView(){Backbone.View.apply(this,arguments)},render:function render(data){this.$el.html(template(data));if(data.invalidNotificationsSummary){this.$(SAVE_BUTTON_CONTAINER_SELECTOR).customtip({tipClass:"validation-tip notification-error"})}}});StepNavigationView.SAVE_CLICK="StepNavigationView:save-click";StepNavigationView.TRANSIT_CLICK="StepNavigationView:transit-click";StepNavigationView.CLOSE_CLICK="StepNavigationView:close-click";return StepNavigationView});define("mustache!src/querywizard/templates/querySneakView",["lib/mustache"],function(mustache){var escapedTemplate='<p class="biggertext db grey singlemargin-top toggle-querysneak js-toggle-querysneak">\n{{#collapsed}}<span>Check what your Query looks like <span class="icon-chevron-right"></span></span>{{/collapsed}}\n{{^collapsed}}<span>Hide Query <span class="icon-chevron-down"></span></span>{{/collapsed}}\n</p>\n{{^collapsed}}\n<div class="js-query-string"></div>\n<div class="js-query-footer"></div>\n{{/collapsed}}\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/querywizard/views/QuerySneakView",["backbone","src/querywizard/events/QueryWizardEventNames","mustache!src/querywizard/templates/querySneakView"],function(Backbone,QueryWizardEventNames,template){"use strict";var VIEW_SELECTORS={QUERY_STRING:".js-query-string",QUERY_FOOTER:".js-query-footer"};var QuerySneakView=Backbone.View.extend({events:{"click .js-toggle-querysneak":function clickJsToggleQuerysneak(){this.trigger(QueryWizardEventNames.STATE_CHANGE,{querySneakViewCollapsed:!this.querySneakViewCollapsed})}},constructor:function QuerySneakView(){Backbone.View.apply(this,arguments)},render:function render(data){data=data||{};if(!data.querySneakViewVisible){this.$el.empty();return}this.querySneakViewCollapsed=data.querySneakViewCollapsed;this.$el.html(template({collapsed:this.querySneakViewCollapsed}));if(!this.querySneakViewCollapsed){this.$(VIEW_SELECTORS.QUERY_STRING).html(data.$queryString);this.$(VIEW_SELECTORS.QUERY_FOOTER).html(data.$queryFooter)}}});return QuerySneakView});define("mustache!src/querywizard/templates/layoutView",["lib/mustache"],function(mustache){var escapedTemplate='<div class="wrapper">\n<div class="progress-tracker js-progress-tracker">\n</div>\n<div class="header pagepadding-top pagepadding-horizontal">\n<h1 class="js-step-title pagetitletext doublepadding-bottom"></h1>\n<a class="js-close-icon popup--close icon-remove singlepadding lightgrey customtip" title="Close Query Wizard"></a>\n<div class="js-validation-errors validation-errors"></div>\n<div class="notifications"></div>\n</div>\n<div class="main pagepadding-horizontal">\n<div class="js-content content singlemargin-right singlepadding-right bwscrollbar">\n<div class="js-step modular singlepadding-top fullheight"></div>\n</div>\n<div class="js-aside aside doublemargin-left"></div>\n</div>\n<div class="footer doublemargin-top pagepadding-horizontal pagepadding-bottom">\n<div class="container">\n<div class="navigation">\n<div class="js-step-navigation"></div>\n</div>\n<div class="beta-message">\n<p class="textright">{{#isBrandwatchOrGreyLabelTheme}} How can we make the Query Wizard better? <a target="_onblank" href="https://docs.google.com/a/brandwatch.com/forms/d/1bXLdLEtIW1MHK8prQV-EJErWtz7uYgYCtGPa0hXbMuE/viewform">Let us know.</a>{{/isBrandwatchOrGreyLabelTheme}}</p>\n</div>\n</div>\n<div class="js-query-sneak"></div>\n</div>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/querywizard/views/LayoutView",["underscore","backbone","src/globals/theme","src/mixins/mixin","src/mixins/withRetrigger","src/mixins/showWaitmaskViewMixin","src/mixins/showNotificationViewMixin","src/views/QueryCreationWarningView","src/querywizard/events/QueryWizardEventNames","src/querywizard/views/ProgressTrackerView","src/querywizard/views/StepNavigationView","src/querywizard/views/QuerySneakView","mustache!src/querywizard/templates/layoutView","src/packages/customtip"],function(_,Backbone,theme,mixin,withRetrigger,showWaitmaskViewMixin,showNotificationViewMixin,QueryCreationWarningView,QueryWizardEventNames,ProgressTrackerView,StepNavigationView,QuerySneakView,template){"use strict";var VIEW_SELECTORS={PROGRESS_TRACKER:".js-progress-tracker",CONTENT:".js-content",STEP:".js-step",ASIDE:".js-aside",STEP_NAVIGATION:".js-step-navigation",STEP_TITLE:".js-step-title",QUERY_SNEAK:".js-query-sneak",VALIDATION_ERRORS:".js-validation-errors",CLOSE_ICON:".js-close-icon"};var STEP_CLASS_PREFIX="qw-step__";function formatErrorMessage(data){if(data.serverError){return[data.serverError]}return _.chain(data.errors).values().flatten().compact().value()}function renderErrorMessage(view,data){var errors=formatErrorMessage(data);if(errors.length){errors.forEach(function(error,index){view.showErrorNotification(error,{append:index>0,selector:VIEW_SELECTORS.VALIDATION_ERRORS,omitClose:true})})}else{view.removeNotification({selector:VIEW_SELECTORS.VALIDATION_ERRORS})}}function formatNotification(view,options){var text;var notificationOptions;if(!options){return}text=QueryCreationWarningView.getNotificationMessage(options.reason);if(!text){text=options.reason}notificationOptions={text:text,append:true,cssClass:"notification-"+options.type,omitClose:options.type==="error",onRemoved:function onRemoved(){view.trigger(QueryWizardEventNames.STATE_CHANGE,options.stateDataOnRemove,{silent:true})}};if(options.reasonData){notificationOptions.actions=[{text:"Show Details",action:function action(){QueryCreationWarningView.show({reason:options.reason,reasonData:options.reasonData})}}]}return notificationOptions}function renderNotifications(view,data){var notifications=data.notifications;view.removeNotification();if(!notifications){return}_(notifications).forEach(function(notification){if(!notification){return}var formattedNotification=formatNotification(view,notification);if(formattedNotification){view.showNotification(formattedNotification)}})}function removeStepClass($el){$el.removeClass(function(index,classAttribute){return classAttribute.split(" ").filter(function(className){return className.lastIndexOf(STEP_CLASS_PREFIX,0)===0}).join(" ")})}function renderStepView(view,data){var $step=view.$(VIEW_SELECTORS.STEP);if(!data.$step||data.$step.parent().is($step)){return}removeStepClass($step);$step.addClass(STEP_CLASS_PREFIX+data.stepKey);$step.html(data.$step)}function createProgressTracker(view){view.progressTrackerView=new ProgressTrackerView}function createStepNavigation(view){view.stepNavigation=new StepNavigationView;view.retrigger(view.stepNavigation,StepNavigationView.TRANSIT_CLICK,QueryWizardEventNames.TRANSIT);view.retrigger(view.stepNavigation,StepNavigationView.SAVE_CLICK,QueryWizardEventNames.QUERY_CREATE);view.retrigger(view.stepNavigation,StepNavigationView.CLOSE_CLICK,QueryWizardEventNames.CLOSE_QUERY_WIZARD)}function createQuerySneakView(view){view.querySneakView=new QuerySneakView;view.retrigger(view.querySneakView,QueryWizardEventNames.STATE_CHANGE);view.retrigger(view.querySneakView,QueryWizardEventNames.REQUEST_EDIT_WITHIN_QUERY_EDITOR)}function hasAsideChanged(view,data){var domIsEmpty=view.$(VIEW_SELECTORS.ASIDE).children().length===0;var dataIsEmpty=!data.$aside||data.$aside.length===0;return domIsEmpty||dataIsEmpty||!view.$(VIEW_SELECTORS.ASIDE).children()[0].isEqualNode(data.$aside[0])}function softRender(view,data){data=data||{};var stepTitle=data.id?data.stepTitleEdit:data.stepTitleNew;view.$(VIEW_SELECTORS.STEP_TITLE).text(stepTitle);if(hasAsideChanged(view,data)){view.$(VIEW_SELECTORS.ASIDE).children().detach();if(data.$aside){view.$(VIEW_SELECTORS.CONTENT).removeClass("fullwidth");view.$(VIEW_SELECTORS.ASIDE).removeClass("hidden");view.$(VIEW_SELECTORS.ASIDE).html(data.$aside)}else{view.$(VIEW_SELECTORS.CONTENT).addClass("fullwidth");view.$(VIEW_SELECTORS.ASIDE).addClass("hidden")}}renderErrorMessage(view,data);renderNotifications(view,data);renderStepView(view,data);view.progressTrackerView.render(data);view.stepNavigation.render(data);view.querySneakView.render(data)}var LayoutView=Backbone.View.extend({events:{"click .js-close-icon":function clickJsCloseIcon(){this.trigger(QueryWizardEventNames.CLOSE_QUERY_WIZARD)}},constructor:function LayoutView(){Backbone.View.apply(this,arguments);createProgressTracker(this);createStepNavigation(this);createQuerySneakView(this)},render:function render(data){data=data||{};this.$el.html(template(_.extend({},{isBrandwatchOrGreyLabelTheme:theme.isBrandwatchOrGreyLabelTheme()},data)));this.$(VIEW_SELECTORS.CLOSE_ICON).customtip({position:"left",offset:[-3,0]});this.$(VIEW_SELECTORS.PROGRESS_TRACKER).html(this.progressTrackerView.$el);this.$(VIEW_SELECTORS.STEP_NAVIGATION).html(this.stepNavigation.$el);this.$(VIEW_SELECTORS.QUERY_SNEAK).html(this.querySneakView.$el);this.$(VIEW_SELECTORS.ASIDE).html(data.$aside);softRender(this,data);this.render=softRender.bind(null,this)},remove:function remove(){if(this.progressTrackerView){this.progressTrackerView.remove();this.progressTrackerView=null}if(this.stepNavigation){this.stepNavigation.remove();this.stepNavigation=null}if(this.querySneakView){this.querySneakView.remove();this.querySneakView=null}Backbone.View.prototype.remove.call(this)}});mixin(LayoutView,withRetrigger);_.extend(LayoutView.prototype,showWaitmaskViewMixin);_.extend(LayoutView.prototype,showNotificationViewMixin);return LayoutView});(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==="object"&&typeof module==="object")module.exports=factory();else if(typeof define==="function"&&define.amd)define("jsdiff",[],factory);else if(typeof exports==="object")exports["JsDiff"]=factory();else root["JsDiff"]=factory()})(this,function(){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:false};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.loaded=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.p="";return __webpack_require__(0)}([function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _diffBase=__webpack_require__(1);var _diffBase2=_interopRequireDefault(_diffBase);var _diffCharacter=__webpack_require__(2);var _diffWord=__webpack_require__(3);var _diffLine=__webpack_require__(5);var _diffSentence=__webpack_require__(6);var _diffCss=__webpack_require__(7);var _diffJson=__webpack_require__(8);var _patchApply=__webpack_require__(9);var _patchParse=__webpack_require__(10);var _patchCreate=__webpack_require__(12);var _convertDmp=__webpack_require__(13);var _convertXml=__webpack_require__(14);exports.Diff=_diffBase2["default"];exports.diffChars=_diffCharacter.diffChars;exports.diffWords=_diffWord.diffWords;exports.diffWordsWithSpace=_diffWord.diffWordsWithSpace;exports.diffLines=_diffLine.diffLines;exports.diffTrimmedLines=_diffLine.diffTrimmedLines;exports.diffSentences=_diffSentence.diffSentences;exports.diffCss=_diffCss.diffCss;exports.diffJson=_diffJson.diffJson;exports.structuredPatch=_patchCreate.structuredPatch;exports.createTwoFilesPatch=_patchCreate.createTwoFilesPatch;exports.createPatch=_patchCreate.createPatch;exports.applyPatch=_patchApply.applyPatch;exports.applyPatches=_patchApply.applyPatches;exports.parsePatch=_patchParse.parsePatch;exports.convertChangesToDMP=_convertDmp.convertChangesToDMP;exports.convertChangesToXML=_convertXml.convertChangesToXML;exports.canonicalize=_diffJson.canonicalize},function(module,exports){"use strict";exports.__esModule=true;exports["default"]=Diff;function Diff(){}Diff.prototype={diff:function diff(oldString,newString){var options=arguments.length<=2||arguments[2]===undefined?{}:arguments[2];var callback=options.callback;if(typeof options==="function"){callback=options;options={}}this.options=options;var self=this;function done(value){if(callback){setTimeout(function(){callback(undefined,value)},0);return true}else{return value}}oldString=this.castInput(oldString);newString=this.castInput(newString);oldString=this.removeEmpty(this.tokenize(oldString));newString=this.removeEmpty(this.tokenize(newString));var newLen=newString.length,oldLen=oldString.length;var editLength=1;var maxEditLength=newLen+oldLen;var bestPath=[{newPos:-1,components:[]}];var oldPos=this.extractCommon(bestPath[0],newString,oldString,0);if(bestPath[0].newPos+1>=newLen&&oldPos+1>=oldLen){return done([{value:newString.join(""),count:newString.length}])}function execEditLength(){for(var diagonalPath=-1*editLength;diagonalPath<=editLength;diagonalPath+=2){var basePath=undefined;var addPath=bestPath[diagonalPath-1],removePath=bestPath[diagonalPath+1],_oldPos=(removePath?removePath.newPos:0)-diagonalPath;if(addPath){bestPath[diagonalPath-1]=undefined}var canAdd=addPath&&addPath.newPos+1<newLen,canRemove=removePath&&0<=_oldPos&&_oldPos<oldLen;if(!canAdd&&!canRemove){bestPath[diagonalPath]=undefined;continue}if(!canAdd||canRemove&&addPath.newPos<removePath.newPos){basePath=clonePath(removePath);self.pushComponent(basePath.components,undefined,true)}else{basePath=addPath;basePath.newPos++;self.pushComponent(basePath.components,true,undefined)}_oldPos=self.extractCommon(basePath,newString,oldString,diagonalPath);if(basePath.newPos+1>=newLen&&_oldPos+1>=oldLen){return done(buildValues(self,basePath.components,newString,oldString,self.useLongestToken))}else{bestPath[diagonalPath]=basePath}}editLength++}if(callback){(function exec(){setTimeout(function(){if(editLength>maxEditLength){return callback()}if(!execEditLength()){exec()}},0)})()}else{while(editLength<=maxEditLength){var ret=execEditLength();if(ret){return ret}}}},pushComponent:function pushComponent(components,added,removed){var last=components[components.length-1];if(last&&last.added===added&&last.removed===removed){components[components.length-1]={count:last.count+1,added:added,removed:removed}}else{components.push({count:1,added:added,removed:removed})}},extractCommon:function extractCommon(basePath,newString,oldString,diagonalPath){var newLen=newString.length,oldLen=oldString.length,newPos=basePath.newPos,oldPos=newPos-diagonalPath,commonCount=0;while(newPos+1<newLen&&oldPos+1<oldLen&&this.equals(newString[newPos+1],oldString[oldPos+1])){newPos++;oldPos++;commonCount++}if(commonCount){basePath.components.push({count:commonCount})}basePath.newPos=newPos;return oldPos},equals:function equals(left,right){return left===right},removeEmpty:function removeEmpty(array){var ret=[];for(var i=0;i<array.length;i++){if(array[i]){ret.push(array[i])}}return ret},castInput:function castInput(value){return value},tokenize:function tokenize(value){return value.split("")}};function buildValues(diff,components,newString,oldString,useLongestToken){var componentPos=0,componentLen=components.length,newPos=0,oldPos=0;for(;componentPos<componentLen;componentPos++){var component=components[componentPos];if(!component.removed){if(!component.added&&useLongestToken){var value=newString.slice(newPos,newPos+component.count);value=value.map(function(value,i){var oldValue=oldString[oldPos+i];return oldValue.length>value.length?oldValue:value});component.value=value.join("")}else{component.value=newString.slice(newPos,newPos+component.count).join("")}newPos+=component.count;if(!component.added){oldPos+=component.count}}else{component.value=oldString.slice(oldPos,oldPos+component.count).join("");oldPos+=component.count;if(componentPos&&components[componentPos-1].added){var tmp=components[componentPos-1];components[componentPos-1]=components[componentPos];components[componentPos]=tmp}}}var lastComponent=components[componentLen-1];if((lastComponent.added||lastComponent.removed)&&diff.equals("",lastComponent.value)){components[componentLen-2].value+=lastComponent.value;components.pop()}return components}function clonePath(path){return{newPos:path.newPos,components:path.components.slice(0)}}module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.diffChars=diffChars;function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _base=__webpack_require__(1);var _base2=_interopRequireDefault(_base);var characterDiff=new _base2["default"];exports.characterDiff=characterDiff;function diffChars(oldStr,newStr,callback){return characterDiff.diff(oldStr,newStr,callback)}},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.diffWords=diffWords;exports.diffWordsWithSpace=diffWordsWithSpace;function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _base=__webpack_require__(1);var _base2=_interopRequireDefault(_base);var _utilParams=__webpack_require__(4);var extendedWordChars=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/;var reWhitespace=/\S/;var wordDiff=new _base2["default"];exports.wordDiff=wordDiff;wordDiff.equals=function(left,right){return left===right||this.options.ignoreWhitespace&&!reWhitespace.test(left)&&!reWhitespace.test(right)};wordDiff.tokenize=function(value){var tokens=value.split(/(\s+|\b)/);for(var i=0;i<tokens.length-1;i++){if(!tokens[i+1]&&tokens[i+2]&&extendedWordChars.test(tokens[i])&&extendedWordChars.test(tokens[i+2])){tokens[i]+=tokens[i+2];tokens.splice(i+1,2);i--}}return tokens};function diffWords(oldStr,newStr,callback){var options=_utilParams.generateOptions(callback,{ignoreWhitespace:true});return wordDiff.diff(oldStr,newStr,options)}function diffWordsWithSpace(oldStr,newStr,callback){return wordDiff.diff(oldStr,newStr,callback)}},function(module,exports){"use strict";exports.__esModule=true;exports.generateOptions=generateOptions;function generateOptions(options,defaults){if(typeof options==="function"){defaults.callback=options}else if(options){for(var _name in options){if(options.hasOwnProperty(_name)){defaults[_name]=options[_name]}}}return defaults}},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.diffLines=diffLines;exports.diffTrimmedLines=diffTrimmedLines;function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _base=__webpack_require__(1);var _base2=_interopRequireDefault(_base);var _utilParams=__webpack_require__(4);var lineDiff=new _base2["default"];exports.lineDiff=lineDiff;lineDiff.tokenize=function(value){var retLines=[],linesAndNewlines=value.split(/(\n|\r\n)/);if(!linesAndNewlines[linesAndNewlines.length-1]){linesAndNewlines.pop()}for(var i=0;i<linesAndNewlines.length;i++){var line=linesAndNewlines[i];if(i%2&&!this.options.newlineIsToken){retLines[retLines.length-1]+=line}else{if(this.options.ignoreWhitespace){line=line.trim()}retLines.push(line)}}return retLines};function diffLines(oldStr,newStr,callback){return lineDiff.diff(oldStr,newStr,callback)}function diffTrimmedLines(oldStr,newStr,callback){var options=_utilParams.generateOptions(callback,{ignoreWhitespace:true});return lineDiff.diff(oldStr,newStr,options)}},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.diffSentences=diffSentences;function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _base=__webpack_require__(1);var _base2=_interopRequireDefault(_base);var sentenceDiff=new _base2["default"];exports.sentenceDiff=sentenceDiff;sentenceDiff.tokenize=function(value){return value.split(/(\S.+?[.!?])(?=\s+|$)/)};function diffSentences(oldStr,newStr,callback){return sentenceDiff.diff(oldStr,newStr,callback)}},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.diffCss=diffCss;function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _base=__webpack_require__(1);var _base2=_interopRequireDefault(_base);var cssDiff=new _base2["default"];exports.cssDiff=cssDiff;cssDiff.tokenize=function(value){return value.split(/([{}:;,]|\s+)/)};function diffCss(oldStr,newStr,callback){return cssDiff.diff(oldStr,newStr,callback)}},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.diffJson=diffJson;exports.canonicalize=canonicalize;function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _base=__webpack_require__(1);var _base2=_interopRequireDefault(_base);var _line=__webpack_require__(5);var objectPrototypeToString=Object.prototype.toString;var jsonDiff=new _base2["default"];exports.jsonDiff=jsonDiff;jsonDiff.useLongestToken=true;jsonDiff.tokenize=_line.lineDiff.tokenize;jsonDiff.castInput=function(value){return typeof value==="string"?value:JSON.stringify(canonicalize(value),undefined,"  ")};jsonDiff.equals=function(left,right){return _base2["default"].prototype.equals(left.replace(/,([\r\n])/g,"$1"),right.replace(/,([\r\n])/g,"$1"))};function diffJson(oldObj,newObj,callback){return jsonDiff.diff(oldObj,newObj,callback)}function canonicalize(obj,stack,replacementStack){stack=stack||[];replacementStack=replacementStack||[];var i=undefined;for(i=0;i<stack.length;i+=1){if(stack[i]===obj){return replacementStack[i]}}var canonicalizedObj=undefined;if("[object Array]"===objectPrototypeToString.call(obj)){stack.push(obj);canonicalizedObj=new Array(obj.length);replacementStack.push(canonicalizedObj);for(i=0;i<obj.length;i+=1){canonicalizedObj[i]=canonicalize(obj[i],stack,replacementStack)}stack.pop();replacementStack.pop()}else if(typeof obj==="object"&&obj!==null){stack.push(obj);canonicalizedObj={};replacementStack.push(canonicalizedObj);var sortedKeys=[],key=undefined;for(key in obj){if(obj.hasOwnProperty(key)){sortedKeys.push(key)}}sortedKeys.sort();for(i=0;i<sortedKeys.length;i+=1){key=sortedKeys[i];canonicalizedObj[key]=canonicalize(obj[key],stack,replacementStack)}stack.pop();replacementStack.pop()}else{canonicalizedObj=obj}return canonicalizedObj}},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.applyPatch=applyPatch;exports.applyPatches=applyPatches;function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _parse=__webpack_require__(10);var _utilDistanceIterator=__webpack_require__(11);var _utilDistanceIterator2=_interopRequireDefault(_utilDistanceIterator);function applyPatch(source,uniDiff){var options=arguments.length<=2||arguments[2]===undefined?{}:arguments[2];if(typeof uniDiff==="string"){uniDiff=_parse.parsePatch(uniDiff)}if(Array.isArray(uniDiff)){if(uniDiff.length>1){throw new Error("applyPatch only works with a single input.")}uniDiff=uniDiff[0]}var lines=source.split("\n"),hunks=uniDiff.hunks,compareLine=options.compareLine||function(lineNumber,line,operation,patchContent){return line===patchContent},errorCount=0,fuzzFactor=options.fuzzFactor||0,minLine=0,offset=0,removeEOFNL=undefined,addEOFNL=undefined;function hunkFits(hunk,toPos){for(var j=0;j<hunk.lines.length;j++){var line=hunk.lines[j],operation=line[0],content=line.substr(1);if(operation===" "||operation==="-"){if(!compareLine(toPos+1,lines[toPos],operation,content)){errorCount++;if(errorCount>fuzzFactor){return false}}toPos++}}return true}for(var i=0;i<hunks.length;i++){var hunk=hunks[i],maxLine=lines.length-hunk.oldLines,localOffset=0,toPos=offset+hunk.oldStart-1;var iterator=_utilDistanceIterator2["default"](toPos,minLine,maxLine);for(;localOffset!==undefined;localOffset=iterator()){if(hunkFits(hunk,toPos+localOffset)){hunk.offset=offset+=localOffset;break}}if(localOffset===undefined){return false}minLine=hunk.offset+hunk.oldStart+hunk.oldLines}for(var i=0;i<hunks.length;i++){var hunk=hunks[i],toPos=hunk.offset+hunk.newStart-1;for(var j=0;j<hunk.lines.length;j++){var line=hunk.lines[j],operation=line[0],content=line.substr(1);if(operation===" "){toPos++}else if(operation==="-"){lines.splice(toPos,1)}else if(operation==="+"){lines.splice(toPos,0,content);toPos++}else if(operation==="\\"){var previousOperation=hunk.lines[j-1]?hunk.lines[j-1][0]:null;if(previousOperation==="+"){removeEOFNL=true}else if(previousOperation==="-"){addEOFNL=true}}}}if(removeEOFNL){while(!lines[lines.length-1]){lines.pop()}}else if(addEOFNL){lines.push("")}return lines.join("\n")}function applyPatches(uniDiff,options){if(typeof uniDiff==="string"){uniDiff=_parse.parsePatch(uniDiff)}var currentIndex=0;function processIndex(){var index=uniDiff[currentIndex++];if(!index){return options.complete()}options.loadFile(index,function(err,data){if(err){return options.complete(err)}var updatedContent=applyPatch(data,index,options);options.patched(index,updatedContent);setTimeout(processIndex,0)})}processIndex()}},function(module,exports){"use strict";exports.__esModule=true;exports.parsePatch=parsePatch;function parsePatch(uniDiff){var options=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];var diffstr=uniDiff.split("\n"),list=[],i=0;function parseIndex(){var index={};list.push(index);while(i<diffstr.length){var line=diffstr[i];if(/^(\-\-\-|\+\+\+|@@)\s/.test(line)){break}var header=/^(?:Index:|diff(?: -r \w+)+)\s+(.+?)\s*$/.exec(line);if(header){index.index=header[1]}i++}parseFileHeader(index);parseFileHeader(index);index.hunks=[];while(i<diffstr.length){var line=diffstr[i];if(/^(Index:|diff|\-\-\-|\+\+\+)\s/.test(line)){break}else if(/^@@/.test(line)){index.hunks.push(parseHunk())}else if(line&&options.strict){throw new Error("Unknown line "+(i+1)+" "+JSON.stringify(line))}else{i++}}}function parseFileHeader(index){var fileHeader=/^(\-\-\-|\+\+\+)\s+(\S+)\s?(.+?)\s*$/.exec(diffstr[i]);if(fileHeader){var keyPrefix=fileHeader[1]==="---"?"old":"new";index[keyPrefix+"FileName"]=fileHeader[2];index[keyPrefix+"Header"]=fileHeader[3];i++}}function parseHunk(){var chunkHeaderIndex=i,chunkHeaderLine=diffstr[i++],chunkHeader=chunkHeaderLine.split(/@@ -(\d+)(?:,(\d+))? \+(\d+)(?:,(\d+))? @@/);var hunk={oldStart:+chunkHeader[1],oldLines:+chunkHeader[2]||1,newStart:+chunkHeader[3],newLines:+chunkHeader[4]||1,lines:[]};var addCount=0,removeCount=0;for(;i<diffstr.length;i++){var operation=diffstr[i][0];if(operation==="+"||operation==="-"||operation===" "||operation==="\\"){hunk.lines.push(diffstr[i]);if(operation==="+"){addCount++}else if(operation==="-"){removeCount++}else if(operation===" "){addCount++;removeCount++}}else{break}}if(!addCount&&hunk.newLines===1){hunk.newLines=0}if(!removeCount&&hunk.oldLines===1){hunk.oldLines=0}if(options.strict){if(addCount!==hunk.newLines){throw new Error("Added line count did not match for hunk at line "+(chunkHeaderIndex+1))}if(removeCount!==hunk.oldLines){throw new Error("Removed line count did not match for hunk at line "+(chunkHeaderIndex+1))}}return hunk}while(i<diffstr.length){parseIndex()}return list}},function(module,exports){"use strict";exports.__esModule=true;exports["default"]=function(start,minLine,maxLine){var wantForward=true,backwardExhausted=false,forwardExhausted=false,localOffset=1;return function iterator(){var _again=true;_function:while(_again){_again=false;if(wantForward&&!forwardExhausted){if(backwardExhausted){localOffset++}else{wantForward=false}if(start+localOffset<=maxLine){return localOffset}forwardExhausted=true}if(!backwardExhausted){if(!forwardExhausted){wantForward=true}if(minLine<=start-localOffset){return-localOffset++}backwardExhausted=true;_again=true;continue _function}}}};module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.structuredPatch=structuredPatch;exports.createTwoFilesPatch=createTwoFilesPatch;exports.createPatch=createPatch;function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}else{return Array.from(arr)}}var _diffLine=__webpack_require__(5);function structuredPatch(oldFileName,newFileName,oldStr,newStr,oldHeader,newHeader,options){if(!options){options={context:4}}var diff=_diffLine.diffLines(oldStr,newStr);diff.push({value:"",lines:[]});function contextLines(lines){return lines.map(function(entry){return" "+entry})}var hunks=[];var oldRangeStart=0,newRangeStart=0,curRange=[],oldLine=1,newLine=1;var _loop=function(i){var current=diff[i],lines=current.lines||current.value.replace(/\n$/,"").split("\n");current.lines=lines;if(current.added||current.removed){var _curRange;if(!oldRangeStart){var prev=diff[i-1];oldRangeStart=oldLine;newRangeStart=newLine;if(prev){curRange=options.context>0?contextLines(prev.lines.slice(-options.context)):[];oldRangeStart-=curRange.length;newRangeStart-=curRange.length}}(_curRange=curRange).push.apply(_curRange,_toConsumableArray(lines.map(function(entry){return(current.added?"+":"-")+entry})));if(current.added){newLine+=lines.length}else{oldLine+=lines.length}}else{if(oldRangeStart){if(lines.length<=options.context*2&&i<diff.length-2){var _curRange2;(_curRange2=curRange).push.apply(_curRange2,_toConsumableArray(contextLines(lines)))}else{var _curRange3;var contextSize=Math.min(lines.length,options.context);(_curRange3=curRange).push.apply(_curRange3,_toConsumableArray(contextLines(lines.slice(0,contextSize))));var hunk={oldStart:oldRangeStart,oldLines:oldLine-oldRangeStart+contextSize,newStart:newRangeStart,newLines:newLine-newRangeStart+contextSize,lines:curRange};if(i>=diff.length-2&&lines.length<=options.context){var oldEOFNewline=/\n$/.test(oldStr);var newEOFNewline=/\n$/.test(newStr);if(lines.length==0&&!oldEOFNewline){curRange.splice(hunk.oldLines,0,"\\ No newline at end of file")}else if(!oldEOFNewline||!newEOFNewline){curRange.push("\\ No newline at end of file")}}hunks.push(hunk);oldRangeStart=0;newRangeStart=0;curRange=[]}}oldLine+=lines.length;newLine+=lines.length}};for(var i=0;i<diff.length;i++){_loop(i)}return{oldFileName:oldFileName,newFileName:newFileName,oldHeader:oldHeader,newHeader:newHeader,hunks:hunks}}function createTwoFilesPatch(oldFileName,newFileName,oldStr,newStr,oldHeader,newHeader,options){var diff=structuredPatch(oldFileName,newFileName,oldStr,newStr,oldHeader,newHeader,options);var ret=[];if(oldFileName==newFileName){ret.push("Index: "+oldFileName)}ret.push("===================================================================");ret.push("--- "+diff.oldFileName+(typeof diff.oldHeader==="undefined"?"":"\t"+diff.oldHeader));ret.push("+++ "+diff.newFileName+(typeof diff.newHeader==="undefined"?"":"\t"+diff.newHeader));for(var i=0;i<diff.hunks.length;i++){var hunk=diff.hunks[i];ret.push("@@ -"+hunk.oldStart+","+hunk.oldLines+" +"+hunk.newStart+","+hunk.newLines+" @@");ret.push.apply(ret,hunk.lines)}return ret.join("\n")+"\n"}function createPatch(fileName,oldStr,newStr,oldHeader,newHeader,options){return createTwoFilesPatch(fileName,fileName,oldStr,newStr,oldHeader,newHeader,options)}},function(module,exports){"use strict";exports.__esModule=true;exports.convertChangesToDMP=convertChangesToDMP;function convertChangesToDMP(changes){var ret=[],change=undefined,operation=undefined;for(var i=0;i<changes.length;i++){change=changes[i];if(change.added){operation=1}else if(change.removed){operation=-1}else{operation=0}ret.push([operation,change.value])}return ret}},function(module,exports){"use strict";exports.__esModule=true;exports.convertChangesToXML=convertChangesToXML;function convertChangesToXML(changes){var ret=[];for(var i=0;i<changes.length;i++){var change=changes[i];if(change.added){ret.push("<ins>")}else if(change.removed){ret.push("<del>")}ret.push(escapeHTML(change.value));if(change.added){ret.push("</ins>")}else if(change.removed){ret.push("</del>")}}return ret.join("")}function escapeHTML(s){var n=s;n=n.replace(/&/g,"&amp;");n=n.replace(/</g,"&lt;");n=n.replace(/>/g,"&gt;");n=n.replace(/"/g,"&quot;");return n}}])});define("mustache!src/querywizard/templates/elements/queryStringView",["lib/mustache"],function(mustache){var escapedTemplate='<div class="js-query-string querywizard-query-string field fullwidth modular monospacefont lightgreybg darkgrey overflow-both bwscrollbar">{{querystring}}</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/querywizard/css/queryStringView.css",["css!src/querywizard/css/compiled.css"],function(){});define("src/querywizard/views/elements/QueryStringView",["underscore","jquery","backbone","jsdiff","mustache!src/querywizard/templates/elements/queryStringView","css!src/querywizard/css/queryStringView.css"],function(_,$,Backbone,JsDiff,template){"use strict";var HIGHLIGHT_DELAY=450;var CSS_CLASSES={HIGHLIGHT:"highlight",DIFF:"query-diff"};var VIEW_SELECTORS={QUERY_STRING:".js-query-string",RECENTLY_CHANGED:".js-recently"};function animationEndHandler(e){$(e.currentTarget).removeClass(CSS_CLASSES.HIGHLIGHT)}function flashDiff($querystring){$querystring.addClass(CSS_CLASSES.HIGHLIGHT);$querystring.get(0).removeEventListener("animationend",animationEndHandler);$querystring.get(0).addEventListener("animationend",animationEndHandler,false)}function buildMarkup(lastQueryString,newQueryString){var html="";JsDiff.diffWords(lastQueryString,newQueryString).forEach(function(part){if(part.removed){return}if(part.added){html+='<span class="'+CSS_CLASSES.DIFF+'">'}html+=_.escape(part.value);if(part.added){html+="</span>"}});return html}function startAnimation(view,afterDelayCallback){clearAnimation(view);view.tid=setTimeout(function(){flashDiff(view.$querystring);afterDelayCallback()},HIGHLIGHT_DELAY)}function clearAnimation(view){if(view.tid){clearTimeout(view.tid)}}function updateQuery(view,newQueryString,highlightQueryChanges){var markup;var $querystring=view.$querystring;if(highlightQueryChanges&&view.lastQueryString===""){highlightQueryChanges=false}if(newQueryString===""){$querystring.empty();view.lastQueryString="";return}if(newQueryString!==view.lastQueryString&&highlightQueryChanges){markup=buildMarkup(view.lastQueryString,newQueryString);$querystring.html(markup)}else{markup=newQueryString;$querystring.text(markup)}startAnimation(view,function(){view.lastQueryString=newQueryString})}var QueryStringView=Backbone.View.extend({constructor:function QueryStringView(){Backbone.View.apply(this,arguments);this.lastQueryString=""},render:function render(data){data=data||{};this.$el.html(template());this.$querystring=this.$(VIEW_SELECTORS.QUERY_STRING);if(data.includedTerms===""){this.lastQueryString=""}updateQuery(this,data.includedTerms||"",!data.hasQuerySummaryView)},remove:function remove(){if(this.$querystring){this.$querystring.get(0).removeEventListener("animationend",animationEndHandler)}clearAnimation(this);Backbone.View.prototype.remove.apply(this,arguments)}});QueryStringView.CSS_CLASSES=CSS_CLASSES;return QueryStringView});define("mustache!src/querywizard/templates/elements/queryFooterView",["lib/mustache"],function(mustache){var escapedTemplate='{{#isSaveStep}}\n<div class="query-footer singlepadding grey overflow-hidden">\n<a class="link-edit-queryeditor{{#valid}} js-edit-queryeditor grey"{{/valid}} {{^valid}} disabled customtip {{/valid}}"\n{{^valid}}\n{{#isLoadingTestsearchResults}}\ntitle="Please wait while we estimate your mention volume"\n{{/isLoadingTestsearchResults}}\n{{^isLoadingTestsearchResults}}\ntitle="You need to name your Query first"\n{{/isLoadingTestsearchResults}}\n{{/valid}} >\n<span class="icon-pencil smallpadding-right"></span>{{^isEdit}}Save your Query and edit it manually{{/isEdit}}{{#isEdit}}Edit this Query manually{{/isEdit}}\n</a>\n<span class="js-query-length-counter floatright">{{queryLength}} characters left</span>\n</div>\n{{/isSaveStep}}\n{{^isSaveStep}}\n<div class="query-footer singlepadding grey overflow-hidden">\n{{#isEdit}}\n<a class="link-edit-queryeditor{{#name}} js-edit-queryeditor grey{{/name}} {{^name}}disabled customtip"\ntitle="You need to name your Query first"{{/name}}>\n<span class="icon-pencil smallpadding-right"></span>Edit this Query manually\n</a>\n{{/isEdit}}\n<span class="js-query-length-counter floatright">{{queryLength}} characters left</span>\n</div>\n{{/isSaveStep}}\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/querywizard/css/queryFooterView.css",["css!src/querywizard/css/compiled.css"],function(){});define("src/querywizard/views/elements/QueryFooterView",["underscore","backbone","src/models/Query","src/helpers/queryLengthHelper","src/querywizard/events/QueryWizardEventNames","src/querywizard/helpers/queryWizardConfirmHelper","mustache!src/querywizard/templates/elements/queryFooterView","css!src/querywizard/css/queryFooterView.css","src/packages/customtip"],function(_,Backbone,QueryModel,queryLengthHelper,QueryWizardEventNames,queryWizardConfirmHelper,template){"use strict";var QUERY_TEXT_MAX_LENGTH=QueryModel.queryTextMaxLength;var VIEW_SELECTORS={QUERY_LENGTH_COUNTER:".js-query-length-counter"};var QueryFooterView=Backbone.View.extend({events:{"click .js-edit-queryeditor":function clickJsEditQueryeditor(){var view=this;queryWizardConfirmHelper.editInQueryEditor(function(result){if(!result){return}view.trigger(QueryWizardEventNames.REQUEST_EDIT_WITHIN_QUERY_EDITOR,{linkType:"Query Footer"})})}},constructor:function QueryFooterView(){Backbone.View.apply(this,arguments)},render:function render(data){var allIndicatorCssClasses=queryLengthHelper.getAllIndicatorCssClasses();var newCssClass;data=data||{};newCssClass=queryLengthHelper.getIndicatorCssClass(data.includedTerms?data.includedTerms.length:0);this.$el.html(template(_.extend({},data,{queryLength:data.includedTerms?QUERY_TEXT_MAX_LENGTH-data.includedTerms.length:QUERY_TEXT_MAX_LENGTH})));this.$(VIEW_SELECTORS.QUERY_LENGTH_COUNTER).removeClass(allIndicatorCssClasses).addClass(newCssClass);this.$el.customtip()}});return QueryFooterView});define("mustache!src/querywizard/templates/querySummaryView",["lib/mustache"],function(mustache){var escapedTemplate='<span class="biggertext hugeline smallmargin-bottom singlemargin-top">This is what your Query looks like</span>\n<div class="query-summary-content bwscrollbar lightgreybg">\n<div class="js-query-string"></div>\n</div>\n<div class="js-query-footer"></div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/querywizard/css/querySummaryView.css",["css!src/querywizard/css/compiled.css"],function(){});define("src/querywizard/views/QuerySummaryView",["backbone","mustache!src/querywizard/templates/querySummaryView","css!src/querywizard/css/querySummaryView.css"],function(Backbone,template){"use strict";var VIEW_SELECTORS={QUERY_STRING:".js-query-string",QUERY_FOOTER:".js-query-footer"};var QuerySummaryView=Backbone.View.extend({constructor:function QuerySummaryView(){Backbone.View.apply(this,arguments)},render:function render(data){if(!data||!data.hasQuerySummaryView){return}this.$el.html(template);this.$(VIEW_SELECTORS.QUERY_STRING).html(data.$queryString);this.$(VIEW_SELECTORS.QUERY_FOOTER).html(data.$queryFooter)}});return QuerySummaryView});define("src/querywizard/TestSearchReducers",["underscore","bw-fe-helpers/numberHelper"],function(_,numberHelper){"use strict";var reducers={};function defaultReducer(state,props){return _.extend({},state,props)}function reduceTestsearchDeltaProps(state,props){var newState=_.extend({},state,props);var isLoadingCurrentOrDeltaTestsearchResults=newState.isLoadingTestsearchResults||newState.isLoadingTestsearchDelta;var isFirstSearch=newState.previousTestsearchResultsTotal===undefined&&(props.testsearchResultsTotal!==undefined||isLoadingCurrentOrDeltaTestsearchResults);var testsearchResultsDelta;if(isFirstSearch&&!state.isEdit){newState.previousTestsearchResultsTotal=0}if(isFirstSearch&&state.isEdit||props.testsearchResultsDelta===null){return _.extend(newState,{canShowMentionsDeltaView:false,testsearchResultsDelta:null})}newState.isLoadingCurrentOrDeltaTestsearchResults=isLoadingCurrentOrDeltaTestsearchResults;newState.showForTheFirstTime=!state.canShowMentionsDeltaView;if(newState.isLoadingCurrentOrDeltaTestsearchResults){return _.extend(newState,{testsearchResultsDelta:{hasIncreased:false,hasDecreased:false}})}if(props.isDeltaModeActive!==undefined||props.activeTab!==undefined){return _.extend(newState,{testsearchResultsDelta:_.extend({highlight:false},state.testsearchResultsDelta),showAfterSwitch:state.isDeltaModeActive!==newState.isDeltaModeActive})}testsearchResultsDelta=getTestsearchResultsDelta(newState);return _.extend(newState,{canShowMentionsDeltaView:true,testsearchResultsDelta:testsearchResultsDelta})}function getTestsearchResultsDelta(newState){var testsearchResultsTotal=newState.testsearchResultsTotal;var isValidDeltaMentionsCount=newState.canRequestDeltaMode&&(!newState.testSearchOptionsByMode||newState.testSearchOptionsByMode.delta.term!==null);var deltaMentionsCount=isValidDeltaMentionsCount&&newState.deltaMentionsCount!==null?newState.deltaMentionsCount:Math.abs(testsearchResultsTotal-newState.previousTestsearchResultsTotal);var hasIncreased=newState.previousTestsearchResultsTotal<testsearchResultsTotal;var hasDecreased=newState.previousTestsearchResultsTotal>testsearchResultsTotal;var updatedPreviousTestsearchResultsTotal=hasIncreased?testsearchResultsTotal-deltaMentionsCount:testsearchResultsTotal+deltaMentionsCount;var deltaMentionsPercent=deltaMentionsCount/updatedPreviousTestsearchResultsTotal*100;var deltaMentionsRoundedPercent=Math.round(deltaMentionsPercent);var hasPercentageBeenRounded=deltaMentionsPercent!==deltaMentionsRoundedPercent;var deltaMentionsPercentPrefix="";var deltaMentionsPercentLabel="";var formatNumber=numberHelper.formatSpaceDelimitedNumber;if(hasIncreased){deltaMentionsPercentLabel=" increase";if(hasPercentageBeenRounded&&deltaMentionsRoundedPercent===0){deltaMentionsPercentPrefix="<";deltaMentionsRoundedPercent=.5}}else if(hasDecreased){deltaMentionsPercentLabel=" decrease";if(hasPercentageBeenRounded){switch(deltaMentionsRoundedPercent){case 100:deltaMentionsPercentPrefix=">";deltaMentionsRoundedPercent=99.5;break;case 0:deltaMentionsPercentPrefix="<";deltaMentionsRoundedPercent=.5;break;default:break}}}return{highlight:hasIncreased||hasDecreased,hasIncreased:hasIncreased,hasDecreased:hasDecreased,isDeltaModeAvailable:isValidDeltaMentionsCount&&(hasIncreased||hasDecreased),mentionsCount:formatNumber(deltaMentionsCount),isCountOne:deltaMentionsCount===1,mentionsPercentText:!isFinite(deltaMentionsRoundedPercent)?null:deltaMentionsPercentPrefix+formatNumber(deltaMentionsRoundedPercent)+"%"+deltaMentionsPercentLabel}}reducers.delta=reduceTestsearchDeltaProps;return{get:function get(key){return reducers[key]||defaultReducer}}});define("src/querywizard/helpers/queryWizardTestSearchXhrDataHelper",["underscore"],function(_){"use strict";var helper;var isXhrRunning=function isXhrRunning(xhr){return!!xhr&&xhr.state()==="pending"};var isXhrSuccessful=function isXhrSuccessful(xhr){return!!xhr&&xhr.state()==="resolved"};var isArrayDifferent=function isArrayDifferent(){var arrayA=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var arrayB=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];if(arrayA.length!==arrayB.length){return true}return _.intersection(arrayB,arrayA).length!==arrayB.length};var isOutdated=function isOutdated(xhrData,testSearchOptions){return!xhrData||!testSearchOptions||xhrData.requestedIncludedTerms!==testSearchOptions.term||isArrayDifferent(xhrData.requestedExclusionSnippetIds,testSearchOptions.exclusionSnippetIds)||isArrayDifferent(xhrData.requestedInclusionSnippetIds,testSearchOptions.inclusionSnippetIds)||xhrData.requestedLanguageAgnostic!==testSearchOptions.languageAgnostic||isArrayDifferent(xhrData.requestedLanguages,testSearchOptions.langCode)};var collectionNeedsUpdate=function collectionNeedsUpdate(xhrData,qwState){var xhr=xhrData&&xhrData.request;if(helper.isOutdated(xhrData,qwState)){return true}if(helper.isXhrRunning(xhr)){return false}return!isXhrSuccessful(xhr)};helper={isXhrRunning:isXhrRunning,isOutdated:isOutdated,collectionNeedsUpdate:collectionNeedsUpdate};return helper});define("src/querywizard/helpers/queryWizardDeltaQueryHelper",["underscore","src/querywizard/TermNode","src/querywizard/helpers/queryWizardQueryHelper"],function(_,TermNode,queryWizardQueryHelper){"use strict";var helper;var OPERATORS=TermNode.OPERATORS;var wrapWithBrackets=function wrapWithBrackets(string){return"(".concat(string,")")};var reduceDeltaData=function reduceDeltaData(deltaDataA,deltaDataB,operator){var reducedDeltaData;if(!deltaDataA||!deltaDataB){return null}switch(operator){case OPERATORS.NOT:reducedDeltaData={mayIncrease:deltaDataA.mayIncrease||deltaDataB.mayDecrease,mayDecrease:deltaDataA.mayDecrease||deltaDataB.mayIncrease};break;case OPERATORS.AND:case OPERATORS.NEAR:case OPERATORS.OR:reducedDeltaData={mayIncrease:deltaDataA.mayIncrease||deltaDataB.mayIncrease,mayDecrease:deltaDataA.mayDecrease||deltaDataB.mayDecrease};break;default:reducedDeltaData=null}if(!reducedDeltaData||reducedDeltaData.mayIncrease&&reducedDeltaData.mayDecrease){return null}return reducedDeltaData};var inferDeltaDataFromNOTNodes=function inferDeltaDataFromNOTNodes(previousTermNode,currentTermNode){var leftDeltaData={};var rightDeltaData={};if(previousTermNode.children.length>0){leftDeltaData=helper.inferDeltaDataFromTrees(previousTermNode.children[0],currentTermNode.children[0])}if(previousTermNode.children.length>1){rightDeltaData=helper.inferDeltaDataFromTrees(previousTermNode.children[1],currentTermNode.children[1])}return helper.reduceDeltaData(leftDeltaData,rightDeltaData,previousTermNode.operator)};var getNodeString=function getNodeString(node){return node.toResult?node.toResult():node};var equalsNode=function equalsNode(nodeA,nodeB){return getNodeString(nodeA)===getNodeString(nodeB)};var isContained=function isContained(containedNode,containerNode){return!!containerNode.children&&!!containerNode.children.find(equalsNode.bind(null,containedNode))};var inferDeltaDataFromNewOperatorNode=function inferDeltaDataFromNewOperatorNode(previousTermNode,currentTermNode){var isPreviousContainedInCurrent=isContained(previousTermNode,currentTermNode);var isCurrentContainedInPrevious=isContained(currentTermNode,previousTermNode);if(!isPreviousContainedInCurrent&&!isCurrentContainedInPrevious){return null}var operator=isPreviousContainedInCurrent?currentTermNode.operator:previousTermNode.operator;var containedPartIndex=isPreviousContainedInCurrent?currentTermNode.children.findIndex(equalsNode.bind(null,previousTermNode)):previousTermNode.children.findIndex(equalsNode.bind(null,currentTermNode));switch(operator){case OPERATORS.NOT:if(containedPartIndex>0){return null}return{mayIncrease:!isPreviousContainedInCurrent,mayDecrease:isPreviousContainedInCurrent};case OPERATORS.AND:case OPERATORS.NEAR:return{mayIncrease:!isPreviousContainedInCurrent,mayDecrease:isPreviousContainedInCurrent};case TermNode.OPERATORS.OR:return{mayIncrease:isPreviousContainedInCurrent,mayDecrease:!isPreviousContainedInCurrent};default:return null}};var inferDeltaDataFromParentNodes=function inferDeltaDataFromParentNodes(previousTermNode,currentTermNode){var currentTermNodeHasMoreChildren;var identityDeltaData={mayIncrease:false,mayDecrease:false};if(previousTermNode.toResult()===currentTermNode.toResult()){return identityDeltaData}if(previousTermNode.operator!==currentTermNode.operator){return inferDeltaDataFromNewOperatorNode(previousTermNode,currentTermNode)}if(previousTermNode.children.length===currentTermNode.children.length){if(previousTermNode.operator===OPERATORS.NOT){return inferDeltaDataFromNOTNodes(previousTermNode,currentTermNode)}return previousTermNode.children.reduce(function(deltaData,currentPreviousTermNodeChild,index){var currentDeltaData=helper.inferDeltaDataFromTrees(currentPreviousTermNodeChild,currentTermNode.children[index]);return helper.reduceDeltaData(deltaData,currentDeltaData,previousTermNode.operator)},identityDeltaData)}currentTermNodeHasMoreChildren=previousTermNode.children.length<currentTermNode.children.length;switch(currentTermNode.operator){case OPERATORS.NOT:case OPERATORS.AND:case OPERATORS.NEAR:return{mayIncrease:!currentTermNodeHasMoreChildren,mayDecrease:currentTermNodeHasMoreChildren};case OPERATORS.OR:return{mayIncrease:currentTermNodeHasMoreChildren,mayDecrease:!currentTermNodeHasMoreChildren};default:return null}};var inferDeltaDataFromTrees=function inferDeltaDataFromTrees(previousTermNode,currentTermNode){var isPreviousTermNodeLeaf=typeof previousTermNode==="string";var isCurrentTermNodeLeaf=typeof currentTermNode==="string";if(isPreviousTermNodeLeaf&&isCurrentTermNodeLeaf){if(previousTermNode===currentTermNode){return{mayIncrease:false,mayDecrease:false}}return null}if(!isPreviousTermNodeLeaf&&!isCurrentTermNodeLeaf){return helper.inferDeltaDataFromParentNodes(previousTermNode,currentTermNode)}return inferDeltaDataFromNewOperatorNode(previousTermNode,currentTermNode)};var buildDeltaQueryString=function buildDeltaQueryString(previousTermNodeTree,currentTermNodeTree){var previousQueryString=previousTermNodeTree.toResult();var currentQueryString=currentTermNodeTree.toResult();var deltaData=helper.inferDeltaDataFromTrees(previousTermNodeTree,currentTermNodeTree);var supersetQuery;var subsetQuery;var tree;if(!deltaData||!deltaData.mayIncrease&&!deltaData.mayDecrease){return null}supersetQuery=deltaData.mayDecrease?previousQueryString:currentQueryString;subsetQuery=deltaData.mayDecrease?currentQueryString:previousQueryString;tree=new TermNode([supersetQuery,subsetQuery].map(wrapWithBrackets),OPERATORS.NOT);return tree.toResult()};var haveMultipleExclusionSnippetChanged=function haveMultipleExclusionSnippetChanged(previousExclusionSnippetIds,currentExclusionSnippetIds){var intersection=_.intersection(currentExclusionSnippetIds,previousExclusionSnippetIds);var hasMultipleAdditions=currentExclusionSnippetIds.length-intersection.length>1;var hasMultipleDeletions=previousExclusionSnippetIds.length-intersection.length>1;var hasSwapped=intersection.length!==Math.min(currentExclusionSnippetIds.length,previousExclusionSnippetIds.length);return hasMultipleAdditions||hasMultipleDeletions||hasSwapped};var getTestSearchOptions=function getTestSearchOptions(previousQueryXhrData,qwState){var currentExclusionSnippetIds=queryWizardQueryHelper.getSnippetIds(qwState.exclusionSnippets,qwState.exclusionSnippetData)||[];var previousExclusionSnippetIds=previousQueryXhrData&&previousQueryXhrData.requestedExclusionSnippetIds||[];var hasAddedExclusionSnippets=currentExclusionSnippetIds.length>previousExclusionSnippetIds.length;var testSearchOptions=queryWizardQueryHelper.getTestSearchOptions(qwState);var currentTermNodeTree=testSearchOptions.optimisedTermNodeTree;var previousTermNodeTree=previousQueryXhrData&&previousQueryXhrData.requestedTermNodeTree;var hasOptimisedQueryPartChanged=previousQueryXhrData&&qwState.optimisedIncludedTerms!==previousQueryXhrData.requestedIncludedTerms;var haveExclusionSnippetsChanged=currentExclusionSnippetIds.length!==previousExclusionSnippetIds.length;if(!previousTermNodeTree||haveExclusionSnippetsChanged&&hasOptimisedQueryPartChanged||haveMultipleExclusionSnippetChanged(currentExclusionSnippetIds,previousExclusionSnippetIds)){return null}if(hasOptimisedQueryPartChanged){testSearchOptions.term=helper.buildDeltaQueryString(previousTermNodeTree,currentTermNodeTree);return testSearchOptions}if(!haveExclusionSnippetsChanged){return testSearchOptions}testSearchOptions.exclusionSnippetIds=_.intersection(currentExclusionSnippetIds,previousExclusionSnippetIds);testSearchOptions.inclusionSnippetIds=hasAddedExclusionSnippets?_.difference(currentExclusionSnippetIds,previousExclusionSnippetIds):_.difference(previousExclusionSnippetIds,currentExclusionSnippetIds);return testSearchOptions};helper={getTestSearchOptions:getTestSearchOptions,buildDeltaQueryString:buildDeltaQueryString,inferDeltaDataFromTrees:inferDeltaDataFromTrees,inferDeltaDataFromParentNodes:inferDeltaDataFromParentNodes,reduceDeltaData:reduceDeltaData};return helper});define("mustache!src/querywizard/templates/mentionsDeltaView",["lib/mustache"],function(mustache){var escapedTemplate='{{^isDeltaModeActive}}\n{{#canShowMentionsDeltaView}}\n<div class="js-mentions-delta-slidable {{#showForTheFirstTime}}mentions-delta__slide-up{{/showForTheFirstTime}}">\n\n{{#isLoadingCurrentOrDeltaTestsearchResults}}\n<div class="mentions-delta-wrapper">\n<span>Calculating...</span>\n</div>\n{{/isLoadingCurrentOrDeltaTestsearchResults}}\n\n{{^isLoadingCurrentOrDeltaTestsearchResults}}\n{{#mentionsCount}}\n<div class="js-mentions-delta-wrapper mentions-delta-wrapper">\n<span class="js-delta-text">\n<div class="dib bold mentions-count{{#highlight}} mentions-delta__highlight-changes{{/highlight}}">\n{{#isDeltaModeAvailable}}<a class="js-delta-preview-switcher">{{/isDeltaModeAvailable}}\n{{mentionsCount}} Mention{{^isCountOne}}s{{/isCountOne}}\n{{#isDeltaModeAvailable}}</a>{{/isDeltaModeAvailable}}\n</div>\n\n{{#hasDecreased}}removed{{/hasDecreased}}{{^hasDecreased}}added{{/hasDecreased}}\nby your change\n\n{{#mentionsPercentText}}\n{{#isDeltaModeAvailable}}<a class="js-delta-preview-switcher">{{/isDeltaModeAvailable}}\n<span class="mentions-count">({{mentionsPercentText}})</span>\n{{#isDeltaModeAvailable}}</a>{{/isDeltaModeAvailable}}\n{{/mentionsPercentText}}\n<a class="help icon-bwhelp" data-key="querywizard-mentions-delta"></a>\n</span>\n\n{{#isDeltaModeAvailable}}\n<a class="js-mentions-delta-query-wizard-tour js-delta-preview-switcher js-delta-preview-button preview-switcher customtip" title="Preview changes">\n<span class="js-delta-preview-switcher-label tinypadding-right">\n{{#hasIncreased}}\nAdded mentions view\n{{/hasIncreased}}\n{{#hasDecreased}}\nRemoved mentions view\n{{/hasDecreased}}\n</span>\n<span class="icon-chevron-up smalltext"></span>\n</a>\n{{/isDeltaModeAvailable}}\n</div>\n{{/mentionsCount}}\n{{/isLoadingCurrentOrDeltaTestsearchResults}}\n\n</div>\n{{/canShowMentionsDeltaView}}\n{{/isDeltaModeActive}}\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/querywizard/views/MentionsDeltaView",["backbone","src/pageTour","src/querywizard/events/QueryWizardEventNames","mustache!src/querywizard/templates/mentionsDeltaView","src/packages/customtip"],function(Backbone,pageTour,QueryWizardEventNames,template){"use strict";var VIEW_SELECTORS={MENTIONS_DELTA_SLIDE_UP:".js-mentions-delta-slidable",MENTIONS_DELTA_WRAPPER:".js-mentions-delta-wrapper",DELTA_PREVIEW_BUTTON:".js-delta-preview-button",DELTA_PREVIEW_SWITCHER:".js-delta-preview-switcher",DELTA_PREVIEW_SWITCHER_LABEL:".js-delta-preview-switcher-label",DELTA_TEXT:".js-delta-text"};function onDeltaPreviewSwitch(view){pageTour.close("mentionsDeltaQueryWizard");view.trigger(QueryWizardEventNames.PREVIEW_DELTA_MODE_CHANGED,true)}function hideOverlappingPreviewSwitcherLabel(view){var availableWidth=view.$(VIEW_SELECTORS.MENTIONS_DELTA_WRAPPER).width();var deltaTextWidth=view.$(VIEW_SELECTORS.DELTA_TEXT).width();var deltaPreviewButtonMaxWidth=142;var padding=14;view.$(VIEW_SELECTORS.DELTA_PREVIEW_SWITCHER_LABEL).toggleClass("hidden",deltaTextWidth+deltaPreviewButtonMaxWidth+padding>availableWidth)}function addRelativePopups(view){pageTour.setTourMark("mentionsDeltaQueryWizard");view.$(VIEW_SELECTORS.DELTA_PREVIEW_BUTTON).customtip()}var MentionsDeltaView=Backbone.View.extend({className:"mentions-delta",events:function events(){return{"click .js-delta-preview-switcher":onDeltaPreviewSwitch.bind(null,this)}},constructor:function MentionsDeltaView(){Backbone.View.apply(this,arguments)},render:function render(data){var templateData;data=data||{};templateData=Object.assign({isDeltaModeActive:data.isDeltaModeActive,isLoadingCurrentOrDeltaTestsearchResults:data.isLoadingCurrentOrDeltaTestsearchResults,showForTheFirstTime:data.showForTheFirstTime,canShowMentionsDeltaView:data.canShowMentionsDeltaView},data.testsearchResultsDelta);this.$el.html(template(templateData));hideOverlappingPreviewSwitcherLabel(this);if(!data.testsearchResultsDelta||!data.testsearchResultsDelta.isDeltaModeAvailable){return}if(data.showForTheFirstTime){this.$(VIEW_SELECTORS.MENTIONS_DELTA_SLIDE_UP).on("animationend",addRelativePopups.bind(null,this))}else{addRelativePopups(this)}},resize:function resize(){hideOverlappingPreviewSwitcherLabel(this)},remove:function remove(){pageTour.close("mentionsDeltaQueryWizard")}});return MentionsDeltaView});define("mustache!src/querywizard/templates/elements/deltaModeHeaderView",["lib/mustache"],function(mustache){var escapedTemplate='{{#isDeltaModeActive}}\n<div  class="delta-mode-header">\n<div class="popuptitletext tinypadding-top">\n<span class="bold">Mentions\n{{#hasIncreased}}added{{/hasIncreased}}\n{{#hasDecreased}}removed{{/hasDecreased}}\n</span>\nby your last change\n</div>\n<div class="mediumtext tinypadding-top">\n<span class="mentions-count">\n{{mentionsCount}} Mention{{^isCountOne}}s{{/isCountOne}}\n</span>\n{{#hasIncreased}}added{{/hasIncreased}}\n{{#hasDecreased}}removed{{/hasDecreased}}\n\n{{#mentionsPercentText}}\n<span class="mentions-count">\n({{mentionsPercentText}})\n</span>\n{{/mentionsPercentText}}\n<a class="help icon-bwhelp" data-key="querywizard-mentions-delta"></a>\n</div>\n<a class="js-query-preview-switcher preview-switcher customtip" title="Back to normal preview">\n<span class="tinypadding-right">\n{{#hasIncreased}}\nAdded mentions view\n{{/hasIncreased}}\n{{#hasDecreased}}\nRemoved mentions view\n{{/hasDecreased}}\n</span>\n<span class="icon-chevron-down smalltext"></span>\n</a>\n</div>\n{{/isDeltaModeActive}}\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/querywizard/views/elements/DeltaModeHeaderView",["backbone","src/querywizard/events/QueryWizardEventNames","mustache!src/querywizard/templates/elements/deltaModeHeaderView","src/packages/customtip"],function(Backbone,QueryWizardEventNames,template){"use strict";var VIEW_SELECTORS={QUERY_PREVIEW_SWITCHER:".js-query-preview-switcher"};return Backbone.View.extend({events:function events(){var _this=this;return{"click .js-query-preview-switcher":function clickJsQueryPreviewSwitcher(){_this.trigger(QueryWizardEventNames.PREVIEW_DELTA_MODE_CHANGED,false)}}},render:function render(){var data=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var templateData=Object.assign({isDeltaModeActive:data.isDeltaModeActive},data.testsearchResultsDelta);this.$el.html(template(templateData));if(data.isDeltaModeActive){this.$(VIEW_SELECTORS.QUERY_PREVIEW_SWITCHER).customtip()}}})});define("mustache!src/querywizard/templates/elements/testSearchQueryAndDeltaContainerView",["lib/mustache"],function(mustache){var escapedTemplate='<div class="js-query-preview fullheight absleft absright"></div>\n<div class="js-delta-preview fullheight absleft absright"></div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/querywizard/views/elements/TestSearchQueryAndDeltaContainerView",["backbone","src/mixins/mixin","src/mixins/withRetrigger","mustache!src/querywizard/templates/elements/testSearchQueryAndDeltaContainerView"],function(Backbone,mixin,withRetrigger,template){"use strict";var VIEW_SELECTORS={QUERY_PREVIEW:".js-query-preview",DELTA_PREVIEW:".js-delta-preview"};function softRender(view,data){view.$(VIEW_SELECTORS.QUERY_PREVIEW).toggleClass("hidden",!!data.isDeltaModeActive);view.$(VIEW_SELECTORS.DELTA_PREVIEW).toggleClass("hidden",!data.isDeltaModeActive);if(!data.isDeltaModeActive){if(typeof view.queryView.shown==="function"){view.queryView.shown()}}else{if(typeof view.deltaView.shown==="function"){view.deltaView.shown()}}}var TestSearchQueryAndDeltaContainerView=Backbone.View.extend({className:"fullheight relative",initialize:function initialize(options){var queryOptions;var deltaOptions;if(!options.collections){throw new Error("TestSearchQueryAndDeltaContainerView must be initialized with options.collections")}if(!options.collections.query){throw new Error("TestSearchQueryAndDeltaContainerView must be initialized with options.collections.query")}if(!options.collections.delta){throw new Error("TestSearchQueryAndDeltaContainerView must be initialized with options.collections.delta")}queryOptions=Object.assign({collection:options.collections.query},options.viewOptions);deltaOptions=Object.assign({collection:options.collections.delta,isDeltaView:true},options.viewOptions);this.queryView=new options.ViewClass(queryOptions);this.deltaView=new options.ViewClass(deltaOptions);this.retrigger(this.queryView,"reload");this.retrigger(this.deltaView,"reload")},remove:function remove(){if(this.queryView){this.queryView.remove()}if(this.deltaView){this.deltaView.remove()}Backbone.View.prototype.remove.call(this)},render:function render(data){data=data||{};this.$el.html(template(data));this.$(VIEW_SELECTORS.QUERY_PREVIEW).append(this.queryView.$el);this.$(VIEW_SELECTORS.DELTA_PREVIEW).append(this.deltaView.$el);softRender(this,data);this.render=softRender.bind(null,this)},resize:function resize(){if(this.queryView.$el.is(":visible")&&typeof this.queryView.resize==="function"){this.queryView.resize()}if(this.deltaView.$el.is(":visible")&&typeof this.deltaView.resize==="function"){this.deltaView.resize()}}});mixin(TestSearchQueryAndDeltaContainerView,withRetrigger);return TestSearchQueryAndDeltaContainerView});define("mustache!src/querywizard/templates/testSearchTabsView",["lib/mustache"],function(mustache){var escapedTemplate='<div class="js-delta-mode-header"></div>\n\n<nav class="horizontal-navigation singlepadding-top singlepadding-right fullwidth">\n{{#tabs}}\n<a class="js-tab horizontal-navigation--item navbuttonshade\nsinglepadding-left singlepadding-right db floatleft\n{{#active}}active{{/active}}" data-key="{{key}}">{{title}}</a>\n{{/tabs}}\n<div class="clearleft"></div>\n</nav>\n<div class="js-tabs-content tabs-content bwscrollbar singlepadding-horizontal">\n{{#tabs}}\n<div class="js-tab-content tab-content hidden" data-key="{{key}}"></div>\n{{/tabs}}\n</div>\n<div class="js-mentions-delta"></div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/querywizard/views/TestSearchTabsView",["jquery","underscore","backbone","src/mixins/mixin","src/mixins/withRetrigger","src/events/queryWizardEvents","src/components/mentions/_testsearch/views/TestSearchResultsView","src/querybuilder/views/HistoryPreviewTabView","src/querybuilder/views/TopicsPreviewTabView","src/querybuilder/views/TopListPreviewTabView","src/querywizard/views/MentionsDeltaView","src/querywizard/events/globalEventNames","src/querywizard/events/QueryWizardEventNames","src/querywizard/views/elements/DeltaModeHeaderView","src/querywizard/views/elements/TestSearchQueryAndDeltaContainerView","mustache!src/querywizard/templates/testSearchTabsView"],function($,_,Backbone,mixin,withRetrigger,queryWizardEvents,TestSearchResultsView,HistoryPreviewTabView,TopicsPreviewTabView,TopListPreviewTabView,MentionsDeltaView,globalQueryWizardEventNames,QueryWizardEventNames,DeltaModeHeaderView,TestSearchQueryAndDeltaContainerView,renderTestSearchTabsView){"use strict";var QUERYWIZARD_EVENTS=globalQueryWizardEventNames.QUERYWIZARD;var TAB_CONFIG=[{key:"mentions",title:"Mentions Preview"},{key:"history",title:"History"},{key:"topics",title:"Topics"},{key:"sites",title:"Sites"},{key:"authors",title:"Authors"}];function getRenderData(data){var activeTab=data.activeTab;var tabs=TAB_CONFIG.map(function(tab){return _.extend({},tab,{active:activeTab===tab.key})});return _.extend({},data,{tabs:tabs})}function updateActiveTab(view,activeViewTabKey){view.$(".js-tab[data-key="+activeViewTabKey+"]").addClass("active").siblings().removeClass("active")}function updateActiveTabView(view,data,activeViewTabKey){var activeView=view[activeViewTabKey+"View"];view.$(".js-tab-content").addClass("hidden");view.$(".js-tab-content[data-key="+activeViewTabKey+"]").removeClass("hidden");activeView.render(data)}function softRender(view,data){var activeViewTabKey=data.activeTab;view.deltaModeHeaderView.render(data);view.mentionsDeltaView.render(data);updateActiveTab(view,activeViewTabKey);updateActiveTabView(view,data,activeViewTabKey)}function trackSwitchTabView(tabId){queryWizardEvents.trigger(QUERYWIZARD_EVENTS.QUERYWIZARD_TESTSEARCH_TAB_CLICKED,{tabId:tabId})}var TestSearchTabsView=Backbone.View.extend({events:{"click .js-tab":function clickJsTab(event){var key=$(event.target).data("key");this.trigger(QueryWizardEventNames.PREVIEW_TAB_CHANGED,key);trackSwitchTabView(key)}},constructor:function TestSearchTabsView(options){var view=this;var requiredCollections=["mentions","history","topics","sites","authors"];if(!options.collections){throw new Error("TestSearchTabsView must be initialized with options.collections")}requiredCollections.forEach(function(requiredCollection){if(!options.collections[requiredCollection]){throw new Error("TestSearchTabsView must be initialized with options.collections."+requiredCollection)}});this.deltaModeHeaderView=new DeltaModeHeaderView;this.retrigger(this.deltaModeHeaderView,QueryWizardEventNames.PREVIEW_DELTA_MODE_CHANGED);this.mentionsDeltaView=new MentionsDeltaView;this.retrigger(this.mentionsDeltaView,QueryWizardEventNames.PREVIEW_DELTA_MODE_CHANGED);this.mentionsView=new TestSearchQueryAndDeltaContainerView({ViewClass:TestSearchResultsView,collections:options.collections.mentions});this.historyView=new TestSearchQueryAndDeltaContainerView({ViewClass:HistoryPreviewTabView,collections:options.collections.history});this.topicsView=new TestSearchQueryAndDeltaContainerView({ViewClass:TopicsPreviewTabView,collections:options.collections.topics});this.sitesView=new TestSearchQueryAndDeltaContainerView({ViewClass:TopListPreviewTabView,collections:options.collections.sites,viewOptions:{mentionType:"site",percentageColumnTooltip:"The percentages show how much share of voice a Site has "+"compared to all Mentions found for this Query."}});this.authorsView=new TestSearchQueryAndDeltaContainerView({ViewClass:TopListPreviewTabView,collections:options.collections.authors,viewOptions:{mentionType:"author",cssClass:"orange",percentageColumnTooltip:"The percentages show how active an "+"Author is compared to all Mentions found for this Query.",demonstrative:"This"}});TAB_CONFIG.forEach(function(tab){var subView=view[tab.key+"View"];view.retrigger(subView,"reload",QueryWizardEventNames.PREVIEW_RESULTS)});this.listenTo(this.topicsView,TopicsPreviewTabView.CLICKTHROUGH_EVENT,function(viewType,topic){queryWizardEvents.trigger(QUERYWIZARD_EVENTS.QUERYWIZARD_TESTSEARCH_TOPIC_CLICKED,viewType,topic)});this.listenTo(this.topicsView,TopicsPreviewTabView.GO_BACK_EVENT,function(viewType){queryWizardEvents.trigger(QUERYWIZARD_EVENTS.QUERYWIZARD_TESTSEARCH_TOPIC_RESULTS_BACK_BUTTON_CLICKED,viewType)});this.listenTo(this.topicsView,TopicsPreviewTabView.SWITCH_VIEW_EVENT,function(viewType){queryWizardEvents.trigger(QUERYWIZARD_EVENTS.QUERYWIZARD_TESTSEARCH_TOPICS_VIEW_SWITCHED,viewType)});Backbone.View.apply(this,arguments)},render:function render(data){var view=this;var renderData=getRenderData(data);view.$el.html(renderTestSearchTabsView(renderData));TAB_CONFIG.forEach(function(tab){var $tabContent=view.$(".js-tab-content[data-key="+tab.key+"]");$tabContent.html(view[tab.key+"View"].$el)});view.$(".js-delta-mode-header").html(view.deltaModeHeaderView.$el);view.$(".js-mentions-delta").html(view.mentionsDeltaView.$el);softRender(view,renderData);view.render=softRender.bind(null,view)},resize:function resize(activeTab){switch(activeTab){case"history":this.historyView.resize();break;case"topics":this.topicsView.resize();break}this.mentionsDeltaView.resize()},remove:function remove(){var view=this;TAB_CONFIG.forEach(function(tab){var tabView=view[tab.key+"View"];if(tabView){tabView.remove();tabView=undefined}});view.deltaModeHeaderView.remove();view.mentionsDeltaView.remove();Backbone.View.prototype.remove.call(this,arguments)}});mixin(TestSearchTabsView,withRetrigger);return TestSearchTabsView});define("mustache!src/querywizard/templates/testSearchPlaceholderView",["lib/mustache"],function(mustache){var escapedTemplate='<div class="biggertext hugeline db grey">Test your Query to preview your results.</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/querywizard/views/TestSearchPlaceholderView",["backbone","mustache!src/querywizard/templates/testSearchPlaceholderView"],function(Backbone,renderTestSearchPlaceholderView){"use strict";var TestSearchPlaceholderView=Backbone.View.extend({constructor:function TestSearchPlaceholderView(){Backbone.View.apply(this,arguments)},render:function render(){this.$el.html(renderTestSearchPlaceholderView())}});return TestSearchPlaceholderView});define("mustache!src/querywizard/templates/testSearch",["lib/mustache"],function(mustache){var escapedTemplate='<div class="js-testsearch-prehead testsearch-prehead">\n</div>\n<div class="js-testsearch-wrapper testsearch-wrapper">\n<div class="js-placeholder placeholder"></div>\n<div class="js-testsearch-tabs testsearch-tabs"></div>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/querywizard/css/testSearch.css",["css!src/querywizard/css/compiled.css"],function(){});define("src/querywizard/views/TestSearchWrapperView",["backbone","src/mixins/mixin","src/mixins/withRetrigger","src/querywizard/views/TestSearchTabsView","src/querywizard/views/TestSearchPlaceholderView","src/querywizard/events/QueryWizardEventNames","mustache!src/querywizard/templates/testSearch","css!src/querywizard/css/testSearch.css"],function(Backbone,mixin,withRetrigger,TestSearchTabsView,TestSearchPlaceholderView,QueryWizardEventNames,renderTestSearchTemplate){"use strict";var VIEW_SELECTORS={PREHEAD:".js-testsearch-prehead",WRAPPER:".js-testsearch-wrapper",TABS:".js-testsearch-tabs",PLACEHOLDER:".js-placeholder",TABS_CONTENT:".js-tabs-content"};var CSS_CLASSES={PREHEAD_SHRINK:"qw-ts-prehead__shrink",PREHEAD_GROW:"qw-ts-prehead__grow",WRAPPER_SHRINK:"qw-ts-wrapper__shrink",WRAPPER_GROW:"qw-ts-wrapper__grow",DELTA_MODE:"delta-mode",INCREASED_RESULTS:"increased-results",DECREASED_RESULTS:"decreased-results"};var softRenderSubViews=function softRenderSubViews(view,data){view.$(VIEW_SELECTORS.WRAPPER).toggleClass(CSS_CLASSES.DELTA_MODE,data.isDeltaModeActive);view.tabsView.render(data);view.placeholderView.render(data)};var softRender=function softRender(view,data){view.$(VIEW_SELECTORS.PREHEAD).removeClass(CSS_CLASSES.PREHEAD_SHRINK).removeClass(CSS_CLASSES.PREHEAD_GROW);view.$(VIEW_SELECTORS.WRAPPER).removeClass(CSS_CLASSES.WRAPPER_SHRINK).removeClass(CSS_CLASSES.WRAPPER_GROW);if(data.testsearchResultsDelta){view.$(VIEW_SELECTORS.WRAPPER).toggleClass(CSS_CLASSES.INCREASED_RESULTS,data.testsearchResultsDelta.hasIncreased).toggleClass(CSS_CLASSES.DECREASED_RESULTS,data.testsearchResultsDelta.hasDecreased)}if(data.isDeltaModeActive){if(data.showAfterSwitch){view.$(VIEW_SELECTORS.PREHEAD).addClass(CSS_CLASSES.PREHEAD_SHRINK);view.$(VIEW_SELECTORS.WRAPPER).addClass(CSS_CLASSES.WRAPPER_GROW)}softRenderSubViews(view,data);return}if(data.showAfterSwitch){view.$(VIEW_SELECTORS.PREHEAD).addClass(CSS_CLASSES.PREHEAD_GROW);view.$(VIEW_SELECTORS.WRAPPER).addClass(CSS_CLASSES.WRAPPER_SHRINK);view.$(VIEW_SELECTORS.WRAPPER).one("animationend",function(){view.trigger(QueryWizardEventNames.PREVIEW_DELTA_ANIMATION_CLOSED)})}else{softRenderSubViews(view,data)}};var TestSearchWrapperView=Backbone.View.extend({constructor:function TestSearchWrapperView(options){options=options||{};if(!options.collectionData){throw new Error("TestSearchWrapperView must be initialized with options.collectionData")}this.collectionData=options.collectionData;Backbone.View.apply(this,arguments)},render:function render(data){var tabsViewOptions;this.$el.append(renderTestSearchTemplate(data));tabsViewOptions={collections:this.collectionData,el:this.$(VIEW_SELECTORS.TABS)};this.tabsView=new TestSearchTabsView(tabsViewOptions);this.placeholderView=new TestSearchPlaceholderView({el:this.$(VIEW_SELECTORS.PLACEHOLDER)});this.retrigger(this.tabsView,QueryWizardEventNames.PREVIEW_RESULTS);this.retrigger(this.tabsView,QueryWizardEventNames.PREVIEW_TAB_CHANGED);this.retrigger(this.tabsView,QueryWizardEventNames.PREVIEW_DELTA_MODE_CHANGED);softRender(this,data);this.render=softRender.bind(null,this)},hidePlaceholder:function hidePlaceholder(){this.$(VIEW_SELECTORS.PLACEHOLDER).addClass("hidden")},resize:function resize(data){var activeTab=data.activeTab;if(this.tabsView){this.tabsView.resize(activeTab)}},remove:function remove(){if(this.tabsView){this.tabsView.remove();delete this.tabsView}if(this.placeholderView){this.placeholderView.remove();delete this.placeholderView}}});mixin(TestSearchWrapperView,withRetrigger);return TestSearchWrapperView});define("src/querywizard/controllers/TestSearchController",["jquery","underscore","src/mixins/mixin","src/mixins/withRetrigger","src/components/mentions/_testsearch/models/TestSearchHistoryCollection","src/components/mentions/_testsearch/models/TestSearchResultsCollection","src/querywizard/TestSearchReducers","src/querywizard/helpers/queryWizardTestSearchXhrDataHelper","src/querywizard/events/QueryWizardEventNames","src/querywizard/helpers/queryWizardQueryHelper","src/querywizard/helpers/queryWizardDeltaQueryHelper","src/querywizard/views/TestSearchWrapperView","src/querybuilder/models/TestSearchTopicsCollection","src/querybuilder/models/TestSearchTopListCollection"],function($,_,mixin,withRetrigger,TestSearchHistoryCollection,TestSearchResultsCollection,TestSearchReducers,queryWizardTestSearchXhrDataHelper,QueryWizardEventNames,queryWizardQueryHelper,queryWizardDeltaQueryHelper,TestSearchWrapperView,TestSearchTopicsCollection,TestSearchTopListCollection){"use strict";function collectionNeedsUpdate(controller,testSearchOptions,tabName,isDeltaCollection){var xhrDataByMode=controller._testSearchXhrDataByTab[tabName];var xhrData=xhrDataByMode&&xhrDataByMode[isDeltaCollection?"delta":"query"];return queryWizardTestSearchXhrDataHelper.collectionNeedsUpdate(xhrData,testSearchOptions)}function abortAllOutdatedRunningXhrs(controller){_(controller._testSearchXhrDataByTab).each(function(xhrDataByMode){_(xhrDataByMode).each(function(xhrData,key){var testSearchOptions=controller.state.testSearchOptionsByMode[key];var isXhrRunning=queryWizardTestSearchXhrDataHelper.isXhrRunning(xhrData.request);var isXhrDataOutdated=queryWizardTestSearchXhrDataHelper.isOutdated(xhrData,testSearchOptions);if(isXhrRunning&&isXhrDataOutdated&&xhrData.request){xhrData.request.abort()}})})}function abortAllRunningXhrs(controller){_(controller._testSearchXhrDataByTab).each(function(xhrDataByMode){_(xhrDataByMode).each(function(xhrData){xhrData.request.abort()})})}function onPreviewTabChanged(controller,tabKey){setState(controller,{activeTab:tabKey});fetch(controller)}function onPreviewDeltaModeChanged(controller,isDeltaModeActive){setState(controller,{isDeltaModeActive:isDeltaModeActive})}function onPreviewDeltaAnimationClosed(controller){setState(controller,{showAfterSwitch:false})}function bindViewEvents(controller){controller.testSearchWrapperView.on(QueryWizardEventNames.PREVIEW_RESULTS,fetch.bind(null,controller));controller.testSearchWrapperView.on(QueryWizardEventNames.PREVIEW_TAB_CHANGED,onPreviewTabChanged.bind(null,controller));controller.testSearchWrapperView.on(QueryWizardEventNames.PREVIEW_DELTA_MODE_CHANGED,onPreviewDeltaModeChanged.bind(null,controller));controller.testSearchWrapperView.on(QueryWizardEventNames.PREVIEW_DELTA_ANIMATION_CLOSED,onPreviewDeltaAnimationClosed.bind(null,controller))}function resetAllCollections(controller,options){_.each(controller.collectionData,function(collections){_.each(collections,function(collection){collection.reset([],options)})})}function canRequestDeltaMode(controller,qwState){var previousRequestMentionsData=controller._testSearchXhrDataByTab.mentions&&controller._testSearchXhrDataByTab.mentions.query;if(!previousRequestMentionsData){return false}return!qwState.haveLanguagesChanged}function onTestSearchQueryResultsRequest(controller){resetAllCollections(controller,{silent:true});setState(controller,{isLoadingTestsearchResults:true,testsearchResultsTotal:null});controller.trigger(QueryWizardEventNames.TEST_SEARCH_CHANGE,{isLoadingTestsearchResults:true,testsearchResultsMetaData:null,testsearchResultsTotal:null,sampledTestsearchResultsMetaData:null})}function onTestSearchQueryResultsSuccess(controller,collection){var resultsMetaData=collection&&collection.resultsMetaData();var eventData={testsearchResultsMetaData:resultsMetaData,testsearchResultsTotal:collection&&collection.total,isLoadingTestsearchResults:false};setState(controller,{isLoadingTestsearchResults:false,testsearchResultsTotal:collection&&collection.total});controller.trigger(QueryWizardEventNames.TEST_SEARCH_CHANGE,eventData)}function onTestSearchQueryResultsError(controller){setState(controller,{isLoadingTestsearchResults:false,testsearchResultsDelta:null})}function onTestSearchDeltaResultsRequest(controller){setState(controller,{isLoadingTestsearchDelta:true,deltaMentionsCount:null})}function onTestSearchDeltaResultsSuccess(controller,collection){setState(controller,{isLoadingTestsearchDelta:false,deltaMentionsCount:collection&&collection.total})}function onTestSearchDeltaResultsError(controller){setState(controller,{isLoadingTestsearchDelta:false,deltaMentionsCount:null})}function createCollections(controller){var testSearchQueryResultsCollection=new TestSearchResultsCollection;var testSearchDeltaResultsCollection=new TestSearchResultsCollection;testSearchQueryResultsCollection.on("sync",onTestSearchQueryResultsSuccess.bind(null,controller));testSearchQueryResultsCollection.on("error",onTestSearchQueryResultsError.bind(null,controller));testSearchDeltaResultsCollection.on("sync",onTestSearchDeltaResultsSuccess.bind(null,controller));testSearchDeltaResultsCollection.on("error",onTestSearchDeltaResultsError.bind(null,controller));return{mentions:{query:testSearchQueryResultsCollection,delta:testSearchDeltaResultsCollection},history:{query:new TestSearchHistoryCollection,delta:new TestSearchHistoryCollection},topics:{query:new TestSearchTopicsCollection,delta:new TestSearchTopicsCollection},sites:{query:new TestSearchTopListCollection(null,{mentionType:"site"}),delta:new TestSearchTopListCollection(null,{mentionType:"site"})},authors:{query:new TestSearchTopListCollection(null,{mentionType:"author"}),delta:new TestSearchTopListCollection(null,{mentionType:"author"})}}}function initializeState(){return{activeTab:"mentions",isDeltaModeAvailable:false,isDeltaModeActive:false,testSearchOptionsByMode:{}}}function initialize(controller){controller.$el=controller.$el||$("<div>");controller.$el.html("");controller.collectionData=createCollections(controller);controller._testSearchXhrDataByTab={};controller.state=initializeState();controller.testSearchWrapperView=new TestSearchWrapperView({collectionData:controller.collectionData,el:controller.$el});controller.testSearchWrapperView.render(controller.state);bindViewEvents(controller)}function fetchMentionsTabData(controller){var testSearchOptions=controller.state.testSearchOptionsByMode.query;if(collectionNeedsUpdate(controller,testSearchOptions,"mentions",false)){onTestSearchQueryResultsRequest(controller);onTestSearchDeltaResultsRequest(controller);fetchTabDataByTabName(controller,"mentions")}}function skipFetch(controller,activeTab,isDeltaCollection,activeTabCollection){if(activeTab==="mentions"){if(isDeltaCollection){onTestSearchDeltaResultsSuccess(controller,activeTabCollection)}else{onTestSearchQueryResultsSuccess(controller,activeTabCollection)}}}function fetchTabDataByTabName(controller,activeTab){var canRequestDeltaMode=controller.state.canRequestDeltaMode;_(controller.collectionData[activeTab]).forEach(function(activeTabCollection,key){var isDeltaCollection=key==="delta";var testSearchOptions;var request;if(isDeltaCollection&&!canRequestDeltaMode){return skipFetch(controller,activeTab,isDeltaCollection,activeTabCollection)}testSearchOptions=controller.state.testSearchOptionsByMode[key];if(!testSearchOptions||testSearchOptions.term===null){return skipFetch(controller,activeTab,isDeltaCollection,null)}if(!collectionNeedsUpdate(controller,testSearchOptions,activeTab,isDeltaCollection)){return skipFetch(controller,activeTab,isDeltaCollection,activeTabCollection)}request=activeTabCollection.fetch(testSearchOptions);if(!controller._testSearchXhrDataByTab[activeTab]){controller._testSearchXhrDataByTab[activeTab]={}}controller._testSearchXhrDataByTab[activeTab][key]={request:request,requestedIncludedTerms:testSearchOptions.term,requestedTermNodeTree:testSearchOptions.optimisedTermNodeTree,requestedLanguages:testSearchOptions.langCode,requestedLanguageAgnostic:testSearchOptions.languageAgnostic,requestedExclusionSnippetIds:testSearchOptions.exclusionSnippetIds,requestedInclusionSnippetIds:testSearchOptions.inclusionSnippetIds}})}function setState(controller,props){var deltaReducer=TestSearchReducers.get("delta");controller.state=_.extend({},controller.state,props,deltaReducer(controller.state,props));controller.testSearchWrapperView.render(controller.state)}function fetch(controller){var activeTab=controller.state.activeTab;controller.testSearchWrapperView.hidePlaceholder();abortAllOutdatedRunningXhrs(controller);fetchMentionsTabData(controller);if(activeTab==="mentions"){return}fetchTabDataByTabName(controller,activeTab)}function TestSearchController(){initialize(this)}TestSearchController.prototype.previewResults=function(qwState){var previousQueryMentionsXhrData=this._testSearchXhrDataByTab.mentions&&this._testSearchXhrDataByTab.mentions.query;setState(this,{testSearchOptionsByMode:{query:queryWizardQueryHelper.getTestSearchOptions(qwState),delta:queryWizardDeltaQueryHelper.getTestSearchOptions(previousQueryMentionsXhrData,qwState)},isEdit:qwState.isEdit,previousTestsearchResultsTotal:qwState.testsearchResultsTotal,canRequestDeltaMode:canRequestDeltaMode(this,qwState),isDeltaModeActive:false});fetch(this)};TestSearchController.prototype.reset=function(){abortAllRunningXhrs(this);resetAllCollections(this);this.trigger(QueryWizardEventNames.TEST_SEARCH_CHANGE,{isLoadingTestsearchResults:false,testsearchResultsMetaData:null,sampledTestsearchResultsMetaData:null});this.remove();initialize(this)};TestSearchController.prototype.resize=function(){this.testSearchWrapperView.resize(this.state)};TestSearchController.prototype.remove=function(){if(this.testSearchWrapperView){this.testSearchWrapperView.remove();delete this.testSearchWrapperView}};mixin(TestSearchController,withRetrigger);return TestSearchController});define("src/querywizard/helpers/suggestApiHelper",["q","bw-fe-helpers/promiseHelper"],function(Q,promiseHelper){"use strict";var RECOMMENDATIONS_API="suggest/recommendationsapi";var COMPLETIONS_API="suggest/completionsapi";var APIS=[RECOMMENDATIONS_API,COMPLETIONS_API];var WEBSITE="websites";var HASHTAG="hashtags";var TWITTER_HANDLE="twitterhandles";var TYPES=[WEBSITE,HASHTAG,TWITTER_HANDLE];function getUrl(apiName,mediaType){return"/"+apiName+"/"+mediaType}function fetchSuggestions(apiName,mediaType,query){return Q.Promise(function(resolve,reject){if(APIS.indexOf(apiName)<0){throw new Error("API name not supported")}if(TYPES.indexOf(mediaType)<0){throw new Error("suggest type not supported")}if(typeof query!=="string"){throw new Error("query must be a query string")}if(!query.length){resolve([])}return promiseHelper.ajax({url:getUrl(apiName,mediaType),data:{q:query}}).then(function(data){resolve(data)},function(errorData){reject(errorData.responseText)})})}return{fetchWebsiteRecommendations:function fetchWebsiteRecommendations(query){return fetchSuggestions(RECOMMENDATIONS_API,WEBSITE,query)},fetchHashtagRecommendations:function fetchHashtagRecommendations(query){return fetchSuggestions(RECOMMENDATIONS_API,HASHTAG,query)},fetchTwitterHandleRecommendations:function fetchTwitterHandleRecommendations(query){return fetchSuggestions(RECOMMENDATIONS_API,TWITTER_HANDLE,query)},fetchWebsiteCompletions:function fetchWebsiteCompletions(query){return fetchSuggestions(COMPLETIONS_API,WEBSITE,query)},fetchHashtagCompletions:function fetchHashtagCompletions(query){return fetchSuggestions(COMPLETIONS_API,HASHTAG,query)},fetchTwitterHandleCompletions:function fetchTwitterHandleCompletions(query){return fetchSuggestions(COMPLETIONS_API,TWITTER_HANDLE,query)}}});define("src/querywizard/controllers/SuggestController",["underscore","q","src/globals/flags","src/globals/flagNames","src/mixins/mixin","src/mixins/withRetrigger","src/helpers/twitterApiHelper","src/querywizard/helpers/suggestApiHelper","src/querywizard/QueryWizardActions","src/querywizard/events/QueryWizardEventNames"],function(_,Q,flags,FLAGS,mixin,withRetrigger,twitterApiHelper,suggestApiHelper,QueryWizardActions,QueryWizardEventNames){"use strict";var SUGGEST_STATE_CHANGE="change";function createNamespacedDataState(name,data){var newState={};newState[name]=data;return newState}function getFormattedUnknownTwitterHandles(handles){return handles.map(function(handle){return{value:handle,data:{isUnknown:true,description:"This Twitter handle doesn't seem to exist on Twitter."}}})}function formatTwitterHandleSelectedData(responseData,requestedHandles){var missingHandles;var formattedResults=responseData.map(function(item){return{label:item.name,value:item.screen_name,data:{description:item.description,tooltip:item.tooltip,imgSrc:item.profile_image_url,verified:item.verified}}});missingHandles=_.difference(requestedHandles,_.pluck(responseData,"screen_name"));return formattedResults.concat(getFormattedUnknownTwitterHandles(missingHandles))}function formatTwitterHandleSearchData(responseData,query,source){return responseData.map(function(item){return{label:item.name,value:item.screen_name,sources:[source],aliases:[query],data:{description:item.description,tooltip:item.tooltip,imgSrc:item.profile_image_url,verified:item.verified}}})}function lookupTwitterHandles(namespace,controller,twitterHandles){var loadingState={};if(!controller.state.loggedIntoTwitter){return}loadingState[namespace]={isSelectedCollectionLoading:true};controller.trigger(QueryWizardEventNames.STATE_CHANGE,loadingState);twitterApiHelper.usersLookup(twitterHandles).then(function(responseData){var newState=createNamespacedDataState(namespace,{isSelectedCollectionLoading:false,selectedData:formatTwitterHandleSelectedData(responseData,twitterHandles),lookupError:false});controller.trigger(QueryWizardEventNames.STATE_CHANGE,newState)},function(err){var newState=createNamespacedDataState(namespace,{isSelectedCollectionLoading:false,selectedData:[],lookupError:err});controller.trigger(QueryWizardEventNames.STATE_CHANGE,newState)})}function searchTwitterHandlesFromTwitterAPI(namespace,controller,query){twitterApiHelper.usersSearch(query).then(function(responseData){var newState=createNamespacedDataState(namespace,{isSearchCollectionLoading:false,searchData:formatTwitterHandleSearchData(responseData,query,"twitterAPI"),searchError:false});controller.trigger(QueryWizardEventNames.STATE_CHANGE,newState)},function(err){var newState=createNamespacedDataState(namespace,{isSearchCollectionLoading:false,searchData:[],searchError:err});controller.trigger(QueryWizardEventNames.STATE_CHANGE,newState)})}function reduceRecommendations(recommendations,result){var newRecommendations=[].concat(recommendations);if(result.state!=="fulfilled"){console.error(result.state+": "+result.reason);return recommendations}result.value.forEach(function(newRecommendation){var index=_(recommendations).findIndex(function(recommendation){return recommendation.value===newRecommendation.value});if(index===-1){newRecommendations.push(newRecommendation)}else{newRecommendations[index].sources=recommendations[index].sources.concat(newRecommendation.sources)}});return newRecommendations}function reduceRecommendationErrors(reducedMessage,result){return reducedMessage+" # "+result.reason}function searchTwitterHandlesFromTwitterAndBrandwatchAPI(namespace,controller,query){var brandwatchAPIRecommendationsPromise=suggestApiHelper.fetchTwitterHandleRecommendations(query).then(function(handleRecommendations){return twitterApiHelper.usersLookup(handleRecommendations)}).then(function(responseData){return formatTwitterHandleSearchData(responseData,query,"brandwatchRecommendationsAPI")});var twitterAPIRecommendationsPromise=twitterApiHelper.usersSearch(query).then(function(responseData){return formatTwitterHandleSearchData(responseData,query,"twitterAPI")});return Q.allSettled([brandwatchAPIRecommendationsPromise,twitterAPIRecommendationsPromise]).then(function(results){var areAllRejected=_.every(results,function(result){return result.state==="rejected"});var newState=createNamespacedDataState(namespace,{isSearchCollectionLoading:false,sourceData:results.reduce(reduceRecommendations,[]),searchError:areAllRejected&&"All sources rejected: "+results.reduce(reduceRecommendationErrors,"")});controller.trigger(QueryWizardEventNames.STATE_CHANGE,newState);return newState})}function searchTwitterHandles(namespace,controller,query){var loadingState={};if(!controller.state.loggedIntoTwitter){loadingState[namespace]={defaultSearchTerm:query};controller.trigger(QueryWizardEventNames.STATE_CHANGE,loadingState);return}loadingState[namespace]={isSearchCollectionLoading:true,defaultSearchTerm:query};controller.trigger(QueryWizardEventNames.STATE_CHANGE,loadingState);if(flags.variation(FLAGS.ENABLE_QUERYWIZARD_RECOMMENDATIONS)&&namespace==="twitterHandleData"){return searchTwitterHandlesFromTwitterAndBrandwatchAPI(namespace,controller,query)}return searchTwitterHandlesFromTwitterAPI(namespace,controller,query)}function fetchSuggestions(fetchFunction,namespace,controller,query){var loadingState=createNamespacedDataState(namespace,{isLoading:true,data:[],error:false});controller.trigger(QueryWizardEventNames.STATE_CHANGE,loadingState);fetchFunction(query).then(function(data){var newState=createNamespacedDataState(namespace,{isLoading:false,data:data,error:false});controller.trigger(QueryWizardEventNames.STATE_CHANGE,newState)}).catch(function(error){var newState=createNamespacedDataState(namespace,{isLoading:false,data:[],error:error});controller.trigger(QueryWizardEventNames.STATE_CHANGE,newState)})}function initializeEventListeners(controller){controller.on(SUGGEST_STATE_CHANGE,function(props){controller.state=_.extend({},controller.state,props);controller.trigger(QueryWizardEventNames.STATE_CHANGE,{twitterHandleData:controller.state,twitterHandleExclusionData:controller.state})})}function initializeTwitterHandleData(controller){twitterApiHelper.getLoginStatus(function(err,loggedIntoTwitter){if(err){loggedIntoTwitter=false}controller.trigger(SUGGEST_STATE_CHANGE,{loggedIntoTwitter:loggedIntoTwitter});if(!loggedIntoTwitter){return}controller.trigger(QueryWizardEventNames.DISPATCH_ACTION,{type:QueryWizardActions.FETCH_TWITTER_HANDLES});controller.trigger(QueryWizardEventNames.DISPATCH_ACTION,{type:QueryWizardActions.FETCH_TWITTER_HANDLE_EXCLUSIONS})})}function SuggestController(){this.state={loggedIntoTwitter:false};initializeEventListeners(this);initializeTwitterHandleData(this)}SuggestController.prototype.fetchHashtagRecommendations=function(query){fetchSuggestions(suggestApiHelper.fetchHashtagRecommendations,"hashtagRecommendations",this,query)};SuggestController.prototype.fetchWebsiteRecommendations=function(query){fetchSuggestions(suggestApiHelper.fetchWebsiteRecommendations,"websiteRecommendations",this,query)};SuggestController.prototype.fetchTwitterHandleRecommendations=function(query){fetchSuggestions(suggestApiHelper.fetchTwitterHandleRecommendations,"twitterHandleRecommendations",this,query)};SuggestController.prototype.fetchHashtagCompletions=function(query){if(query.length<2){return}fetchSuggestions(suggestApiHelper.fetchHashtagCompletions,"hashtagCompletions",this,query)};SuggestController.prototype.fetchWebsiteCompletions=function(query){if(query.length<2){return}fetchSuggestions(suggestApiHelper.fetchWebsiteCompletions,"websiteCompletions",this,query)};SuggestController.prototype.fetchTwitterHandleCompletions=function(query){if(query.length<2){return}fetchSuggestions(suggestApiHelper.fetchTwitterHandleCompletions,"twitterHandleCompletions",this,query)};SuggestController.prototype.fetchTwitterHandles=function(twitterHandles){lookupTwitterHandles("twitterHandleData",this,twitterHandles)};SuggestController.prototype.fetchTwitterHandleExclusions=function(twitterHandles){lookupTwitterHandles("twitterHandleExclusionData",this,twitterHandles)};SuggestController.prototype.searchTwitterHandles=function(query){return searchTwitterHandles("twitterHandleData",this,query)};SuggestController.prototype.searchTwitterHandleExclusions=function(query){searchTwitterHandles("twitterHandleExclusionData",this,query)};SuggestController.prototype.loginToTwitter=function(){var controller=this;twitterApiHelper.login(function(err){if(err){controller.trigger(SUGGEST_STATE_CHANGE,{twitterAuthenticationError:err});return}controller.trigger(SUGGEST_STATE_CHANGE,{loggedIntoTwitter:true});controller.trigger(QueryWizardEventNames.DISPATCH_ACTION,{type:QueryWizardActions.FETCH_TWITTER_HANDLES});controller.trigger(QueryWizardEventNames.DISPATCH_ACTION,{type:QueryWizardActions.FETCH_TWITTER_HANDLE_EXCLUSIONS});controller.trigger(QueryWizardEventNames.DISPATCH_ACTION,{type:QueryWizardActions.SEARCH_TWITTER_HANDLES})})};SuggestController.prototype.remove=function(){this.stopListening();this.off()};mixin(SuggestController,withRetrigger);return SuggestController});define("css!src/querywizard/css/querywizard.css",["css!src/querywizard/css/compiled.css"],function(){});define("src/querywizard/controllers/QueryWizardController",["jquery","underscore","moment","src/globals/flags","appLayout","src/ApiError","src/mixins/mixin","src/mixins/withRetrigger","src/mixins/withPopup","src/helpers/dashboard-wizard/dashboardWizardHelper","src/globals/flagNames","src/globals/me","src/permissions","src/models/Alert","src/models/LanguageCollection","src/models/Query","src/events/queryEvents","src/events/queryWizardEvents","src/events/globalEventNames","src/setupstore/setupstoreApiHelper","src/querywizard/events/globalEventNames","src/querywizard/helpers/queryWizardConfirmHelper","src/querybuilder/queryFormHelper","src/querywizard/QueryWizardFlow","src/querywizard/QueryWizardTransitions","src/querywizard/QueryWizardSetups","src/querywizard/QueryWizardSteps","src/querywizard/QueryWizardActions","src/querywizard/QueryWizardReducers","src/querywizard/QueryWizardValidators","src/querywizard/QueryWizardStepConfig","src/querywizard/helpers/queryWizardDefaultValuesHelper","src/querywizard/events/QueryWizardEventNames","src/querywizard/models/WizardQuery","src/querywizard/models/LocationCollection","src/querywizard/models/ExclusionSnippetCollection","src/querywizard/views/LayoutView","src/querywizard/views/elements/QueryStringView","src/querywizard/views/elements/QueryFooterView","src/querywizard/views/QuerySummaryView","src/querywizard/controllers/TestSearchController","src/querywizard/controllers/SuggestController","lib/jquery.notify","css!src/querywizard/css/querywizard.css"],function($,_,moment,flags,appLayout,ApiError,mixin,withRetrigger,withPopup,dashboardWizardHelper,FLAGS,me,permissions,Alert,LanguageCollection,QueryModel,queryEvents,queryWizardEvents,globalEventNames,setupstoreApiHelper,globalQueryWizardEventNames,queryWizardConfirmHelper,queryFormHelper,queryWizardFlow,QueryWizardTransitions,QueryWizardSetups,QueryWizardSteps,QueryWizardActions,QueryWizardReducers,QueryWizardValidators,QueryWizardStepConfig,queryWizardDefaultValuesHelper,QueryWizardEventNames,WizardQueryModel,LocationCollection,ExclusionSnippetCollection,LayoutView,QueryStringView,QueryFooterView,QuerySummaryView,TestSearchController,SuggestController){"use strict";var QUERY_EVENTS=globalEventNames.QUERIES;var QUERYWIZARD_EVENTS=globalQueryWizardEventNames.QUERYWIZARD;var WIZARD_PROPERTIES=["usecase","name","languageAgnostic","languages","samplePercent","includedTerms"];var MODEL_ATTRIBUTES=WizardQueryModel.WIZARD_ATTRIBUTES.concat(WIZARD_PROPERTIES);var LOADING_NOTIFICATION_DELAY=1e3;function getTrackingData(state,additionalData){var trackingData={isNew:!state.id,currentStep:state.stepKey,queryId:state.id,usecase:state.usecase,languages:state.languages,languageAgnostic:!!state.languageAgnostic,projectId:state.projectId};WizardQueryModel.WIZARD_ATTRIBUTES.forEach(function(key){trackingData["QW_"+key]=state[key]});return _.extend(trackingData,additionalData)}function getPropsForModel(state){return MODEL_ATTRIBUTES.reduce(function(memo,attr){memo[attr]=state[attr];return memo},{})}function createLayoutView(controller){var view=new LayoutView({el:controller.$el});controller.retrigger(view,QueryWizardEventNames.QUERY_CREATE);controller.retrigger(view,QueryWizardEventNames.TRANSIT);controller.retrigger(view,QueryWizardEventNames.CREATE_SETUP);controller.retrigger(view,QueryWizardEventNames.STATE_CHANGE);controller.retrigger(view,QueryWizardEventNames.CLOSE_QUERY_WIZARD);controller.on(QueryWizardEventNames.MODEL_SYNC,view.hideWaitmask);controller.on(QueryWizardEventNames.MODEL_REQUEST,view.showWaitmask);controller.on(QueryWizardEventNames.MODEL_ERROR,function(model,response){view.hideWaitmask();setState(controller,{serverError:new ApiError(response).message})});return view}function validate(state){var validator=QueryWizardValidators.get(state.stepKey);return validator(state)}function setState(controller,changedProps,silent){changedProps.twitterHandleData=_.extend({},controller.state.twitterHandleData,changedProps.twitterHandleData);changedProps.twitterHandleExclusionData=_.extend({},controller.state.twitterHandleExclusionData,changedProps.twitterHandleExclusionData);controller.state=_.extend({},controller.state,changedProps);controller.state=_.extend({},controller.state,validate(controller.state));if(!silent){renderViews(controller)}}function createCurrentStepView(controller,stepKey){var StepViewClass=QueryWizardStepConfig.getView(stepKey);var view=new StepViewClass;controller.retrigger(view,QueryWizardEventNames.STATE_CHANGE);controller.retrigger(view,QueryWizardEventNames.DISPATCH_ACTION);if(stepKey===QueryWizardSteps.USECASE_SELECTION){controller.retrigger(view,QueryWizardEventNames.REQUEST_EDIT_WITHIN_QUERY_EDITOR)}if(stepKey===QueryWizardSteps.BRAND_OWNED_MEDIA){controller.retrigger(view,QueryWizardEventNames.TWITTER_AUTH_REQUEST)}if(stepKey===QueryWizardSteps.BRAND_EXCLUSIONS){controller.retrigger(view,QueryWizardEventNames.TWITTER_AUTH_REQUEST)}if([QueryWizardSteps.BRAND_SETUPSTORE_ENTRY,QueryWizardSteps.HASHTAG_CAMPAIGN_SETUPSTORE_ENTRY].indexOf(stepKey)>-1){controller.retrigger(view,QueryWizardEventNames.CREATE_SETUP)}return view}function createQueryStringView(){return new QueryStringView}function createQueryFooterView(controller){var view=new QueryFooterView;controller.retrigger(view,QueryWizardEventNames.REQUEST_EDIT_WITHIN_QUERY_EDITOR);return view}function createQuerySummaryView(){return new QuerySummaryView}function createViews(controller){return{layoutView:createLayoutView(controller),queryFooterView:createQueryFooterView(controller),queryStringView:createQueryStringView(),querySummaryView:createQuerySummaryView(),currentStepView:createCurrentStepView(controller,controller.state.stepKey)}}function applyAsideElement(controller,renderData){if(controller.state.testSearchVisible){renderData.$aside=controller.testSearchController.$el;return}if(controller.state.hasQuerySummaryView){renderData.$aside=controller.views.querySummaryView.$el;return}}function renderViews(controller){var views=controller.views;views.queryStringView.$el.detach();views.queryFooterView.$el.detach();var renderData=_.extend({$queryString:views.queryStringView.$el,$queryFooter:views.queryFooterView.$el,$step:views.currentStepView.$el},controller.state);applyAsideElement(controller,renderData);Object.keys(views).forEach(function(key){views[key].render(renderData)})}function initializeModel(controller){var model=controller.model;function applyRetrigger(model){controller.retrigger(model,"request",QueryWizardEventNames.MODEL_REQUEST);controller.retrigger(model,"error",QueryWizardEventNames.MODEL_ERROR);controller.retrigger(model,"sync",QueryWizardEventNames.MODEL_SYNC)}applyRetrigger(model);controller.on(QueryWizardEventNames.QUERY_CREATE,function(options){var needsTransit=options&&options.needsTransit;var saveOptions={validate:false,success:function success(){if(needsTransit){controller.trigger(QueryWizardEventNames.TRANSIT,"next");return}}};if(!needsTransit){controller.retrigger(controller,QueryWizardEventNames.MODEL_SYNC,"confirmed")}model.save(getPropsForModel(controller.state),saveOptions)});controller.on(QueryWizardEventNames.MODEL_SYNC,onQuerySaved.bind(null,controller));controller.on(QueryWizardEventNames.REQUEST_EDIT_WITHIN_QUERY_EDITOR,function(payload){var queryModel;model.set(getPropsForModel(controller.state),{silent:true});queryModel=model.toQueryModel();applyRetrigger(queryModel);setState(controller,{editInQueryEditor:true});queryModel.save({});queryWizardEvents.trigger(QUERYWIZARD_EVENTS.QUERYWIZARD_EDIT_WITHIN_QUERY_EDITOR_REQUESTED,getTrackingData(controller.state,{linkType:payload.linkType}))});return model}function onQuerySaved(controller,model){var isNewQuery=controller.model.isNew();var createAlert=controller.state.createAlert;var createSignal=controller.state.createSignal;queryFormHelper.createBackfill(model,controller.state.backfillDuration);if(createAlert){queryFormHelper.createAlert({query:model,threshold:controller.state.alertThreshold}).catch(function(){$.notify({text:"Failed to create Alert for this Query. You can retry in the Alerts/Custom Alerts section.",className:"notification-error"})})}if(createSignal){queryFormHelper.createSignal({query:model}).catch(function(){$.notify({text:"Failed to create Signal for this Query. You can retry in the Alerts/Signals section.",className:"notification-error"})})}if(!model||model.get("createdByWizard")){return}queryEvents.trigger(isNewQuery?QUERY_EVENTS.QUERY_CREATE:QUERY_EVENTS.QUERY_CHANGE,model);controller.trigger(QueryWizardEventNames.OPEN_QUERY_EDITOR,model)}function getStepNotifications(notifications){if(!notifications){return{}}return Object.keys(notifications).reduce(function(res,key){if(notifications[key]&&notifications[key].keepOnTransit){res[key]=notifications[key]}return res},{})}function getStepState(step,state){return{stepKey:step.stepKey,stepTitleNew:QueryWizardStepConfig.getStepTitleNew(step.stepKey,state.brandName),stepTitleEdit:QueryWizardStepConfig.getStepTitleEdit(step.stepKey,state.brandName),isFirst:step.isFirst,isSetupStoreEntryStep:step.isSetupStoreEntryStep,isSaveStep:step.isSaveStep,hasConfirmStepNext:step.hasConfirmStepNext,testSearchVisible:QueryWizardStepConfig.hasTestSearch(step.stepKey),fetchTwitterHandlesOnStepExit:QueryWizardStepConfig.fetchTwitterHandlesOnStepExit(step.stepKey),fetchRecommendationsOnStepExit:QueryWizardStepConfig.fetchRecommendationsOnStepExit(step.stepKey),hasQuerySummaryView:QueryWizardStepConfig.hasQuerySummaryView(step.stepKey),querySneakViewVisible:QueryWizardStepConfig.hasQuerySneakView(step.stepKey)&&!!state.includedTerms,notifications:getStepNotifications(state.notifications),name:queryWizardDefaultValuesHelper.getQueryName(state),serverError:undefined}}function queryHasNotBeenChanged(controller){var currentPropsForModel=getPropsForModel(controller.state);var modelEditableProps=_.pick(controller.model.toJSON(),MODEL_ATTRIBUTES);modelEditableProps.includedTerms=modelEditableProps.includedTerms.length>0?modelEditableProps.includedTerms[0]:"";return _.isEqual(currentPropsForModel,modelEditableProps)}function executeActionsOnStepExit(controller){if(controller.state.fetchRecommendationsOnStepExit){controller.trigger(QueryWizardEventNames.DISPATCH_ACTION,{type:QueryWizardActions.FETCH_HASHTAG_RECOMMENDATIONS});controller.trigger(QueryWizardEventNames.DISPATCH_ACTION,{type:QueryWizardActions.FETCH_WEBSITE_RECOMMENDATIONS});controller.trigger(QueryWizardEventNames.DISPATCH_ACTION,{type:QueryWizardActions.FETCH_TWITTER_HANDLE_RECOMMENDATIONS})}if(controller.state.fetchTwitterHandlesOnStepExit){controller.trigger(QueryWizardEventNames.DISPATCH_ACTION,{type:QueryWizardActions.SEARCH_TWITTER_HANDLES})}}function executeActionsOnStepEnter(controller){showLoadingTestsearchNotification(controller)}function onRecommendationClicked(controller,options){var newState={};if(!options.doNotUpdateState){newState[options.name]=_.union(controller.state[options.name],[options.value]);controller.trigger(QueryWizardEventNames.STATE_CHANGE,newState)}queryWizardEvents.trigger(QUERYWIZARD_EVENTS.QUERYWIZARD_RECOMMENDATION_CLICKED,getTrackingData(controller.state,options))}function onCompletionAdded(controller,options){queryWizardEvents.trigger(QUERYWIZARD_EVENTS.QUERYWIZARD_COMPLETION_ADDED,getTrackingData(controller.state,options))}function initializeState(controller){var initialStep;var initialState=controller.model.toJSON();var queryCreationRules=controller.queryCreationRules;var reduceAppProps=QueryWizardReducers.get("app");var reduceInitialProps;initialState.includedTerms=Array.isArray(initialState.includedTerms)?initialState.includedTerms[0]:initialState.includedTerms;initialState.timeStamp=+moment.utc();initialState.setupTemplates=[];initialState.projectUsageSummary={mentionLimit:queryCreationRules.projectUsageSummary.get("mentionLimit"),mentionUsage:queryCreationRules.projectUsageSummary.get("mentionsThisMonth"),legacy:queryCreationRules.projectUsageSummary.get("legacy")};initialState.alertThreshold=Alert.DEFAULT_ALERT_THRESHOLD;initialState.canCreateSignals=permissions.check("see.signals");initialState.emailAddress=me.get("username");initialStep=queryWizardFlow.init(QueryWizardTransitions,initialState);reduceInitialProps=QueryWizardReducers.get(initialStep.stepKey);_.extend(initialState,getStepState(initialStep,initialState),{querySneakViewCollapsed:true});_.extend(initialState,reduceInitialProps(initialState,{}));_.extend(initialState,reduceAppProps(initialState,queryCreationRules));_.extend(initialState,queryFormHelper.getBackfillData(queryCreationRules.projectUsageSummary,controller.model));_.extend(initialState,validate(initialState));controller.on(QueryWizardEventNames.TRANSIT,function(direction){var oldStepKey=controller.state.stepKey;var newStep=queryWizardFlow.transit(QueryWizardTransitions,controller.state,direction);var reduceStepProps=QueryWizardReducers.get(newStep.stepKey);var reduceAppProps=QueryWizardReducers.get("app");var reducedProps;var testsearchResultsMetaData=controller.state.testsearchResultsMetaData;var estimatedMonthlyResults=testsearchResultsMetaData&&testsearchResultsMetaData.estimatedMonthlyResults;if(appLayout.helpView){appLayout.helpView.remove()}executeActionsOnStepExit(controller);controller.views.currentStepView.off();controller.views.currentStepView.remove();controller.views.currentStepView=createCurrentStepView(controller,newStep.stepKey);reducedProps=_.extend({},controller.state,getStepState(newStep,controller.state));_.extend(reducedProps,reduceStepProps(reducedProps,{}));_.extend(reducedProps,reduceAppProps(reducedProps,queryCreationRules));setState(controller,reducedProps);executeActionsOnStepEnter(controller);controller.$el.centreModal();queryWizardEvents.trigger(QUERYWIZARD_EVENTS.QUERYWIZARD_TRANSITED,getTrackingData(controller.state,{direction:direction,previousStep:oldStepKey,estimatedMonthlyResults:estimatedMonthlyResults}))});controller.on(QueryWizardEventNames.CREATE_SETUP,function(){var setup=_(controller.state.setupTemplates).findWhere({templateType:controller.state.setupType});controller.trigger("confirmed",controller.model);if(setup){dashboardWizardHelper.start({templateId:setup.id,templateType:controller.state.setupType,projectId:parseInt(controller.state.projectId,10),queryId:controller.model.get("id"),skipDataSourceSelection:true,source:"Query Wizard"})}});controller.on(QueryWizardEventNames.STATE_CHANGE,function(props,options){var state=controller.state;var reduceStepProps=QueryWizardReducers.get(state.stepKey);var reduceAppProps=QueryWizardReducers.get("app");var reducedProps=reduceAppProps(reduceStepProps(state,props),queryCreationRules);if(typeof props.querySneakViewCollapsed!=="undefined"){queryWizardEvents.trigger(QUERYWIZARD_EVENTS.QUERYWIZARD_PREVIEW_TOGGLED,getTrackingData(controller.state,{collapsed:props.querySneakViewCollapsed}))}if(props.isLoadingTestsearchResults===false){clearLoadingNotificationTimer(controller)}setState(controller,reducedProps,options&&options.silent);if(controller.state.hasQueryChanged||controller.state.haveLanguagesChanged){if(options&&options.needsDebouncing){controller.debouncedPreviewResults()}else{previewResults(controller)}}});controller.on(QueryWizardEventNames.DISPATCH_ACTION,function(action){var query;if(action.type===QueryWizardActions.FETCH_LOCATIONS){controller.trigger(QueryWizardEventNames.STATE_CHANGE,{locationPayload:action.payload,locationIsLoading:true});controller.locationCollection.fetch(controller.state);return}if(action.type===QueryWizardActions.FETCH_EXCLUSION_SNIPPETS){controller.trigger(QueryWizardEventNames.STATE_CHANGE,{exclusionSnippetsIsLoading:true});controller.exclusionSnippetCollection.fetch({languages:controller.state.languages})}if(action.type===QueryWizardActions.FETCH_TWITTER_HANDLES){controller.suggestController.fetchTwitterHandles(controller.state.twitterHandles);return}if(action.type===QueryWizardActions.FETCH_TWITTER_HANDLE_EXCLUSIONS){controller.suggestController.fetchTwitterHandleExclusions(controller.state.twitterHandleExclusions);return}if(action.type===QueryWizardActions.SEARCH_TWITTER_HANDLES){query=action.payload!==undefined?action.payload:controller.state.brandName;controller.suggestController.searchTwitterHandles(query);return}if(action.type===QueryWizardActions.SEARCH_TWITTER_HANDLE_EXCLUSIONS){query=action.payload!==undefined?action.payload:controller.state.brandName;controller.suggestController.searchTwitterHandleExclusions(query);return}if(flags.variation(FLAGS.ENABLE_QUERYWIZARD_RECOMMENDATIONS)){if(action.type===QueryWizardActions.FETCH_HASHTAG_RECOMMENDATIONS){controller.suggestController.fetchHashtagRecommendations(controller.state.brandName)}if(action.type===QueryWizardActions.FETCH_WEBSITE_RECOMMENDATIONS){controller.suggestController.fetchWebsiteRecommendations(controller.state.brandName)}if(action.type===QueryWizardActions.FETCH_TWITTER_HANDLE_RECOMMENDATIONS){controller.suggestController.fetchTwitterHandleRecommendations(controller.state.brandName)}if(action.type===QueryWizardActions.RECOMMENDATION_CLICKED){onRecommendationClicked(controller,action.payload)}}if(flags.variation(FLAGS.ENABLE_QUERYWIZARD_COMPLETIONS)){if(action.type===QueryWizardActions.FETCH_HASHTAG_COMPLETIONS){controller.trigger(QueryWizardEventNames.STATE_CHANGE,{hashtagCompletions:[]});controller.suggestController.fetchHashtagCompletions(action.payload)}if(action.type===QueryWizardActions.FETCH_WEBSITE_COMPLETIONS){controller.trigger(QueryWizardEventNames.STATE_CHANGE,{websiteCompletions:[]});controller.suggestController.fetchWebsiteCompletions(action.payload)}if(action.type===QueryWizardActions.FETCH_TWITTER_HANDLE_COMPLETIONS){controller.trigger(QueryWizardEventNames.STATE_CHANGE,{twitterHandleCompletions:[]});controller.suggestController.fetchTwitterHandleCompletions(action.payload)}if(action.type===QueryWizardActions.COMPLETION_ADDED){onCompletionAdded(controller,action.payload)}}});controller.on(QueryWizardEventNames.PREVIEW_RESULTS,function(){if(!controller.state.optimisedIncludedTerms||!controller.state.languages.length){controller.testSearchController.reset();return}controller.testSearchController.previewResults(controller.state);showLoadingTestsearchNotification(controller)});controller.on(QueryWizardEventNames.TWITTER_AUTH_REQUEST,function(){controller.suggestController.loginToTwitter()});controller.on(QueryWizardEventNames.CLOSE_QUERY_WIZARD,function(){if(controller.state.isSetupStoreEntryStep){controller.trigger("confirmed",controller.model);return}if(queryHasNotBeenChanged(controller)){controller.remove();return}queryWizardConfirmHelper.closeQueryWizard(function(result){if(!result){return}controller.remove()})});return initialState}function initializeTestSearchController(controller){var testSearchController=new TestSearchController;controller.retrigger(testSearchController,QueryWizardEventNames.TEST_SEARCH_CHANGE,QueryWizardEventNames.STATE_CHANGE);controller.retrigger(testSearchController,QueryWizardEventNames.PREVIEW_TAB_CHANGED);return testSearchController}function initializeSuggestController(controller){var suggestController=new SuggestController;controller.retrigger(suggestController,QueryWizardEventNames.STATE_CHANGE);controller.retrigger(suggestController,QueryWizardEventNames.DISPATCH_ACTION);return suggestController}function previewResults(controller){controller.trigger(QueryWizardEventNames.PREVIEW_RESULTS)}function clearLoadingNotificationTimer(controller){if(controller._loadingNotificationTimer){clearTimeout(controller._loadingNotificationTimer);controller._loadingNotificationTimer=undefined}}function showLoadingTestsearchNotification(controller){var state=controller.state;if(!state.isLoadingTestsearchResults||!state.showTestsearchNotification){return}function onTimeout(){controller.trigger(QueryWizardEventNames.STATE_CHANGE,{hasLoadingNotificationTimedOut:true})}clearLoadingNotificationTimer(controller);controller._loadingNotificationTimer=setTimeout(onTimeout,LOADING_NOTIFICATION_DELAY)}function initializeDebouncedPreviewResults(controller){return _.debounce(function(){previewResults(controller)},350)}function initializeLanguageCollection(controller){var languageCollection=new LanguageCollection;languageCollection.on("sync",function(data){var languageJSON=data.toJSON();controller.trigger(QueryWizardEventNames.STATE_CHANGE,{languageData:languageJSON})});return languageCollection}function initializeLocationCollection(controller){var locationCollection=new LocationCollection;locationCollection.on("sync",function(collection,result,request){if(request.data.locationIds!==undefined){controller.trigger(QueryWizardEventNames.STATE_CHANGE,{locationIsLoading:false,selectedLocationData:collection.toJSON()})}else{controller.trigger(QueryWizardEventNames.STATE_CHANGE,{locationIsLoading:false,searchLocationData:collection.toJSON()})}});locationCollection.on("error",function(collection,response){controller.trigger(QueryWizardEventNames.STATE_CHANGE,{locationIsLoading:false,locationError:response})});return locationCollection}function initializeExclusionSnippetCollection(controller){var exclusionSnippetCollection=new ExclusionSnippetCollection;exclusionSnippetCollection.on("sync",function(collection){controller.trigger(QueryWizardEventNames.STATE_CHANGE,{exclusionSnippetData:collection.toJSON().reduce(function(memo,snippet){memo[snippet.name]=snippet;return memo},{}),exclusionSnippetsIsLoading:false})});exclusionSnippetCollection.on("error",function(collection,response){controller.trigger(QueryWizardEventNames.STATE_CHANGE,{exclusionSnippetError:response,exclusionSnippetData:[],exclusionSnippetsIsLoading:false})});return exclusionSnippetCollection}function initializeSetupTemplates(controller){setupstoreApiHelper.fetchSetupTemplates(function(error,setupTemplates){if(error){console.error(error);return}setupTemplates.forEach(function(setupTemplate){var isTemplateAllowed=_(QueryWizardSetups.allowedTypesByUsecase).some(function(allowedSetupTypes){return allowedSetupTypes.indexOf(setupTemplate.templateType)>-1});if(!isTemplateAllowed){return}setupstoreApiHelper.fetchSetupTemplate(setupTemplate.id,function(templateError,setupTemplate){var templates;if(templateError){console.error(templateError);return}templates=[].concat(controller.state.setupTemplates,[setupTemplate]);controller.trigger(QueryWizardEventNames.STATE_CHANGE,{setupTemplates:templates})})})})}function initialize(controller,queryModel,queryCreationRules){controller.$el=$('<div class="querywizard">');controller.queryCreationRules=queryCreationRules;controller.model=queryModel.isNew()?new WizardQueryModel({projectId:queryModel.get("projectId"),usecase:queryModel.get("usecase")}):queryModel;initializeModel(controller);initializeSetupTemplates(controller);controller.state=initializeState(controller);controller.views=createViews(controller);controller.debouncedPreviewResults=initializeDebouncedPreviewResults(controller);controller.languageCollection=initializeLanguageCollection(controller);controller.locationCollection=initializeLocationCollection(controller);controller.exclusionSnippetCollection=initializeExclusionSnippetCollection(controller);controller.testSearchController=initializeTestSearchController(controller);controller.suggestController=initializeSuggestController(controller);renderViews(controller);controller.languageCollection.fetch();controller.exclusionSnippetCollection.fetch({languages:controller.state.languages});if(!controller.model.isNew()){if(controller.state.locations){controller.trigger(QueryWizardEventNames.DISPATCH_ACTION,{type:QueryWizardActions.FETCH_LOCATIONS})}if(!controller.state.exclusionSnippets||!controller.state.exclusionSnippets.length){controller.trigger(QueryWizardEventNames.PREVIEW_RESULTS)}}}function QueryWizardController(options){options=options||{};if(!(options.model instanceof QueryModel)){throw new Error("A Query model is required")}if(!options.queryCreationRules){throw new Error("queryCreationRules are required")}initialize(this,options.model,options.queryCreationRules);queryWizardEvents.trigger(QUERYWIZARD_EVENTS.QUERYWIZARD_OPENED,getTrackingData(this.state))}QueryWizardController.prototype.remove=function(){var duration;var additionalData;this.stopListening();this.off();this.testSearchController.remove();this.suggestController.remove();_.each(this.views,function(view){view.remove()});duration=moment().diff(this.state.timeStamp)/1e3;additionalData=_.extend({},this.state.analyticsData,{queryId:this.model.id,wasSaved:this.model.get("lastModificationDate")!==this.state.lastModificationDate,editInQueryEditor:!!this.state.editInQueryEditor,durationInSecs:Math.round(duration),durationInMins:Math.round(duration/60)});queryWizardEvents.trigger(QUERYWIZARD_EVENTS.QUERYWIZARD_CLOSED,getTrackingData(this.state,additionalData))};QueryWizardController.show=function(options){var controller;options=options||{};controller=new QueryWizardController(options);controller.showAsPopup({fitToWindow:true,className:"popup modular querywizard-modal",minWidth:920,minHeight:636,maxWidth:1920,maxHeight:1080,removeCloseIcon:true,onAfterResize:function onAfterResize(){if(controller.views.currentStepView.resize){controller.views.currentStepView.resize(controller.state)}controller.testSearchController.resize()}});return controller};mixin(QueryWizardController,withPopup);mixin(QueryWizardController,withRetrigger);return QueryWizardController});define("mustache!templates/templateInfoView",["lib/mustache"],function(mustache){var escapedTemplate='<div class="typeInfo lightgreybg">\n<section class="js-typeinfo infosection textcenter" data-type="">\n<span class="infoicon icon-bwinfo"></span>\n</section>\n{{#typesHints}}\n<section class="js-typeinfo hidden" data-type="{{ type }}">\n<header>\n<h3 class="infobox--header dib normal doublepadding-horizontal doublemargin-right doublemargin-top">\n{{#description}}\n{{description}}\n{{/description}}\n{{^description}}\n{{name}} {{viewTypeName}}\n{{/description}}\n</h3>\n</header>\n<div class="mediumtext-bigline singlepadding-top doublepadding-horizontal doublepadding-bottom type-description">{{{ text }}}</div>\n{{#hasAnnotations}}\n<label class="js-show-annotations show-annotations db doublemargin-bottom doublepadding-horizontal">\n<input type="checkbox" class="floatleft smallmargin-right smallmargin-bottom" {{#annotationChecked}}checked{{/annotationChecked}}><span>Show Explanations in this Dashboard</span>\n</label>\n{{/hasAnnotations}}\n</section>\n{{/typesHints}}\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!css/templateInfoView.css",["css!css/compiled.css"],function(){});define("src/views/TemplateInfoView",["underscore","jquery","backbone","src/storageProvider","mustache!templates/templateInfoView","css!css/templateInfoView.css"],function(_,$,Backbone,storageProvider,template){"use strict";var ANNOTATION_PREFERENCE_PREFIX="annotationPreference_";function getAnnotationPreferenceKey(type){return ANNOTATION_PREFERENCE_PREFIX+type}function setAnnotationPreference(type,showAnnotations){storageProvider.set(getAnnotationPreferenceKey(type),showAnnotations)}function getAnnotationPreference(type){var preference=storageProvider.get(getAnnotationPreferenceKey(type));return _.isUndefined(preference)?true:preference}function updateAnnotationsChecked(types){types.map(function(type){if(type.hasAnnotations){type.annotationChecked=getAnnotationPreference(type.type)}return type})}var TemplateInfoView=Backbone.View.extend({className:"template-info-view",events:{"change .js-show-annotations input":function onToggleAnnotations(e){var type=$(e.currentTarget).closest(".js-typeinfo").data("type");setAnnotationPreference(type,$(e.currentTarget).is(":checked"))}},constructor:function TemplateInfoView(options){Backbone.View.apply(this,arguments);this.types=options.types;this.viewTypeName=options.viewTypeName},render:function render(){updateAnnotationsChecked(this.types);this.$el.html(template({typesHints:this.types,viewTypeName:this.viewTypeName}))},appendTemplateInfo:function appendTemplateInfo(typeData){this.types=this.types.concat([typeData]);this.render()},removeTemplateInfo:function removeTemplateInfo(typeToRemove){this.$(".js-typeinfo[data-type="+typeToRemove+"]").remove();this.types=this.types.filter(function(t){return t.type!==typeToRemove})},showTemplateInfo:function showTemplateInfo(type){this.$(".js-typeinfo[data-type="+(type||'""')+"]").removeClass("hidden").siblings().addClass("hidden")},isChecked:function isChecked(type){return getAnnotationPreference(type)}});return TemplateInfoView});define("mustache!templates/channelCreation",["lib/mustache"],function(mustache){var escapedTemplate='<h1 class="popuptitletext singlemargin-bottom draggable">{{{title}}}</h1>\n\n<p class="smallmargin-bottom bold">Choose a Channel type</p>\n\n<div class="b-ch-creation__main">\n\n<div class="b-ch-creation__selection doublemargin-bottom">\n</div>\n\n<div class="errorPane notification-error rounded smallpadding-vertical singlepadding-horizontal singlemargin-bottom hidden"/>\n{{#types}}\n<form class="js-form b-ch-creation__form" data-type="{{type}}">\n<div class="doublemargin-bottom">\n<p class="smallmargin-bottom bold" data-label="searchTerm">{{label}}</p>\n<input data-at="channels-profile-or-url" value="{{searchTerm}}" type="text" name="searchTerm"\nplaceholder="{{placeholder}}" class="js-search-term b-ch-creation__search-term validation-wrapper" autocomplete="off">\n</div>\n{{#showQueryName}}\n<div>\n<p class="smallmargin-bottom bold">Channel Name</p>\n<input data-at="facebook-channel-name" value="{{queryName}}" type="text" name="queryName"\nplaceholder="e.g. Unicef {{name}} Channel" class="js-query-name b-ch-creation__query-name validation-wrapper" autocomplete="off">\n</div>\n{{/showQueryName}}\n</form>\n{{/types}}\n\n</div>\n\n<div class="b-ch-creation__info infobox valigntop threecol lightgreybg doublemargin-left"></div>\n\n<footer>\n<button class="js-next b-ch-creation__next defaultbutton" data-at="channels-create-next">Next <span class="tinypadding-left icon-chevron-right"></span></button>\n<button class="js-cancel b-ch-creation__cancel button singlemargin-left">Cancel</button>\n</footer>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!templates/channelFacebookCompliantInfo",["lib/mustache"],function(mustache){var escapedTemplate='<p class="smallmargin-bottom">Use a Facebook Channel to manage and optimize your own pages, and to monitor your competitor\'s posts and performance.</p>\n<p>Facebook Channels require you to authenticate with Facebook. In order to view audience member names and profile pictures, a Page Admin authentication is required.</p>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!css/channelSelectionView.css",["css!css/compiled.css"],function(){});define("src/views/ChannelSelectionView",["underscore","backbone","src/globals/flags","src/globals/flagNames","src/globals/queries","src/DataSourceManager","src/views/ValidatingFormView","src/views/TemplateSelectionView","src/views/TemplateInfoView","src/mixins/mixin","src/mixins/withPopup","mustache!templates/channelCreation","mustache!templates/channelFacebookCompliantInfo","src/packages/modalDialogs","css!css/channelSelectionView.css"],function(_,Backbone,flags,FLAGS,queriesGlobal,dataSourceManager,ValidatingFormView,TemplateSelectionView,TemplateInfoView,mixin,withPopup,channelCreationTemplate,compliantFbTemplate){"use strict";var selectionSel=".b-ch-creation__selection";var infoSel=".b-ch-creation__info";var formSel=".b-ch-creation__form";var nextSel=".b-ch-creation__next";var CreateChannelView=ValidatingFormView.extend({className:"b-ch-creation modular pagepadding",channelTypeView:null,channelInfoView:null,selectedChannel:null,events:{"click .js-cancel":"onCancel","click .js-next":"onContinue","input .js-search-term":"onInput","input .js-query-name":"onInput","submit .js-form":"onContinue"},constructor:function constructor(options){var supportedTypes=dataSourceManager.getChannelsNames();var self=this;options=options||{};options.types=options.types||supportedTypes;this.model=new Backbone.Model;this.meta=options.meta||{};this.types=_.map(dataSourceManager.getChannels(),function(val,key){var additionalSettings={};if(key==="publicfacebook"){additionalSettings.showQueryName=true;additionalSettings.queryName=options.queryName||"";if(flags.variation(FLAGS.FACEBOOK_COMPLIANCE)){additionalSettings.text=compliantFbTemplate}}additionalSettings.showSearchTerm=key!=="instagram";return _.extend({},{type:key},val,self.meta[key]||{},additionalSettings)}).filter(function(el){return _.contains(options.types,el.type)});var selectionView=this.channelTypeView=new TemplateSelectionView({types:this.types,palette:"channels"});var infoView=this.channelInfoView=new TemplateInfoView({viewTypeName:"Channel",types:this.types});Backbone.View.apply(this,arguments);this.selectedChannel=this.types.length===1?this.types[0].type:options.selected||null;this.listenTo(selectionView,"mouseEnteredTemplate",infoView.showTemplateInfo);this.listenTo(selectionView,"mouseLeftTemplate",function(){infoView.showTemplateInfo(this.selectedChannel)});this.listenTo(selectionView,"selectedTypeChanged",this._handleChannelChange)},render:function render(){var title=this.types.length>1?"Create a New Channel":this.types[0].createNew;this.$el.html(channelCreationTemplate({title:title,types:this.types}));this._renderTemplateSelectionView();this._renderTemplateInfoView();this._renderInputs();return this},_renderTemplateSelectionView:function _renderTemplateSelectionView(){this.channelTypeView.render();if(this.selectedChannel){this.channelTypeView.selectTemplate(this.selectedChannel)}this.$(selectionSel).append(this.channelTypeView.$el)},_renderTemplateInfoView:function _renderTemplateInfoView(){this.channelInfoView.render();if(this.selectedChannel){this.channelInfoView.showTemplateInfo(this.selectedChannel)}this.$(infoSel).append(this.channelInfoView.$el)},_renderInputs:function _renderInputs(){var visibleMod="b-ch-creation__form--visible";this.$(formSel).removeClass(visibleMod).filter("[data-type="+this.selectedChannel+"]").addClass(visibleMod);var $searchTerm=this._$searchTerm();if(!this._getSelectedChannelType().showSearchTerm){$searchTerm.hide();$searchTerm.siblings("[data-label=searchTerm]").hide();if(this.meta[this.selectedChannel]&&this.meta[this.selectedChannel].errors){this.showErrors(this.meta[this.selectedChannel].errors.searchTerm)}}else{this.hideErrors();$searchTerm.focus();if(this.meta[this.selectedChannel]&&this.meta[this.selectedChannel].errors){this.showInputValidation(this._$searchTerm(),this.meta[this.selectedChannel].errors)}}this.onInput()},_handleChannelChange:function _handleChannelChange(eventData){var channelType=(eventData||{}).type;if(channelType===this.selectedChannel){return}this.selectedChannel=channelType;this._renderInputs()},_toggleSubmitBtn:function _toggleSubmitBtn(toState){this.$(nextSel).prop("disabled",toState)},_$searchTerm:function _$searchTerm(){return this.$(".b-ch-creation__form--visible .b-ch-creation__search-term")},_$queryName:function _$queryName(){return this.$(".b-ch-creation__form--visible .b-ch-creation__query-name")},_getSelectedChannelType:function _getSelectedChannelType(){var _this=this;if(!this.selectedChannel){return{}}return this.types.find(function(item){return item.type===_this.selectedChannel})},_isValid:function _isValid(){var isValid;if(!this._getSelectedChannelType().showSearchTerm){isValid=true}else{isValid=!!(this._$searchTerm().val()||"").trim().length}if(this._getSelectedChannelType().showQueryName){var queryName=(this._$queryName().val()||"").trim();var isAvailableName=!queriesGlobal.findWhere({name:queryName});isValid=isValid&&queryName.length&&isAvailableName;this.hideError(this._$queryName());if(isValid){return true}if(!isAvailableName){this.showInputValidation(this._$queryName(),{queryName:"A Query or Channel with this name already exists"})}}return isValid},onInput:function onInput(){this._toggleSubmitBtn(!this._isValid())},onCancel:function onCancel(e){e.preventDefault();this.trigger("channelCreationCancelled");this.remove()},onContinue:function onContinue(e){e.preventDefault();if(!this._isValid()){return}this.trigger("queryTypeChosen",{searchTerm:this._$searchTerm().val(),queryName:this._$queryName().val(),queryType:this.selectedChannel});this.remove()},remove:function remove(){this.channelTypeView.remove();this.channelInfoView.remove();ValidatingFormView.prototype.remove.call(this)}});mixin(CreateChannelView,withPopup);return CreateChannelView});(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==="object"&&typeof module==="object")module.exports=factory();else if(typeof define==="function"&&define.amd)define("bw-fe-helpers/facebookHelper",[],factory);else{var a=factory();for(var i in a)(typeof exports==="object"?exports:root)[i]=a[i]}})(this,function(){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=22)}({22:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_exports__["default"]={getPostIdFromPostUrl:function getPostIdFromPostUrl(postUrl){var notFoundString="";if(!postUrl){return notFoundString}var getPostIdRegEx=/facebook.*([&?]story_fbid=|\/posts\/)([0-9]+).*$/,results=getPostIdRegEx.exec(postUrl);if(results){return results[2]}return notFoundString},getAvatar:function getAvatar(facebookAuthorId,options){options=options||{};var url="//graph.facebook.com/"+facebookAuthorId+"/picture";if(options.square){url+="?type=square"}return url}}}})["default"]});(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==="object"&&typeof module==="object")module.exports=factory(require("underscore"));else if(typeof define==="function"&&define.amd)define("bw-fe-helpers/facebookApiErrorParser",["underscore"],factory);else{var a=typeof exports==="object"?factory(require("underscore")):factory(root["underscore"]);for(var i in a)(typeof exports==="object"?exports:root)[i]=a[i]}})(this,function(__WEBPACK_EXTERNAL_MODULE__1__){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=21)}({1:function(module,exports){module.exports=__WEBPACK_EXTERNAL_MODULE__1__},21:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var underscore__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1);var underscore__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(underscore__WEBPACK_IMPORTED_MODULE_0__);__webpack_exports__["default"]={getErrorObject:function getErrorObject(json){if(!underscore__WEBPACK_IMPORTED_MODULE_0___default.a.isObject(json)){return undefined}return json.error||json},getMessageText:function getMessageText(json){var errorObj=this.getErrorObject(json);return errorObj&&errorObj.message},isOAuthError:function isOAuthError(json){var error=this.getErrorObject(json);return error&&error.type==="OAuthException"},isApplicationRateLimitedError:function isApplicationRateLimitedError(json){var error=this.getErrorObject(json);return error&&this.isOAuthError(json)&&error.code===4},isAccessTokenValidationError:function isAccessTokenValidationError(json){var error=this.getErrorObject(json);return error&&this.isOAuthError(json)&&error.code===190},isNoAccessTokenProvidedError:function isNoAccessTokenProvidedError(json){var error=this.getErrorObject(json);return error&&this.isOAuthError(json)&&error.code===104},isObjectNotFoundError:function isObjectNotFoundError(json){var error=this.getErrorObject(json);return error&&this.isOAuthError(json)&&error.code===803},getFriendlyErrorMessage:function getFriendlyErrorMessage(json){var text;if(this.isObjectNotFoundError(json)){return"Could not find page - please check it exists and is public, then try again"}text=this.getMessageText(json);if(text){return"Sorry, Facebook is reporting this error:"+"<br>"+underscore__WEBPACK_IMPORTED_MODULE_0___default.a.escapeHTML(text)}return undefined}}}})["default"]});define("mustache!src/extensions/facebookanalytics/templates/facebookChannelCreationForm",["lib/mustache"],function(mustache){var escapedTemplate='<div>\n<h1 class="popuptitletext doublemargin-bottom draggable">Create Facebook Channel</h1>\n{{{pagePreview}}}\n<div class="b-fb-query-creation__channel-ownership">\n<div class="b-fb-query-creation__ownership-selection doublepadding-right">\n<span class="notification-info rounded smallpadding-vertical singlepadding-horizontal mediumline db singlemargin-bottom">\n{{#fbPageTokenExists}}<strong>Great!</strong> You have Page Admin authentication. We pre-selected "Yes", which we recommend for best possible data coverage.{{/fbPageTokenExists}}\n{{^fbPageTokenExists}}We recommend to select "Yes" if you can provide the Page Admin authentication later.{{/fbPageTokenExists}}\n</span>\n<span class="bold">Set up as an Owned Channel?</span>\n<div class="singlepadding-top">\n<label class="js-ownership b-fb-query-creation__ownership {{#fbPageTokenExists}}b-fb-query-creation__ownership--selected{{/fbPageTokenExists}} db smallpadding smallmargin-bottom" data-type="owned">\n<input type="radio" name="ownership" value="true" {{#fbPageTokenExists}}checked{{/fbPageTokenExists}} /> <span class="bold smallpadding-left">Yes</span>. My organization or client owns this Facebook page.\n</label>\n<label class="js-ownership b-fb-query-creation__ownership db smallpadding" data-type="nonowned">\n<input type="radio" name="ownership" value="false" data-at="facebook-ownership-radio-false" /> <span class="bold smallpadding-left">No</span>. This is a community or competitor\'s Facebook page.\n</label>\n</div>\n</div>\n<div class="b-fb-query-creation__ownership-info infoboxbgcolor singlepadding-vertical doublepadding-right">\n<div class="js-ownership-info" data-type="owned">\n<header class="infobox--header doublepadding-horizontal">Owned Channel</header>\n<span class="db doublepadding-left singlepadding-top">This is a Facebook page that my organization or client owns.</span>\n<span class="db doublepadding-left singlepadding-top">For an Owned Channel to have the best possible data coverage, the Page Admin needs to authenticate with {{productName}}.</span>\n</div>\n<div class="js-ownership-info hidden" data-type="nonowned">\n<header class="infobox--header doublepadding-horizontal">Non-Owned Channel</header>\n<span class="db doublepadding-left singlepadding-top">This is a community or competitor owned Facebook page.</span>\n<span class="db doublepadding-left singlepadding-top">For Non-Owned Channels to have the best possible data coverage, you need as many Facebook users to authenticate with {{productName}} as possible.</span>\n</div>\n</div>\n</div>\n<p>\n<button class="js-back button"><span class="tinypadding-left icon-chevron-left"></span> Back</button>\n<button class="js-save smallmargin-left defaultbutton" data-at="channel-facebook-create" {{^fbPageTokenExists}}disabled{{/fbPageTokenExists}}>Next <span class="tinypadding-left icon-chevron-right"></span></button>\n</p>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/extensions/facebookanalytics/templates/facebookChannelCreationSuccess",["lib/mustache"],function(mustache){var escapedTemplate='<div>\n<h1 class="popuptitletext doublemargin-bottom draggable">Create Facebook Channel</h1>\n\n<div class="notification-success notification rounded smallpadding singlemargin-bottom">\n<strong>Success!</strong> Your Facebook Channel has been created.\n</div>\n\n{{{pagePreview}}}\n\n<hr class="doublemargin-bottom lightborder"/>\n\n{{#fbPageTokenExists}}\n<div class="bold singlepadding-bottom">Congratulations!</div>\n<p class="bigline">Your Facebook Channel has the best possible data coverage as you or somebody in your organisation has provided Page Admin access. However, the data coverage of some of your other Facebook Channels can still be improved by inviting more people to connect.</p>\n{{/fbPageTokenExists}}\n{{^fbPageTokenExists}}\n{{#owned}}\n<div class="bold singlepadding-bottom">How to improve the data coverage of this Channel?</div>\n{{#facebookCompliant}}\n<p class="bigline">This Channel has been created as "Owned" but will only have a basic data coverage on owned posts until the Page Admin authentication has been provided. You can invite the owner to connect in the next step to get the best possible coverage as well as access to audience member names and profile pictures.</p>\n{{/facebookCompliant}}\n{{^facebookCompliant}}\n<p class="bigline">Your Facebook Channel has been created as an Owned Channel but will only have a basic data coverage until Page Admin authentication has been provided. You can invite the owner to connect in the next step to get the best possible coverage.</p>\n{{/facebookCompliant}}\n{{/owned}}\n{{^owned}}\n{{#facebookCompliant}}\n<div class="bold singlepadding-bottom">How to improve the data coverage of a Non-Owned Channel?</div>\n<p class="bigline">This Channel has been created as "Non-Owned" and will have basic data coverage. Audience member names and profile pictures on this page won\'t be available (in accordance with Facebook terms and conditions). You can invite more Facebook users to connect with your Brandwatch account in the next step to get the best possible coverage.</p>\n{{/facebookCompliant}}\n{{^facebookCompliant}}\n<div class="bold singlepadding-bottom">How to Improve a Non-Owned Channel?</div>\n<p class="bigline">Your Facebook Channel has been created as a Non-Owned Channel. This Channel will have  basic data coverage except if there are enough Facebook users connected with your Brandwatch account to provide the best possible data coverage.</p>\n{{/facebookCompliant}}\n{{/owned}}\n{{/fbPageTokenExists}}\n\n<p class="doublemargin-top">\n<button class="js-invite-button defaultbutton">\n{{#fbPageTokenExists}}\nInvite Facebook Users to Connect Now\n{{/fbPageTokenExists}}\n{{^fbPageTokenExists}}\n{{#owned}}\nInvite the Owner to connect Now\n{{/owned}}\n{{^owned}}\nInvite More Facebook Users to Connect Now\n{{/owned}}\n{{/fbPageTokenExists}}\n<span class="icon-chevron-right tinypadding-left"></span>\n</button>\n<button class="js-close smallmargin-left button" data-at="channel-facebook-close">Skip</button>\n</p>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/extensions/facebookanalytics/templates/facebookChannelCreationPreview",["lib/mustache"],function(mustache){var escapedTemplate='<div class="bold smallpadding-bottom">Page Information</div>\n<section class="b-fb-query-creation__channel-preview infoboxbgcolor singlepadding doublemargin-bottom">\n<div class="tinypadding">\n{{#imgURL}}<img class="b-fb-query-creation__channel-image" src="{{imgURL}}" />{{/imgURL}}\n</div>\n<div class="tinypadding singlemargin-left">\n<div class="robotoregularfont biggertext bold smallpadding-bottom">\n{{queryName}}\n</div>\n<div class="tinypadding-bottom">\n<span class="bold">URL:</span> {{link}}\n</div>\n<div class="smallpadding-bottom">\n<span class="bold">Category:</span> {{#category}}{{category}}{{/category}}{{^category}}Not Available{{/category}}\n</div>\n<div class="b-fb-query-creation__channel-about">\n{{about}}\n</div>\n</div>\n</section>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/extensions/facebookanalytics/templates/facebookQueryCreationError",["lib/mustache"],function(mustache){var escapedTemplate='<div>\n<h1 class="popuptitletext doublemargin-bottom draggable">\n{{#apiError}}Facebook Channel could not be created{{/apiError}}\n{{^apiError}}Create Facebook Channel{{/apiError}}\n</h1>\n<div class="notification-error rounded smallpadding-vertical singlepadding-horizontal">\n{{#apiError}}{{apiError}}{{/apiError}}\n{{^apiError}}Sorry, there was an error communicating with Facebook. Please try again later.{{/apiError}}\n</div>\n<p class="doublemargin-top">\n{{#apiError}}\n<button class="js-retry-save defaultbutton"><span class="tinypadding-left icon-chevron-left"></span> Back</button>\n{{/apiError}}\n{{^apiError}}\n<button class="js-retry-facebook defaultbutton">Retry</button>\n{{/apiError}}\n<button class="js-close singlemargin-left button">Cancel</button>\n</p>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/extensions/facebookanalytics/templates/facebookQueryCreationLogin",["lib/mustache"],function(mustache){var escapedTemplate='<h1 class="popuptitletext singlemargin-bottom">Create Facebook Channel</h1>\n<div>\n<p class="singlemargin-bottom">We need to authenticate you to create a Facebook Channel.<br>Please authenticate with Facebook.</p>\n<div class="js-fb-login-view"></div>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/extensions/facebookanalytics/css/facebookPublicQueryForm.css",["css!src/extensions/facebookanalytics/css/compiled.css"],function(){});function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}define("src/extensions/facebookanalytics/views/FacebookPublicQueryCreationView",["jquery","backbone","q","src/globals/flags","src/globals/flagNames","src/globals/theme","src/ApiError","src/extensions/facebookanalytics/views/FacebookLoginView","bw-fe-helpers/facebookHelper","bw-fe-helpers/facebookApiErrorParser","src/helpers/fbTokenServiceHelper","src/views/invitefacebookusers/InviteFacebookUsersView","src/helpers/FB","src/mixins/mixin","src/mixins/withPopup","mustache!src/extensions/facebookanalytics/templates/facebookChannelCreationForm","mustache!src/extensions/facebookanalytics/templates/facebookChannelCreationSuccess","mustache!src/extensions/facebookanalytics/templates/facebookChannelCreationPreview","mustache!src/extensions/facebookanalytics/templates/facebookQueryCreationError","mustache!src/extensions/facebookanalytics/templates/facebookQueryCreationLogin","css!src/extensions/facebookanalytics/css/facebookPublicQueryForm.css","src/packages/customtip"],function($,Backbone,Q,flags,FLAGS,theme,ApiError,FacebookLoginView,facebookHelper,facebookApiErrorParser,fbTokenServiceHelper,InviteFacebookUsersView,FB,mixin,withPopup,channelCreationFormTemplate,channelCreationSuccessTemplate,channelCreationPreviewTemplate,queryCreationErrorTemplate,queryCreationLoginTemplate){"use strict";var _events;var GENERIC_ERROR="Your Channel could not be created at this time, please try again";var VIEW_SELECTORS={CLOSE_FORM:".js-close",RETRY_FACEBOOK:".js-retry-facebook",RETRY_SAVE:".js-retry-save",NAVIGATE_BACK:".js-back",SAVE_CHANNEL:".js-save",FB_LOGIN_VIEW:".js-fb-login-view",SHOW_INVITE:".js-invite-button",OWNERSHIP_STATUS:".js-ownership",OWNERSHIP_INFO:".js-ownership-info"};function createEncodedUrl(term){var facebookBaseUrl="https://www.facebook.com/";var returnUrl;if(term.indexOf("http")===0){returnUrl=term}else{returnUrl=facebookBaseUrl+term}return window.encodeURIComponent(returnUrl)}function saveChannel(view){view.$el.showMessage("Saving Channel...");var data={name:view.queryName,facebookPageId:view.currentSearchResult.id,facebookPageName:view.currentSearchResult.name,facebookPageURL:view.currentSearchResult.link,owned:view.owned};view.model.save(data,{success:function success(){view.trigger("queryCreated",view.model);view.$el.hideMessage();view.renderSuccessMessage()},error:function error(model,resp){var error=new ApiError(resp);var errorMessage=error.errorCodes.length?error.message:GENERIC_ERROR;view.$el.hideMessage();view.renderErrorMessage(errorMessage)}})}function showInfoBox(view,type){view.$(VIEW_SELECTORS.OWNERSHIP_INFO).addClass("hidden").filter('[data-type="'.concat(type,'"]')).removeClass("hidden")}function setSelection(view,type){view.owned=type==="owned";showInfoBox(view,type);view.$(VIEW_SELECTORS.OWNERSHIP_STATUS).removeClass("b-fb-query-creation__ownership--selected").filter('[data-type="'.concat(type,'"]')).addClass("b-fb-query-creation__ownership--selected");view.$(VIEW_SELECTORS.SAVE_CHANNEL).prop("disabled",false)}function showSearchError(view,error){var text="An error occurred contacting Facebook";if(error instanceof Error){text=error.message}else{text=facebookApiErrorParser.getFriendlyErrorMessage(error)||text}return view.navigateBack({meta:{publicfacebook:{errors:{searchTerm:text}}}})}function handlePageSearchError(view,error){if(error instanceof Error||facebookApiErrorParser.isObjectNotFoundError(error)){return showSearchError(view,error)}if(facebookApiErrorParser.isAccessTokenValidationError(error)||facebookApiErrorParser.isNoAccessTokenProvidedError(error)){view.$el.hideMessage();return view.renderFBLoginForm()}var searchTerm=createEncodedUrl(view.searchTerm);return view.getFallbackFbApiSearchPromise(searchTerm).then(handlePageSearchSuccess.bind(null,view)).catch(showSearchError.bind(null,view))}function handlePageSearchSuccess(view,response){return checkForPageToken(response.id,function(pageTokenExists){view.fbPageTokenExists=pageTokenExists;view.setModelData(response);view.renderForm()})}function checkForPageToken(pageId,callback){fbTokenServiceHelper.fetchPageDetails(pageId,function(error){var _ref=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},hasPageToken=_ref.hasPageToken;if(error||!hasPageToken){return callback(false)}callback(true)})}function showInviteForm(view){view.remove();InviteFacebookUsersView.show()}function getPagePreview(view){var data=Object.assign({},view.currentSearchResult,{queryName:view.queryName});return channelCreationPreviewTemplate(data,false)}var FacebookPublicQueryCreationView=Backbone.View.extend({className:"b-fb-query-creation modular ninecol",events:(_events={},_defineProperty(_events,"click ".concat(VIEW_SELECTORS.CLOSE_FORM),"remove"),_defineProperty(_events,"click ".concat(VIEW_SELECTORS.RETRY_FACEBOOK),"render"),_defineProperty(_events,"click ".concat(VIEW_SELECTORS.RETRY_SAVE),"renderForm"),_defineProperty(_events,"click ".concat(VIEW_SELECTORS.NAVIGATE_BACK),"navigateBack"),_defineProperty(_events,"click ".concat(VIEW_SELECTORS.EDIT_TERM),"navigateBack"),_defineProperty(_events,"click ".concat(VIEW_SELECTORS.SAVE_CHANNEL),function click(){saveChannel(this)}),_defineProperty(_events,"click ".concat(VIEW_SELECTORS.SHOW_INVITE),function click(){showInviteForm(this)}),_defineProperty(_events,"mouseover ".concat(VIEW_SELECTORS.OWNERSHIP_STATUS),function mouseover(e){if(typeof this.owned!=="undefined"){return}showInfoBox(this,$(e.currentTarget).data("type"))}),_defineProperty(_events,"click ".concat(VIEW_SELECTORS.OWNERSHIP_STATUS),function click(e){setSelection(this,$(e.currentTarget).data("type"))}),_events),constructor:function FacebookPublicQueryCreationView(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};Backbone.View.apply(this,arguments);if(!options.queryName){throw new Error("FacebookPublicQueryCreationView requires options.queryName for new channel creation flow")}if(!options.searchTerm){throw new Error("FacebookPublicQueryCreationView requires options.searchTerm to be defined")}this.queryName=options.queryName;this.searchTerm=options.searchTerm;this.listenTo(FB,"login",this.initPageSearch)},remove:function remove(){if(this.facebookLoginView){this.facebookLoginView.remove()}this.$el.removeModal();Backbone.View.prototype.remove.call(this)},render:function render(){var _this=this;this.$el.showMessage("Waiting for data");FB.getLoginStatus(function(err,response){if(err){_this.renderErrorMessage();return console.error(err)}if(response.loggedIn){return _this.initPageSearch()}return _this.renderFBLoginForm()})},renderErrorMessage:function renderErrorMessage(apiError){this.$el.html(queryCreationErrorTemplate({apiError:apiError}));this.$el.centreModal()},renderSuccessMessage:function renderSuccessMessage(){this.$el.html(channelCreationSuccessTemplate({owned:this.owned,fbPageTokenExists:this.fbPageTokenExists,pagePreview:getPagePreview(this),facebookCompliant:flags.variation(FLAGS.FACEBOOK_COMPLIANCE)}));this.$el.centreModal()},renderForm:function renderForm(){var data={fbPageTokenExists:this.fbPageTokenExists,productName:theme.productName,pagePreview:getPagePreview(this)};this.$el.hideMessage();this.$el.html(channelCreationFormTemplate(data));this.$el.centreModal()},renderFBLoginForm:function renderFBLoginForm(){if(this.facebookLoginView){this.facebookLoginView.remove()}this.facebookLoginView=new FacebookLoginView;this.facebookLoginView.render();this.$el.html(queryCreationLoginTemplate());this.$(VIEW_SELECTORS.FB_LOGIN_VIEW).html(this.facebookLoginView.$el);this.$el.centreModal()},initPageSearch:function initPageSearch(){var searchTerm=createEncodedUrl(this.searchTerm);return this.getFacebookSdkSearchPromise(searchTerm).then(handlePageSearchSuccess.bind(null,this)).catch(handlePageSearchError.bind(null,this))},getFacebookSdkSearchPromise:function getFacebookSdkSearchPromise(searchTerm){return Q.Promise(function(resolve,reject){FB.pageSearch(searchTerm,function(error,response){if(error){return reject(error)}if(!response.is_published){var message="The selected page was private. Please choose a public Facebook page";return reject(new Error(message))}return resolve(response)})})},getFallbackFbApiSearchPromise:function getFallbackFbApiSearchPromise(searchTerm){return Q($.getJSON("/facebookpagelookup/"+searchTerm))},setModelData:function setModelData(data){this.currentSearchResult=Object.assign({},data,{imgURL:"".concat(facebookHelper.getAvatar(data.id),"?type=normal")})},navigateBack:function navigateBack(eventData){eventData.selected="publicfacebook";eventData.meta=eventData.meta||{publicfacebook:{}};eventData.meta.publicfacebook.searchTerm=this.searchTerm;eventData.queryName=this.queryName;this.trigger("navigateBack",eventData)}});mixin(FacebookPublicQueryCreationView,withPopup);return FacebookPublicQueryCreationView});define("src/extensions/facebookanalytics/models/FacebookQuery",["backbone","src/globals/currentProject"],function(Backbone,currentProject){"use strict";return Backbone.Validations.Model.extend({validate:{name:{custom:"validateName"}},validateName:function validateName(name){var value=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";if(!value.trim().length){return"Facebook Channel name is required"}},defaults:function defaults(){return{type:"publicfacebook",name:null,facebookPageId:null,facebookPageName:null,facebookPageURL:null}},constructor:function FacebookQuery(){Backbone.Validations.Model.apply(this,arguments);this.projectId=currentProject.id;if(!this.projectId){throw new Error("Facebook channel requires a projectId")}},url:function url(){return"/projects/{projectId}/facebookchannels/".concat(this.id||"")},getCoverageStatus:function getCoverageStatus(){var sla=this.get("serviceLevelAgreementName");if(!sla){return}if(!this.get("accessible")){return"error"}if(sla!=="basic"){return sla}if(this.get("owned")){return"waiting"}return"basic"},save:function save(attributes,options){options=options||{};this.facebookConsumerKey=options.facebookConsumerKey;this.facebookAccessToken=options.facebookAccessToken;return Backbone.Validations.Model.prototype.save.apply(this,arguments)}})});define("mustache!src/extensions/facebookanalytics/templates/facebookEditQuery",["lib/mustache"],function(mustache){var escapedTemplate='<div>\n<div class="draggable biggertext doublemargin-bottom">\nEdit Facebook Channel\n</div>\n<div class="js-error-notification notification-error rounded smallpadding-vertical singlepadding-horizontal doublemargin-bottom hidden"></div>\n<p class="doublemargin-bottom">\n<span class="db bold smallmargin-bottom">Page URL</span>\n<a href="{{pageURL}}" target="_blank">{{pageURL}}</a>\n</p>\n<form>{{! enables enter for default button }}\n<p class="smallmargin-top">\n<span class="bold db smallpadding-vertical">Channel Name</span>\n<input type="text" name="name" class="js-name field fivecol singlemargin-bottom" value="{{name}}">\n</p>\n<span class="bold db doublemargin-top">Channel Ownership</span>\n<div class="singlepadding-vertical">\n<label class="js-ownership b-facebookEditQuery__ownership {{#isOwned}}b-facebookEditQuery__ownership--selected{{/isOwned}} smallmargin-bottom" data-type="owned">\n<input type="radio" class="js-ownership-status" name="ownership" value="owned" {{#isOwned}}checked{{/isOwned}} /> <span class="bold smallpadding-left">Owned</span>. My organization or client owns this Facebook page.\n</label>\n<label class="js-ownership b-facebookEditQuery__ownership {{^isOwned}}b-facebookEditQuery__ownership--selected{{/isOwned}}" data-type="nonowned">\n<input type="radio" class="js-ownership-status" name="ownership" value="nonowned" {{^isOwned}}checked{{/isOwned}} /> <span class="bold smallpadding-left">Non-Owned</span>. This is a community or competitor\'s Facebook page.\n</label>\n</div>\n<p class="singlemargin-top">\n<button class="js-save defaultbutton">\nSave Channel\n</button>\n<button class="js-close button smallmargin-left">Cancel</button>\n</p>\n</form>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/extensions/facebookanalytics/css/facebookEditQuery.css",["css!src/extensions/facebookanalytics/css/compiled.css"],function(){});function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}define("src/extensions/facebookanalytics/views/FacebookEditQueryView",["jquery","underscore","backbone","src/ApiError","src/events/globalEventNames","src/events/queryEvents","src/helpers/validationTooltipHelper","src/extensions/facebookanalytics/models/FacebookQuery","mustache!src/extensions/facebookanalytics/templates/facebookEditQuery","src/mixins/mixin","src/mixins/withPopup","src/packages/waitmask","css!src/extensions/facebookanalytics/css/facebookEditQuery.css"],function($,_,Backbone,ApiError,globalEventNames,queryEvents,validationTooltipHelper,FacebookQuery,facebookEditQueryTemplate,mixin,withPopup){"use strict";var _events;var VIEW_SELECTORS={ERROR_NOTIFICATION:".js-error-notification",NAME_INPUT:".js-name",CLOSE_BUTTON:".js-close",SAVE_BUTTON:".js-save",OWNERSHIP_TOGGLE:".js-ownership",OWNERSHIP_STATUS:".js-ownership-status:checked"};function showNotification(view,message){view.$(VIEW_SELECTORS.ERROR_NOTIFICATION).text(message).removeClass("hidden")}function hideNotification(view){view.$(VIEW_SELECTORS.ERROR_NOTIFICATION).empty().addClass("hidden")}function save(view){var $nameInput=view.$(VIEW_SELECTORS.NAME_INPUT);var name=_.stripTags($nameInput.val().trim());if(!name){validationTooltipHelper.showError("Facebook Channel name is required",$nameInput);return}hideNotification(view);validationTooltipHelper.hideError($nameInput);view.$el.showWaitmask("Saving...");var owned=view.$(VIEW_SELECTORS.OWNERSHIP_STATUS).val()==="owned";var data={name:name,owned:owned};view.model.save(data,{wait:true,success:function success(){queryEvents.trigger(globalEventNames.QUERIES.QUERY_CHANGE,view.model);view.remove()},error:function error(model,response){var error=new ApiError(response);showNotification(view,error.message);view.$el.hideWaitmask()}})}function setSelection(view,type){view.$(VIEW_SELECTORS.OWNERSHIP_TOGGLE).removeClass("b-facebookEditQuery__ownership--selected").filter('[data-type="'.concat(type,'"]')).addClass("b-facebookEditQuery__ownership--selected")}var FacebookEditQueryView=Backbone.View.extend({events:(_events={},_defineProperty(_events,"click ".concat(VIEW_SELECTORS.CLOSE_BUTTON),function click(e){e.preventDefault();this.remove()}),_defineProperty(_events,"click ".concat(VIEW_SELECTORS.SAVE_BUTTON),function click(e){e.preventDefault();save(this)}),_defineProperty(_events,"click ".concat(VIEW_SELECTORS.OWNERSHIP_TOGGLE),function click(e){setSelection(this,$(e.currentTarget).data("type"))}),_events),constructor:function FacebookEditQueryView(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(!options.query){throw new Error("options.query is required")}if(options.query instanceof FacebookQuery){this.model=options.query}else{this.model=new FacebookQuery({id:options.query.id})}Backbone.View.apply(this,arguments)},render:function render(data){this.$el.html(facebookEditQueryTemplate({name:data.name,pageURL:data.facebookPageURL,isOwned:data.owned}));this.$(VIEW_SELECTORS.NAME_INPUT).focus();return this}});mixin(FacebookEditQueryView,withPopup);return FacebookEditQueryView});define("mustache!templates/renameChannelView",["lib/mustache"],function(mustache){var escapedTemplate='<div class="b-rename-channel__ui">\n<div class="b-rename-channel__title draggable biggertext doublemargin-bottom">{{formTitle}}</div>\n<div class="b-rename-channel__err errorPane hidden"></div>\n<p class="b-rename-channel__desc smallmargin-vertical doublemargin-bottom">\n<span class="b-rename-channel__label db bold smallmargin-bottom">{{pageURLLabel}}</span>\n<a href="{{pageURL}}" target="_blank">{{pageShort}}</a>\n</p>\n<form>{{! enables enter for default button }}\n<p class="smallmargin-vertical">\n<input type="text" name="name" class="b-rename-channel__name field fivecol validation-wrapper singlemargin-bottom" value="{{name}}">\n</p>\n\n<p class="creationControls singlemargin-top">\n<button default="" class="js-rename b-rename-channel__rename defaultbutton">Rename Channel</button>\n<button class="js-cancel b-rename-channel__cancel button smallmargin-left">Cancel</button>\n</p>\n</form>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!css/renameChannelView.css",["css!css/compiled.css"],function(){});define("src/components/RenameChannelBaseView",["underscore","src/events/globalEventNames","src/events/queryEvents","src/views/ValidatingFormView","mustache!templates/renameChannelView","src/mixins/mixin","src/mixins/withPopup","src/packages/modalDialogs","src/packages/waitmask","css!css/renameChannelView.css"],function(_,globalEventNames,queryEvents,ValidatingFormView,renameChannelViewTemplate,mixin,withPopup){"use strict";var QUERY_EVENTS=globalEventNames.QUERIES;var nameSel=".b-rename-channel__name";var RenameChannelBaseView=ValidatingFormView.extend({className:"b-rename-channel",events:{"click .js-rename":"onRenameClick","click .js-cancel":"onCancelClick"},constructor:function RenameChannelBaseView(options){if(!options||!options.query){throw new Error("options.query is required")}this.genericQueryModel=options.query;this.model=this.getChannelModel();this.model.on("invalid",this.onModelError,this);ValidatingFormView.apply(this,arguments)},render:function render(data){var templateData=this.getTemplateData(data);this.$el.html(renameChannelViewTemplate(templateData));this.$(nameSel).focus();return this},onRenameClick:function onRenameClick(e){e.preventDefault();this.rename()},onCancelClick:function onCancelClick(e){e.preventDefault();this.remove()},rename:function rename(){var self=this;var name=_.stripTags(this.$(nameSel).val());this.$el.showWaitmask("Saving...");this.model.save({name:name},{wait:true,success:function success(model){var modifiedAttrs={name:name,lastModificationDate:model.get("lastModificationDate")};self.genericQueryModel.set(modifiedAttrs);queryEvents.trigger(QUERY_EVENTS.QUERY_CHANGE,self.genericQueryModel);self.remove()},error:function error(model,response){self.$el.hideWaitmask();self.onServerError(model,response)}})},onModelError:function onModelError(){this.$el.hideWaitmask();ValidatingFormView.prototype.onModelError.apply(this,arguments)}});mixin(RenameChannelBaseView,withPopup);return RenameChannelBaseView});define("src/extensions/twitteranalytics/models/TwitterRenameQuery",["underscore","backbone","src/globals/currentProject"],function(_,Backbone,currentProject){"use strict";return Backbone.Model.extend({validate:function validate(attrs){if(!_.trim(attrs.name)){return{name:"Twitter Channel name is required"}}},constructor:function constructor(options){Backbone.Model.apply(this,arguments);this.projectId=options.projectId||currentProject.id;if(!this.projectId){throw new Error("no project id for channel")}},url:function url(){return"/projects/"+this.projectId+"/twitterqueries/"+(this.id||"")}})});define("src/extensions/twitteranalytics/views/TwitterRenameQueryView",["src/components/RenameChannelBaseView","src/extensions/twitteranalytics/models/TwitterRenameQuery"],function(RenameChannelBaseView,TwitterRenameQuery){"use strict";return RenameChannelBaseView.extend({constructor:function TwitterRenameQueryView(){RenameChannelBaseView.apply(this,arguments)},getChannelModel:function getChannelModel(){return new TwitterRenameQuery({id:this.genericQueryModel.id,name:this.genericQueryModel.get("name")})},getTemplateData:function getTemplateData(data){return{name:data.name,formTitle:"Rename Twitter Channel",pageURLLabel:"Twitter Profile",pageURL:"//twitter.com/"+data.twitterScreenName,pageShort:"@"+data.twitterScreenName}}})});define("src/extensions/twitteranalytics/models/TwitterQuery",["backbone"],function(Backbone){"use strict";return Backbone.Model.extend({initialize:function initialize(options){this.isConfirmed=false;this.projectId=options?options.projectId:null;this.unset("projectId")},url:function url(){if(this.isNew()){return"/projects/{projectId}/twitterqueries?confirm="+this.isConfirmed}else{return"/projects/{projectId}/twitterqueries/"+this.id}}})});define("mustache!templates/channelquerycreation/queryForm",["lib/mustache"],function(mustache){var escapedTemplate='<div class="draggable popuptitletext singlemargin-bottom">\n{{#error}}{{channel.name}} Channel Could not be Created{{/error}}\n{{#warning}}Confirm Channel Creation{{/warning}}\n{{^done}}Create {{channel.name}} Channel{{/done}}\n</div>\n{{#loggedIn}}\n{{^done}}\n<p class="smallmargin-vertical">\n<label class="db bold smallmargin-bottom">{{channel.name}} name/URL</label>\n<div class="searchTermFeedback"><a class="floatright editSearchTerm">Edit</a><div class="fourcol textellipsis"></div></div>\n</p>\n\n<div class="pagePreview doublemargin-vertical doublepadding-vertical"></div>\n\n<p class="creationControls hidden smallmargin-vertical">\n<label class="db bold smallmargin-bottom">Channel name</label>\n<input type="text" name="queryName" class="field fivecol queryName validation-wrapper" />\n</p>\n\n<div class="tokenData"></div>\n\n<p class="creationControls hidden doublemargin-top">\n<button class="back-button button"><span class="tinypadding-left icon-chevron-left"></span></button>\n<button data-at="channels-create-channel" class="createQuery smallmargin-left defaultbutton">Create Channel</button>\n<button class="hidden reAuthenticate smallmargin-left defaultbutton">Re-authenticate</button>\n<button class="cancel smallmargin-left button">Cancel</button>\n</p>\n{{/done}}\n{{#error}}\n<div class="errorMessage">\n<p>{{error}}</p>\n</div>\n<p>\n<button class="back-button buttonpadding singlemargin-top"><span class="tinypadding-left icon-chevron-left"></span> Back</button>\n</p>\n{{/error}}\n{{#warning}}\n<div class="warningMessage">\n<p>{{warning}}</p>\n</div>\n<p>\n<button class="back-button button singlemargin-top singlemargin-left"><span class="tinypadding-left icon-chevron-left"></span> Back</button>\n<button class="js-confirm defaultbutton singlemargin-top">Confirm</button>\n</p>\n{{/warning}}\n{{/loggedIn}}\n{{^loggedIn}}\n<div class="{{channelType}}LoginContainer hint-info">\n<div class="infoMessage">{{{channel.noAuthHTML}}}</div>\n<div class="singlemargin-top">\n<a class="dib social-button social-button--{{channelType}} channel-login" data-at="authenticate-channel-{{channelType}}">\n<span class="{{channel.iconClass}} smallpadding-right"></span>Authenticate with {{channel.name}}\n</a>\n</div>\n</div>\n{{/loggedIn}}\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/components/ChannelCreationBaseView",["underscore","src/globals/queries","src/views/ValidatingFormView","src/DataSourceManager","src/mixins/mixin","src/mixins/withPopup","mustache!templates/channelquerycreation/queryForm","css!css/socialButtons.css"],function(_,queries,ValidatingFormView,DataSourceManager,mixin,withPopup,queryFormTemplate){"use strict";var ChannelCreationBaseView=ValidatingFormView.extend({channelType:undefined,channelCreationTemplate:queryFormTemplate,events:{"click .search":"onSearchClick","click .channel-login":"onChannelLogin","click .createQuery":"onCreateQuery","click .cancel":"onClose","click .js-confirm":"onConfirmClick","click .editSearchTerm":"onNavigateBack","click .back-button":"onNavigateBack"},initialize:function initialize(options){this.searchTerm=options.searchTerm;this.domain=DataSourceManager.getChannels()[this.channelType].domain},getTemplateData:function getTemplateData(){return{error:this.queryCreationError,warning:this.queryCreationWarning,done:this.saveSuccess||this.queryCreationError||this.queryCreationWarning,loggedIn:this.loggedIn,channelType:this.channelType,channel:DataSourceManager.getChannels()[this.channelType]}},render:function render(){var self=this;var templateData=this.getTemplateData();if(this.loggedIn){return this.renderForm(templateData)}this.apiHelper.getLoginStatus(function(err,loggedIn){if(loggedIn){templateData.loggedIn=true;self.loggedIn=true}self.renderForm(templateData)})},apiHelper:{login:_.noop,getLoginStatus:_.noop,get:_.noop},_parseSearchTerm:function _parseSearchTerm(term){var parser;if(term.indexOf(this.domain)!==-1){parser=document.createElement("a");parser.href=term;term=_(parser.pathname.split("/")).compact();term=term[term.length-1];parser=undefined}return term},renderForm:function renderForm(templateData){var self=this;var username=this._parseSearchTerm(this.searchTerm);this.$el.html(this.channelCreationTemplate(templateData));this.$(".searchTermFeedback .textellipsis").text(this.searchTerm);this.$el.centreModal();if(!this.queryCreationError&&!this.queryCreationWarning&&this.loggedIn){this.hideError(this.$(".searchTerm"));this.initSearch(username,function doneCallback(){self.showCreationControls();self.$el.centreModal()})}},onChannelLogin:function onChannelLogin(){var self=this;return this.apiHelper.login(function(err){if(!err){self.loggedIn=true}self.render()})},initSearch:function initSearch(username,doneCallback){doneCallback()},showCreationControls:function showCreationControls(){this.$(".creationControls").removeClass("hidden")},onCreateQuery:function onCreateQuery(){var $queryNameInput=this.$(".queryName");var queryName=_.stripTags($queryNameInput.val().trim());var duplicateName;if(!queryName.length){return this.showInputValidation($queryNameInput,{queryName:"Please enter a name for your Channel"})}duplicateName=queries.find(function(query){return query.get("name")===queryName});if(duplicateName){return this.showInputValidation($queryNameInput,{queryName:'There is already a data source with the name "'+queryName+'" in this project'})}this.hideError($queryNameInput);this.$el.showMessage({text:"Saving Channel...",opacity:.8});this.saveQuery(queryName,false)},saveQuery:_.noop,onClose:function onClose(){this.trigger("cancelled");this.remove()},onConfirmClick:function onConfirmClick(){var queryName=this.model.get("name");this.saveQuery(queryName,true)},onNavigateBack:function onNavigateBack(eventData){var channelType=this.channelType;var meta={};meta[channelType]={};eventData.selected=channelType;meta[channelType]={};eventData.meta=eventData.meta||meta;eventData.meta[channelType].searchTerm=this.searchTerm;this.trigger("navigateBack",eventData)}});mixin(ChannelCreationBaseView,withPopup);return ChannelCreationBaseView});define("mustache!src/extensions/twitteranalytics/templates/twitterQueryPreview",["lib/mustache"],function(mustache){var escapedTemplate='{{#name}}\n<p>\n<span class="twocol dib bold textright singlepadding-right">Account Name</span>\n<span class="accountName textellipsis twocol dib">{{name}}</span>\n</p>\n{{/name}}\n{{#followers}}\n<p class="smallmargin-top">\n<span class="twocol dib bold textright singlepadding-right">Followers</span>\n<span class="accountFollowers textellipsis twocol dib">{{followers}}</span>\n</p>\n{{/followers}}\n{{#location}}\n<p class="smallmargin-top">\n<span class="twocol about dib bold textright singlepadding-right">Location</span>\n<span class="accountLocation twocol dib">{{location}}</span>\n</p>\n{{/location}}\n{{#bio}}\n<p class="smallmargin-top">\n<span class="twocol about dib bold textright singlepadding-right">Description</span>\n<span class="accountBio shadowscroll dib">{{bio}}</span>\n</p>\n{{/bio}}\n{{#squareImgURL}}\n<img src="{{squareImgURL}}" class="smallmargin-left smallmargin-bottom rounded" />\n{{/squareImgURL}}\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/extensions/twitteranalytics/css/twitterQueryForm.css",["css!src/extensions/twitteranalytics/css/compiled.css"],function(){});define("src/extensions/twitteranalytics/views/TwitterQueryCreationView",["src/globals/theme","src/globals/queries","src/analytics/Analytics","src/extensions/twitteranalytics/models/TwitterQuery","src/ApiError","src/helpers/twitterApiHelper","src/helpers/errorHelper","src/components/ChannelCreationBaseView","mustache!src/extensions/twitteranalytics/templates/twitterQueryPreview","css!src/extensions/twitteranalytics/css/twitterQueryForm.css","css!css/socialButtons.css"],function(theme,queries,Analytics,TwitterQuery,ApiError,twitterApiHelper,errorHelper,ChannelCreationBaseView,previewTemplate){"use strict";var ACTION_CONFIRM_VOLUME_CODE="501";var CHANNEL_FOLLOWER_LIMIT=5e6;var CHANNEL_TYPE="twitter";var TwitterQueryCreationView=ChannelCreationBaseView.extend({className:"twitterQueryCreation sixcol",modelClass:TwitterQuery,apiHelper:twitterApiHelper,channelType:CHANNEL_TYPE,initSearch:function initSearch(username,doneCallback){var self=this;this.$el.showMessage({text:"Waiting for data..."});twitterApiHelper.get("users/show.json",{screen_name:username},function(err,data){var contactEmail;self.$el.hideMessage();if(err){return self.onNavigateBack({meta:{twitter:{errors:{searchTerm:errorHelper.getErrorMessage(err)}}}})}if(data.followers_count>CHANNEL_FOLLOWER_LIMIT){Analytics.trackEvent({name:"Miscellaneous.TwitterQueryCreationPopup",action:"Searched_Account_With_"+data.followers_count+"_Followers",origin:"Application"});contactEmail=theme.contactEmail;self.queryCreationError="Profile has too many followers. please contact "+contactEmail+" or talk to your account contact for more information.";self.render();return}self.updatePreview(data);doneCallback()})},updatePreview:function updatePreview(data){var templateData={name:data.screen_name,followers:data.followers_count,location:data.location,bio:data.description,squareImgURL:data.profile_image_url};this.model.set({twitterUserId:data.id_str,twitterScreenName:data.screen_name});this.$(".pagePreview").html(previewTemplate(templateData));this.$(".queryName").val(data.screen_name)},saveQuery:function saveQuery(queryName,confirmed){var self=this;this.model.isConfirmed=confirmed===true;this.model.save({name:queryName},{success:function success(){self.$el.hideMessage();self.saveSuccess=true;self.queryCreationWarning=self.queryCreationError=null;self.trigger("queryCreated",self.model);queries.add(self.model);self.remove()},error:function error(model,response){var apiError=new ApiError(response),errorString=apiError.message;if(apiError.hasCode(ACTION_CONFIRM_VOLUME_CODE)){self.queryCreationWarning="The Channel you are creating may generate a high volume of mentions. Continue?"}else{self.queryCreationWarning=null;self.queryCreationError=errorString}self.$el.hideMessage();self.render()}})}});return TwitterQueryCreationView});define("src/instagramchannel/models/InstagramQuery",["backbone"],function(Backbone){"use strict";var ENDPOINT_URL="/projects/{projectId}/instagramqueries";return Backbone.Model.extend({constructor:function InstagramQuery(attributes,options){options=options||{};Backbone.Model.prototype.constructor.apply(this,arguments);this.isConfirmed=options.isConfirmed||false;this.projectId=attributes?attributes.projectId:null;this.unset("projectId")},url:function url(){if(this.isNew()){return ENDPOINT_URL+"?confirm="+this.isConfirmed+"&instagramAccessToken="+this.instagramAccessToken}if(this.instagramAccessToken){return ENDPOINT_URL+"/"+this.id+"?instagramAccessToken="+this.instagramAccessToken}return ENDPOINT_URL+"/"+this.id},save:function save(attributes,options){options=options||{};this.instagramAccessToken=options.instagramAccessToken;return Backbone.Model.prototype.save.apply(this,arguments)}})});define("mustache!src/instagramchannel/templates/instagramQueryPreview",["lib/mustache"],function(mustache){var escapedTemplate='<p class="smallmargin-bottom">\n<span class="twocol dib bold textright singlepadding-right">Account Name</span>\n<span class="accountName textellipsis threecol dib">{{username}}</span>\n</p>\n<p class="smallmargin-vertical">\n<span class="twocol dib bold textright singlepadding-right">Posts</span>\n<span class="posts textellipsis threecol dib">{{posts}}</span>\n</p>\n<p class="smallmargin-vertical">\n<span class="twocol dib bold textright singlepadding-right">Followers</span>\n<span class="followedBy textellipsis threecol dib">{{followed_by}}</span>\n</p>\n<p class="smallmargin-vertical">\n<span class="twocol dib bold textright singlepadding-right">Following</span>\n<span class="follows textellipsis threecol dib">{{follows}}</span>\n</p>\n{{#description}}\n<p class="smallmargin-vertical">\n<span class="pagePreview--description-label twocol dib bold textright singlepadding-right">Description</span>\n<span class="pagePreview--description-value shadowscroll dib">{{description}}</span>\n</p>\n{{/description}}\n<img src="{{squareImgURL}}" class="smallmargin-left smallmargin-bottom rounded" />\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/instagramchannel/templates/instagramTokenStatus",["lib/mustache"],function(mustache){var escapedTemplate='{{#tokenIsHot}}\n<div class="b-notification-msg b-notification-msg--type_error singlepadding singlemargin-vertical mediumline">\n<strong>@{{tokenUsername}}</strong>s authentication has reached the allowed limit of channels.\nPlease log out and re-authenticate with an alternative Instagram account.\n</div>\n{{/tokenIsHot}}\n{{#tokenIsWarm}}\n<div class="b-notification-msg b-notification-msg--type_warning singlepadding singlemargin-vertical mediumline">\n<strong>@{{tokenUsername}}</strong>s authentication has almost reached the allowed limit of channels.\nPlease log out and re-authenticate with an alternative Instagram account.\n</div>\n{{/tokenIsWarm}}\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/instagramchannel/css/instagramQueryForm.css",["css!src/instagramchannel/css/compiled.css"],function(){});define("src/instagramchannel/views/InstagramQueryCreationView",["underscore","src/globals/queries","src/instagramchannel/models/InstagramQuery","src/ApiError","src/helpers/instagramApiHelper","src/helpers/errorHelper","src/components/ChannelCreationBaseView","mustache!src/instagramchannel/templates/instagramQueryPreview","mustache!src/instagramchannel/templates/instagramTokenStatus","css!src/instagramchannel/css/instagramQueryForm.css","css!css/socialButtons.css"],function(_,queries,InstagramQuery,ApiError,instagramApiHelperFactory,errorHelper,ChannelCreationBaseView,previewTemplate,tokenStatusTemplate){"use strict";var InstagramQueryCreationView;var CHANNEL_TYPE="instagram";InstagramQueryCreationView=ChannelCreationBaseView.extend({className:"instagramQueryCreation sixcol",modelClass:InstagramQuery,apiHelper:instagramApiHelperFactory.getChannelsHelper(),channelType:CHANNEL_TYPE,needsReAuth:true,events:_.extend({"click .reAuthenticate":"onReAuthenticate"},ChannelCreationBaseView.prototype.events),onReAuthenticate:function onReAuthenticate(){this.trigger("retryWithAnotherLogin",{searchTerm:this.searchTerm})},initSearch:function initSearch(username,doneCallback){var self=this;this.$el.showMessage({text:"Waiting for data..."});return this.apiHelper.getSelf().then(function(tokenOwnerInfo){self.updatePreview(tokenOwnerInfo);doneCallback&&doneCallback();self.$el.hideMessage()}).catch(function(err){self.onNavigateBack({meta:{instagram:{errors:{searchTerm:errorHelper.getErrorMessage(err)}}}});self.$el.hideMessage()})},updatePreview:function updatePreview(data){var previewData={username:data.username,followed_by:data.counts.followed_by,follows:data.counts.follows,description:data.bio,posts:data.counts.media,squareImgURL:data.profile_picture};var tokenData={tokenUsername:data.username};this.model.set({instagramUserId:data.id.toString(),instagramScreenName:data.username});this.$(".pagePreview").html(previewTemplate(previewData));this.$(".tokenData").html(tokenStatusTemplate(tokenData));this.$(".queryName").val(data.username)},saveQuery:function saveQuery(queryName,confirmed){var self=this;var successHandler=function successHandler(){self.$el.hideMessage();self.saveSuccess=true;self.queryCreationWarning=self.queryCreationError=null;self.trigger("queryCreated",self.model);queries.add(self.model);self.remove()};var errorHandler=function errorHandler(response){var apiError=new ApiError(response);var errorString=apiError.message;self.queryCreationWarning=null;self.queryCreationError=errorString;self.$el.hideMessage();self.render()};this.model.isConfirmed=confirmed===true;return this.apiHelper.getAccessToken().then(function(data){return self.model.save({name:queryName},{instagramAccessToken:data.accessToken}).then(successHandler,errorHandler)}).fail(errorHandler)},onChannelLogin:function onChannelLogin(){var _this=this;return this.apiHelper.reauth(function(){_this.needsReAuth=false;_this.loggedIn=true;_this.render()})},render:function render(){var _this2=this;var templateData=this.getTemplateData();this.apiHelper.getLoginStatus().then(function(res){if(res.isLoggedIn&&!_this2.needsReAuth&&!res.revoked){templateData.loggedIn=true;_this2.loggedIn=true}else{templateData.loggedIn=false;_this2.loggedIn=false;_this2.needsReAuth=false}}).then(function(){return _this2.renderForm(templateData)}).catch(function(res){if(res.hasOwnProperty("status")&&res.status===401){templateData.loggedIn=false;_this2.loggedIn=false;_this2.needsReAuth=false}return _this2.renderForm(templateData)})}});return InstagramQueryCreationView});define("src/instagramchannel/models/InstagramRenameQuery",["underscore","backbone","src/globals/currentProject"],function(_,Backbone,currentProject){"use strict";return Backbone.Model.extend({validate:function validate(attrs){if(!_.trim(attrs.name)){return{name:"Instagram Channel name is required"}}},constructor:function InstagramRenameQueryView(options){Backbone.Model.apply(this,arguments);this.projectId=options.projectId||currentProject.id;if(!this.projectId){throw new Error("no project id for channel")}},url:function url(){return"/projects/"+this.projectId+"/instagramqueries/"+(this.id||"")}})});define("src/instagramchannel/views/InstagramRenameQueryView",["src/components/RenameChannelBaseView","src/instagramchannel/models/InstagramRenameQuery"],function(RenameChannelBaseView,InstagramRenameQuery){"use strict";return RenameChannelBaseView.extend({constructor:function InstagramRenameQueryView(){RenameChannelBaseView.apply(this,arguments)},getChannelModel:function getChannelModel(){return new InstagramRenameQuery({id:this.genericQueryModel.id,name:this.genericQueryModel.get("name")})},getTemplateData:function getTemplateData(data){return{name:data.name,formTitle:"Rename Instagram Channel",pageURLLabel:"Page URL",pageURL:"//instagram.com/"+data.instagramScreenName,pageShort:"@"+data.instagramScreenName}}})});define("src/helpers/clientHelper",[],function(){"use strict";function hasValidQueryLimit(queryLimit){var limit=parseInt(queryLimit,10);if(isNaN(limit)){return false}if(limit<=0||limit>=9999){return false}return true}return{hasValidQueryLimit:hasValidQueryLimit}});define("src/models/ProjectUsageSummary",["backbone","src/helpers/clientHelper"],function(Backbone,clientHelper){"use strict";return Backbone.Model.extend({initialize:function initialize(attrs,options){options=options||{};if(!options.projectId){throw new Error("A projectId must be supplied")}this.projectId=options.projectId},url:function url(){return"/projects/"+this.projectId+"/usagesummary"},getQueryData:function getQueryData(){return{projectId:this.projectId}},isMentionBasedClient:function isMentionBasedClient(){var queryLimit=this.get("queryLimit"),isLegacy=this.get("legacy"),pricingType=this.get("pricingModel");if(isLegacy&&pricingType==="MB"){return true}if(isLegacy&&pricingType==="QB"){return false}return!clientHelper.hasValidQueryLimit(queryLimit)}})});define("src/QueryCreationRules",["src/models/ProjectUsageSummary","bw-fe-helpers/dateHelper","bw-fe-helpers/numberHelper"],function(ProjectUsageSummary,dateHelper,numberHelper){"use strict";var pricingTypeLookup={MB:"mentionBased",QB:"queryBased"},OK_RESULT={isAllowed:true},TOO_MANY_DAILY_MENTIONS_ERROR_LIMIT=1e6;function estimateMentionsTotalThisMonth(estimatePerDay){return estimatePerDay*dateHelper.remainingDaysThisMonth()}function StandardQueryCreationRules(projectUsageSummary){var isInstanceOf=projectUsageSummary instanceof ProjectUsageSummary;if(!projectUsageSummary||!isInstanceOf){throw new Error("StandardQueryCreationRules must be instantiated with a project usage summary model")}var pricingType=pricingTypeLookup[projectUsageSummary.get("pricingModel")];this.projectUsageSummary=projectUsageSummary;this.pricingType=pricingType;this.monthlyLimit=projectUsageSummary.get("mentionLimit");this.mentionsThisMonth=projectUsageSummary.get("mentionsThisMonth")}StandardQueryCreationRules.prototype.atQueryLimit=function(){return this.projectUsageSummary.get("atQueryLimit")};StandardQueryCreationRules.prototype.atMentionLimit=function(){return this.projectUsageSummary.get("atMentionLimit")};StandardQueryCreationRules.prototype.overMonthlyMentionsLimit=function(){return false};StandardQueryCreationRules.prototype.likelyToBreachMonthlyMentionsLimit=function(estDailyResults,mentionsThisMonth,monthlyLimit){return mentionsThisMonth+estimateMentionsTotalThisMonth(estDailyResults)>monthlyLimit};StandardQueryCreationRules.prototype.checkCanCreateNewQuery=function(){if(this.atQueryLimit()){return{isAllowed:false,reason:"atQueryLimit",data:{}}}return this.checkCanEditQuery({})};StandardQueryCreationRules.prototype.userHasPermissionToEdit=function(){return true};StandardQueryCreationRules.prototype.checkCanEditQuery=function(options){var query=options?options.query:null;if(query){if(!this.userHasPermissionToEdit(options)){return{isAllowed:false,reason:"userDoesNotHavePermission",data:{}}}}if(this.atMentionLimit()){return{isAllowed:false,reason:"atMentionLimit",data:{}}}return OK_RESULT};StandardQueryCreationRules.prototype.checkCanCreateNewQueryWithTheseSearchResults=function(testSearchMetaData){if(this.overMonthlyMentionsLimit()){return{isAllowed:false,reason:"overMonthlyMentionsLimit",data:{}}}if(testSearchMetaData.estimatedMonthlyResults+this.mentionsThisMonth>this.monthlyLimit){return{isAllowed:true,reason:"likelyToBreachMonthlyMentionsLimit",data:{estimatedMonthlyResults:numberHelper.formatSpaceDelimitedNumber(testSearchMetaData.estimatedMonthlyResults),monthlyLimit:numberHelper.formatSpaceDelimitedNumber(this.monthlyLimit)}}}return OK_RESULT};StandardQueryCreationRules.prototype.isOverDailyMentionLimit=function(estimatedDailyResult){return estimatedDailyResult>TOO_MANY_DAILY_MENTIONS_ERROR_LIMIT};function LegacyQueryCreationRules(projectUsageSummary){StandardQueryCreationRules.call(this,projectUsageSummary);if(this.pricingType==="mentionBased"){this.monthlyLimit=projectUsageSummary.get("mentionLimit");this.mentionsThisMonth=projectUsageSummary.get("mentionsThisMonth");return}if(this.pricingType==="queryBased"){this.monthlyLimit=undefined;this.mentionsThisMonth=undefined;this.dailyAllowance=projectUsageSummary.get("dailyLimit")}}LegacyQueryCreationRules.prototype=Object.create(StandardQueryCreationRules.prototype);LegacyQueryCreationRules.prototype.overMonthlyMentionsLimit=function(){var message="QueryCreationRules.overMonthlyMentionsLimit() "+"is not applicable for clients with pricingType not set to mentionBased";if(this.pricingType!=="mentionBased"){throw new Error(message)}return this.mentionsThisMonth>this.monthlyLimit};LegacyQueryCreationRules.prototype.checkCanEditQuery=function(options){var query=options?options.query:null;if(query){if(!this.userHasPermissionToEdit(options)){return{isAllowed:false,reason:"userDoesNotHavePermission",data:{}}}}if(this.pricingType==="mentionBased"&&this.overMonthlyMentionsLimit()){return{isAllowed:false,reason:"overMonthlyMentionsLimit",data:{}}}return OK_RESULT};LegacyQueryCreationRules.prototype.checkCanCreateNewQueryWithTheseSearchResults=function(testSearchMetaData){if(this.pricingType==="mentionBased"){if(this.overMonthlyMentionsLimit()){return{isAllowed:false,reason:"overMonthlyMentionsLimit",data:{}}}if(this.likelyToBreachMonthlyMentionsLimit(testSearchMetaData.estimatedDailyResults,this.mentionsThisMonth,this.monthlyLimit)){return{isAllowed:true,reason:"likelyToBreachMonthlyMentionsLimit",data:{estimatedMonthlyResults:numberHelper.formatSpaceDelimitedNumber(testSearchMetaData.estimatedMonthlyResults),monthlyLimit:numberHelper.formatSpaceDelimitedNumber(this.monthlyLimit)}}}return OK_RESULT}if(testSearchMetaData.estimatedDailyResults>this.dailyAllowance){return{isAllowed:true,reason:"fairUsage",data:{estimatedDailyResults:numberHelper.formatSpaceDelimitedNumber(testSearchMetaData.estimatedDailyResults),dailyAllowance:numberHelper.formatSpaceDelimitedNumber(this.dailyAllowance)}}}return OK_RESULT};var QueryCreationRules={create:function create(projectUsageSummary){var createInstance=function createInstance(projectUsageSummaryModel){var isLegacy=!!projectUsageSummaryModel.get("legacy"),Super=isLegacy?LegacyQueryCreationRules:StandardQueryCreationRules,o=Object.create(Super.prototype);Super.call(o,projectUsageSummaryModel);return o};return createInstance(projectUsageSummary)}};return QueryCreationRules});define("src/QueryFormManager",["underscore","jquery","src/globals/me","src/events/globalEventNames","src/events/queryEvents","src/helpers/instagramApiHelper","src/views/QueryTypeSelectionView","src/querybuilder/views/QueryBuilderView","src/querywizard/events/QueryWizardEventNames","src/querywizard/events/QueryCreatorSelectionEventNames","src/querywizard/models/WizardQuery","src/querywizard/controllers/QueryCreatorSelectionController","src/querywizard/controllers/QueryWizardController","src/views/QueryCreationWarningView","src/views/ChannelSelectionView","src/extensions/facebookanalytics/views/FacebookPublicQueryCreationView","src/extensions/facebookanalytics/views/FacebookEditQueryView","src/extensions/twitteranalytics/views/TwitterRenameQueryView","src/extensions/twitteranalytics/views/TwitterQueryCreationView","src/extensions/twitteranalytics/models/TwitterQuery","src/instagramchannel/views/InstagramQueryCreationView","src/instagramchannel/views/InstagramRenameQueryView","src/instagramchannel/models/InstagramQuery","src/models/Query","src/extensions/facebookanalytics/models/FacebookQuery","src/models/ProjectUsageSummary","src/QueryCreationRules","q","src/ApiError","src/packages/waitmask","src/packages/modalDialogs","lib/jquery.notify"],function(_,$,me,globalEventNames,queryEvents,instagramApiHelperFactory,QueryTypeSelectionView,QueryBuilderView,QueryWizardEventNames,QueryCreatorSelectionEventNames,WizardQuery,QueryCreatorSelectionController,QueryWizardController,QueryCreationWarningView,ChannelSelectionView,FacebookPublicQueryCreationView,FacebookEditQueryView,TwitterRenameQueryView,TwitterQueryCreationView,TwitterQuery,InstagramQueryCreationView,InstagramRenameQueryView,InstagramQuery,Query,FacebookQuery,ProjectUsageSummary,QueryCreationRules,Q,ApiError){"use strict";var QUERY_EVENTS=globalEventNames.QUERIES;var WEB_QUERY_TYPE="text";var CHANNEL_QUERY_TYPE="channel";function showWaitMask(){$("#inner-wrapper").showWaitmask("Preparing...")}function hideWaitMask(){$("#inner-wrapper").hideWaitmask()}function closeQueryCreatorSelection(QueryFormManager){if(!QueryFormManager.queryCreatorSelectionController){return}QueryFormManager.queryCreatorSelectionController.remove();delete QueryFormManager.queryCreatorSelectionController}return{channelMap:{publicfacebook:{View:FacebookPublicQueryCreationView,EditView:FacebookEditQueryView,Query:FacebookQuery},twitter:{View:TwitterQueryCreationView,EditView:TwitterRenameQueryView,Query:TwitterQuery},instagram:{View:InstagramQueryCreationView,EditView:InstagramRenameQueryView,Query:InstagramQuery}},_getProjectUsageSummary:function _getProjectUsageSummary(projectId){var self=this,projectUsageSummary=new ProjectUsageSummary({},{projectId:projectId});return new Q.Promise(function(resolve,reject){projectUsageSummary.fetch().then(resolve.bind(null,projectUsageSummary),reject.bind(null,self))})},showCreateQueryForm:function showCreateQueryForm(options){var client=me.get("client")||{},showQueryTypeSelection=this.showQueryTypeSelection.bind(this),self=this;this.project=options.project;this.allowedQueryTypes=options.allowedQueryTypes;if(!options||!options.project){throw new Error("options.project must be set")}if(!client.railsEnabled){return showQueryTypeSelection({allowedQueryTypes:this.allowedQueryTypes,defaultQueryType:options.defaultQueryType})}showWaitMask();this._getProjectUsageSummary(options.project.id).then(function(projectUsageSummary){hideWaitMask();showQueryTypeSelection({dailyAllowance:projectUsageSummary.get("dailyLimit"),allowedQueryTypes:self.allowedQueryTypes,defaultQueryType:options.defaultQueryType})},function(){hideWaitMask();$.notify({text:"Error retrieving project usage summary information, please contact your administrator",className:"error"})})},showQueryTypeSelection:function showQueryTypeSelection(options){var canSkipQueryTypeChoice=options.dailyAllowance===undefined&&this.allowedQueryTypes;if(canSkipQueryTypeChoice){if(_.indexOf(this.allowedQueryTypes,WEB_QUERY_TYPE)===-1){return this.initQueryCreation(CHANNEL_QUERY_TYPE)}if(this.allowedQueryTypes.length===1){return this.initQueryCreation(WEB_QUERY_TYPE)}}this.querySelectionView=QueryTypeSelectionView.show(_.extend({onClose:this.removeQuerySelectionView.bind(this)},options)).on("confirmed",this.confirmQueryTypeSelection.bind(this))},confirmQueryTypeSelection:function confirmQueryTypeSelection(queryType){this.querySelectionView.close();this.initQueryCreation(queryType)},showChannelTypeSelection:function showChannelTypeSelection(options){var opts=_.extend({types:this.allowedQueryTypes},options||{});this.channelSelectionView=new ChannelSelectionView(opts);this.channelSelectionView.on("queryTypeChosen",this.showCreateChannelForm.bind(this)).on("channelCreationCancelled",this.removeCreateChannelForm.bind(this)).render();this.channelSelectionView.showAsPopup({className:"popup",width:"auto"});return this.channelSelectionView},showCreateChannelForm:function showCreateChannelForm(data){var self=this;var project=this.project||data.project;var searchTerm=data.searchTerm;var queryName=data.queryName;if(!project){throw new Error("project must be set")}showWaitMask();this._getProjectUsageSummary(project.id).then(function(projectUsageSummary){var queryCreationRules=QueryCreationRules.create(projectUsageSummary);var result=queryCreationRules.checkCanCreateNewQuery();hideWaitMask();if(result.reason){return self.showWarning({cssClass:"warning",result:result})}self.instantiateQueryCreationView(data.queryType,searchTerm,queryName)})},instantiateQueryCreationView:function instantiateQueryCreationView(queryType,searchTerm,queryName){var viewInstance;var channel=this.channelMap[queryType];viewInstance=new channel.View({model:new channel.Query,searchTerm:searchTerm,queryName:queryName});viewInstance.on("queryCreated",function(model){queryEvents.trigger(QUERY_EVENTS.QUERY_CREATE,model)}).on("closed",this.removeQueryForm.bind(this,queryType)).on("navigateBack",this.backToChannelTypeSelection.bind(this)).on("retryWithAnotherLogin",this.retryWithAnotherLogin.bind(this)).render();viewInstance.showAsPopup({className:"popup pagepadding",onClose:function onClose(){viewInstance.trigger("closed")}});this.setQueryCreationView(queryType,viewInstance)},retryWithAnotherLogin:function retryWithAnotherLogin(data){var self=this;(this.allowedQueryTypes||Object.keys(this.channelMap)).forEach(this.removeQueryForm,this);instagramApiHelperFactory.getChannelsHelper().reauth(function(){self.showCreateChannelForm({searchTerm:data.searchTerm,queryType:"instagram"})})},initQueryCreation:function initQueryCreation(queryType){var project=this.project;if(queryType===CHANNEL_QUERY_TYPE){return this.showChannelTypeSelection()}this.createWebQueryForm({project:project,query:new Query({projectId:project.id})})},createWebQueryForm:function createWebQueryForm(options){var self=this;showWaitMask();this._getProjectUsageSummary(options.project.id).then(function(projectUsageSummary){var queryCreationRules=QueryCreationRules.create(projectUsageSummary),result=queryCreationRules.checkCanCreateNewQuery();hideWaitMask();return self._processResultWarning(result)||self._showWebQueryForm(_.extend(options,{queryCreationRules:queryCreationRules}),function(model){queryEvents.trigger(QUERY_EVENTS.QUERY_CREATE,model)})})},editWebQueryForm:function editWebQueryForm(options){var self=this;var projectId=options.project.id;this._getProjectUsageSummary(projectId).then(function(projectUsageSummary){var queryCreationRules=QueryCreationRules.create(projectUsageSummary),result=queryCreationRules.checkCanEditQuery(options.query);hideWaitMask();return self._processResultWarning(result)||self._showWebQueryForm(_.extend(options,{queryCreationRules:queryCreationRules}),function(model){queryEvents.trigger(QUERY_EVENTS.QUERY_CHANGE,model)})})},editChannelForm:function editChannelForm(query){var type=query.get("type");var editView=new this.channelMap[type].EditView({query:query});showWaitMask();editView.model.fetch({success:function success(){hideWaitMask();editView.render(editView.model.toJSON()).showAsPopup({className:"smallpopup"})},error:function error(model,response){hideWaitMask();var error=new ApiError(response);$.notify({text:error.message||"Error renaming query",className:"notification-error"})}})},_processResultWarning:function _processResultWarning(result){if(result.reason){this.showWarning({cssClass:"warning",result:result});return result}},_withQueryCreatorSelection:function _withQueryCreatorSelection(options,callback){var model=options.query;if(model.get("type")!=="text"){return callback(QueryBuilderView)}if(options.useWizard){return callback(QueryWizardController)}if(model.isNew()){var closeSelection=closeQueryCreatorSelection.bind(null,this);this.queryCreatorSelectionController=QueryCreatorSelectionController.show({onClose:closeSelection}).on(QueryCreatorSelectionEventNames.CONFIRM,function(value){closeSelection();if(value==="queryBuilder"){return callback(QueryBuilderView)}else{return callback(QueryWizardController)}}).on(QueryCreatorSelectionEventNames.CANCEL,closeSelection);return}if(model.get("createdByWizard")){return callback(QueryWizardController)}return callback(QueryBuilderView)},_getDoShowWebQueryForm:function _getDoShowWebQueryForm(options,done){return function(WebQueryViewClass){var self=this;this.queryForm=WebQueryViewClass.show({model:options.query,queryCreationRules:options.queryCreationRules,project:options.project}).on(QueryWizardEventNames.OPEN_QUERY_EDITOR,function(model){self.removeWebQueryForm();options.query=model;if(!model.isNew()){self.showEditQueryForm(options);return}self.createWebQueryForm(options)}).on("confirmed",function(model){if(done){done(model)}self.removeWebQueryForm()}).on("closed",self.removeWebQueryForm.bind(self))}},_showWebQueryForm:function _showWebQueryForm(options,done){if(!options||!options.project){throw new Error("options.project must be set")}if(!options.query){throw new Error("options.query must be set")}this._withQueryCreatorSelection(options,this._getDoShowWebQueryForm(options,done).bind(this))},getQueryCreationView:function getQueryCreationView(queryType){return this[queryType+"ViewInstance"]},setQueryCreationView:function setQueryCreationView(queryType,instance){this[queryType+"ViewInstance"]=instance},backToChannelTypeSelection:function backToChannelTypeSelection(data){(this.allowedQueryTypes||Object.keys(this.channelMap)).forEach(this.removeQueryForm,this);this.showChannelTypeSelection(data)},showEditQueryForm:function showEditQueryForm(options){var self=this;var query=options.query;var type;if(!options.query){throw new Error("options.query must be set")}if(query.get("createdByWizard")){query=new WizardQuery(query.toJSON())}this.withinDashboard=options.withinDashboard||false;this.removeForms();type=query.get("type");if(this.channelMap[type]&&this.channelMap[type].EditView){return self.editChannelForm(query)}showWaitMask();query.fetch({success:function success(){if(options.revertQuery){var isCurrentQueryCreatedByWizard=query.get("createdByWizard");query.set(options.revertQuery,{silent:true});if(options.revertQuery.createdByWizard){query=new WizardQuery(query.toJSON())}else if(isCurrentQueryCreatedByWizard){var wizardModel=new WizardQuery(query.toJSON());query=wizardModel.toQueryModel()}}self.editWebQueryForm({project:options.project,query:query})},error:function error(){hideWaitMask()}})},removeQueryForm:function removeQueryForm(queryType){var view=this.getQueryCreationView(queryType);this.setQueryCreationView(queryType,null);if(view){view.off();view.remove()}},removeWebQueryForm:function removeWebQueryForm(){var queryForm=this.queryForm;delete this.queryForm;if(queryForm){queryForm.off();queryForm.remove()}},removeQuerySelectionView:function removeQuerySelectionView(){var querySelectionView=this.querySelectionView;delete this.querySelectionView;if(querySelectionView){querySelectionView.off();querySelectionView.remove()}},removeCreateChannelForm:function removeCreateChannelForm(){var channelSelectionView=this.channelSelectionView;delete this.channelSelectionView;if(channelSelectionView){channelSelectionView.off();channelSelectionView.remove()}},removeForms:function removeForms(){(this.allowedQueryTypes||[]).forEach(function(queryType){this.removeQueryForm(queryType)},this);this.removeWebQueryForm();this.removeCreateChannelForm();this.removeQuerySelectionView()},showWarning:function showWarning(warningOptions){var self=this,warningView=this.warningView=new QueryCreationWarningView({reason:warningOptions.result.reason,reasonData:warningOptions.result.data});warningView.render();warningView.$el.showModal({className:"popup smallpopup",onClose:function onClose(){if(warningView){warningView.remove();delete self.warningView}self.removeForms()}});warningView.bind("closed",function(){warningView.$el.removeModal()})}}});define("src/controls/lib/viewHelpers",["src/globals/flags","src/globals/flagNames"],function(flags,FLAGS){"use strict";var getIconClassGivenType=function getIconClassGivenType(type){var decahoseIcon=flags.variation(FLAGS.ENABLE_RESEARCH_QUERIES)?"icon-bwquery-research":"icon-bwquery-twitter";switch(type){case"twitter":return"icon-bwtwitter";case"instagram":return"icon-bwinstagram";case"publicfacebook":return"icon-facebook-sign";case"text":case"ditto":return"icon-bwquery";case"logo":return"icon-bwquery-logo";case"decahose":return decahoseIcon;case"monitor":return"icon-bwsearch";default:return false}};return{getIconClassGivenType:getIconClassGivenType}});define("src/models/QueryGroup",["underscore","src/models/Group"],function(_,Group){"use strict";return Group.extend({defaults:function defaults(){return{name:"",queries:[]}},validate:{name:{required:true,custom:"validateName"},queries:{required:true,custom:"atLeastOneQuery"}},validateName:function validateName(attrName,attrValue){if(_.isUndefined(attrValue)){return"noname"}return attrValue.length>60?"maxlength":undefined},atLeastOneQuery:function atLeastOneQuery(attrName,attrValue){return _.isUndefined(attrValue)||attrValue.length===0?"nothingchosen":undefined},url:function url(){var projectId=this.get("projectId")||_(this.get("sharedProjectIds")).clone().pop();return"/projects/"+projectId+"/querygroups/"+(this.id||"")}})});function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(iter){if(Symbol.iterator in Object(iter)||Object.prototype.toString.call(iter)==="[object Arguments]")return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}}define("src/models/QueryGroupCollection",["src/models/GroupCollection","src/models/QueryGroup"],function(GroupCollection,QueryGroup){"use strict";return GroupCollection.extend({model:QueryGroup,url:function url(){var projectId=this.projectId;if(!projectId){throw new Error("Cannot fetch Groups without a projectId")}return"/projects/"+projectId+"/querygroups"},parse:function parse(response){return response.results},getQueryIdsFromGroupIds:function getQueryIdsFromGroupIds(){var _this=this;var queryGroupIds=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];return[].concat(queryGroupIds).map(function(queryGroupId){var queryGroup=_this.get(queryGroupId);return queryGroup&&queryGroup.get("queries").map(function(query){return query.id})}).reduce(function(memo){var values=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[undefined];return memo.concat.apply(memo,_toConsumableArray(values))},[])}})});define("src/globals/queryGroups",["src/globals/currentProject","src/models/QueryGroupCollection"],function(currentProject,QueryGroupCollection){"use strict";var queryGroups=new QueryGroupCollection;currentProject.onLoad(function(callback){queryGroups.projectId=currentProject.id;if(!currentProject.id){queryGroups.reset([],{silent:false});return}queryGroups.reset([],{silent:true});queryGroups.fetch({success:function success(){callback()},error:function error(model,err){callback(err)}})});return queryGroups});define("mustache!templates/queryGroupFormView",["lib/mustache"],function(mustache){var escapedTemplate='<header>\n<h1 class="popuptitletext singlemargin-bottom draggable" data-at="create-query-group-dialog-title"><span class="sevencol textellipsis db">{{title}}</span></h1>\n</header>\n<div class="content">\n<form>\n<div class="errorPane notification-error rounded smallpadding-vertical singlepadding-horizontal singlemargin-bottom hidden"></div>\n<fieldset class="singlemargin-bottom">\n<label for="groupName" class="smallmargin-bottom">\nGroup name\n</label>\n<input class="validation-wrapper field fourcol" id="groupName" data-at="query-group-dialog-query-group-name" autocomplete="off" name="groupName" type="text" size="32" maxlength="32" placeholder="E.g. Key Markets" value="{{name}}" data-validationmessage-required="Please give the Group a name" data-validationmessage-maxlength="Sorry, names can\'t be more than 32 letters">\n</fieldset>\n<nav class="singlemargin-top">\n<div class="groupTabs horizontal-navigation">\n<a class="showEditTab active singlepadding-horizontal horizontal-navigation--item navbuttonshade dib">Queries/Channels in Group</a>\n<a class="showSharingTab singlepadding-horizontal horizontal-navigation--item navbuttonshade dib">Sharing Settings</a>\n</div>\n</nav>\n<div class="editTab">\n<fieldset class="queryList smallmargin-bottom">\n<div class="queryListHeader doublepadding-bottom">\n<a class="singlemargin-left floatright removeAll">Remove all</a>\n<div class="floatright">\n<a class="icon-search filterList customtip" title="Filter Selected Queries">&nbsp;</a>\n<input type="text" autocomplete="off" name="filter" placeholder="Filter Selected Queries" class="hidden field filterList iconfield search valigntop" />\n</div>\n</div>\n<div class="validation-wrapper" data-validation-message-nothingchosen="Please choose at least one Query">\n<select class="query smallmargin-top" name="queries" multiple>\n{{#queries}}\n<option value="{{id}}" {{selected}} {{#typeIconClass}}data-typeiconclass="{{typeIconClass}}"{{/typeIconClass}}>{{name}}</option>\n{{/queries}}\n</select>\n</div>\n</fieldset>\n</div>\n<div class="sharingTab singlemargin-top hidden"></div>\n<fieldset class="controls pagemargin-top">\n<button class="save defaultbutton" data-at="create-new-query-group-button">{{buttonLabel}}</button>\n<button class="cancel button singlemargin-left">Cancel</button>\n</fieldset>\n</form>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("text!templates/groupcreation/multipleQueryGroupSelectorMain.template",[],function(){return'<div class="{{className}}" tabindex=1>\n    <ul class="{{selectionsClass}}">\n        {{#selections}}\n        {{/selections}}\n    </ul>\n    <div class="{{selectedClass}} rounded darkgrey smallpadding-horizontal relative">\n        <span class="{{selectedTextClass}} dib doublepadding-right fullwidth textellipsis" data-at="query-group-add-query-dropdown">{{selectedItemText}}</span><i class="icon-chevron-down rounded linkblue absright hugeline smallmargin-right"></i>\n    </div>\n</div>\n'});define("text!templates/groupcreation/multipleQueryGroupSelectorSelection.template",[],function(){return'<li\n    class="{{selectionItemClass}}"\n    title="{{label}}"\n    data-value="{{value}}">\n    {{#data.typeiconclass}}\n        <span class="smallmargin-right {{itemClass}}__icon {{data.typeiconclass}}"></span>\n    {{/data.typeiconclass}}\n    <span class="sixcolmax name">{{text}}</span>\n    <a class="{{unselectItemClass}} iconsmall icon-remove floatright singlemargin-right customtip" title="{{title}}"></a>\n</li>\n'});define("text!templates/groupcreation/queryGroupSelectorItem.template",[],function(){return'<li\n    class="{{itemClass}} smallpadding relative db textellipsis ellipsistooltip customtip"\n    title="{{label}}"\n    data-text="{{label}}"\n    data-value="{{value}}">\n    {{#data.typeiconclass}}\n        <span class="smallmargin-right {{itemClass}}__icon {{data.typeiconclass}}"></span>\n    {{/data.typeiconclass}}\n    <p class="name bigtext textellipsis {{itemTextClass}}">{{label}}</p>\n</li>\n'});define("text!templates/groupcreation/queryGroupSelectorItemsPopup.template",[],function(){return'<div class="groupCreationSelleckt {{itemsClass}} lightshadow">\n    <div class="searchContainer smallpadding relative db">\n        <input class="{{searchInputClass}} rounded" placeholder="search"></input>\n    </div>\n    <ul class="{{itemslistClass}}">\n        {{#items}}\n            {{> item}}\n        {{/items}}\n    </ul>\n</div>\n'});(function($){"use strict";$.fn.filterlist=function(options){var $list;if(!options){throw new Error("options should be set")}$list=$(options.list);if(!$list.length){throw new Error("options.list should be set")}this.on("change keyup",function onFilter(e){var val=$(e.target).val().toLowerCase();$list.find("li").hide().filter(function(){var $item=$(this),text=$item.data("text");if(!text){text=$item.text().toLowerCase();$item.data("text",text)}return text.indexOf(val)>-1}).show()})}})($);define("lib/jquery.filterlist",function(){});define("css!css/queryGroup.css",["css!css/compiled.css"],function(){});define("css!css/queryGroupSellecktor.css",["css!css/compiled.css"],function(){});define("src/views/QueryGroupFormView",["underscore","jquery","src/controls/lib/viewHelpers","src/globals/me","src/globals/queries","src/views/ValidatingFormView","src/views/GroupShareView","src/models/ProjectSummaryCollection","src/models/QueryGroup","src/globals/queryGroups","mustache!templates/queryGroupFormView","mustache!templates/genericConfirmation","text!templates/groupcreation/multipleQueryGroupSelectorMain.template","text!templates/groupcreation/multipleQueryGroupSelectorSelection.template","text!templates/groupcreation/queryGroupSelectorItem.template","text!templates/groupcreation/queryGroupSelectorItemsPopup.template","src/packages/modalDialogs","src/packages/customtip","src/packages/waitmask","src/packages/selleckt","lib/jquery.filterlist","css!css/queryGroup.css","css!css/groupTabs.css","css!css/queryGroupSellecktor.css"],function(_,$,viewHelpers,me,queries,ValidatingFormView,GroupShareView,ProjectSummaryCollection,QueryGroup,queryGroups,queryGroupTemplate,genericConfirmationTemplate,projectSelectorMainTemplate,projectSelectorSelectionTemplate,projectSelectorItemTemplate,projectSelectorItemsPopup){"use strict";function makeTitle(isNew,name){return isNew?"Create Group":'Edit Group "'+name+'"'}var QueryGroupFormView=ValidatingFormView.extend({events:{"click .showEditTab":"onClickEditTab","click .showSharingTab":"onClickSharingTab","click .closeConfirmation":"onClose","click button.save":"onSave","click button.cancel":"onCancelled","click a.filterList":"onFilter","focusout input.filterList":"onFocusOutFilter","click a.removeAll":"onRemoveAll","change select[name=queries]":"onChangeSelection"},className:"groupAdmin queryGroup modular",initialize:function initialize(opts){var options=opts||{};if(!options.model){throw new Error("options.model must be defined!")}if(!options.projects){throw new Error("options.projects must be set")}this.projects=options.projects;this.loading=options.loading||false;if(this.loading){this.projects.on("reset",this.onProjectsLoaded,this)}this.collection=options.collection||queryGroups;ValidatingFormView.prototype.initialize.call(this,options)},onFilter:function onFilter(e){e.preventDefault();this.filter($(e.target))},onFocusOutFilter:function onFocusOutFilter(e){var $input=$(e.target),val=$input.val();if(!val){$input.addClass("hidden");this.$("a.filterList").show()}},filter:function filter($filterIcon){$filterIcon.hide();this.$("input.filterList").removeClass("hidden").focus()},onRemoveAll:function onRemoveAll(e){e.preventDefault();this.removeAll()},removeAll:function removeAll(){var $filterList=this.$("input.filterList");this.$("select.query").val([]).change();if($filterList.val().trim()!==""){$filterList.val("").trigger("change")}},render:function render(){var $el=this.$el,model=this.model,isNew=model.isNew(),selectedQueries=isNew?[]:_(model.get("queries")).pluck("id"),name=model.get("name"),data=_.extend({},{name:name,title:makeTitle(isNew,name),buttonLabel:isNew?"Create Group":"Update Group",queries:_(queries.toJSON()).chain().map(function(query){return{id:query.id,name:query.name,selected:_(selectedQueries).include(query.id)?"selected":"",typeIconClass:viewHelpers.getIconClassGivenType(query.type)}}).sortBy(function(query){return query.name.toLowerCase()}).value()});$el.html(queryGroupTemplate(data));this.querySelect=this.$('[name="queries"]').selleckt({className:"selleckt modular",placeholderText:"Add a Query / Channel",alternatePlaceholder:"Add another Query / Channel",selectionsClass:"selectedValues",enableSearch:true,mainTemplate:projectSelectorMainTemplate,selectionTemplate:projectSelectorSelectionTemplate,itemTemplate:projectSelectorItemTemplate,popupTemplate:projectSelectorItemsPopup}).data("selleckt");this.$("input.filterList").filterlist({list:this.$(".selectedValues")});this.groupShareView=new GroupShareView({model:this.model,projects:this.projects,groupNoun:"Group",groupType:"Group",canShareWithMultipleProjects:false,canEditProjects:false,loading:this.loading,noteTexts:{private:"is available <strong>only to you</strong>"+" in the Project above. It <strong>cannot</strong> be seen by other users",readonly:"<strong>can be seen</strong> but not edited by users of the Project above.",public:"<strong>can be edited</strong> by users of the Project above."}});$el.centreModal();if(this.loading){this.$el.showWaitmask("Loading...");return}this.groupShareView.render();this.$(".sharingTab").html(this.groupShareView.el);this.$el.customtip();return this},onChangeSelection:function onChangeSelection(){this.hideErrors();this.$el.centreModal()},onProjectsLoaded:function onProjectsLoaded(){this.projects.off("reset",this.onProjectsLoaded,this);this.loading=false;this.render()},getFormattedValues:function getFormattedValues(){return this.querySelect.getSelection().map(function(query){return{id:query.value,name:query.label}})},onSave:function onSave(e){e.preventDefault();var shareSettings=this.groupShareView.getValues();this.save({name:this.$el.find('input[name="groupName"]').val().trim(),queries:this.getFormattedValues(),sharedProjectIds:shareSettings.projectId,shared:shareSettings.shared,users:[{id:me.id}]})},save:function save(attrs){var self=this,saveType=this.model.isNew()?"create":"update";this.$el.showWaitmask("Saving...");this.model.save(attrs,{success:function success(model){self.$el.hideWaitmask();self.collection.add(model);self.showConfirmation(saveType)},error:function error(model,response){self.$el.hideWaitmask();self.onServerError(model,response)},wait:true});if(this.model.validationError){this.$el.hideWaitmask()}},showConfirmation:function showConfirmation(saveType){var name=_.str.escapeHTML(this.model.get("name"));if(this.querySelect){this.querySelect.destroy()}this.$("form").replaceWith(genericConfirmationTemplate({thing:"Group",name:name,wasEdit:saveType==="update",section:"Data"}));this.$(".popup-title").text(makeTitle(saveType!=="update",name))},onClickEditTab:function onClickEditTab(){this.$(".editTab").removeClass("hidden");this.$(".sharingTab").addClass("hidden");this.$(".showEditTab").addClass("active");this.$(".showSharingTab").removeClass("active")},onClickSharingTab:function onClickSharingTab(){this.$(".sharingTab").removeClass("hidden");this.$(".editTab").addClass("hidden");this.$(".showSharingTab").addClass("active");this.$(".showEditTab").removeClass("active")},onModelError:function onModelError(model,response){ValidatingFormView.prototype.onModelError.apply(this,arguments);if(response.name){response.groupName=response.name;this.showInputValidation(this.$('[name="groupName"]'),response)}if(response.queries){this.showInputValidation(this.$('[name="queries"]'),response)}},onCancelled:function onCancelled(e){e.preventDefault();this.trigger("cancelled",{model:this.model});this.remove()},onClose:function onClose(){this.remove()},remove:function remove(){if(this.projects){this.projects.off("reset",this.onProjectsLoaded,this)}if(this.groupShareView){this.groupShareView.remove()}if(this.querySelect){this.querySelect.destroy()}this.$el.removeModal();ValidatingFormView.prototype.remove.call(this)}},{show:function show(opts){var options=opts||{},view,oldRemove;if(options.projects){options.loading=false}else{options.projects=new ProjectSummaryCollection(undefined,{pagination:false});options.loading=true;options.projects.fetch()}_.extend(options,{model:options.model||new QueryGroup,collection:options.collection||queryGroups});view=new QueryGroupFormView(options);oldRemove=view.remove;view.remove=function(){this.$el.removeModal();oldRemove.call(this)};$(view.el).showModal({draggable:"header h1",className:"popup standardpopup",keepCentered:true,allowMultipleInstances:true,zIndex:10011});view.render();view.$("input[name=groupName]").focus();return view}});return QueryGroupFormView});define("mustache!templates/createEditSiteGroup",["lib/mustache"],function(mustache){var escapedTemplate='<header>\n<h1 class="popuptitletext singlemargin-bottom draggable"><span class="sevencol textellipsis db">{{title}}</span></h1>\n</header>\n<div class="content">\n<div class="errorPane notification-error rounded smallpadding-vertical singlepadding-horizontal singlemargin-bottom hidden"></div>\n<fieldset class="singlemargin-bottom">\n<label for="groupName-{{cid}}" class="smallmargin-bottom">List Name\n<a class="help icon-bwhelp dib mediumtext customtip" data-key="sitegroups-add" title="Learn more about Site Lists"></a>\n</label>\n<input class="validation-wrapper fourcol field" id="groupName-{{cid}}" autocomplete="off" name="groupName" type="text" size="32" maxlength="32" placeholder="E.g. My Site List" value="{{name}}" data-validation-message-required="Please give the Site List a name" data-validation-message-maxlength="Sorry, names can\'t be more than 32 letters">\n</fieldset>\n<nav>\n<div class="groupTabs horizontal-navigation">\n<a class="showEditTab active singlepadding-horizontal horizontal-navigation--item navbuttonshade dib">Sites in List</a>\n<a class="showSharingTab singlepadding-horizontal horizontal-navigation--item navbuttonshade dib">Sharing Settings</a>\n</div>\n</nav>\n<div class="editTab">\n<fieldset class="sitesContainer smallmargin-bottom">\n<div class="itemListHeader">\n<a class="removeAll floatright">Remove all</a>\n</div>\n<div class="sites itemList clearboth bwscrollbar-narrow">\n</div>\n</fieldset>\n<fieldset class="addFieldContainer">\n<span class="prefix smallmargin-right">http://</span>\n<input class="validation-wrapper fourcol field autocomplete" size="32" name="site" id="site" data-validation-message-nothingchosen="Please choose at least one site" type="text" placeholder="Add site, e.g www.example.com" />\n<a class="help icon-bwhelp smallmargin-top floatright dib" data-key="sitegroups-csv"></a>\n<a class="upload floatright smallmargin-top smallmargin-right customtip" title="Add sites from a csv or txt file">Upload Sites</a>\n<input type="file" name="file" class="hidden file"></input>\n<p class="no-site hidden notification notification-warning rounded smallpadding-vertical singlepadding-horizontal singlemargin-top">{{{noSiteNotificationText}}}</p>\n</fieldset>\n</div>\n<div class="sharingTab singlemargin-top hidden">\n</div>\n<fieldset class="controls doublemargin-top">\n<button class="save defaultbutton">{{buttonLabel}}</button>\n<button class="cancel button singlemargin-left">Cancel</button>\n</fieldset>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!templates/supportCenterLink",["lib/mustache"],function(mustache){var escapedTemplate='<a href="/supportsso?return_to=https%3A%2F%2Fsupport.brandwatch.com%2Fhc%2Frequests%2Fnew" class="action" target="_blank">the support team</a>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!css/siteGroupAdmin.css",["css!css/compiled.css"],function(){});define("src/views/CreateEditSiteGroupView",["underscore","jquery","src/models/ProjectSummaryCollection","src/globals/theme","src/views/ListView","src/views/GroupShareView","src/views/ValidatingFormView","mustache!templates/createEditSiteGroup","mustache!templates/supportCenterLink","bw-fe-helpers/mimeTypeHelper","src/packages/waitmask","src/packages/modalDialogs","lib/jquery.showModal","lib/jquery.confirm","lib/jquery.notify","css!css/siteGroupAdmin.css","css!css/groupTabs.css"],function(_,$,ProjectSummaryCollection,theme,ListView,GroupShareView,ValidatingFormView,createEditSiteGroupTemplate,supportCenterLinkTemplate,mimeTypeHelper){"use strict";function makeTitle(isNew,name){return isNew?"Create Site List":'Edit Site List "'+name+'"'}function validateSites(sites){var invalidSite;_(sites).find(function(site){if(_(site).trim().indexOf(" ")>-1){invalidSite=site;return true}});return invalidSite}function getNoSiteNotificationText(){if(theme.isBrandwatchOrGreyLabelTheme()){return"Sorry, this website is not in the system.\n              Please contact ".concat(supportCenterLinkTemplate()," or talk to your account contact.")}return"Sorry, this website is not in the system."}var CreateEditSiteGroupView=ValidatingFormView.extend({className:"groupAdmin createEditSiteGroup modular",events:{"click .showEditTab":"onClickEditTab","click .showSharingTab":"onClickSharingTab","keyup input[name=site]":"onKeyUpInSite","click a.removeAll":"onRemoveAll","click button.save":"onSave","click button.cancel,button.close":"onCancel","click a.upload":"onClickUpload","change input.file":"onFileSelected","click button.closeConfirmation":"onClose"},constructor:function CreateEditSiteGroupView(options){ValidatingFormView.apply(this,arguments);if(!options.collection){throw new TypeError("CreateEditSiteGroupView should be constructed with a collection option")}this.wasNew=this.model.isNew();if(!this.model){throw new Error("options.model must be set!")}if(!options.projects){throw new Error("options.projects must be set")}this.projects=options.projects;this.loading=options.loading||false;if(this.loading){this.projects.on("reset",this.onProjectsLoaded,this)}this.collection=options.collection;this.listView=new ListView({items:[],formatItemForTemplate:function formatItemForTemplate(item){return{id:item.domain,name:item.domain,title:"Remove "+item.domain}}});if(options.prefillDomain){this.prefillDomain=options.prefillDomain}this.model.on("change",this.onModelChange,this);_(this).bindAll("onFileSelected")},remove:function remove(){this.listView.remove();this.model.off("change",this.onModelChange,this);this.projects.off("reset",this.onProjectsLoaded,this);if(this.groupShareView){this.groupShareView.remove()}ValidatingFormView.prototype.remove.call(this)},onProjectsLoaded:function onProjectsLoaded(){this.projects.off("reset",this.onProjectsLoaded,this);this.loading=false;this.render()},onClickUpload:function onClickUpload(){this.$(".file").val("").click()},onModelChange:function onModelChange(){this.render()},render:function render(){var model=this.model,name=model.get("name"),listView=this.listView;this.$el.html(createEditSiteGroupTemplate({id:model.id,cid:this.cid,title:makeTitle(model.isNew()||this.wasNew,name),name:name,buttonLabel:this.wasNew?"Create Site List":"Update Site List",editing:!this.wasNew,loading:this.loading,noSiteNotificationText:getNoSiteNotificationText()}));if(this.loading){this.$(".overlay").removeClass("hidden");return}this.groupShareView=new GroupShareView({model:this.model,projects:this.projects,groupType:"Site List"});this.groupShareView.render();this.$(".sharingTab").html(this.groupShareView.el);listView.setElement(this.$(".sites"));listView.render();listView.removeAll();if(this.prefillDomain){this.listView.addItem({domain:this.prefillDomain});this.prefillDomain=undefined}_(model.get("domains")).each(function(domain){listView.addItem({domain:domain})});this.$el.customtip()},onClickEditTab:function onClickEditTab(){this.$(".editTab").removeClass("hidden");this.$(".sharingTab").addClass("hidden");this.$(".showEditTab").addClass("active");this.$(".showSharingTab").removeClass("active")},onClickSharingTab:function onClickSharingTab(){this.$(".sharingTab").removeClass("hidden");this.$(".editTab").addClass("hidden");this.$(".showSharingTab").addClass("active");this.$(".showEditTab").removeClass("active")},onKeyUpInSite:function onKeyUpInSite(e){var $noSite=this.$(".no-site"),siteToAdd=this.$("[name=site]").val().trim();this.hideErrors();if(e.which===13&&siteToAdd!==""){if(_(this.listView.getValues()).any(function(site){return site.domain.toLowerCase()===siteToAdd.toLowerCase()})){$noSite.addClass("hidden");this.showInputValidation(this.$("input#site"),{site:["Site already exists"]});return}this.listView.addItem({domain:siteToAdd});this.$("[name=site]").val("");this.$el.customtip()}},onRemoveAll:function onRemoveAll(){this.listView.removeAll()},getSites:function getSites(){return _(this.listView.getValues()).map(function(item){return item.domain})},onSave:function onSave(){var self=this,model=this.model,name=this.$("[name=groupName]").val(),$siteField=this.$("[name=site]"),siteInField=$siteField.val().trim(),sites,shareSettings=this.groupShareView.getValues();this.hideErrors();if(!name){this.showInputValidation(this.$("[name=groupName]"),{groupName:{message:"Please name this Site List (so you can find it easily later)"}})}if(name.length>32){this.showInputValidation(this.$("[name=groupName]"),{groupName:{message:"Name cannot be longer than 32 characters"}});this.onClickEditTab()}if(siteInField){this.listView.addItem({domain:siteInField});$siteField.val("")}sites=this.getSites();if(!sites.length){this.showInputValidation(this.$("[name=site]"),{site:{message:"Please select at least one site to add to this Site List"}});this.onClickEditTab()}if(!name||name.length>32||!sites.length){return}this.$el.showWaitmask("Saving...");model.save({name:this.$("[name=groupName]").val(),domains:sites,shared:shareSettings.shared,sharedProjectIds:shareSettings.projectId},{wait:true,success:function success(){self.$el.hideWaitmask();self.collection.add(model);self.trigger("sitegroup:added",model);self.remove()},error:function error(model,response){self.$el.hideWaitmask();self.onServerError(model,response)}})},onCancel:function onCancel(e){e.preventDefault();this.trigger("cancelled",{model:this.model});this.remove()},onClose:function onClose(e){e.preventDefault();this.remove()},addSite:function addSite(name){name=name.trim();if(name!==""&&!_.any(this.listView.getValues(),function(site){return site.domain.toLowerCase()===name.toLowerCase()})){this.listView.addItem({domain:name})}},onFileSelected:function onFileSelected(evt){var self=this,file=evt.target&&evt.target.files&&evt.target.files[0],fileReader;if(!mimeTypeHelper.isCSV(file.type,file.name)){$.notify({text:"Unable to upload file. The file type is not allowed.",duration:2e3});return}fileReader=new FileReader;fileReader.onload=function(evt){self.onFileLoaded(evt.target)};this.$el.showWaitmask("Loading file...");fileReader.readAsText(file)},onFileLoaded:function onFileLoaded(file){var self=this;var message="";var existingSites=_.map(_.pluck(self.listView.getValues()||[],"domain"),function(a){return a.toLowerCase()});var newSites=_.compact(file.result.split(/[\n\r,]+/)).map(function(str){return str.replace(/^"(.+(?="$))"$/,"$1").replace(/""/g,'"').toLowerCase()});var deDupedNewSites;var duplicateSiteCount;var invalidSite=validateSites(newSites);if(invalidSite){this.$el.spin(false);return $.notify({text:'Unable to upload file. The site "'+invalidSite+'" contained one or more spaces',className:"error",duration:2e3})}deDupedNewSites=_(newSites).chain().reduce(function(memo,site){site=site.toLowerCase();if(memo.indexOf(site)===-1&&existingSites.indexOf(site)===-1){memo.push(site)}return memo},[]).value();duplicateSiteCount=newSites.length-deDupedNewSites.length;if(deDupedNewSites.length===0){message="All "+duplicateSiteCount+" sites from this CSV were already in this Site List"}else{message=deDupedNewSites.length+" site(s) added"+(duplicateSiteCount?", "+duplicateSiteCount+" site(s) were duplicates":"")}_.each(newSites,function(a){if(a){self.addSite(a,"from file")}});this.$el.customtip();$.notify({text:message,duration:5e3});this.$el.hideWaitmask()},hideNotInSystemMessage:function hideNotInSystemMessage(){this.$(".no-site").addClass("hidden").removeData("site")},showNotInSystemMessage:function showNotInSystemMessage(){this.$(".no-site").removeClass("hidden").data("site",this.$("[name=site]").val())}},{show:function show(options){if(!options.collection){throw new TypeError("CreateEditSiteGroupView.show should be called with a collection option")}var view,oldRemove;if(options.projects){options.loading=false}else{options.projects=new ProjectSummaryCollection(undefined,{pagination:false});options.loading=true;options.projects.fetch()}view=new CreateEditSiteGroupView(options);oldRemove=view.remove;view.render();view.$el.showModal({draggable:"h1:first",className:"popup standardpopup",allowMultipleInstances:true,onClose:function onClose(){oldRemove.call(view)}});view.$("input[name=groupName]").focus();view.remove=function(){view.$el.removeModal()};return view}});return CreateEditSiteGroupView});define("mustache!templates/locationListViewItem",["lib/mustache"],function(mustache){var escapedTemplate='<li data-id="{{id}}"><span class="sixcolmax dib name">{{{name}}}</span><a class="remove iconsmall icon-remove floatright singlemargin-right customtip" title="{{title}}"></a></li>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/views/LocationListView",["src/views/ListView","mustache!templates/locationListViewItem"],function(ListView,locationListViewItemTemplate){"use strict";return ListView.extend({renderItem:function renderItem(item){return locationListViewItemTemplate(item)}})});define("mustache!templates/createEditLocationGroup",["lib/mustache"],function(mustache){var escapedTemplate='<header>\n<h1 class="popuptitletext singlemargin-bottom draggable"><span class="sevencol textellipsis db">{{title}}</span></h1>\n</header>\n<form>\n<div class="errorPane notification-error rounded smallpadding-vertical singlepadding-horizontal singlemargin-bottom hidden"></div>\n<fieldset class="singlemargin-bottom">\n<label for="groupName" class="smallmargin-bottom">List Name</label>\n<input class="validation-wrapper fourcol field" id="groupName" autocomplete="off" name="groupName" type="text" size="32" maxlength="32" placeholder="E.g. Key Markets" value="{{name}}" data-validationmessage-required="Please give the Location List a name" data-validationmessage-maxlength="Sorry, names can\'t be more than 32 letters">\n</fieldset>\n<div class="groupTabs horizontal-navigation">\n<a class="showEditTab active singlepadding-horizontal horizontal-navigation--item navbuttonshade dib">Locations in List</a>\n<a class="showSharingTab singlepadding-horizontal horizontal-navigation--item navbuttonshade dib">Sharing Settings</a>\n</div>\n<div class="editTab">\n<fieldset class="locationsContainer smallmargin-bottom">\n<div class="itemListHeader">\n<a class="removeAll floatright singlemargin-left">Remove all</a>\n<div class="floatright">\n<a class="icon-search filterList">&nbsp;</a>\n<input type="text" autocomplete="off" name="filter" placeholder="Search Locations" class="hidden iconfield search filterList valigntop" />\n</div>\n</div>\n<div class="locations itemList bwscrollbar-narrow">\n</div>\n</fieldset>\n<fieldset class="addFieldContainer">\n<input class="validation-wrapper field autocomplete fourcol" size="32" name="locations" id="locations" data-validation-message-nothingchosen="Please choose at least one location" type="text" placeholder="Add location, e.g. California" />\n</fieldset>\n</div>\n<div class="sharingTab singlemargin-top hidden">\n</div>\n<fieldset class="controls doublemargin-top">\n<button class="save defaultbutton">{{buttonLabel}}</button>\n<button class="cancel button singlemargin-left">Cancel</button>\n</fieldset>\n</form>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!css/locationGroup.css",["css!css/compiled.css"],function(){});define("src/views/CreateEditLocationGroupView",["backbone","underscore","jquery","src/Workbench","src/views/ValidatingFormView","src/views/LocationListView","src/views/GroupShareView","mustache!templates/createEditLocationGroup","mustache!templates/genericConfirmation","src/packages/modalDialogs","src/packages/waitmask","src/packages/customtip","jquery.autocomplete/jquery.autocomplete","jquery.autocomplete/jquery.autocomplete.ajax","lib/jquery.filterlist","css!css/locationGroup.css","css!css/groupTabs.css"],function(Backbone,_,$,Workbench,ValidatingFormView,LocationListView,GroupShareView,locationGroupTemplate,genericConfirmationTemplate){"use strict";function makeTitle(isNew,name){return isNew?"Create Location List":'Edit Location List "'+name+'"'}var CreateEditLocationGroupView=ValidatingFormView.extend({events:{"click .showEditTab":"onClickEditTab","click .showSharingTab":"onClickSharingTab","click button.save":"onSave","click button.cancel":"onCancelled","click button.closeConfirmation":"onClose","click a.filterList":"onFilter","click a.removeAll":"onRemoveAll"},className:"locationGroup groupAdmin modular",initialize:function initialize(opts){var self=this,options=opts||{};if(!options.model){throw new Error("options.model must be defined!")}if(!options.projects){throw new Error("options.projects must be set")}this.projects=options.projects;this.listView=new LocationListView({items:[].concat(this.model.get("locations")),formatItemForTemplate:function formatItemForTemplate(item){return{id:item.id,name:self.formatLocationName(item.fullName),title:"Remove "+item.name}}});ValidatingFormView.prototype.initialize.call(this,options)},onFilter:function onFilter(e){e.preventDefault();this.filter($(e.target))},filter:function filter($filterIcon){$filterIcon.hide();this.$("input.filterList").removeClass("hidden").focus()},onRemoveAll:function onRemoveAll(e){e.preventDefault();this.removeAll()},removeAll:function removeAll(){var $filterList=this.$("input.filterList");this.listView.removeAll();if($filterList.val().trim()!==""){$filterList.val("").trigger("change")}},render:function render(){var model=this.model,isNew=model.isNew(),name=model.get("name"),data=_.extend({},{name:model.get("name")||"",title:makeTitle(isNew,name),buttonLabel:isNew?"Create Location List":"Update Location List"});this.$el.html(locationGroupTemplate(data));this.listView.setElement(this.$el.find(".locations")).render();this.$("input.filterList").filterlist({list:this.listView.$("ul")});this.$("a[title]").customtip({position:"top center"});this.groupShareView=new GroupShareView({model:this.model,projects:this.projects,groupType:"Location List"});this.groupShareView.render();this.$(".sharingTab").html(this.groupShareView.el);this.initAutocomplete();this.$el.centreModal();return this},initAutocomplete:function initAutocomplete(options){var self=this,defaults={css:{width:540},filterResult:function filterResult(result){return!_(self.listView.getValues()).find(function(location){return location.id===result.id})},renderResult:function renderResult(result){return self.formatLocationName(result.fullName)},selected:function selected(result){self.hideError(self.$('input[name="locations"]'));self.listView.addItem(result);$(self.el).centreModal()},parseData:function parseData(data){return data.results},plugins:[{plugin:$.fn.autocomplete.ajax,options:{url:Workbench.buildApiUrl("/locations"),params:{pageSize:20,page:0}}}]};options=options||{};this.$(".autocomplete").autocomplete(_.extend({},defaults,options))},formatLocationName:function formatLocationName(name){var commaIdx=name.indexOf(",");name="<em>"+name.substring(0,commaIdx>-1?commaIdx:name.length)+"</em>"+(commaIdx>-1?name.substring(commaIdx,name.length):"");return name.length>83?name.substring(0,80)+"...":name},onSave:function onSave(e){e.preventDefault();this.save()},save:function save(){var self=this,shareSettings=this.groupShareView.getValues(),wasNew=this.model.isNew();this.$el.showWaitmask("Saving...");this.model.save({name:$(this.el).find('input[name="groupName"]').val().trim(),locations:this.listView.getValues(),shared:shareSettings.shared,sharedProjectIds:shareSettings.projectId},{success:function success(model){self.$el.hideWaitmask();self.collection.add(model);self.showConfirmation(wasNew?"create":"update")},error:function error(model,response){self.$el.hideWaitmask();self.onServerError(model,response)},wait:true});if(this.model.validationError){this.$el.hideWaitmask()}},showConfirmation:function showConfirmation(saveType){var name=_.escape(this.model.get("name"));this.$("form").replaceWith(genericConfirmationTemplate({thing:"Location Group",name:this.model.get("name"),wasEdit:saveType==="update",section:"Tools"}));this.$(".popup-title").html(makeTitle(saveType!=="update",name))},onModelError:function onModelError(model,response){ValidatingFormView.prototype.onModelError.apply(this,arguments);if(response.name){response.groupName=response.name;this.showInputValidation(this.$('[name="groupName"]'),response)}},onClickEditTab:function onClickEditTab(){this.$(".editTab").removeClass("hidden");this.$(".sharingTab").addClass("hidden");this.$(".showEditTab").addClass("active");this.$(".showSharingTab").removeClass("active")},onClickSharingTab:function onClickSharingTab(){this.$(".sharingTab").removeClass("hidden");this.$(".editTab").addClass("hidden");this.$(".showSharingTab").addClass("active");this.$(".showEditTab").removeClass("active")},onCancelled:function onCancelled(e){e.preventDefault();this.trigger("cancelled",{model:this.model});this.remove()},onClose:function onClose(){this.remove()},remove:function remove(){if(this.groupShareView){this.groupShareView.remove()}Backbone.View.prototype.remove.call(this)}},{show:function show(options){var view=new CreateEditLocationGroupView(options),oldRemove=view.remove;view.render();view.$el.showModal({draggable:"header h1",className:"popup standardpopup",allowMultipleInstances:true,keepCentred:true,onClose:function onClose(){oldRemove.call(view)}});view.$("input[name=groupName]").focus();view.remove=function(){view.$el.removeModal()};return view}});return CreateEditLocationGroupView});function _typeof(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}define("src/controls/lib/paramAssert",[],function(){"use strict";var assert=function assert(predicate,message){if(!predicate){throw new TypeError(message)}return true};var isType=function isType(param,type,message){switch(type){case"array":return assert(Array.isArray(param),message);default:return assert(_typeof(param)===type,message)}};var isInstance=function isInstance(suspect,expectation,message){return assert(suspect instanceof expectation,message)};var isInstanceOfAny=function isInstanceOfAny(suspect,expectations,message){var _isInstanceOfAny=expectations.some(function(expectation){return suspect instanceof expectation});return assert(_isInstanceOfAny,message)};var isDefined=function isDefined(trigger,message){return assert(!trigger,message)};var isNotDefined=function isNotDefined(trigger,message){if(trigger===undefined||trigger===null){throw new TypeError(message)}return true};return{isType:isType,isInstance:isInstance,isInstanceOfAny:isInstanceOfAny,isDefined:isDefined,isNotDefined:isNotDefined}});define("mustache!src/components/imagewall/components/promo/promosignupform",["lib/mustache"],function(mustache){var escapedTemplate='<label class="b-iw-promo-signup__label">\n<div class="b-iw-promo-signup__label-text">Email to contact you at:</div>\n<div class="b-iw-promo-signup__input-container">\n<input type="text" class="js-email b-iw-promo-signup__input" placeholder="Email..." value="{{email}}">\n</div>\n</label>\n{{#allowMessage}}\n<label class="b-iw-promo-signup__label">\n<div class="b-iw-promo-signup__label-text">Your Message:\n<span class="b-iw-promo-signup__label-text--optional"> (optional)</span>\n</div>\n<div class="b-iw-promo-signup__input-container">\n<textarea class="js-message b-iw-promo-signup__input b-iw-promo-signup__input--message"\nplaceholder="e.g. Hi..."></textarea>\n</div>\n</label>\n{{/allowMessage}}\n<label class="b-iw-promo-signup__label">\n<div class="b-iw-promo-signup__label-text">Brand(s) you are interested in:\n<span class="b-iw-promo-signup__label-text--optional"> (optional)</span></div>\n<div class="b-iw-promo-signup__input-container">\n<input type="text" class="js-brands b-iw-promo-signup__input" placeholder="e.g. Nike, Ikea, Heineken">\n<button class="js-send b-iw-promo__send-button b-iw-promo__button\nb-iw-promo__button--medium b-iw-promo__button--primary">Send</button>\n</div>\n</label>\n\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/components/imagewall/components/promo/promo.css",["css!src/components/imagewall/components/promo/compiled.css"],function(){});define("css!src/components/imagewall/components/promo/promosignupform.css",["css!src/components/imagewall/components/promo/compiled.css"],function(){});function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}define("src/components/imagewall/components/promo/PromotionSignupForm",["backbone","bw-fe-helpers/validationHelpers","bw-fe-helpers/promiseHelper","src/controls/lib/paramAssert","src/globals/me","src/components/imagewall/helpers/logoqueriesEnabledHelper","src/helpers/validationTooltipHelper","mustache!src/components/imagewall/components/promo/promosignupform","src/packages/customtip","css!src/components/imagewall/components/promo/promo.css","css!src/components/imagewall/components/promo/promosignupform.css"],function(Backbone,validationHelpers,promiseHelper,paramAssert,me,logoqueriesEnabledHelper,validationTooltipHelper,template){"use strict";var VIEW_SELECTORS={EMAIL_INPUT:".js-email",MESSAGE_INPUT:".js-message",BRANDS_INPUT:".js-brands",SEND_BUTTON:".js-send"};function onEmailChanged(view,field,event){var value=event.target.value;validationHelpers.isValidEmail(value.trim())?onIsValidEmail(view):onIsInvalidEmail(view)}function onIsValidEmail(view){var $input=view.$(VIEW_SELECTORS.EMAIL_INPUT);validationTooltipHelper.hideError($input);$input.removeClass("b-iw-promo-signup__input--invalid");view.$(VIEW_SELECTORS.SEND_BUTTON).prop("disabled",false)}function onIsInvalidEmail(view){var $input=view.$(VIEW_SELECTORS.EMAIL_INPUT);$input.addClass("b-iw-promo-signup__input--invalid customtip").prop("title","Your email is incorrect.").customtip({tipClass:"tip-top b-iw-signup-form__validation-tooltip--error"});view.$(VIEW_SELECTORS.SEND_BUTTON).prop("disabled",true)}function onClickSend(view){var email=view.$(VIEW_SELECTORS.EMAIL_INPUT).val().trim();var messageInputValue=view.$(VIEW_SELECTORS.MESSAGE_INPUT).val();var message=messageInputValue&&messageInputValue.trim();var brands=view.$(VIEW_SELECTORS.BRANDS_INPUT).val().trim();var isLogoQueryEnabled=logoqueriesEnabledHelper.isEnabled();var calledFrom=view.calledFrom;var data={email:email,message:message,brands:brands,isLogoQueryEnabled:isLogoQueryEnabled,calledFrom:calledFrom};view.$(VIEW_SELECTORS.SEND_BUTTON).prop("disabled",true);view.trigger("signup-submit");promiseHelper.ajax({method:"POST",url:"/signup-logoqueries",contentType:"application/json",data:JSON.stringify(data)}).then(function(){view.trigger("signup-success",data);view.remove()}).catch(function(error){view.$(VIEW_SELECTORS.SEND_BUTTON).prop("disabled",false);view.trigger("signup-error",Object.assign({},{error:error},data))})}function getTemplateData(){return{email:me.get("username"),allowMessage:logoqueriesEnabledHelper.isEnabled()}}var PromotionSignupForm=Backbone.View.extend({className:"b-iw-promo-signup",constructor:function PromotionSignupForm(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};Backbone.View.apply(this,arguments);paramAssert.isNotDefined(options.calledFrom,"calledFrom must be defined");this.calledFrom=options.calledFrom},events:function events(){var _ref;return _ref={},_defineProperty(_ref,"keyup ".concat(VIEW_SELECTORS.EMAIL_INPUT),onEmailChanged.bind(null,this,"email")),_defineProperty(_ref,"click ".concat(VIEW_SELECTORS.SEND_BUTTON),onClickSend.bind(null,this)),_ref},render:function render(){var templateData=getTemplateData();this.$el.html(template(templateData))},shown:function shown(){this.$("".concat(VIEW_SELECTORS.MESSAGE_INPUT,", ").concat(VIEW_SELECTORS.BRANDS_INPUT)).eq(0).select()},retry:function retry(){onClickSend(this)}});return PromotionSignupForm});define("mustache!src/components/imagewall/components/promo/signupsuccess",["lib/mustache"],function(mustache){var escapedTemplate='<svg viewBox="0 0 74 74" class="b-iw-promo__icon-indicator--larger b-iw-promo__icon-indicator--success">\n<path d="M37 .5C16.86.5.5 16.86.5 37S16.86 73.5 37 73.5 73.5 57.14 73.5 37 57.14.5 37 .5zm0 3c18.52 0 33.5 14.98 33.5 33.5S55.52 70.5 37 70.5 3.5 55.52 3.5 37 18.48 3.5 37 3.5zm12.834 20.375l-17.5 17.5-5.834-5.834-4.375 4.375 10.209 10.209L54.209 28.25l-4.375-4.375z"/>\n</svg>\n<h1 class="b-iw-promo__title">Thanks for your interest!</h1>\n<p class="b-iw-promo__paragraph">\n<strong>The team has been notified.</strong>\n<br>\n<strong>We will email you at <span class="js-email">{{email}}</span> to discuss the details of the new\nQueries.</strong>\n</p>\n<p class="b-iw-promo__paragraph">\nIf you want to get in touch straight away, <a href="https://www.brandwatch.com/contactmaps/" target="_blank">click here</a>.\n</p>\n<div class="b-iw-promo__button-group">\n<button class="js-close-button b-iw-promo__button b-iw-promo__button--medium b-iw-promo__button--color-success">Close</button>\n</div>\n<span class="js-close b-iw-signup-status__close icon-remove"></span>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/components/imagewall/components/promo/signupstatus.css",["css!src/components/imagewall/components/promo/compiled.css"],function(){});function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}define("src/components/imagewall/components/promo/SignupSuccessPopup",["backbone","src/mixins/mixin","src/mixins/withPopup","mustache!src/components/imagewall/components/promo/signupsuccess","css!src/components/imagewall/components/promo/promo.css","css!src/components/imagewall/components/promo/signupstatus.css"],function(Backbone,mixin,withPopup,template){"use strict";var _events;var VIEW_SELECTORS={CLOSE_ICON:".js-close",CLOSE_BUTTON:".js-close-button"};var SignupSuccessPopup=Backbone.View.extend({className:"b-iw-signup-status b-iw-signup-status--success",events:(_events={},_defineProperty(_events,"click ".concat(VIEW_SELECTORS.CLOSE_ICON),function onClose(){this.remove()}),_defineProperty(_events,"click ".concat(VIEW_SELECTORS.CLOSE_BUTTON),function onClose(){this.remove()}),_events),constructor:function SignupSuccessPopup(){Backbone.View.apply(this,arguments)},render:function render(data){this.$el.html(template(data))}},{show:function show(){var data=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{email:""};var view=new SignupSuccessPopup;view.render(data);view.showAsPopup({className:"popup modular",top:"center",left:"center",removeCloseIcon:true});return view}});mixin(SignupSuccessPopup,withPopup);return SignupSuccessPopup});define("mustache!src/components/imagewall/components/promo/signuperror",["lib/mustache"],function(mustache){var escapedTemplate='<svg viewBox="0 0 74 74" class="b-iw-promo__icon-indicator--larger b-iw-promo__icon-indicator--error">\n<path d="M37 .5C16.805.5.5 16.805.5 37S16.805 73.5 37 73.5 73.5 57.195 73.5 37 57.195.5 37 .5zm0 3A33.394 33.394 0 0 1 70.5 37 33.394 33.394 0 0 1 37 70.5 33.394 33.394 0 0 1 3.5 37 33.394 33.394 0 0 1 37 3.5zM31.729 19l1.459 24.063h7.29L41.939 19h-10.21zm5.105 28.072a4.016 4.016 0 0 0-4.012 4.012c0 2.21 1.802 4.01 4.012 4.01 2.21 0 4.01-1.8 4.01-4.01 0-2.214-1.8-4.012-4.01-4.012z"/>\n</svg>\n<h1 class="b-iw-promo__title">Sorry, something went wrong</h1>\n<p class="b-iw-promo__paragraph">\nPlease try again  if the issue persists, please contact our team.\n</p>\n<div class="b-iw-promo__button-group">\n<button class="js-retry b-iw-promo__button b-iw-promo__button--medium b-iw-promo__button--color-error">Try again</button>\n</div>\n<span class="js-close b-iw-signup-status__close icon-remove"></span>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}define("src/components/imagewall/components/promo/SignupErrorPopup",["backbone","src/mixins/mixin","src/mixins/withPopup","mustache!src/components/imagewall/components/promo/signuperror","css!src/components/imagewall/components/promo/promo.css","css!src/components/imagewall/components/promo/signupstatus.css"],function(Backbone,mixin,withPopup,template){"use strict";var _events;var VIEW_SELECTORS={CLOSE:".js-close",RETRY:".js-retry"};var SignupErrorPopup=Backbone.View.extend({events:(_events={},_defineProperty(_events,"click ".concat(VIEW_SELECTORS.CLOSE),function onClose(){this.remove()}),_defineProperty(_events,"click ".concat(VIEW_SELECTORS.RETRY),function onClose(){this.trigger("retry");this.remove()}),_events),className:"b-iw-signup-status b-iw-signup-status--error",constructor:function SignupErrorPopup(){Backbone.View.apply(this,arguments)},render:function render(){this.$el.html(template(this.options))}},{show:function show(){var view=new SignupErrorPopup;view.render();view.showAsPopup({className:"popup modular",top:"center",left:"center",removeCloseIcon:true});return view}});mixin(SignupErrorPopup,withPopup);return SignupErrorPopup});define("mustache!src/components/imagewall/components/promo/promopopup",["lib/mustache"],function(mustache){var escapedTemplate='<div class="b-iw-promo-popup__left-pane">\n<h1 class="b-iw-promo__title">\nUnlock <span class="b-iw-promo__title--strong">Image Insights</span>\n</h1>\n<p class="b-iw-promo__paragraph">\n<strong>You\'re missing thousands of images that contain your logo.</strong>\n</p>\n<p class="b-iw-promo__paragraph">\nDiscover the images youre missing with the worlds best logo detection\ntechnology.\n{{#showSignupForm}}\n<br>\n<br>Prices start from $480 per month.\n{{/showSignupForm}}\n</p>\n{{#showSignupForm}}\n<p class="b-iw-promo__paragraph">\n<strong>Interested? Get in touch using the form below.</strong>\n</p>\n<div class="js-signup-form b-iw-promo-popup__signup-form"></div>\n{{/showSignupForm}}\n{{^showSignupForm}}\n<p class="b-iw-promo__paragraph">\n<strong>Interested? Talk to your account contact to get started.</strong>\n</p>\n{{/showSignupForm}}\n</div>\n<div class="b-iw-promo-popup__right-pane">\n</div>\n<span class="js-close b-iw-promo-popup__close icon-remove"></span>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/components/imagewall/components/promo/promopopupRequestNew",["lib/mustache"],function(mustache){var escapedTemplate='<div class="b-iw-promo-popup__left-pane">\n<h1 class="b-iw-promo__title">\nRequest New Logo Queries\n</h1>\n{{#showSignupForm}}\n{{^projectHasLogoQueries}}\n<p class="b-iw-promo__paragraph">\nHold up, you dont have any logo queries in this project yet.\n</p>\n<p class="b-iw-promo__paragraph">\nTo get started with image insights you can either <strong>move</strong> a logo query here or request a new one using the form below.\n</p>\n{{/projectHasLogoQueries}}\n{{#projectHasLogoQueries}}\n<p class="b-iw-promo__paragraph">\n<strong>\nTo request one or more new Logo Queries, please complete the form below.\n</strong>\n</p>\n{{/projectHasLogoQueries}}\n<p class="b-iw-promo__paragraph">\n<strong>Note:</strong> Prices start from $480 per logo per month. Dont worry, we wont start charging yet.\n</p>\n<div class="js-signup-form b-iw-promo-popup__signup-form"></div>\n{{/showSignupForm}}\n{{^showSignupForm}}\n<p class="b-iw-promo__paragraph">\n<strong>Talk to your account contact to add another Logo Query.</strong>\n</p>\n{{/showSignupForm}}\n</div>\n<span class="js-close b-iw-promo-popup__close icon-remove"></span>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/components/imagewall/components/promo/promopopup.css",["css!src/components/imagewall/components/promo/compiled.css"],function(){});function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}define("src/components/imagewall/components/promo/PromotionPopup",["backbone","src/globals/queries","src/globals/theme","src/events/logoDetectionEvents","src/events/globalEventNames","src/components/imagewall/components/promo/PromotionSignupForm","src/components/imagewall/components/promo/SignupSuccessPopup","src/components/imagewall/components/promo/SignupErrorPopup","src/components/imagewall/helpers/logoqueriesEnabledHelper","src/mixins/mixin","src/mixins/withPopup","mustache!src/components/imagewall/components/promo/promopopup","mustache!src/components/imagewall/components/promo/promopopupRequestNew","css!src/components/imagewall/components/promo/promo.css","css!src/components/imagewall/components/promo/promopopup.css","src/packages/modalDialogs","src/packages/waitmask"],function(Backbone,queries,theme,logoDetectionEvents,globalEventNames,PromotionSignupForm,SignupSuccessPopup,SignupErrorPopup,logoqueriesEnabledHelper,mixin,withPopup,promotionTemplate,requestNewTemplate){"use strict";var VIEW_SELECTORS={CLOSE:".js-close",SIGNUP_FORM:".js-signup-form"};var PROMOTION_EVENTS=globalEventNames.LOGO_DETECTION_PROMOTION;function showSignupForm(){return theme.isBrandwatchOrGreyLabelTheme()}function onSignupSuccess(view,data){view.$el.hideWaitmask();view.remove();logoDetectionEvents.trigger(PROMOTION_EVENTS.PROMOTION_SIGNUP,data);SignupSuccessPopup.show(data)}function onSignupError(view,data){view.$el.hideWaitmask();logoDetectionEvents.trigger(PROMOTION_EVENTS.PROMOTION_SIGNUP_ERROR,data);var signupErrorPopup=SignupErrorPopup.show();view.listenTo(signupErrorPopup,"retry",function(){view.signupForm.retry()})}function isLogoQueriesEnabled(){return logoqueriesEnabledHelper.isEnabled()}function projectHasLogoQueries(){return isLogoQueriesEnabled()&&queries.containsLogoQueryIds(queries.pluck("id"))}var PromotionPopup=Backbone.View.extend({className:function className(){var classes=["b-iw-promo-popup"];if(isLogoQueriesEnabled()){classes.push("b-iw-promo-popup--without-right-pane")}else if(!showSignupForm()){classes.push("b-iw-promo-popup--small")}return classes.join(" ")},constructor:function PromotionPopup(){var _this=this;var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};Backbone.View.apply(this,arguments);if(showSignupForm()){this.signupForm=new PromotionSignupForm(options);this.listenTo(this.signupForm,"signup-success",onSignupSuccess.bind(null,this));this.listenTo(this.signupForm,"signup-error",onSignupError.bind(null,this));this.listenTo(this.signupForm,"signup-submit",function(){_this.$el.showWaitmask()})}},events:_defineProperty({},"click ".concat(VIEW_SELECTORS.CLOSE),function onClose(){logoDetectionEvents.trigger(PROMOTION_EVENTS.PROMOTION_CLOSED);this.remove()}),render:function render(){var actualTemplate=isLogoQueriesEnabled()?requestNewTemplate:promotionTemplate;this.$el.html(actualTemplate({projectHasLogoQueries:projectHasLogoQueries(),showSignupForm:!!this.signupForm}));var signupForm=this.signupForm;if(signupForm){signupForm.render();this.$(VIEW_SELECTORS.SIGNUP_FORM).empty().append(signupForm.$el)}},shown:function shown(){if(this.signupForm){this.signupForm.shown()}logoDetectionEvents.trigger(PROMOTION_EVENTS.PROMOTION_SHOWN)},remove:function remove(){if(this.signupForm){this.signupForm.remove()}Backbone.View.prototype.remove.call(this)}},{show:function show(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var popup=new PromotionPopup(options);popup.render();popup.showAsPopup({className:"popup",top:"center",left:"center",removeCloseIcon:true});popup.shown();return popup},CALLED_FROM:{DASHBOARD_PICKER:"dashboard-picker",COMPONENT_PICKER:"component-picker",DATA_LOGO_QUERIES:"data-logo-queries",QUERY_INPUT:"query-input"}});mixin(PromotionPopup,withPopup);return PromotionPopup});define("src/models/LocationGroup",["underscore","src/models/Group"],function(_,Group){"use strict";return Group.extend({defaults:function defaults(){return{name:"",locations:[],sharedProjectIds:[]}},validate:{name:{required:true,custom:"validateName"},locations:{required:true,custom:"atLeastOneLocation"}},validateName:function validateName(attrName,attrValue){if(_.isUndefined(attrValue)){return"noname"}return attrValue.length>32?"maxlength":undefined},atLeastOneLocation:function atLeastOneLocation(attrName,attrValue){return _.isUndefined(attrValue)||attrValue.length===0?"nothingchosen":undefined},url:function url(){return"/projects/{projectId}/group/location/"+(this.id||"")},isOwn:function isOwn(userId){return this.get("userId")===userId},getOwner:function getOwner(){return this.get("userName")||"n/a"}})});define("src/models/LocationGroupCollection",["src/models/GroupCollection","src/models/LocationGroup"],function(GroupCollection,LocationGroup){"use strict";return GroupCollection.extend({model:LocationGroup,url:"/projects/{projectId}/group/location/summary",parse:function parse(response){return response.results}})});define("src/globals/locationGroups",["src/globals/currentProject","src/models/LocationGroupCollection"],function(currentProject,LocationGroupCollection){"use strict";var locationGroups=new LocationGroupCollection;currentProject.onLoad(function(callback){locationGroups.projectId=currentProject.id;if(!currentProject.id){locationGroups.reset([],{silent:false});return}locationGroups.reset([],{silent:true});locationGroups.fetch({success:function success(){callback()},error:function error(model,err){callback(err)}})});return locationGroups});define("src/controlsEventsObserver",["src/controls/controlsEvents","src/Workbench","src/globals/currentProject","src/globals/siteGroups","src/QueryFormManager","src/views/QueryGroupFormView","src/views/CreateEditSiteGroupView","src/models/SiteGroup","src/views/CreateEditLocationGroupView","src/views/AuthorGroupAdministrationView","src/components/imagewall/components/promo/PromotionPopup","src/models/LocationGroup","src/models/ProjectSummaryCollection","src/globals/locationGroups","src/globals/authorGroups","src/analytics/Analytics"],function(controlsEvents,Workbench,currentProject,siteGroups,QueryFormManager,QueryGroupFormView,CreateEditSiteGroupView,SiteGroup,CreateEditLocationGroupView,AuthorGroupAdministrationView,LogoDetectionPromotionPopup,LocationGroup,ProjectSummaryCollection,locationGroups,authorGroups,Analytics){"use strict";function onCreateQuery(options){options=options||{};var _options=options,allowedQueryTypes=_options.allowedQueryTypes;if(allowedQueryTypes&&allowedQueryTypes.length===1&&allowedQueryTypes[0]==="logo"){LogoDetectionPromotionPopup.show({calledFrom:LogoDetectionPromotionPopup.CALLED_FROM.QUERY_INPUT});return}QueryFormManager.showCreateQueryForm({project:currentProject,userData:Workbench.userData,allowedQueryTypes:options.allowedQueryTypes});Analytics.trackEvent({name:"Miscellaneous.QueryInputs",action:"Add_Query",origin:"Application"})}function onEditQuery(query){QueryFormManager.showEditQueryForm({query:query,project:currentProject,withinDashboard:true});Analytics.trackEvent({name:"Miscellaneous.QueryInputs",action:"Edit_Query",origin:"Application"})}function onCreateQueryGroup(){QueryGroupFormView.show()}function onEditQueryGroup(queryGroup){QueryGroupFormView.show({model:queryGroup})}function createSiteGroup(data){var siteGroupForm=CreateEditSiteGroupView.show({collection:siteGroups,model:new SiteGroup});if(data&&data.callback){siteGroupForm.once("sitegroup:added",function(siteGroup){data.callback(siteGroup.id)})}}function editSiteGroup(data){var siteGroup=siteGroups.get(data.id);CreateEditSiteGroupView.show({collection:siteGroups,model:siteGroup})}function onCreateLocationGroup(options){var locationGroupForm=CreateEditLocationGroupView.show({model:new LocationGroup,projects:new ProjectSummaryCollection(undefined,{pagination:false}),collection:locationGroups});locationGroupForm.once("cancelled",function(){options.cancelled()})}function onEditLocationGroup(locationGroup){CreateEditLocationGroupView.show({collection:locationGroups,model:locationGroup,projects:new ProjectSummaryCollection(undefined,{pagination:false})})}function onCreateAuthorGroup(options){var authorGroupForm;authorGroupForm=AuthorGroupAdministrationView.show({collection:authorGroups});authorGroupForm.once("cancelled",function(){options.callback()})}function onEditAuthorGroup(authorGroupModel){AuthorGroupAdministrationView.show({collection:authorGroups,model:authorGroupModel})}return{start:function start(){controlsEvents.on("createQuery",onCreateQuery);controlsEvents.on("editQuery",onEditQuery);controlsEvents.on("createQueryGroup",onCreateQueryGroup);controlsEvents.on("editQueryGroup",onEditQueryGroup);controlsEvents.on("sitegroup:new",createSiteGroup);controlsEvents.on("sitegroup:edit",editSiteGroup);controlsEvents.on("createLocationGroup",onCreateLocationGroup);controlsEvents.on("editLocationGroup",onEditLocationGroup);controlsEvents.on("createAuthorGroup",onCreateAuthorGroup);controlsEvents.on("editAuthorGroup",onEditAuthorGroup)},stop:function stop(){controlsEvents.off("createQuery",onCreateQuery);controlsEvents.off("editQuery",onEditQuery);controlsEvents.off("createQueryGroup",onCreateQueryGroup);controlsEvents.off("editQueryGroup",onEditQueryGroup);controlsEvents.off("sitegroup:new",createSiteGroup);controlsEvents.off("sitegroup:edit",editSiteGroup);controlsEvents.off("createLocationGroup",onCreateLocationGroup);controlsEvents.off("editLocationGroup",onEditLocationGroup)}}});define("app",["backbone","jquery","src/Workbench","src/backboneSync","src/globals/me","src/globals/theme","src/appInitialise","src/AppRouter","appLayout","src/logoutDetector","src/helpers/appSettingsHelper","src/helpers/logoVersionHelper","src/appStartup","twitter-intents","app-startup/initializeAnalyticsObservers","src/controls/settings","src/analytics/Analytics","src/controlsEventsObserver"],function(Backbone,$,Workbench,backboneSync,me,theme,appInitialise,AppRouter,appLayout,logoutDetector,appSettingsHelper,logoVersionHelper,appStartup,TwitterIntents,initializeAnalyticsObservers,controlsSettings,Analytics,controlsEventsObserver){"use strict";var app=new AppRouter;if(!window.console){window.console={log:function log(){},warn:function warn(){},error:function error(){},trace:function trace(){}}}if(!console.time){console.time=function(){};console.timeEnd=function(){}}app.boot=function(){$.ajaxSetup({cache:false,error:function error(){console.error(arguments)},statusCode:{401:function _(){if(Workbench.isApiUrl(this.url)){logoutDetector.checkLoginStatus()}},503:function _(){window.location="/logout/?redirect="+window.location.href}}});me.set(appSettingsHelper.get("me"));Workbench.configure(appSettingsHelper.get("workbench"));theme.configure(appSettingsHelper.get("theme"));logoVersionHelper.configure(appSettingsHelper.get("logograbAssetCdnUrl"));backboneSync.apply();appInitialise.go(function(){appLayout.load($("#main"));appStartup.start();Backbone.history.start({pushState:true});Workbench.trigger("ready");Analytics.logMetric("app:ready")});initializeAnalyticsObservers();controlsEventsObserver.start();controlsSettings.apiUrl=Workbench.apiUrl;$("body").on("click","a",function(e){var $a=$(e.currentTarget);var href=$a.attr("href");var hasTargetBlank=$a.attr("target")==="_blank";if(!hasTargetBlank&&app.canHandle(href)&&!e.isDefaultPrevented()){e.preventDefault();app.navigate(href.substring(1),true)}});(new TwitterIntents).register()};return app});require.config({paths:{keymaster:"vendor/keymaster/1.6.3/keymaster","d3-layout-cloud":"vendor/d3-cloud/1.2.1/build/d3.layout.cloud","jquery-tools-tooltip":"vendor/jquery.tools/1.2.9-bw/src/tooltip/tooltip",dateinput:"vendor/jquery.tools/1.2.9-bw/src/dateinput/dateinput","leaflet-image":"vendor/leaflet-image/0.0.4/leaflet-image","jquery-tools-overlay":"vendor/jquery.tools/1.2.9-bw/src/overlay/overlay","jquery-tools-toolbox":"vendor/jquery.tools/1.2.9-bw/src/toolbox/toolbox.expose","moment-tz":"vendor/moment-timezone/0.5.16/builds/moment-timezone.min","leaflet-markercluster":"vendor/leaflet.markercluster/0.4.0/dist/leaflet.markercluster","modular-css-source":"vendor/modular-css/1.6.2/build",bogus:"vendor/bogus/1.0.0/bogus","jquery-autosize":"vendor/jquery-autosize/1.18.2/jquery.autosize","bw-component-api-client":"vendor/bw-component-api-client/0.3.2/index","bw-fe-helpers":"vendor/bw-fe-helpers/3.6.3","bw-highcharts":"vendor/bw-highcharts/1.4.0/index","topics-visualisations":"vendor/topics-vis.analytics-frontend/0.44.0/index","emoji-cloud-builder":"vendor/emoji-cloud-builder/0.5.1/index","jquery.autocomplete":"vendor/jquery.autocomplete/1.1.1/","jquery.showRelativeTo":"vendor/jquery.showRelativeTo/0.13.0/jquery.showRelativeTo",mapbox:"vendor/mapbox.js/2.1.8/mapbox","ace-mode-brandwatch":"vendor/ace-mode-brandwatch/0.1.3/src",ace:"vendor/ace/1.2.6/lib/ace",async:"vendor/async/0.2.5/lib/async",css:"vendor/bw-requirejs-plugins/1.1.2/css","customtip-source":"vendor/customtip/2.1.2",customtip:"vendor/customtip/2.1.2/src/jquery.customtip",d3:"vendor/d3/3.3.10/d3","daterangepicker.timesupport":"vendor/daterangepicker/1.6.0/lib/daterangepicker/daterangepicker.timesupport",daterangepicker:"vendor/daterangepicker/1.6.0/lib/daterangepicker/daterangepicker",fetch:"vendor/fetch/2.0.4/fetch","guiders-source":"vendor/guiders.js/1.3.1-bw",guiders:"vendor/guiders.js/1.3.1-bw/guiders",html2canvas:"vendor/html2canvas/0.5.0-alpha1/dist/html2canvas","jquery.acify":"vendor/jquery.acify/0.10.8/jquery.acify","jquery.spin":"vendor/spin.js/1.3.3/jquery.spin",jsdiff:"vendor/jsdiff/2.2.1/diff",jsonp:"vendor/bw-requirejs-plugins/1.1.2/jsonp",ldclient:"vendor/ldclient-js/2.3.1/ldclient.min","lib/tabler":"vendor/tabler/0.10.20/lib/tabler","markdown-it-attrs":"vendor/markdown-it-attrs/0.5.1/markdown-it-attrs.browser","markdown-it":"vendor/markdown-it/6.0.1/dist/markdown-it","mixpanel-analytics-helper":"vendor/bw-mixpanel-helpers/1.0.0/dist/mixpanelAnalyticsHelper",moment:"vendor/moment/2.22.1/moment","mustache-common":"vendor/bw-requirejs-plugins/1.1.2/mustache-common",mustache:"vendor/bw-requirejs-plugins/1.1.2/mustache",popper:"vendor/popper/1.12.9/popper.min",q:"vendor/q/1.3.0/q",rangeslider:"vendor/rangeslider.js/2.1.1/dist/rangeslider",rx:"vendor/rxjs/5.5.10/global/rx.min","selleckt-legacy":"vendor/selleckt/2.5.2/dist/selleckt-legacy",selleckt:"vendor/selleckt/2.5.2/dist/selleckt",shufflejs:"vendor/shufflejs/5.1.0/dist/shuffle","slick.core":"vendor/slickgrid/2.3.0/slick.core","slick.dataview":"vendor/slickgrid/2.3.0/slick.dataview","slick.grid":"vendor/slickgrid/2.3.0/slick.grid","slick.grid-source":"vendor/slickgrid/2.3.0",spin:"vendor/spin.js/1.3.3/spin",svgjs:"vendor/svg.js/2.3.0/dist/svg",text:"vendor/requirejs-text/2.0.10/text",timepicker:"vendor/timepicker/0.2.1/lib/timepicker/timepicker","twitter-intents":"vendor/twitter-intents/1.0.0/twitter-intents","twitter-text":"vendor/twitter-text/1.13.4/js/twitter-text","underscore.string":"vendor/underscore.string/2.3.3/dist/underscore.string.min",geosearch:"vendor/leaflet/2.6.0/geosearch.min",backbone:"src/packages/backbone","moment-timezone":"src/packages/momentTimezoneLoader","lib/mustache":"src/packages/mustache-global",jquery:"src/packages/jquery",underscore:"src/packages/underscore"},shim:{d3:{exports:"d3"},"twitter-text":{exports:"twttr.txt"},guiders:{exports:"guiders"},"jquery.spin":{deps:["spin","jquery"],exports:"jquery"},"lib/jquery.event.drag-2.2":{deps:[],exports:"jQuery.fn.drag"},"lib/jquery.event.drag.live-2.2-patched.js":{deps:["lib/jquery.event.drag-2.2"],exports:"jQuery.fn.drag.delegate"},rangeslider:{deps:["jquery"],exports:"jquery.fn.rangeslider"},"slick.core":{deps:[],exports:"Slick"},"slick.grid":{deps:["lib/jquery.event.drag-2.2","slick.core"],exports:"Slick.Grid"},"slick.dataview":{deps:["slick.grid"],exports:"Slick.Data"},"jquery.autocomplete/jquery.autocomplete":{exports:"jQuery.fn.autocomplete"},"jquery.autocomplete/jquery.autocomplete.ajax":{deps:["jquery.autocomplete/jquery.autocomplete"],exports:"jQuery.fn.autocomplete.ajax"},"jquery.autocomplete/jquery.autocomplete.localsearch":{deps:["jquery.autocomplete/jquery.autocomplete"],exports:"jQuery.fn.autocomplete.localsearch"},"lib/jquery.autocomplete.singletagselect.js":{deps:["jquery.autocomplete/jquery.autocomplete"],exports:"jQuery.fn.autocomplete.singletagselect"},customtip:{deps:["jquery","jquery-tools-tooltip"],exports:"jQuery.fn.customtip"},"lib/jquery.html2canvas.helper":{deps:["jquery","html2canvas"],exports:"jQuery.fn.takeScreenshot"},"jquery-tools-tooltip":{deps:["jquery"],exports:"jQuery.fn.tooltip"},"query.acify":{deps:["jquery"],exports:"jQuery.acify"},"leaflet-image":{deps:["mapbox"]},"leaflet-markercluster":{deps:["mapbox","css!vendor/leaflet.markercluster/0.4.0/dist/MarkerCluster.css","css!vendor/leaflet.markercluster/0.4.0/dist/MarkerCluster.Default.css"]},mapbox:{deps:["css!vendor/mapbox.js/2.1.8/mapbox.css","src/packages/leafletGlobals"],exports:"L"}},map:{"selleckt-legacy":{_:"underscore"}},packages:[{name:"modal",location:"vendor/modal/3.0.0/src"}]});define("src/main",["app"],function(app){"use strict";return app});define("src/ModuleWrapper",["underscore","jquery"],function(_,$){"use strict";var instanceSeq=0,moduleLoadCallbackQueues={};function wrapOnResourceLoad(){if(require.onResourceLoad&&require.onResourceLoad._wrapped){return}var originalOnResourceLoad=require.onResourceLoad;require.onResourceLoad=function(context,map){var name=map.originalName,module,callback;if(_.isEmpty(moduleLoadCallbackQueues)){return originalOnResourceLoad.apply(this,arguments)}_(moduleLoadCallbackQueues).forEach(function(queue,key){while(queue[name]&&queue[name].length){if(!module){module=require(name)}callback=queue[name].shift();try{callback(null,module)}catch(e){console.error("Error calling module callback",e)}}delete queue[name];if(_.isEmpty(queue)){delete moduleLoadCallbackQueues[key]}});if(originalOnResourceLoad){return originalOnResourceLoad.apply(this,arguments)}unwrapOnResourceLoadIfNecessary()};require.onResourceLoad._wrapped=true;require.onResourceLoad.restore=function(){require.onResourceLoad=originalOnResourceLoad}}function unwrapOnResourceLoadIfNecessary(){if(_.isEmpty(moduleLoadCallbackQueues)&&require.onResourceLoad&&require.onResourceLoad._wrapped){require.onResourceLoad.restore()}}function listenForModule(instance,name,callback){var waitingForResourceLoad=moduleLoadCallbackQueues[instance._id];if(!waitingForResourceLoad){waitingForResourceLoad=moduleLoadCallbackQueues[instance._id]={}}waitingForResourceLoad[name]=waitingForResourceLoad[name]||[];waitingForResourceLoad[name].push(callback);wrapOnResourceLoad()}function restoreModuleListeners(instance){delete moduleLoadCallbackQueues[instance._id];unwrapOnResourceLoadIfNecessary()}function wrapFunction(originalFunc,override){return function(){var boundOriginal,overrideArgs;boundOriginal=_(originalFunc).bind(this);overrideArgs=[boundOriginal].concat(Array.prototype.slice.call(arguments));return override.apply(this,overrideArgs)}}function ModuleWrapper(){this._id=(instanceSeq++).toString();this._originalAttributes=[];this._newAttributes=[]}ModuleWrapper.prototype.wrap=function(obj,key,override,namespace){if(!obj){throw new Error("Should wrap property of an object")}this._originalAttributes.push({obj:obj,key:key,val:obj[key],namespace:namespace});if(_(override).isFunction()){obj[key]=wrapFunction(obj[key],override);return}obj[key]=override};ModuleWrapper.prototype.defineProperty=function(obj,key,value){if(!obj){throw new Error("Should define property of an object")}if(!_.isUndefined(obj[key])){throw new Error('Property already exists - did you mean to use "wrap"?')}this._newAttributes.push({obj:obj,key:key});obj[key]=value};ModuleWrapper.prototype.backup=function(obj,key,context){var value,prop;if(!obj){throw new Error("Should backup property of an object")}if(!(key in obj)){throw new Error("Property "+key+" does not exist on "+obj)}prop=obj[key];if(_.isFunction(prop)){value=_.bind(obj[key],context||obj)}else if(_.isObject(prop)){value=$.extend(true,_.isArray(obj[key])?[]:{},obj[key])}else{value=obj[key]}this._originalAttributes.push({obj:obj,key:key,val:value})};ModuleWrapper.prototype.wrapModule=function(name,callback){if(!require.defined(name)){return listenForModule(this,name,callback)}var module=this.require(name);callback(null,module)};ModuleWrapper.prototype.restore=function(){this._originalAttributes=_(this._originalAttributes).reduce(function(memo,original){original.obj[original.key]=original.val;return memo},[]);this._newAttributes=_(this._newAttributes).reduce(function(memo,attr){delete attr.obj[attr.key];return memo},[]);restoreModuleListeners(this)};ModuleWrapper.prototype.require=require;return ModuleWrapper});define("src/helpers/uhdHelpers",["moment"],function(moment){"use strict";function getHistoricData(dataSource){var json;if(!dataSource){throw new Error("getHistoricData requires dataSource")}if(dataSource.backfillDetails){return dataSource.backfillDetails}if(dataSource.toJSON){json=dataSource.toJSON();if(json.backfillDetails){return json.backfillDetails}if(Array.isArray(json)&&json.length){return json[0].backfillDetails}}}function hasHistoricData(dataSource,rawStartDate){var startDate;var historicData;if(!dataSource){return false}if(!rawStartDate){throw new Error("hasHistoricData requires a valid startDate")}historicData=this.getHistoricData(dataSource);if(!historicData){return false}startDate=moment(rawStartDate);if(!startDate.isValid()){throw new Error("hasHistoricData requires a valid startDate")}return[].concat(historicData).some(function(query){return startDate.isBefore(query.backfillDate)})}return{getHistoricData:getHistoricData,hasHistoricData:hasHistoricData}});function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};var ownKeys=Object.keys(source);if(typeof Object.getOwnPropertySymbols==="function"){ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))}ownKeys.forEach(function(key){_defineProperty(target,key,source[key])})}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}define("src/componentDefinitions",[],function(){"use strict";var ComponentDefinitions=function(){function ComponentDefinitions(){_classCallCheck(this,ComponentDefinitions);this.spec={keyinsights:{componentName:"Key Insights",src:"src/components/keyinsights/KeyInsightsComponent"},topsites:{title:"Top Sites",src:"src/components/topsites/TopSitesComponent"},topauthors:{componentName:"Top Authors",src:"src/components/topauthors/TopAuthorsComponent"},toptweeters:{componentName:"Tweeters",src:"src/components/tweeters/TweetersComponent"},topics:{componentName:"Topics",src:"src/components/topics/TopicsComponent"},topicgrowthcomparison:{componentName:"Topic Growth Comparison",src:"src/components/topicgrowthcomparison/TopicGrowthComparisonComponent"},trendingtopics:{componentName:"Trending Topics",src:"src/components/trendingtopics/TrendingTopicsComponent"},chart:{componentName:"Chart",src:"src/components/chart/ChartComponent"},mentions:{componentName:"Mentions",src:"src/components/mentions/MentionsComponent"},history:{componentName:"History",src:"src/components/history/HistoryComponent"},historycomparison:{componentName:"Date Range Comparison",src:"src/components/historycomparison/HistoryComparisonComponent"},worldoverview:{componentName:"World Overview (Mentions Map)",src:"src/components/worldoverview/WorldOverviewComponent"},note:{componentName:"Note",src:"src/components/notes/NotesComponent"},videotracker:{componentName:"Video Tracker",src:"src/components/videotracker/VideoTrackerComponent"},emojis:{componentName:"Emojis",src:"src/components/emojis/EmojisComponent"},wordcloud:{componentName:"Word Cloud",src:"src/components/wordcloud/WordCloudComponent"},topicplot:{componentName:"Topic Plot",src:"src/components/topicplot/TopicPlotComponent"},topicwheel:{componentName:"Topics Wheel",info:"View the main and sub topics for the mentions that match your search "+"and segment using a number of pre-built parameters.",src:"src/components/topicwheel/TopicWheelComponent"},youtubeanalytics:{componentName:"YouTube Analytics",src:"src/components/youtubeanalytics/YoutubeAnalyticsComponent"},geotagged:{componentName:"Geotagged (Mentions Map)",src:"src/extensions/locations/components/GeotaggedComponent"},twitterinsights:{componentName:"Twitter Insights",src:"src/components/twitterinsights/TwitterInsightsComponent"},instagramcomments:{componentName:"Instagram Comments",src:"src/instagramchannel/components/comments/InstagramCommentsComponent"},instagramengagement:{componentName:"Instagram Engagement",src:"src/instagramchannel/components/engagement/InstagramEngagementComponent"},instagraminteractions:{componentName:"Instagram Interactions",src:"src/instagramchannel/components/interactions/InstagramInteractionsComponent"},instagramownerinsights:{componentName:"Instagram Owner Insights",src:"src/instagramchannel/components/ownerinsights/InstagramInsightsComponent"},instagramperformanceanalytics:{componentName:"Instagram Performance Analytics",src:"src/instagramchannel/components/performance/InstagramPerformanceAnalyticsComponent"},instagramposts:{componentName:"Instagram Posts",src:"src/instagramchannel/components/posts/InstagramPostsComponent"},instagramsummary:{componentName:"Instagram Summary",src:"src/instagramchannel/components/summary/InstagramSummaryComponent"},instagramtopposts:{componentName:"Instagram Top Posts",src:"src/instagramchannel/components/topposts/InstagramTopPostsComponent"},instagramtotalfollowers:{componentName:"Instagram Total Followers",src:"src/instagramchannel/components/totalfollowers/InstagramTotalFollowersComponent"},querygroupcomparison:{componentName:"Group Comparison",src:"src/components/querygroupcomparison/QueryGroupComparisonComponent"},relativesentimentsummary:{componentName:"Relative Sentiment Summary",src:"src/components/relativesentimentsummary/RelativeSentimentSummaryComponent"},grouptopicsoversitetype:{componentName:"Disabled Topics",src:"src/components/disabled/DisabledTopicsComponent"},headlines:{componentName:"Disabled Headlines",src:"src/components/disabled/DisabledHeadlinesComponent"},twitteranalytics:{componentName:"Twitter Analytics",src:"src/extensions/twitteranalytics/components/TwitterAnalyticsComponent"},twitterengagers:{componentName:"Twitter Audience",src:"src/extensions/twitteranalytics/components/TwitterEngagersComponent"},facebookanalytics:{componentName:"Facebook Analytics",src:"src/extensions/facebookanalytics/components/FacebookAnalyticsComponent"},facebookposts:{componentName:"Facebook Posts",src:"src/extensions/facebookanalytics/components/FacebookPostsComponent"},facebookcomments:{componentName:"Facebook Comments",src:"src/extensions/facebookanalytics/components/FacebookCommentsComponent"},facebookfans:{componentName:"Facebook Audience",src:"src/extensions/facebookanalytics/components/FacebookFansComponent"},imagewall:{componentName:"Image Wall",src:"src/components/imagewall/ImageWallComponent"},imageanalysis:{componentName:"Image Analysis",src:"src/components/imageanalysis/ImageAnalysisComponent"},benchmark:{componentName:"Benchmark",src:"src/components/benchmark/BenchmarkComponent"},youtubementions:{componentName:"YouTube Mentions",src:"src/components/youtubementions/YoutubeMentionsComponent"},topiccomparison:{componentName:"Twitter Topic Comparison",src:"src/components/topiccomparison/TopicComparisonComponent"},demographicsummary:{componentName:"Twitter Demographics",src:"src/extensions/demographicssummary/components/DemographicsSummaryComponent"},sentiment:{componentName:"Sentiment"},uniqueauthors:{componentName:"Unique Authors over Time"},pagetypes:{componentName:"Page Types over Time"},videoshares:{componentName:"Video Shares"},imagelabels:{componentName:"Image Labels",src:"src/components/imagelabels/ImageLabelsComponent"}}}_createClass(ComponentDefinitions,[{key:"getDefinition",value:function getDefinition(type){var definition=this.spec[type];if(!definition){return}return _objectSpread({type:type},definition)}}]);return ComponentDefinitions}();return new ComponentDefinitions});function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};var ownKeys=Object.keys(source);if(typeof Object.getOwnPropertySymbols==="function"){ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))}ownKeys.forEach(function(key){_defineProperty(target,key,source[key])})}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}define("src/helpers/componentEventsHelper",["src/analytics/Analytics","src/events/componentEvents","src/events/globalEventNames","src/globals/currentDashboard","src/globals/currentProject","src/globals/queries","src/globals/queryGroups","src/componentDefinitions"],function(Analytics,componentEvents,globalEventNames,currentDashboard,currentProject,queries,queryGroups,componentDefinitions){"use strict";var COMPONENT_EVENT_NAMES=globalEventNames.COMPONENTS;function getAppliedFilterNames(view){if(!view.controlsView||typeof view.controlsView.getAppliedFilterNames!=="function"){return[]}return view.controlsView.getAppliedFilterNames()}function getCustomizeSettings(component){if(typeof component.getCustomizeSettings==="function"){return component.getCustomizeSettings()}return{}}function getOrderBySettings(view){var orderBy=view.settings.get("orderBy");if(orderBy!=null){return{orderBy:orderBy}}return{}}function triggerComponentSettingsSetTrackingEvent(view,options){return componentEvents.trigger(COMPONENT_EVENT_NAMES.SETTINGS_SET,_objectSpread({componentName:view.componentName,currentViewKey:view.currentViewKey},options))}function triggerComponentLoadedTrackingEvent(view,options){var queryIds=view.settings.get("queryId");var queryGroupIsActive=view.settings.get("currentMode")==="queryGroup";if(queryGroupIsActive){queryIds=queryGroups.getQueryIdsFromGroupIds(view.settings.get("queryGroupId"))}var queryTypes=queries.getQueryTypesFromIds(queryIds);var opts=Object.assign({tabName:view.tabName,componentName:view.componentName,dashboardId:currentDashboard.id,dashboardType:currentDashboard.get("dashboardType"),projectId:currentProject.id,queryTypes:queryTypes,queryIds:queryIds,modifiedFilters:getAppliedFilterNames(view),insightsSidebarActive:!!view.insightsSidebarActive},options,getCustomizeSettings(view),getOrderBySettings(view));componentEvents.trigger(COMPONENT_EVENT_NAMES.COMPONENT_LOADED,opts)}function triggerComponentAddedTrackingEvent(type){var definition=componentDefinitions.getDefinition(type);Analytics.trackEvent({name:"Component."+definition.componentName,action:"Add",origin:"Application"});componentEvents.trigger(COMPONENT_EVENT_NAMES.COMPONENT_ADDED,{componentName:definition.componentName,dashboardId:currentDashboard.id,projectId:currentProject.id})}return{triggerComponentLoadedTrackingEvent:triggerComponentLoadedTrackingEvent,triggerComponentAddedTrackingEvent:triggerComponentAddedTrackingEvent,triggerComponentSettingsSetTrackingEvent:triggerComponentSettingsSetTrackingEvent}});define("src/globals/languages",["src/models/LanguageCollection","src/ApiError"],function(LanguageCollection,ApiError){"use strict";var fetchPromise,languages=new LanguageCollection;return{load:function load(callback){if(typeof callback!=="function"){throw new Error("Please supply a callback!")}if(!fetchPromise){fetchPromise=languages.fetch()}fetchPromise.then(function success(){callback(null,languages)},function error(xhr){callback(new ApiError(xhr))})},reset:function reset(){fetchPromise=null}}});define("src/models/ProfessionCollection",["backbone"],function(Backbone){"use strict";return Backbone.Collection.extend({url:"/authors/professions/",parse:function parse(data){return data.results}})});define("src/globals/professions",["src/models/ProfessionCollection","src/ApiError"],function(ProfessionCollection,ApiError){"use strict";var fetchPromise,professions=new ProfessionCollection;return{load:function load(callback){if(typeof callback!=="function"){throw new Error("Please supply a callback!")}if(!fetchPromise){fetchPromise=professions.fetch()}fetchPromise.then(function success(){callback(null,professions)},function error(xhr){callback(new ApiError(xhr))})},reset:function reset(){fetchPromise=null}}});define("src/models/InterestCollection",["backbone"],function(Backbone){"use strict";return Backbone.Collection.extend({url:"/authors/interests/",parse:function parse(data){return data.results}})});define("src/globals/interests",["src/models/InterestCollection","src/ApiError"],function(InterestCollection,ApiError){"use strict";var fetchPromise,interests=new InterestCollection;return{load:function load(callback){if(typeof callback!=="function"){throw new Error("Please supply a callback!")}if(!fetchPromise){fetchPromise=interests.fetch()}fetchPromise.then(function success(){callback(null,interests)},function error(xhr){callback(new ApiError(xhr))})},reset:function reset(){fetchPromise=null}}});define("src/controls/views/ControlsViewInputs",["backbone","underscore","jquery"],function(Backbone,_,$){"use strict";return Backbone.View.extend({constructor:function ControlsViewInputs(){Backbone.View.apply(this,arguments)},events:function events(){return{"blur input":"inputChanged","change select":"selectChanged"}},inputChanged:function inputChanged(){this.trigger("changesMade")},selectChanged:function selectChanged(){this.trigger("changesMade")},getValues:function getValues(){var m={};this.$("[name]").each(function(){var $el=$(this);var modelKey=$el.attr("name");if(_.isUndefined(m[modelKey])){m[modelKey]=$el.val()}});return m}})});(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define("selleckt",[],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.selleckt=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";var KEY_CODES={DOWN:40,UP:38,ENTER:13,ESC:27};module.exports=KEY_CODES},{}],2:[function(require,module,exports){"use strict";var MicroEvent=function(){};MicroEvent.prototype={on:function(event,fct){this._events=this._events||{};this._events[event]=this._events[event]||[];this._events[event].push(fct)},bind:function(){console.warn("SELLECKT: .bind() is deprecated. Use .on() instead.");this.on.apply(this,arguments)},off:function(event,fct){this._events=this._events||{};if(event in this._events===false){return}this._events[event].splice(this._events[event].indexOf(fct),1)},unbind:function(){console.warn("SELLECKT: .unbind() is deprecated. Use .off() instead.");this.off.apply(this,arguments)},trigger:function(event){this._events=this._events||{};if(event in this._events===false){return}for(var i=0;i<this._events[event].length;i++){this._events[event][i].apply(this,Array.prototype.slice.call(arguments,1))}}};MicroEvent.mixin=function(destObject){var props=["bind","on","unbind","off","trigger"];for(var i=0;i<props.length;i++){destObject.prototype[props[i]]=MicroEvent.prototype[props[i]]}};module.exports=MicroEvent},{}],3:[function(require,module,exports){(function(global){"use strict";var TEMPLATES=require("./TEMPLATES");var templateUtils=require("./templateUtils");var SingleSelleckt=require("./SingleSelleckt.js");var $=typeof window!=="undefined"?window["$"]:typeof global!=="undefined"?global["$"]:null;var _=typeof window!=="undefined"?window["_"]:typeof global!=="undefined"?global["_"]:null;var Mustache=typeof window!=="undefined"?window["Mustache"]:typeof global!=="undefined"?global["Mustache"]:null;function MultiSelleckt(options){var settings=_.defaults(options,{mainTemplate:TEMPLATES.MULTI,itemTemplate:TEMPLATES.MULTI_ITEM,selectionTemplate:TEMPLATES.MULTI_SELECTION,alternatePlaceholder:"Select another...",selectionsClass:"selections",selectionItemClass:"selectionItem",unselectItemClass:"unselect",showEmptyList:false,hideSelectedItem:true});this.mainTemplate=settings.mainTemplate;this.itemTemplate=settings.itemTemplate;this.selectionTemplate=settings.selectionTemplate;this.alternatePlaceholder=settings.alternatePlaceholder;this.selectionsClass=settings.selectionsClass;this.selectionItemClass=settings.selectionItemClass;this.unselectItemClass=settings.unselectItemClass;this.showEmptyList=settings.showEmptyList;this.hideSelectedItem=settings.hideSelectedItem;templateUtils.cacheTemplate(this.selectionTemplate);SingleSelleckt.call(this,settings)}MultiSelleckt.prototype=Object.create(SingleSelleckt.prototype);MultiSelleckt.prototype._mutationHandler=function(mutations){var newItems=[],removedItems=[],selectedItems=[];_.forEach(mutations,function(mutation){newItems=newItems.concat(this._getItemsFromNodes(mutation.addedNodes));removedItems=removedItems.concat(this._getItemsFromNodes(mutation.removedNodes))},this);this.items=this.items.concat(newItems);if(removedItems.length){_.forEach(removedItems,function(item){this.unselectItem(item,{silent:true})},this);this.items=_.reject(this.items,function(item){return _.any(removedItems,function(removedItem){return removedItem.value===item.value})})}_.forEach(this.items,function(item){if(item.isSelected){this.selectItem(item,{silent:true});selectedItems.push(item)}},this);this.trigger("itemsUpdated",{items:this.items,newItems:newItems,removedItems:removedItems,selectedItems:selectedItems})};MultiSelleckt.prototype._filterSelection=function(items,selection){var selectionValues=_.pluck(selection,"value");return _.filter(items,function(item){return selectionValues.indexOf(item.value)===-1})};MultiSelleckt.prototype.selectItem=function(item,options){options=options||{};if(!this.selectedItems){this.selectedItems=[]}if(_(this.selectedItems).indexOf(item)!==-1){return}this.selectedItems.push(item);this.$selections.append(this.buildItem(item));this.$sellecktEl.find("."+this.selectedTextClass).text(this.alternatePlaceholder);this.toggleDisabled();if(!options.silent){this.updateOriginalSelect();this.trigger("itemSelected",item)}};MultiSelleckt.prototype.updateOriginalSelect=function(){this.$originalSelectEl.val(_(this.getSelection()).map(function(item){return item.value})).trigger("change",{origin:"selleckt"})};MultiSelleckt.prototype.updateSelection=function(newSelection){var self=this,currentSelection=_(this.getSelection()).pluck("value"),itemsToAdd=_.difference(newSelection,currentSelection),itemsToRemove=_.difference(currentSelection,newSelection);_(itemsToAdd).each(function(value){self.selectItem(self.findItem(value))});_(itemsToRemove).each(function(value){self.unselectItem(self.findItem(value))})};MultiSelleckt.prototype.getSelection=function(){return this.selectedItems};MultiSelleckt.prototype.getTemplateData=function(){var data=SingleSelleckt.prototype.getTemplateData.call(this);return _.extend(data,{selectionsClass:this.selectionsClass})};MultiSelleckt.prototype.parseItems=function($selectEl){var itemsObj=this._parseItemsFromOptions($selectEl);this.items=itemsObj.items;this.selectedItems=itemsObj.selectedItems};MultiSelleckt.prototype.getItemsForPopup=function(){var showSelectedItem=!this.hideSelectedItem;var selectedValues=_.map(this.selectedItems,function(item){return item.value});return showSelectedItem?this.items:_.filter(this.items,function(item){return _.indexOf(selectedValues,item.value)===-1},this)};MultiSelleckt.prototype.render=function(){SingleSelleckt.prototype.render.call(this);var $selections=this.$selections=this.$sellecktEl.find("."+this.selectionsClass),$selectionItems=$("<div>");_(this.getSelection()).each(function(item){$selectionItems.append(this.buildItem(item))},this);$selections.html($selectionItems.children())};MultiSelleckt.prototype.bindEvents=function(){var unselectItem=_.bind(this.unselectItem,this),selectionItemClass=this.selectionItemClass;this.$sellecktEl.on("click","."+this.unselectItemClass,function(e){e.preventDefault();e.stopPropagation();var $item=$(e.target).closest("."+selectionItemClass);unselectItem($item.data("item"))});SingleSelleckt.prototype.bindEvents.call(this)};MultiSelleckt.prototype.getItemTemplateData=function(item){return{text:item.label,value:item.value,selectionItemClass:this.selectionItemClass,unselectItemClass:this.unselectItemClass,data:item.data}};MultiSelleckt.prototype.buildItem=function(item){var rendered=Mustache.render(this.selectionTemplate,this.getItemTemplateData(item),{item:this.itemTemplate}),$html=$(rendered);return $html.data("item",item)};MultiSelleckt.prototype.unselectItem=function(item,options){options=options||{};this.$selections.find('[data-value="'+item.value+'"]').remove();this.selectedItems=_(this.selectedItems).reject(function(candidate){return candidate===item});if(!this.selectedItems.length){this.$sellecktEl.find("."+this.selectedTextClass).text(this.placeholderText)}this.toggleDisabled();this._refreshPopupWithSearchHits(this.defaultSearchTerm);if(!options.silent){this.updateOriginalSelect();this.trigger("itemUnselected",item)}};MultiSelleckt.prototype.toggleDisabled=function(){var $sellecktEl=this.$sellecktEl,noItemsLeft=this.selectedItems.length===this.items.length;$sellecktEl.toggleClass("noitems",noItemsLeft);$sellecktEl.toggleClass("disabled",noItemsLeft&&!this.showEmptyList)};module.exports=MultiSelleckt}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./SingleSelleckt.js":5,"./TEMPLATES":6,"./templateUtils":9}],4:[function(require,module,exports){(function(global){"use strict";var KEY_CODES=require("./KEY_CODES");var TEMPLATES=require("./TEMPLATES");var templateUtils=require("./templateUtils");var $=typeof window!=="undefined"?window["$"]:typeof global!=="undefined"?global["$"]:null;var _=typeof window!=="undefined"?window["_"]:typeof global!=="undefined"?global["_"]:null;var Mustache=typeof window!=="undefined"?window["Mustache"]:typeof global!=="undefined"?global["Mustache"]:null;var MicroEvent=require("./MicroEvent");function createPopup(){return $("<div>",{class:"sellecktPopup selleckt"})}function attachPopup($popup,$attachTarget){$attachTarget.find(".sellecktPopup").remove();$popup.appendTo($attachTarget)}function SellecktPopup(options){var settings=_.defaults(options||{},{template:TEMPLATES.ITEMS_CONTAINER,itemTemplate:TEMPLATES.SINGLE_ITEM,templateData:{},itemsClass:"items",itemslistClass:"itemslist",itemClass:"item",itemTextClass:"itemText",highlightClass:"highlighted",searchInputClass:"search",showSearch:false,defaultSearchTerm:"",maxHeightPopupPositioning:false});this.template=settings.template;this.templateData=settings.templateData;this.itemTemplate=settings.itemTemplate;this.itemsClass=settings.itemsClass;this.itemslistClass=settings.itemslistClass;this.itemClass=settings.itemClass;this.itemTextClass=settings.itemTextClass;this.highlightClass=settings.highlightClass;this.searchInputClass=settings.searchInputClass;this.showSearch=settings.showSearch;this.defaultSearchTerm=settings.defaultSearchTerm;this.maxHeightPopupPositioning=settings.maxHeightPopupPositioning;templateUtils.cacheTemplate(this.template);templateUtils.cacheTemplate(this.itemTemplate)}_.extend(SellecktPopup.prototype,{open:function($opener,items,options){options=options||{};var $popup=this.$popup=createPopup();var $input;if(options.css){$popup.css(options.css)}this.$opener=$opener;this.renderItems(items);attachPopup($popup,$("body"));this._positionPopup($opener);this.bindEvents();this._attachResizeHandler($opener);$input=$popup.find("."+this.searchInputClass);if(this.showSearch&&$input.length){$input.val(this.defaultSearchTerm).get(0).select()}else{$popup.find("."+this.itemClass).first().attr("tabindex",-1).focus()}},close:function(){this._removeResizeHandler();this.$opener=undefined;if(this.$popup){this.$popup.remove();this.$popup=undefined;this.trigger("close")}},getTemplateData:function(){return _.extend(this.templateData,{showSearch:this.showSearch,itemsClass:this.itemsClass,itemslistClass:this.itemslistClass,itemClass:this.itemClass,itemTextClass:this.itemTextClass,searchInputClass:this.searchInputClass})},renderItems:function(items){var templateData=_.extend({items:items},this.getTemplateData()),rendered=Mustache.render(this.template,templateData,{item:this.itemTemplate});this.$popup.html(rendered)},refreshItems:function(items){var $rendered=_.map(items,function(item){var itemEl=Mustache.render(this.itemTemplate,_.extend({itemTextClass:this.itemTextClass,itemClass:this.itemClass},item));if(item.matchEnd>0){return this._addMarkToItem(itemEl,item)}return itemEl},this);this.$popup.find("."+this.itemslistClass).html($rendered);this.$popup.toggleClass("noitems",!items.length);if(this.$popup.hasClass("flipped")){this._positionPopup(this.$opener,{keepCurrentOrientation:true})}},_addMarkToItem:function(itemEl,item){var $itemEl=$(itemEl),$textContainer=$itemEl.find("."+this.itemTextClass),markStart="<mark>",markEnd="</mark>",html;html=_.escape(item.label.substring(0,item.matchStart))+markStart+_.escape(item.label.slice(item.matchStart,item.matchEnd+1))+markEnd+_.escape(item.label.substring(item.matchEnd+1));$textContainer.html(html);return $itemEl},bindEvents:function(){var self=this,lockMousover=false,highlightClass=this.highlightClass,itemClass="."+this.itemClass,itemslistClass="."+this.itemslistClass,$popup=this.$popup,itemslist=$popup.find(itemslistClass)[0],trigger=_.bind(this.trigger,this),searchInputClass="."+this.searchInputClass,$searchInput;function getHighlightItem(){return $popup.find("."+highlightClass)}function highlightItem($item){$popup.find(itemClass).removeClass(highlightClass);$item.addClass(highlightClass).attr("tabindex",-1).focus()}function selectItem($target){trigger("valueSelected",$target.attr("data-value"));self.close()}function scrollItems(offset,absolute){lockMousover=true;if(absolute){itemslist.scrollTop=offset}else{itemslist.scrollTop+=offset}_.delay(function(){lockMousover=false},200)}$popup.on("mouseover",itemClass,function(e){if(lockMousover){return}highlightItem($(e.currentTarget))});$popup.on("click",itemClass,function(e){e.preventDefault();return selectItem($(e.currentTarget))});$popup.on("keydown",itemClass,function(e){var whichKey=e.which,$currentHighlightItem,$theItems,$itemToHighlight;if(whichKey!==KEY_CODES.DOWN&&whichKey!==KEY_CODES.UP&&whichKey!==KEY_CODES.ENTER&&whichKey!==KEY_CODES.ESC){return}e.preventDefault();if(e.which===KEY_CODES.ESC){return self.close()}$currentHighlightItem=getHighlightItem();if(e.which===KEY_CODES.ENTER){return selectItem($currentHighlightItem)}$theItems=$popup.find(itemClass);if(whichKey===KEY_CODES.DOWN){$itemToHighlight=$currentHighlightItem.nextAll(itemClass).first();if(!$currentHighlightItem.length||!$itemToHighlight.length){$itemToHighlight=$theItems.first();scrollItems(0,true)}else if($itemToHighlight.offset().top+$itemToHighlight.outerHeight()>$popup.offset().top+$popup.outerHeight()){scrollItems($itemToHighlight.outerHeight())}return highlightItem($itemToHighlight)}if(whichKey===KEY_CODES.UP){$itemToHighlight=$currentHighlightItem.prevAll(itemClass).first();if(!$currentHighlightItem.length||!$itemToHighlight.length){$itemToHighlight=$theItems.last();scrollItems($itemToHighlight.offset().top,true)}else if($itemToHighlight.offset().top<$popup.offset().top+$itemToHighlight.outerHeight()){scrollItems(-$itemToHighlight.outerHeight())}return highlightItem($itemToHighlight)}});if(this.showSearch){$searchInput=$popup.find(searchInputClass);$searchInput.on("keydown",function(e){var whichKey=e.which;if(whichKey===KEY_CODES.ESC){return self.close()}if(whichKey===KEY_CODES.DOWN){e.stopPropagation();e.preventDefault();return highlightItem($popup.find(itemClass).first())}});$searchInput.on("keyup",_.debounce(function(e){var whichKey=e.which;if(whichKey===KEY_CODES.ESC||whichKey===KEY_CODES.ENTER){return}var term=$searchInput.val();trigger("search",term)}))}$popup.on("click",function(e){var $target=$(e.target);e.stopPropagation();if($target.is(itemClass)||$target.is(searchInputClass)){return}self.close()})},_getPopupMaxHeight:function(){var $itemsList;if(!this.maxHeightPopupPositioning){return this.$popup.outerHeight()}$itemsList=this.$popup.find("."+this.itemslistClass);return this.$popup.outerHeight()+parseInt($itemsList.css("max-height"),10)-$itemsList.height()},_canShowBelow:function(options,openerHeight,openerOffset){var $window=$(window),popupMaxHeight=this._getPopupMaxHeight(),windowHeight=$window.height(),windowScrollTop=$window.scrollTop(),viewportBottom=windowScrollTop+windowHeight,enoughRoomBelow=viewportBottom>openerOffset.top+openerHeight+popupMaxHeight,enoughRoomAbove=openerOffset.top>=popupMaxHeight;if(!enoughRoomAbove){enoughRoomBelow=true}return enoughRoomBelow&&!(options.keepCurrentOrientation&&this.$popup.hasClass("flipped"))},_positionPopup:function($opener,options){options=options||{};var popupHeight=this.$popup.outerHeight(),openerHeight=$opener.outerHeight(),openerOffset=$opener.offset(),showBelow=this._canShowBelow(options,openerHeight,openerOffset),css={position:"absolute",left:openerOffset.left,top:showBelow?openerOffset.top+openerHeight:openerOffset.top-popupHeight};this.$popup.css(css);if(options.keepCurrentOrientation!==true){this.$popup.toggleClass("flipped",!showBelow)}},_attachResizeHandler:function($opener){var $popup=this.$popup,positionPopup=_.bind(this._positionPopup,this);this.resizeHandler=_.throttle(function(){positionPopup($opener,$popup)},20);$(window).on("resize",this.resizeHandler)},_removeResizeHandler:function(){if(this.resizeHandler){$(window).off("resize",this.resizeHandler);this.resizeHandler=undefined}}});MicroEvent.mixin(SellecktPopup);module.exports=SellecktPopup}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./KEY_CODES":1,"./MicroEvent":2,"./TEMPLATES":6,"./templateUtils":9}],5:[function(require,module,exports){(function(global){"use strict";var KEY_CODES=require("./KEY_CODES");var TEMPLATES=require("./TEMPLATES");var templateUtils=require("./templateUtils");var SellecktPopup=require("./SellecktPopup");var $=typeof window!=="undefined"?window["$"]:typeof global!=="undefined"?global["$"]:null;var _=typeof window!=="undefined"?window["_"]:typeof global!=="undefined"?global["_"]:null;var Mustache=typeof window!=="undefined"?window["Mustache"]:typeof global!=="undefined"?global["Mustache"]:null;var MicroEvent=require("./MicroEvent");function SingleSelleckt(options){var settings=_.defaults(options,{mainTemplate:TEMPLATES.SINGLE,itemTemplate:TEMPLATES.SINGLE_ITEM,popupTemplate:TEMPLATES.ITEMS_CONTAINER,mainTemplateData:{},popupTemplateData:{},selectedClass:"selected",selectedTextClass:"selectedText",className:"dropdown selleckt",placeholderText:"Please select...",highlightClass:"highlighted",enableSearch:false,searchInputClass:"search",searchThreshold:0,defaultSearchTerm:"",hideSelectedItem:false,maxHeightPopupPositioning:false});this.$originalSelectEl=options.$selectEl;this.mainTemplate=settings.mainTemplate;this.itemTemplate=settings.itemTemplate;this.popupTemplate=settings.popupTemplate;this.mainTemplateData=settings.mainTemplateData;this.popupTemplateData=settings.popupTemplateData;this.selectedClass=settings.selectedClass;this.selectedTextClass=settings.selectedTextClass;this.className=settings.className;this.placeholderText=settings.placeholderText;this.highlightClass=settings.highlightClass;this.itemsClass=settings.itemsClass;this.itemslistClass=settings.itemslistClass;this.itemClass=settings.itemClass;this.itemTextClass=settings.itemTextClass;this.searchInputClass=settings.searchInputClass;this.parseItems(this.$originalSelectEl);this.showSearch=settings.enableSearch&&this.items.length>settings.searchThreshold;this.defaultSearchTerm=settings.defaultSearchTerm;this.hideSelectedItem=settings.hideSelectedItem;this.maxHeightPopupPositioning=settings.maxHeightPopupPositioning;this.id=_.uniqueId("selleckt");templateUtils.cacheTemplate(this.mainTemplate)}function closeEventHandler(context,event){var eventTrigger=$(event.target).closest("."+context.selectedClass)[0];var dropdownTrigger=context.$sellecktEl.find("."+context.selectedClass)[0];var $popup=context.popup&&context.popup.$popup;if(eventTrigger===dropdownTrigger&&event.currentTarget===document){return}var anyParentIsPopup=$popup&&_.any($(event.target).parents(),function(parent){return $(parent).is($popup)});if(anyParentIsPopup){return}context._close()}SingleSelleckt.prototype.DELAY_TIMEOUT=0;_.extend(SingleSelleckt.prototype,{_open:function(){var $sellecktEl=this.$sellecktEl;if($sellecktEl.hasClass("disabled")){return}if(this.popup){return}this.popup=this._makePopup();if(this.defaultSearchTerm){this._refreshPopupWithSearchHits(this.defaultSearchTerm)}$sellecktEl.addClass("open").removeClass("closed");$(document).off("click.selleckt-"+this.id).on("click.selleckt-"+this.id,_.bind(closeEventHandler,this,this));$("body").addClass("no-scroll")},_close:function(){$(document).off("click.selleckt-"+this.id);this.$sellecktEl.removeClass("open").addClass("closed");this._removePopup();this.trigger("close");$("body").removeClass("no-scroll")},_removePopup:function(){if(this.popup){this.popup.off("valueSelected",this.onPopupValueSelected);this.popup.close();this.popup=undefined}},getItemsForPopup:function(){var showSelectedItem=!this.hideSelectedItem;var itemsToShow=showSelectedItem?this.items:_.filter(this.items,function(item){return this.selectedItem!==item},this);return itemsToShow},_makePopup:function(){var popup=new SellecktPopup({template:this.popupTemplate,templateData:this.popupTemplateData,itemTemplate:this.itemTemplate,itemsClass:this.itemsClass,itemslistClass:this.itemslistClass,itemClass:this.itemClass,itemTextClass:this.itemTextClass,searchInputClass:this.searchInputClass,showSearch:this.showSearch,defaultSearchTerm:this.defaultSearchTerm,maxHeightPopupPositioning:this.maxHeightPopupPositioning});var popupOptions={css:{minWidth:this.$sellecktEl.outerWidth()+"px"}};popup.open(this.$sellecktEl.find("."+this.selectedClass),this.getItemsForPopup(),popupOptions);popup.on("close",_.bind(this._onPopupClose,this));popup.on("valueSelected",_.bind(this._onPopupValueSelected,this));popup.on("search",_.bind(this._refreshPopupWithSearchHits,this));this.trigger("onPopupCreated",popup);return popup},_onPopupClose:function(){if(this.$sellecktEl.hasClass("open")){this._close()}this.$sellecktEl.attr("tabindex",-1).focus()},_onPopupValueSelected:function(value){var item=this.findItem(value);this.selectItem(item)},_filterItems:function(items,term){var matchTerm,reduced;if(!term){return items}matchTerm=term.toLowerCase();reduced=_.reduce(items,function(memo,item){var matchIndex;var group="byName";var matchStart;var matchEnd;if(!item.value){return memo}matchIndex=item.label.toLowerCase().indexOf(matchTerm);matchStart=matchIndex;matchEnd=matchIndex+(term.length-1);if(matchIndex===-1&&item.aliases&&item.aliases.length>0){matchIndex=_.reduce(item.aliases,function(index,alias){if(index===-1){return String(alias).toLowerCase().indexOf(matchTerm)}else{return index}},-1);if(matchIndex!==-1){group="byAlias";matchStart=matchEnd=-1}}if(matchIndex!==-1){memo[group].push(_.extend({},item,{matchStart:matchStart,matchEnd:matchEnd}))}return memo},{byName:[],byAlias:[]});return reduced.byName.concat(reduced.byAlias)},_filterSelection:function(items,selection){return _.filter(items,function(item){return item.value!==selection.value})},_refreshPopupWithSearchHits:function(term){var matchingItems=this._filterItems(this.items,term);var hideSelectedItem=this.hideSelectedItem;var selectedItem=this.getSelection();var itemsToShow;if(selectedItem&&hideSelectedItem){itemsToShow=this._filterSelection(matchingItems,selectedItem)}else{itemsToShow=matchingItems}this.defaultSearchTerm=term;if(this.popup){this.popup.refreshItems(itemsToShow)}this.trigger("optionsFiltered",term)},_parseItemsFromOptions:function($selectEl){return _.reduce($selectEl.find("option"),function(memo,option){var $option=$(option),data=$option.data(),item={value:$option.val(),label:$option.text(),data:data};if(data&&data.aliases){item.aliases=data.aliases.split(",")}if(item.value&&item.label){memo.items.push(item);if($option.prop("selected")){memo.selectedItems.push(item)}}return memo},{items:[],selectedItems:[]})},_createOptionFromItem:function(item){var $option=$("<option>",{selected:item.isSelected,value:item.value,text:item.label});if(item.data){Object.keys(item.data).forEach(function(key){var val=item.data[key];var attrVal=_.isArray(val)?val.join(","):val;$option.attr("data-"+key,attrVal)})}return $option},_getItemsFromNodes:function(nodeList){return _.map(nodeList,function(node){var aliases=$(node).attr("data-aliases");var item={value:node.value,label:node.text,isSelected:node.selected||undefined};if(aliases){item.aliases=aliases.split(",")}return item})},_mutationHandler:function(mutations){var newItems=[],removedItems=[],selectedItems=[];_.forEach(mutations,function(mutation){newItems=newItems.concat(this._getItemsFromNodes(mutation.addedNodes));removedItems=removedItems.concat(this._getItemsFromNodes(mutation.removedNodes))},this);this.items=this.items.concat(newItems);if(removedItems.length){this.items=_.reject(this.items,function(item){return _.any(removedItems,function(removedItem){return removedItem.value===item.value})})}_.forEach(this.items,function(item){if(item.isSelected){this.selectItem(item,{silent:true});selectedItems.push(item)}},this);if(!selectedItems.length){this.selectedItem=undefined;if(this.$sellecktEl){this.$sellecktEl.find("."+this.selectedTextClass).text(this.placeholderText)}}this.trigger("itemsUpdated",{items:this.items,newItems:newItems,removedItems:removedItems,selectedItems:selectedItems})},_observeMutations:function(element){var mutationHandler=_.bind(this._mutationHandler,this);var observer=this.mutationObserver=new MutationObserver(mutationHandler);observer.observe(element,{childList:true,attributes:false,characterData:false,subtree:false,attributeOldValue:false,characterDataOldvalue:false})},_stopObservingMutations:function(){this.mutationObserver.disconnect()},bindEvents:function(){var self=this,$sellecktEl=this.$sellecktEl,$originalSelectEl=this.$originalSelectEl,$selected=$sellecktEl.find("> ."+this.selectedClass);$sellecktEl.on("keydown",function(e){var whichKey=e.which;if(whichKey===KEY_CODES.ENTER){self._open()}});$selected.on("click",function(){self.$sellecktEl.focus();if($sellecktEl.hasClass("open")){return self._close()}self._open()});$originalSelectEl.on("change.selleckt",function(e,data){if(data&&data.origin==="selleckt"){return}var newSelection=$(e.target).val();self.updateSelection(newSelection);e.stopImmediatePropagation()})},parseItems:function($selectEl){var itemsObj=this._parseItemsFromOptions($selectEl);this.items=itemsObj.items;if(itemsObj.selectedItems[0]){this.selectItem(itemsObj.selectedItems[0],{silent:true})}},findItem:function(value){return _(this.items).find(function(item){return item.value==value})},selectItem:function(item,options){var $sellecktEl=this.$sellecktEl,displayedLabel=item&&item.label||this.placeholderText;item=item||{};options=options||{};if(item===this.selectedItem){return}if($sellecktEl){$sellecktEl.find("."+this.selectedTextClass).text(displayedLabel)}this.selectedItem=item;if(!options.silent){this.$originalSelectEl.val(item.value).trigger("change",{origin:"selleckt"});this.trigger("itemSelected",item)}},selectItemByValue:function(value,options){var item=this.findItem(value);if(!item){return}this.selectItem(item,options)},updateSelection:function(newSelection){this.selectItem(this.findItem(newSelection))},getSelection:function(){return this.selectedItem},getTemplateData:function(){var selectedItem=this.getSelection();return _.extend(this.mainTemplateData,{showSearch:this.showSearch,selectedItemText:selectedItem&&selectedItem.label||this.placeholderText,className:this.className,selectedClass:this.selectedClass,selectedTextClass:this.selectedTextClass})},addItems:function(items){this._stopObservingMutations();var $options=_.map(items,function(item){return this._createOptionFromItem(item)},this);this.$originalSelectEl.append($options);this.items=this.items.concat(items);_.forEach(items,function(item){if(item.isSelected){this.selectItem(item)}},this);this._observeMutations(this.$originalSelectEl[0])},addItem:function(item){this._stopObservingMutations();this._createOptionFromItem(item).appendTo(this.$originalSelectEl);this.items.push(item);if(item.isSelected){this.selectItem(item)}this._observeMutations(this.$originalSelectEl[0])},removeItem:function(value){this._stopObservingMutations();this.$originalSelectEl.find('option[value="'+value+'"]').remove();this.items=_.filter(this.items,function(item){return value!==item.value});if(this.selectedItem.value===value){if(this.$sellecktEl){this.$sellecktEl.find("."+this.selectedTextClass).text(this.placeholderText)}this.selectedItem=undefined}this._observeMutations(this.$originalSelectEl[0])},render:function(){var templateData=this.getTemplateData(),$originalSelectEl=this.$originalSelectEl,rendered=Mustache.render(this.mainTemplate,templateData),$sellecktEl=this.$sellecktEl=$(rendered).addClass("closed");$originalSelectEl.hide().before($sellecktEl);this.bindEvents();this._observeMutations($originalSelectEl[0])},destroy:function(){if(!this.$sellecktEl){return}this._removePopup();this._stopObservingMutations();$(document).off("click.selleckt-"+this.id);this.$sellecktEl.off().remove();this.$originalSelectEl.off("change.selleckt");this.$originalSelectEl.removeData("selleckt").show()}});MicroEvent.mixin(SingleSelleckt);module.exports=SingleSelleckt}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./KEY_CODES":1,"./MicroEvent":2,"./SellecktPopup":4,"./TEMPLATES":6,"./templateUtils":9}],6:[function(require,module,exports){"use strict";var TEMPLATES={SINGLE:'<div class="{{className}}" tabindex=1>'+'<div class="{{selectedClass}}">'+'<span class="{{selectedTextClass}}">{{selectedItemText}}</span><i class="icon-arrow-down"></i>'+"</div>"+"</div>",SINGLE_ITEM:'<li class="{{itemClass}}" data-text="{{label}}" data-value="{{value}}">'+'<span class="{{itemTextClass}}">{{label}}</span>'+"</li>",MULTI:'<div class="{{className}}" tabindex=1>'+'<ul class="{{selectionsClass}}">'+"{{#selections}}"+"{{/selections}}"+"</ul>"+'<div class="{{selectedClass}}">'+'<span class="{{selectedTextClass}}">{{selectedItemText}}</span><i class="icon-arrow-down"></i>'+"</div>"+"</div>",MULTI_ITEM:'<li class="{{itemClass}}" data-text="{{label}}" data-value="{{value}}">'+"{{label}}"+"</li>",MULTI_SELECTION:'<li class="{{selectionItemClass}}" data-value="{{value}}">'+'{{text}}<i class="icon-remove {{unselectItemClass}}"></i>'+"</li>",ITEMS_CONTAINER:'<div class="{{itemsClass}}">'+"{{#showSearch}}"+'<div class="searchContainer">'+'<input class="{{searchInputClass}}"></input>'+"</div>"+'<span class="noitemsText">No items</span>'+"{{/showSearch}}"+'<ul class="{{itemslistClass}}">'+"{{#items}}"+"{{> item}}"+"{{/items}}"+"</ul>"+"</div>"};module.exports=TEMPLATES},{}],7:[function(require,module,exports){"use strict";var SingleSelleckt=require("./SingleSelleckt");var MultiSelleckt=require("./MultiSelleckt");var SellecktPopup=require("./SellecktPopup");var templateUtils=require("./templateUtils");var jqueryPlugin=require("./sellecktJqueryPlugin");var selleckt={create:function(options){var Super=!!options.multiple?MultiSelleckt:SingleSelleckt,o=Object.create(Super.prototype);Super.call(o,options);return o},SingleSelleckt:SingleSelleckt,MultiSelleckt:MultiSelleckt,SellecktPopup:SellecktPopup,templateUtils:templateUtils};jqueryPlugin.mixin(selleckt);module.exports=selleckt},{"./MultiSelleckt":3,"./SellecktPopup":4,"./SingleSelleckt":5,"./sellecktJqueryPlugin":8,"./templateUtils":9}],8:[function(require,module,exports){(function(global){"use strict";var $=typeof window!=="undefined"?window["$"]:typeof global!=="undefined"?global["$"]:null;var _=typeof window!=="undefined"?window["_"]:typeof global!=="undefined"?global["_"]:null;module.exports={mixin:function(selleckt){$.fn.selleckt=function(options){options=options||{};return this.each(function(){var $self=$(this),sellecktPlugin=$self.data("selleckt"),settings=_.extend({$selectEl:$self,multiple:!!$self.attr("multiple")},options);if(sellecktPlugin){return}sellecktPlugin=selleckt.create(settings);$self.data("selleckt",sellecktPlugin);sellecktPlugin.render()})}}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],9:[function(require,module,exports){(function(global){"use strict";var Mustache=typeof window!=="undefined"?window["Mustache"]:typeof global!=="undefined"?global["Mustache"]:null;module.exports={cacheTemplate:function(template){if(typeof template!=="string"){throw new Error("Please provide a valid mustache template.")}Mustache.parse(template)}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}]},{},[7])(7)});define("modal/arrowDimensions",[],function(){"use strict";return{calculate:function(){var arrow=document.querySelector(".modal-arrow");if(!arrow){throw new Error("No modal arrow to calculate size of.")}var style=window.getComputedStyle(document.querySelector(".modal-arrow"));var transformString=style.transform||style.webkitTransform||style.mozTransform||style.msTransform;var width=parseInt(style.width,10)||0;var height=parseInt(style.height,10)||0;if(!transformString||transformString==="none"){return{height:height,width:width}}var transform=transformString.split("(")[1].split(")")[0].split(",").map(parseFloat);return{height:Math.round(height*transform[0]+width*transform[1]),width:Math.round(height*transform[1]+width*transform[0])}}}});define("modal/positioning",["./arrowDimensions"],function(arrowDimensions){"use strict";function absolute(modal,position){var width=modal.clientWidth+"px";var height=modal.clientHeight+"px";modal.style.position="absolute";modal.style.margin=0;modal.style.width=width;modal.style.height=height;modal.style.top=Math.floor(position.top)+"px";modal.style.left=Math.floor(position.left)+"px"}function positionAbove(modal,node){var nodeRect=node.getBoundingClientRect();var arrowDims=arrowDimensions.calculate();var leftBoundary=document.documentElement.clientWidth-modal.offsetWidth;var leftPosition=nodeRect.left+document.body.scrollLeft-(modal.offsetWidth-node.offsetWidth)/2;var topPosition=nodeRect.top+document.body.scrollTop-(modal.offsetHeight+arrowDims.height/2);absolute(modal,{left:Math.max(Math.min(leftPosition,leftBoundary),0),top:Math.max(topPosition,0)})}function positionRight(modal,node){var nodeRect=node.getBoundingClientRect();var arrowDims=arrowDimensions.calculate();var leftPosition=nodeRect.left+document.body.scrollLeft+node.offsetWidth+Math.floor(arrowDims.width/2);var topPosition=nodeRect.top+document.body.scrollTop+Math.floor(node.offsetHeight/2-modal.offsetHeight/2);absolute(modal,{left:Math.max(leftPosition,0),top:Math.max(topPosition,0)})}function fitsAbove(modal,node){var totalModalHeight=modal.offsetHeight+arrowDimensions.calculate().height/2;var nodeRect=node.getBoundingClientRect();var nodeOffsetTop=nodeRect.top+document.body.scrollTop;return totalModalHeight<=nodeOffsetTop}function fitsRight(modal,node){var totalModalWidth=modal.offsetWidth+arrowDimensions.calculate().width/2;var nodeRect=node.getBoundingClientRect();var nodeOffsetLeft=nodeRect.left+document.body.scrollLeft;var offsetRight=nodeOffsetLeft+node.offsetWidth;return totalModalWidth+offsetRight<=document.documentElement.clientWidth}return{positionAbove:positionAbove,positionRight:positionRight,fitsAbove:fitsAbove,fitsRight:fitsRight}});define("modal/main",["./positioning"],function(positioning){"use strict";var modal;var content;var callback;var options;function createOverlay(options){var background=document.createElement("div");background.setAttribute("id","modal-background");background.className=options.className;background.innerHTML='<div id="modal-content" class="popup"><div class="container"></div></div>';if(options.hideClose){return background}var closeButton=document.createElement("a");closeButton.className="btn-close";closeButton.innerHTML="<span>&#10799;</span>";background.firstChild.appendChild(closeButton);return background}function openModal(cont,opts,cb){if(opts){options={className:opts.className||"",closeOnEsc:opts.hasOwnProperty("closeOnEsc")?opts.closeOnEsc:true,closeOnClick:opts.hasOwnProperty("closeOnClick")?opts.closeOnClick:true,hideClose:opts.hideClose}}else{options={classNames:"",closeOnEsc:true,closeOnClick:true}}if(content){closeModal()}var overlay=createOverlay(options);overlay.querySelector("#modal-content .container").appendChild(cont);content=cont;callback=cb;document.body.appendChild(overlay);modal=document.getElementById("modal-content");attachEvents();return modal}function closeModal(){if(callback){callback(content)}content=undefined;callback=undefined;var modalBackground=modal&&modal.parentElement;if(!modalBackground||!modalBackground.parentElement){return}modalBackground.parentNode.removeChild(modalBackground);detachEvents()}function closeModalOnEsc(e){if(options.closeOnEsc&&e.keyCode===27){closeModal()}}function closeModalOnClick(e){if(options.closeOnClick&&e.target===e.currentTarget){closeModal()}}function attachEvents(){var button=modal.querySelector(".btn-close");var background=modal.parentElement;if(button){button.addEventListener("click",closeModal,false);button.addEventListener("touchstart",closeModal,false)}background.addEventListener("click",closeModalOnClick,false);background.addEventListener("touchstart",closeModalOnClick,false);document.body.addEventListener("keyup",closeModalOnEsc,false)}function detachEvents(){var button=modal.querySelector(".btn-close");var background=modal.parentElement;if(button){button.removeEventListener("close",closeModal);button.removeEventListener("touchstart",closeModal)}background.removeEventListener("click",closeModalOnClick);background.removeEventListener("touchstart",closeModalOnClick);document.body.removeEventListener("keyup",closeModalOnEsc)}function removeArrow(){var parent=content.parentElement;var arrow=parent.querySelector(".modal-arrow-container");parent.removeChild(arrow)}function addArrowMarker(positionClass){var arrow=document.createElement("div");arrow.className=positionClass+" modal-arrow-container";arrow.innerHTML='<div class="modal-arrow"></div>';content.parentElement.appendChild(arrow)}function addArrow(direction){if(direction==="left"){addArrowMarker("modal-arrow-left");return}if(direction==="below"){addArrowMarker("modal-arrow-below");return}}var modalInterface={open:function open(content,opts,cb){if(!content){throw new Error("Cannot show modal without any elements to show")}var options=opts||{};var callback=cb;var useOptsArgAsCallback=cb===undefined&&typeof opts==="function";if(useOptsArgAsCallback){return openModal(content,undefined,opts)}return openModal(content,options,callback)},close:function(){closeModal()},anchorAbove:function(toThisNode){if(!modal){throw new Error("A modal must be open to anchor to a node.")}if(!toThisNode){throw new Error("A node must be given for the modal to anchor to.")}addArrow("below");if(positioning.fitsAbove(modal,toThisNode)){positioning.positionAbove(modal,toThisNode)}else{removeArrow();addArrow("left");positioning.positionRight(modal,toThisNode)}},anchorRight:function(toThisNode){if(!modal){throw new Error("A modal must be open to anchor to a node.")}if(!toThisNode){throw new Error("A node bust be given for the modal to anchor to.")}addArrow("left");if(positioning.fitsRight(modal,toThisNode)){positioning.positionRight(modal,toThisNode)}else{removeArrow();addArrow("below");positioning.positionAbove(modal,toThisNode)}}};return modalInterface});define("modal",["modal/main"],function(main){return main});define("mustache!src/controls/templates/colourPickerView",["lib/mustache"],function(mustache){var escapedTemplate='<div class="smallmargin smallpadding">\n<header class="popuptext singlemargin-bottom caption-title threecol">{{title}}</header>\n<div class="swatch-container threecol">\n{{#colours}}\n{{^value}}\n<div class="onecol rounded swatch floatleft customtip {{#selected}}selected-swatch{{/selected}}" title="Automatically assign a colour" style="background-color: #D2D1D1" data-id="{{id}}"></div>\n{{/value}}\n{{#value}}\n<div class="onecol rounded swatch floatleft customtip {{#selected}}selected-swatch{{/selected}}" title="{{name}}" data-id="{{id}}" style="background-color: {{value}}"></div>\n{{/value}}\n{{/colours}}\n</div>\n<div class="caption-container threecol">\n<div class="smallpadding caption-content">{{captionText}}</div>\n</div>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/controls/css/colourPickerView.css",["css!src/controls/css/compiled.css"],function(){});define("src/controls/views/ColourPickerView",["backbone","jquery","mustache!src/controls/templates/colourPickerView","css!src/controls/css/colourPickerView.css","customtip"],function(Backbone,$,template){"use strict";return Backbone.View.extend({className:"colourPickerView",events:{"click .swatch":function onSwatchClick(evt){var $target=$(evt.target),colourId=$target.data("id");if($target.hasClass("selected-swatch")){return}this.$el.find(".selected-swatch").removeClass("selected-swatch");$target.addClass("selected-swatch");this.trigger("changeColour",colourId===""?null:colourId)}},constructor:function ColourPickerView(options){Backbone.View.apply(this,arguments);if(!options.hasOwnProperty("selectedId")){throw new Error("options.selectedId is required")}if(!options.hasOwnProperty("captionText")){throw new Error("options.captionText is required")}if(!options.hasOwnProperty("title")){throw new Error("options.title is required")}this.selectedId=options.selectedId;this.captionText=options.captionText;this.title=options.title},render:function render(){var view=this,templateData={colours:view.model.map(function(model){return{id:model.id,name:model.get("name"),value:model.get("value"),selected:model.id===view.selectedId}}),selected:view.selectedId,captionText:view.captionText,title:view.title};templateData.colours.sort(function(a,b){return a.id-b.id});templateData.colours.unshift({id:null,name:"auto",selected:view.selectedId===null});view.$el.html(template(templateData));view.$el.customtip()}})});define("mustache!src/controls/templates/queryInputs",["lib/mustache"],function(mustache){var escapedTemplate='<select class="query" name="queryId" {{#allowMultipleSelection}}multiple{{/allowMultipleSelection}}>\n{{^allowMultipleSelection}}\n<option value></option>\n{{/allowMultipleSelection}}\n{{#queries}}\n<option value="{{id}}" {{selected}} data-logotype="{{isLogoType}}" data-readonly="{{isReadOnly}}" data-locked="{{isLocked}}" {{#lockedByUsername}}data-lockedbyusername="{{lockedByUsername}}"{{/lockedByUsername}} {{#typeIconClass}}data-typeiconclass="{{typeIconClass}}"{{/typeIconClass}} {{#colour}}data-colour="{{colour}}"{{/colour}} data-usecolour="{{usecolour}}" data-queryid="{{id}}">{{name}}</option>\n{{/queries}}\n</select>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("text!src/controls/templates/queryselection/querySelectorItem.template",[],function(){return'<li\n    class="{{itemClass}} smallpadding relative db textellipsis ellipsistooltip customtip"\n    title="{{label}}"\n    data-text="{{label}}"\n    data-value="{{value}}">\n    {{#data.typeiconclass}}\n        <span class="{{itemClass}}__icon {{data.typeiconclass}}"></span>\n    {{/data.typeiconclass}}\n    <span class="{{itemTextClass}}">\n        {{label}}\n    </span>\n</li>\n'});define("text!src/controls/templates/queryselection/querySelectorItemsPopup.template",[],function(){return'<div class="{{itemsClass}} keepMinWidth lightshadow">\n    <div class="searchContainer smallpadding relative db">\n        <input class="{{searchInputClass}} rounded"/>\n    </div>\n    <ul class="{{itemslistClass}}">\n        {{#items}}\n            {{> item}}\n        {{/items}}\n        {{^items}}\n        <li class="empty smallpadding relative db textellipsis">\n            <span class="{{itemTextClass}} lightgrey">No items</span>\n        </li>\n        {{/items}}\n    </ul>\n    {{#footer}}\n    <footer class="footer smallpadding relative db">\n        {{{footer}}}\n    </footer>\n    {{/footer}}\n</div>\n'});define("text!src/controls/templates/queryselection/querySelectorMain.template",[],function(){return'<div class="{{className}}" tabindex=1>\n    <ul class="{{selectionsClass}} top bwscrollbar-narrow">\n        {{#selections}}\n        {{/selections}}\n    </ul>\n    <div class="{{selectedClass}} js-query-selector-trigger rounded darkgrey smallpadding-horizontal relative">\n        <span class="{{selectedTextClass}} dib doublepadding-right fullwidth textellipsis">{{selectedItemText}}</span><i class="icon-chevron-down rounded linkblue absright hugeline smallmargin-right"></i>\n    </div>\n</div>\n'});define("text!src/controls/templates/queryselection/querySelectorSelection.template",[],function(){return'<li class="{{selectionItemClass}} rounded relative" data-value="{{value}}">\n    {{#data.usecolour}}\n    {{#data.colour}}\n    <div class="colour-band floatleft js-colour-select customtip" style="background-color: {{data.colour}};" title="Assign a colour" data-queryid="{{data.queryid}}"></div>\n    {{/data.colour}}\n    {{^data.colour}}\n    <div class="colour-band floatleft js-colour-select customtip" title="Assign a colour" data-queryid="{{data.queryid}}">A</div>\n    {{/data.colour}}\n    {{/data.usecolour}}\n    <div class="relative smallpadding-left doublepadding-right textellipsis ellipsistooltip customtip" title="{{text}}">\n        {{#data.typeiconclass}}\n            <span class="{{data.typeiconclass}}"></span>\n        {{/data.typeiconclass}}\n        {{text}}<i class="icon-remove {{unselectItemClass}} iconsmaller grey absright hugeline smallmargin-right customtip" title="Deselect"></i>\n    </div>\n    <div class="action abstop">\n        {{#data.logotype}}\n            <i class="action-icon readonly icon-lock grey customtip" title=\'Get in touch with your account contact for changes to your Logo Query.\'></i>\n        {{/data.logotype}}\n        {{^data.logotype}}\n            {{#data.readonly}}\n                <i class="action-icon readonly icon-lock grey customtip" title=\'Contact your admin for access.\'></i>\n            {{/data.readonly}}\n            {{^data.readonly}}\n                {{^data.locked}}\n                <i class="action-icon js-edit icon-pencil grey customtip" title=\'Edit "{{text}}".\'></i>\n                {{/data.locked}}\n                {{#data.locked}}\n                <i class="action-icon icon-lock grey disabled customtip" title=\'Locked by Administrator "{{data.lockedbyusername}}".\'></i>\n                {{/data.locked}}\n            {{/data.readonly}}\n        {{/data.logotype}}\n    </div>\n</li>\n'});define("css!src/controls/css/sellecktPopup.css",["css!src/controls/css/compiled.css"],function(){});define("src/controls/views/QueryInputs",["backbone","underscore","jquery","selleckt","modal","src/controls/views/ColourPickerView","src/controls/controlsEvents","src/controls/lib/viewHelpers","mustache!src/controls/templates/queryInputs","text!src/controls/templates/queryselection/querySelectorItem.template","text!src/controls/templates/queryselection/querySelectorItemsPopup.template","text!src/controls/templates/queryselection/querySelectorMain.template","text!src/controls/templates/queryselection/querySelectorSelection.template","customtip","css!src/controls/css/sellecktPopup.css"],function(Backbone,_,$,selleckt,modal,ColourPickerView,controlsEvents,viewHelpers,queryInputsTemplate,querySelectorItemTemplate,querySelectorItemsPopupTemplate,querySelectorMainTemplate,querySelectorSelectionTemplate){"use strict";function getSelleckt(view){return view.selleckt}function getFooterTemplate(inputLabel,isReadOnly){if(isReadOnly){return{}}return{footer:'<a class="js-create-query"><span class="iconsmaller icon-plus smallpadding-right" />New '+(inputLabel||"Query / Channel")+"</a>"}}function destroySelleckt(view){var selleckt=getSelleckt(view);if(!selleckt){return}selleckt.off("itemSelected",view.onChanges);selleckt.off("itemUnselected",view.onChanges);selleckt.destroy()}function setColourForQuery(view,queryId,colourId){if(!view.useQueryColour||!view.queryColours){return}var found=view.queryColours.findWhere({queryId:queryId});if(!colourId){if(found){view.queryColours.remove(found)}return}var colour=view.colourPalette.findWhere({id:colourId}).toJSON();if(found){found.set("colourId",colourId);found.set("colour",colour);return}view.queryColours.add({queryId:queryId,colourId:colourId,colour:colour})}function getColourForQuery(view,queryId){if(!view.useQueryColour||!view.queryColours){return{}}var found=view.queryColours.findWhere({queryId:queryId});if(!found){return{}}return found.get("colour")}function checkMandatoryOptions(options){if(!options){throw new TypeError('options must be an object with mandatory fields "queries" and "canEditQueries"')}if(!options||!options.queries){throw new TypeError("options.queries must be set")}if(!options.hasOwnProperty("canEditQueries")){throw new TypeError("options.canEditQueries must be supplied")}if(options.queryColourOptions){if(!(options.queryColourOptions.colours instanceof Backbone.Collection)){throw new TypeError("queryColourOptions when truthy must be an object with mandatory colours collection")}if(!(options.queryColourOptions.palette instanceof Backbone.Collection)){throw new TypeError("queryColourOptions when truthy must be an object with mandatory palette collection")}if(typeof options.queryColourOptions.pickerCaption!=="string"){throw new TypeError("queryColourOptions when truthy must be an object with mandatory pickerCaption string")}}}function registerListeners(view){view.listenTo(view.model,"change",view.updateValues);view.listenTo(view.model,"invalid",view.showErrors);view.listenTo(view.queries,"reset change add remove",view.render);if(view.useQueryColour){view.listenTo(view.queryColours,"reset change add remove",view.render)}view.onChanges=_.bind(view.onChanges,view)}return Backbone.View.extend({className:"queryInputs modular",events:function events(){return{"click .js-edit":"onEditQuery","click .js-colour-select":"onColourSelect"}},constructor:function QueryInputs(options){Backbone.View.apply(this,arguments);checkMandatoryOptions(options);this.useQueryColour=!!options.queryColourOptions;this.queries=options.queries;this.isEnabled="isEnabled"in options?options.isEnabled:true;this.selectPlaceholder=options.selectPlaceholder;this.selectAdditionalClassName=options.selectAdditionalClassName;this.allowMultipleSelection="allowMultipleSelection"in options?options.allowMultipleSelection:true;this.inputLabel=options.inputLabel;this.allowedQueryTypes=options.allowedQueryTypes;this.isReadOnly=!options.canEditQueries;if(this.useQueryColour){this.queryColours=options.queryColourOptions.colours;this.colourPalette=options.queryColourOptions.palette;this.queryColourPickerCaption=options.queryColourOptions.pickerCaption}registerListeners(this)},remove:function remove(){destroySelleckt(this);Backbone.View.prototype.remove.call(this)},updateValues:function updateValues(){var queryId=[].concat(this.model.get("queryId")||[]),$queryId=this.$("[name=queryId]");this.$(".invalid").removeClass("invalid");if(!_.isEqual($queryId.val(),queryId)){$queryId.val(queryId).change()}},showErrors:function showErrors(model,errors){if(errors.queryId||Array.isArray(errors)&&errors.indexOf("queryId")>-1){this.$("[name=queryId]").addClass("invalid");getSelleckt(this).$sellecktEl.addClass("invalid")}},render:function render(){if(!this.isEnabled){this.$el.empty();return}var rawIds=[].concat(this.$("[name=queryId]").val()||this.model.get("queryId")||[]),selectedQueries=rawIds.map(function(id){return parseInt(id,10)}),data=this.getTemplateData(selectedQueries),onCreateQuery=_.bind(this.onCreateQuery,this);this.$el.html(queryInputsTemplate(data));destroySelleckt(this);this.selleckt=selleckt.create({$selectEl:this.$("[name=queryId]"),multiple:this.allowMultipleSelection,placeholderText:this.selectPlaceholder?this.selectPlaceholder:"Select Query / Channel",alternatePlaceholder:"Select another",additionalClassName:this.selectAdditionalClassName,showEmptyList:true,mainTemplate:querySelectorMainTemplate,selectionTemplate:querySelectorSelectionTemplate,itemTemplate:querySelectorItemTemplate,popupTemplate:querySelectorItemsPopupTemplate,popupTemplateData:getFooterTemplate(this.inputLabel,this.isReadOnly),enableSearch:true});this.selleckt.on("itemSelected",this.onChanges);this.selleckt.on("itemUnselected",this.onChanges);this.selleckt.on("onPopupCreated",function(popup){var $popupEl=popup.$popup;$popupEl.on("click",".js-create-query",onCreateQuery)});this.selleckt.render();this.trigger("rendered");this.$el.customtip()},getTemplateData:function getTemplateData(selectedQueries){var view=this;var allowedQueryTypes=[].concat(view.allowedQueryTypes||[]);var templateData={allowMultipleSelection:view.allowMultipleSelection,queries:[]};view.queries.forEach(function(query){var type=query.get("type");if(allowedQueryTypes.length&&allowedQueryTypes.indexOf(type)===-1){return}templateData.queries.push({id:query.id,usecolour:view.useQueryColour,colour:getColourForQuery(view,query.id).value,name:query.get("name"),selected:selectedQueries.indexOf(query.id)>-1?"selected":"",type:type,typeIconClass:viewHelpers.getIconClassGivenType(type),isReadOnly:view.isReadOnly,isLogoType:type==="logo",isLocked:query.get("lockedQuery")===true,lockedByUsername:query.get("lockedByUsername")})});return templateData},getValues:function getValues(){var view=this,queryIds;if(!view.isEnabled){return{queryId:view.model.get("queryId")}}queryIds=[].concat(view.$("[name=queryId]").val()||[]).reduce(function(ids,val){var id=parseInt(val,10);if(!isNaN(id)&&ids.indexOf(id)===-1){ids.push(id)}return ids},[]);if(!view.allowMultipleSelection){return{queryId:queryIds[0]}}return{queryId:queryIds}},onEditQuery:function onEditQuery(event){var $target=$(event.target),queryId=$target.closest("li[data-value]").data("value");this.editQuery(queryId)},editQuery:function editQuery(queryId){var queryModel=this.queries.get(queryId);controlsEvents.trigger("editQuery",queryModel)},onCreateQuery:function onCreateQuery(){this.createQuery()},createQuery:function createQuery(){this.stopListening(this.queries,"add",this.onQueryCreated);this.listenToOnce(this.queries,"add",this.onQueryCreated);controlsEvents.trigger("createQuery",{allowedQueryTypes:this.allowedQueryTypes})},onQueryCreated:function onQueryCreated(model){this.render();this.selectQuery(model.id)},selectQuery:function selectQuery(queryId){var querySelect=this.$("[name=queryId]"),selection=this.allowMultipleSelection?[queryId].concat(querySelect.val()):[queryId];querySelect.val(selection).trigger("change")},onColourSelect:function onColourSelect(evt){var view=this,queryId=$(evt.target).data().queryid,query=queryId?view.queries.get(queryId):null,colour=view.queryColours.findWhere({queryId:queryId}),colourPickerView=new ColourPickerView({model:view.colourPalette,selectedId:colour&&colour.get("colourId")||null,captionText:view.queryColourPickerCaption,title:query?"Custom colour: "+query.get("name"):""});colourPickerView.render();view.listenTo(colourPickerView,"changeColour",function(colourId){setColourForQuery(view,queryId,colourId);modal.close()});modal.open(colourPickerView.el,{closeOnEsc:true,closeOnClick:true,className:"popup-wrapper singlepadding",hideClose:true});modal.anchorRight(evt.target)},onChanges:function onChanges(){this.trigger("changesMade",this.getValues())}})});define("mustache!src/controls/templates/controlsViewQueryInputs",["lib/mustache"],function(mustache){var escapedTemplate='<div class="inputWrapper relative">\n<div>\n<label class="db smallpadding-bottom">{{inputLabel}}</label>\n<a class="help icon-bwhelp abstop absright" data-key="{{helpKey}}" ></a>\n</div>\n<div class="query"></div>\n<a class="js-edit smallpadding-left icon-pencil grey customtip"></a>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/controls/views/ControlsViewQueryInputs",["jquery","src/controls/views/ControlsViewInputs","src/controls/views/QueryInputs","mustache!src/controls/templates/controlsViewQueryInputs","customtip"],function($,ControlsViewInputs,QueryInputs,queryInputsTemplate){"use strict";return ControlsViewInputs.extend({className:"queryInputs modular singlepadding-horizontal singlepadding-top",constructor:function ControlsViewQueryInputs(options){ControlsViewInputs.apply(this,arguments);if(!options||!options.queries){throw new TypeError("options.queries must be set")}this.isEnabled="isEnabled"in options?options.isEnabled:true;this.inputLabel=options.inputLabel;this.helpKey=options.helpKey;this.queryInputs=new QueryInputs({model:this.model,queries:options.queries,isEnabled:this.isEnabled,selectPlaceholder:options.selectPlaceholder,selectAdditionalClassName:options.selectAdditionalClassName,inputLabel:options.inputLabel,allowMultipleSelection:!!options.allowMultipleSelection,allowedQueryTypes:options.allowedQueryTypes,canEditQueries:!!options.canEditQueries,queryColourOptions:options.queryColourOptions});ControlsViewInputs.prototype.initialize.call(this,options)},remove:function remove(){this.queryInputs.remove();ControlsViewInputs.prototype.remove.call(this)},getValues:function getValues(){return this.queryInputs.getValues()},render:function render(){if(!this.isEnabled){this.$el.empty();return}var data=this.getTemplateData();this.queryInputs.$el.detach();this.$el.html(queryInputsTemplate(data));this.queryInputs.render();this.$(".query").append(this.queryInputs.$el);this.$el.customtip()},getTemplateData:function getTemplateData(){return{helpKey:this.helpKey||"filters-query-name",inputLabel:this.inputLabel}},selectChanged:function selectChanged(){$(".tooltip").hide();this.$el.customtip();ControlsViewInputs.prototype.selectChanged.call(this)}})});(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==="object"&&typeof module==="object")module.exports=factory(require("moment-timezone"),require("underscore"));else if(typeof define==="function"&&define.amd)define("bw-fe-helpers/dateRangeFormatter",["moment-timezone","underscore"],factory);else{var a=typeof exports==="object"?factory(require("moment-timezone"),require("underscore")):factory(root["moment-timezone"],root["underscore"]);for(var i in a)(typeof exports==="object"?exports:root)[i]=a[i]}})(this,function(__WEBPACK_EXTERNAL_MODULE__0__,__WEBPACK_EXTERNAL_MODULE__1__){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=19)}({0:function(module,exports){module.exports=__WEBPACK_EXTERNAL_MODULE__0__},1:function(module,exports){module.exports=__WEBPACK_EXTERNAL_MODULE__1__},19:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var underscore__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1);var underscore__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(underscore__WEBPACK_IMPORTED_MODULE_0__);var moment_timezone__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(0);var moment_timezone__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(moment_timezone__WEBPACK_IMPORTED_MODULE_1__);var _isoDateHelper__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(5);var DEFAULT_TIMEZONE="UTC";__webpack_exports__["default"]={formatISODatePeriod:function formatISODatePeriod(datePeriod){var period=_isoDateHelper__WEBPACK_IMPORTED_MODULE_2__["default"].parseISODatePeriod(datePeriod);if(period.y||period.M||period.w||period.s){throw new Error("Can only format periods with days, hours or minutes in "+JSON.stringify(period))}if(underscore__WEBPACK_IMPORTED_MODULE_0___default.a.compact([period.d,period.h,period.m]).length>=2){throw new Error("Can only format periods in either days, hours or minutes")}if(period.d){if(period.d===1){return"Today"}return"Last "+period.d+" days"}if(period.h){if(period.h===1){return"Last hour"}return"Last "+period.h+" hours"}if(period.m){if(period.m===1){return"Last minute"}return"Last "+period.m+" minutes"}},formatISODateRange:function formatISODateRange(dateRange,options){options=options||{};var parsedDateRange=_isoDateHelper__WEBPACK_IMPORTED_MODULE_2__["default"].parseISODateRange(dateRange);var format=options.specifyTime?"HH:mm MMM DD, YYYY":"MMM DD, YYYY";var startMoment=moment_timezone__WEBPACK_IMPORTED_MODULE_1___default()(parsedDateRange.startDate);var endMoment=moment_timezone__WEBPACK_IMPORTED_MODULE_1___default()(parsedDateRange.endDate);var timezone=options.timezone||DEFAULT_TIMEZONE;var startDateFormatted;var endDateFormatted;if(!options.specifyTime){endMoment.tz(timezone).subtract({d:1})}startDateFormatted=startMoment.tz(timezone).format(format);endDateFormatted=endMoment.tz(timezone).format(format);if(startMoment.isSame(endMoment)){return startDateFormatted}return startDateFormatted+" - "+endDateFormatted},format:function format(dateRange,options){options=options||{};var timezone=options.timezone||DEFAULT_TIMEZONE;var formattedDateRange;var timezoneOffsetInfo;if(_isoDateHelper__WEBPACK_IMPORTED_MODULE_2__["default"].isISODatePeriod(dateRange)){formattedDateRange=this.formatISODatePeriod(dateRange)}if(_isoDateHelper__WEBPACK_IMPORTED_MODULE_2__["default"].isISODateRange(dateRange)){formattedDateRange=this.formatISODateRange(dateRange,options)}if(formattedDateRange){if(options.addTimezoneOffsetInfo){timezoneOffsetInfo=timezone===DEFAULT_TIMEZONE?"(UTC)":moment_timezone__WEBPACK_IMPORTED_MODULE_1___default.a.tz(timezone).format("(UTCZ)");return[formattedDateRange,timezoneOffsetInfo].join(" ")}return formattedDateRange}throw new Error("Not a date range: "+dateRange)}}},5:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var underscore__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1);var underscore__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(underscore__WEBPACK_IMPORTED_MODULE_0__);var moment_timezone__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(0);var moment_timezone__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(moment_timezone__WEBPACK_IMPORTED_MODULE_1__);var ISO_DATE_REGEX=/^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}(\.[0-9]{3})?(Z|[+-]\d{2}:?\d{2})$/,ISO_DATE_RANGE_REGEX=/^P([0-9]+Y)?([0-9]+M)?([0-9]+W)?([0-9]+D)?T?([0-9]+H)?([0-9]+M)?([0-9]+S)?$/,UTC_TIMEZONE="UTC";__webpack_exports__["default"]={today:function today(options){options=options||{};var timezone=options.timezone||UTC_TIMEZONE;return moment_timezone__WEBPACK_IMPORTED_MODULE_1___default.a.tz(timezone).startOf("day").toISOString()},isISODate:function isISODate(str){return ISO_DATE_REGEX.test(str)},isISODateRange:function isISODateRange(str){var parts=str&&str.split("/");if(!parts){return false}return parts.length===2&&this.isISODate(parts[0])&&this.isISODate(parts[1])},isISODatePeriod:function isISODatePeriod(str){return ISO_DATE_RANGE_REGEX.test(str)},parseISODateRange:function parseISODateRange(str,options){if(!this.isISODateRange(str)){throw new Error(str+" is not an ISO range string")}var parts=str.split("/");if(options&&options.timezone){return{startDate:moment_timezone__WEBPACK_IMPORTED_MODULE_1___default.a.utc(parts[0]).tz(options.timezone).format(),endDate:moment_timezone__WEBPACK_IMPORTED_MODULE_1___default.a.utc(parts[1]).tz(options.timezone).format()}}return{startDate:moment_timezone__WEBPACK_IMPORTED_MODULE_1___default.a.utc(parts[0]).toISOString(),endDate:moment_timezone__WEBPACK_IMPORTED_MODULE_1___default.a.utc(parts[1]).toISOString()}},parseISODatePeriod:function parseISODatePeriod(str){var period=ISO_DATE_RANGE_REGEX.exec(str);return{y:parseInt(period&&period[1],10)||0,M:parseInt(period&&period[2],10)||0,w:parseInt(period&&period[3],10)||0,d:parseInt(period&&period[4],10)||0,h:parseInt(period&&period[5],10)||0,m:parseInt(period&&period[6],10)||0,s:parseInt(period&&period[7],10)||0}},makeISODateRange:function makeISODateRange(date1,date2,options){if(options&&options.timezone){return moment_timezone__WEBPACK_IMPORTED_MODULE_1___default.a.utc(date1).tz(options.timezone).format()+"/"+moment_timezone__WEBPACK_IMPORTED_MODULE_1___default.a.utc(date2).tz(options.timezone).format()}return moment_timezone__WEBPACK_IMPORTED_MODULE_1___default.a.utc(date1).toISOString()+"/"+moment_timezone__WEBPACK_IMPORTED_MODULE_1___default.a.utc(date2).toISOString()},makeISODatePeriod:function makeISODatePeriod(date1,date2){var daysDiff,hoursDiff,minutesDiff;if(!date2&&underscore__WEBPACK_IMPORTED_MODULE_0___default.a.isNumber(date1)){return"P"+date1+"D"}daysDiff=moment_timezone__WEBPACK_IMPORTED_MODULE_1___default()(date2).diff(date1,"d");hoursDiff=moment_timezone__WEBPACK_IMPORTED_MODULE_1___default()(date2).diff(date1,"h");minutesDiff=moment_timezone__WEBPACK_IMPORTED_MODULE_1___default()(date2).diff(date1,"m");if(daysDiff){return"P"+daysDiff+"D"}if(hoursDiff){return"PT"+hoursDiff+"H"}if(minutesDiff){return"PT"+minutesDiff+"M"}},isLessThanOneDay:function isLessThanOneDay(datePeriod){var period=this.parseISODatePeriod(datePeriod);if(period.y||period.M||period.w||period.d){return false}return true},getStartAndEndDateForPeriod:function getStartAndEndDateForPeriod(period,options){options=options||{};var timezone=options.timezone||UTC_TIMEZONE;var referenceDate=moment_timezone__WEBPACK_IMPORTED_MODULE_1___default.a.tz(timezone);var periodObject=this.parseISODatePeriod(period);if(!this.isLessThanOneDay(period)){referenceDate.startOf("day").add({d:1})}return{startDate:referenceDate.clone().subtract(periodObject).toISOString(),endDate:referenceDate.toISOString()}},extractStartEndDates:function extractStartEndDates(rangeOrPeriod,options){if(this.isISODatePeriod(rangeOrPeriod)){return this.getStartAndEndDateForPeriod(rangeOrPeriod,options)}if(this.isISODateRange(rangeOrPeriod)){return this.parseISODateRange(rangeOrPeriod,options)}throw new Error("Argument is not an ISO8601 date range or period")},convertToISODateRange:function convertToISODateRange(period,options){var timezone=options&&options.timezone;var dates=this.extractStartEndDates(period,options);return this.makeISODateRange(dates.startDate,dates.endDate,timezone==="UTC"?undefined:options)},convertToISODatePeriod:function convertToISODatePeriod(dateRange){var dates=this.extractStartEndDates(dateRange);return this.makeISODatePeriod(dates.startDate,dates.endDate)}}}})["default"]});define("mustache!src/controls/templates/dateInputs",["lib/mustache"],function(mustache){var escapedTemplate='<span class="db smallpadding-bottom"><label for="{{cid}}-dateRange">Date</label></span>\n<input type="text" id="{{cid}}-dateRange" name="dateRange" class="date dib field" placeholder="Enter date range" required autocomplete="off" value="{{dateRange}}" />\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-date-range" ></a>\n{{/showHelp}}\n<p class="fixedDate {{^canSeeFixedDateRange}}hidden{{/canSeeFixedDateRange}}">\n<label for="fixedDate-{{cid}}">\n<input type="checkbox" class="toggleFixedDate smallmargin-right" value="true" name="fixedDateRange" id="fixedDate-{{cid}}" {{fixedDateCheckedState}}/>Fixed date range\n</label>\n<a class="help icon-bwhelp" data-key="filters-date-fixed"></a>\n</p>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});(function(root,factory){"use strict";var MicroEvent=function(){};MicroEvent.prototype={bind:function(event,fct){this._events=this._events||{};this._events[event]=this._events[event]||[];this._events[event].push(fct)},unbind:function(event,fct){this._events=this._events||{};if(event in this._events===false){return}this._events[event].splice(this._events[event].indexOf(fct),1)},trigger:function(event){this._events=this._events||{};if(event in this._events===false){return}for(var i=0;i<this._events[event].length;i++){this._events[event][i].apply(this,Array.prototype.slice.call(arguments,1))}}};MicroEvent.mixin=function(destObject){var props=["bind","unbind","trigger"];for(var i=0;i<props.length;i++){if(typeof destObject==="function"){destObject.prototype[props[i]]=MicroEvent.prototype[props[i]]}else{destObject[props[i]]=MicroEvent.prototype[props[i]]}}};if(typeof define==="function"&&define.amd){define("timepicker",["jquery","underscore","moment"],function($,_,moment){return factory($||root.jQuery,_||root._,moment||root.moment,MicroEvent)})}else{root.timepicker=factory(root.jQuery,root._,root.moment,MicroEvent)}})(this,function($,_,moment,MicroEvent){"use strict";if(!$){throw new Error("timepicker requires jQuery to be loaded")}if(!_){throw new Error("timepicker requires underscore to be loaded")}if(!moment){throw new Error("timepicker requires moment to be loaded")}var TIME_REGEX=/^([01]\d|2[0-3]):?([0-5]\d)$/,DOWN_ARROW_CODE=40,MAX_MINUTES_CHECKED=60,PUBLIC_METHODS=["destroy","open","close","select","deselect","reset"],findNearestPresetTimeMemo=_.memoize(findNearestPresetTime);function buildTimePickerList(presetTimes){return presetTimes.map(function(time){return'<li data-time="'+time+'">'+time+"</li>"}).join("")}function buildPicker(options){var $ul=$("<ul/>");$ul.addClass(options.pickerClassName).html(buildTimePickerList(options.presetTimes));return $ul}function getPresetTimes(intervalDuration){var presetTimes=[],interval=moment(intervalDuration,"HH:mm"),start=moment().startOf("day"),end=moment(start).add({days:1}),duration=moment.duration({hours:interval.hours(),minutes:interval.minutes()});while(start.diff(end)<0){presetTimes.push(start.format("HH:mm"));start=start.add(duration)}return presetTimes}function setupEvents(timepicker){timepicker.$input.on("click.timepicker",function(e){e.stopPropagation();e.preventDefault();timepicker.open()});timepicker.$input.on("blur.timepicker",function(){timepicker.close()});timepicker.$input.on("focus.timepicker",function(){timepicker.open()});timepicker.$picker.on("click.timepicker","li",function(e){e.preventDefault();e.stopPropagation();timepicker._preventClose=false;timepicker.select($(e.target).data("time"));timepicker.close()});timepicker.$picker.on("mousedown.timepicker","li",function(){timepicker._preventClose=true;$("body").one("mouseup",function(){timepicker.$picker.hide()})});timepicker.$input.on("keydown.timepicker",function(e){if(e.keyCode===DOWN_ARROW_CODE){timepicker.open();return}timepicker.close();timepicker.reset()})}function isPresetTime(timeStr,presetTimes){return presetTimes.indexOf(timeStr)>=0}function findNearestPresetTime(timeStr,presetTimes){var time,minutesChecked=0;time=moment(timeStr,"HH:mm");function direction(){return minutesChecked%2?minutesChecked:-minutesChecked}function seek(time){var attemptTimeStr=time.format("HH:mm");if(isPresetTime(attemptTimeStr,presetTimes)){return attemptTimeStr}if(minutesChecked>MAX_MINUTES_CHECKED){return}minutesChecked+=1;time.add("minutes",direction());return seek(time)}return seek(time)}function TimePicker($input){this.presetTimes=getPresetTimes(this.custom.interval);this.$input=$input;this.$picker=buildPicker({pickerClassName:this.custom.pickerClassName,presetTimes:this.presetTimes});this._preventClose=false;this._preventOpen=false;setupEvents(this)}TimePicker.prototype.isOpen=function(){return this.$picker.is(":visible")};TimePicker.prototype.open=function(){if(this._preventOpen||this.isOpen()){return}var inputPosition=this.$input.offset(),currentTime=this.$input.val();this.$picker.appendTo(this.custom.pickerContainer).css({top:inputPosition.top+this.$input.outerHeight(),left:inputPosition.left}).show();if(isPresetTime(currentTime,this.presetTimes)){this.select(currentTime,{silent:true})}scrollToShowTime(this,currentTime,this.presetTimes);this.trigger("onOpen")};TimePicker.prototype.findOptionByTime=function(time){return this.$picker.find('[data-time="'+time+'"]')};TimePicker.prototype.close=function(){if(this._preventClose){return}this.$picker.hide()};TimePicker.prototype.select=function(time,options){var $option=this.findOptionByTime(time),isSilent=(options||{}).silent===true;this.deselect();if(this.$input.val()!==time){this.$input.val(time)}$option.addClass(this.custom.pickerSelectedClassName);this._preventOpen=true;if(!isSilent){this.$input.trigger("change").trigger("focus");this.trigger("onSelect",time)}this._preventOpen=false};TimePicker.prototype.reset=function(){this.deselect()};TimePicker.prototype.destroy=function(){this.$picker.remove();this.$input.off(".timepicker");this.$input.removeData("timepicker")};TimePicker.prototype.deselect=function(){this.$picker.find("li").removeClass(this.custom.pickerSelectedClassName)};function scrollToShowTime(picker,time,presetTimes){var timePickerHeight,itemHeight,idealPosition,selectedTimePosition,scrollAdjustment=0,needsAdjustment,nearestPresetTime,$selectedTime;if(!time){picker.$picker.scrollTop(scrollAdjustment);return}nearestPresetTime=findNearestPresetTimeMemo(time,presetTimes);if(!nearestPresetTime){picker.$picker.scrollTop(scrollAdjustment);return}$selectedTime=picker.findOptionByTime(nearestPresetTime);timePickerHeight=picker.$picker.outerHeight();itemHeight=$selectedTime.outerHeight();selectedTimePosition=$selectedTime.index()*itemHeight;idealPosition=timePickerHeight/2-itemHeight/2;needsAdjustment=selectedTimePosition>idealPosition;if(needsAdjustment){scrollAdjustment=Math.abs(selectedTimePosition-idealPosition)}picker.$picker.scrollTop(scrollAdjustment)}function isValidMethod(method){if(PUBLIC_METHODS.indexOf(method)===-1){throw new Error("Invalid timepicker method")}return true}function isValidInterval(interval){if(!TIME_REGEX.exec(interval)){throw new Error("Invalid interval, must be a valid time")}}function isValidOptions(options){if(options.interval){isValidInterval(options.interval)}return true}MicroEvent.mixin(TimePicker);function setupPlugin($inputs,options){options=$.extend({},$.timepicker.defaults,options);return $inputs.each(function(){var $input=$(this),instance,currentInstance=$input.data("timepicker");if(currentInstance){currentInstance.destroy();currentInstance=undefined}$.extend(TimePicker.prototype,{custom:options});instance=new TimePicker($input);$input.data("timepicker",instance)})}function runPluginMethod($inputs,method,args){return $inputs.each(function(){var $input=$(this),timepicker;timepicker=$input.data("timepicker");timepicker[method].apply(timepicker,args)})}function isInstantiation(options){return _.isObject(options)&&isValidOptions(options)}function isMethodCall(options){return _.isString(options)&&isValidMethod(options)}$.fn.timepicker=function(value){var options=value||{};if(isInstantiation(options)){return setupPlugin(this,options)}else if(isMethodCall(options)){return runPluginMethod(this,options,Array.prototype.slice.call(arguments,1))}else{throw new Error("Invalid timepicker call")}};$.timepicker={};$.timepicker.defaults={pickerContainer:"body",pickerClassName:"time-picker",pickerSelectedClassName:"time-picker--selected",interval:"01:00"};$.expr.pseudos.timepicker=function(elem){return $(elem).data("timepicker")!==undefined};return TimePicker});(function(root,factory){"use strict";if(typeof define==="function"&&define.amd){define("daterangepicker.timesupport",["jquery","underscore","moment","timepicker"],function($,_,moment){return factory($,_,moment)})}else{root.daterangepicker.timeSupport=factory(root.jQuery,root._,root.moment)}})(this,function($,_,moment){"use strict";var TIME_REGEX=/^([01]\d|2[0-3]):([0-5]\d)$/,TIME_FORMAT="HH:mm";function setupTimePanelEvents(panel){panel.$el.on("change.time-panel",panel.$input,function(){if(panel.isValidTime()){panel.updateCalendarDate()}})}function getTimePanel(){return $('<div class="time-support__panel"><input name="time" class="time-support__field field rounded" /></div>')}function getTimePanelWrapper(){var html='<div class="time-support">'+'<div class="time-support__panel-wrapper"></div>'+'<label class="time-support__specify-time"><input type="checkbox" name="specifyTime"> Specify time</label>'+"</div>";return $(html)}function TimePanel(options){if(!options.calendar){throw new Error("Time panel must be instantiated with options.calendar")}this.$el=getTimePanel();this.$input=this.$el.find('input[name="time"]').timepicker();this.calendar=options.calendar;this.timezone=options.timezone;setupTimePanelEvents(this)}_.extend(TimePanel.prototype,{isValidTime:function(){var panel=this,time=panel.$input.val();panel.$input.removeClass("invalid-time");if(!time||!TIME_REGEX.test(time)){panel.$input.addClass("invalid-time");return false}return true},getTime:function(){var time=this.$input.val();return moment.tz(time,TIME_FORMAT,this.timezone)},setTime:function(time){this.$input.val(time)},updateCalendarDate:function(options){var panel=this,date,hours=0,minutes=0,time=panel.getTime(),currentDate=panel.calendar.selectedDate;options=options||{};if(time){hours=time.hours();minutes=time.minutes()}date=moment.tz([currentDate.year(),currentDate.month(),currentDate.date(),hours,minutes],this.timezone);panel.calendar.updateSelectedDate(date,options)},destroy:function(){var panel=this;if(panel.$el){panel.$el.remove();panel.$el.off(".time-panel")}}});function TimeSupport(options){var plugin=this,isSpecifyTimeChecked=(options||{}).specifyTimeChecked;plugin.$el=getTimePanelWrapper();plugin.$specifyTime=plugin.$el.find("[name=specifyTime]");plugin.$specifyTime.prop("checked",isSpecifyTimeChecked);plugin.$specifyTime.on("change",_.bind(plugin.setPanelState,plugin))}TimeSupport.pluginName="timeSupport";_.extend(TimeSupport.prototype,{resetCalendars:function(){var plugin=this,refreshData={};plugin.startPanel.updateCalendarDate({silent:true});refreshData.startDate=plugin.startPanel.calendar.selectedDate;plugin.endPanel.updateCalendarDate({silent:true});refreshData.endDate=plugin.endPanel.calendar.selectedDate;plugin.picker.trigger("refresh",refreshData)},setPanelState:function(){var plugin=this;if(plugin.$specifyTime.prop("checked")){plugin.openPanel()}else{plugin.closePanel()}},render:function(daterangepicker){var plugin=this;plugin.$el.insertBefore(daterangepicker.$el.find(".calendar-footer"));plugin.$panelWrapper=plugin.$el.find(".time-support__panel-wrapper");plugin.$panelWrapper.html(plugin.startPanel.$el);plugin.$panelWrapper.append(plugin.endPanel.$el);plugin.setPanelState()},updateStartTime:function(startMoment){this.startPanel.setTime(startMoment.format(TIME_FORMAT))},updateEndTime:function(endMoment){this.endPanel.setTime(endMoment.format(TIME_FORMAT))},getStartTimePicker:function(){return this.startPanel.$input.data("timepicker")},setTimezone:function(timezone){var isUTC=timezone.indexOf("UTC")!==-1;var tzOffset=isUTC?"(UTC)":moment.tz(timezone).format("(UTCZ)");this.$timezoneSpan.text(tzOffset)},getEndTimePicker:function(){return this.endPanel.$input.data("timepicker")},openPanel:function(){this.$panelWrapper.addClass("isOpen");this.updateStartTime(this.startPanel.calendar.selectedDate.tz(this.picker.timezone));this.updateEndTime(this.endPanel.calendar.selectedDate.tz(this.picker.timezone));this.resetCalendars()},closePanel:function(){var plugin=this,startOfDay=moment().startOf("day");plugin.$panelWrapper.removeClass("isOpen");plugin.updateStartTime(startOfDay);plugin.updateEndTime(startOfDay);plugin.resetCalendars()},attach:function(daterangepicker){var plugin=this,startCalendar=daterangepicker.startCalendar,endCalendar=daterangepicker.endCalendar,timezone=daterangepicker.timezone;if(!endCalendar){throw new Error("Timepicker is not supported for single date")}plugin.picker=daterangepicker;plugin.startPanel=new TimePanel({calendar:startCalendar,timezone:timezone});$('<label class="time-support__from">From</label>').insertBefore(plugin.startPanel.$input);plugin.endPanel=new TimePanel({calendar:endCalendar,timezone:timezone});$('<label class="time-support__to">To</label>').insertBefore(plugin.endPanel.$input);this.$timezoneSpan=$('<span class="time-support__zone"></span>').insertAfter(plugin.endPanel.$input);this.setTimezone(timezone);daterangepicker.bind("onRendered",function(){plugin.render(daterangepicker)});daterangepicker.bind("startDateSelected",function(args){plugin.updateEndTime(args.endDate);endCalendar.updateSelectedDate(args.endDate,{silent:true})});daterangepicker.bind("endDateSelected",function(args){plugin.updateStartTime(args.startDate);startCalendar.updateSelectedDate(args.startDate,{silent:true})});daterangepicker.bind("presetSelected",function(args){var specifyTime=args.specifyTime===true;plugin.$specifyTime.prop("checked",specifyTime).trigger("change");plugin.updateStartTime(args.startDate);plugin.updateEndTime(args.endDate);startCalendar.updateSelectedDate(args.startDate,{silent:true});endCalendar.updateSelectedDate(args.endDate,{silent:true})});function updateSelectedDateWrapper(panel,originalUpdateSelectedDate,date,options){var time;if(plugin.$specifyTime.prop("checked")){time=panel.getTime();date=moment.tz(date,timezone).hours(time.hours()).minutes(time.minutes())}originalUpdateSelectedDate.call(panel.calendar,date,options)}startCalendar.updateSelectedDate=_.wrap(startCalendar.updateSelectedDate,function(originalFunc,date,options){updateSelectedDateWrapper(plugin.startPanel,originalFunc,date,options)});endCalendar.updateSelectedDate=_.wrap(endCalendar.updateSelectedDate,function(originalFunc,date,options){updateSelectedDateWrapper(plugin.endPanel,originalFunc,date,options)})},detach:function(){var plugin=this;plugin.$el.remove();plugin.startPanel.destroy();plugin.endPanel.destroy()}});return TimeSupport});(function(root,factory){"use strict";var MicroEvent=function(){};MicroEvent.prototype={bind:function(event,fct){this._events=this._events||{};this._events[event]=this._events[event]||[];this._events[event].push(fct)},unbind:function(event,fct){this._events=this._events||{};if(event in this._events===false){return}this._events[event].splice(this._events[event].indexOf(fct),1)},trigger:function(event){this._events=this._events||{};if(event in this._events===false){return}for(var i=0;i<this._events[event].length;i++){this._events[event][i].apply(this,Array.prototype.slice.call(arguments,1))}}};MicroEvent.mixin=function(destObject){var props=["bind","unbind","trigger"];for(var i=0;i<props.length;i++){destObject.prototype[props[i]]=MicroEvent.prototype[props[i]]}};if(typeof define==="function"&&define.amd){define("daterangepicker",["jquery","underscore","moment","moment-timezone"],function($,_,moment){return factory($||root.jQuery,_||root._,moment||root.moment,MicroEvent)})}else{root.daterangepicker=factory(root.jQuery,root._,root.moment,MicroEvent)}})(this,function($,_,moment,MicroEvent){"use strict";if(!$){throw new Error("daterangepicker requires jQuery to be loaded")}if(!_){throw new Error("daterangepicker requires underscore to be loaded")}if(!moment){throw new Error("daterangepicker requires moment to be loaded")}var MILLISECONDS_PER_DAY=1e3*60*60*24,DEFAULT_TIMEZONE="UTC";function Calendar(options){var $el=this.$el=$("<div>");var className=options.className;var timezone=this.timezone=options.timezone;var todayString=moment.tz(timezone).format("YYYY-MM-DD");var selectedDate=this.selectedDate=moment.tz(options.selectedDate,timezone);var monthToDisplay=moment.tz([selectedDate.year(),selectedDate.month(),1,12],timezone);options=_.defaults(options,{selectedDate:todayString});this.label=options.label;this.monthToDisplay=monthToDisplay;if(className){$el.addClass(className)}$el.on("click","td.day",_.bind(this.onDayClicked,this));$el.on("click","th.next",_.bind(this.onNextClicked,this));$el.on("click","th.prev",_.bind(this.onPreviousClicked,this))}function buildCalendarHtml(data){var rowHtml=_(data.rows).map(function(row){var columnHtml=_(row.columns).map(function(col){return'<td class="day '+(col.className||"")+'" data-date="'+col.date+'">'+col.dayNumber+"</td>"});return'<tr class="week">'+columnHtml.join("")+"</tr>"});return'<table class="calendar">'+"<thead>"+"<tr>"+"<th>"+data.label+"</th>"+'<th class="prev"><span class="icon-chevron-left"></span></th>'+'<th class="month-title" colspan="3" style="width: auto">'+data.monthTitle+"</th>"+'<th class="next"><span class="icon-chevron-right"></span></th>'+"<th></th>"+"</tr>"+"<tr>"+"<th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th>Sat</th><th>Sun</th>"+"</tr>"+"</thead>"+"<tbody>"+rowHtml.join("")+"</tbody>"+"</table>"}_.extend(Calendar.prototype,{_getStartDate:function(){var startDate=this.monthToDisplay.clone();if(startDate.day()!==1){startDate.subtract({d:(startDate.day()||7)-1})}return startDate},_findCellByDate:function(date){return this.$el.find('.day[data-date="'+date.format("YYYY-MM-DD")+'"]')},render:function(){var rowStartDate=this._getStartDate().subtract({d:1}),selectedDate=this.selectedDate,monthToDisplayIndex=this.monthToDisplay.month(),lastDayOfMonthToDisplay=this.monthToDisplay.clone().add({M:1}).subtract({d:1}),getClassName=function(date){var classes=[];if(date.month()!==monthToDisplayIndex){classes.push("grey")}else if(date.date()===selectedDate.date()){classes.push("selected")}if(classes.length){return classes.join(" ")}},weeksToShow=Math.ceil(lastDayOfMonthToDisplay.diff(rowStartDate,"days")/7),data={label:this.label?'<span class="calendar-label">'+this.label+"</span>":"",monthTitle:this.monthToDisplay.format("MMMM YYYY"),rows:_.map(_.range(weeksToShow),function(weekIdx){return{columns:_.map(_.range(7),function(dayIdx){var date=rowStartDate.clone().add({d:weekIdx*7+(dayIdx+1)});return{date:date.format("YYYY-MM-DD"),className:getClassName(date),dayNumber:date.date()}})}})};this.$el.html(buildCalendarHtml(data))},destroy:function(){var $el=this.$el;$el.off("click","td.day");$el.off("click","th.next");$el.off("click","th.prev");$el.remove()},onDayClicked:function(e){e.stopPropagation();var target=$(e.target),date=target.data("date");this.updateSelectedDate(date)},onNextClicked:function(e){e.stopPropagation();this.monthToDisplay.add({M:1});this.showMonth()},onPreviousClicked:function(e){e.stopPropagation();this.monthToDisplay.subtract({M:1});this.showMonth()},updateSelectedDate:function(date,options){options=options||{};var newDate=this.selectedDate=moment.tz(date,this.timezone),month=newDate.month(),year=newDate.year(),monthToDisplay=this.monthToDisplay,silent=!!options.silent;if(month!==monthToDisplay.month()||year!==monthToDisplay.year()){this.monthToDisplay.set({month:month,year:year});this.showMonth()}this.addMarker(this.selectedDate);if(!silent){this.trigger("onDateSelected",{date:date})}},showMonth:function(){this.render();this.trigger("onMonthDisplayed",{month:this.monthToDisplay})},addMarker:function(date){var selectedClassName="selected";this.$el.find("."+selectedClassName).removeClass(selectedClassName);this._findCellByDate(date).addClass(selectedClassName)},highlightCells:function(startDate,endDate){var startCell=this._findCellByDate(startDate).not(".grey"),endCell=this._findCellByDate(endDate).not(".grey"),startRow=startCell.parent(),endRow=endCell.parent(),inRangeClassName="inRange",daySelector=".day",greySelector=".grey",dateDiff=startDate.diff(endDate);this.$el.find("."+inRangeClassName).removeClass(inRangeClassName);if(dateDiff===0||Math.abs(dateDiff)<MILLISECONDS_PER_DAY){return}if(this.monthToDisplay.diff(startDate.clone().date(1))<0){if(!startCell.length){return}}if(this.monthToDisplay.diff(endDate.clone().date(1))>0){if(!endCell.length){return}}if(!startCell.length&&!endCell.length){this.$el.find(daySelector).not(greySelector).addClass(inRangeClassName);return}if(!startCell.length){endCell.parent().prevAll().children(daySelector).not(greySelector).addClass(inRangeClassName);endCell.prevAll(daySelector).not(greySelector).addClass(inRangeClassName);return}if(!endCell.length){startCell.parent().nextAll().children(daySelector).not(greySelector).addClass(inRangeClassName);startCell.nextAll(daySelector).not(greySelector).addClass(inRangeClassName);return}if(startRow.is(endRow)){startCell.nextUntil(endCell).addClass(inRangeClassName)}else{startRow.nextUntil(endRow).children(daySelector).not(greySelector).addClass(inRangeClassName);startCell.nextAll(daySelector).not(greySelector).addClass(inRangeClassName);endCell.prevAll(daySelector).not(greySelector).addClass(inRangeClassName)}endCell.addClass(inRangeClassName);startCell.addClass(inRangeClassName)}});function DateRangePicker(options){var todayString;var $el=this.$el=$("<div/>");options=_.defaults(options,{startDate:todayString,endDate:todayString,zIndex:9999,singleDate:false});this.timezone=options.timezone||DEFAULT_TIMEZONE;todayString=moment.tz(this.timezone).format("YYYY-MM-DD");options.startDate=options.startDate||todayString;options.endDate=options.endDate||todayString;this.closeButtonCssClass=options.closeButtonCssClass||"";this.doneButtonCssClass=options.doneButtonCssClass||"";$el.on("click",".presets li",_.bind(this.onPresetClick,this));$el.on("click",".close a, .done",_.bind(this.onCloseClick,this));$el.on("click","table,div",function(e){e.stopPropagation()});this.startCalendar=this._createCalendar({selectedDate:options.startDate,timezone:this.timezone,className:"startCalendar",label:options.singleDate?"":"From"});if(!options.singleDate){this.endCalendar=this._createCalendar({selectedDate:options.endDate,timezone:this.timezone,className:"endCalendar",label:"To"})}if(options.presets){this.presets=options.presets;this.$el.addClass("withPresets")}this.startCalendar.bind("onDateSelected",_.bind(this.onStartDateSelected,this));this.startCalendar.bind("onMonthDisplayed",_.bind(this._updateStartCalendarHighlight,this));if(!options.singleDate){this.endCalendar.bind("onDateSelected",_.bind(this.onEndDateSelected,this));this.endCalendar.bind("onMonthDisplayed",_.bind(this._updateEndCalendarHighlight,this))}this.zIndex=options.zIndex;this._plugins=[]}DateRangePicker.create=function(options){options=options||{};var plugins;var i;var $input=options.$input;var className=options.className;var picker;plugins=options&&options.plugins||[];delete options.className;picker=new DateRangePicker(options);for(i=0;i<plugins.length;i++){picker.addPlugin(plugins[i],options[plugins[i].pluginName])}if(className){picker.$el.addClass(className)}picker.$input=$input;$input.data("picker",picker);return picker};_.extend(DateRangePicker.prototype,{_createCalendar:function(options){return new Calendar(options)},_updateStartCalendarHighlight:function(){var startDate=this.getStartDate();if(this.endCalendar){this.startCalendar.highlightCells(startDate,this.getEndDate())}this.startCalendar.addMarker(startDate)},_updateEndCalendarHighlight:function(){var endDate=this.getEndDate();this.endCalendar.highlightCells(this.getStartDate(),endDate);this.endCalendar.addMarker(endDate)},_highlightRange:function(startDate,endDate){if(startDate.diff(endDate)>0){return}if(this.endCalendar){this.startCalendar.highlightCells(startDate,endDate);this.endCalendar.highlightCells(startDate,endDate)}},buildPresetsList:function(){var presets=this.presets,lis;if(!presets){return}lis=_(presets).map(function(val,key){return["<li",'data-startdate="'+val.startDate+'"','data-enddate="'+(val.endDate||val.startDate)+'"','data-time="'+(val.specifyTime?"true":"false")+'">'+key+"</li>"].join(" ")});return['<div class="presets-wrapper">','<div class="close">','<a class="'+_.escape(this.closeButtonCssClass)+'"></a>',"</div>",'<nav class="presets">',"<h1>Quick Select</h1>","<ul>"+lis.join("")+"</ul>","</nav>","</div>"].join(" ")},render:function(){var startCalendar=this.startCalendar,endCalendar=this.endCalendar,presetsList=this.buildPresetsList(),calendarWrapper=$('<div class="calendar-wrapper">'),calendarWrapperInner=$('<div class="calendar-wrapper-inner"/>'),footer=$('<div class="calendar-footer">'+'<button class="done '+_.escape(this.doneButtonCssClass)+'">Done</button>'+"</div>");startCalendar.render();this._updateStartCalendarHighlight();if(endCalendar){endCalendar.render();this._updateEndCalendarHighlight()}calendarWrapperInner.append(startCalendar.$el);if(endCalendar){calendarWrapperInner.append(endCalendar.$el)}calendarWrapperInner.appendTo(calendarWrapper);this.$el.addClass("picker").append(presetsList).append(calendarWrapper).append(footer);this.trigger("onRendered")},show:function($target){var $el=this.$el,targetOffset=$target.offset(),windowWidth=$(window).width(),zIndex=this.zIndex,left;if(targetOffset.left+$el.outerWidth()>windowWidth){left=windowWidth-$el.outerWidth()-10}else{left=targetOffset.left}this.trigger("onBeforeShown",this);$el.show();$el.css({top:targetOffset.top+$target.outerHeight(),left:left,zIndex:zIndex});$(document).on("click.daterangepicker",_.bind(this.hide,this))},hide:function(){this.$el.hide();$(document).off("click.daterangepicker",this.hide)},destroy:function(){var pluginName;this.startCalendar.destroy();if(this.endCalendar){this.endCalendar.destroy()}while(pluginName=this._plugins.shift()){if(this[pluginName].detach){this[pluginName].detach(this)}this[pluginName]=undefined}this._plugins=[];this.$input.removeData("picker");this.$el.remove()},getStartDate:function(){return this.startCalendar.selectedDate},getEndDate:function(){if(this.endCalendar){return this.endCalendar.selectedDate}return this.startCalendar.selectedDate},setDateRange:function(startDate,endDate){startDate=moment.tz(startDate,this.timezone);if(this.endCalendar){endDate=moment.tz(endDate,this.timezone);if(startDate.diff(endDate)>0){return}}this.startCalendar.updateSelectedDate(startDate);if(this.endCalendar){this.endCalendar.updateSelectedDate(endDate)}},onStartDateSelected:function(args){var startDate=moment.tz(args.date,this.timezone),endDate=this.getEndDate();if(moment.tz(startDate,this.timezone).diff(endDate)>0){this.endCalendar.updateSelectedDate(startDate,{silent:true});endDate=startDate}this._highlightRange(startDate,endDate);this.trigger("startDateSelected",{startDate:startDate,endDate:endDate})},onEndDateSelected:function(args){var endDate=moment.tz(args.date,this.timezone),startDate=this.getStartDate();if(moment.tz(startDate,this.timezone).diff(endDate)>0){this.startCalendar.updateSelectedDate(endDate,{silent:true});startDate=endDate}this._highlightRange(startDate,endDate);this.trigger("endDateSelected",{startDate:startDate,endDate:endDate})},onPresetClick:function(e){e.stopPropagation();var target=$(e.target),startDate=moment.tz(target.data("startdate"),this.timezone),endDate=moment.tz(target.data("enddate"),this.timezone),specifyTime=target.data("time");this.startCalendar.updateSelectedDate(startDate,{silent:true});if(this.endCalendar){this.endCalendar.updateSelectedDate(endDate,{silent:true})}this._updateStartCalendarHighlight();if(this.endCalendar){this._updateEndCalendarHighlight()}this.trigger("presetSelected",{startDate:startDate,endDate:endDate,specifyTime:specifyTime})},onCloseClick:function(e){e.stopPropagation();this.hide()},addPlugin:function(Plugin,options){if(!Plugin.pluginName){throw new Error("Plugin "+Plugin+" must have a pluginName property")}var plugin=new Plugin(options);plugin.attach(this);this[Plugin.pluginName]=plugin;this._plugins.push(Plugin.pluginName)}});MicroEvent.mixin(Calendar);MicroEvent.mixin(DateRangePicker);$.fn.daterangepicker=function(options){options=options||{};var updateValue=function(formatter,args){var startDate=args.startDate,endDate=args.endDate,formattedValue=formatter(startDate,endDate);this.val(formattedValue)};return this.each(function(){var $self=$(this),picker=$self.data("picker"),formatter=options.dateFormatter||function(startDate,endDate){return startDate.format("DD MMM YYYY")+" - "+endDate.format("DD MMM YYYY")},boundUpdate=_.bind(updateValue,$self,formatter);if(!picker){options.$input=$self;picker=DateRangePicker.create(options);picker.render();picker.bind("startDateSelected",boundUpdate);picker.bind("endDateSelected",boundUpdate);picker.bind("presetSelected",boundUpdate);picker.bind("refresh",boundUpdate);$("body").append(picker.$el.hide())}$self.on("click",function(e){e.stopPropagation();picker.show($self)})})};return DateRangePicker});define("css!src/controls/css/daterangepicker.css",["css!src/controls/css/compiled.css"],function(){});define("css!src/controls/css/daterangepicker.timesupport.css",["css!src/controls/css/compiled.css"],function(){});define("css!src/controls/css/timepicker.css",["css!src/controls/css/compiled.css"],function(){});define("src/controls/views/ControlsViewDateInputs",["underscore","src/controls/views/ControlsViewInputs","bw-fe-helpers/isoDateHelper","bw-fe-helpers/dateRangeFormatter","moment","mustache!src/controls/templates/dateInputs","daterangepicker.timesupport","daterangepicker","timepicker","css!src/controls/css/daterangepicker.css","css!src/controls/css/daterangepicker.timesupport.css","css!src/controls/css/timepicker.css"],function(_,ControlsViewInputs,isoDateHelper,dateRangeFormatter,moment,dateInputsTemplate,timeSupportPlugin){"use strict";var DATE_PERIOD_REGEX=/^Last ([0-9]+) Days$/i,HOUR_PERIOD_REGEX=/^Last ([0-9]+) Hours$/i,MINUTES_PERIOD_REGEX=/^Last ([0-9]+) Minutes$/i,TIME_REGEX=/([01]\d|2[0-3]):([0-5]\d)/,SINGLE_DATE_REGEX=/\d{4}-\d{2}-\d{2}/;function parseSingleDateStringFormats(date){return date.replace(/\/|\./g,"-")}function getDateFormat(isTimeSpecified,isSingleDate){if(isSingleDate){return"YYYY-MM-DD"}return(isTimeSpecified?"HH:mm ":"")+"MMM DD, YYYY"}function parseDate(date,timezone,isEndDate){var dateString=parseSingleDateStringFormats(date),isSingleDate=SINGLE_DATE_REGEX.test(dateString),isTimeSpecified=TIME_REGEX.test(dateString),dateFormat=getDateFormat(isTimeSpecified,isSingleDate),dateMoment=moment.tz(dateString,dateFormat,timezone);if(isEndDate&&!isTimeSpecified){dateMoment.add({d:1})}return dateMoment.toISOString()}function parseDateRange(date,timezone){var startDateStr=date.split(" - ")[0],endDateStr=date.split(" - ")[1];return{startDate:parseDate(startDateStr,timezone,false),endDate:parseDate(endDateStr,timezone,true)}}function parseSingleDate(date,timezone){return{startDate:parseDate(date,timezone,false),endDate:parseDate(date,timezone,true)}}return ControlsViewInputs.extend({className:"dateInputs singlepadding-horizontal",events:function events(){return _.extend({"change input.toggleFixedDate":"toggleFixedDates"},ControlsViewInputs.prototype.events.call())},constructor:function ControlsViewDateInputs(options){ControlsViewInputs.apply(this,arguments);this.listenTo(this.model,"change",this.refresh);this.listenTo(this.model,"invalid",this.showValidationErrors);this.showFixedDateRange=options.showFixedDateRange!==false;this.timezone=options.timezone||"UTC";this.enableTimePicker=options.enableTimePicker===true},remove:function remove(){if(this.datePicker){this.datePicker.unbind();this.datePicker.destroy()}ControlsViewInputs.prototype.remove.call(this)},showValidationErrors:function showValidationErrors(model,errors){if(errors&&(errors.startDate||errors.indexOf&&errors.indexOf("startDate")>-1)){this.$("input.date").addClass("invalid")}if(errors&&(errors.endDate||errors.indexOf&&errors.indexOf("endDate")>-1)){this.$("input.date").addClass("invalid")}if(errors&&(errors.dateRange||errors.indexOf&&errors.indexOf("dateRange")>-1)){this.$("input.date").addClass("invalid")}},hideValidationErrors:function hideValidationErrors(){this.$("input.date").removeClass("invalid")},getValues:function getValues(){return{dateRange:this.getDateRange(),specifyTime:this.getSpecifyTime()}},getDateRange:function getDateRange(){var date=this.$(".date").val(),datePeriodMatch=DATE_PERIOD_REGEX.exec(date),hourPeriodMatch=HOUR_PERIOD_REGEX.exec(date),minutePeriodMatch=MINUTES_PERIOD_REGEX.exec(date),startAndEndDates;if(!date){return""}if(date==="Today"){return"P1D"}if(date==="Last hour"){return"PT1H"}if(date==="Last minute"){return"PT1M"}if(datePeriodMatch){return"P"+parseInt(datePeriodMatch[1],10)+"D"}if(hourPeriodMatch){return"PT"+parseInt(hourPeriodMatch[1],10)+"H"}if(minutePeriodMatch){return"PT"+parseInt(minutePeriodMatch[1],10)+"M"}if(date&&date.indexOf(" - ")>-1){startAndEndDates=parseDateRange(date,this.timezone)}else{startAndEndDates=parseSingleDate(date,this.timezone)}return isoDateHelper.makeISODateRange(startAndEndDates.startDate,startAndEndDates.endDate,{timezone:this.timezone})||""},getSpecifyTime:function getSpecifyTime(){var timeSupport=this.datePicker.timeSupport;if(timeSupport){return timeSupport.$specifyTime.prop("checked")}return this.model.get("specifyTime")},refresh:function refresh(){var model=this.model,fixedDateRange,changes=model.changedAttributes(),$fixedDate=this.$("[name=fixedDateRange]"),specifyTime=this.getSpecifyTime();if(changes.dateRange){fixedDateRange=isoDateHelper.isISODateRange(changes.dateRange);this.$(".date").val(dateRangeFormatter.format(changes.dateRange,{specifyTime:specifyTime,timezone:this.timezone}));$fixedDate.prop("checked",fixedDateRange)}},render:function render(){var data=this.getTemplateData(this.model.toJSON());this.$el.html(dateInputsTemplate(data));this.setupDatepicker(this.$(".date"),data)},getTemplateData:function getTemplateData(data){var dateRange=data.dateRange;var isFixedDateRange=isoDateHelper.isISODateRange(dateRange);var dates=dateRange?isoDateHelper.extractStartEndDates(dateRange):{};var formattedRange=dateRange?dateRangeFormatter.format(dateRange,{specifyTime:data.specifyTime,timezone:this.timezone}):"";var endDate=moment.utc(dates.endDate);if(data.specifyTime!==true){endDate.subtract({d:1})}return _.extend(data,{cid:_.uniqueId(),dateRange:formattedRange,startDate:dates.startDate,endDate:endDate.toISOString(),canSeeFixedDateRange:this.showFixedDateRange,fixedDateCheckedState:isFixedDateRange?"checked":""})},setupDatepicker:function setupDatepicker($input,data){var view=this,dateFormatStr="YYYY-MM-DD",datetimeFormatStr="YYYY-MM-DDTHH:mm",now=moment.utc(new Date),nowStr=now.format(dateFormatStr),timeNowStr=now.format(datetimeFormatStr),oneHourAgoStr=now.clone().subtract({h:1}).format(datetimeFormatStr),sixHoursAgoStr=now.clone().subtract({h:6}).format(datetimeFormatStr),sevenDaysAgoStr=now.clone().subtract({d:6}).format(dateFormatStr),fourteenDaysAgoStr=now.clone().subtract({d:13}).format(dateFormatStr),oneMonthAgoStr=now.clone().subtract({M:1}).add({d:1}).format(dateFormatStr),twoMonthsAgoStr=now.clone().subtract({M:2}).add({d:1}).format(dateFormatStr),picker,dateFormatter=_.bind(function(startDate,endDate){var fixedDateRange=this.$("[name=fixedDateRange]").is(":checked"),specifyTime=picker.$el.find("[name=specifyTime]").is(":checked"),dateRange;if(specifyTime){startDate=moment.tz([startDate.year(),startDate.month(),startDate.date(),startDate.hours(),startDate.minutes()],view.timezone);endDate=moment.tz([endDate.year(),endDate.month(),endDate.date(),endDate.hours(),endDate.minutes()],view.timezone)}else{startDate=moment.tz(startDate,view.timezone);endDate=moment.tz(endDate,view.timezone).add({d:1})}if(fixedDateRange){dateRange=isoDateHelper.makeISODateRange(startDate,endDate)}else{dateRange=isoDateHelper.makeISODatePeriod(startDate,endDate)}return dateRangeFormatter.format(dateRange,{timezone:view.timezone,specifyTime:specifyTime})},this),setFixedMode=_.bind(function(){var checkbox=this.$("[name=fixedDateRange]");if(!checkbox.is(":checked")){checkbox.prop("checked",true)}},this),pickerPlugins=[],timeSupportOptions={specifyTimeChecked:data.specifyTime},pickerPresets={Today:{startDate:nowStr,endDate:nowStr},"7d":{startDate:sevenDaysAgoStr,endDate:nowStr},"14d":{startDate:fourteenDaysAgoStr,endDate:nowStr},"1m":{startDate:oneMonthAgoStr,endDate:nowStr},"2m":{startDate:twoMonthsAgoStr,endDate:nowStr}};if(this.enableTimePicker){pickerPlugins.push(timeSupportPlugin);pickerPresets=_.extend({"1hr":{startDate:oneHourAgoStr,endDate:timeNowStr,specifyTime:true},"6hr":{startDate:sixHoursAgoStr,endDate:timeNowStr,specifyTime:true}},pickerPresets)}$input.daterangepicker({startDate:data.startDate,endDate:data.endDate,timezone:this.timezone,zIndex:10011,presets:pickerPresets,plugins:pickerPlugins,dateFormatter:dateFormatter,timeSupport:timeSupportOptions});picker=this.datePicker=$input.data("picker");picker.bind("startDateSelected",function(args){setFixedMode();$input.val(dateFormatter(args.startDate,args.endDate));view.trigger("changesMade")});picker.bind("endDateSelected",function(args){setFixedMode();$input.val(dateFormatter(args.startDate,args.endDate));view.trigger("changesMade")});picker.bind("presetSelected",function(){picker.$el.hide();view.trigger("changesMade")});$input.val(data.dateRange)},toggleFixedDates:function toggleFixedDates(){var fixedDateRange=this.$("[name=fixedDateRange]").is(":checked"),$dateRange=this.$("[name=dateRange]"),dateRange=this.getDateRange(),specifyTime=this.getSpecifyTime();if(fixedDateRange){dateRange=isoDateHelper.convertToISODateRange(dateRange,{timezone:this.timezone})}else{dateRange=isoDateHelper.convertToISODatePeriod(dateRange)}$dateRange.val(dateRangeFormatter.format(dateRange,{specifyTime:specifyTime,timezone:this.timezone}));this.inputChanged()},inputChanged:function inputChanged(){this.hideValidationErrors();ControlsViewInputs.prototype.inputChanged.call(this)}})});define("src/views/ControlsViewInputs",["src/controls/views/ControlsViewInputs"],function(ControlsViewInputs){"use strict";return ControlsViewInputs.extend({initialize:function initialize(options){options=options||{};if(!("dashboard"in options)){throw new Error("You should try to pass in a dashboard instance "+"(usually this.dashboard from a ControlsView instance or src/globals/currentDashboard). "+'If this is truly a "global" ControlsViewInput (ie shouldn\'t have any dashboard permissions '+"applied to it) then pass in dashboard: undefined")}this.dashboard=options.dashboard;ControlsViewInputs.prototype.initialize.call(this,options)}})});define("mustache!templates/searchInput",["lib/mustache"],function(mustache){var escapedTemplate='<div class="searchBoxWrapper singlepadding">\n<fieldset class="searchInput lastInSet">\n<div class="editor searchField search iconfield monospacefont {{^search}}empty{{/search}}">{{search}}</div>\n<input class="search-input" type="hidden" name="search" value="{{search}}">\n<button class="button ignoreHighlight" value="Go" {{^fieldEnabled}}disabled="true"{{/fieldEnabled}}>Go</button>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="{{helpKey}}" ></a>\n{{/showHelp}}\n</fieldset>\n{{#liveStreamEnabled}}\n<p class="liveStreamWarning searchField field smalltext customtip" title="Search is not supported when &quot;live stream&quot; is enabled.<br/>You can set up rules to automatically tag/categorize mentions based on search terms then filter by them in &quot;live stream&quot; mode.">\n<span class="icon-warning-sign smallpadding-left"></span>\nSearch not available\n</p>\n{{/liveStreamEnabled}}\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/views/ControlsViewSearchInput",["underscore","jquery","src/views/ControlsViewInputs","mustache!templates/searchInput","src/packages/customtip","jquery.acify"],function(_,$,ControlsViewInputs,template){"use strict";return ControlsViewInputs.extend({className:"searchBox modular collapsed",helpKey:"mentions-search",events:{"click .editor":"handleEditorClick","click button":"onClickButton","keydown .editor":"onEditorKeydown"},initialize:function initialize(options){if(options){this.expandDirection=options.expandDirection;this.expanderClassName=options.expanderClassName}this.model.bind("change",this.render,this);this.showHelp=options.showHelp!==false;this.helpKey=options.helpKey||this.helpKey;this.enabled=true;ControlsViewInputs.prototype.initialize.call(this,options)},remove:function remove(){this.model.unbind("change",this.render,this);if(this.aceEditor){this.aceEditor.destroy()}ControlsViewInputs.prototype.remove.call(this)},render:function render(){var data=this.getTemplateData(this.model.toJSON()),$el=this.$el,editorDiv=this.editorDiv;if(editorDiv){editorDiv.detach()}$el.html(template(data)).customtip();if(this.aceEditor&&!this.aceEditor.getReadOnly()){this.aceEditor.setValue(data.search)}if(editorDiv){this.$(".editor").replaceWith(editorDiv)}else{editorDiv=this.$(".editor")}editorDiv.toggleClass("disabled",!this.fieldEnabled())},onClickButton:function onClickButton(e){this.trigger("changesMade");this.trigger("search",e)},onEditorKeydown:function onEditorKeydown(e){if(e.which===13&&!e.shiftKey){e.preventDefault();this.updateSearchTerm();$(e.target).blur();this.trigger("changesMade",e);this.trigger("search",e)}else if(e.which===27&&!e.shiftKey){e.preventDefault();$(e.target).blur()}},handleEditorClick:function handleEditorClick(e){this.initAceEditor($(e.currentTarget))},initAceEditor:function initAceEditor(editorDiv){if(!this.fieldEnabled()){return}if(this.aceEditor){this.expandSearchContainer();return}editorDiv.acify({autoResize:true,onReady:_.bind(function(opts){this.aceEditor=opts.editor;this.editorDiv=$(opts.editor.container);this.expandSearchContainer();this.aceEditor.focus();this.aceEditor.navigateLineEnd()},this),onBlur:_.bind(this.updateSearchTermAndShrink,this)})},updateSearchTermAndShrink:function updateSearchTermAndShrink(){this.updateSearchTerm();this.shrinkSearchContainer()},expandSearchContainer:function expandSearchContainer(){var editorDiv=this.editorDiv,aceEditor=this.aceEditor;this.$el.removeClass("collapsed").addClass("expanded");editorDiv.removeClass("empty");aceEditor.fitToContents(true);editorDiv.one("transitionend webkitTransitionEnd oTransitionEnd",function(){aceEditor.resize()})},updateSearchTerm:function updateSearchTerm(){this.$(".search-input").val(this.aceEditor.getValue())},shrinkSearchContainer:function shrinkSearchContainer(){var editorDiv=this.editorDiv,aceEditor=this.aceEditor;this.$el.removeClass("expanded").addClass("collapsed");editorDiv.css({height:""});aceEditor.scrollToRow(0);editorDiv.one("transitionend webkitTransitionEnd oTransitionEnd",function(){aceEditor.resize()})},setEnabled:function setEnabled(enabled){this.$("input, button").prop("disabled",!enabled).toggleClass("disabled",!enabled);this.$(".editor").toggleClass("disabled",!enabled);if(this.aceEditor){this.aceEditor.setReadOnly(!enabled)}this.enabled=enabled},liveStreamEnabled:function liveStreamEnabled(){return!!this.model.get("liveStreaming")},fieldEnabled:function fieldEnabled(){return this.enabled&&!this.liveStreamEnabled()},getTemplateData:function getTemplateData(){var model=this.model;return{showHelp:this.showHelp,search:model.get("search"),fieldEnabled:this.fieldEnabled(),liveStreamEnabled:this.liveStreamEnabled(),helpKey:this.helpKey}},getValues:function getValues(){var $field=this.$el.find("[name=search]");if($field.is(":disabled")){return{search:""}}return{search:_.trim($field.val()),start:1}}})});define("src/globals/filtersClipboard",["src/storageProvider","src/globals/currentProject"],function(storageProvider,currentProject){"use strict";var STORAGE_KEY="FiltersClipboard";var initialised=false;function init(){if(initialised){return}clear();currentProject.onLoad(function(done){clear();done()});initialised=true}function isInitialized(){if(!initialised){throw new Error("filtersClipboard must be initialised first with init()")}}function get(){isInitialized();return storageProvider.get(STORAGE_KEY)}function set(data){isInitialized();storageProvider.set(STORAGE_KEY,data)}function clear(){storageProvider.remove(STORAGE_KEY)}return{init:init,get:get,set:set,clear:clear}});define("src/controls/views/ContextMenuView",["backbone","jquery","jquery.showRelativeTo"],function(Backbone,$){"use strict";var menu,onCloseCallback;return Backbone.View.extend({constructor:function ContextMenuView(){Backbone.View.apply(this,arguments)},checkDefaultActionConditions:function checkDefaultActionConditions(options){return!!options.openDefault},remove:function remove(){menu=undefined;this.$el.removeRelativeTo();this.trigger("remove");return Backbone.View.prototype.remove.apply(this,arguments)},isShown:function isShown(){return!!menu}},{show:function show(options){var ViewClass=this;options=options||{};onCloseCallback=options.onClose||$.noop;if(!options.$target){throw new Error("options.$target must be set")}if(menu&&menu.$target.is(options.$target)){ViewClass.hide();return}ViewClass.hide();menu=new ViewClass(options);menu.$target=options.$target;if(menu.checkDefaultActionConditions(options)){menu.performDefaultAction();return}menu.render();menu.$el.showRelativeTo({target:options.$target,position:menu.position,onRemove:function onRemove(){ViewClass.hide()}});menu.on("remove",function(){$("body").off("click.contextMenu");menu=null;onCloseCallback()});setTimeout(function(){$("body").on("click.contextMenu",function(){ViewClass.hide()})});return menu},hide:function hide(){if(menu){menu.remove()}}})});define("mustache!templates/filterActionsContextMenu",["lib/mustache"],function(mustache){var escapedTemplate='<ul>\n<li class="context-menu--item js-copy {{^canCopy}}disabled{{/canCopy}}">\n<a><span class="icon-bwcopy lightgrey smallmargin-right"></span>Copy</a>\n</li>\n<li class="context-menu--item js-paste {{^canPaste}}disabled{{/canPaste}}">\n<a><span class="icon-paste lightgrey smallmargin-right"></span>Paste and Apply</a>\n</li>\n<li class="context-menu--item separator"></li>\n<li class="context-menu--item js-clear">\n<a><span class="icon-remove lightgrey smallmargin-right"></span>Clear Filters</a>\n</li>\n</ul>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};var ownKeys=Object.keys(source);if(typeof Object.getOwnPropertySymbols==="function"){ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))}ownKeys.forEach(function(key){_defineProperty(target,key,source[key])})}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}define("src/views/FilterActionsContextMenu",["src/globals/filtersClipboard","src/controls/views/ContextMenuView","mustache!templates/filterActionsContextMenu"],function(filtersClipboard,ContextMenuView,template){"use strict";var _events;var VIEW_SELECTORS={COPY:".js-copy",PASTE:".js-paste",CLEAR:".js-clear"};var FilterActionsContextMenu=ContextMenuView.extend({tagName:"nav",className:"componentContextMenu context-menu popupframe",position:"below-right",constructor:function FilterActionsContextMenu(_ref){var currentFilterValues=_ref.currentFilterValues;if(!currentFilterValues){throw new Error("FilterActionsContextMenu must be initialised with currentFilterValues")}filtersClipboard.init();this.currentFilterValues=currentFilterValues;ContextMenuView.apply(this,arguments)},events:(_events={},_defineProperty(_events,"click ".concat(VIEW_SELECTORS.COPY,":not(.disabled)"),"onCopy"),_defineProperty(_events,"click ".concat(VIEW_SELECTORS.PASTE,":not(.disabled)"),"onPaste"),_defineProperty(_events,"click ".concat(VIEW_SELECTORS.CLEAR),"onClear"),_events),render:function render(){var canCopy=!!Object.keys(this.currentFilterValues).length;var canPaste=!!filtersClipboard.get();this.$el.html(template({canCopy:canCopy,canPaste:canPaste}))},onCopy:function onCopy(event){event.preventDefault();event.stopPropagation();filtersClipboard.set(_objectSpread({},this.currentFilterValues));this.trigger("copied");this.remove()},onPaste:function onPaste(event){event.preventDefault();event.stopPropagation();var data=filtersClipboard.get();this.trigger("paste",data);this.remove()},onClear:function onClear(event){event.preventDefault();event.stopPropagation();this.trigger("clear");this.remove()}});return FilterActionsContextMenu});define("mustache!src/controls/filters/templates/filterOptions",["lib/mustache"],function(mustache){var escapedTemplate='{{#options}}\n<option{{#isSelected}} selected="selected"{{/isSelected}}{{#isReadOnly}} data-readonly="true"{{/isReadOnly}} value="{{value}}">\n{{text}}\n</option>\n{{/options}}\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/controls/filters/filtersHelper",["underscore","jquery","src/controls/lib/paramAssert","mustache!src/controls/filters/templates/filterOptions","text!src/controls/templates/sellecktMain.template","text!src/controls/templates/sellecktItem.template","text!src/controls/templates/sellecktPopup.template","text!src/controls/templates/sellecktSelection.template","selleckt","customtip"],function(_,$,paramAssert,filterOptionsTemplate,sellecktMainTemplate,sellecktItemTemplate,sellecktPopupTemplate,sellecktSelectionTemplate){"use strict";var EMPTY_ARRAY=[],helper={};helper.capitalize=function(text){if(!text){return""}text=String(text);return text[0].toUpperCase()+text.substring(1)};helper.css={};helper.css.getChevronClass=function getChevronClass(expanded){paramAssert.isType(expanded,"boolean","getChevronClass expects a Boolean expanded argument");return expanded?"icon-chevron-down":"icon-chevron-right"};helper.css.getExpandedClass=function getExpandedClass(expanded){paramAssert.isType(expanded,"boolean","getExpandedClass expects a Boolean expanded argument");return expanded?"":"hidden"};helper.css.getGroupClass=function getGroupClass(isActive){paramAssert.isType(isActive,"boolean","getGroupClass expects a Boolean isActive argument");return isActive?"":"hidden"};helper.css.getOnClass=function getOnClass(isActive){paramAssert.isType(isActive,"boolean","getOnClass expects a Boolean isActive argument");return isActive?"on":""};helper.css.getTickClass=function getTickClass(hasValue){paramAssert.isType(hasValue,"boolean","getTickClass expects a Boolean hasValue argument");return hasValue?"applied":"hidden"};helper.multiSelect={};helper.multiSelect.getSellecktOptions=function getSellecktOptions(title){return{className:"selleckt modular dib",mainTemplate:sellecktMainTemplate,popupTemplate:sellecktPopupTemplate,itemTemplate:sellecktItemTemplate,selectionTemplate:sellecktSelectionTemplate,placeholderText:title,alternatePlaceholder:title,unselectItemClass:"remove",mainTemplateData:{selectionBottom:true}}};helper.multiSelect.setup=function setupMultiSelects($selects,opts){$selects.each(function(index,select){var $select=$(select),title=$select.attr("title"),options=_.extend(helper.multiSelect.getSellecktOptions(title),opts||{});options.selectionTemplate=options.selectionTemplate||sellecktItemTemplate;options.mainTemplateData=options.mainTemplateData||{showSelections:true};$select.selleckt(options)})};helper.multiSelect.destroy=function destroyMultiSelects($selects){$selects.each(function(index,select){var selectData=$(select).data();if(selectData.selleckt){selectData.selleckt.destroy()}})};helper.multiSelect.renderOptions=function renderOptions(choices){paramAssert.isType(choices,"array","renderHTMLOptions expects choices argument as an Array");var templateView={options:choices.map(function(choice){return{isReadOnly:choice.isReadOnly,isSelected:choice.isSelected,value:choice.value,text:helper.capitalize(choice.text)}})};return filterOptionsTemplate(templateView)};helper.multiSelect.renderSimpleValuesAsOptions=function renderSimpleValuesAsOptions(availableValues,selectedValues){var chosenValues=Array.prototype.concat(selectedValues||EMPTY_ARRAY);return helper.multiSelect.renderOptions(availableValues.map(function(value){return{isSelected:chosenValues.indexOf(value)>-1,text:value,value:value}}))};helper.permissions={};helper.permissions.isReadOnlyForUser=function isReadOnly(item,userId){var ownerId=item.user&&item.user[0]&&item.user[0].id;return userId!==ownerId&&item.shared==="readonly"};return helper});define("src/controls/filters/SimplifiedFiltersView",["underscore","jquery","src/controls/filters/filtersHelper","src/controls/views/ControlsViewInputs","selleckt","customtip"],function(_,$,filtersHelper,ControlsViewInputs){"use strict";function getFilterTrackingName(index,tickIndicator){var filterGroupName=this.$(".active-indicator").prev().text().trim();var filterName=$(tickIndicator).data("tick-key");return filterGroupName+": "+filterName}var SimplifiedFiltersView=ControlsViewInputs.extend({className:"filterGroup",events:function events(){return{"click a.toggle":"toggleFieldset","keyup input.field":"inputChanged","blur input":"inputChanged","change select":"selectChanged"}},constructor:function SimplifiedFiltersView(){ControlsViewInputs.apply(this,arguments);this.listenTo(this.model,"change",this.refresh);this.listenTo(this.model,"invalid",this.showValidationErrors);this.expanded=false},toggleFieldset:function toggleFieldset(e){e.preventDefault();var $el=$(e.currentTarget),$icon=$el.find("span:first"),fieldset=this.$("fieldset."+$el.attr("rel"));$el.toggleClass("on");$icon.toggleClass("icon-chevron-right icon-chevron-down");fieldset.toggleClass("hidden");this.expanded=!this.expanded;this.trigger("toggle",this.expanded)},refresh:function refresh(){var self=this,data=this.model.toJSON(),groupIndicatorsOn=false;this.$("fieldset > p").each(function(i,p){var $p=$(p),$tickIndicator=$p.find(".indicator"),tickIndicatorsOn=false;$p.find("[name]").each(function(e,el){var $el=$(el),$selleckt=$el.data("selleckt"),name=$el.attr("name"),value=data[name];if(self.isNullOrEmpty(value)){value=""}if($el.attr("type")==="checkbox"||$el.attr("type")==="radio"){$el.prop("checked",!!value)}else{$el.val(value||"")}if($el.attr("type")==="range"||$el.hasClass("range")){if(value>$el.attr("min")){groupIndicatorsOn=tickIndicatorsOn=true}$el.blur()}else if(value!==""){groupIndicatorsOn=tickIndicatorsOn=true}if($selleckt){$selleckt.updateSelection($el.val())}});if(tickIndicatorsOn){$tickIndicator.addClass("applied").removeClass("hidden")}else{$tickIndicator.removeClass("applied").addClass("hidden")}});if(groupIndicatorsOn){this.$(".active-indicator").removeClass("hidden")}else{this.$(".active-indicator").addClass("hidden")}},refreshMultiSelects:function refreshMultiSelects(){var $selects=this.$("select[multiple]");filtersHelper.multiSelect.destroy($selects);filtersHelper.multiSelect.setup($selects)},inputChanged:function inputChanged(e){var $el=$(e.target),$parent=$el.parent(),item=_.extend(this.model.toJSON(),this.getValues()),showIndicator=false,errors;errors=this.model.validate(item);this.hideValidationErrors();if(errors){this.showValidationErrors(this.model,errors);return}$el.removeClass("invalid");$parent.find("input[name]").each(function(){if(!_.isEmpty($(this).val())){showIndicator=true}});this.toggleIndicator($el,showIndicator);this.trigger("changesMade")},selectChanged:function selectChanged(e){var $el=$(e.target),newVal=$el.val(),item=_.extend(this.model.toJSON(),this.getValues()),showIndicator,errors;errors=this.model.validate(item);this.hideValidationErrors();if(errors){this.showValidationErrors(this.model,errors);return}$el.removeClass("invalid");showIndicator=!_.isEmpty(newVal)&&newVal!=="-1";this.toggleIndicator($el,showIndicator);$(".tooltip").hide();$el.parent().customtip();this.trigger("changesMade")},showValidationErrors:function showValidationErrors(model,errors){var self=this;_(errors).each(function(key){self.toggleIndicator(self.$('[name="'+key+'"]').addClass("invalid"),false)})},hideValidationErrors:function hideValidationErrors(){this.$(".invalid").removeClass("invalid")},toggleIndicator:function toggleIndicator($input,showIndicator){var $parent=$input.parents("p"),indicatorSpan=$parent.find("span.indicator");if(showIndicator&&!$parent.find(".invalid").length){indicatorSpan.removeClass("hidden")}else{indicatorSpan.addClass("hidden")}},isNullOrEmpty:function isNullOrEmpty(value){return _.isArray(value)?!value.length:!value&&value!==false},getAppliedFilterNames:function getAppliedFilterNames(){return this.$(".indicator:not(.hidden)").map(getFilterTrackingName.bind(this)).get()}});return SimplifiedFiltersView});define("mustache!src/controls/filters/templates/sentiment",["lib/mustache"],function(mustache){var escapedTemplate='<p>\n<a rel="sentiment" class="toggle {{onClass}}"><span class="{{chevronClass}} grey smallpadding-right"></span>Sentiment</a>\n<span data-rel="sentiment" class="active-indicator {{groupClass}}">On</span>\n</p>\n<fieldset class="sentiment {{expandedClass}}">\n<p class="clearfix">\n<span class="indicator {{sentimentTickClass}}" data-tick-key="sentiment"></span>\n<select class="sentiment selectfield" name="sentiment" title="Sentiment" multiple>\n{{{sentimentOptions}}}\n</select>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-sentiment"></a>\n{{/showHelp}}\n</p>\n</fieldset>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/controls/filters/Sentiment/Renderer",["src/controls/filters/filtersHelper","src/controls/lib/paramAssert","mustache!src/controls/filters/templates/sentiment"],function(filtersHelper,paramAssert,template){"use strict";var Renderer={};Renderer.getTemplateView=function getTemplateView(options){paramAssert.isType(options.showHelp,"boolean","getTemplateView expects showHelp option to be a Boolean");paramAssert.isType(options.isOn,"boolean","getTemplateView expects isOn option to be a Boolean");paramAssert.isType(options.isExpanded,"boolean","getTemplateView expects isExpanded option to be a Boolean");paramAssert.isType(options.sentiments,"array","getTemplateView expects sentiments option to be an Array");paramAssert.isType(options.selectedSentiments,"array","getTemplateView expects selectedSentiments option to be an Array");var renderSimpleValuesAsOptions=filtersHelper.multiSelect.renderSimpleValuesAsOptions,templateView={showHelp:options.showHelp,onClass:filtersHelper.css.getOnClass(options.isExpanded),groupClass:filtersHelper.css.getGroupClass(options.isOn),chevronClass:filtersHelper.css.getChevronClass(options.isExpanded),expandedClass:filtersHelper.css.getExpandedClass(options.isExpanded),sentimentTickClass:filtersHelper.css.getTickClass(options.selectedSentiments.length>0),sentimentOptions:renderSimpleValuesAsOptions(options.sentiments,options.selectedSentiments)};return templateView};Renderer.render=function render(options){var templateView=Renderer.getTemplateView(options),html=template(templateView);return html};return Renderer});define("src/controls/filters/SentimentFilters",["jquery","q","underscore","src/controls/lib/paramAssert","src/controls/filters/SimplifiedFiltersView","src/controls/filters/filtersHelper","src/controls/filters/Sentiment/Renderer","jquery.spin"],function($,Q,_,paramAssert,SimplifiedFiltersView,filtersHelper,Renderer){"use strict";var EMPTY_ARRAY=[];function fetchDataAndRender(view,metrics){function showError(error){console.error(error.stack||error.message);$.notify("error loading sentiments: "+error.message)}return Q.nbind(metrics.load,metrics)().then(function(model){var sentiments=model.get("sentiments");paramAssert.isType(sentiments,"array","sentiments expected to be an Array");view.sentiments=sentiments;view.dataLoaded=true;return view.render()}).fail(showError)}var SentimentFilters=SimplifiedFiltersView.extend({constructor:function SentimentFilters(options){var showHelpErrorMessage='SentimentFilters must be instantiated with a Boolean "showHelp" option';SimplifiedFiltersView.apply(this,arguments);paramAssert.isNotDefined(options,"SentimentFilters must be instantiated with an options argument");paramAssert.isNotDefined(options.showHelp,showHelpErrorMessage);paramAssert.isType(options.showHelp,"boolean",showHelpErrorMessage);this.showHelp=options.showHelp;paramAssert.isNotDefined(options.metrics,"SentimentFilters requires metrics to be passed");this.fetchDataAndRender=_.partial(fetchDataAndRender,this,options.metrics);this.listenTo(this,"toggle",this.onToggle)},onToggle:function onToggle(on){var view=this,$fieldset=view.$("fieldset.sentiment");if(!on||view.dataLoaded){return}view.$el.spin();$fieldset.css("visibility","hidden");view.fetchDataAndRender()},render:function render(){var data=this.model.toJSON(),html=Renderer.render({showHelp:this.showHelp,isOn:Boolean(data.sentiment&&data.sentiment.length),isExpanded:this.expanded,sentiments:this.dataLoaded?this.sentiments:EMPTY_ARRAY,selectedSentiments:Array.prototype.concat(this.model.get("sentiment")||EMPTY_ARRAY)}),$el=$(html),$selects=$el.find("select[multiple]");filtersHelper.multiSelect.setup($selects);$el.customtip();this.$el.html($el)},getValues:function getValues(){var dataLoaded=this.dataLoaded,values={sentiment:dataLoaded?this.$("[name=sentiment]").val():this.model.get("sentiment")};return values}});return SentimentFilters});define("src/controls/filters/FiltersView",["underscore","jquery","src/controls/lib/paramAssert","src/controls/filters/SimplifiedFiltersView","src/controls/lib/validationHelpers","text!src/controls/templates/sellecktMain.template","text!src/controls/templates/sellecktPopup.template","text!src/controls/templates/sellecktItem.template","text!src/controls/templates/sellecktSelection.template","selleckt","css!src/controls/css/sellecktPopup.css","customtip"],function(_,$,paramAssert,SimplifiedFiltersView,validationHelpers,sellecktMainTemplate,sellecktPopupTemplate,sellecktItemTemplate,sellecktSelectionTemplate){"use strict";return SimplifiedFiltersView.extend({constructor:function FiltersView(options){paramAssert.isNotDefined(options,"options must be defined!");paramAssert.isType(options.showHelp,"boolean","options.showHelp must be defined!");SimplifiedFiltersView.apply(this,arguments);this.showHelp=options.showHelp},makeEl:function makeEl(){throw new Error("FiltersView.makeEl needs to be overridden by your own class")},render:function render(){var el=this.makeEl(this.model.toJSON());this.$el.html(el);this.setupMultiSelects()},getSellecktOptions:function getSellecktOptions($select){var title=$select.attr("title");return{placeholderText:title,alternatePlaceholder:title,mainTemplate:sellecktMainTemplate,itemTemplate:sellecktItemTemplate,popupTemplate:sellecktPopupTemplate,selectionTemplate:sellecktSelectionTemplate,unselectItemClass:"remove",mainTemplateData:{selectionBottom:true}}},setupMultiSelects:function setupMultiSelects(){var self=this;this.$("select[multiple]").each(function(){var $select=$(this),options=self.getSellecktOptions($select);$select.selleckt(options);$select.parent().customtip()})},refreshMultiSelects:function refreshMultiSelects(){this.$("select[multiple]").each(function(){var selectData=$(this).data();if(selectData.selleckt){selectData.selleckt.destroy()}});this.setupMultiSelects()},getTemplateData:function getTemplateData(){var model=this.model,data=this.model.toJSON(),filterClasses=this.getFilterIndicatorStatuses(model),expanded=this.expanded;return _.extend(data,{cid:_.uniqueId(),isPositiveNumberRegex:validationHelpers.isPositiveNumberRegex?validationHelpers.isPositiveNumberRegex.source:"",showHelp:this.showHelp,getTickClass:function getTickClass(){return function(name){return filterClasses.tickIndicators[name]?"applied":"hidden"}},groupClass:filterClasses.groupIndicators?"":"hidden",onClass:filterClasses.groupIndicators?"on":"",expandedClass:expanded?"":"hidden",chevronClass:expanded?"icon-chevron-down":"icon-chevron-right"})},getFilterIndicatorStatuses:function getFilterIndicatorStatuses(){throw new Error("FiltersView.getFilterIndicatorStatuses needs to be overridden by your own class")},isNullOrEmpty:function isNullOrEmpty(value){return _.isArray(value)?!value.length:!value&&value!==false}})});define("mustache!src/controls/filters/templates/emotion",["lib/mustache"],function(mustache){var escapedTemplate='<p>\n<a rel="emotion" class="toggle {{onClass}}"><span class="{{chevronClass}} grey smallpadding-right"></span>Sentiment &amp; Emotion</a>\n<span data-rel="emotion" class="active-indicator {{groupClass}}">On</span>\n</p>\n<fieldset class="emotion {{expandedClass}}">\n<p class="sentiment clearfix">\n<span class="indicator {{#getTickClass}}sentiment{{/getTickClass}}" data-tick-key="sentiment"></span>\n<select class="sentiment selectfield" name="sentiment" title="Sentiment" multiple>\n{{#sentimentOptions}}{{{.}}}{{/sentimentOptions}}\n</select>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-sentiment"></a>\n{{/showHelp}}\n</p>\n\n<p class="emotion clearfix">\n<span class="indicator {{#getTickClass}}emotion{{/getTickClass}}" data-tick-key="emotion"></span>\n<select class="emotion selectfield" name="classifications" title="Emotion" multiple>\n{{#emotionOptions}}{{{.}}}{{/emotionOptions}}\n</select>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-emotion"></a>\n{{/showHelp}}\n</p>\n<p class="xemotion clearfix">\n<span class="indicator {{#getTickClass}}xemotion{{/getTickClass}}" data-tick-key="xemotion"></span>\n<select class="xemotion selectfield" name="xclassifications" title="Exclude Emotion" multiple>\n{{#xemotionOptions}}{{{.}}}{{/xemotionOptions}}\n</select>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-xemotion"></a>\n{{/showHelp}}\n</p>\n</fieldset>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/controls/filters/SentimentAndEmotionsFilters",["src/controls/filters/FiltersView","src/controls/lib/controlsViewDataBuilder","mustache!src/controls/filters/templates/emotion"],function(FiltersView,controlsViewDataBuilder,template){"use strict";function isEmotionsClassification(classificationName){return classificationName.startsWith("emotions:")}var EmotionsFilters=FiltersView.extend({constructor:function EmotionsFilters(options){FiltersView.apply(this,arguments);this.emotions=options.emotions;this.metrics=options.metrics},getSelectedSentiment:function getSelectedSentiment(){return this.model.get("sentiment")||[]},getSelectedEmotions:function getSelectedEmotions(){return(this.model.get("classifications")||[]).filter(isEmotionsClassification)},getExcludedEmotions:function getExcludedEmotions(){return(this.model.get("xclassifications")||[]).filter(isEmotionsClassification)},makeEl:function makeEl(data,sentiment){var emotions=this.emotions.map(function(_ref){var id=_ref.id,name=_ref.name;return{id:"emotions:".concat(id),name:name}}).sort(function(a,b){return a.name.localeCompare(b.name)});var selectedEmotions=this.getSelectedEmotions();var excludedEmotions=this.getExcludedEmotions();var selectedSentiment=this.getSelectedSentiment();var templateData=Object.assign({},this.getTemplateData(data),{sentimentOptions:controlsViewDataBuilder.buildOptionsFromArray(sentiment,selectedSentiment),emotionOptions:controlsViewDataBuilder.buildOptionsFromObject(emotions,selectedEmotions),xemotionOptions:controlsViewDataBuilder.buildOptionsFromObject(emotions,excludedEmotions)});return template(templateData)},render:function render(){var _this=this;this.metrics.load(function(_,metrics){var sentiments=metrics.get("sentiments");var el=_this.makeEl(_this.model.toJSON(),sentiments);_this.$el.html(el);_this.setupMultiSelects()})},getValues:function getValues(){var sentiment=this.$("[name=sentiment]").val();var emotion=this.$("[name=classifications]").val();var xemotion=this.$("[name=xclassifications]").val();return{sentiment:sentiment,classifications:emotion,xclassifications:xemotion}},getFilterIndicatorStatuses:function getFilterIndicatorStatuses(){var tickIndicators={sentiment:!this.isNullOrEmpty(this.getSelectedSentiment()),emotion:!this.isNullOrEmpty(this.getSelectedEmotions()),xemotion:!this.isNullOrEmpty(this.getExcludedEmotions())};var groupIndicators=tickIndicators.emotion||tickIndicators.xemotion||tickIndicators.sentiment;return{tickIndicators:tickIndicators,groupIndicators:groupIndicators}}});return EmotionsFilters});define("mustache!src/controls/filters/templates/pageAndMentionType",["lib/mustache"],function(mustache){var escapedTemplate='<p>\n<a rel="mentionType" class="toggle {{onClass}}">\n<span class="{{chevronClass}} grey smallpadding-right"></span>Page & Mention Type\n</a>\n<span data-rel="mentionType" class="active-indicator {{groupClass}}">On</span>\n</p>\n<fieldset class="mentionType {{expandedClass}}">\n<p class="inclPageTypes clearfix">\n<span class="indicator {{#getTickClass}}pageType{{/getTickClass}}" data-tick-key="pageType"></span>\n{{#dataLoaded}}\n<select class="pageType selectfield" name="pageType" title="Page Type" multiple>\n{{{pageTypeOptions}}}\n</select>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-pagetype"></a>\n{{/showHelp}}\n{{/dataLoaded}}\n</p>\n<p class="exclPageTypes clearfix">\n<span class="indicator {{#getTickClass}}xpageType{{/getTickClass}}" data-tick-key="xpageType"></span>\n{{#dataLoaded}}\n<select class="xpageType selectfield" name="xpageType" title="Exclude Page Type" multiple>\n{{{excludedPageTypeOptions}}}\n</select>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-exclude-pagetype"></a>\n{{/showHelp}}\n{{/dataLoaded}}\n</p>\n{{#showSubTypeFilter}}\n<p class="subtype clearfix doublemargin-top">\n<span class="indicator {{#getTickClass}}subtype{{/getTickClass}}" data-tick-key="subtype"></span>\n{{#dataLoaded}}\n<select class="subtype selectfield" name="subtype" title="Media Type" multiple>\n{{{subTypeOptions}}}\n</select>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-subtype"></a>\n{{/showHelp}}\n{{/dataLoaded}}\n</p>\n{{/showSubTypeFilter}}\n<p class="mentiontype clearfix doublemargin-top">\n<span class="indicator {{#getTickClass}}threadEntryType{{/getTickClass}}" data-tick-key="threadEntryType"></span>\n<select class="mentiontype selectfield" name="threadEntryType" title="Mention Type" multiple>\n{{#mentionTypeOptions}}{{{.}}}{{/mentionTypeOptions}}\n</select>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-mentiontype"></a>\n{{/showHelp}}\n</p>\n<p class="xmentiontype clearfix">\n<span class="indicator {{#getTickClass}}xthreadEntryType{{/getTickClass}}" data-tick-key="xthreadEntryType"></span>\n<select class="xmentiontype selectfield" name="xthreadEntryType" title="Exclude Mention Type" multiple>\n{{#xmentionTypeOptions}}{{{.}}}{{/xmentionTypeOptions}}\n</select>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-xmentiontype"></a>\n{{/showHelp}}\n</p>\n</fieldset>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/controls/filters/PageAndMentionTypeFilters",["src/controls/filters/FiltersView","src/controls/lib/controlsViewDataBuilder","src/globals/metrics","mustache!src/controls/filters/templates/pageAndMentionType"],function(FiltersView,controlsViewDataBuilder,globalMetrics,template){"use strict";var DATA_KEYS=["pageType","xpageType","subtype","threadEntryType","xthreadEntryType"];var MENTION_TYPES=[{name:"Post / Original Tweet",id:"post"},{name:"Comment / Reply",id:"reply"},{name:"Retweet",id:"share"}];var PageAndMentionTypeFilters=FiltersView.extend({constructor:function PageAndMentionTypeFilters(options){var _this=this;FiltersView.apply(this,arguments);this.showSubTypeFilter=!!options.showSubTypeFilter;this.dataLoaded=false;var fetchDataCalls=[globalMetrics.fetchPageTypes().then(function(pageTypes){return _this.pageTypes=pageTypes})];if(this.showSubTypeFilter){fetchDataCalls.push(globalMetrics.fetchSubTypes().then(function(subTypes){return _this.subTypes=subTypes}))}Promise.all(fetchDataCalls).then(function(){_this.dataLoaded=true;_this.render()}).catch(function(error){console.error("Unable to load metrics",error)})},makeEl:function makeEl(data){var pageTypes=this.pageTypes;var subTypes=this.subTypes;var _this$model$toJSON=this.model.toJSON(),_this$model$toJSON$pa=_this$model$toJSON.pageType,selectedPageTypes=_this$model$toJSON$pa===void 0?[]:_this$model$toJSON$pa,_this$model$toJSON$xp=_this$model$toJSON.xpageType,excludedPageTypes=_this$model$toJSON$xp===void 0?[]:_this$model$toJSON$xp,_this$model$toJSON$su=_this$model$toJSON.subtype,selectedSubTypes=_this$model$toJSON$su===void 0?[]:_this$model$toJSON$su,_this$model$toJSON$th=_this$model$toJSON.threadEntryType,selectedMentionTypes=_this$model$toJSON$th===void 0?[]:_this$model$toJSON$th,_this$model$toJSON$xt=_this$model$toJSON.xthreadEntryType,excludedMentionTypes=_this$model$toJSON$xt===void 0?[]:_this$model$toJSON$xt;data=Object.assign(this.getTemplateData(),{dataLoaded:this.dataLoaded,selectedPageTypes:selectedPageTypes,pageTypeOptions:controlsViewDataBuilder.buildOptionsFromArray(pageTypes,selectedPageTypes),excludedPageTypes:excludedPageTypes,excludedPageTypeOptions:controlsViewDataBuilder.buildOptionsFromArray(pageTypes,excludedPageTypes),showSubTypeFilter:this.showSubTypeFilter,subTypeOptions:this.showSubTypeFilter&&controlsViewDataBuilder.buildOptionsFromArray(subTypes,selectedSubTypes),selectedMentionTypes:selectedMentionTypes,mentionTypeOptions:controlsViewDataBuilder.buildOptionsFromObject(MENTION_TYPES,selectedMentionTypes),excludedMentionTypes:excludedMentionTypes,xmentionTypeOptions:controlsViewDataBuilder.buildOptionsFromObject(MENTION_TYPES,excludedMentionTypes),cid:this.cid});return template(data)},getValues:function getValues(){var _this2=this;var values={};DATA_KEYS.forEach(function(key){return values[key]=_this2.$("[name=".concat(key,"]")).val()});return values},getFilterIndicatorStatuses:function getFilterIndicatorStatuses(model){var _this3=this;var tickIndicators={};DATA_KEYS.forEach(function(key){return tickIndicators[key]=!_this3.isNullOrEmpty(model.get(key))});var groupIndicators=Object.keys(tickIndicators).some(function(key){return tickIndicators[key]});return{tickIndicators:tickIndicators,groupIndicators:groupIndicators}}});return PageAndMentionTypeFilters});define("mustache!src/controls/filters/templates/forumThread",["lib/mustache"],function(mustache){var escapedTemplate='<p>\n<a rel="forum" class="toggle"><span class="icon-chevron-right grey smallpadding-right"></span>Forum thread</a>\n<span data-rel="forum" class="active-indicator {{groupClass}}">On</span>\n</p>\n<fieldset class="forum hidden">\n<p class="clearfix">\n<span class="indicator {{#getTickClass}}forumPosts{{/getTickClass}}" data-tick-key="forumPosts"></span>\n<label for="forumPostsMin{{cid}}">Posts</label>\n<input name="forumPostsMin" id="forumPostsMin{{cid}}" placeholder="Min" class="field num" pattern="{{isPositiveNumberRegex}}" value="{{forumPostsMin}}"/>\n<span> to </span>\n<input name="forumPostsMax" placeholder="Max" class="field num" pattern="{{isPositiveNumberRegex}}" value="{{forumPostsMax}}"/>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-forum-posts" ></a>\n{{/showHelp}}\n</p>\n<p class="clearfix">\n<span class="indicator {{#getTickClass}}forumViews{{/getTickClass}}" data-tick-key="forumViews"></span>\n<label for="forumViewsMin{{cid}}">Views</label>\n<input name="forumViewsMin" id="forumViewsMin{{cid}}" placeholder="Min" class="field num" pattern="{{isPositiveNumberRegex}}" value="{{forumViewsMin}}"/>\n<span> to </span>\n<input name="forumViewsMax" placeholder="Max" class="field num" pattern="{{isPositiveNumberRegex}}" value="{{forumViewsMax}}"/>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-forum-views" ></a>\n{{/showHelp}}\n</p>\n</fieldset>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/controls/filters/ForumThreadFilters",["src/controls/filters/FiltersView","mustache!src/controls/filters/templates/forumThread"],function(FiltersView,template){"use strict";return FiltersView.extend({constructor:function ForumThreadFilters(){FiltersView.apply(this,arguments)},makeEl:function makeEl(data){return template(this.getTemplateData(data))},getFilterIndicatorStatuses:function getFilterIndicatorStatuses(model){var ticks={forumPosts:!this.isNullOrEmpty(model.get("forumPostsMin"))||!this.isNullOrEmpty(model.get("forumPostsMax")),forumViews:!this.isNullOrEmpty(model.get("forumViewsMin"))||!this.isNullOrEmpty(model.get("forumViewsMax"))},groups=ticks.forumPosts||ticks.forumViews;return{tickIndicators:ticks,groupIndicators:groups}}})});define("mustache!src/controls/filters/templates/blog",["lib/mustache"],function(mustache){var escapedTemplate='<p>\n<a rel="blog" class="toggle"><span class="icon-chevron-right grey smallpadding-right"></span>Blog</a>\n<span data-rel="blog" class="active-indicator {{groupClass}}">On</span>\n</p>\n<fieldset class="blog hidden">\n<p class="clearfix">\n<span class="indicator doubleheight {{#getTickClass}}blogComments{{/getTickClass}}" data-tick-key="blogComments"></span>\n<label for="blogCommentsMin{{cid}}">Comments per Post</label>\n<input name="blogCommentsMin" id="blogCommentsMin{{cid}}" placeholder="Min" class="field num" pattern="{{isPositiveNumberRegex}}" value="{{blogCommentsMin}}"/>\n<span> to </span>\n<input name="blogCommentsMax" placeholder="Max" class="field num" pattern="{{isPositiveNumberRegex}}" value="{{blogCommentsMax}}"/>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-blog-comments"></a>\n{{/showHelp}}\n</p>\n</fieldset>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/controls/css/blogFilters.css",["css!src/controls/css/compiled.css"],function(){});define("src/controls/filters/BlogFilters",["src/controls/filters/FiltersView","mustache!src/controls/filters/templates/blog","css!src/controls/css/blogFilters.css"],function(FiltersView,template){"use strict";return FiltersView.extend({constructor:function BlogFilters(){FiltersView.apply(this,arguments)},makeEl:function makeEl(data){return template(this.getTemplateData(data))},getFilterIndicatorStatuses:function getFilterIndicatorStatuses(model){var ticks={blogComments:!this.isNullOrEmpty(model.get("blogCommentsMin"))||!this.isNullOrEmpty(model.get("blogCommentsMax"))},groups=ticks.blogComments;return{tickIndicators:ticks,groupIndicators:groups}}})});define("src/controls/buildApiUrl",["src/controls/settings"],function(controlsSettings){"use strict";function buildApiUrl(segment){return[controlsSettings.apiUrl,segment].join("/").replace(/([^:])\/+/g,"$1/")}return buildApiUrl});define("src/controls/filters/locations/LocationProvider",["jquery","underscore","src/controls/buildApiUrl"],function($,_,buildApiUrl){"use strict";var cache={},LocationProvider;function fetchCode(code,url){url+="/"+code;return $.ajax({url:url}).then(function(data){return data})}function defaultUrl(){return buildApiUrl("/locations")}LocationProvider=function LocationProvider(options){this.url=_.result(options,"url")||defaultUrl()};LocationProvider.prototype.addToCache=function(code,location){cache[code]=$.Deferred().resolve(location).promise()};LocationProvider.prototype.clearCache=function(){cache={}};LocationProvider.prototype.fetch=function(codes){var deferreds=[],url=this.url;deferreds=[].concat(codes||[]).map(function(code){return cache[code]||(cache[code]=fetchCode(code,url))});return $.when.apply(this,deferreds).then(function doneFilter(){var argsArray=Array.prototype.slice.apply(arguments);return argsArray})};return LocationProvider});define("mustache!src/controls/filters/templates/locationAutocomplete",["lib/mustache"],function(mustache){var escapedTemplate='<form>\n<input type="text" autocomplete="off" class="field autocomplete" name="locations" placeholder="Select Location...">\n</form>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});(function($,_){"use strict";var defaults={showAllResultsOnFocusOrEmpty:false,renderList:function(items){return"<ul>"+items+"</ul>"}};function LocalSearch(options){if(!options){throw new Error("options should be defined")}if(!options.data){throw new Error("options.data should be defined")}if(!options.isMatch){throw new Error("options.isMatch should be defined")}this.options=$.extend({},defaults,options);this._data=options.data}LocalSearch.prototype.attach=function(autocomplete){var localSearch=this;var keyup=autocomplete.keyup;var resultSelected=autocomplete.resultSelected;var renderResults=autocomplete.renderResults;var hasResults=autocomplete.hasResults;if(this.options.showAllResultsOnFocusOrEmpty){LocalSearch.prototype.showAllResults=function(){localSearch.results=_(localSearch._data).filter(function(item){return autocomplete.options.filterResult.call(autocomplete,item)});autocomplete.$results.empty().append(autocomplete.renderResults()).show().find("li").filter(":first").addClass("highlight")};autocomplete.focus=function(){autocomplete.options.onFocus();localSearch.showAllResults()};autocomplete.keyup=function(){var previousPrefix=autocomplete.previousPrefix;keyup.apply(autocomplete,arguments);if(autocomplete.prefix===""&&previousPrefix!==""){localSearch.showAllResults()}}}autocomplete.hasResults=function(){localSearch.results=_(localSearch._data).filter(function(item){return localSearch.options.isMatch(item,autocomplete.prefix)&&autocomplete.options.filterResult.call(autocomplete,item)});return hasResults.call(autocomplete)||localSearch.results.length};autocomplete.renderResults=function(){var autocomplete=this;var renderResult=_.isFunction(localSearch.options.renderResult)?localSearch.options.renderResult:autocomplete.options.renderResult;var html=renderResults.apply(autocomplete,arguments);var localItems=_(localSearch.results).map(function(result){return'<li><a href="#" data-id="local-'+result.id+'">'+renderResult.call(autocomplete,result)+"</a></li>"}).join("");return localSearch.options.renderList(localItems,autocomplete._data.length>0)+html};autocomplete.resultSelected=function(e,$anchor){e.preventDefault();var id=$anchor.attr("data-id")||"";var result;if(id.indexOf("local-")===0){id=parseInt(id.replace("local-",""),10);result=_(localSearch._data).find(function(item){return item.id===id});autocomplete.options.selected.call(autocomplete,result);autocomplete.afterResultSelected()}else{resultSelected.apply(autocomplete,arguments)}};autocomplete.navigateUp=function(){var $highlight=autocomplete.$results.find(".highlight");var $prevLi;if(!$highlight.length){this.$results.find("ul li").filter(":first").addClass("highlight")}else{$prevLi=$highlight.prev();if($prevLi.length){$prevLi.addClass("highlight").next().removeClass()}else{$prevLi=$highlight.parent().prevAll("ul").filter(":last").find("li").filter(":last");if($prevLi.length){$highlight.removeClass();$prevLi.addClass("highlight")}}}autocomplete.scroll("up")};autocomplete.navigateDown=function(){var $highlight=autocomplete.$results.find(".highlight");var $nextLi;if(!$highlight.length){this.$results.find("ul li").filter(":first").addClass("highlight")}else{$nextLi=$highlight.next();if($nextLi.length){$nextLi.addClass("highlight").prev().removeClass()}else{$nextLi=$highlight.parent().nextAll("ul").filter(":first").find("li").filter(":first");if($nextLi.length){$highlight.removeClass();$nextLi.addClass("highlight")}}}autocomplete.scroll("down")};return this};$.fn.autocomplete.localsearch=LocalSearch;return LocalSearch})($,_);define("jquery.autocomplete/jquery.autocomplete.localsearch",["jquery.autocomplete/jquery.autocomplete"],function(global){return function(){var ret,fn;return ret||global.jQuery.fn.autocomplete.localsearch}}(this));define("src/controls/filters/LocationFiltersAutocomplete",["backbone","underscore","jquery","src/controls/lib/paramAssert","src/controls/buildApiUrl","mustache!src/controls/filters/templates/locationAutocomplete","jquery.showRelativeTo","jquery.autocomplete/jquery.autocomplete","jquery.autocomplete/jquery.autocomplete.ajax","jquery.autocomplete/jquery.autocomplete.localsearch"],function(Backbone,_,$,paramAssert,buildApiUrl,template){"use strict";function isReadonly(item,userId){var ownerId=item.user&&item.user.length?item.user[0].id:"undefined";return userId!==ownerId&&item.shared==="readonly"}return Backbone.View.extend({className:"locationFiltersAutocomplete singlepadding lightgreybg rounded",constructor:function LocationFiltersAutocomplete(options){Backbone.View.apply(this,arguments);this.options=options||{};paramAssert.isNotDefined(options||options.locationGroups,"options.locationGroups must be supplied");paramAssert.isNotDefined(options||options.userId,"options.userId must be supplied");paramAssert.isType(this.options.getSelectedIds,"function","LocationFiltersAutocomplete expects getSelectedIds");paramAssert.isType(this.options.callback,"function","LocationFiltersAutocomplete expects a callback");this.locationGroups=options.locationGroups;this.userId=options.userId;this.url=_.result(options,"url")||buildApiUrl("/locations")},remove:function remove(){this.$el.removeRelativeTo();$("body").off("mousedown.removeLocationFiltersAutocomplete");Backbone.View.prototype.remove.call(this)},render:function render(){this.$el.html(template({}));return this},initAutocomplete:function initAutocomplete(options){var self=this,$autocomplete=this.$(".autocomplete"),userId=this.userId,locationGroups=this.locationGroups,defaults={css:{width:450},onBlur:function onBlur(e){if(e.which&&(e.which===9||e.which===27)){self.remove()}},renderResult:function renderResult(result){return self.formatLocationName(result.fullName)},filterResult:function filterResult(result){return self.options.getSelectedIds().indexOf(result.id)===-1},parseData:function parseData(data){return data.results},selected:function selected(result){self.options.callback(result,$(this));self.remove()},plugins:[{plugin:$.fn.autocomplete.ajax,options:{url:this.url,params:{pageSize:20,page:0}}},{plugin:$.fn.autocomplete.localsearch,options:{showAllResultsOnFocusOrEmpty:true,data:locationGroups.map(function(locationGroup){return{id:locationGroup.get("id"),name:locationGroup.get("name"),readonly:isReadonly(locationGroup.toJSON(),userId),type:"locationGroup"}}),renderResult:function renderResult(result){return"<em>"+_.escape(result.name)+"</em>"},isMatch:function isMatch(item,prefix){return item.name.toLowerCase().indexOf(prefix)===0},renderList:function renderList(items,hasRemoteItems){var list="";if(items.length){list+="<p>Your custom Location Lists</p><ul>"+items+"</ul>"}list+="<p>System locations</p>";if(!hasRemoteItems){list+='<p class="tip">Type to find locations</p>'}return list}}}]};$autocomplete.autocomplete(_.extend({},defaults,options||{}));_.defer(function(){$autocomplete.focus()})},showNextTo:function showNextTo($target,position){var $el=this.$el,positionForPlugin;positionForPlugin=_.isFunction(position)?position:function(){var targetOffset=$target.offset(),left=position==="right"?targetOffset.left-12:targetOffset.left-($el.outerWidth()-$target.outerWidth())+12;return{position:"absolute",top:targetOffset.top-12,left:left}};$el.appendTo("body").showRelativeTo({target:$target,position:positionForPlugin});this.initAutocomplete();$("body").on("mousedown.removeLocationFiltersAutocomplete",_.bind(this.remove,this))},formatLocationName:function formatLocationName(name){var commaIdx=name.indexOf(",");name="<em>"+name.substring(0,commaIdx>-1?commaIdx:name.length)+"</em>"+(commaIdx>-1?name.substring(commaIdx,name.length):"");return name.length>83?name.substring(0,80)+"...":name}})});define("mustache!src/controls/filters/templates/genericLocation",["lib/mustache"],function(mustache){var escapedTemplate='<div class="location" name="locations">\n{{#ownDashboard}}\n{{#hasUnknownLocationList}}\n<p class="unknown clearfix">\n<span class="icon info"></span>\nLocation Group filters<br/>applied\n<a class="help icon-bwhelp" data-key="filters-unknown-group-applied" tabIndex="-1"></a>\n</p>\n{{/hasUnknownLocationList}}\n{{/ownDashboard}}\n\n<span class="indicator {{locationIndicatorClass}}" data-tick-key="{{filterKeyLocation}}"></span>\n<label>Filter by {{filterLabel}}</label><a class="new iconsmaller icon-plus grey smallmargin-left customtip" data-type="include" title="Create new Location List"></a>\n\n{{#sharedLocationGroupApplied}}\n<p class="shared clearfix">\n<span class="icon info"></span>\nLocation List filters are applied\n<a class="help icon-bwhelp" data-key="filters-location-shared-group-applied" tabIndex="-1"></a>\n</p>\n{{/sharedLocationGroupApplied}}\n\n<p class="clearfix {{#showNewTag}}newAndHelp{{/showNewTag}}">\n<input type="text" class="field autocomplete" name="locations" placeholder="Select Location...">\n{{#showNewTag}}\n<span title="{{filterLabel}} is NEW" class="newIcon"></span>\n{{/showNewTag}}\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="{{helpKey}}" ></a>\n{{/showHelp}}\n</p>\n<ul class="locations dib modular include {{#hideIncludeList}}hidden{{/hideIncludeList}}">\n{{{locations}}}\n</ul>\n</div>\n<div class="location" name="xlocations">\n<span class="indicator {{xlocationIndicatorClass}}" data-tick-key="xlocations"></span>\n<label>Exclude {{filterLabel}}</label><a class="new iconsmaller icon-plus grey smallmargin-left customtip" data-type="exclude" title="Create new Location List"></a>\n\n{{#sharedxLocationGroupApplied}}\n<p class="shared clearfix">\n<span class="icon info"></span>\nLocation List filters are applied\n<a class="help icon-bwhelp" data-key="filters-location-shared-group-applied" tabIndex="-1"></a>\n</p>\n{{/sharedxLocationGroupApplied}}\n\n<p class="clearfix {{#showNewTag}}newAndHelp{{/showNewTag}}">\n<input type="text" class="field autocomplete" name="xlocations" placeholder="Select Location...">\n{{#showNewTag}}\n<span title="{{filterLabel}} is NEW" class="newIcon"></span>\n{{/showNewTag}}\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="{{helpKey}}" ></a>\n{{/showHelp}}\n</p>\n<ul class="locations dib modular exclude {{#hideExcludeList}}hidden{{/hideExcludeList}}">\n{{{xlocations}}}\n</ul>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/controls/filters/templates/locationItem",["lib/mustache"],function(mustache){var escapedTemplate='<li data-type="{{type}}" data-id="{{id}}">\n<span class="smallpadding-left dib textellipsis customtip nowrap fullwidth {{^system}}ellipsistooltip{{/system}}" title="{{title}}">{{name}}</span>\n<a class="remove absright smallmargin-right customtip" title="Remove filter"><span class="iconsmaller icon-remove grey"></span></a>\n{{#system}}\n<a class="shared system absright customtip" title="System defined location"><span class="icon-lock grey"></span></a>\n{{/system}}\n{{^system}}\n{{#readonly}}\n<a class="shared absright customtip" title="Sorry, read-only"><span class="icon-lock grey"></span></a>\n{{/readonly}}\n{{^readonly}}\n<a class="edit absright customtip" title=\'Edit "{{name}}"\'><span class="icon-pencil grey"></span></a>\n{{/readonly}}\n{{/system}}\n</li>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/controls/filters/templates/locationLoading",["lib/mustache"],function(mustache){var escapedTemplate='<fieldset class="location hidden" name="locations">\n<p>Loading...</p>\n</fieldset>';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/controls/filters/templates/locationFetchFailed",["lib/mustache"],function(mustache){var escapedTemplate='<fieldset class="location" name="locations">\n<p class="warning">\nSorry, the location filters have not loaded properly.\nPlease try loading the dashboard again.\n</p>\n</fieldset>';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/controls/filters/GenericLocationFilters",["backbone","underscore","jquery","src/controls/lib/paramAssert","src/controls/controlsEvents","src/controls/filters/locations/LocationProvider","src/controls/filters/LocationFiltersAutocomplete","mustache!src/controls/filters/templates/genericLocation","mustache!src/controls/filters/templates/locationItem","mustache!src/controls/filters/templates/locationLoading","mustache!src/controls/filters/templates/locationFetchFailed","customtip"],function(Backbone,_,$,paramAssert,controlsEvents,LocationProvider,LocationFiltersAutocomplete,locationTemplate,locationItemTemplate,locationLoadingTemplate,locationFetchFailedTemplate){"use strict";function getFormattedLocations(locationKey,locationGroupKey,data,locationData,sortingLookup,userId,locationGroups){var locations=[].concat(formatLocations(locationKey,data,locationData)).concat(formatLocationGroups(locationGroupKey,data,userId,locationGroups));return compactAndSortFormattedLocations(locations,sortingLookup)}function getFormattedXlocations(xlocationKey,xlocationGroupKey,data,locationData,sortingLookup,userId,locationGroups){var xlocations=[].concat(formatLocations(xlocationKey,data,locationData)).concat(formatLocationGroups(xlocationGroupKey,data,userId,locationGroups));return compactAndSortFormattedLocations(xlocations,sortingLookup)}function formatLocations(modelKey,modelData,locationData){var locationIds=[].concat(modelData[modelKey]||[]),formattedLocations=_(locationIds).map(function makeLocationObject(locationId){var dataForLocation=_(locationData).find(function findLocationDataForId(location){return location.id===locationId});if(!dataForLocation){console.warn("No data for location: ",locationId);return}return{id:locationId,type:modelKey,readonly:true,system:true,title:dataForLocation.fullName,name:dataForLocation.name}});return formattedLocations}function formatLocationGroups(modelKey,modelData,userId,locationGroups){return _(modelData[modelKey]).map(function formatLocationGroupAsObject(locationGroupId){var locationGroup=locationGroups.get(locationGroupId);if(!locationGroup){return}return{id:locationGroupId,type:modelKey,readonly:isReadonly(locationGroup.toJSON(),userId),name:locationGroup.get("name"),title:locationGroup.get("name")}})}function compactAndSortFormattedLocations(formattedLocations,sortingLookup){return _(formattedLocations).chain().flatten().compact().sortBy(function lookupSortIndex(location){return sortingLookup[location.id]}).value()}function buildLocationItems(locationList){return _(locationList).chain().map(function(location){return locationItemTemplate(location,false)}).value().join("")}function hasUnknownLocationList(locationGroups,ids,xids){var allIds=_([].concat(ids)).chain().union(xids).compact().value();return _(allIds).any(function(id){return locationGroups.get(id)===undefined})}function isReadonly(item,userId){var ownerId=item.user&&item.user.length?item.user[0].id:undefined;return userId!==ownerId&&item.shared==="readonly"}function toggleTickIndicator($input,showIndicator){var $indicatorSpan=$input.closest("div").find("span.indicator");if(showIndicator){$indicatorSpan.removeClass("hidden")}else{$indicatorSpan.addClass("hidden")}}function getMakeElData(view){var options=view.options,data=options.data,locationGroups=view.locationGroups,locations=getFormattedLocations("location","locationGroup",data,view.locationData,view.locationOrder,view.userId,view.locationGroups),xlocations=getFormattedXlocations("xlocation","xlocationGroup",data,view.locationData,view.xlocationOrder,view.userId,view.locationGroups),sharedLocationGroupApplied=view.isSharedLocationGroupApplied(data.locationGroup),sharedxLocationGroupApplied=view.isSharedLocationGroupApplied(data.xlocationGroup);return _.extend({},data,{filterKeyLocation:"location",filterKeyxLocation:"xlocation",locations:buildLocationItems(locations),xlocations:buildLocationItems(xlocations),hasUnknownLocationList:hasUnknownLocationList(locationGroups,data.locationGroup,data.xlocationGroup),ownDashboard:view.isOwner(),sharedLocationGroupApplied:sharedLocationGroupApplied,sharedxLocationGroupApplied:sharedxLocationGroupApplied,locationIndicatorClass:_(locations).some()?"applied":"hidden",xlocationIndicatorClass:_(xlocations).some()?"applied":"hidden",helpKey:options.helpKey,showHelp:options.showHelp,showBetaTag:options.showBetaTag,showNewTag:options.showNewTag,filterLabel:options.filterLabel,hideIncludeList:!sharedLocationGroupApplied&&!locations.length,hideExcludeList:!sharedxLocationGroupApplied&&!xlocations.length})}return Backbone.View.extend({locationsFetched:false,locationOrder:{},xlocationOrder:{},events:function events(){return{"focus .autocomplete":"onLocationInputFocused","click a.remove":"onRemoveLocation","click a.new":"onClickNew","click a.edit":"onClickEdit"}},constructor:function GenericLocationFilters(){Backbone.View.apply(this,arguments)},initialize:function initialize(options){paramAssert.isNotDefined(options||options.locationGroups,"options.locationGroups must be provided");paramAssert.isNotDefined(options.userId,"options.userId must be provided");paramAssert.isNotDefined(options.hasOwnProperty("ownerId"),"options.ownerId must be specified");this.locationGroups=options.locationGroups;this.userId=options.userId;this.ownerId=options.ownerId;this.autocompletePosition=options.autocompletePosition;this.listenTo(this.locationGroups,"change",this.refreshLocationGroupsOnChange);this.listenTo(this.locationGroups,"remove",this.refreshLocationGroupsOnRemove);this.options=options||{};this.options.filterLabel=this.options.filterLabel||"Locations";this.options.helpKey=this.options.helpKey||"filters-location";this.autocompleteUrl=this.options.autocompleteUrl;this.locationProvider=new LocationProvider({url:this.options.locationProviderUrl})},render:function render(){if(!this.locationsFetched){this.$el.html(this.makeLoadingEl(this.options.data))}return this.fetchLocationData(_.partial(this.renderCallback))},renderCallback:function renderCallback(err,locations){var data;if(err){this.$el.html(this.makeLocationFetchFailedEl());return}this.locationData=locations;data=getMakeElData(this);this.$el.html(this.makeEl(data)).customtip()},makeLoadingEl:function makeLoadingEl(){return locationLoadingTemplate({locationsFetched:this.locationsFetched,locationsFetchFailed:this.locationsFetchFailed})},makeLocationFetchFailedEl:function makeLocationFetchFailedEl(){return locationFetchFailedTemplate()},makeEl:function makeEl(data){return locationTemplate(data)},onGroupAddedForInclusion:function onGroupAddedForInclusion(model){this.addLocationHelper({id:model.id,name:model.get("name"),readonly:isReadonly(model,this.userId),type:"locationGroup"},"include")},onGroupAddedForExclusion:function onGroupAddedForExclusion(model){this.addLocationHelper({id:model.id,name:model.get("name"),readonly:isReadonly(model,this.userId),type:"locationGroup"},"exclude")},onClickNew:function onClickNew(e){e.preventDefault();var self=this,locationGroups=this.locationGroups,$target=$(e.currentTarget),groupAddedHandler=$target.data("type")==="include"?"onGroupAddedForInclusion":"onGroupAddedForExclusion";locationGroups.off("add",this[groupAddedHandler],this);locationGroups.once("add",this[groupAddedHandler],this);controlsEvents.trigger("createLocationGroup",{cancelled:function cancelled(){locationGroups.off("add",self[groupAddedHandler],self)}})},onClickEdit:function onClickEdit(e){e.preventDefault();var $target=$(e.target),id=$target.closest("li[data-id]").data("id"),locationGroupModel=this.locationGroups.get(id);controlsEvents.trigger("editLocationGroup",locationGroupModel)},fetchLocationData:function fetchLocationData(callback){var self=this,data=this.options.data,locationSettings=["location","xlocation"],enabledSettings=_(locationSettings).reduce(function(memo,setting){return memo.concat(data[setting]||[])},[]);if(!enabledSettings.length){this.locationsFetched=true}return this.locationProvider.fetch(enabledSettings).then(function done(locations){self.locationsFetched=true;callback.call(self,undefined,locations)},function fail(){self.locationsFetchFailed=true;callback.call(self,new Error("Location fetch failed"))})},remove:function remove(){if(this.locationFiltersAutocompleteView){this.locationFiltersAutocompleteView.remove()}Backbone.View.prototype.remove.call(this)},setData:function setData(data){this.options.data={location:data.location,locationGroup:data.locationGroup,xlocation:data.xlocation,xlocationGroup:data.xlocationGroup}},getValues:function getValues(){var self=this;var data=this.options.data;var values={location:[],locationGroup:[],xlocation:[],xlocationGroup:[]};var $locationItems=this.$("ul.locations.include li");var $xlocationItems=this.$("ul.locations.exclude li");var createFilter=function createFilter(index){var $this=$(this),type=$this.attr("data-type"),id=type==="locationGroup"||type==="xlocationGroup"?parseInt($this.attr("data-id"),10):$this.attr("data-id"),orderMap=type.charAt(0)==="x"?self.xlocationOrder:self.locationOrder;orderMap[id]=index;values[type].push(id)};if(!this.locationsFetched||this.locationsFetchFailed){return _(values).chain().keys().reduce(function(memo,key){memo[key]=data[key];return memo},{}).value()}$locationItems.each(createFilter);$xlocationItems.each(createFilter);_(values).chain().keys().each(function(key){if(values[key].length){values[key]=_(values[key]).uniq()}});return values},onLocationInputFocused:function onLocationInputFocused(e){this.showLocationAutocomplete($(e.currentTarget))},showLocationAutocomplete:function showLocationAutocomplete($target){var self=this,filterType=$target.attr("name")==="locations"?"include":"exclude";if(this.locationFiltersAutocompleteView){this.locationFiltersAutocompleteView.remove()}this.locationFiltersAutocompleteView=new LocationFiltersAutocomplete({locationGroups:this.locationGroups,userId:this.userId,callback:filterType==="include"?_.bind(this.addLocation,this):_.bind(this.addXlocation,this),getSelectedIds:function getSelectedIds(){return self.$("ul.locations."+filterType+" li").map(function(){var $this=$(this),id=$this.attr("data-id"),type=$this.attr("data-type");return type==="locationGroup"||type==="xlocationGroup"?parseInt(id,10):id}).get()},url:this.autocompleteUrl});this.locationFiltersAutocompleteView.render();this.locationFiltersAutocompleteView.showNextTo($target,this.autocompletePosition);_.defer(function fixForIeLaggyFocusProblem(){var typedInTheWrongField=$target.val().trim(),hasTypedSomething=typedInTheWrongField.length,lastChar=hasTypedSomething?typedInTheWrongField[typedInTheWrongField.length-1]:"",plugin;if(!hasTypedSomething){return}plugin=self.locationFiltersAutocompleteView.$("input.autocomplete").data("plugin_autocomplete");$target.val("");plugin.$element.val(typedInTheWrongField).trigger("keyup",{which:lastChar.charCodeAt(0)})})},refresh:function refresh(){this.render()},isOwner:function isOwner(){var ownerId=parseInt(this.ownerId,10)||undefined;return!_.isUndefined(ownerId)&&ownerId===parseInt(this.userId,10)},isSharedLocationGroupApplied:function isSharedLocationGroupApplied(locationGroupIds){var locationGroups=this.locationGroups;if(this.isOwner()){return false}return!!_(locationGroupIds).find(function(locationGroupId){return!locationGroups.get(locationGroupId)})},getSelectedLocationGroupIds:function getSelectedLocationGroupIds(){var $allItems=this.$("ul.locations li"),selectedGroupIds;selectedGroupIds=$allItems.map(function getIdForLocationGroup(){var $this=$(this),dataType=$this.attr("data-type");return dataType==="locationGroup"||dataType==="xlocationGroup"?parseInt($this.attr("data-id"),10):undefined}).get();return selectedGroupIds},refreshLocationGroupsOnChange:function refreshLocationGroupsOnChange(model){var self=this,userId=this.userId,changes=model.changedAttributes(),$affectedItems=this.$('ul.locations li[data-id="'+model.id+'"]');if(!$affectedItems.length){return}if(changes.name){$affectedItems.each(function updateGroupName(){var $this=$(this),$newItem,dataType=$this.attr("data-type");dataType=dataType.charAt(0)==="x"?dataType.substring(1,dataType.length):dataType;$newItem=$(self.makeLocationItem({id:model.id,name:model.get("name"),readonly:isReadonly(model,userId),type:dataType},$this.parent().hasClass("exclude")?"exclude":"include"));$this.replaceWith($newItem);$newItem.customtip()})}if(changes.locations){this.trigger("changesMade")}},refreshLocationGroupsOnRemove:function refreshLocationGroupsOnRemove(model){var $affectedItems=this.$('ul.locations li[data-id="'+model.id+'"]');if(!$affectedItems.length){return}$affectedItems.each(function removeGroup(){var $this=$(this),$parent=$this.parent();$this.remove();if(!$parent.find("li").length){$parent.addClass("hidden")}});this.trigger("changesMade")},addLocation:function addLocation(result){this.addLocationHelper(result,"include")},addXlocation:function addXlocation(result){this.addLocationHelper(result,"exclude")},addLocationHelper:function addLocationHelper(result,filterType){var $list=this.$("ul.locations."+filterType);$list.removeClass("hidden").append(this.makeLocationItem(result,filterType)).customtip();if(this.locationFiltersAutocompleteView){$(this.locationFiltersAutocompleteView.el).reposition()}toggleTickIndicator(this.$('input[name="'+(filterType==="include"?"locations":"xlocations")+'"]'),true);this.trigger("changesMade")},makeLocationItem:function makeLocationItem(data,filterType){var isAnIncludeFilter=filterType==="include",isAGroupFilter=data.type==="locationGroup"||data.type==="xlocationGroup",name=data.name,title=isAGroupFilter?name:data.fullName,readonly=data.readonly,system=false,type;if(isAGroupFilter){type=isAnIncludeFilter?"locationGroup":"xlocationGroup"}else{type=isAnIncludeFilter?"location":"xlocation";system=true;readonly=true}return locationItemTemplate({type:type,id:data.id,name:name,title:title,readonly:readonly,system:system},false)},onRemoveLocation:function onRemoveLocation(e){this.removeLocation($(e.currentTarget))},removeLocation:function removeLocation($target){var $listItem=$target.closest("li"),$list=$listItem.parent(),$input=$list.hasClass("include")?this.$('input[name="locations"]'):this.$('input[name="xlocations"]'),hasLocations;$listItem.remove();if(this.locationFiltersAutocompleteView){$(this.locationFiltersAutocompleteView.el).reposition()}hasLocations=$list.find("li").length;if(!hasLocations){$list.addClass("hidden")}toggleTickIndicator($input,hasLocations);this.trigger("changesMade")}})});define("mustache!src/controls/filters/templates/twitter",["lib/mustache"],function(mustache){var escapedTemplate='<div>\n<p>\n<a rel="twitter" class="group-title toggle {{onClass}}"><span class="{{chevronClass}} grey smallpadding-right"></span>{{groupTitle}}</a>\n<span data-rel="twitter" class="active-indicator {{groupClass}}">On</span>\n</p>\n<fieldset class="twitter {{expandedClass}}">\n{{^hideRetweetFilter}}\n<p class="twitterRetweets clearfix">\n<span class="indicator {{#getTickClass}}twitterRetweets{{/getTickClass}}" data-tick-key="twitterRetweets"></span>\n<label for="twitterRetweetsMin{{cid}}">Retweets</label>\n<input name="twitterRetweetsMin" id="twitterRetweetsMin{{cid}}" placeholder="Min" class="field num" pattern="{{isPositiveNumberRegex}}" value="{{twitterRetweetsMin}}"/>\n<span> to </span>\n<input name="twitterRetweetsMax" placeholder="Max" class="field num" pattern="{{isPositiveNumberRegex}}" value="{{twitterRetweetsMax}}"/>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-twitter-retweets" ></a>\n{{/showHelp}}\n</p>\n{{/hideRetweetFilter}}\n{{^hideReachFilter}}\n<p class="twitterReach clearfix">\n<span class="indicator {{#getTickClass}}twitterReach{{/getTickClass}}" data-tick-key="twitterReach"></span>\n<label for="reachMin{{cid}}">Twitter Reach</label>\n<input id="reachMin{{cid}}" name="reachMin" placeholder="Min" class="field num" pattern="{{isPositiveNumberRegex}}" value="{{reachMin}}"/>\n<span> to </span>\n<input name="reachMax" placeholder="Max" class="field num" pattern="{{isPositiveNumberRegex}}" value="{{reachMax}}"/>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="{{#authorHelp}}filters-authors-reach{{/authorHelp}}{{^authorHelp}}filters-twitter-reach-per-mention{{/authorHelp}}" ></a>\n{{/showHelp}}\n</p>\n{{/hideReachFilter}}\n{{^hideTweetsFilter}}\n<p class="twitterTweets clearfix">\n<span class="indicator {{#getTickClass}}twitterTweets{{/getTickClass}}" data-tick-key="twitterTweets"></span>\n<label for="twitterPostCountMin{{cid}}">Total Tweets</label>\n<input id="twitterPostCountMin{{cid}}" name="twitterPostCountMin" placeholder="Min" class="field num" pattern="{{isPositiveNumberRegex}}" value="{{twitterPostCountMin}}"/>\n<span> to </span>\n<input name="twitterPostCountMax" placeholder="Max" class="field num" pattern="{{isPositiveNumberRegex}}" value="{{twitterPostCountMax}}"/>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-twitter-tweets" ></a>\n{{/showHelp}}\n</p>\n{{/hideTweetsFilter}}\n{{^hideFollowingFilter}}\n<p class="twitterFollowing clearfix">\n<span class="indicator {{#getTickClass}}twitterFollowing{{/getTickClass}}" data-tick-key="twitterFollowing"></span>\n<label for="twitterFollowingMin{{cid}}">Following</label>\n<input id="twitterFollowingMin{{cid}}" name="twitterFollowingMin" placeholder="Min" class="field num" pattern="{{isPositiveNumberRegex}}" value="{{twitterFollowingMin}}"/>\n<span> to </span>\n<input name="twitterFollowingMax" placeholder="Max" class="field num" pattern="{{isPositiveNumberRegex}}" value="{{twitterFollowingMax}}"/>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-twitter-following" ></a>\n{{/showHelp}}\n</p>\n{{/hideFollowingFilter}}\n<p class="twitterFollowers clearfix">\n<span class="indicator {{#getTickClass}}twitterFollowers{{/getTickClass}}" data-tick-key="twitterFollowers"></span>\n<label for="twitterFollowersMin{{cid}}">Followers</label>\n<input id="twitterFollowersMin{{cid}}" name="twitterFollowersMin" placeholder="Min" class="field num" pattern="{{isPositiveNumberRegex}}" value="{{twitterFollowersMin}}"/>\n<span> to </span>\n<input name="twitterFollowersMax" placeholder="Max" class="field num" pattern="{{isPositiveNumberRegex}}" value="{{twitterFollowersMax}}"/>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-twitter-followers" ></a>\n{{/showHelp}}\n</p>\n<p class="twitterInfluence clearfix">\n<span class="indicator {{#getTickClass}}influence{{/getTickClass}}" data-tick-key="influence"></span>\n<label for="influenceMin{{cid}}">{{influenceLabel}}</label>\n<input id="influenceMin{{cid}}" name="influenceMin" placeholder="Min" class="field num" pattern="{{isPositiveNumberRegex}}" value="{{influenceMin}}"/>\n<span> to </span>\n<input name="influenceMax" placeholder="Max" class="field num" pattern="{{isPositiveNumberRegex}}" value="{{influenceMax}}"/>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-twitter-influence" ></a>\n{{/showHelp}}\n</p>\n{{^hideImpressionsFilter}}\n<p class="twitterImpressions clearfix">\n<span class="indicator {{#getTickClass}}impressions{{/getTickClass}}" data-tick-key="impressions"></span>\n<label class="customtip" title="Impressions">Impress.</label>\n<input name="impressionsMin" placeholder="Min" class="num field" pattern="{{isPositiveNumberRegex}}" value="{{impressionsMin}}"/>\n<span> to </span>\n<input name="impressionsMax" placeholder="Max" class="num field" pattern="{{isPositiveNumberRegex}}" value="{{impressionsMax}}"/>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-twitter-impressions" ></a>\n{{/showHelp}}\n</p>\n{{/hideImpressionsFilter}}\n{{^hideOutreachFilter}}\n<p class="twitterMinOutreach clearfix">\n<span class="indicator {{#getTickClass}}outreachMin{{/getTickClass}}" data-tick-key="outreachMin"></span>\n<label class="outreachLabel">Min outreach</label>\n<select name="outreachMin" class="outreach selectfield">\n<option value="">all</option>\n{{{minOutreachOptions}}}\n</select>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-twitter-min-outreach" ></a>\n{{/showHelp}}\n</p>\n<p class="twitterMaxOutreach clearfix">\n<span class="indicator {{#getTickClass}}outreachMax{{/getTickClass}}" data-tick-key="outreachMax"></span>\n<label class="outreachLabel">Max outreach</label>\n<select name="outreachMax" class="outreach selectfield">\n<option value="">all</option>\n{{{maxOutreachOptions}}}\n</select>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-twitter-max-outreach" ></a>\n{{/showHelp}}\n</p>\n{{/hideOutreachFilter}}\n{{^hideRoleFilter}}\n<p class="twitterRole clearfix">\n<span class="indicator {{#getTickClass}}twitterRole{{/getTickClass}}" data-tick-key="twitterRole"></span>\n<label class="twitterRoleLabel">User Role</label>\n<select name="twitterRole" class="twitterRole selectfield">\n<option value="">any</option>\n{{{twitterRoleOptions}}}\n</select>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-twitter-role"></a>\n{{/showHelp}}\n</p>\n{{/hideRoleFilter}}\n{{^hideVerifiedFilter}}\n<p class="twitterVerified clearfix">\n<span class="indicator {{#getTickClass}}twitterVerified{{/getTickClass}}" data-tick-key="twitterVerified"></span>\n<label class="twitterVerifiedLabel">Verification</label>\n<select name="twitterVerified" class="twitterVerified selectfield">\n<option value="">all</option>\n{{{twitterVerifiedOptions}}}\n</select>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-twitter-verified"></a>\n{{/showHelp}}\n</p>\n{{/hideVerifiedFilter}}\n{{#showAccountTypeFilter}}\n<p class="twitterAccountType clearfix newAndHelp">\n<span class="indicator {{#getTickClass}}accountType{{/getTickClass}}" data-tick-key="accountType"></span>\n<select class="accountType selectfield" name="accountType" title="Account Type" multiple>\n{{{accountTypeOptions}}}\n</select>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-account-type" ></a>\n{{/showHelp}}\n</p>\n{{/showAccountTypeFilter}}\n{{#showGenderFilter}}\n<p class="twitterGender clearfix newAndHelp">\n<span class="indicator {{#getTickClass}}gender{{/getTickClass}}" data-tick-key="gender"></span>\n<select class="gender selectfield" name="gender" title="Gender" multiple>\n{{{genderOptions}}}\n</select>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-gender"></a>\n{{/showHelp}}\n</p>\n{{/showGenderFilter}}\n{{#showProfessionFilter}}\n<p class="twitterProfession clearfix newAndHelp">\n<span class="indicator {{#getTickClass}}profession{{/getTickClass}}" data-tick-key="profession"></span>\n<select class="profession selectfield" name="profession" title="Profession" multiple>\n{{{professionOptions}}}\n</select>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-profession"></a>\n{{/showHelp}}\n</p>\n{{^hideExcludeProfessionFilter}}\n<p class="xtwitterProfession clearfix newAndHelp">\n<span class="indicator {{#getTickClass}}xprofession{{/getTickClass}}" data-tick-key="xprofession"></span>\n<select class="xprofession selectfield" name="xprofession" title="Exclude Profession" multiple>\n{{{xprofessionOptions}}}\n</select>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-exclude-profession"></a>\n{{/showHelp}}\n</p>\n{{/hideExcludeProfessionFilter}}\n{{/showProfessionFilter}}\n{{#showInterestFilter}}\n<p class="twitterInterest clearfix newAndHelp">\n<span class="indicator {{#getTickClass}}interest{{/getTickClass}}" data-tick-key="interest"></span>\n<select class="interest selectfield" name="interest" title="Interest" multiple>\n{{{interestOptions}}}\n</select>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-interest"></a>\n{{/showHelp}}\n</p>\n{{^hideExcludeInterestFilter}}\n<p class="xtwitterInterest clearfix newAndHelp">\n<span class="indicator {{#getTickClass}}xinterest{{/getTickClass}}" data-tick-key="xinterest"></span>\n<select class="xinterest selectfield" name="xinterest" title="Exclude Interest" multiple>\n{{{xinterestOptions}}}\n</select>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-exclude-interest"></a>\n{{/showHelp}}\n</p>\n{{/hideExcludeInterestFilter}}\n{{/showInterestFilter}}\n</fieldset>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/controls/css/twitterFilters.css",["css!src/controls/css/compiled.css"],function(){});define("src/controls/filters/TwitterFilters",["async","underscore","jquery","src/controls/lib/paramAssert","src/controls/filters/FiltersView","src/controls/filters/GenericLocationFilters","src/controls/lib/controlsViewDataBuilder","mustache!src/controls/filters/templates/twitter","customtip","spin","css!src/controls/css/twitterFilters.css"],function(async,_,$,paramAssert,FiltersView,GenericLocationFilters,controlsViewDataBuilder,template){"use strict";var HIDE_TWITTER_FILTER_OPTIONS=["hideRetweetFilter","hideReachFilter","hideTweetsFilter","hideFollowingFilter","hideImpressionsFilter","hideOutreachFilter","hideRoleFilter","hideVerifiedFilter","hideExcludeProfessionFilter","hideExcludeInterestFilter"];var INFLUENCE_LABEL="Influence";var GROUP_TITLE="Twitter";function fixTwitterVerified(view){var twitterVerified=view.model.get("twitterVerified");if(!view.isNullOrEmpty(twitterVerified)){view.$("[name=twitterVerified]").val(String(twitterVerified))}}function setOptions(view,options){paramAssert.isNotDefined(options.professions,"options.professions must be supplied!");paramAssert.isNotDefined(options.interests,"options.interests must be supplied!");paramAssert.isNotDefined(options.locationGroups,"options.locationGroups must be supplied!");paramAssert.isNotDefined(options.userId,"options.userId must be supplied!");paramAssert.isNotDefined(options.hasOwnProperty("ownerId"),"options.ownerId must be specified");view.professions=options.professions;view.interests=options.interests;view.locationGroups=options.locationGroups;view.userId=options.userId;view.ownerId=options.ownerId;view.locationAutocompleteUrl=options.locationAutocompleteUrl;view.locationProviderUrl=options.locationProviderUrl;view.showGenderFilter=options.showGenderFilter;view.showAccountTypeFilter=options.showAccountTypeFilter;view.showProfessionFilter=options.showProfessionFilter;view.showInterestFilter=options.showInterestFilter;view.showAuthorLocationFilter=options.showAuthorLocationFilter;view.influenceLabel=options.influenceLabel||INFLUENCE_LABEL;view.groupTitle=options.groupTitle||GROUP_TITLE;_.extend(view,_.pick(options,HIDE_TWITTER_FILTER_OPTIONS));view.autocompletePosition=options.autocompletePosition}return FiltersView.extend({constructor:function TwitterFilters(options){FiltersView.apply(this,arguments);setOptions(this,options||{});this.listenTo(this,"toggle",this.onToggle)},onToggle:function onToggle(on){var render=_.bind(this.render,this),$el=this.$el;if(on&&!this.loadedProfessionsInterests){this.$("fieldset").empty().spin();this.loadProfessionsInterests(function(){$el.spin(false);render()})}},remove:function remove(){if(this.locationFiltersView){this.locationFiltersView.remove()}FiltersView.prototype.remove.call(this)},render:function render(){FiltersView.prototype.render.call(this);this.$el.customtip()},makeEl:function makeEl(data){var $template=$(template(this.getTemplateData(data)));if(this.loadedProfessionsInterests){this.renderLocationFilters($template)}return $template},loadProfessionsInterests:function loadProfessionsInterests(callback){var self=this,_professions=this.professions,_interests=this.interests,professionNames=this.professionNames||[],interestNames=this.interestNames||[];if(!this.showProfessionFilter&&!this.showInterestFilter){self.loadedProfessionsInterests=true;callback();return}async.parallel({professions:function professions(callback){if(professionNames.length){return callback(null,professionNames)}_professions.load(function(err,professions){var professionNames=professions.map(function(result){return result.get("name")});callback(err,professionNames)})},interests:function interests(callback){if(interestNames.length){return callback(null,interestNames)}_interests.load(function(err,interests){var interestNames=interests.map(function(result){return result.get("name")});callback(err,interestNames)})}},function(err,result){self.professionNames=result.professions;self.interestNames=result.interests;self.loadedProfessionsInterests=true;callback()})},renderLocationFilters:function renderLocationFilters($template){var filterData,locationFiltersView=this.locationFiltersView;if(!this.showAuthorLocationFilter){return}if(!locationFiltersView){filterData={location:this.model.get("authorLocation"),locationGroup:this.model.get("authorLocationGroup"),xlocation:this.model.get("xauthorLocation"),xlocationGroup:this.model.get("xauthorLocationGroup")};locationFiltersView=this.locationFiltersView=new GenericLocationFilters({data:filterData,filterLabel:"Author Locations",helpKey:"filters-author-location",showHelp:this.getTemplateData(this.model.toJSON()).showHelp,locationGroups:this.locationGroups,userId:this.userId,ownerId:this.ownerId,showBetaTag:true,autocompletePosition:this.autocompletePosition,autocompleteUrl:this.locationAutocompleteUrl,locationProviderUrl:this.locationProviderUrl})}locationFiltersView.render();$template.find("fieldset.twitter").append(locationFiltersView.$el)},refresh:function refresh(){FiltersView.prototype.refresh.call(this);fixTwitterVerified(this);this.refreshLocationFilters()},refreshLocationFilters:function refreshLocationFilters(){var locationFiltersView=this.locationFiltersView;if(!locationFiltersView){return}var authorLocationFilterApplied=this.model.has("authorLocation")&&this.model.get("authorLocation").length>0||this.model.has("xauthorLocation")&&this.model.get("xauthorLocation").length>0||this.model.has("authorLocationGroup")&&this.model.get("authorLocationGroup").length>0||this.model.has("xauthorLocationGroup")&&this.model.get("xauthorLocationGroup").length>0;if(authorLocationFilterApplied){this.$(".active-indicator").removeClass("hidden")}locationFiltersView.options.data={location:this.model.get("authorLocation"),locationGroup:this.model.get("authorLocationGroup"),xlocation:this.model.get("xauthorLocation"),xlocationGroup:this.model.get("xauthorLocationGroup")};locationFiltersView.render()},getValues:function getValues(){var values=FiltersView.prototype.getValues.call(this),locations,locationFiltersView=this.locationFiltersView;if(values.twitterVerified==="true"){values.twitterVerified=true}else if(values.twitterVerified==="false"){values.twitterVerified=false}if(locationFiltersView){locations=this.locationFiltersView.getValues();values.authorLocation=locations.location;values.xauthorLocation=locations.xlocation;values.authorLocationGroup=locations.locationGroup;values.xauthorLocationGroup=locations.xlocationGroup}else{values.authorLocation=this.model.get("authorLocation");values.xauthorLocation=this.model.get("xauthorLocation");values.authorLocationGroup=this.model.get("authorLocationGroup");values.xauthorLocationGroup=this.model.get("xauthorLocationGroup")}if(!this.loadedProfessionsInterests){values.profession=this.model.get("profession");values.xprofession=this.model.get("xprofession");values.interest=this.model.get("interest");values.xinterest=this.model.get("xinterest")}return values},getTemplateData:function getTemplateData(){var outreachValues=[1,2,3,4,5,6,7,8,9,10,11,12],data=FiltersView.prototype.getTemplateData.call(this),twitterFilters=[{name:"Verified",value:true},{name:"Unverified",value:false}],twitterRoleFilters=[{name:"Owner",id:"owner"},{name:"Audience",id:"audience"}],twitterOptions,selectedAttr="selected",isSelected,optionString,professionNames=this.professionNames||[],interestNames=this.interestNames||[];twitterOptions=_(twitterFilters).map(function(option){isSelected=option.value===data.twitterVerified?selectedAttr:"";optionString="<option "+isSelected+' value="'+option.value+'">'+option.name+"</option>";isSelected="";return optionString});return _.extend(data,{minOutreachOptions:controlsViewDataBuilder.buildOptionsFromArray(outreachValues,data.outreachMin),maxOutreachOptions:controlsViewDataBuilder.buildOptionsFromArray(outreachValues,data.outreachMax),twitterVerifiedOptions:twitterOptions,genderOptions:controlsViewDataBuilder.buildOptionsFromArray(["male","female"],data.gender),accountTypeOptions:controlsViewDataBuilder.buildOptionsFromArray(["individual","organisational"],data.accountType),professionOptions:controlsViewDataBuilder.buildOptionsFromArray(professionNames,data.profession),xprofessionOptions:controlsViewDataBuilder.buildOptionsFromArray(professionNames,data.xprofession),interestOptions:controlsViewDataBuilder.buildOptionsFromArray(interestNames,data.interest),xinterestOptions:controlsViewDataBuilder.buildOptionsFromArray(interestNames,data.xinterest),twitterRoleOptions:controlsViewDataBuilder.buildOptionsFromObject(twitterRoleFilters,data.twitterRole),groupTitle:this.groupTitle,influenceLabel:this.influenceLabel,showGenderFilter:this.showGenderFilter,showAccountTypeFilter:this.showAccountTypeFilter,showProfessionFilter:this.showProfessionFilter,showInterestFilter:this.showInterestFilter},_.pick(this,HIDE_TWITTER_FILTER_OPTIONS))},getFilterIndicatorStatuses:function getFilterIndicatorStatuses(model){var ticks={twitterRetweets:!this.isNullOrEmpty(model.get("twitterRetweetsMin"))||!this.isNullOrEmpty(model.get("twitterRetweetsMax")),twitterReach:!this.isNullOrEmpty(model.get("reachMin"))||!this.isNullOrEmpty(model.get("reachMax")),twitterTweets:!this.isNullOrEmpty(model.get("twitterPostCountMin"))||!this.isNullOrEmpty(model.get("twitterPostCountMax")),twitterFollowing:!this.isNullOrEmpty(model.get("twitterFollowingMin"))||!this.isNullOrEmpty(model.get("twitterFollowingMax")),twitterFollowers:!this.isNullOrEmpty(model.get("twitterFollowersMin"))||!this.isNullOrEmpty(model.get("twitterFollowersMax")),influence:!this.isNullOrEmpty(model.get("influenceMin"))||!this.isNullOrEmpty(model.get("influenceMax")),outreachMin:!this.isNullOrEmpty(model.get("outreachMin")),outreachMax:!this.isNullOrEmpty(model.get("outreachMax")),twitterVerified:!this.isNullOrEmpty(model.get("twitterVerified")),impressions:!this.isNullOrEmpty(model.get("impressionsMin"))||!this.isNullOrEmpty(model.get("impressionsMax")),gender:!this.isNullOrEmpty(model.get("gender")),accountType:!this.isNullOrEmpty(model.get("accountType")),twitterRole:!this.isNullOrEmpty(model.get("twitterRole")),authorLocation:!this.isNullOrEmpty(model.get("authorLocation")),xauthorLocation:!this.isNullOrEmpty(model.get("xauthorLocation")),authorLocationGroup:!this.isNullOrEmpty(model.get("authorLocationGroup")),xauthorLocationGroup:!this.isNullOrEmpty(model.get("xauthorLocationGroup")),profession:!this.isNullOrEmpty(model.get("profession")),xprofession:!this.isNullOrEmpty(model.get("xprofession")),interest:!this.isNullOrEmpty(model.get("interest")),xinterest:!this.isNullOrEmpty(model.get("xinterest"))},groups=_(ticks).some(function(tick){return tick});return{tickIndicators:ticks,groupIndicators:groups}}},{FILTER_NAMES:["twitterRetweetsMin","twitterRetweetsMax","reachMin","reachMax","twitterPostCountMin","twitterPostCountMax","twitterFollowingMin","twitterFollowingMax","twitterFollowersMin","twitterFollowersMax","influenceMin","influenceMax","impressionsMin","impressionsMax","outreachMin","outreachMax","twitterRole","twitterVerified","accountType","gender","profession","xprofession","interest","xinterest","authorLocation","xauthorLocation","authorLocationGroup","xauthorLocationGroup"]})});define("mustache!src/controls/filters/templates/author",["lib/mustache"],function(mustache){var escapedTemplate='<p>\n<a rel="author" class="toggle"><span class="icon-chevron-right grey smallpadding-right"></span>Author</a>\n<span data-rel="author" class="active-indicator {{groupClass}}">On</span>\n</p>\n<fieldset class="author hidden">\n<p class="authorName clearfix">\n<span class="indicator {{#getTickClass}}author{{/getTickClass}}" data-tick-key="author"></span>\n<input class="field author" type="text" name="author" placeholder="Type author name" autocomplete="off" value="{{author}}"/>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-authors-name" ></a>\n{{/showHelp}}\n</p>\n<p class="authorExactName clearfix">\n<input id="exactAuthor-{{cid}}" class="exactAuthor" type="checkbox" name="exactAuthor" value="true" {{exactAuthorCheckedState}} />\n<label for="exactAuthor-{{cid}}">Exact match</label>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-authors-exact-name" ></a>\n{{/showHelp}}\n</p>\n<p class="js-unknown-author-group clearfix {{^hasUnknownFilters}}hidden{{/hasUnknownFilters}}">\n<span class="iconsmall icon-info-sign"></span>\n<label>Author List filters applied</label>\n<a class="help icon-bwhelp" data-key="filters-unknown-group-applied" tabIndex="-1"></a>\n</p>\n<p class="clearfix">\n<span class="indicator {{#getTickClass}}authorGroups{{/getTickClass}}" data-tick-key="authorGroups"></span>\n<select name="authorGroup" class="selectfield" title="Author Lists" multiple>\n{{{includedAuthorGroupOptions}}}\n</select>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-authorgroups-include"></a>\n{{/showHelp}}\n</p>\n<p class="clearfix">\n<span class="indicator {{#getTickClass}}excludeAuthorGroups{{/getTickClass}}" data-tick-key="excludeAuthorGroups"></span>\n<select name="xauthorGroup" class="selectfield" title="Exclude Author Lists" multiple>\n{{{excludedAuthorGroupOptions}}}\n</select>\n</p>\n</fieldset>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("text!src/controls/templates/sellecktItemEdit.template",[],function(){return'<li class="selectionItem rounded relative" data-value="{{value}}">\n    {{#data.usecolour}}\n    {{#data.colour}}\n    <div class="colour-band floatleft js-colour-select customtip" style="background-color: {{data.colour}};" title="Assign a colour" data-queryid="{{data.queryid}}"></div>\n    {{/data.colour}}\n    {{^data.colour}}\n    <div class="colour-band floatleft js-colour-select customtip" title="Assign a colour" data-queryid="{{data.queryid}}">A</div>\n    {{/data.colour}}\n    {{/data.usecolour}}\n    <div class="relative smallpadding-left doublepadding-right textellipsis ellipsistooltip customtip" title="{{text}}">\n        {{#data.typeiconclass}}\n            <span class="{{data.typeiconclass}}"></span>\n        {{/data.typeiconclass}}\n        {{text}}<i class="icon-remove remove iconsmaller grey absright hugeline smallmargin-right customtip" title="Deselect"></i>\n    </div>\n    <div class="action abstop">\n        {{#data.readonly}}\n        <i class="action-icon readonly icon-lock grey customtip" title=\'Contact your admin for access\'></i>\n        {{/data.readonly}}\n        {{^data.readonly}}\n            {{^data.locked}}\n            <i class="action-icon js-edit icon-pencil grey customtip" title=\'Edit "{{text}}"\'></i>\n            {{/data.locked}}\n            {{#data.locked}}\n            <i class="action-icon icon-lock grey disabled customtip" title=\'Locked by Administrator "{{data.lockedbyusername}}"\'></i>\n            {{/data.locked}}\n        {{/data.readonly}}\n    </div>\n</li>\n'});define("src/controls/filters/AuthorFilters",["underscore","jquery","src/controls/controlsEvents","src/controls/lib/paramAssert","src/controls/lib/controlsViewDataBuilder","src/controls/filters/FiltersView","mustache!src/controls/filters/templates/author","text!src/controls/templates/sellecktMain.template","text!src/controls/templates/sellecktItemEdit.template","text!src/controls/templates/sellecktPopup.template","customtip"],function(_,$,controlsEvents,paramAssert,controlsViewDataBuilder,FiltersView,template,sellecktMainTemplate,sellecktItemEditTemplate,sellecktPopupTemplate){"use strict";function hasUnknownModels(collection,ids,xids){var allIds=_([].concat(ids)).chain().union(xids).compact().value();return _(allIds).any(function(id){return collection.get(id)===undefined})}function trimTwitterAuthors(author,isTwitterAuthor){if(isTwitterAuthor){return author.slice(1)}return author}function isReadonly(group,userId){var ownerId=group.user&&group.user.length?group.user[0].id:"undefined";return userId!==ownerId&&group.shared==="readonly"}return FiltersView.extend({events:function events(){return _.extend(FiltersView.prototype.events.call(this),{"click a.js-new":"onClickNew","click i.js-edit":"onClickEditItem"})},constructor:function AuthorFilters(options){FiltersView.apply(this,arguments);paramAssert.isNotDefined(options||options.authorGroups,"options.authorGroups should be supplied");paramAssert.isNotDefined(options.userId,"options.userId should be supplied");paramAssert.isNotDefined(options.hasOwnProperty("ownerId"),"options.ownerId should be supplied");paramAssert.isNotDefined(options.hasOwnProperty("canEditGroups"),"options.canEditGroups should be supplied");this.authorGroups=options.authorGroups;this.userId=options.userId;this.ownerId=options.ownerId;this.canEditGroups=options.canEditGroups;this.listenTo(this.authorGroups,"add remove change",this.refreshSelects);this.listenTo(this.authorGroups,"reset",this.render)},_handleNewAuthorClicks:function _handleNewAuthorClicks(){var onClickNew=_.bind(this.onClickNew,this),onClickHandler=function onClickHandler(popup){var $popupEl=popup.$popup;$popupEl.on("click",".js-new",onClickNew)};this.authorSelleckt=this.$("select[name=authorGroup]").data("selleckt");this.xauthorSelleckt=this.$("select[name=xauthorGroup]").data("selleckt");this.authorSelleckt.on("onPopupCreated",onClickHandler);this.xauthorSelleckt.on("onPopupCreated",onClickHandler)},onGroupAddedForInclusion:function onGroupAddedForInclusion(model){this.$('[name="authorGroup"] option[value="'+model.id+'"]').prop("selected",true).parent().trigger("change")},onGroupAddedForExclusion:function onGroupAddedForExclusion(model){this.$('[name="xauthorGroup"] option[value="'+model.id+'"]').prop("selected",true).parent().trigger("change")},onClickNew:function onClickNew(e){e.preventDefault();var self=this,authorGroups=this.authorGroups,$target=$(e.currentTarget),groupAddedHandler=$target.data("type")==="authorGroup"?"onGroupAddedForInclusion":"onGroupAddedForExclusion";authorGroups.off("add",this[groupAddedHandler],this);authorGroups.once("add",this[groupAddedHandler],this);controlsEvents.trigger("createAuthorGroup",{callback:function callback(){authorGroups.off("add",self[groupAddedHandler],self)}})},onClickEditItem:function onClickEditItem(event){var $target=$(event.target),id=$target.closest("li[data-value]").data("value"),authorGroupModel=this.authorGroups.get(id);controlsEvents.trigger("editAuthorGroup",authorGroupModel)},render:function render(){FiltersView.prototype.render.call(this);this.$el.customtip();this._handleNewAuthorClicks()},remove:function remove(){if(this.authorSelleckt){this.authorSelleckt.destroy()}if(this.xauthorSelleckt){this.xauthorSelleckt.destroy()}return FiltersView.prototype.remove.call(this)},refreshSelects:function refreshSelects(){var userId=this.userId,$authorGroup=this.$("select[name=authorGroup]"),authorGroup=$authorGroup.val(),$xauthorGroup=this.$("select[name=xauthorGroup]"),xauthorGroup=$xauthorGroup.val(),html;html=_(this.authorGroups.toJSON()).map(function(authorGroup){var readonlyAttr=isReadonly(authorGroup,userId)?' data-readonly="true"':"";return"<option"+readonlyAttr+' value="'+authorGroup.id+'">'+authorGroup.name+"</option>"}).join("\n");this.$("select[name=authorGroup],select[name=xauthorGroup]").html(html);$authorGroup.val(authorGroup);$xauthorGroup.val(xauthorGroup);this.refreshMultiSelects();this._handleNewAuthorClicks()},makeEl:function makeEl(data){return template(this.getTemplateData(data))},getTemplateData:function getTemplateData(){var userId=this.userId,authorGroups=this.authorGroups,data=FiltersView.prototype.getTemplateData.call(this),authorGroupsJSON=authorGroups.toJSON(),isExactAuthor=!!this.model.get("exactAuthor");if(data.exactAuthor){data.author=data.exactAuthor;data.exactAuthor=true}function isReadOnlyWrapper(group){return isReadonly(group,userId)}return _.extend(data,{cid:_.uniqueId(),exactAuthorCheckedState:isExactAuthor==="true"||isExactAuthor===true?"checked":"",hasUnknownFilters:hasUnknownModels(authorGroups,data.authorGroup,data.xauthorGroup),includedAuthorGroupOptions:controlsViewDataBuilder.buildOptionsFromObject(authorGroupsJSON,data.authorGroup,isReadOnlyWrapper),excludedAuthorGroupOptions:controlsViewDataBuilder.buildOptionsFromObject(authorGroupsJSON,data.xauthorGroup,isReadOnlyWrapper),notifyAGSet:this.isAuthorFilterSet(["authorGroup","xauthorGroup"])})},getSellecktOptions:function getSellecktOptions($select){var options=FiltersView.prototype.getSellecktOptions.call(this,$select),canEditGroups=this.canEditGroups;options.showEmptyList=true;options.selectionTemplate=sellecktItemEditTemplate;options.popupTemplate=sellecktPopupTemplate;if(canEditGroups){options.mainTemplate=sellecktMainTemplate;options.popupTemplateData=_.extend({},options.popupTemplateData,{footer:'<a class="js-new customtip" data-type="'+$select.attr("name")+'" data-tip-position="bottom" title="Create new Author List">'+'<span class="iconsmaller icon-plus smallpadding-right"></span>New</a>'});return options}return options},isSharedDashboard:function isSharedDashboard(){return this.ownerId&&parseInt(this.ownerId,10)!==this.userId},getValues:function getValues(){var model=this.model,isSharedDashboard=this.isSharedDashboard(),exactAuthor=model.get("exactAuthor"),$exactAuthor=this.$(".exactAuthor"),author=this.$("input.author").val(),authorGroup=this.$("select[name=authorGroup]").val()||[],xauthorGroup=this.$("select[name=xauthorGroup]").val()||[],knownGroupIds,appendUnkownGroups;if(isSharedDashboard){knownGroupIds=this.authorGroups.pluck("id");appendUnkownGroups=function appendUnkownGroups(name,values){var modelValues=model.get(name)||[],unknownIds=_([].concat(modelValues)).filter(function(val){var id=parseInt(val,10);if(_.isNaN(id)){return false}return knownGroupIds.indexOf(id)===-1});return values.concat(_(unknownIds).map(function(val){return""+val}))};authorGroup=appendUnkownGroups("authorGroup",authorGroup);xauthorGroup=appendUnkownGroups("xauthorGroup",xauthorGroup)}if($exactAuthor[0]){exactAuthor=$exactAuthor.is(":checked")&&!this.isNullOrEmpty(author)}this.setAuthorType(author);author=author.replace(/[]/g,'"');author=trimTwitterAuthors(author,this.isTwitterAuthor);return{author:!exactAuthor&&author||null,exactAuthor:exactAuthor&&author||null,authorGroup:authorGroup,xauthorGroup:xauthorGroup}},setAuthorType:function setAuthorType(author){this.isTwitterAuthor=undefined;if(author.charAt(0)==="@"){this.isTwitterAuthor=true}},toggleTick:function toggleTick(modelKey,$tickIndicator){if(this.isNullOrEmpty(this.model.get(modelKey))){$tickIndicator.addClass("hidden").removeClass("applied");return}$tickIndicator.removeClass("hidden").addClass("applied")},isAuthorFilterSet:function isAuthorFilterSet(modelKeys){var self=this;return _(modelKeys).any(function isModelKeySet(key){return!self.isNullOrEmpty(self.model.get(key))})},toggleGroupActiveIndicator:function toggleGroupActiveIndicator(){var $activeIndicator=this.$(".active-indicator");if(this.isAuthorFilterSet(["author","authorGroup","xauthorGroup"])){$activeIndicator.removeClass("hidden")}else{$activeIndicator.addClass("hidden")}},refresh:function refresh(){var model=this.model,author=model.get("author"),isExactAuthor=!!model.get("exactAuthor"),$author=this.$("input.author"),$exactAuthor=this.$("[name=exactAuthor]"),hasUnknownAuthorGroups=hasUnknownModels(this.authorGroups,model.get("authorGroup"),model.get("xauthorGroup"));if(isExactAuthor){author=model.get("exactAuthor")}$author.val(this.getTypedAuthorValue(author));$exactAuthor.prop("checked",isExactAuthor);this.$("select[name=authorGroup]").val(model.get("authorGroup")).change();this.$("select[name=xauthorGroup]").val(model.get("xauthorGroup")).change();this.toggleTick("author",this.$(".indicator[data-tick-key=author]"));this.toggleTick("authorGroup",this.$(".indicator[data-tick-key=authorGroups]"));this.toggleTick("xauthorGroup",this.$(".indicator[data-tick-key=excludeAuthorGroups]"));this.$(".js-unknown-author-group").toggleClass("hidden",!hasUnknownAuthorGroups);this.toggleGroupActiveIndicator()},getTypedAuthorValue:function getTypedAuthorValue(author){if(author&&this.isTwitterAuthor){return"@"+author}return author},getFilterIndicatorStatuses:function getFilterIndicatorStatuses(model){var ticks={author:!this.isNullOrEmpty(model.get("author")||model.get("exactAuthor")),authorGroups:!this.isNullOrEmpty(model.get("authorGroup")),excludeAuthorGroups:!this.isNullOrEmpty(model.get("xauthorGroup"))},groups=!!_(ticks).find(function(item){return item});return{tickIndicators:ticks,groupIndicators:groups}}})});define("mustache!src/controls/templates/selectDropdownView",["lib/mustache"],function(mustache){var escapedTemplate='<div class="js-filter-dropdown b-filter-dropdown modular popupframe singlepadding qa-{{propertyName}}">\n<div>\n<input class="iconfield search js-search-input fullwidth" placeholder="{{searchPlaceholder}}" value="" />\n</div>\n<header class="b-filter-dropdown__header singlemargin-vertical">\n<h1 class="b-filter-dropdown__header--left">\n{{title}}<a class="help icon-bwhelp smallmargin-left" data-key="filters-{{helpKey}}"></a>\n</h1>\n<span class="b-filter-dropdown__header--right">\n<a class="js-select-all">Select all</a>\n<a class="js-unselect-all hidden">Unselect all</a>\n</span>\n</header>\n<div class="js-list-wrapper b-filter-dropdown__list-wrapper singlemargin-bottom rowborder-top rowborder bwscrollbar-narrow"></div>\n\n{{#infoText}}\n<p class="lightgrey info-text">{{{infoText}}}</p>\n{{/infoText}}\n\n{{#summaryType}}\n<div class="js-helpbox b-filter-dropdown__helpbox infoboxbgcolor rounded noSelection">\n<span class="b-filter-dropdown__helplabel db tinypadding-vertical smallpadding-left">\n{{summaryType}} mentions {{summaryActionLabel}} with\n</span>\n<span class="js-summary b-filter-dropdown__helptext db smallpadding tinymargin-vertical"></span>\n</div>\n{{/summaryType}}\n<p class="singlemargin-top">\n<button class="js-apply defaultbutton">{{applyLabel}}</button>\n<button class="js-cancel button singlemargin-left">Cancel</button>\n</p>\n</div>';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/controls/templates/selectDropdownList",["lib/mustache"],function(mustache){var escapedTemplate='{{#hasProperties}}\n<ul class="b-filter-dropdown__list b-filter-dropdown__list--nomarginleft singlemargin-top">\n{{#properties}}\n<li class="js-listitem highlightrow textellipsis tinypadding">\n<label class="tinypadding ellipsistooltip customtip{{#checked}} bold{{/checked}}" title="{{name}}">\n<input class="js-property smallmargin-right" type="checkbox" name="{{name}}" value="{{id}}" {{checked}}>\n{{{name}}}\n</label>\n</li>\n{{/properties}}\n</ul>\n{{/hasProperties}}\n<div class="js-no-results {{#hasProperties}}hidden {{/hasProperties}}bigtext grey textcenter smallpadding-vertical">{{capitalisedPropertyName}} not found</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/controls/css/selectDropdownView.css",["css!src/controls/css/compiled.css"],function(){});define("src/controls/views/SelectDropdownView",["underscore","jquery","src/controls/filters/filtersHelper","src/controls/views/ContextMenuView","mustache!src/controls/templates/selectDropdownView","mustache!src/controls/templates/selectDropdownList","customtip","css!src/controls/css/selectDropdownView.css"],function(_,$,filtersHelper,ContextMenuView,template,listTemplate){"use strict";var VIEW_SELECTORS={APPLY_CHANGES:".js-apply",SEARCH_INPUT:".js-search-input",HELP_BOX:".js-helpbox",LIST_WRAPPER:".js-list-wrapper",SELECT_ALL:".js-select-all",UNSELECT_ALL:".js-unselect-all",NO_RESULTS:".js-no-results",LIST_ITEM:".js-listitem",ITEM:".js-property",SUMMARY:".js-summary"};VIEW_SELECTORS.VISIBLE_ITEM=VIEW_SELECTORS.LIST_ITEM+":not(.hidden) "+VIEW_SELECTORS.ITEM;var INPUT_DELAY=200;function arrayContentsIdentical(a,b){return _(a).all(function(id){return b.indexOf(id)>-1})&&_(b).all(function(id){return a.indexOf(id)>-1})}function lowerCaseName(model){return(model.get("name")||"").toLowerCase().trim()}function truncate(text,length){if(!text||text.length<length){return text}return text.substring(0,length)+"..."}function getPropertiesSummaryText(propertyNames,joinString){var helpTextMaxSize=45,summary=propertyNames.sort(function(a,b){return a.toLowerCase()>b.toLowerCase()?1:-1}).join(joinString);return truncate(summary,helpTextMaxSize)}function validateOptions(options){if(!options){throw new Error("options must be defined!")}if(!options.collection){throw new Error("options.collection must be defined!")}if(!_.isFunction(options.callback)){throw new Error("options.callback must be defined!")}if(!options.propertyName){throw new Error("options.propertyName must be defined!")}}function storeSelectors(view){view.listItems=[];view.$noResults=view.$(VIEW_SELECTORS.NO_RESULTS);view.$(VIEW_SELECTORS.LIST_ITEM).each(function(){var $el=$(this);var name=$el.find("input").attr("name").toLowerCase();view.listItems.push({name:name.toLowerCase(),$el:$el})})}return ContextMenuView.extend({position:"below-right-fit",events:function events(){return{"click .js-apply":"onApply","click .js-cancel":"onCancel","keyup .js-search-input":_.debounce(this.renderSearchResult.bind(this),INPUT_DELAY),"change .js-property":"onChangePropertyCheckbox","click .js-select-all":"onClickSelectAll","click .js-unselect-all":"onClickUnselectAll","click .js-filter-dropdown":"onClickStopPropagation"}},constructor:function SelectDropdownView(options){ContextMenuView.apply(this,arguments);validateOptions(options);this.callback=options.callback;this.idsAreInteger=options.collection.pluck("id").some(function(id){return typeof id==="number"});this.selectedIds=options.selectedIds?_.clone(options.selectedIds):[];this.currentlySelectedIds=options.selectedIds?_.clone(options.selectedIds):[];this.mode=options.mode;this.propertyName=options.propertyName;this.capitalisedPropertyName=filtersHelper.capitalize(this.propertyName);this.capitalisedPropertyNamePlural=filtersHelper.capitalize(options.propertyNamePlural||this.propertyName+"s");this.displaySummary=options.displaySummary;this.summaryActionLabel=options.summaryActionLabel;this.infoText=options.infoText;this.listTemplate=options.listTemplate||listTemplate},runCallback:function runCallback(err,selectedIds){if(this.calledBack){throw new Error("callback already fired!")}this.calledBack=true;this.callback.call(null,err,selectedIds)},onApply:function onApply(){var view=this;var selectedIds=_(this.getSelectedPropertyIds()).chain().map(function(id){return view.collection.get(id)}).sortBy(lowerCaseName).pluck("id").value();this.runCallback(undefined,selectedIds);this.remove()},onCancel:function onCancel(e){e.preventDefault();this.runCallback("cancelled");this.remove()},remove:function remove(){if(!this.calledBack){this.runCallback("cancelled")}ContextMenuView.prototype.remove.call(this)},updateView:function updateView(){this.updateMultiSelectLinks();if(this.mode){this.updateSummary()}this.toggleButtons()},onChangePropertyCheckbox:function onChangePropertyCheckbox(e){this.toggleProperty(e.target);this.updateView()},toggleProperty:function toggleProperty(checkbox){var $checkbox=$(checkbox),id=$checkbox&&$checkbox.val(),val=$checkbox.is(":checked");if(!id){return}if(this.idsAreInteger){id=parseInt(id,10)}if(val){this.currentlySelectedIds=[].concat(this.currentlySelectedIds.concat(id));$checkbox.prop("checked",val).parent().addClass("bold")}else{this.currentlySelectedIds=_(this.currentlySelectedIds).without(id);$checkbox.prop("checked",val).parent().removeClass("bold")}},onClickStopPropagation:function onClickStopPropagation(e){if(!$(e.target).is("a.help")){e.stopPropagation()}},onClickSelectAll:function onClickSelectAll(){this.toggleDisplayedItems(true)},onClickUnselectAll:function onClickUnselectAll(){this.toggleDisplayedItems(false)},getSelectedIds:function getSelectedIds(){return this.$(VIEW_SELECTORS.ITEM+":checked").map(function(){return this.value}).get()},toggleDisplayedItems:function toggleDisplayedItems(select){this.$(VIEW_SELECTORS.VISIBLE_ITEM).prop("checked",select).parent().toggleClass("bold",select);this.currentlySelectedIds=this.getSelectedIds();this.updateView()},updateMultiSelectLinks:function updateMultiSelectLinks(){var allPropertyCount=this.$(VIEW_SELECTORS.VISIBLE_ITEM).length;var selectedPropertyCount=this.$(VIEW_SELECTORS.VISIBLE_ITEM+":checked").length;var allSelected=selectedPropertyCount===allPropertyCount;this.$(VIEW_SELECTORS.SELECT_ALL).toggleClass("hidden",allSelected);this.$(VIEW_SELECTORS.UNSELECT_ALL).toggleClass("hidden",!allSelected)},updateSummary:function updateSummary(){var view=this;var selectedCount=this.currentlySelectedIds.length;var $helpContainer=this.$(VIEW_SELECTORS.HELP_BOX);var $summaryText=$helpContainer.find(VIEW_SELECTORS.SUMMARY);var propertyNames;var text;if(selectedCount===0){return $helpContainer.addClass("vhidden")}propertyNames=this.currentlySelectedIds.map(function(id){var property=view.collection.get(id);return property&&property.get("name")||""});text=getPropertiesSummaryText(propertyNames,this.mode==="include"?" AND ":" OR ");$helpContainer.removeClass("vhidden");$summaryText.text(text)},toggleButtons:function toggleButtons(){if(arrayContentsIdentical(this.currentlySelectedIds,this.selectedIds)){this.$(VIEW_SELECTORS.APPLY_CHANGES).prop("disabled",true)}else{this.$(VIEW_SELECTORS.APPLY_CHANGES).prop("disabled",false)}},getSelectedPropertyIds:function getSelectedPropertyIds(){return this.currentlySelectedIds},preparePropertyData:function preparePropertyData(filteredProperties,useCurrentIds){var selectedIds=useCurrentIds?this.currentlySelectedIds:this.selectedIds;return _(filteredProperties).chain().sortBy(lowerCaseName).map(function(property){var data=property.toJSON();data.checked=_(selectedIds).find(function(id){return id===data.id})?"checked":"";return data}).value()},render:function render(){var mode=this.mode;var titleAction=mode?mode==="include"?"Pick ":"Exclude ":"Pick ";this.$el.html(template({title:titleAction+this.capitalisedPropertyNamePlural,searchPlaceholder:"Search "+this.capitalisedPropertyNamePlural,propertyName:this.propertyName,helpKey:mode?mode==="include"?this.propertyName:"x"+this.propertyName:undefined,summaryType:this.displaySummary&&mode?mode==="include"?"Show":"Exclude":undefined,summaryActionLabel:this.summaryActionLabel,infoText:this.infoText,applyLabel:mode?"Set Filters":"Apply"}));var listHtml=this.listTemplate({capitalisedPropertyName:this.capitalisedPropertyName,properties:this.preparePropertyData(this.collection.models),hasProperties:this.collection.length>0});this.$(VIEW_SELECTORS.LIST_WRAPPER).html(listHtml).customtip();storeSelectors(this);this.updateView()},hasSearchResults:function hasSearchResults(filteredPropertiesData){return filteredPropertiesData&&filteredPropertiesData.length},renderSearchResult:function renderSearchResult(){var searchString=(this.$(VIEW_SELECTORS.SEARCH_INPUT).val()||"").toLowerCase();var hasResults=false;this.listItems.forEach(function(item){var matches=item.name.indexOf(searchString)>-1;if(matches){hasResults=true}item.$el.toggleClass("hidden",!matches)});this.$noResults.toggleClass("hidden",hasResults)}})});define("mustache!src/controls/filters/templates/baseDropdownFilters",["lib/mustache"],function(mustache){var escapedTemplate='<p>\n<a rel="property" class="toggle"><span class="icon-chevron-right grey smallpadding-right"></span>{{capitalisedPropertyName}}</a>\n<span data-rel="property" class="active-indicator {{groupClass}}">On</span>\n</p>\n<fieldset class="js-dropdown b-dropdown-filter property hidden qa-{{propertyName}}">\n<p class="propertiesIncluded clearfix">\n<span class="indicator {{#getTickClass}}properties{{/getTickClass}}" data-tick-key="properties"></span>\n<label>Filter by {{capitalisedPropertyName}}</label>\n<span class="js-selected-list js-selected-list-include modular b-dropdown-filter__selected-list"></span>\n<input id="properties-{{cid}}" type="hidden" class="propertiesInput field" name="properties" value="{{properties}}"/>\n<button class="js-edit js-edit-include selectfield b-dropdown-filter__button">{{includeButtonLabel}}</button>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-{{propertyName}}"></a>\n{{/showHelp}}\n</p>\n<p class="propertiesExcluded clearfix">\n<span class="indicator {{#getTickClass}}xproperties{{/getTickClass}}" data-tick-key="xproperties"></span>\n<label>Exclude {{capitalisedPropertyName}}</label>\n<span class="js-selected-list js-selected-list-exclude modular b-dropdown-filter__selected-list"></span>\n<input id="xproperties-{{cid}}" type="hidden" class="propertiesInput field" name="xproperties" value="{{xproperties}}"/>\n<button class="js-edit js-edit-exclude selectfield b-dropdown-filter__button">{{excludeButtonLabel}}</button>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-x{{propertyName}}"></a>\n{{/showHelp}}\n</p>\n</fieldset>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/controls/filters/templates/baseDropdownFiltersItem",["lib/mustache"],function(mustache){var escapedTemplate='<li class="darkgrey relative">\n<span class="dib abstop textellipsis ellipsistooltip customtip" title="{{name}}">{{name}}</span>\n<a class="js-delete iconsmaller icon-remove customtip" data-property-id="{{id}}" title="Deselect"></a>\n</li>';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/controls/css/baseDropdownFilters.css",["css!src/controls/css/compiled.css"],function(){});define("src/controls/filters/BaseDropdownFiltersView",["underscore","jquery","src/controls/filters/filtersHelper","src/controls/filters/FiltersView","src/controls/views/SelectDropdownView","mustache!src/controls/filters/templates/baseDropdownFilters","mustache!src/controls/filters/templates/baseDropdownFiltersItem","css!src/controls/css/baseDropdownFilters.css","customtip"],function(_,$,filtersHelper,FiltersView,SelectDropdownView,template,itemTemplate){"use strict";var VIEW_SELECTORS={BUTTON_INCLUDE:".js-edit-include",BUTTON_EXCLUDE:".js-edit-exclude",INPUT_EXCLUDE:"[name=xproperties]",INPUT_INCLUDE:"[name=properties]",SELECTED_LIST:".js-selected-list",SELECTED_LIST__INCLUDE:".js-selected-list-include",SELECTED_LIST__EXCLUDE:".js-selected-list-exclude",TICK_EXCLUDE:'.indicator[data-tick-key="xproperties"]',TICK_INCLUDE:'.indicator[data-tick-key="properties"]'};function getPropertyIdToNameMap(propertyCollection){return propertyCollection.reduce(function(memo,property){memo[property.id]=property.get("name");return memo},{})}function getPropertyElement(name,id){var data={id:id,name:_.escape(name)};return itemTemplate(data,false)}function parseIds(view,idString){var ids;if(!idString){return}ids=idString.split(",");if(!view.idsAreInteger){return ids}return _(ids).chain().map(function(value){return parseInt(value,10)}).compact().value()}function getXPropertiesFromModel(propertyCollection,model,propertyName){return getPropertiesFromModel(propertyCollection,model,"x"+propertyName)}function getPropertiesFromModel(propertyCollection,model,propertyName){var properties=model.get(propertyName)||[];return properties.filter(function(propertyId){return!!propertyCollection.get(propertyId)})}function getButtonLabel(view,properties){return properties.length?"Change selection":"Select "+view.capitalisedPropertyNamePlural}function getPropertyField(view,isInclude){return view.$(isInclude?VIEW_SELECTORS.INPUT_INCLUDE:VIEW_SELECTORS.INPUT_EXCLUDE)}function validateOptions(options){if(!options){throw new TypeError("BaseDropdownFiltersView must be instantiated with options")}if(!options.propertyName){throw new TypeError("BaseDropdownFiltersView must be instantiated with a propertyName option")}if(!options.collection){throw new TypeError("BaseDropdownFiltersView must be instantiated with a collection option")}}return FiltersView.extend({events:function events(){return _.extend(FiltersView.prototype.events.call(this),{"click .js-edit":"onPropertySelectClick","click .js-delete":"onPropertyDeleteClick"})},constructor:function BaseDropdownFiltersView(options){validateOptions(options);this.idsAreInteger=options.collection.pluck("id").some(function(id){return typeof id==="number"});this.propertyName=options.propertyName;this.capitalisedPropertyName=filtersHelper.capitalize(this.propertyName);this.capitalisedPropertyNamePlural=filtersHelper.capitalize(options.propertyNamePlural||this.propertyName+"s");this.collection=options.collection;this.dropdownListTemplate=options.dropdownListTemplate;this.displaySummary=options.displaySummary;this.summaryActionLabel=options.summaryActionLabel;this.infoText=options.infoText;this.SelectDropdownViewClass=options.SelectDropdownViewClass||SelectDropdownView;this.listenTo(this.collection,"add remove change",this.onPropertiesUpdated);this.listenTo(this.collection,"reset",this.render);FiltersView.apply(this,arguments)},remove:function remove(){if(this.dropdownView){this.dropdownView.remove()}FiltersView.prototype.remove.call(this)},onPropertiesUpdated:function onPropertiesUpdated(){var values=this.getValues();var properties=values[this.propertyName];var xproperties=values["x"+this.propertyName];var propertiesMap=getPropertyIdToNameMap(this.collection);properties=_.filter(properties||[],function(propId){return propertiesMap[propId]});xproperties=_.filter(xproperties||[],function(propId){return propertiesMap[propId]});this.$(VIEW_SELECTORS.INPUT_INCLUDE).val(properties.join(",")).blur();this.$(VIEW_SELECTORS.INPUT_EXCLUDE).val(xproperties.join(",")).blur()},makeEl:function makeEl(inputData){var properties=getPropertiesFromModel(this.collection,this.model,this.propertyName);var xproperties=getXPropertiesFromModel(this.collection,this.model,this.propertyName);var data=_.extend(inputData,{properties:properties,xproperties:xproperties});var $el=$(template(this.getTemplateData(data)));$el.find(VIEW_SELECTORS.SELECTED_LIST__INCLUDE).append(this.getSelectedPropertiesListTemplate(properties));$el.find(VIEW_SELECTORS.SELECTED_LIST__EXCLUDE).append(this.getSelectedPropertiesListTemplate(xproperties));return $el.customtip()},getTemplateData:function getTemplateData(data){return _.extend(FiltersView.prototype.getTemplateData.call(this),{cid:this.cid,includeButtonLabel:getButtonLabel(this,data.properties),excludeButtonLabel:getButtonLabel(this,data.xproperties),capitalisedPropertyName:this.capitalisedPropertyName,propertyName:this.propertyName,properties:data.properties.join(","),xproperties:data.xproperties.join(",")})},getSelectedPropertiesListTemplate:function getSelectedPropertiesListTemplate(propertyIds){var propertiesMap=getPropertyIdToNameMap(this.collection);var output='<ul class="selectedValues">';output+=_(propertyIds).map(function(propertyId){var propertyName=propertiesMap[propertyId];if(!propertyName){return""}return getPropertyElement(propertyName,propertyId)}).join("\n");return $(output+"</ul>")},updateSelectedPropertiesList:function updateSelectedPropertiesList(propertyIds,mode){var template=this.getSelectedPropertiesListTemplate(propertyIds);var selectedListSelector=VIEW_SELECTORS.SELECTED_LIST__INCLUDE;var buttonSelector=VIEW_SELECTORS.BUTTON_INCLUDE;if(mode==="exclude"){selectedListSelector=VIEW_SELECTORS.SELECTED_LIST__EXCLUDE;buttonSelector=VIEW_SELECTORS.BUTTON_EXCLUDE}this.$(selectedListSelector).empty().append(template).customtip();this.$(buttonSelector).html(getButtonLabel(this,propertyIds))},refresh:function refresh(){var model=this.model;var $propertiesInput=this.$(VIEW_SELECTORS.INPUT_INCLUDE);var $xpropertiesInput=this.$(VIEW_SELECTORS.INPUT_EXCLUDE);var properties=getPropertiesFromModel(this.collection,model,this.propertyName);var xproperties=getXPropertiesFromModel(this.collection,model,this.propertyName);var includedProperties=properties.join(",");var excludedProperties=xproperties.join(",");$propertiesInput.val(includedProperties);this.updateSelectedPropertiesList(properties,"include");$xpropertiesInput.val(excludedProperties);this.updateSelectedPropertiesList(xproperties,"exclude");this.$(VIEW_SELECTORS.TICK_INCLUDE).toggleClass("applied",!!includedProperties).toggleClass("hidden",!includedProperties);this.$(VIEW_SELECTORS.TICK_EXCLUDE).toggleClass("applied",!!excludedProperties).toggleClass("hidden",!excludedProperties);this.$(".active-indicator").toggleClass("hidden",!includedProperties&&!excludedProperties)},getValues:function getValues(){var includedProperties=this.$(VIEW_SELECTORS.INPUT_INCLUDE).val();var excludedProperties=this.$(VIEW_SELECTORS.INPUT_EXCLUDE).val();var values={};values[this.propertyName]=parseIds(this,includedProperties);values["x"+this.propertyName]=parseIds(this,excludedProperties);return values},onPropertySelectClick:function onPropertySelectClick(e){e.preventDefault();if(this.dropdownView&&this.dropdownView.isShown()){this.SelectDropdownViewClass.hide();return}this.showDropdownView($(e.currentTarget))},onPropertyDeleteClick:function onPropertyDeleteClick(e){var $target=$(e.target);var isInclude=$target.parents(VIEW_SELECTORS.SELECTED_LIST__INCLUDE).length;var propertyId=""+$target.data("propertyId");var $propertyField=getPropertyField(this,isInclude);var propertyIds=$propertyField.val().split(",");propertyIds=_.without(propertyIds,propertyId);$propertyField.val(propertyIds.join(",")).blur()},showDropdownView:function showDropdownView($target){var isInclude=$target.is(VIEW_SELECTORS.BUTTON_INCLUDE);var $propertyField=getPropertyField(this,isInclude);var currentValues=this.getValues();if(this.dropdownView){this.dropdownView.remove()}$target.addClass("active");this.dropdownView=this.SelectDropdownViewClass.show({$target:$target,mode:isInclude?"include":"exclude",collection:this.collection,selectedIds:isInclude?currentValues[this.propertyName]:currentValues["x"+this.propertyName],propertyName:this.propertyName,propertyNamePlural:this.propertyNamePlural,displaySummary:this.displaySummary,summaryActionLabel:this.summaryActionLabel,infoText:this.infoText,callback:function callback(err,selectedProperties){$target.removeClass("active");if(err==="cancelled"){return}$propertyField.val(selectedProperties.join(",")).blur()}})},inputChanged:function inputChanged(e){var $el=$(e.target);var mode=$el.attr("name")==="xproperties"?"exclude":"include";var cats=$el.val().split(",");if(cats.length===1&&!cats[0]){cats=[]}this.updateSelectedPropertiesList(cats,mode);FiltersView.prototype.inputChanged.apply(this,arguments)},getFilterIndicatorStatuses:function getFilterIndicatorStatuses(){var model=this.model;var properties=getPropertiesFromModel(this.collection,model,this.propertyName);var xproperties=getXPropertiesFromModel(this.collection,model,this.propertyName);var ticks={properties:properties.length>0,xproperties:xproperties.length>0};return{tickIndicators:ticks,groupIndicators:properties.concat(xproperties).length>0}}})});define("mustache!src/controls/templates/selectLanguageDropdownList",["lib/mustache"],function(mustache){var escapedTemplate='{{#hasProperties}}\n<fieldset>\n{{#properties.european.length}}\n<div class="js-language-container">\n<div class="js-category-header b-filter-dropdown__header singlepadding-top smallpadding-bottom">\n<h2>European</h2>\n<span class="b-filter-dropdown__header--right smallpadding-right">\n<a class="js-select-all-in-category">Select all</a>\n<a class="js-unselect-all-in-category hidden">Unselect all</a>\n</span>\n</div>\n<ul class="b-filter-dropdown__list smallmargin-left smallpadding-bottom rowborder">\n{{#properties.european}}\n<li class="js-listitem tinymargin-bottom highlightrow">\n<label for="language-{{code}}">\n<input class="js-property tinymargin-right" type="checkbox" name="{{name}}" id="language-{{code}}" value="{{code}}" title="{{name}}" {{checked}} />\n{{{name}}}\n</label>\n</li>\n{{/properties.european}}\n</ul>\n</div>\n{{/properties.european.length}}\n{{#properties.scandinavian.length}}\n<div class="js-language-container">\n<div class="js-category-header b-filter-dropdown__header singlepadding-top smallpadding-bottom">\n<h2>Scandinavian</h2>\n<span class="b-filter-dropdown__header--right smallpadding-right">\n<a class="js-select-all-in-category">Select all</a>\n<a class="js-unselect-all-in-category hidden">Unselect all</a>\n</span>\n</div>\n<ul class="b-filter-dropdown__list smallmargin-left smallpadding-bottom rowborder">\n{{#properties.scandinavian}}\n<li class="js-listitem tinymargin-bottom highlightrow">\n<label for="language-{{code}}">\n<input class="js-property tinymargin-right" type="checkbox" name="{{name}}" id="language-{{code}}" value="{{code}}" title="{{name}}" {{checked}} />\n{{{name}}}\n</label>\n</li>\n{{/properties.scandinavian}}\n</ul>\n</div>\n{{/properties.scandinavian.length}}\n{{#properties.americas.length}}\n<div class="js-language-container">\n<div class="js-category-header b-filter-dropdown__header singlepadding-top smallpadding-bottom">\n<h2>American</h2>\n<span class="b-filter-dropdown__header--right smallpadding-right">\n<a class="js-select-all-in-category">Select all</a>\n<a class="js-unselect-all-in-category hidden">Unselect all</a>\n</span>\n</div>\n<ul class="b-filter-dropdown__list smallmargin-left smallpadding-bottom rowborder">\n{{#properties.americas}}\n<li class="js-listitem tinymargin-bottom highlightrow">\n<label for="language-{{code}}">\n<input class="js-property tinymargin-right" type="checkbox" name="{{name}}" id="language-{{code}}" value="{{code}}" title="{{name}}" {{checked}} />\n{{{name}}}\n</label>\n</li>\n{{/properties.americas}}\n</ul>\n</div>\n{{/properties.americas.length}}\n{{#properties.middleEast.length}}\n<div class="js-language-container">\n<div class="js-category-header b-filter-dropdown__header singlepadding-top smallpadding-bottom">\n<h2>Middle Eastern</h2>\n<span class="b-filter-dropdown__header--right smallpadding-right">\n<a class="js-select-all-in-category">Select all</a>\n<a class="js-unselect-all-in-category hidden">Unselect all</a>\n</span>\n</div>\n<ul class="b-filter-dropdown__list smallmargin-left smallpadding-bottom rowborder">\n{{#properties.middleEast}}\n<li class="js-listitem tinymargin-bottom highlightrow">\n<label for="language-{{code}}">\n<input class="js-property tinymargin-right" type="checkbox" name="{{name}}" id="language-{{code}}" value="{{code}}" title="{{name}}" {{checked}} />\n{{{name}}}\n</label>\n</li>\n{{/properties.middleEast}}\n</ul>\n</div>\n{{/properties.middleEast.length}}\n{{#properties.asia.length}}\n<div class="js-language-container">\n<div class="js-category-header b-filter-dropdown__header singlepadding-top smallpadding-bottom">\n<h2>Asian</h2>\n<span class="b-filter-dropdown__header--right smallpadding-right">\n<a class="js-select-all-in-category">Select all</a>\n<a class="js-unselect-all-in-category hidden">Unselect all</a>\n</span>\n</div>\n<ul class="b-filter-dropdown__list smallmargin-left smallpadding-bottom rowborder">\n{{#properties.asia}}\n<li class="js-listitem tinymargin-bottom highlightrow">\n<label for="language-{{code}}">\n<input class="js-property tinymargin-right" type="checkbox" name="{{name}}" id="language-{{code}}" value="{{code}}" title="{{name}}" {{checked}} />\n{{{name}}}\n</label>\n</li>\n{{/properties.asia}}\n</ul>\n</div>\n{{/properties.asia.length}}\n{{#properties.newLanguage.length}}\n<div class="js-language-container">\n<div class="js-category-header b-filter-dropdown__header singlepadding-top smallpadding-bottom">\n<h2 class="newLanguage">Alpha Languages</h2>\n<span class="b-filter-dropdown__header--right smallpadding-right">\n<a class="js-select-all-in-category">Select all</a>\n<a class="js-unselect-all-in-category hidden">Unselect all</a>\n</span>\n</div>\n<ul class="b-filter-dropdown__list smallmargin-left smallpadding-bottom rowborder">\n{{#properties.newLanguage}}\n<li class="js-listitem tinymargin-bottom highlightrow">\n<label for="language-{{code}}">\n<input class="js-property tinymargin-right" type="checkbox" name="{{name}}" id="language-{{code}}" value="{{code}}" title="{{name}}" {{checked}} />\n{{{name}}}\n</label>\n</li>\n{{/properties.newLanguage}}\n</ul>\n</div>\n{{/properties.newLanguage.length}}\n</fieldset>\n{{/hasProperties}}\n\n<div class="js-no-results {{#hasProperties}}hidden {{/hasProperties}}bigtext grey textcenter smallpadding-vertical">{{capitalisedPropertyName}} not found</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/controls/views/SelectLanguagesView",["underscore","jquery","backbone","bw-fe-helpers/languageGroupHelper","src/controls/views/SelectDropdownView","mustache!src/controls/templates/selectLanguageDropdownList"],function(_,$,Backbone,languageGroupHelper,SelectDropdownView,listTemplate){"use strict";var VIEW_SELECTORS={FOLLOWING_VISIBLE_INPUTS:"+ ul li:not(.hidden) .js-property",CATEGORY_HEADER:".js-category-header",LANGUAGE_CONTAINER:".js-language-container",SELECT_ALL_IN_CATEGORY:".js-select-all-in-category",UNSELECT_ALL_IN_CATEGORY:".js-unselect-all-in-category"};function onClickSelectAllInCategory(view,e){toggleDisplayedItemsInCategory(view,e.target,true)}function onClickUnselectAllInCategory(view,e){toggleDisplayedItemsInCategory(view,e.target,false)}function toggleDisplayedItemsInCategory(view,target,select){var $targetedInputs=$(target).closest(VIEW_SELECTORS.CATEGORY_HEADER).find(VIEW_SELECTORS.FOLLOWING_VISIBLE_INPUTS);$targetedInputs.prop("checked",select).parent().toggleClass("bold",select);view.currentlySelectedIds=view.getSelectedIds();view.updateView()}function isLanguageSelected(languageData,selectedIds){return _(selectedIds).find(function(id){return id===languageData.id})}return SelectDropdownView.extend({constructor:function SelectLanguagesView(options){SelectDropdownView.call(this,_.extend({listTemplate:listTemplate,propertyName:"language"},options))},events:function events(){var events=SelectDropdownView.prototype.events.call(this);events["click "+VIEW_SELECTORS.SELECT_ALL_IN_CATEGORY]=onClickSelectAllInCategory.bind(null,this);events["click "+VIEW_SELECTORS.UNSELECT_ALL_IN_CATEGORY]=onClickUnselectAllInCategory.bind(null,this);return events},hasSearchResults:function hasSearchResults(filteredPropertiesData){return filteredPropertiesData&&Object.keys(filteredPropertiesData).some(function(key){return filteredPropertiesData[key]&&filteredPropertiesData[key].length>0})},preparePropertyData:function preparePropertyData(filteredProperties,useCurrentIds){var selectedIds=useCurrentIds?this.currentlySelectedIds:this.selectedIds;var languageCollection=new Backbone.Collection(filteredProperties);var languageDataByCategory=languageGroupHelper.getLanguageData(languageCollection);languageDataByCategory=languageGroupHelper.asteriskAlphaLanguages(languageDataByCategory);Object.keys(languageDataByCategory).forEach(function(key){languageDataByCategory[key]=languageDataByCategory[key].map(function(languageData){languageData.checked=isLanguageSelected(languageData,selectedIds)?"checked":"";return languageData})});return languageDataByCategory},updateMultiSelectLinks:function updateMultiSelectLinks(){this.$(VIEW_SELECTORS.CATEGORY_HEADER).each(function(){var $this=$(this);var $allProperties=$this.find(VIEW_SELECTORS.FOLLOWING_VISIBLE_INPUTS);var $selectedProperties=$allProperties.filter(function(){return $(this).is(":checked")});var allSelected=$selectedProperties.length===$allProperties.length;$this.find(VIEW_SELECTORS.SELECT_ALL_IN_CATEGORY).toggleClass("hidden",allSelected);$this.find(VIEW_SELECTORS.UNSELECT_ALL_IN_CATEGORY).toggleClass("hidden",!allSelected)});SelectDropdownView.prototype.updateMultiSelectLinks.call(this)},renderSearchResult:function renderSearchResult(){SelectDropdownView.prototype.renderSearchResult.call(this);this.$(VIEW_SELECTORS.LANGUAGE_CONTAINER).each(function(){var $this=$(this);var hasMatch=$this.find("li:not(.hidden)").length>0;$this.toggleClass("hidden",!hasMatch)})}})});define("src/controls/filters/LanguageFilters",["underscore","src/controls/filters/BaseDropdownFiltersView","src/controls/views/SelectLanguagesView"],function(_,BaseDropdownFiltersView,SelectLanguagesView){"use strict";return BaseDropdownFiltersView.extend({constructor:function LanguageFilters(options){if(!options||!options.languageCollection){throw new TypeError("LanguageFilters must be instantiated with a languageCollection option")}var infoText="* These languages only have basic support."+'<a class="help icon-bwhelp smallmargin-left" data-key="filters-language-support" title="View help text"></a>';BaseDropdownFiltersView.call(this,_.extend({},options,{propertyName:"language",infoText:infoText,collection:options.languageCollection,SelectDropdownViewClass:SelectLanguagesView}))}})});define("mustache!src/controls/filters/templates/location",["lib/mustache"],function(mustache){var escapedTemplate='<div>\n<p>\n<a rel="location" class="toggle {{fieldsetHiddenArrow}}"><span class="icon-chevron-right grey smallpadding-right"></span>Location</a>\n<span data-rel="location" class="active-indicator {{groupClass}}">On</span>\n</p>\n<fieldset class="location {{fieldsetHidden}}">\n</fieldset>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/controls/css/locationFilters.css",["css!src/controls/css/compiled.css"],function(){});define("src/controls/filters/LocationFilters",["underscore","jquery","src/controls/lib/paramAssert","src/controls/filters/FiltersView","src/controls/filters/GenericLocationFilters","mustache!src/controls/filters/templates/location","css!src/controls/css/locationFilters.css"],function(_,$,paramAssert,FiltersView,GenericLocationFilters,locationTemplate){"use strict";return FiltersView.extend({constructor:function LocationFilters(options){paramAssert.isNotDefined(options||options.locationGroups,"options.locationGroups must be supplied");paramAssert.isNotDefined(options.userId,"options.userId must be supplied");paramAssert.isNotDefined(options.hasOwnProperty("ownerId"),"options.ownerId must be supplied");this.locationGroups=options.locationGroups;this.userId=options.userId;this.ownerId=options.ownerId;this.autocompletePosition=options.autocompletePosition||"left";FiltersView.apply(this,arguments)},remove:function remove(){if(this.locationFiltersView){this.locationFiltersView.remove()}FiltersView.prototype.remove.call(this)},makeEl:function makeEl(data){var $template=$(locationTemplate(this.getTemplateData(data)));return this.renderLocationFilters($template).then(function(){return $template})},render:function render(){var self=this;return this.makeEl(this.model.toJSON()).then(function(el){self.$el.html(el);self.setupMultiSelects()})},getTemplateData:function getTemplateData(){var data=FiltersView.prototype.getTemplateData.call(this);return _(data).extend({fieldsetHidden:"hidden"})},renderLocationFilters:function renderLocationFilters($template){var view=this,filterData,locationFiltersView=this.locationFiltersView;if(!locationFiltersView){filterData={location:this.model.get("location"),locationGroup:this.model.get("locationGroup"),xlocation:this.model.get("xlocation"),xlocationGroup:this.model.get("xlocationGroup")};locationFiltersView=this.locationFiltersView=new GenericLocationFilters({data:filterData,filterLabel:"Locations",helpKey:"filters-location",locationGroups:this.locationGroups,userId:this.userId,ownerId:this.ownerId,showHelp:this.getTemplateData(this.model.toJSON()).showHelp,autocompletePosition:this.autocompletePosition});view.listenTo(locationFiltersView,"changesMade",function(){view.trigger("changesMade")})}return locationFiltersView.render().then(function(){$template.find("fieldset.location").append(locationFiltersView.$el)})},getValues:function getValues(){var values=FiltersView.prototype.getValues.call(this),locations,locationFiltersView=this.locationFiltersView;if(locationFiltersView){locations=this.locationFiltersView.getValues();values.location=locations.location;values.xlocation=locations.xlocation;values.locationGroup=locations.locationGroup;values.xlocationGroup=locations.xlocationGroup}return values},refresh:function refresh(){FiltersView.prototype.refresh.call(this);this.refreshLocationFilters()},refreshLocationFilters:function refreshLocationFilters(){var locationFiltersView=this.locationFiltersView,model=this.model;if(!locationFiltersView){return}var locationFilterApplied=model.has("location")&&model.get("location").length>0||model.has("xlocation")&&model.get("xlocation").length>0||model.has("locationGroup")&&model.get("locationGroup").length>0||model.has("xlocationGroup")&&model.get("xlocationGroup").length>0;if(locationFilterApplied){this.$(".active-indicator").removeClass("hidden")}locationFiltersView.setData({location:model.get("location"),locationGroup:model.get("locationGroup"),xlocation:model.get("xlocation"),xlocationGroup:model.get("xlocationGroup")});locationFiltersView.render()},getFilterIndicatorStatuses:function getFilterIndicatorStatuses(model){var ticks={location:!this.isNullOrEmpty(model.get("location")),xlocation:!this.isNullOrEmpty(model.get("xlocation")),locationGroup:!this.isNullOrEmpty(model.get("locationGroup")),xlocationGroup:!this.isNullOrEmpty(model.get("xlocationGroup"))},groups=_(ticks).some(function(tick){return tick});return{tickIndicators:ticks,groupIndicators:groups}}})});define("src/controls/filters/categoryFiltersHelper",["underscore","src/controls/lib/paramAssert"],function(_,paramAssert){"use strict";function getSelectionAsText(categories,options){var category,selectedIds,mode;paramAssert.isNotDefined(categories,"getSelectionAsText must be passed a categories argument");paramAssert.isNotDefined(options,"getSelectionAsText must be passed an options argument");paramAssert.isNotDefined(options.categoryId,"Missing options.categoryId");paramAssert.isNotDefined(options.mode,"Missing options.mode");category=categories.get(options.categoryId);selectedIds=options.selectedIds||[];mode=options.mode;if(!selectedIds.length){return""}if(selectedIds[0]===category.id){return _(category.get("children")).pluck("name").join(" OR ")}return _(category.get("children")).chain().filter(function(subcat){return selectedIds.indexOf(subcat.id)>-1}).pluck("name").value().join(mode==="include"?" AND ":" OR ")}return{getSelectionAsText:getSelectionAsText}});define("mustache!src/controls/filters/templates/categoryFiltersContextMenu",["lib/mustache"],function(mustache){var escapedTemplate='<div class="modular popupframe threecol singlepadding filterSelectionPopup categoryFiltersSelection">\n<header>\n<h1 class="singlemargin-bottom">{{#isInclude}}Filter by{{/isInclude}}{{^isInclude}}Exclude{{/isInclude}} Category</h1>\n</header>\n<div>\n<ul class="tinypadding-vertical bwscrollbar-narrow">\n<li class="{{#checked}}bold{{/checked}}">\n<label for="{{cid}}_{{id}}" class="db tinypadding customtip textellipsis ellipsistooltip" title=\'Any "{{name}}"\'>\n<input name="selection" type="{{inputType}}" id="{{cid}}_{{id}}" val="{{id}}" class="smallmargin-right" {{#checked}}checked{{/checked}}/>\nAny "{{name}}"\n</label>\n</li>\n<li class="separator tinypadding-bottom tinymargin-bottom"></li>\n{{#categories}}\n<li class="{{#checked}}bold{{/checked}}">\n<label for="{{cid}}_{{id}}" class="db tinypadding customtip textellipsis ellipsistooltip" title="{{name}}">\n<input name="selection" type="{{inputType}}" id="{{cid}}_{{id}}" val="{{id}}" class="smallmargin-right" {{#checked}}checked{{/checked}}/>\n{{name}}\n</label>\n</li>\n{{/categories}}\n</ul>\n<div class="singlemargin-top helpbox infoboxbgcolor rounded noSelection">\n<span class="helplabel db tinypadding-vertical smallpadding-left">\n{{#isInclude}}Show{{/isInclude}}{{^isInclude}}Exclude{{/isInclude}} mentions categorised as\n</span>\n<span class="helptext db smallpadding tinymargin-vertical"></span>\n</div>\n</div>\n<footer class="singlemargin-top">\n<button class="apply defaultbutton" disabled>Set as Filter</button>\n<button class="close button singlemargin-left">Cancel</button>\n</footer>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/controls/css/categoryFiltersContextMenu.css",["css!src/controls/css/compiled.css"],function(){});define("src/controls/filters/CategoryFiltersContextMenuView",["jquery","underscore","src/controls/lib/paramAssert","src/controls/views/ContextMenuView","src/controls/filters/categoryFiltersHelper","mustache!src/controls/filters/templates/categoryFiltersContextMenu","css!src/controls/css/categoryFiltersContextMenu.css","customtip"],function($,_,paramAssert,ContextMenuView,categoryFiltersHelper,template){"use strict";function truncate(text,length){if(text.length<length){return text}return text.substring(0,length)+"..."}function formatSubcategoriesData(children,selection){return _(children).chain().sortBy(function(child){return _.isUndefined(child.ordering)?child.name:child.ordering}).map(function(child){return{name:child.name,id:child.id,checked:selection.indexOf(child.id)>-1}}).value()}function getSelectedIds($selection){return $selection.map(function(idx,elem){return parseInt($(elem).attr("val"),10)}).get()}var CategoryFiltersContextMenuView=ContextMenuView.extend({events:{"change input":"onChangeSelection",'change input[type="checkbox"]':"onClickCheckbox","click .apply":"onApply","click .close":"onClose","click .categoryFiltersSelection":"onClickStopPropagation"},constructor:function CategoryFiltersContextMenuView(options){ContextMenuView.apply(this,arguments);paramAssert.isNotDefined(options,"CategoryFiltersContextMenuView must be passed an options argument");paramAssert.isNotDefined(options.categories,"CategoryFiltersContextMenuView must be passed a categories option");paramAssert.isNotDefined(options.category,"CategoryFiltersContextMenuView must be passed a category option");paramAssert.isNotDefined(options.mode,"CategoryFiltersContextMenuView must be initialised with options.mode");this.categories=options.categories;this.category=options.category;this.mode=options.mode;this.selection=options.selection||[]},render:function render(){var category=this.category,selection=this.selection,isInclude=this.mode==="include",data={cid:this.cid,isInclude:isInclude,name:category.get("name"),id:category.id,checked:selection.indexOf(category.id)>-1,inputType:isInclude?category.get("multiple")===true?"checkbox":"radio":"checkbox",categories:formatSubcategoriesData(this.category.get("children"),selection)};this.$el.html(template(data)).customtip();this.updateHelpText();this.toggleApplyButton()},highlightSelection:function highlightSelection(){var $checked=this.$("input:checked");this.$("li").removeClass("bold");$checked.closest("li").addClass("bold")},updateHelpText:function updateHelpText(){var $helpTextEl=this.$(".helptext"),selectedIds=getSelectedIds(this.$("input:checked")),helpTextMaxSize=50,helpText;if(!selectedIds.length){return $helpTextEl.html("").parent().addClass("noSelection")}helpText=categoryFiltersHelper.getSelectionAsText(this.categories,{categoryId:this.category.id,selectedIds:selectedIds,mode:this.mode});helpText=truncate(helpText,helpTextMaxSize);$helpTextEl.text(helpText).parent().removeClass("noSelection")},toggleApplyButton:function toggleApplyButton(){var selection=getSelectedIds(this.$("input:checked"));this.$(".apply").prop("disabled",!selection.length)},onClickStopPropagation:function onClickStopPropagation(e){e.stopPropagation()},onChangeSelection:function onChangeSelection(){this.highlightSelection();this.updateHelpText();this.toggleApplyButton()},onClickCheckbox:function onClickCheckbox(e){var $target=$(e.currentTarget),value=parseInt($target.attr("val"),10),isChecked=$target.is(":checked");if(!isChecked){return}if(value===this.category.id){var $otherOptions=this.$("input").not($target);return $otherOptions.prop("checked",false).trigger("change")}this.$("input:first").prop("checked",false).trigger("change")},onApply:function onApply(){this.trigger("categorySelectionClosed",{categoryId:this.category.id,mode:this.mode,selection:getSelectedIds(this.$("input:checked"))});this.remove()},onClose:function onClose(){this.trigger("categorySelectionClosed");this.remove()}});return CategoryFiltersContextMenuView});define("mustache!src/controls/filters/templates/categories",["lib/mustache"],function(mustache){var escapedTemplate='<p>\n<a rel="category" class="toggle {{#isExpanded}}on{{/isExpanded}}">\n<span class="icon-chevron-{{#isExpanded}}down{{/isExpanded}}{{^isExpanded}}right{{/isExpanded}} grey smallpadding-right"></span>Category\n</a>\n<span data-rel="category" class="active-indicator {{groupClass}}">On</span>\n</p>\n<fieldset class="category {{^isExpanded}}hidden{{/isExpanded}} modular">\n{{^hasCategories}}\n<p class="notification-info rounded smallpadding-vertical singlepadding-horizontal mediumline smallmargin-top">\nThere are no Categories in this Project yet by which you can filter.\n</p>\n{{/hasCategories}}\n{{#hasCategories}}\n<div class="include clearfix" data-mode="include">\n<p class="categories clearfix">\n<span class="indicator {{#getTickClass}}categories{{/getTickClass}}" data-tick-key="categories"></span>\n<label class="fullwidth">Filter by Category</label>\n</p>\n<ul class="selectedValues">\n{{{included}}}\n</ul>\n<select name="categories" class="selectfield floatleft">\n<option value="">-- Select Category --</option>\n{{{options}}}\n</select>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-category-include"></a>\n{{/showHelp}}\n</div>\n<div class="exclude clearfix singlemargin-top" data-mode="exclude">\n<p class="excludeCategories clearfix">\n<span class="indicator {{#getTickClass}}excludeCategories{{/getTickClass}}" data-tick-key="excludeCategories"></span>\n<label class="fullwidth singlemargin-top">Exclude Category</label>\n</p>\n<ul class="selectedValues">\n{{{excluded}}}\n</ul>\n<select name="excludeCategories" class="selectfield floatleft">\n<option value="">-- Select Category --</option>\n{{{options}}}\n</select>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-category-exclude"></a>\n{{/showHelp}}\n</div>\n{{/hasCategories}}\n</fieldset>';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/controls/filters/templates/categoryItem",["lib/mustache"],function(mustache){var escapedTemplate='<li data-categoryid={{id}} class="relative">\n<span class="js-edit absleft smallpadding-left textellipsis customtip" title="Change selection: {{name}} {{#selectionText}}({{selectionText}}){{/selectionText}}">\n{{name}}\n{{#hasSelectedChildren}}\n({{#children}}<span data-subcategoryid="{{id}}">{{name}}</span>{{^isLast}}, {{/isLast}}{{/children}})\n{{/hasSelectedChildren}}\n</span>\n<a class="js-remove absright tinymargin-right iconsmaller icon-remove customtip" title="Deselect"></a>\n</li>';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/controls/css/categoryFilters.css",["css!src/controls/css/compiled.css"],function(){});define("src/controls/filters/CategoryFilters",["underscore","jquery","src/controls/lib/paramAssert","src/controls/lib/controlsViewDataBuilder","src/controls/filters/FiltersView","src/controls/filters/CategoryFiltersContextMenuView","src/controls/filters/categoryFiltersHelper","mustache!src/controls/filters/templates/categories","mustache!src/controls/filters/templates/categoryItem","selleckt","customtip","css!src/controls/css/categoryFilters.css"],function(_,$,paramAssert,controlsViewDataBuilder,FiltersView,CategoryFiltersContextMenuView,categoryFiltersHelper,template,itemTemplate){"use strict";function getParentCategoriesData(ids){if(!ids||!ids.length){return[]}return _(ids).map(function(id){return{categoryId:id,selection:[id]}})}function getChildrenCategoriesData(categories,ids){var parent;if(!ids||!ids.length){return[]}return _(ids).chain().reduce(function(memo,childId){parent=categories.find(function(cat){return _(cat.get("children")).any(function(child){return child.id===childId})});if(!parent){return memo}if(memo[parent.id]){memo[parent.id].selection.push(childId);return memo}memo[parent.id]={categoryId:parent.id,selection:[childId]};return memo},{}).values().value()}function getSelectedCategoryIds(categories,data){var inclParents=getParentCategoriesData(data.parentCategory),exclParents=getParentCategoriesData(data.xparentCategory),inclCategories=getChildrenCategoriesData(categories,data.category),exclCategories=getChildrenCategoriesData(categories,data.xcategory);return{included:[].concat(inclCategories,inclParents),excluded:[].concat(exclCategories,exclParents)}}function formatChildrenData(children){if(!children||!children.length){return}return _(children).chain().sortBy(function(child){return _.isUndefined(child.ordering)?child.name:child.ordering}).map(function(child,idx,list){return{id:child.id,name:child.name,isLast:idx===list.length-1}}).value()}function buildSelectedItem(categories,category,selection,mode){var hasSelectedChildren,selectedChildren,data;if(!category||!selection||!selection.length){return""}hasSelectedChildren=selection.length&&selection[0]!==category.id;selectedChildren=!hasSelectedChildren?[]:_(category.get("children")).filter(function(child){return selection.indexOf(child.id)>-1});data={id:category.id,name:category.get("name"),selectionText:categoryFiltersHelper.getSelectionAsText(categories,{categoryId:category.id,selectedIds:selection,mode:mode}),hasSelectedChildren:hasSelectedChildren,children:formatChildrenData(selectedChildren)};return itemTemplate(data,false)}function buildSelectedItems(categories,items,mode){return _(items).map(function(item){var category=categories.get(item.categoryId);return buildSelectedItem(categories,category,item.selection,mode)}).join("")}function buildCategoryOptionString(category){var subcategories=_(category.children).chain().sortBy(function(subcategory){return _.isUndefined(subcategory.ordering)?subcategory.name:subcategory.ordering}).pluck("name").value().join(", ");return category.name+" ("+subcategories+")"}function parseIds(items,mode){var isInclude=mode==="include",parents=isInclude?"parentCategory":"xparentCategory",children=isInclude?"category":"xcategory",memo={},$category,$subcategories;memo[parents]=[];memo[children]=[];return _(items).reduce(function(memo,item){$category=$(item);$subcategories=$category.find("[data-subcategoryid]");if(!$subcategories.length){memo[parents].push(parseInt($category.data("categoryid"),10));return memo}_($subcategories).each(function(subcategory){memo[children].push(parseInt($(subcategory).data("subcategoryid"),10))});return memo},memo)}function getUserCategoriesData(categories){var userCategories=categories.toJSON();return _(userCategories).chain().sortBy(function(category){return category.name.toLowerCase()}).map(function(category){return{id:category.id,name:buildCategoryOptionString(category)}}).value()}function getSelectionForCategory($categoryEl){var $subcategories=$categoryEl.find("[data-subcategoryid]");if(!$categoryEl.length){return}if(!$subcategories.length){return[$categoryEl.data("categoryid")]}return $subcategories.map(function(idx,elem){return $(elem).data("subcategoryid")}).get()}var CategoryFilters=FiltersView.extend({events:function events(){return _.extend(FiltersView.prototype.events.call(this),{"click .js-edit":"onEditCategory","click .js-remove":"onRemoveCategory"})},constructor:function CategoryFilters(options){FiltersView.apply(this,arguments);paramAssert.isNotDefined(options||options.categories,"CategoryFilters must be constructed with a categories option");this.categories=options.categories;this.listenTo(this.categories,"add remove change reset",this.onCategoriesUpdated,this)},render:function render(){FiltersView.prototype.render.call(this);this.setupCategorySelects()},remove:function remove(){FiltersView.prototype.remove.call(this)},onCategoriesUpdated:function onCategoriesUpdated(){this.render()},getValues:function getValues(){var included=parseIds(this.$(".include [data-categoryid]"),"include"),excluded=parseIds(this.$(".exclude [data-categoryid]"),"exclude");return _.extend({},included,excluded)},refresh:function refresh(){var data=this.model.toJSON(),currentSelection=getSelectedCategoryIds(this.categories,data),included=buildSelectedItems(this.categories,currentSelection.included,"include"),excluded=buildSelectedItems(this.categories,currentSelection.excluded,"exclude");this.$(".include .selectedValues").empty().append(included);this.$(".exclude .selectedValues").empty().append(excluded);this.$(".include .indicator").toggleClass("applied",!!included).toggleClass("hidden",!included);this.$(".exclude .indicator").toggleClass("applied",!!excluded).toggleClass("hidden",!excluded);this.$(".active-indicator").toggleClass("hidden",!included&&!excluded);this.$el.customtip()},makeEl:function makeEl(data){var userCategories=getUserCategoriesData(this.categories),currentSelection=getSelectedCategoryIds(this.categories,data);data=this.getTemplateData(data);data=_.extend(data,{hasCategories:userCategories&&userCategories.length||false,options:controlsViewDataBuilder.buildOptionsFromObject(userCategories),included:buildSelectedItems(this.categories,currentSelection.included,"include"),excluded:buildSelectedItems(this.categories,currentSelection.excluded,"exclude"),isExpanded:this.$(".toggle.on").length});return template(data)},setupCategorySelects:function setupCategorySelects(){var $select=this.$("select"),sellecktOptions=_.extend({},this.getSellecktOptions($select),{enableSearch:true,className:"selleckt modular db floatleft"});$select.selleckt(sellecktOptions);$select.parent().customtip()},selectChanged:function selectChanged(e){var $select=$(e.currentTarget),categoryId=parseInt($select.val(),10),mode=$select.closest(".include, .exclude").data("mode");if(isNaN(categoryId)){return}$select.val("").change();this.showCategoryContextMenu({$target:$select.siblings(".selleckt"),categoryId:categoryId,mode:mode})},showCategoryContextMenu:function showCategoryContextMenu(options){var contextMenu=CategoryFiltersContextMenuView.show(_.extend({selection:getSelectionForCategory(this.$("."+options.mode+' [data-categoryid="'+options.categoryId+'"]')),categories:this.categories,category:this.categories.get(options.categoryId)},options));this.listenToOnce(contextMenu,"categorySelectionClosed",this.onSelectCategory)},onEditCategory:function onEditCategory(e){e.stopPropagation();var $item=$(e.currentTarget).closest("li"),categoryId=$item.data("categoryid"),mode=$item.closest(".include, .exclude").data("mode");$(".tooltip").hide();this.showCategoryContextMenu({$target:$item,categoryId:categoryId,mode:mode})},selectCategory:function selectCategory(options){var category=this.categories.get(options.categoryId),selection=options.selection||[],mode=options.mode,$currentItem,$newItem;if(!category){return}$newItem=$(buildSelectedItem(this.categories,category,selection,mode));$currentItem=this.$("."+mode+' li[data-categoryid="'+category.id+'"]');if($currentItem.length){$currentItem.replaceWith($newItem)}else{this.$("."+mode+" .selectedValues").append($newItem)}$newItem.customtip();this.toggleIndicator(this.$("."+mode+" .indicator"),true);this.trigger("changesMade")},onSelectCategory:function onSelectCategory(options){if(!options){return}this.selectCategory(options)},removeCategory:function removeCategory(categoryId,mode){var $item=this.$("."+mode+' li[data-categoryid="'+categoryId+'"]'),remainingItems=$item.siblings().length;$item.remove();if(!remainingItems){this.toggleIndicator(this.$("."+mode+" .indicator"),false)}this.trigger("changesMade")},onRemoveCategory:function onRemoveCategory(e){var $target=$(e.currentTarget),categoryId=$target.closest("li").data("categoryid"),mode=$target.closest(".include, .exclude").data("mode");this.removeCategory(categoryId,mode)},getFilterIndicatorStatuses:function getFilterIndicatorStatuses(model){var ticks={categories:!this.isNullOrEmpty(model.get("category"))||!this.isNullOrEmpty(model.get("parentCategory")),excludeCategories:!this.isNullOrEmpty(model.get("xcategory"))||!this.isNullOrEmpty(model.get("xparentCategory"))},groups=!!_(ticks).find(function(item){return item});return{tickIndicators:ticks,groupIndicators:groups}}});return CategoryFilters});define("src/controls/filters/TagFilters",["underscore","src/controls/filters/BaseDropdownFiltersView"],function(_,BaseDropdownFiltersView){"use strict";return BaseDropdownFiltersView.extend({constructor:function TagFilters(options){if(!options||!(options.tags||options.tagCollection)){throw new TypeError("TagFilters must be instantiated with a tagCollection option")}BaseDropdownFiltersView.call(this,_.extend({},options,{propertyName:"tag",collection:options.tags||options.tagCollection,displaySummary:true,summaryActionLabel:"tagged"}))}})});define("mustache!src/controls/filters/templates/site",["lib/mustache"],function(mustache){var escapedTemplate='<p>\n<a rel="site" class="toggle"><span class="icon-chevron-right grey smallpadding-right"></span>Site</a>\n<span data-rel="site" class="active-indicator {{groupClass}}">On</span>\n</p>\n<fieldset class="site hidden">\n<p class="mozRankMin clearfix">\n<span class="indicator {{tickClass.mozRankMin}}" data-tick-key="mozRankMin"></span>\n<label class="mozLabel">Min mozrank</label>\n<select name="mozRankMin" class="mozRank selectfield">\n<option value="">all</option>\n{{{minMozRankOptions}}}\n</select>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-moz-min" ></a>\n{{/showHelp}}\n</p>\n<p class="mozRankMax clearfix">\n<span class="indicator {{tickClass.mozRankMax}}" data-tick-key="mozRankMax"></span>\n<label class="mozLabel">Max mozrank</label>\n<select name="mozRankMax" class="mozRank selectfield">\n<option value="">all</option>\n{{{maxMozRankOptions}}}\n</select>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-moz-max" ></a>\n{{/showHelp}}\n</p>\n<p class="backlinks clearfix">\n<span class="indicator {{tickClass.backlinks}}" data-tick-key="backlinks"></span>\n<label>Backlinks</label>\n<input name="backlinksMin" placeholder="Min" class="field num" pattern="{{isPositiveNumberRegex}}" value="{{backlinksMin}}"/>\n<span> to </span>\n<input name="backlinksMax" placeholder="Max" class="field num" pattern="{{isPositiveNumberRegex}}" value="{{backlinksMax}}"/>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-backlinks" ></a>\n{{/showHelp}}\n</p>\n<p class="js-unknown-site-group clearfix {{^hasUnknownFilters}}hidden{{/hasUnknownFilters}}">\n<span class="iconsmall icon-info-sign"></span>\n<label>Site List filters applied</label>\n<a class="help icon-bwhelp" data-key="filters-unknown-group-applied" tabIndex="-1"></a>\n</p>\n<p data-sitegroup-type="included" class="sitegroup inclSiteGroups clearfix">\n<span class="indicator {{tickClass.siteGroups}}" data-tick-key="siteGroups"></span>\n<select name="siteGroup" class="selectfield" title="Site Lists" multiple>\n{{{includedSiteGroupOptions}}}\n</select>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-include-site-groups" ></a>\n{{/showHelp}}\n</p>\n<p data-sitegroup-type="excluded" class="sitegroup exlSiteGroups clearfix">\n<span class="indicator {{tickClass.excludeSiteGroups}}" data-tick-key="excludeSiteGroups"></span>\n<select name="xsiteGroup" class="selectfield" title="Exclude Site Lists" multiple>\n{{{excludedSiteGroupOptions}}}\n</select>\n</p>\n<p class="clearfix extra-top-margin">\n<span class="indicator {{tickClass.monthlyVisitors}}" data-tick-key="monthlyVisitors"></span>\n<label class="doubleheight" for="monthlyVisitorsMin{{cid}}">Visitors / Month</label>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-visitors-month" ></a>\n{{/showHelp}}\n<input id="monthlyVisitorsMin{{cid}}" name="monthlyVisitorsMin" placeholder="Min" class="field num" pattern="{{isPositiveNumberRegex}}" value="{{monthlyVisitorsMin}}"/>\n<span> to </span>\n<input name="monthlyVisitorsMax" placeholder="Max" class="field num" pattern="{{isPositiveNumberRegex}}" value="{{monthlyVisitorsMax}}"/>\n</p>\n<p class="clearfix">\n<span class="indicator {{tickClass.averageVisits}}" data-tick-key="averageVisits"></span>\n<label class="doubleheight" for="avarageVisitsMin{{cid}}">Avg. Visits</label>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-visitors-visits" ></a>\n{{/showHelp}}\n<input id="avarageVisitsMin{{cid}}" name="averageVisitsMin" placeholder="Min" class="field num" pattern="{{isPositiveNumberRegex}}" value="{{averageVisitsMin}}"/>\n<span> to </span>\n<input name="averageVisitsMax" placeholder="Max" class="field num" pattern="{{isPositiveNumberRegex}}" value="{{averageVisitsMax}}"/>\n</p>\n<p class="clearfix">\n<span class="indicator {{tickClass.pagesPerVisit}}" data-tick-key="pagesPerVisit"></span>\n<label class="doubleheight" for="pagesPerVisitMin{{cid}}">Avg. Pages</label>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-visitor-pages" ></a>\n{{/showHelp}}\n<input id="pagesPerVisitMin{{cid}}" name="pagesPerVisitMin" placeholder="Min" class="field num" pattern="{{isPositiveNumberRegex}}" value="{{pagesPerVisitMin}}"/>\n<span> to </span>\n<input name="pagesPerVisitMax" placeholder="Max" class="field num" pattern="{{isPositiveNumberRegex}}" value="{{pagesPerVisitMax}}"/>\n</p>\n<p class="clearfix">\n<span class="indicator {{tickClass.averageDurationOfVisit}}" data-tick-key="averageDurationOfVisit"></span>\n<label class="doubleheight" for="averageDurationOfVisitMin{{cid}}">Avg. Time (min)</label>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-visitor-duration" ></a>\n{{/showHelp}}\n<input id="averageDurationOfVisitMin{{cid}}" name="averageDurationOfVisitMin" placeholder="Min" class="field num" pattern="{{isPositiveNumberRegex}}" value="{{averageDurationOfVisitMin}}"/>\n<span> to </span>\n<input name="averageDurationOfVisitMax" placeholder="Max" class="field num" pattern="{{isPositiveNumberRegex}}" value="{{averageDurationOfVisitMax}}"/>\n</p>\n<p class="gender clearfix">\n<span class="indicator {{tickClass.percentMaleVisitorsMin}}" data-tick-key="percentMaleVisitorsMin"></span>\n<label>% Male</label>\n<select name="percentMaleVisitorsMin" class="selectfield">\n<option value="">Min</option>\n{{{minMaleOptions}}}\n</select>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-percent-male" ></a>\n{{/showHelp}}\n</p>\n<p class="gender clearfix">\n<span class="indicator {{tickClass.percentFemaleVisitorsMin}}" data-tick-key="percentFemaleVisitorsMin"></span>\n<label>% Female</label>\n<select name="percentFemaleVisitorsMin" class="selectfield">\n<option value="">Min</option>\n{{{minFemaleOptions}}}\n</select>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-percent-female" ></a>\n{{/showHelp}}\n</p>\n</fieldset>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/controls/filters/Site/Renderer",["src/controls/filters/filtersHelper","src/controls/lib/paramAssert","src/controls/lib/controlsViewDataBuilder","mustache!src/controls/filters/templates/site"],function(filtersHelper,paramAssert,controlsViewDataBuilder,template){"use strict";var MOZ_RANKS=[1,2,3,4,5,6,7,8,9,10];var PERCENTAGES=[10,20,30,40,50,60,70,80,90,100];var EMPTY_ARRAY=[];var Renderer={};function verifyMozRankOptions(options){var mozRankMin=options.mozRankMin!==undefined?options.mozRankMin:NaN;var mozRankMax=options.mozRankMax!==undefined?options.mozRankMax:NaN;paramAssert.isType(mozRankMin,"number","getTemplateData expects mozRankMin to be undefined or a Number");paramAssert.isType(mozRankMax,"number","getTemplateData expects mozRankMin to be undefined or a Number")}function verifyBacklinksOptions(options){var backlinksMin=options.backlinksMin!==undefined?options.backlinksMin:NaN;var backlinksMax=options.backlinksMax!==undefined?options.backlinksMax:NaN;paramAssert.isType(backlinksMin,"number","getTemplateData expects mozRankMin to be undefined or a Number",false);paramAssert.isType(backlinksMax,"number","getTemplateData expects mozRankMin to be undefined or a Number",false)}function verifySiteGroupsOptions(options){paramAssert.isType(options.siteGroups,"array","getTemplateData expects siteGroups to be an Array");paramAssert.isType(options.selectedSiteGroups,"array","getTemplateData expects selectedSiteGroups to be an Array");paramAssert.isType(options.selectedXSiteGroups,"array","getTemplateData expects selectedXSiteGroups to be an Array")}function verifySiteVisitorsOptions(options){["monthlyVisitorsMin","monthlyVisitorsMax","averageVisitsMin","averageVisitsMax","pagesPerVisitMin","pagesPerVisitMax","averageDurationOfVisitMin","averageDurationOfVisitMax","minMaleOptions","minFemaleOptions"].forEach(function(key){return options[key]===undefined||paramAssert.isType(options[key],"number","getTemplateData expects ".concat(key," to be undefined or a Number but is ").concat(options[key]))})}function verifyGetTemplateViewOptions(options,userId){paramAssert.isType(options.showHelp,"boolean","getTemplateData expects showHelp option to be a Boolean");paramAssert.isType(options.isOn,"boolean","getTemplateData expects isOn option to be a Boolean");paramAssert.isType(options.hasUnknownFilters,"boolean","getTemplateData expects hasUnknownFilters to be a Boolean");verifyBacklinksOptions(options);verifyMozRankOptions(options);verifySiteGroupsOptions(options);verifySiteVisitorsOptions(options);paramAssert.isType(userId,"number","getTemplateData expects userId to be a Number")}function getChosenValues(array){var values=Array.prototype.concat(array||EMPTY_ARRAY);return values.map(function(value){return parseInt(value,10)})}function renderSiteGroupsAsOptions(siteGroups,selectedIds,userId){var chosenValues=getChosenValues(selectedIds),formattedValues=siteGroups.map(function(siteGroup){return{isReadOnly:filtersHelper.permissions.isReadOnlyForUser(siteGroup,userId),isSelected:chosenValues.indexOf(siteGroup.id)>-1,text:siteGroup.name,value:siteGroup.id}}),options=filtersHelper.multiSelect.renderOptions(formattedValues);return options}Renderer.getTemplateData=function getTemplateData(options,userId){verifyGetTemplateViewOptions(options,userId);var renderSimpleValuesAsOptions=filtersHelper.multiSelect.renderSimpleValuesAsOptions;var tickClass={mozRankMin:filtersHelper.css.getTickClass(options.mozRankMin>0),mozRankMax:filtersHelper.css.getTickClass(options.mozRankMax>0),backlinks:filtersHelper.css.getTickClass(options.backlinksMin>0||options.backlinksMax>0),siteGroups:filtersHelper.css.getTickClass(options.selectedSiteGroups.length>0),excludeSiteGroups:filtersHelper.css.getTickClass(options.selectedXSiteGroups.length>0),monthlyVisitors:filtersHelper.css.getTickClass(options.monthlyVisitorsMax>0||options.monthlyVisitorsMin>0),averageVisits:filtersHelper.css.getTickClass(options.avarageVisitsMin>0||options.averageVisitsMax>0),pagesPerVisit:filtersHelper.css.getTickClass(options.pagesPerVisitMin>0||options.pagesPerVisitMax>0),averageDurationOfVisit:filtersHelper.css.getTickClass(options.averageDurationOfVisitMax>0||options.averageDurationOfVisitMax>0),percentFemaleVisitorsMin:filtersHelper.css.getTickClass(options.percentFemaleVisitorsMin>0),percentMaleVisitorsMin:filtersHelper.css.getTickClass(options.percentMaleVisitorsMin>0)};var templateView={showHelp:options.showHelp,onClass:filtersHelper.css.getOnClass(options.isOn),groupClass:filtersHelper.css.getGroupClass(options.isOn),hasUnknownFilters:options.hasUnknownFilters,tickClass:tickClass,minMozRankOptions:renderSimpleValuesAsOptions(MOZ_RANKS,options.mozRankMin),maxMozRankOptions:renderSimpleValuesAsOptions(MOZ_RANKS,options.mozRankMax),backlinksMin:options.backlinksMin,backlinksMax:options.backlinksMax,isPositiveNumberRegex:"^[0-9]*$",includedSiteGroupOptions:renderSiteGroupsAsOptions(options.siteGroups,options.selectedSiteGroups,userId),excludedSiteGroupOptions:renderSiteGroupsAsOptions(options.siteGroups,options.selectedXSiteGroups,userId),monthlyVisitorsMin:options.monthlyVisitorsMin,monthlyVisitorsMax:options.monthlyVisitorsMax,averageVisitsMin:options.averageVisitsMin,averageVisitsMax:options.averageVisitsMax,pagesPerVisitMin:options.pagesPerVisitMin,pagesPerVisitMax:options.pagesPerVisitMax,averageDurationOfVisitMin:options.averageDurationOfVisitMin,averageDurationOfVisitMax:options.averageDurationOfVisitMax,minMaleOptions:controlsViewDataBuilder.buildOptionsFromArray(PERCENTAGES,options.percentMaleVisitorsMin),minFemaleOptions:controlsViewDataBuilder.buildOptionsFromArray(PERCENTAGES,options.percentFemaleVisitorsMin)};return templateView};Renderer.render=function render(options,userId){var templateData=Renderer.getTemplateData(options,userId);var html=template(templateData);return html};return Renderer});define("css!src/controls/css/siteFilters.css",["css!src/controls/css/compiled.css"],function(){});define("src/controls/filters/SiteFilters",["underscore","backbone","jquery","src/controls/lib/paramAssert","src/controls/controlsEvents","src/controls/filters/SimplifiedFiltersView","src/controls/filters/filtersHelper","src/controls/filters/Site/Renderer","text!src/controls/templates/sellecktMain.template","text!src/controls/templates/sellecktItem.template","text!src/controls/templates/sellecktItemEdit.template","text!src/controls/templates/sellecktPopup.template","customtip","css!src/controls/css/siteFilters.css","css!src/controls/css/sellecktPopup.css"],function(_,Backbone,$,paramAssert,controlsEvents,SimplifiedFiltersView,filtersHelper,Renderer,sellecktMainTemplate,sellecktItemTemplate,sellecktItemEditTemplate,sellecktPopupTemplate){"use strict";var DATA_KEYS=["mozRankMin","mozRankMax","backlinksMin","backlinksMax","siteGroup","xsiteGroup","monthlyVisitorsMin","monthlyVisitorsMax","averageVisitsMin","averageVisitsMax","pagesPerVisitMin","pagesPerVisitMax","averageDurationOfVisitMin","averageDurationOfVisitMax","percentFemaleVisitorsMin","percentMaleVisitorsMin"];function getData(view){var data=view.model.pick(DATA_KEYS);Object.keys(data).forEach(function(key){var rawValue=data[key];var value;if(/M(in|ax)$/.test(key)){value=view.isNullOrEmpty(rawValue)?undefined:Number(rawValue)}else if(/siteGroup$/.test(key)){value=view.isNullOrEmpty(rawValue)?[]:[].concat(rawValue)}data[key]=value});return data}function hasUnknownModels(collection,ids,xids){var allIds=_([].concat(ids)).chain().union(xids).compact().value();return _(allIds).any(function(id){return collection.get(id)===undefined})}function isReadonly(group,userId){var ownerId=group.user&&group.user.length?group.user[0].id:"undefined";return userId!==ownerId&&group.shared==="readonly"}var SiteFilters=SimplifiedFiltersView.extend({events:function events(){return _.extend(SimplifiedFiltersView.prototype.events.call(this),{"click i.js-edit":"triggerEditSiteGroupEvent"})},constructor:function SiteFilters(options){SimplifiedFiltersView.apply(this,arguments);paramAssert.isInstance(options.siteGroups,Backbone.Collection,"SiteFilters must be instantiated with a siteGroups option as a Backbone.Collection");this.siteGroups=options.siteGroups;paramAssert.isType(options.showHelp,"boolean",'SiteFilters must be instantiated with a Boolean "showHelp" option');this.showHelp=options.showHelp;paramAssert.isType(options.userId,"number","SiteFilters must be instantiated with userId option as a Number");this.userId=options.userId;paramAssert.isType(options.canEditGroups,"boolean",'SiteFilters must be instantiated with a Boolean "canEditGroups" option');this.canEditGroups=options.canEditGroups;this.listenTo(this.siteGroups,"add remove change",this.refreshSelects);this.listenTo(this.siteGroups,"reset",this.render)},_handleNewSiteClicks:function _handleNewSiteClicks(){var triggerNewSiteGroupEvent=_.bind(this.triggerNewSiteGroupEvent,this);if(this.siteGroupSelleckt){this.siteGroupSelleckt.on("onPopupCreated",function(popup){var $popupEl=popup.$popup;$popupEl.on("click",".js-new",function(){triggerNewSiteGroupEvent("included")})})}if(this.xsiteGroupSelleckt){this.xsiteGroupSelleckt.on("onPopupCreated",function(popup){var $popupEl=popup.$popup;$popupEl.on("click",".js-new",function(){triggerNewSiteGroupEvent("excluded")})})}},remove:function remove(){if(this.siteGroupSelleckt){this.siteGroupSelleckt.destroy()}if(this.xsiteGroupSelleckt){this.xsiteGroupSelleckt.destroy()}return SimplifiedFiltersView.prototype.remove.call(this)},render:function render(){var _this=this;var data=getData(this);var hasData=Object.keys(data).some(function(key){return!_this.isNullOrEmpty(data[key])});var renderData=Object.assign({},data,{hasUnknownFilters:hasUnknownModels(this.siteGroups,data.siteGroup,data.xsiteGroup),showHelp:this.showHelp,isOn:hasData,isExpanded:this.expanded,siteGroups:this.siteGroups.toJSON(),selectedSiteGroups:data.siteGroup||[],selectedXSiteGroups:data.xsiteGroup||[]});var html=Renderer.render(renderData,this.userId);var $el=$(html);var $selects=$el.find("select[multiple]");$el.customtip();this.$el.html($el);this.renderSelleckts(this.canEditGroups,$selects)},refreshSelects:function refreshSelects(){var $siteGroup=this.$("select[name=siteGroup]"),siteGroup=$siteGroup.val(),$xsiteGroup=this.$("select[name=xsiteGroup]"),xsiteGroup=$xsiteGroup.val(),userId=this.userId,html;html=_(this.siteGroups.toJSON()).map(function(siteGroup){var readonlyAttr=isReadonly(siteGroup,userId)?' data-readonly="true"':"";return"<option"+readonlyAttr+' value="'+siteGroup.id+'">'+siteGroup.name+"</option>"}).join("\n");this.$("select[name=siteGroup],select[name=xsiteGroup]").html(html);$siteGroup.val(siteGroup);$xsiteGroup.val(xsiteGroup);this.renderSelleckts(this.canEditGroups,this.$el.find("select[multiple]"))},renderSelleckts:function renderSelleckts(canEditGroups,$selects){var itemTemplate=canEditGroups?sellecktItemEditTemplate:sellecktItemTemplate;$selects.each(function(index,select){var $select=$(select),selectData=$select.data(),sellecktExistsAlready=Boolean(selectData.selleckt),title=$select.attr("title"),options={showEmptyList:true,placeholderText:title,alternatePlaceholder:title,selectionTemplate:itemTemplate,mainTemplate:sellecktMainTemplate,mainTemplateData:{selectionBottom:true},sellecktPopupTemplate:sellecktPopupTemplate,popupTemplateData:{footer:'<a class="js-new customtip" data-type="'+_.escape($select.attr("name"))+'" data-tip-position="bottom" title="Create new Site List">'+'<span class="iconsmaller icon-plus smallpadding-right"></span>New</a>'}};if(sellecktExistsAlready){selectData.selleckt.destroy()}filtersHelper.multiSelect.setup($select,options)});this.siteGroupSelleckt=this.$("select[name=siteGroup]").data("selleckt");this.xsiteGroupSelleckt=this.$("select[name=xsiteGroup]").data("selleckt");this._handleNewSiteClicks()},onGroupAddedForInclusion:function onGroupAddedForInclusion(model){this.$('[name="siteGroup"] option[value="'+model.id+'"]').prop("selected",true).parent().trigger("change")},onGroupAddedForExclusion:function onGroupAddedForExclusion(model){this.$('[name="xsiteGroup"] option[value="'+model.id+'"]').prop("selected",true).parent().trigger("change")},toggleTick:function toggleTick(values,$tickIndicator){var isEmpty=this.isNullOrEmpty(values);$tickIndicator.toggleClass("applied",!isEmpty);$tickIndicator.toggleClass("hidden",isEmpty)},isSiteFilterSet:function isSiteFilterSet(){var _this2=this;return _(DATA_KEYS).any(function(key){return!_this2.isNullOrEmpty(_this2.model.get(key))})},toggleGroupActiveIndicator:function toggleGroupActiveIndicator(){var $activeIndicator=this.$(".active-indicator");var isEnabled=this.isSiteFilterSet();$activeIndicator.toggleClass("hidden",!isEnabled)},triggerNewSiteGroupEvent:function triggerNewSiteGroupEvent(type){var view=this;controlsEvents.trigger("sitegroup:new",{callback:function siteGroupAddedHandler(siteGroupId){var selector='[data-sitegroup-type="'+type+'"] option[value="'+siteGroupId+'"]',optionElement=view.$(selector),selectElement=optionElement.parent();if(optionElement.length===0){throw new Error("SiteGroup option not found")}optionElement.prop("selected",true);selectElement.trigger("change")}})},triggerEditSiteGroupEvent:function triggerEditSiteGroupEvent(e){var $target=$(e.target),id=$target.closest("li[data-value]").data("value");controlsEvents.trigger("sitegroup:edit",{id:id})}});return SiteFilters});define("mustache!src/controls/filters/templates/instagram",["lib/mustache"],function(mustache){var escapedTemplate='<p>\n<a rel="instagram" class="toggle"><span class="icon-chevron-right grey smallpadding-right"></span>Instagram</a>\n<span data-rel="instagram" class="active-indicator {{groupClass}}">On</span>\n</p>\n<fieldset class="instagram hidden">\n{{#showUserRoleFilter}}\n<p class="instagramUserRole clearfix">\n<span class="indicator {{#getTickClass}}instagramUserRole{{/getTickClass}}" data-tick-key="instagramUserRole"></span>\n<label class="instagramUserRoleLabel">User Role</label>\n<select name="instagramUserRole" class="instagramUserRole selectfield">\n<option value="">any</option>\n{{#userRoleOptions}}{{{.}}}{{/userRoleOptions}}\n</select>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-instagram-userrole"></a>\n{{/showHelp}}\n</p>\n{{/showUserRoleFilter}}\n{{^hideSubTypeFilter}}\n<p class="instagramSubtype clearfix">\n<span class="indicator {{#getTickClass}}subtype{{/getTickClass}}" data-tick-key="subtype"></span>\n<label class="instagramSubtypeLabel">Media Type</label>\n<select name="subtype" class="instagramSubtype selectfield">\n<option value="">any</option>\n{{#subtypeOptions}}{{{.}}}{{/subtypeOptions}}\n</select>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-instagram-mediatype"></a>\n{{/showHelp}}\n</p>\n{{/hideSubTypeFilter}}\n{{^hidePostMetricsFilters}}\n<p class="instagramInteractions clearfix">\n<span class="indicator {{#getTickClass}}instagramInteractionsMin{{/getTickClass}}" data-tick-key="instagramInteractionsMin"></span>\n<label>Interac.</label>\n<input class="num field" placeholder="Min" name="instagramInteractionsMin" pattern="{{isPositiveNumberRegex}}" value="{{instagramInteractionsMin}}" />\n<span>to</span>\n<input class="num field" placeholder="Max"name="instagramInteractionsMax" pattern="{{isPositiveNumberRegex}}" value="{{instagramInteractionsMax}}" />\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-instagram-interactions"></a>\n{{/showHelp}}\n</p>\n<p class="instagramLikes clearfix">\n<span class="indicator {{#getTickClass}}instagramLikesMin{{/getTickClass}}" data-tick-key="instagramLikesMin"></span>\n<label>Likes</label>\n<input class="num field" placeholder="Min" pattern="{{isPositiveNumberRegex}}" name="instagramLikesMin" value="{{instagramLikesMin}}" />\n<span>to</span>\n<input class="num field" placeholder="Max" pattern="{{isPositiveNumberRegex}}" name="instagramLikesMax" value="{{instagramLikesMax}}" />\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-instagram-likes"></a>\n{{/showHelp}}\n</p>\n<p class="instagramComments clearfix">\n<span class="indicator {{#getTickClass}}instagramCommentsMin{{/getTickClass}}" data-tick-key="instagramCommentsMin"></span>\n<label>Comments</label>\n<input class="num field" placeholder="Min" name="instagramCommentsMin" pattern="{{isPositiveNumberRegex}}" value="{{instagramCommentsMin}}" />\n<span>to</span>\n<input class="num field" placeholder="Max" name="instagramCommentsMax" pattern="{{isPositiveNumberRegex}}" value="{{instagramCommentsMax}}" />\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-instagram-comments"></a>\n{{/showHelp}}\n</p>\n{{/hidePostMetricsFilters}}\n{{^hidePostsFilter}}\n<p class="instagramPosts clearfix">\n<span class="indicator {{#getTickClass}}instagramPostsMin{{/getTickClass}}" data-tick-key="instagramPostsMin"></span>\n<label>Posts</label>\n<input class="num field" placeholder="Min" name="instagramPostsMin" pattern="{{isPositiveNumberRegex}}" value="{{instagramPostsMin}}" />\n<span>to</span>\n<input class="num field" placeholder="Max" name="instagramPostsMax" pattern="{{isPositiveNumberRegex}}" value="{{instagramPostsMax}}" />\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-instagram-posts"></a>\n{{/showHelp}}\n</p>\n{{/hidePostsFilter}}\n<p class="instagramFollowers clearfix">\n<span class="indicator {{#getTickClass}}instagramFollowersMin{{/getTickClass}}" data-tick-key="instagramFollowersMin"></span>\n<label>Followers</label>\n<input class="num field" placeholder="Min" name="instagramFollowersMin" pattern="{{isPositiveNumberRegex}}" value="{{instagramFollowersMin}}" />\n<span>to</span>\n<input class="num field" placeholder="Max"name="instagramFollowersMax" pattern="{{isPositiveNumberRegex}}" value="{{instagramFollowersMax}}" />\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-instagram-followers"></a>\n{{/showHelp}}\n</p>\n<p class="instagramFollowing clearfix">\n<span class="indicator {{#getTickClass}}instagramFollowingMin{{/getTickClass}}" data-tick-key="instagramFollowingMin"></span>\n<label>Following</label>\n<input class="num field" placeholder="Min" name="instagramFollowingMin" pattern="{{isPositiveNumberRegex}}" value="{{instagramFollowingMin}}" />\n<span>to</span>\n<input class="num field" placeholder="Max"name="instagramFollowingMax" pattern="{{isPositiveNumberRegex}}" value="{{instagramFollowingMax}}" />\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-instagram-following"></a>\n{{/showHelp}}\n</p>\n</fieldset>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/controls/css/instagramFilters.css",["css!src/controls/css/compiled.css"],function(){});define("src/controls/filters/InstagramFilters",["underscore","src/controls/filters/FiltersView","src/controls/lib/controlsViewDataBuilder","mustache!src/controls/filters/templates/instagram","css!src/controls/css/instagramFilters.css"],function(_,FiltersView,controlsViewDataBuilder,filterTemplate){"use strict";var HIDE_INSTAGRAM_FILTER_OPTIONS=["hideSubTypeFilter","hidePostsFilter","showUserRoleFilter","hidePostMetricsFilters"];function setOptions(view,options){_.extend(view,_.pick(options,HIDE_INSTAGRAM_FILTER_OPTIONS))}return FiltersView.extend({constructor:function InstagramFilters(options){FiltersView.apply(this,arguments);setOptions(this,options||{})},makeEl:function makeEl(){return filterTemplate(this.getTemplateData())},getTemplateData:function getTemplateData(){var data=FiltersView.prototype.getTemplateData.call(this);var subtypeFilters=[{name:"Photo",id:"photo"},{name:"Video",id:"video"}];var userRoleFilters=[{name:"Owner",id:"owner"},{name:"Audience",id:"audience"}];var templateData=_.extend(data,{subtypeOptions:controlsViewDataBuilder.buildOptionsFromObject(subtypeFilters,data.subtype),userRoleOptions:controlsViewDataBuilder.buildOptionsFromObject(userRoleFilters,data.instagramUserRole)},_.pick(this,HIDE_INSTAGRAM_FILTER_OPTIONS));return templateData},getFilterIndicatorStatuses:function getFilterIndicatorStatuses(model){var ticks={instagramUserRole:!this.isNullOrEmpty(model.get("instagramUserRole")),instagramLikesMin:!this.isNullOrEmpty(model.get("instagramLikesMin"))||!this.isNullOrEmpty(model.get("instagramLikesMax")),instagramCommentsMin:!this.isNullOrEmpty(model.get("instagramCommentsMin"))||!this.isNullOrEmpty(model.get("instagramCommentsMax")),instagramInteractionsMin:!this.isNullOrEmpty(model.get("instagramInteractionsMin"))||!this.isNullOrEmpty(model.get("instagramInteractionsMax")),instagramPostsMin:!this.isNullOrEmpty(model.get("instagramPostsMin"))||!this.isNullOrEmpty(model.get("instagramPostsMax")),instagramFollowersMin:!this.isNullOrEmpty(model.get("instagramFollowersMin"))||!this.isNullOrEmpty(model.get("instagramFollowersMax")),instagramFollowingMin:!this.isNullOrEmpty(model.get("instagramFollowingMin"))||!this.isNullOrEmpty(model.get("instagramFollowingMax"))};if(!this.hideSubTypeFilter){ticks.subtype=!this.isNullOrEmpty(model.get("subtype"))}var groups=ticks.subtype||ticks.instagramUserRole||ticks.instagramLikesMin||ticks.instagramCommentsMin||ticks.instagramInteractionsMin||ticks.instagramPostsMin||ticks.instagramFollowersMin||ticks.instagramFollowingMin;return{tickIndicators:ticks,groupIndicators:groups}},getValues:function getValues(){var values=FiltersView.prototype.getValues.call(this);return values}})});define("mustache!src/controls/filters/templates/reach",["lib/mustache"],function(mustache){var escapedTemplate='<p>\n<a rel="reach" class="toggle"><span class="icon-chevron-right grey smallpadding-right"></span>Reach</a>\n<span data-rel="reach" class="active-indicator {{groupClass}}">On</span>\n</p>\n<fieldset class="reach hidden">\n<p class="clearfix">\n<span class="indicator doubleheight {{#getTickClass}}reachEstimate{{/getTickClass}}" data-tick-key="reachEstimate"></span>\n<label for="reachEstimateMin{{cid}}">Reach</label>\n<input name="reachEstimateMin" placeholder="Min" class="field num" pattern="{{isPositiveNumberRegex}}" value="{{reachEstimateMin}}" id="reachEstimateMin{{cid}}"/>\n<span> to </span>\n<input name="reachEstimateMax" placeholder="Max" class="field num" pattern="{{isPositiveNumberRegex}}" value="{{reachEstimateMax}}"/>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="reach-estimate"></a>\n{{/showHelp}}\n</p>\n</fieldset>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/controls/css/reachFilters.css",["css!src/controls/css/compiled.css"],function(){});define("src/controls/filters/ReachFilters",["src/controls/filters/FiltersView","mustache!src/controls/filters/templates/reach","css!src/controls/css/reachFilters.css"],function(FiltersView,template){"use strict";return FiltersView.extend({constructor:function ReachFilters(){FiltersView.apply(this,arguments)},makeEl:function makeEl(data){return template(this.getTemplateData(data))},getFilterIndicatorStatuses:function getFilterIndicatorStatuses(model){var ticks={reachEstimate:!this.isNullOrEmpty(model.get("reachEstimateMin"))||!this.isNullOrEmpty(model.get("reachEstimateMax"))},groups=ticks.reachEstimate;return{tickIndicators:ticks,groupIndicators:groups}}})});define("src/controls/lib/logoFiltersHelpers",["underscore","src/helpers/logoVersionHelper"],function(_,logoVersionHelper){"use strict";function wasLogoVersionAlreadyAdded(allLogos,logoUrl){return!!_.find(allLogos,function(logo){return logo.logoId===logoUrl})}function getSortedLogos(collection,selection){selection=selection||[];collection.comparator="name";collection.sort();return collection.reduce(function(memo,logo){logo.get("logoUrls").forEach(function(logoUrl){if(wasLogoVersionAlreadyAdded(memo,logoUrl)){return}memo.push({lowerCaseName:logo.escape("name").toLowerCase(),logoName:logo.escape("name"),logoId:logoUrl,logoUrl:logoVersionHelper.rewriteUrl(logoUrl),selected:selection.indexOf(logoUrl)>-1})});return memo},[])}return{getSortedLogos:getSortedLogos}});define("mustache!src/controls/templates/logosSelection",["lib/mustache"],function(mustache){var escapedTemplate='<div class="js-logoselection-popup modular popupframe singlepadding helpbgcolor">\n<input class="js-search-logo iconfield search db fullwidth singlemargin-bottom" type="text" placeholder="Search Brand" />\n<span class="dib bold smallpadding-bottom">Pick logos</span>\n<a class="js-select-all floatright">Select all</a>\n<a class="js-unselect-all floatright hidden">Unselect all</a>\n<ul class="b-logos-selection__list">\n{{#logos}}\n<li class="js-logo b-logos-selection__logo {{#selected}}b-logos-selection__logo--selected{{/selected}}" data-search="{{lowerCaseName}}">\n<img class="b-logos-selection__image" src="{{logoUrl}}" data-id={{logoId}} alt="{{logoName}}" />\n</li>\n{{/logos}}\n{{^logos}}\n<li class="smallpadding-bottom lightgrey">\nNo Logo Queries in this project\n</li>\n{{/logos}}\n</ul>\n<footer class="singlepadding-top">\n<button class="js-apply defaultbutton smallmargin-right">Set Filter</button>\n<button class="js-close button">Cancel</button>\n</footer>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/controls/css/logosSelection.css",["css!src/controls/css/compiled.css"],function(){});define("src/controls/views/LogosSelectionView",["jquery","src/controls/lib/paramAssert","src/controls/lib/logoFiltersHelpers","src/controls/views/ContextMenuView","mustache!src/controls/templates/logosSelection","css!src/controls/css/logosSelection.css"],function($,paramAssert,logoFiltersHelpers,ContextMenuView,template){"use strict";var SELECTION_CLOSED="SELECTION_CLOSED";var SELECTION_APPLIED="SELECTION_APPLIED";var VIEW_SELECTORS={LOGO:".js-logo",SELECT_ALL:".js-select-all",UNSELECT_ALL:".js-unselect-all",HELP_ICON:".js-help-icon",SEARCH:".js-search-logo"};var VIEW_CLASSES={SELECTED_LOGO:"b-logos-selection__logo--selected",HIDDEN_LOGO:"b-logos-selection__logo--hidden"};function stopEventPropagation(event){if(!$(event.target).is(VIEW_SELECTORS.HELP_ICON)){event.stopPropagation()}}function setFilter(view){view.trigger(SELECTION_APPLIED,view.selection);view.remove()}function close(view){view.trigger(SELECTION_CLOSED);view.remove()}function toggleSingleSelection(view,event){var $logo=$(event.currentTarget);var logoId=$logo.children(0).data("id");var logoIndex=view.selection.indexOf(logoId);toggleSelectLink(view,true);if(logoIndex===-1){view.selection.push(logoId);$logo.addClass(VIEW_CLASSES.SELECTED_LOGO);return}view.selection.splice(logoIndex,1);$logo.removeClass(VIEW_CLASSES.SELECTED_LOGO)}function toggleSelectAll(view,select){view.$(VIEW_SELECTORS.LOGO).not("."+VIEW_CLASSES.HIDDEN_LOGO).toggleClass(VIEW_CLASSES.SELECTED_LOGO,select);view.selection=view.$("."+VIEW_CLASSES.SELECTED_LOGO).map(function(index,logo){return $(logo).children(":first").data("id")}).get();toggleSelectLink(view,!select)}function toggleSelectLink(view,selectAll){view.$(VIEW_SELECTORS.SELECT_ALL).toggleClass("hidden",!selectAll);view.$(VIEW_SELECTORS.UNSELECT_ALL).toggleClass("hidden",selectAll)}function searchLogo(view,event){var searchString=$(event.currentTarget).val().trim().toLowerCase();view.$(VIEW_SELECTORS.LOGO).removeClass(VIEW_CLASSES.HIDDEN_LOGO);toggleSelectLink(view,true);if(!searchString){return}view.$(VIEW_SELECTORS.LOGO+':not([data-search*="'+searchString+'"])').addClass(VIEW_CLASSES.HIDDEN_LOGO)}function onKeyupSearch(view,event){if(event.which&&event.which===27){$(event.currentTarget).val("").trigger("input")}}var LogosSelectionView=ContextMenuView.extend({position:"below-right-fit",events:function events(){return{"click .js-logoselection-popup":stopEventPropagation,"click .js-close":close.bind(null,this),"click .js-apply":setFilter.bind(null,this),"click .js-logo":toggleSingleSelection.bind(null,this),"click .js-select-all":toggleSelectAll.bind(null,this,true),"click .js-unselect-all":toggleSelectAll.bind(null,this,false),"keyup .js-search-logo":onKeyupSearch.bind(null,this),"input .js-search-logo":searchLogo.bind(null,this)}},constructor:function LogosSelectionView(options){ContextMenuView.apply(this,arguments);options=options||{};paramAssert.isNotDefined(options.collection,"LogosSelectionView requires options.collection to be set");if(options.selection){paramAssert.isType(options.selection,"array","LogosSelectionView requires options.selection to be an array")}this.selection=options.selection||[];this.logos=logoFiltersHelpers.getSortedLogos(this.collection,this.selection)},render:function render(){var data={logos:this.logos};this.$el.html(template(data))},focusSearchInput:function focusSearchInput(){this.$(VIEW_SELECTORS.SEARCH).focus()}});LogosSelectionView.SELECTION_CLOSED=SELECTION_CLOSED;LogosSelectionView.SELECTION_APPLIED=SELECTION_APPLIED;return LogosSelectionView});define("mustache!src/controls/filters/templates/logoversions",["lib/mustache"],function(mustache){var escapedTemplate='<p>\n<a rel="logoVersions" class="toggle {{#isExpanded}}on{{/isExpanded}}">\n<span class="icon-chevron-{{#isExpanded}}down{{/isExpanded}}{{^isExpanded}}right{{/isExpanded}} grey smallpadding-right"></span>Logo\n</a>\n<span data-rel="logoVersions" class="active-indicator js-active-indicator {{groupClass}}">On</span>\n</p>\n<fieldset class="logoVersions {{^isExpanded}}hidden{{/isExpanded}} modular">\n<div class="js-loading-logoversions">\nLoading logo versions\n</div>\n<div class="js-no-logoversions hidden">\n<p class="notification-info rounded smallpadding-vertical singlepadding-horizontal mediumline smallmargin-top">\nThere are no Logo Queries in this Project yet by which you can filter.\n</p>\n</div>\n<div class="js-selection hidden">\n<div class="include clearfix">\n<p class="logoVersions clearfix">\n<span class="js-indicator--logoVersions indicator {{#getTickClass}}logoVersions{{/getTickClass}}" data-tick-key="logoVersions"></span>\n<label class="fullwidth">Filter by Logo</label>\n</p>\n<ul class="js-current-inclusions b-logo-versions__selection"></ul>\n<button class="js-include-logos b-logo-versions__dropdown selectfield">Select Logos</button>\n{{#showHelp}}\n<a class="js-help-icon help icon-bwhelp" data-key="filters-logoversion-include"></a>\n{{/showHelp}}\n<div class="hidden">\n<select name="logoVersions" class="js-select" multiple></select>\n</div>\n</div>\n<div class="exclude clearfix smallmargin-top">\n<p class="xlogoVersions clearfix">\n<span class="js-indicator--xlogoVersions indicator {{#getTickClass}}xlogoVersions{{/getTickClass}}" data-tick-key="xlogoVersions"></span>\n<label class="fullwidth singlemargin-top">Exclude Logo</label>\n</p>\n<ul class="js-current-exclusions b-logo-versions__selection"></ul>\n<button class="js-exclude-logos b-logo-versions__dropdown selectfield">Select Logos</button>\n{{#showHelp}}\n<a class="js-help-icon help icon-bwhelp" data-key="filters-logoversion-exclude"></a>\n{{/showHelp}}\n<div class="hidden">\n<select name="xlogoVersions" class="js-select" multiple></select>\n</div>\n</div>\n</div>\n</fieldset>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/controls/filters/templates/logoversionsselection",["lib/mustache"],function(mustache){var escapedTemplate='{{#logos}}\n<li class="b-logo-versions__item">\n<div class="b-logo-versions__logo">\n<img class="b-logo-versions__image" src="{{url}}">\n<a class="js-remove-{{#inclusion}}inclusion{{/inclusion}}{{^inclusion}}exclusion{{/inclusion}} grey iconsmaller icon-remove" data-id="{{id}}"></a>\n</div>\n</li>\n{{/logos}}\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/controls/css/logoVersionsFilters.css",["css!src/controls/css/compiled.css"],function(){});define("src/controls/filters/LogoVersionsFilters",["underscore","jquery","src/controls/lib/paramAssert","src/controls/lib/logoFiltersHelpers","src/controls/filters/FiltersView","src/controls/lib/controlsViewDataBuilder","src/controls/views/LogosSelectionView","src/helpers/logoVersionHelper","mustache!src/controls/filters/templates/logoversions","mustache!src/controls/filters/templates/logoversionsselection","css!src/controls/css/logoVersionsFilters.css"],function(_,$,paramAssert,logoFiltersHelpers,FiltersView,controlsViewDataBuilder,LogosSelectionView,logoVersionHelper,template,selectionTemplate){"use strict";var VIEW_SELECTORS={INDICATOR_LOGOVERSIONS:".js-indicator--logoVersions",INDICATOR_XLOGOVERSIONS:".js-indicator--xlogoVersions",SELECT_LOGOVERSIONS:'.js-select[name="logoVersions"]',SELECT_XLOGOVERSIONS:'.js-select[name="xlogoVersions"]',CURRENT_INCLUSIONS:".js-current-inclusions",CURRENT_EXCLUSIONS:".js-current-exclusions",LOADING:".js-loading-logoversions",NO_LOGOVERSIONS:".js-no-logoversions",SELECTION:".js-selection",ACTIVE_INDICATOR:".js-active-indicator"};function toggleIndicator(view,name,hasValue){var selector;if(name==="logoVersions"){selector=VIEW_SELECTORS.INDICATOR_LOGOVERSIONS}else if(name==="xlogoVersions"){selector=VIEW_SELECTORS.INDICATOR_XLOGOVERSIONS}else{return}if(hasValue){view.$(selector).removeClass("hidden");return}view.$(selector).addClass("hidden")}function onVersionSelect(view,event){var $target=$(event.target);var name=$target.attr("name");var value=$target.val();toggleIndicator(view,name,!!value.length)}function onShowSelection(view,inclusion,event){event.preventDefault();var selection=inclusion?view.$(VIEW_SELECTORS.SELECT_LOGOVERSIONS).val():view.$(VIEW_SELECTORS.SELECT_XLOGOVERSIONS).val();var logosSelectionView=LogosSelectionView.show({$target:$(event.currentTarget),selection:selection,collection:view.collection,showHelp:view.showHelp});if(!logosSelectionView){return}logosSelectionView.focusSearchInput();view.listenToOnce(logosSelectionView,LogosSelectionView.SELECTION_APPLIED,function(selection){var selector=inclusion?VIEW_SELECTORS.SELECT_LOGOVERSIONS:VIEW_SELECTORS.SELECT_XLOGOVERSIONS;view.$(selector).val(selection).trigger("change");updateCurrentSelection(view)})}function onRemoveSelection(view,inclusion,event){event.preventDefault();var logoUrl=$(event.currentTarget).data("id");var selector=inclusion?VIEW_SELECTORS.SELECT_LOGOVERSIONS:VIEW_SELECTORS.SELECT_XLOGOVERSIONS;view.$(selector+' [value="'+logoUrl+'"]').prop("selected",false).trigger("change");updateCurrentSelection(view)}function updateCurrentSelection(view){var selection=view.$(VIEW_SELECTORS.SELECT_LOGOVERSIONS).val()||[];view.$(VIEW_SELECTORS.CURRENT_INCLUSIONS).html(selectionTemplate({inclusion:true,logos:selection.map(function(logoId){return{id:logoId,url:logoVersionHelper.rewriteUrl(logoId)}})}));var xSelection=view.$(VIEW_SELECTORS.SELECT_XLOGOVERSIONS).val()||[];view.$(VIEW_SELECTORS.CURRENT_EXCLUSIONS).html(selectionTemplate({inclusion:false,logos:xSelection.map(function(logoId){return{id:logoId,url:logoVersionHelper.rewriteUrl(logoId)}})}))}function buildOptions(view,selectedValue){selectedValue=selectedValue||[];return logoFiltersHelpers.getSortedLogos(view.collection,selectedValue).map(function(logo){return controlsViewDataBuilder.buildOption({isSelected:logo.selected,text:logo.logoUrl,val:logo.logoId})})}function onSync(view){var includedOptions;var excludedOptions;view.$(VIEW_SELECTORS.LOADING).addClass("hidden");if(view.collection.length===0){view.$(VIEW_SELECTORS.NO_LOGOVERSIONS).removeClass("hidden");return}includedOptions=buildOptions(view,view.getTemplateData().logoVersions);excludedOptions=buildOptions(view,view.getTemplateData().xlogoVersions);view.$(VIEW_SELECTORS.SELECT_LOGOVERSIONS).append(includedOptions);view.$(VIEW_SELECTORS.SELECT_XLOGOVERSIONS).append(excludedOptions);view.$(VIEW_SELECTORS.SELECTION).removeClass("hidden");updateCurrentSelection(view);view.dataLoaded=true}function onToggle(view){if(!view.dataLoaded){view.collection.fetch();return}}return FiltersView.extend({constructor:function LogoVersionsFilters(options){paramAssert.isNotDefined(options.collection,"options.collection is not defined");FiltersView.apply(this,arguments);this.dataLoaded=false;this.listenToOnce(this.collection,"sync",onSync.bind(null,this));this.listenTo(this,"toggle",onToggle.bind(null,this))},events:function events(){var events=FiltersView.prototype.events.apply();return _.extend({},events,{"click .js-include-logos":onShowSelection.bind(null,this,true),"click .js-exclude-logos":onShowSelection.bind(null,this,false),"click .js-remove-inclusion":onRemoveSelection.bind(null,this,true),"click .js-remove-exclusion":onRemoveSelection.bind(null,this,false),"change .js-select":onVersionSelect.bind(null,this)})},render:function render(){var el=this.makeEl();this.$el.html(el)},makeEl:function makeEl(){return template(this.getTemplateData())},getTemplateData:function getTemplateData(){var data=FiltersView.prototype.getTemplateData.call(this);return _.extend({},data,{isExpanded:this.expanded})},refresh:function refresh(){var data=this.model.toJSON();if(this.isNullOrEmpty(data.logoVersions)&&this.isNullOrEmpty(data.xlogoVersions)){this.$(VIEW_SELECTORS.ACTIVE_INDICATOR).addClass("hidden")}else{this.$(VIEW_SELECTORS.ACTIVE_INDICATOR).removeClass("hidden")}if(this.isNullOrEmpty(data.logoVersions)){this.$(VIEW_SELECTORS.INDICATOR_LOGOVERSIONS).removeClass("applied").addClass("hidden")}else{this.$(VIEW_SELECTORS.INDICATOR_LOGOVERSIONS).removeClass("hidden").addClass("applied")}if(this.isNullOrEmpty(data.xlogoVersions)){this.$(VIEW_SELECTORS.INDICATOR_XLOGOVERSIONS).removeClass("applied").addClass("hidden")}else{this.$(VIEW_SELECTORS.INDICATOR_XLOGOVERSIONS).removeClass("hidden").addClass("applied")}this.$(VIEW_SELECTORS.SELECT_LOGOVERSIONS).val(data.logoVersions);this.$(VIEW_SELECTORS.SELECT_XLOGOVERSIONS).val(data.xlogoVersions);updateCurrentSelection(this)},getFilterIndicatorStatuses:function getFilterIndicatorStatuses(model){var ticks={logoVersions:!this.isNullOrEmpty(model.get("logoVersions")),xlogoVersions:!this.isNullOrEmpty(model.get("xlogoVersions"))};var groups=!!_(ticks).find(function(item){return item});return{tickIndicators:ticks,groupIndicators:groups}}})});define("src/models/LogoQuery",["src/models/Query"],function(Query){"use strict";return Query.extend({constructor:function LogoQuery(){Query.apply(this,arguments)},save:function save(attributes,options){var filteredAttributes=Object.assign({},attributes,{logograbBrandId:undefined,logoUrls:undefined});return Query.prototype.save.call(this,filteredAttributes,options)},url:function url(){return"/projects/"+this.projectId+"/logoqueries/"+(this.id||"")}})});define("src/models/QueryCollection",["underscore","src/models/Query","src/models/PaginatedCollection"],function(_,Query,PaginatedCollection){"use strict";return PaginatedCollection.extend({model:Query,constructor:function QueryCollection(models,options){options=options||{};options=_.defaults(options,{pagination:false});PaginatedCollection.call(this,models,options);this._type=options.type;this._filter=options.filter||"";this.projectId=options.projectId;this.startLoading();this.on("request",this.startLoading,this);this.on("sync",this.stopLoading,this)},startLoading:function startLoading(){this.isLoading=true},stopLoading:function stopLoading(){this.isLoading=false},fetch:function fetch(options){options=options||{};if(!this.projectId){throw new Error("this.projectId must be set!")}return PaginatedCollection.prototype.fetch.call(this,options)},parse:function parse(response){var projectId=this.projectId;response.results=_(response.results).map(function(query){return _.extend(query,{projectId:projectId})});if(!this.isPaginated()){return response.results}return PaginatedCollection.prototype.parse.call(this,response)},comparator:function comparator(model){return model.get("name").toLowerCase()},url:function url(){return"/projects/"+this.projectId+"/queries"},getQueryData:function getQueryData(){var options=PaginatedCollection.prototype.getQueryData.call(this),type=this.getType();options.nameContains=this._filter;if(!type||type.length===0){return options}return _.extend(options,{type:type})},getFilter:function getFilter(){return this._filter},setFilter:function setFilter(val){this._filter=val},getType:function getType(){return this._type},setType:function setType(val){this._type=val}})});define("src/models/LogoQueryCollection",["src/models/LogoQuery","src/models/QueryCollection"],function(LogoQuery,QueryCollection){"use strict";return QueryCollection.extend({model:LogoQuery,constructor:function LogoQueryCollection(){QueryCollection.apply(this,arguments)},url:function url(){return"/projects/{projectId}/logoqueries"}})});define("src/views/filters/FiltersView",["src/permissions","src/globals/currentDashboard","src/views/ControlsViewInputs","src/controls/filters/FiltersView"],function(permissions,currentDashboard,ControlsViewInputs,ControlsFiltersView){"use strict";return ControlsFiltersView.extend({constructor:function FiltersView(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};options=Object.assign({showHelp:permissions.check("see.dashboard.controls.help",currentDashboard)},options);ControlsFiltersView.call(this,options)},initialize:function initialize(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};ControlsViewInputs.prototype.initialize.call(this,options)}})});define("mustache!templates/filters/workflow",["lib/mustache"],function(mustache){var escapedTemplate='<p>\n<a rel="workflow" class="toggle"><span class="icon-chevron-right grey smallpadding-right"></span>Workflow</a>\n<span data-rel="workflow" class="active-indicator {{groupClass}}">On</span>\n</p>\n<fieldset class="workflow hidden">\n<p class="clearfix">\n<span class="indicator {{#getTickClass}}workflowAssignment{{/getTickClass}}" data-tick-key="workflowAssignment"></span>\n<select name="assigned" class="selectfield">\n<option value="">Assignment - all</option>\n{{#assignmentOptions}}{{{.}}}{{/assignmentOptions}}\n</select>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-workflow-assignment" ></a>\n{{/showHelp}}\n</p>\n<p class="clearfix">\n<span class="indicator {{#getTickClass}}workflowChecked{{/getTickClass}}" data-tick-key="workflowChecked"></span>\n<select name="checked" class="selectfield">\n<option value="">Checked - all</option>\n{{#checkedOptions}}{{{.}}}{{/checkedOptions}}\n</select>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-workflow-checked" ></a>\n{{/showHelp}}\n</p>\n<p class="clearfix">\n<span class="indicator {{#getTickClass}}workflowPriority{{/getTickClass}}" data-tick-key="workflowPriority"></span>\n<select name="priority" class="selectfield">\n<option value="">Priority - all</option>\n{{#priorityOptions}}{{{.}}}{{/priorityOptions}}\n</select>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-workflow-priority" ></a>\n{{/showHelp}}\n</p>\n<p class="clearfix">\n<span class="indicator {{#getTickClass}}workflowStatus{{/getTickClass}}" data-tick-key="workflowStatus"></span>\n<select name="status" class="selectfield">\n<option value="">Status - all</option>\n{{#statusOptions}}{{{.}}}{{/statusOptions}}\n</select>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-workflow-status" ></a>\n{{/showHelp}}\n</p>\n</fieldset>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/views/filters/WorkflowFilters",["underscore","src/controls/lib/controlsViewDataBuilder","src/views/filters/FiltersView","mustache!templates/filters/workflow"],function(_,controlsViewDataBuilder,FiltersView,template){"use strict";function buildSelectObject(children,selected){children=_(children).map(function(child){return{id:child.name,name:child.name}});children.push({id:"na",name:"n/a"});return controlsViewDataBuilder.buildOptionsFromObject(children,selected)}var WorkflowFilters=FiltersView.extend({constructor:function WorkflowFilters(options){FiltersView.apply(this,arguments);if(!options||!options.workflow){throw new TypeError("WorkflowFilters must be instantiated with a workflow option")}this.workflow=options.workflow;this.listenTo(this.workflow,"add remove change reset",this.render,this)},remove:function remove(){FiltersView.prototype.remove.call(this)},makeEl:function makeEl(data){var workflow=this.workflow.toJSON(),assignment=workflow.assignment||{},status=workflow.status||{},priority=workflow.priority||{},selectedAssignment=data.assigned||[],selectedChecked=data.checked===false?"false":data.checked===true?"true":"",selectedPriority=data.priority||[],selectedStatus=data.status||[];data=this.getTemplateData(data);data=_.extend(data,{assignmentOptions:buildSelectObject(assignment.children,selectedAssignment),checkedOptions:controlsViewDataBuilder.buildOptionsFromObject([{id:"true",name:"yes"},{id:"false",name:"no"}],selectedChecked),priorityOptions:buildSelectObject(priority.children,selectedPriority),statusOptions:buildSelectObject(status.children,selectedStatus)});return template(data)},refresh:function refresh(){var checked=this.model.get("checked");FiltersView.prototype.refresh.call(this);if(!checked&&checked!==false){checked=""}else{checked=checked.toString()}this.$("select[name=checked]").val(checked);this.$("select[name=assigned]").val(this.model.get("assigned"));this.$("select[name=priority]").val(this.model.get("priority"));this.$("select[name=status]").val(this.model.get("status"))},getValues:function getValues(){var checked=this.$("select[name=checked]").val();if(checked==="true"){checked=true}else if(checked==="false"){checked=false}return{assigned:this.$("select[name=assigned]").val(),status:this.$("select[name=status]").val(),priority:this.$("select[name=priority]").val(),checked:checked}},getFilterIndicatorStatuses:function getFilterIndicatorStatuses(model){var ticks={workflowAssignment:model.get("assigned")&&model.get("assigned").length,workflowChecked:_.isBoolean(model.get("checked")),workflowPriority:model.get("priority")&&model.get("priority").length,workflowStatus:model.get("status")&&model.get("status").length},groups=ticks.workflowAssignment||ticks.workflowChecked||ticks.workflowPriority||ticks.workflowStatus;return{tickIndicators:ticks,groupIndicators:groups}}});return WorkflowFilters});define("mustache!src/extensions/facebookanalytics/templates/facebookFilter",["lib/mustache"],function(mustache){var escapedTemplate='<p>\n<a rel="facebook" class="toggle" data-at="component-filters-toggle-facebook"><span class="icon-chevron-right grey smallpadding-right"></span>Facebook</a>\n<span data-rel="facebook" class="active-indicator {{groupClass}}">On</span>\n</p>\n<fieldset class="facebook hidden">\n<p class="facebookRole clearfix">\n<span class="indicator {{#getTickClass}}facebookRole{{/getTickClass}}" data-tick-key="facebookRole"></span>\n<label class="facebookRoleLabel">User Role</label>\n<select name="facebookRole" class="facebookRole selectfield">\n<option value="">any</option>\n{{#facebookRoleOptions}}{{{.}}}{{/facebookRoleOptions}}\n</select>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-facebook-role"></a>\n{{/showHelp}}\n</p>\n<p class="resourceType clearfix">\n<span class="indicator {{#getTickClass}}resourceType{{/getTickClass}}" data-tick-key="resourceType"></span>\n<select name="resourceType" class="resourceType selectfield" title="Mention Type" multiple>\n{{#facebookTypeOptions}}{{{.}}}{{/facebookTypeOptions}}\n</select>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-facebook-mentiontype"></a>\n{{/showHelp}}\n</p>\n<p class="xresourceType clearfix">\n<span class="indicator {{#getTickClass}}xresourceType{{/getTickClass}}" data-tick-key="xresourceType"></span>\n<select name="xresourceType" class="resourceType selectfield" title="Exclude Mention Type" multiple>\n{{#facebookExcludeTypeOptions}}{{{.}}}{{/facebookExcludeTypeOptions}}\n</select>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-facebook-mentiontype"></a>\n{{/showHelp}}\n</p>\n{{^hideSubTypeFilter}}\n<p class="facebookSubtype clearfix">\n<span class="indicator {{#getTickClass}}facebookSubType{{/getTickClass}}" data-tick-key="facebookSubType"></span>\n<label class="facebookSubTypeLabel">Media Type</label>\n<select name="subtype" class="facebookSubtype selectfield">\n<option value="">any</option>\n{{#facebookSubtypeOptions}}{{{.}}}{{/facebookSubtypeOptions}}\n</select>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-facebook-mediatype"></a>\n{{/showHelp}}\n</p>\n{{/hideSubTypeFilter}}\n<p class="facebookLikes clearfix">\n<span class="indicator {{#getTickClass}}facebookLikesMin{{/getTickClass}}" data-tick-key="facebookLikesMin"></span>\n<label>Likes</label>\n<input class="num field" placeholder="Min" pattern="{{isPositiveNumberRegex}}" name="facebookLikesMin" value="{{facebookLikesMin}}" />\n<span>to</span>\n<input class="num field" placeholder="Max" pattern="{{isPositiveNumberRegex}}" name="facebookLikesMax" value="{{facebookLikesMax}}" />\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-facebook-likes"></a>\n{{/showHelp}}\n</p>\n<p class="facebookComments clearfix">\n<span class="indicator {{#getTickClass}}facebookCommentsMin{{/getTickClass}}" data-tick-key="facebookCommentsMin"></span>\n<label>Comments</label>\n<input class="num field" placeholder="Min" name="facebookCommentsMin" pattern="{{isPositiveNumberRegex}}" value="{{facebookCommentsMin}}" />\n<span>to</span>\n<input class="num field" placeholder="Max" name="facebookCommentsMax" pattern="{{isPositiveNumberRegex}}" value="{{facebookCommentsMax}}" />\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-facebook-comments"></a>\n{{/showHelp}}\n</p>\n<p class="facebookShares clearfix">\n<span class="indicator {{#getTickClass}}facebookSharesMin{{/getTickClass}}" data-tick-key="facebookSharesMin"></span>\n<label>Shares</label>\n<input class="num field" placeholder="Min" name="facebookSharesMin" pattern="{{isPositiveNumberRegex}}" value="{{facebookSharesMin}}" />\n<span>to</span>\n<input class="num field" placeholder="Max"name="facebookSharesMax" pattern="{{isPositiveNumberRegex}}" value="{{facebookSharesMax}}" />\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-facebook-shared"></a>\n{{/showHelp}}\n</p>\n</fieldset>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/controls/filters/FacebookFilters",["underscore","src/views/filters/FiltersView","src/controls/lib/controlsViewDataBuilder","mustache!src/extensions/facebookanalytics/templates/facebookFilter","src/analytics/Analytics"],function(_,FiltersView,controlsViewDataBuilder,filterTemplate,Analytics){"use strict";var HIDE_FACEBOOK_FILTER_OPTIONS=["hideSubTypeFilter"];function setOptions(view,options){_.extend(view,_.pick(options,HIDE_FACEBOOK_FILTER_OPTIONS))}return FiltersView.extend({constructor:function FacebookFilters(options){FiltersView.apply(this,arguments);setOptions(this,options||{})},makeEl:function makeEl(){return filterTemplate(this.getTemplateData())},getTemplateData:function getTemplateData(){var data=FiltersView.prototype.getTemplateData.call(this);var facebookRoleFilters=[{name:"Page Owner",id:"owner"},{name:"Audience",id:"audience"}];var facebookTypeFilters=[{name:"Post",id:"public-facebook-post"},{name:"Comment",id:"public-facebook-comment"},{name:"Dark Post",id:"dark-facebook-post"},{name:"Dark Comment",id:"dark-facebook-comment"}];var facebookSubtypeFilters=[{name:"Link",id:"link"},{name:"Other",id:"other"},{name:"Photo",id:"photo"},{name:"Status",id:"status"},{name:"Video",id:"video"}];var templateData=_.extend(data,{facebookRoleOptions:controlsViewDataBuilder.buildOptionsFromObject(facebookRoleFilters,data.facebookRole),facebookSubtypeOptions:controlsViewDataBuilder.buildOptionsFromObject(facebookSubtypeFilters,data.subtype),facebookTypeOptions:controlsViewDataBuilder.buildOptionsFromObject(facebookTypeFilters,data.resourceType),facebookExcludeTypeOptions:controlsViewDataBuilder.buildOptionsFromObject(facebookTypeFilters,data.xresourceType)},_.pick(this,HIDE_FACEBOOK_FILTER_OPTIONS));return templateData},getFilterIndicatorStatuses:function getFilterIndicatorStatuses(model){var ticks={facebookLikesMin:!this.isNullOrEmpty(model.get("facebookLikesMin"))||!this.isNullOrEmpty(model.get("facebookLikesMax")),facebookLikesMax:!this.isNullOrEmpty(model.get("facebookLikesMax"))||!this.isNullOrEmpty(model.get("facebookLikesMin")),facebookCommentsMin:!this.isNullOrEmpty(model.get("facebookCommentsMin"))||!this.isNullOrEmpty(model.get("facebookCommentsMax")),facebookCommentsMax:!this.isNullOrEmpty(model.get("facebookCommentsMax"))||!this.isNullOrEmpty(model.get("facebookCommentsMin")),facebookSharesMin:!this.isNullOrEmpty(model.get("facebookSharesMin"))||!this.isNullOrEmpty(model.get("facebookSharesMax")),facebookSharesMax:!this.isNullOrEmpty(model.get("facebookSharesMax"))||!this.isNullOrEmpty(model.get("facebookSharesMin")),facebookRole:!this.isNullOrEmpty(model.get("facebookRole")),resourceType:!this.isNullOrEmpty(model.get("resourceType")),xresourceType:!this.isNullOrEmpty(model.get("xresourceType"))};if(!this.hideSubTypeFilter){ticks.subtype=!this.isNullOrEmpty(model.get("subtype"))}var groups=ticks.facebookLikesMin||ticks.facebookLikesMax||ticks.facebookCommentsMin||ticks.facebookCommentsMax||ticks.facebookSharesMin||ticks.facebookSharesMax||ticks.facebookRole||ticks.subtype||ticks.resourceType||ticks.xresourceType;return{tickIndicators:ticks,groupIndicators:groups}},getValues:function getValues(){var values=FiltersView.prototype.getValues.call(this);if(Object.values(values).filter(function(value){return!Array.isArray(value)&&Boolean(value)||value.length}).length){Analytics.trackEvent({name:"Miscellaneous.Facebook Filters",action:"Apply_Type_"+values.resourceType+"_Subtype_"+values.subtype+"_Role_"+values.facebookRole,origin:"Application",values:{facebookSubtype:values.subtype,resourceType:values.resourceType,facebookRole:values.facebookRole,likesMin:values.facebookLikesMin,likesMax:values.facebookLikesMax,commentsMin:values.facebookCommentsMin,commentsMax:values.facebookCommentsMax,sharesMin:values.facebookSharesMin,sharesMax:values.facebookSharesMax}})}return values}})});define("mustache!templates/controls",["lib/mustache"],function(mustache){var escapedTemplate='<div class="component-controls">\n<div class="controls--section querySettings lightgreybg">\n{{#canSeeQueryFields}}\n<fieldset class="queryinputs singlemargin-bottom"></fieldset>\n{{/canSeeQueryFields}}\n<fieldset class="dateinputs lastInSet singlemargin-bottom">\n</fieldset>\n<p class="apply singlepadding-horizontal singlemargin-vertical"><button class="applyChanges {{applyClassName}}">{{applyText}}</button></p>\n</div>\n{{#canSeeFilters}}\n<div class="controls--section filters singlepadding lightgreybg">\n<div class="controls--section__header-container">\n<h2 class="controls--section__header bold bigtext">\nFilters\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-component" ></a>\n{{/showHelp}}\n</h2>\n<a class="js-filter-actions\ncontrols--section__filter-actions">Actions<span class="smallmargin-left icon-chevron-down"></span></a>\n</div>\n\n<p class="apply singlemargin-top">\n<button class="applyChanges {{applyClassName}}">{{applyText}}</button>\n{{#canClearFilters}}\n<a class="clearFilters db floatright smallmargin-top">Clear Filters</a>\n{{/canClearFilters}}\n</p>\n</div>\n{{/canSeeFilters}}\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}define("src/views/ControlsView",["q","jquery","backbone","underscore","src/pageTour","src/permissions","src/globals/me","src/globals/currentDashboard","src/globals/workflow","src/globals/classifications","src/globals/metrics","src/globals/siteGroups","src/globals/queries","src/globals/queryGroups","src/globals/locationGroups","src/globals/authorGroups","src/globals/professions","src/globals/interests","src/globals/currentProject","src/globals/flags","src/globals/flagNames","src/events/globalEventNames","src/events/quickSearchEvents","src/controls/views/ControlsViewQueryInputs","src/controls/views/ControlsViewDateInputs","src/views/ControlsViewSearchInput","src/views/FilterActionsContextMenu","src/controls/filters/SentimentFilters","src/controls/filters/SentimentAndEmotionsFilters","src/controls/filters/PageAndMentionTypeFilters","src/controls/filters/ForumThreadFilters","src/controls/filters/BlogFilters","src/controls/filters/TwitterFilters","src/controls/filters/AuthorFilters","src/controls/filters/LanguageFilters","src/controls/filters/LocationFilters","src/controls/filters/CategoryFilters","src/controls/filters/TagFilters","src/controls/filters/SiteFilters","src/controls/filters/InstagramFilters","src/controls/filters/ReachFilters","src/controls/filters/LogoVersionsFilters","src/models/LogoQueryCollection","src/views/filters/WorkflowFilters","src/controls/filters/FacebookFilters","mustache!templates/controls","lib/jquery.notify"],function(Q,$,Backbone,_,pageTour,permissions,me,currentDashboard,globalWorkflow,globalClassifications,globalMetrics,globalSiteGroups,queries,queryGroups,locationGroups,authorGroups,professions,interests,currentProject,flags,FLAGS,globalEventNames,quickSearchEvents,ControlsViewQueryInputs,ControlsViewDateInputs,ControlsViewSearchInput,FilterActionsContextMenu,SentimentFilters,SentimentAndEmotionsFilters,PageAndMentionTypeFilters,ForumThreadFilters,BlogFilters,TwitterFilters,AuthorFilters,LanguageFilters,LocationFilters,CategoryFilters,TagFilters,SiteFilters,InstagramFilters,ReachFilters,LogoVersionsFilters,LogoQueryCollection,WorkflowFilters,FacebookFilters,controlsTemplate){"use strict";var LOGO_QUERY_INPUTS_PAGE_TOUR_ID="logoQueryInputs";var QUICK_NOTIFICATION_DURATION=2e3;function trackQuickSearchSubmitted(dashboard,componentType,model){var eventData={projectId:dashboard.get("projectId"),dashboard:dashboard.id,componentType:componentType,term:model.get("search")};if(model.get("currentMode")==="queryGroup"){eventData.queryGroupId=model.get("queryGroupId")}else{eventData.queryId=model.get("queryId")}quickSearchEvents.trigger(globalEventNames.QUICK_SEARCH.QUICK_SEARCH_SUBMITTED,eventData)}function nonEmptyChangedProperties(previous,changed){var result={};_.each(changed,function(changedValue,key){var previousValue=previous[key];if(_.isEmpty(previousValue)&&!_.isBoolean(previousValue)&&_.isEmpty(changedValue)&&!_.isBoolean(changedValue)){return}if(previousValue===changedValue){return}result[key]=changedValue});return result}function validateOptions(options){if(!options){throw new TypeError("ControlsView must be instantiated with an options argument")}if(!(options.categories instanceof Backbone.Collection)){throw new TypeError("ControlsView expects categories option to be a Backbone.Collection")}if(!(options.tags instanceof Backbone.Collection)){throw new TypeError("ControlsView expects tags option to be a Backbone.Collection")}}function toggleHighlightApplyChanges($elements,enableHighlight){$elements.toggleClass("highlighted",enableHighlight)}function getCurrentFilterValues(model,filters){var allFilterValues=filters.map(function(filter){return filter.getValues()});var allFilterKeys=[].concat.apply([],allFilterValues.map(function(filterValues){return Object.keys(filterValues)}));return allFilterKeys.reduce(function(memo,key){var value=model.get(key);if(value){memo[key]=value}return memo},{})}var ControlsView=Backbone.View.extend({events:function events(){return{"click .applyChanges":"onApplyChanges","click .js-filter-actions":"onFilterActionsClick","click .clearFilters":"clearFilters"}},constructor:function ControlsView(options){Backbone.View.apply(this,arguments);validateOptions(options);this.componentType=options.componentType;this.categories=options.categories;this.languages=options.languages;this.tags=options.tags;if(!options.global){Object.defineProperty(this,"dashboard",{value:options.dashboard||currentDashboard,configurable:true})}if(permissions.check("see.dashboard.controls.advancedFilters",this.dashboard)){this.filters=this.getFilters({model:this.model,dashboard:this.dashboard,userId:me.id,ownerId:this.dashboard&&this.dashboard.getOwner(),showHelp:permissions.check("see.dashboard.controls.help",this.dashboard)})}else{this.filters=[]}},remove:function remove(){var self=this;this.model.off("change",this.changesApplied,this);if(this.queryInputs){this.queryInputs.off("changesMade",this.onChangesMade,this);this.queryInputs.remove();delete this.queryInputs;this.closeInputsGuider()}if(this.dateInputs){this.dateInputs.off("changesMade",this.onChangesMade,this);this.dateInputs.remove();delete this.dateInputs}if(this.searchInput){this.searchInput.remove();this.searchInput=undefined}if(this.filterActionsContextMenu){this.filterActionsContextMenu.remove();this.filterActionsContextMenu=undefined}if(this.filters){_(this.filters).each(function(filter){filter.off("changesMade",self.onChangesMade,this);filter.remove()});delete this.filters}Backbone.View.prototype.remove.call(this)},prepareRenderData:function prepareRenderData(){return _.extend({applyText:this.applyText||"Apply",applyClassName:this.applyClassName||"defaultbutton",showHelp:permissions.check("see.dashboard.controls.help",this.dashboard),canSeeQueryFields:permissions.check("see.dashboard.controls.queryField",this.dashboard),canSeeFilters:permissions.check("see.dashboard.controls.advancedFilters",this.dashboard),canClearFilters:permissions.check("see.dashboard.controls.clearFilters",this.dashboard)},this.model.toJSON())},makeEl:function makeEl(data){return controlsTemplate(data)},render:function render(){var self=this;var data=this.prepareRenderData();var $el=this.makeEl(data);var $this=this.$el;var viewOptions=this.getViewOptions();_(this.filters).each(function(filter){return filter.$el.detach()});this.setupInputViews(viewOptions);if(this.queryInputs&&!(this.queryInputs instanceof this.constructor.QueryInputsClass)){throw new TypeError("queryInputs type must match QueryInputsClass static property")}$this.html($el);return Q.when(this.renderInputs()).then(function(){self.model.off("change",self.changesApplied,self).on("change",self.changesApplied,self)})},showInputsGuider:function showInputsGuider(){var isControlsViewVisible=this.$el.is(":visible");var projectHasLogoQuery=queries.findWhere({type:"logo"});var allowedQueryTypes=this.getViewOptions().allowedQueryTypes;var isLogoQueryAllowed=!allowedQueryTypes||allowedQueryTypes.indexOf("logo")>=0;var componentHasLogoQuery=queries.containsLogoQueryIds(this.model.get("queryId"));if(isControlsViewVisible&&projectHasLogoQuery&&isLogoQueryAllowed&&!componentHasLogoQuery){pageTour.setTourMark(LOGO_QUERY_INPUTS_PAGE_TOUR_ID,{attachTo:this.$(".js-logo-query-inputs-tour")})}},closeInputsGuider:function closeInputsGuider(){pageTour.close(LOGO_QUERY_INPUTS_PAGE_TOUR_ID)},getViewOptions:function getViewOptions(){return{model:this.model,dashboard:this.dashboard,queries:queries,queryGroups:queryGroups,allowedQueryTypes:this.constructor.allowedQueryTypes,allowMultipleSelection:this.constructor.allowMultipleSelection}},createQueryInputs:function createQueryInputs(viewOptions){return new this.constructor.QueryInputsClass(viewOptions)},createDateInputs:function createDateInputs(viewOptions){return new ControlsViewDateInputs(viewOptions)},setupInputViews:function setupInputViews(viewOptions){var queryViewOptions=_.extend({isEnabled:permissions.check("see.dashboard.controls.queryField",viewOptions.dashboard),canEditQueries:permissions.check("edit.queries")},viewOptions);viewOptions.timezone=this.dashboard&&this.dashboard.getTimezone();this.queryInputs=this.createQueryInputs(queryViewOptions);this.dateInputs=this.createDateInputs(viewOptions);if(!this.model.disableSearch&&me.get("uiRole")!=="viewMetricsOnly"){this.searchInput=new ControlsViewSearchInput(_.extend({expandDirection:"left",expanderClassName:"mentionsSearchTermExpander controls--section singlepadding lightgreybg"},viewOptions));this.listenTo(this.searchInput,"changesMade",this.onChangesMade,this);this.listenTo(this.searchInput,"search",this.onSearchApplied,this)}this.listenTo(this.queryInputs,"changesMade",this.onChangesMade);this.listenTo(this.dateInputs,"changesMade",this.onChangesMade)},getFilters:function getFilters(viewOptions){var _this=this;var sentimentFiltersOptions=_.extend({},viewOptions,{metrics:globalMetrics});var pageAndMentionTypeFiltersOptions=_.extend({},viewOptions,{showSubTypeFilter:true});var categoryFiltersOptions=_.extend({},viewOptions,{categories:this.categories});var siteFilters=Object.assign({},viewOptions,{siteGroups:globalSiteGroups,showHelp:permissions.check("see.dashboard.controls.help",currentDashboard),userId:me.id,canEditGroups:permissions.check("edit.groups",currentDashboard)});var authorViewOptions=Object.assign({},viewOptions,{authorGroups:authorGroups,canEditGroups:permissions.check("edit.groups",this.dashboard)});var languageFiltersOptions=Object.assign({},viewOptions,{languageCollection:this.languages});var locationFiltersOptions=Object.assign({},viewOptions,{locationGroups:locationGroups});var twitterFiltersOptions=Object.assign({},viewOptions,{professions:professions,interests:interests,locationGroups:locationGroups,userId:me.id,ownerId:this.dashboard&&this.dashboard.getOwner()});var tagFiltersOptions=Object.assign({},viewOptions,{tagCollection:this.tags});var workflowFiltersOptions=Object.assign({},viewOptions,{workflow:globalWorkflow});var facebookFiltersOptions=Object.assign({},viewOptions,{hideSubTypeFilter:true});var instagramFiltersOptions=Object.assign({},viewOptions,{hideSubTypeFilter:true});var logoVersionsFiltersOptions=Object.assign({},viewOptions,{collection:new LogoQueryCollection([],{projectId:currentProject.id})});var emotionsFiltersOptions=_.extend({},viewOptions,{emotions:globalClassifications.getEmotionLabels(),metrics:globalMetrics});if(!viewOptions.hasOwnProperty("showHelp")){throw new Error("ControlsView.getFilters must be called with a showHelp option")}var enableReachMetric=flags.variation(FLAGS.ENABLE_REACH_METRIC);var features=[];if(enableReachMetric){features.push({filter:ReachFilters,option:viewOptions})}return[{filter:CategoryFilters,option:categoryFiltersOptions},{filter:TagFilters,option:tagFiltersOptions},{filter:PageAndMentionTypeFilters,option:pageAndMentionTypeFiltersOptions},flags.variation(FLAGS.ENABLE_EMOTIONS)?{filter:SentimentAndEmotionsFilters,option:emotionsFiltersOptions}:{filter:SentimentFilters,option:sentimentFiltersOptions},{filter:AuthorFilters,option:authorViewOptions},{filter:LocationFilters,option:locationFiltersOptions},{filter:LanguageFilters,option:languageFiltersOptions},{filter:WorkflowFilters,option:workflowFiltersOptions},{filter:SiteFilters,option:siteFilters},{filter:TwitterFilters,option:twitterFiltersOptions},{filter:FacebookFilters,option:facebookFiltersOptions},{filter:InstagramFilters,option:instagramFiltersOptions},{filter:ForumThreadFilters,option:viewOptions},{filter:BlogFilters,option:viewOptions},{filter:LogoVersionsFilters,option:logoVersionsFiltersOptions}].concat(features).reduce(function(memo,_ref){var Filter=_ref.filter,option=_ref.option;var definedFilters=_this.getFiltersByName();if(definedFilters.includes(Filter)){memo.push(new Filter(option))}return memo},[])},getFiltersByName:function getFiltersByName(){return Object.keys(ControlsView.FILTER_NAMES).map(function(key){return ControlsView.FILTER_NAMES[key]})},renderInputs:function renderInputs(){this.renderSearchInput();if(permissions.check("see.dashboard.controls.queryField",this.dashboard)){this.renderQueryInputs()}this.renderDateInputs();return this.renderFilters()},renderFilters:function renderFilters(){var self=this;var renderedFilters=_.map(this.filters,function(filter){self.$(".filters p.apply").before(filter.el);filter.on("changesMade",self.onChangesMade,self);return filter.render()});return Q.all(renderedFilters)},renderQueryInputs:function renderQueryInputs(){this.$(".queryinputs").prepend(this.queryInputs.el);this.queryInputs.render();this.queryInputs.$(".queryInputs").addClass("js-logo-query-inputs-tour")},renderSearchInput:function renderSearchInput(){if(this.searchInput){if(!this.$(".searchBoxContainer").length){this.$el.prepend('<div class="searchBoxContainer controls--section lightgreybg" />')}this.$(".searchBoxContainer").append(this.searchInput.el);this.searchInput.render()}},renderDateInputs:function renderDateInputs(){this.$(".dateinputs").prepend(this.dateInputs.el);this.dateInputs.render()},onSearchApplied:function onSearchApplied(e){this.onApplyChanges(e);trackQuickSearchSubmitted(this.dashboard,this.componentType,this.model)},onApplyChanges:function onApplyChanges(e){e.preventDefault();return this.applyChanges()},onFilterActionsClick:function onFilterActionsClick(){var _this2=this;this.filterActionsContextMenu=FilterActionsContextMenu.show({$target:this.$(".js-filter-actions"),currentFilterValues:getCurrentFilterValues(this.model,this.filters)});this.listenToOnce(this.filterActionsContextMenu,"copied",this.onFiltersCopied.bind(this));this.listenToOnce(this.filterActionsContextMenu,"paste",this.onPasteFilters.bind(this));this.listenToOnce(this.filterActionsContextMenu,"clear",this.clearFilters.bind(this));this.listenToOnce(this.filterActionsContextMenu,"remove",function(){_this2.stopListening(_this2.filterActionsContextMenu);_this2.filterActionsContextMenu=undefined})},onFiltersCopied:function onFiltersCopied(){$.notify({text:"Filter settings copied",duration:QUICK_NOTIFICATION_DURATION,className:"notification-info"})},onPasteFilters:function onPasteFilters(filterValues){this.clearFilters();this.setFilters(filterValues);$.notify({text:"Filter settings pasted",duration:QUICK_NOTIFICATION_DURATION,className:"notification-success"})},getSupportedFilterNames:function getSupportedFilterNames(){return Object.keys(this.getInitialFilterValues()[1])},setFilters:function setFilters(filters){var changes=this.getSupportedFilterNames().reduce(function(memo,filterName){var value=filters[filterName];if(Array.isArray(value)&&!value.length){return memo}if(!value){return memo}memo[filterName]=value;return memo},{});this.model.set(changes)},applyChanges:function applyChanges(additionalSettings){this.setSettings(additionalSettings);var previous=this.model.previousAttributes();var changed=this.model.changedAttributes();var changedAttrs=nonEmptyChangedProperties(previous,changed);var changedFiltersAttrs=_.pick(changedAttrs,_.keys(this.finalFilterValues));var applyType=_.isEmpty(changedAttrs)?"Reload":"Filter";this.trigger("applyChanges",changedFiltersAttrs,applyType)},setSettings:function setSettings(additionalSettings){this.model.set(_.extend({},this.getSettings(),additionalSettings),{validate:true})},getSettings:function getSettings(){this.finalFilterValues=_(this.filters).reduce(function(values,filter){var filterValues=filter.getValues();_.each(filterValues,function(value,key){if(values[key]){values[key]=values[key].concat(filterValues[key])}else{values[key]=filterValues[key]}});return values},{});return _.extend({lastUpdated:(new Date).getTime()},this.getSettingsForInputViews(),this.finalFilterValues)},getSettingsForInputViews:function getSettingsForInputViews(){var values=this.queryInputs.getValues();if(this.dateInputs){values=_.extend(values,this.dateInputs.getValues())}if(this.searchInput){values=_.extend(values,this.searchInput.getValues())}return values},getInitialFilterValues:function getInitialFilterValues(){var defaults=_.result(this.model,"defaults");var filterDefaults={};var defaultKeys=_.keys(defaults||{});var filterKeys=_.chain(this.filters).map(function(filter){filter.hideValidationErrors();return filter.getValues()}).reduce(function(memo,values){_(values).forEach(function(value,key){if(defaultKeys.indexOf(key)===-1){memo[key]=""}else{filterDefaults[key]=defaults[key]}});return memo},{}).value();return[filterDefaults,filterKeys]},clearFilters:function clearFilters(){var _this$getInitialFilte=this.getInitialFilterValues(),_this$getInitialFilte2=_slicedToArray(_this$getInitialFilte,2),filterDefaults=_this$getInitialFilte2[0],filterKeys=_this$getInitialFilte2[1];this.model.set(filterDefaults,{silent:true});this.model.set(filterKeys,{unset:true})},onChangesMade:function onChangesMade(){toggleHighlightApplyChanges(this.$(".applyChanges:not(.ignoreHighlight)"),true);this.enableApplyChanges()},changesApplied:function changesApplied(){toggleHighlightApplyChanges(this.$(".applyChanges:not(.ignoreHighlight)"),false)},enableApplyChanges:function enableApplyChanges(){this.$(".applyChanges:not(.disabled)").prop("disabled",false).text("Apply")},disableApplyChanges:function disableApplyChanges(){this.$(".applyChanges").prop("disabled",true).text("Loading...")},getAppliedFilterNames:function getAppliedFilterNames(){var filterNamesByFilterGroup=this.filters.map(function(filterView){return filterView.getAppliedFilterNames()});return _.flatten(filterNamesByFilterGroup)}},{FILTER_NAMES:{CategoryFilters:CategoryFilters,TagFilters:TagFilters,PageAndMentionTypeFilters:PageAndMentionTypeFilters,SentimentFilters:SentimentFilters,SentimentAndEmotionsFilters:SentimentAndEmotionsFilters,AuthorFilters:AuthorFilters,LocationFilters:LocationFilters,LanguageFilters:LanguageFilters,WorkflowFilters:WorkflowFilters,SiteFilters:SiteFilters,TwitterFilters:TwitterFilters,FacebookFilters:FacebookFilters,InstagramFilters:InstagramFilters,ForumThreadFilters:ForumThreadFilters,BlogFilters:BlogFilters,LogoVersionsFilters:LogoVersionsFilters,ReachFilters:ReachFilters},QueryInputsClass:ControlsViewQueryInputs});return ControlsView});define("mustache!templates/componentContextMenu",["lib/mustache"],function(mustache){var escapedTemplate='<ul>\n{{#canReload}}\n<li class="context-menu--item js-reload"><a><span class="icon-bwreload smallmargin-right" data-at="component-contextmenu-reload"></span>Reload</a></li>\n<li class="context-menu--item separator"></li>\n{{/canReload}}\n<li class="context-menu--item js-delete"><a><span class="icon-trash smallmargin-right"></span>Delete</a></li>\n{{#canEditDashboards}}\n<li class="context-menu--item separator"></li>\n<li class="context-menu--item js-duplicate"><a><span class="icon-bwcopy smallmargin-right"></span>Duplicate Below</a></li>\n<li class="context-menu--item separator"></li>\n<li class="context-menu--item js-copy"><a><span class="icon-bwcopy smallmargin-right"></span>Copy</a></li>\n<li class="context-menu--item js-paste"><a><span class="icon-paste smallmargin-right"></span>Paste Below</a></li>\n{{/canEditDashboards}}\n</ul>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/views/ComponentContextMenuView",["src/permissions","src/views/ContextMenuView","mustache!templates/componentContextMenu"],function(permissions,ContextMenuView,template){"use strict";return ContextMenuView.extend({tagName:"nav",className:"componentContextMenu context-menu popupframe",position:"below-right",initialize:function initialize(options){options=options||{};if(!options.$target){throw new Error("ComponentContextMenuView must be initialized with options.$target")}this.$target=options.$target;this._isShown=false;this.canReload=options.canReload!==false;this.canEditDashboards=options.canEditDashboards||permissions.check("edit.dashboard")},events:function events(){return{"click li.js-duplicate":"onClickDuplicate","click li.js-delete":"onClickDelete","click li.js-reload":"onClickReload","click li.js-copy":"onClickCopy","click li.js-paste":"onClickPaste"}},remove:function remove(){if(this._isShown){this.trigger("hidden",{target:this.$target})}this._isShown=false;ContextMenuView.prototype.remove.call(this)},render:function render(){this.$el.html(template({canEditDashboards:this.canEditDashboards,canReload:this.canReload}));this._isShown=true},onClickDuplicate:function onClickDuplicate(){this.trigger("duplicate",{target:this.$target});this.remove()},onClickDelete:function onClickDelete(){this.trigger("delete",{target:this.$target});this.remove()},onClickReload:function onClickReload(){this.trigger("reload",{target:this.$target});this.remove()},onClickCopy:function onClickCopy(){this.trigger("copy",{target:this.$target});this.remove()},onClickPaste:function onClickPaste(){this.trigger("paste",{target:this.$target});this.remove()},isShown:function isShown(){return this._isShown}})});define("mustache!templates/utilsBar",["lib/mustache"],function(mustache){var escapedTemplate='{{#canSeeHelp}}\n<li class="help floatleft singlepadding-horizontal componentHeader--section"><a data-key="{{helpKey}}" class="help icon-bwhelp db componentHeader--icon"></a></li>\n{{/canSeeHelp}}\n{{#hasAlternateViews}}\n<li class="switch-views floatleft componentHeader--section">\n<a class="switch-views singlepadding-horizontal db grey customtip" data-at="component-switch-view" title="Current View: {{activeViewName}}"><span class="js-view-icon componentHeader--icon {{activeViewIconClassName}}"></span><span class="label smallpadding-left">View</span> <span class="icon-chevron-down componentHeader--icon"></span></a>\n<ul class="alternate-views context-menu popupframe modular">\n{{#alternateViews}}\n{{{.}}}\n{{/alternateViews}}\n</ul>\n</li>\n{{/hasAlternateViews}}\n{{#canExport}}\n<li class="floatleft componentHeader--section"><a class="export db grey singlepadding-horizontal"><span class="icon-bwdownload componentHeader--icon"></span><span class="label smallpadding-left">Export</span> <span class="componentHeader--icon icon-chevron-down"></span></a></li>\n{{/canExport}}\n{{#canSeeControls}}\n<li class="floatleft componentHeader--section filters" data-at="component-toggle-filters">\n<a class="controls db grey customtip singlepadding-horizontal componentHeader--toggle" title="Toggle filters"><span class="icon-filter componentHeader--icon"></span><span class="label smallpadding-left">{{controlsLabel}}</span></a>\n</li>\n{{/canSeeControls}}\n{{#showComponentContexMenu}}\n<li class="floatleft componentHeader--section js-componentcontextmenu" data-at="component-toggle-contextmenu">\n<a class="db grey icon-chevron-down singlemargin-horizontal componentHeader--icon"></a>\n</li>\n{{/showComponentContexMenu}}\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/views/UtilsBarView",["backbone","underscore","jquery","src/permissions","src/globals/currentDashboard","src/views/ComponentContextMenuView","mustache!templates/utilsBar","src/packages/customtip"],function(Backbone,_,$,permissions,currentDashboard,ComponentContextMenuView,utilsBarTemplate){"use strict";return Backbone.View.extend({tagName:"ul",className:"utilsBar",events:function events(){return{"click a.close":"close","click a.controls":"toggleControls","click a.export":"onToggleExportMenu","click a.switch-views":"toggleSwitchViewsMenu","click .alternate-views li":"switchView","click .utilsBar li a":"onUtilsBarItemClick","click .js-componentcontextmenu":"onClickComponentContextMenu"}},initialize:function initialize(options){if(!options||!options.viewList){throw new Error("options.viewList must be defined!")}if(!options.exportView){throw new Error("options.exportView must be defined!")}_(this).bindAll("removeSwitchViewsMenu");this.viewList=options.viewList;this.exportView=options.exportView;this.helpKey=options.helpKey;this.canExport=options.canExport!==false;this.canReload=options.canReload!==false;this.canSeeHelp=options.canSeeHelp!==false;this.canSeeControls=options.canSeeControls!==false;this.listenTo(this.exportView,"shown",this.onShowExportMenu);this.listenTo(this.exportView,"hidden",this.onHideExportMenu)},onShowExportMenu:function onShowExportMenu(){this.$("a.export").closest("li").addClass("open")},onHideExportMenu:function onHideExportMenu(){this.$("a.export").closest("li").removeClass("open")},remove:function remove(){if(this.componentMenu){ComponentContextMenuView.hide();this.componentMenu=null}$("body").off("click.removeViewSwitcher",this.removeSwitchViewsMenu);Backbone.View.prototype.remove.call(this)},close:function close(){this.trigger("close")},reload:function reload(){this.trigger("reload")},onClickComponentContextMenu:function onClickComponentContextMenu(e){e.preventDefault();e.stopPropagation();this.toggleComponentContextMenu($(e.target).closest(".js-componentcontextmenu"))},toggleComponentContextMenu:function toggleComponentContextMenu($target){if(!$target){return}this.removeExportView();this.removeSwitchViewsMenu();if(this.componentMenu){ComponentContextMenuView.hide();this.componentMenu=null;return}this.componentMenu=ComponentContextMenuView.show({$target:$target,canReload:this.canReload});if(this.componentMenu){this.listenTo(this.componentMenu,"duplicate",this.duplicate);this.listenTo(this.componentMenu,"delete",this.close);this.listenTo(this.componentMenu,"reload",this.reload);this.listenTo(this.componentMenu,"copy",this.copy);this.listenTo(this.componentMenu,"paste",this.paste);this.listenTo(this.componentMenu,"hidden",function(){$target.removeClass("open")});$target.addClass("open")}},duplicate:function duplicate(){this.trigger("duplicate")},copy:function copy(){this.trigger("copy")},paste:function paste(){this.trigger("paste")},toggleControls:function toggleControls(){this.removeSwitchViewsMenu();this.trigger("toggleControls");this.$(".filters").toggleClass("active")},showControls:function showControls(enable){this.$(".filters").toggleClass("active",enable)},toggleSwitchViewsMenu:function toggleSwitchViewsMenu(e){var viewMenu=this.$("li.switch-views");this.removeExportView();this.toggleComponentContextMenu();if(viewMenu.hasClass("open")){return this.removeSwitchViewsMenu()}viewMenu.addClass("open");e.stopPropagation();$("body").on("click.removeViewSwitcher",this.removeSwitchViewsMenu)},removeSwitchViewsMenu:function removeSwitchViewsMenu(){var viewMenu=this.$(".switch-views"),viewList=viewMenu.find(".alternate-views");$("body").off("click.removeViewSwitcher",this.removeSwitchViewsMenu);viewList.hide().removeAttr("style");viewMenu.removeClass("open")},onToggleExportMenu:function onToggleExportMenu(e){e.preventDefault();this.toggleExportMenu()},toggleExportMenu:function toggleExportMenu(){if(!this.exportView.isVisible()){this.removeSwitchViewsMenu();this.toggleComponentContextMenu();var menu=this.exportView;menu.render();menu.showNextTo(this.$("a.export"))}else{this.removeExportView()}},removeExportView:function removeExportView(){this.exportView.hide()},onUtilsBarItemClick:function onUtilsBarItemClick(){$(".select2-container-active").select2("close")},switchView:function switchView(e){e.preventDefault();var target=$(e.target),$el=target.closest("li"),key=$el.data("key"),activeView;if($el.hasClass("disabled")){return}_(this.viewList).each(function(vw){if(vw.isActive){vw.isActive=false;return}if(vw.key===key){vw.isActive=true;activeView=vw}});this.trigger("switchView",key);this.toggleSwitchViewsMenu(e);$el.addClass("disabled").siblings().removeClass("disabled");this.$(".js-view-icon").removeClass(_(this.viewList).pluck("iconClassName").join(" ")).addClass(activeView.iconClassName).closest(".switch-views").prop("title","Current View: "+activeView.name).customtip();return false},render:function render(options){var data={},template=options&&options.template||utilsBarTemplate,views=this.viewList,activeView=_(views).findWhere({isActive:true});if(!activeView){activeView=_(views).findWhere({isDefault:true})}if(!activeView){activeView=views.length?views[0]:undefined}if(_(views).size()>1){data.hasAlternateViews=permissions.check("see.dashboard.component.changeView",currentDashboard);data.alternateViews=_(views).map(function(view){var viewKey=view.key,currentView=_(views).detect(function(vw){return vw.key===viewKey}),disabledClass="",viewIcon="";if(currentView&&currentView.isActive){disabledClass=" disabled"}if(view.iconClassName){viewIcon=['<span class="',view.iconClassName,' singlepadding-left smallpadding-right">',"</span>"].join("")}return["<li ",'class="context-menu--item iconindent ',disabledClass,'" ','data-key="',viewKey,'">',viewIcon,view.name,"</li>"].join("")})}data.canSeeHelp=this.canSeeHelp&&permissions.check("see.dashboard.component.help",currentDashboard);data.canSeeControls=this.canSeeControls&&permissions.check("see.dashboard.controls",currentDashboard);data.canMinimize=this.canMinimize;data.showComponentContexMenu=permissions.check("edit.dashboard",currentDashboard);data.controlsLabel=permissions.check("see.dashboard.controls.advancedFilters",currentDashboard)?"Filters":"Date";data.helpKey=this.helpKey;data.canExport=this.canExport;if(activeView){data.activeViewName=activeView.name;data.activeViewIconClassName=activeView.iconClassName}this.$el.html(template(data)).customtip()},showPartialSolrIndicator:function showPartialSolrIndicator(){if(this.$(".js-partial-solr-indicator").length===0){this.$el.prepend('<li class="js-partial-solr-indicator floatleft componentHeader--section">&nbsp;</li>')}},hidePartialSolrIndicator:function hidePartialSolrIndicator(){this.$(".js-partial-solr-indicator").remove()}})});define("src/models/ExportMenu",["backbone"],function(Backbone){"use strict";return Backbone.Model.extend({defaults:{showCustomSize:true},validate:function validate(attrs){if(attrs.size==="custom"){var minSize=100;var maxSize=5e3;var width=parseInt(attrs.customWidth,10);var height=parseInt(attrs.customHeight,10);var widthInvalid=isNaN(width)||width<minSize||width>maxSize;var heightInvalid=isNaN(height)||height<minSize||height>maxSize;if(widthInvalid&&heightInvalid){return{dimension:"both",message:"Please enter a width and height between ".concat(minSize," and ").concat(maxSize)}}if(widthInvalid){return{dimension:"width",message:"Please enter a width between ".concat(minSize," and ").concat(maxSize)}}if(heightInvalid){return{dimension:"height",message:"Please enter a height between ".concat(minSize," and ").concat(maxSize)}}}}})});define("mustache!templates/exportMenu",["lib/mustache"],function(mustache){var escapedTemplate='<div class="exportMenuView">\n<ul class="export-formats">\n{{#formats}}\n<li data-export-format="{{id}}" class="context-menu--item {{#isImageFormat}}showImageOptions{{/isImageFormat}} {{#disabled}}disabled{{/disabled}}"><a>{{name}}</a></li>\n{{/formats}}\n</ul>\n\n<div class="image-options smallpadding-vertical singlepadding-horizontal hidden">\n<form class="singlemargin-bottom">\n<ul>\n{{#sizes}}\n<li class="standardSize">\n<label class="size {{cssClass}}">\n<input class="size" type="radio" name="size" value="{{value}}" {{checked}}/>\n{{name}}\n</label>\n<span class="size-help">{{help}}</span>\n</li>\n{{/sizes}}\n{{#showCustomSize}}\n<li class="customSize">\n<label class="size">\n<input class="size" type="radio" name="size" value="custom"/>\nCustom\n</label>\n<div class="custom-size-dimensions">\n<label><span>Width:</span> <input type="text" class="custom customWidth field" name="customWidth"/>px</label>\n<label><span>Height:</span> <input type="text" class="custom customHeight field" name="customHeight"/>px</label>\n<p class="validation-message hidden size-help"></p>\n</div>\n</li>\n{{/showCustomSize}}\n</ul>\n<input type="hidden" name="format"/>\n<button class="doImageExport defaultbutton singlemargin-top">Export</button>\n</form>\n</div>\n\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}define("src/views/ExportMenuView",["backbone","underscore","jquery","mustache!templates/exportMenu","jquery.showRelativeTo"],function(Backbone,_,$,exportMenuTemplate){"use strict";function buildSizes(model){var sizes=model.get("sizes");if(sizes&&sizes[0]){sizes[0].checked="checked"}return sizes}function buildExportFormats(model){var formats=[];if(model.get("showXlsCsv")){formats.push({id:model.get("useXlsx")?"xlsx":"xls",name:"Excel"});formats.push({id:"csv",name:"CSV"})}if(model.get("showJpg")||model.get("showImage")){formats.push({id:"jpeg",name:"JPG",isImageFormat:true})}if(model.get("showPng")||model.get("showImage")){formats.push({id:"png",name:"PNG",isImageFormat:true})}if(model.get("showSvg")||model.get("showImage")){formats.push({id:"svg+xml",name:"SVG",isImageFormat:true})}return formats}return Backbone.View.extend({className:"exportMenu context-menu popupframe modular",events:{"submit form":"submitForm","click .export-formats li:not(.disabled)":"refreshMenu","click .export-formats li.disabled":"onClickDisabledFormat","click .doImageExport":"doImageExport","click .standardSize":"markActive","click .customSize":"markActive","click .image-options":"onDoImageExport","focusin input.custom":"clearValidation"},initialize:function initialize(){_(this).bindAll("hide");this.model.on("change",this.render,this)},remove:function remove(){if(this.isVisible()){this.hide()}this.off();Backbone.View.prototype.remove.call(this)},showNextTo:function showNextTo(parent){if(!(parent instanceof $)){throw new Error("Parent must be a jQuery-wrapped DOM node")}this.shown=true;this.$el.appendTo("body").showRelativeTo({target:parent});$("body").on("click.hideExportMenuView",this.hide.bind(this));this.trigger("shown");this.parent=parent},isVisible:function isVisible(){return this.shown},hide:function hide(e){if(e&&$(e.target).closest(".export").length){return}this.shown=false;$("body").off("click.hideExportMenuView");this.trigger("hidden",{$parent:this.parent});this.$el.hide().removeRelativeTo();this.parent=null},render:function render(){var cid=this.cid,model=this.model,data={formats:model.get("formats")||buildExportFormats(model),showCustomSize:model.get("showCustomSize"),sizes:buildSizes(model),makeId:function makeId(text){return cid+"-"+text}},el=exportMenuTemplate(data);this.$el.html(el)},onDoImageExport:function onDoImageExport(e){e.stopPropagation();var src=$(e.target);if(src.is(".doImageExport")){this.doImageExport(e)}},submitForm:function submitForm(e){e.preventDefault()},refreshMenu:function refreshMenu(e){e.preventDefault();e.stopPropagation();var $el=$(e.currentTarget),$menuEl=this.$(".exportMenuView"),$imageOptions=this.$(".image-options"),showImageOptions=$el.closest("li").hasClass("showImageOptions"),format=$el.attr("data-export-format");$el.siblings().removeClass("active");$menuEl.find("input[type=radio]:checked").closest("li").addClass("active");this.$("input[name=format]").val(format);if(!showImageOptions){this.showExportingThrobber();this.trigger("doExport",{format:format,chartName:this.model.get("exportKey")});$menuEl.removeClass("expanded");return}this.$validationArea=this.$(".validation-message");this.$inputCustomSize=this.$("input.custom");this.$inputCustomWidth=this.$("input.customWidth");this.$inputCustomHeight=this.$("input.customHeight");$el.addClass("active");$menuEl.addClass("expanded");this.clearValidation();$imageOptions.removeClass("hidden");this.$el.reposition()},onClickDisabledFormat:function onClickDisabledFormat(e){e.preventDefault();e.stopPropagation();this.warnDisabledFormat($(e.currentTarget).attr("data-export-format"))},warnDisabledFormat:function warnDisabledFormat(format){this.trigger("disabledFormatSelected",{format:format})},showExportingThrobber:function showExportingThrobber(){var self=this,exportNotice=$('<div class="exporting singlemargin-horizontal">Exporting...</div>'),menuView=this.$(".exportMenuView");menuView.children().addClass("hidden");menuView.removeClass("expanded").append(exportNotice);this.$el.reposition();setTimeout(function(){self.hide()},3e3)},markActive:function markActive(e){$(".standardSize").removeClass("active");$(".customSize").removeClass("active");$(e.target).closest("li").addClass("active").find("input[type=radio]").prop("checked",true)},doImageExport:function doImageExport(e){e.preventDefault();e.stopPropagation();var formData=_(this.$("form").serializeArray()).reduce(function(memo,pair){memo[pair.name]=pair.value;return memo},{});this.model.set(formData,{silent:true,validate:true});if(this.model.validationError){this.showValidationError(this.model.validationError);return}this.showExportingThrobber();var _formData$size$split=formData.size.split(","),_formData$size$split2=_slicedToArray(_formData$size$split,2),width=_formData$size$split2[0],height=_formData$size$split2[1];this.trigger("doExport",{width:formData.size==="custom"?formData.customWidth/2:width,height:formData.size==="custom"?formData.customHeight/2:height,format:"image/"+formData.format,chartName:this.model.get("exportKey")})},showValidationError:function showValidationError(error){this.$inputCustomSize.removeClass("invalid");if(error){if(error.dimension==="both"){this.$inputCustomSize.addClass("invalid")}if(error.dimension==="width"){this.$inputCustomWidth.addClass("invalid")}if(error.dimension==="height"){this.$inputCustomHeight.addClass("invalid")}this.$validationArea.text(error.message);this.$validationArea.removeClass("hidden")}},clearValidation:function clearValidation(){this.$validationArea.text("");this.$validationArea.addClass("hidden");this.$inputCustomSize.removeClass("invalid")}})});define("mustache!src/uhd/templates/uhd-popup",["lib/mustache"],function(mustache){var escapedTemplate='<div class="uhd-popup popup singlepadding">\n<p class="notification-info rounded smallpadding-vertical singlepadding-horizontal singlemargin-bottom">\nThis Component includes <b>Historical Data</b>\n</p>\n<table class="uhd-popup-table doublemargin-bottom">\n<thead class="smalltext">\n<tr class="rowborder columnheader lightgrey">\n<th class="cellpadding-vertical cellpadding-right">Query</th>\n<th class="cellpadding">Last Modified</th>\n<th class="cellpadding">Historical Data Available *</th>\n</tr>\n</thead>\n<tbody class="grey mediumtext">\n{{#queries}}\n<tr class="highlightrow rowborder">\n<td class="cellpadding uhd-popup-table__query">\n<span class="uhd-popup-table__icon icon-bwquery iconbig querycolor smallpadding-right"></span>\n<span class="customtip" title="{{name}}">{{name}}</span>\n</td>\n<td class="cellpadding">{{lastModifiedDate}}</td>\n<td class="cellpadding uhd-popup-table__available-from">Back to {{backfillMinDate}}</td>\n</tr>\n{{/queries}}\n</tbody>\n</table>\n\n{{^isBrandwatchOrGreyLabelTheme}}\n<p class="uhd-popup__footnote mediumtext bigline grey">\nPlease talk to your account contact for more information\n</p>\n{{/isBrandwatchOrGreyLabelTheme}}\n{{#isBrandwatchOrGreyLabelTheme}}\n<p class="uhd-popup__footnote mediumtext bigline grey">\nData from before Query creation/editing is powered by the Brandwatch archive of social and web content plus a scaled 10% sample of Twitter &dash; <a href="https://support.brandwatch.com/hc/en-us/articles/227136648#howitworks" target="_blank">more details</a>\n</p>\n{{/isBrandwatchOrGreyLabelTheme}}\n</div>\n<div class="uhd-popup-arrow"></div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/uhd/views/UHDPopupView",["backbone","bw-fe-helpers/dateHelper","mustache!src/uhd/templates/uhd-popup","src/globals/theme","jquery.showRelativeTo","src/packages/customtip"],function(Backbone,dateHelper,uhdPopupTemplate,theme){"use strict";var view;var destroyId;var DESTROY_TIMEOUT=300;var INITIAL_ARROW_X_POSITION=-7;var UHDPopupView;function formatQueries(queries){return queries.map(function(query){return{name:query.name,lastModifiedDate:dateHelper.prettifyDate(query.lastModifiedDate,{format:"MMM DD, YYYY"}),backfillMinDate:dateHelper.prettifyDate(query.backfillMinDate,{format:"MMM DD, YYYY"})}})}function pointArrowAtTarget(view,$target){var viewPos=view.$el.offset();var targetPos=$target.offset();var $arrow=view.$(".uhd-popup-arrow");var arrowLeftPos=INITIAL_ARROW_X_POSITION+(targetPos.left-viewPos.left)+$target.outerWidth()/2;$arrow.css("left",arrowLeftPos+"px").toggleClass("uhd-popup-arrow--up",viewPos.top>targetPos.top)}function show($target,queries){clearTimeout(destroyId);if(!view){view=new UHDPopupView}if($target&&view.$target&&view.$target.get(0)===$target.get(0)){return}view.render(queries);view.$target=$target;view.$el.appendTo("body").showRelativeTo({target:$target});pointArrowAtTarget(view,$target)}function destroy(){clearTimeout(destroyId);destroyId=setTimeout(function(){if(view){view.remove();view=null}},DESTROY_TIMEOUT)}UHDPopupView=Backbone.View.extend({className:"uhd-popup-view",events:{mouseenter:function mouseenter(){UHDPopupView.show(this.$target)},mouseleave:function mouseleave(){UHDPopupView.destroy()}},render:function render(queries){this.$el.html(uhdPopupTemplate({isBrandwatchOrGreyLabelTheme:theme.isBrandwatchOrGreyLabelTheme(),queries:formatQueries(queries)}));this.$(".customtip").customtip()}},{show:show,destroy:destroy});return UHDPopupView});function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};var ownKeys=Object.keys(source);if(typeof Object.getOwnPropertySymbols==="function"){ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))}ownKeys.forEach(function(key){_defineProperty(target,key,source[key])})}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}define("src/exportManager",["underscore","jquery","src/Workbench","bw-highcharts","bw-fe-helpers/isoDateHelper","bw-fe-helpers/dateHelper","lib/jquery.notify"],function(_,$,Workbench,Highcharts,isoDateHelper,dateHelper){"use strict";var notifyTimeout=5e3,EXPORT_BASE64_TO_PNG_API_ENDPOINT="/download/base64";function formatFileNameDate(date){return dateHelper.prettifyDate(date,{format:"DD_MMM",timezone:"UTC"})}function generateFileName(options){var width=options.width,height=options.height,filenamePrefix=options.filenamePrefix||"chart",queryName=(options.queryName||"").replace(/\s/g,"_"),dateRange=options.dateRange,startDate=options.startDate,endDate=options.endDate,result=[filenamePrefix],startDateString,endDateString,extractedDates;if(queryName){result.push(queryName)}if(dateRange){extractedDates=isoDateHelper.extractStartEndDates(dateRange);startDate=extractedDates.startDate;endDate=extractedDates.endDate}startDateString=formatFileNameDate(startDate);endDateString=formatFileNameDate(endDate);if(startDateString&&endDateString){result.push("from",startDateString,"to",endDateString)}if(width){result.push(width*2+"px")}if(width&&height){result.push("x")}if(height){result.push(height*2+"px")}return result.join("_")}function buildExportSettings(options){options=options||{};var exportSettings=_.defaults(options,{format:"image/jpeg",width:options.size||800,height:"",chartName:"chart_"+ +new Date,chartOptions:{chart:{events:{load:function load(){if(this.options.series[0].type==="sunburst"){return}var xAxis=this.xAxis[0];var plotLines=xAxis.plotLinesAndBands.map(function(plotline){return _objectSpread({},plotline.options,{label:""})});xAxis.update({plotLines:plotLines})}}}},filename:generateFileName(options),allowHTML:true});return exportSettings}var exportManager={exportData:function exportData(model,settings,options){options=options||{};var format=options.format||"xls",url=options.url||(_.isFunction(model.url)?model.url():model.url),queryData=settings&&_.isFunction(settings.getQueryDataForExport)?settings.getQueryDataForExport():{};if(url.indexOf("?")>-1){url+="&"}else{url+="?"}if("start"in queryData){queryData.start=1}if("page"in queryData){queryData.page=0}if("pageSize"in queryData){queryData.pageSize=5e3}url+=$.param(queryData);url=url.replace(/\/?\?/g,"."+format+"?");url=Workbench.buildApiUrl(url);exportManager.exportInIframe(url);if(format==="csv"){$.notify("Creating CSV file...",notifyTimeout)}else{$.notify("Creating Excel spreadsheet...",notifyTimeout)}},exportInIframe:function exportInIframe(url){var $iframe=$('<iframe style="display:none" />');$iframe.attr("src",url);$iframe.on("load",function(){setTimeout(function(){$iframe.remove()},1e3)});$iframe.appendTo("body")},exportChart:function exportChart(chart,options,chartOptions){var _this=this;var exportSettings=_.extend(chart.options.exporting,buildExportSettings(options),{fallbackToExportServer:false});chart.options.peaks=undefined;chart.options.exporting.error=function(){return _this.exportSvg(chart.getSVG(),exportSettings)};var _chart$options$export=chart.options.exporting,filename=_chart$options$export.filename,width=_chart$options$export.width,sourceWidth=_chart$options$export.width,sourceHeight=_chart$options$export.height,type=_chart$options$export.format;return chart.exportChartLocal({type:type,filename:filename,width:width,sourceWidth:sourceWidth,sourceHeight:sourceHeight},chartOptions)},exportSvg:function exportSvg(svg,options){var $form;$form=$('<form method=post target=_blank style="display:none;" />');$form.attr("action",options.url||Highcharts.getOptions().exporting.url);_({filename:options.filename||"export",type:options.format,width:options.width,height:options.height,svg:svg}).forEach(function(value,name){var $input=$("<input type=hidden />");$input.attr("name",name);$input.attr("value",value);$form.append($input)});$form.appendTo("body");$form.submit();$form.remove()},exportToPng:function exportToPng(base64ImageData,fileName){var $iframe=$('<iframe style="display:none" onload=""></iframe>'),$form=$('<form method="post" action="'+EXPORT_BASE64_TO_PNG_API_ENDPOINT+'" />');base64ImageData=base64ImageData.replace("data:image/png;base64,","");$form.append('<input type="hidden" name="data" value="'+base64ImageData+'" />');$form.append('<input type="hidden" name="filename" value="'+fileName+'.png"/>');$("body").append($iframe);$iframe.contents().find("body").append($form);$form.submit();$form.remove()},getExportSizes:function getExportSizes(width,height){if(!width||!height){return undefined}return[{name:"High Resolution",value:"".concat(width,",").concat(height),help:"".concat(width*2,"px, ").concat(height*2,"px")}]}};return exportManager});define("mustache!templates/component",["lib/mustache"],function(mustache){var escapedTemplate='{{#annotation}}\n<div class="js-component-annotation component-annotation relative infoboxbgcolor singlepadding rounded singlemargin-bottom">\n{{#author.imagePath}}\n<img src="{{author.imagePath}}" title="{{author.name}}" class="floatleft avatar customtip"/>\n{{/author.imagePath}}\n<div class="db doublepadding-right component-annotation-content{{#author.imagePath}} hasauthor{{/author.imagePath}}">\n{{{annotation}}}\n{{#feedback}}\n<div class="singlepadding-top">{{{feedback}}}</div>\n{{/feedback}}\n</div>\n<div class="clearleft"></div>\n<span class="js-close-annotation icon-remove absright abstop singlepadding lightgrey customtip" title="Remove Explanation"></span>\n</div>\n{{/annotation}}\n<header class="componentHeader clearfix draggable">\n<h1 class="js-component-title componentHeader--section componentHeader--name draggable floatleft darkgrey textellipsis threecolmax dib\nsinglemargin-right bold floatleft {{^dashboardIsReadOnly}}customtip" data-at="component-header"\ntitle="{{titleTooltip}}{{/dashboardIsReadOnly}}">{{title}}</h1>\n{{#isBeta}}<span class="betaIcon"></span>{{/isBeta}}\n{{#isPrototype}}<span class="prototypeIcon"></span>{{/isPrototype}}\n<span class="utilsBarContainer"></span>\n<span class="optionsSummary floatleft">{{optionsSummary}}</span>\n<div class="temporary-notifications"></div>\n<div class="notifications"></div>\n</header>\n<aside class="clearright">\n<form class="controls"></form>\n</aside>\n<div class="content clearleft">\n{{#hasCommonCustomizeBar}}<header data-reactapp=\'common-customize-bar\'></header>{{/hasCommonCustomizeBar}}\n{{#hasCustomizeBar}}<header data-reactapp=\'customize-bar\'></header>{{/hasCustomizeBar}}\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!templates/componentOptionsSummary",["lib/mustache"],function(mustache){var escapedTemplate='{{#hasQueryName}}\n<div class="componentHeader--section query floatleft singlepadding-horizontal {{#queryIsReadOnly}}readonly{{/queryIsReadOnly}}">\n<span class="value db floatleft textellipsis threecolmax customtip" title="{{label}}: {{queryTooltip}}">{{queryName}}</span>\n</div>\n{{/hasQueryName}}\n<div class="componentHeader--section uhd-component-header floatleft smallpadding-horizontal hidden">\n<span class="value db floatleft"><img class="uhd-component-header__icon" src="/src/uhd/img/history-icon.svg"/></span>\n</div>\n<div class="componentHeader--section dateRange floatleft\n{{#hasTitleOrQueryName}}singlepadding-horizontal{{/hasTitleOrQueryName}}{{^hasTitleOrQueryName}}singlepadding-right{{/hasTitleOrQueryName}}\n{{#dateIsReadOnly}}readonly{{/dateIsReadOnly}}">\n<span class="value db floatleft {{#dateTooltip}} customtip {{/dateTooltip}}" title="{{dateTooltip}}">{{dateRange}}</span>\n</div>\n{{#hasSolrData}}<div class="componentHeader--section floatleft js-solr-indicator">&nbsp;</div>{{/hasSolrData}}\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define("markdown-it",[],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.markdownit=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";module.exports=require("entities/maps/entities.json")},{"entities/maps/entities.json":53}],2:[function(require,module,exports){"use strict";module.exports=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","meta","nav","noframes","ol","optgroup","option","p","param","pre","section","source","title","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"]},{}],3:[function(require,module,exports){"use strict";var attr_name="[a-zA-Z_:][a-zA-Z0-9:._-]*";var unquoted="[^\"'=<>`\\x00-\\x20]+";var single_quoted="'[^']*'";var double_quoted='"[^"]*"';var attr_value="(?:"+unquoted+"|"+single_quoted+"|"+double_quoted+")";var attribute="(?:\\s+"+attr_name+"(?:\\s*=\\s*"+attr_value+")?)";var open_tag="<[A-Za-z][A-Za-z0-9\\-]*"+attribute+"*\\s*\\/?>";var close_tag="<\\/[A-Za-z][A-Za-z0-9\\-]*\\s*>";var comment="\x3c!----\x3e|\x3c!--(?:-?[^>-])(?:-?[^-])*--\x3e";var processing="<[?].*?[?]>";var declaration="<![A-Z]+\\s+[^>]*>";var cdata="<!\\[CDATA\\[[\\s\\S]*?\\]\\]>";var HTML_TAG_RE=new RegExp("^(?:"+open_tag+"|"+close_tag+"|"+comment+"|"+processing+"|"+declaration+"|"+cdata+")");var HTML_OPEN_CLOSE_TAG_RE=new RegExp("^(?:"+open_tag+"|"+close_tag+")");module.exports.HTML_TAG_RE=HTML_TAG_RE;module.exports.HTML_OPEN_CLOSE_TAG_RE=HTML_OPEN_CLOSE_TAG_RE},{}],4:[function(require,module,exports){"use strict";function _class(obj){return Object.prototype.toString.call(obj)}function isString(obj){return _class(obj)==="[object String]"}var _hasOwnProperty=Object.prototype.hasOwnProperty;function has(object,key){return _hasOwnProperty.call(object,key)}function assign(obj){var sources=Array.prototype.slice.call(arguments,1);sources.forEach(function(source){if(!source){return}if(typeof source!=="object"){throw new TypeError(source+"must be object")}Object.keys(source).forEach(function(key){obj[key]=source[key]})});return obj}function arrayReplaceAt(src,pos,newElements){return[].concat(src.slice(0,pos),newElements,src.slice(pos+1))}function isValidEntityCode(c){if(c>=55296&&c<=57343){return false}if(c>=64976&&c<=65007){return false}if((c&65535)===65535||(c&65535)===65534){return false}if(c>=0&&c<=8){return false}if(c===11){return false}if(c>=14&&c<=31){return false}if(c>=127&&c<=159){return false}if(c>1114111){return false}return true}function fromCodePoint(c){if(c>65535){c-=65536;var surrogate1=55296+(c>>10),surrogate2=56320+(c&1023);return String.fromCharCode(surrogate1,surrogate2)}return String.fromCharCode(c)}var UNESCAPE_MD_RE=/\\([!"#$%&'()*+,\-.\/:;<=>?@[\\\]^_`{|}~])/g;var ENTITY_RE=/&([a-z#][a-z0-9]{1,31});/gi;var UNESCAPE_ALL_RE=new RegExp(UNESCAPE_MD_RE.source+"|"+ENTITY_RE.source,"gi");var DIGITAL_ENTITY_TEST_RE=/^#((?:x[a-f0-9]{1,8}|[0-9]{1,8}))/i;var entities=require("./entities");function replaceEntityPattern(match,name){var code=0;if(has(entities,name)){return entities[name]}if(name.charCodeAt(0)===35&&DIGITAL_ENTITY_TEST_RE.test(name)){code=name[1].toLowerCase()==="x"?parseInt(name.slice(2),16):parseInt(name.slice(1),10);if(isValidEntityCode(code)){return fromCodePoint(code)}}return match}function unescapeMd(str){if(str.indexOf("\\")<0){return str}return str.replace(UNESCAPE_MD_RE,"$1")}function unescapeAll(str){if(str.indexOf("\\")<0&&str.indexOf("&")<0){return str}return str.replace(UNESCAPE_ALL_RE,function(match,escaped,entity){if(escaped){return escaped}return replaceEntityPattern(match,entity)})}var HTML_ESCAPE_TEST_RE=/[&<>"]/;var HTML_ESCAPE_REPLACE_RE=/[&<>"]/g;var HTML_REPLACEMENTS={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};function replaceUnsafeChar(ch){return HTML_REPLACEMENTS[ch]}function escapeHtml(str){if(HTML_ESCAPE_TEST_RE.test(str)){return str.replace(HTML_ESCAPE_REPLACE_RE,replaceUnsafeChar)}return str}var REGEXP_ESCAPE_RE=/[.?*+^$[\]\\(){}|-]/g;function escapeRE(str){return str.replace(REGEXP_ESCAPE_RE,"\\$&")}function isSpace(code){switch(code){case 9:case 32:return true}return false}function isWhiteSpace(code){if(code>=8192&&code<=8202){return true}switch(code){case 9:case 10:case 11:case 12:case 13:case 32:case 160:case 5760:case 8239:case 8287:case 12288:return true}return false}var UNICODE_PUNCT_RE=require("uc.micro/categories/P/regex");function isPunctChar(ch){return UNICODE_PUNCT_RE.test(ch)}function isMdAsciiPunct(ch){switch(ch){case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:case 58:case 59:case 60:case 61:case 62:case 63:case 64:case 91:case 92:case 93:case 94:case 95:case 96:case 123:case 124:case 125:case 126:return true;default:return false}}function normalizeReference(str){return str.trim().replace(/\s+/g," ").toUpperCase()}exports.lib={};exports.lib.mdurl=require("mdurl");exports.lib.ucmicro=require("uc.micro");exports.assign=assign;exports.isString=isString;exports.has=has;exports.unescapeMd=unescapeMd;exports.unescapeAll=unescapeAll;exports.isValidEntityCode=isValidEntityCode;exports.fromCodePoint=fromCodePoint;exports.escapeHtml=escapeHtml;exports.arrayReplaceAt=arrayReplaceAt;exports.isSpace=isSpace;exports.isWhiteSpace=isWhiteSpace;exports.isMdAsciiPunct=isMdAsciiPunct;exports.isPunctChar=isPunctChar;exports.escapeRE=escapeRE;exports.normalizeReference=normalizeReference},{"./entities":1,mdurl:59,"uc.micro":65,"uc.micro/categories/P/regex":63}],5:[function(require,module,exports){"use strict";exports.parseLinkLabel=require("./parse_link_label");exports.parseLinkDestination=require("./parse_link_destination");exports.parseLinkTitle=require("./parse_link_title")},{"./parse_link_destination":6,"./parse_link_label":7,"./parse_link_title":8}],6:[function(require,module,exports){"use strict";var isSpace=require("../common/utils").isSpace;var unescapeAll=require("../common/utils").unescapeAll;module.exports=function parseLinkDestination(str,pos,max){var code,level,lines=0,start=pos,result={ok:false,pos:0,lines:0,str:""};if(str.charCodeAt(pos)===60){pos++;while(pos<max){code=str.charCodeAt(pos);if(code===10||isSpace(code)){return result}if(code===62){result.pos=pos+1;result.str=unescapeAll(str.slice(start+1,pos));result.ok=true;return result}if(code===92&&pos+1<max){pos+=2;continue}pos++}return result}level=0;while(pos<max){code=str.charCodeAt(pos);if(code===32){break}if(code<32||code===127){break}if(code===92&&pos+1<max){pos+=2;continue}if(code===40){level++;if(level>1){break}}if(code===41){level--;if(level<0){break}}pos++}if(start===pos){return result}result.str=unescapeAll(str.slice(start,pos));result.lines=lines;result.pos=pos;result.ok=true;return result}},{"../common/utils":4}],7:[function(require,module,exports){"use strict";module.exports=function parseLinkLabel(state,start,disableNested){var level,found,marker,prevPos,labelEnd=-1,max=state.posMax,oldPos=state.pos;state.pos=start+1;level=1;while(state.pos<max){marker=state.src.charCodeAt(state.pos);if(marker===93){level--;if(level===0){found=true;break}}prevPos=state.pos;state.md.inline.skipToken(state);if(marker===91){if(prevPos===state.pos-1){level++}else if(disableNested){state.pos=oldPos;return-1}}}if(found){labelEnd=state.pos}state.pos=oldPos;return labelEnd}},{}],8:[function(require,module,exports){"use strict";var unescapeAll=require("../common/utils").unescapeAll;module.exports=function parseLinkTitle(str,pos,max){var code,marker,lines=0,start=pos,result={ok:false,pos:0,lines:0,str:""};if(pos>=max){return result}marker=str.charCodeAt(pos);if(marker!==34&&marker!==39&&marker!==40){return result}pos++;if(marker===40){marker=41}while(pos<max){code=str.charCodeAt(pos);if(code===marker){result.pos=pos+1;result.lines=lines;result.str=unescapeAll(str.slice(start+1,pos));result.ok=true;return result}else if(code===10){lines++}else if(code===92&&pos+1<max){pos++;if(str.charCodeAt(pos)===10){lines++}}pos++}return result}},{"../common/utils":4}],9:[function(require,module,exports){"use strict";var utils=require("./common/utils");var helpers=require("./helpers");var Renderer=require("./renderer");var ParserCore=require("./parser_core");var ParserBlock=require("./parser_block");var ParserInline=require("./parser_inline");var LinkifyIt=require("linkify-it");var mdurl=require("mdurl");var punycode=require("punycode");var config={default:require("./presets/default"),zero:require("./presets/zero"),commonmark:require("./presets/commonmark")};var BAD_PROTO_RE=/^(vbscript|javascript|file|data):/;var GOOD_DATA_RE=/^data:image\/(gif|png|jpeg|webp);/;function validateLink(url){var str=url.trim().toLowerCase();return BAD_PROTO_RE.test(str)?GOOD_DATA_RE.test(str)?true:false:true}var RECODE_HOSTNAME_FOR=["http:","https:","mailto:"];function normalizeLink(url){var parsed=mdurl.parse(url,true);if(parsed.hostname){if(!parsed.protocol||RECODE_HOSTNAME_FOR.indexOf(parsed.protocol)>=0){try{parsed.hostname=punycode.toASCII(parsed.hostname)}catch(er){}}}return mdurl.encode(mdurl.format(parsed))}function normalizeLinkText(url){var parsed=mdurl.parse(url,true);if(parsed.hostname){if(!parsed.protocol||RECODE_HOSTNAME_FOR.indexOf(parsed.protocol)>=0){try{parsed.hostname=punycode.toUnicode(parsed.hostname)}catch(er){}}}return mdurl.decode(mdurl.format(parsed))}function MarkdownIt(presetName,options){if(!(this instanceof MarkdownIt)){return new MarkdownIt(presetName,options)}if(!options){if(!utils.isString(presetName)){options=presetName||{};presetName="default"}}this.inline=new ParserInline;this.block=new ParserBlock;this.core=new ParserCore;this.renderer=new Renderer;this.linkify=new LinkifyIt;this.validateLink=validateLink;this.normalizeLink=normalizeLink;this.normalizeLinkText=normalizeLinkText;this.utils=utils;this.helpers=helpers;this.options={};this.configure(presetName);if(options){this.set(options)}}MarkdownIt.prototype.set=function(options){utils.assign(this.options,options);return this};MarkdownIt.prototype.configure=function(presets){var self=this,presetName;if(utils.isString(presets)){presetName=presets;presets=config[presetName];if(!presets){throw new Error('Wrong `markdown-it` preset "'+presetName+'", check name')}}if(!presets){throw new Error("Wrong `markdown-it` preset, can't be empty")}if(presets.options){self.set(presets.options)}if(presets.components){Object.keys(presets.components).forEach(function(name){if(presets.components[name].rules){self[name].ruler.enableOnly(presets.components[name].rules)}if(presets.components[name].rules2){self[name].ruler2.enableOnly(presets.components[name].rules2)}})}return this};MarkdownIt.prototype.enable=function(list,ignoreInvalid){var result=[];if(!Array.isArray(list)){list=[list]}["core","block","inline"].forEach(function(chain){result=result.concat(this[chain].ruler.enable(list,true))},this);result=result.concat(this.inline.ruler2.enable(list,true));var missed=list.filter(function(name){return result.indexOf(name)<0});if(missed.length&&!ignoreInvalid){throw new Error("MarkdownIt. Failed to enable unknown rule(s): "+missed)}return this};MarkdownIt.prototype.disable=function(list,ignoreInvalid){var result=[];if(!Array.isArray(list)){list=[list]}["core","block","inline"].forEach(function(chain){result=result.concat(this[chain].ruler.disable(list,true))},this);result=result.concat(this.inline.ruler2.disable(list,true));var missed=list.filter(function(name){return result.indexOf(name)<0});if(missed.length&&!ignoreInvalid){throw new Error("MarkdownIt. Failed to disable unknown rule(s): "+missed)}return this};MarkdownIt.prototype.use=function(plugin){var args=[this].concat(Array.prototype.slice.call(arguments,1));plugin.apply(plugin,args);return this};MarkdownIt.prototype.parse=function(src,env){var state=new this.core.State(src,this,env);this.core.process(state);return state.tokens};MarkdownIt.prototype.render=function(src,env){env=env||{};return this.renderer.render(this.parse(src,env),this.options,env)};MarkdownIt.prototype.parseInline=function(src,env){var state=new this.core.State(src,this,env);state.inlineMode=true;this.core.process(state);return state.tokens};MarkdownIt.prototype.renderInline=function(src,env){env=env||{};return this.renderer.render(this.parseInline(src,env),this.options,env)};module.exports=MarkdownIt},{"./common/utils":4,"./helpers":5,"./parser_block":10,"./parser_core":11,"./parser_inline":12,"./presets/commonmark":13,"./presets/default":14,"./presets/zero":15,"./renderer":16,"linkify-it":54,mdurl:59,punycode:52}],10:[function(require,module,exports){"use strict";var Ruler=require("./ruler");var _rules=[["table",require("./rules_block/table"),["paragraph","reference"]],["code",require("./rules_block/code")],["fence",require("./rules_block/fence"),["paragraph","reference","blockquote","list"]],["blockquote",require("./rules_block/blockquote"),["paragraph","reference","list"]],["hr",require("./rules_block/hr"),["paragraph","reference","blockquote","list"]],["list",require("./rules_block/list"),["paragraph","reference","blockquote"]],["reference",require("./rules_block/reference")],["heading",require("./rules_block/heading"),["paragraph","reference","blockquote"]],["lheading",require("./rules_block/lheading")],["html_block",require("./rules_block/html_block"),["paragraph","reference","blockquote"]],["paragraph",require("./rules_block/paragraph")]];function ParserBlock(){this.ruler=new Ruler;for(var i=0;i<_rules.length;i++){this.ruler.push(_rules[i][0],_rules[i][1],{alt:(_rules[i][2]||[]).slice()})}}ParserBlock.prototype.tokenize=function(state,startLine,endLine){var ok,i,rules=this.ruler.getRules(""),len=rules.length,line=startLine,hasEmptyLines=false,maxNesting=state.md.options.maxNesting;while(line<endLine){state.line=line=state.skipEmptyLines(line);if(line>=endLine){break}if(state.sCount[line]<state.blkIndent){break}if(state.level>=maxNesting){state.line=endLine;break}for(i=0;i<len;i++){ok=rules[i](state,line,endLine,false);if(ok){break}}state.tight=!hasEmptyLines;if(state.isEmpty(state.line-1)){hasEmptyLines=true}line=state.line;if(line<endLine&&state.isEmpty(line)){hasEmptyLines=true;line++;if(line<endLine&&state.parentType==="list"&&state.isEmpty(line)){break}state.line=line}}};ParserBlock.prototype.parse=function(src,md,env,outTokens){var state;if(!src){return}state=new this.State(src,md,env,outTokens);this.tokenize(state,state.line,state.lineMax)};ParserBlock.prototype.State=require("./rules_block/state_block");module.exports=ParserBlock},{"./ruler":17,"./rules_block/blockquote":18,"./rules_block/code":19,"./rules_block/fence":20,"./rules_block/heading":21,"./rules_block/hr":22,"./rules_block/html_block":23,"./rules_block/lheading":24,"./rules_block/list":25,"./rules_block/paragraph":26,"./rules_block/reference":27,"./rules_block/state_block":28,"./rules_block/table":29}],11:[function(require,module,exports){"use strict";var Ruler=require("./ruler");var _rules=[["normalize",require("./rules_core/normalize")],["block",require("./rules_core/block")],["inline",require("./rules_core/inline")],["linkify",require("./rules_core/linkify")],["replacements",require("./rules_core/replacements")],["smartquotes",require("./rules_core/smartquotes")]];function Core(){this.ruler=new Ruler;for(var i=0;i<_rules.length;i++){this.ruler.push(_rules[i][0],_rules[i][1])}}Core.prototype.process=function(state){var i,l,rules;rules=this.ruler.getRules("");for(i=0,l=rules.length;i<l;i++){rules[i](state)}};Core.prototype.State=require("./rules_core/state_core");module.exports=Core},{"./ruler":17,"./rules_core/block":30,"./rules_core/inline":31,"./rules_core/linkify":32,"./rules_core/normalize":33,"./rules_core/replacements":34,"./rules_core/smartquotes":35,"./rules_core/state_core":36}],12:[function(require,module,exports){"use strict";var Ruler=require("./ruler");var _rules=[["text",require("./rules_inline/text")],["newline",require("./rules_inline/newline")],["escape",require("./rules_inline/escape")],["backticks",require("./rules_inline/backticks")],["strikethrough",require("./rules_inline/strikethrough").tokenize],["emphasis",require("./rules_inline/emphasis").tokenize],["link",require("./rules_inline/link")],["image",require("./rules_inline/image")],["autolink",require("./rules_inline/autolink")],["html_inline",require("./rules_inline/html_inline")],["entity",require("./rules_inline/entity")]];var _rules2=[["balance_pairs",require("./rules_inline/balance_pairs")],["strikethrough",require("./rules_inline/strikethrough").postProcess],["emphasis",require("./rules_inline/emphasis").postProcess],["text_collapse",require("./rules_inline/text_collapse")]];function ParserInline(){var i;this.ruler=new Ruler;for(i=0;i<_rules.length;i++){this.ruler.push(_rules[i][0],_rules[i][1])}this.ruler2=new Ruler;for(i=0;i<_rules2.length;i++){this.ruler2.push(_rules2[i][0],_rules2[i][1])}}ParserInline.prototype.skipToken=function(state){var ok,i,pos=state.pos,rules=this.ruler.getRules(""),len=rules.length,maxNesting=state.md.options.maxNesting,cache=state.cache;if(typeof cache[pos]!=="undefined"){state.pos=cache[pos];return}if(state.level<maxNesting){for(i=0;i<len;i++){state.level++;ok=rules[i](state,true);state.level--;if(ok){break}}}else{state.pos=state.posMax}if(!ok){state.pos++}cache[pos]=state.pos};ParserInline.prototype.tokenize=function(state){var ok,i,rules=this.ruler.getRules(""),len=rules.length,end=state.posMax,maxNesting=state.md.options.maxNesting;while(state.pos<end){if(state.level<maxNesting){for(i=0;i<len;i++){ok=rules[i](state,false);if(ok){break}}}if(ok){if(state.pos>=end){break}continue}state.pending+=state.src[state.pos++]}if(state.pending){state.pushPending()}};ParserInline.prototype.parse=function(str,md,env,outTokens){var i,rules,len;var state=new this.State(str,md,env,outTokens);this.tokenize(state);rules=this.ruler2.getRules("");len=rules.length;for(i=0;i<len;i++){rules[i](state)}};ParserInline.prototype.State=require("./rules_inline/state_inline");module.exports=ParserInline},{"./ruler":17,"./rules_inline/autolink":37,"./rules_inline/backticks":38,"./rules_inline/balance_pairs":39,"./rules_inline/emphasis":40,"./rules_inline/entity":41,"./rules_inline/escape":42,"./rules_inline/html_inline":43,"./rules_inline/image":44,"./rules_inline/link":45,"./rules_inline/newline":46,"./rules_inline/state_inline":47,"./rules_inline/strikethrough":48,"./rules_inline/text":49,"./rules_inline/text_collapse":50}],13:[function(require,module,exports){"use strict";module.exports={options:{html:true,xhtmlOut:true,breaks:false,langPrefix:"language-",linkify:false,typographer:false,quotes:"",highlight:null,maxNesting:20},components:{core:{rules:["normalize","block","inline"]},block:{rules:["blockquote","code","fence","heading","hr","html_block","lheading","list","reference","paragraph"]},inline:{rules:["autolink","backticks","emphasis","entity","escape","html_inline","image","link","newline","text"],rules2:["balance_pairs","emphasis","text_collapse"]}}}},{}],14:[function(require,module,exports){"use strict";module.exports={options:{html:false,xhtmlOut:false,breaks:false,langPrefix:"language-",linkify:false,typographer:false,quotes:"",highlight:null,maxNesting:100},components:{core:{},block:{},inline:{}}}},{}],15:[function(require,module,exports){"use strict";module.exports={options:{html:false,xhtmlOut:false,breaks:false,langPrefix:"language-",linkify:false,typographer:false,quotes:"",highlight:null,maxNesting:20},components:{core:{rules:["normalize","block","inline"]},block:{rules:["paragraph"]},inline:{rules:["text"],rules2:["balance_pairs","text_collapse"]}}}},{}],16:[function(require,module,exports){"use strict";var assign=require("./common/utils").assign;var unescapeAll=require("./common/utils").unescapeAll;var escapeHtml=require("./common/utils").escapeHtml;var default_rules={};default_rules.code_inline=function(tokens,idx){return"<code>"+escapeHtml(tokens[idx].content)+"</code>"};default_rules.code_block=function(tokens,idx){return"<pre><code>"+escapeHtml(tokens[idx].content)+"</code></pre>\n"};default_rules.fence=function(tokens,idx,options,env,slf){var token=tokens[idx],info=token.info?unescapeAll(token.info).trim():"",langName="",highlighted;if(info){langName=info.split(/\s+/g)[0];token.attrJoin("class",options.langPrefix+langName)}if(options.highlight){highlighted=options.highlight(token.content,langName)||escapeHtml(token.content)}else{highlighted=escapeHtml(token.content)}if(highlighted.indexOf("<pre")===0){return highlighted+"\n"}return"<pre><code"+slf.renderAttrs(token)+">"+highlighted+"</code></pre>\n"};default_rules.image=function(tokens,idx,options,env,slf){var token=tokens[idx];token.attrs[token.attrIndex("alt")][1]=slf.renderInlineAsText(token.children,options,env);return slf.renderToken(tokens,idx,options)};default_rules.hardbreak=function(tokens,idx,options){return options.xhtmlOut?"<br />\n":"<br>\n"};default_rules.softbreak=function(tokens,idx,options){return options.breaks?options.xhtmlOut?"<br />\n":"<br>\n":"\n"};default_rules.text=function(tokens,idx){return escapeHtml(tokens[idx].content)};default_rules.html_block=function(tokens,idx){return tokens[idx].content};default_rules.html_inline=function(tokens,idx){return tokens[idx].content};function Renderer(){this.rules=assign({},default_rules)}Renderer.prototype.renderAttrs=function renderAttrs(token){var i,l,result;if(!token.attrs){return""}result="";for(i=0,l=token.attrs.length;i<l;i++){result+=" "+escapeHtml(token.attrs[i][0])+'="'+escapeHtml(token.attrs[i][1])+'"'}return result};Renderer.prototype.renderToken=function renderToken(tokens,idx,options){var nextToken,result="",needLf=false,token=tokens[idx];if(token.hidden){return""}if(token.block&&token.nesting!==-1&&idx&&tokens[idx-1].hidden){result+="\n"}result+=(token.nesting===-1?"</":"<")+token.tag;result+=this.renderAttrs(token);if(token.nesting===0&&options.xhtmlOut){result+=" /"}if(token.block){needLf=true;if(token.nesting===1){if(idx+1<tokens.length){nextToken=tokens[idx+1];if(nextToken.type==="inline"||nextToken.hidden){needLf=false}else if(nextToken.nesting===-1&&nextToken.tag===token.tag){needLf=false}}}}result+=needLf?">\n":">";return result};Renderer.prototype.renderInline=function(tokens,options,env){var type,result="",rules=this.rules;for(var i=0,len=tokens.length;i<len;i++){type=tokens[i].type;if(typeof rules[type]!=="undefined"){result+=rules[type](tokens,i,options,env,this)}else{result+=this.renderToken(tokens,i,options)}}return result};Renderer.prototype.renderInlineAsText=function(tokens,options,env){var result="",rules=this.rules;for(var i=0,len=tokens.length;i<len;i++){if(tokens[i].type==="text"){result+=rules.text(tokens,i,options,env,this)}else if(tokens[i].type==="image"){result+=this.renderInlineAsText(tokens[i].children,options,env)}}return result};Renderer.prototype.render=function(tokens,options,env){var i,len,type,result="",rules=this.rules;for(i=0,len=tokens.length;i<len;i++){type=tokens[i].type;if(type==="inline"){result+=this.renderInline(tokens[i].children,options,env)}else if(typeof rules[type]!=="undefined"){result+=rules[tokens[i].type](tokens,i,options,env,this)}else{result+=this.renderToken(tokens,i,options,env)}}return result};module.exports=Renderer},{"./common/utils":4}],17:[function(require,module,exports){"use strict";function Ruler(){this.__rules__=[];this.__cache__=null}Ruler.prototype.__find__=function(name){for(var i=0;i<this.__rules__.length;i++){if(this.__rules__[i].name===name){return i}}return-1};Ruler.prototype.__compile__=function(){var self=this;var chains=[""];self.__rules__.forEach(function(rule){if(!rule.enabled){return}rule.alt.forEach(function(altName){if(chains.indexOf(altName)<0){chains.push(altName)}})});self.__cache__={};chains.forEach(function(chain){self.__cache__[chain]=[];self.__rules__.forEach(function(rule){if(!rule.enabled){return}if(chain&&rule.alt.indexOf(chain)<0){return}self.__cache__[chain].push(rule.fn)})})};Ruler.prototype.at=function(name,fn,options){var index=this.__find__(name);var opt=options||{};if(index===-1){throw new Error("Parser rule not found: "+name)}this.__rules__[index].fn=fn;this.__rules__[index].alt=opt.alt||[];this.__cache__=null};Ruler.prototype.before=function(beforeName,ruleName,fn,options){var index=this.__find__(beforeName);var opt=options||{};if(index===-1){throw new Error("Parser rule not found: "+beforeName)}this.__rules__.splice(index,0,{name:ruleName,enabled:true,fn:fn,alt:opt.alt||[]});this.__cache__=null};Ruler.prototype.after=function(afterName,ruleName,fn,options){var index=this.__find__(afterName);var opt=options||{};if(index===-1){throw new Error("Parser rule not found: "+afterName)}this.__rules__.splice(index+1,0,{name:ruleName,enabled:true,fn:fn,alt:opt.alt||[]});this.__cache__=null};Ruler.prototype.push=function(ruleName,fn,options){var opt=options||{};this.__rules__.push({name:ruleName,enabled:true,fn:fn,alt:opt.alt||[]});this.__cache__=null};Ruler.prototype.enable=function(list,ignoreInvalid){if(!Array.isArray(list)){list=[list]}var result=[];list.forEach(function(name){var idx=this.__find__(name);if(idx<0){if(ignoreInvalid){return}throw new Error("Rules manager: invalid rule name "+name)}this.__rules__[idx].enabled=true;result.push(name)},this);this.__cache__=null;return result};Ruler.prototype.enableOnly=function(list,ignoreInvalid){if(!Array.isArray(list)){list=[list]}this.__rules__.forEach(function(rule){rule.enabled=false});this.enable(list,ignoreInvalid)};Ruler.prototype.disable=function(list,ignoreInvalid){if(!Array.isArray(list)){list=[list]}var result=[];list.forEach(function(name){var idx=this.__find__(name);if(idx<0){if(ignoreInvalid){return}throw new Error("Rules manager: invalid rule name "+name)}this.__rules__[idx].enabled=false;result.push(name)},this);this.__cache__=null;return result};Ruler.prototype.getRules=function(chainName){if(this.__cache__===null){this.__compile__()}return this.__cache__[chainName]||[]};module.exports=Ruler},{}],18:[function(require,module,exports){"use strict";var isSpace=require("../common/utils").isSpace;module.exports=function blockquote(state,startLine,endLine,silent){var nextLine,lastLineEmpty,oldTShift,oldSCount,oldBMarks,oldIndent,oldParentType,lines,initial,offset,ch,terminatorRules,token,i,l,terminate,pos=state.bMarks[startLine]+state.tShift[startLine],max=state.eMarks[startLine];if(state.src.charCodeAt(pos++)!==62){return false}if(silent){return true}if(state.src.charCodeAt(pos)===32){pos++}oldIndent=state.blkIndent;state.blkIndent=0;initial=offset=state.sCount[startLine]+pos-(state.bMarks[startLine]+state.tShift[startLine]);oldBMarks=[state.bMarks[startLine]];state.bMarks[startLine]=pos;while(pos<max){ch=state.src.charCodeAt(pos);if(isSpace(ch)){if(ch===9){offset+=4-offset%4}else{offset++}}else{break}pos++}lastLineEmpty=pos>=max;oldSCount=[state.sCount[startLine]];state.sCount[startLine]=offset-initial;oldTShift=[state.tShift[startLine]];state.tShift[startLine]=pos-state.bMarks[startLine];terminatorRules=state.md.block.ruler.getRules("blockquote");for(nextLine=startLine+1;nextLine<endLine;nextLine++){if(state.sCount[nextLine]<oldIndent){break}pos=state.bMarks[nextLine]+state.tShift[nextLine];max=state.eMarks[nextLine];if(pos>=max){break}if(state.src.charCodeAt(pos++)===62){if(state.src.charCodeAt(pos)===32){pos++}initial=offset=state.sCount[nextLine]+pos-(state.bMarks[nextLine]+state.tShift[nextLine]);oldBMarks.push(state.bMarks[nextLine]);state.bMarks[nextLine]=pos;while(pos<max){ch=state.src.charCodeAt(pos);if(isSpace(ch)){if(ch===9){offset+=4-offset%4}else{offset++}}else{break}pos++}lastLineEmpty=pos>=max;oldSCount.push(state.sCount[nextLine]);state.sCount[nextLine]=offset-initial;oldTShift.push(state.tShift[nextLine]);state.tShift[nextLine]=pos-state.bMarks[nextLine];continue}if(lastLineEmpty){break}terminate=false;for(i=0,l=terminatorRules.length;i<l;i++){if(terminatorRules[i](state,nextLine,endLine,true)){terminate=true;break}}if(terminate){break}oldBMarks.push(state.bMarks[nextLine]);oldTShift.push(state.tShift[nextLine]);oldSCount.push(state.sCount[nextLine]);state.sCount[nextLine]=-1}oldParentType=state.parentType;state.parentType="blockquote";token=state.push("blockquote_open","blockquote",1);token.markup=">";token.map=lines=[startLine,0];state.md.block.tokenize(state,startLine,nextLine);token=state.push("blockquote_close","blockquote",-1);token.markup=">";state.parentType=oldParentType;lines[1]=state.line;for(i=0;i<oldTShift.length;i++){state.bMarks[i+startLine]=oldBMarks[i];state.tShift[i+startLine]=oldTShift[i];state.sCount[i+startLine]=oldSCount[i]}state.blkIndent=oldIndent;return true}},{"../common/utils":4}],19:[function(require,module,exports){"use strict";module.exports=function code(state,startLine,endLine){var nextLine,last,token,emptyLines=0;if(state.sCount[startLine]-state.blkIndent<4){return false}last=nextLine=startLine+1;while(nextLine<endLine){if(state.isEmpty(nextLine)){emptyLines++;if(emptyLines>=2&&state.parentType==="list"){break}nextLine++;continue}emptyLines=0;if(state.sCount[nextLine]-state.blkIndent>=4){nextLine++;last=nextLine;continue}break}state.line=last;token=state.push("code_block","code",0);token.content=state.getLines(startLine,last,4+state.blkIndent,true);token.map=[startLine,state.line];return true}},{}],20:[function(require,module,exports){"use strict";module.exports=function fence(state,startLine,endLine,silent){var marker,len,params,nextLine,mem,token,markup,haveEndMarker=false,pos=state.bMarks[startLine]+state.tShift[startLine],max=state.eMarks[startLine];if(pos+3>max){return false}marker=state.src.charCodeAt(pos);if(marker!==126&&marker!==96){return false}mem=pos;pos=state.skipChars(pos,marker);len=pos-mem;if(len<3){return false}markup=state.src.slice(mem,pos);params=state.src.slice(pos,max);if(params.indexOf("`")>=0){return false}if(silent){return true}nextLine=startLine;for(;;){nextLine++;if(nextLine>=endLine){break}pos=mem=state.bMarks[nextLine]+state.tShift[nextLine];max=state.eMarks[nextLine];if(pos<max&&state.sCount[nextLine]<state.blkIndent){break}if(state.src.charCodeAt(pos)!==marker){continue}if(state.sCount[nextLine]-state.blkIndent>=4){continue}pos=state.skipChars(pos,marker);if(pos-mem<len){continue}pos=state.skipSpaces(pos);if(pos<max){continue}haveEndMarker=true;break}len=state.sCount[startLine];state.line=nextLine+(haveEndMarker?1:0);token=state.push("fence","code",0);token.info=params;token.content=state.getLines(startLine+1,nextLine,len,true);token.markup=markup;token.map=[startLine,state.line];return true}},{}],21:[function(require,module,exports){"use strict";var isSpace=require("../common/utils").isSpace;module.exports=function heading(state,startLine,endLine,silent){var ch,level,tmp,token,pos=state.bMarks[startLine]+state.tShift[startLine],max=state.eMarks[startLine];ch=state.src.charCodeAt(pos);if(ch!==35||pos>=max){return false}level=1;ch=state.src.charCodeAt(++pos);while(ch===35&&pos<max&&level<=6){level++;ch=state.src.charCodeAt(++pos)}if(level>6||pos<max&&ch!==32){return false}if(silent){return true}max=state.skipSpacesBack(max,pos);tmp=state.skipCharsBack(max,35,pos);if(tmp>pos&&isSpace(state.src.charCodeAt(tmp-1))){max=tmp}state.line=startLine+1;token=state.push("heading_open","h"+String(level),1);token.markup="########".slice(0,level);token.map=[startLine,state.line];token=state.push("inline","",0);token.content=state.src.slice(pos,max).trim();token.map=[startLine,state.line];token.children=[];token=state.push("heading_close","h"+String(level),-1);token.markup="########".slice(0,level);return true}},{"../common/utils":4}],22:[function(require,module,exports){"use strict";var isSpace=require("../common/utils").isSpace;module.exports=function hr(state,startLine,endLine,silent){var marker,cnt,ch,token,pos=state.bMarks[startLine]+state.tShift[startLine],max=state.eMarks[startLine];marker=state.src.charCodeAt(pos++);if(marker!==42&&marker!==45&&marker!==95){return false}cnt=1;while(pos<max){ch=state.src.charCodeAt(pos++);if(ch!==marker&&!isSpace(ch)){return false}if(ch===marker){cnt++}}if(cnt<3){return false}if(silent){return true}state.line=startLine+1;token=state.push("hr","hr",0);token.map=[startLine,state.line];token.markup=Array(cnt+1).join(String.fromCharCode(marker));return true}},{"../common/utils":4}],23:[function(require,module,exports){"use strict";var block_names=require("../common/html_blocks");var HTML_OPEN_CLOSE_TAG_RE=require("../common/html_re").HTML_OPEN_CLOSE_TAG_RE;var HTML_SEQUENCES=[[/^<(script|pre|style)(?=(\s|>|$))/i,/<\/(script|pre|style)>/i,true],[/^<!--/,/-->/,true],[/^<\?/,/\?>/,true],[/^<![A-Z]/,/>/,true],[/^<!\[CDATA\[/,/\]\]>/,true],[new RegExp("^</?("+block_names.join("|")+")(?=(\\s|/?>|$))","i"),/^$/,true],[new RegExp(HTML_OPEN_CLOSE_TAG_RE.source+"\\s*$"),/^$/,false]];module.exports=function html_block(state,startLine,endLine,silent){var i,nextLine,token,lineText,pos=state.bMarks[startLine]+state.tShift[startLine],max=state.eMarks[startLine];if(!state.md.options.html){return false}if(state.src.charCodeAt(pos)!==60){return false}lineText=state.src.slice(pos,max);for(i=0;i<HTML_SEQUENCES.length;i++){if(HTML_SEQUENCES[i][0].test(lineText)){break}}if(i===HTML_SEQUENCES.length){return false}if(silent){return HTML_SEQUENCES[i][2]}nextLine=startLine+1;if(!HTML_SEQUENCES[i][1].test(lineText)){for(;nextLine<endLine;nextLine++){if(state.sCount[nextLine]<state.blkIndent){break}pos=state.bMarks[nextLine]+state.tShift[nextLine];max=state.eMarks[nextLine];lineText=state.src.slice(pos,max);if(HTML_SEQUENCES[i][1].test(lineText)){if(lineText.length!==0){nextLine++}break}}}state.line=nextLine;token=state.push("html_block","",0);token.map=[startLine,nextLine];token.content=state.getLines(startLine,nextLine,state.blkIndent,true);return true}},{"../common/html_blocks":2,"../common/html_re":3}],24:[function(require,module,exports){"use strict";module.exports=function lheading(state,startLine,endLine){var content,terminate,i,l,token,pos,max,level,marker,nextLine=startLine+1,terminatorRules=state.md.block.ruler.getRules("paragraph");for(;nextLine<endLine&&!state.isEmpty(nextLine);nextLine++){if(state.sCount[nextLine]-state.blkIndent>3){continue}if(state.sCount[nextLine]>=state.blkIndent){pos=state.bMarks[nextLine]+state.tShift[nextLine];max=state.eMarks[nextLine];if(pos<max){marker=state.src.charCodeAt(pos);if(marker===45||marker===61){pos=state.skipChars(pos,marker);pos=state.skipSpaces(pos);if(pos>=max){level=marker===61?1:2;break}}}}if(state.sCount[nextLine]<0){continue}terminate=false;for(i=0,l=terminatorRules.length;i<l;i++){if(terminatorRules[i](state,nextLine,endLine,true)){terminate=true;break}}if(terminate){break}}if(!level){return false}content=state.getLines(startLine,nextLine,state.blkIndent,false).trim();state.line=nextLine+1;token=state.push("heading_open","h"+String(level),1);token.markup=String.fromCharCode(marker);token.map=[startLine,state.line];token=state.push("inline","",0);token.content=content;token.map=[startLine,state.line-1];token.children=[];token=state.push("heading_close","h"+String(level),-1);token.markup=String.fromCharCode(marker);return true}},{}],25:[function(require,module,exports){"use strict";var isSpace=require("../common/utils").isSpace;function skipBulletListMarker(state,startLine){var marker,pos,max,ch;pos=state.bMarks[startLine]+state.tShift[startLine];max=state.eMarks[startLine];marker=state.src.charCodeAt(pos++);if(marker!==42&&marker!==45&&marker!==43){return-1}if(pos<max){ch=state.src.charCodeAt(pos);if(!isSpace(ch)){return-1}}return pos}function skipOrderedListMarker(state,startLine){var ch,start=state.bMarks[startLine]+state.tShift[startLine],pos=start,max=state.eMarks[startLine];if(pos+1>=max){return-1}ch=state.src.charCodeAt(pos++);if(ch<48||ch>57){return-1}for(;;){if(pos>=max){return-1}ch=state.src.charCodeAt(pos++);if(ch>=48&&ch<=57){if(pos-start>=10){return-1}continue}if(ch===41||ch===46){break}return-1}if(pos<max){ch=state.src.charCodeAt(pos);if(!isSpace(ch)){return-1}}return pos}function markTightParagraphs(state,idx){var i,l,level=state.level+2;for(i=idx+2,l=state.tokens.length-2;i<l;i++){if(state.tokens[i].level===level&&state.tokens[i].type==="paragraph_open"){state.tokens[i+2].hidden=true;state.tokens[i].hidden=true;i+=2}}}module.exports=function list(state,startLine,endLine,silent){var nextLine,initial,offset,indent,oldTShift,oldIndent,oldLIndent,oldTight,oldParentType,start,posAfterMarker,ch,pos,max,indentAfterMarker,markerValue,markerCharCode,isOrdered,contentStart,listTokIdx,prevEmptyEnd,listLines,itemLines,tight=true,terminatorRules,token,i,l,terminate;if((posAfterMarker=skipOrderedListMarker(state,startLine))>=0){isOrdered=true}else if((posAfterMarker=skipBulletListMarker(state,startLine))>=0){isOrdered=false}else{return false}markerCharCode=state.src.charCodeAt(posAfterMarker-1);if(silent){return true}listTokIdx=state.tokens.length;if(isOrdered){start=state.bMarks[startLine]+state.tShift[startLine];markerValue=Number(state.src.substr(start,posAfterMarker-start-1));token=state.push("ordered_list_open","ol",1);if(markerValue!==1){token.attrs=[["start",markerValue]]}}else{token=state.push("bullet_list_open","ul",1)}token.map=listLines=[startLine,0];token.markup=String.fromCharCode(markerCharCode);nextLine=startLine;prevEmptyEnd=false;terminatorRules=state.md.block.ruler.getRules("list");while(nextLine<endLine){pos=posAfterMarker;max=state.eMarks[nextLine];initial=offset=state.sCount[nextLine]+posAfterMarker-(state.bMarks[startLine]+state.tShift[startLine]);while(pos<max){ch=state.src.charCodeAt(pos);if(isSpace(ch)){if(ch===9){offset+=4-offset%4}else{offset++}}else{break}pos++}contentStart=pos;if(contentStart>=max){indentAfterMarker=1}else{indentAfterMarker=offset-initial}if(indentAfterMarker>4){indentAfterMarker=1}indent=initial+indentAfterMarker;token=state.push("list_item_open","li",1);token.markup=String.fromCharCode(markerCharCode);token.map=itemLines=[startLine,0];oldIndent=state.blkIndent;oldTight=state.tight;oldTShift=state.tShift[startLine];oldLIndent=state.sCount[startLine];oldParentType=state.parentType;state.blkIndent=indent;state.tight=true;state.parentType="list";state.tShift[startLine]=contentStart-state.bMarks[startLine];state.sCount[startLine]=offset;if(contentStart>=max&&state.isEmpty(startLine+1)){state.line=Math.min(state.line+2,endLine)}else{state.md.block.tokenize(state,startLine,endLine,true)}if(!state.tight||prevEmptyEnd){tight=false}prevEmptyEnd=state.line-startLine>1&&state.isEmpty(state.line-1);state.blkIndent=oldIndent;state.tShift[startLine]=oldTShift;state.sCount[startLine]=oldLIndent;state.tight=oldTight;state.parentType=oldParentType;token=state.push("list_item_close","li",-1);token.markup=String.fromCharCode(markerCharCode);nextLine=startLine=state.line;itemLines[1]=nextLine;contentStart=state.bMarks[startLine];if(nextLine>=endLine){break}if(state.isEmpty(nextLine)){break}if(state.sCount[nextLine]<state.blkIndent){break}terminate=false;for(i=0,l=terminatorRules.length;i<l;i++){if(terminatorRules[i](state,nextLine,endLine,true)){terminate=true;break}}if(terminate){break}if(isOrdered){posAfterMarker=skipOrderedListMarker(state,nextLine);if(posAfterMarker<0){break}}else{posAfterMarker=skipBulletListMarker(state,nextLine);if(posAfterMarker<0){break}}if(markerCharCode!==state.src.charCodeAt(posAfterMarker-1)){break}}if(isOrdered){token=state.push("ordered_list_close","ol",-1)}else{token=state.push("bullet_list_close","ul",-1)}token.markup=String.fromCharCode(markerCharCode);listLines[1]=nextLine;state.line=nextLine;if(tight){markTightParagraphs(state,listTokIdx)}return true}},{"../common/utils":4}],26:[function(require,module,exports){"use strict";module.exports=function paragraph(state,startLine){var content,terminate,i,l,token,nextLine=startLine+1,terminatorRules=state.md.block.ruler.getRules("paragraph"),endLine=state.lineMax;for(;nextLine<endLine&&!state.isEmpty(nextLine);nextLine++){if(state.sCount[nextLine]-state.blkIndent>3){continue}if(state.sCount[nextLine]<0){continue}terminate=false;for(i=0,l=terminatorRules.length;i<l;i++){if(terminatorRules[i](state,nextLine,endLine,true)){terminate=true;break}}if(terminate){break}}content=state.getLines(startLine,nextLine,state.blkIndent,false).trim();state.line=nextLine;token=state.push("paragraph_open","p",1);token.map=[startLine,state.line];token=state.push("inline","",0);token.content=content;token.map=[startLine,state.line];token.children=[];token=state.push("paragraph_close","p",-1);return true}},{}],27:[function(require,module,exports){"use strict";var parseLinkDestination=require("../helpers/parse_link_destination");var parseLinkTitle=require("../helpers/parse_link_title");var normalizeReference=require("../common/utils").normalizeReference;var isSpace=require("../common/utils").isSpace;module.exports=function reference(state,startLine,_endLine,silent){var ch,destEndPos,destEndLineNo,endLine,href,i,l,label,labelEnd,res,start,str,terminate,terminatorRules,title,lines=0,pos=state.bMarks[startLine]+state.tShift[startLine],max=state.eMarks[startLine],nextLine=startLine+1;if(state.src.charCodeAt(pos)!==91){return false}while(++pos<max){if(state.src.charCodeAt(pos)===93&&state.src.charCodeAt(pos-1)!==92){if(pos+1===max){return false}if(state.src.charCodeAt(pos+1)!==58){return false}break}}endLine=state.lineMax;terminatorRules=state.md.block.ruler.getRules("reference");for(;nextLine<endLine&&!state.isEmpty(nextLine);nextLine++){if(state.sCount[nextLine]-state.blkIndent>3){continue}if(state.sCount[nextLine]<0){continue}terminate=false;for(i=0,l=terminatorRules.length;i<l;i++){if(terminatorRules[i](state,nextLine,endLine,true)){terminate=true;break}}if(terminate){break}}str=state.getLines(startLine,nextLine,state.blkIndent,false).trim();max=str.length;for(pos=1;pos<max;pos++){ch=str.charCodeAt(pos);if(ch===91){return false}else if(ch===93){labelEnd=pos;break}else if(ch===10){lines++}else if(ch===92){pos++;if(pos<max&&str.charCodeAt(pos)===10){lines++}}}if(labelEnd<0||str.charCodeAt(labelEnd+1)!==58){return false}for(pos=labelEnd+2;pos<max;pos++){ch=str.charCodeAt(pos);if(ch===10){lines++}else if(isSpace(ch)){}else{break}}res=parseLinkDestination(str,pos,max);if(!res.ok){return false}href=state.md.normalizeLink(res.str);if(!state.md.validateLink(href)){return false}pos=res.pos;lines+=res.lines;destEndPos=pos;destEndLineNo=lines;start=pos;for(;pos<max;pos++){ch=str.charCodeAt(pos);if(ch===10){lines++}else if(isSpace(ch)){}else{break}}res=parseLinkTitle(str,pos,max);if(pos<max&&start!==pos&&res.ok){title=res.str;pos=res.pos;lines+=res.lines}else{title="";pos=destEndPos;lines=destEndLineNo}while(pos<max){ch=str.charCodeAt(pos);if(!isSpace(ch)){break}pos++}if(pos<max&&str.charCodeAt(pos)!==10){if(title){title="";pos=destEndPos;lines=destEndLineNo;while(pos<max){ch=str.charCodeAt(pos);if(!isSpace(ch)){break}pos++}}}if(pos<max&&str.charCodeAt(pos)!==10){return false}label=normalizeReference(str.slice(1,labelEnd));if(!label){return false}if(silent){return true}if(typeof state.env.references==="undefined"){state.env.references={}}if(typeof state.env.references[label]==="undefined"){state.env.references[label]={title:title,href:href}}state.line=startLine+lines+1;return true}},{"../common/utils":4,"../helpers/parse_link_destination":6,"../helpers/parse_link_title":8}],28:[function(require,module,exports){"use strict";var Token=require("../token");var isSpace=require("../common/utils").isSpace;function StateBlock(src,md,env,tokens){var ch,s,start,pos,len,indent,offset,indent_found;this.src=src;this.md=md;this.env=env;this.tokens=tokens;this.bMarks=[];this.eMarks=[];this.tShift=[];this.sCount=[];this.blkIndent=0;this.line=0;this.lineMax=0;this.tight=false;this.parentType="root";this.ddIndent=-1;this.level=0;this.result="";s=this.src;indent_found=false;for(start=pos=indent=offset=0,len=s.length;pos<len;pos++){ch=s.charCodeAt(pos);if(!indent_found){if(isSpace(ch)){indent++;if(ch===9){offset+=4-offset%4}else{offset++}continue}else{indent_found=true}}if(ch===10||pos===len-1){if(ch!==10){pos++}this.bMarks.push(start);this.eMarks.push(pos);this.tShift.push(indent);this.sCount.push(offset);indent_found=false;indent=0;offset=0;start=pos+1}}this.bMarks.push(s.length);this.eMarks.push(s.length);this.tShift.push(0);this.sCount.push(0);this.lineMax=this.bMarks.length-1}StateBlock.prototype.push=function(type,tag,nesting){var token=new Token(type,tag,nesting);token.block=true;if(nesting<0){this.level--}token.level=this.level;if(nesting>0){this.level++}this.tokens.push(token);return token};StateBlock.prototype.isEmpty=function isEmpty(line){return this.bMarks[line]+this.tShift[line]>=this.eMarks[line]};StateBlock.prototype.skipEmptyLines=function skipEmptyLines(from){for(var max=this.lineMax;from<max;from++){if(this.bMarks[from]+this.tShift[from]<this.eMarks[from]){break}}return from};StateBlock.prototype.skipSpaces=function skipSpaces(pos){var ch;for(var max=this.src.length;pos<max;pos++){ch=this.src.charCodeAt(pos);if(!isSpace(ch)){break}}return pos};StateBlock.prototype.skipSpacesBack=function skipSpacesBack(pos,min){if(pos<=min){return pos}while(pos>min){if(!isSpace(this.src.charCodeAt(--pos))){return pos+1}}return pos};StateBlock.prototype.skipChars=function skipChars(pos,code){for(var max=this.src.length;pos<max;pos++){if(this.src.charCodeAt(pos)!==code){break}}return pos};StateBlock.prototype.skipCharsBack=function skipCharsBack(pos,code,min){if(pos<=min){return pos}while(pos>min){if(code!==this.src.charCodeAt(--pos)){return pos+1}}return pos};StateBlock.prototype.getLines=function getLines(begin,end,indent,keepLastLF){var i,lineIndent,ch,first,last,queue,lineStart,line=begin;if(begin>=end){return""}queue=new Array(end-begin);for(i=0;line<end;line++,i++){lineIndent=0;lineStart=first=this.bMarks[line];if(line+1<end||keepLastLF){last=this.eMarks[line]+1}else{last=this.eMarks[line]}while(first<last&&lineIndent<indent){ch=this.src.charCodeAt(first);if(isSpace(ch)){if(ch===9){lineIndent+=4-lineIndent%4}else{lineIndent++}}else if(first-lineStart<this.tShift[line]){lineIndent++}else{break}first++}queue[i]=this.src.slice(first,last)}return queue.join("")};StateBlock.prototype.Token=Token;module.exports=StateBlock},{"../common/utils":4,"../token":51}],29:[function(require,module,exports){"use strict";function getLine(state,line){var pos=state.bMarks[line]+state.blkIndent,max=state.eMarks[line];return state.src.substr(pos,max-pos)}function escapedSplit(str){var result=[],pos=0,max=str.length,ch,escapes=0,lastPos=0,backTicked=false,lastBackTick=0;ch=str.charCodeAt(pos);while(pos<max){if(ch===96&&escapes%2===0){backTicked=!backTicked;lastBackTick=pos}else if(ch===124&&escapes%2===0&&!backTicked){result.push(str.substring(lastPos,pos));lastPos=pos+1}else if(ch===92){escapes++}else{escapes=0}pos++;if(pos===max&&backTicked){backTicked=false;pos=lastBackTick+1}ch=str.charCodeAt(pos)}result.push(str.substring(lastPos));return result}module.exports=function table(state,startLine,endLine,silent){var ch,lineText,pos,i,nextLine,columns,columnCount,token,aligns,t,tableLines,tbodyLines;if(startLine+2>endLine){return false}nextLine=startLine+1;if(state.sCount[nextLine]<state.blkIndent){return false}pos=state.bMarks[nextLine]+state.tShift[nextLine];if(pos>=state.eMarks[nextLine]){return false}ch=state.src.charCodeAt(pos);if(ch!==124&&ch!==45&&ch!==58){return false}lineText=getLine(state,startLine+1);if(!/^[-:| ]+$/.test(lineText)){return false}columns=lineText.split("|");aligns=[];for(i=0;i<columns.length;i++){t=columns[i].trim();if(!t){if(i===0||i===columns.length-1){continue}else{return false}}if(!/^:?-+:?$/.test(t)){return false}if(t.charCodeAt(t.length-1)===58){aligns.push(t.charCodeAt(0)===58?"center":"right")}else if(t.charCodeAt(0)===58){aligns.push("left")}else{aligns.push("")}}lineText=getLine(state,startLine).trim();if(lineText.indexOf("|")===-1){return false}columns=escapedSplit(lineText.replace(/^\||\|$/g,""));columnCount=columns.length;if(columnCount>aligns.length){return false}if(silent){return true}token=state.push("table_open","table",1);token.map=tableLines=[startLine,0];token=state.push("thead_open","thead",1);token.map=[startLine,startLine+1];token=state.push("tr_open","tr",1);token.map=[startLine,startLine+1];for(i=0;i<columns.length;i++){token=state.push("th_open","th",1);token.map=[startLine,startLine+1];if(aligns[i]){token.attrs=[["style","text-align:"+aligns[i]]]}token=state.push("inline","",0);token.content=columns[i].trim();token.map=[startLine,startLine+1];token.children=[];token=state.push("th_close","th",-1)}token=state.push("tr_close","tr",-1);token=state.push("thead_close","thead",-1);token=state.push("tbody_open","tbody",1);token.map=tbodyLines=[startLine+2,0];for(nextLine=startLine+2;nextLine<endLine;nextLine++){if(state.sCount[nextLine]<state.blkIndent){break}lineText=getLine(state,nextLine);if(lineText.indexOf("|")===-1){break}columns=escapedSplit(lineText.replace(/^\||\|\s*$/g,""));token=state.push("tr_open","tr",1);for(i=0;i<columnCount;i++){token=state.push("td_open","td",1);if(aligns[i]){token.attrs=[["style","text-align:"+aligns[i]]]}token=state.push("inline","",0);token.content=columns[i]?columns[i].trim():"";token.children=[];token=state.push("td_close","td",-1)}token=state.push("tr_close","tr",-1)}token=state.push("tbody_close","tbody",-1);token=state.push("table_close","table",-1);tableLines[1]=tbodyLines[1]=nextLine;state.line=nextLine;return true}},{}],30:[function(require,module,exports){"use strict";module.exports=function block(state){var token;if(state.inlineMode){token=new state.Token("inline","",0);token.content=state.src;token.map=[0,1];token.children=[];state.tokens.push(token)}else{state.md.block.parse(state.src,state.md,state.env,state.tokens)}}},{}],31:[function(require,module,exports){"use strict";module.exports=function inline(state){var tokens=state.tokens,tok,i,l;for(i=0,l=tokens.length;i<l;i++){tok=tokens[i];if(tok.type==="inline"){state.md.inline.parse(tok.content,state.md,state.env,tok.children)}}}},{}],32:[function(require,module,exports){"use strict";var arrayReplaceAt=require("../common/utils").arrayReplaceAt;function isLinkOpen(str){return/^<a[>\s]/i.test(str)}function isLinkClose(str){return/^<\/a\s*>/i.test(str)}module.exports=function linkify(state){var i,j,l,tokens,token,currentToken,nodes,ln,text,pos,lastPos,level,htmlLinkLevel,url,fullUrl,urlText,blockTokens=state.tokens,links;if(!state.md.options.linkify){return}for(j=0,l=blockTokens.length;j<l;j++){if(blockTokens[j].type!=="inline"||!state.md.linkify.pretest(blockTokens[j].content)){continue}tokens=blockTokens[j].children;htmlLinkLevel=0;for(i=tokens.length-1;i>=0;i--){currentToken=tokens[i];if(currentToken.type==="link_close"){i--;while(tokens[i].level!==currentToken.level&&tokens[i].type!=="link_open"){i--}continue}if(currentToken.type==="html_inline"){if(isLinkOpen(currentToken.content)&&htmlLinkLevel>0){htmlLinkLevel--}if(isLinkClose(currentToken.content)){htmlLinkLevel++}}if(htmlLinkLevel>0){continue}if(currentToken.type==="text"&&state.md.linkify.test(currentToken.content)){text=currentToken.content;links=state.md.linkify.match(text);nodes=[];level=currentToken.level;lastPos=0;for(ln=0;ln<links.length;ln++){url=links[ln].url;fullUrl=state.md.normalizeLink(url);if(!state.md.validateLink(fullUrl)){continue}urlText=links[ln].text;if(!links[ln].schema){urlText=state.md.normalizeLinkText("http://"+urlText).replace(/^http:\/\//,"")}else if(links[ln].schema==="mailto:"&&!/^mailto:/i.test(urlText)){urlText=state.md.normalizeLinkText("mailto:"+urlText).replace(/^mailto:/,"")}else{urlText=state.md.normalizeLinkText(urlText)}pos=links[ln].index;if(pos>lastPos){token=new state.Token("text","",0);token.content=text.slice(lastPos,pos);token.level=level;nodes.push(token)}token=new state.Token("link_open","a",1);token.attrs=[["href",fullUrl]];token.level=level++;token.markup="linkify";token.info="auto";nodes.push(token);token=new state.Token("text","",0);token.content=urlText;token.level=level;nodes.push(token);token=new state.Token("link_close","a",-1);token.level=--level;token.markup="linkify";token.info="auto";nodes.push(token);lastPos=links[ln].lastIndex}if(lastPos<text.length){token=new state.Token("text","",0);token.content=text.slice(lastPos);token.level=level;nodes.push(token)}blockTokens[j].children=tokens=arrayReplaceAt(tokens,i,nodes)}}}}},{"../common/utils":4}],33:[function(require,module,exports){"use strict";var NEWLINES_RE=/\r[\n\u0085]|[\u2424\u2028\u0085]/g;var NULL_RE=/\u0000/g;module.exports=function inline(state){var str;str=state.src.replace(NEWLINES_RE,"\n");str=str.replace(NULL_RE,"");state.src=str}},{}],34:[function(require,module,exports){"use strict";var RARE_RE=/\+-|\.\.|\?\?\?\?|!!!!|,,|--/;var SCOPED_ABBR_TEST_RE=/\((c|tm|r|p)\)/i;var SCOPED_ABBR_RE=/\((c|tm|r|p)\)/gi;var SCOPED_ABBR={c:"",r:"",p:"",tm:""};function replaceFn(match,name){return SCOPED_ABBR[name.toLowerCase()]}function replace_scoped(inlineTokens){var i,token;for(i=inlineTokens.length-1;i>=0;i--){token=inlineTokens[i];if(token.type==="text"){token.content=token.content.replace(SCOPED_ABBR_RE,replaceFn)}}}function replace_rare(inlineTokens){var i,token;for(i=inlineTokens.length-1;i>=0;i--){token=inlineTokens[i];if(token.type==="text"){if(RARE_RE.test(token.content)){token.content=token.content.replace(/\+-/g,"").replace(/\.{2,}/g,"").replace(/([?!])/g,"$1..").replace(/([?!]){4,}/g,"$1$1$1").replace(/,{2,}/g,",").replace(/(^|[^-])---([^-]|$)/gm,"$1$2").replace(/(^|\s)--(\s|$)/gm,"$1$2").replace(/(^|[^-\s])--([^-\s]|$)/gm,"$1$2")}}}}module.exports=function replace(state){var blkIdx;if(!state.md.options.typographer){return}for(blkIdx=state.tokens.length-1;blkIdx>=0;blkIdx--){if(state.tokens[blkIdx].type!=="inline"){continue}if(SCOPED_ABBR_TEST_RE.test(state.tokens[blkIdx].content)){replace_scoped(state.tokens[blkIdx].children)}if(RARE_RE.test(state.tokens[blkIdx].content)){replace_rare(state.tokens[blkIdx].children)}}}},{}],35:[function(require,module,exports){"use strict";var isWhiteSpace=require("../common/utils").isWhiteSpace;var isPunctChar=require("../common/utils").isPunctChar;var isMdAsciiPunct=require("../common/utils").isMdAsciiPunct;var QUOTE_TEST_RE=/['"]/;var QUOTE_RE=/['"]/g;var APOSTROPHE="";function replaceAt(str,index,ch){return str.substr(0,index)+ch+str.substr(index+1)}function process_inlines(tokens,state){var i,token,text,t,pos,max,thisLevel,item,lastChar,nextChar,isLastPunctChar,isNextPunctChar,isLastWhiteSpace,isNextWhiteSpace,canOpen,canClose,j,isSingle,stack,openQuote,closeQuote;stack=[];for(i=0;i<tokens.length;i++){token=tokens[i];thisLevel=tokens[i].level;for(j=stack.length-1;j>=0;j--){if(stack[j].level<=thisLevel){break}}stack.length=j+1;if(token.type!=="text"){continue}text=token.content;pos=0;max=text.length;OUTER:while(pos<max){QUOTE_RE.lastIndex=pos;t=QUOTE_RE.exec(text);if(!t){break}canOpen=canClose=true;pos=t.index+1;isSingle=t[0]==="'";lastChar=32;if(t.index-1>=0){lastChar=text.charCodeAt(t.index-1)}else{for(j=i-1;j>=0;j--){if(tokens[j].type!=="text"){continue}lastChar=tokens[j].content.charCodeAt(tokens[j].content.length-1);break}}nextChar=32;if(pos<max){nextChar=text.charCodeAt(pos)}else{for(j=i+1;j<tokens.length;j++){if(tokens[j].type!=="text"){continue}nextChar=tokens[j].content.charCodeAt(0);break}}isLastPunctChar=isMdAsciiPunct(lastChar)||isPunctChar(String.fromCharCode(lastChar));isNextPunctChar=isMdAsciiPunct(nextChar)||isPunctChar(String.fromCharCode(nextChar));isLastWhiteSpace=isWhiteSpace(lastChar);isNextWhiteSpace=isWhiteSpace(nextChar);if(isNextWhiteSpace){canOpen=false}else if(isNextPunctChar){if(!(isLastWhiteSpace||isLastPunctChar)){canOpen=false}}if(isLastWhiteSpace){canClose=false}else if(isLastPunctChar){if(!(isNextWhiteSpace||isNextPunctChar)){canClose=false}}if(nextChar===34&&t[0]==='"'){if(lastChar>=48&&lastChar<=57){canClose=canOpen=false}}if(canOpen&&canClose){canOpen=false;canClose=isNextPunctChar}if(!canOpen&&!canClose){if(isSingle){token.content=replaceAt(token.content,t.index,APOSTROPHE)}continue}if(canClose){for(j=stack.length-1;j>=0;j--){item=stack[j];if(stack[j].level<thisLevel){break}if(item.single===isSingle&&stack[j].level===thisLevel){item=stack[j];if(isSingle){openQuote=state.md.options.quotes[2];closeQuote=state.md.options.quotes[3]}else{openQuote=state.md.options.quotes[0];closeQuote=state.md.options.quotes[1]}token.content=replaceAt(token.content,t.index,closeQuote);tokens[item.token].content=replaceAt(tokens[item.token].content,item.pos,openQuote);pos+=closeQuote.length-1;if(item.token===i){pos+=openQuote.length-1}text=token.content;max=text.length;stack.length=j;continue OUTER}}}if(canOpen){stack.push({token:i,pos:t.index,single:isSingle,level:thisLevel})}else if(canClose&&isSingle){token.content=replaceAt(token.content,t.index,APOSTROPHE)}}}}module.exports=function smartquotes(state){var blkIdx;if(!state.md.options.typographer){return}for(blkIdx=state.tokens.length-1;blkIdx>=0;blkIdx--){if(state.tokens[blkIdx].type!=="inline"||!QUOTE_TEST_RE.test(state.tokens[blkIdx].content)){continue}process_inlines(state.tokens[blkIdx].children,state)}}},{"../common/utils":4}],36:[function(require,module,exports){"use strict";var Token=require("../token");function StateCore(src,md,env){this.src=src;this.env=env;this.tokens=[];this.inlineMode=false;this.md=md}StateCore.prototype.Token=Token;module.exports=StateCore},{"../token":51}],37:[function(require,module,exports){"use strict";var EMAIL_RE=/^<([a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*)>/;var AUTOLINK_RE=/^<([a-zA-Z][a-zA-Z0-9+.\-]{1,31}):([^<>\x00-\x20]*)>/;module.exports=function autolink(state,silent){var tail,linkMatch,emailMatch,url,fullUrl,token,pos=state.pos;if(state.src.charCodeAt(pos)!==60){return false}tail=state.src.slice(pos);if(tail.indexOf(">")<0){return false}if(AUTOLINK_RE.test(tail)){linkMatch=tail.match(AUTOLINK_RE);url=linkMatch[0].slice(1,-1);fullUrl=state.md.normalizeLink(url);if(!state.md.validateLink(fullUrl)){return false}if(!silent){token=state.push("link_open","a",1);token.attrs=[["href",fullUrl]];token.markup="autolink";token.info="auto";token=state.push("text","",0);token.content=state.md.normalizeLinkText(url);token=state.push("link_close","a",-1);token.markup="autolink";token.info="auto"}state.pos+=linkMatch[0].length;return true}if(EMAIL_RE.test(tail)){emailMatch=tail.match(EMAIL_RE);url=emailMatch[0].slice(1,-1);fullUrl=state.md.normalizeLink("mailto:"+url);if(!state.md.validateLink(fullUrl)){return false}if(!silent){token=state.push("link_open","a",1);token.attrs=[["href",fullUrl]];token.markup="autolink";token.info="auto";token=state.push("text","",0);token.content=state.md.normalizeLinkText(url);token=state.push("link_close","a",-1);token.markup="autolink";token.info="auto"}state.pos+=emailMatch[0].length;return true}return false}},{}],38:[function(require,module,exports){"use strict";module.exports=function backtick(state,silent){var start,max,marker,matchStart,matchEnd,token,pos=state.pos,ch=state.src.charCodeAt(pos);if(ch!==96){return false}start=pos;pos++;max=state.posMax;while(pos<max&&state.src.charCodeAt(pos)===96){pos++}marker=state.src.slice(start,pos);matchStart=matchEnd=pos;while((matchStart=state.src.indexOf("`",matchEnd))!==-1){matchEnd=matchStart+1;while(matchEnd<max&&state.src.charCodeAt(matchEnd)===96){matchEnd++}if(matchEnd-matchStart===marker.length){if(!silent){token=state.push("code_inline","code",0);token.markup=marker;token.content=state.src.slice(pos,matchStart).replace(/[ \n]+/g," ").trim()}state.pos=matchEnd;return true}}if(!silent){state.pending+=marker}state.pos+=marker.length;return true}},{}],39:[function(require,module,exports){"use strict";module.exports=function link_pairs(state){var i,j,lastDelim,currDelim,delimiters=state.delimiters,max=state.delimiters.length;for(i=0;i<max;i++){lastDelim=delimiters[i];if(!lastDelim.close){continue}j=i-lastDelim.jump-1;while(j>=0){currDelim=delimiters[j];if(currDelim.open&&currDelim.marker===lastDelim.marker&&currDelim.end<0&&currDelim.level===lastDelim.level){lastDelim.jump=i-j;lastDelim.open=false;currDelim.end=i;currDelim.jump=0;break}j-=currDelim.jump+1}}}},{}],40:[function(require,module,exports){"use strict";module.exports.tokenize=function emphasis(state,silent){var i,scanned,token,start=state.pos,marker=state.src.charCodeAt(start);if(silent){return false}if(marker!==95&&marker!==42){return false}scanned=state.scanDelims(state.pos,marker===42);for(i=0;i<scanned.length;i++){token=state.push("text","",0);token.content=String.fromCharCode(marker);state.delimiters.push({marker:marker,jump:i,token:state.tokens.length-1,level:state.level,end:-1,open:scanned.can_open,close:scanned.can_close})}state.pos+=scanned.length;return true};module.exports.postProcess=function emphasis(state){var i,startDelim,endDelim,token,ch,isStrong,delimiters=state.delimiters,max=state.delimiters.length;for(i=0;i<max;i++){startDelim=delimiters[i];if(startDelim.marker!==95&&startDelim.marker!==42){continue}if(startDelim.end===-1){continue}endDelim=delimiters[startDelim.end];isStrong=i+1<max&&delimiters[i+1].end===startDelim.end-1&&delimiters[i+1].token===startDelim.token+1&&delimiters[startDelim.end-1].token===endDelim.token-1&&delimiters[i+1].marker===startDelim.marker;ch=String.fromCharCode(startDelim.marker);token=state.tokens[startDelim.token];token.type=isStrong?"strong_open":"em_open";token.tag=isStrong?"strong":"em";token.nesting=1;token.markup=isStrong?ch+ch:ch;token.content="";token=state.tokens[endDelim.token];token.type=isStrong?"strong_close":"em_close";token.tag=isStrong?"strong":"em";token.nesting=-1;token.markup=isStrong?ch+ch:ch;token.content="";if(isStrong){state.tokens[delimiters[i+1].token].content="";state.tokens[delimiters[startDelim.end-1].token].content="";i++}}}},{}],41:[function(require,module,exports){"use strict";var entities=require("../common/entities");var has=require("../common/utils").has;var isValidEntityCode=require("../common/utils").isValidEntityCode;var fromCodePoint=require("../common/utils").fromCodePoint;var DIGITAL_RE=/^&#((?:x[a-f0-9]{1,8}|[0-9]{1,8}));/i;var NAMED_RE=/^&([a-z][a-z0-9]{1,31});/i;module.exports=function entity(state,silent){var ch,code,match,pos=state.pos,max=state.posMax;if(state.src.charCodeAt(pos)!==38){return false}if(pos+1<max){ch=state.src.charCodeAt(pos+1);if(ch===35){match=state.src.slice(pos).match(DIGITAL_RE);if(match){if(!silent){code=match[1][0].toLowerCase()==="x"?parseInt(match[1].slice(1),16):parseInt(match[1],10);state.pending+=isValidEntityCode(code)?fromCodePoint(code):fromCodePoint(65533)}state.pos+=match[0].length;return true}}else{match=state.src.slice(pos).match(NAMED_RE);if(match){if(has(entities,match[1])){if(!silent){state.pending+=entities[match[1]]}state.pos+=match[0].length;return true}}}}if(!silent){state.pending+="&"}state.pos++;return true}},{"../common/entities":1,"../common/utils":4}],42:[function(require,module,exports){"use strict";var isSpace=require("../common/utils").isSpace;var ESCAPED=[];for(var i=0;i<256;i++){ESCAPED.push(0)}"\\!\"#$%&'()*+,./:;<=>?@[]^_`{|}~-".split("").forEach(function(ch){ESCAPED[ch.charCodeAt(0)]=1});module.exports=function escape(state,silent){var ch,pos=state.pos,max=state.posMax;if(state.src.charCodeAt(pos)!==92){return false}pos++;if(pos<max){ch=state.src.charCodeAt(pos);if(ch<256&&ESCAPED[ch]!==0){if(!silent){state.pending+=state.src[pos]}state.pos+=2;return true}if(ch===10){if(!silent){state.push("hardbreak","br",0)}pos++;while(pos<max){ch=state.src.charCodeAt(pos);if(!isSpace(ch)){break}pos++}state.pos=pos;return true}}if(!silent){state.pending+="\\"}state.pos++;return true}},{"../common/utils":4}],43:[function(require,module,exports){"use strict";var HTML_TAG_RE=require("../common/html_re").HTML_TAG_RE;function isLetter(ch){var lc=ch|32;return lc>=97&&lc<=122}module.exports=function html_inline(state,silent){var ch,match,max,token,pos=state.pos;if(!state.md.options.html){return false}max=state.posMax;if(state.src.charCodeAt(pos)!==60||pos+2>=max){return false}ch=state.src.charCodeAt(pos+1);if(ch!==33&&ch!==63&&ch!==47&&!isLetter(ch)){return false}match=state.src.slice(pos).match(HTML_TAG_RE);if(!match){return false}if(!silent){token=state.push("html_inline","",0);token.content=state.src.slice(pos,pos+match[0].length)}state.pos+=match[0].length;return true}},{"../common/html_re":3}],44:[function(require,module,exports){"use strict";var parseLinkLabel=require("../helpers/parse_link_label");var parseLinkDestination=require("../helpers/parse_link_destination");var parseLinkTitle=require("../helpers/parse_link_title");var normalizeReference=require("../common/utils").normalizeReference;var isSpace=require("../common/utils").isSpace;module.exports=function image(state,silent){var attrs,code,content,label,labelEnd,labelStart,pos,ref,res,title,token,tokens,start,href="",oldPos=state.pos,max=state.posMax;if(state.src.charCodeAt(state.pos)!==33){return false}if(state.src.charCodeAt(state.pos+1)!==91){return false}labelStart=state.pos+2;labelEnd=parseLinkLabel(state,state.pos+1,false);if(labelEnd<0){return false}pos=labelEnd+1;if(pos<max&&state.src.charCodeAt(pos)===40){pos++;for(;pos<max;pos++){code=state.src.charCodeAt(pos);if(!isSpace(code)&&code!==10){break}}if(pos>=max){return false}start=pos;res=parseLinkDestination(state.src,pos,state.posMax);if(res.ok){href=state.md.normalizeLink(res.str);if(state.md.validateLink(href)){pos=res.pos}else{href=""}}start=pos;for(;pos<max;pos++){code=state.src.charCodeAt(pos);if(!isSpace(code)&&code!==10){break}}res=parseLinkTitle(state.src,pos,state.posMax);if(pos<max&&start!==pos&&res.ok){title=res.str;pos=res.pos;for(;pos<max;pos++){code=state.src.charCodeAt(pos);if(!isSpace(code)&&code!==10){break}}}else{title=""}if(pos>=max||state.src.charCodeAt(pos)!==41){state.pos=oldPos;return false}pos++}else{if(typeof state.env.references==="undefined"){return false}if(pos<max&&state.src.charCodeAt(pos)===91){start=pos+1;pos=parseLinkLabel(state,pos);if(pos>=0){label=state.src.slice(start,pos++)}else{pos=labelEnd+1}}else{pos=labelEnd+1}if(!label){label=state.src.slice(labelStart,labelEnd)}ref=state.env.references[normalizeReference(label)];if(!ref){state.pos=oldPos;return false}href=ref.href;title=ref.title}if(!silent){content=state.src.slice(labelStart,labelEnd);state.md.inline.parse(content,state.md,state.env,tokens=[]);token=state.push("image","img",0);token.attrs=attrs=[["src",href],["alt",""]];token.children=tokens;token.content=content;if(title){attrs.push(["title",title])}}state.pos=pos;state.posMax=max;return true}},{"../common/utils":4,"../helpers/parse_link_destination":6,"../helpers/parse_link_label":7,"../helpers/parse_link_title":8}],45:[function(require,module,exports){"use strict";var parseLinkLabel=require("../helpers/parse_link_label");var parseLinkDestination=require("../helpers/parse_link_destination");var parseLinkTitle=require("../helpers/parse_link_title");var normalizeReference=require("../common/utils").normalizeReference;var isSpace=require("../common/utils").isSpace;module.exports=function link(state,silent){var attrs,code,label,labelEnd,labelStart,pos,res,ref,title,token,href="",oldPos=state.pos,max=state.posMax,start=state.pos;if(state.src.charCodeAt(state.pos)!==91){return false}labelStart=state.pos+1;labelEnd=parseLinkLabel(state,state.pos,true);if(labelEnd<0){return false}pos=labelEnd+1;if(pos<max&&state.src.charCodeAt(pos)===40){pos++;for(;pos<max;pos++){code=state.src.charCodeAt(pos);if(!isSpace(code)&&code!==10){break}}if(pos>=max){return false}start=pos;res=parseLinkDestination(state.src,pos,state.posMax);if(res.ok){href=state.md.normalizeLink(res.str);if(state.md.validateLink(href)){pos=res.pos}else{href=""}}start=pos;for(;pos<max;pos++){code=state.src.charCodeAt(pos);if(!isSpace(code)&&code!==10){break}}res=parseLinkTitle(state.src,pos,state.posMax);if(pos<max&&start!==pos&&res.ok){title=res.str;pos=res.pos;for(;pos<max;pos++){code=state.src.charCodeAt(pos);if(!isSpace(code)&&code!==10){break}}}else{title=""}if(pos>=max||state.src.charCodeAt(pos)!==41){state.pos=oldPos;return false}pos++}else{if(typeof state.env.references==="undefined"){return false}if(pos<max&&state.src.charCodeAt(pos)===91){start=pos+1;pos=parseLinkLabel(state,pos);if(pos>=0){label=state.src.slice(start,pos++)}else{pos=labelEnd+1}}else{pos=labelEnd+1}if(!label){label=state.src.slice(labelStart,labelEnd)}ref=state.env.references[normalizeReference(label)];if(!ref){state.pos=oldPos;return false}href=ref.href;title=ref.title}if(!silent){state.pos=labelStart;state.posMax=labelEnd;token=state.push("link_open","a",1);token.attrs=attrs=[["href",href]];if(title){attrs.push(["title",title])}state.md.inline.tokenize(state);token=state.push("link_close","a",-1)}state.pos=pos;state.posMax=max;return true}},{"../common/utils":4,"../helpers/parse_link_destination":6,"../helpers/parse_link_label":7,"../helpers/parse_link_title":8}],46:[function(require,module,exports){"use strict";module.exports=function newline(state,silent){var pmax,max,pos=state.pos;if(state.src.charCodeAt(pos)!==10){return false}pmax=state.pending.length-1;max=state.posMax;if(!silent){if(pmax>=0&&state.pending.charCodeAt(pmax)===32){if(pmax>=1&&state.pending.charCodeAt(pmax-1)===32){state.pending=state.pending.replace(/ +$/,"");state.push("hardbreak","br",0)}else{state.pending=state.pending.slice(0,-1);state.push("softbreak","br",0)}}else{state.push("softbreak","br",0)}}pos++;while(pos<max&&state.src.charCodeAt(pos)===32){pos++}state.pos=pos;return true}},{}],47:[function(require,module,exports){"use strict";var Token=require("../token");var isWhiteSpace=require("../common/utils").isWhiteSpace;var isPunctChar=require("../common/utils").isPunctChar;var isMdAsciiPunct=require("../common/utils").isMdAsciiPunct;function StateInline(src,md,env,outTokens){this.src=src;this.env=env;this.md=md;this.tokens=outTokens;this.pos=0;this.posMax=this.src.length;this.level=0;this.pending="";this.pendingLevel=0;this.cache={};this.delimiters=[]}StateInline.prototype.pushPending=function(){var token=new Token("text","",0);token.content=this.pending;token.level=this.pendingLevel;this.tokens.push(token);this.pending="";return token};StateInline.prototype.push=function(type,tag,nesting){if(this.pending){this.pushPending()}var token=new Token(type,tag,nesting);if(nesting<0){this.level--}token.level=this.level;if(nesting>0){this.level++}this.pendingLevel=this.level;this.tokens.push(token);return token};StateInline.prototype.scanDelims=function(start,canSplitWord){var pos=start,lastChar,nextChar,count,can_open,can_close,isLastWhiteSpace,isLastPunctChar,isNextWhiteSpace,isNextPunctChar,left_flanking=true,right_flanking=true,max=this.posMax,marker=this.src.charCodeAt(start);lastChar=start>0?this.src.charCodeAt(start-1):32;while(pos<max&&this.src.charCodeAt(pos)===marker){pos++}count=pos-start;nextChar=pos<max?this.src.charCodeAt(pos):32;isLastPunctChar=isMdAsciiPunct(lastChar)||isPunctChar(String.fromCharCode(lastChar));isNextPunctChar=isMdAsciiPunct(nextChar)||isPunctChar(String.fromCharCode(nextChar));isLastWhiteSpace=isWhiteSpace(lastChar);isNextWhiteSpace=isWhiteSpace(nextChar);if(isNextWhiteSpace){left_flanking=false}else if(isNextPunctChar){if(!(isLastWhiteSpace||isLastPunctChar)){left_flanking=false}}if(isLastWhiteSpace){right_flanking=false}else if(isLastPunctChar){if(!(isNextWhiteSpace||isNextPunctChar)){right_flanking=false}}if(!canSplitWord){can_open=left_flanking&&(!right_flanking||isLastPunctChar);can_close=right_flanking&&(!left_flanking||isNextPunctChar)}else{can_open=left_flanking;can_close=right_flanking}return{can_open:can_open,can_close:can_close,length:count}};StateInline.prototype.Token=Token;module.exports=StateInline},{"../common/utils":4,"../token":51}],48:[function(require,module,exports){"use strict";module.exports.tokenize=function strikethrough(state,silent){var i,scanned,token,len,ch,start=state.pos,marker=state.src.charCodeAt(start);if(silent){return false}if(marker!==126){return false}scanned=state.scanDelims(state.pos,true);len=scanned.length;ch=String.fromCharCode(marker);if(len<2){return false}if(len%2){token=state.push("text","",0);token.content=ch;len--}for(i=0;i<len;i+=2){token=state.push("text","",0);token.content=ch+ch;state.delimiters.push({marker:marker,jump:i,token:state.tokens.length-1,level:state.level,end:-1,open:scanned.can_open,close:scanned.can_close})}state.pos+=scanned.length;return true};module.exports.postProcess=function strikethrough(state){var i,j,startDelim,endDelim,token,loneMarkers=[],delimiters=state.delimiters,max=state.delimiters.length;for(i=0;i<max;i++){startDelim=delimiters[i];if(startDelim.marker!==126){continue}if(startDelim.end===-1){continue}endDelim=delimiters[startDelim.end];token=state.tokens[startDelim.token];token.type="s_open";token.tag="s";token.nesting=1;token.markup="~~";token.content="";token=state.tokens[endDelim.token];token.type="s_close";token.tag="s";token.nesting=-1;token.markup="~~";token.content="";if(state.tokens[endDelim.token-1].type==="text"&&state.tokens[endDelim.token-1].content==="~"){loneMarkers.push(endDelim.token-1)}}while(loneMarkers.length){i=loneMarkers.pop();j=i+1;while(j<state.tokens.length&&state.tokens[j].type==="s_close"){j++}j--;if(i!==j){token=state.tokens[j];state.tokens[j]=state.tokens[i];state.tokens[i]=token}}}},{}],49:[function(require,module,exports){"use strict";function isTerminatorChar(ch){switch(ch){case 10:case 33:case 35:case 36:case 37:case 38:case 42:case 43:case 45:case 58:case 60:case 61:case 62:case 64:case 91:case 92:case 93:case 94:case 95:case 96:case 123:case 125:case 126:return true;default:return false}}module.exports=function text(state,silent){var pos=state.pos;while(pos<state.posMax&&!isTerminatorChar(state.src.charCodeAt(pos))){pos++}if(pos===state.pos){return false}if(!silent){state.pending+=state.src.slice(state.pos,pos)}state.pos=pos;return true}},{}],50:[function(require,module,exports){"use strict";module.exports=function text_collapse(state){var curr,last,level=0,tokens=state.tokens,max=state.tokens.length;for(curr=last=0;curr<max;curr++){level+=tokens[curr].nesting;tokens[curr].level=level;if(tokens[curr].type==="text"&&curr+1<max&&tokens[curr+1].type==="text"){tokens[curr+1].content=tokens[curr].content+tokens[curr+1].content}else{if(curr!==last){tokens[last]=tokens[curr]}last++}}if(curr!==last){tokens.length=last}}},{}],51:[function(require,module,exports){"use strict";function Token(type,tag,nesting){this.type=type;this.tag=tag;this.attrs=null;this.map=null;this.nesting=nesting;this.level=0;this.children=null;this.content="";this.markup="";this.info="";this.meta=null;this.block=false;this.hidden=false}Token.prototype.attrIndex=function attrIndex(name){var attrs,i,len;if(!this.attrs){return-1}attrs=this.attrs;for(i=0,len=attrs.length;i<len;i++){if(attrs[i][0]===name){return i}}return-1};Token.prototype.attrPush=function attrPush(attrData){if(this.attrs){this.attrs.push(attrData)}else{this.attrs=[attrData]}};Token.prototype.attrSet=function attrSet(name,value){var idx=this.attrIndex(name),attrData=[name,value];if(idx<0){this.attrPush(attrData)}else{this.attrs[idx]=attrData}};Token.prototype.attrJoin=function attrJoin(name,value){var idx=this.attrIndex(name);if(idx<0){this.attrPush([name,value])}else{this.attrs[idx][1]=this.attrs[idx][1]+" "+value}};module.exports=Token},{}],52:[function(require,module,exports){(function(global){(function(root){var freeExports=typeof exports=="object"&&exports&&!exports.nodeType&&exports;var freeModule=typeof module=="object"&&module&&!module.nodeType&&module;var freeGlobal=typeof global=="object"&&global;if(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal||freeGlobal.self===freeGlobal){root=freeGlobal}var punycode,maxInt=2147483647,base=36,tMin=1,tMax=26,skew=38,damp=700,initialBias=72,initialN=128,delimiter="-",regexPunycode=/^xn--/,regexNonASCII=/[^\x20-\x7E]/,regexSeparators=/[\x2E\u3002\uFF0E\uFF61]/g,errors={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},baseMinusTMin=base-tMin,floor=Math.floor,stringFromCharCode=String.fromCharCode,key;function error(type){throw new RangeError(errors[type])}function map(array,fn){var length=array.length;var result=[];while(length--){result[length]=fn(array[length])}return result}function mapDomain(string,fn){var parts=string.split("@");var result="";if(parts.length>1){result=parts[0]+"@";string=parts[1]}string=string.replace(regexSeparators,".");var labels=string.split(".");var encoded=map(labels,fn).join(".");return result+encoded}function ucs2decode(string){var output=[],counter=0,length=string.length,value,extra;while(counter<length){value=string.charCodeAt(counter++);if(value>=55296&&value<=56319&&counter<length){extra=string.charCodeAt(counter++);if((extra&64512)==56320){output.push(((value&1023)<<10)+(extra&1023)+65536)}else{output.push(value);counter--}}else{output.push(value)}}return output}function ucs2encode(array){return map(array,function(value){var output="";if(value>65535){value-=65536;output+=stringFromCharCode(value>>>10&1023|55296);value=56320|value&1023}output+=stringFromCharCode(value);return output}).join("")}function basicToDigit(codePoint){if(codePoint-48<10){return codePoint-22}if(codePoint-65<26){return codePoint-65}if(codePoint-97<26){return codePoint-97}return base}function digitToBasic(digit,flag){return digit+22+75*(digit<26)-((flag!=0)<<5)}function adapt(delta,numPoints,firstTime){var k=0;delta=firstTime?floor(delta/damp):delta>>1;delta+=floor(delta/numPoints);for(;delta>baseMinusTMin*tMax>>1;k+=base){delta=floor(delta/baseMinusTMin)}return floor(k+(baseMinusTMin+1)*delta/(delta+skew))}function decode(input){var output=[],inputLength=input.length,out,i=0,n=initialN,bias=initialBias,basic,j,index,oldi,w,k,digit,t,baseMinusT;basic=input.lastIndexOf(delimiter);if(basic<0){basic=0}for(j=0;j<basic;++j){if(input.charCodeAt(j)>=128){error("not-basic")}output.push(input.charCodeAt(j))}for(index=basic>0?basic+1:0;index<inputLength;){for(oldi=i,w=1,k=base;;k+=base){if(index>=inputLength){error("invalid-input")}digit=basicToDigit(input.charCodeAt(index++));if(digit>=base||digit>floor((maxInt-i)/w)){error("overflow")}i+=digit*w;t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias;if(digit<t){break}baseMinusT=base-t;if(w>floor(maxInt/baseMinusT)){error("overflow")}w*=baseMinusT}out=output.length+1;bias=adapt(i-oldi,out,oldi==0);if(floor(i/out)>maxInt-n){error("overflow")}n+=floor(i/out);i%=out;output.splice(i++,0,n)}return ucs2encode(output)}function encode(input){var n,delta,handledCPCount,basicLength,bias,j,m,q,k,t,currentValue,output=[],inputLength,handledCPCountPlusOne,baseMinusT,qMinusT;input=ucs2decode(input);inputLength=input.length;n=initialN;delta=0;bias=initialBias;for(j=0;j<inputLength;++j){currentValue=input[j];if(currentValue<128){output.push(stringFromCharCode(currentValue))}}handledCPCount=basicLength=output.length;if(basicLength){output.push(delimiter)}while(handledCPCount<inputLength){for(m=maxInt,j=0;j<inputLength;++j){currentValue=input[j];if(currentValue>=n&&currentValue<m){m=currentValue}}handledCPCountPlusOne=handledCPCount+1;if(m-n>floor((maxInt-delta)/handledCPCountPlusOne)){error("overflow")}delta+=(m-n)*handledCPCountPlusOne;n=m;for(j=0;j<inputLength;++j){currentValue=input[j];if(currentValue<n&&++delta>maxInt){error("overflow")}if(currentValue==n){for(q=delta,k=base;;k+=base){t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias;if(q<t){break}qMinusT=q-t;baseMinusT=base-t;output.push(stringFromCharCode(digitToBasic(t+qMinusT%baseMinusT,0)));q=floor(qMinusT/baseMinusT)}output.push(stringFromCharCode(digitToBasic(q,0)));bias=adapt(delta,handledCPCountPlusOne,handledCPCount==basicLength);delta=0;++handledCPCount}}++delta;++n}return output.join("")}function toUnicode(input){return mapDomain(input,function(string){return regexPunycode.test(string)?decode(string.slice(4).toLowerCase()):string})}function toASCII(input){return mapDomain(input,function(string){return regexNonASCII.test(string)?"xn--"+encode(string):string})}punycode={version:"1.3.2",ucs2:{decode:ucs2decode,encode:ucs2encode},decode:decode,encode:encode,toASCII:toASCII,toUnicode:toUnicode};if(typeof define=="function"&&typeof define.amd=="object"&&define.amd){define("punycode",function(){return punycode})}else if(freeExports&&freeModule){if(module.exports==freeExports){freeModule.exports=punycode}else{for(key in punycode){punycode.hasOwnProperty(key)&&(freeExports[key]=punycode[key])}}}else{root.punycode=punycode}})(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],53:[function(require,module,exports){module.exports={Aacute:"",aacute:"",Abreve:"",abreve:"",ac:"",acd:"",acE:"",Acirc:"",acirc:"",acute:"",Acy:"",acy:"",AElig:"",aelig:"",af:"",Afr:"",afr:"",Agrave:"",agrave:"",alefsym:"",aleph:"",Alpha:"",alpha:"",Amacr:"",amacr:"",amalg:"",amp:"&",AMP:"&",andand:"",And:"",and:"",andd:"",andslope:"",andv:"",ang:"",ange:"",angle:"",angmsdaa:"",angmsdab:"",angmsdac:"",angmsdad:"",angmsdae:"",angmsdaf:"",angmsdag:"",angmsdah:"",angmsd:"",angrt:"",angrtvb:"",angrtvbd:"",angsph:"",angst:"",angzarr:"",Aogon:"",aogon:"",Aopf:"",aopf:"",apacir:"",ap:"",apE:"",ape:"",apid:"",apos:"'",ApplyFunction:"",approx:"",approxeq:"",Aring:"",aring:"",Ascr:"",ascr:"",Assign:"",ast:"*",asymp:"",asympeq:"",Atilde:"",atilde:"",Auml:"",auml:"",awconint:"",awint:"",backcong:"",backepsilon:"",backprime:"",backsim:"",backsimeq:"",Backslash:"",Barv:"",barvee:"",barwed:"",Barwed:"",barwedge:"",bbrk:"",bbrktbrk:"",bcong:"",Bcy:"",bcy:"",bdquo:"",becaus:"",because:"",Because:"",bemptyv:"",bepsi:"",bernou:"",Bernoullis:"",Beta:"",beta:"",beth:"",between:"",Bfr:"",bfr:"",bigcap:"",bigcirc:"",bigcup:"",bigodot:"",bigoplus:"",bigotimes:"",bigsqcup:"",bigstar:"",bigtriangledown:"",bigtriangleup:"",biguplus:"",bigvee:"",bigwedge:"",bkarow:"",blacklozenge:"",blacksquare:"",blacktriangle:"",blacktriangledown:"",blacktriangleleft:"",blacktriangleright:"",blank:"",blk12:"",blk14:"",blk34:"",block:"",bne:"=",bnequiv:"",bNot:"",bnot:"",Bopf:"",bopf:"",bot:"",bottom:"",bowtie:"",boxbox:"",boxdl:"",boxdL:"",boxDl:"",boxDL:"",boxdr:"",boxdR:"",boxDr:"",boxDR:"",boxh:"",boxH:"",boxhd:"",boxHd:"",boxhD:"",boxHD:"",boxhu:"",boxHu:"",boxhU:"",boxHU:"",boxminus:"",boxplus:"",boxtimes:"",boxul:"",boxuL:"",boxUl:"",boxUL:"",boxur:"",boxuR:"",boxUr:"",boxUR:"",boxv:"",boxV:"",boxvh:"",boxvH:"",boxVh:"",boxVH:"",boxvl:"",boxvL:"",boxVl:"",boxVL:"",boxvr:"",boxvR:"",boxVr:"",boxVR:"",bprime:"",breve:"",Breve:"",brvbar:"",bscr:"",Bscr:"",bsemi:"",bsim:"",bsime:"",bsolb:"",bsol:"\\",bsolhsub:"",bull:"",bullet:"",bump:"",bumpE:"",bumpe:"",Bumpeq:"",bumpeq:"",Cacute:"",cacute:"",capand:"",capbrcup:"",capcap:"",cap:"",Cap:"",capcup:"",capdot:"",CapitalDifferentialD:"",caps:"",caret:"",caron:"",Cayleys:"",ccaps:"",Ccaron:"",ccaron:"",Ccedil:"",ccedil:"",Ccirc:"",ccirc:"",Cconint:"",ccups:"",ccupssm:"",Cdot:"",cdot:"",cedil:"",Cedilla:"",cemptyv:"",cent:"",centerdot:"",CenterDot:"",cfr:"",Cfr:"",CHcy:"",chcy:"",check:"",checkmark:"",Chi:"",chi:"",circ:"",circeq:"",circlearrowleft:"",circlearrowright:"",circledast:"",circledcirc:"",circleddash:"",CircleDot:"",circledR:"",circledS:"",CircleMinus:"",CirclePlus:"",CircleTimes:"",cir:"",cirE:"",cire:"",cirfnint:"",cirmid:"",cirscir:"",ClockwiseContourIntegral:"",CloseCurlyDoubleQuote:"",CloseCurlyQuote:"",clubs:"",clubsuit:"",colon:":",Colon:"",Colone:"",colone:"",coloneq:"",comma:",",commat:"@",comp:"",compfn:"",complement:"",complexes:"",cong:"",congdot:"",Congruent:"",conint:"",Conint:"",ContourIntegral:"",copf:"",Copf:"",coprod:"",Coproduct:"",copy:"",COPY:"",copysr:"",CounterClockwiseContourIntegral:"",crarr:"",cross:"",Cross:"",Cscr:"",cscr:"",csub:"",csube:"",csup:"",csupe:"",ctdot:"",cudarrl:"",cudarrr:"",cuepr:"",cuesc:"",cularr:"",cularrp:"",cupbrcap:"",cupcap:"",CupCap:"",cup:"",Cup:"",cupcup:"",cupdot:"",cupor:"",cups:"",curarr:"",curarrm:"",curlyeqprec:"",curlyeqsucc:"",curlyvee:"",curlywedge:"",curren:"",curvearrowleft:"",curvearrowright:"",cuvee:"",cuwed:"",cwconint:"",cwint:"",cylcty:"",dagger:"",Dagger:"",daleth:"",darr:"",Darr:"",dArr:"",dash:"",Dashv:"",dashv:"",dbkarow:"",dblac:"",Dcaron:"",dcaron:"",Dcy:"",dcy:"",ddagger:"",ddarr:"",DD:"",dd:"",DDotrahd:"",ddotseq:"",deg:"",Del:"",Delta:"",delta:"",demptyv:"",dfisht:"",Dfr:"",dfr:"",dHar:"",dharl:"",dharr:"",DiacriticalAcute:"",DiacriticalDot:"",DiacriticalDoubleAcute:"",DiacriticalGrave:"`",DiacriticalTilde:"",diam:"",diamond:"",Diamond:"",diamondsuit:"",diams:"",die:"",DifferentialD:"",digamma:"",disin:"",div:"",divide:"",divideontimes:"",divonx:"",DJcy:"",djcy:"",dlcorn:"",dlcrop:"",dollar:"$",Dopf:"",dopf:"",Dot:"",dot:"",DotDot:"",doteq:"",doteqdot:"",DotEqual:"",dotminus:"",dotplus:"",dotsquare:"",doublebarwedge:"",DoubleContourIntegral:"",DoubleDot:"",DoubleDownArrow:"",DoubleLeftArrow:"",DoubleLeftRightArrow:"",DoubleLeftTee:"",DoubleLongLeftArrow:"",DoubleLongLeftRightArrow:"",DoubleLongRightArrow:"",DoubleRightArrow:"",DoubleRightTee:"",DoubleUpArrow:"",DoubleUpDownArrow:"",DoubleVerticalBar:"",DownArrowBar:"",downarrow:"",DownArrow:"",Downarrow:"",DownArrowUpArrow:"",DownBreve:"",downdownarrows:"",downharpoonleft:"",downharpoonright:"",DownLeftRightVector:"",DownLeftTeeVector:"",DownLeftVectorBar:"",DownLeftVector:"",DownRightTeeVector:"",DownRightVectorBar:"",DownRightVector:"",DownTeeArrow:"",DownTee:"",drbkarow:"",drcorn:"",drcrop:"",Dscr:"",dscr:"",DScy:"",dscy:"",dsol:"",Dstrok:"",dstrok:"",dtdot:"",dtri:"",dtrif:"",duarr:"",duhar:"",dwangle:"",DZcy:"",dzcy:"",dzigrarr:"",Eacute:"",eacute:"",easter:"",Ecaron:"",ecaron:"",Ecirc:"",ecirc:"",ecir:"",ecolon:"",Ecy:"",ecy:"",eDDot:"",Edot:"",edot:"",eDot:"",ee:"",efDot:"",Efr:"",efr:"",eg:"",Egrave:"",egrave:"",egs:"",egsdot:"",el:"",Element:"",elinters:"",ell:"",els:"",elsdot:"",Emacr:"",emacr:"",empty:"",emptyset:"",EmptySmallSquare:"",emptyv:"",EmptyVerySmallSquare:"",emsp13:"",emsp14:"",emsp:"",ENG:"",eng:"",ensp:"",Eogon:"",eogon:"",Eopf:"",eopf:"",epar:"",eparsl:"",eplus:"",epsi:"",Epsilon:"",epsilon:"",epsiv:"",eqcirc:"",eqcolon:"",eqsim:"",eqslantgtr:"",eqslantless:"",Equal:"",equals:"=",EqualTilde:"",equest:"",Equilibrium:"",equiv:"",equivDD:"",eqvparsl:"",erarr:"",erDot:"",escr:"",Escr:"",esdot:"",Esim:"",esim:"",Eta:"",eta:"",ETH:"",eth:"",Euml:"",euml:"",euro:"",excl:"!",exist:"",Exists:"",expectation:"",exponentiale:"",ExponentialE:"",fallingdotseq:"",Fcy:"",fcy:"",female:"",ffilig:"",fflig:"",ffllig:"",Ffr:"",ffr:"",filig:"",FilledSmallSquare:"",FilledVerySmallSquare:"",fjlig:"fj",flat:"",fllig:"",fltns:"",fnof:"",Fopf:"",fopf:"",forall:"",ForAll:"",fork:"",forkv:"",Fouriertrf:"",fpartint:"",frac12:"",frac13:"",frac14:"",frac15:"",frac16:"",frac18:"",frac23:"",frac25:"",frac34:"",frac35:"",frac38:"",frac45:"",frac56:"",frac58:"",frac78:"",frasl:"",frown:"",fscr:"",Fscr:"",gacute:"",Gamma:"",gamma:"",Gammad:"",gammad:"",gap:"",Gbreve:"",gbreve:"",Gcedil:"",Gcirc:"",gcirc:"",Gcy:"",gcy:"",Gdot:"",gdot:"",ge:"",gE:"",gEl:"",gel:"",geq:"",geqq:"",geqslant:"",gescc:"",ges:"",gesdot:"",gesdoto:"",gesdotol:"",gesl:"",gesles:"",Gfr:"",gfr:"",gg:"",Gg:"",ggg:"",gimel:"",GJcy:"",gjcy:"",gla:"",gl:"",glE:"",glj:"",gnap:"",gnapprox:"",gne:"",gnE:"",gneq:"",gneqq:"",gnsim:"",Gopf:"",gopf:"",grave:"`",GreaterEqual:"",GreaterEqualLess:"",GreaterFullEqual:"",GreaterGreater:"",GreaterLess:"",GreaterSlantEqual:"",GreaterTilde:"",Gscr:"",gscr:"",gsim:"",gsime:"",gsiml:"",gtcc:"",gtcir:"",gt:">",GT:">",Gt:"",gtdot:"",gtlPar:"",gtquest:"",gtrapprox:"",gtrarr:"",gtrdot:"",gtreqless:"",gtreqqless:"",gtrless:"",gtrsim:"",gvertneqq:"",gvnE:"",Hacek:"",hairsp:"",half:"",hamilt:"",HARDcy:"",hardcy:"",harrcir:"",harr:"",hArr:"",harrw:"",Hat:"^",hbar:"",Hcirc:"",hcirc:"",hearts:"",heartsuit:"",hellip:"",hercon:"",hfr:"",Hfr:"",HilbertSpace:"",hksearow:"",hkswarow:"",hoarr:"",homtht:"",hookleftarrow:"",hookrightarrow:"",hopf:"",Hopf:"",horbar:"",HorizontalLine:"",hscr:"",Hscr:"",hslash:"",Hstrok:"",hstrok:"",HumpDownHump:"",HumpEqual:"",hybull:"",hyphen:"",Iacute:"",iacute:"",ic:"",Icirc:"",icirc:"",Icy:"",icy:"",Idot:"",IEcy:"",iecy:"",iexcl:"",iff:"",ifr:"",Ifr:"",Igrave:"",igrave:"",ii:"",iiiint:"",iiint:"",iinfin:"",iiota:"",IJlig:"",ijlig:"",Imacr:"",imacr:"",image:"",ImaginaryI:"",imagline:"",imagpart:"",imath:"",Im:"",imof:"",imped:"",Implies:"",incare:"",in:"",infin:"",infintie:"",inodot:"",intcal:"",int:"",Int:"",integers:"",Integral:"",intercal:"",Intersection:"",intlarhk:"",intprod:"",InvisibleComma:"",InvisibleTimes:"",IOcy:"",iocy:"",Iogon:"",iogon:"",Iopf:"",iopf:"",Iota:"",iota:"",iprod:"",iquest:"",iscr:"",Iscr:"",isin:"",isindot:"",isinE:"",isins:"",isinsv:"",isinv:"",it:"",Itilde:"",itilde:"",Iukcy:"",iukcy:"",Iuml:"",iuml:"",Jcirc:"",jcirc:"",Jcy:"",jcy:"",Jfr:"",jfr:"",jmath:"",Jopf:"",jopf:"",Jscr:"",jscr:"",Jsercy:"",jsercy:"",Jukcy:"",jukcy:"",Kappa:"",kappa:"",kappav:"",Kcedil:"",kcedil:"",Kcy:"",kcy:"",Kfr:"",kfr:"",kgreen:"",KHcy:"",khcy:"",KJcy:"",kjcy:"",Kopf:"",kopf:"",Kscr:"",kscr:"",lAarr:"",Lacute:"",lacute:"",laemptyv:"",lagran:"",Lambda:"",lambda:"",lang:"",Lang:"",langd:"",langle:"",lap:"",Laplacetrf:"",laquo:"",larrb:"",larrbfs:"",larr:"",Larr:"",lArr:"",larrfs:"",larrhk:"",larrlp:"",larrpl:"",larrsim:"",larrtl:"",latail:"",lAtail:"",lat:"",late:"",lates:"",lbarr:"",lBarr:"",lbbrk:"",lbrace:"{",lbrack:"[",lbrke:"",lbrksld:"",lbrkslu:"",Lcaron:"",lcaron:"",Lcedil:"",lcedil:"",lceil:"",lcub:"{",Lcy:"",lcy:"",ldca:"",ldquo:"",ldquor:"",ldrdhar:"",ldrushar:"",ldsh:"",le:"",lE:"",LeftAngleBracket:"",LeftArrowBar:"",leftarrow:"",LeftArrow:"",Leftarrow:"",LeftArrowRightArrow:"",leftarrowtail:"",LeftCeiling:"",LeftDoubleBracket:"",LeftDownTeeVector:"",LeftDownVectorBar:"",LeftDownVector:"",LeftFloor:"",leftharpoondown:"",leftharpoonup:"",leftleftarrows:"",leftrightarrow:"",LeftRightArrow:"",Leftrightarrow:"",leftrightarrows:"",leftrightharpoons:"",leftrightsquigarrow:"",LeftRightVector:"",LeftTeeArrow:"",LeftTee:"",LeftTeeVector:"",leftthreetimes:"",LeftTriangleBar:"",LeftTriangle:"",LeftTriangleEqual:"",LeftUpDownVector:"",LeftUpTeeVector:"",LeftUpVectorBar:"",LeftUpVector:"",LeftVectorBar:"",LeftVector:"",lEg:"",leg:"",leq:"",leqq:"",leqslant:"",lescc:"",les:"",lesdot:"",lesdoto:"",lesdotor:"",lesg:"",lesges:"",lessapprox:"",lessdot:"",lesseqgtr:"",lesseqqgtr:"",LessEqualGreater:"",LessFullEqual:"",LessGreater:"",lessgtr:"",LessLess:"",lesssim:"",LessSlantEqual:"",LessTilde:"",lfisht:"",lfloor:"",Lfr:"",lfr:"",lg:"",lgE:"",lHar:"",lhard:"",lharu:"",lharul:"",lhblk:"",LJcy:"",ljcy:"",llarr:"",ll:"",Ll:"",llcorner:"",Lleftarrow:"",llhard:"",lltri:"",Lmidot:"",lmidot:"",lmoustache:"",lmoust:"",lnap:"",lnapprox:"",lne:"",lnE:"",lneq:"",lneqq:"",lnsim:"",loang:"",loarr:"",lobrk:"",longleftarrow:"",LongLeftArrow:"",Longleftarrow:"",longleftrightarrow:"",LongLeftRightArrow:"",Longleftrightarrow:"",longmapsto:"",longrightarrow:"",LongRightArrow:"",Longrightarrow:"",looparrowleft:"",looparrowright:"",lopar:"",Lopf:"",lopf:"",loplus:"",lotimes:"",lowast:"",lowbar:"_",LowerLeftArrow:"",LowerRightArrow:"",loz:"",lozenge:"",lozf:"",lpar:"(",lparlt:"",lrarr:"",lrcorner:"",lrhar:"",lrhard:"",lrm:"",lrtri:"",lsaquo:"",lscr:"",Lscr:"",lsh:"",Lsh:"",lsim:"",lsime:"",lsimg:"",lsqb:"[",lsquo:"",lsquor:"",Lstrok:"",lstrok:"",ltcc:"",ltcir:"",lt:"<",LT:"<",Lt:"",ltdot:"",lthree:"",ltimes:"",ltlarr:"",ltquest:"",ltri:"",ltrie:"",ltrif:"",ltrPar:"",lurdshar:"",luruhar:"",lvertneqq:"",lvnE:"",macr:"",male:"",malt:"",maltese:"",Map:"",map:"",mapsto:"",mapstodown:"",mapstoleft:"",mapstoup:"",marker:"",mcomma:"",Mcy:"",mcy:"",mdash:"",mDDot:"",measuredangle:"",MediumSpace:"",Mellintrf:"",Mfr:"",mfr:"",mho:"",micro:"",midast:"*",midcir:"",mid:"",middot:"",minusb:"",minus:"",minusd:"",minusdu:"",MinusPlus:"",mlcp:"",mldr:"",mnplus:"",models:"",Mopf:"",mopf:"",mp:"",mscr:"",Mscr:"",mstpos:"",Mu:"",mu:"",multimap:"",mumap:"",nabla:"",Nacute:"",nacute:"",nang:"",nap:"",napE:"",napid:"",napos:"",napprox:"",natural:"",naturals:"",natur:"",nbsp:"",nbump:"",nbumpe:"",ncap:"",Ncaron:"",ncaron:"",Ncedil:"",ncedil:"",ncong:"",ncongdot:"",ncup:"",Ncy:"",ncy:"",ndash:"",nearhk:"",nearr:"",neArr:"",nearrow:"",ne:"",nedot:"",NegativeMediumSpace:"",NegativeThickSpace:"",NegativeThinSpace:"",NegativeVeryThinSpace:"",nequiv:"",nesear:"",nesim:"",NestedGreaterGreater:"",NestedLessLess:"",NewLine:"\n",nexist:"",nexists:"",Nfr:"",nfr:"",ngE:"",nge:"",ngeq:"",ngeqq:"",ngeqslant:"",nges:"",nGg:"",ngsim:"",nGt:"",ngt:"",ngtr:"",nGtv:"",nharr:"",nhArr:"",nhpar:"",ni:"",nis:"",nisd:"",niv:"",NJcy:"",njcy:"",nlarr:"",nlArr:"",nldr:"",nlE:"",nle:"",nleftarrow:"",nLeftarrow:"",nleftrightarrow:"",nLeftrightarrow:"",nleq:"",nleqq:"",nleqslant:"",nles:"",nless:"",nLl:"",nlsim:"",nLt:"",nlt:"",nltri:"",nltrie:"",nLtv:"",nmid:"",NoBreak:"",NonBreakingSpace:"",nopf:"",Nopf:"",Not:"",not:"",NotCongruent:"",NotCupCap:"",NotDoubleVerticalBar:"",NotElement:"",NotEqual:"",NotEqualTilde:"",NotExists:"",NotGreater:"",NotGreaterEqual:"",NotGreaterFullEqual:"",NotGreaterGreater:"",NotGreaterLess:"",NotGreaterSlantEqual:"",NotGreaterTilde:"",NotHumpDownHump:"",NotHumpEqual:"",notin:"",notindot:"",notinE:"",notinva:"",notinvb:"",notinvc:"",NotLeftTriangleBar:"",NotLeftTriangle:"",NotLeftTriangleEqual:"",NotLess:"",NotLessEqual:"",NotLessGreater:"",NotLessLess:"",NotLessSlantEqual:"",NotLessTilde:"",NotNestedGreaterGreater:"",NotNestedLessLess:"",notni:"",notniva:"",notnivb:"",notnivc:"",NotPrecedes:"",NotPrecedesEqual:"",NotPrecedesSlantEqual:"",NotReverseElement:"",NotRightTriangleBar:"",NotRightTriangle:"",NotRightTriangleEqual:"",NotSquareSubset:"",NotSquareSubsetEqual:"",NotSquareSuperset:"",NotSquareSupersetEqual:"",NotSubset:"",NotSubsetEqual:"",NotSucceeds:"",NotSucceedsEqual:"",NotSucceedsSlantEqual:"",NotSucceedsTilde:"",NotSuperset:"",NotSupersetEqual:"",NotTilde:"",NotTildeEqual:"",NotTildeFullEqual:"",NotTildeTilde:"",NotVerticalBar:"",nparallel:"",npar:"",nparsl:"",npart:"",npolint:"",npr:"",nprcue:"",nprec:"",npreceq:"",npre:"",nrarrc:"",nrarr:"",nrArr:"",nrarrw:"",nrightarrow:"",nRightarrow:"",nrtri:"",nrtrie:"",nsc:"",nsccue:"",nsce:"",Nscr:"",nscr:"",nshortmid:"",nshortparallel:"",nsim:"",nsime:"",nsimeq:"",nsmid:"",nspar:"",nsqsube:"",nsqsupe:"",nsub:"",nsubE:"",nsube:"",nsubset:"",nsubseteq:"",nsubseteqq:"",nsucc:"",nsucceq:"",nsup:"",nsupE:"",nsupe:"",nsupset:"",nsupseteq:"",nsupseteqq:"",ntgl:"",Ntilde:"",ntilde:"",ntlg:"",ntriangleleft:"",ntrianglelefteq:"",ntriangleright:"",ntrianglerighteq:"",Nu:"",nu:"",num:"#",numero:"",numsp:"",nvap:"",nvdash:"",nvDash:"",nVdash:"",nVDash:"",nvge:"",nvgt:">",nvHarr:"",nvinfin:"",nvlArr:"",nvle:"",nvlt:"<",nvltrie:"",nvrArr:"",nvrtrie:"",nvsim:"",nwarhk:"",nwarr:"",nwArr:"",nwarrow:"",nwnear:"",Oacute:"",oacute:"",oast:"",Ocirc:"",ocirc:"",ocir:"",Ocy:"",ocy:"",odash:"",Odblac:"",odblac:"",odiv:"",odot:"",odsold:"",OElig:"",oelig:"",ofcir:"",Ofr:"",ofr:"",ogon:"",Ograve:"",ograve:"",ogt:"",ohbar:"",ohm:"",oint:"",olarr:"",olcir:"",olcross:"",oline:"",olt:"",Omacr:"",omacr:"",Omega:"",omega:"",Omicron:"",omicron:"",omid:"",ominus:"",Oopf:"",oopf:"",opar:"",OpenCurlyDoubleQuote:"",OpenCurlyQuote:"",operp:"",oplus:"",orarr:"",Or:"",or:"",ord:"",order:"",orderof:"",ordf:"",ordm:"",origof:"",oror:"",orslope:"",orv:"",oS:"",Oscr:"",oscr:"",Oslash:"",oslash:"",osol:"",Otilde:"",otilde:"",otimesas:"",Otimes:"",otimes:"",Ouml:"",ouml:"",ovbar:"",OverBar:"",OverBrace:"",OverBracket:"",OverParenthesis:"",para:"",parallel:"",par:"",parsim:"",parsl:"",part:"",PartialD:"",Pcy:"",pcy:"",percnt:"%",period:".",permil:"",perp:"",pertenk:"",Pfr:"",pfr:"",Phi:"",phi:"",phiv:"",phmmat:"",phone:"",Pi:"",pi:"",pitchfork:"",piv:"",planck:"",planckh:"",plankv:"",plusacir:"",plusb:"",pluscir:"",plus:"+",plusdo:"",plusdu:"",pluse:"",PlusMinus:"",plusmn:"",plussim:"",plustwo:"",pm:"",Poincareplane:"",pointint:"",popf:"",Popf:"",pound:"",prap:"",Pr:"",pr:"",prcue:"",precapprox:"",prec:"",preccurlyeq:"",Precedes:"",PrecedesEqual:"",PrecedesSlantEqual:"",PrecedesTilde:"",preceq:"",precnapprox:"",precneqq:"",precnsim:"",pre:"",prE:"",precsim:"",prime:"",Prime:"",primes:"",prnap:"",prnE:"",prnsim:"",prod:"",Product:"",profalar:"",profline:"",profsurf:"",prop:"",Proportional:"",Proportion:"",propto:"",prsim:"",prurel:"",Pscr:"",pscr:"",Psi:"",psi:"",puncsp:"",Qfr:"",qfr:"",qint:"",qopf:"",Qopf:"",qprime:"",Qscr:"",qscr:"",quaternions:"",quatint:"",quest:"?",questeq:"",quot:'"',QUOT:'"',rAarr:"",race:"",Racute:"",racute:"",radic:"",raemptyv:"",rang:"",Rang:"",rangd:"",range:"",rangle:"",raquo:"",rarrap:"",rarrb:"",rarrbfs:"",rarrc:"",rarr:"",Rarr:"",rArr:"",rarrfs:"",rarrhk:"",rarrlp:"",rarrpl:"",rarrsim:"",Rarrtl:"",rarrtl:"",rarrw:"",ratail:"",rAtail:"",ratio:"",rationals:"",rbarr:"",rBarr:"",RBarr:"",rbbrk:"",rbrace:"}",rbrack:"]",rbrke:"",rbrksld:"",rbrkslu:"",Rcaron:"",rcaron:"",Rcedil:"",rcedil:"",rceil:"",rcub:"}",Rcy:"",rcy:"",rdca:"",rdldhar:"",rdquo:"",rdquor:"",rdsh:"",real:"",realine:"",realpart:"",reals:"",Re:"",rect:"",reg:"",REG:"",ReverseElement:"",ReverseEquilibrium:"",ReverseUpEquilibrium:"",rfisht:"",rfloor:"",rfr:"",Rfr:"",rHar:"",rhard:"",rharu:"",rharul:"",Rho:"",rho:"",rhov:"",RightAngleBracket:"",RightArrowBar:"",rightarrow:"",RightArrow:"",Rightarrow:"",RightArrowLeftArrow:"",rightarrowtail:"",RightCeiling:"",RightDoubleBracket:"",RightDownTeeVector:"",RightDownVectorBar:"",RightDownVector:"",RightFloor:"",rightharpoondown:"",rightharpoonup:"",rightleftarrows:"",rightleftharpoons:"",rightrightarrows:"",rightsquigarrow:"",RightTeeArrow:"",RightTee:"",RightTeeVector:"",rightthreetimes:"",RightTriangleBar:"",RightTriangle:"",RightTriangleEqual:"",RightUpDownVector:"",RightUpTeeVector:"",RightUpVectorBar:"",RightUpVector:"",RightVectorBar:"",RightVector:"",ring:"",risingdotseq:"",rlarr:"",rlhar:"",rlm:"",rmoustache:"",rmoust:"",rnmid:"",roang:"",roarr:"",robrk:"",ropar:"",ropf:"",Ropf:"",roplus:"",rotimes:"",RoundImplies:"",rpar:")",rpargt:"",rppolint:"",rrarr:"",Rrightarrow:"",rsaquo:"",rscr:"",Rscr:"",rsh:"",Rsh:"",rsqb:"]",rsquo:"",rsquor:"",rthree:"",rtimes:"",rtri:"",rtrie:"",rtrif:"",rtriltri:"",RuleDelayed:"",ruluhar:"",rx:"",Sacute:"",sacute:"",sbquo:"",scap:"",Scaron:"",scaron:"",Sc:"",sc:"",sccue:"",sce:"",scE:"",Scedil:"",scedil:"",Scirc:"",scirc:"",scnap:"",scnE:"",scnsim:"",scpolint:"",scsim:"",Scy:"",scy:"",sdotb:"",sdot:"",sdote:"",searhk:"",searr:"",seArr:"",searrow:"",sect:"",semi:";",seswar:"",setminus:"",setmn:"",sext:"",Sfr:"",sfr:"",sfrown:"",sharp:"",SHCHcy:"",shchcy:"",SHcy:"",shcy:"",ShortDownArrow:"",ShortLeftArrow:"",shortmid:"",shortparallel:"",ShortRightArrow:"",ShortUpArrow:"",shy:"",Sigma:"",sigma:"",sigmaf:"",sigmav:"",sim:"",simdot:"",sime:"",simeq:"",simg:"",simgE:"",siml:"",simlE:"",simne:"",simplus:"",simrarr:"",slarr:"",SmallCircle:"",smallsetminus:"",smashp:"",smeparsl:"",smid:"",smile:"",smt:"",smte:"",smtes:"",SOFTcy:"",softcy:"",solbar:"",solb:"",sol:"/",Sopf:"",sopf:"",spades:"",spadesuit:"",spar:"",sqcap:"",sqcaps:"",sqcup:"",sqcups:"",Sqrt:"",sqsub:"",sqsube:"",sqsubset:"",sqsubseteq:"",sqsup:"",sqsupe:"",sqsupset:"",sqsupseteq:"",square:"",Square:"",SquareIntersection:"",SquareSubset:"",SquareSubsetEqual:"",SquareSuperset:"",SquareSupersetEqual:"",SquareUnion:"",squarf:"",squ:"",squf:"",srarr:"",Sscr:"",sscr:"",ssetmn:"",ssmile:"",sstarf:"",Star:"",star:"",starf:"",straightepsilon:"",straightphi:"",strns:"",sub:"",Sub:"",subdot:"",subE:"",sube:"",subedot:"",submult:"",subnE:"",subne:"",subplus:"",subrarr:"",subset:"",Subset:"",subseteq:"",subseteqq:"",SubsetEqual:"",subsetneq:"",subsetneqq:"",subsim:"",subsub:"",subsup:"",succapprox:"",succ:"",succcurlyeq:"",Succeeds:"",SucceedsEqual:"",SucceedsSlantEqual:"",SucceedsTilde:"",succeq:"",succnapprox:"",succneqq:"",succnsim:"",succsim:"",SuchThat:"",sum:"",Sum:"",sung:"",sup1:"",sup2:"",sup3:"",sup:"",Sup:"",supdot:"",supdsub:"",supE:"",supe:"",supedot:"",Superset:"",SupersetEqual:"",suphsol:"",suphsub:"",suplarr:"",supmult:"",supnE:"",supne:"",supplus:"",supset:"",Supset:"",supseteq:"",supseteqq:"",supsetneq:"",supsetneqq:"",supsim:"",supsub:"",supsup:"",swarhk:"",swarr:"",swArr:"",swarrow:"",swnwar:"",szlig:"",Tab:"\t",target:"",Tau:"",tau:"",tbrk:"",Tcaron:"",tcaron:"",Tcedil:"",tcedil:"",Tcy:"",tcy:"",tdot:"",telrec:"",Tfr:"",tfr:"",there4:"",therefore:"",Therefore:"",Theta:"",theta:"",thetasym:"",thetav:"",thickapprox:"",thicksim:"",ThickSpace:"",ThinSpace:"",thinsp:"",thkap:"",thksim:"",THORN:"",thorn:"",tilde:"",Tilde:"",TildeEqual:"",TildeFullEqual:"",TildeTilde:"",timesbar:"",timesb:"",times:"",timesd:"",tint:"",toea:"",topbot:"",topcir:"",top:"",Topf:"",topf:"",topfork:"",tosa:"",tprime:"",trade:"",TRADE:"",triangle:"",triangledown:"",triangleleft:"",trianglelefteq:"",triangleq:"",triangleright:"",trianglerighteq:"",tridot:"",trie:"",triminus:"",TripleDot:"",triplus:"",trisb:"",tritime:"",trpezium:"",Tscr:"",tscr:"",TScy:"",tscy:"",TSHcy:"",tshcy:"",Tstrok:"",tstrok:"",twixt:"",twoheadleftarrow:"",twoheadrightarrow:"",Uacute:"",uacute:"",uarr:"",Uarr:"",uArr:"",Uarrocir:"",Ubrcy:"",ubrcy:"",Ubreve:"",ubreve:"",Ucirc:"",ucirc:"",Ucy:"",ucy:"",udarr:"",Udblac:"",udblac:"",udhar:"",ufisht:"",Ufr:"",ufr:"",Ugrave:"",ugrave:"",uHar:"",uharl:"",uharr:"",uhblk:"",ulcorn:"",ulcorner:"",ulcrop:"",ultri:"",Umacr:"",umacr:"",uml:"",UnderBar:"_",UnderBrace:"",UnderBracket:"",UnderParenthesis:"",Union:"",UnionPlus:"",Uogon:"",uogon:"",Uopf:"",uopf:"",UpArrowBar:"",uparrow:"",UpArrow:"",Uparrow:"",UpArrowDownArrow:"",updownarrow:"",UpDownArrow:"",Updownarrow:"",UpEquilibrium:"",upharpoonleft:"",upharpoonright:"",uplus:"",UpperLeftArrow:"",UpperRightArrow:"",upsi:"",Upsi:"",upsih:"",Upsilon:"",upsilon:"",UpTeeArrow:"",UpTee:"",upuparrows:"",urcorn:"",urcorner:"",urcrop:"",Uring:"",uring:"",urtri:"",Uscr:"",uscr:"",utdot:"",Utilde:"",utilde:"",utri:"",utrif:"",uuarr:"",Uuml:"",uuml:"",uwangle:"",vangrt:"",varepsilon:"",varkappa:"",varnothing:"",varphi:"",varpi:"",varpropto:"",varr:"",vArr:"",varrho:"",varsigma:"",varsubsetneq:"",varsubsetneqq:"",varsupsetneq:"",varsupsetneqq:"",vartheta:"",vartriangleleft:"",vartriangleright:"",vBar:"",Vbar:"",vBarv:"",Vcy:"",vcy:"",vdash:"",vDash:"",Vdash:"",VDash:"",Vdashl:"",veebar:"",vee:"",Vee:"",veeeq:"",vellip:"",verbar:"|",Verbar:"",vert:"|",Vert:"",VerticalBar:"",VerticalLine:"|",VerticalSeparator:"",VerticalTilde:"",VeryThinSpace:"",Vfr:"",vfr:"",vltri:"",vnsub:"",vnsup:"",Vopf:"",vopf:"",vprop:"",vrtri:"",Vscr:"",vscr:"",vsubnE:"",vsubne:"",vsupnE:"",vsupne:"",Vvdash:"",vzigzag:"",Wcirc:"",wcirc:"",wedbar:"",wedge:"",Wedge:"",wedgeq:"",weierp:"",Wfr:"",wfr:"",Wopf:"",wopf:"",wp:"",wr:"",wreath:"",Wscr:"",wscr:"",xcap:"",xcirc:"",xcup:"",xdtri:"",Xfr:"",xfr:"",xharr:"",xhArr:"",Xi:"",xi:"",xlarr:"",xlArr:"",xmap:"",xnis:"",xodot:"",Xopf:"",xopf:"",xoplus:"",xotime:"",xrarr:"",xrArr:"",Xscr:"",xscr:"",xsqcup:"",xuplus:"",xutri:"",xvee:"",xwedge:"",Yacute:"",yacute:"",YAcy:"",yacy:"",Ycirc:"",ycirc:"",Ycy:"",ycy:"",yen:"",Yfr:"",yfr:"",YIcy:"",yicy:"",Yopf:"",yopf:"",Yscr:"",yscr:"",YUcy:"",yucy:"",yuml:"",Yuml:"",Zacute:"",zacute:"",Zcaron:"",zcaron:"",Zcy:"",zcy:"",Zdot:"",zdot:"",zeetrf:"",ZeroWidthSpace:"",Zeta:"",zeta:"",zfr:"",Zfr:"",ZHcy:"",zhcy:"",zigrarr:"",zopf:"",Zopf:"",Zscr:"",zscr:"",zwj:"",zwnj:""}},{}],54:[function(require,module,exports){"use strict";function assign(obj){var sources=Array.prototype.slice.call(arguments,1);sources.forEach(function(source){if(!source){return}Object.keys(source).forEach(function(key){obj[key]=source[key]})});return obj}function _class(obj){return Object.prototype.toString.call(obj)}function isString(obj){return _class(obj)==="[object String]"}function isObject(obj){return _class(obj)==="[object Object]"}function isRegExp(obj){return _class(obj)==="[object RegExp]"}function isFunction(obj){return _class(obj)==="[object Function]"}function escapeRE(str){return str.replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}var defaultOptions={fuzzyLink:true,fuzzyEmail:true,fuzzyIP:false};function isOptionsObj(obj){return Object.keys(obj||{}).reduce(function(acc,k){return acc||defaultOptions.hasOwnProperty(k)},false)}var defaultSchemas={"http:":{validate:function(text,pos,self){var tail=text.slice(pos);if(!self.re.http){self.re.http=new RegExp("^\\/\\/"+self.re.src_auth+self.re.src_host_port_strict+self.re.src_path,"i")}if(self.re.http.test(tail)){return tail.match(self.re.http)[0].length}return 0}},"https:":"http:","ftp:":"http:","//":{validate:function(text,pos,self){var tail=text.slice(pos);if(!self.re.no_http){self.re.no_http=new RegExp("^"+self.re.src_auth+self.re.src_host_port_strict+self.re.src_path,"i")}if(self.re.no_http.test(tail)){if(pos>=3&&text[pos-3]===":"){return 0}return tail.match(self.re.no_http)[0].length}return 0}},"mailto:":{validate:function(text,pos,self){var tail=text.slice(pos);if(!self.re.mailto){self.re.mailto=new RegExp("^"+self.re.src_email_name+"@"+self.re.src_host_strict,"i")}if(self.re.mailto.test(tail)){return tail.match(self.re.mailto)[0].length}return 0}}};var tlds_2ch_src_re="a[cdefgilmnoqrstuwxz]|b[abdefghijmnorstvwyz]|c[acdfghiklmnoruvwxyz]|d[ejkmoz]|e[cegrstu]|f[ijkmor]|g[abdefghilmnpqrstuwy]|h[kmnrtu]|i[delmnoqrst]|j[emop]|k[eghimnprwyz]|l[abcikrstuvy]|m[acdeghklmnopqrstuvwxyz]|n[acefgilopruz]|om|p[aefghklmnrstwy]|qa|r[eosuw]|s[abcdeghijklmnortuvxyz]|t[cdfghjklmnortvwz]|u[agksyz]|v[aceginu]|w[fs]|y[et]|z[amw]";var tlds_default="biz|com|edu|gov|net|org|pro|web|xxx|aero|asia|coop|info|museum|name|shop|".split("|");function resetScanCache(self){self.__index__=-1;self.__text_cache__=""}function createValidator(re){return function(text,pos){var tail=text.slice(pos);if(re.test(tail)){return tail.match(re)[0].length}return 0}}function createNormalizer(){return function(match,self){self.normalize(match)}}function compile(self){var re=self.re=assign({},require("./lib/re"));var tlds=self.__tlds__.slice();if(!self.__tlds_replaced__){tlds.push(tlds_2ch_src_re)}tlds.push(re.src_xn);re.src_tlds=tlds.join("|");function untpl(tpl){return tpl.replace("%TLDS%",re.src_tlds)}re.email_fuzzy=RegExp(untpl(re.tpl_email_fuzzy),"i");re.link_fuzzy=RegExp(untpl(re.tpl_link_fuzzy),"i");re.link_no_ip_fuzzy=RegExp(untpl(re.tpl_link_no_ip_fuzzy),"i");re.host_fuzzy_test=RegExp(untpl(re.tpl_host_fuzzy_test),"i");var aliases=[];self.__compiled__={};function schemaError(name,val){throw new Error('(LinkifyIt) Invalid schema "'+name+'": '+val)}Object.keys(self.__schemas__).forEach(function(name){var val=self.__schemas__[name];if(val===null){return}var compiled={validate:null,link:null};self.__compiled__[name]=compiled;if(isObject(val)){if(isRegExp(val.validate)){compiled.validate=createValidator(val.validate)}else if(isFunction(val.validate)){compiled.validate=val.validate}else{schemaError(name,val)}if(isFunction(val.normalize)){compiled.normalize=val.normalize}else if(!val.normalize){compiled.normalize=createNormalizer()}else{schemaError(name,val)}return}if(isString(val)){aliases.push(name);return}schemaError(name,val)});aliases.forEach(function(alias){if(!self.__compiled__[self.__schemas__[alias]]){return}self.__compiled__[alias].validate=self.__compiled__[self.__schemas__[alias]].validate;self.__compiled__[alias].normalize=self.__compiled__[self.__schemas__[alias]].normalize});self.__compiled__[""]={validate:null,normalize:createNormalizer()};var slist=Object.keys(self.__compiled__).filter(function(name){return name.length>0&&self.__compiled__[name]}).map(escapeRE).join("|");self.re.schema_test=RegExp("(^|(?!_)(?:>|"+re.src_ZPCc+"))("+slist+")","i");self.re.schema_search=RegExp("(^|(?!_)(?:>|"+re.src_ZPCc+"))("+slist+")","ig");self.re.pretest=RegExp("("+self.re.schema_test.source+")|"+"("+self.re.host_fuzzy_test.source+")|"+"@","i");resetScanCache(self)}function Match(self,shift){var start=self.__index__,end=self.__last_index__,text=self.__text_cache__.slice(start,end);this.schema=self.__schema__.toLowerCase();this.index=start+shift;this.lastIndex=end+shift;this.raw=text;this.text=text;this.url=text}function createMatch(self,shift){var match=new Match(self,shift);self.__compiled__[match.schema].normalize(match,self);return match}function LinkifyIt(schemas,options){if(!(this instanceof LinkifyIt)){return new LinkifyIt(schemas,options)}if(!options){if(isOptionsObj(schemas)){options=schemas;schemas={}}}this.__opts__=assign({},defaultOptions,options);this.__index__=-1;this.__last_index__=-1;this.__schema__="";this.__text_cache__="";this.__schemas__=assign({},defaultSchemas,schemas);this.__compiled__={};this.__tlds__=tlds_default;this.__tlds_replaced__=false;this.re={};compile(this)}LinkifyIt.prototype.add=function add(schema,definition){this.__schemas__[schema]=definition;compile(this);return this};LinkifyIt.prototype.set=function set(options){this.__opts__=assign(this.__opts__,options);return this};LinkifyIt.prototype.test=function test(text){this.__text_cache__=text;this.__index__=-1;if(!text.length){return false}var m,ml,me,len,shift,next,re,tld_pos,at_pos;if(this.re.schema_test.test(text)){re=this.re.schema_search;re.lastIndex=0;while((m=re.exec(text))!==null){len=this.testSchemaAt(text,m[2],re.lastIndex);if(len){this.__schema__=m[2];this.__index__=m.index+m[1].length;this.__last_index__=m.index+m[0].length+len;break}}}if(this.__opts__.fuzzyLink&&this.__compiled__["http:"]){tld_pos=text.search(this.re.host_fuzzy_test);if(tld_pos>=0){if(this.__index__<0||tld_pos<this.__index__){if((ml=text.match(this.__opts__.fuzzyIP?this.re.link_fuzzy:this.re.link_no_ip_fuzzy))!==null){shift=ml.index+ml[1].length;if(this.__index__<0||shift<this.__index__){this.__schema__="";this.__index__=shift;this.__last_index__=ml.index+ml[0].length}}}}}if(this.__opts__.fuzzyEmail&&this.__compiled__["mailto:"]){at_pos=text.indexOf("@");if(at_pos>=0){if((me=text.match(this.re.email_fuzzy))!==null){shift=me.index+me[1].length;next=me.index+me[0].length;if(this.__index__<0||shift<this.__index__||shift===this.__index__&&next>this.__last_index__){this.__schema__="mailto:";this.__index__=shift;this.__last_index__=next}}}}return this.__index__>=0};LinkifyIt.prototype.pretest=function pretest(text){return this.re.pretest.test(text)};LinkifyIt.prototype.testSchemaAt=function testSchemaAt(text,schema,pos){if(!this.__compiled__[schema.toLowerCase()]){return 0}return this.__compiled__[schema.toLowerCase()].validate(text,pos,this)};LinkifyIt.prototype.match=function match(text){var shift=0,result=[];if(this.__index__>=0&&this.__text_cache__===text){result.push(createMatch(this,shift));shift=this.__last_index__}var tail=shift?text.slice(shift):text;while(this.test(tail)){result.push(createMatch(this,shift));tail=tail.slice(this.__last_index__);shift+=this.__last_index__}if(result.length){return result}return null};LinkifyIt.prototype.tlds=function tlds(list,keepOld){list=Array.isArray(list)?list:[list];if(!keepOld){this.__tlds__=list.slice();this.__tlds_replaced__=true;compile(this);return this}this.__tlds__=this.__tlds__.concat(list).sort().filter(function(el,idx,arr){return el!==arr[idx-1]}).reverse();compile(this);return this};LinkifyIt.prototype.normalize=function normalize(match){if(!match.schema){match.url="http://"+match.url}if(match.schema==="mailto:"&&!/^mailto:/i.test(match.url)){match.url="mailto:"+match.url}};module.exports=LinkifyIt},{"./lib/re":55}],55:[function(require,module,exports){"use strict";var src_Any=exports.src_Any=require("uc.micro/properties/Any/regex").source;var src_Cc=exports.src_Cc=require("uc.micro/categories/Cc/regex").source;var src_Z=exports.src_Z=require("uc.micro/categories/Z/regex").source;var src_P=exports.src_P=require("uc.micro/categories/P/regex").source;var src_ZPCc=exports.src_ZPCc=[src_Z,src_P,src_Cc].join("|");var src_ZCc=exports.src_ZCc=[src_Z,src_Cc].join("|");var src_pseudo_letter="(?:(?!"+src_ZPCc+")"+src_Any+")";var src_pseudo_letter_non_d="(?:(?![0-9]|"+src_ZPCc+")"+src_Any+")";var src_ip4=exports.src_ip4="(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)";exports.src_auth="(?:(?:(?!"+src_ZCc+").)+@)?";var src_port=exports.src_port="(?::(?:6(?:[0-4]\\d{3}|5(?:[0-4]\\d{2}|5(?:[0-2]\\d|3[0-5])))|[1-5]?\\d{1,4}))?";var src_host_terminator=exports.src_host_terminator="(?=$|"+src_ZPCc+")(?!-|_|:\\d|\\.-|\\.(?!$|"+src_ZPCc+"))";var src_path=exports.src_path="(?:"+"[/?#]"+"(?:"+"(?!"+src_ZCc+"|[()[\\]{}.,\"'?!\\-]).|"+"\\[(?:(?!"+src_ZCc+"|\\]).)*\\]|"+"\\((?:(?!"+src_ZCc+"|[)]).)*\\)|"+"\\{(?:(?!"+src_ZCc+"|[}]).)*\\}|"+'\\"(?:(?!'+src_ZCc+'|["]).)+\\"|'+"\\'(?:(?!"+src_ZCc+"|[']).)+\\'|"+"\\'(?="+src_pseudo_letter+").|"+"\\.{2,3}[a-zA-Z0-9%/]|"+"\\.(?!"+src_ZCc+"|[.]).|"+"\\-(?!--(?:[^-]|$))(?:-*)|"+"\\,(?!"+src_ZCc+").|"+"\\!(?!"+src_ZCc+"|[!]).|"+"\\?(?!"+src_ZCc+"|[?])."+")+"+"|\\/"+")?";var src_email_name=exports.src_email_name='[\\-;:&=\\+\\$,\\"\\.a-zA-Z0-9_]+';var src_xn=exports.src_xn="xn--[a-z0-9\\-]{1,59}";var src_domain_root=exports.src_domain_root="(?:"+src_xn+"|"+src_pseudo_letter_non_d+"{1,63}"+")";var src_domain=exports.src_domain="(?:"+src_xn+"|"+"(?:"+src_pseudo_letter+")"+"|"+"(?:"+src_pseudo_letter+"(?:-(?!-)|"+src_pseudo_letter+"){0,61}"+src_pseudo_letter+")"+")";var src_host=exports.src_host="(?:"+src_ip4+"|"+"(?:(?:(?:"+src_domain+")\\.)*"+src_domain_root+")"+")";var tpl_host_fuzzy=exports.tpl_host_fuzzy="(?:"+src_ip4+"|"+"(?:(?:(?:"+src_domain+")\\.)+(?:%TLDS%))"+")";var tpl_host_no_ip_fuzzy=exports.tpl_host_no_ip_fuzzy="(?:(?:(?:"+src_domain+")\\.)+(?:%TLDS%))";exports.src_host_strict=src_host+src_host_terminator;var tpl_host_fuzzy_strict=exports.tpl_host_fuzzy_strict=tpl_host_fuzzy+src_host_terminator;exports.src_host_port_strict=src_host+src_port+src_host_terminator;var tpl_host_port_fuzzy_strict=exports.tpl_host_port_fuzzy_strict=tpl_host_fuzzy+src_port+src_host_terminator;var tpl_host_port_no_ip_fuzzy_strict=exports.tpl_host_port_no_ip_fuzzy_strict=tpl_host_no_ip_fuzzy+src_port+src_host_terminator;exports.tpl_host_fuzzy_test="localhost|\\.\\d{1,3}\\.|(?:\\.(?:%TLDS%)(?:"+src_ZPCc+"|$))";exports.tpl_email_fuzzy="(^|>|"+src_ZCc+")("+src_email_name+"@"+tpl_host_fuzzy_strict+")";exports.tpl_link_fuzzy="(^|(?![.:/\\-_@])(?:[$+<=>^`|]|"+src_ZPCc+"))"+"((?![$+<=>^`|])"+tpl_host_port_fuzzy_strict+src_path+")";exports.tpl_link_no_ip_fuzzy="(^|(?![.:/\\-_@])(?:[$+<=>^`|]|"+src_ZPCc+"))"+"((?![$+<=>^`|])"+tpl_host_port_no_ip_fuzzy_strict+src_path+")"},{"uc.micro/categories/Cc/regex":61,"uc.micro/categories/P/regex":63,"uc.micro/categories/Z/regex":64,"uc.micro/properties/Any/regex":66}],56:[function(require,module,exports){"use strict";var decodeCache={};function getDecodeCache(exclude){var i,ch,cache=decodeCache[exclude];if(cache){return cache}cache=decodeCache[exclude]=[];for(i=0;i<128;i++){ch=String.fromCharCode(i);cache.push(ch)}for(i=0;i<exclude.length;i++){ch=exclude.charCodeAt(i);cache[ch]="%"+("0"+ch.toString(16).toUpperCase()).slice(-2)}return cache}function decode(string,exclude){var cache;if(typeof exclude!=="string"){exclude=decode.defaultChars}cache=getDecodeCache(exclude);return string.replace(/(%[a-f0-9]{2})+/gi,function(seq){var i,l,b1,b2,b3,b4,chr,result="";for(i=0,l=seq.length;i<l;i+=3){b1=parseInt(seq.slice(i+1,i+3),16);if(b1<128){result+=cache[b1];continue}if((b1&224)===192&&i+3<l){b2=parseInt(seq.slice(i+4,i+6),16);if((b2&192)===128){chr=b1<<6&1984|b2&63;if(chr<128){result+=""}else{result+=String.fromCharCode(chr)}i+=3;continue}}if((b1&240)===224&&i+6<l){b2=parseInt(seq.slice(i+4,i+6),16);b3=parseInt(seq.slice(i+7,i+9),16);if((b2&192)===128&&(b3&192)===128){chr=b1<<12&61440|b2<<6&4032|b3&63;if(chr<2048||chr>=55296&&chr<=57343){result+=""}else{result+=String.fromCharCode(chr)}i+=6;continue}}if((b1&248)===240&&i+9<l){b2=parseInt(seq.slice(i+4,i+6),16);b3=parseInt(seq.slice(i+7,i+9),16);b4=parseInt(seq.slice(i+10,i+12),16);if((b2&192)===128&&(b3&192)===128&&(b4&192)===128){chr=b1<<18&1835008|b2<<12&258048|b3<<6&4032|b4&63;if(chr<65536||chr>1114111){result+=""}else{chr-=65536;result+=String.fromCharCode(55296+(chr>>10),56320+(chr&1023))}i+=9;continue}}result+=""}return result})}decode.defaultChars=";/?:@&=+$,#";decode.componentChars="";module.exports=decode},{}],57:[function(require,module,exports){"use strict";var encodeCache={};function getEncodeCache(exclude){var i,ch,cache=encodeCache[exclude];if(cache){return cache}cache=encodeCache[exclude]=[];for(i=0;i<128;i++){ch=String.fromCharCode(i);if(/^[0-9a-z]$/i.test(ch)){cache.push(ch)}else{cache.push("%"+("0"+i.toString(16).toUpperCase()).slice(-2))}}for(i=0;i<exclude.length;i++){cache[exclude.charCodeAt(i)]=exclude[i]}return cache}function encode(string,exclude,keepEscaped){var i,l,code,nextCode,cache,result="";if(typeof exclude!=="string"){keepEscaped=exclude;exclude=encode.defaultChars}if(typeof keepEscaped==="undefined"){keepEscaped=true}cache=getEncodeCache(exclude);for(i=0,l=string.length;i<l;i++){code=string.charCodeAt(i);if(keepEscaped&&code===37&&i+2<l){if(/^[0-9a-f]{2}$/i.test(string.slice(i+1,i+3))){result+=string.slice(i,i+3);i+=2;continue}}if(code<128){result+=cache[code];continue}if(code>=55296&&code<=57343){if(code>=55296&&code<=56319&&i+1<l){nextCode=string.charCodeAt(i+1);if(nextCode>=56320&&nextCode<=57343){result+=encodeURIComponent(string[i]+string[i+1]);i++;continue}}result+="%EF%BF%BD";continue}result+=encodeURIComponent(string[i])}return result}encode.defaultChars=";/?:@&=+$,-_.!~*'()#";encode.componentChars="-_.!~*'()";module.exports=encode},{}],58:[function(require,module,exports){"use strict";module.exports=function format(url){var result="";result+=url.protocol||"";result+=url.slashes?"//":"";result+=url.auth?url.auth+"@":"";if(url.hostname&&url.hostname.indexOf(":")!==-1){result+="["+url.hostname+"]"}else{result+=url.hostname||""}result+=url.port?":"+url.port:"";result+=url.pathname||"";result+=url.search||"";result+=url.hash||"";return result}},{}],59:[function(require,module,exports){"use strict";module.exports.encode=require("./encode");module.exports.decode=require("./decode");module.exports.format=require("./format");module.exports.parse=require("./parse")},{"./decode":56,"./encode":57,"./format":58,"./parse":60}],60:[function(require,module,exports){"use strict";function Url(){this.protocol=null;this.slashes=null;this.auth=null;this.port=null;this.hostname=null;this.hash=null;this.search=null;this.pathname=null}var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,simplePathPattern=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,delims=["<",">",'"',"`"," ","\r","\n","\t"],unwise=["{","}","|","\\","^","`"].concat(delims),autoEscape=["'"].concat(unwise),nonHostChars=["%","/","?",";","#"].concat(autoEscape),hostEndingChars=["/","?","#"],hostnameMaxLen=255,hostnamePartPattern=/^[+a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,hostlessProtocol={javascript:true,"javascript:":true},slashedProtocol={http:true,https:true,ftp:true,gopher:true,file:true,"http:":true,"https:":true,"ftp:":true,"gopher:":true,"file:":true};function urlParse(url,slashesDenoteHost){if(url&&url instanceof Url){return url}var u=new Url;u.parse(url,slashesDenoteHost);return u}Url.prototype.parse=function(url,slashesDenoteHost){var i,l,lowerProto,hec,slashes,rest=url;rest=rest.trim();if(!slashesDenoteHost&&url.split("#").length===1){var simplePath=simplePathPattern.exec(rest);if(simplePath){this.pathname=simplePath[1];if(simplePath[2]){this.search=simplePath[2]}return this}}var proto=protocolPattern.exec(rest);if(proto){proto=proto[0];lowerProto=proto.toLowerCase();this.protocol=proto;rest=rest.substr(proto.length)}if(slashesDenoteHost||proto||rest.match(/^\/\/[^@\/]+@[^@\/]+/)){slashes=rest.substr(0,2)==="//";if(slashes&&!(proto&&hostlessProtocol[proto])){rest=rest.substr(2);this.slashes=true}}if(!hostlessProtocol[proto]&&(slashes||proto&&!slashedProtocol[proto])){var hostEnd=-1;for(i=0;i<hostEndingChars.length;i++){hec=rest.indexOf(hostEndingChars[i]);if(hec!==-1&&(hostEnd===-1||hec<hostEnd)){hostEnd=hec}}var auth,atSign;if(hostEnd===-1){atSign=rest.lastIndexOf("@")}else{atSign=rest.lastIndexOf("@",hostEnd)}if(atSign!==-1){auth=rest.slice(0,atSign);rest=rest.slice(atSign+1);this.auth=auth}hostEnd=-1;for(i=0;i<nonHostChars.length;i++){hec=rest.indexOf(nonHostChars[i]);if(hec!==-1&&(hostEnd===-1||hec<hostEnd)){hostEnd=hec}}if(hostEnd===-1){hostEnd=rest.length}if(rest[hostEnd-1]===":"){hostEnd--}var host=rest.slice(0,hostEnd);rest=rest.slice(hostEnd);this.parseHost(host);this.hostname=this.hostname||"";var ipv6Hostname=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!ipv6Hostname){var hostparts=this.hostname.split(/\./);for(i=0,l=hostparts.length;i<l;i++){var part=hostparts[i];if(!part){continue}if(!part.match(hostnamePartPattern)){var newpart="";for(var j=0,k=part.length;j<k;j++){if(part.charCodeAt(j)>127){newpart+="x"}else{newpart+=part[j]}}if(!newpart.match(hostnamePartPattern)){var validParts=hostparts.slice(0,i);var notHost=hostparts.slice(i+1);var bit=part.match(hostnamePartStart);if(bit){validParts.push(bit[1]);notHost.unshift(bit[2])}if(notHost.length){rest=notHost.join(".")+rest}this.hostname=validParts.join(".");break}}}}if(this.hostname.length>hostnameMaxLen){this.hostname=""}if(ipv6Hostname){this.hostname=this.hostname.substr(1,this.hostname.length-2)}}var hash=rest.indexOf("#");if(hash!==-1){this.hash=rest.substr(hash);rest=rest.slice(0,hash)}var qm=rest.indexOf("?");if(qm!==-1){this.search=rest.substr(qm);rest=rest.slice(0,qm)}if(rest){this.pathname=rest}if(slashedProtocol[lowerProto]&&this.hostname&&!this.pathname){this.pathname=""}return this};Url.prototype.parseHost=function(host){var port=portPattern.exec(host);if(port){port=port[0];if(port!==":"){this.port=port.substr(1)}host=host.substr(0,host.length-port.length)}if(host){this.hostname=host}};module.exports=urlParse},{}],61:[function(require,module,exports){module.exports=/[\0-\x1F\x7F-\x9F]/},{}],62:[function(require,module,exports){module.exports=/[\xAD\u0600-\u0605\u061C\u06DD\u070F\u180E\u200B-\u200F\u202A-\u202E\u2060-\u2064\u2066-\u206F\uFEFF\uFFF9-\uFFFB]|\uD804\uDCBD|\uD82F[\uDCA0-\uDCA3]|\uD834[\uDD73-\uDD7A]|\uDB40[\uDC01\uDC20-\uDC7F]/},{}],63:[function(require,module,exports){module.exports=/[!-#%-\*,-/:;\?@\[-\]_\{\}\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E42\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC8\uDDCD\uDE38-\uDE3D]|\uD805[\uDCC6\uDDC1-\uDDC9\uDE41-\uDE43]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD82F\uDC9F/},{}],64:[function(require,module,exports){module.exports=/[ \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000]/},{}],65:[function(require,module,exports){module.exports.Any=require("./properties/Any/regex");module.exports.Cc=require("./categories/Cc/regex");module.exports.Cf=require("./categories/Cf/regex");module.exports.P=require("./categories/P/regex");module.exports.Z=require("./categories/Z/regex")},{"./categories/Cc/regex":61,"./categories/Cf/regex":62,"./categories/P/regex":63,"./categories/Z/regex":64,"./properties/Any/regex":66}],66:[function(require,module,exports){module.exports=/[\0-\uD7FF\uDC00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF]/},{}],67:[function(require,module,exports){"use strict";module.exports=require("./lib/")},{"./lib/":9}]},{},[67])(67)});(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define("markdown-it-attrs",[],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.markdownItAttrs=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";var utils=require("./utils.js");module.exports=function attributes(md){function curlyAttrs(state){var tokens=state.tokens;var l=tokens.length;for(var i=0;i<l;++i){if(tokens[i].block&&tokens[i].info&&hasCurly(tokens[i].info)){var codeCurlyStart=tokens[i].info.indexOf("{");var codeCurlyEnd=tokens[i].info.length-1;var codeAttrs=utils.getAttrs(tokens[i].info,codeCurlyStart+1,codeCurlyEnd);utils.addAttrs(codeAttrs,tokens[i]);tokens[i].info=tokens[i].info.substring(0,codeCurlyStart);continue}if(tokens[i].type!=="inline"){continue}var inlineTokens=tokens[i].children;if(!inlineTokens||inlineTokens.length<=0){continue}for(var j=0,k=inlineTokens.length;j<k;++j){if(!inlineTokens[j]||inlineTokens[j].type!=="text"){continue}if(!inlineTokens[j-1]||inlineTokens[j-1].nesting===1){continue}if(inlineTokens[j].content[0]!=="{"){continue}var endChar=inlineTokens[j].content.indexOf("}");if(endChar===-1){continue}var attrToken=matchingOpeningToken(inlineTokens,j-1);if(!attrToken){continue}var attrs=utils.getAttrs(inlineTokens[j].content,1,endChar);if(attrs.length!==0){inlineTokens[j].content=inlineTokens[j].content.substr(endChar+1);attrToken.info="b";utils.addAttrs(attrs,attrToken)}}if(hasCurly(tokens[i].content)){var content=last(inlineTokens).content;var curlyStart=content.lastIndexOf("{");var attrs=utils.getAttrs(content,curlyStart+1,content.length-1);if(content[curlyStart-1]===" "){curlyStart-=1}var nextLastInline=nextLast(inlineTokens);var possibleBulletListOpen=secondTokenNotHidden(tokens,i-1);if(nextLastInline&&possibleBulletListOpen&&nextLastInline.type==="softbreak"&&possibleBulletListOpen.type==="bullet_list_open"){utils.addAttrs(attrs,secondTokenNotHidden(tokens,i-1));tokens[i].children=inlineTokens.slice(0,-2)}else{utils.addAttrs(attrs,firstTokenNotHidden(tokens,i-1));last(inlineTokens).content=content.slice(0,curlyStart)}}}}md.core.ruler.before("replacements","curly_attributes",curlyAttrs);md.renderer.rules.code_inline=renderCodeInline};function renderCodeInline(tokens,idx,_,__,slf){var token=tokens[idx];return"<code"+slf.renderAttrs(token)+">"+utils.escapeHtml(tokens[idx].content)+"</code>"}function hasCurly(str){if(!str||!str.length||str.length<4){return false}if(str.charAt(str.length-1)!=="}"){return false}if(str.indexOf("{")===-1){return false}return true}function firstTokenNotHidden(tokens,i){if(tokens[i]&&tokens[i].hidden){return firstTokenNotHidden(tokens,i-1)}return tokens[i]}function secondTokenNotHidden(tokens,i){if(tokens[i]&&tokens[i].hidden){return secondTokenNotHidden(tokens,i-1)}return firstTokenNotHidden(tokens,i-1)}function matchingOpeningToken(tokens,i){if(tokens[i].type==="softbreak"){return false}if(tokens[i].nesting===0){return tokens[i]}var type=tokens[i].type.replace("_close","_open");for(;i>=0;--i){if(tokens[i].type===type){return tokens[i]}}}function last(arr){return arr.slice(-1)[0]}function nextLast(arr){return arr.slice(-2,-1)[0]}},{"./utils.js":2}],2:[function(require,module,exports){exports.getAttrs=function(str,start,end){var allowedKeyChars=/[^\t\n\f \/>"'=]/;var pairSeparator=" ";var keySeparator="=";var classChar=".";var idChar="#";var attrs=[];var key="";var value="";var parsingKey=true;var valueInsideQuotes=false;for(var i=start;i<=end;++i){var char=str.charAt(i);if(char===keySeparator){parsingKey=false;continue}if(char===classChar&&key===""){key="class";parsingKey=false;continue}if(char===idChar&&key===""){key="id";parsingKey=false;continue}if(char==='"'&&value===""){valueInsideQuotes=true;continue}if(char==='"'&&valueInsideQuotes){valueInsideQuotes=false;continue}if(char===pairSeparator&&!valueInsideQuotes||i===end){if(key===""){continue}attrs.push([key,value]);key="";value="";parsingKey=true;continue}if(parsingKey&&char.search(allowedKeyChars)===-1){continue}if(parsingKey){key+=char;continue}value+=char}return attrs};exports.addAttrs=function(attrs,token){for(var j=0,l=attrs.length;j<l;++j){var key=attrs[j][0];if(key==="class"&&token.attrIndex("class")!==-1){var classIdx=token.attrIndex("class");token.attrs[classIdx][1]+=" "+attrs[j][1]}else{token.attrPush(attrs[j])}}return token};var HTML_ESCAPE_TEST_RE=/[&<>"]/;var HTML_ESCAPE_REPLACE_RE=/[&<>"]/g;var HTML_REPLACEMENTS={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};function replaceUnsafeChar(ch){return HTML_REPLACEMENTS[ch]}exports.escapeHtml=function(str){if(HTML_ESCAPE_TEST_RE.test(str)){return str.replace(HTML_ESCAPE_REPLACE_RE,replaceUnsafeChar)}return str}},{}]},{},[1])(1)});define("src/helpers/markdown",["markdown-it","markdown-it-attrs"],function(MarkdownIt,MarkdownItAttrs){"use strict";var markdownIt=new MarkdownIt({breaks:true});markdownIt.use(MarkdownItAttrs);return{toHTML:function toHTML(source){markdownIt.set({html:false});return markdownIt.render(source)},toHTMLUnsanitized:function toHTMLUnsanitized(source){markdownIt.set({html:true});return markdownIt.render(source)}}});define("css!css/component.css",["css!css/compiled.css"],function(){});define("css!src/uhd/css/componentOptionsSummary.css",["css!src/uhd/css/compiled.css"],function(){});define("css!src/uhd/css/uhdPopup.css",["css!src/uhd/css/compiled.css"],function(){});define("src/components/Component",["q","async","backbone","underscore","jquery","src/ReactAppLoader","src/permissions","src/helpers/uhdHelpers","src/helpers/componentEventsHelper","src/globals/queries","src/globals/theme","src/events/componentEvents","src/events/globalEventNames","src/globals/categories","src/globals/currentDashboard","src/globals/currentProject","src/globals/queryGroups","src/globals/languages","src/globals/tags","src/views/ControlsView","src/views/UtilsBarView","src/models/ExportMenu","src/views/ExportMenuView","src/uhd/views/UHDPopupView","src/analytics/Analytics","src/exportManager","bw-fe-helpers/isoDateHelper","bw-fe-helpers/dateRangeFormatter","mustache!templates/component","mustache!templates/componentOptionsSummary","src/helpers/markdown","src/packages/customtip","lib/jquery.confirm","css!css/component.css","css!src/uhd/css/componentOptionsSummary.css","css!src/uhd/css/uhdPopup.css"],function(Q,async,Backbone,_,$,ReactAppLoader,permissions,uhdHelpers,componentEventsHelper,queries,theme,componentEvents,globalEventNames,categories,currentDashboard,currentProject,queryGroups,globalLanguages,tags,ControlsView,UtilsBarView,ExportMenuModel,ExportMenuView,UHDPopupView,Analytics,exportManager,isoDateHelper,dateRangeFormatter,componentTemplate,optionsSummaryTemplate,markdown){"use strict";var COMPONENT_EVENT_NAMES=globalEventNames.COMPONENTS;var MIN_COMPACT_COMPONENT_WIDTH=800;function triggerComponentInitialLoadEvent(view,viewKey){view._triggerComponentLoadedTrackingEvent({loadingType:"initialLoad",view:viewKey})}function onDataObjectSync(component){component.updateOptionsSummary();component.toggleUnlimitedHistoricDataIcon();component.enableApplyChanges()}function listenToDataEvents(component,dataObject){var onDataObjectSyncWithComponent=onDataObjectSync.bind(null,component);if(!dataObject){return}component.listenTo(dataObject,"request",function onRequest(dataObject,xhr,options){component.disableApplyChanges(dataObject,xhr,options)});component.listenTo(dataObject,"sync",onDataObjectSyncWithComponent);component.listenTo(dataObject,"error",onDataObjectSyncWithComponent)}function addEventForPermission(events,permission,event){if(permissions.check(permission,currentDashboard)){_.extend(events,event)}}function onClickCloseIcon(view){var REMOVE_SINGLE="removeSingle";var REMOVE_ALL="removeAll";function confirmCallback(result){if(!result){return}if(result===REMOVE_SINGLE){view.removeAnnotationElement();componentEvents.trigger(COMPONENT_EVENT_NAMES.ANNOTATION_REMOVED,view);return}if(result===REMOVE_ALL){componentEvents.trigger(COMPONENT_EVENT_NAMES.ANNOTATION_REMOVED_ALL);return}}$.confirm({title:"Remove Explanation",text:'Are you sure you want to <strong>remove this Explanation</strong>?<div class="grey smallpadding-top">'+"You can also remove all Explanations in this Dashboard.</div>",dialogClass:"smallpopup",escape:false,buttons:[{text:"Remove",className:"ok",value:REMOVE_SINGLE,keyCode:13},{text:"Remove all Explanations",className:"cancel",value:REMOVE_ALL},{text:"Cancel",className:"cancel",value:false,keyCode:27}]},confirmCallback)}function showUHDPopup(view,event){UHDPopupView.show($(event.currentTarget),view.getHistoricData())}function removeUHDPopup(){UHDPopupView.destroy()}function getAnnotationData(annotation){var annotationData={};if(!annotation){return annotationData}annotationData.author=getAnnotationAuthor(annotation);annotationData.content=getAnnotationContent(annotation);annotationData.feedback=getAnnotationFeedback(annotation);return annotationData}function getAnnotationAuthor(annotation){if(!annotation.author||theme.canSeeAnnotationAuthor!==true){return}return annotation.author}function getAnnotationContent(annotation){if(!annotation.content){return}return markdown.toHTMLUnsanitized(annotation.content)}function getAnnotationFeedback(annotation){if(!annotation.feedback||theme.canSeeAnnotationFeedback!==true){return}return markdown.toHTMLUnsanitized(annotation.feedback)}return Backbone.View.extend({tagName:"article",className:"component clearfix",events:function events(){var events={"click .js-close-annotation":onClickCloseIcon.bind(null,this),"mouseenter .uhd-component-header":showUHDPopup.bind(null,this),"mouseleave .uhd-component-header":removeUHDPopup};addEventForPermission(events,"edit.dashboard",{"dblclick .componentHeader h1":"editName"});addEventForPermission(events,"see.dashboard.controls.queryField",{"click .optionsSummary .query":"onClickOptionsSummaryQuery"});addEventForPermission(events,"see.dashboard.controls.dateRange",{"click .optionsSummary .dateRange":"onClickOptionsSummaryDate"});return events},initialize:function initialize(options){var listenToDataEventsWithComponent=listenToDataEvents.bind(null,this);this.resize=_.debounce(this.resize,100);if(!this.model&&!this.collection){throw new Error("this.model or this.collection needs to be set")}if(this.getControlsModelClass){throw new Error("getControlsModelClass no longer supported - use DataModel and DataModel.controlsModel")}options=options||{};if(options.customizeBarConfiguration){this.customizeBarConfiguration=options.customizeBarConfiguration;this.customizeBarOpen=options.customizeBarOpen!==false;this.customizeBarReactApp=new ReactAppLoader("customizeBarApp");this.listenTo(this.settings,"change",this.renderCustomizeBar)}this.tabName=options.tabName;this.componentName=options.componentName||"Component";this.type=options.type;this.title=options.title;this.annotation=options.annotation;this.settings=(this.model||this.collection).settings;this.isBeta=options.isBeta;this.isPrototype=options.isPrototype;this.optionsDisplayed=!!options.optionsDisplayed;this.resetComponentPageSelection();[this.model,this.collection].forEach(listenToDataEventsWithComponent);this.listenTo(this.settings,"change",this.refreshViews);this.listenTo(this.settings,"change",this.updateOptionsSummary);this.listenTo(this.settings,"change",this.raiseSettingsChangedEvent);this.listenTo(componentEvents,COMPONENT_EVENT_NAMES.CLOSE_ALL_ANNOTATIONS,_.partial(this.removeAnnotationElement,this));this._viewCache={};this.exportModel=new ExportMenuModel({showXlsCsv:true,showImage:false});this.setInitialView(options.activeView)},remove:function remove(){if(this._viewCache&&Object.keys(this._viewCache).length>0){Object.values(this._viewCache).forEach(function(view){view.remove()});this._viewCache=undefined}if(this.controlsView){this.controlsView.off();this.controlsView.remove();this.controlsView=undefined}if(this.utilsBarView){this.utilsBarView.off();this.utilsBarView.remove();this.utilsBarView=undefined}if(this.exportView){this.exportView.off();this.exportView.remove();this.exportView=undefined}this.settings.off("change",this.refreshViews,this);this.settings.off("change",this.updateOptionsSummary,this);this.settings.off("change",this.raiseSettingsChangedEvent,this);if(this.customizeBarReactApp){this.settings.off("change",this.renderCustomizeBar,this);this.customizeBarReactApp.remove()}Backbone.View.prototype.remove.call(this)},disableApplyChanges:function disableApplyChanges(){var _this=this;if(this.buildControlsViewPromise){this.buildControlsViewPromise.then(function(){_this.controlsView.disableApplyChanges()})}},enableApplyChanges:function enableApplyChanges(){var _this2=this;if(this.buildControlsViewPromise){this.buildControlsViewPromise.then(function(){_this2.controlsView.enableApplyChanges()})}},getDataSource:function getDataSource(){return this.collection||this.model},getHistoricData:function getHistoricData(){return uhdHelpers.getHistoricData(this.getDataSource())},hasHistoricData:function hasHistoricData(startDate){return uhdHelpers.hasHistoricData(this.getDataSource(),startDate)},toggleUnlimitedHistoricDataIcon:function toggleUnlimitedHistoricDataIcon(){var startDate=this.settings.getQueryData().startDate;var shouldShowIcon=this.hasHistoricData(startDate);this.$(".optionsSummary .uhd-component-header").toggleClass("hidden",!shouldShowIcon)},minimise:function minimise(){this.$el.toggleClass("minimised");if(!this.$el.hasClass("minimised")){this.resize()}},close:function close(callback){var self=this;this.checkPermission("edit.dashboard");$.confirm({title:"Delete Component",text:'Are you sure you want to delete the Component "'+self.title+'" ?'},callback)},cleanup:function cleanup(result){if(!result){return}this.trigger("closed",this);this.remove();componentEvents.trigger(COMPONENT_EVENT_NAMES.COMPONENT_REMOVED,{componentName:this.componentName,dashboardId:currentDashboard.id,projectId:currentProject.id});Analytics.trackEvent({name:"Component."+this.componentName,action:"Remove",origin:this.cid})},duplicate:function duplicate(){this.trigger("duplicate",this)},copy:function copy(){this.trigger("copy",this)},paste:function paste(){this.trigger("paste",this)},onClickOptionsSummaryQuery:function onClickOptionsSummaryQuery(){this.displayComponentControls()},onClickOptionsSummaryDate:function onClickOptionsSummaryDate(){this.displayComponentControls()},displayComponentControls:function displayComponentControls(){this.showControls(true);this.utilsBarView.showControls(true)},reload:function reload(){this.controlsView.applyChanges()},showControls:function showControls(enable){var _this3=this;var $el=this.$el,$form;this.checkPermission("see.dashboard.controls");if(enable&&!$el.hasClass("noControls")){$form=$el.find(".controls--section.querySettings").addClass("flash");_.defer(function(){$form.removeClass("flash")});return}$el.toggleClass("noControls",!enable);$el.toggleClass("hasControls",enable);this.optionsDisplayed=enable;this.resize();return this.buildControlsViewPromise.then(function(){if(enable){if(_this3.controlsView.showInputsGuider&&typeof _this3.controlsView.showInputsGuider==="function"){_this3.controlsView.showInputsGuider()}return}if(_this3.controlsView.closeInputsGuider&&typeof _this3.controlsView.closeInputsGuider==="function"){_this3.controlsView.closeInputsGuider()}})},toggleControls:function toggleControls(){return this.showControls(this.$el.hasClass("noControls"))},editName:function editName(){var self=this,h1=this.$("> header h1"),oldName=h1.text(),newName,input;this.checkPermission("edit.dashboard");if(h1.children("input").length){return}input=$('<input name="dashboardComponentName" type="text" />').val(oldName).blur(function(){newName=input.val()||oldName;h1.html(newName).attr("title",self.getTitleTooltip(newName)).customtip();self.title=newName;self.raiseTitleChangedEvent()}).keyup(function(e){if(e.which===13){input.blur()}else if(e.which===27){h1.html(oldName).attr("title",self.getTitleTooltip(oldName)).customtip()}});h1.attr("title","Enter Component name").customtip();h1.html(input);input.focus()},getTitleTooltip:function getTitleTooltip(title){return'Double click "'+_.escape(title)+'" to rename this Component'},checkPermission:function checkPermission(permissionName){if(!permissions.check(permissionName,currentDashboard)){throw new Error("User doesn't have the permission to perform this action")}},getExportMenuViewClass:function getExportMenuViewClass(){return ExportMenuView},getUtilsBarViewClass:function getUtilsBarViewClass(){return UtilsBarView},translateLegacyViewName:function translateLegacyViewName(name){return name},resetComponentPageSelection:function resetComponentPageSelection(){var settings=this.settings;if(settings&&settings.get("page")){settings.set("page",0)}},setInitialView:function setInitialView(viewName){var views=this.getViews(),viewKey;if(!viewName){this.currentViewKey=this.getDefaultView();return}if(views[viewName]){this.currentViewKey=viewName;return}viewKey=this.translateLegacyViewName(viewName);if(views[viewKey]){this.currentViewKey=viewKey;return}console.warn("could not load view with name:",viewKey);this.currentViewKey=this.getDefaultView()},getDefaultView:function getDefaultView(){var views=this.getViews(),defaultViewKey=_(views).chain().keys().find(function(key){return views[key].isDefault===true}).value();return defaultViewKey},getHelpKey:function getHelpKey(){return"Component"},buildView:function buildView(key,options){var view=new(this.getViews()[key].type)(_.extend({model:this.model,collection:this.collection,settings:this.settings,exportModel:this.exportModel,categories:categories},options));this.listenTo(view,"notify",this.onNotify);return view},onNotify:function onNotify(options){this.showTemporaryNotification(options)},showTemporaryNotification:function showTemporaryNotification(options){this.$(".temporary-notifications").showNotification(_.defaults(options,{duration:5e3}))},switchView:function switchView(viewKey,options){Analytics.trackEvent({name:"Component."+this.componentName,action:"Switch_to_view_"+viewKey,origin:"Application"});this.showView(viewKey,options);this._triggerComponentLoadedTrackingEvent({loadingType:"viewChange",view:viewKey,previousView:this.currentViewKey})},showView:function showView(viewKey,options){var view=this._viewCache[viewKey];var viewSpec=this.getViews()[viewKey];var contentArea=this.$(".content");Analytics.trackEvent({name:"Component."+this.componentName,action:"Show_view_"+viewKey,origin:"Application"});if(!view){view=this.buildView(viewKey,viewSpec.options);contentArea.append(view.el);view.render()}else{view.$el.show()}if(this.currentView){this.currentView.$el.hide();this.currentView.hidden()}view.shown();this.currentView=this._viewCache[viewKey]=view;this.currentViewKey=viewKey;if(!options||!options.silent){this.trigger("switchView",this,viewKey)}},refreshViews:function refreshViews(){var self=this,cacheKeys=_.keys(this._viewCache);_(cacheKeys).each(function(key){var view=self._viewCache[key];if(view!==self.currentView){delete self._viewCache[key];view.off();view.remove()}})},updateOptionsSummary:function updateOptionsSummary(){var self=this;var currentMode=this.settings.get("currentMode");var queryIds=[].concat(this.settings.get("queryId")||[]);var queryGroupId=this.settings.get("queryGroupId");var dateRange=this.settings.get("dateRange");var timezone=currentDashboard.getTimezone();var dateRangeFormattingOptions={specifyTime:this.settings.get("specifyTime"),timezone:timezone,addTimezoneOffsetInfo:currentDashboard.isProjectsTimezoneOverriden()};var dateTooltip;var formattedDateRange;var templateData;var queryGroup;var isoDateRange;if(isoDateHelper.isISODatePeriod(dateRange)){isoDateRange=isoDateHelper.convertToISODateRange(dateRange,{timezone:timezone});dateTooltip=isoDateRange?dateRangeFormatter.format(isoDateRange,dateRangeFormattingOptions):null}formattedDateRange=dateRange?dateRangeFormatter.format(dateRange,dateRangeFormattingOptions):"";templateData={dateRange:formattedDateRange,dateTooltip:dateTooltip,queryIsReadOnly:!permissions.check("edit.queries",currentDashboard),dateIsReadOnly:!permissions.check("see.dashboard.controls.dateRange"),hasSolrData:this.getDataSource().hasSolrData};function renderOptionsSummary(){self.$(".optionsSummary").html(optionsSummaryTemplate(templateData)).customtip()}if(!permissions.check("see.dashboard.component.optionsSummary",currentDashboard)){return}if(queryGroupId&&(!currentMode||currentMode==="queryGroup")){queryGroup=queryGroups.get(queryGroupId);if(queryGroup){templateData.label="Group";templateData.queryName=queryGroup.get("name");templateData.queryTooltip=templateData.queryName;templateData.hasQueryName=true;templateData.hasTitleOrQueryName=true}return renderOptionsSummary()}templateData.label="Data";templateData.hasQueryName=true;templateData.hasTitleOrQueryName=true;templateData.queryName="Loading...";self.$(".optionsSummary").html(optionsSummaryTemplate(templateData)).customtip();async.map(queryIds,function(id,callback){var query=queries.get(id),queryType,queryName,queryString,queryTooltip;if(!query){return callback(null,{})}queryType=query.get("type");queryName=query.get("name");queryTooltip=queryName;if(queryType==="text"||queryType==="structured"){queryString=_.compact([].concat(query.get("includedTerms"),query.get("contextTerms"),query.get("excludedTerms"))).join(", ");if(queryString){queryTooltip+=" [ "+_.truncate(queryString,24)+" ]"}}if(queryType==="publicfacebook"){queryTooltip+=" (Facebook Channel)"}if(queryType==="twitter"){queryTooltip+=" (Twitter Channel)"}callback(null,{name:queryName,tooltip:queryTooltip})},function(err,queryDetails){if(!queryDetails.length){templateData.hasQueryName=false}templateData.hasTitleOrQueryName=templateData.hasQueryName||!!self.title;templateData.queryName=_(queryDetails).pluck("name").join(", ");templateData.queryTooltip=_(queryDetails).pluck("tooltip").join(", ");renderOptionsSummary()})},raiseSettingsChangedEvent:function raiseSettingsChangedEvent(){this.trigger("settingsChanged",this,this.settings.toJSON())},raiseTitleChangedEvent:function raiseTitleChangedEvent(){this.trigger("titleChanged",this,this.title)},getViews:function getViews(){throw new Error("oops - looks like you didn't implement getViews")},render:function render(){var _this4=this;var annotationData=getAnnotationData(this.annotation);var data={title:this.title,titleTooltip:this.getTitleTooltip(this.title),dashboardIsReadOnly:!permissions.check("edit.dashboard",currentDashboard),annotation:annotationData.content,author:annotationData.author,feedback:annotationData.feedback,isBeta:this.isBeta,isPrototype:this.isPrototype,hasCustomizeBar:this.customizeBarReactApp,hasCommonCustomizeBar:!!this.customizeBarConfigKey};var viewKey=this.currentViewKey;var $el=this.$el;var renderPromise;data.controlsLabel=permissions.check("see.dashboard.controls.advancedFilters",currentDashboard)?"Controls":"Date";$el.html(componentTemplate(data));this.$(".js-close-annotation, header, .js-component-annotation").customtip();if(data.dashboardIsReadOnly){$el.addClass("readOnly")}this.buildControlsViewPromise=this.buildControlsView();this.buildExportMenuView();this.buildUtilsBarView(viewKey);if(this.customizeBarReactApp){this.buildCustomizeBar()}this.showView(viewKey,{silent:true,buildControlsViewPromise:this.buildControlsViewPromise});renderPromise=this.buildControlsViewPromise.then(function(){triggerComponentInitialLoadEvent(_this4,viewKey)});if(!this.settings.set({},{validate:true})){return renderPromise}_([this.model,this.collection]).forEach(function(obj){if(!obj){return}obj.fetch()});this.updateOptionsSummary();this.updateCompactMode();Analytics.trackEvent({name:"Component."+this.componentName,action:"View"});return renderPromise},renderCustomizeBar:function renderCustomizeBar(){var _this5=this;var toggleCustomizeBar=function toggleCustomizeBar(customizeBarOpen){_this5.customizeBarOpen=!customizeBarOpen;_this5.trigger("customizeBarToggled",_this5,_this5.customizeBarOpen);_this5.renderCustomizeBar()};var onChange=function onChange(oldSettings,formData){return _this5.settings.set(formData.formData||formData,{validate:true})};if(this.customizeBarConfiguration.onChange){onChange=this.customizeBarConfiguration.onChange.bind(this)}this.customizeBarReactApp.render({customizeBarOpen:this.customizeBarOpen,toggleCustomizeBar:toggleCustomizeBar,onChange:onChange,settings:this.settings.toJSON(),schema:this.customizeBarConfiguration.schema,uiSchema:this.customizeBarConfiguration.uiSchema,title:this.customizeBarConfiguration.title||""})},buildCustomizeBar:function buildCustomizeBar(){this.$("[data-reactapp=customize-bar]").append(this.customizeBarReactApp.$el);this.renderCustomizeBar()},buildControlsView:function buildControlsView(){var _this6=this;var $el=this.$el;var deferred=Q.defer();$el.toggleClass("noControls",!this.optionsDisplayed);$el.toggleClass("hasControls",this.optionsDisplayed);globalLanguages.load(function(err,languages){if(err){deferred.reject();return}_this6.controlsView=new _this6.constructor.ControlsViewClass({componentType:_this6.type,categories:categories,model:_this6.settings,el:_this6.$("aside form.controls"),languages:languages,tags:tags});_this6.listenTo(_this6.controlsView,"applyChanges",_this6.onApplyChanges);Promise.resolve(_this6.controlsView.render()).then(function(){if(_this6.controlsView.showInputsGuider&&typeof _this6.controlsView.showInputsGuider==="function"){_this6.controlsView.showInputsGuider()}}).then(function(){deferred.resolve()},function(){deferred.reject()})});return deferred.promise},buildExportMenuView:function buildExportMenuView(){var ExportMenuViewClass=this.getExportMenuViewClass();this.exportView=new ExportMenuViewClass({model:this.exportModel});this.listenTo(this.exportView,"doExport",this.doExport)},buildUtilsBarView:function buildUtilsBarView(viewKey){var views=this.getViews(),UtilsBarViewClass=this.getUtilsBarViewClass();this.utilsBarView=new UtilsBarViewClass({exportView:this.exportView,canExport:this.canExport!==false,canReload:this.canReload!==false,canSeeHelp:this.canSeeHelp!==false,viewList:_(views).map(function(view,key){return{name:view.name,key:key,isActive:key===viewKey,iconClassName:view.iconClassName}}),helpKey:this.getHelpKey()});this.$("header.componentHeader .utilsBarContainer").append(this.utilsBarView.el);this.utilsBarView.render();this.utilsBarView.showControls(this.optionsDisplayed);this.listenTo(this.utilsBarView,"switchView",this.switchView);this.listenTo(this.utilsBarView,"minimise",this.minimise);this.listenTo(this.utilsBarView,"duplicate",this.duplicate);this.listenTo(this.utilsBarView,"close",this.close.bind(this,this.cleanup.bind(this)));this.listenTo(this.utilsBarView,"reload",this.reload);this.listenTo(this.utilsBarView,"toggleControls",this.toggleControls);this.listenTo(this.utilsBarView,"copy",this.copy);this.listenTo(this.utilsBarView,"paste",this.paste)},shown:function shown(){if(this.currentView){this.currentView.shown()}},hidden:function hidden(){if(this.currentView){this.currentView.hidden()}if(this.controlsView&&this.controlsView.closeInputsGuider&&typeof this.controlsView.closeInputsGuider==="function"){this.controlsView.closeInputsGuider()}},resize:function resize(){var self=this;this.updateCompactMode();_(this._viewCache).each(function(view){if(view===self.currentView&&view.el){view.resize()}})},updateCompactMode:function updateCompactMode(){this.$el.toggleClass("compact",this.$el.width()<=MIN_COMPACT_COMPONENT_WIDTH)},onApplyChanges:function onApplyChanges(changes,actionPrefix){var loadingType;switch(actionPrefix){case"Filter":loadingType="filterApply";break;case"Reload":loadingType="reload";break;default:loadingType="unknown";break}_.each(changes,function(value,key){this.track([actionPrefix,key,value].join("_"))},this);this._triggerComponentLoadedTrackingEvent({loadingType:loadingType})},track:function track(action,values){Analytics.trackEvent({name:"Component."+this.componentName,action:action,origin:this.cid,values:values})},trackExport:function trackExport(format,values){this.track("Export_"+format,values)},doExport:function doExport(exportSettings){switch(exportSettings.format){case"csv":case"xls":case"xlsx":this.trackExport(exportSettings.format);return exportManager.exportData(this.model||this.collection,this.settings,exportSettings);case"image/jpeg":case"image/png":case"image/svg+xml":this.trackExport(exportSettings.format,{size:exportSettings.size||800});return this.currentView.doExport(exportSettings);default:throw new Error("Unexpected component export format ".concat(exportSettings.format))}},removeAnnotationElement:function removeAnnotationElement(){this.$(".js-component-annotation").remove();this.annotation=undefined},_triggerComponentLoadedTrackingEvent:function _triggerComponentLoadedTrackingEvent(options){componentEventsHelper.triggerComponentLoadedTrackingEvent(this,options)}},{ControlsViewClass:ControlsView})})})();