define(["underscore","bw-fe-helpers/numberHelper","src/components/keyinsights/helpers/constants"],function(_,numberHelper,constants){"use strict";var formatters={};function formatPercentageChange(percentageChange){if(!percentageChange){return}return{percentage:numberHelper.prettyNumber(Math.abs(percentageChange))+"%",icon:"icon-caret-"+(percentageChange>=0?"up":"down")}}function getPercentageChange(current,previous){current=parseInt(current,10);previous=parseInt(previous,10);if(!current||!previous){return}return formatPercentageChange(Math.round((current-previous)/previous*100))}function getFormattedNumbers(data){var currentPrettyNumber=numberHelper.prettyNumber(data.current,{returnProps:true});var previousPrettyNumber=numberHelper.prettyNumber(data.previous,{returnProps:true});var currentFullNumber;var previousFullNumber;if(currentPrettyNumber.unit&&currentPrettyNumber.unit!==""){currentFullNumber=numberHelper.formatSpaceDelimitedNumber(data.current)}if(previousPrettyNumber.unit&&previousPrettyNumber.unit!==""){previousFullNumber=numberHelper.formatSpaceDelimitedNumber(data.previous)}return{current:{number:currentPrettyNumber.number,unit:currentPrettyNumber.unit,fullNumber:currentFullNumber},previous:{number:previousPrettyNumber.number+previousPrettyNumber.unit,fullNumber:previousFullNumber},change:getPercentageChange(data.current,data.previous)}}formatters[constants.totalMentions]=function totalMentionsFormatter(data){return _.extend({title:"Total Mentions",hasClickThrough:true,type:constants.totalMentions},getFormattedNumbers(data))};formatters[constants.uniqueAuthors]=function uniqueAuthorsFormatter(data){return _.extend({title:"Unique Authors",hasClickThrough:false,type:constants.uniqueAuthors},getFormattedNumbers(data))};formatters[constants.trendingTopics]=function trendingTopicsFormatter(data){return{title:"Trending Topics",type:constants.trendingTopics,items:[].concat(data).map(function(topic,index){return{id:index,text:topic}}),noDataMessage:"No Topics Available"}};formatters[constants.topStories]=function topStoriesFormatter(data){return{title:"Top News Stories",hasToolTips:true,type:constants.topStories,items:data.map(function(story){return{id:story.id,text:story.title}}),noDataMessage:"No Stories Available"}};formatters[constants.uniqueImages]=function uniqueImagesFormatter(data){return _.extend({title:"Unique Images",hasClickThrough:false,type:constants.uniqueImages},getFormattedNumbers(data))};formatters[constants.topHashtags]=function topHashtagsFormatter(data){return{title:"Top Hashtags",hasClickThrough:false,type:constants.topHashtags,noDataMessage:"No Hashtags Available",items:data.map(function(hashtag,index){return{id:index,text:hashtag.name}})}};function formatData(rawData){return Object.keys(rawData).reduce(function(memo,key){memo[key]=formatters[key](rawData[key]);return memo},{})}return{format:formatData}});