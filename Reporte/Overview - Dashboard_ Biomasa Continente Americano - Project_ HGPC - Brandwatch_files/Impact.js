(function(){define("src/extensions/demographicssummary/configuration/DemographicsDashboardConfiguration",["src/DashboardConfiguration"],function(DashboardConfiguration){"use strict";return new DashboardConfiguration({settings:{currentMode:"query"},tabs:[{id:"summary",name:"Summary",components:[{id:"summary",type:"demographicsummary",title:"Twitter Demographics Summary",settings:{currentMode:"query",accountType:["individual"]}}],settings:{}},{id:"gender",name:"Gender",settings:{},components:[{id:"summary",type:"demographicsummary",title:"Twitter Author Gender Summary",settings:{currentMode:"query"},activeView:"genderView"},{id:"topiccomparison",type:"topiccomparison",title:"Twitter Topic Comparison by Author Gender",settings:{currentMode:"query"}},{id:"topTweetersMale",type:"toptweeters",title:"Top Male Tweeters",settings:{currentMode:"query",limit:"10",orderBy:"followers",orderDirection:"descending",gender:["male"],spec:[{field:"volume",disabled:false},{field:"positive",disabled:true},{field:"negative",disabled:true},{field:"neutral",disabled:true},{field:"followers",disabled:false},{field:"accountType",disabled:true},{field:"gender",disabled:true},{field:"influence",disabled:true},{field:"outreach",disabled:true}]},activeView:"authorProfilesView",widthRatio:2},{id:"topTweetersFemale",type:"toptweeters",title:"Top Female Tweeters",settings:{currentMode:"query",limit:"10",orderBy:"followers",orderDirection:"descending",gender:["female"],spec:[{field:"volume",disabled:false},{field:"positive",disabled:true},{field:"negative",disabled:true},{field:"neutral",disabled:true},{field:"followers",disabled:false},{field:"accountType",disabled:true},{field:"gender",disabled:true},{field:"influence",disabled:true},{field:"outreach",disabled:true}]},componentName:"Tweeters",activeView:"authorProfilesView",widthRatio:2}]},{id:"interests",name:"Interests",settings:{},components:[{id:"demographicsummary",type:"demographicsummary",title:"Twitter Author Interests Summary",settings:{currentMode:"query"},activeView:"interestsView"},{id:"topiccomparison",type:"topiccomparison",title:"Twitter Topic Comparison by Author Interests",settings:{currentMode:"query",topicComparisonDimension:"interests",criteriaValue1:6,criteriaValue2:20}},{id:"authorsByInterestBusiness",type:"toptweeters",title:"Top Tweeters by Interest - Business",settings:{currentMode:"query",limit:"10",orderBy:"followers",orderDirection:"descending",interest:["Business"],spec:[{field:"volume",disabled:false},{field:"positive",disabled:true},{field:"negative",disabled:true},{field:"neutral",disabled:true},{field:"followers",disabled:false},{field:"accountType",disabled:true},{field:"gender",disabled:true},{field:"influence",disabled:true},{field:"outreach",disabled:true}]},activeView:"authorProfilesView",widthRatio:2},{id:"authorsByInterestTechnology",type:"toptweeters",title:"Top Tweeters by Interest - Technology",settings:{currentMode:"query",limit:"10",orderBy:"followers",orderDirection:"descending",interest:["Technology"],spec:[{field:"volume",disabled:false},{field:"positive",disabled:true},{field:"negative",disabled:true},{field:"neutral",disabled:true},{field:"followers",disabled:false},{field:"accountType",disabled:true},{field:"gender",disabled:true},{field:"influence",disabled:true},{field:"outreach",disabled:true}]},componentName:"Tweeters",activeView:"authorProfilesView",widthRatio:2}]},{id:"professions",name:"Professions",settings:{},components:[{id:"demographicsummary",type:"demographicsummary",title:"Twitter Author Professions Summary",settings:{currentMode:"query"},activeView:"professionsView"},{id:"topiccomparison",type:"topiccomparison",title:"Topic Comparison by Author Professions",settings:{currentMode:"query",topicComparisonDimension:"professions",criteriaValue1:2,criteriaValue2:8}},{id:"toptweetersExecutives",type:"toptweeters",title:"Top Tweeters by Profession - Executive",settings:{currentMode:"query",limit:"10",orderBy:"followers",orderDirection:"descending",profession:["Executive"],spec:[{field:"volume",disabled:false},{field:"positive",disabled:true},{field:"negative",disabled:true},{field:"neutral",disabled:true},{field:"followers",disabled:false},{field:"accountType",disabled:true},{field:"gender",disabled:true},{field:"influence",disabled:true},{field:"outreach",disabled:true}]},activeView:"authorProfilesView",widthRatio:2},{id:"toptweetersJournalist",type:"toptweeters",title:"Top Tweeters by Profession - Journalist",settings:{currentMode:"query",limit:"10",orderBy:"followers",orderDirection:"descending",profession:["Journalist"],spec:[{field:"volume",disabled:false},{field:"positive",disabled:true},{field:"negative",disabled:true},{field:"neutral",disabled:true},{field:"followers",disabled:false},{field:"accountType",disabled:true},{field:"gender",disabled:true},{field:"influence",disabled:true},{field:"outreach",disabled:true}]},activeView:"authorProfilesView",widthRatio:2}]},{id:"locations",name:"Locations",settings:{},components:[{id:"demographicsummary",type:"demographicsummary",title:"Twitter Author Locations Summary",settings:{currentMode:"query",accountType:["individual"]},activeView:"locationsView"},{id:"toptweetersUS",type:"toptweeters",title:"Top Tweeters by Country - US",settings:{currentMode:"query",limit:"10",orderBy:"followers",orderDirection:"descending",authorLocation:["us"],accountType:["individual"],spec:[{field:"volume",disabled:false},{field:"positive",disabled:true},{field:"negative",disabled:true},{field:"neutral",disabled:true},{field:"followers",disabled:false},{field:"accountType",disabled:true},{field:"gender",disabled:true},{field:"influence",disabled:true},{field:"outreach",disabled:true}]},activeView:"authorProfilesView",widthRatio:2},{id:"toptweetersUK",type:"toptweeters",title:"Top Tweeters by Country - UK",settings:{currentMode:"query",limit:"10",orderBy:"followers",orderDirection:"descending",authorLocation:["uk"],accountType:["individual"],spec:[{field:"volume",disabled:false},{field:"positive",disabled:true},{field:"negative",disabled:true},{field:"neutral",disabled:true},{field:"followers",disabled:false},{field:"accountType",disabled:true},{field:"gender",disabled:true},{field:"influence",disabled:true},{field:"outreach",disabled:true}]},activeView:"authorProfilesView",widthRatio:2},{id:"locationMap",type:"worldoverview",title:'Global Tweets by "Individual" Authors',settings:{currentMode:"query",accountType:["individual"]}},{id:"geotaggedMentionsMap",type:"geotagged",title:"Geotagged (Mentions Map)"}]},{id:"mentions",name:'Mentions by "Individual" Authors',components:[{id:"mentionsSearch",type:"mentions",title:"Tweets by individuals",settings:{currentMode:"query",orderBy:"date",orderDirection:"desc",page:0,pageSize:20,visibleColumns:["sentiment","found","twitterFollowers","gender","professions","interest","authorCity","authorCounty","authorCountry"],start:1,accountType:["individual"]}}]},{id:"advanced",name:"Advanced",components:[{id:"chart",type:"chart",title:"Tweeter Interests broken down by Gender",activeView:"horizontalBarChart",settings:{currentMode:"query",dimension1:"interest",dimension2:"gender",aggregate:"authors",accountType:["individual"]},customizeBarOpen:false},{id:"twitterInsightsMale",type:"twitterinsights",title:"Top Content - Male Tweeters",settings:{currentMode:"query",direction:"desc",sort:"count",displayedCount:"10",doEmoticons:true,doHashtags:true,doMentionedTweeters:true,gender:["male"]},activeView:"tableView",widthRatio:2},{id:"twitterInsightsFemale",type:"twitterinsights",title:"Top Content - Female Tweeters",settings:{currentMode:"query",displayedCount:"10",doHashtags:true,doEmoticons:true,doMentionedTweeters:true,sort:"count",direction:"desc",gender:["female"]},activeView:"tableView",widthRatio:2}]}]})});define("src/components/mentions/helpers/mentionsExportHelper",["src/exportManager","src/analytics/Analytics","src/permissions"],function(exportManager,Analytics,permissions){"use strict";var LARGE_EXPORT_WARNING="You are downloading more than 1000 mentions - "+"this download may take a long time and may not work. We recommend using "+"the 'Download' menu (top navigation) for 1000+ mentions\n\nIf you want "+"to try this download nevertheless, click OK, otherwise cancel this dialog. Thanks.";function trackExport(componentName,format,values){Analytics.trackEvent({name:"Miscellaneous."+componentName,action:"Export_"+format,values:values})}return{canExport:function canExport(){var settings=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(!permissions.check("export.mentions")){return false}if(settings.hasOwnProperty("emojis")&&typeof settings.emojis==="string"&&settings.emojis.length>0){return false}return true},warnIfBigVolumeAndExport:function warnIfBigVolumeAndExport(componentName,mentionsCollection,settings,extraOptions){var format=extraOptions.format;if(mentionsCollection.resultsTotal>1e3&&!confirm(LARGE_EXPORT_WARNING)){return}if(format==="fulltext.xlsx"){extraOptions.url=mentionsCollection.url+"/fulltext";extraOptions.format="xlsx"}trackExport(componentName,extraOptions.format,{numberOfMentions:mentionsCollection.size()});return exportManager.exportData(mentionsCollection,settings,extraOptions)}}});define("src/models/RuleControls",["underscore","src/globals/queries","bw-fe-helpers/languageGroupHelper","src/components/mentions/models/MentionsControls"],function(_,queries,languageGroupHelper,MentionsControls){"use strict";function isCJKQuery(queryId){var query=queries.get(queryId);var languages=query&&query.get("languages");var isLanguageAgnostic=query&&query.get("languageAgnostic");return!isLanguageAgnostic&&languages&&languages.some(languageGroupHelper.isIdeographic)}function getQueryCJKStatus(queryIdList){var status="ok";var hasCJKQuery=queryIdList.some(isCJKQuery);var hasNonCJKQuery=queryIdList.some(function(queryId){return!isCJKQuery(queryId)});if(hasCJKQuery){if(hasNonCJKQuery){status="warning"}else{status="error"}}return status}return MentionsControls.extend({parseQueryId:function parseQueryId(attrs){if(attrs.queryId){attrs.queryId=[].concat(attrs.queryId)}},dataSpec:function dataSpec(){var dataSpec=MentionsControls.prototype.dataSpec.apply(this,arguments);delete dataSpec.queryId;return dataSpec},validate:function validate(attrs){var errors=MentionsControls.prototype.validate.apply(this,arguments)||[];var cjkStatus;if(attrs.applyToProject===false&&_.isArray(attrs.queryId)&&!attrs.queryId.length||!attrs.queryId){errors.push("queryId")}else{cjkStatus=getQueryCJKStatus(attrs.queryId);if(attrs.search&&attrs.search.indexOf("raw:")!==-1){if(cjkStatus==="error"){errors.push("CJK error")}else if(cjkStatus==="warning"){this.trigger("cjk info","show warning")}}}if(cjkStatus!=="warning"){this.trigger("cjk info","remove warning")}return errors.length?errors:undefined}})});define("src/models/QuerySearchWithinValidation",["backbone"],function(Backbone){"use strict";return Backbone.Model.extend({initialize:function initialize(options){options=options||{};if(!options.query||typeof options.query!=="string"){throw new Error("QuerySearchWithinValidation model must be initialized with options.query as a String")}},url:function url(){return"/query-validation/searchwithin?language=en&query="+encodeURIComponent(this.get("query"))},parse:function parse(data){var parsed={valid:data.errors.length===0&&data.issues.length===0,query:data.query,validation_errors:data.errors.join(),validation_issues:data.issues};return parsed}})});define("src/views/RuleStepView",["backbone"],function(Backbone){"use strict";return Backbone.View.extend({className:"step",constructor:function RuleStepView(){Backbone.View.apply(this,arguments);if(!this.model){throw new Error("RuleStep must be initialized with options.model")}},validate:function validate(callback){callback()},shown:function shown(){}})});define("mustache!src/controls/filters/templates/imageFilters",["lib/mustache"],function(mustache){var escapedTemplate='<p>\n<a rel="logodetection" class="toggle {{#isExpanded}}on{{/isExpanded}}"><span class="{{chevronClass}} grey smallpadding-right"></span>Image</a>\n<span data-rel="logodetection" class="active-indicator {{groupClass}}">On</span>\n</p>\n<fieldset class="logodetection {{expandedClass}}">\n<p class="clearfix">\n<span class="indicator {{#getTickClass}}imageId{{/getTickClass}}" data-tick-key="imageId"></span>\n<span class="js-imagefilter-set imagefilter__set {{^logoImagesGroupId}}imagefilter__set--hidden{{/logoImagesGroupId}}">\nFiltered by an image\n<a class="js-imagefilter-remove imagefilter__remove icon-remove customtip" title="Remove image filter"></a>\n</span>\n<span class="js-imagefilter-unset imagefilter__unset {{#logoImagesGroupId}}imagefilter__unset--hidden{{/logoImagesGroupId}}">\nNo image filter applied\n</span>\n<input type="hidden" name="logoImagesGroupId" class="js-logoimagesgroupid field" value="{{logoImagesGroupId}}"/>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-logoimagesgroupid"></a>\n{{/showHelp}}\n</p>\n</fieldset>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/controls/css/imageFilters.css",["css!src/controls/css/compiled.css"],function(){});define("src/controls/filters/ImageFilters",["underscore","bw-fe-helpers/windowHelper","src/controls/filters/FiltersView","mustache!src/controls/filters/templates/imageFilters","css!src/controls/css/imageFilters.css","customtip"],function(_,windowHelper,FiltersView,renderLogoDetectionTemplate){"use strict";var VIEW_SELECTORS={IMAGEFILTER_SET:".js-imagefilter-set",IMAGEFILTER_UNSET:".js-imagefilter-unset",GROUP_ID:".js-logoimagesgroupid"};var CSS_CLASSES={HIDDEN:"imagefilter__set--hidden imagefilter__unset--hidden"};var CONFIRMATION_MESSAGE="Are you sure you want to remove the image filter from this Component? "+"This action cannot be undone.\n\nTo re-apply the filter you will need to add the mentions "+"to the Dashboard again. This can be done from the Image Wall Component.";function removeImageFilter(view){if(!windowHelper.getWindow().confirm(CONFIRMATION_MESSAGE)){return}view.$(VIEW_SELECTORS.IMAGEFILTER_SET).addClass(CSS_CLASSES.HIDDEN);view.$(VIEW_SELECTORS.IMAGEFILTER_UNSET).removeClass(CSS_CLASSES.HIDDEN);view.$(VIEW_SELECTORS.GROUP_ID).val("").trigger("change")}return FiltersView.extend({events:function events(){var events=FiltersView.prototype.events.apply(this,arguments);return _.extend(events,{"change input":"inputChanged","click .js-imagefilter-remove":removeImageFilter.bind(null,this)})},constructor:function ImageFilters(){FiltersView.apply(this,arguments)},makeEl:function makeEl(){return renderLogoDetectionTemplate(this.getTemplateData())},render:function render(){FiltersView.prototype.render.call(this);this.$el.customtip()},getFilterIndicatorStatuses:function getFilterIndicatorStatuses(model){var ticks={imageId:!this.isNullOrEmpty(model.get("logoImagesGroupId"))};return{tickIndicators:ticks,groupIndicators:!!ticks.imageId}},getValues:function getValues(){return{logoImagesGroupId:this.$(VIEW_SELECTORS.GROUP_ID).val()}}})});define("mustache!templates/multipleQuerySelectInputs",["lib/mustache"],function(mustache){var escapedTemplate='<div class="panes">\n<fieldset class="query relative {{#applyToProject}} hidden {{/applyToProject}}">\n<select class="query" {{#applyToProject}} disabled {{/applyToProject}} name="queryId" multiple>\n{{#queries}}\n<option value="{{id}}" data-locked="{{isLocked}}" {{#typeIconClass}}data-typeiconclass="{{typeIconClass}}"{{/typeIconClass}}  {{#lockedByUsername}}data-lockedbyusername="{{lockedByUsername}}"{{/lockedByUsername}} {{selected}}>{{name}}</option>\n{{/queries}}\n</select>\n<a class="help icon-bwhelp absbottom absright" data-key="{{queriesHelpKey}}"></a>\n</fieldset>\n<p class="applyToProject smallmargin-top">\n<input type="checkbox" name="applyToProject" {{#applyToProject}} checked {{/applyToProject}} id="applyToProject" class="tinymargin-right"/>\n<label for="applyToProject">Apply to whole Project</label>\n</p>\n\n<p class="testSearchSelection singlemargin-top hidden">\nQuery to use for test searches\n</p>\n<select class="testSearchQueryList testSearchSelection selectfield smallmargin-top hidden" name="testSearchQueryId">\n</select>\n\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!css/multipleQuerySelectInputs.css",["css!css/compiled.css"],function(){});define("src/views/ControlsViewMultipleQuerySelectInputs",["underscore","jquery","src/Workbench","src/globals/currentProject","src/globals/queries","src/controls/lib/viewHelpers","src/QueryFormManager","src/analytics/Analytics","src/views/ControlsViewInputs","mustache!templates/multipleQuerySelectInputs","text!src/controls/templates/sellecktItemEdit.template","src/packages/selleckt","src/packages/customtip","css!css/multipleQuerySelectInputs.css"],function(_,$,Workbench,currentProject,queries,viewHelpers,QueryFormManager,Analytics,ControlsViewInputs,template,sellecktItemEditTemplate){"use strict";return ControlsViewInputs.extend({className:"multipleQuerySelectInputs singlepadding modular",events:function events(){return _.extend({"change .applyToProject":"onToggleApplyToProject","click a.deselect":"onDeselectQuery","click .js-edit":"onEditQuery"},ControlsViewInputs.prototype.events.call(this))},initialize:function initialize(options){if(options){this.hideTestSearchQuery=options.hideTestSearchQuery;this.hideAddLink=options.hideAddLink;this.queries=options.queries;this.allowedQueryTypes=options.allowedQueryTypes||[]}else{this.allowedQueryTypes=[]}if(!this.queries){this.queries=queries}this.listenTo(this.model,"invalid",this.showValidationErrors);this.listenTo(queries,"reset change add",this.render)},render:function render(){var templateData=this.getTemplateData(),selectedQueries=templateData.selectedQueries,data=templateData.data,onCreateQuery=_.bind(this.onCreateQuery,this);if(selectedQueries.length>1||data.applyToProject){data.showTestSearchDropdown=true}this.$el.html(template(data));this.toggleTestSearchQueryDropdown();this.querySelect=this.$('[name="queryId"]').selleckt({selectionTemplate:sellecktItemEditTemplate,placeholderText:"Select Query / Channel",alternatePlaceholder:"Select another",unselectItemClass:"remove",enableSearch:true,showEmptyList:true,popupTemplateData:{footer:this.hideAddLink?"":'<a class="js-create-query">'+'   <span class="iconsmaller icon-plus smallpadding-right" />New Query / Channel'+"</a>"}});if(this.sellecktInstance){this.sellecktInstance.destroy()}this.sellecktInstance=this.querySelect.data("selleckt");this.sellecktInstance.on("onPopupCreated",function(popup){popup.$popup.on("click",".js-create-query",function(e){e.stopPropagation();onCreateQuery()})});this.$el.customtip()},getTemplateData:function getTemplateData(){var selectedQueries;var data;var allowedQueryTypes=this.allowedQueryTypes;var queryId=this.$("[name=queryId]").val()||[];queryId=queryId.length===0?null:queryId;selectedQueries=_([].concat(queryId||this.model.get("queryId")||[])).map(function(id){return parseInt(id,10)});data={queries:_(this.queries.toJSON()).chain().filter(function(query){if(!allowedQueryTypes.length){return true}return allowedQueryTypes.includes(query.type)}).map(function(query){return{id:query.id,name:query.name,type:query.type,typeIconClass:viewHelpers.getIconClassGivenType(query.type),isLocked:query.lockedQuery,lockedByUsername:query.lockedByUsername,selected:_(selectedQueries).include(query.id)?"selected":""}}).sortBy(function(query){return query.name.toLowerCase()}).value(),applyToProject:this.model.get("scope")==="project"?true:false,queriesHelpKey:"multiple-query-select-input-rules"};return{selectedQueries:selectedQueries,data:data}},getValues:function getValues(){var queryIds=_([].concat(this.$("[name=queryId]").val()||[])).chain().map(function(val){return parseInt(val,10)}).compact().value(),applyToProject=this.$("[name=applyToProject]").is(":checked"),testSearchQueryId=parseInt(this.$("[name=testSearchQueryId]").val(),10)||undefined;return{queryId:queryIds,applyToProject:applyToProject,testSearchQueryId:testSearchQueryId}},showWholeProjectMessage:function showWholeProjectMessage(){var wholeProjectMessage=this.$("p.notification-info");return wholeProjectMessage.length?wholeProjectMessage.show():this.$("p.applyToProject").after('<p class="notification-info rounded smallpadding-vertical singlepadding-horizontal '+'mediumline smallmargin-top">'+"Will apply to all Queries in the Project now and in the future.</p>")},removeWholeProjectMessage:function removeWholeProjectMessage(){return this.$("p.notification-info").remove()},onToggleApplyToProject:function onToggleApplyToProject(){var querySelect=this.querySelect;if(this.$("[name=applyToProject]").is(":checked")){querySelect.prop("disabled",true);this.showWholeProjectMessage();this.hideQuerySelection()}else{querySelect.prop("disabled",false);this.removeWholeProjectMessage();this.showQuerySelection()}this.toggleTestSearchQueryDropdown();this.trigger("changesMade")},hideQuerySelection:function hideQuerySelection(){this.$("fieldset.query").addClass("hidden")},showQuerySelection:function showQuerySelection(){this.$("fieldset.query").removeClass("hidden")},onDeselectQuery:function onDeselectQuery(){this.toggleTestSearchQueryDropdown();this.removeValidationErrors()},selectChanged:function selectChanged(e){var $target=$(e.target);if($target.hasClass("query")){if($target.val()!==null){this.$(".query .selleckt").removeClass("invalid")}this.toggleTestSearchQueryDropdown()}$(".tooltip").hide();this.$el.customtip();ControlsViewInputs.prototype.selectChanged.call(this)},toggleTestSearchQueryDropdown:function toggleTestSearchQueryDropdown(){if(this.hideTestSearchQuery){return}var $testSearchMarkup=this.$(".testSearchSelection"),values=this.getValues();if(values.queryId.length>1||values.applyToProject){this.updateTestSearchQueryDropdown();$testSearchMarkup.removeClass("hidden")}else{$testSearchMarkup.addClass("hidden");this.$("select.testSearchSelection").empty()}},updateTestSearchQueryDropdown:function updateTestSearchQueryDropdown(){var data=this.getTemplateData().data,queries=[],newQueryList="";if(this.$("[name=applyToProject]").is(":checked")){queries=data.queries}else{queries=_(data.queries).filter(function(query){return query.selected==="selected"})}newQueryList=_(queries).map(function(query){return'<option value="'+query.id+'" >'+_.escape(query.name)+"</option>"}).join("");this.$("[name=testSearchQueryId]").html(newQueryList)},remove:function remove(){if(this.sellecktInstance){this.sellecktInstance.destroy()}ControlsViewInputs.prototype.remove.call(this)},showValidationErrors:function showValidationErrors(model,errors){if(errors&&(errors.queryId||_(errors).isArray()&&_(errors).include("queryId"))){this.$(".query .selleckt").addClass("invalid")}},removeValidationErrors:function removeValidationErrors(){this.$(".query .selleckt").removeClass("invalid")},onEditQuery:function onEditQuery(event){var $target=$(event.target),queryId=$target.closest("li[data-value]").data("value");this.editQuery(queryId)},editQuery:function editQuery(queryId){var queryModel=queries.get(queryId);QueryFormManager.showEditQueryForm({query:queryModel,project:currentProject,withinDashboard:true});Analytics.trackEvent({name:"Miscellaneous.QueryInputs",action:"Edit_Query",origin:"Application"})},onCreateQuery:function onCreateQuery(){this.createQuery()},createQuery:function createQuery(){this.stopListening(queries,"add",this.onQueryCreated);this.listenToOnce(queries,"add",this.onQueryCreated);QueryFormManager.showCreateQueryForm({project:currentProject,userData:Workbench.userData,allowedQueryTypes:this.allowedQueryTypes});Analytics.trackEvent({name:"Miscellaneous.QueryInputs",action:"Add_Query",origin:"Application"})},onQueryCreated:function onQueryCreated(model){this.render();this.selectQuery(model.id)},selectQuery:function selectQuery(queryId){var querySelect=this.querySelect,selection=[queryId].concat(querySelect.val());querySelect.val(selection).trigger("change")}})});define("mustache!templates/logoQueryDeselectedNotification",["lib/mustache"],function(mustache){var escapedTemplate='<div class="notification-info singlemargin-top singlemargin-left singlemargin-right smallpadding-vertical singlepadding-horizontal rounded mediumline">\nYour Logo Query has been deselected. Rules are not yet available for Logo Queries.\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/views/RuleControlsView",["underscore","jquery","src/globals/flags","src/globals/flagNames","src/globals/crimsonMode","src/controls/filters/ImageFilters","src/permissions","src/views/ControlsView","src/views/ControlsViewSearchInput","src/views/ControlsViewMultipleQuerySelectInputs","mustache!templates/logoQueryDeselectedNotification"],function(_,$,flags,FLAGS,crimsonMode,ImageFilters,permissions,ControlsView,ControlsViewSearchInput,ControlsViewMultipleQuerySelectInputs,logoQueryDeselectedNotificationTemplate){"use strict";return ControlsView.extend({applyText:"Test Search",applyClassName:"button",initialize:function initialize(options){options=options||{};options.global=true;ControlsView.prototype.initialize.call(this,options)},setupInputViews:function setupInputViews(viewOptions){this.searchInput=new ControlsViewSearchInput(_.extend({expandDirection:"left",expanderClassName:"mentionsSearchTermExpander lightgreybg"},viewOptions));this.searchInput.on("changesMade",this.onChangesMade,this);this.listenTo(this.searchInput,"search",this.onApplyChanges,this);this.queryInputs=this.createQueryInputs(viewOptions);this.queryInputs.on("changesMade",this.onChangesMade,this)},renderInputs:function renderInputs(){if(!this.$(".searchBoxContainer").length){$(this.el).prepend('<div class="searchBoxContainer lightgreybg controls--section-first" />')}this.$(".searchBoxContainer").append(this.searchInput.el);this.searchInput.render();if(permissions.check("see.dashboard.controls.queryField",this.dashboard)){this.renderQueryInputs()}return this.renderFilters()},renderQueryInputs:function renderQueryInputs(){ControlsView.prototype.renderQueryInputs.call(this);if(this.showDeselectedNotification){this.$(".queryinputs").prepend(logoQueryDeselectedNotificationTemplate())}},getSettings:function getSettings(){return _.extend({},this.searchInput?this.searchInput.getValues():{},ControlsView.prototype.getSettings.call(this))},getViewOptions:function getViewOptions(){var options=ControlsView.prototype.getViewOptions.call(this);var commonQueryTypes=["twitter","publicfacebook","instagram","logo"];var textQueryType=[crimsonMode.enabled()?"monitor":"text"];options.allowedQueryTypes=textQueryType.concat(commonQueryTypes);return options},getFiltersByName:function getFiltersByName(){var filters=ControlsView.FILTER_NAMES;return[filters.PageAndMentionTypeFilters,flags.variation(FLAGS.ENABLE_EMOTIONS)?filters.SentimentAndEmotionsFilters:filters.SentimentFilters,filters.AuthorFilters,filters.LocationFilters,filters.LanguageFilters,filters.SiteFilters,filters.TwitterFilters,filters.FacebookFilters,filters.ForumThreadFilters,filters.BlogFilters,filters.LogoVersionsFilters]},getFilters:function getFilters(viewOptions){var filters=ControlsView.prototype.getFilters.call(this,Object.assign({showGenderFilter:true,showAccountTypeFilter:true,showAuthorLocationFilter:true,showProfessionFilter:true,showInterestFilter:true},viewOptions));var hasImageFilterApplied=!!viewOptions.model.get("logoImagesGroupId");if(hasImageFilterApplied){var imageFilters=new ImageFilters(viewOptions);filters.push(imageFilters)}return filters}},{QueryInputsClass:ControlsViewMultipleQuerySelectInputs})});define("src/mixins/componentViewMixin",["underscore","src/helpers/errorHelper","src/permissions","lib/jquery.showMessage"],function(_,errorHelper,permissions){"use strict";return{listenForStatusMessages:function listenForStatusMessages(model){this.listenTo(model,"request",this.waitingForData);this.listenTo(model,"sync",this.clearWaitingMessage);this.listenTo(model,"error",this.showErrorMessage)},stopListeningForStatusMessages:function stopListeningForStatusMessages(model){this.stopListening(model,"request",this.waitingForData);this.stopListening(model,"sync",this.clearWaitingMessage);this.stopListening(model,"error",this.showErrorMessage)},noResults:function noResults(){this.showMessage("No results")},waitingForData:function waitingForData(options){options=_.extend({text:"Waiting for data...",opacity:.8,maskClassName:"animated fast fadein"},options);this.$el.showMessage(options)},clearWaitingMessage:function clearWaitingMessage(){var $el=this.$el;if($el.hasMessage("Waiting for data...")){$el.hideMessage()}},clearMessage:function clearMessage(){var $el=this.$el;if($el.hasMessage()){$el.hideMessage()}},getErrorMessage:function getErrorMessage(res){return errorHelper.getErrorMessage(res)},showErrorMessage:function showErrorMessage(model,res){if(arguments.length===1){res=model}if(res&&res.statusText==="abort"){return}var errorMessage=this.getErrorMessage(res);this.showMessage(errorMessage,"notification-error")},showValidationError:function showValidationError(){this.showMessage("Please check the Filters section","notification-error")},showMessage:function showMessage(message,className){this.$el.showMessage({text:message,className:className||""})},showMentionInfo:function showMentionInfo(options,settings){var MentionsPopup=require("src/components/mentions/views/MentionsPopup");MentionsPopup.showMentions({settings:settings||this.settings,additionalOptions:_.omit(options,"title"),title:options.title,showTermFilter:options.showTermFilter})},hidden:function hidden(){},canSeeMentions:function canSeeMentions(){return permissions.check("see.mentions")}}});define("css!css/animations.css",["css!css/compiled.css"],function(){});define("src/views/ComponentView",["backbone","underscore","src/mixins/componentViewMixin","jquery.showRelativeTo","lib/jquery.showMessage","css!css/animations.css"],function(Backbone,_,componentViewMixin){"use strict";var ComponentView=Backbone.View.extend({initialize:function initialize(options){Backbone.View.prototype.initialize.call(this,options);_(this).bindAll("noResults");if(!this.model&&!this.collection){throw new Error("model must be defined!")}if(!options||!options.exportModel){throw new Error("options.exportModel must be defined!")}if(_.isFunction(this.destroy)){throw new Error("ComponentView.destroy should no longer be used - "+"override remove instead and call ComponentView.prototype.remove")}if(!options.settings){throw new Error("options.settings must be defined!")}this.exportModel=options.exportModel;this.settings=options.settings;this.listenTo(this.settings,"invalid",this.showValidationError);(function(model){model.settings=model.settings||options.settings;this.listenForStatusMessages(model)}).call(this,this.model||this.collection)},remove:function remove(){this.model=undefined;this.collection=undefined;this.settings=undefined;Backbone.View.prototype.remove.apply(this)},resize:function resize(){},shown:function shown(){if(this.exportModel){this.exportModel.set({showXlsCsv:true,showImage:false})}}});_.extend(ComponentView.prototype,componentViewMixin);return ComponentView});define("src/components/mentions/helpers/logoDetectionHelper",["bw-fe-helpers/validationHelpers"],function(validationHelpers){"use strict";var getDefaultLogoImage=function getDefaultLogoImage(logoImages,logoImagesGroupId){if(validationHelpers.isNullOrEmpty(logoImages)){return}var logoImageWithGroupId;if(logoImagesGroupId){logoImageWithGroupId=logoImages.find(function(logoImage){return logoImage.logoImagesGroupId===logoImagesGroupId})}if(logoImageWithGroupId){return logoImageWithGroupId}return logoImages.reduce(function(memo,logoImage){return memo.logos.length<logoImage.logos.length?logoImage:memo})};return{getDefaultLogoImage:getDefaultLogoImage}});define("mustache!src/components/mentions/templates/siteContextMenu",["lib/mustache"],function(mustache){var escapedTemplate='<ul>\n{{#isOfflinePublication}}\n<li class="js-showMentions {{^showDomainProfile}}{{^canAddToSiteGroup}}default{{/canAddToSiteGroup}}{{/showDomainProfile}} context-menu--item" data-domain="{{domain}}"><a>View Mentions from <strong>{{publicationName}}<strong></a></li>\n{{/isOfflinePublication}}\n{{^isOfflinePublication}}\n{{#showDomainProfile}}\n<li class="default js-showDomainProfile context-menu--item"><a>Show Domain Information</a></li>\n<li class="separator context-menu--item"></li>\n{{/showDomainProfile}}\n{{#canAddToSiteGroup}}\n<li class="js-addToSiteGroup {{^showDomainProfile}}default{{/showDomainProfile}} context-menu--item" data-domain="{{domain}}"><a>Add to a Site List</a></li>\n{{^showDomainProfile}}<li class="separator"></li>{{/showDomainProfile}}\n{{/canAddToSiteGroup}}\n<li class="js-showMentions {{^showDomainProfile}}{{^canAddToSiteGroup}}default{{/canAddToSiteGroup}}{{/showDomainProfile}} context-menu--item" data-domain="{{domain}}"><a>View Mentions on {{strippedDomain}}</a></li>\n{{/isOfflinePublication}}\n</ul>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/components/mentions/views/SiteContextMenu",["backbone","underscore","src/permissions","src/globals/me","src/globals/currentDashboard","src/views/ContextMenuView","src/components/mentions/views/AddToSiteGroupView","src/components/mentions/_mentionsprofile/views/DomainProfileView","mustache!src/components/mentions/templates/siteContextMenu","src/packages/modalDialogs","jquery.showRelativeTo"],function(Backbone,_,permissions,me,currentDashboard,ContextMenuView,AddToSiteGroupView,DomainProfileView,template){"use strict";return ContextMenuView.extend({tagName:"nav",className:"siteContextMenu context-menu popupframe",events:function events(){return{"click li.js-showDomainProfile":"onShowDomainPofile","click li.js-showMentions":"onShowMentions","click li.js-addToSiteGroup":"onAddToSiteGroup"}},initialize:function initialize(options){_(this).bindAll("render","onShowMentions","onAddToSiteGroup");if(!options||!options.settings){throw new Error("options.settings must be defined!")}this.model=this.model||new Backbone.Model({domain:options.domain,queryId:options.settings.get("queryId"),settings:options.settings.toJSON(),mentionUrl:options.mentionUrl,mentionTitle:options.mentionTitle,publicationName:options.publicationName});this.settings=options.settings;this.$target=options.$target;this.model.bind("change",this.render,this)},isOfflinePublication:function isOfflinePublication(){var publicationName=this.model.get("publicationName");return!(_.isUndefined(publicationName)||_.isNull(publicationName))},render:function render(){var model=this.model,domain=model.get("domain"),mentionUrl=model.get("mentionUrl"),mentionTitle=model.get("mentionTitle"),isMention=mentionUrl&&mentionTitle,showDomainProfile=!domain.match(/twitter\.com/gi)&&!domain.match(/facebook\.com/gi),publicationName=model.get("publicationName");this.$el.html(template({domain:domain,strippedDomain:domain.replace(/^www\./,""),showDomainProfile:showDomainProfile&&isMention,canAddToSiteGroup:permissions.check("edit.groups",currentDashboard),isOfflinePublication:this.isOfflinePublication(),publicationName:publicationName}))},onShowMentions:function onShowMentions(e){e.preventDefault();e.stopPropagation();this.openMentions();this.remove()},onAddToSiteGroup:function onAddToSiteGroup(e){var pos=this.$el.position();e.preventDefault();e.stopPropagation();this.addToSiteGroup(this.model.get("domain"),{top:pos.top-20,left:pos.left+20});this.remove()},onShowDomainPofile:function onShowDomainPofile(e){var mentionUrl=this.model.get("mentionUrl"),mentionTitle=this.model.get("mentionTitle");e.preventDefault();e.stopPropagation();DomainProfileView.show(mentionUrl,mentionTitle);this.remove()},addToSiteGroup:function addToSiteGroup(domain,additionalOptions){AddToSiteGroupView.show(_(additionalOptions||{}).extend({userId:me.id,domain:domain,$target:this.$el}))},openMentions:function openMentions(){var domain=this.model.get("domain"),publicationName=this.model.get("publicationName"),mentionSettings={},additionalOptions=this.mentionsOptions||{domain:domain,publication:publicationName};mentionSettings.settings=this.settings.clone();mentionSettings.additionalOptions=additionalOptions;mentionSettings.settings.set("page",0);mentionSettings.settings.set("pageSize",20);require("src/components/mentions/views/MentionsPopup").showMentions(mentionSettings)}})});define("src/components/imagewall/components/passepartout/helpers/canvasHelper",[],function(){"use strict";var drawPolygons=function drawPolygons(ctx,coordinates){var numberOfPoints=coordinates.length;if(numberOfPoints<1){return}ctx.moveTo(coordinates[numberOfPoints-1].x,coordinates[numberOfPoints-1].y);coordinates.forEach(function(coordinate){ctx.lineTo(coordinate.x,coordinate.y)})};var drawLogos=function drawLogos(ctx,logos){logos.forEach(function(logo){drawPolygons(ctx,logo.coordinates)})};var drawLogoShadow=function drawLogoShadow(ctx,width,height,logos){ctx.save();ctx.beginPath();drawLogos(ctx,logos);ctx.shadowBlur=15;ctx.shadowColor="rgba(0, 0, 0, 0.5)";ctx.fillStyle="black";ctx.fill();ctx.clip();ctx.clearRect(0,0,width,height);ctx.restore()};var drawRedBorder=function drawRedBorder(ctx,logos,ratio,needsFilling){ctx.beginPath();drawLogos(ctx,logos);ctx.strokeStyle="red";ctx.lineWidth=2/ratio;ctx.stroke();if(needsFilling){ctx.fillStyle="rgba(256, 0, 0, 0.3)";ctx.fill()}};var renderMask=function renderMask(canvas,data,isSecondary){var ratio=data.ratio,scaledWidth=data.scaledWidth,scaledHeight=data.scaledHeight,paddedLogos=data.paddedLogos,_data$logoImage=data.logoImage,width=_data$logoImage.width,height=_data$logoImage.height;var ctx=canvas.getContext("2d");canvas.width=scaledWidth;canvas.height=scaledHeight;ctx.scale(ratio,ratio);if(isSecondary){drawLogoShadow(ctx,width,height,paddedLogos)}drawRedBorder(ctx,paddedLogos,ratio,isSecondary)};return{renderMask:renderMask}});define("src/components/imagewall/components/passepartout/helpers/logoCoordinatesHelper",[],function(){"use strict";var getPaddedVerticalEquation=function getPaddedVerticalEquation(coords,previousPoint,nextPoint,paddingValue){var signedPaddingValue;if(previousPoint.x>coords.x&&nextPoint.x>=coords.x||previousPoint.x>=coords.x&&nextPoint.x>coords.x){signedPaddingValue=-paddingValue}else if(previousPoint.x<coords.x&&nextPoint.x<=coords.x||previousPoint.x<=coords.x&&nextPoint.x<coords.x){signedPaddingValue=paddingValue}else{signedPaddingValue=0}return{c:coords.x+signedPaddingValue}};var getPaddedLinearEquation=function getPaddedLinearEquation(coords,nextCoords,previousPoint,nextPoint,paddingValue){var slope=(nextCoords.y-coords.y)/(nextCoords.x-coords.x);var yIntercept=coords.y-slope*coords.x;var yInterceptPaddingValue;var signedPaddingValue;yInterceptPaddingValue=paddingValue/Math.cos(Math.atan(slope));if(previousPoint.y>slope*previousPoint.x+yIntercept&&nextPoint.y>=slope*nextPoint.x+yIntercept||previousPoint.y>=slope*previousPoint.x+yIntercept&&nextPoint.y>slope*nextPoint.x+yIntercept){signedPaddingValue=-yInterceptPaddingValue}else if(previousPoint.y<slope*previousPoint.x+yIntercept&&nextPoint.y<=slope*nextPoint.x+yIntercept||previousPoint.y<=slope*previousPoint.x+yIntercept&&nextPoint.y<slope*nextPoint.x+yIntercept){signedPaddingValue=yInterceptPaddingValue}else{signedPaddingValue=0}return{m:slope,b:yIntercept+signedPaddingValue}};var getPaddedLogos=function getPaddedLogos(logos){var ratio=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;return logos.map(function(logo){var paddingValue=5/ratio;var paddedLineEquations=logo.coordinates.map(function(edgeStartCoords,index){var edgeEndCoords=logo.coordinates[(index+1)%logo.coordinates.length];var previousPointCoords=logo.coordinates[(logo.coordinates.length+index-1)%logo.coordinates.length];var nextPointCoords=logo.coordinates[(index+2)%logo.coordinates.length];if(edgeEndCoords.x===edgeStartCoords.x){return getPaddedVerticalEquation(edgeStartCoords,previousPointCoords,nextPointCoords,paddingValue)}return getPaddedLinearEquation(edgeStartCoords,edgeEndCoords,previousPointCoords,nextPointCoords,paddingValue)});var paddedCoordinates=paddedLineEquations.map(function(eq,index){var nextEq=paddedLineEquations[(index+1)%paddedLineEquations.length];var x;if(eq.c!==undefined&&nextEq.m!==undefined){return{x:eq.c,y:nextEq.m*eq.c+nextEq.b}}if(nextEq.c!==undefined&&eq.m!==undefined){return{x:nextEq.c,y:eq.m*nextEq.c+eq.b}}if(eq.m!==undefined&&nextEq.m!==undefined){x=(nextEq.b-eq.b)/(eq.m-nextEq.m);return{x:x,y:eq.m*x+eq.b}}return null});return{url:logo.url,coordinates:paddedCoordinates}})};return{getPaddedLogos:getPaddedLogos}});define("src/components/imagewall/components/passepartout/helpers/imageHelper",[],function(){"use strict";var loadImage=function loadImage(url){return new Promise(function(resolve,reject){if(!url){return reject("Image url is missing")}var img=document.createElement("img");img.onload=function(){return resolve(img)};img.onerror=function(){return reject()};img.src=url})};function attachLoadingListener(url,successCallback,errorCallback){return loadImage(url).then(function(img){successCallback(img.attributes.src.value)}).catch(function(err){console.error(err);errorCallback()})}return{attachLoadingListener:attachLoadingListener}});define("mustache!src/components/imagewall/components/passepartout/Passepartout",["lib/mustache"],function(mustache){var escapedTemplate='<div class="js-image b-iw-passepartout__image" style="width:{{scaledWidth}}px; height:{{scaledHeight}}px; background-size:{{scaledWidth}}px {{scaledHeight}}px;">\n<div class="js-loader b-iw-passepartout__loader" style="background-color:{{dominantColor}};">\n<div class="js-error-message b-iw-passepartout__error-message b-iw-passepartout__error-message--{{errorMessageModifier}}">\nSorry, we could not<br/>load this image\n</div>\n</div>\n</div>\n<canvas class="js-primary-mask b-iw-passepartout__primary-mask"> </canvas>\n<canvas class="js-secondary-mask b-iw-passepartout__secondary-mask"> </canvas>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/components/imagewall/components/passepartout/passepartout.css",["css!src/components/imagewall/components/passepartout/compiled.css"],function(){});define("src/components/imagewall/components/passepartout/Passepartout",["backbone","src/helpers/colourHelper","src/events/logoDetectionEvents","src/events/globalEventNames","src/components/imagewall/components/passepartout/helpers/canvasHelper","src/components/imagewall/components/passepartout/helpers/logoCoordinatesHelper","src/components/imagewall/components/passepartout/helpers/imageHelper","mustache!src/components/imagewall/components/passepartout/Passepartout","css!src/components/imagewall/components/passepartout/passepartout.css"],function(Backbone,colourHelper,logoDetectionEvents,globalEventNames,canvasHelper,logoCoordinatesHelper,imageHelper,template){"use strict";var CLASS_NAMES={passepartout:"b-iw-passepartout",passepartoutPointer:"b-iw-passepartout--pointer",primaryMaskShowing:"b-iw-passepartout--primary-mask-showing",secondaryMaskShowing:"b-iw-passepartout--secondary-mask-showing",loaderHidden:"b-iw-passepartout__loader--hidden",errorMessageVisible:"b-iw-passepartout__error-message--visible",highlight:"b-iw-passepartout__image--highlight"};var VIEW_SELECTORS={loader:".js-loader",errorMessage:".js-error-message",image:".js-image",primaryMask:".js-primary-mask",secondaryMask:".js-secondary-mask"};var IMAGE_INSIGHTS_EVENTS=globalEventNames.IMAGE_INSIGHTS;var getCanvasData=function getCanvasData(view,data){var passepartoutMaxWidth=view.passepartoutMaxWidth||data.logoImage.width;var passepartoutMaxHeight=view.passepartoutMaxHeight||data.logoImage.height;var widthRatio=passepartoutMaxWidth/data.logoImage.width;var heightRatio=passepartoutMaxHeight/data.logoImage.height;var ratio=Math.min(widthRatio,heightRatio);var brightnessValue=colourHelper.brightness(data.logoImage.dominantColor);var errorMessageModifier=brightnessValue<130?"white":"black";return Object.assign({},data,{paddedLogos:logoCoordinatesHelper.getPaddedLogos(data.logoImage.logos,ratio),ratio:ratio,errorMessageModifier:errorMessageModifier,scaledWidth:ratio*data.logoImage.width,scaledHeight:ratio*data.logoImage.height,dominantColor:data.logoImage.dominantColor})};var showImage=function showImage(view,data,imageUrl){view.$(VIEW_SELECTORS.loader).addClass(CLASS_NAMES.loaderHidden);view.$(VIEW_SELECTORS.image).css("background-image",'url("'.concat(imageUrl,'")'));view._imageLoaded=true;var _data$logoImage=data.logoImage,url=_data$logoImage.url,logoImagesGroupId=_data$logoImage.logoImagesGroupId,pageType=_data$logoImage.pageType;logoDetectionEvents.trigger(IMAGE_INSIGHTS_EVENTS.IMAGE_LOAD_SUCCESS,{logoImageUrl:url,logoImagesGroupId:logoImagesGroupId,pageType:pageType})};var showErrorMessage=function showErrorMessage(view,data){view.$(VIEW_SELECTORS.errorMessage).addClass(CLASS_NAMES.errorMessageVisible);var _data$logoImage2=data.logoImage,url=_data$logoImage2.url,logoImagesGroupId=_data$logoImage2.logoImagesGroupId,pageType=_data$logoImage2.pageType;logoDetectionEvents.trigger(IMAGE_INSIGHTS_EVENTS.IMAGE_LOAD_FAILURE,{logoImageUrl:url,logoImagesGroupId:logoImagesGroupId,pageType:pageType})};return Backbone.View.extend({className:function className(){return CLASS_NAMES.passepartout+(this.showMousePointer?" ".concat(CLASS_NAMES.passepartoutPointer):"")},constructor:function Passepartout(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.passepartoutMaxWidth=options.passepartoutMaxWidth;this.passepartoutMaxHeight=options.passepartoutMaxHeight;this.showMousePointer=!!options.showMousePointer;Backbone.View.apply(this,arguments)},events:{mouseover:"addHighlight",mouseout:"removeHighlight"},render:function render(data){var canvasData=getCanvasData(this,data);this.$el.html(template(canvasData));imageHelper.attachLoadingListener(data.logoImage.url,showImage.bind(null,this,data),showErrorMessage.bind(null,this,data));canvasHelper.renderMask(this.$(VIEW_SELECTORS.primaryMask).get(0),canvasData);canvasHelper.renderMask(this.$(VIEW_SELECTORS.secondaryMask).get(0),canvasData,true)},addHighlight:function addHighlight(){this.$(VIEW_SELECTORS.image).addClass(CLASS_NAMES.highlight)},removeHighlight:function removeHighlight(){this.$(VIEW_SELECTORS.image).removeClass(CLASS_NAMES.highlight)},showPrimaryMask:function showPrimaryMask(){if(this._imageLoaded){this.$el.addClass(CLASS_NAMES.primaryMaskShowing)}},hidePrimaryMask:function hidePrimaryMask(){this.$el.removeClass(CLASS_NAMES.primaryMaskShowing)},showSecondaryMask:function showSecondaryMask(){if(this._imageLoaded){this.$el.addClass(CLASS_NAMES.secondaryMaskShowing)}},hideSecondaryMask:function hideSecondaryMask(){this.$el.removeClass(CLASS_NAMES.secondaryMaskShowing)}})});(function(root,factory){"use strict";if(typeof define==="function"&&define.amd){define("lib/tabler/tabler.pageSize",["jquery","underscore"],function($,_){return factory($,_)})}else{root.tabler.pageSize=factory(root.jQuery,root._)}})(this,function($,_){"use strict";function PageSize(options){_.extend(this,options||{})}PageSize.pluginName="pageSize";_.extend(PageSize.prototype,{render:function(){var sizes=this.sizes||[20,50,100],pager=this.pager,id=_.uniqueId("tabler-pageSize"),html=["<p class=pageSize>",'<label for="'+id+'">'+(this.beforeText||"Show")+"</label>",'<select id="'+id+'">'];_(sizes).forEach(function(size){html.push('<option value="'+size+'"'+(size===pager.pageSize?"selected":"")+">"+size+"</option>")});html=html.concat(["</select>","<span>"+(this.afterText||"items / page")+"</span></p>"]);return html.join("\n")},attach:function(table){var self=this;if(!table.pager){throw new Error("pageSize plugin cannot be used without the pager plugin")}this.pager=table.pager;var renderPager=this.originalRenderPager=this.pager.renderPager;table.pager.renderPager=function(table,data,spec){var pager=renderPager.apply(this,arguments),html=self.render();if(spec){html=pager.replace("</td>",html+"</td>")}else{html=pager+html}return html};table.$el.on("change","p.pageSize select",function(){var $select=$(this),val=$select.val();self.pager.updatePaging({currentPage:0,pageSize:parseInt(val,10)})})},detach:function(table){this.pager.renderPager=this.originalRenderPager;this.pager=undefined;this.originalRenderPager=undefined;table.$el.off("change","p.pageSize select")}});return PageSize});define("mustache!src/uhd/templates/uhd-breakdown-popup",["lib/mustache"],function(mustache){var escapedTemplate='<div class="uhd-breakdown-popup popup singlepadding">\n<p class="mediumtext bigline"><strong>Data from after Query creation/editing</strong></p>\n<p class="mediumtext bigline singlemargin-bottom js-ongoing-mentions">{{ongoingDataSize}} mentions</p>\n\n<p class="mediumtext bigline"><strong>Data from before Query creation/editing (Historical Data*)</strong></p>\n<p class="mediumtext bigline doublemargin-bottom"><span class="js-inflated-archive-mentions">~{{inflatedArchiveDataSize}} mentions</span> (out of which <span class="js-archive-mentions">{{archiveDataSize}}</span> are available in this table as a sample).</p>\n\n{{^isBrandwatchOrGreyLabelTheme}}\n<p class="uhd-popup__footnote mediumtext bigline grey">\nPlease talk to your account contact for more information\n</p>\n{{/isBrandwatchOrGreyLabelTheme}}\n{{#isBrandwatchOrGreyLabelTheme}}\n<p class="uhd-popup__footnote lightgrey">\nData from before Query creation/editing is powered by Brandwatch\'s archive of social and web content plus a scaled 10% sample of Twitter.\n<strong>Not every mention will be available</strong> &dash; <a href="https://support.brandwatch.com/hc/en-us/articles/227136648#howitworks" target="_blank">more details</a>\n</p>\n{{/isBrandwatchOrGreyLabelTheme}}\n</div>\n<div class="uhd-popup-arrow"></div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/uhd/views/UHDBreakdownPopupView",["backbone","src/globals/theme","bw-fe-helpers/numberHelper","mustache!src/uhd/templates/uhd-breakdown-popup","jquery.showRelativeTo"],function(Backbone,theme,numberHelper,uhdMentionsPopupTemplate){"use strict";var view;var destroyId;var DESTROY_TIMEOUT=300;var INITIAL_ARROW_X_POSITION=-7;var UHDBreakdownPopupView;function pointArrowAtTarget(view,$target){var viewPos=view.$el.offset();var targetPos=$target.offset();var $arrow=view.$(".uhd-popup-arrow");var arrowLeftPos=INITIAL_ARROW_X_POSITION+(targetPos.left-viewPos.left)+$target.outerWidth()/2;$arrow.css("left",arrowLeftPos+"px").toggleClass("uhd-popup-arrow--up",viewPos.top>targetPos.top)}function formatHistoricData(historicData){return{archiveDataSize:numberHelper.formatSpaceDelimitedNumber(historicData.archiveDataSize),inflatedArchiveDataSize:numberHelper.formatSpaceDelimitedNumber(historicData.inflatedArchiveDataSize),ongoingDataSize:numberHelper.formatSpaceDelimitedNumber(historicData.ongoingDataSize)}}function show($target,historicData){clearTimeout(destroyId);if(!view){view=new UHDBreakdownPopupView}if($target&&view.$target&&view.$target.get(0)===$target.get(0)){return}view.render(historicData);view.$target=$target;view.$el.appendTo("body").showRelativeTo({target:$target});pointArrowAtTarget(view,$target)}function destroy(){clearTimeout(destroyId);destroyId=setTimeout(function(){if(view){view.remove();view=null}},DESTROY_TIMEOUT)}UHDBreakdownPopupView=Backbone.View.extend({className:"uhd-mentions-popup-view",events:{mouseenter:function mouseenter(){UHDBreakdownPopupView.show(this.$target)},mouseleave:function mouseleave(){UHDBreakdownPopupView.destroy()}},render:function render(historicData){var formattedHistoricData=formatHistoricData(historicData);this.$el.html(uhdMentionsPopupTemplate({isBrandwatchOrGreyLabelTheme:theme.isBrandwatchOrGreyLabelTheme(),archiveDataSize:formattedHistoricData.archiveDataSize,inflatedArchiveDataSize:formattedHistoricData.inflatedArchiveDataSize,ongoingDataSize:formattedHistoricData.ongoingDataSize}))}},{show:show,destroy:destroy});return UHDBreakdownPopupView});define("mustache!src/components/mentions/templates/snippetsView",["lib/mustache"],function(mustache){var escapedTemplate='<header>\n<h1 class="singlemargin-left">\n{{#size}}\n{{itemsType}} <strong>{{start}} - {{end}}</strong> of {{^historicData}}<strong>{{size}}</strong>{{/historicData}}{{#historicData}}<strong><span class="linkblue link disabled js-historic-data">~{{size}}</span></strong>&nbsp;<span class="lightgrey">(includes Historical Data)</span>{{/historicData}}{{#isFacebook}} <a class="help icon-bwhelp" data-key="facebook-comments-dedupe"></a>{{/isFacebook}}{{#totalMentions}} out of {{totalMentions}} <a class="help icon-bwhelp" data-key="partially-available-mentions"></a>{{/totalMentions}}\n{{/size}}\n</h1>\n<form>\n{{#showDateFilter}}\n<p>\n<select name="dateRange" class="date selectfield">\n<option value="1">Today</option>\n<option value="8">Last 7 days</option>\n<option value="15">Last 14 days</option>\n<option value="31">Last 30 days</option>\n<option value="61">Last 60 days</option>\n</select>\n</p>\n{{/showDateFilter}}\n{{#showTermFilter}}\n<div class="searchBox modular">\n<div class="editor searchField search iconfield monospacefont collapsed {{^search}}empty{{/search}}">{{{search}}}</div>\n<input type="hidden" class="search-input" name="search" value="{{{search}}}">\n<button class="button smallmargin-left search-button">Go</button>\n</div>\n{{/showTermFilter}}\n{{#showSortOrderSelect}}\n<p>\n<label for="orderBy-{{uniqueId}}" class="doublemargin-left">Sort by</label>\n<select name="orderBy" id="orderBy-{{uniqueId}}" class="selectfield">\n<option value="date"{{#orderedBy}}date{{/orderedBy}}>Newest</option>\n<option value="forumPosts"{{#orderedBy}}forumPosts{{/orderedBy}}>Forum Posts</option>\n<option value="blogComments"{{#orderedBy}}blogComments{{/orderedBy}}>Blog Comments</option>\n<option value="twitterRetweets"{{#orderedBy}}twitterRetweets{{/orderedBy}}>Retweets</option>\n<option value="twitterFollowers"{{#orderedBy}}twitterFollowers{{/orderedBy}}>Twitter Followers</option>\n<option value="monthlyVisitors"{{#orderedBy}}monthlyVisitors{{/orderedBy}}>Site Visitors</option>\n<option value="mozRank"{{#orderedBy}}mozRank{{/orderedBy}}>mozRank</option>\n{{#showReachEstimate}}\n<option value="reachEstimate"{{#orderedBy}}reachEstimate{{/orderedBy}}>Reach</option>\n{{/showReachEstimate}}\n</select>\n</p>\n{{/showSortOrderSelect}}\n</form>\n</header>\n<div class="messages hidden"></div>\n<div class="resultsAndPager">\n<ol class="results" style="counter-reset:li {{listStartsAt}};">\n{{#items}}\n<li class="{{pageType}} highlightrow" lang="{{language}}" data-id="{{id}}">\n<div class="snippet--container">\n{{#showStars}}\n<a href="#star({{url}})" class="customtip starMention{{#starred}} starred{{/starred}}" title="Star this mention">&#x2605;</a>\n{{/showStars}}\n<div class="sentimentborder {{sentiment}}"></div>\n<article>\n{{^twitterMention}}\n<div class="snippet snippet--other">\n<header class="snippet__header">\n<span class="snippet__header-left">\n{{#isOfflinePublication}}\n<span class="snippet__logo snippet__logo--offline-publication smallmargin-right" data-id="{{id}}" data-authorid="{{authorId}}">\n{{#snippetsHeader}}\n{{{snippetsHeader}}}\n{{/snippetsHeader}}\n</span>\n<a class="snippet__date" href="#" target="_blank"><span class="externallink icon-external-link tinymargin-right"></span>{{formattedTimestamp}}</a>\n{{/isOfflinePublication}}\n{{^isOfflinePublication}}\n<a class="snippet__logo {{#facebookMention}} snippet__logo--facebook {{/facebookMention}} smallmargin-right" data-id="{{id}}" data-authorid="{{authorId}}"\ntitle="Show {{#facebookMention}}Facebook Profile for {{author}}{{/facebookMention}}{{^facebookMention}}Domain Info{{/facebookMention}}">\n{{#snippetsHeader}}\n{{{snippetsHeader}}}\n{{/snippetsHeader}}\n</a>\n<a class="snippet__date" href="{{url}}" target="_blank"><span class="externallink icon-external-link tinymargin-right"></span>{{formattedTimestamp}}</a>\n{{/isOfflinePublication}}\n<div class="authorline darkgrey tinymargin-bottom">\n{{#instagramMention}}<span class="logo icon-bwinstagram"></span>{{/instagramMention}}\n{{#author}}\n<span class="author" author-author="{{author}}" data-domain="{{domain}}">{{author}}</span>\n<span class="smallmargin-horizontal">-</span>\n{{/author}}\n{{#isOfflinePublication}}\n{{#publicationName}}\n<span class="site smallmargin-right" data-domain="{{domain}}" title="{{title}}" data-publication="{{publicationName}}">{{publicationName}}</span>\n{{/publicationName}}\n{{/isOfflinePublication}}\n{{^isOfflinePublication}}\n<span class="site smallmargin-right" data-domain="{{domain}}">{{domainStripped}}</span>\n{{/isOfflinePublication}}\n{{#facebookMention}}\n<span class="snippet__header-small">\n{{#isDarkPost}}\n<span class="smallmargin-right">(Dark Post)</span>\n{{/isDarkPost}}\n{{#isDarkComment}}\n<span class="smallmargin-right">(Dark Comment)</span>\n{{/isDarkComment}}\n{{#facebookLikes}}\n<span class="facebook-likes customtip smallmargin-right" title="Facebook Likes">Likes: {{facebookLikes}}</span>\n{{/facebookLikes}}\n{{#facebookShares}}\n<span class="facebook-shares customtip smallmargin-right" title="Facebook Shares">Shares: {{facebookShares}}</span>\n{{/facebookShares}}\n{{#facebookComments}}\n<span class="facebook-comments customtip smallmargin-right" title="Facebook Comments">Comments: {{facebookComments}}</span>\n{{/facebookComments}}\n</span>\n{{/facebookMention}}\n{{^facebookMention}}\n<span class="type grey smallmargin-right">({{typeName}})</span>\n<span class="snippet__header-small">\n{{#forumMention}}\n{{#posts}}\n<span class="posts customtip smallmargin-right" data-val="{{value}}" title="Forum Posts">Posts: {{formatted}}</span>\n{{/posts}}\n{{#views}}\n<span class="views customtip smallmargin-right" data-val="{{value}}" title="Forum Views">Views: {{formatted}}</span>\n{{/views}}\n{{/forumMention}}\n{{#blogMention}}\n{{#comments}}\n<span class="comments customtip smallmargin-right" data-val="{{value}}" title="Blog Comments">Comments: {{formatted}}</span>\n{{/comments}}\n{{/blogMention}}\n{{#normalMention}}\n{{#mozRank}}\n<span class="mozRank smallmargin-right" data-val="{{mozRank}}">mozRank: {{mozRank}}</span>\n{{/mozRank}}\n{{#visitors}}\n<span class="visitors smallmargin-right" data-val="{{value}}">Visitors: {{formatted}}</span>\n{{/visitors}}\n{{/normalMention}}\n</span>\n{{/facebookMention}}\n</div>\n{{#isOfflinePublication}}\n<a href="#" target="_blank" class="title-text readMention customtip bold" title="Read this mention">{{title}}</a>\n{{/isOfflinePublication}}\n{{^isOfflinePublication}}\n<a href="{{url}}" target="_blank" class="title-text readMention customtip bold" title="Read this mention">{{title}}</a>\n{{/isOfflinePublication}}\n</span>\n</header>\n<p class="summary">\n{{#summary}}\n<span class="text">{{{summary}}}</span>\n{{/summary}}\n</p>\n{{^isOfflinePublication}}\n{{{mentionsIntents}}}\n{{/isOfflinePublication}}\n</div>\n{{/twitterMention}}\n{{#twitterMention}}\n{{{twitterMention}}}\n{{/twitterMention}}\n{{#queryName}}\n<div class="query smallmargin-top" data-val="{{queryName}}">Query: {{{queryName}}}</div>\n{{/queryName}}\n<span class="clearRightToLeftLanguages"></span>\n{{#hasCategories}}\n<ul class="categories normalwrap floatleft smallpadding-top">\n{{#formattedCategories}}\n<li class="floatleft doublepadding-right category nowrap">\n<span class="floatleft grey smallpadding-right name">{{name}}:</span>\n<ul class="subcategories normalwrap floatleft">\n{{#subcategories}}\n<li class="floatleft smallpadding-horizontal smallmargin-right categorybox">{{.}}</li>\n{{/subcategories}}\n</ul>\n</li>\n{{/formattedCategories}}\n</ul>\n{{/hasCategories}}\n<span class="clearRightToLeftLanguages"></span>\n</article>\n{{#hasImage}}\n<div class="snippet--media-container modular">\n<div class="snippet--image">\n{{#logoImage}}\n<div class="js-passepartout"></div>\n{{/logoImage}}\n{{^logoImage}}\n{{#mediaImage}}\n{{{mediaImage}}}\n{{/mediaImage}}\n{{/logoImage}}\n</div>\n<div class="snippet--logo singlemargin-left">\n</div>\n</div>\n{{/hasImage}}\n</div>\n</li>\n{{/items}}\n</ol>\n{{#size}}\n<footer class="paging">\n{{{pager}}}\n</footer>\n{{/size}}\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/components/mentions/templates/snippetsDefaultHeader",["lib/mustache"],function(mustache){var escapedTemplate='{{#imageUrl}}\n<img class="snippet__favicon" src="{{imageUrl}}">\n{{/imageUrl}}\n{{^imageUrl}}\n<span class="snippet__favicon icon-bwuser tinypadding"></span>\n{{/imageUrl}}\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/components/mentions/templates/snippetsFacebookHeader",["lib/mustache"],function(mustache){var escapedTemplate='{{#avatarUrl}}\n<img class="snippet__avatar" src="{{avatarUrl}}">\n{{^isDark}}\n<img class="snippet__data-source-logo">\n{{/isDark}}\n{{/avatarUrl}}\n{{^avatarUrl}}\n<img class="snippet__facebook-placeholder">\n{{/avatarUrl}}\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/components/mentions/templates/snippetsInstagramHeader",["lib/mustache"],function(mustache){var escapedTemplate='{{#avatarUrl}}\n<img class="snippet__avatar" src="{{avatarUrl}}">\n{{/avatarUrl}}\n{{^avatarUrl}}\n<img class="snippet__instagram-placeholder">\n{{/avatarUrl}}\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/components/mentions/templates/mediaImage",["lib/mustache"],function(mustache){var escapedTemplate='{{#mediaUrl}}\n<img class="snippet__inline-image singlepadding-vertical" src="{{mediaUrl}}">\n{{/mediaUrl}}\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/components/mentions/templates/mediaObject",["lib/mustache"],function(mustache){var escapedTemplate='{{#mediaUrl}}\n<div class="b-img">\n<object\nclass="b-img__pic"\ndata="{{mediaUrl}}"\ntype="image/png">\n<span class="b-img__alt">\nThe post\'s image is no longer available.\n</span>\n</object>\n</div>\n{{/mediaUrl}}\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/components/mentions/css/twitterMention.css",["css!src/components/mentions/css/compiled.css"],function(){});function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}define("src/components/mentions/views/MentionsSnippetsView",["backbone","underscore","jquery","src/permissions","src/helpers/uhdHelpers","src/globals/currentDashboard","src/globals/flags","src/globals/flagNames","src/views/ComponentView","src/components/mentions/_singlemention/views/SingleMentionView","src/components/mentions/_mentionsprofile/views/DomainProfileView","src/components/mentions/_mentionsprofile/views/TwitterProfileView","src/components/mentions/_mentionsprofile/views/FacebookProfileView","src/components/mentions/helpers/logoDetectionHelper","src/components/mentions/helpers/offlinePublicationHelper","src/components/mentions/views/SiteContextMenu","src/components/mentions/views/EngageContextMenu","src/components/imagewall/components/logolist/LogoList","src/components/imagewall/components/passepartout/Passepartout","src/views/AuthorContextMenu","bw-fe-helpers/dateHelper","bw-fe-helpers/numberHelper","bw-fe-helpers/autoLinkHelper","bw-fe-helpers/urlHelper","bw-fe-helpers/isoDateHelper","bw-fe-helpers/windowHelper","src/helpers/mentionSnippetParser","src/helpers/twitterHelper","lib/tabler/tabler.pager","lib/tabler/tabler.pageSize","bw-fe-helpers/validationHelpers","bw-fe-helpers/faviconHelper","src/uhd/views/UHDBreakdownPopupView","mustache!src/components/mentions/templates/snippetsView","mustache!src/components/mentions/templates/twitterMention","mustache!src/components/mentions/templates/mentionsIntents","mustache!src/components/mentions/templates/snippetsDefaultHeader","mustache!src/components/mentions/templates/snippetsFacebookHeader","mustache!src/components/mentions/templates/snippetsInstagramHeader","mustache!src/components/mentions/templates/mediaImage","mustache!src/components/mentions/templates/mediaObject","src/packages/customtip","jquery.acify","css!src/components/mentions/css/snippets.css","css!src/components/mentions/css/twitterMention.css","css!src/uhd/css/uhdPopup.css"],function(Backbone,_,$,permissions,uhdHelpers,currentDashboard,flags,FLAGS,ComponentView,SingleMentionView,DomainProfileView,TwitterProfileView,FacebookProfileView,logoDetectionHelper,offlinePublicationHelper,SiteContextMenu,EngageContextMenu,LogoList,Passepartout,AuthorContextMenu,dateHelper,numberHelper,autoLinkHelper,urlHelper,isoDateHelper,windowHelper,mentionSnippetParser,twitterHelper,Pager,PageSize,validationHelpers,faviconHelper,UHDBreakdownPopupView,snippetsView,twitterMention,mentionsIntents,snippetsDefaultHeader,snippetsFacebookHeader,snippetsInstagramHeader,mediaImage,mediaObject){"use strict";function formatNumberForTemplate(val){if(val===undefined){return}return{value:val,formatted:numberHelper.prettyNumber(val)}}function formatCategories(categories,itemCategories){return _(itemCategories).chain().reduce(function(memo,subCatId){var subcat,cat=categories.find(function(cat){subcat=_(cat.get("children")).find(function(subCat){return subCat.id===subCatId});return!!subcat}),selectedCat,catName;if(!cat){return memo}catName=cat.get("name");selectedCat=memo[catName];if(!selectedCat){selectedCat=memo[catName]={name:catName,subcategories:[]}}selectedCat.subcategories.push(subcat.name);return memo},{}).values().value()}function getMediaUrl(item){var mediaUrl=item.logoImage&&item.logoImage.url;if(!mediaUrl&&validationHelpers.hasImageMediaUrl(item.mediaUrls)){mediaUrl=item.mediaUrls[0]}return mediaUrl}function getMediaObject(mediaUrl){if(!mediaUrl){return}return mediaObject({mediaUrl:urlHelper.removeProtocol(mediaUrl)})}function getMediaImage(mediaUrl){if(!mediaUrl){return}return mediaImage({mediaUrl:mediaUrl})}function removeExistingContextMenu(view){if(view.contextMenu){view.contextMenu.remove()}}function showUHDBreakdownPopupView(view,event){UHDBreakdownPopupView.show($(event.currentTarget),view.getHistoricDataBreakdown())}function destroyUHDBreakdownPopupView(){UHDBreakdownPopupView.destroy()}function removeLogoListViews(view){if(view.logoListViews&&view.logoListViews.length){view.logoListViews.forEach(function(view){return view.remove()})}view.logoListViews=[]}function renderLogoListViews(view,data){removeLogoListViews(view);data.items.forEach(function(item){var logos=item.logoImage&&item.logoImage.logos||[];if(!logos.length){return}var $logoContainer=view.$(".results li[data-id=".concat(item.id,"] .snippet--logo"));var logoListView=new LogoList({el:$logoContainer});logoListView.render(item.logoImage.logos);view.logoListViews.push(logoListView)})}function appendPassepartouts(view){Object.entries(view.passepartouts).forEach(function(_ref){var _ref2=_slicedToArray(_ref,2),key=_ref2[0],passepartout=_ref2[1];view.$('.results li[data-id="'.concat(key,'"] .js-passepartout')).append(passepartout.$el)})}function cleanupPassepartouts(view){if(Object.entries(view.passepartouts).length){Object.entries(view.passepartouts).forEach(function(_ref3){var _ref4=_slicedToArray(_ref3,2),passepartout=_ref4[1];passepartout.remove()});view.passepartouts={}}}function showPrimaryMask(view){_.values(view.passepartouts).forEach(function(passepartout){passepartout.showPrimaryMask()})}function hidePrimaryMask(view){_.values(view.passepartouts).forEach(function(passepartout){passepartout.hidePrimaryMask()})}function onRowMouseEnter(event){var id=event.currentTarget.dataset.id;var passepartout=this.passepartouts[id];if(passepartout){passepartout.showSecondaryMask()}}function onRowMouseLeave(event){var id=event.currentTarget.dataset.id;var passepartout=this.passepartouts[id];if(passepartout){passepartout.hideSecondaryMask()}}var MentionsSnippetsView=ComponentView.extend({tagName:"section",className:"mentionSnippets snippets",events:function events(){return{"click button":"onSearchInMentions","change select[name=orderBy]":"onReSort","change select[name=dateRange]":"onChangeDateRange","click a.starMention":"onStarMention","click .snippet__logo":"onViewProfile","click .twitterAuthor":"onClickTwitterUsername","click .twitterAvatar":"onClickTwitterAvatar","click .snippet":"onReadMention","click .authorline .author":"onClickAuthor","click .authorline .site":"onClickSite","click .twitterSummary a:not(.twitter-username)":"onClickTwitterMentionLink","click a.js-instagram-mention-url":"onClickInstagramMentionLink","click .editor":"initAceEditor","click .engage":"onClickEngage","mouseenter .js-historic-data":showUHDBreakdownPopupView.bind(null,this),"mouseleave .js-historic-data":destroyUHDBreakdownPopupView,"keydown .editor":"onEditorKeydown","mouseenter .results li[data-id]":onRowMouseEnter.bind(this),"mouseleave .results li[data-id]":onRowMouseLeave.bind(this)}},constructor:function MentionsSnippetsView(options){options=options||{};if(!options){throw new TypeError("MentionsSnippetsView should be called with an options argument")}if(!options.categories){throw new TypeError("MentionsSnippetsView should be called with a categories option")}var self=this;options.exportModel=options.exportModel||new Backbone.Model;this.viewOnly=!!options.viewOnly;this.showTermFilter=options.showTermFilter!==false;this.showDateFilter=!!options.showDateFilter;this.showSortOrderSelect=options.youtubeOnly?false:options.showSortOrderSelect!==false;this.isPopup=!!options.isPopup;this.itemsType=options.itemsType;this.timezone=options.timezone||currentDashboard.getTimezone();this.totalMentions=options.totalMentions;this.passepartouts={};this.componentEventBus=options.componentEventBus;this.youtubeOnly=options.youtubeOnly||false;this.categories=options.categories;ComponentView.apply(this,arguments);this.setListener();this.pager=new Pager;this.pageSize=new PageSize({sizes:[10,20,30,40,50,100]});var instance=_.extend({$el:this.$el,pager:this.pager,fetch:function fetch(options,callback){callback({totalResults:self.collection.resultsTotal,items:self.collection.toJSON()})}},Backbone.Events);this.pager.attach(instance);this.pageSize.attach(instance);instance.on("paged",function(pageOptions){self.settings.set({pageSize:pageOptions.pageSize,page:pageOptions.currentPage})})},setListener:function setListener(){this.listenTo(this.collection,"request",this.waitingForData);this.listenTo(this.collection,"sync",this.onSync);this.listenTo(this.collection,"invalid",this.showInvalidMessage);if(this.componentEventBus){this.listenTo(this.componentEventBus,"mouseover",showPrimaryMask.bind(null,this));this.listenTo(this.componentEventBus,"mouseout",hidePrimaryMask.bind(null,this))}},getHistoricDataBreakdown:function getHistoricDataBreakdown(){return this.collection.getHistoricDataBreakdown()},onSync:function onSync(){if(this.isBeingSaved){this.isBeingSaved=false;return}this.render()},onClickAuthor:function onClickAuthor(e){e.preventDefault();e.stopPropagation();var $target=$(e.target),mentionId=$target.closest("li").data("id"),model=this.collection.get(mentionId),isTwitter=model.get("pageType")==="twitter",isFacebook=model.get("pageType")==="facebook",isMentionAuthorline=!!$target.closest(".authorline").length;this.showAuthorMenu(model.get("author"),model.get("facebookAuthorId"),$target,isTwitter,isFacebook,isMentionAuthorline)},showAuthorMenu:function showAuthorMenu(author,authorId,$target,isTwitter,isFacebook,isMentionAuthorline){removeExistingContextMenu(this);this.contextMenu=AuthorContextMenu.show({authorId:authorId,author:author,$target:$target,settings:this.settings,isTwitterProfile:!!isTwitter,isFacebookProfile:!!isFacebook,isMentionAuthorline:isMentionAuthorline})},onClickSite:function onClickSite(e){e.preventDefault();e.stopPropagation();var $target=$(e.target),mentionId=$target.closest("li").data("id"),mention=this.collection.get(mentionId),mentionUrl=mention.get("url"),mentionTitle=mention.get("title"),publicationName=mention.get("publicationName");this.showSiteMenu($target.data("domain"),$target,mentionUrl,mentionTitle,publicationName)},showSiteMenu:function showSiteMenu(domain,$target,mentionUrl,mentionTitle,publicationName){removeExistingContextMenu(this);this.contextMenu=SiteContextMenu.show({domain:domain,mentionUrl:mentionUrl,mentionTitle:mentionTitle,$target:$target,settings:this.settings,publicationName:publicationName})},onClickTwitterMentionLink:function onClickTwitterMentionLink(e){e.stopPropagation()},onClickInstagramMentionLink:function onClickInstagramMentionLink(e){e.stopPropagation()},onClickTwitterUsername:function onClickTwitterUsername(e){var $target=$(e.target);e.preventDefault();e.stopPropagation();removeExistingContextMenu(this);this.contextMenu=AuthorContextMenu.show({settings:this.settings,$target:$target,author:$target.closest("[data-screen-name]").data("screen-name"),isTwitterProfile:true,hideMentions:!!this.isPopup})},onClickTwitterAvatar:function onClickTwitterAvatar(e){e.preventDefault();e.stopPropagation();var $target=$(e.currentTarget),author=$target.closest(".twitterAuthor").data("screen-name");if(!author){return}TwitterProfileView.show(author)},onClickEngage:function onClickEngage(e){var $target=$(e.target),mentionId=$target.closest("li").data("id"),model=this.collection.get(mentionId);e.preventDefault();e.stopPropagation();removeExistingContextMenu(this);this.contextMenu=EngageContextMenu.show({$target:$(e.target),mention:model})},onSearchInMentions:function onSearchInMentions(e){var search;e.preventDefault();if(this.aceEditor){this.updateSearchTermAndShrink()}search=this.$(".search-input").val();this.settings.set({search:search,page:0})},onReSort:function onReSort(e){var orderBy=$(e.target).val();this.settings.set({orderBy:orderBy,page:0});this.trigger("sort",orderBy)},onChangeDateRange:function onChangeDateRange(e){var dateRange=$(e.target).val();this.settings.set({dateRange:"P"+dateRange+"D"})},onStarMention:function onStarMention(e){e.preventDefault();e.stopPropagation();var $target=$(e.target),mentionId=$target.closest("li").data("id"),mention=this.collection.get(mentionId);this.isBeingSaved=true;mention.save({starred:!$target.is(".starred")},{patch:true});$(e.target).toggleClass("starred")},onViewProfile:function onViewProfile(e){e.preventDefault();e.stopPropagation();var $target=$(e.currentTarget),mentionId=$target.data("id"),mention=this.collection.get(mentionId);if(this.profileView){this.profileView.remove()}if(mention.get("pageType")==="twitter"){this.profileView=TwitterProfileView.show(mention.get("author"))}else if(mention.get("pageType")==="facebook"){var authorId=$target.data("authorid"),authorName=mention.get("author");if(!authorId){return}this.profileView=FacebookProfileView.show({authorId:authorId,authorName:authorName,mentionUrl:"http://www.facebook.com/"+authorId,showPopularity:false})}else{if(!mention.get("isOfflinePublication")){this.profileView=DomainProfileView.show(mention.get("url"),mention.get("title"))}}},onReadMention:function onReadMention(event){if(this.youtubeOnly){var $anchor=$(event.currentTarget).find("a.readMention");windowHelper.open($anchor.attr("href"));return}var $target=$(event.target),mentionId;if($target.closest(".snippet-date-link, .twitterIntents").length){return}event.preventDefault();if(this.contextMenu&&this.contextMenu.isShown()){return}event.stopPropagation();mentionId=$target.closest("li").data("id");SingleMentionView.show({mentionId:mentionId,mentions:this.collection})},waitingForData:function waitingForData(model,xhr,options){var $container=this.$(".messages");if(options&&(options.patch||options.streaming)){return}$container.hideMessage();this.$("div.resultsAndPager").addClass("hidden");options=_.extend({text:"Waiting for data...",opacity:.33},options);$container.showMessage(options).removeClass("hidden")},showInvalidMessage:function showInvalidMessage(model,error){this.showMessage(error,"notification-error")},showErrorMessage:function showErrorMessage(model,res){this.showMessage(this.getErrorMessage(res),"notification-error")},showMessage:function showMessage(message,className){var $container=this.$(".messages");this.$("div.resultsAndPager ol").addClass("hidden");$container.hideMessage().showMessage({text:message,className:className||""}).removeClass("hidden")},hideMessage:function hideMessage(){this.$(".messages").addClass("hidden").hideMessage();this.$(".resultsAndPager").removeClass("hidden")},disableSortSelect:function disableSortSelect(){var $select=this.$("select[name=orderBy]");return $select.prop("disabled",true)},initAceEditor:function initAceEditor(e){var editorDiv=$(e.currentTarget);if(this.aceEditor){this.expandSearchField();return}editorDiv.acify({autoResize:true,onReady:_.bind(function(opts){this.aceEditor=opts.editor;this.editorDiv=$(opts.editor.container);this.expandSearchField();this.aceEditor.focus();this.aceEditor.navigateLineEnd()},this),onBlur:_.bind(this.updateSearchTermAndShrink,this)})},onEditorKeydown:function onEditorKeydown(e){if(e.which===13&&!e.shiftKey){e.preventDefault();$(e.target).blur();this.onSearchInMentions(e)}else if(e.which===27&&!e.shiftKey){e.preventDefault();$(e.target).blur()}},expandSearchField:function expandSearchField(){var editorDiv=this.editorDiv,aceEditor=this.aceEditor;editorDiv.removeClass("collapsed empty").addClass("expanded");aceEditor.fitToContents(true);editorDiv.one("transitionend",function(){aceEditor.resize()})},onClickButton:function onClickButton(e){this.trigger("changesMade");this.trigger("search",e)},updateSearchTermAndShrink:function updateSearchTermAndShrink(){this.updateSearchTerm();this.shrinkSearchField()},updateSearchTerm:function updateSearchTerm(){this.$(".search-input").val(this.aceEditor.getValue())},shrinkSearchField:function shrinkSearchField(){var editorDiv=this.editorDiv,aceEditor=this.aceEditor;editorDiv.addClass("collapsed").removeClass("expanded");editorDiv.css({height:""});aceEditor.scrollToRow(0);editorDiv.one("transitionend",function(){aceEditor.resize()})},render:function render(){var self=this,startIndex=this.collection.resultsPage*this.collection.resultsPageSize+1,startDate=this.settings.getQueryData().startDate,historicData=uhdHelpers.hasHistoricData(this.collection,startDate),mentionsCount=historicData?this.collection.inflatedTotalDataSize:this.collection.resultsTotal,data={items:this.collection.toJSON(),start:startIndex,size:mentionsCount,end:startIndex+this.collection.size()-1},orderBy=this.settings.get("orderBy"),pager=this.pager,pageSize=this.pageSize,queryId=this.settings.get("queryId")||[],multipleQueries=this.settings.get("currentMode")==="queryGroup"||queryId.length>1,dateRange=isoDateHelper.parseISODatePeriod(this.settings.get("dateRange")),twitterMentionData,editorDiv=this.editorDiv,logoImagesGroupId=this.settings.get("logoImagesGroupId");function getTwitterMentionData(item){return{id:item.id,author:item.author,authorName:item.author,tweets:formatNumberForTemplate(item.twitterPostCount),twitterVerified:item.twitterVerified===true,intents:twitterHelper.getIntentsMarkupFromUrl(item.url,true),summary:item.summary,avatarUrl:item.avatarUrl||"/img/twitter-profile-default.png",twitterFullName:item.twitterFullName?item.twitterFullName.trim():"",formattedTimestamp:item.formattedTimestamp,url:item.url,retweets:item.twitterRetweets||0,impressions:item.impressions||0,replies:item.twitterReplyCount||0,mediaUrl:item.mediaUrl,mediaImage:item.mediaImage,prefix:"snippet"}}function getFormattedCategories(item,categories){var formattedCategories;if(item.categories&&!!item.categories.length){formattedCategories=formatCategories(categories,item.categories)}if(item.tags&&!!item.tags.length){if(!formattedCategories){formattedCategories=[]}formattedCategories.push({name:"Tags",subcategories:item.tags})}return formattedCategories}function setPageTypeData(item){switch(item.pageType){case"twitter":item.normalMention=undefined;item.summary=autoLinkHelper.twitterContent(item.summary,{urlEntities:item.urlEntities||twitterHelper.makeUrlEntities(item),htmlEscapeNonEntities:false});item.mediaImage=getMediaObject(item.mediaUrl);twitterMentionData=getTwitterMentionData(item);if(data.showStars){twitterMentionData.showStars={starred:item.starred}}item.twitterMention=twitterMention(twitterMentionData,false);break;case"facebook":{item.facebookMention=true;item.isDarkPost=item.resourceType==="dark-facebook-post";item.isDarkComment=item.resourceType==="dark-facebook-comment";var isDark=item.isDarkPost||item.isDarkComment;var avatarUrl=isDark?"/img/facebook-dark-post.png":item.avatarUrl;item.snippetsHeader=snippetsFacebookHeader({avatarUrl:avatarUrl,isDark:isDark});item.mediaImage=getMediaObject(item.mediaUrl);break}case"instagram":item.instagramMention=true;item.snippetsHeader=snippetsInstagramHeader({avatarUrl:item.avatarUrl||"/img/instagram-profile-default.png"});item.summary=autoLinkHelper.instagramContent(item.summary,{htmlEscapeNonEntities:false});item.mediaImage=getMediaObject(item.mediaUrl);break;case"forum":item.forumMention={posts:formatNumberForTemplate(item.forumPosts),views:formatNumberForTemplate(item.forumViews)};item.snippetsHeader=snippetsDefaultHeader({imageUrl:item.imageUrl});item.mediaImage=getMediaImage(item.mediaUrl);break;case"blog":item.blogMention={comments:formatNumberForTemplate(item.blogComments)};item.snippetsHeader=snippetsDefaultHeader({imageUrl:item.imageUrl});item.mediaImage=getMediaImage(item.mediaUrl);break;default:item.snippetsHeader=snippetsDefaultHeader({imageUrl:item.imageUrl});item.mediaImage=getMediaImage(item.mediaUrl);break}}this.clearWaitingMessage();cleanupPassepartouts(this);data.historicData=historicData;data.uniqueId=_.uniqueId();data.search=_.escape(this.settings.get("search")||"");data.showStars=permissions.check("edit.mentions",currentDashboard)?!this.viewOnly:false;data.showAddToSiteGroup=permissions.check("edit.groups",currentDashboard)?!this.viewOnly:false;data.showTermFilter=!!this.showTermFilter;data.showDateFilter=!!this.showDateFilter;data.showSortOrderSelect=!!this.showSortOrderSelect;data.itemsType=this.itemsType||"Mentions";data.isFacebook=this.settings.get("resourceType")==="public-facebook-comment";data.totalMentions=this.totalMentions;if(data.items){data.listStartsAt=data.start-1;data.items=data.items.map(function(item){if(!multipleQueries){delete item.queryName}item.formattedCategories=getFormattedCategories(item,self.categories);item.hasCategories=item.formattedCategories&&!!item.formattedCategories.length;item.title=item.title||"No Title";item.formattedTimestamp=dateHelper.formatTimeStamp(item.date,self.timezone);item.summary=mentionSnippetParser.parse(item.snippet||"",item.matchPositions);item.typeName=_.isUndefined(item.pageType)?"General":_.capitalize(item.pageType);item.domainStripped=(item.domain||"").replace(/^www\./,"");item.normalMention={mozRank:Math.round(item.mozRank*100)/100,visitors:formatNumberForTemplate(item.visitors)};var url=item.url;if(item.isOfflinePublication){url=offlinePublicationHelper.getOnlineUrl(item.domain)}item.imageUrl=faviconHelper.getFaviconUrl(url);if(item.logoImages){item.logoImage=logoDetectionHelper.getDefaultLogoImage(item.logoImages,logoImagesGroupId);var passepartout=new Passepartout({showMousePointer:false,passepartoutMaxHeight:100,passepartoutMaxWidth:160});passepartout.render({logoImage:item.logoImage});self.passepartouts[item.id]=passepartout}item.mediaUrl=getMediaUrl(item);setPageTypeData(item);item.mentionsIntents=mentionsIntents();item.hasImage=item.logoImage||item.mediaImage;return item});pager.currentPage=this.collection.resultsPage;pager.totalResults=this.collection.resultsTotal;pager.pageSize=this.settings.get("pageSize");pager.pager=function(data,pageOptions,callback){self.settings.set({pageSize:pageOptions.pageSize,page:pageOptions.currentPage});callback()};data.pager=function(){return pager.render(data.items)};data.pageSize=function(){return pageSize.render()}}data.orderedBy=function(){return function(field){return orderBy===field?" selected":""}};data.showReachEstimate=flags.variation(FLAGS.ENABLE_REACH_METRIC);if(editorDiv){editorDiv.detach()}this.$el.html(snippetsView(data));appendPassepartouts(this);this.$el.customtip();this.$("img").on("error",function(){$(this).css({visibility:"hidden"})});if(editorDiv){this.$(".editor").replaceWith(editorDiv)}if(!data.items.length){this.showMessage("No results")}else{renderLogoListViews(this,data)}if(this.showDateFilter){if(dateRange.d){this.$("[name=dateRange]").val(dateRange.d.toString()||8)}}},remove:function remove(){removeLogoListViews(this);ComponentView.prototype.remove.call(this)}});return MentionsSnippetsView});define("mustache!templates/ruleSettingsView",["lib/mustache"],function(mustache){var escapedTemplate='<div>\n<a class="link hidden toggleInstructions floatright doublemargin-right smallmargin-top">\n<span class="instructionLabel hidden">Hide Instructions</span><span class="instructionLabel">Show Instructions</span>\n</a>\n<h1 class="popuptitletext ninecolmax textellipsis draggable">\n{{#isNew}}Create Rule - Settings{{/isNew}}{{^isNew}}Edit Rule "{{ruleName}}" - Settings{{/isNew}}\n</h1>\n<div class="errorPane notifications rounded smallpadding-top"></div>\n</div>\n<article class="bwscrollbar singlemargin-top">\n<aside>\n<form class="controls">\n</form>\n</aside>\n<div class="overlay hidden"></div>\n{{#showInstructions}}\n<div class="instructions eightcol">\n<h2>What is a Rule?</h2>\n<p>A Rule automatically applies an action like <strong>\'categorise\'</strong> or <strong>\'tag\'</strong> to any mentions that match the Filters you define here.</p>\n<ul class="steps pagemargin-horizontal pagemargin-top">\n<li><span class="stepDigit">1</span>Pick one or more Queries</li>\n<li><span class="stepDigit">2</span>Put in a search term <span class="medium">(optional)</span></li>\n<li><span class="stepDigit">3</span>Apply Filters <span class="medium">(optional)</span></li>\n<li><span class="stepDigit">4</span>Test your search <span class="medium">(repeat until happy)</span></li>\n<li><span class="stepDigit">5</span>Click "Next" <span class="medium">to set up what actions to take</span></li>\n</ul>\n<p class="hint">You can also create a Rule within the <b>Mentions Component</b> of a Dashboard.</p>\n</div>\n{{/showInstructions}}\n<div class="content eightcol floatright singlepadding-horizontal {{#showInstructions}}hidden{{/showInstructions}}">\n</div>\n</article>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!css/ruleSettingsView.css",["css!css/compiled.css"],function(){});define("src/views/RuleSettingsView",["q","underscore","src/globals/queries","src/components/mentions/models/MentionCollection","src/globals/categories","src/globals/languages","src/globals/tags","src/globals/currentProject","src/models/RuleControls","src/models/QuerySearchWithinValidation","src/views/RuleStepView","src/views/RuleControlsView","src/components/mentions/views/MentionsSnippetsView","mustache!templates/ruleSettingsView","lib/jquery.showNotification","css!css/ruleSettingsView.css"],function(Q,_,queries,MentionCollection,categories,globalLanguages,tags,currentProject,RuleControls,QuerySearchWithinValidation,RuleStepView,RuleControlsView,MentionsSnippetsView,ruleSettingsView){"use strict";function _getValues(view){var filter=view.settings.getQueryData(),applyToProject=view.controlsView.getSettings().applyToProject;delete filter.orderBy;delete filter.orderDirection;delete filter.page;delete filter.pageSize;delete filter.startDate;delete filter.endDate;if(filter.author){filter.author=[].concat(filter.author)}if(filter.exactAuthor){filter.exactAuthor=[].concat(filter.exactAuthor)}if(applyToProject){delete filter.queryId;filter.projectId=currentProject.id}else{delete filter.projectId}view.snippetsView.hideMessage();return{scope:applyToProject?"project":"query",filter:filter}}return RuleStepView.extend({className:RuleStepView.prototype.className+" ruleSettingsView",events:{"click a.toggleInstructions":function onToggleInstructions(e){var view=this;e.preventDefault();view.$(".instructions").toggleClass("hidden");view.$(".content").toggleClass("hidden");view.$(".instructionLabel").toggleClass("hidden")}},constructor:function RuleSettingsView(){var _this=this;RuleStepView.apply(this,arguments);var model=this.model;this.settings=new RuleControls(_.extend({queryId:model.get("queryId"),queryName:(queries.get(model.get("queryId"))||{get:function get(){}}).get("name"),dateRange:"P31D",scope:model.get("scope")},model.get("filter")));this.controlsViewReadyPromise=this.getControlsViewOptions().then(function(controlsViewOptions){_this.controlsView=new RuleControlsView(controlsViewOptions)});this.mentions=new MentionCollection([],{settings:_.clone(this.settings.toJSON())});this.snippetsView=new MentionsSnippetsView({collection:this.mentions,settings:this.mentions.settings,viewOnly:true,showTermFilter:false,showDateFilter:true,categories:categories});this.listenTo(this.settings,"change",this.settingsChanged);this.listenTo(this.settings,"invalid",this.handleCJKError);this.listenTo(this.settings,"cjk info",this.handleCJKInfoMessaging)},handleCJKError:function handleCJKError(model,errors){var hasCJKError=errors&&errors.some(function(error){return error==="CJK error"});if(hasCJKError){this.showErrorMessage(model,"Sorry, the raw: operator is not compatible with Chinese, Japanese or Korean Queries. Please review your search.")}},handleCJKInfoMessaging:function handleCJKInfoMessaging(msg){if(msg==="show warning"){this.showNotification({text:"Please note that the raw: operator is not compatible with Chinese, "+"Japanese or Korean Queries and won’t work for them.",cssClass:"notification-warning cjk-warning",omitClose:false})}else if(this.$el.find(".cjk-warning").length){this.removeNotification()}},showNotification:function showNotification(options){var $el=this.$el;$el.addClass("hasNotification");this.$(".notifications").empty().showNotification(_.extend({onRemoved:function onRemoved(){$el.removeClass("hasNotification")}},options))},removeNotification:function removeNotification(){this.$(".notifications").empty();this.$el.removeClass("hasNotification")},getControlsViewOptions:function getControlsViewOptions(){var _this2=this;var deferred=Q.defer();globalLanguages.load(function(err,languages){if(err){deferred.reject();return}deferred.resolve({categories:categories,model:_this2.settings,tags:tags,languages:languages})});return deferred.promise},remove:function remove(){var _this3=this;this.controlsViewReadyPromise.then(function(){_this3.controlsView.remove()});this.snippetsView.remove();RuleStepView.prototype.remove.call(this)},render:function render(){var _this4=this;var model=this.model;this.$el.html(ruleSettingsView({showInstructions:true,isNew:_.isUndefined(model.id),ruleName:model.get("name")}));var controlsViewRenderPromise=this.controlsViewReadyPromise.then(function(){_this4.controlsView.setElement(_this4.$("aside form.controls"));_this4.controlsView.render()});this.snippetsView.render();this.$(".content").append(this.snippetsView.el);this.focusInput();return controlsViewRenderPromise},focusInput:function focusInput(){this.$(".selleckt").focus()},showErrorMessage:function showErrorMessage(model,message){this.$(".instructions").addClass("hidden");this.$(".content").removeClass("hidden");this.$("h1 a.toggleInstructions").removeClass("hidden");this.mentions.trigger("invalid",model,message)},settingsChanged:function settingsChanged(){var $content=this.$(".content"),settings=this.settings.toJSON();settings.queryId=settings.testSearchQueryId||settings.queryId[0];delete settings.dateRange;delete settings.testSearchQueryId;delete settings.pageSize;delete settings.orderBy;delete settings.orderDirection;settings.page=0;settings.lastUpdated=(new Date).getTime();this.mentions.settings.set(settings);this.$(".instructions").addClass("hidden");$content.removeClass("hidden");this.$("a.toggleInstructions").removeClass("hidden")},getValues:function getValues(callback){var self=this,settings=this.controlsView.getSettings(),queryValidation,values;if(!this.settings.set(settings,{validate:true})){return callback("Please check the settings/filters section")}values=_getValues(this);if(!settings.search){return callback(null,values)}queryValidation=new QuerySearchWithinValidation({query:settings.search});this.snippetsView.showMessage("Validating search term...");queryValidation.fetch({success:function success(){var errors=[].concat(queryValidation.get("validation_errors")||[]);if(errors&&errors.length){self.showErrorMessage(queryValidation,errors[0]);return callback(errors[0])}return callback(null,values)},error:function error(model){var errorMessage="An error occurred while validating your search term.";self.showErrorMessage(model,errorMessage);return callback(errorMessage)}})}})});define("mustache!templates/chooseSentiment",["lib/mustache"],function(mustache){var escapedTemplate='<section>\n<ul>\n<li class="nochange smallpadding-left">\n<input id="{{id}}-nochange" type="radio" name="sentiment" value {{#nochange}}checked{{/nochange}} />\n<label for="{{id}}-nochange"><span class="name">No change</span> <span class="status"></span></label>\n</li>\n<li class="separator singlepadding-bottom rowborder singlemargin-bottom"></li>\n<li class="positive tinypadding-vertical smallpadding-left">\n<input id="{{id}}-positive" type="radio" name="sentiment" value="positive" {{#positive}}checked{{/positive}} />\n<label for="{{id}}-positive"><span class="name">Positive</span> <span class="status"></span></label>\n</li>\n<li class="neutral tinypadding-vertical smallpadding-left">\n<input id="{{id}}-neutral" type="radio" name="sentiment" value="neutral" {{#neutral}}checked{{/neutral}} />\n<label for="{{id}}-neutral"><span class="name">Neutral</span> <span class="status"></span></label>\n</li>\n<li class="negative tinypadding-vertical smallpadding-left">\n<input id="{{id}}-negative" type="radio" name="sentiment" value="negative" {{#negative}}checked{{/negative}} />\n<label for="{{id}}-negative"><span class="name">Negative</span> <span class="status"></span></label>\n</li>\n</ul>\n</section>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/views/ChooseSentimentView",["backbone","jquery","mustache!templates/chooseSentiment"],function(Backbone,$,chooseSentimentTemplate){"use strict";return Backbone.View.extend({events:{"change input[type=radio]":"onChangeSentiment"},initialize:function initialize(options){this.selected=options&&options.selected},render:function render(){this.$el.html(chooseSentimentTemplate({nochange:!this.selected,positive:this.selected==="positive",neutral:this.selected==="neutral",negative:this.selected==="negative"}))},onChangeSentiment:function onChangeSentiment(e){var $input=$(e.target);this.selected=$input.attr("value")||undefined;this.trigger("selected",this.selected);$input.closest("li").addClass("adding").siblings().removeClass("adding").find("label span.status").text("");if(this.selected){$input.next("label").find(".status").text("(adding this)")}else{this.$("li").removeClass("adding")}}})});define("mustache!templates/chooseEmotion",["lib/mustache"],function(mustache){var escapedTemplate='<section class="chooseemotion">\n<ul>\n{{#items}}\n<li class="tinypadding-vertical smallpadding-left {{#checked}}adding{{/checked}}">\n<label>\n<input type="checkbox" value="emotions:{{id}}" name="emotion" {{#checked}}checked{{/checked}} class="js-select-emotion" />\n<span class="js-name {{#checked}}bold{{/checked}}">{{name}}</span>\n</label>\n</li>\n{{/items}}\n</ul>\n</section>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!css/chooseemotionview.css",["css!css/compiled.css"],function(){});function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};var ownKeys=Object.keys(source);if(typeof Object.getOwnPropertySymbols==="function"){ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))}ownKeys.forEach(function(key){_defineProperty(target,key,source[key])})}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}define("src/views/ChooseEmotionView",["underscore","backbone","src/globals/classifications","mustache!templates/chooseEmotion","css!css/chooseemotionview.css"],function(_,Backbone,globalClassifications,template){"use strict";var VIEW_SELECTOR={SELECT:".js-select-emotion",NAME:".js-name"};function getTemplateData(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var mode=options.mode,_options$addClassific=options.addClassifications,addClassifications=_options$addClassific===void 0?[]:_options$addClassific,_options$removeClassi=options.removeClassifications,removeClassifications=_options$removeClassi===void 0?[]:_options$removeClassi;var checkedClassifications=mode==="add"?addClassifications:removeClassifications;return{mode:_.capitalize(mode),items:globalClassifications.getEmotionLabels().map(function(emotion){if(checkedClassifications.includes("emotions:".concat(emotion.id))){return _objectSpread({},emotion,{checked:true})}return emotion})}}function highlightSelected(view){view.$("".concat(VIEW_SELECTOR.NAME)).removeClass("bold");view.$("".concat(VIEW_SELECTOR.SELECT,":checked ~ ").concat(VIEW_SELECTOR.NAME)).addClass("bold")}return Backbone.View.extend({constructor:function ChooseEmotionView(options){Backbone.View.apply(this,arguments);this.options=options},render:function render(){var templateData=getTemplateData(this.options);this.$el.html(template(templateData))},events:function events(){return _defineProperty({},"change ".concat(VIEW_SELECTOR.SELECT),"onSelect")},onSelect:function onSelect(){var checkboxes=this.$("".concat(VIEW_SELECTOR.SELECT,":checked")).toArray();var attrs=_defineProperty({},"".concat(this.options.mode,"Classifications"),checkboxes.map(function(_ref2){var value=_ref2.value;return value}));highlightSelected(this);this.trigger("selected",attrs)}})});define("mustache!templates/chooseLocation",["lib/mustache"],function(mustache){var escapedTemplate='<section>\n<p class="smallpadding-bottom smallpadding-left">\n<input class="iconfield filterList field autocomplete" type="text" style="width:60%" name="filter" placeholder="Type to find locations" value="{{locationName}}" autocomplete="off" autofocus />\n</p>\n</section>';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/views/ChooseLocationView",["backbone","jquery","underscore","src/Workbench","mustache!templates/chooseLocation","jquery.autocomplete/jquery.autocomplete","jquery.autocomplete/jquery.autocomplete.ajax"],function(Backbone,$,_,Workbench,chooseLocationTemplate){"use strict";return Backbone.View.extend({initialize:function initialize(options){var _this=this;this._handlerReference=function(event){return _this.clickOff(event)};$("body").on("click",this._handlerReference);if(options){this.location=options.location||""}else{this.location=""}},render:function render(){this.$el.html(chooseLocationTemplate({locationName:this.location.name||""}));this.initAutocomplete();this.trigger("selected",this.location)},clickOff:function clickOff(e){var $target=$(e.target);if($target.hasClass("autocomplete")){return true}this.$el.html(chooseLocationTemplate({locationName:this.location.name}));this.initAutocomplete()},initAutocomplete:function initAutocomplete(options){var _this2=this;var defaults={css:{class:"filterList",width:540},renderResult:function renderResult(result){return _this2.formatLocationName(result.fullName)},selected:function selected(result){_this2.location=result;_this2.render()},parseData:function parseData(data){return data.results},plugins:[{plugin:$.fn.autocomplete.ajax,options:{url:Workbench.buildApiUrl("/locations"),params:{pageSize:20,page:0}}}]};options=options||{};this.$(".autocomplete").autocomplete(_.extend({},defaults,options))},formatLocationName:function formatLocationName(name){var commaIdx=name.indexOf(",");name="<em>"+name.substring(0,commaIdx>-1?commaIdx:name.length)+"</em>"+(commaIdx>-1?name.substring(commaIdx,name.length):"");return name.length>83?name.substring(0,80)+"...":name},remove:function remove(){$("body").off("click",this._handlerReference);delete this._handlerReference}})});define("mustache!templates/chooseTag",["lib/mustache"],function(mustache){var escapedTemplate='<section>\n<p class="smallpadding-bottom smallpadding-left">\n<input class="iconfield filterList fivecol" type="text" name="filter" maxlength="200" placeholder="Search or create Tag" value="{{filter}}" autocomplete="off" autofocus />\n</p>\n<p class="createTagMessage hidden smallpadding-bottom smallpadding-left"></p>\n<ul>\n{{#tags}}\n<li data-name="{{lowerCaseName}}" class="{{#hidden}}hidden{{/hidden}} tinypadding-vertical smallpadding-left {{#checked}}adding{{/checked}}">\n<input id="ss-{{formid}}-{{id}}" type="{{#allowMultipleSelections}}checkbox{{/allowMultipleSelections}}{{^allowMultipleSelections}}radio{{/allowMultipleSelections}}" value="{{id}}" name="tag" {{#checked}}checked{{/checked}} />\n<label for="ss-{{formid}}-{{id}}">\n<span class="name">{{name}}</span>\n<span class="status">{{#checked}}(adding this){{/checked}}</span>\n</label>\n</li>\n{{/tags}}\n</ul>\n</section>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});(function($){"use strict";$.fn.clearableTextField=function(){var $this=$(this);if($this.length<=0){return}$this.on("keyup change paste cut input",function(){trigger($this)});$this.each(function(){$this.data("original-padding-right",$this.css("padding-right"));addClearButton($this)})};function trigger(input){var clearButton=input.closest(".clearButtonWrapper").find(".textClearButton");if(input.val().length>0){clearButton.show();updateClearButtonPosition(input,clearButton)}else{clearButton.hide()}}function updateClearButtonPosition(input,clearButton){var pos=input.position(),offset=Math.round((input.outerHeight(true)-clearButton.outerHeight())/2);clearButton.css({top:pos.top+offset})}function addClearButton(input,setFocus){var wrap=input.parent(),clearButton,w;if(!wrap.hasClass("clearButtonWrapper")){wrap=input.wrap('<div class="clearButtonWrapper" />')}input.after("<div class='textClearButton'></div>");clearButton=input.next();w=clearButton.outerHeight();input.css("padding-right",input.data("original-padding-right")+w+4);updateClearButtonPosition(input,clearButton);clearButton.click(function(){input.val("");trigger(input);input.change();input.focus()});if(!input.val().length){clearButton.hide()}if(setFocus&&!_.isUndefined(setFocus)){input.focus()}}})(jQuery);define("lib/jquery.clearabletext/jquery.clearableText",function(){});define("css!lib/jquery.clearabletext/jquery.clearableText.css",["css!lib/jquery.clearabletext/compiled.css"],function(){});define("src/views/ChooseTagView",["backbone","jquery","underscore","mustache!templates/chooseTag","lib/jquery.clearabletext/jquery.clearableText","lib/jquery.notify","lib/jquery.showMessage","css!lib/jquery.clearabletext/jquery.clearableText.css"],function(Backbone,$,_,chooseTagTemplate){"use strict";var DEFAULT_ERROR_MESSAGE="An error occurred, please try again or contact support.";var NEW_TAG_MESSAGE="Press <strong>enter</strong> to create tag <strong>";function getTags(view,filter){return view.tagCollection.chain().sortBy(function(tag){return tag.get("name").toLowerCase()}).map(function(tag){var tagName=tag.get("name");return{id:tag.id,name:tagName,checked:_(view.selectedTags).any(function(name){return(name||"").toLowerCase()===(tagName||"").toLowerCase()}),hidden:tagName.toLowerCase().indexOf(filter.toLowerCase())!==0,lowerCaseName:tagName.toLowerCase()}}).value()}function handleEnterEvent(view,value){view.$el.showMessage("Please wait...");view.tagCollection.create({name:value},{success:function success(model){var tagName=model.get("name");view.addTag(tagName);view.$el.hideMessage();view.render()},error:function error(model){view.tagCollection.remove(model);showNotifyNotification(DEFAULT_ERROR_MESSAGE,"notification-error");view.$el.hideMessage();view.render()}})}function showNotifyNotification(text,type){return $.notify({text:text,className:type})}function toggleTagVisibilty(view,value){view.$("ul li").each(function(i,el){var $li=$(el);$li.toggleClass("hidden",$li.data("name").toString().indexOf(value.toLowerCase())!==0)})}var ChooseTagView=Backbone.View.extend({events:{"keypress input[name=filter]":"onKeyPressFilter","keyup input[name=filter]":"onKeyupFilter","change input[name=filter]":"onKeyupFilter"},constructor:function ChooseTagView(options){Backbone.View.apply(this,arguments);if(!options){throw new TypeError("ChooseTagView must be instantiated with an options argument")}if(!options.tagCollection){throw new TypeError("ChooseTagView must be instantiated with a tagCollection option")}this.tagCollection=options.tagCollection;this.selectedTags=options.selectedTags||[]},getTagName:function getTagName(tagId){return this.tagCollection.get(parseInt(tagId,10)).get("name")},onKeyupFilter:function onKeyupFilter(event){var $input=$(event.target);var value=$input.val().trim();if(!value||this.tagCollection.getByName(value)){this.$(".createTagMessage").addClass("hidden")}else{this.$(".createTagMessage").html(NEW_TAG_MESSAGE+_.escape(value)).removeClass("hidden");if(event.which===13){$input.val("");return handleEnterEvent(this,value)}}toggleTagVisibilty(this,value)},onKeyPressFilter:function onKeyPressFilter(event){if(event.which===13){event.preventDefault()}},render:function render(){var allowMultipleSelections=this.allowMultipleSelections;var filter=this.$("input[name=filter]").val()||"";this.$el.html(chooseTagTemplate({allowMultipleSelections:allowMultipleSelections,filter:filter,formid:_.uniqueId("chooseTag-"),tags:getTags(this,filter)}));this.$("input[name=filter]").clearableTextField();this.trigger("selected",this.selectedTags)}});return ChooseTagView});define("src/views/ChooseMultiTagView",["jquery","underscore","src/views/ChooseTagView"],function($,_,ChooseTagView){"use strict";var ChooseMultiTagView=ChooseTagView.extend({events:function events(){return _.defaults({"change input:checkbox[name=tag]":"onChangeTag"},ChooseTagView.prototype.events)},constructor:function ChooseMultiTagView(){ChooseTagView.apply(this,arguments);this.allowMultipleSelections=true},addTag:function addTag(tagName){this.selectedTags.push(tagName)},removeTag:function removeTag(tagName){this.selectedTags.splice(this.selectedTags.indexOf(tagName),1)},onChangeTag:function onChangeTag(event){var $element=$(event.target);var tagId=$element.val();var tagName=this.getTagName(tagId);$element.prop("checked")?this.addTag(tagName):this.removeTag(tagName);this.render()}});return ChooseMultiTagView});define("mustache!templates/chooseCategory",["lib/mustache"],function(mustache){var escapedTemplate='<p>\n<label class="db tinypadding-bottom" for="maincat-{{formid}}">Main Category</label>\n<select id="maincat-{{formid}}" class="selectfield">\n<option value>-- Choose a Category --</option>\n{{#categories}}\n<option value="{{id}}"{{#selected}} selected{{/selected}}>{{name}}</option>\n{{/categories}}\n</select>\n{{#canEditCategories}}\n{{^emptyForm}}<a class="icon-pencil lightgrey smallpadding-left js-edit-category customtip" title="Edit this Category"></a>{{/emptyForm}}\n<a class="icon-plus lightgrey smallpadding-left js-add-category customtip" title="Create a new main Category"></a>\n{{/canEditCategories}}\n</p>\n{{#showSubCategories}}\n<p class="selectSubcat singlepadding-top tinypadding-bottom">Select which Subcategory should be applied</p>\n<section class="bwscrollbar-narrow smallpadding-top">\n<div class="errorPane notification-error rounded smallpadding-vertical singlepadding-horizontal smallmargin-bottom hidden"></div>\n{{#singleCategoryForm}}\n<ul>\n{{#subCategories}}\n<li class="tinypadding-vertical smallpadding-left">\n<input id="ss-{{formid}}" type="checkbox" value="{{id}}" name="category" checked disabled /><label for="ss-{{formid}}">{{name}}</label>\n</li>\n{{/subCategories}}\n<li class="singlepadding-top smallpadding-left">\n<a class="js-add-subcategory"><span class="icon-plus iconsmall smallpadding-right"></span>New Subcategory</a>\n</li>\n</ul>\n{{/singleCategoryForm}}\n{{#singleSelectForm}}\n<ul>\n<li class="nochange smallpadding-left">\n<input id="ss-{{formid}}" type="radio" value="" name="category" checked class="nochange" /><label for="ss-{{formid}}">No change</label>\n</li>\n<li class="separator singlepadding-bottom rowborder singlemargin-bottom"></li>\n{{#subCategories}}\n<li class="tinypadding-vertical smallpadding-left">\n<input id="ss-{{formid}}-{{id}}" type="radio" value="{{id}}" name="category"{{#checked}} checked{{/checked}} />\n<label for="ss-{{formid}}-{{id}}"{{#checked}} class="adding"{{/checked}}><span class="name">{{name}}</span> <span class="status">{{#checked}}(adding this){{/checked}}</span></label>\n</li>\n{{/subCategories}}\n<li class="singlepadding-top smallpadding-left">\n<a class="js-add-subcategory"><span class="icon-plus iconsmall smallpadding-right"></span>New Subcategory</a>\n</li>\n</ul>\n{{/singleSelectForm}}\n{{#multipleSelectForm}}\n<ul>\n{{#subCategories}}\n<li class="tinypadding-vertical smallpadding-left" data-name="{{name}}">\n<input id="ss-{{formid}}-{{id}}" type="checkbox" value="{{id}}" name="category"{{#checked}} checked{{/checked}} />\n<label for="ss-{{formid}}-{{id}}"{{#checked}} class="adding"{{/checked}}><span class="name">{{name}}</span> <span class="status">{{#checked}}(adding this){{/checked}}</span></label>\n</li>\n{{/subCategories}}\n<li class="singlepadding-top smallpadding-left">\n<a class="js-add-subcategory"><span class="icon-plus iconsmall smallpadding-right"></span>New Subcategory</a>\n</li>\n</ul>\n{{/multipleSelectForm}}\n</section>\n{{/showSubCategories}}\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/views/ChooseCategoryView",["backbone","underscore","jquery","src/views/CategoriesFormView","mustache!templates/chooseCategory","lib/jquery.prompt","src/packages/customtip","src/packages/waitmask"],function(Backbone,_,$,CategoriesFormView,chooseCategoryTemplate){"use strict";function getParentCategory(categories,selected){var category=categories.find(function(cat){return _(cat.get("children")).any(function(child){return selected.indexOf(child.id)>-1})});if(!category){return}return category.id}var ChooseCategoryView=Backbone.View.extend({events:{"change select":"onCategoryChanged","click .js-edit-category":"onClickEditCategory","change input[type=radio]":"onSubcategoryChecked","change input[type=checkbox]":"onSubcategoryChecked","click .js-add-category":"onAddCategory","click .js-add-subcategory":"onAddSubcategory"},constructor:function ChooseCategoryView(options){Backbone.View.apply(this,arguments);if(!options||!options.collection){throw new TypeError("ChooseCategoryView must be initialized with a collection option")}if(typeof options.canEditCategories!=="boolean"){throw new TypeError("ChooseCategoryView must be initialized with a canEditCategories option as a boolean")}this.selected=options&&options.selected||[];this.selectedParent=getParentCategory(this.collection,this.selected);this.canEditCategories=options.canEditCategories;this.listenTo(this.collection,"change",this.render)},render:function render(){var view=this,selected=view.selected||[],parentId=view.selectedParent,catValues=[].concat(selected),selectedCategory=view.collection.get(parentId);view.$el.html(chooseCategoryTemplate({categories:view.collection.chain().sortBy(function(cat){return cat.get("name").toLowerCase()}).map(function(cat){return{id:cat.id,name:cat.get("name"),selected:cat.id===parentId}}).value(),subCategories:selectedCategory&&_(selectedCategory.get("children")||[]).chain().sortBy(function(cat){return cat.name}).map(function(cat){return{id:cat.id,name:cat.name,checked:catValues.indexOf(cat.id)>-1}}).value(),formid:_.uniqueId("chooseCategory"),canEditCategories:view.canEditCategories,emptyForm:!selectedCategory,singleCategoryForm:selectedCategory&&selectedCategory.get("children").length===1,singleSelectForm:selectedCategory&&selectedCategory.get("children").length!==1&&!selectedCategory.get("multiple"),multipleSelectForm:selectedCategory&&selectedCategory.get("children").length!==1&&selectedCategory.get("multiple"),showSubCategories:!!selectedCategory}));view.$el.customtip()},onCategoryChanged:function onCategoryChanged(e){var categoryId=parseInt($(e.target).val(),10),selectedCategory=this.collection.get(categoryId);this.selected=undefined;this.changeCategory(selectedCategory)},changeCategory:function changeCategory(selectedCategory){if(selectedCategory){this.selectedParent=selectedCategory.id;if(selectedCategory.get("children").length===1){this.selected=[selectedCategory.get("children")[0].id]}}this.trigger("selected",this.selected);this.render()},onClickEditCategory:function onClickEditCategory(){var selectedCategory=this.collection.get(this.selectedParent);if(!selectedCategory){return}CategoriesFormView.show({model:selectedCategory,collection:this.collection})},onSubcategoryChecked:function onSubcategoryChecked(){var allChecked=this.$("section input:checked").map(function(i,el){return parseInt($(el).val(),10)}).get(),categoryId=parseInt(this.$("select").val(),10),selectedCategory=this.collection.get(categoryId);this.selectedParent=selectedCategory.id;this.$("label").removeClass("adding").find(".status").text("");this.$("input:checked").next("label").addClass("adding").find(".status").text("(adding this)");this.selected=_.compact(allChecked);if(!this.selected||this.selected.length===0){this.selected=undefined}this.trigger("selected",this.selected)},onAddCategory:function onAddCategory(){this.collection.off("add",this.onCategoryAdded,this);this.collection.once("add",this.onCategoryAdded,this);CategoriesFormView.show({collection:this.collection})},onCategoryAdded:function onCategoryAdded(model){this.changeCategory(model)},onAddSubcategory:function onAddSubcategory(){var self=this,categoryModel=this.collection.get(this.selectedParent),$container=this.$(".action.categories section"),isUniqueName;$.prompt({text:"New Subcategory",intro:'Enter new Subcategory name for the Category "'+categoryModel.escape("name")+'"'},function(err,name){if(err){return}isUniqueName=!_(categoryModel.get("children")).some(function(m){return m.name===name});if(!isUniqueName){self.showError('Subcategory "'+name+'" already exists');return}self.hideError();$container.showWaitmask("Saving new Subcategory...");categoryModel.save({children:_(categoryModel.get("children")).sortBy("ordering").concat({name:name})},{success:function success(model){$container.hideWaitmask();self.onSubcategoryAdded(model)},error:function error(){$container.hideWaitmask();self.showError("Couldn't save new Subcategory. Please try again.")}})})},onSubcategoryAdded:function onSubcategoryAdded(model){var newSubcategoryId=_(model.get("children")).max(function(c){return c.ordering}).id;if(_.isArray(this.selected)){this.selected.push(newSubcategoryId)}else{this.selected=[newSubcategoryId]}this.changeCategory(model)},showError:function showError(message){this.$(".errorPane").text(message).removeClass("hidden")},hideError:function hideError(){this.$(".errorPane").text("").addClass("hidden")},remove:function remove(){this.collection.off("add",this.onCategoryAdded,this);Backbone.View.prototype.remove.call(this)}});return ChooseCategoryView});define("mustache!templates/chooseAssignee",["lib/mustache"],function(mustache){var escapedTemplate='<section>\n<ul>\n<li class="nochange smallpadding-left">\n<input id="{{id}}-nochange" type="radio" name="assignee" value {{#nochange}}checked{{/nochange}} />\n<label for="{{id}}-nochange"><span class="name">No change</span></label>\n</li>\n<li class="separator singlepadding-bottom rowborder singlemargin-bottom"></li>\n{{#assignees}}\n<li class="tinypadding-vertical smallpadding-left">\n<input id="{{id}}-{{name}}" type="radio" name="assignee" value="{{id}}" {{#checked}}checked{{/checked}} />\n<label for="{{id}}-{{name}}"><span class="name">{{name}}</span> <span class="status"></span></label>\n</li>\n{{/assignees}}\n</section>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/views/ChooseAssigneeView",["backbone","underscore","jquery","src/globals/workflow","mustache!templates/chooseAssignee"],function(Backbone,_,$,workflow,chooseAssigneeTemplate){"use strict";return Backbone.View.extend({events:{"change input":"onChangeAssignee"},initialize:function initialize(options){this.selected=options&&options.selected},render:function render(){var selected=this.selected;this.$el.html(chooseAssigneeTemplate({id:_.uniqueId("assignee"),assignees:_((workflow.get("assignment")||{}).children||[]).map(function(assignee){return{id:assignee.id,name:assignee.name,checked:assignee.name===selected}}),nochange:!selected}))},onChangeAssignee:function onChangeAssignee(e){var $input=$(e.target),assigneeId=parseInt($input.val(),10),assignee=_((workflow.get("assignment")||{}).children).find(function(assignee){return assignee.id===assigneeId});$input.closest("li").addClass("adding").siblings().removeClass("adding").find(".status").text("");if(assignee){this.selected=assignee.name;this.$("li label .status").text("");$input.next("label").find(".status").text("(adding this)")}else{this.$("li").removeClass("adding");this.selected=undefined}this.trigger("selected",this.selected)}})});define("mustache!templates/choosePriority",["lib/mustache"],function(mustache){var escapedTemplate='<section>\n<ul>\n<li class="nochange smallpadding-left">\n<input id="priority-nochange" type="radio" name="priority" value {{#nochange}}checked{{/nochange}} />\n<label for="priority-nochange"><span class="name">No change</span></label>\n</li>\n<li class="separator singlepadding-bottom rowborder singlemargin-bottom"></li>\n{{#priorities}}\n<li class="tinypadding-vertical smallpadding-left">\n<input id="{{id}}-{{name}}" type="radio" name="priority" value="{{id}}" {{#checked}}checked{{/checked}} />\n<label for="{{id}}-{{name}}"><span class="name">{{name}}</span> <span class="status"></span></label>\n</li>\n{{/priorities}}\n</ul>\n</section>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/views/ChoosePriorityView",["backbone","underscore","jquery","src/globals/workflow","mustache!templates/choosePriority"],function(Backbone,_,$,workflow,choosePriorityTemplate){"use strict";return Backbone.View.extend({events:{"change input":"onChangePriority"},initialize:function initialize(options){this.selected=options&&options.selected},render:function render(){var selected=this.selected;this.$el.html(choosePriorityTemplate({priorities:_((workflow.get("priority")||{}).children||[]).chain().map(function(priority){return{id:priority.id,name:_.capitalize(priority.name),checked:priority.name===selected,order:priority.order}}).sortBy(function(priority){return priority.order}).value(),nochange:!selected}))},onChangePriority:function onChangePriority(e){var $input=$(e.target),priorityId=parseInt($input.val(),10),priority=_((workflow.get("priority")||{}).children).find(function(priority){return priority.id===priorityId});$input.closest("li").addClass("adding").siblings().removeClass("adding").find(".status").text("");if(priority){this.selected=priority.name;this.$("li label .status").text("");$input.next("label").find(".status").text("(adding this)")}else{this.$("li").removeClass("adding");this.selected=undefined}this.trigger("selected",this.selected)}})});define("mustache!templates/chooseStatus",["lib/mustache"],function(mustache){var escapedTemplate='<section>\n<ul>\n<li class="nochange smallpadding-left">\n<input id="status-nochange" type="radio" name="status" value {{#nochange}}checked{{/nochange}} />\n<label for="status-nochange"><span class="name">No change</span></label>\n</li>\n<li class="separator singlepadding-bottom rowborder singlemargin-bottom"></li>\n{{#statuses}}\n<li class="tinypadding-vertical smallpadding-left">\n<input id="{{id}}-{{name}}" type="radio" name="status" value="{{id}}" {{#checked}}checked{{/checked}} />\n<label for="{{id}}-{{name}}"><span class="name">{{name}}</span> <span class="status"></span></label>\n</li>\n{{/statuses}}\n</ul>\n</section>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/views/ChooseStatusView",["backbone","underscore","jquery","src/globals/workflow","mustache!templates/chooseStatus"],function(Backbone,_,$,workflow,chooseStatusTemplate){"use strict";return Backbone.View.extend({events:{"change input":"onChangeStatus"},initialize:function initialize(options){this.selected=options&&options.selected},render:function render(){var selected=this.selected;this.$el.html(chooseStatusTemplate({statuses:_((workflow.get("status")||{}).children||[]).map(function(status){return{id:status.id,name:_.capitalize(status.name),checked:status.name===selected}}),nochange:!selected}))},onChangeStatus:function onChangeStatus(e){var $input=$(e.target),statusId=parseInt($input.val(),10),status=_((workflow.get("status")||{}).children).find(function(status){return status.id===statusId});$input.closest("li").addClass("adding").siblings().removeClass("adding").find(".status").text("");if(status){this.selected=status.name;this.$("li label .status").text("");$input.next("label").find(".status").text("(adding this)")}else{this.$("li").removeClass("adding");this.selected=undefined}this.trigger("selected",this.selected)}})});define("mustache!templates/ruleActionView",["lib/mustache"],function(mustache){var escapedTemplate='<h1 class="popuptitletext tencolmax textellipsis draggable">\n{{#isNew}}Create Rule{{/isNew}}{{^isNew}}Edit Rule "{{name}}"{{/isNew}} - Action\n</h1>\n<form class="singlemargin-top rowborder-top singlepadding-top">\x3c!--for IE9 (BM-502) --\x3e\n<p>What should happen with mentions for this search?</p>\n<p class="actions singlepadding-vertical"><a class="chooseAction" data-at="rule-editor-choose-action">Choose an action</a></p>\n<ul class="context-menu popupframe hidden">\n<li class="context-menu--item iconindent sentiment"><a>Change Sentiment</a></li>\n<li class="context-menu--item iconindent location"><a>Change Location</a></li>\n{{#enableEmotions}}\n<li class="context-menu--item separator"></li>\n<li class="context-menu--item iconindent add-emotion"><a>Add Emotions</a></li>\n<li class="context-menu--item iconindent remove-emotion"><a>Remove Emotions</a></li>\n{{/enableEmotions}}\n<li class="context-menu--item separator"></li>\n<li class="context-menu--item iconindent tag"><a><span class="icon-tag singlepadding-left smallpadding-right"></span>Add Tags</a></li>\n<li class="context-menu--item iconindent category"><a>Add a Category</a></li>\n<li class="context-menu--item separator"></li>\n<li class="context-menu--item iconindent star"><a><span class="icon-star singlepadding-left smallpadding-right"></span>Add Star</a></li>\n<li class="context-menu--item separator"></li>\n<li class="context-menu--item iconindent assign"><a>Add Assignment</a></li>\n<li class="context-menu--item iconindent priority"><a>Add Priority</a></li>\n<li class="context-menu--item iconindent status"><a>Add Status</a></li>\n<li class="context-menu--item iconindent checked" data-at="rule-editor-add-checked-action"><a>Add "Checked" Status</a></li>\n</ul>\n<div class="action">\n</div>\n</form>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!css/ruleActionView.css",["css!css/compiled.css"],function(){});function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};var ownKeys=Object.keys(source);if(typeof Object.getOwnPropertySymbols==="function"){ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))}ownKeys.forEach(function(key){_defineProperty(target,key,source[key])})}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}define("src/views/RuleActionView",["underscore","jquery","src/permissions","src/globals/categories","src/globals/tags","src/globals/flags","src/globals/flagNames","src/views/RuleStepView","src/views/ChooseSentimentView","src/views/ChooseEmotionView","src/views/ChooseLocationView","src/views/ChooseMultiTagView","src/views/ChooseCategoryView","src/views/ChooseAssigneeView","src/views/ChoosePriorityView","src/views/ChooseStatusView","mustache!templates/ruleActionView","css!css/ruleActionView.css"],function(_,$,permissions,categories,globalTags,flags,FLAGS,RuleStepView,ChooseSentimentView,ChooseEmotionView,ChooseLocationView,ChooseMultiTagView,ChooseCategoryView,ChooseAssigneeView,ChoosePriorityView,ChooseStatusView,ruleActionView){"use strict";var actionMap={starred:"star",assignment:"assign",addTag:"tag",addCategories:"category",addClassifications:"add-emotion",removeClassifications:"remove-emotion"};function toggleActionMenu(view){var contextMenu=view.$(".context-menu");contextMenu.toggleClass("hidden");if(!contextMenu.hasClass("hidden")){$("body").one("click.ruleActionContextMenu",view.onHideContextMenu)}}function resetPreviousSelection(view){var ruleAction=view.model.get("ruleAction"),actionType=view.actionType,$actionElement=view.$(".action>:visible");if(ruleAction&&actionType){delete ruleAction[actionType];$actionElement.find("input:checked").prop("checked",false).trigger("change");$actionElement.find(".nochange input").prop("checked",true).trigger("change")}view.$("ul.context-menu").addClass("hidden")}function showActionView(view,action){var actionClass="action bwscrollbar-narrow ".concat(view.actionType);view.$("div.action").attr("class",actionClass).empty().append(action.view);view.$("a.chooseAction").text("Action: ".concat(action.title))}function showSentimentAction(view){var model=view.model;view.actionType="sentiment";view.sentimentView=view.sentimentView||new ChooseSentimentView({selected:(model.get("ruleAction")||{}).sentiment});showActionView(view,{view:view.sentimentView.$el,title:"Change Sentiment"});view.sentimentView.off("selected");view.sentimentView.on("selected",function(sentiment){model.set({ruleAction:{sentiment:sentiment}})},view);view.sentimentView.render()}function showEmotionAction(view,mode){var model=view.model;var viewName="".concat(mode,"EmotionView");view.actionType="emotion";view[viewName]=view[viewName]||new ChooseEmotionView({addClassifications:(model.get("ruleAction")||{}).addClassifications,removeClassifications:(model.get("ruleAction")||{}).removeClassifications,showHeadline:false,mode:mode});showActionView(view,{view:view[viewName].$el,title:"".concat(_.capitalize(mode)," Emotions")});view.$("a.chooseAction").text("Action: ".concat(_.capitalize(mode)," Emotions"));view[viewName].off("selected");view[viewName].on("selected",function(emotions){model.set({ruleAction:_objectSpread({},emotions)})});view[viewName].render()}function showLocationAction(view){var model=view.model;view.actionType="location";view.locationView=view.locationView||new ChooseLocationView({location:(model.get("ruleAction")||{}).location});showActionView(view,{view:view.locationView.$el,title:"Change Location"});view.locationView.off("selected");view.locationView.on("selected",function(location){model.set({ruleAction:{location:location.id,locationName:location.name}})},view);view.locationView.render()}function showTagAction(view){var model=view.model;view.actionType="tag";view.tagView=view.tagView||new ChooseMultiTagView({selectedTags:(model.get("ruleAction")||{}).addTag,tagCollection:globalTags});showActionView(view,{view:view.tagView.$el,title:"Add Tags"});view.tagView.off("selected");view.tagView.on("selected",function(tags){model.set({ruleAction:{addTag:[].concat(tags)}})},view);view.tagView.render()}function showCategoryAction(view){view.actionType="category";view.categoryView=view.categoryView||new ChooseCategoryView(view.getCategoryViewOptions());showActionView(view,{view:view.categoryView.$el,title:"Add Category"});view.categoryView.off("selected");view.categoryView.on("selected",function(category){view.model.set({ruleAction:{addCategories:category}})},view);view.categoryView.render()}function showStarAction(view){view.actionType="star";showActionView(view,{view:'<p class="smallpadding-left">This will <Strong>Star</strong> any mentions that match this search',title:"Add Star"});view.model.set({ruleAction:{starred:true}})}function showAssignAction(view){var model=view.model;view.actionType="assign";view.assigneeView=view.assigneeView||new ChooseAssigneeView({selected:(model.get("ruleAction")||{}).assignment});showActionView(view,{view:view.assigneeView.$el,title:"Add Assignment"});view.assigneeView.off("selected");view.assigneeView.on("selected",function(assignee){model.set({ruleAction:{assignment:assignee}})},view);view.assigneeView.render()}function showPriorityAction(view){var model=view.model;view.actionType="priority";view.priorityView=view.priorityView||new ChoosePriorityView({selected:(model.get("ruleAction")||{}).priority});showActionView(view,{view:view.priorityView.$el,title:"Add Priority"});view.priorityView.off("selected");view.priorityView.on("selected",function(priority){model.set({ruleAction:{priority:priority}})},view);view.priorityView.render()}function showStatusAction(view){var model=view.model;view.actionType="status";view.statusView=view.statusView||new ChooseStatusView({selected:(model.get("ruleAction")||{}).status});showActionView(view,{view:view.statusView.$el,title:"Add Status"});view.statusView.off("selected");view.statusView.on("selected",function(status){model.set({ruleAction:{status:status}})},view);view.statusView.render()}function showCheckedAction(view){view.actionType="checked";showActionView(view,{view:'<p class="smallpadding-left">This will set the <strong>checked</strong> '+"status on mentions that match this search</p>",title:'Add "Checked" Status'});view.model.set({ruleAction:{checked:true}})}return RuleStepView.extend({className:RuleStepView.prototype.className+" ruleActionView modular",events:function events(){return{"submit form":function onFormSubmit(e){e.preventDefault()},"click p.actions a.chooseAction":function onChooseAction(){toggleActionMenu(this)},"click ul.context-menu li":function onClickAction(){resetPreviousSelection(this)},"click ul.context-menu li.sentiment":function onClickSentimentAction(){showSentimentAction(this)},"click ul.context-menu li.add-emotion":function onClickSentimentAction(){showEmotionAction(this,"add")},"click ul.context-menu li.remove-emotion":function onClickSentimentAction(){showEmotionAction(this,"remove")},"click ul.context-menu li.location":function onClickLocationAction(){showLocationAction(this)},"click ul.context-menu li.tag":function onClickTagAction(){showTagAction(this)},"click ul.context-menu li.category":function onClickCategoryAction(){showCategoryAction(this)},"click ul.context-menu li.star":function onClickStarAction(){showStarAction(this)},"click ul.context-menu li.assign":function onClickAssignAction(){showAssignAction(this)},"click ul.context-menu li.priority":function onClickPriorityAction(){showPriorityAction(this)},"click ul.context-menu li.status":function onClickStatusAction(){showStatusAction(this)},"click ul.context-menu li.checked":function onClickCheckedAction(){showCheckedAction(this)}}},constructor:function RuleActionView(){RuleStepView.apply(this,arguments);_(this).bindAll("onHideContextMenu")},getRuleActionType:function getRuleActionType(ruleAction){var key=Object.keys(ruleAction).filter(function(key){return ruleAction[key]})[0];if(!key){return}return actionMap[key]||key},render:function render(){var model=this.model;var isNew=model.isNew();this.$el.html(ruleActionView({isNew:isNew,enableEmotions:flags.variation(FLAGS.ENABLE_EMOTIONS_MARKUP),name:model.get("name")||""}))},setRuleAction:function setRuleAction(){var model=this.model;var ruleAction=model.get("ruleAction")||{};var type=this.getRuleActionType(ruleAction);if(!type){return this.$(".action").addClass("hidden")}this.$("ul.context-menu li."+type+" a").click()},cleanupViews:function cleanupViews(){var _this=this;["sentimentView","addEmotionView","removeEmotionView","locationView","tagView","categoryView","assigneeView","priorityView","statusView"].forEach(function(viewKey){if(_this[viewKey]){_this[viewKey].off();_this[viewKey].remove();_this[viewKey]=null}})},remove:function remove(){this.cleanupViews();$("body").off("click.ruleActionContextMenu");RuleStepView.prototype.remove.call(this)},onHideContextMenu:function onHideContextMenu(e){var contextMenu=this.$(".context-menu");if($(e.target).is("a.chooseAction")){$("body").one("click.ruleActionContextMenu",this.onHideContextMenu);return}contextMenu.addClass("hidden")},getCategoryViewOptions:function getCategoryViewOptions(){return{selected:(this.model.get("ruleAction")||{}).addCategories,collection:categories,canEditCategories:permissions.check("edit.categories")}},getValues:function getValues(callback){var ruleAction=this.model.get("ruleAction")||{},ruleActions=_(ruleAction).filter(function(val){return _.isArray(val)?val.length:!!val});if(!ruleActions.length){return callback("Please choose an action for this Rule")}callback(null,{ruleAction:ruleAction})}})});define("src/helpers/categoriesHelper",[],function(){"use strict";function findParentCategory(categories,selected){var category=categories.find(function(cat){return cat.get("children").some(function(child){return selected.indexOf(child.id)>-1})});return category}return{findParentCategory:findParentCategory}});define("mustache!templates/ruleScopeView",["lib/mustache"],function(mustache){var escapedTemplate='<h1 class="popuptitletext tencolmax textellipsis draggable">\n{{#isNew}}Create Rule{{/isNew}}{{^isNew}}Edit Rule "{{name}}"{{/isNew}} - Name and Scope\n</h1>\n<div class="scope singlemargin-top singlepadding-top">\n<div class="ruleName doublemargin-bottom">\n<label class="dib smallpadding-bottom" for="nameRule">Name your Rule</label>\n<input class="db field fourcol" data-at="rule-editor-name-input" type="text" id="nameRule" name="name" value="{{name}}" />\n</div>\n<label class="db singlepadding-bottom">Please select which mentions should be affected by this Rule</label>\n<ul class="singlepadding-left singlepadding-bottom">\n<li class="singlepadding-bottom hugeline">\n<p>\n<input id="backfill-false" data-at="rule-editor-backfill-false-radio" type="radio" name="backfill" value="false" {{^backfill}} checked {{/backfill}}>\n<label class="smallpadding-left" for="backfill-false"><span class="name">Apply Rule to <b>future</b> mentions <b>only</b></span></label>\n</p>\n<div class="smallpadding-vertical singlepadding-horizontal fivecol infoboxbgcolor mediumtext-bigline doublemargin-left">\n<p>This Rule will apply to mentions that will be found from now on.</p>\n</div>\n</li>\n<li class="singlepadding-bottom hugeline clearfix">\n<p>\n<input id="backfill-true" type="radio" name="backfill" value="true" {{#backfill}} checked {{/backfill}}>\n<label class="smallpadding-left" for="backfill-true"><span class="name">Apply Rule to <b>future and past</b> mentions</span></label>\n</p>\n<div class="smallpadding-vertical singlepadding-horizontal floatleft fivecol infoboxbgcolor mediumtext-bigline doublemargin-left">\n<p>\nThis Rule will apply to future and historical mentions back to {{backfillEarliest}}.\nFor large data volumes this may take several minutes. We\'ll email you when it\'s ready.\n</p>\n<p class="singlemargin-top">\nPlease reach out to your Account Contact to access historical data prior to {{backfillEarliest}}.\n</p>\n</div>\n<div class="changesMarkupWarning smallpadding-vertical singlepadding-horizontal floatleft hidden fivecol notification notification-warning mediumline rounded doublemargin-left">\nThis Rule may change existing markup when applied to past mentions.\n<a class="help icon-bwhelp" data-key="rules-action-backdate-note"></a>\n</div>\n</li>\n</ul>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/views/RuleScopeView",["underscore","src/globals/categories","src/views/RuleStepView","src/helpers/categoriesHelper","src/helpers/rulesHelper","mustache!templates/ruleScopeView"],function(_,categories,RuleStepView,categoriesHelper,rulesHelper,template){"use strict";var markupChangingRuleTypes=["sentiment","starred","assignment","priority","status","checked"];function isMarkupChangingRule(ruleAction){var ruleTypes=_(ruleAction).keys(),hasAlwaysChangingType=_(ruleTypes).any(function(type){return markupChangingRuleTypes.indexOf(type)>-1}),hasCategory=ruleTypes.indexOf("category")>-1,parentCategory;if(hasAlwaysChangingType){return true}if(!hasCategory){return false}parentCategory=categoriesHelper.findParentCategory(categories,ruleAction.category);if(parentCategory.get("multiple")){return false}return true}return RuleStepView.extend({className:RuleStepView.prototype.className+" ruleScopeView",events:{"change input[name=backfill]":function onChangeBackfill(){this.toggleBackfillWarning()}},constructor:function RuleScopeView(){RuleStepView.apply(this,arguments)},render:function render(){var model=this.model;var isNew=model.isNew();this.$el.html(template({isNew:isNew,name:model.get("name")||"",backfill:isNew,backfillEarliest:rulesHelper.getBulkActionEarliest("D MMM YYYY")}))},toggleBackfillWarning:function toggleBackfillWarning(){var doBackfill=this.$('input[name="backfill"]:checked').val()==="true",isChangingMarkup=isMarkupChangingRule(this.model.get("ruleAction"));this.$(".changesMarkupWarning").toggleClass("hidden",!(doBackfill&&isChangingMarkup))},getValues:function getValues(callback){var ruleName=this.$("input[name=name]").val().trim(),needsBackfill=this.$('input[name="backfill"]:checked').val()==="true";if(!ruleName){return callback("Please enter a name for this Rule")}callback(null,{name:ruleName},{needsBackfill:needsBackfill})},shown:function shown(){this.render();this.toggleBackfillWarning()}})});define("src/helpers/stringHelper",[],function(){"use strict";return{pluralize:function pluralize(count,singular,plural){return count===1?singular:plural}}});define("mustache!templates/ruleConfirmationView",["lib/mustache"],function(mustache){var escapedTemplate='<h1 class="popuptitletext tencolmax textellipsis draggable">\nConfirm {{^isNew}}Changes to {{/isNew}}Rule Setup\n</h1>\n<div class="summary singlemargin-top">\n<div class="summary-row name singlepadding-vertical">\n<label class="bold">Name</label>\n<p class="value">{{name}}</p>\n</div>\n<div class="summary-row data-source singlepadding-vertical">\n<label class="bold">Data Source</label>\n{{#projectScope}}\n<p class="value">The Rule will apply to all Queries in the Project "{{project}}"</p>\n{{/projectScope}}\n{{^projectScope}}\n<p class="value">{{queries}}</p>\n{{/projectScope}}\n</div>\n{{#term}}\n<div class="summary-row search-string singlepadding-vertical">\n<label class="bold">Search String</label>\n<p class="value">{{term}}</p>\n</div>\n{{/term}}\n{{#filtersCount}}\n<div class="summary-row filters singlepadding-vertical">\n<label class="bold">Filters</label>\n<p class="value">{{filtersCount}} {{filterLabel}} applied</p>\n</div>\n{{/filtersCount}}\n<div class="summary-row action singlepadding-vertical">\n<label class="bold">Action</label>\n<p class="value">{{{action}}}</p>\n</div>\n<div class="summary-row scope singlepadding-vertical">\n<label class="bold">Scope</label>\n{{^backfill}}\n<p class="value">The Rule will apply to all <b>future</b> mentions</p>\n{{/backfill}}\n{{#backfill}}\n<p class="value">The Rule will apply to all <b>future and past</b> mentions (back to {{backfillEarliest}})</p>\n{{/backfill}}\n</div>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/views/RuleConfirmationView",["underscore","src/globals/categories","src/helpers/categoriesHelper","src/globals/queries","src/globals/currentProject","src/views/RuleStepView","src/helpers/rulesHelper","src/helpers/stringHelper","mustache!templates/ruleConfirmationView"],function(_,categories,categoriesHelper,queries,currentProject,RuleStepView,rulesHelper,stringHelper,template){"use strict";var ignoredFilterKeys=["search","queryId","lastUpdated","applyToProject","testSearchQueryId"];function getTagActionSummary(tagNames){var tags=[].concat(tagNames);if(tags.length>1){return"Add Tags: "+tags.join(", ")}if(tags.length){return"Add Tag: "+tags[0]}return"Add Tag: <unknown>"}function getCategoryActionSummary(categoryIds){var parentCategory;categoryIds=[].concat(categoryIds);parentCategory=categoriesHelper.findParentCategory(categories,categoryIds);if(!parentCategory){return"Unknown category"}return"Add "+(categoryIds.length>1?"Categories":"Category")+": "+_(parentCategory.get("children")).chain().filter(function(child){return categoryIds.indexOf(child.id)>-1}).pluck("name").value().join(", ")}function getEmotionLabel(classification){var emotionPrefix="emotions:";return _.capitalize(classification.substring(emotionPrefix.length))}function getClassificationsSummary(_ref){var removeClassifications=_ref.removeClassifications,addClassifications=_ref.addClassifications;var message="";if(addClassifications){var title="Add ".concat(stringHelper.pluralize(addClassifications.length,"Emotion","Emotions"));var labels=addClassifications.map(getEmotionLabel);message+="".concat(title,": ").concat(labels.join(", "))}if(addClassifications&&removeClassifications){message+="<br>"}if(removeClassifications){var _title="Remove ".concat(stringHelper.pluralize(removeClassifications.length,"Emotion","Emotions"));var _labels=removeClassifications.map(getEmotionLabel);message+="".concat(_title,": ").concat(_labels.join(", "))}return message}var RuleConfirmationView=RuleStepView.extend({className:RuleStepView.prototype.className+" ruleConfirmationView",constructor:function RuleConfirmationView(options){RuleStepView.apply(this,arguments);if(!options||!options.tagCollection){throw new TypeError("RuleConfirmationView must be instantiated with a tagCollection option")}if(!options.context){throw new TypeError("RuleConfirmationView requires a context object")}this.tagCollection=options.tagCollection;this.context=options.context},buildActionSummary:function buildActionSummary(ruleAction){if(ruleAction.sentiment){return"Set Sentiment to "+_.capitalize(ruleAction.sentiment)}if(ruleAction.removeClassifications||ruleAction.addClassifications){return getClassificationsSummary(ruleAction)}if(ruleAction.locationName){return"Set Location to "+ruleAction.locationName}if(ruleAction.addTag){return getTagActionSummary(ruleAction.addTag)}if(ruleAction.addCategories){return getCategoryActionSummary(ruleAction.addCategories)}if(ruleAction.assignment){return"Assign to "+ruleAction.assignment}if(ruleAction.priority){return"Set priority to "+ruleAction.priority}if(ruleAction.status){return"Set status to "+ruleAction.status}if(ruleAction.checked){return'Add "Checked" Status'}return"Add Star"},render:function render(){var model=this.model;var context=this.context;var settings=model.get("filter");var searchTerm=settings.search;var filters=_(settings).filter(function(value,key){if(ignoredFilterKeys.indexOf(key)>-1){return false}return _.isArray(value)?value.length:!!value});var filtersCount=_(filters).size();this.$el.html(template({isNew:model.isNew(),name:model.get("name"),projectScope:model.get("scope")==="project",project:currentProject.get("name"),queries:_([].concat(model.get("filter").queryId)).map(function(id){var query=queries.get(id);return query&&query.get("name")}).join(", "),action:this.buildActionSummary(model.get("ruleAction")),term:searchTerm,filtersCount:filtersCount,filterLabel:filtersCount===1?"filter":"filters",backfill:context.needsBackfill,backfillEarliest:rulesHelper.getBulkActionEarliest("D MMM YYYY")}))},shown:function shown(){this.render()}});return RuleConfirmationView});define("mustache!templates/ruleCreationView",["lib/mustache"],function(mustache){var escapedTemplate='<div class="content">\n</div>\n<footer class="doublemargin-top">\n<button class="button js-prev singlemargin-right floatleft hidden"><span class="grey icon-chevron-left"></span></button>\n<button class="defaultbutton js-next singlemargin-right floatleft" tabindex="1" data-at="rule-editor-next-button">Next <span class="tinypadding-left icon-chevron-right"></span></button>\n<button class="defaultbutton js-save singlemargin-right floatleft hidden" data-at="rule-editor-save-button">Save Rule</button>\n<div class="loading-small hidden singlemargin-right tinymargin-top singlepadding-top smallpadding-bottom floatleft singlepadding-left smallpadding-right"></div>\n<div class="error hidden mediumtext singlemargin-right floatleft tinypadding-top"></div>\n</footer>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!css/ruleCreationView.css",["css!css/compiled.css"],function(){});define("src/views/RuleCreationView",["underscore","backbone","src/ApiError","src/views/RuleSettingsView","src/views/RuleActionView","src/views/RuleScopeView","src/views/RuleConfirmationView","src/analytics/Analytics","src/events/rulesEvents","src/events/globalEventNames","bw-fe-helpers/ModelBackup","mustache!templates/ruleCreationView","css!css/ruleCreationView.css","src/packages/modalDialogs","src/packages/waitmask"],function(_,Backbone,ApiError,RuleSettingsView,RuleActionView,RuleScopeView,RuleConfirmationView,Analytics,rulesEvents,globalEventNames,ModelBackup,template){"use strict";function doBackfill(view,model,wasNew){model.backfill({success:function success(){view.onRuleSaved(wasNew)},error:function error(){view.$el.hideWaitmask();view.showError("Backdating could not be performed for your Rule. Please try again or contact support")}})}function triggerGlobalEvents(model,wasNew){if(wasNew){return rulesEvents.trigger(globalEventNames.RULES.RULE_ADDED,model.toJSON())}rulesEvents.trigger(globalEventNames.RULES.RULE_UPDATED,model.toJSON())}var RuleCreationView=Backbone.View.extend({events:function events(){var view=this;return{"click .js-prev":function onClickPrev(){view.prev()},"click .js-next":function onClickNext(){view.blockButtons();view.activeStep.getValues(function(err,values,context){values=_.clone(values);view.unblockButtons();if(err){view.showError(err);return}_.extend(view.context,context);view.model.set(values);view.next()})},"click .js-save":function onClickSave(){view.save()}}},constructor:function RuleCreationView(options){Backbone.View.apply(this,arguments);options=options||{};if(!options.model){throw new Error("RuleCreationView requires options.model to be set")}if(!options.tagCollection){throw new TypeError("RuleCreationView must be instantiated with a tagCollection option")}this.tagCollection=options.tagCollection;this.modelBackup=new ModelBackup(this.model);this.context={};this.steps=[new RuleSettingsView({model:this.model,context:this.context}),new RuleActionView({model:this.model,context:this.context}),new RuleScopeView({model:this.model,context:this.context}),new RuleConfirmationView({model:this.model,tagCollection:this.tagCollection,context:this.context})]},remove:function remove(){this.steps.forEach(function(step){step.remove()});if(this.modelBackup){this.modelBackup.restore()}Backbone.View.prototype.remove.call(this)},render:function render(){var $contentContainer;this.$el.html(template());this.$el.showWaitmask({text:"Loading...",opacity:1});$contentContainer=this.$(".content");this.steps.forEach(function(view){$contentContainer.append(view.el);view.render();if(view.setRuleAction){view.setRuleAction()}});this.$(".step:not(:first)").addClass("hidden");this.activeStep=this.steps[0];this.$el.centreModal();this.$el.hideWaitmask()},next:function next(){var $currentStep=this.activeStep.$el,$nextStep=$currentStep.next(".step");if(!$nextStep.length){return}this.hideError();$currentStep.addClass("hidden");$nextStep.removeClass("hidden");this.activeStep=this.steps[$nextStep.index()];this.activeStep.shown();this.updateButtons()},prev:function prev(){var $currentStep=this.activeStep.$el,$prevStep=$currentStep.prev(".step");if(!$prevStep.length){return}this.hideError();$currentStep.addClass("hidden");$prevStep.removeClass("hidden");this.activeStep=this.steps[$prevStep.index()];this.activeStep.shown();this.updateButtons()},save:function save(){var self=this,model=this.model,isNew=model.isNew(),needsBackfill=this.context.needsBackfill;this.blockButtons();this.$el.showWaitmask({test:"Saving Rule...",opacity:1});model.save({},{success:function success(){var actionType=_(model.get("ruleAction")||[]).keys()[0],action=(isNew?"Add_":"Edit_")+actionType;Analytics.trackEvent({name:"Miscellaneous.Rules",action:action,origin:"Application"});self.modelBackup=undefined;if(!needsBackfill){return self.onRuleSaved(isNew)}doBackfill(self,model,isNew)},error:function error(model,xhr){var error=new ApiError(xhr);self.$el.hideWaitmask();self.unblockButtons();self.showError('Your Rule could not be saved: "'+error.message+'"')}})},blockButtons:function blockButtons(){this.$("footer button").prop("disabled",true);this.$("footer .loading-small").removeClass("hidden")},unblockButtons:function unblockButtons(){this.$("footer button").prop("disabled",false);this.$("footer .loading-small").addClass("hidden")},updateButtons:function updateButtons(){var $activeStep=this.activeStep.$el,isFirstStep=!$activeStep.prev(".step").length,isLastStep=!$activeStep.next(".step").length;this.$("button.js-prev").toggleClass("hidden",isFirstStep);this.$("button.js-next").toggleClass("hidden",isLastStep);this.$("button.js-save").toggleClass("hidden",!isLastStep)},showError:function showError(errorMessage){if(!errorMessage){return}this.$(".error").text(errorMessage).removeClass("hidden")},hideError:function hideError(){this.$(".error").text("").addClass("hidden")},onRuleSaved:function onRuleSaved(wasNew){triggerGlobalEvents(this.model,wasNew);this.trigger("saved",this.model,wasNew);this.remove()}},{show:function show(options){if(!options||!options.tagCollection){throw new TypeError("RuleCreationView.show must be passed a tagCollection option")}var view=new RuleCreationView(options),oldRemove=view.remove;view.remove=function(){view.$el.removeModal()};view.$el.showModal({draggable:"h1.draggable",className:"ruleCreationView modular popup pagepadding",onClose:function onClose(){oldRemove.call(view)}});view.render();return view}});return RuleCreationView});define("mustache!src/components/mentions/templates/unsupportedAttributes",["lib/mustache"],function(mustache){var escapedTemplate="Rules don't support {{#noImageFilterSupport}}Image, {{/noImageFilterSupport}}Category, Tag and Workflow filters.\n\nThese settings will <b>not be used</b> for the Rule you're creating.\n";return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/helpers/createRuleHelper",["underscore","jquery","src/globals/currentProject","src/globals/flags","src/globals/flagNames","src/globals/queries","src/globals/tags","src/models/Rule","src/views/RuleCreationView","mustache!src/components/mentions/templates/unsupportedAttributes","lib/jquery.notify","lib/jquery.confirm"],function(_,$,currentProject,flags,FLAGS,queries,globalTags,Rule,RuleCreationView,unsupportedAttributesTemplate){"use strict";function getUnsupportedRulesAttributes(){var UNSUPPORTED_RULES_ATTRIBUTES=["assigned","status","category","parentCategory","tag","xtag","xcategory","xparentCategory","starred","priority"];if(!flags.variation(FLAGS.ENABLE_LOGO_QUERIES_RULES_IMAGE_FILTER)){UNSUPPORTED_RULES_ATTRIBUTES.push("logoImagesGroupId")}return UNSUPPORTED_RULES_ATTRIBUTES}function hasUnsupportedAttributes(settings){return getUnsupportedRulesAttributes().some(function(attr){if(settings[attr]===undefined){return false}var value=settings[attr];if(!value){return false}if(Array.isArray(value)&&!value.length){return false}return true})}function hasLogoQuerySelected(queryIds){if(!queryIds){return false}queryIds=[].concat(queryIds);return queries.containsLogoQueryIds(queryIds)}function showSaveSuccessMessage(rule){$.notify({text:'Rule "'+rule.escape("name")+'" saved successfully',className:"notification-success"})}function showRulesPopup(settings){getUnsupportedRulesAttributes().forEach(function(attr){return delete settings[attr]});delete settings.liveStreaming;RuleCreationView.show({tagCollection:globalTags,model:new Rule({projectId:currentProject.id,filter:settings})}).once("saved",function(rule){showSaveSuccessMessage(rule)})}return{show:function show(settings){var hasLogoQueries=hasLogoQuerySelected(settings.queryId);if(!hasUnsupportedAttributes(settings)){showRulesPopup(settings);return}var text=unsupportedAttributesTemplate({noImageFilterSupport:getUnsupportedRulesAttributes().includes("logoImagesGroupId")});$.confirm({escape:false,title:"We Can't Apply all the Settings to Your Rule",text:text,dialogClass:hasLogoQueries?"smallpopup":"tinypopup",buttons:[{text:"Continue to Rule Creation",className:"ok",value:true,keyCode:13},{text:"Cancel",className:"cancel",value:false,keyCode:27}]},function(choice){if(choice){_.defer(function(){showRulesPopup(settings)})}})}}});define("src/helpers/controlsViewHelper",[],function(){"use strict";function resetPageWhenChangesApplied(view){var wrappedApply=view.applyChanges;view.applyChanges=function(additionalSettings){additionalSettings=additionalSettings||{};additionalSettings.page=0;wrappedApply.call(this,additionalSettings)}}return{resetPageWhenChangesApplied:resetPageWhenChangesApplied}});define("mustache!src/controls/templates/queryGroupInputs",["lib/mustache"],function(mustache){var escapedTemplate='{{#showLabel}}\n<label class="db smallpadding-bottom">{{labelText}}</label>\n{{/showLabel}}\n{{#showHelpKey}}\n<a class="help icon-bwhelp singlemargin-right" data-key="{{helpKey}}" tabindex="-1"></a>\n{{/showHelpKey}}\n<select class="queryGroup selectfield" name="queryGroupId" {{#canSelectMultiple}}multiple{{/canSelectMultiple}}>\n{{^canSelectMultiple}}\n<option value="">Select Group</option>\n{{/canSelectMultiple}}\n{{#queryGroups}}\n<option value="{{id}}" {{selected}}>{{name}}</option>\n{{/queryGroups}}\n</select>\n{{^canSelectMultiple}}\n<a class="editQueryGroup icon-pencil grey customtip smallpadding-left" tabindex="-1" title="Edit Group"></a>\n{{/canSelectMultiple}}\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/controls/views/QueryGroupInputs",["backbone","underscore","jquery","selleckt","src/controls/controlsEvents","mustache!src/controls/templates/queryGroupInputs","text!src/controls/templates/queryselection/querySelectorItem.template","text!src/controls/templates/queryselection/querySelectorItemsPopup.template","text!src/controls/templates/queryselection/querySelectorMain.template","text!src/controls/templates/queryselection/querySelectorSelection.template","customtip","css!src/controls/css/sellecktPopup.css"],function(Backbone,_,$,selleckt,controlsEvents,queryGroupInputsTemplate,querySelectorItemTemplate,querySelectorItemsPopupTemplate,querySelectorMainTemplate,querySelectorSelectionTemplate){"use strict";function getSelleckt(view){return view.selleckt}return Backbone.View.extend({className:"queryGroupInputs inputWrapper relative",events:function events(){return{"click a.editQueryGroup":"onEditQueryGroup","click .js-edit":"onClickMultiSellecktEditGroup"}},constructor:function QueryGroupInputs(options){Backbone.View.apply(this,arguments);if(!options||!options.queryGroups){throw new TypeError("options.queryGroups must be defined")}this.queryGroups=options.queryGroups;this.helpKey=options.helpKey;this.labelText=options.labelText||"Select Group";this.canSelectMultiple=!!options.canSelectMultiple;this.showHelpKey="showHelpKey"in options?options.showHelpKey:true;this.isEnabled="isEnabled"in options?options.isEnabled:true;this.showLabel="showLabel"in options?options.showLabel:true;this.listenTo(this.model,"change",this.updateValues);this.listenTo(this.model,"invalid",this.showErrors);this.listenTo(this.queryGroups,"add remove change:name reset",this.render);this.listenTo(this.queryGroups,"add",this.onQueryGroupAdded)},remove:function remove(){var selleckt=getSelleckt(this);if(selleckt){selleckt.destroy()}Backbone.View.prototype.remove.call(this)},onEditQueryGroup:function onEditQueryGroup(e){e.preventDefault();var queryGroupId=this.$("[name=queryGroupId]").val(),queryGroup=this.queryGroups.get(queryGroupId);if(queryGroup){controlsEvents.trigger("editQueryGroup",queryGroup)}},onClickMultiSellecktEditGroup:function onClickMultiSellecktEditGroup(e){var queryGroupId=$(e.currentTarget).closest(".selectionItem").data("value"),queryGroup=this.queryGroups.get(queryGroupId);controlsEvents.trigger("editQueryGroup",queryGroup)},onQueryGroupAdded:function onQueryGroupAdded(model){this.$("[name=queryGroupId]").val(model.id)},onCreateQueryGroup:function onCreateQueryGroup(e){e.preventDefault();this.stopListening(this.queryGroups,"add",this.onQueryGroupAdded);this.listenToOnce(this.queryGroups,"add",this.onQueryGroupAdded);controlsEvents.trigger("createQueryGroup",this.queryGroups)},updateValues:function updateValues(){var queryGroupId=this.model.get("queryGroupId")||"",$queryGroupId=this.$("[name=queryGroupId]");this.$(".invalid").removeClass("invalid");if($queryGroupId.val()!==queryGroupId.toString()){$queryGroupId.val(queryGroupId).change()}},showErrors:function showErrors(model,errors){if(!_.isArray(errors)){return}if(errors.indexOf("queryGroupId")>-1){this.$("[name=queryGroupId]").addClass("invalid");getSelleckt(this).$sellecktEl.addClass("invalid")}},render:function render(){if(!this.isEnabled){this.$el.empty();return}var queryGroupIds=this.$("[name=queryGroupId]").val()||this.model.get("queryGroupId")||this.model.get("groupID");var selectedQueryGroupIds=_([].concat(queryGroupIds)).map(function(id){return parseInt(id,10)}),data={queryGroups:_(this.queryGroups.toJSON()).map(function(group){return{id:group.id,name:group.name,selected:selectedQueryGroupIds.indexOf(group.id)>-1?"selected":""}}),canSelectMultiple:this.canSelectMultiple,showLabel:this.showLabel,labelText:this.labelText,helpKey:this.helpKey||"filters-query-group",showHelpKey:this.showHelpKey};var onCreateQueryGroup=_.bind(this.onCreateQueryGroup,this);this.$el.html(queryGroupInputsTemplate(data));this.$el.customtip();this.initEditQueryGroupLink();if(this.selleckt){this.selleckt.destroy()}this.selleckt=selleckt.create({$selectEl:this.$("select"),className:"selleckt modular dib fullwidth",multiple:this.canSelectMultiple,enableSearch:true,placeholderText:"Select Group",mainTemplate:querySelectorMainTemplate,selectionTemplate:querySelectorSelectionTemplate,itemTemplate:querySelectorItemTemplate,popupTemplate:querySelectorItemsPopupTemplate,popupTemplateData:{footer:this.canSelectMultiple?"":'<a class="newQueryGroup"><span class="iconsmaller icon-plus smallpadding-right" />New Query Group</a>'}});this.selleckt.render();this.selleckt.on("onPopupCreated",function(popup){var $popupEl=popup.$popup;$popupEl.on("click",".newQueryGroup",onCreateQueryGroup)})},initEditQueryGroupLink:function initEditQueryGroupLink(){var self=this,editLink=self.$("a.editQueryGroup"),toggleEditLink=function toggleEditLink(){editLink.toggleClass("enabled",!!$(this).val())};if(this.queryGroupSelector){this.queryGroupSelector.off()}this.queryGroupSelector=this.$("[name=queryGroupId]");this.queryGroupSelector.change(toggleEditLink);toggleEditLink.call(this.queryGroupSelector)},getValues:function getValues(){if(!this.isEnabled){return{queryGroupId:this.model.get("queryGroupId")}}var queryGroups=_.map([].concat(this.$("[name=queryGroupId]").val()||[]),function(id){return parseInt(id,10)});return{queryGroupId:this.canSelectMultiple?queryGroups:queryGroups[0]||""}}})});define("mustache!src/controls/templates/combinedQueryInputs",["lib/mustache"],function(mustache){var escapedTemplate='<a class="help icon-bwhelp" data-type="query" data-key="multiple-query-select-input" tabindex="-1"></a>\n<a class="help icon-bwhelp" data-type="queryGroup" data-key="filters-query-group" tabindex="-1"></a>\n<ul class="tabs">\n<li data-type="query"><a tabindex="-1">Data</a></li>\n<li data-type="queryGroup"><a tabindex="-1">Group</a></li>\n</ul>\n<div class="panes smallmargin-bottom">\n<fieldset class="query tab hidden"></fieldset>\n<fieldset class="queryGroup tab hidden"></fieldset>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/controls/css/combinedQueryInputs.css",["css!src/controls/css/compiled.css"],function(){});define("src/controls/views/ControlsViewCombinedQueryInputs",["underscore","jquery","src/controls/views/ControlsViewInputs","src/controls/views/QueryInputs","src/controls/views/QueryGroupInputs","mustache!src/controls/templates/combinedQueryInputs","css!src/controls/css/combinedQueryInputs.css","customtip"],function(_,$,ControlsViewInputs,QueryInputs,QueryGroupInputs,combinedQueryInputsTemplate){"use strict";return ControlsViewInputs.extend({className:"combinedQueryInputs modular singlepadding-horizontal singlepadding-top",events:function events(){return _.extend({"click ul.tabs li":"onClickTab","click .query .js-edit":"onEditQuery","click .js-create-query":"onCreateQuery"},ControlsViewInputs.prototype.events.call())},constructor:function ControlsViewCombinedQueryInputs(options){ControlsViewInputs.apply(this,arguments);if(!options||!options.queries){throw new TypeError("options.queries must be set")}if(!options.queryGroups){throw new TypeError("options.queryGroups must be set")}if(!options||!options.hasOwnProperty("canEditQueries")){throw new TypeError("options.canEditQueries must be supplied")}this.queries=options.queries;this.queryGroups=options.queryGroups;this.listenTo(this.model,"change",this.updateValues);this.listenTo(this.model,"invalid",this.showErrors);this.isEnabled="isEnabled"in options?options.isEnabled:true;this.queryInputs=new QueryInputs({model:this.model,queries:options.queries,isEnabled:this.isEnabled,inputLabel:options.inputLabel,selectPlaceholder:options.selectPlaceholder,allowedQueryTypes:options.allowedQueryTypes,canEditQueries:options.canEditQueries,queryColourOptions:options.queryColourOptions});this.queryGroupInputs=new QueryGroupInputs({model:this.model,queryGroups:options.queryGroups,isEnabled:this.isEnabled,showLabel:false,showHelpKey:false,canSelectMultiple:options.canSelectMultipleQueryGroups,canEditQueries:options.canEditQueries})},remove:function remove(){this.queryInputs.remove();this.queryGroupInputs.remove();ControlsViewInputs.prototype.remove.call(this)},updateValues:function updateValues(){var currentMode=this.model.get("currentMode");this.showTab(currentMode)},render:function render(){if(!this.isEnabled){this.$el.empty();return}var selectedQueryGroupId=this.$("[name=queryGroupId]").val()||this.model.get("queryGroupId"),currentMode=this.model.get("currentMode")||(selectedQueryGroupId?"queryGroup":"query");if(this.$(".panes .query").length){currentMode=this.$(".panes .query").hasClass("hidden")?"queryGroup":"query"}this.queryInputs.$el.detach();this.queryGroupInputs.$el.detach();this.$el.html(combinedQueryInputsTemplate());this.queryInputs.render();this.$(".query").append(this.queryInputs.el);this.queryGroupInputs.render();this.$(".queryGroup").append(this.queryGroupInputs.el);this.toggleHelp(currentMode);this.showTab(currentMode);this.$el.customtip()},onClickTab:function onClickTab(e){e.preventDefault();var $target=$(e.target).closest("li"),newMode=$target.data("type")==="query"?"query":"queryGroup";this.showTab(newMode);this.model.set(_.extend(this.getValues(),{currentMode:newMode}));if(this.model.validationError&&this.model.validationError.length){this.$("."+newMode+" .selleckt").addClass("invalid")}else{this.$("."+newMode+" .selleckt").removeClass("invalid")}this.toggleHelp(newMode)},showTab:function showTab(type){type=type||"query";this.$("ul.tabs li").each(function(i,el){var $el=$(el),$a=$el.find("a");$a.toggleClass("current active",$el.data("type")===type)});this.$("div.panes fieldset").each(function(i,el){var $el=$(el);$el.toggleClass("hidden",!$el.hasClass(type))})},toggleHelp:function toggleHelp(currentMode){this.$(".help").hide().filter("[data-type="+currentMode+"]").show()},getValues:function getValues(){if(!this.isEnabled){return{currentMode:this.model.get("currentMode"),queryId:this.model.get("queryId")||[],queryName:"",queryGroupId:this.model.get("queryGroupId")||""}}var currentMode=this.$("ul.tabs li a.current").parent().data("type"),query=this.queryInputs.getValues(),queryGroupId=this.queryGroupInputs.getValues().queryGroupId;return{currentMode:currentMode,queryId:query.queryId,queryName:"",queryGroupId:queryGroupId}},selectChanged:function selectChanged(e){var $target=$(e.target);var currentMode=this.model.get("currentMode");var isQueryOrGroupSelect=$target.hasClass("query")||$target.hasClass("queryGroup");if(isQueryOrGroupSelect){if($target.val()&&$target.val().length){this.$("."+currentMode+" .selleckt").removeClass("invalid")}else{this.$("."+currentMode+" .selleckt").addClass("invalid")}}$(".tooltip").hide();this.$el.customtip();ControlsViewInputs.prototype.selectChanged.call(this)}})});define("mustache!templates/alertMainSettings",["lib/mustache"],function(mustache){var escapedTemplate='<div class="overlay hidden modular"></div>\n<div class="topsettings doublemargin-bottom modular">\n<div class="firstcol doublepadding-right valigntop">\n<fieldset class="recipients">\n<span>To</span>\n<div class="recipientsFields fields validation-wrapper fivecol">\n<ul class="recipientList tinymargin-top">\n{{#isNewAlert}}\n<li data-email="{{email}}" class="mediumtext">{{email}}<a class="icon-remove remove iconsmaller grey smallmargin-left pointer"></a></li>\n{{/isNewAlert}}\n{{#recipients}}\n<li data-email="{{.}}" class="mediumtext">{{.}}<a class="icon-remove remove iconsmaller grey smallmargin-left pointer"></a></li>\n{{/recipients}}\n</ul>\n<input id="recipient-{{cid}}" class="field rounded threecol tinymargin-top" name="recipient" type="text" placeholder="colleague@example.com"/>\n<button class="js-add button valignbottom smallmargin-left customtip onecol" title="Add recipient - they will get an opt-in link first">Add</button>\n</div>\n</fieldset>\n<fieldset class="alertName singlemargin-top">\n<p>\n<label for="alertName-{{cid}}">Alert Name</label>\n</p>\n<p>\n<input  id="alertName-{{cid}}" class="tinymargin-top validation-wrapper field fourcol" name="name" maxlength="1024" type="text" value="{{name}}" placeholder="Will appear in email Subject" />\n</p>\n</fieldset>\n</div>\n<div class="secondcol doublepadding-left singlepadding-top">\n<fieldset class="alertTypes validation-wrapper">\n<p class="increaseAlert tinymargin-top">\n<input id="thresholdAlertEnabled-{{cid}}" name="thresholdAlertEnabled" type="checkbox" value="true" {{thresholdAlertEnabled}} data-toggle-element="thresholdAlertFields"/>\n<label for="thresholdAlertEnabled-{{cid}}" class="tinymargin-left">Alert me about <b>increases</b> in volume...</label>\n<a class="help icon-bwhelp tinymargin-left" data-key="alert-on-increase"></a>\n</p>\n<p class="thresholdAlertFields fields hidden smallmargin-top">\n<label for="threshold-{{cid}}">When there is an increase in mentions of&nbsp;</label>\n<input id="threshold-{{cid}}" class="validation-wrapper field textright" name="threshold" type="text" value="{{threshold}}"/>\n%\n</p>\n<p class="scheduledAlertLabelRow singlemargin-top">\n<input id="scheduledAlertEnabled-{{cid}}" name="scheduledAlertEnabled" type="checkbox" value="true" {{scheduledAlertEnabled}} data-toggle-element="scheduledAlertFields"/>\n<label for="scheduledAlertEnabled-{{cid}}" class="tinymargin-left">Alert me when <b>new mentions</b> are found...</label>\n<a class="help icon-bwhelp tinymargin-left" data-key="alert-schedule"></a>\n</p>\n<p class="scheduledAlertFields fields hidden singlemargin-top">\n<select id="frequency-{{cid}}" class="frequency selectfield" name="frequency">\n<option value="5">As it happens</option>\n<option value="15">Every 15 minutes</option>\n<option value="30">Every 30 minutes</option>\n<option value="60">Hourly</option>\n<option value="{{frequencyTwiceDaily}}">Twice daily</option>\n<option value="{{frequencyDaily}}">Daily</option>\n<option value="{{frequencyWeekly}}">Weekly</option>\n</select>\n<span class="dayOfWeekField">\non\n<select name="dayOfWeek" class="selectfield">\n<option value="1">Monday</option>\n<option value="2">Tuesday</option>\n<option value="3">Wednesday</option>\n<option value="4">Thursday</option>\n<option value="5">Friday</option>\n<option value="6">Saturday</option>\n<option value="7">Sunday</option>\n</select>\n</span>\n<span class="hourOfDayField">\nat\n<select name="hourOfDay" class="selectfield">\n<option value="6">6am</option>\n<option value="7">7am</option>\n<option value="8">8am</option>\n<option value="9">9am</option>\n<option value="10">10am</option>\n<option value="11">11am</option>\n<option value="12">12pm</option>\n<option value="13">1pm</option>\n<option value="14">2pm</option>\n<option value="15">3pm</option>\n<option value="16">4pm</option>\n<option value="17">5pm</option>\n<option value="18">6pm</option>\n<option value="19">7pm</option>\n<option value="20">8pm</option>\n<option value="21">9pm</option>\n<option value="22">10pm</option>\n<option value="23">11pm</option>\n<option value="0">12am</option>\n<option value="1">1am</option>\n<option value="2">2am</option>\n<option value="3">3am</option>\n<option value="4">4am</option>\n<option value="5">5am</option>\n</select>\n<span class="secondTimeField">\nand\n<span class="secondTime">12am</span>\n</span>\nUTC\n</span>\n</p>\n<hr>\n<p>\n<label class="smallmargin-bottom db" for="mentionsPerAlert-slider">How many mentions should the Alert mail contain?</span></label>\n<div class="js-query-sampling-slider">\n<input name="mentionsPerAlert-slider" type="range" min="{{mentionsPerAlertMin}}" max="{{mentionsPerAlertMax}}" step="{{mentionsPerAlertStep}}" value="{{mentionsPerAlert}}">\n<span class="js-mentions-per-alert onecol smallpadding-left textright" value="{{mentionsPerAlert}}">{{mentionsPerAlert}} mentions</span>\n</div>\n</p>\n</div>\n</div>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/views/AlertMainSettingsView",["backbone","underscore","jquery","src/globals/me","bw-fe-helpers/validationHelpers","mustache!templates/alertMainSettings","moment","src/packages/bwslider"],function(Backbone,_,$,me,validationHelpers,template,moment){"use strict";var frequencyTwiceDaily=720;var frequencyDaily=1440;var frequencyWeekly=10080;var mentionsPerAlertMin=5;var mentionsPerAlertMax=50;var mentionsPerAlertStep=5;function getEmails(view){return _.compact(view.$(".recipientsFields li").map(function(i,el){return $(el).data("email")}).get())}function getRecipients(view){var lastRecipient=view.$("input[name=recipient]").val().trim();var recipients=getEmails(view);if(lastRecipient&&validationHelpers.isValidEmail(lastRecipient)){recipients.push(lastRecipient)}return _(recipients).map(function(recipient){return{email:recipient.trim()}})}function checkEmailIsFromCreator(email){return email.toLowerCase()===me.get("username").toLowerCase()}function removeCreatorFromRecipients(view){var recipients=getRecipients(view);return _(recipients).reject(function(recipient){return checkEmailIsFromCreator(recipient.email)})}function addCreatorToRecipients(recipients,emailCreator){var recipientsEmails=_(recipients).pluck("email");if(emailCreator){recipientsEmails.unshift(me.get("username"))}return recipientsEmails}function addEnteredRecipientToList(view){var $recipientsList=view.$(".recipientsFields ul.recipientList");var $recipient=view.$("input[name=recipient]");var recipient=$recipient.val();if(recipient&&!validationHelpers.isValidEmail(recipient)){$recipient.addClass("invalid")}else if(recipient){$recipientsList.append('<li data-email="'+_.escape(recipient)+'" class="mediumtext">'+_.escape(recipient)+'<a class="icon-remove remove iconsmaller grey smallmargin-left pointer"></a></li>');$recipient.val("")}$recipientsList.scrollTop($recipientsList.prop("scrollHeight"));view.trigger("resized")}function updateSelectBoxes(view){var self=view;var $el=view.$el;$el.find("select").each(function(){var $select=$(this);$select.val(self.model.get($select.attr("name")))});view.updateSelectBoxesVisibility()}function isCreatorIncluded(view){var recipients=getRecipients(view);return recipients.some(function checkForCreator(element){return checkEmailIsFromCreator(element.email)})}function renderMentionsPerAlertSlider(view){var $mentionsPerAlertOutput=view.$(".js-mentions-per-alert");view.rangeslider=view.$("input[name=mentionsPerAlert-slider]").bwslider({onSlide:function onSlide(position,value){$mentionsPerAlertOutput.html(value+" mentions")}}).data("plugin_rangeslider")}return Backbone.View.extend({className:"alertMainSettings",events:{"change .alertTypes input[type=checkbox]":"onUpdateAlertMode","change .alertTypes select":"updateSelectBoxesVisibility","keyup .alertTypes select":"updateSelectBoxesVisibility","keydown input[name=recipient]":"onKeyDownRecipient","click .js-add":"onClickAddRecipient","click .recipientsFields a.remove":"onRemoveRecipient","change .frequency":"onFrequencyChanged"},initialize:function initialize(options){if(!options||!options.model){throw new Error("options.model must be defined!")}},render:function render(){var self=this;var data=this.model.toJSON();var $el=this.$el;var username=me.get("username");var mentionsPerAlert=data.mentionsPerAlert||mentionsPerAlertMin;var alertTypes=data.alertTypes||[];var recipients=addCreatorToRecipients(data.recipients,data.emailCreator);data=_.extend(data,{cid:this.cid,scheduledAlertEnabled:alertTypes.indexOf("scheduled")>-1?"checked":"",thresholdAlertEnabled:alertTypes.indexOf("threshold")>-1?"checked":"",recipients:recipients,recipientsSummary:recipients.length?", "+recipients.join(", "):"",isNewAlert:recipients.length===0,email:username,frequencyTwiceDaily:frequencyTwiceDaily,frequencyDaily:frequencyDaily,frequencyWeekly:frequencyWeekly,mentionsPerAlertMin:mentionsPerAlertMin,mentionsPerAlertMax:mentionsPerAlertMax,mentionsPerAlertStep:mentionsPerAlertStep,mentionsPerAlert:mentionsPerAlert});$el.html(template(data));$el.find("input[type=checkbox]").each(function(){self.onUpdateAlertMode(this)});updateSelectBoxes(this);renderMentionsPerAlertSlider(this)},getHelpKeyIncrease:function getHelpKeyIncrease(){return"alert-on-increase"},getHelpKeySchedule:function getHelpKeySchedule(){return"alert-schedule"},onUpdateAlertMode:function onUpdateAlertMode(e){var $checkbox=$(e.target||e);var $toggleElement=this.$("."+$checkbox.data("toggle-element"));var state=false;if($checkbox.is(":checked")){state=true}$toggleElement.toggleClass("hidden",!state);this.trigger("alertTypesChanged",this.getAlertTypes());this.trigger("resized")},onClickAddRecipient:function onClickAddRecipient(){var $recipientInput=this.$("input[name=recipient]");$recipientInput.removeClass("invalid");addEnteredRecipientToList(this);$recipientInput.focus()},onKeyDownRecipient:function onKeyDownRecipient(e){this.$("input[name=recipient]").removeClass("invalid");if(e.which===13){addEnteredRecipientToList(this)}},onRemoveRecipient:function onRemoveRecipient(e){var $li=$(e.target).closest("li");$li.remove()},onFrequencyChanged:function onFrequencyChanged(){this.trigger("frequencyChanged",this.getFrequency())},updateSelectBoxesVisibility:function updateSelectBoxesVisibility(){var $el=this.$el;var $dayField=$el.find(".dayOfWeekField");var $timeField=$el.find(".hourOfDayField");var $timeSelect=$el.find("[name=hourOfDay]");var currentFreq=parseInt($el.find("select[name=frequency]").val(),10);var timeValue;$dayField.toggleClass("hidden",currentFreq!==frequencyWeekly);$timeField.toggleClass("hidden",[frequencyTwiceDaily,frequencyDaily,frequencyWeekly].indexOf(currentFreq)===-1);timeValue=parseInt($timeSelect.val(),10);if(currentFreq===frequencyTwiceDaily&&timeValue!==-1){$el.find(".secondTime").html(moment(0).hours(timeValue+12).format("ha"));$el.find(".secondTimeField").removeClass("hidden")}else{$el.find(".secondTimeField").addClass("hidden")}},getAlertTypes:function getAlertTypes(){var alertTypes=[];if(this.$("[name=scheduledAlertEnabled]").is(":checked")){alertTypes.push("scheduled")}if(this.$("[name=thresholdAlertEnabled]").is(":checked")){alertTypes.push("threshold")}return alertTypes},getFrequency:function getFrequency(){return parseInt(this.$("select[name=frequency]").val(),10)},getValues:function getValues(){var recipients;addEnteredRecipientToList(this);recipients=removeCreatorFromRecipients(this);return{name:this.$("[name=name]").val(),recipients:recipients,emailCreator:isCreatorIncluded(this),alertTypes:this.getAlertTypes(),frequency:this.getFrequency(),dayOfWeek:parseInt(this.$("select[name=dayOfWeek]").val(),10),hourOfDay:parseInt(this.$("select[name=hourOfDay]").val(),10),threshold:parseInt(this.$("[name=threshold]").val(),10)||50,mentionsPerAlert:parseInt(this.$("[name=mentionsPerAlert-slider]").val(),10)}}})});define("mustache!templates/alertControls",["lib/mustache"],function(mustache){var escapedTemplate='<div class="searchBoxContainer controls--section-first lightgreybg singlepadding">\n</div>\n<div class="component-controls">\n<div class="controls--section queries lightgreybg">\n{{#canSeeQueryFields}}\n<fieldset class="queryinputs"></fieldset>\n{{/canSeeQueryFields}}\n<fieldset class="dateinputs lastInSet"></fieldset>\n<div class="singlepadding">\n<button class="applyChanges button">Test Search</button>\n</div>\n</div>\n\t{{#canSeeFilters}}\n<div class="filters controls--section singlepadding lightgreybg">\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="filters-component" ></a>\n{{/showHelp}}\n<h2 class="bold db bigtext smallpadding-bottom">Filters</h2>\n<p class="apply singlemargin-top">\n<button class="applyChanges button">Test Search</button>\n\t\t\t{{#canClearFilters}}\n<a class="clearFilters db floatright smallmargin-top">Clear Filters</a>\n\t\t\t{{/canClearFilters}}\n</p>\n</div>\n{{/canSeeFilters}}\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/views/AlertControlsView",["underscore","src/permissions","src/views/ControlsView","src/views/ControlsViewSearchInput","mustache!templates/alertControls"],function(_,permissions,ControlsView,ControlsViewSearchInput,template){"use strict";return ControlsView.extend({setupInputViews:function setupInputViews(viewOptions){this.searchInput=new ControlsViewSearchInput({expanderClassName:"lightgreybg",model:this.model,dashboard:undefined,helpKey:"alert-search-terms"});this.searchInput.bind("changesMade",this.onChangesMade,this);this.listenTo(this.searchInput,"search",this.onApplyChanges,this);this.queryInputs=this.createQueryInputs(viewOptions);this.queryInputs.bind("changesMade",this.onChangesMade,this)},renderInputs:function renderInputs(){this.$(".searchBoxContainer").append(this.searchInput.el);this.searchInput.render();if(permissions.check("see.dashboard.controls.queryField",this.dashboard)){this.renderQueryInputs()}this.renderFilters()},setSearchFieldEnabled:function setSearchFieldEnabled(enabled){this.searchInput.setEnabled(enabled)},makeEl:function makeEl(data){return template(data)},getFilters:function getFilters(viewOptions){_(viewOptions).extend({showGenderFilter:true,showAccountTypeFilter:true,showAuthorLocationFilter:true,showProfessionFilter:true,showInterestFilter:true});return ControlsView.prototype.getFilters.call(this,_.extend({},viewOptions,{autocompletePosition:"right"}))},getSettings:function getSettings(){return _.extend({},this.searchInput?this.searchInput.getValues():{},ControlsView.prototype.getSettings.call(this))}})});define("src/models/AlertCollection",["backbone","underscore","src/globals/currentProject","src/models/Alert"],function(Backbone,_,currentProject,Alert){"use strict";var AlertCollection=Backbone.Collection.extend({model:Alert,initialize:function initialize(models,options){options=options||{};this.projectId=options.projectId||currentProject.id},url:function url(){return"/alerts/?projectId="+this.projectId},parse:function parse(results){var projectId=this.projectId;return _.filter(results,function(result){return projectId===result.projectId})}});return AlertCollection});define("src/globals/alerts",["src/globals/currentProject","src/models/AlertCollection"],function(currentProject,AlertCollection){"use strict";var alerts=new AlertCollection;currentProject.onLoad(function(done){if(currentProject.id!==alerts.projectId){alerts.reset([]);alerts.projectId=currentProject.id}done()});return alerts});define("mustache!templates/alertSettings",["lib/mustache"],function(mustache){var escapedTemplate='<header>\n<h1 class="popuptitletext singlemargin-bottom draggable textellipsis">{{title}}</h1>\n</header>\n<div class="body">\n<form><div class="errorPane notification-error rounded smallpadding-vertical singlepadding-horizontal hidden"></div></form>\n<div class="topPanel"></div>\n<fieldset class="filterSettings doublemargin-bottom clearboth expandable {{^filtersExpanded}}collapsed{{/filtersExpanded}}">\n<legend>\n<a class="toggle">\n<span>Set Filters &amp; preview mentions</span>\n</a>\n<a class="help icon-bwhelp" data-key="alert-filters-info"></a>\n<a class="toggle-icon">Toggle</a>\n</legend>\n<article class="pagemargin-horizontal pagemargin-bottom">\n<aside>\n<form class="controls"></form>\n</aside>\n{{#showInstructions}}\n<div class="instructions">\n<h2>To create an Alert</h2>\n<ul class="steps">\n<li><span class="stepDigit">1</span>Select when Alert should be sent</li>\n<li><span class="stepDigit">2</span>Enter Alert name</li>\n<li><span class="stepDigit">3</span>Pick Query and adjust filter</li>\n<li><span class="stepDigit">4</span>Test search<span class="grey">*</span><span class="medium">(repeat until happy)</span></li>\n<li><span class="stepDigit">5</span>Click "Save Alert"</li>\n</ul>\n<p class="optional grey">*optional</p>\n<p class="hint">You can also create an Alert within the <b>Mentions Component</b> of a Dashboard.</p>\n</div>\n{{/showInstructions}}\n<div class="content {{#showInstructions}}hidden{{/showInstructions}}">\n</div>\n</article>\n</fieldset>\n</div>\n<footer>\n<div class="pagepadding-horizontal pagepadding-bottom doublepadding-top overflow-both">\n<button class="save defaultbutton floatleft">Save Alert</button>\n<button class="cancel button singlemargin-left floatleft">Cancel</button>\n<div class="errorMessage hidden singlemargin-left notification-error smallpadding-vertical singlepadding-horizontal rounded floatleft">Please fix errors above</div>\n</div>\n</footer>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!css/dashboard.css",["css!css/compiled.css"],function(){});define("css!css/alertSettingsPopup.css",["css!css/compiled.css"],function(){});define("css!css/instructions.css",["css!css/compiled.css"],function(){});define("src/views/AlertSettingsPopup",["q","underscore","jquery","src/events/alertEvents","src/events/globalEventNames","src/views/ValidatingFormView","src/components/mentions/views/MentionsSnippetsView","src/views/AlertMainSettingsView","src/views/AlertControlsView","src/globals/alerts","src/globals/categories","src/globals/languages","src/globals/tags","src/components/mentions/models/MentionCollection","src/analytics/Analytics","mustache!templates/alertSettings","src/packages/modalDialogs","src/packages/waitmask","src/packages/customtip","css!css/dashboard.css","css!css/alertSettingsPopup.css","css!css/instructions.css"],function(Q,_,$,alertEvents,globalEventNames,ValidatingFormView,MentionsSnippetsView,AlertMainSettingsView,AlertControlsView,alerts,categories,globalLanguages,tags,MentionCollection,Analytics,alertSettings){"use strict";var ALERT_EVENT_NAMES=globalEventNames.ALERTS;var AlertSettingsPopup=ValidatingFormView.extend({className:"alertSettingsPopup",events:{"click .save":"onSave","click .cancel":"onClose","click .filterSettings>legend":"onToggleFilterPanel"},initialize:function initialize(opts){var options=opts||{};ValidatingFormView.prototype.initialize.apply(this,arguments);this.createMode=this.model.isNew();this.title=options.title;if(_.isUndefined(options.filtersExpanded)){this.filtersExpanded=this.createMode}else{this.filtersExpanded=options.filtersExpanded}if(!this.title){if(this.createMode){this.title="Create Email Alert"}else{this.title='Edit Email Alert: "'+this.model.get("name")+'"'}}this.collection=options.collection||alerts;this.model.settings.bind("change",this.updateSettingsModel,this);this.canUpdateSettingsModel=true;this.mentionsModel=new MentionCollection;this.mentionsModel.settings=this.model.settings;this.originalSettings=this.model.settings.toJSON();this.mainSettingsView=new AlertMainSettingsView({model:this.model});this.snippetsView=new MentionsSnippetsView({collection:this.mentionsModel,settings:this.model.settings,viewOnly:true,showTermFilter:false,showDateFilter:true,categories:categories});this.fetchSnippets=!this.filtersExpanded&&this.model.get("queryId");this.model.settings.bind("invalid",this.onControlsError,this);this.callback=options.callback;this.mainSettingsView.on("resized",this.onResize,this);this.onWindowResize=_.debounce(this.onWindowResize,50);$(window).on("resize.AlertSettingsPopup",_.bind(this.onResize,this))},remove:function remove(){var modelSettings=this.model.settings;modelSettings.off("change",this.updateSettingsModel);modelSettings.off("invalid",this.onControlsError);if(this.isModelDirty){modelSettings.clear({silent:true}).set(this.originalSettings)}$(window).off("resize.AlertSettingsPopup");this.snippetsView.unbind();this.snippetsView.remove();this.mainSettingsView.off();this.mainSettingsView.remove();if(this.controlsView){this.controlsView.off();this.controlsView.remove()}ValidatingFormView.prototype.remove.call(this)},render:function render(){var _this=this;var $el=this.$el,data=_.extend(this.model.toJSON(),{title:this.title,filtersExpanded:this.filtersExpanded,showInstructions:this.createMode});$el.html(alertSettings(data));var deferred=Q.defer();globalLanguages.load(function(err,languages){if(err){deferred.reject();return}_this.controlsView=new AlertControlsView({categories:categories,model:_this.model.settings,el:_this.$("aside form.controls"),global:true,tags:tags,languages:languages});deferred.resolve()});return deferred.promise.then(function(){_this.controlsView.render();_this.controlsView.searchInput.on("changesMade",_this.updateSearchFieldState,_this);_this.mainSettingsView.on("alertTypesChanged",_this.updateSearchFieldState,_this);_this.mainSettingsView.on("frequencyChanged",_this.updateSearchFieldState,_this);$el.find(".filterSettings .content").append(_this.snippetsView.el);_this.snippetsView.render();$el.find(".topPanel").append(_this.mainSettingsView.el);_this.mainSettingsView.render();_this.updateSearchFieldState();_this.$el.customtip();_this.onResize(true)})},updateSettingsModel:function updateSettingsModel(){this.isModelDirty=true;if(!this.canUpdateSettingsModel){return}delete this.fetchSnippets;this.hideInstructions();this.fetchModel(this.mentionsModel)},fetchModel:function fetchModel(model){var self=this;this.hideErrors();model.fetch({error:function error(model,response){self.onServerError(model,response)}})},hideInstructions:function hideInstructions(){this.$(".instructions").remove();this.$(".content").removeClass("hidden")},onSave:function onSave(e){var self=this;e.preventDefault();return this.saveAlert(function(){self.isModelDirty=false;self.remove()})},saveAlert:function saveAlert(onSuccess){var self=this,model=this.model,isNewModel=this.model.isNew(),updateObj=this.mainSettingsView.getValues(),filterSettings=this.controlsView.getSettings(),errors;updateObj=_.extend(updateObj,{settings:filterSettings});this.hideErrors();errors=model.validate(updateObj);if(errors){if(errors.settings){model.settings.trigger("invalid",model.settings,errors.settings)}this.onModelError(model,errors);return}this.canUpdateSettingsModel=false;this.$el.showWaitmask({text:"Saving...",applyPosition:false});model.save(updateObj,{success:function success(model){self.$el.hideWaitmask();var action=isNewModel?"Add":"Edit";Analytics.trackEvent({name:"Miscellaneous.Alerts",action:action,origin:"Application"});if(self.collection){self.collection.add(model)}if(_.isFunction(onSuccess)){onSuccess(model)}self.runCallback(null,model);alertEvents.trigger(ALERT_EVENT_NAMES.ALERT_SAVED,model.toJSON())},error:function error(model,response){self.$el.hideWaitmask();self.canUpdateSettingsModel=true;self.onServerError(model,response)}})},hideErrors:function hideErrors(){this.$("footer .errorMessage").addClass("hidden");ValidatingFormView.prototype.hideErrors.apply(this,arguments);this.onResize()},onClose:function onClose(){this.remove()},onWindowResize:function onWindowResize(){this.onResize(true)},onResize:function onResize(recenter){var $legend=this.$(".filterSettings>legend"),$content=this.$(".filterSettings>article"),$modal=this.$el,$modalContainer=$modal.parent(),$filterPanel=this.$("fieldset.filterSettings"),winHeight=$(window).height(),position=$modalContainer.position()||{},y=parseInt(position.top,10)||0,attrs={};if(recenter){attrs.top=Math.round(winHeight*.05);attrs.left=Math.round($(window).width()/2-$modal.width()/2)+"px";y=attrs.top}if($filterPanel.hasClass("collapsed")){attrs.height=$modal.outerHeight()+this.$(">footer").height()-36}else{attrs.height=Math.round(winHeight-y*2)-36}attrs.height+="px";attrs.top+="px";$modalContainer.css(attrs);$content.css("top",$legend.position().top+$legend.outerHeight(true))},onModelError:function onModelError(){this.$("footer .errorMessage").removeClass("hidden");return ValidatingFormView.prototype.onModelError.apply(this,arguments)},onServerError:function onServerError(){ValidatingFormView.prototype.onServerError.apply(this,arguments);this.onResize()},onControlsError:function onControlsError(model,errors){var message="Please check the section on the left";if(errors.indexOf("queryId")>=0){message="Please select a query in the section on the left"}this.hideInstructions();this.snippetsView.showMessage(message,"notification-error");this.$("footer .errorMessage").removeClass("hidden")},updateSearchFieldState:function updateSearchFieldState(){this.mainSettingsView.trigger("resized")},onToggleFilterPanel:function onToggleFilterPanel(){var $filterPanel=this.$("fieldset.filterSettings"),needsFetch=false;if($filterPanel.hasClass("collapsed")){$filterPanel.removeClass("collapsed");if(this.fetchSnippets){needsFetch=true}this.filtersExpanded=true}else{$filterPanel.addClass("collapsed");this.filtersExpanded=false}this.onResize();if(needsFetch){this.updateSettingsModel()}},runCallback:function runCallback(err,model){if(this.calledBack){throw new Error("callback already fired!")}if(_.isFunction(this.callback)){this.calledBack=true;this.callback.call(null,err,model)}}},{show:function show(options){if(!options||!options.model){throw new Error("options.model must be set!")}var view=new AlertSettingsPopup(options),oldRemove=view.remove;view.$el.showModal({className:"alertPopupModal popup hugepopup",draggable:".alertSettingsPopup>header>h1",fitToWindow:false,keepCentered:false,maxWidth:960,onClose:function onClose(){oldRemove.call(view)}});this.renderPromise=view.render();view.remove=function(){view.$el.removeModal()};return view}});return AlertSettingsPopup});define("src/components/mentions/views/MentionsControlsView",["underscore","src/permissions","src/globals/currentProject","src/globals/currentDashboard","src/helpers/createRuleHelper","src/views/ControlsView","src/helpers/controlsViewHelper","src/controls/filters/ImageFilters","src/controls/views/ControlsViewCombinedQueryInputs","src/models/Alert","src/views/AlertSettingsPopup"],function(_,permissions,currentProject,currentDashboard,createRuleHelper,ControlsView,controlsViewHelper,ImageFilters,ControlsViewCombinedQueryInputs,Alert,AlertSettingsPopup){"use strict";return ControlsView.extend({events:function events(){return _.extend({"click div.createAlert a:not(.help)":"onClickEmailAlert","click div.createRule a:not(.help)":"onClickRules"},ControlsView.prototype.events.call(this))},constructor:function MentionsControlsView(){ControlsView.apply(this,arguments);controlsViewHelper.resetPageWhenChangesApplied(this);this.listenTo(this.model,"change:liveStreaming",this.renderDateControlsForLiveStreamingState,this)},remove:function remove(){if(this.ruleCreationView){this.stopListening(this.ruleCreationView,"saved",this.showSaveSuccessMessage);this.ruleCreationView.remove();this.ruleCreationView=undefined}ControlsView.prototype.remove.call(this)},getFilters:function getFilters(viewOptions){var finalViewOptions=Object.assign({},viewOptions,{showGenderFilter:true,showAccountTypeFilter:true,showAuthorLocationFilter:true,showProfessionFilter:true,showInterestFilter:true});var filters=ControlsView.prototype.getFilters.call(this,finalViewOptions);filters.push(new ImageFilters(finalViewOptions));return filters},renderInputs:function renderInputs(){ControlsView.prototype.renderInputs.call(this);this.renderDateControlsForLiveStreamingState()},render:function render(){var html="";ControlsView.prototype.render.call(this);if(permissions.check("edit.alerts",currentDashboard)){html+='<div class="createAlert lightgreybg controls--section singlepadding">'+'<div class="notifications"></div>'+'<a class="help icon-bwhelp" data-key="mentions:mentions-email-alerts"></a>'+"<a>Create an <strong>Email Alert</strong> using these filter settings</a>"+"</div>"}if(permissions.check("edit.rules",currentDashboard)){html+='<div class="createRule lightgreybg controls--section singlepadding">'+'<a class="help icon-bwhelp" data-key="rule-creation-info"></a>'+"<a>Create a <strong>Rule</strong> using these filter settings</a>"+"</div>"}this.$el.addClass("mentionsControls").append(html)},onClickEmailAlert:function onClickEmailAlert(e){var settings=this.model.toJSON();delete settings.liveStreaming;e.preventDefault();AlertSettingsPopup.show({filtersExpanded:false,model:new Alert({projectId:currentProject.id,settings:settings})})},onClickRules:function onClickRules(e){e.preventDefault();createRuleHelper.show(this.model.toJSON())},renderDateControlsForLiveStreamingState:function renderDateControlsForLiveStreamingState(){var enableDateInput=!this.model.get("liveStreaming"),$dateFieldset=this.$("fieldset.dateinputs"),$dateInputs=this.dateInputs.$("input"),$anchors=this.dateInputs.$("a");$dateInputs.prop("disabled",!enableDateInput);if(!enableDateInput){$dateFieldset.attr("title","Please turn Live stream off to choose a date");$anchors.addClass("disabledcolor");this.dateInputs.undelegateEvents()}else{$dateFieldset.attr("title","");$anchors.removeClass("disabledcolor");this.dateInputs.delegateEvents()}}},{QueryInputsClass:ControlsViewCombinedQueryInputs})});define("src/helpers/api2queryHelper",["underscore"],function(_){"use strict";var ORDER_DIRECTION_MAP={ascending:"asc",descending:"desc"};return{sanitisePagination:function sanitisePagination(queryData){queryData=this.sanitiseOrder(queryData);queryData=this.sanitisePageSize(queryData);return queryData},sanitiseOrder:function sanitiseOrder(queryData){if(queryData.sort){queryData.orderBy=queryData.sort;delete queryData.sort}if(queryData.direction){queryData.orderDirection=ORDER_DIRECTION_MAP[queryData.direction]||queryData.direction;delete queryData.direction}return queryData},sanitiseLimit:function sanitiseLimit(queryData){if(queryData.count){queryData.limit=queryData.count;delete queryData.count}return queryData},sanitisePageSize:function sanitisePageSize(queryData){if(queryData.count){queryData.pageSize=queryData.count;delete queryData.count}return queryData},sanitiseDate:function sanitiseDate(queryData){queryData=this.sanitiseOrder(queryData);if(queryData.orderBy&&queryData.orderBy==="timestamp"){queryData.orderBy="date"}return queryData},sanitiseTwitterReplyCount:function sanitiseTwitterReplyCount(queryData){queryData=this.sanitiseOrder(queryData);if(queryData.orderBy&&queryData.orderBy==="twitterReplies"){queryData.orderBy="twitterReplyCount"}return queryData},migrateTwitterOrderByValues:function migrateTwitterOrderByValues(attrs){var newValue;var OLD_TO_NEW_MAP={followers:"twitterFollowers",importance:"impact",replies:"twitterReplies",retweets:"twitterRetweets",atMentions:"twitterAtMentions"};newValue=OLD_TO_NEW_MAP[attrs.orderBy];if(newValue){attrs.orderBy=newValue}return attrs},migrateFacebookOrderByValues:function migrateFacebookOrderByValues(attrs){var newValue;var OLD_TO_NEW_MAP={total:"mentions",posts:"facebookPosts",comments:"facebookComments",likes:"facebookLikes",engagement:"impact"};newValue=OLD_TO_NEW_MAP[attrs.orderBy];if(newValue){attrs.orderBy=newValue}return attrs},queryDataForTopAuthorsQuery:function queryDataForTopAuthorsQuery(controlData){var data=_.clone(controlData);data=this.sanitiseTwitterReplyCount(data);if(data.orderBy==="twitterFollowers"){data.orderBy="followers"}return data},parseTopAuthorResult:function parseTopAuthorResult(result){var data=result.data;return{queries:_.pluck(result.values,"id"),queryNames:_.pluck(result.values,"name"),author:data.authorName,mentions:data.volume,volume:data.volume,sentiment:data.sentiment,domain:data.domain,avatarUrl:decodeURIComponent(data.twitterAvatar)||null,impact:data.impact,impactAmplification:data.impactAmplification,impactReach:data.impactReach,impactRelevancy:data.impactRelevancy,facebookLikes:data.facebookLikes,facebookAuthorId:data.facebookAuthorId,facebookPosts:data.facebookPosts,facebookComments:data.facebookComments,tweetVolume:data.domain==="twitter.com"?data.volume||0:0,twitterAtMentions:data.twitterAtMentions,twitterRetweets:data.twitterRetweets,twitterReplies:data.twitterReplyCount,twitterFollowers:data.twitterFollowers,twitterFollowing:data.twitterFollowing,twitterVerified:data.twitterVerified,publicationName:data.publicationName,reachEstimate:data.reachEstimate}}}});define("src/helpers/timezonesControlsModelHelper",["underscore","bw-fe-helpers/isoDateHelper","bw-fe-helpers/timezoneDateHelper"],function(_,isoDateHelper,timezoneDateHelper){"use strict";return{shiftDayRangeToNewTimezone:function shiftDayRangeToNewTimezone(ControlsModel){return ControlsModel.extend({constructor:function constructor(){ControlsModel.apply(this,arguments);var newTimezone=this.timezone;var oldDateRange=this.get("dateRange");var newDateRange;if(!isoDateHelper.isISODateRange(oldDateRange)){return}newDateRange=oldDateRange.split("/").map(function(dateTime){return timezoneDateHelper.replaceTimezoneOffset(dateTime,newTimezone)}).join("/");this.set({dateRange:newDateRange},{silent:true})},toJSON:function toJSON(){var timezone=this.timezone;var json=ControlsModel.prototype.toJSON.apply(this,arguments);if(!isoDateHelper.isISODateRange(json.dateRange)){return json}var datesArray=json.dateRange.split("/").map(function(dateTime){return timezoneDateHelper.formatInAnotherTimezone(dateTime,timezone)});json.dateRange=datesArray.join("/");return json}})},extendQueryDataWithTimezone:function extendQueryDataWithTimezone(ControlsModel){return ControlsModel.extend({getQueryData:function getQueryData(){return _.extend({timezone:this.timezone},ControlsModel.prototype.getQueryData.apply(this,arguments))}})}}});define("src/components/topics/models/TopicsControls",["underscore","src/models/CombinedQueryControls","src/helpers/api2queryHelper","src/helpers/timezonesControlsModelHelper"],function(_,CombinedQueryControls,api2queryHelper,timezonesControlsModelHelper){"use strict";function upgradeOldControlsValues(attrs){api2queryHelper.sanitiseOrder(attrs);api2queryHelper.sanitiseLimit(attrs);if(attrs.term){attrs.search=attrs.term;delete attrs.term}if(attrs.breadcrumbTerm){attrs.breadcrumbSearch=attrs.breadcrumbTerm;delete attrs.breadcrumbTerm}if(attrs.breadcrumbCat){attrs.breadcrumbCategory=attrs.breadcrumbCat;delete attrs.breadcrumbCat}if(attrs.doTopics||attrs.doTopics===false){attrs.excludeTopics=!attrs.doTopics;delete attrs.doTopics}if(attrs.doTags||attrs.doTags===false){attrs.excludeTags=!attrs.doTags;delete attrs.doTags}if(attrs.doCategories||attrs.doCategories===false){attrs.excludeCategories=!attrs.doCategories;delete attrs.doCategories}if(attrs.blacklist){attrs.blacklistTopics=attrs.blacklist;delete attrs.blacklist}}function combineSearchString(queryData,search){if(search){return"("+_.compact([queryData.search,search]).join(") AND (")+")"}else if(typeof queryData.search!=="undefined"){return queryData.search}return""}var TopicsControls=CombinedQueryControls.extend({defaults:function defaults(){return _.extend(CombinedQueryControls.prototype.defaults.call(this),{orderBy:"volume",limit:50,graphedTopics:[],excludeTopics:false,excludeTags:true,excludeCategories:true})},set:function set(key,value,options){var attrs;if(_.isObject(key)||!key){attrs=key;options=value}else{attrs={};attrs[key]=value}upgradeOldControlsValues(attrs);return CombinedQueryControls.prototype.set.call(this,attrs,options)},getQueryData:function getQueryData(){var queryData=CombinedQueryControls.prototype.getQueryData.call(this);queryData.search=combineSearchString(queryData,this.get("breadcrumbSearch"));queryData.category=(queryData.category||[]).concat(this.get("breadcrumbCategory")||[]);if(this.get("logoImagesGroupId")){queryData.logoImagesGroupId=this.get("logoImagesGroupId")}if(queryData.excludeTopics===false){delete queryData.excludeTopics}if(queryData.excludeTags===false){delete queryData.excludeTags}if(queryData.excludeCategories===false){delete queryData.excludeCategories}if(queryData.search===""){delete queryData.search}return queryData},getQueryDataFieldNames:function getQueryDataFieldNames(){return CombinedQueryControls.prototype.getQueryDataFieldNames.apply(this,arguments).concat(["excludeTopics","excludeTags","excludeCategories","blacklistTopics","emojis","limit","orderBy"])}},{combineSearchString:combineSearchString});return timezonesControlsModelHelper.extendQueryDataWithTimezone(TopicsControls)});define("src/components/topics/models/Topics",["underscore","src/models/DataModel","src/components/topics/models/TopicsControls"],function(_,DataModel,TopicsControls){"use strict";return DataModel.extend({controlsModel:TopicsControls,doNotFetchOnSettingsChange:["graphedTopics","spec"],url:"/projects/{projectId}/data/volume/topics/queries/",getTopic:function getTopic(id){return _(this.get("topics")).find(function(topic){return topic.id.toString()===id.toString()})}})});(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==="object"&&typeof module==="object")module.exports=factory(require("underscore"));else if(typeof define==="function"&&define.amd)define("bw-fe-helpers/topicsHelper",["underscore"],factory);else{var a=typeof exports==="object"?factory(require("underscore")):factory(root["underscore"]);for(var i in a)(typeof exports==="object"?exports:root)[i]=a[i]}})(this,function(__WEBPACK_EXTERNAL_MODULE__1__){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=49)}([,function(module,exports){module.exports=__WEBPACK_EXTERNAL_MODULE__1__},,,function(module,exports){module.exports=function(useSourceMap){var list=[];list.toString=function toString(){return this.map(function(item){var content=cssWithMappingToString(item,useSourceMap);if(item[2]){return"@media "+item[2]+"{"+content+"}"}else{return content}}).join("")};list.i=function(modules,mediaQuery){if(typeof modules==="string")modules=[[null,modules,""]];var alreadyImportedModules={};for(var i=0;i<this.length;i++){var id=this[i][0];if(typeof id==="number")alreadyImportedModules[id]=true}for(i=0;i<modules.length;i++){var item=modules[i];if(typeof item[0]!=="number"||!alreadyImportedModules[item[0]]){if(mediaQuery&&!item[2]){item[2]=mediaQuery}else if(mediaQuery){item[2]="("+item[2]+") and ("+mediaQuery+")"}list.push(item)}}};return list};function cssWithMappingToString(item,useSourceMap){var content=item[1]||"";var cssMapping=item[3];if(!cssMapping){return content}if(useSourceMap&&typeof btoa==="function"){var sourceMapping=toComment(cssMapping);var sourceURLs=cssMapping.sources.map(function(source){return"/*# sourceURL="+cssMapping.sourceRoot+source+" */"});return[content].concat(sourceURLs).concat([sourceMapping]).join("\n")}return[content].join("\n")}function toComment(sourceMap){var base64=btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))));var data="sourceMappingURL=data:application/json;charset=utf-8;base64,"+base64;return"/*# "+data+" */"}},,,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var underscore__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1);var underscore__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(underscore__WEBPACK_IMPORTED_MODULE_0__);function getRoundedNumber(number,options){var multiplier=1;var toFixed=options.toFixed;if(underscore__WEBPACK_IMPORTED_MODULE_0___default.a.isNumber(toFixed)&&!isNaN(toFixed)&&toFixed>=0&&toFixed<=20){multiplier=Math.pow(10,Math.floor(toFixed))}return(Math.round(number*multiplier)/multiplier).toString()}function getFormattedNumber(number,unit,options){if(options.returnProps){return{number:number,unit:unit}}return[number,unit].join("")}__webpack_exports__["default"]={prettyNumber:function prettyNumber(number,options){var parsed=parseFloat(number);var absNumber=Math.abs(parsed);var unit="";var divisor;options=options||{};if(!underscore__WEBPACK_IMPORTED_MODULE_0___default.a.isNumber(parsed)||isNaN(parsed)){return number||""}if(!isFinite(parsed)){return""}if(absNumber>999999){unit="M";divisor=1e6}else if(absNumber>9999){unit="K";divisor=1e3}return getFormattedNumber(getRoundedNumber(divisor?parsed/divisor:parsed,options),unit,options)},formatNaturalNumber:function formatNaturalNumber(number){var parsed=parseFloat(number);if(!underscore__WEBPACK_IMPORTED_MODULE_0___default.a.isNumber(parsed)||isNaN(parsed)){return number||""}if(!isFinite(parsed)){return""}if(parsed<0){return number.toString()}return parsed.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1"+",")},formatSpaceDelimitedNumber:function formatSpaceDelimitedNumber(number){var parsed=parseFloat(number);if(!underscore__WEBPACK_IMPORTED_MODULE_0___default.a.isNumber(parsed)||isNaN(parsed)){return number||""}if(!isFinite(parsed)){return""}if(parsed<0){return number.toString()}return parsed.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1"+" ")}}},,,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var opacityTextSubtle=exports.opacityTextSubtle=.75;var opacityTextDisabled=exports.opacityTextDisabled=.3;var opacityBackgroundOverlayModal=exports.opacityBackgroundOverlayModal=.9;var opacityBackgroundOverlayHeavy=exports.opacityBackgroundOverlayHeavy=.75;var opacityBackgroundOverlayLight=exports.opacityBackgroundOverlayLight=.3;var opacityBackgroundSubtle=exports.opacityBackgroundSubtle=.15;var opacityBackgroundActive=exports.opacityBackgroundActive=.08;var opacityBackgroundDisabled=exports.opacityBackgroundDisabled=.05;var opacityBackgroundHover=exports.opacityBackgroundHover=.04;var opacityBorder=exports.opacityBorder=.2;var opacityShadow=exports.opacityShadow=.1;var opacityInputBorderFocused=exports.opacityInputBorderFocused=.5;var opacityInputBorderValid=exports.opacityInputBorderValid=.4;var opacityInputBorderInvalid=exports.opacityInputBorderInvalid=.25},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.importCssVariables=exports.flags=exports.icons=exports.opacities=exports.layout=exports.colors=exports.animations=undefined;var _animations=__webpack_require__(31);Object.defineProperty(exports,"animations",{enumerable:true,get:function get(){return _interopRequireDefault(_animations).default}});var _layout=__webpack_require__(32);Object.defineProperty(exports,"layout",{enumerable:true,get:function get(){return _interopRequireDefault(_layout).default}});var _icons=__webpack_require__(33);Object.defineProperty(exports,"icons",{enumerable:true,get:function get(){return _interopRequireDefault(_icons).default}});var _flags=__webpack_require__(34);Object.defineProperty(exports,"flags",{enumerable:true,get:function get(){return _interopRequireDefault(_flags).default}});var _importCssVariables=__webpack_require__(36);Object.defineProperty(exports,"importCssVariables",{enumerable:true,get:function get(){return _interopRequireDefault(_importCssVariables).default}});var _colors=__webpack_require__(45);var colors=_interopRequireWildcard(_colors);var _opacities=__webpack_require__(10);var opacities=_interopRequireWildcard(_opacities);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.colors=colors;exports.opacities=opacities},,,,,,,,,,,,,,,,,,,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={transitionTimeFast:100,transitionTimeBase:200,transitionTimeSlow:400,transitionFunction:[.25,.46,.45,.94]}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={layoutWidthTiny:"23rem",layoutWidthSmall:"48rem",layoutWidthMedium:"62rem",layoutWidthLarge:"75rem",zIndexSticky:1,zIndexPlatformMask:2,zIndexPlatformConsole:3,zIndexPlatformDock:4,zIndexPosition:5,zIndexModal:5,zIndexNotifications:6}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={annotate:{body:'<path d="M9.364 12.293c.354.354-.354 1.06-.707.707l-2.475-2.475L3 13l2.475-3.182L3 7.343c-.354-.353.354-1.06.707-.707C5.121 8.05 10.071 4.515 8.657 3.1c-.354-.354.353-1.061.707-.707l1.768 1.767.707.707 1.768 1.768c.353.354-.354 1.06-.707.707-1.415-1.414-4.95 3.536-3.536 4.95z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},"analytics-alert":{body:'<path fill-rule="evenodd" d="M14 8A6 6 0 1 1 2 8a6 6 0 0 1 12 0zm-5 3a1 1 0 1 0-2.002 0A1 1 0 0 0 9 11zM7 4l.3 5h1.4L9 4H7z"/>',height:"16",viewBox:"0 0 16 16",width:"16"},"arrow-down":{body:'<path d="M6.999 2v8.158L4.464 7.621 3.05 9.035l4.242 4.243.707.707 4.95-4.949v-.002l-1.414-1.413-2.536 2.537V2z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},"arrow-down-left":{body:'<path fill="currentColor" d="M11.53 3.048L5.76 8.817l.002-3.587h-2v7h7v-2H7.176l5.768-5.768z" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},"arrow-down-right":{body:'<path fill="currentColor" d="M3.055 4.463l5.769 5.769-3.587-.002v2h7v-7h-2l.001 3.587L4.469 3.05z" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},"arrow-up":{body:'<path d="M9 14V5.842l2.535 2.537 1.414-1.414-4.242-4.243L8 2.015 3.05 6.964v.002l1.414 1.413L7 5.842V14z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},"arrow-up-left":{body:'<path fill="currentColor" d="M12.945 11.537L7.176 5.768l3.587.002v-2h-7v7h2l-.001-3.587 5.769 5.768z" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},"arrow-up-right":{body:'<path fill="currentColor" d="M4.475 12.94l5.769-5.77-.001 3.587h2v-7h-7l-.001.001v2l3.588-.001-5.769 5.768z" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},at:{body:'<path fill-rule="evenodd" d="M7.988 6A1.99 1.99 0 0 0 6 7.989C6 8.956 6.747 10 7.955 10c1.034 0 1.247-.225 1.3-.639.05-.414.212-2.085.305-2.926C9.204 6.239 8.634 6 7.988 6M8 15c-3.86 0-7-3.141-7-7s3.14-7 7-7 7 2.915 7 6.499c0 1.882-.73 3.353-2 4.035-.934.5-2.003.484-2.79-.039a2.308 2.308 0 0 1-.28-.217c-.443.285-1.07.472-1.975.472-2.043 0-3.705-1.688-3.705-3.761A3.743 3.743 0 0 1 7.988 4.25c1.717 0 3.007 1.025 3.062 1.069l.382.309s-.36 3.274-.432 3.87c-.073.596.766.713 1.171.494.685-.368 1.08-1.276 1.08-2.493 0-2.618-2.357-4.749-5.25-4.749A5.256 5.256 0 0 0 2.75 8 5.256 5.256 0 0 0 8 13.25a4.765 4.765 0 0 0 2.786-.867l1.004 1.433A6.476 6.476 0 0 1 8.001 15"/>',height:"16",viewBox:"0 0 16 16",width:"16"},"bar-chart":{body:'<path d="M6.5 2h3v11h-3V2zM11 5h3v8h-3V5zM2 7h3v6H2V7z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},benchmark:{body:'<path d="M9.5 12.5a2.988 2.988 0 0 1-2.604-1.54 4.471 4.471 0 0 0 4.064-4.064A2.988 2.988 0 0 1 12.5 9.5c0 1.654-1.346 3-3 3m0-6c0 1.654-1.346 3-3 3 0-1.654 1.346-3 3-3m-6 0c0-1.654 1.346-3 3-3 1.122 0 2.09.626 2.604 1.54A4.471 4.471 0 0 0 5.04 9.104 2.988 2.988 0 0 1 3.5 6.5m7.29-1.29C10.232 3.358 8.534 2 6.5 2A4.5 4.5 0 0 0 2 6.5c0 2.034 1.358 3.732 3.21 4.29C5.768 12.642 7.466 14 9.5 14A4.5 4.5 0 0 0 14 9.5c0-2.034-1.358-3.732-3.21-4.29" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},"box-collapse":{body:'<path d="M7 12.5V15h2v-2.5h3l-4-4-4 4h3zm2-9V1H7v2.5H4l4 4 4-4H9z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},"box-expand":{body:'<path d="M9 11V5h3L8 1 4 5h3v6H4l4 4 4-4H9z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},"chevron-down":{body:'<path d="M4 5L2.5 6.5 8 12l5.5-5.5L12 5 8 9z" fill-rule="nonzero" fill="currentColor"/>',height:"16",viewBox:"0 0 16 16",width:"16"},"chevron-left":{body:'<path d="M11 4L9.5 2.5 4 8l5.5 5.5L11 12 7 8z" fill-rule="nonzero" fill="currentColor"/>',height:"16",viewBox:"0 0 16 16",width:"16"},"chevron-right":{body:'<path d="M5 12l1.5 1.5L12 8 6.5 2.5 5 4l4 4z" fill-rule="nonzero" fill="currentColor"/>',height:"16",viewBox:"0 0 16 16",width:"16"},"chevron-up":{body:'<path d="M12 11l1.5-1.5L8 4 2.5 9.5 4 11l4-4z" fill-rule="nonzero" fill="currentColor"/>',height:"16",viewBox:"0 0 16 16",width:"16"},clock:{body:'<path d="M8 1a7 7 0 1 1 0 14A7 7 0 0 1 8 1zm0 1.75A5.256 5.256 0 0 0 2.75 8 5.256 5.256 0 0 0 8 13.25 5.256 5.256 0 0 0 13.25 8 5.256 5.256 0 0 0 8 2.75zm1.086 7.75L7 8.414V5.25a1 1 0 0 1 2 0v2.336l1.5 1.5A.999.999 0 1 1 9.086 10.5z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},"cloud-upload":{body:'<path d="M12.967 7.174C12.797 4.844 10.873 3 8.5 3 6.535 3 4.882 4.268 4.268 6.024A3.489 3.489 0 0 0 1 9.5 3.5 3.5 0 0 0 4.5 13H7v-3H5l3-4 3 4H9v3h3.5l.5-.183A2.993 2.993 0 0 0 15 10a2.99 2.99 0 0 0-2.033-2.826" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},cross:{body:'<g fill-rule="nonzero" stroke="currentColor" stroke-width="2.1" fill="none"><path d="M3.75 12.25l8.5-8.5" class="ax-animicon__path-1"/><path d="M3.75 3.75l8.5 8.5" class="ax-animicon__path-2"/></g>',height:"16",viewBox:"0 0 16 16",width:"16"},customise:{body:'<path d="M12.258 5.313a.49.49 0 0 0 .495-.122l1.56-1.56c.09.287.152.587.152.904a3 3 0 0 1-3 3c-.316 0-.615-.064-.902-.155L7.36 10.585c.079.267.133.545.133.838 0 1.659-1.341 3-3 3-.316 0-.615-.062-.901-.152l1.566-1.567a.495.495 0 0 0 .125-.48l-.256-.928a.494.494 0 0 0-.327-.336l-.998-.314a.488.488 0 0 0-.496.121l-1.558 1.56a2.964 2.964 0 0 1-.155-.903 3 3 0 0 1 3-3c.34 0 .662.07.966.173l3.16-3.16a3 3 0 0 1-.152-.902 3 3 0 0 1 3-3c.316 0 .616.062.902.153l-1.566 1.567a.49.49 0 0 0-.127.48l.258.927A.494.494 0 0 0 11.26 5l.998.313z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},data:{body:'<g fill="currentColor" fill-rule="evenodd"><circle cx="8" cy="8" r="1.714"/><circle cx="3.714" cy="8" r="1.714"/><circle cx="12.286" cy="8" r="1.714"/><circle cx="8" cy="12.286" r="1.714"/><circle cx="3.714" cy="12.286" r="1.714"/><circle cx="12.286" cy="12.286" r="1.714"/><circle cx="8" cy="3.714" r="1.714"/><circle cx="3.714" cy="3.714" r="1.714"/><circle cx="12.286" cy="3.714" r="1.714"/></g>',height:"16",viewBox:"0 0 16 16",width:"16"},deck:{body:'<path d="M2 3h8v6H2V3zm2 7h7v1H4v-1zm2 2h7v1H6v-1zm6-7v6h-1V5h1zm2 2v6h-1V7h1z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},dot:{body:'<circle cx="8" cy="8" r="6" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},"dot-outline":{body:'<path d="M8 14A6 6 0 1 1 8 2a6 6 0 0 1 0 12zm0-.5a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},"double-chevron-left":{body:'<path d="M8 4.5L4.5 8 8 11.5 6.5 13l-5-5 5-5L8 4.5zm5 0L9.5 8l3.5 3.5-1.5 1.5-5-5 5-5L13 4.5z" fill-rule="nonzero" fill="currentColor"/>',height:"16",viewBox:"0 0 16 16",width:"16"},"double-chevron-right":{body:'<path d="M3 11.5L6.5 8 3 4.5 4.5 3l5 5-5 5L3 11.5zm5 0L11.5 8 8 4.5 9.5 3l5 5-5 5L8 11.5z" fill-rule="nonzero" fill="currentColor"/>',height:"16",viewBox:"0 0 16 16",width:"16"},duplicate:{body:'<path d="M2 5v9h9v-2H4V5H2zm3 6h9V2H5v9zm2-5h2V4h1v2h2v1h-2v2H9V7H7V6z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},ellipsis:{body:'<path d="M8 10a2 2 0 1 1 0-4 2 2 0 0 1 0 4zm-5 0a2 2 0 1 1 0-4 2 2 0 0 1 0 4zm10 0a2 2 0 1 1 0-4 2 2 0 0 1 0 4z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},email:{body:'<path d="M7.63 8.13L2.15 3.145A.492.492 0 0 1 2.5 3h11a.5.5 0 0 1 .35.145L8.355 8.147a.502.502 0 0 1-.724-.017zm1.414.74L14 4.361v8.14a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5V4.36l4.94 4.492a1.5 1.5 0 0 0 1.066.441c.379 0 .756-.142 1.038-.424z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},exclude:{body:'<path fill-rule="evenodd" d="M8 13a4.949 4.949 0 0 1-2.496-.691l6.805-6.804C12.736 6.241 13 7.087 13 8a5 5 0 0 1-5 5M3 8a5 5 0 0 1 5-5c.937 0 1.805.274 2.555.724l-6.832 6.831A4.944 4.944 0 0 1 3 8m5-7a7 7 0 1 0 0 14A7 7 0 0 0 8 1"/>',height:"16",viewBox:"0 0 16 16",width:"16"},facebook:{body:'<g fill-rule="nonzero" fill="none"><path d="M15.111 0H.89A.889.889 0 0 0 0 .889V15.11c0 .491.398.889.889.889h7.658V9.813H6.469V7.391h2.078V5.613c0-2.066 1.262-3.193 3.11-3.193.623-.002 1.244.03 1.863.096v2.15h-1.276c-1.002 0-1.197.478-1.197 1.178v1.543h2.397l-.31 2.422h-2.087V16h4.064c.491 0 .889-.398.889-.889V.89A.889.889 0 0 0 15.111 0z" fill="#4267B2"/><path d="M11.047 16V9.813h2.086l.311-2.422h-2.397V5.85c0-.7.195-1.178 1.197-1.178h1.272v-2.16a17.213 17.213 0 0 0-1.863-.095c-1.844 0-3.11 1.126-3.11 3.193v1.778H6.468v2.422h2.078V16h2.5z" fill="#FFF"/></g>',height:"16",viewBox:"0 0 16 16",width:"16"},filter:{body:'<path fill="currentColor" d="M3 3h10L9.5 8.001v5.002h-3V8.001z" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},"flip-horizontal":{body:'<path d="M6.5 8.5l-5 4.041V4.46l5 4.041zm3 0l5-4.041v8.082L9.5 8.5zM7.5 2h1v12h-1V2z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},"flip-vertical":{body:'<path d="M7.5 6.5l-4.041-5h8.082L7.5 6.5zm0 3l4.041 5H3.46l4.041-5zm6.5-2v1H2v-1h12z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},folder:{body:'<path d="M12.465 13H2.78L4.186 7.38A.5.5 0 0 1 4.671 7h8.654a.5.5 0 0 1 .485.622L12.465 13zm-9.18-6.14L2 12V4c0-.276.226-.5.498-.5h3.003c.276 0 .621.184.777.418L7 5h4.504c.274 0 .496.223.496.5V6H4.386c-.657 0-.928.167-1.101.86z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},"folder-closed":{body:'<path d="M13.5 12V5.5c0-.277-.222-.5-.496-.5H7.5l-.721-1.082a1.037 1.037 0 0 0-.777-.418H2.998A.501.501 0 0 0 2.5 4v8h11z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},followers:{body:'<path d="M7.25 5.25a2.25 2.25 0 1 1-4.502-.002 2.25 2.25 0 0 1 4.502.002zM11 7.5a2.25 2.25 0 1 1 .002-4.502A2.25 2.25 0 0 1 11 7.5zm0 1c2.209 0 4 2.015 4 4.5h-5a5.784 5.784 0 0 0-1.294-3.679C9.356 8.808 10.145 8.5 11 8.5zm-6 0c2.209 0 4 2.015 4 4.5H1c0-2.485 1.791-4.5 4-4.5z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},"form-resize":{body:'<path d="M9.707 13.707a1 1 0 1 1-1.414-1.414l4-4a1 1 0 0 1 1.414 1.414l-4 4zm2.586-11.414a1 1 0 0 1 1.414 1.414l-10 10a1 1 0 1 1-1.414-1.414l10-10z" fill="currentColor" fill-rule="nonzero"/>',height:"16",viewBox:"0 0 16 16",width:"16"},"format-bold":{body:'<path d="M4 13V3h3.77c1.307 0 2.298.232 2.973.697.675.465 1.013 1.146 1.013 2.043 0 .49-.136.922-.407 1.295-.27.373-.648.647-1.13.82.551.129.986.388 1.304.777.318.39.477.865.477 1.428 0 .962-.33 1.69-.99 2.185-.661.494-1.603.746-2.825.755H4zm2.218-4.354v2.699h1.9c.523 0 .93-.116 1.224-.347.293-.231.44-.55.44-.958 0-.916-.51-1.38-1.53-1.394H6.217zm0-1.456H7.86c1.118-.019 1.678-.433 1.678-1.244 0-.453-.142-.78-.425-.978-.284-.2-.731-.299-1.342-.299H6.218v2.52z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},"format-italic":{body:'<path d="M6.304 11.493L7.685 4.5H6.363V3h5v1.5H9.71l-1.38 6.993h1.314v1.5H8.033L8.03 13H6.006l.002-.007H4.644v-1.5h1.66z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},"format-title":{body:'<path d="M6.402 10.94H2.84L2.16 13H0L3.672 3h1.884l3.692 10H7.087l-.685-2.06zM3.388 9.186l1.226-3.693 1.24 3.693H3.388zm10.491 3.678a2.174 2.174 0 0 1-.196-.657c-.475.529-1.091.793-1.85.793-.718 0-1.313-.208-1.785-.623a2.005 2.005 0 0 1-.708-1.572c0-.777.288-1.373.864-1.789.576-.415 1.408-.625 2.496-.63h.901v-.42c0-.339-.087-.61-.26-.813-.174-.203-.449-.305-.824-.305-.33 0-.588.08-.775.237-.188.158-.281.375-.281.65H9.503c0-.424.13-.817.392-1.178s.633-.645 1.112-.85a4.05 4.05 0 0 1 1.612-.309c.903 0 1.62.227 2.151.681.53.454.796 1.092.796 1.914v3.178c.005.695.102 1.222.292 1.578v.115h-1.979zm-1.619-1.361c.289 0 .556-.065.8-.193.243-.13.424-.302.541-.519v-1.26h-.731c-.98 0-1.502.339-1.565 1.016l-.007.116c0 .244.086.444.257.603.172.158.407.237.705.237z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},"format-underline":{body:'<path d="M12 3v6.497c0 1.08-.357 1.933-1.072 2.561-.714.628-1.69.942-2.928.942-1.219 0-2.186-.305-2.903-.915-.717-.61-1.083-1.447-1.097-2.513V3h2.15v6.51c0 .647.164 1.118.492 1.413.327.296.78.444 1.358.444 1.21 0 1.823-.6 1.842-1.802V3H12zM4 14.5h8V16H4v-1.5z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},grid:{body:'<path d="M3 3h4v4H3V3zm6 0h4v4H9V3zM3 9h4v4H3V9zm6 0h4v4H9V9z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},growth:{body:'<path fill="currentColor" d="M8.749 3.5l2.001 2L8.25 8l-2-2-5 5L3 12.75 6.25 9.5l2 2 4.249-4.251 2 2.001V3.5z" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},hamburger:{body:'<path d="M3 3h10v2H3V3zm0 4h10v2H3V7zm0 4h10v2H3v-2z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},heart:{body:'<path d="M10.802 3c-1.172 0-2.271.989-2.8 1.547C7.473 3.989 6.374 3 5.202 3 3.199 3 2 4.253 2 6.351 2 8.07 3.474 9.51 3.528 9.56c0 0 4.367 4.44 4.474 4.44.108 0 4.468-4.426 4.468-4.426.061-.064 1.534-1.504 1.534-3.223C14.004 4.253 12.805 3 10.802 3" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},home:{body:'<path fill-rule="evenodd" d="M9.504 14.003h2A1 1 0 0 0 12.5 13V8.002h.497c.546 0 .683-.318.29-.712l-4.57-4.577a1.008 1.008 0 0 0-1.422 0L2.725 7.29c-.389.39-.263.712.29.712h.497V13a.993.993 0 0 0 .996 1.003h2v-2.996a1.498 1.498 0 1 1 2.996 0v2.996z"/>',height:"16",viewBox:"0 0 16 16",width:"16"},information:{body:'<path d="M10.5 14h-5v-1.25h1.25V7H5.5V5.75h3.75v7h1.25V14zM9.375 3c0 .759-.617 1.375-1.375 1.375A1.376 1.376 0 0 1 6.625 3c0-.758.617-1.375 1.375-1.375S9.375 2.242 9.375 3z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},"information-circle":{body:'<path d="M15 8A7 7 0 1 0 1 8a7 7 0 0 0 14 0m1 0A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM6.2 6.8v.72h.9v3.58h-.9v.9h3.6v-.9h-.9V6.8H6.2zm2.7-1.775a.876.876 0 1 0-1.751.001.876.876 0 0 0 1.751-.001z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},installation:{body:'<path d="M1 3h6v4H1V3zm0 6h6v4H1V9zm8-6h6v4H9V3zm0 6h6v4H9V9z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},instagram:{body:'<defs><path d="M8 0C5.827 0 5.555.01 4.702.048 3.85.087 3.269.222 2.76.42a3.921 3.921 0 0 0-1.417.923c-.445.444-.719.89-.923 1.417-.198.509-.333 1.09-.372 1.942C.01 5.555 0 5.827 0 8s.01 2.445.048 3.298c.039.852.174 1.433.372 1.942.204.526.478.973.923 1.417.444.445.89.719 1.417.923.509.198 1.09.333 1.942.372C5.555 15.99 5.827 16 8 16s2.445-.01 3.298-.048c.852-.039 1.433-.174 1.942-.372a3.922 3.922 0 0 0 1.417-.923c.445-.444.719-.89.923-1.417.198-.509.333-1.09.372-1.942C15.99 10.445 16 10.173 16 8s-.01-2.445-.048-3.298c-.039-.852-.174-1.433-.372-1.942a3.922 3.922 0 0 0-.923-1.417A3.921 3.921 0 0 0 13.24.42c-.509-.198-1.09-.333-1.942-.372C10.445.01 10.173 0 8 0zm0 1.441c2.136 0 2.39.009 3.233.047.78.036 1.203.166 1.485.276.374.145.64.318.92.598.28.28.453.546.598.92.11.282.24.705.276 1.485.038.844.047 1.097.047 3.233s-.009 2.39-.047 3.233c-.036.78-.166 1.203-.276 1.485-.145.374-.318.64-.598.92-.28.28-.546.453-.92.598-.282.11-.705.24-1.485.276-.844.038-1.097.047-3.233.047s-2.39-.009-3.233-.047c-.78-.036-1.203-.166-1.485-.276a2.478 2.478 0 0 1-.92-.598 2.479 2.479 0 0 1-.598-.92c-.11-.282-.24-.705-.276-1.485-.038-.844-.047-1.097-.047-3.233s.009-2.39.047-3.233c.036-.78.166-1.203.276-1.485.145-.374.318-.64.598-.92.28-.28.546-.453.92-.598.282-.11.705-.24 1.485-.276.844-.038 1.097-.047 3.233-.047zm.061 9.308a2.687 2.687 0 1 1 0-5.375 2.687 2.687 0 0 1 0 5.375zm0-6.827a4.14 4.14 0 1 0 0 8.28 4.14 4.14 0 0 0 0-8.28zm5.271-.164a.967.967 0 1 1-1.935 0 .967.967 0 0 1 1.935 0" id="a"/><radialGradient cx="25.156%" cy="100%" fx="25.156%" fy="100%" r="131.971%" gradientTransform="rotate(-41.063 .338 .968) scale(1 .93552)" id="c"><stop stop-color="#FED170" offset="0%"/><stop stop-color="#F9A562" offset="13.295%"/><stop stop-color="#F05048" offset="38.227%"/><stop stop-color="#CE2F88" offset="73.423%"/><stop stop-color="#AC32AE" offset="100%"/></radialGradient><radialGradient cx="4.816%" cy="0%" fx="4.816%" fy="0%" r="158.037%" gradientTransform="matrix(.97886 .20453 -.08519 .4077 .001 -.01)" id="e"><stop stop-color="#4056BA" offset="0%"/><stop stop-color="#7040BA" stop-opacity=".892" offset="22.898%"/><stop stop-color="#7040BA" stop-opacity=".479" offset="46.167%"/><stop stop-color="#E4644A" stop-opacity="0" offset="100%"/></radialGradient><path id="d" d="M0 0h16v16H0z"/></defs><g fill="none" fill-rule="evenodd"><mask id="b" fill="#fff"><use xlink:href="#a"/></mask><use fill="#0A0B09" xlink:href="#a"/><g mask="url(#b)"><use fill="url(#c)" xlink:href="#d"/><use fill="url(#e)" xlink:href="#d"/></g></g>',height:"16",viewBox:"0 0 16 16",width:"16"},integrations:{body:'<path d="M11.5 9.868a1 1 0 0 1 1-.998c.26 0 .492.106.67.268.222.238.51.362.83.362.69 0 1.25-.671 1.25-1.5 0-.828-.56-1.5-1.25-1.5-.32 0-.608.127-.83.365a.993.993 0 0 1-.67.268 1 1 0 0 1-1-1V3H2v3.133a1 1 0 0 0 1 1c.26 0 .492-.084.67-.247.221-.237.51-.386.83-.386.69 0 1.25.672 1.25 1.5 0 .829-.56 1.5-1.25 1.5-.32 0-.609-.148-.83-.385-.178-.163.09-.245-.17-.245-.551 0-1.499.447-1.5.998V13h9.5V9.868z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},iris:{body:'<path d="M2.06 0A1.67 1.67 0 0 0 .377 1.681a1.67 1.67 0 0 0 1.68 1.68 1.681 1.681 0 0 0 1.682-1.68 1.681 1.681 0 0 0-1.68-1.68zm13.273 0a1.681 1.681 0 0 0-1.712 1.681 1.681 1.681 0 0 0 1.712 1.68 1.67 1.67 0 0 0 1.68-1.68 1.67 1.67 0 0 0-1.68-1.68zM.563 4.828V16h2.993V4.828zm10.434 0a2.726 2.726 0 0 0-2.42 1.506l-.081-1.3H5.698V16H8.66V8.825a2.163 2.163 0 0 1 2.182-1.127 7.329 7.329 0 0 1 1.025.082l.072-2.82a3.075 3.075 0 0 0-.91-.132 2.726 2.726 0 0 0-.033 0zm2.84 0V16h2.992V4.828zm8.895.071a4.787 4.787 0 0 0-2.665.954A2.942 2.942 0 0 0 18.89 8.23c0 1.63 1.27 2.706 3.81 3.25a5.607 5.607 0 0 1 1.673.542.912.912 0 0 1 .523.82 1.025 1.025 0 0 1-.482.8 2.132 2.132 0 0 1-1.24.307 2.245 2.245 0 0 1-1.415-.41 1.527 1.527 0 0 1-.564-1.158H18.49a3.075 3.075 0 0 0 .595 1.804 4.028 4.028 0 0 0 1.64 1.322 5.791 5.791 0 0 0 2.388.482 5.381 5.381 0 0 0 3.24-.913 2.788 2.788 0 0 0 1.26-2.367 2.962 2.962 0 0 0-2.265-2.88 11.962 11.962 0 0 0-1.804-.472 4.664 4.664 0 0 1-1.517-.512.871.871 0 0 1-.451-.759 1.025 1.025 0 0 1 .41-.84 1.66 1.66 0 0 1 1.117-.318 1.66 1.66 0 0 1 1.23.4 1.353 1.353 0 0 1 .41 1.025h2.88a3.075 3.075 0 0 0-1.22-2.49 5.125 5.125 0 0 0-3.26-.965 4.787 4.787 0 0 0-.41 0z"/>',height:"16",viewBox:"0 0 28 16",width:"28"},kred:{body:'<path d="M12.893 3.948l-8.146 6.448L3 9V4.5A1.5 1.5 0 0 1 4.5 3h7a1.5 1.5 0 0 1 1.393.948zm-7.346 7.09L13 5.138V8.04a2 2 0 0 1-.751 1.562l-4.25 3.4-2.452-1.963z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},"line-graph":{body:'<path fill-rule="evenodd" d="M12.533 9.055A2.003 2.003 0 0 1 15 11a2 2 0 1 1-3.687-1.073L8.468 5.945a2.003 2.003 0 0 1-1.248-.103L4.842 8.219a2 2 0 1 1-1.06-1.061l2.377-2.377a2 2 0 1 1 3.53.292l2.844 3.982z"/>',height:"16",viewBox:"0 0 16 16",width:"16"},list:{body:'<path d="M3 3h2v2H3V3zm4 0h6v2H7V3zM3 7h2v2H3V7zm4 0h6v2H7V7zm-4 4h2v2H3v-2zm4 0h6v2H7v-2z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},location:{body:'<path d="M8 14c-.037 0-4.5-4.5-4.5-7.5a4.5 4.5 0 0 1 9 0c0 3-4.463 7.5-4.5 7.5zm0-6a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},lock:{body:'<style>.st0{enable-background:new}</style><path class="st0" d="M11 6V5c0-1.7-1.3-3-3-3S5 3.3 5 5v1H3.5v7h9V6H11zM6.5 5c0-.8.7-1.5 1.5-1.5s1.5.7 1.5 1.5v1h-3V5z"/>',viewBox:"0 0 16 16"},log:{body:'<path d="M2 1h12a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zm2 3v2h8V4H4zm0 3v2h8V7H4zm0 3v2h5v-2H4z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},"magnify-glass":{body:'<path d="M4 7a3 3 0 1 1 6 0 3 3 0 0 1-6 0zm10 5.586l-2.832-2.832C11.692 8.964 12 8.019 12 7a5 5 0 1 0-5 5 4.964 4.964 0 0 0 2.754-.832L12.586 14 14 12.586z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},minus:{body:'<path d="M3 7h10v2H3z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},monitor:{body:'<path d="M12.25 10.137a.114.114 0 0 1-.113.113H3.863a.114.114 0 0 1-.113-.113V4.863c0-.062.051-.113.113-.113h8.274c.062 0 .113.05.113.113v5.274zM12.137 3H3.863A1.863 1.863 0 0 0 2 4.863v5.274C2 11.166 2.834 12 3.863 12H6v1h4v-1h2.137A1.863 1.863 0 0 0 14 10.137V4.863A1.863 1.863 0 0 0 12.137 3z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},moon:{body:'<path d="M7.3 3.049a5.001 5.001 0 1 0 5.651 5.65A4 4 0 1 1 7.3 3.049z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},open:{body:'<path fill-rule="evenodd" d="M9.25 2H14v4.75h-1.5V4.5l-5 5-1-1 2.25-2.25L11.5 3.5H9.25V2zm.748 7.001l1.367-1.365c.088.406.134.864.134 1.399v.43c0 1.072-.184 1.837-.534 2.489a3.637 3.637 0 0 1-1.511 1.512c-.652.348-1.418.534-2.49.534h-.429c-1.072 0-1.837-.186-2.489-.534a3.637 3.637 0 0 1-1.512-1.512C2.187 11.302 2 10.537 2 9.465v-.43c0-1.072.186-1.837.534-2.489a3.637 3.637 0 0 1 1.513-1.512c.652-.348 1.417-.534 2.489-.534h.429c.535 0 .992.046 1.4.136L7.25 5.75l-.252.251L6.965 6h-.429c-.8 0-1.335.118-1.782.357-.39.208-.688.506-.897.897-.237.446-.357.98-.357 1.781v.43c0 .801.12 1.335.357 1.781.21.391.508.689.897.897.447.239.981.357 1.782.357h.43c.8 0 1.335-.118 1.781-.357.39-.208.688-.506.897-.897.239-.446.356-.98.356-1.781v-.43-.034z"/>',height:"16",viewBox:"0 0 16 16",width:"16"},pencil:{body:'<path d="M13.352 3.415a.997.997 0 0 1-.001 1.414l-.707.707-2.121-2.122.707-.707a.997.997 0 0 1 1.413-.001l.709.709zM4.158 9.778l6.01-6.01L12.29 5.89 6.28 11.9 4.157 9.78zm-1.767 3.89l1.06-3.183 2.122 2.121-3.182 1.061z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},pinterest:{body:'<g fill="none" fill-rule="evenodd"><path d="M8 .001A8 8 0 0 0 5.083 15.45c-.07-.633-.133-1.604.028-2.295.145-.624.938-3.976.938-3.976s-.24-.48-.24-1.188c0-1.112.645-1.943 1.448-1.943.683 0 1.012.513 1.012 1.127 0 .686-.437 1.713-.662 2.664-.189.796.4 1.445 1.184 1.445 1.422 0 2.515-1.5 2.515-3.663 0-1.915-1.376-3.255-3.341-3.255-2.276 0-3.612 1.708-3.612 3.472 0 .687.264 1.425.595 1.826a.24.24 0 0 1 .055.229c-.06.253-.195.796-.222.907-.035.147-.116.178-.267.107-1-.465-1.624-1.926-1.624-3.099 0-2.523 1.833-4.84 5.286-4.84 2.774 0 4.931 1.977 4.931 4.62 0 2.756-1.738 4.975-4.151 4.975-.81 0-1.573-.421-1.833-.918 0 0-.402 1.527-.499 1.901-.18.695-.668 1.566-.994 2.097A8 8 0 1 0 8 .001" fill="#A8242F"/><path d="M5.084 15.45c-.07-.633-.133-1.604.028-2.295.145-.624.938-3.976.938-3.976s-.24-.48-.24-1.188c0-1.112.645-1.943 1.448-1.943.683 0 1.012.513 1.012 1.127 0 .686-.437 1.713-.662 2.664-.189.796.4 1.445 1.184 1.445 1.422 0 2.515-1.5 2.515-3.663 0-1.915-1.376-3.255-3.341-3.255-2.276 0-3.612 1.708-3.612 3.472 0 .687.264 1.425.595 1.826a.24.24 0 0 1 .055.229c-.06.253-.195.796-.222.907-.035.147-.116.178-.267.107-1-.465-1.624-1.926-1.624-3.099 0-2.523 1.833-4.84 5.286-4.84 2.774 0 4.931 1.977 4.931 4.62 0 2.756-1.738 4.975-4.151 4.975-.81 0-1.573-.421-1.833-.918 0 0-.402 1.527-.499 1.901-.18.695-.668 1.566-.994 2.097a2.562 2.562 0 0 1-.547-.193z" fill="#FFF"/></g>',height:"16",viewBox:"0 0 16 16",width:"16"},plugin:{body:'<path d="M12.267 5.151L10.499 6.92l-.78-.78-.634-.634 1.768-1.768a1 1 0 0 0-1.415-1.414L7.671 4.09l-.707-.707-2.475 2.475.035.036a3.98 3.98 0 0 0-.289 4.46L1.66 12.93l1.414 1.414 2.575-2.575a3.98 3.98 0 0 0 4.461-.289l.035.036L12.62 9.04l-.707-.707 1.768-1.768a.999.999 0 1 0-1.414-1.414z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},plus:{body:'<path d="M9 7V3H7v4H3v2h4v4h2V9h4V7z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},preview:{body:'<path d="M9.5 8a1.5 1.5 0 1 1-3.001-.001A1.5 1.5 0 0 1 9.5 8M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6m0-7.5C4.134 3.5 1 8 1 8s3.134 4.5 7 4.5S15 8 15 8s-3.134-4.5-7-4.5" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},"question-mark":{body:'<path d="M6.625 13c0-.759.617-1.375 1.375-1.375s1.375.616 1.375 1.375c0 .758-.617 1.375-1.375 1.375A1.377 1.377 0 0 1 6.625 13zM9 10.25H7v-.188c0-.62.221-1.21.616-1.753.281-.387.615-.701.91-.978l.095-.09c.627-.593.982-.963.976-1.682C9.597 4.674 8.88 4 8 4s-1.597.674-1.597 1.555V6H4.445v-.445A3.56 3.56 0 0 1 8 2a3.565 3.565 0 0 1 3.555 3.553c.009 1.6-1.03 2.583-1.587 3.111l-.078.073c-.275.259-.534.503-.695.723a.91.91 0 0 0-.195.602v.188z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},"question-mark-circle":{body:'<path d="M15 8A7 7 0 1 0 1 8a7 7 0 0 0 14 0m1 0A8 8 0 1 1 0 8a8 8 0 0 1 16 0M5.778 6.362v.278h1.224v-.278c0-.551.448-.972.998-.972s.998.421.998.974c.004.45-.218.681-.61 1.052l-.059.056a4.337 4.337 0 0 0-.569.611c-.247.339-.385.708-.385 1.096V9.2h1.25v-.021c0-.139.024-.241.122-.377.1-.137.262-.289.434-.451l.049-.046c.348-.33.997-.944.992-1.944A2.228 2.228 0 0 0 8 4.14a2.225 2.225 0 0 0-2.222 2.222zM8.9 11.025a.876.876 0 1 1-1.751-.001.876.876 0 0 1 1.751.001" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},reddit:{body:'<g fill="none" fill-rule="evenodd"><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0" fill="#FF4500"/><path d="M13.286 7.958a1.167 1.167 0 0 0-1.975-.839c-.798-.575-1.897-.947-3.12-.99l.531-2.5 1.736.369a.831.831 0 0 0 1.663-.04.83.83 0 1 0-1.577-.368l-1.94-.412a.208.208 0 0 0-.247.16l-.593 2.79c-1.242.035-2.358.407-3.166.989a1.167 1.167 0 1 0-1.284 1.905 2.298 2.298 0 0 0-.028.353c0 1.795 2.09 3.25 4.667 3.25s4.667-1.455 4.667-3.25c0-.118-.01-.235-.028-.35.409-.182.694-.59.694-1.067z" fill="#FFF"/><path d="M9.934 10.994c-.568.568-1.658.612-1.979.612-.32 0-1.41-.044-1.978-.612a.216.216 0 0 1 .305-.306c.359.359 1.126.486 1.673.486.548 0 1.315-.127 1.674-.486a.216.216 0 0 1 .305.306zm-.146-1.369a.834.834 0 0 1 0-1.667.834.834 0 0 1 0 1.667zm-4.5-.833a.834.834 0 0 1 1.666 0 .834.834 0 0 1-1.666 0z" fill="#FF4500"/></g>',height:"16",viewBox:"0 0 16 16",width:"16"},refresh:{body:'<path d="M14 8l-1-5.5-1.288 1.788a5.25 5.25 0 1 0 0 7.424l-1.486-1.486A3.137 3.137 0 0 1 8 11.15 3.153 3.153 0 0 1 4.85 8 3.153 3.153 0 0 1 8 4.85c.868 0 1.656.353 2.226.924L8.5 7 14 8z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},replace:{body:'<path d="M5 11h9V2H5v9zm6-7l1 1-2.5 2.5L11 9H7V5l1.5 1.5L11 4zM2 5h2v7h7v2H2V5z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},reply:{body:'<path d="M7.5 5.5V3L2 7l5.5 4V8.5H10c1.453 0 3.781 1.734 1.141 4.547l.531.547S14 12.281 14 9.75c0-2.531-2-4.25-4-4.25H7.5z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},reports:{body:'<path fill-rule="evenodd" d="M3.5 2h9c.798 0 1.5.705 1.5 1.5v9c0 .8-.7 1.5-1.5 1.5h-9c-.8 0-1.5-.7-1.5-1.5v-9C2 2.697 2.697 2 3.5 2zM4 8v4h2V8H4zm3-4v8h2V4H7zm3 2.5V12h2V6.5h-2z"/>',height:"16",viewBox:"0 0 16 16",width:"16"},retweet:{body:'<path d="M13 7.5h2l-3 4-3-4h2v-2H7.5L6 3.5h7v4zm-8 3h3.5l1.5 2H3v-4H1l3-4 3 4H5v2z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},ring:{body:'<path d="M8 14A6 6 0 1 1 8 2a6 6 0 0 1 0 12zm0-3a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},share:{body:'<path d="M8.04 4.404L5.128 6.347a2 2 0 1 0 0 3.305l2.914 1.943a2 2 0 1 0 .832-1.248L5.959 8.405a2.01 2.01 0 0 0 0-.81l2.914-1.942a2 2 0 1 0-.832-1.248z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},star:{body:'<path d="M8 1.5L6.5 6 2 6.084l3.476 2.869L3.999 13.5 8 10.786l4 2.714-1.476-4.547 3.475-2.869L9.499 6z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},sun:{body:'<path fill-rule="evenodd" d="M12 8a4 4 0 1 1-8 0 4 4 0 0 1 8 0zM7.375 3.5V1h1.25v2.5h-1.25zm-1.084.29l-1.083.625-1.25-2.165 1.083-.625 1.25 2.165zM4.415 5.209L3.79 6.291l-2.165-1.25.625-1.082 2.165 1.25zM1 8.625v-1.25h2.5v1.25H1zm2.79 1.084l.625 1.082-2.165 1.25-.625-1.082 2.165-1.25zm1.418 1.876l1.083.625-1.25 2.165-1.083-.625 1.25-2.165zM7.375 15v-2.5h1.25V15h-1.25zm2.333-2.79l1.083-.625 1.25 2.165-1.083.625-1.25-2.165zm1.876-1.419l.625-1.082 2.165 1.25-.625 1.082-2.165-1.25zm.916-2.166v-1.25H15v1.25h-2.5zm-.29-2.334l-.626-1.082 2.165-1.25.625 1.082-2.165 1.25zM10.79 4.415L9.708 3.79l1.25-2.165 1.083.625-1.25 2.165z"/>',height:"16",viewBox:"0 0 16 16",width:"16"},switch:{body:'<path d="M6.56 12.71V15l-4.45-3.43 4.45-3.43v2.29H14v2.28H6.56zM4.22 5.57H2V3.29h7.44V1l4.45 3.43-4.45 3.43V5.57z"/>',viewBox:"0 0 16 16"},tag:{body:'<path d="M6.5 5.501a.997.997 0 0 1-.999 1 1 1 0 1 1 1-1M3.499 2.5a.997.997 0 0 0-.999 1v4.204c0 .364 0 .762.375 1.137l5.433 5.435c.391.39 1.025.39 1.416 0L12 12l2.275-2.276a1 1 0 0 0 0-1.414L8.842 2.875C8.466 2.5 8.069 2.5 7.703 2.5H3.5z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},tick:{body:'<path d="M3.25 8.25L6 11l6.75-6.75" fill-rule="nonzero" stroke="currentColor" stroke-width="2.1" fill="none"/>',height:"16",viewBox:"0 0 16 16",width:"16"},tools:{body:'<path d="M6 9v.5a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5V9h4.5v2.5A1.5 1.5 0 0 1 13 13H3a1.5 1.5 0 0 1-1.5-1.5V9H6zm8.5-1h-13V5.5C1.5 4.7 2.2 4 3 4h2v-.5C5 2.7 5.7 2 6.5 2h3c.8 0 1.5.7 1.5 1.5V4h2c.8 0 1.5.7 1.5 1.5V8zM6 3v1h4V3H6z"/>',height:"16",viewBox:"0 0 16 16",width:"16"},trash:{body:'<path d="M4 4.5h8l-.447 8.501a1.06 1.06 0 0 1-1.056.999H5.503a1.066 1.066 0 0 1-1.056-.999L4 4.5zM3.5 3h9v1h-9V3zM7 2h2v1H7V2z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},"triangle-down":{body:'<path d="M3 4l5.07 8L13 4z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},"triangle-left":{body:'<path d="M11 3L3 8.07 11 13z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},"triangle-right":{body:'<path d="M5 13l8-5.07L5 3z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},"triangle-up":{body:'<path d="M13 12L7.93 4 3 12z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},twitter:{body:'<path d="M0 13.526a6.586 6.586 0 0 0 4.86-1.36 3.285 3.285 0 0 1-3.067-2.28c.201.04.407.06.618.06.3 0 .693-.04.968-.115C1.878 9.529.85 8.203.85 6.613c0 .204.846.352 1.384.369C1.352 6.394.721 5.389.721 4.25c0-.601.136-1.166.418-1.65a9.29 9.29 0 0 0 6.754 3.429 3.287 3.287 0 0 1-.092-.747 3.28 3.28 0 0 1 5.674-2.246 6.554 6.554 0 0 0 2.084-.797 3.298 3.298 0 0 1-1.444 1.817A6.56 6.56 0 0 0 16 3.538a6.673 6.673 0 0 1-1.638 1.7c.007.14.01.281.01.424C14.371 10 11.07 15 5.031 15A9.301 9.301 0 0 1 0 13.526z" fill="#1DA1F2" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},unlock:{body:'<path d="M6.5 7V4c0-.827.673-1.5 1.5-1.5s1.5.673 1.5 1.5v1H11V4a3 3 0 1 0-6 0v3H3.5v7h9V7h-6z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},warning:{body:'<path d="M6.25 2h3.5l-.5 8.25h-2.5L6.25 2zm.375 11c0-.759.617-1.375 1.375-1.375s1.375.616 1.375 1.375c0 .758-.617 1.375-1.375 1.375A1.377 1.377 0 0 1 6.625 13z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"},"warning-circle":{body:'<path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-1 0A7 7 0 1 0 1 8a7 7 0 0 0 14 0zm-6.1 3.025a.876.876 0 1 1-1.751-.001.876.876 0 0 1 1.751.001zM6.9 4h2.2l-.2 5.2H7.1L6.9 4z" fill="currentColor" fill-rule="evenodd"/>',height:"16",viewBox:"0 0 16 16",width:"16"}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _flags=__webpack_require__(35);var _flags2=_interopRequireDefault(_flags);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_flags2.default},function(module){module.exports={ad:{src:"flags/ad.svg",color:"rgb(48, 77, 140)"},ae:{src:"flags/ae.svg",color:"rgb(201, 58, 58)"},af:{src:"flags/af.svg",color:"rgb(201, 58, 58)"},ag:{src:"flags/ag.svg",color:"rgb(201, 58, 58)"},ai:{src:"flags/ai.svg",color:"rgb(48, 77, 140)"},al:{src:"flags/al.svg",color:"rgb(201, 58, 58)"},am:{src:"flags/am.svg",color:"rgb(201, 58, 58)"},ao:{src:"flags/ao.svg",color:"rgb(201, 58, 58)"},aq:{src:"flags/aq.svg",color:"rgb(59, 121, 204)"},ar:{src:"flags/ar.svg",color:"rgb(48, 77, 140)"},as:{src:"flags/as.svg",color:"rgb(48, 77, 140)"},at:{src:"flags/at.svg",color:"rgb(201, 58, 58)"},au:{src:"flags/au.svg",color:"rgb(48, 77, 140)"},aw:{src:"flags/aw.svg",color:"rgb(201, 58, 58)"},ax:{src:"flags/ax.svg",color:"rgb(48, 77, 140)"},az:{src:"flags/az.svg",color:"rgb(201, 58, 58)"},ba:{src:"flags/ba.svg",color:"rgb(48, 77, 140)"},bb:{src:"flags/bb.svg",color:"rgb(48, 77, 140)"},bd:{src:"flags/bd.svg",color:"rgb(201, 58, 58)"},be:{src:"flags/be.svg",color:"rgb(201, 58, 58)"},bf:{src:"flags/bf.svg",color:"rgb(201, 58, 58)"},bg:{src:"flags/bg.svg",color:"rgb(201, 58, 58)"},bh:{src:"flags/bh.svg",color:"rgb(201, 58, 58)"},bi:{src:"flags/bi.svg",color:"rgb(201, 58, 58)"},bj:{src:"flags/bj.svg",color:"rgb(201, 58, 58)"},bl:{src:"flags/bl.svg",color:"rgb(48, 77, 140)"},bm:{src:"flags/bm.svg",color:"rgb(48, 77, 140)"},bn:{src:"flags/bn.svg",color:"rgb(201, 58, 58)"},bo:{src:"flags/bo.svg",color:"rgb(48, 77, 140)"},bq:{src:"flags/bq.svg",color:"rgb(48, 77, 140)"},br:{src:"flags/br.svg",color:"rgb(48, 77, 140)"},bs:{src:"flags/bs.svg",color:"rgb(36, 173, 189)"},bt:{src:"flags/bt.svg",color:"rgb(201, 58, 58)"},bv:{src:"flags/bv.svg",color:"rgb(48, 77, 140)"},bw:{src:"flags/bw.svg",color:"rgb(36, 173, 189)"},by:{src:"flags/by.svg",color:"rgb(201, 58, 58)"},bz:{src:"flags/bz.svg",color:"rgb(48, 77, 140)"},ca:{src:"flags/ca.svg",color:"rgb(201, 58, 58)"},cc:{src:"flags/cc.svg",color:"rgb(158, 97, 57)"},cd:{src:"flags/cd.svg",color:"rgb(201, 58, 58)"},cf:{src:"flags/cf.svg",color:"rgb(201, 58, 58)"},cg:{src:"flags/cg.svg",color:"rgb(201, 58, 58)"},ch:{src:"flags/ch.svg",color:"rgb(201, 58, 58)"},ci:{src:"flags/ci.svg",color:"rgb(47, 145, 112)"},ck:{src:"flags/ck.svg",color:"rgb(48, 77, 140)"},cl:{src:"flags/cl.svg",color:"rgb(48, 77, 140)"},cm:{src:"flags/cm.svg",color:"rgb(201, 58, 58)"},cn:{src:"flags/cn.svg",color:"rgb(201, 58, 58)"},co:{src:"flags/co.svg",color:"rgb(48, 77, 140)"},cr:{src:"flags/cr.svg",color:"rgb(48, 77, 140)"},cu:{src:"flags/cu.svg",color:"rgb(201, 58, 58)"},cv:{src:"flags/cv.svg",color:"rgb(48, 77, 140)"},cw:{src:"flags/cw.svg",color:"rgb(48, 77, 140)"},cx:{src:"flags/cx.svg",color:"rgb(48, 77, 140)"},cy:{src:"flags/cy.svg",color:"rgb(158, 97, 57)"},cz:{src:"flags/cz.svg",color:"rgb(48, 77, 140)"},de:{src:"flags/de.svg",color:"rgb(201, 58, 58)"},dj:{src:"flags/dj.svg",color:"rgb(201, 58, 58)"},dk:{src:"flags/dk.svg",color:"rgb(201, 58, 58)"},dm:{src:"flags/dm.svg",color:"rgb(201, 58, 58)"},do:{src:"flags/do.svg",color:"rgb(48, 77, 140)"},dz:{src:"flags/dz.svg",color:"rgb(201, 58, 58)"},ec:{src:"flags/ec.svg",color:"rgb(48, 77, 140)"},ee:{src:"flags/ee.svg",color:"rgb(59, 121, 204)"},eg:{src:"flags/eg.svg",color:"rgb(201, 58, 58)"},eh:{src:"flags/eh.svg",color:"rgb(201, 58, 58)"},er:{src:"flags/er.svg",color:"rgb(201, 58, 58)"},es:{src:"flags/es.svg",color:"rgb(201, 58, 58)"},et:{src:"flags/et.svg",color:"rgb(201, 58, 58)"},eu:{src:"flags/eu.svg",color:"rgb(48, 77, 140)"},fi:{src:"flags/fi.svg",color:"rgb(48, 77, 140)"},fj:{src:"flags/fj.svg",color:"rgb(48, 77, 140)"},fk:{src:"flags/fk.svg",color:"rgb(48, 77, 140)"},fm:{src:"flags/fm.svg",color:"rgb(144, 160, 214)"},fo:{src:"flags/fo.svg",color:"rgb(48, 77, 140)"},fr:{src:"flags/fr.svg",color:"rgb(48, 77, 140)"},ga:{src:"flags/ga.svg",color:"rgb(59, 121, 204)"},"gb-eng":{src:"flags/gb-eng.svg",color:"rgb(201, 58, 58)"},"gb-nir":{src:"flags/gb-nir.svg",color:"rgb(48, 77, 140)"},"gb-sct":{src:"flags/gb-sct.svg",color:"rgb(59, 121, 204)"},"gb-wls":{src:"flags/gb-wls.svg",color:"rgb(201, 58, 58)"},gb:{src:"flags/gb.svg",color:"rgb(48, 77, 140)"},gd:{src:"flags/gd.svg",color:"rgb(201, 58, 58)"},ge:{src:"flags/ge.svg",color:"rgb(201, 58, 58)"},gf:{src:"flags/gf.svg",color:"rgb(201, 58, 58)"},gg:{src:"flags/gg.svg",color:"rgb(201, 58, 58)"},gh:{src:"flags/gh.svg",color:"rgb(201, 58, 58)"},gi:{src:"flags/gi.svg",color:"rgb(201, 58, 58)"},gl:{src:"flags/gl.svg",color:"rgb(201, 58, 58)"},gm:{src:"flags/gm.svg",color:"rgb(48, 77, 140)"},gn:{src:"flags/gn.svg",color:"rgb(201, 58, 58)"},gp:{src:"flags/gp.svg",color:"rgb(48, 77, 140)"},gq:{src:"flags/gq.svg",color:"rgb(201, 58, 58)"},gr:{src:"flags/gr.svg",color:"rgb(48, 77, 140)"},gs:{src:"flags/gs.svg",color:"rgb(48, 77, 140)"},gt:{src:"flags/gt.svg",color:"rgb(48, 77, 140)"},gu:{src:"flags/gu.svg",color:"rgb(48, 77, 140)"},gw:{src:"flags/gw.svg",color:"rgb(201, 58, 58)"},gy:{src:"flags/gy.svg",color:"rgb(201, 58, 58)"},hk:{src:"flags/hk.svg",color:"rgb(201, 58, 58)"},hm:{src:"flags/hm.svg",color:"rgb(48, 77, 140)"},hn:{src:"flags/hn.svg",color:"rgb(59, 121, 204)"},hr:{src:"flags/hr.svg",color:"rgb(48, 77, 140)"},ht:{src:"flags/ht.svg",color:"rgb(48, 77, 140)"},hu:{src:"flags/hu.svg",color:"rgb(201, 58, 58)"},id:{src:"flags/id.svg",color:"rgb(201, 58, 58)"},ie:{src:"flags/ie.svg",color:"rgb(47, 145, 112)"},il:{src:"flags/il.svg",color:"rgb(48, 77, 140)"},im:{src:"flags/im.svg",color:"rgb(201, 58, 58)"},in:{src:"flags/in.svg",color:"rgb(48, 77, 140)"},io:{src:"flags/io.svg",color:"rgb(48, 77, 140)"},iq:{src:"flags/iq.svg",color:"rgb(201, 58, 58)"},ir:{src:"flags/ir.svg",color:"rgb(201, 58, 58)"},is:{src:"flags/is.svg",color:"rgb(48, 77, 140)"},it:{src:"flags/it.svg",color:"rgb(201, 58, 58)"},je:{src:"flags/je.svg",color:"rgb(48, 77, 140)"},jm:{src:"flags/jm.svg",color:"rgb(47, 145, 112)"},jo:{src:"flags/jo.svg",color:"rgb(201, 58, 58)"},jp:{src:"flags/jp.svg",color:"rgb(201, 58, 58)"},ke:{src:"flags/ke.svg",color:"rgb(201, 58, 58)"},kg:{src:"flags/kg.svg",color:"rgb(201, 58, 58)"},kh:{src:"flags/kh.svg",color:"rgb(48, 77, 140)"},ki:{src:"flags/ki.svg",color:"rgb(48, 77, 140)"},km:{src:"flags/km.svg",color:"rgb(48, 77, 140)"},kn:{src:"flags/kn.svg",color:"rgb(201, 58, 58)"},kp:{src:"flags/kp.svg",color:"rgb(48, 77, 140)"},kr:{src:"flags/kr.svg",color:"rgb(48, 77, 140)"},kw:{src:"flags/kw.svg",color:"rgb(201, 58, 58)"},ky:{src:"flags/ky.svg",color:"rgb(48, 77, 140)"},kz:{src:"flags/kz.svg",color:"#302d35"},la:{src:"flags/la.svg",color:"rgb(201, 58, 58)"},lb:{src:"flags/lb.svg",color:"rgb(201, 58, 58)"},lc:{src:"flags/lc.svg",color:"#302d35"},li:{src:"flags/li.svg",color:"rgb(48, 77, 140)"},lk:{src:"flags/lk.svg",color:"rgb(167, 46, 94)"},lr:{src:"flags/lr.svg",color:"rgb(48, 77, 140)"},ls:{src:"flags/ls.svg",color:"rgb(48, 77, 140)"},lt:{src:"flags/lt.svg",color:"rgb(201, 58, 58)"},lu:{src:"flags/lu.svg",color:"rgb(201, 58, 58)"},lv:{src:"flags/lv.svg",color:"rgb(201, 58, 58)"},ly:{src:"flags/ly.svg",color:"rgb(201, 58, 58)"},ma:{src:"flags/ma.svg",color:"rgb(201, 58, 58)"},mc:{src:"flags/mc.svg",color:"rgb(201, 58, 58)"},md:{src:"flags/md.svg",color:"rgb(48, 77, 140)"},me:{src:"flags/me.svg",color:"rgb(48, 77, 140)"},mf:{src:"flags/mf.svg",color:"rgb(48, 77, 140)"},mg:{src:"flags/mg.svg",color:"rgb(201, 58, 58)"},mh:{src:"flags/mh.svg",color:"rgb(48, 77, 140)"},mk:{src:"flags/mk.svg",color:"rgb(201, 58, 58)"},ml:{src:"flags/ml.svg",color:"rgb(201, 58, 58)"},mm:{src:"flags/mm.svg",color:"rgb(201, 58, 58)"},mn:{src:"flags/mn.svg",color:"rgb(48, 77, 140)"},mo:{src:"flags/mo.svg",color:"rgb(47, 145, 112)"},mp:{src:"flags/mp.svg",color:"rgb(96, 99, 161)"},mq:{src:"flags/mq.svg",color:"rgb(48, 77, 140)"},mr:{src:"flags/mr.svg",color:"rgb(47, 145, 112)"},ms:{src:"flags/ms.svg",color:"rgb(48, 77, 140)"},mt:{src:"flags/mt.svg",color:"rgb(96, 99, 161)"},mu:{src:"flags/mu.svg",color:"rgb(201, 58, 58)"},mv:{src:"flags/mv.svg",color:"rgb(201, 58, 58)"},mw:{src:"flags/mw.svg",color:"rgb(201, 58, 58)"},mx:{src:"flags/mx.svg",color:"rgb(201, 58, 58)"},my:{src:"flags/my.svg",color:"rgb(48, 77, 140)"},mz:{src:"flags/mz.svg",color:"rgb(201, 58, 58)"},na:{src:"flags/na.svg",color:"rgb(48, 77, 140)"},nc:{src:"flags/nc.svg",color:"rgb(48, 77, 140)"},ne:{src:"flags/ne.svg",color:"rgb(47, 145, 112)"},nf:{src:"flags/nf.svg",color:"rgb(47, 145, 112)"},ng:{src:"flags/ng.svg",color:"rgb(128, 190, 76)"},ni:{src:"flags/ni.svg",color:"rgb(167, 46, 94)"},nl:{src:"flags/nl.svg",color:"rgb(48, 77, 140)"},no:{src:"flags/no.svg",color:"rgb(48, 77, 140)"},np:{src:"flags/np.svg",color:"rgb(201, 58, 58)"},nr:{src:"flags/nr.svg",color:"rgb(48, 77, 140)"},nu:{src:"flags/nu.svg",color:"rgb(48, 77, 140)"},nz:{src:"flags/nz.svg",color:"rgb(48, 77, 140)"},om:{src:"flags/om.svg",color:"rgb(201, 58, 58)"},pa:{src:"flags/pa.svg",color:"rgb(48, 77, 140)"},pe:{src:"flags/pe.svg",color:"rgb(201, 58, 58)"},pf:{src:"flags/pf.svg",color:"rgb(48, 77, 140)"},pg:{src:"flags/pg.svg",color:"rgb(201, 58, 58)"},ph:{src:"flags/ph.svg",color:"rgb(48, 77, 140)"},pk:{src:"flags/pk.svg",color:"rgb(47, 145, 112)"},pl:{src:"flags/pl.svg",color:"rgb(201, 58, 58)"},pm:{src:"flags/pm.svg",color:"rgb(48, 77, 140)"},pn:{src:"flags/pn.svg",color:"rgb(48, 77, 140)"},pr:{src:"flags/pr.svg",color:"rgb(201, 58, 58)"},ps:{src:"flags/ps.svg",color:"rgb(201, 58, 58)"},pt:{src:"flags/pt.svg",color:"rgb(48, 77, 140)"},pw:{src:"flags/pw.svg",color:"#302d35"},py:{src:"flags/py.svg",color:"rgb(48, 77, 140)"},qa:{src:"flags/qa.svg",color:"rgb(167, 46, 94)"},re:{src:"flags/re.svg",color:"rgb(48, 77, 140)"},ro:{src:"flags/ro.svg",color:"rgb(48, 77, 140)"},rs:{src:"flags/rs.svg",color:"rgb(48, 77, 140)"},ru:{src:"flags/ru.svg",color:"rgb(48, 77, 140)"},rw:{src:"flags/rw.svg",color:"rgb(47, 145, 112)"},sa:{src:"flags/sa.svg",color:"rgb(47, 145, 112)"},sb:{src:"flags/sb.svg",color:"rgb(48, 77, 140)"},sc:{src:"flags/sc.svg",color:"rgb(48, 77, 140)"},sd:{src:"flags/sd.svg",color:"rgb(201, 58, 58)"},se:{src:"flags/se.svg",color:"rgb(48, 77, 140)"},sg:{src:"flags/sg.svg",color:"rgb(201, 58, 58)"},sh:{src:"flags/sh.svg",color:"rgb(48, 77, 140)"},si:{src:"flags/si.svg",color:"rgb(48, 77, 140)"},sj:{src:"flags/sj.svg",color:"rgb(48, 77, 140)"},sk:{src:"flags/sk.svg",color:"rgb(48, 77, 140)"},sl:{src:"flags/sl.svg",color:"rgb(48, 77, 140)"},sm:{src:"flags/sm.svg",color:"rgb(201, 58, 58)"},sn:{src:"flags/sn.svg",color:"rgb(201, 58, 58)"},so:{src:"flags/so.svg",color:"#302d35"},sr:{src:"flags/sr.svg",color:"rgb(201, 58, 58)"},ss:{src:"flags/ss.svg",color:"rgb(48, 77, 140)"},st:{src:"flags/st.svg",color:"rgb(201, 58, 58)"},sv:{src:"flags/sv.svg",color:"rgb(48, 77, 140)"},sx:{src:"flags/sx.svg",color:"rgb(48, 77, 140)"},sy:{src:"flags/sy.svg",color:"rgb(201, 58, 58)"},sz:{src:"flags/sz.svg",color:"rgb(48, 77, 140)"},tc:{src:"flags/tc.svg",color:"rgb(48, 77, 140)"},td:{src:"flags/td.svg",color:"rgb(48, 77, 140)"},tf:{src:"flags/tf.svg",color:"rgb(48, 77, 140)"},tg:{src:"flags/tg.svg",color:"rgb(201, 58, 58)"},th:{src:"flags/th.svg",color:"rgb(48, 77, 140)"},tj:{src:"flags/tj.svg",color:"rgb(201, 58, 58)"},tk:{src:"flags/tk.svg",color:"rgb(48, 77, 140)"},tl:{src:"flags/tl.svg",color:"rgb(201, 58, 58)"},tm:{src:"flags/tm.svg",color:"rgb(201, 58, 58)"},tn:{src:"flags/tn.svg",color:"rgb(201, 58, 58)"},to:{src:"flags/to.svg",color:"rgb(201, 58, 58)"},tr:{src:"flags/tr.svg",color:"rgb(201, 58, 58)"},tt:{src:"flags/tt.svg",color:"rgb(201, 58, 58)"},tv:{src:"flags/tv.svg",color:"rgb(48, 77, 140)"},tw:{src:"flags/tw.svg",color:"rgb(48, 77, 140)"},tz:{src:"flags/tz.svg",color:"rgb(47, 145, 112)"},ua:{src:"flags/ua.svg",color:"rgb(59, 121, 204)"},ug:{src:"flags/ug.svg",color:"rgb(201, 58, 58)"},um:{src:"flags/um.svg",color:"rgb(48, 77, 140)"},un:{src:"flags/un.svg",color:"rgb(59, 121, 204)"},us:{src:"flags/us.svg",color:"rgb(48, 77, 140)"},uy:{src:"flags/uy.svg",color:"rgb(48, 77, 140)"},uz:{src:"flags/uz.svg",color:"rgb(201, 58, 58)"},va:{src:"flags/va.svg",color:"rgb(201, 58, 58)"},vc:{src:"flags/vc.svg",color:"rgb(48, 77, 140)"},ve:{src:"flags/ve.svg",color:"rgb(48, 77, 140)"},vg:{src:"flags/vg.svg",color:"rgb(48, 77, 140)"},vi:{src:"flags/vi.svg",color:"rgb(48, 77, 140)"},vn:{src:"flags/vn.svg",color:"rgb(201, 58, 58)"},vu:{src:"flags/vu.svg",color:"rgb(201, 58, 58)"},wf:{src:"flags/wf.svg",color:"rgb(48, 77, 140)"},ws:{src:"flags/ws.svg",color:"rgb(48, 77, 140)"},ye:{src:"flags/ye.svg",color:"rgb(201, 58, 58)"},yt:{src:"flags/yt.svg",color:"rgb(48, 77, 140)"},za:{src:"flags/za.svg",color:"rgb(48, 77, 140)"},zm:{src:"flags/zm.svg",color:"rgb(201, 58, 58)"},zw:{src:"flags/zw.svg",color:"rgb(201, 58, 58)"}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(){__webpack_require__(37);__webpack_require__(38);__webpack_require__(39);__webpack_require__(40);__webpack_require__(41);__webpack_require__(42);__webpack_require__(43);__webpack_require__(44)}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(4)(false);exports.push([module.i,":root {\n  --transition-time-fast: 100ms;\n  --transition-time-base: 200ms;\n  --transition-time-slow: 400ms;\n  --transition-function: cubic-bezier(0.25, 0.46, 0.45, 0.94);\n}\n",""])},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(4)(false);exports.push([module.i,"/* stylelint-disable max-line-length */\n:root {\n  --rgb-ui-carbon--darker: 43, 43, 43;\n  --rgb-ui-carbon--dark: 53, 53, 53;\n  --rgb-ui-carbon: 63, 63, 63;\n\n  --rgb-ui-white-noise--darker: 228, 228, 228;\n  --rgb-ui-white-noise--dark: 238, 238, 238;\n  --rgb-ui-white-noise: 248, 248, 248;\n\n  --rgb-ui-white: 255, 255, 255;\n  --rgb-ui-black: 33, 33, 33;\n\n  --rgb-ui-accent--hover: 48, 171, 232;\n  --rgb-ui-accent: 35, 158, 219;\n  --rgb-ui-accent--active: 22, 145, 207;\n\n  --rgb-ui-success--hover: 10, 204, 162;\n  --rgb-ui-success: 0, 190, 150;\n  --rgb-ui-success--active: 0, 166, 130;\n\n  --rgb-ui-warning--hover: 230, 186, 85;\n  --rgb-ui-warning: 218, 174, 69;\n  --rgb-ui-warning--active: 204, 159, 55;\n\n  --rgb-ui-error--hover: 255, 99, 133;\n  --rgb-ui-error: 252, 72, 112;\n  --rgb-ui-error--active: 240, 58, 97;\n\n  --rgb-ui-info--hover: var(--rgb-ui-accent--hover);\n  --rgb-ui-info: var(--rgb-ui-accent);\n  --rgb-ui-info--active: var(--rgb-ui-accent--active);\n\n  --color-ui-carbon--darker: rgb(var(--rgb-ui-carbon--darker));\n  --color-ui-carbon--dark: rgb(var(--rgb-ui-carbon--dark));\n  --color-ui-carbon: rgb(var(--rgb-ui-carbon));\n\n  --color-ui-white-noise--darker: rgb(var(--rgb-ui-white-noise--darker));\n  --color-ui-white-noise--dark: rgb(var(--rgb-ui-white-noise--dark));\n  --color-ui-white-noise: rgb(var(--rgb-ui-white-noise));\n\n  --color-ui-black: rgb(var(--rgb-ui-black));\n  --color-ui-white: rgb(var(--rgb-ui-white));\n\n  --color-ui-accent--active: rgb(var(--rgb-ui-accent--active));\n  --color-ui-accent: rgb(var(--rgb-ui-accent));\n  --color-ui-accent--hover: rgb(var(--rgb-ui-accent--hover));\n\n  --color-ui-success--hover: rgb(var(--rgb-ui-success--hover));\n  --color-ui-success: rgb(var(--rgb-ui-success));\n  --color-ui-success--active: rgb(var(--rgb-ui-success--active));\n\n  --color-ui-warning--hover: rgb(var(--rgb-ui-warning--hover));\n  --color-ui-warning: rgb(var(--rgb-ui-warning));\n  --color-ui-warning--active: rgb(var(--rgb-ui-warning--active));\n\n  --color-ui-error--hover: rgb(var(--rgb-ui-error--hover));\n  --color-ui-error: rgb(var(--rgb-ui-error));\n  --color-ui-error--active: rgb(var(--rgb-ui-error--active));\n\n  --color-ui-info--hover: rgb(var(--rgb-ui-info--hover));\n  --color-ui-info: rgb(var(--rgb-ui-info));\n  --color-ui-info--active: rgb(var(--rgb-ui-info--active));\n\n  --color-ui-highlight: rgb(215, 255, 0);\n\n  --color-sentiment-positive-active: rgb(62, 148, 76);\n  --color-sentiment-positive: rgb(76, 161, 90);\n  --color-sentiment-positive-hover: rgb(90, 173, 104);\n  --color-sentiment-negative-active: rgb(201, 58, 58);\n  --color-sentiment-negative: rgb(215, 74, 74);\n  --color-sentiment-negative-hover: rgb(227, 89, 89);\n\n  --color-product-forbidden-planet--active: rgb(232, 159, 144);\n  --color-product-forbidden-planet: rgb(245, 177, 164);\n  --color-product-forbidden-planet--hover: rgb(255, 195, 184);\n\n  --color-product-tiny-clanger--active: rgb(232, 132, 166);\n  --color-product-tiny-clanger: rgb(244, 152, 183);\n  --color-product-tiny-clanger--hover: rgb(255, 171, 199);\n\n  --color-product-critical-mass--active: rgb(214, 75, 107);\n  --color-product-critical-mass: rgb(227, 90, 122);\n  --color-product-critical-mass--hover: rgb(240, 108, 139);\n\n  --color-product-fantastic-voyage--active: rgb(156, 36, 82);\n  --color-product-fantastic-voyage: rgb(167, 46, 94);\n  --color-product-fantastic-voyage--hover: rgb(181, 60, 106);\n\n  --color-product-paradise-lost--active: rgb(143, 99, 166);\n  --color-product-paradise-lost: rgb(156, 115, 178);\n  --color-product-paradise-lost--hover: rgb(171, 134, 191);\n\n  --color-product-serene-sea--active: rgb(125, 143, 201);\n  --color-product-serene-sea: rgb(144, 160, 214);\n  --color-product-serene-sea--hover: rgb(163, 178, 227);\n\n  --color-product-event-horizon--active: rgb(81, 85, 148);\n  --color-product-event-horizon: rgb(96, 99, 161);\n  --color-product-event-horizon--hover: rgb(113, 116, 173);\n\n  --color-product-electric-dreams--active: rgb(46, 109, 191);\n  --color-product-electric-dreams: rgb(59, 121, 204);\n  --color-product-electric-dreams--hover: rgb(74, 136, 217);\n\n  --color-product-outer-limits--active: rgb(108, 199, 235);\n  --color-product-outer-limits: rgb(127, 214, 248);\n  --color-product-outer-limits--hover: rgb(147, 222, 252);\n\n  --color-product-giant-leap--active: rgb(69, 192, 217);\n  --color-product-giant-leap: rgb(85, 205, 230);\n  --color-product-giant-leap--hover: rgb(102, 219, 242);\n\n  --color-product-moon-lagoon--active: rgb(25, 161, 176);\n  --color-product-moon-lagoon: rgb(36, 173, 189);\n  --color-product-moon-lagoon--hover: rgb(48, 186, 201);\n\n  --color-product-space-invader--active: rgb(36, 133, 100);\n  --color-product-space-invader: rgb(47, 145, 112);\n  --color-product-space-invader--hover: rgb(58, 158, 125);\n\n  --color-product-extraterrestrial--active: rgb(99, 189, 96);\n  --color-product-extraterrestrial: rgb(116, 201, 113);\n  --color-product-extraterrestrial--hover: rgb(133, 214, 131);\n\n  --color-product-terra-form--active: rgb(115, 179, 62);\n  --color-product-terra-form: rgb(128, 190, 76);\n  --color-product-terra-form--hover: rgb(142, 204, 92);\n\n  --color-product-primeval-soup--active: rgb(186, 186, 15);\n  --color-product-primeval-soup: rgb(200, 200, 25);\n  --color-product-primeval-soup--hover: rgb(212, 212, 38);\n\n  --color-product-future-shock--active: rgb(227, 223, 16);\n  --color-product-future-shock: rgb(240, 236, 29);\n  --color-product-future-shock--hover: rgb(252, 249, 43);\n\n  --color-product-sun-maker--active: rgb(240, 201, 5);\n  --color-product-sun-maker: rgb(252, 213, 18);\n  --color-product-sun-maker--hover: rgb(255, 220, 46);\n\n  --color-product-new-horizon--active: rgb(242, 178, 0);\n  --color-product-new-horizon: rgb(255, 190, 10);\n  --color-product-new-horizon--hover: rgb(254, 199, 49);\n\n  --color-product-blast-off--active: rgb(237, 124, 43);\n  --color-product-blast-off: rgb(249, 138, 57);\n  --color-product-blast-off--hover: rgb(255, 148, 71);\n\n  --color-product-crash-course--active: rgb(242, 93, 70);\n  --color-product-crash-course: rgb(255, 109, 86);\n  --color-product-crash-course--hover: rgb(255, 126, 106);\n\n  --color-product-solar-rust--active: rgb(191, 118, 15);\n  --color-product-solar-rust: rgb(205, 129, 26);\n  --color-product-solar-rust--hover: rgb(217, 143, 39);\n\n  --color-product-ground-control--active: rgb(145, 85, 45);\n  --color-product-ground-control: rgb(158, 97, 57);\n  --color-product-ground-control--hover: rgb(171, 110, 70);\n\n  --color-product-space-oddity--active: rgb(176, 149, 76);\n  --color-product-space-oddity: rgb(189, 163, 91);\n  --color-product-space-oddity--hover: rgb(201, 176, 107);\n\n  --color-product-rocky-planet--active: rgb(145, 128, 100);\n  --color-product-rocky-planet: rgb(158, 142, 117);\n  --color-product-rocky-planet--hover: rgb(171, 157, 135);\n\n  --color-product-deep-thought--active: rgb(167, 162, 179);\n  --color-product-deep-thought: rgb(187, 185, 192);\n  --color-product-deep-thought--hover: rgb(204, 204, 204);\n\n  --color-product-luna-dust--active: rgb(103, 129, 143);\n  --color-product-luna-dust: rgb(120, 144, 156);\n  --color-product-luna-dust--hover: rgb(138, 158, 168);\n\n  --color-sentiment-negative--active: rgb(201, 58, 58);\n  --color-sentiment-negative: rgb(215, 74, 74);\n  --color-sentiment-negative--hover: rgb(227, 89, 89);\n\n  --color-sentiment-positive--active: rgb(62, 148, 76);\n  --color-sentiment-positive: rgb(76, 161, 90);\n  --color-sentiment-positive--hover: rgb(90, 173, 104);\n\n  --color-sentiment-neutral--active: var(--color-product-deep-thought--active);\n  --color-sentiment-neutral: var(--color-product-deep-thought);\n  --color-sentiment-neutral--hover: var(--color-product-deep-thought--hover);\n\n  --color-social-twitter--active: rgb(16, 148, 230);\n  --color-social-twitter: rgb(29, 161, 242);\n  --color-social-twitter--hover: rgb(43, 174, 255);\n\n  --color-social-facebook--active: rgb(48, 77, 140);\n  --color-social-facebook: rgb(59, 89, 152);\n  --color-social-facebook--hover: rgb(73, 102, 166);\n\n  --color-social-instagram--active: rgb(171, 58, 133);\n  --color-social-instagram: rgb(183, 71, 146);\n  --color-social-instagram--hover: rgb(196, 86, 160);\n\n  --color-better-together: rgb(240, 78, 78);\n}\n/* stylelint-enable */\n",""])},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(4)(false);exports.push([module.i,":root {\n  --layout-width-tiny: 23rem;\n  --layout-width-small: 48rem;\n  --layout-width-medium: 62rem;\n  --layout-width-large: 75rem;\n\n  --z-index-sticky: 1;\n  --z-index-platform-mask: 2;\n  --z-index-platform-console: 3;\n  --z-index-platform-dock: 4;\n  --z-index-position: 5;\n  --z-index-modal: 5;\n  --z-index-notifications: 6;\n}\n",""])},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(4)(false);exports.push([module.i,":root {\n  --opacity-text--subtle: 0.75;\n  --opacity-text--disabled: 0.3;\n\n  --opacity-background--overlay-modal: 0.9;\n  --opacity-background--overlay-heavy: 0.75;\n  --opacity-background--overlay-light: 0.3;\n  --opacity-background--subtle: 0.15;\n  --opacity-background--active: 0.08;\n  --opacity-background--disabled: 0.05;\n  --opacity-background--hover: 0.04;\n\n  --opacity-border: 0.2;\n\n  --opacity-shadow--light: 0.14;\n  --opacity-shadow--heavy: 0.15;\n\n  --opacity-input-border--focused: 0.5;\n  --opacity-input-border--valid: 0.4;\n  --opacity-input-border--invalid: 0.25;\n}\n",""])},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(4)(false);exports.push([module.i,"/* stylelint-disable max-line-length */\n:root {\n  --spacing-grid-size: 0.25rem;\n\n  --spacing-grid-size--x1: var(--spacing-grid-size);\n  --spacing-grid-size--x2: calc(var(--spacing-grid-size) * 2);\n  --spacing-grid-size--x3: calc(var(--spacing-grid-size) * 3);\n  --spacing-grid-size--x4: calc(var(--spacing-grid-size) * 4);\n  --spacing-grid-size--x5: calc(var(--spacing-grid-size) * 5);\n  --spacing-grid-size--x6: calc(var(--spacing-grid-size) * 6);\n  --spacing-grid-size--x8: calc(var(--spacing-grid-size) * 8);\n\n  --page-padding-horizontal: var(--spacing-grid-size--x6);\n  --page-padding-vertical: var(--spacing-grid-size--x6);\n\n  --component-line-height: 1rem;\n\n  --component-border-width-small: 0.0625rem;\n  --component-border-width-medium: 0.0625rem;\n  --component-border-width-large: 0.125rem;\n  --component-border-width-huge: 0.125rem;\n  --component-border-width: var(--component-border-width-small);\n\n  --component-border-radius: 0.1875rem;\n  --component-border-radius-large: 0.5rem;\n\n  --component-padding-vertical-small: calc(var(--spacing-grid-size) - var(--component-border-width-small));\n  --component-padding-vertical-medium: calc(calc(var(--spacing-grid-size) * 2) - var(--component-border-width-small));\n  --component-padding-vertical-large: calc(calc(var(--spacing-grid-size) * 3) - var(--component-border-width-small));\n\n  --component-padding-horizontal-small: calc(var(--spacing-grid-size) * 3);\n  --component-padding-horizontal-medium: calc(var(--spacing-grid-size) * 3);\n  --component-padding-horizontal-large: calc(var(--spacing-grid-size) * 4);\n\n  --component-round-size-small: calc(var(--spacing-grid-size) * 6);\n  --component-round-size-medium: calc(var(--spacing-grid-size) * 12);\n  --component-round-size-large: calc(var(--spacing-grid-size) * 18);\n  --component-round-size-huge: calc(var(--spacing-grid-size) * 30);\n\n  --drop-shadow-border: 0 0 0 0.0625rem;\n  --drop-shadow-definition: 0 0.0625rem 0.125rem 0.03125rem;\n  --drop-shadow-elevation--x1: 0 0.0625rem 0.1875rem 0;\n  --drop-shadow-elevation--x2: 0 0.25rem 0.5625rem 0;\n\n  /**\n   * Shared chart variables.\n   *\n   *  [1] Needed to normalise bar widths. However\n   *      this is not in relation to anything so\n   *      will need adjusting if text widths change :sob:\n   */\n  --cmp-chart-label-margin: var(--spacing-grid-size--x2);\n  --cmp-chart-label-line-height: 1rem;  /* [1] */\n  --cmp-chart-label-width: calc(2rem + var(--cmp-chart-label-margin));  /* [1] */\n  --cmp-chart-label-height: calc(var(--cmp-chart-label-line-height) + var(--cmp-chart-label-margin));\n\n  --cmp-chart-opacity-faded: 0.25;\n\n  --cmp-dot-plot-diameter: 0.8125rem;\n  --cmp-dot-plot-radius: calc(var(--cmp-dot-plot-diameter) * 0.5);\n\n  --cmp-benchmark-line-width: 0.0625rem;\n  --cmp-benchmark-line-height: var(--cmp-dot-plot-diameter);\n\n  --cmp-chart-overflow-space: calc(var(--cmp-chart-label-width) + var(--cmp-dot-plot-radius));\n\n  /**\n   * Shared component variables.\n   */\n  --cmp-context-tip-edge-to-edge: 0.75rem;\n}\n/* stylelint-enable */\n",""])},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(4)(false);exports.push([module.i,"/* stylelint-disable max-line-length */\n:root {\n  --rgb-theme-day-main: var(--rgb-ui-carbon);\n  --rgb-theme-day-main--dark: var(--rgb-ui-carbon--dark);\n  --rgb-theme-day-main--darker: var(--rgb-ui-carbon--darker);\n\n  --rgb-theme-day-background--shade-1: var(--rgb-ui-white);\n  --rgb-theme-day-background--shade-2: var(--rgb-ui-white-noise);\n  --rgb-theme-day-background--shade-3: var(--rgb-ui-white-noise--dark);\n  --rgb-theme-day-background--shade-4: var(--rgb-ui-white-noise--darker);\n\n  --color-theme-day-main: rgb(var(--rgb-theme-day-main));\n  --color-theme-day-main--dark: rgb(var(--rgb-theme-day-main--dark));\n  --color-theme-day-main--darker: rgb(var(--rgb-theme-day-main--darker));\n\n  --color-theme-day-text: var(--color-theme-day-main);\n  --color-theme-day-text--subtle: rgba(var(--rgb-theme-day-main), var(--opacity-text--subtle));\n  --color-theme-day-text--disabled: rgba(var(--rgb-theme-day-main), var(--opacity-text--disabled));\n\n  --color-theme-day-background--shade-1: rgb(var(--rgb-theme-day-background--shade-1));\n  --color-theme-day-background--shade-2: rgb(var(--rgb-theme-day-background--shade-2));\n  --color-theme-day-background--shade-3: rgb(var(--rgb-theme-day-background--shade-3));\n  --color-theme-day-background--shade-4: rgb(var(--rgb-theme-day-background--shade-4));\n\n  --color-theme-day-background: var(--color-theme-day-background--shade-1);\n  --color-theme-day-background--overlay-heavy: rgba(var(--rgb-theme-day-main), var(--opacity-background--overlay-heavy));\n  --color-theme-day-background--overlay-light: rgba(var(--rgb-theme-day-main), var(--opacity-background--overlay-light));\n  --color-theme-day-background--subtle: rgba(var(--rgb-theme-day-main), var(--opacity-background--subtle));\n  --color-theme-day-background--active: rgba(var(--rgb-theme-day-main), var(--opacity-background--active));\n  --color-theme-day-background--disabled: rgba(var(--rgb-theme-day-main), var(--opacity-background--disabled));\n  --color-theme-day-background--hover: rgba(var(--rgb-theme-day-main), var(--opacity-background--hover));\n\n  --color-theme-day-border: rgba(var(--rgb-theme-day-main), var(--opacity-border));\n\n  --color-theme-day-shadow--border: rgba(var(--rgb-theme-day-main), var(--opacity-border));\n  --color-theme-day-shadow--light: rgba(var(--rgb-theme-day-main), var(--opacity-shadow--light));\n  --color-theme-day-shadow--heavy: rgba(var(--rgb-theme-day-main), var(--opacity-shadow--heavy));\n\n  --drop-shadow-theme-day-border: var(--drop-shadow-border) var(--color-theme-day-shadow--border);\n  --drop-shadow-theme-day-elevation--x1:\n    var(--drop-shadow-elevation--x1) var(--color-theme-day-shadow--light),\n    var(--drop-shadow-definition) var(--color-theme-day-shadow--heavy);\n  --drop-shadow-theme-day-elevation--x2:\n    var(--drop-shadow-elevation--x2) var(--color-theme-day-shadow--light),\n    var(--drop-shadow-definition) var(--color-theme-day-shadow--heavy);\n}\n\n.ax-theme--day {\n  --rgb-theme-main: var(--rgb-theme-day-main);\n  --rgb-theme-main--dark: var(--rgb-theme-day-main--dark);\n  --rgb-theme-main--darker: var(--rgb-theme-day-main--darker);\n\n  --rgb-theme-background--shade-1: var(--rgb-theme-day-background--shade-1);\n  --rgb-theme-background--shade-2: var(--rgb-theme-day-background--shade-2);\n  --rgb-theme-background--shade-3: var(--rgb-theme-day-background--shade-3);\n  --rgb-theme-background--shade-4: var(--rgb-theme-day-background--shade-4);\n\n  --color-theme-main: var(--color-theme-day-main);\n  --color-theme-main--dark: var(--color-theme-day-main--dark);\n  --color-theme-main--darker: var(--color-theme-day-main--darker);\n\n  --color-theme-text: var(--color-theme-day-text);\n  --color-theme-text--subtle: var(--color-theme-day-text--subtle);\n  --color-theme-text--disabled: var(--color-theme-day-text--disabled);\n\n  --color-theme-background--shade-1: var(--color-theme-day-background--shade-1);\n  --color-theme-background--shade-2: var(--color-theme-day-background--shade-2);\n  --color-theme-background--shade-3: var(--color-theme-day-background--shade-3);\n  --color-theme-background--shade-4: var(--color-theme-day-background--shade-4);\n\n  --color-theme-background: var(--color-theme-day-background);\n  --color-theme-background--overlay-heavy: var(--color-theme-day-background--overlay-heavy);\n  --color-theme-background--overlay-light: var(--color-theme-day-background--overlay-light);\n  --color-theme-background--subtle: var(--color-theme-day-background--subtle);\n  --color-theme-background--active: var(--color-theme-day-background--active);\n  --color-theme-background--disabled: var(--color-theme-day-background--disabled);\n  --color-theme-background--hover: var(--color-theme-day-background--hover);\n\n  --color-theme-border: var(--color-theme-day-border);\n\n  --color-theme-shadow--border: var(--color-theme-day-shadow--border);\n  --color-theme-shadow--light: var(--color-theme-day-shadow--heavy);\n  --color-theme-shadow--heavy: var(--color-theme-day-shadow--light);\n\n  --drop-shadow-theme-border: var(--drop-shadow-theme-day-border);\n  --drop-shadow-theme-elevation--x1: var(--drop-shadow-theme-day-elevation--x1);\n  --drop-shadow-theme-elevation--x2: var(--drop-shadow-theme-day-elevation--x2);\n}\n",""])},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(4)(false);exports.push([module.i,"/* stylelint-disable max-line-length */\n:root {\n  --rgb-theme-night-main: var(--rgb-ui-white-noise);\n  --rgb-theme-night-main--dark: var(--rgb-ui-white-noise--dark);\n  --rgb-theme-night-main--darker: var(--rgb-ui-white-noise--darker);\n\n  --rgb-theme-night-background--shade-1: var(--rgb-ui-black);\n  --rgb-theme-night-background--shade-2: var(--rgb-ui-carbon--darker);\n  --rgb-theme-night-background--shade-3: var(--rgb-ui-carbon--dark);\n  --rgb-theme-night-background--shade-4: var(--rgb-ui-carbon);\n\n  --color-theme-night-main: rgb(var(--rgb-theme-night-main));\n  --color-theme-night-main--dark: rgb(var(--rgb-theme-night-main--dark));\n  --color-theme-night-main--darker: rgb(var(--rgb-theme-night-main--darker));\n\n  --color-theme-night-text: var(--color-theme-night-main);\n  --color-theme-night-text--subtle: rgba(var(--rgb-theme-night-main), var(--opacity-text--subtle));\n  --color-theme-night-text--disabled: rgba(var(--rgb-theme-night-main), var(--opacity-text--disabled));\n\n  --color-theme-night-background--shade-1: rgb(var(--rgb-theme-night-background--shade-1));\n  --color-theme-night-background--shade-2: rgb(var(--rgb-theme-night-background--shade-2));\n  --color-theme-night-background--shade-3: rgb(var(--rgb-theme-night-background--shade-3));\n  --color-theme-night-background--shade-4: rgb(var(--rgb-theme-night-background--shade-4));\n\n  --color-theme-night-background: var(--color-theme-night-background--shade-2);\n  --color-theme-night-background--overlay-heavy: rgba(var(--rgb-theme-night-main), var(--opacity-background--overlay-heavy));\n  --color-theme-night-background--overlay-light: rgba(var(--rgb-theme-night-main), var(--opacity-background--overlay-light));\n  --color-theme-night-background--subtle: rgba(var(--rgb-theme-night-main), var(--opacity-background--subtle));\n  --color-theme-night-background--active: rgba(var(--rgb-theme-night-main), var(--opacity-background--active));\n  --color-theme-night-background--disabled: rgba(var(--rgb-theme-night-main), var(--opacity-background--disabled));\n  --color-theme-night-background--hover: rgba(var(--rgb-theme-night-main), var(--opacity-background--hover));\n\n  --color-theme-night-border: rgba(var(--rgb-theme-night-main), var(--opacity-border));\n\n  --color-theme-night-shadow--border: rgba(var(--rgb-theme-night-main), var(--opacity-border));\n  --color-theme-night-shadow--light: rgba(var(--rgb-ui-black), var(--opacity-shadow--light));\n  --color-theme-night-shadow--heavy: rgba(var(--rgb-ui-black), var(--opacity-shadow--heavy));\n\n  --drop-shadow-theme-night-border: var(--drop-shadow-border) var(--color-theme-night-shadow--border);\n  --drop-shadow-theme-night-elevation--x1:\n    var(--drop-shadow-elevation--x1) var(--color-theme-night-shadow--light),\n    var(--drop-shadow-definition) var(--color-theme-night-shadow--heavy);\n  --drop-shadow-theme-night-elevation--x2:\n    var(--drop-shadow-elevation--x2) var(--color-theme-night-shadow--light),\n    var(--drop-shadow-definition) var(--color-theme-night-shadow--heavy);\n}\n\n.ax-theme--night {\n  --rgb-theme-main: var(--rgb-theme-night-main);\n  --rgb-theme-main--dark: var(--rgb-theme-night-main--dark);\n  --rgb-theme-main--darker: var(--rgb-theme-night-main--darker);\n\n  --rgb-theme-background--shade-1: var(--rgb-theme-night-background--shade-1);\n  --rgb-theme-background--shade-2: var(--rgb-theme-night-background--shade-2);\n  --rgb-theme-background--shade-3: var(--rgb-theme-night-background--shade-3);\n  --rgb-theme-background--shade-4: var(--rgb-theme-night-background--shade-4);\n\n  --color-theme-main: var(--color-theme-night-main);\n  --color-theme-main--dark: var(--color-theme-night-main--dark);\n  --color-theme-main--darker: var(--color-theme-night-main--darker);\n\n  --color-theme-text: var(--color-theme-night-text);\n  --color-theme-text--subtle: var(--color-theme-night-text--subtle);\n  --color-theme-text--disabled: var(--color-theme-night-text--disabled);\n\n  --color-theme-background--shade-1: var(--color-theme-night-background--shade-1);\n  --color-theme-background--shade-2: var(--color-theme-night-background--shade-2);\n  --color-theme-background--shade-3: var(--color-theme-night-background--shade-3);\n  --color-theme-background--shade-4: var(--color-theme-night-background--shade-4);\n\n  --color-theme-background: var(--color-theme-night-background);\n  --color-theme-background--overlay-heavy: var(--color-theme-night-background--overlay-heavy);\n  --color-theme-background--overlay-light: var(--color-theme-night-background--overlay-light);\n  --color-theme-background--subtle: var(--color-theme-night-background--subtle);\n  --color-theme-background--active: var(--color-theme-night-background--active);\n  --color-theme-background--disabled: var(--color-theme-night-background--disabled);\n  --color-theme-background--hover: var(--color-theme-night-background--hover);\n\n  --color-theme-border: var(--color-theme-night-border);\n\n  --color-theme-shadow--border: var(--color-theme-night-shadow--border);\n  --color-theme-shadow--light: var(--color-theme-night-shadow--heavy);\n  --color-theme-shadow--heavy: var(--color-theme-night-shadow--light);\n\n  --drop-shadow-theme-border: var(--drop-shadow-theme-night-border);\n  --drop-shadow-theme-elevation--x1: var(--drop-shadow-theme-night-elevation--x1);\n  --drop-shadow-theme-elevation--x2: var(--drop-shadow-theme-night-elevation--x2);\n}\n",""])},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(4)(false);exports.push([module.i,"/* stylelint-disable value-keyword-case */\n:root {\n  --font-family-body: 'Roboto', Helvetica, Arial, sans-serif;\n\n  --font-weight-thin: 100;\n  --font-weight-light: 300;\n  --font-weight-regular: 400;\n  --font-weight-medium: 500;\n  --font-weight-bold: 700;\n\n  --font-size-label: 0.625rem;\n  --font-size-small: 0.75rem;\n  --font-size-body: 0.8125rem;\n  --font-size-large: 0.875rem;\n  --font-size-headtitle: 1.0625rem;\n  --font-size-headline: 1.375rem;\n  --font-size-display1: 2rem;\n  --font-size-display2: 2.5rem;\n\n  --line-height-label: 1rem;\n  --line-height-body: 1.25rem;\n  --line-height-small: var(--line-height-body);\n  --line-height-large: var(--line-height-body);\n  --line-height-headtitle: 1.5rem;\n  --line-height-headline: 1.75rem;\n  --line-height-display1: 2.5rem;\n  --line-height-display2: 3rem;\n\n  --letter-spacing-tight: -0.00125rem;\n  --letter-spacing-loose: 0.001875rem;\n}\n/* stylelint-enable */\n",""])},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.userDefinedGraphColors=exports.productHoverColors=exports.productActiveColors=exports.productColors=exports.productColorNames=exports.themeNightBorder=exports.themeNightBackgroundHover=exports.themeNightBackgroundDisabled=exports.themeNightBackgroundActive=exports.themeNightBackgroundSubtle=exports.themeNightBackgroundOverlayLight=exports.themeNightBackgroundOverlayHeavy=exports.themeNightTextDisabled=exports.themeNightTextSubtle=exports.themeNightText=exports.themeNightMainDarker=exports.themeNightMainDark=exports.themeNightMain=exports.themeDayBorder=exports.themeDayBackgroundHover=exports.themeDayBackgroundDisabled=exports.themeDayBackgroundActive=exports.themeDayBackgroundSubtle=exports.themeDayBackgroundOverlayLight=exports.themeDayBackgroundOverlayHeavy=exports.themeDayTextDisabled=exports.themeDayTextSubtle=exports.themeDayText=exports.themeDayMainDarker=exports.themeDayMainDark=exports.themeDayMain=exports.externalTwiiterBlue=exports.betterTogether=exports.socialInstagramHover=exports.socialInstagram=exports.socialInstagramActive=exports.socialFacebookHover=exports.socialFacebook=exports.socialFacebookActive=exports.socialTwitterHover=exports.socialTwitter=exports.socialTwitterActive=exports.sentimentNeutralHover=exports.sentimentNeutral=exports.sentimentNeutralActive=exports.sentimentNegativeHover=exports.sentimentNegative=exports.sentimentNegativeActive=exports.sentimentPositiveHover=exports.sentimentPositive=exports.sentimentPositiveActive=exports.productLunaDustHover=exports.productLunaDust=undefined;exports.productLunaDustActive=exports.productDeepThoughtHover=exports.productDeepThought=exports.productDeepThoughtActive=exports.productRockyPlanetHover=exports.productRockyPlanet=exports.productRockyPlanetActive=exports.productSpaceOddityHover=exports.productSpaceOddity=exports.productSpaceOddityActive=exports.productGroundControlHover=exports.productGroundControl=exports.productGroundControlActive=exports.productSolarRustHover=exports.productSolarRust=exports.productSolarRustActive=exports.productCrashCourseHover=exports.productCrashCourse=exports.productCrashCourseActive=exports.productBlastOffHover=exports.productBlastOff=exports.productBlastOffActive=exports.productNewHorizonHover=exports.productNewHorizon=exports.productNewHorizonActive=exports.productSunMakerHover=exports.productSunMaker=exports.productSunMakerActive=exports.productFutureShockHover=exports.productFutureShock=exports.productFutureShockActive=exports.productPrimevalSoupHover=exports.productPrimevalSoup=exports.productPrimevalSoupActive=exports.productTerraFormHover=exports.productTerraForm=exports.productTerraFormActive=exports.productExtraterrestrialHover=exports.productExtraterrestrial=exports.productExtraterrestrialActive=exports.productSpaceInvaderHover=exports.productSpaceInvader=exports.productSpaceInvaderActive=exports.productMoonLagoonHover=exports.productMoonLagoon=exports.productMoonLagoonActive=exports.productGiantLeapHover=exports.productGiantLeap=exports.productGiantLeapActive=exports.productOuterLimitsHover=exports.productOuterLimits=exports.productOuterLimitsActive=exports.productElectricDreamsHover=exports.productElectricDreams=exports.productElectricDreamsActive=exports.productEventHorizonHover=exports.productEventHorizon=exports.productEventHorizonActive=exports.productSereneSeaHover=exports.productSereneSea=exports.productSereneSeaActive=exports.productParadiseLostHover=exports.productParadiseLost=exports.productParadiseLostActive=exports.productFantasticVoyageHover=exports.productFantasticVoyage=exports.productFantasticVoyageActive=exports.productCriticalMassHover=exports.productCriticalMass=exports.productCriticalMassActive=exports.productTinyClangerHover=exports.productTinyClanger=exports.productTinyClangerActive=exports.productForbiddenPlanetHover=exports.productForbiddenPlanet=exports.productForbiddenPlanetActive=exports.uiHighlight=exports.uiWhite=exports.uiBlack=exports.uiInfoActive=exports.uiInfo=exports.uiInfoHover=exports.uiErrorActive=exports.uiError=exports.uiErrorHover=exports.uiWarningActive=exports.uiWarning=exports.uiWarningHover=exports.uiSuccessActive=exports.uiSuccess=exports.uiSuccessHover=exports.uiAccentActive=exports.uiAccent=exports.uiAccentHover=exports.uiWhiteNoise=exports.uiWhiteNoiseDark=exports.uiWhiteNoiseDarker=exports.uiCarbonDarker=exports.uiCarbonDark=exports.uiCarbon=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _opacities=__webpack_require__(10);var uiCarbon=exports.uiCarbon={r:72,g:70,b:77};var uiCarbonDark=exports.uiCarbonDark={r:57,g:55,b:62};var uiCarbonDarker=exports.uiCarbonDarker={r:48,g:45,b:53};var uiWhiteNoiseDarker=exports.uiWhiteNoiseDarker={r:227,g:225,b:232};var uiWhiteNoiseDark=exports.uiWhiteNoiseDark={r:237,g:235,b:242};var uiWhiteNoise=exports.uiWhiteNoise={r:247,g:245,b:252};var uiAccentHover=exports.uiAccentHover={r:48,g:171,b:232};var uiAccent=exports.uiAccent={r:35,g:158,b:219};var uiAccentActive=exports.uiAccentActive={r:22,g:145,b:207};var uiSuccessHover=exports.uiSuccessHover={r:10,g:204,b:162};var uiSuccess=exports.uiSuccess={r:0,g:190,b:150};var uiSuccessActive=exports.uiSuccessActive={r:0,g:166,b:130};var uiWarningHover=exports.uiWarningHover={r:230,g:186,b:85};var uiWarning=exports.uiWarning={r:218,g:174,b:69};var uiWarningActive=exports.uiWarningActive={r:204,g:159,b:55};var uiErrorHover=exports.uiErrorHover={r:255,g:99,b:133};var uiError=exports.uiError={r:252,g:72,b:112};var uiErrorActive=exports.uiErrorActive={r:240,g:58,b:97};var uiInfoHover=exports.uiInfoHover={r:48,g:171,b:232};var uiInfo=exports.uiInfo={r:35,g:158,b:219};var uiInfoActive=exports.uiInfoActive={r:22,g:145,b:207};var uiBlack=exports.uiBlack={r:33,g:33,b:33};var uiWhite=exports.uiWhite={r:255,g:255,b:255};var uiHighlight=exports.uiHighlight={r:215,g:255,b:0};var productForbiddenPlanetActive=exports.productForbiddenPlanetActive={r:232,g:159,b:144};var productForbiddenPlanet=exports.productForbiddenPlanet={r:245,g:177,b:164};var productForbiddenPlanetHover=exports.productForbiddenPlanetHover={r:255,g:195,b:184};var productTinyClangerActive=exports.productTinyClangerActive={r:232,g:132,b:166};var productTinyClanger=exports.productTinyClanger={r:244,g:152,b:183};var productTinyClangerHover=exports.productTinyClangerHover={r:255,g:171,b:199};var productCriticalMassActive=exports.productCriticalMassActive={r:214,g:75,b:107};var productCriticalMass=exports.productCriticalMass={r:227,g:90,b:122};var productCriticalMassHover=exports.productCriticalMassHover={r:240,g:108,b:139};var productFantasticVoyageActive=exports.productFantasticVoyageActive={r:156,g:36,b:82};var productFantasticVoyage=exports.productFantasticVoyage={r:167,g:46,b:94};var productFantasticVoyageHover=exports.productFantasticVoyageHover={r:181,g:60,b:106};var productParadiseLostActive=exports.productParadiseLostActive={r:143,g:99,b:166};var productParadiseLost=exports.productParadiseLost={r:156,g:115,b:178};var productParadiseLostHover=exports.productParadiseLostHover={r:171,g:134,b:191};var productSereneSeaActive=exports.productSereneSeaActive={r:125,g:143,b:201};var productSereneSea=exports.productSereneSea={r:144,g:160,b:214};var productSereneSeaHover=exports.productSereneSeaHover={r:163,g:178,b:227};var productEventHorizonActive=exports.productEventHorizonActive={r:81,g:85,b:148};var productEventHorizon=exports.productEventHorizon={r:96,g:99,b:161};var productEventHorizonHover=exports.productEventHorizonHover={r:113,g:116,b:173};var productElectricDreamsActive=exports.productElectricDreamsActive={r:46,g:109,b:191};var productElectricDreams=exports.productElectricDreams={r:59,g:121,b:204};var productElectricDreamsHover=exports.productElectricDreamsHover={r:74,g:136,b:217};var productOuterLimitsActive=exports.productOuterLimitsActive={r:108,g:199,b:235};var productOuterLimits=exports.productOuterLimits={r:127,g:214,b:248};var productOuterLimitsHover=exports.productOuterLimitsHover={r:147,g:222,b:252};var productGiantLeapActive=exports.productGiantLeapActive={r:69,g:192,b:217};var productGiantLeap=exports.productGiantLeap={r:85,g:205,b:230};var productGiantLeapHover=exports.productGiantLeapHover={r:102,g:219,b:242};var productMoonLagoonActive=exports.productMoonLagoonActive={r:25,g:161,b:176};var productMoonLagoon=exports.productMoonLagoon={r:36,g:173,b:189};var productMoonLagoonHover=exports.productMoonLagoonHover={r:48,g:186,b:201};var productSpaceInvaderActive=exports.productSpaceInvaderActive={r:36,g:133,b:100};var productSpaceInvader=exports.productSpaceInvader={r:47,g:145,b:112};var productSpaceInvaderHover=exports.productSpaceInvaderHover={r:58,g:158,b:125};var productExtraterrestrialActive=exports.productExtraterrestrialActive={r:99,g:189,b:96};var productExtraterrestrial=exports.productExtraterrestrial={r:116,g:201,b:113};var productExtraterrestrialHover=exports.productExtraterrestrialHover={r:133,g:214,b:131};var productTerraFormActive=exports.productTerraFormActive={r:115,g:179,b:62};var productTerraForm=exports.productTerraForm={r:128,g:190,b:76};var productTerraFormHover=exports.productTerraFormHover={r:142,g:204,b:92};var productPrimevalSoupActive=exports.productPrimevalSoupActive={r:186,g:186,b:15};var productPrimevalSoup=exports.productPrimevalSoup={r:200,g:200,b:25};var productPrimevalSoupHover=exports.productPrimevalSoupHover={r:212,g:212,b:38};var productFutureShockActive=exports.productFutureShockActive={r:227,g:223,b:16};var productFutureShock=exports.productFutureShock={r:240,g:236,b:29};var productFutureShockHover=exports.productFutureShockHover={r:252,g:249,b:43};var productSunMakerActive=exports.productSunMakerActive={r:240,g:201,b:5};var productSunMaker=exports.productSunMaker={r:252,g:213,b:18};var productSunMakerHover=exports.productSunMakerHover={r:255,g:220,b:46};var productNewHorizonActive=exports.productNewHorizonActive={r:242,g:178,b:0};var productNewHorizon=exports.productNewHorizon={r:255,g:190,b:10};var productNewHorizonHover=exports.productNewHorizonHover={r:254,g:199,b:49};var productBlastOffActive=exports.productBlastOffActive={r:237,g:124,b:43};var productBlastOff=exports.productBlastOff={r:249,g:138,b:57};var productBlastOffHover=exports.productBlastOffHover={r:255,g:148,b:71};var productCrashCourseActive=exports.productCrashCourseActive={r:242,g:93,b:70};var productCrashCourse=exports.productCrashCourse={r:255,g:109,b:86};var productCrashCourseHover=exports.productCrashCourseHover={r:255,g:126,b:106};var productSolarRustActive=exports.productSolarRustActive={r:191,g:118,b:15};var productSolarRust=exports.productSolarRust={r:205,g:129,b:26};var productSolarRustHover=exports.productSolarRustHover={r:217,g:143,b:39};var productGroundControlActive=exports.productGroundControlActive={r:145,g:85,b:45};var productGroundControl=exports.productGroundControl={r:158,g:97,b:57};var productGroundControlHover=exports.productGroundControlHover={r:171,g:110,b:70};var productSpaceOddityActive=exports.productSpaceOddityActive={r:176,g:149,b:76};var productSpaceOddity=exports.productSpaceOddity={r:189,g:163,b:91};var productSpaceOddityHover=exports.productSpaceOddityHover={r:201,g:176,b:107};var productRockyPlanetActive=exports.productRockyPlanetActive={r:145,g:128,b:100};var productRockyPlanet=exports.productRockyPlanet={r:158,g:142,b:117};var productRockyPlanetHover=exports.productRockyPlanetHover={r:171,g:157,b:135};var productDeepThoughtActive=exports.productDeepThoughtActive={r:167,g:162,b:179};var productDeepThought=exports.productDeepThought={r:187,g:185,b:192};var productDeepThoughtHover=exports.productDeepThoughtHover={r:204,g:204,b:204};var productLunaDustActive=exports.productLunaDustActive={r:103,g:129,b:143};var productLunaDust=exports.productLunaDust={r:120,g:144,b:156};var productLunaDustHover=exports.productLunaDustHover={r:138,g:158,b:168};var sentimentPositiveActive=exports.sentimentPositiveActive={r:62,g:148,b:76};var sentimentPositive=exports.sentimentPositive={r:76,g:161,b:90};var sentimentPositiveHover=exports.sentimentPositiveHover={r:90,g:173,b:104};var sentimentNegativeActive=exports.sentimentNegativeActive={r:201,g:58,b:58};var sentimentNegative=exports.sentimentNegative={r:215,g:74,b:74};var sentimentNegativeHover=exports.sentimentNegativeHover={r:227,g:89,b:89};var sentimentNeutralActive=exports.sentimentNeutralActive=productDeepThoughtActive;var sentimentNeutral=exports.sentimentNeutral=productDeepThought;var sentimentNeutralHover=exports.sentimentNeutralHover=productDeepThoughtHover;var socialTwitterActive=exports.socialTwitterActive={r:16,g:148,b:230};var socialTwitter=exports.socialTwitter={r:29,g:161,b:242};var socialTwitterHover=exports.socialTwitterHover={r:43,g:174,b:255};var socialFacebookActive=exports.socialFacebookActive={r:48,g:77,b:140};var socialFacebook=exports.socialFacebook={r:59,g:89,b:152};var socialFacebookHover=exports.socialFacebookHover={r:73,g:102,b:166};var socialInstagramActive=exports.socialInstagramActive={r:171,g:58,b:133};var socialInstagram=exports.socialInstagram={r:183,g:71,b:146};var socialInstagramHover=exports.socialInstagramHover={r:196,g:86,b:160};var betterTogether=exports.betterTogether={r:240,g:78,b:78};var externalTwiiterBlue=exports.externalTwiiterBlue=socialTwitter;var themeDayMain=exports.themeDayMain=uiCarbon;var themeDayMainDark=exports.themeDayMainDark=uiCarbonDark;var themeDayMainDarker=exports.themeDayMainDarker=uiCarbonDarker;var themeDayText=exports.themeDayText=themeDayMain;var themeDayTextSubtle=exports.themeDayTextSubtle=_extends({},themeDayMain,{a:_opacities.opacityTextSubtle});var themeDayTextDisabled=exports.themeDayTextDisabled=_extends({},themeDayMain,{a:_opacities.opacityTextDisabled});var themeDayBackgroundOverlayHeavy=exports.themeDayBackgroundOverlayHeavy=_extends({},themeDayMain,{a:_opacities.opacityBackgroundOverlayHeavy});var themeDayBackgroundOverlayLight=exports.themeDayBackgroundOverlayLight=_extends({},themeDayMain,{a:_opacities.opacityBackgroundOverlayLight});var themeDayBackgroundSubtle=exports.themeDayBackgroundSubtle=_extends({},themeDayMain,{a:_opacities.opacityBackgroundSubtle});var themeDayBackgroundActive=exports.themeDayBackgroundActive=_extends({},themeDayMain,{a:_opacities.opacityBackgroundActive});var themeDayBackgroundDisabled=exports.themeDayBackgroundDisabled=_extends({},themeDayMain,{a:_opacities.opacityBackgroundDisabled});var themeDayBackgroundHover=exports.themeDayBackgroundHover=_extends({},themeDayMain,{a:_opacities.opacityBackgroundHover});var themeDayBorder=exports.themeDayBorder=_extends({},themeDayMain,{a:_opacities.opacityBorder});var themeNightMain=exports.themeNightMain=uiWhiteNoise;var themeNightMainDark=exports.themeNightMainDark=uiWhiteNoiseDark;var themeNightMainDarker=exports.themeNightMainDarker=uiWhiteNoiseDarker;var themeNightText=exports.themeNightText=themeNightMain;var themeNightTextSubtle=exports.themeNightTextSubtle=_extends({},themeNightMain,{a:_opacities.opacityTextSubtle});var themeNightTextDisabled=exports.themeNightTextDisabled=_extends({},themeNightMain,{a:_opacities.opacityTextDisabled});var themeNightBackgroundOverlayHeavy=exports.themeNightBackgroundOverlayHeavy=_extends({},themeNightMain,{a:_opacities.opacityBackgroundOverlayHeavy});var themeNightBackgroundOverlayLight=exports.themeNightBackgroundOverlayLight=_extends({},themeNightMain,{a:_opacities.opacityBackgroundOverlayLight});var themeNightBackgroundSubtle=exports.themeNightBackgroundSubtle=_extends({},themeNightMain,{a:_opacities.opacityBackgroundSubtle});var themeNightBackgroundActive=exports.themeNightBackgroundActive=_extends({},themeNightMain,{a:_opacities.opacityBackgroundActive});var themeNightBackgroundDisabled=exports.themeNightBackgroundDisabled=_extends({},themeNightMain,{a:_opacities.opacityBackgroundDisabled});var themeNightBackgroundHover=exports.themeNightBackgroundHover=_extends({},themeNightMain,{a:_opacities.opacityBackgroundHover});var themeNightBorder=exports.themeNightBorder=_extends({},themeNightMain,{a:_opacities.opacityBorder});var productColorNames=exports.productColorNames={"forbidden-planet":"Forbidden Planet","tiny-clanger":"Tiny Clanger","critical-mass":"Critical Mass","fantastic-voyage":"Fantasitc Voyage","paradise-lost":"Paradise Lost","serene-sea":"Serene Sea","event-horizon":"Event Horizon","electric-dreams":"Electric Dreams","outer-limits":"Outer Limits","giant-leap":"Giant Leap","moon-lagoon":"Moon Lagoon","space-invader":"Space Invader",extraterrestrial:"Extraterrestrial","terra-form":"Terra Form","primeval-soup":"Primeval Soup","future-shock":"Future Shock","sun-maker":"Sun Maker","new-horizon":"New Horizon","blast-off":"Blast Off","crash-course":"Crash Course","solar-rust":"Solar Rust","ground-control":"Ground Control","space-oddity":"Space Oddity","rocky-planet":"Rocky Planet","deep-thought":"Deep Thought","luna-dust":"Luna Dust"};var productColors=exports.productColors={"forbidden-planet":productForbiddenPlanet,"tiny-clanger":productTinyClanger,"critical-mass":productCriticalMass,"fantastic-voyage":productFantasticVoyage,"paradise-lost":productParadiseLost,"serene-sea":productSereneSea,"event-horizon":productEventHorizon,"electric-dreams":productElectricDreams,"outer-limits":productOuterLimits,"giant-leap":productGiantLeap,"moon-lagoon":productMoonLagoon,"space-invader":productSpaceInvader,extraterrestrial:productExtraterrestrial,"terra-form":productTerraForm,"primeval-soup":productPrimevalSoup,"future-shock":productFutureShock,"sun-maker":productSunMaker,"new-horizon":productNewHorizon,"blast-off":productBlastOff,"crash-course":productCrashCourse,"solar-rust":productSolarRust,"ground-control":productGroundControl,"space-oddity":productSpaceOddity,"rocky-planet":productRockyPlanet,"deep-thought":productDeepThought,"luna-dust":productLunaDust};var productActiveColors=exports.productActiveColors={"forbidden-planet":productForbiddenPlanetActive,"tiny-clanger":productTinyClangerActive,"critical-mass":productCriticalMassActive,"fantastic-voyage":productFantasticVoyageActive,"paradise-lost":productParadiseLostActive,"serene-sea":productSereneSeaActive,"event-horizon":productEventHorizonActive,"electric-dreams":productElectricDreamsActive,"outer-limits":productOuterLimitsActive,"giant-leap":productGiantLeapActive,"moon-lagoon":productMoonLagoonActive,"space-invader":productSpaceInvaderActive,extraterrestrial:productExtraterrestrialActive,"terra-form":productTerraFormActive,"primeval-soup":productPrimevalSoupActive,"future-shock":productFutureShockActive,"sun-maker":productSunMakerActive,"new-horizon":productNewHorizonActive,"blast-off":productBlastOffActive,"crash-course":productCrashCourseActive,"solar-rust":productSolarRustActive,"ground-control":productGroundControlActive,"space-oddity":productSpaceOddityActive,"rocky-planet":productRockyPlanetActive,"deep-thought":productDeepThoughtActive,"luna-dust":productLunaDustActive};var productHoverColors=exports.productHoverColors={"forbidden-planet":productForbiddenPlanetHover,"tiny-clanger":productTinyClangerHover,"critical-mass":productCriticalMassHover,"fantastic-voyage":productFantasticVoyageHover,"paradise-lost":productParadiseLostHover,"serene-sea":productSereneSeaHover,"event-horizon":productEventHorizonHover,"electric-dreams":productElectricDreamsHover,"outer-limits":productOuterLimitsHover,"giant-leap":productGiantLeapHover,"moon-lagoon":productMoonLagoonHover,"space-invader":productSpaceInvaderHover,extraterrestrial:productExtraterrestrialHover,"terra-form":productTerraFormHover,"primeval-soup":productPrimevalSoupHover,"future-shock":productFutureShockHover,"sun-maker":productSunMakerHover,"new-horizon":productNewHorizonHover,"blast-off":productBlastOffHover,"crash-course":productCrashCourseHover,"solar-rust":productSolarRustHover,"ground-control":productGroundControlHover,"space-oddity":productSpaceOddityHover,"rocky-planet":productRockyPlanetHover,"deep-thought":productDeepThoughtHover,"luna-dust":productLunaDustHover};var userDefinedGraphColors=exports.userDefinedGraphColors={"tiny-clanger":productTinyClanger,"critical-mass":productCriticalMass,"paradise-lost":productParadiseLost,"serene-sea":productSereneSea,"giant-leap":productGiantLeap,"moon-lagoon":productMoonLagoon,"terra-form":productTerraForm,"primeval-soup":productPrimevalSoup,"new-horizon":productNewHorizon,"blast-off":productBlastOff,"ground-control":productGroundControl,"luna-dust":productLunaDust}},,,,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var dist=__webpack_require__(12);function rgbToHex(rgbColor){return"#".concat(["r","g","b"].map(function(level){return rgbColor[level].toString(16).padStart(2,0).toUpperCase()}).join(""))}var userDefinedGraphColors=Object.values(dist["colors"].userDefinedGraphColors).map(rgbToHex);function chartColorGenerator(){var index=0;return function(){var nextColor=userDefinedGraphColors[index];index=(index+1)%userDefinedGraphColors.length;return nextColor}}var colorsHelper_colors={DEFAULT:"#494B4B",TOPIC_TYPE_WORD:"#494B4B",TOPIC_TYPE_PHRASE:"#9E5320",TOPIC_TYPE_PLACE:"#9C73B2",TOPIC_TYPE_HASH_TAG:"#5ACBDC",TOPIC_TYPE_PERSON:"#DBD403",TOPIC_TYPE_ORGANISATION:"#FF9430",SENTIMENT_POSITIVE:"#4CA15A",SENTIMENT_RATHER_POSITIVE:"#97CEA0",SENTIMENT_NEUTRAL:"#BBB9C0",SENTIMENT_RATHER_NEGATIVE:"#F1C0C0",SENTIMENT_NEGATIVE:"#D74A4A",GENDER_MALE:"#3B74B7",GENDER_FEMALE:"#A72E5E",GENDER_UNKNOWN:"#999999",VOLUME_HIGH:"#3B74B7",VOLUME_MID:"#5ACBDC",VOLUME_LOW:"#C2C2C2",TRENDING_HIGH:"#FF634A",TRENDING_MID:"#F9B800",TRENDING_LOW:"#C2C2C2"};var TOPICS_UI_TYPES={EMOJIS:"Emojis",HASH_TAGS:"Hashtags",LOCATIONS:"Locations",ORGANISATIONS:"Organizations",PEOPLE:"People",PHRASES:"Phrases",KEYWORDS:"Keywords",CATEGORIES:"Categories",TAGS:"Tags",NOUNS:"Nouns",ADJECTIVES:"Adjectives",VERBS:"Verbs"};var api_TOPICS_API_RETURN_TYPES={EMOJI:"emoji",HASH_TAG:"hashtag",PLACE:"place",ORGANISATION:"organisation",PERSON:"person",WORD:"word",PHRASE:"phrase",CATEGORY:"category",TAG:"tag",NOUN:"noun",ADJECTIVE:"adjective",VERB:"verb"};var TOPICS_API_REQUEST_TYPES={EMOJIS:"emojis",HASH_TAGS:"hashtags",PLACES:"places",ORGANISATIONS:"organisations",PEOPLE:"people",PHRASES:"phrases",WORDS:"words",CATEGORIES:"categories",TAGS:"tags",NOUNS:"nouns",ADJECTIVES:"adjectives",VERBS:"verbs"};var TOPICS_UI_SENTIMENT={POSITIVE:"Positive",RATHER_POSITIVE:"Rather Positive",NEUTRAL:"Neutral",RATHER_NEGATIVE:"Rather Negative",NEGATIVE:"Negative"};var TOPICS_UI_GENDERS={MALE:"Male",FEMALE:"Female",UNKNOWN:"Unknown"};var api_TOPICS_UI_NAME_MAP=new Map([[api_TOPICS_API_RETURN_TYPES.EMOJI,TOPICS_UI_TYPES.EMOJIS],[api_TOPICS_API_RETURN_TYPES.HASH_TAG,TOPICS_UI_TYPES.HASH_TAGS],[api_TOPICS_API_RETURN_TYPES.PLACE,TOPICS_UI_TYPES.LOCATIONS],[api_TOPICS_API_RETURN_TYPES.ORGANISATION,TOPICS_UI_TYPES.ORGANISATIONS],[api_TOPICS_API_RETURN_TYPES.PERSON,TOPICS_UI_TYPES.PEOPLE],[api_TOPICS_API_RETURN_TYPES.PHRASE,TOPICS_UI_TYPES.PHRASES],[api_TOPICS_API_RETURN_TYPES.WORD,TOPICS_UI_TYPES.KEYWORDS],[api_TOPICS_API_RETURN_TYPES.CATEGORY,TOPICS_UI_TYPES.CATEGORIES],[api_TOPICS_API_RETURN_TYPES.TAG,TOPICS_UI_TYPES.TAGS],[api_TOPICS_API_RETURN_TYPES.NOUN,TOPICS_UI_TYPES.NOUNS],[api_TOPICS_API_RETURN_TYPES.ADJECTIVE,TOPICS_UI_TYPES.ADJECTIVES],[api_TOPICS_API_RETURN_TYPES.VERB,TOPICS_UI_TYPES.VERBS]]);var TOPICS_NAME_MAP=new Map([[api_TOPICS_API_RETURN_TYPES.EMOJI,TOPICS_API_REQUEST_TYPES.EMOJIS],[api_TOPICS_API_RETURN_TYPES.HASH_TAG,TOPICS_API_REQUEST_TYPES.HASH_TAGS],[api_TOPICS_API_RETURN_TYPES.PLACE,TOPICS_API_REQUEST_TYPES.PLACES],[api_TOPICS_API_RETURN_TYPES.ORGANISATION,TOPICS_API_REQUEST_TYPES.ORGANISATIONS],[api_TOPICS_API_RETURN_TYPES.PERSON,TOPICS_API_REQUEST_TYPES.PEOPLE],[api_TOPICS_API_RETURN_TYPES.WORD,TOPICS_API_REQUEST_TYPES.WORDS],[api_TOPICS_API_RETURN_TYPES.PHRASE,TOPICS_API_REQUEST_TYPES.PHRASES],[api_TOPICS_API_RETURN_TYPES.CATEGORY,TOPICS_API_REQUEST_TYPES.CATEGORIES],[api_TOPICS_API_RETURN_TYPES.TAG,TOPICS_API_REQUEST_TYPES.TAGS],[api_TOPICS_API_RETURN_TYPES.NOUN,TOPICS_API_REQUEST_TYPES.NOUNS],[api_TOPICS_API_RETURN_TYPES.ADJECTIVE,TOPICS_API_REQUEST_TYPES.ADJECTIVES],[api_TOPICS_API_RETURN_TYPES.VERB,TOPICS_API_REQUEST_TYPES.VERBS]]);var TOPICS_SENTIMENT_COLOR_MAP=new Map([[TOPICS_UI_SENTIMENT.POSITIVE,colorsHelper_colors.SENTIMENT_POSITIVE],[TOPICS_UI_SENTIMENT.RATHER_POSITIVE,colorsHelper_colors.SENTIMENT_RATHER_POSITIVE],[TOPICS_UI_SENTIMENT.NEUTRAL,colorsHelper_colors.SENTIMENT_NEUTRAL],[TOPICS_UI_SENTIMENT.RATHER_NEGATIVE,colorsHelper_colors.SENTIMENT_RATHER_NEGATIVE],[TOPICS_UI_SENTIMENT.NEGATIVE,colorsHelper_colors.SENTIMENT_NEGATIVE]]);var TOPICS_GENDER_COLOR_MAP=new Map([[TOPICS_UI_GENDERS.MALE,colorsHelper_colors.GENDER_MALE],[TOPICS_UI_GENDERS.FEMALE,colorsHelper_colors.GENDER_FEMALE],[TOPICS_UI_GENDERS.UNKNOWN,colorsHelper_colors.GENDER_UNKNOWN]]);function flipMap(map){var flippedMap=new Map;map.forEach(function(v,k){return flippedMap.set(v,k)});return flippedMap}var REQUEST_TO_RETURN_MAP=flipMap(TOPICS_NAME_MAP);var TOPICS_REQUEST_UI_MAP=Object.keys(TOPICS_API_REQUEST_TYPES).reduce(function(memo,key){var type=TOPICS_API_REQUEST_TYPES[key];if(REQUEST_TO_RETURN_MAP.has(type)){var returnType=REQUEST_TO_RETURN_MAP.get(type);if(api_TOPICS_UI_NAME_MAP.has(returnType)){memo.set(type,api_TOPICS_UI_NAME_MAP.get(returnType))}}return memo},new Map);var api={TOPICS_REQUEST_UI_MAP:TOPICS_REQUEST_UI_MAP,TOPICS_API_RETURN_TYPES:api_TOPICS_API_RETURN_TYPES,TOPICS_API_REQUEST_TYPES:TOPICS_API_REQUEST_TYPES,TOPICS_NAME_MAP:TOPICS_NAME_MAP,TOPICS_UI_NAME_MAP:api_TOPICS_UI_NAME_MAP,TOPICS_UI_SENTIMENT:TOPICS_UI_SENTIMENT,TOPICS_UI_GENDERS:TOPICS_UI_GENDERS,TOPICS_SENTIMENT_COLOR_MAP:TOPICS_SENTIMENT_COLOR_MAP,TOPICS_GENDER_COLOR_MAP:TOPICS_GENDER_COLOR_MAP};var define=function(constructor,factory,prototype){constructor.prototype=factory.prototype=prototype;prototype.constructor=constructor};function extend(parent,definition){var prototype=Object.create(parent.prototype);for(var key in definition)prototype[key]=definition[key];return prototype}function Color(){}var darker=.7;var brighter=1/darker;var reI="\\s*([+-]?\\d+)\\s*",reN="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",reP="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",reHex3=/^#([0-9a-f]{3})$/,reHex6=/^#([0-9a-f]{6})$/,reRgbInteger=new RegExp("^rgb\\("+[reI,reI,reI]+"\\)$"),reRgbPercent=new RegExp("^rgb\\("+[reP,reP,reP]+"\\)$"),reRgbaInteger=new RegExp("^rgba\\("+[reI,reI,reI,reN]+"\\)$"),reRgbaPercent=new RegExp("^rgba\\("+[reP,reP,reP,reN]+"\\)$"),reHslPercent=new RegExp("^hsl\\("+[reN,reP,reP]+"\\)$"),reHslaPercent=new RegExp("^hsla\\("+[reN,reP,reP,reN]+"\\)$");var named={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};define(Color,color_color,{displayable:function(){return this.rgb().displayable()},hex:function(){return this.rgb().hex()},toString:function(){return this.rgb()+""}});function color_color(format){var m;format=(format+"").trim().toLowerCase();return(m=reHex3.exec(format))?(m=parseInt(m[1],16),new Rgb(m>>8&15|m>>4&240,m>>4&15|m&240,(m&15)<<4|m&15,1)):(m=reHex6.exec(format))?rgbn(parseInt(m[1],16)):(m=reRgbInteger.exec(format))?new Rgb(m[1],m[2],m[3],1):(m=reRgbPercent.exec(format))?new Rgb(m[1]*255/100,m[2]*255/100,m[3]*255/100,1):(m=reRgbaInteger.exec(format))?rgba(m[1],m[2],m[3],m[4]):(m=reRgbaPercent.exec(format))?rgba(m[1]*255/100,m[2]*255/100,m[3]*255/100,m[4]):(m=reHslPercent.exec(format))?hsla(m[1],m[2]/100,m[3]/100,1):(m=reHslaPercent.exec(format))?hsla(m[1],m[2]/100,m[3]/100,m[4]):named.hasOwnProperty(format)?rgbn(named[format]):format==="transparent"?new Rgb(NaN,NaN,NaN,0):null}function rgbn(n){return new Rgb(n>>16&255,n>>8&255,n&255,1)}function rgba(r,g,b,a){if(a<=0)r=g=b=NaN;return new Rgb(r,g,b,a)}function rgbConvert(o){if(!(o instanceof Color))o=color_color(o);if(!o)return new Rgb;o=o.rgb();return new Rgb(o.r,o.g,o.b,o.opacity)}function color_rgb(r,g,b,opacity){return arguments.length===1?rgbConvert(r):new Rgb(r,g,b,opacity==null?1:opacity)}function Rgb(r,g,b,opacity){this.r=+r;this.g=+g;this.b=+b;this.opacity=+opacity}define(Rgb,color_rgb,extend(Color,{brighter:function(k){k=k==null?brighter:Math.pow(brighter,k);return new Rgb(this.r*k,this.g*k,this.b*k,this.opacity)},darker:function(k){k=k==null?darker:Math.pow(darker,k);return new Rgb(this.r*k,this.g*k,this.b*k,this.opacity)},rgb:function(){return this},displayable:function(){return 0<=this.r&&this.r<=255&&(0<=this.g&&this.g<=255)&&(0<=this.b&&this.b<=255)&&(0<=this.opacity&&this.opacity<=1)},hex:function(){return"#"+hex(this.r)+hex(this.g)+hex(this.b)},toString:function(){var a=this.opacity;a=isNaN(a)?1:Math.max(0,Math.min(1,a));return(a===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(a===1?")":", "+a+")")}}));function hex(value){value=Math.max(0,Math.min(255,Math.round(value)||0));return(value<16?"0":"")+value.toString(16)}function hsla(h,s,l,a){if(a<=0)h=s=l=NaN;else if(l<=0||l>=1)h=s=NaN;else if(s<=0)h=NaN;return new Hsl(h,s,l,a)}function hslConvert(o){if(o instanceof Hsl)return new Hsl(o.h,o.s,o.l,o.opacity);if(!(o instanceof Color))o=color_color(o);if(!o)return new Hsl;if(o instanceof Hsl)return o;o=o.rgb();var r=o.r/255,g=o.g/255,b=o.b/255,min=Math.min(r,g,b),max=Math.max(r,g,b),h=NaN,s=max-min,l=(max+min)/2;if(s){if(r===max)h=(g-b)/s+(g<b)*6;else if(g===max)h=(b-r)/s+2;else h=(r-g)/s+4;s/=l<.5?max+min:2-max-min;h*=60}else{s=l>0&&l<1?0:h}return new Hsl(h,s,l,o.opacity)}function hsl(h,s,l,opacity){return arguments.length===1?hslConvert(h):new Hsl(h,s,l,opacity==null?1:opacity)}function Hsl(h,s,l,opacity){this.h=+h;this.s=+s;this.l=+l;this.opacity=+opacity}define(Hsl,hsl,extend(Color,{brighter:function(k){k=k==null?brighter:Math.pow(brighter,k);return new Hsl(this.h,this.s,this.l*k,this.opacity)},darker:function(k){k=k==null?darker:Math.pow(darker,k);return new Hsl(this.h,this.s,this.l*k,this.opacity)},rgb:function(){var h=this.h%360+(this.h<0)*360,s=isNaN(h)||isNaN(this.s)?0:this.s,l=this.l,m2=l+(l<.5?l:1-l)*s,m1=2*l-m2;return new Rgb(hsl2rgb(h>=240?h-240:h+120,m1,m2),hsl2rgb(h,m1,m2),hsl2rgb(h<120?h+240:h-120,m1,m2),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&(0<=this.l&&this.l<=1)&&(0<=this.opacity&&this.opacity<=1)}}));function hsl2rgb(h,m1,m2){return(h<60?m1+(m2-m1)*h/60:h<180?m2:h<240?m1+(m2-m1)*(240-h)/60:m1)*255}var deg2rad=Math.PI/180;var rad2deg=180/Math.PI;var K=18,Xn=.96422,Yn=1,Zn=.82521,t0=4/29,t1=6/29,t2=3*t1*t1,t3=t1*t1*t1;function labConvert(o){if(o instanceof Lab)return new Lab(o.l,o.a,o.b,o.opacity);if(o instanceof Hcl){if(isNaN(o.h))return new Lab(o.l,0,0,o.opacity);var h=o.h*deg2rad;return new Lab(o.l,Math.cos(h)*o.c,Math.sin(h)*o.c,o.opacity)}if(!(o instanceof Rgb))o=rgbConvert(o);var r=rgb2lrgb(o.r),g=rgb2lrgb(o.g),b=rgb2lrgb(o.b),y=xyz2lab((.2225045*r+.7168786*g+.0606169*b)/Yn),x,z;if(r===g&&g===b)x=z=y;else{x=xyz2lab((.4360747*r+.3850649*g+.1430804*b)/Xn);z=xyz2lab((.0139322*r+.0971045*g+.7141733*b)/Zn)}return new Lab(116*y-16,500*(x-y),200*(y-z),o.opacity)}function gray(l,opacity){return new Lab(l,0,0,opacity==null?1:opacity)}function lab(l,a,b,opacity){return arguments.length===1?labConvert(l):new Lab(l,a,b,opacity==null?1:opacity)}function Lab(l,a,b,opacity){this.l=+l;this.a=+a;this.b=+b;this.opacity=+opacity}define(Lab,lab,extend(Color,{brighter:function(k){return new Lab(this.l+K*(k==null?1:k),this.a,this.b,this.opacity)},darker:function(k){return new Lab(this.l-K*(k==null?1:k),this.a,this.b,this.opacity)},rgb:function(){var y=(this.l+16)/116,x=isNaN(this.a)?y:y+this.a/500,z=isNaN(this.b)?y:y-this.b/200;x=Xn*lab2xyz(x);y=Yn*lab2xyz(y);z=Zn*lab2xyz(z);return new Rgb(lrgb2rgb(3.1338561*x-1.6168667*y-.4906146*z),lrgb2rgb(-.9787684*x+1.9161415*y+.033454*z),lrgb2rgb(.0719453*x-.2289914*y+1.4052427*z),this.opacity)}}));function xyz2lab(t){return t>t3?Math.pow(t,1/3):t/t2+t0}function lab2xyz(t){return t>t1?t*t*t:t2*(t-t0)}function lrgb2rgb(x){return 255*(x<=.0031308?12.92*x:1.055*Math.pow(x,1/2.4)-.055)}function rgb2lrgb(x){return(x/=255)<=.04045?x/12.92:Math.pow((x+.055)/1.055,2.4)}function hclConvert(o){if(o instanceof Hcl)return new Hcl(o.h,o.c,o.l,o.opacity);if(!(o instanceof Lab))o=labConvert(o);if(o.a===0&&o.b===0)return new Hcl(NaN,0,o.l,o.opacity);var h=Math.atan2(o.b,o.a)*rad2deg;return new Hcl(h<0?h+360:h,Math.sqrt(o.a*o.a+o.b*o.b),o.l,o.opacity)}function lch(l,c,h,opacity){return arguments.length===1?hclConvert(l):new Hcl(h,c,l,opacity==null?1:opacity)}function hcl(h,c,l,opacity){return arguments.length===1?hclConvert(h):new Hcl(h,c,l,opacity==null?1:opacity)}function Hcl(h,c,l,opacity){this.h=+h;this.c=+c;this.l=+l;this.opacity=+opacity}define(Hcl,hcl,extend(Color,{brighter:function(k){return new Hcl(this.h,this.c,this.l+K*(k==null?1:k),this.opacity)},darker:function(k){return new Hcl(this.h,this.c,this.l-K*(k==null?1:k),this.opacity)},rgb:function(){return labConvert(this).rgb()}}));var A=-.14861,B=+1.78277,C=-.29227,D=-.90649,E=+1.97294,ED=E*D,EB=E*B,BC_DA=B*C-D*A;function cubehelixConvert(o){if(o instanceof Cubehelix)return new Cubehelix(o.h,o.s,o.l,o.opacity);if(!(o instanceof Rgb))o=rgbConvert(o);var r=o.r/255,g=o.g/255,b=o.b/255,l=(BC_DA*b+ED*r-EB*g)/(BC_DA+ED-EB),bl=b-l,k=(E*(g-l)-C*bl)/D,s=Math.sqrt(k*k+bl*bl)/(E*l*(1-l)),h=s?Math.atan2(k,bl)*rad2deg-120:NaN;return new Cubehelix(h<0?h+360:h,s,l,o.opacity)}function cubehelix_cubehelix(h,s,l,opacity){return arguments.length===1?cubehelixConvert(h):new Cubehelix(h,s,l,opacity==null?1:opacity)}function Cubehelix(h,s,l,opacity){this.h=+h;this.s=+s;this.l=+l;this.opacity=+opacity}define(Cubehelix,cubehelix_cubehelix,extend(Color,{brighter:function(k){k=k==null?brighter:Math.pow(brighter,k);return new Cubehelix(this.h,this.s,this.l*k,this.opacity)},darker:function(k){k=k==null?darker:Math.pow(darker,k);return new Cubehelix(this.h,this.s,this.l*k,this.opacity)},rgb:function(){var h=isNaN(this.h)?0:(this.h+120)*deg2rad,l=+this.l,a=isNaN(this.s)?0:this.s*l*(1-l),cosh=Math.cos(h),sinh=Math.sin(h);return new Rgb(255*(l+a*(A*cosh+B*sinh)),255*(l+a*(C*cosh+D*sinh)),255*(l+a*(E*cosh)),this.opacity)}}));function basis(t1,v0,v1,v2,v3){var t2=t1*t1,t3=t2*t1;return((1-3*t1+3*t2-t3)*v0+(4-6*t2+3*t3)*v1+(1+3*t1+3*t2-3*t3)*v2+t3*v3)/6}var src_basis=function(values){var n=values.length-1;return function(t){var i=t<=0?t=0:t>=1?(t=1,n-1):Math.floor(t*n),v1=values[i],v2=values[i+1],v0=i>0?values[i-1]:2*v1-v2,v3=i<n-1?values[i+2]:2*v2-v1;return basis((t-i/n)*n,v0,v1,v2,v3)}};var basisClosed=function(values){var n=values.length;return function(t){var i=Math.floor(((t%=1)<0?++t:t)*n),v0=values[(i+n-1)%n],v1=values[i%n],v2=values[(i+1)%n],v3=values[(i+2)%n];return basis((t-i/n)*n,v0,v1,v2,v3)}};var constant=function(x){return function(){return x}};function linear(a,d){return function(t){return a+t*d}}function exponential(a,b,y){return a=Math.pow(a,y),b=Math.pow(b,y)-a,y=1/y,function(t){return Math.pow(a+t*b,y)}}function color_hue(a,b){var d=b-a;return d?linear(a,d>180||d<-180?d-360*Math.round(d/360):d):constant(isNaN(a)?b:a)}function gamma(y){return(y=+y)===1?nogamma:function(a,b){return b-a?exponential(a,b,y):constant(isNaN(a)?b:a)}}function nogamma(a,b){var d=b-a;return d?linear(a,d):constant(isNaN(a)?b:a)}var src_rgb=function rgbGamma(y){var color=gamma(y);function rgb(start,end){var r=color((start=color_rgb(start)).r,(end=color_rgb(end)).r),g=color(start.g,end.g),b=color(start.b,end.b),opacity=nogamma(start.opacity,end.opacity);return function(t){start.r=r(t);start.g=g(t);start.b=b(t);start.opacity=opacity(t);return start+""}}rgb.gamma=rgbGamma;return rgb}(1);function rgbSpline(spline){return function(colors){var n=colors.length,r=new Array(n),g=new Array(n),b=new Array(n),i,color;for(i=0;i<n;++i){color=color_rgb(colors[i]);r[i]=color.r||0;g[i]=color.g||0;b[i]=color.b||0}r=spline(r);g=spline(g);b=spline(b);color.opacity=1;return function(t){color.r=r(t);color.g=g(t);color.b=b(t);return color+""}}}var rgbBasis=rgbSpline(src_basis);var rgbBasisClosed=rgbSpline(basisClosed);var src_array=function(a,b){var nb=b?b.length:0,na=a?Math.min(nb,a.length):0,x=new Array(na),c=new Array(nb),i;for(i=0;i<na;++i)x[i]=src_value(a[i],b[i]);for(;i<nb;++i)c[i]=b[i];return function(t){for(i=0;i<na;++i)c[i]=x[i](t);return c}};var src_date=function(a,b){var d=new Date;return a=+a,b-=a,function(t){return d.setTime(a+b*t),d}};var number=function(a,b){return a=+a,b-=a,function(t){return a+b*t}};var object=function(a,b){var i={},c={},k;if(a===null||typeof a!=="object")a={};if(b===null||typeof b!=="object")b={};for(k in b){if(k in a){i[k]=src_value(a[k],b[k])}else{c[k]=b[k]}}return function(t){for(k in i)c[k]=i[k](t);return c}};var reA=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,reB=new RegExp(reA.source,"g");function string_zero(b){return function(){return b}}function one(b){return function(t){return b(t)+""}}var src_string=function(a,b){var bi=reA.lastIndex=reB.lastIndex=0,am,bm,bs,i=-1,s=[],q=[];a=a+"",b=b+"";while((am=reA.exec(a))&&(bm=reB.exec(b))){if((bs=bm.index)>bi){bs=b.slice(bi,bs);if(s[i])s[i]+=bs;else s[++i]=bs}if((am=am[0])===(bm=bm[0])){if(s[i])s[i]+=bm;else s[++i]=bm}else{s[++i]=null;q.push({i:i,x:number(am,bm)})}bi=reB.lastIndex}if(bi<b.length){bs=b.slice(bi);if(s[i])s[i]+=bs;else s[++i]=bs}return s.length<2?q[0]?one(q[0].x):string_zero(b):(b=q.length,function(t){for(var i=0,o;i<b;++i)s[(o=q[i]).i]=o.x(t);return s.join("")})};var src_value=function(a,b){var t=typeof b,c;return b==null||t==="boolean"?constant(b):(t==="number"?number:t==="string"?(c=color_color(b))?(b=c,src_rgb):src_string:b instanceof color_color?src_rgb:b instanceof Date?src_date:Array.isArray(b)?src_array:typeof b.valueOf!=="function"&&typeof b.toString!=="function"||isNaN(b)?object:number)(a,b)};var discrete=function(range){var n=range.length;return function(t){return range[Math.max(0,Math.min(n-1,Math.floor(t*n)))]}};var src_hue=function(a,b){var i=color_hue(+a,+b);return function(t){var x=i(t);return x-360*Math.floor(x/360)}};var src_round=function(a,b){return a=+a,b-=a,function(t){return Math.round(a+b*t)}};var degrees=180/Math.PI;var identity={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};var decompose=function(a,b,c,d,e,f){var scaleX,scaleY,skewX;if(scaleX=Math.sqrt(a*a+b*b))a/=scaleX,b/=scaleX;if(skewX=a*c+b*d)c-=a*skewX,d-=b*skewX;if(scaleY=Math.sqrt(c*c+d*d))c/=scaleY,d/=scaleY,skewX/=scaleY;if(a*d<b*c)a=-a,b=-b,skewX=-skewX,scaleX=-scaleX;return{translateX:e,translateY:f,rotate:Math.atan2(b,a)*degrees,skewX:Math.atan(skewX)*degrees,scaleX:scaleX,scaleY:scaleY}};var cssNode,cssRoot,cssView,svgNode;function parseCss(value){if(value==="none")return identity;if(!cssNode)cssNode=document.createElement("DIV"),cssRoot=document.documentElement,cssView=document.defaultView;cssNode.style.transform=value;value=cssView.getComputedStyle(cssRoot.appendChild(cssNode),null).getPropertyValue("transform");cssRoot.removeChild(cssNode);value=value.slice(7,-1).split(",");return decompose(+value[0],+value[1],+value[2],+value[3],+value[4],+value[5])}function parseSvg(value){if(value==null)return identity;if(!svgNode)svgNode=document.createElementNS("http://www.w3.org/2000/svg","g");svgNode.setAttribute("transform",value);if(!(value=svgNode.transform.baseVal.consolidate()))return identity;value=value.matrix;return decompose(value.a,value.b,value.c,value.d,value.e,value.f)}function interpolateTransform(parse,pxComma,pxParen,degParen){function pop(s){return s.length?s.pop()+" ":""}function translate(xa,ya,xb,yb,s,q){if(xa!==xb||ya!==yb){var i=s.push("translate(",null,pxComma,null,pxParen);q.push({i:i-4,x:number(xa,xb)},{i:i-2,x:number(ya,yb)})}else if(xb||yb){s.push("translate("+xb+pxComma+yb+pxParen)}}function rotate(a,b,s,q){if(a!==b){if(a-b>180)b+=360;else if(b-a>180)a+=360;q.push({i:s.push(pop(s)+"rotate(",null,degParen)-2,x:number(a,b)})}else if(b){s.push(pop(s)+"rotate("+b+degParen)}}function skewX(a,b,s,q){if(a!==b){q.push({i:s.push(pop(s)+"skewX(",null,degParen)-2,x:number(a,b)})}else if(b){s.push(pop(s)+"skewX("+b+degParen)}}function scale(xa,ya,xb,yb,s,q){if(xa!==xb||ya!==yb){var i=s.push(pop(s)+"scale(",null,",",null,")");q.push({i:i-4,x:number(xa,xb)},{i:i-2,x:number(ya,yb)})}else if(xb!==1||yb!==1){s.push(pop(s)+"scale("+xb+","+yb+")")}}return function(a,b){var s=[],q=[];a=parse(a),b=parse(b);translate(a.translateX,a.translateY,b.translateX,b.translateY,s,q);rotate(a.rotate,b.rotate,s,q);skewX(a.skewX,b.skewX,s,q);scale(a.scaleX,a.scaleY,b.scaleX,b.scaleY,s,q);a=b=null;return function(t){var i=-1,n=q.length,o;while(++i<n)s[(o=q[i]).i]=o.x(t);return s.join("")}}}var interpolateTransformCss=interpolateTransform(parseCss,"px, ","px)","deg)");var interpolateTransformSvg=interpolateTransform(parseSvg,", ",")",")");var rho=Math.SQRT2,rho2=2,rho4=4,epsilon2=1e-12;function zoom_cosh(x){return((x=Math.exp(x))+1/x)/2}function zoom_sinh(x){return((x=Math.exp(x))-1/x)/2}function tanh(x){return((x=Math.exp(2*x))-1)/(x+1)}var zoom=function(p0,p1){var ux0=p0[0],uy0=p0[1],w0=p0[2],ux1=p1[0],uy1=p1[1],w1=p1[2],dx=ux1-ux0,dy=uy1-uy0,d2=dx*dx+dy*dy,i,S;if(d2<epsilon2){S=Math.log(w1/w0)/rho;i=function(t){return[ux0+t*dx,uy0+t*dy,w0*Math.exp(rho*t*S)]}}else{var d1=Math.sqrt(d2),b0=(w1*w1-w0*w0+rho4*d2)/(2*w0*rho2*d1),b1=(w1*w1-w0*w0-rho4*d2)/(2*w1*rho2*d1),r0=Math.log(Math.sqrt(b0*b0+1)-b0),r1=Math.log(Math.sqrt(b1*b1+1)-b1);S=(r1-r0)/rho;i=function(t){var s=t*S,coshr0=zoom_cosh(r0),u=w0/(rho2*d1)*(coshr0*tanh(rho*s+r0)-zoom_sinh(r0));return[ux0+u*dx,uy0+u*dy,w0*coshr0/zoom_cosh(rho*s+r0)]}}i.duration=S*1e3;return i};function hsl_hsl(hue){return function(start,end){var h=hue((start=hsl(start)).h,(end=hsl(end)).h),s=nogamma(start.s,end.s),l=nogamma(start.l,end.l),opacity=nogamma(start.opacity,end.opacity);return function(t){start.h=h(t);start.s=s(t);start.l=l(t);start.opacity=opacity(t);return start+""}}}var src_hsl=hsl_hsl(color_hue);var hslLong=hsl_hsl(nogamma);function lab_lab(start,end){var l=nogamma((start=lab(start)).l,(end=lab(end)).l),a=nogamma(start.a,end.a),b=nogamma(start.b,end.b),opacity=nogamma(start.opacity,end.opacity);return function(t){start.l=l(t);start.a=a(t);start.b=b(t);start.opacity=opacity(t);return start+""}}function hcl_hcl(hue){return function(start,end){var h=hue((start=hcl(start)).h,(end=hcl(end)).h),c=nogamma(start.c,end.c),l=nogamma(start.l,end.l),opacity=nogamma(start.opacity,end.opacity);return function(t){start.h=h(t);start.c=c(t);start.l=l(t);start.opacity=opacity(t);return start+""}}}var src_hcl=hcl_hcl(color_hue);var hclLong=hcl_hcl(nogamma);function src_cubehelix_cubehelix(hue){return function cubehelixGamma(y){y=+y;function cubehelix(start,end){var h=hue((start=cubehelix_cubehelix(start)).h,(end=cubehelix_cubehelix(end)).h),s=nogamma(start.s,end.s),l=nogamma(start.l,end.l),opacity=nogamma(start.opacity,end.opacity);return function(t){start.h=h(t);start.s=s(t);start.l=l(Math.pow(t,y));start.opacity=opacity(t);return start+""}}cubehelix.gamma=cubehelixGamma;return cubehelix}(1)}var src_cubehelix=src_cubehelix_cubehelix(color_hue);var cubehelixLong=src_cubehelix_cubehelix(nogamma);function piecewise_piecewise(interpolate,values){var i=0,n=values.length-1,v=values[0],I=new Array(n<0?0:n);while(i<n)I[i]=interpolate(v,v=values[++i]);return function(t){var i=Math.max(0,Math.min(n-1,Math.floor(t*=n)));return I[i](t-i)}}var quantize=function(interpolator,n){var samples=new Array(n);for(var i=0;i<n;++i)samples[i]=interpolator(i/(n-1));return samples};var COLOR_BY_TOPIC_TYPE="topicType";function getLegend(props){var colorBy=props.colorBy;var legendSettings=Object.assign(props,{colorBy:colorBy});var legendKey;var discreteLegends=["topicType","sentiment","gender"];var continuousLegends=["volume","trending"];if(discreteLegends.includes(colorBy)){legendKey=getLegendForDiscreteKey(legendSettings)}if(continuousLegends.includes(colorBy)){legendKey=getLegendForContinuousKey(legendSettings)}return legendKey}function visibleTopicsForColorByTopicType(filteredTopics){return function(field){return filteredTopics.some(function(topic){return field.type===topic.type})}}function getLegendForDiscreteKey(_ref){var colorBy=_ref.colorBy,topics=_ref.topics;var fields=[];var TOPICS_UI_NAME_MAP=api.TOPICS_UI_NAME_MAP,TOPICS_API_RETURN_TYPES=api.TOPICS_API_RETURN_TYPES;if(colorBy===COLOR_BY_TOPIC_TYPE){fields=[{label:TOPICS_UI_NAME_MAP.get(TOPICS_API_RETURN_TYPES.HASH_TAG),type:TOPICS_API_RETURN_TYPES.HASH_TAG,color:colorsHelper_colors.TOPIC_TYPE_HASH_TAG},{label:TOPICS_UI_NAME_MAP.get(TOPICS_API_RETURN_TYPES.PLACE),type:TOPICS_API_RETURN_TYPES.PLACE,color:colorsHelper_colors.TOPIC_TYPE_PLACE},{label:TOPICS_UI_NAME_MAP.get(TOPICS_API_RETURN_TYPES.ORGANISATION),type:TOPICS_API_RETURN_TYPES.ORGANISATION,color:colorsHelper_colors.TOPIC_TYPE_ORGANISATION},{label:TOPICS_UI_NAME_MAP.get(TOPICS_API_RETURN_TYPES.PERSON),type:TOPICS_API_RETURN_TYPES.PERSON,color:colorsHelper_colors.TOPIC_TYPE_PERSON},{label:TOPICS_UI_NAME_MAP.get(TOPICS_API_RETURN_TYPES.PHRASE),type:TOPICS_API_RETURN_TYPES.PHRASE,color:colorsHelper_colors.TOPIC_TYPE_PHRASE},{label:TOPICS_UI_NAME_MAP.get(TOPICS_API_RETURN_TYPES.WORD),type:TOPICS_API_RETURN_TYPES.WORD,color:colorsHelper_colors.TOPIC_TYPE_WORD}].filter(visibleTopicsForColorByTopicType(topics)).map(function(_ref2){var label=_ref2.label,color=_ref2.color;return{label:label,color:color}})}if(colorBy==="sentiment"){fields=[{label:"Negative",color:colorsHelper_colors.SENTIMENT_NEGATIVE},{label:"Neutral",color:colorsHelper_colors.SENTIMENT_NEUTRAL},{label:"Positive",color:colorsHelper_colors.SENTIMENT_POSITIVE}]}if(colorBy==="gender"){fields=[{label:"Male",color:colorsHelper_colors.GENDER_MALE},{label:"Female",color:colorsHelper_colors.GENDER_FEMALE},{label:"Unknown",color:colorsHelper_colors.GENDER_UNKNOWN}]}return{type:"discrete",fields:fields}}function getLegendForContinuousKey(_ref3){var colorBy=_ref3.colorBy,maxVolume=_ref3.maxVolume;var range;var mainLabel;var startLabel;var endLabel;var gradientColor;if(colorBy==="volume"){var fn=src_value(0,maxVolume);range=[fn(0),fn(.25),fn(.5),fn(.75),fn(1)].map(Math.ceil);mainLabel="Total mentions";gradientColor={start:"#c2c2c2",middle:"#5acbdc",end:"#3b74b7"}}if(colorBy==="trending"){startLabel="Fading";endLabel="Trending";range=null;gradientColor={start:"#c2c2c2",middle:"#f9b800",end:"#ff634a"}}return{type:"continuous",colorBy:colorBy,range:range,mainLabel:mainLabel,startLabel:startLabel,endLabel:endLabel,gradientColor:gradientColor}}var legendHelper=getLegend;function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(iter){if(Symbol.iterator in Object(iter)||Object.prototype.toString.call(iter)==="[object Arguments]")return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};var ownKeys=Object.keys(source);if(typeof Object.getOwnPropertySymbols==="function"){ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))}ownKeys.forEach(function(key){_defineProperty(target,key,source[key])})}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function mapTopicsForVis(topics,wordSize,colorBy){var options={maxValue:findMaxValue(topics,colorBy),minValue:findMinValue(topics,colorBy)};return topics.map(function(topic){var coreProps={id:topic.id,type:topic.type,size:topic[wordSize],value:topic.generateText(),color:topic.getColorForMetric(colorBy,options)};var extraProps={};if(topic.hasOwnProperty("position")&&topic.position.hasOwnProperty("x")){extraProps.position={x:topic.position.x}}return _objectSpread({},coreProps,extraProps)})}var findMaxValue=function findMaxValue(topics,valueProperty){return Math.max.apply(Math,_toConsumableArray(topics.map(function(topic){return topic[valueProperty]})))};var findMinValue=function findMinValue(topics,valueProperty){return Math.min.apply(Math,_toConsumableArray(topics.map(function(topic){return topic[valueProperty]})))};var topicsToVis=mapTopicsForVis;var ascending=function(a,b){return a<b?-1:a>b?1:a>=b?0:NaN};var bisector=function(compare){if(compare.length===1)compare=ascendingComparator(compare);return{left:function(a,x,lo,hi){if(lo==null)lo=0;if(hi==null)hi=a.length;while(lo<hi){var mid=lo+hi>>>1;if(compare(a[mid],x)<0)lo=mid+1;else hi=mid}return lo},right:function(a,x,lo,hi){if(lo==null)lo=0;if(hi==null)hi=a.length;while(lo<hi){var mid=lo+hi>>>1;if(compare(a[mid],x)>0)hi=mid;else lo=mid+1}return lo}}};function ascendingComparator(f){return function(d,x){return ascending(f(d),x)}}var ascendingBisect=bisector(ascending);var bisectRight=ascendingBisect.right;var bisectLeft=ascendingBisect.left;var bisect=bisectRight;var pairs=function(array,f){if(f==null)f=pair;var i=0,n=array.length-1,p=array[0],pairs=new Array(n<0?0:n);while(i<n)pairs[i]=f(p,p=array[++i]);return pairs};function pair(a,b){return[a,b]}var cross=function(values0,values1,reduce){var n0=values0.length,n1=values1.length,values=new Array(n0*n1),i0,i1,i,value0;if(reduce==null)reduce=pair;for(i0=i=0;i0<n0;++i0){for(value0=values0[i0],i1=0;i1<n1;++i1,++i){values[i]=reduce(value0,values1[i1])}}return values};var descending=function(a,b){return b<a?-1:b>a?1:b>=a?0:NaN};var src_number=function(x){return x===null?NaN:+x};var variance=function(values,valueof){var n=values.length,m=0,i=-1,mean=0,value,delta,sum=0;if(valueof==null){while(++i<n){if(!isNaN(value=src_number(values[i]))){delta=value-mean;mean+=delta/++m;sum+=delta*(value-mean)}}}else{while(++i<n){if(!isNaN(value=src_number(valueof(values[i],i,values)))){delta=value-mean;mean+=delta/++m;sum+=delta*(value-mean)}}}if(m>1)return sum/(m-1)};var deviation=function(array,f){var v=variance(array,f);return v?Math.sqrt(v):v};var extent=function(values,valueof){var n=values.length,i=-1,value,min,max;if(valueof==null){while(++i<n){if((value=values[i])!=null&&value>=value){min=max=value;while(++i<n){if((value=values[i])!=null){if(min>value)min=value;if(max<value)max=value}}}}}else{while(++i<n){if((value=valueof(values[i],i,values))!=null&&value>=value){min=max=value;while(++i<n){if((value=valueof(values[i],i,values))!=null){if(min>value)min=value;if(max<value)max=value}}}}}return[min,max]};var array_array=Array.prototype;var slice=array_array.slice;var map=array_array.map;var src_constant=function(x){return function(){return x}};var src_identity=function(x){return x};var src_range=function(start,stop,step){start=+start,stop=+stop,step=(n=arguments.length)<2?(stop=start,start=0,1):n<3?1:+step;var i=-1,n=Math.max(0,Math.ceil((stop-start)/step))|0,range=new Array(n);while(++i<n){range[i]=start+i*step}return range};var e10=Math.sqrt(50),e5=Math.sqrt(10),e2=Math.sqrt(2);var ticks=function(start,stop,count){var reverse,i=-1,n,ticks,step;stop=+stop,start=+start,count=+count;if(start===stop&&count>0)return[start];if(reverse=stop<start)n=start,start=stop,stop=n;if((step=tickIncrement(start,stop,count))===0||!isFinite(step))return[];if(step>0){start=Math.ceil(start/step);stop=Math.floor(stop/step);ticks=new Array(n=Math.ceil(stop-start+1));while(++i<n)ticks[i]=(start+i)*step}else{start=Math.floor(start*step);stop=Math.ceil(stop*step);ticks=new Array(n=Math.ceil(start-stop+1));while(++i<n)ticks[i]=(start-i)/step}if(reverse)ticks.reverse();return ticks};function tickIncrement(start,stop,count){var step=(stop-start)/Math.max(0,count),power=Math.floor(Math.log(step)/Math.LN10),error=step/Math.pow(10,power);return power>=0?(error>=e10?10:error>=e5?5:error>=e2?2:1)*Math.pow(10,power):-Math.pow(10,-power)/(error>=e10?10:error>=e5?5:error>=e2?2:1)}function tickStep(start,stop,count){var step0=Math.abs(stop-start)/Math.max(0,count),step1=Math.pow(10,Math.floor(Math.log(step0)/Math.LN10)),error=step0/step1;if(error>=e10)step1*=10;else if(error>=e5)step1*=5;else if(error>=e2)step1*=2;return stop<start?-step1:step1}var sturges=function(values){return Math.ceil(Math.log(values.length)/Math.LN2)+1};var src_histogram=function(){var value=src_identity,domain=extent,threshold=sturges;function histogram(data){var i,n=data.length,x,values=new Array(n);for(i=0;i<n;++i){values[i]=value(data[i],i,data)}var xz=domain(values),x0=xz[0],x1=xz[1],tz=threshold(values,x0,x1);if(!Array.isArray(tz)){tz=tickStep(x0,x1,tz);tz=src_range(Math.ceil(x0/tz)*tz,x1,tz)}var m=tz.length;while(tz[0]<=x0)tz.shift(),--m;while(tz[m-1]>x1)tz.pop(),--m;var bins=new Array(m+1),bin;for(i=0;i<=m;++i){bin=bins[i]=[];bin.x0=i>0?tz[i-1]:x0;bin.x1=i<m?tz[i]:x1}for(i=0;i<n;++i){x=values[i];if(x0<=x&&x<=x1){bins[bisect(tz,x,0,m)].push(data[i])}}return bins}histogram.value=function(_){return arguments.length?(value=typeof _==="function"?_:src_constant(_),histogram):value};histogram.domain=function(_){return arguments.length?(domain=typeof _==="function"?_:src_constant([_[0],_[1]]),histogram):domain};histogram.thresholds=function(_){return arguments.length?(threshold=typeof _==="function"?_:Array.isArray(_)?src_constant(slice.call(_)):src_constant(_),histogram):threshold};return histogram};var quantile=function(values,p,valueof){if(valueof==null)valueof=src_number;if(!(n=values.length))return;if((p=+p)<=0||n<2)return+valueof(values[0],0,values);if(p>=1)return+valueof(values[n-1],n-1,values);var n,i=(n-1)*p,i0=Math.floor(i),value0=+valueof(values[i0],i0,values),value1=+valueof(values[i0+1],i0+1,values);return value0+(value1-value0)*(i-i0)};var freedmanDiaconis=function(values,min,max){values=map.call(values,src_number).sort(ascending);return Math.ceil((max-min)/(2*(quantile(values,.75)-quantile(values,.25))*Math.pow(values.length,-1/3)))};var scott=function(values,min,max){return Math.ceil((max-min)/(3.5*deviation(values)*Math.pow(values.length,-1/3)))};var src_max=function(values,valueof){var n=values.length,i=-1,value,max;if(valueof==null){while(++i<n){if((value=values[i])!=null&&value>=value){max=value;while(++i<n){if((value=values[i])!=null&&value>max){max=value}}}}}else{while(++i<n){if((value=valueof(values[i],i,values))!=null&&value>=value){max=value;while(++i<n){if((value=valueof(values[i],i,values))!=null&&value>max){max=value}}}}}return max};var src_mean=function(values,valueof){var n=values.length,m=n,i=-1,value,sum=0;if(valueof==null){while(++i<n){if(!isNaN(value=src_number(values[i])))sum+=value;else--m}}else{while(++i<n){if(!isNaN(value=src_number(valueof(values[i],i,values))))sum+=value;else--m}}if(m)return sum/m};var median=function(values,valueof){var n=values.length,i=-1,value,numbers=[];if(valueof==null){while(++i<n){if(!isNaN(value=src_number(values[i]))){numbers.push(value)}}}else{while(++i<n){if(!isNaN(value=src_number(valueof(values[i],i,values)))){numbers.push(value)}}}return quantile(numbers.sort(ascending),.5)};var merge=function(arrays){var n=arrays.length,m,i=-1,j=0,merged,array;while(++i<n)j+=arrays[i].length;merged=new Array(j);while(--n>=0){array=arrays[n];m=array.length;while(--m>=0){merged[--j]=array[m]}}return merged};var src_min=function(values,valueof){var n=values.length,i=-1,value,min;if(valueof==null){while(++i<n){if((value=values[i])!=null&&value>=value){min=value;while(++i<n){if((value=values[i])!=null&&min>value){min=value}}}}}else{while(++i<n){if((value=valueof(values[i],i,values))!=null&&value>=value){min=value;while(++i<n){if((value=valueof(values[i],i,values))!=null&&min>value){min=value}}}}}return min};var permute=function(array,indexes){var i=indexes.length,permutes=new Array(i);while(i--)permutes[i]=array[indexes[i]];return permutes};var scan=function(values,compare){if(!(n=values.length))return;var n,i=0,j=0,xi,xj=values[j];if(compare==null)compare=ascending;while(++i<n){if(compare(xi=values[i],xj)<0||compare(xj,xj)!==0){xj=xi,j=i}}if(compare(xj,xj)===0)return j};var shuffle=function(array,i0,i1){var m=(i1==null?array.length:i1)-(i0=i0==null?0:+i0),t,i;while(m){i=Math.random()*m--|0;t=array[m+i0];array[m+i0]=array[i+i0];array[i+i0]=t}return array};var src_sum=function(values,valueof){var n=values.length,i=-1,value,sum=0;if(valueof==null){while(++i<n){if(value=+values[i])sum+=value}}else{while(++i<n){if(value=+valueof(values[i],i,values))sum+=value}}return sum};var src_transpose=function(matrix){if(!(n=matrix.length))return[];for(var i=-1,m=src_min(matrix,transpose_length),transpose=new Array(m);++i<m;){for(var j=-1,n,row=transpose[i]=new Array(n);++j<n;){row[j]=matrix[j][i]}}return transpose};function transpose_length(d){return d.length}var zip=function(){return src_transpose(arguments)};var map_prefix="$";function map_Map(){}map_Map.prototype=map_map.prototype={constructor:map_Map,has:function(key){return map_prefix+key in this},get:function(key){return this[map_prefix+key]},set:function(key,value){this[map_prefix+key]=value;return this},remove:function(key){var property=map_prefix+key;return property in this&&delete this[property]},clear:function(){for(var property in this)if(property[0]===map_prefix)delete this[property]},keys:function(){var keys=[];for(var property in this)if(property[0]===map_prefix)keys.push(property.slice(1));return keys},values:function(){var values=[];for(var property in this)if(property[0]===map_prefix)values.push(this[property]);return values},entries:function(){var entries=[];for(var property in this)if(property[0]===map_prefix)entries.push({key:property.slice(1),value:this[property]});return entries},size:function(){var size=0;for(var property in this)if(property[0]===map_prefix)++size;return size},empty:function(){for(var property in this)if(property[0]===map_prefix)return false;return true},each:function(f){for(var property in this)if(property[0]===map_prefix)f(this[property],property.slice(1),this)}};function map_map(object,f){var map=new map_Map;if(object instanceof map_Map)object.each(function(value,key){map.set(key,value)});else if(Array.isArray(object)){var i=-1,n=object.length,o;if(f==null)while(++i<n)map.set(i,object[i]);else while(++i<n)map.set(f(o=object[i],i,object),o)}else if(object)for(var key in object)map.set(key,object[key]);return map}var src_map=map_map;var src_nest=function(){var keys=[],sortKeys=[],sortValues,rollup,nest;function apply(array,depth,createResult,setResult){if(depth>=keys.length){if(sortValues!=null)array.sort(sortValues);return rollup!=null?rollup(array):array}var i=-1,n=array.length,key=keys[depth++],keyValue,value,valuesByKey=src_map(),values,result=createResult();while(++i<n){if(values=valuesByKey.get(keyValue=key(value=array[i])+"")){values.push(value)}else{valuesByKey.set(keyValue,[value])}}valuesByKey.each(function(values,key){setResult(result,key,apply(values,depth,createResult,setResult))});return result}function entries(map,depth){if(++depth>keys.length)return map;var array,sortKey=sortKeys[depth-1];if(rollup!=null&&depth>=keys.length)array=map.entries();else array=[],map.each(function(v,k){array.push({key:k,values:entries(v,depth)})});return sortKey!=null?array.sort(function(a,b){return sortKey(a.key,b.key)}):array}return nest={object:function(array){return apply(array,0,createObject,setObject)},map:function(array){return apply(array,0,createMap,setMap)},entries:function(array){return entries(apply(array,0,createMap,setMap),0)},key:function(d){keys.push(d);return nest},sortKeys:function(order){sortKeys[keys.length-1]=order;return nest},sortValues:function(order){sortValues=order;return nest},rollup:function(f){rollup=f;return nest}}};function createObject(){return{}}function setObject(object,key,value){object[key]=value}function createMap(){return src_map()}function setMap(map,key,value){map.set(key,value)}function set_Set(){}var proto=src_map.prototype;set_Set.prototype=set.prototype={constructor:set_Set,has:proto.has,add:function(value){value+="";this[map_prefix+value]=value;return this},remove:proto.remove,clear:proto.clear,values:proto.keys,size:proto.size,empty:proto.empty,each:proto.each};function set(object,f){var set=new set_Set;if(object instanceof set_Set)object.each(function(value){set.add(value)});else if(object){var i=-1,n=object.length;if(f==null)while(++i<n)set.add(object[i]);else while(++i<n)set.add(f(object[i],i,object))}return set}var src_set=set;var src_keys=function(map){var keys=[];for(var key in map)keys.push(key);return keys};var src_values=function(map){var values=[];for(var key in map)values.push(map[key]);return values};var src_entries=function(map){var entries=[];for(var key in map)entries.push({key:key,value:map[key]});return entries};var src_array_array=Array.prototype;var array_map=src_array_array.map;var array_slice=src_array_array.slice;var implicit={name:"implicit"};function ordinal(range){var index=src_map(),domain=[],unknown=implicit;range=range==null?[]:array_slice.call(range);function scale(d){var key=d+"",i=index.get(key);if(!i){if(unknown!==implicit)return unknown;index.set(key,i=domain.push(d))}return range[(i-1)%range.length]}scale.domain=function(_){if(!arguments.length)return domain.slice();domain=[],index=src_map();var i=-1,n=_.length,d,key;while(++i<n)if(!index.has(key=(d=_[i])+""))index.set(key,domain.push(d));return scale};scale.range=function(_){return arguments.length?(range=array_slice.call(_),scale):range.slice()};scale.unknown=function(_){return arguments.length?(unknown=_,scale):unknown};scale.copy=function(){return ordinal().domain(domain).range(range).unknown(unknown)};return scale}function band(){var scale=ordinal().unknown(undefined),domain=scale.domain,ordinalRange=scale.range,range=[0,1],step,bandwidth,round=false,paddingInner=0,paddingOuter=0,align=.5;delete scale.unknown;function rescale(){var n=domain().length,reverse=range[1]<range[0],start=range[reverse-0],stop=range[1-reverse];step=(stop-start)/Math.max(1,n-paddingInner+paddingOuter*2);if(round)step=Math.floor(step);start+=(stop-start-step*(n-paddingInner))*align;bandwidth=step*(1-paddingInner);if(round)start=Math.round(start),bandwidth=Math.round(bandwidth);var values=src_range(n).map(function(i){return start+step*i});return ordinalRange(reverse?values.reverse():values)}scale.domain=function(_){return arguments.length?(domain(_),rescale()):domain()};scale.range=function(_){return arguments.length?(range=[+_[0],+_[1]],rescale()):range.slice()};scale.rangeRound=function(_){return range=[+_[0],+_[1]],round=true,rescale()};scale.bandwidth=function(){return bandwidth};scale.step=function(){return step};scale.round=function(_){return arguments.length?(round=!!_,rescale()):round};scale.padding=function(_){return arguments.length?(paddingInner=paddingOuter=Math.max(0,Math.min(1,_)),rescale()):paddingInner};scale.paddingInner=function(_){return arguments.length?(paddingInner=Math.max(0,Math.min(1,_)),rescale()):paddingInner};scale.paddingOuter=function(_){return arguments.length?(paddingOuter=Math.max(0,Math.min(1,_)),rescale()):paddingOuter};scale.align=function(_){return arguments.length?(align=Math.max(0,Math.min(1,_)),rescale()):align};scale.copy=function(){return band().domain(domain()).range(range).round(round).paddingInner(paddingInner).paddingOuter(paddingOuter).align(align)};return rescale()}function pointish(scale){var copy=scale.copy;scale.padding=scale.paddingOuter;delete scale.paddingInner;delete scale.paddingOuter;scale.copy=function(){return pointish(copy())};return scale}function point(){return pointish(band().paddingInner(1))}var d3_scale_src_constant=function(x){return function(){return x}};var d3_scale_src_number=function(x){return+x};var unit=[0,1];function deinterpolateLinear(a,b){return(b-=a=+a)?function(x){return(x-a)/b}:d3_scale_src_constant(b)}function deinterpolateClamp(deinterpolate){return function(a,b){var d=deinterpolate(a=+a,b=+b);return function(x){return x<=a?0:x>=b?1:d(x)}}}function reinterpolateClamp(reinterpolate){return function(a,b){var r=reinterpolate(a=+a,b=+b);return function(t){return t<=0?a:t>=1?b:r(t)}}}function bimap(domain,range,deinterpolate,reinterpolate){var d0=domain[0],d1=domain[1],r0=range[0],r1=range[1];if(d1<d0)d0=deinterpolate(d1,d0),r0=reinterpolate(r1,r0);else d0=deinterpolate(d0,d1),r0=reinterpolate(r0,r1);return function(x){return r0(d0(x))}}function polymap(domain,range,deinterpolate,reinterpolate){var j=Math.min(domain.length,range.length)-1,d=new Array(j),r=new Array(j),i=-1;if(domain[j]<domain[0]){domain=domain.slice().reverse();range=range.slice().reverse()}while(++i<j){d[i]=deinterpolate(domain[i],domain[i+1]);r[i]=reinterpolate(range[i],range[i+1])}return function(x){var i=bisect(domain,x,1,j)-1;return r[i](d[i](x))}}function copy(source,target){return target.domain(source.domain()).range(source.range()).interpolate(source.interpolate()).clamp(source.clamp())}function continuous(deinterpolate,reinterpolate){var domain=unit,range=unit,interpolate=src_value,clamp=false,piecewise,output,input;function rescale(){piecewise=Math.min(domain.length,range.length)>2?polymap:bimap;output=input=null;return scale}function scale(x){return(output||(output=piecewise(domain,range,clamp?deinterpolateClamp(deinterpolate):deinterpolate,interpolate)))(+x)}scale.invert=function(y){return(input||(input=piecewise(range,domain,deinterpolateLinear,clamp?reinterpolateClamp(reinterpolate):reinterpolate)))(+y)};scale.domain=function(_){return arguments.length?(domain=array_map.call(_,d3_scale_src_number),rescale()):domain.slice()};scale.range=function(_){return arguments.length?(range=array_slice.call(_),rescale()):range.slice()};scale.rangeRound=function(_){return range=array_slice.call(_),interpolate=src_round,rescale()};scale.clamp=function(_){return arguments.length?(clamp=!!_,rescale()):clamp};scale.interpolate=function(_){return arguments.length?(interpolate=_,rescale()):interpolate};return rescale()}var formatDecimal=function(x,p){if((i=(x=p?x.toExponential(p-1):x.toExponential()).indexOf("e"))<0)return null;var i,coefficient=x.slice(0,i);return[coefficient.length>1?coefficient[0]+coefficient.slice(2):coefficient,+x.slice(i+1)]};var src_exponent=function(x){return x=formatDecimal(Math.abs(x)),x?x[1]:NaN};var formatGroup=function(grouping,thousands){return function(value,width){var i=value.length,t=[],j=0,g=grouping[0],length=0;while(i>0&&g>0){if(length+g+1>width)g=Math.max(1,width-length);t.push(value.substring(i-=g,i+g));if((length+=g+1)>width)break;g=grouping[j=(j+1)%grouping.length]}return t.reverse().join(thousands)}};var formatNumerals=function(numerals){return function(value){return value.replace(/[0-9]/g,function(i){return numerals[+i]})}};var re=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function formatSpecifier(specifier){return new FormatSpecifier(specifier)}formatSpecifier.prototype=FormatSpecifier.prototype;function FormatSpecifier(specifier){if(!(match=re.exec(specifier)))throw new Error("invalid format: "+specifier);var match;this.fill=match[1]||" ";this.align=match[2]||">";this.sign=match[3]||"-";this.symbol=match[4]||"";this.zero=!!match[5];this.width=match[6]&&+match[6];this.comma=!!match[7];this.precision=match[8]&&+match[8].slice(1);this.trim=!!match[9];this.type=match[10]||""}FormatSpecifier.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width==null?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision==null?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};var formatTrim=function(s){out:for(var n=s.length,i=1,i0=-1,i1;i<n;++i){switch(s[i]){case".":i0=i1=i;break;case"0":if(i0===0)i0=i;i1=i;break;default:if(i0>0){if(!+s[i])break out;i0=0}break}}return i0>0?s.slice(0,i0)+s.slice(i1+1):s};var prefixExponent;var formatPrefixAuto=function(x,p){var d=formatDecimal(x,p);if(!d)return x+"";var coefficient=d[0],exponent=d[1],i=exponent-(prefixExponent=Math.max(-8,Math.min(8,Math.floor(exponent/3)))*3)+1,n=coefficient.length;return i===n?coefficient:i>n?coefficient+new Array(i-n+1).join("0"):i>0?coefficient.slice(0,i)+"."+coefficient.slice(i):"0."+new Array(1-i).join("0")+formatDecimal(x,Math.max(0,p+i-1))[0]};var formatRounded=function(x,p){var d=formatDecimal(x,p);if(!d)return x+"";var coefficient=d[0],exponent=d[1];return exponent<0?"0."+new Array(-exponent).join("0")+coefficient:coefficient.length>exponent+1?coefficient.slice(0,exponent+1)+"."+coefficient.slice(exponent+1):coefficient+new Array(exponent-coefficient.length+2).join("0")};var formatTypes={"%":function(x,p){return(x*100).toFixed(p)},b:function(x){return Math.round(x).toString(2)},c:function(x){return x+""},d:function(x){return Math.round(x).toString(10)},e:function(x,p){return x.toExponential(p)},f:function(x,p){return x.toFixed(p)},g:function(x,p){return x.toPrecision(p)},o:function(x){return Math.round(x).toString(8)},p:function(x,p){return formatRounded(x*100,p)},r:formatRounded,s:formatPrefixAuto,X:function(x){return Math.round(x).toString(16).toUpperCase()},x:function(x){return Math.round(x).toString(16)}};var d3_format_src_identity=function(x){return x};var prefixes=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];var src_locale=function(locale){var group=locale.grouping&&locale.thousands?formatGroup(locale.grouping,locale.thousands):d3_format_src_identity,currency=locale.currency,decimal=locale.decimal,numerals=locale.numerals?formatNumerals(locale.numerals):d3_format_src_identity,percent=locale.percent||"%";function newFormat(specifier){specifier=formatSpecifier(specifier);var fill=specifier.fill,align=specifier.align,sign=specifier.sign,symbol=specifier.symbol,zero=specifier.zero,width=specifier.width,comma=specifier.comma,precision=specifier.precision,trim=specifier.trim,type=specifier.type;if(type==="n")comma=true,type="g";else if(!formatTypes[type])precision==null&&(precision=12),trim=true,type="g";if(zero||fill==="0"&&align==="=")zero=true,fill="0",align="=";var prefix=symbol==="$"?currency[0]:symbol==="#"&&/[boxX]/.test(type)?"0"+type.toLowerCase():"",suffix=symbol==="$"?currency[1]:/[%p]/.test(type)?percent:"";var formatType=formatTypes[type],maybeSuffix=/[defgprs%]/.test(type);precision=precision==null?6:/[gprs]/.test(type)?Math.max(1,Math.min(21,precision)):Math.max(0,Math.min(20,precision));function format(value){var valuePrefix=prefix,valueSuffix=suffix,i,n,c;if(type==="c"){valueSuffix=formatType(value)+valueSuffix;value=""}else{value=+value;var valueNegative=value<0;value=formatType(Math.abs(value),precision);if(trim)value=formatTrim(value);if(valueNegative&&+value===0)valueNegative=false;valuePrefix=(valueNegative?sign==="("?sign:"-":sign==="-"||sign==="("?"":sign)+valuePrefix;valueSuffix=(type==="s"?prefixes[8+prefixExponent/3]:"")+valueSuffix+(valueNegative&&sign==="("?")":"");if(maybeSuffix){i=-1,n=value.length;while(++i<n){if(c=value.charCodeAt(i),48>c||c>57){valueSuffix=(c===46?decimal+value.slice(i+1):value.slice(i))+valueSuffix;value=value.slice(0,i);break}}}}if(comma&&!zero)value=group(value,Infinity);var length=valuePrefix.length+value.length+valueSuffix.length,padding=length<width?new Array(width-length+1).join(fill):"";if(comma&&zero)value=group(padding+value,padding.length?width-valueSuffix.length:Infinity),padding="";switch(align){case"<":value=valuePrefix+value+valueSuffix+padding;break;case"=":value=valuePrefix+padding+value+valueSuffix;break;case"^":value=padding.slice(0,length=padding.length>>1)+valuePrefix+value+valueSuffix+padding.slice(length);break;default:value=padding+valuePrefix+value+valueSuffix;break}return numerals(value)}format.toString=function(){return specifier+""};return format}function formatPrefix(specifier,value){var f=newFormat((specifier=formatSpecifier(specifier),specifier.type="f",specifier)),e=Math.max(-8,Math.min(8,Math.floor(src_exponent(value)/3)))*3,k=Math.pow(10,-e),prefix=prefixes[8+e/3];return function(value){return f(k*value)+prefix}}return{format:newFormat,formatPrefix:formatPrefix}};var defaultLocale_locale;var defaultLocale_format;var defaultLocale_formatPrefix;defaultLocale({decimal:".",thousands:",",grouping:[3],currency:["$",""]});function defaultLocale(definition){defaultLocale_locale=src_locale(definition);defaultLocale_format=defaultLocale_locale.format;defaultLocale_formatPrefix=defaultLocale_locale.formatPrefix;return defaultLocale_locale}var precisionFixed=function(step){return Math.max(0,-src_exponent(Math.abs(step)))};var precisionPrefix=function(step,value){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(src_exponent(value)/3)))*3-src_exponent(Math.abs(step)))};var precisionRound=function(step,max){step=Math.abs(step),max=Math.abs(max)-step;return Math.max(0,src_exponent(max)-src_exponent(step))+1};var src_tickFormat=function(domain,count,specifier){var start=domain[0],stop=domain[domain.length-1],step=tickStep(start,stop,count==null?10:count),precision;specifier=formatSpecifier(specifier==null?",f":specifier);switch(specifier.type){case"s":{var value=Math.max(Math.abs(start),Math.abs(stop));if(specifier.precision==null&&!isNaN(precision=precisionPrefix(step,value)))specifier.precision=precision;return defaultLocale_formatPrefix(specifier,value)}case"":case"e":case"g":case"p":case"r":{if(specifier.precision==null&&!isNaN(precision=precisionRound(step,Math.max(Math.abs(start),Math.abs(stop)))))specifier.precision=precision-(specifier.type==="e");break}case"f":case"%":{if(specifier.precision==null&&!isNaN(precision=precisionFixed(step)))specifier.precision=precision-(specifier.type==="%")*2;break}}return defaultLocale_format(specifier)};function linearish(scale){var domain=scale.domain;scale.ticks=function(count){var d=domain();return ticks(d[0],d[d.length-1],count==null?10:count)};scale.tickFormat=function(count,specifier){return src_tickFormat(domain(),count,specifier)};scale.nice=function(count){if(count==null)count=10;var d=domain(),i0=0,i1=d.length-1,start=d[i0],stop=d[i1],step;if(stop<start){step=start,start=stop,stop=step;step=i0,i0=i1,i1=step}step=tickIncrement(start,stop,count);if(step>0){start=Math.floor(start/step)*step;stop=Math.ceil(stop/step)*step;step=tickIncrement(start,stop,count)}else if(step<0){start=Math.ceil(start*step)/step;stop=Math.floor(stop*step)/step;step=tickIncrement(start,stop,count)}if(step>0){d[i0]=Math.floor(start/step)*step;d[i1]=Math.ceil(stop/step)*step;domain(d)}else if(step<0){d[i0]=Math.ceil(start*step)/step;d[i1]=Math.floor(stop*step)/step;domain(d)}return scale};return scale}function linear_linear(){var scale=continuous(deinterpolateLinear,number);scale.copy=function(){return copy(scale,linear_linear())};return linearish(scale)}function identity_identity(){var domain=[0,1];function scale(x){return+x}scale.invert=scale;scale.domain=scale.range=function(_){return arguments.length?(domain=array_map.call(_,d3_scale_src_number),scale):domain.slice()};scale.copy=function(){return identity_identity().domain(domain)};return linearish(scale)}var nice=function(domain,interval){domain=domain.slice();var i0=0,i1=domain.length-1,x0=domain[i0],x1=domain[i1],t;if(x1<x0){t=i0,i0=i1,i1=t;t=x0,x0=x1,x1=t}domain[i0]=interval.floor(x0);domain[i1]=interval.ceil(x1);return domain};function log_deinterpolate(a,b){return(b=Math.log(b/a))?function(x){return Math.log(x/a)/b}:d3_scale_src_constant(b)}function log_reinterpolate(a,b){return a<0?function(t){return-Math.pow(-b,t)*Math.pow(-a,1-t)}:function(t){return Math.pow(b,t)*Math.pow(a,1-t)}}function pow10(x){return isFinite(x)?+("1e"+x):x<0?0:x}function powp(base){return base===10?pow10:base===Math.E?Math.exp:function(x){return Math.pow(base,x)}}function logp(base){return base===Math.E?Math.log:base===10&&Math.log10||base===2&&Math.log2||(base=Math.log(base),function(x){return Math.log(x)/base})}function reflect(f){return function(x){return-f(-x)}}function log(){var scale=continuous(log_deinterpolate,log_reinterpolate).domain([1,10]),domain=scale.domain,base=10,logs=logp(10),pows=powp(10);function rescale(){logs=logp(base),pows=powp(base);if(domain()[0]<0)logs=reflect(logs),pows=reflect(pows);return scale}scale.base=function(_){return arguments.length?(base=+_,rescale()):base};scale.domain=function(_){return arguments.length?(domain(_),rescale()):domain()};scale.ticks=function(count){var d=domain(),u=d[0],v=d[d.length-1],r;if(r=v<u)i=u,u=v,v=i;var i=logs(u),j=logs(v),p,k,t,n=count==null?10:+count,z=[];if(!(base%1)&&j-i<n){i=Math.round(i)-1,j=Math.round(j)+1;if(u>0)for(;i<j;++i){for(k=1,p=pows(i);k<base;++k){t=p*k;if(t<u)continue;if(t>v)break;z.push(t)}}else for(;i<j;++i){for(k=base-1,p=pows(i);k>=1;--k){t=p*k;if(t<u)continue;if(t>v)break;z.push(t)}}}else{z=ticks(i,j,Math.min(j-i,n)).map(pows)}return r?z.reverse():z};scale.tickFormat=function(count,specifier){if(specifier==null)specifier=base===10?".0e":",";if(typeof specifier!=="function")specifier=defaultLocale_format(specifier);if(count===Infinity)return specifier;if(count==null)count=10;var k=Math.max(1,base*count/scale.ticks().length);return function(d){var i=d/pows(Math.round(logs(d)));if(i*base<base-.5)i*=base;return i<=k?specifier(d):""}};scale.nice=function(){return domain(nice(domain(),{floor:function(x){return pows(Math.floor(logs(x)))},ceil:function(x){return pows(Math.ceil(logs(x)))}}))};scale.copy=function(){return copy(scale,log().base(base))};return scale}function raise(x,exponent){return x<0?-Math.pow(-x,exponent):Math.pow(x,exponent)}function pow(){var exponent=1,scale=continuous(deinterpolate,reinterpolate),domain=scale.domain;function deinterpolate(a,b){return(b=raise(b,exponent)-(a=raise(a,exponent)))?function(x){return(raise(x,exponent)-a)/b}:d3_scale_src_constant(b)}function reinterpolate(a,b){b=raise(b,exponent)-(a=raise(a,exponent));return function(t){return raise(a+b*t,1/exponent)}}scale.exponent=function(_){return arguments.length?(exponent=+_,domain(domain())):exponent};scale.copy=function(){return copy(scale,pow().exponent(exponent))};return linearish(scale)}function sqrt(){return pow().exponent(.5)}function quantile_quantile(){var domain=[],range=[],thresholds=[];function rescale(){var i=0,n=Math.max(1,range.length);thresholds=new Array(n-1);while(++i<n)thresholds[i-1]=quantile(domain,i/n);return scale}function scale(x){if(!isNaN(x=+x))return range[bisect(thresholds,x)]}scale.invertExtent=function(y){var i=range.indexOf(y);return i<0?[NaN,NaN]:[i>0?thresholds[i-1]:domain[0],i<thresholds.length?thresholds[i]:domain[domain.length-1]]};scale.domain=function(_){if(!arguments.length)return domain.slice();domain=[];for(var i=0,n=_.length,d;i<n;++i)if(d=_[i],d!=null&&!isNaN(d=+d))domain.push(d);domain.sort(ascending);return rescale()};scale.range=function(_){return arguments.length?(range=array_slice.call(_),rescale()):range.slice()};scale.quantiles=function(){return thresholds.slice()};scale.copy=function(){return quantile_quantile().domain(domain).range(range)};return scale}function quantize_quantize(){var x0=0,x1=1,n=1,domain=[.5],range=[0,1];function scale(x){if(x<=x)return range[bisect(domain,x,0,n)]}function rescale(){var i=-1;domain=new Array(n);while(++i<n)domain[i]=((i+1)*x1-(i-n)*x0)/(n+1);return scale}scale.domain=function(_){return arguments.length?(x0=+_[0],x1=+_[1],rescale()):[x0,x1]};scale.range=function(_){return arguments.length?(n=(range=array_slice.call(_)).length-1,rescale()):range.slice()};scale.invertExtent=function(y){var i=range.indexOf(y);return i<0?[NaN,NaN]:i<1?[x0,domain[0]]:i>=n?[domain[n-1],x1]:[domain[i-1],domain[i]]};scale.copy=function(){return quantize_quantize().domain([x0,x1]).range(range)};return linearish(scale)}function threshold_threshold(){var domain=[.5],range=[0,1],n=1;function scale(x){if(x<=x)return range[bisect(domain,x,0,n)]}scale.domain=function(_){return arguments.length?(domain=array_slice.call(_),n=Math.min(domain.length,range.length-1),scale):domain.slice()};scale.range=function(_){return arguments.length?(range=array_slice.call(_),n=Math.min(domain.length,range.length-1),scale):range.slice()};scale.invertExtent=function(y){var i=range.indexOf(y);return[domain[i-1],domain[i]]};scale.copy=function(){return threshold_threshold().domain(domain).range(range)};return scale}var interval_t0=new Date,interval_t1=new Date;function newInterval(floori,offseti,count,field){function interval(date){return floori(date=new Date(+date)),date}interval.floor=interval;interval.ceil=function(date){return floori(date=new Date(date-1)),offseti(date,1),floori(date),date};interval.round=function(date){var d0=interval(date),d1=interval.ceil(date);return date-d0<d1-date?d0:d1};interval.offset=function(date,step){return offseti(date=new Date(+date),step==null?1:Math.floor(step)),date};interval.range=function(start,stop,step){var range=[],previous;start=interval.ceil(start);step=step==null?1:Math.floor(step);if(!(start<stop)||!(step>0))return range;do{range.push(previous=new Date(+start)),offseti(start,step),floori(start)}while(previous<start&&start<stop);return range};interval.filter=function(test){return newInterval(function(date){if(date>=date)while(floori(date),!test(date))date.setTime(date-1)},function(date,step){if(date>=date){if(step<0)while(++step<=0){while(offseti(date,-1),!test(date)){}}else while(--step>=0){while(offseti(date,+1),!test(date)){}}}})};if(count){interval.count=function(start,end){interval_t0.setTime(+start),interval_t1.setTime(+end);floori(interval_t0),floori(interval_t1);return Math.floor(count(interval_t0,interval_t1))};interval.every=function(step){step=Math.floor(step);return!isFinite(step)||!(step>0)?null:!(step>1)?interval:interval.filter(field?function(d){return field(d)%step===0}:function(d){return interval.count(0,d)%step===0})}}return interval}var millisecond_millisecond=newInterval(function(){},function(date,step){date.setTime(+date+step)},function(start,end){return end-start});millisecond_millisecond.every=function(k){k=Math.floor(k);if(!isFinite(k)||!(k>0))return null;if(!(k>1))return millisecond_millisecond;return newInterval(function(date){date.setTime(Math.floor(date/k)*k)},function(date,step){date.setTime(+date+step*k)},function(start,end){return(end-start)/k})};var src_millisecond=millisecond_millisecond;var milliseconds=millisecond_millisecond.range;var durationSecond=1e3;var durationMinute=6e4;var durationHour=36e5;var durationDay=864e5;var durationWeek=6048e5;var second_second=newInterval(function(date){date.setTime(Math.floor(date/durationSecond)*durationSecond)},function(date,step){date.setTime(+date+step*durationSecond)},function(start,end){return(end-start)/durationSecond},function(date){return date.getUTCSeconds()});var src_second=second_second;var seconds=second_second.range;var minute_minute=newInterval(function(date){date.setTime(Math.floor(date/durationMinute)*durationMinute)},function(date,step){date.setTime(+date+step*durationMinute)},function(start,end){return(end-start)/durationMinute},function(date){return date.getMinutes()});var src_minute=minute_minute;var minutes=minute_minute.range;var hour_hour=newInterval(function(date){var offset=date.getTimezoneOffset()*durationMinute%durationHour;if(offset<0)offset+=durationHour;date.setTime(Math.floor((+date-offset)/durationHour)*durationHour+offset)},function(date,step){date.setTime(+date+step*durationHour)},function(start,end){return(end-start)/durationHour},function(date){return date.getHours()});var src_hour=hour_hour;var hours=hour_hour.range;var day_day=newInterval(function(date){date.setHours(0,0,0,0)},function(date,step){date.setDate(date.getDate()+step)},function(start,end){return(end-start-(end.getTimezoneOffset()-start.getTimezoneOffset())*durationMinute)/durationDay},function(date){return date.getDate()-1});var src_day=day_day;var days=day_day.range;function weekday(i){return newInterval(function(date){date.setDate(date.getDate()-(date.getDay()+7-i)%7);date.setHours(0,0,0,0)},function(date,step){date.setDate(date.getDate()+step*7)},function(start,end){return(end-start-(end.getTimezoneOffset()-start.getTimezoneOffset())*durationMinute)/durationWeek})}var sunday=weekday(0);var monday=weekday(1);var tuesday=weekday(2);var wednesday=weekday(3);var thursday=weekday(4);var friday=weekday(5);var saturday=weekday(6);var sundays=sunday.range;var mondays=monday.range;var tuesdays=tuesday.range;var wednesdays=wednesday.range;var thursdays=thursday.range;var fridays=friday.range;var saturdays=saturday.range;var month_month=newInterval(function(date){date.setDate(1);date.setHours(0,0,0,0)},function(date,step){date.setMonth(date.getMonth()+step)},function(start,end){return end.getMonth()-start.getMonth()+(end.getFullYear()-start.getFullYear())*12},function(date){return date.getMonth()});var src_month=month_month;var months=month_month.range;var year_year=newInterval(function(date){date.setMonth(0,1);date.setHours(0,0,0,0)},function(date,step){date.setFullYear(date.getFullYear()+step)},function(start,end){return end.getFullYear()-start.getFullYear()},function(date){return date.getFullYear()});year_year.every=function(k){return!isFinite(k=Math.floor(k))||!(k>0)?null:newInterval(function(date){date.setFullYear(Math.floor(date.getFullYear()/k)*k);date.setMonth(0,1);date.setHours(0,0,0,0)},function(date,step){date.setFullYear(date.getFullYear()+step*k)})};var src_year=year_year;var years=year_year.range;var utcMinute=newInterval(function(date){date.setUTCSeconds(0,0)},function(date,step){date.setTime(+date+step*durationMinute)},function(start,end){return(end-start)/durationMinute},function(date){return date.getUTCMinutes()});var src_utcMinute=utcMinute;var utcMinutes=utcMinute.range;var utcHour=newInterval(function(date){date.setUTCMinutes(0,0,0)},function(date,step){date.setTime(+date+step*durationHour)},function(start,end){return(end-start)/durationHour},function(date){return date.getUTCHours()});var src_utcHour=utcHour;var utcHours=utcHour.range;var utcDay=newInterval(function(date){date.setUTCHours(0,0,0,0)},function(date,step){date.setUTCDate(date.getUTCDate()+step)},function(start,end){return(end-start)/durationDay},function(date){return date.getUTCDate()-1});var src_utcDay=utcDay;var utcDays=utcDay.range;function utcWeekday(i){return newInterval(function(date){date.setUTCDate(date.getUTCDate()-(date.getUTCDay()+7-i)%7);date.setUTCHours(0,0,0,0)},function(date,step){date.setUTCDate(date.getUTCDate()+step*7)},function(start,end){return(end-start)/durationWeek})}var utcSunday=utcWeekday(0);var utcMonday=utcWeekday(1);var utcTuesday=utcWeekday(2);var utcWednesday=utcWeekday(3);var utcThursday=utcWeekday(4);var utcFriday=utcWeekday(5);var utcSaturday=utcWeekday(6);var utcSundays=utcSunday.range;var utcMondays=utcMonday.range;var utcTuesdays=utcTuesday.range;var utcWednesdays=utcWednesday.range;var utcThursdays=utcThursday.range;var utcFridays=utcFriday.range;var utcSaturdays=utcSaturday.range;var utcMonth=newInterval(function(date){date.setUTCDate(1);date.setUTCHours(0,0,0,0)},function(date,step){date.setUTCMonth(date.getUTCMonth()+step)},function(start,end){return end.getUTCMonth()-start.getUTCMonth()+(end.getUTCFullYear()-start.getUTCFullYear())*12},function(date){return date.getUTCMonth()});var src_utcMonth=utcMonth;var utcMonths=utcMonth.range;var utcYear=newInterval(function(date){date.setUTCMonth(0,1);date.setUTCHours(0,0,0,0)},function(date,step){date.setUTCFullYear(date.getUTCFullYear()+step)},function(start,end){return end.getUTCFullYear()-start.getUTCFullYear()},function(date){return date.getUTCFullYear()});utcYear.every=function(k){return!isFinite(k=Math.floor(k))||!(k>0)?null:newInterval(function(date){date.setUTCFullYear(Math.floor(date.getUTCFullYear()/k)*k);date.setUTCMonth(0,1);date.setUTCHours(0,0,0,0)},function(date,step){date.setUTCFullYear(date.getUTCFullYear()+step*k)})};var src_utcYear=utcYear;var utcYears=utcYear.range;function localDate(d){if(0<=d.y&&d.y<100){var date=new Date(-1,d.m,d.d,d.H,d.M,d.S,d.L);date.setFullYear(d.y);return date}return new Date(d.y,d.m,d.d,d.H,d.M,d.S,d.L)}function utcDate(d){if(0<=d.y&&d.y<100){var date=new Date(Date.UTC(-1,d.m,d.d,d.H,d.M,d.S,d.L));date.setUTCFullYear(d.y);return date}return new Date(Date.UTC(d.y,d.m,d.d,d.H,d.M,d.S,d.L))}function newYear(y){return{y:y,m:0,d:1,H:0,M:0,S:0,L:0}}function formatLocale(locale){var locale_dateTime=locale.dateTime,locale_date=locale.date,locale_time=locale.time,locale_periods=locale.periods,locale_weekdays=locale.days,locale_shortWeekdays=locale.shortDays,locale_months=locale.months,locale_shortMonths=locale.shortMonths;var periodRe=formatRe(locale_periods),periodLookup=formatLookup(locale_periods),weekdayRe=formatRe(locale_weekdays),weekdayLookup=formatLookup(locale_weekdays),shortWeekdayRe=formatRe(locale_shortWeekdays),shortWeekdayLookup=formatLookup(locale_shortWeekdays),monthRe=formatRe(locale_months),monthLookup=formatLookup(locale_months),shortMonthRe=formatRe(locale_shortMonths),shortMonthLookup=formatLookup(locale_shortMonths);var formats={a:formatShortWeekday,A:formatWeekday,b:formatShortMonth,B:formatMonth,c:null,d:formatDayOfMonth,e:formatDayOfMonth,f:formatMicroseconds,H:formatHour24,I:formatHour12,j:formatDayOfYear,L:formatMilliseconds,m:formatMonthNumber,M:formatMinutes,p:formatPeriod,Q:formatUnixTimestamp,s:formatUnixTimestampSeconds,S:formatSeconds,u:formatWeekdayNumberMonday,U:formatWeekNumberSunday,V:formatWeekNumberISO,w:formatWeekdayNumberSunday,W:formatWeekNumberMonday,x:null,X:null,y:locale_formatYear,Y:formatFullYear,Z:formatZone,"%":formatLiteralPercent};var utcFormats={a:formatUTCShortWeekday,A:formatUTCWeekday,b:formatUTCShortMonth,B:formatUTCMonth,c:null,d:formatUTCDayOfMonth,e:formatUTCDayOfMonth,f:formatUTCMicroseconds,H:formatUTCHour24,I:formatUTCHour12,j:formatUTCDayOfYear,L:formatUTCMilliseconds,m:formatUTCMonthNumber,M:formatUTCMinutes,p:formatUTCPeriod,Q:formatUnixTimestamp,s:formatUnixTimestampSeconds,S:formatUTCSeconds,u:formatUTCWeekdayNumberMonday,U:formatUTCWeekNumberSunday,V:formatUTCWeekNumberISO,w:formatUTCWeekdayNumberSunday,W:formatUTCWeekNumberMonday,x:null,X:null,y:formatUTCYear,Y:formatUTCFullYear,Z:formatUTCZone,"%":formatLiteralPercent};var parses={a:parseShortWeekday,A:parseWeekday,b:parseShortMonth,B:parseMonth,c:parseLocaleDateTime,d:parseDayOfMonth,e:parseDayOfMonth,f:parseMicroseconds,H:parseHour24,I:parseHour24,j:parseDayOfYear,L:parseMilliseconds,m:parseMonthNumber,M:parseMinutes,p:parsePeriod,Q:parseUnixTimestamp,s:parseUnixTimestampSeconds,S:parseSeconds,u:parseWeekdayNumberMonday,U:parseWeekNumberSunday,V:parseWeekNumberISO,w:parseWeekdayNumberSunday,W:parseWeekNumberMonday,x:parseLocaleDate,X:parseLocaleTime,y:parseYear,Y:parseFullYear,Z:parseZone,"%":parseLiteralPercent};formats.x=newFormat(locale_date,formats);formats.X=newFormat(locale_time,formats);formats.c=newFormat(locale_dateTime,formats);utcFormats.x=newFormat(locale_date,utcFormats);utcFormats.X=newFormat(locale_time,utcFormats);utcFormats.c=newFormat(locale_dateTime,utcFormats);function newFormat(specifier,formats){return function(date){var string=[],i=-1,j=0,n=specifier.length,c,pad,format;if(!(date instanceof Date))date=new Date(+date);while(++i<n){if(specifier.charCodeAt(i)===37){string.push(specifier.slice(j,i));if((pad=pads[c=specifier.charAt(++i)])!=null)c=specifier.charAt(++i);else pad=c==="e"?" ":"0";if(format=formats[c])c=format(date,pad);string.push(c);j=i+1}}string.push(specifier.slice(j,i));return string.join("")}}function newParse(specifier,newDate){return function(string){var d=newYear(1900),i=parseSpecifier(d,specifier,string+="",0),week,day;if(i!=string.length)return null;if("Q"in d)return new Date(d.Q);if("p"in d)d.H=d.H%12+d.p*12;if("V"in d){if(d.V<1||d.V>53)return null;if(!("w"in d))d.w=1;if("Z"in d){week=utcDate(newYear(d.y)),day=week.getUTCDay();week=day>4||day===0?utcMonday.ceil(week):utcMonday(week);week=src_utcDay.offset(week,(d.V-1)*7);d.y=week.getUTCFullYear();d.m=week.getUTCMonth();d.d=week.getUTCDate()+(d.w+6)%7}else{week=newDate(newYear(d.y)),day=week.getDay();week=day>4||day===0?monday.ceil(week):monday(week);week=src_day.offset(week,(d.V-1)*7);d.y=week.getFullYear();d.m=week.getMonth();d.d=week.getDate()+(d.w+6)%7}}else if("W"in d||"U"in d){if(!("w"in d))d.w="u"in d?d.u%7:"W"in d?1:0;day="Z"in d?utcDate(newYear(d.y)).getUTCDay():newDate(newYear(d.y)).getDay();d.m=0;d.d="W"in d?(d.w+6)%7+d.W*7-(day+5)%7:d.w+d.U*7-(day+6)%7}if("Z"in d){d.H+=d.Z/100|0;d.M+=d.Z%100;return utcDate(d)}return newDate(d)}}function parseSpecifier(d,specifier,string,j){var i=0,n=specifier.length,m=string.length,c,parse;while(i<n){if(j>=m)return-1;c=specifier.charCodeAt(i++);if(c===37){c=specifier.charAt(i++);parse=parses[c in pads?specifier.charAt(i++):c];if(!parse||(j=parse(d,string,j))<0)return-1}else if(c!=string.charCodeAt(j++)){return-1}}return j}function parsePeriod(d,string,i){var n=periodRe.exec(string.slice(i));return n?(d.p=periodLookup[n[0].toLowerCase()],i+n[0].length):-1}function parseShortWeekday(d,string,i){var n=shortWeekdayRe.exec(string.slice(i));return n?(d.w=shortWeekdayLookup[n[0].toLowerCase()],i+n[0].length):-1}function parseWeekday(d,string,i){var n=weekdayRe.exec(string.slice(i));return n?(d.w=weekdayLookup[n[0].toLowerCase()],i+n[0].length):-1}function parseShortMonth(d,string,i){var n=shortMonthRe.exec(string.slice(i));return n?(d.m=shortMonthLookup[n[0].toLowerCase()],i+n[0].length):-1}function parseMonth(d,string,i){var n=monthRe.exec(string.slice(i));return n?(d.m=monthLookup[n[0].toLowerCase()],i+n[0].length):-1}function parseLocaleDateTime(d,string,i){return parseSpecifier(d,locale_dateTime,string,i)}function parseLocaleDate(d,string,i){return parseSpecifier(d,locale_date,string,i)}function parseLocaleTime(d,string,i){return parseSpecifier(d,locale_time,string,i)}function formatShortWeekday(d){return locale_shortWeekdays[d.getDay()]}function formatWeekday(d){return locale_weekdays[d.getDay()]}function formatShortMonth(d){return locale_shortMonths[d.getMonth()]}function formatMonth(d){return locale_months[d.getMonth()]}function formatPeriod(d){return locale_periods[+(d.getHours()>=12)]}function formatUTCShortWeekday(d){return locale_shortWeekdays[d.getUTCDay()]}function formatUTCWeekday(d){return locale_weekdays[d.getUTCDay()]}function formatUTCShortMonth(d){return locale_shortMonths[d.getUTCMonth()]}function formatUTCMonth(d){return locale_months[d.getUTCMonth()]}function formatUTCPeriod(d){return locale_periods[+(d.getUTCHours()>=12)]}return{format:function(specifier){var f=newFormat(specifier+="",formats);f.toString=function(){return specifier};return f},parse:function(specifier){var p=newParse(specifier+="",localDate);p.toString=function(){return specifier};return p},utcFormat:function(specifier){var f=newFormat(specifier+="",utcFormats);f.toString=function(){return specifier};return f},utcParse:function(specifier){var p=newParse(specifier,utcDate);p.toString=function(){return specifier};return p}}}var pads={"-":"",_:" ",0:"0"},numberRe=/^\s*\d+/,percentRe=/^%/,requoteRe=/[\\^$*+?|[\]().{}]/g;function pad(value,fill,width){var sign=value<0?"-":"",string=(sign?-value:value)+"",length=string.length;return sign+(length<width?new Array(width-length+1).join(fill)+string:string)}function requote(s){return s.replace(requoteRe,"\\$&")}function formatRe(names){return new RegExp("^(?:"+names.map(requote).join("|")+")","i")}function formatLookup(names){var map={},i=-1,n=names.length;while(++i<n)map[names[i].toLowerCase()]=i;return map}function parseWeekdayNumberSunday(d,string,i){var n=numberRe.exec(string.slice(i,i+1));return n?(d.w=+n[0],i+n[0].length):-1}function parseWeekdayNumberMonday(d,string,i){var n=numberRe.exec(string.slice(i,i+1));return n?(d.u=+n[0],i+n[0].length):-1}function parseWeekNumberSunday(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.U=+n[0],i+n[0].length):-1}function parseWeekNumberISO(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.V=+n[0],i+n[0].length):-1}function parseWeekNumberMonday(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.W=+n[0],i+n[0].length):-1}function parseFullYear(d,string,i){var n=numberRe.exec(string.slice(i,i+4));return n?(d.y=+n[0],i+n[0].length):-1}function parseYear(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.y=+n[0]+(+n[0]>68?1900:2e3),i+n[0].length):-1}function parseZone(d,string,i){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(string.slice(i,i+6));return n?(d.Z=n[1]?0:-(n[2]+(n[3]||"00")),i+n[0].length):-1}function parseMonthNumber(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.m=n[0]-1,i+n[0].length):-1}function parseDayOfMonth(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.d=+n[0],i+n[0].length):-1}function parseDayOfYear(d,string,i){var n=numberRe.exec(string.slice(i,i+3));return n?(d.m=0,d.d=+n[0],i+n[0].length):-1}function parseHour24(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.H=+n[0],i+n[0].length):-1}function parseMinutes(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.M=+n[0],i+n[0].length):-1}function parseSeconds(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.S=+n[0],i+n[0].length):-1}function parseMilliseconds(d,string,i){var n=numberRe.exec(string.slice(i,i+3));return n?(d.L=+n[0],i+n[0].length):-1}function parseMicroseconds(d,string,i){var n=numberRe.exec(string.slice(i,i+6));return n?(d.L=Math.floor(n[0]/1e3),i+n[0].length):-1}function parseLiteralPercent(d,string,i){var n=percentRe.exec(string.slice(i,i+1));return n?i+n[0].length:-1}function parseUnixTimestamp(d,string,i){var n=numberRe.exec(string.slice(i));return n?(d.Q=+n[0],i+n[0].length):-1}function parseUnixTimestampSeconds(d,string,i){var n=numberRe.exec(string.slice(i));return n?(d.Q=+n[0]*1e3,i+n[0].length):-1}function formatDayOfMonth(d,p){return pad(d.getDate(),p,2)}function formatHour24(d,p){return pad(d.getHours(),p,2)}function formatHour12(d,p){return pad(d.getHours()%12||12,p,2)}function formatDayOfYear(d,p){return pad(1+src_day.count(src_year(d),d),p,3)}function formatMilliseconds(d,p){return pad(d.getMilliseconds(),p,3)}function formatMicroseconds(d,p){return formatMilliseconds(d,p)+"000"}function formatMonthNumber(d,p){return pad(d.getMonth()+1,p,2)}function formatMinutes(d,p){return pad(d.getMinutes(),p,2)}function formatSeconds(d,p){return pad(d.getSeconds(),p,2)}function formatWeekdayNumberMonday(d){var day=d.getDay();return day===0?7:day}function formatWeekNumberSunday(d,p){return pad(sunday.count(src_year(d),d),p,2)}function formatWeekNumberISO(d,p){var day=d.getDay();d=day>=4||day===0?thursday(d):thursday.ceil(d);return pad(thursday.count(src_year(d),d)+(src_year(d).getDay()===4),p,2)}function formatWeekdayNumberSunday(d){return d.getDay()}function formatWeekNumberMonday(d,p){return pad(monday.count(src_year(d),d),p,2)}function locale_formatYear(d,p){return pad(d.getFullYear()%100,p,2)}function formatFullYear(d,p){return pad(d.getFullYear()%1e4,p,4)}function formatZone(d){var z=d.getTimezoneOffset();return(z>0?"-":(z*=-1,"+"))+pad(z/60|0,"0",2)+pad(z%60,"0",2)}function formatUTCDayOfMonth(d,p){return pad(d.getUTCDate(),p,2)}function formatUTCHour24(d,p){return pad(d.getUTCHours(),p,2)}function formatUTCHour12(d,p){return pad(d.getUTCHours()%12||12,p,2)}function formatUTCDayOfYear(d,p){return pad(1+src_utcDay.count(src_utcYear(d),d),p,3)}function formatUTCMilliseconds(d,p){return pad(d.getUTCMilliseconds(),p,3)}function formatUTCMicroseconds(d,p){return formatUTCMilliseconds(d,p)+"000"}function formatUTCMonthNumber(d,p){return pad(d.getUTCMonth()+1,p,2)}function formatUTCMinutes(d,p){return pad(d.getUTCMinutes(),p,2)}function formatUTCSeconds(d,p){return pad(d.getUTCSeconds(),p,2)}function formatUTCWeekdayNumberMonday(d){var dow=d.getUTCDay();return dow===0?7:dow}function formatUTCWeekNumberSunday(d,p){return pad(utcSunday.count(src_utcYear(d),d),p,2)}function formatUTCWeekNumberISO(d,p){var day=d.getUTCDay();d=day>=4||day===0?utcThursday(d):utcThursday.ceil(d);return pad(utcThursday.count(src_utcYear(d),d)+(src_utcYear(d).getUTCDay()===4),p,2)}function formatUTCWeekdayNumberSunday(d){return d.getUTCDay()}function formatUTCWeekNumberMonday(d,p){return pad(utcMonday.count(src_utcYear(d),d),p,2)}function formatUTCYear(d,p){return pad(d.getUTCFullYear()%100,p,2)}function formatUTCFullYear(d,p){return pad(d.getUTCFullYear()%1e4,p,4)}function formatUTCZone(){return"+0000"}function formatLiteralPercent(){return"%"}function formatUnixTimestamp(d){return+d}function formatUnixTimestampSeconds(d){return Math.floor(+d/1e3)}var src_defaultLocale_locale;var timeFormat;var timeParse;var utcFormat;var utcParse;defaultLocale_defaultLocale({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function defaultLocale_defaultLocale(definition){src_defaultLocale_locale=formatLocale(definition);timeFormat=src_defaultLocale_locale.format;timeParse=src_defaultLocale_locale.parse;utcFormat=src_defaultLocale_locale.utcFormat;utcParse=src_defaultLocale_locale.utcParse;return src_defaultLocale_locale}var isoSpecifier="%Y-%m-%dT%H:%M:%S.%LZ";function formatIsoNative(date){return date.toISOString()}var formatIso=Date.prototype.toISOString?formatIsoNative:utcFormat(isoSpecifier);var isoFormat=formatIso;function parseIsoNative(string){var date=new Date(string);return isNaN(date)?null:date}var parseIso=+new Date("2000-01-01T00:00:00.000Z")?parseIsoNative:utcParse(isoSpecifier);var isoParse=parseIso;var time_durationSecond=1e3,time_durationMinute=time_durationSecond*60,time_durationHour=time_durationMinute*60,time_durationDay=time_durationHour*24,time_durationWeek=time_durationDay*7,durationMonth=time_durationDay*30,durationYear=time_durationDay*365;function time_date(t){return new Date(t)}function time_number(t){return t instanceof Date?+t:+new Date(+t)}function calendar(year,month,week,day,hour,minute,second,millisecond,format){var scale=continuous(deinterpolateLinear,number),invert=scale.invert,domain=scale.domain;var formatMillisecond=format(".%L"),formatSecond=format(":%S"),formatMinute=format("%I:%M"),formatHour=format("%I %p"),formatDay=format("%a %d"),formatWeek=format("%b %d"),formatMonth=format("%B"),formatYear=format("%Y");var tickIntervals=[[second,1,time_durationSecond],[second,5,5*time_durationSecond],[second,15,15*time_durationSecond],[second,30,30*time_durationSecond],[minute,1,time_durationMinute],[minute,5,5*time_durationMinute],[minute,15,15*time_durationMinute],[minute,30,30*time_durationMinute],[hour,1,time_durationHour],[hour,3,3*time_durationHour],[hour,6,6*time_durationHour],[hour,12,12*time_durationHour],[day,1,time_durationDay],[day,2,2*time_durationDay],[week,1,time_durationWeek],[month,1,durationMonth],[month,3,3*durationMonth],[year,1,durationYear]];function tickFormat(date){return(second(date)<date?formatMillisecond:minute(date)<date?formatSecond:hour(date)<date?formatMinute:day(date)<date?formatHour:month(date)<date?week(date)<date?formatDay:formatWeek:year(date)<date?formatMonth:formatYear)(date)}function tickInterval(interval,start,stop,step){if(interval==null)interval=10;if(typeof interval==="number"){var target=Math.abs(stop-start)/interval,i=bisector(function(i){return i[2]}).right(tickIntervals,target);if(i===tickIntervals.length){step=tickStep(start/durationYear,stop/durationYear,interval);interval=year}else if(i){i=tickIntervals[target/tickIntervals[i-1][2]<tickIntervals[i][2]/target?i-1:i];step=i[1];interval=i[0]}else{step=Math.max(tickStep(start,stop,interval),1);interval=millisecond}}return step==null?interval:interval.every(step)}scale.invert=function(y){return new Date(invert(y))};scale.domain=function(_){return arguments.length?domain(array_map.call(_,time_number)):domain().map(time_date)};scale.ticks=function(interval,step){var d=domain(),t0=d[0],t1=d[d.length-1],r=t1<t0,t;if(r)t=t0,t0=t1,t1=t;t=tickInterval(interval,t0,t1,step);t=t?t.range(t0,t1+1):[];return r?t.reverse():t};scale.tickFormat=function(count,specifier){return specifier==null?tickFormat:format(specifier)};scale.nice=function(interval,step){var d=domain();return(interval=tickInterval(interval,d[0],d[d.length-1],step))?domain(nice(d,interval)):scale};scale.copy=function(){return copy(scale,calendar(year,month,week,day,hour,minute,second,millisecond,format))};return scale}var time=function(){return calendar(src_year,src_month,sunday,src_day,src_hour,src_minute,src_second,src_millisecond,timeFormat).domain([new Date(2e3,0,1),new Date(2e3,0,2)])};var utcTime=function(){return calendar(src_utcYear,src_utcMonth,utcSunday,src_utcDay,src_utcHour,src_utcMinute,src_second,src_millisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)])};function sequential(interpolator){var x0=0,x1=1,k10=1,clamp=false;function scale(x){var t=(x-x0)*k10;return interpolator(clamp?Math.max(0,Math.min(1,t)):t)}scale.domain=function(_){return arguments.length?(x0=+_[0],x1=+_[1],k10=x0===x1?0:1/(x1-x0),scale):[x0,x1]};scale.clamp=function(_){return arguments.length?(clamp=!!_,scale):clamp};scale.interpolator=function(_){return arguments.length?(interpolator=_,scale):interpolator};scale.copy=function(){return sequential(interpolator).domain([x0,x1]).clamp(clamp)};return linearish(scale)}function diverging(interpolator){var x0=0,x1=.5,x2=1,k10=1,k21=1,clamp=false;function scale(x){var t=.5+((x=+x)-x1)*(x<x1?k10:k21);return interpolator(clamp?Math.max(0,Math.min(1,t)):t)}scale.domain=function(_){return arguments.length?(x0=+_[0],x1=+_[1],x2=+_[2],k10=x0===x1?0:.5/(x1-x0),k21=x1===x2?0:.5/(x2-x1),scale):[x0,x1,x2]};scale.clamp=function(_){return arguments.length?(clamp=!!_,scale):clamp};scale.interpolator=function(_){return arguments.length?(interpolator=_,scale):interpolator};scale.copy=function(){return diverging(interpolator).domain([x0,x1,x2]).clamp(clamp)};return linearish(scale)}var numberHelper=__webpack_require__(7);function Topic_rgbToHex(rgbColor){return"#"+["r","g","b"].map(function(level){return rgbColor[level].toString(16).padStart(2,0).toUpperCase()}).join("")}function getInterpolatedColour(_ref){var value=_ref.value,_ref$min=_ref.min,min=_ref$min===void 0?0:_ref$min,max=_ref.max,start=_ref.start,mid=_ref.mid,end=_ref.end;var scaleFn=linear_linear().domain([min,(min+max)/2,max]).range([start,mid,end]).interpolate(src_rgb);return Topic_rgbToHex(color_rgb(scaleFn(value)))}var prettyNumber=numberHelper["default"].prettyNumber;function Topic_Topic(topicData){this.id=topicData.id;this.type=topicData.type;this.label=topicData.label;this.volume=topicData.volume;this.trending=topicData.trending;this.sentiment=topicData.sentiment;this.sentimentScore=topicData.sentimentScore;this.gender=topicData.gender;this.randomColor=topicData.randomColor}Topic_Topic.prototype={getTopicTypeColor:function getTopicTypeColor(){if(this.type===api.TOPICS_API_RETURN_TYPES.WORD){return colorsHelper_colors.TOPIC_TYPE_WORD}if(this.type===api.TOPICS_API_RETURN_TYPES.PHRASE){return colorsHelper_colors.TOPIC_TYPE_PHRASE}if(this.type===api.TOPICS_API_RETURN_TYPES.HASH_TAG){return colorsHelper_colors.TOPIC_TYPE_HASH_TAG}if(this.type===api.TOPICS_API_RETURN_TYPES.PLACE){return colorsHelper_colors.TOPIC_TYPE_PLACE}if(this.type===api.TOPICS_API_RETURN_TYPES.ORGANISATION){return colorsHelper_colors.TOPIC_TYPE_ORGANISATION}if(this.type===api.TOPICS_API_RETURN_TYPES.PERSON){return colorsHelper_colors.TOPIC_TYPE_PERSON}if(this.type===api.TOPICS_API_RETURN_TYPES.EMOJI){return null}},getSentimentName:function getSentimentName(){if(this.sentimentScore>60){return api.TOPICS_UI_SENTIMENT.POSITIVE}if(this.sentimentScore>20){return api.TOPICS_UI_SENTIMENT.RATHER_POSITIVE}if(this.sentimentScore<-60){return api.TOPICS_UI_SENTIMENT.NEGATIVE}if(this.sentimentScore<-20){return api.TOPICS_UI_SENTIMENT.RATHER_NEGATIVE}return api.TOPICS_UI_SENTIMENT.NEUTRAL},getGender:function getGender(){if(this.gender.male>this.gender.female){return api.TOPICS_UI_GENDERS.MALE}if(this.gender.male<this.gender.female){return api.TOPICS_UI_GENDERS.FEMALE}return api.TOPICS_UI_GENDERS.UNKNOWN},getTrendingType:function getTrendingType(){return this.trending<0?"Fading":"Trending"},getVolumeColor:function getVolumeColor(options){return getInterpolatedColour({start:colorsHelper_colors.VOLUME_LOW,mid:colorsHelper_colors.VOLUME_MID,end:colorsHelper_colors.VOLUME_HIGH,value:this.volume,max:options.maxValue})},getTrendingColor:function getTrendingColor(options){return getInterpolatedColour({start:colorsHelper_colors.TRENDING_LOW,mid:colorsHelper_colors.TRENDING_MID,end:colorsHelper_colors.TRENDING_HIGH,value:this.trending,min:options.minValue,max:options.maxValue})},getGenderPercentage:function getGenderPercentage(){function percentage(partial,total){if(total===0){return 0}else{return 100*partial/total}}var _this$gender=this.gender,male=_this$gender.male,female=_this$gender.female;return Math.round(percentage(Math.max(male,female),male+female))},getColorForMetric:function getColorForMetric(metric){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};switch(metric){case"topicType":return this.getTopicTypeColor();case"sentiment":return api.TOPICS_SENTIMENT_COLOR_MAP.get(this.getSentimentName());case"gender":return api.TOPICS_GENDER_COLOR_MAP.get(this.getGender());case"volume":return this.getVolumeColor(options);case"trending":return this.getTrendingColor(options);case"random":return this.randomColor;default:return colorsHelper_colors.DEFAULT}},getValueForMetric:function getValueForMetric(metric){switch(metric){case"topicType":return prettyNumber(this.volume);case"sentiment":return this.sentimentScore;case"gender":return this.getGenderPercentage();case"volume":return prettyNumber(this.volume);case"random":return prettyNumber(this.volume);default:return prettyNumber(this.volume)}},generateText:function generateText(){return this.type===api.TOPICS_API_RETURN_TYPES.EMOJI?this.id:this.label}};var topicsHelper_Topic=Topic_Topic;var axiomColors={"blast-off":{r:249,g:138,b:57},"crash-course":{r:255,g:109,b:86},"critical-mass":{r:227,g:90,b:122},"electric-dreams":{r:59,g:121,b:204},"event-horizon":{r:96,g:99,b:161},"ground-control":{r:158,g:83,b:32},"social-instagram":{r:183,g:71,b:146},"moon-lagoon":{r:36,g:173,b:189},"new-horizon":{r:242,g:174,b:0},"paradise-lost":{r:156,g:115,b:178},"rocky-planet":{r:158,g:142,b:117},"serene-sea":{r:144,g:160,b:214},"solar-rust":{r:205,g:129,b:26},"space-invader":{r:47,g:145,b:112},"space-oddity":{r:189,g:163,b:91},"terra-form":{r:128,g:190,b:76}};function colorGenerator_rgbToHex(rgbColor){return"#".concat(["r","g","b"].map(function(level){return rgbColor[level].toString(16).padStart(2,0).toUpperCase()}).join(""))}var axiomColorsByHex=Object.values(axiomColors).map(function(color){return colorGenerator_rgbToHex(color)});function colorGenerator_chartColorGenerator(index){var nextColor=axiomColorsByHex[index%axiomColorsByHex.length];return nextColor}var topicsWheel_colorGenerator=colorGenerator_chartColorGenerator;function _objectWithoutProperties(source,excluded){if(source==null)return{};var target=_objectWithoutPropertiesLoose(source,excluded);var key,i;if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++){key=sourceSymbolKeys[i];if(excluded.indexOf(key)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(source,key))continue;target[key]=source[key]}}return target}function _objectWithoutPropertiesLoose(source,excluded){if(source==null)return{};var target={};var sourceKeys=Object.keys(source);var key,i;for(i=0;i<sourceKeys.length;i++){key=sourceKeys[i];if(excluded.indexOf(key)>=0)continue;target[key]=source[key]}return target}var LIGHT_TEXT="#ffffff";var DARK_TEXT="#302D35";var textColorByTopicColorMap=new Map([["#55CDE6",DARK_TEXT],["#FFBE0A",DARK_TEXT],["#80BE4C",DARK_TEXT],["#9C73B2",LIGHT_TEXT],["#E35A7A",LIGHT_TEXT],["#9E6139",LIGHT_TEXT],["#24ADBD",DARK_TEXT],["#F98A39",DARK_TEXT],["#F498B7",DARK_TEXT],["#90A0D6",DARK_TEXT],["#C8C819",DARK_TEXT],["#78909C",LIGHT_TEXT],["#FF6D56",DARK_TEXT],["#FCD512",DARK_TEXT],["#6063A1",LIGHT_TEXT],["#F5B1A4",DARK_TEXT],["#BDA35B",DARK_TEXT],["#7FD6F8",DARK_TEXT],["#2F9170",LIGHT_TEXT],["#74C971",DARK_TEXT],["#9E8E75",LIGHT_TEXT]]);function calculateTopicVolume(topic){if(topic.hasOwnProperty("topics")){return topic.topics.reduce(function(memo,childTopic){return memo+calculateTopicVolume(childTopic)},0)}if(topic.hasOwnProperty("volume")){return topic.volume}return 0}var colorBySentimentMap=new Map([["positive","#4CA15A"],["neutral","#BBB9C0"],["negative","#D74A4A"]]);var colorByAccountTypeMap=new Map([["individual","#C8C819"],["organisational","#78909C"]]);var colorByGenderMap=new Map([["male","#3B74B7"],["female","#A72E5E"]]);var colorTypeMap=new Map([["gender",colorByGenderMap],["accountType",colorByAccountTypeMap],["sentiment",colorBySentimentMap]]);function getColorForMappedType(id,type){var colorMap=colorTypeMap.get(type);return colorMap.has(id)?colorMap.get(id):null}function getColorForUnmappedType(index){return topicsWheel_colorGenerator(index)}function calculateTopicColor(topic){if(["category","query","queryGroup","tag"].includes(topic.type)){return getColorForUnmappedType(topic.index)}if(colorTypeMap.has(topic.type)){return getColorForMappedType(topic.id,topic.type)}if(topic.parent&&topic.parent.color){return topic.parent.color}return null}function getTopicFilters(topic){if(!topic.hasOwnProperty("filter")){return{search:topic.label}}return topic.filter}function topicMapper(segmentation,topic){var _getTopicFilters=getTopicFilters(topic),search=_getTopicFilters.search,additionalOptions=_objectWithoutProperties(_getTopicFilters,["search"]);var topicColor=calculateTopicColor(topic);var dataLabelColor=textColorByTopicColorMap.get(topicColor);return{id:"".concat(topic.parent.id,":").concat(topic.id),parent:topic.parent.id,parentNode:topic.parent,name:topic.label,isLeaf:!topic.hasOwnProperty("topics"),search:search,volume:calculateTopicVolume(topic),color:topicColor,dataLabels:{color:dataLabelColor},additionalOptions:additionalOptions,type:topic.type}}function prepareTopics(topics,segmentation){if(topics.length===0){return[]}var rootNode={id:"root",parent:null,name:" "};return[rootNode].concat(flattenTopics(topics,rootNode,topicMapper.bind(null,segmentation)))}function flattenTopics(topics,parent,mapper){return topics.reduce(function(memo,topic,index){var transformedTopic=mapper(Object.assign({parent:parent},topic,{index:index}));if(topic.topics){return[transformedTopic].concat(flattenTopics(topic.topics,transformedTopic,mapper)).concat(memo)}return memo.concat([transformedTopic])},[])}var topicsWheel_prepareTopics=prepareTopics;var topicsWheel={prepareTopics:topicsWheel_prepareTopics};function createTopicWithRandomColor(Topic){var colorGenerator=arguments.length>1&&arguments[1]!==undefined?arguments[1]:chartColorGenerator;var generator=colorGenerator();return function(topicProps){var extraProps={randomColor:generator()};var newTopicProps=Object.assign(extraProps,topicProps);return new Topic(newTopicProps)}}function createTopicsCollection(topics){var Topic=arguments.length>1&&arguments[1]!==undefined?arguments[1]:topicsHelper_Topic;var createTopic=createTopicWithRandomColor(Topic);return topics.map(createTopic)}var topicsCollectionHelper=createTopicsCollection;var MAX_CLOUD_SIZE=300;var naturalNumberProperties=new Set(["volume"]);function prepareTopics_prepareTopics(topics,settings){var cloudSize=settings.cloudSize,wordSize=settings.wordSize;var filteredTopics=topics.filter(function(topic){return!naturalNumberProperties.has(wordSize)||topic[wordSize]>0}).sort(function(a,b){return b[wordSize]-a[wordSize]}).slice(0,Math.min(cloudSize,MAX_CLOUD_SIZE));return topicsCollectionHelper(filteredTopics)}var topicsCloud_prepareTopics=prepareTopics_prepareTopics;var topicsCloud={prepareTopics:topicsCloud_prepareTopics};function TopicForTopicsPlane_objectWithoutProperties(source,excluded){if(source==null)return{};var target=TopicForTopicsPlane_objectWithoutPropertiesLoose(source,excluded);var key,i;if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++){key=sourceSymbolKeys[i];if(excluded.indexOf(key)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(source,key))continue;target[key]=source[key]}}return target}function TopicForTopicsPlane_objectWithoutPropertiesLoose(source,excluded){if(source==null)return{};var target={};var sourceKeys=Object.keys(source);var key,i;for(i=0;i<sourceKeys.length;i++){key=sourceKeys[i];if(excluded.indexOf(key)>=0)continue;target[key]=source[key]}return target}function TopicForTopicsPlane(topicData){var comparison1=topicData.comparison1,genericData=TopicForTopicsPlane_objectWithoutProperties(topicData,["comparison1"]);var topic=new topicsHelper_Topic(genericData);topic.position={x:comparison1.score/100};return topic}var topicsPlane_TopicForTopicsPlane=TopicForTopicsPlane;var MAX_PLANE_SIZE=100;var prepareTopics_naturalNumberProperties=new Set(["volume"]);function topicsPlane_prepareTopics_prepareTopics(topics,settings){var displayedTopics=settings.displayedTopics,wordSize=settings.wordSize;var filteredTopics=topics.filter(function(topic){return!prepareTopics_naturalNumberProperties.has(wordSize)||topic[wordSize]>0}).sort(function(a,b){return b[wordSize]-a[wordSize]}).slice(0,Math.min(displayedTopics,MAX_PLANE_SIZE));return topicsCollectionHelper(filteredTopics,topicsPlane_TopicForTopicsPlane)}var topicsPlane_prepareTopics=topicsPlane_prepareTopics_prepareTopics;var topicsPlane={prepareTopics:topicsPlane_prepareTopics};var topicsHelper=__webpack_exports__["default"]={constants:{api:api,colors:colorsHelper_colors},getLegend:legendHelper,mapTopicsForVis:topicsToVis,Topic:topicsHelper_Topic,topicsWheel:topicsWheel,topicsCloud:topicsCloud,topicsPlane:topicsPlane}}])["default"]});define("src/components/topics/helpers/TopicClickthroughOptionsBuilder",["underscore","bw-fe-helpers/topicsHelper"],function(_,topicsHelper){"use strict";function buildSearchString(topic,options){var searchString;var parts=[];var topicSearchTerm;var TOPICS_API_RETURN_TYPES=topicsHelper.constants.api.TOPICS_API_RETURN_TYPES;if(topic.hasOwnProperty("search")){topicSearchTerm=topic.search}else{if(topic.type===TOPICS_API_RETURN_TYPES.HASH_TAG){var startsWithHash=topic.label.charAt(0)==="#";var tag=startsWithHash?topic.label.slice(1):topic.label;topicSearchTerm="hashtags:".concat(tag)}else{topicSearchTerm='"'.concat(topic.label,'"')}}var legacyTypes=["topic"];var topicTypesWithSearchTerms=[TOPICS_API_RETURN_TYPES.WORD,TOPICS_API_RETURN_TYPES.HASH_TAG,TOPICS_API_RETURN_TYPES.PERSON,TOPICS_API_RETURN_TYPES.PLACE,TOPICS_API_RETURN_TYPES.ORGANISATION,TOPICS_API_RETURN_TYPES.PHRASE,TOPICS_API_RETURN_TYPES.NOUN,TOPICS_API_RETURN_TYPES.ADJECTIVE,TOPICS_API_RETURN_TYPES.VERB].concat(legacyTypes);if(topicTypesWithSearchTerms.includes(topic.type)){options.search="".concat(options.search," ").concat(topicSearchTerm).trim()}if(options.search){parts.push(options.search)}if(options.quickSearch&&typeof options.quickSearch==="string"){var quickSearch=options.quickSearch.trim();if(parts.length>0){parts.push("(".concat(quickSearch,")"))}else{parts.push("".concat(quickSearch))}}searchString=_.compact(parts).join(" AND ");return searchString}function TopicClickthroughOptionsBuilder(options){this.topicsModel=options.topicsModel;this.breadcrumbModel=options.breadcrumbModel;this.settings=options.settings}_.extend(TopicClickthroughOptionsBuilder.prototype,{getMentionOptions:function getMentionOptions(topicId,options){var topic=this.topicsModel.getTopic(topicId);return this.getMentionOptionsForTopic(topic,options)},getQuickSearchString:function getQuickSearchString(settings){if(settings&&typeof settings.get==="function"){return settings.get("search")}else{return""}},getMentionOptionsForTopic:function getMentionOptionsForTopic(topic){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var search=buildSearchString(topic,{search:this.breadcrumbModel.getSearchString()||"",quickSearch:this.getQuickSearchString(this.settings)});var categories=this.breadcrumbModel.getSearchCategoryIds();var tags=this.breadcrumbModel.getSearchTagIds();var title;if(topic.type==="emoji"){options.emojis=topic.id;var emojiImage=window.twemoji.parse(topic.id,{attributes:function attributes(){return{title:topic.label}}});title="Mentions Found for ".concat(emojiImage)}else if(topic.type==="tag"){tags.push(topic.id)}else if(topic.type==="category"){categories.push(topic.id)}return _.extend({search:search,category:categories,tag:tags,title:title},options)}});return TopicClickthroughOptionsBuilder});define("mustache!src/components/topics/templates/topicContextMenu",["lib/mustache"],function(mustache){var escapedTemplate='{{^showViewMentions}}\n<ul>\n<li class="context-menu--item topic-viewmentions"><a>View Mentions ({{volume}})</a></li>\n</ul>\n{{/showViewMentions}}\n{{#showQueryBreakdown}}\n<ul class="queriesHeader">\n{{^showViewMentions}}\n<li class="context-menu--item separator"></li>\n{{/showViewMentions}}\n<li class="context-menu--section-title">\n<p>View Mentions by Query</p>\n</li>\n</ul>\n<ul class="queries">\n{{#queries}}\n<li class="context-menu--item topic-viewmentions" data-queryid="{{queryId}}">\n<a>{{queryName}} ({{volume}})</a>\n</li>\n{{/queries}}\n{{^allQueriesDisplayed}}\n<li class="context-menu--section-footer"><p class="query-limit-exceeded">(Showing first {{maxQueries}} Queries)</p></li>\n{{/allQueriesDisplayed}}\n</ul>\n{{/showQueryBreakdown}}\n<ul>\n<li class="context-menu--item separator"></li>\n<li class="context-menu--item topic-zoom"><a>Zoom Into</a></li>\n{{#showGraphOption}}\n<li class="context-menu--item topic-graph" data-topiccolour="{{colour}}"><a>View on Graph</a></li>\n{{/showGraphOption}}\n{{^showGraphOption}}\n<li class="context-menu--item topic-ungraph" data-topiccolour="{{colour}}"><a>Remove from Graph</a></li>\n{{/showGraphOption}}\n<li class="context-menu--item topic-hidetag"><a>Delete Topic</a></li>\n{{#showCreateRule}}\n<li class="context-menu--item separator"></li>\n<li class="context-menu--item topic-create-rule"><a>Create Rule from this Topic...</a><span class="newIcon"></span></li>\n{{/showCreateRule}}\n</ul>\n\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/components/topics/templates/confirmDeleteTopic",["lib/mustache"],function(mustache){var escapedTemplate='<div class="confirmation">\n<h1 class="popuptitletext singlemargin-bottom draggable">Delete Topic<h1>\n<p class="warning">\nAre you sure you want to delete <br/>"{{topicName}}"?\n</p>\n<p>\nIt will be permanently removed from<br/><b>this component only</b>.\n</p>\n<p class="doublemargin-top">\n<button class="defaultbutton confirm-yes">Yes</button>\n<button class="button singlemargin-left confirm-no">No</button>\n</p>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/components/topics/views/TopicContextMenu",["jquery","underscore","src/globals/queries","src/permissions","src/views/ContextMenuView","src/components/topics/helpers/TopicClickthroughOptionsBuilder","mustache!src/components/topics/templates/topicContextMenu","mustache!src/components/topics/templates/confirmDeleteTopic","lib/jquery.showMessage","src/packages/modalDialogs"],function($,_,queries,permissions,ContextMenuView,TopicClickthroughOptionsBuilder,contextMenuTemplate,deleteTopicTemplate){"use strict";var MAX_QUERIES=10;function colourToHex(colour){if(colour.indexOf("#")>-1){return colour}var d=/(.*?)rgb\((\d+), (\d+), (\d+)\)/.exec(colour),r=parseInt(d[2],10).toString(16),g=parseInt(d[3],10).toString(16),b=parseInt(d[4],10).toString(16);if(r.length<2){r="0"+r}if(g.length<2){g="0"+g}if(b.length<2){b="0"+b}return"#"+r+g+b}function getQueryOptions(topicQueries){var queryOptions;if(!_(topicQueries).isArray()||_(topicQueries).isEmpty()){return[]}queryOptions=_(topicQueries).chain().reject(function(query){return query.volume===0}).map(function(query){return{queryId:query.id,queryName:queries.get(query.id).get("name"),volume:query.volume}}).sortBy(function(query){return query.queryName}).value();return queryOptions}function getMentionOptions(view,queryId){return new TopicClickthroughOptionsBuilder({breadcrumbModel:view.breadcrumbModel,settings:view.settings}).getMentionOptionsForTopic(view.topicData,{queryId:queryId,currentMode:queryId?"query":undefined})}return ContextMenuView.extend({tagName:"nav",className:"topicContextMenu context-menu popupframe",template:contextMenuTemplate,events:{"click li.topic-viewmentions":"onClickViewTopicMentions","click li.topic-zoom":"zoomTopic","click li.topic-hidetag":"hideTopic","click li.topic-graph":"graphTopic","click li.topic-ungraph":"removeGraphTopic","click li.topic-create-rule":"createRule"},initialize:function initialize(options){options=options||{};if(!options.topicData){throw new Error("topicData must be specified")}this.topicData=options.topicData;this.showGraphOption=_(options.isInGraph).isBoolean()?!options.isInGraph:false;this.$target=options.$target;this.breadcrumbModel=options.breadcrumbModel;this.settings=options.settings;this.multipleQueries=options.multipleQueries;this.position=options.position},render:function render(){var $topic=this.$target,topicData=this.topicData,queryOptions=getQueryOptions(topicData.queries),allQueriesDisplayed=queryOptions.length<=MAX_QUERIES,queriesForDisplay=_(queryOptions).first(MAX_QUERIES),data={name:topicData.label,id:topicData.id,colour:colourToHex($topic.css("color")),type:topicData.type,volume:topicData.volume,showGraphOption:this.showGraphOption,showViewMentions:this.multipleQueries&&queriesForDisplay.length===1,showQueryBreakdown:this.multipleQueries,showCreateRule:permissions.check("edit.rules"),queries:queriesForDisplay,allQueriesDisplayed:allQueriesDisplayed,maxQueries:MAX_QUERIES};this.$el.html(this.template(data))},performDefaultAction:function performDefaultAction(){this.zoomTopic()},zoomTopic:function zoomTopic(){var topicData=this.topicData;this.breadcrumbModel.zoomInto({id:topicData.id,name:topicData.label,type:topicData.type,active:true})},onClickViewTopicMentions:function onClickViewTopicMentions(e){var $target=$(e.currentTarget);this.viewTopicMentions($target.data("queryid"))},viewTopicMentions:function viewTopicMentions(queryId){var mentionOptions=getMentionOptions(this,queryId);this.trigger("showMentionInfo",mentionOptions)},hideTopic:function hideTopic(){var confEl=this.confEl=$(deleteTopicTemplate({topicName:this.topicData.label,topicId:this.topicData.id})),onClickConfirmation=_(this.onClickConfirmation).bind(this);confEl.showModal({draggable:".draggable",className:"popup tinypopup"});confEl.parent().find(".close").hide();confEl.parent().on("click",".confirmation",onClickConfirmation)},graphTopic:function graphTopic(){this.trigger("topicAddedToGraph",this.topicData.id)},removeGraphTopic:function removeGraphTopic(){this.trigger("topicRemovedFromGraph",this.topicData.id)},createRule:function createRule(){var settings=this.settings&&this.settings.toJSON()||{};var finalSettings=Object.assign(settings,getMentionOptions(this));this.trigger("createRule",finalSettings)},onClickConfirmation:function onClickConfirmation(e){var $target=$(e.target),$confirmation=$target.parents(".confirmation");if(!$confirmation.length){return false}this.clickConfirmation($target,$confirmation)},getTopicBlacklistProperty:function getTopicBlacklistProperty(topicData){return topicData.label},clickConfirmation:function clickConfirmation($target,$confirmation){if($target.is(".confirm-yes")){this.trigger("hideTopic",this.getTopicBlacklistProperty(this.topicData));$confirmation.removeModal()}else if($target.is(".confirm-no")){$confirmation.removeModal()}}})});define("mustache!src/components/topics/templates/topicsList",["lib/mustache"],function(mustache){var escapedTemplate='<div class="cloud-keys">\n<div class="cloud" id="{{containerId}}"></div>\n{{#includeKey}}\n<div class="key-wrapper">\n<span class="key-topic"><span></span>Topics</span>\n<span class="key-tag"><span></span>Tags</span>\n<span class="key-category"><span></span>Categories</span>\n</div>\n{{/includeKey}}\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/components/topics/views/TopicsCloudView",["backbone","underscore","jquery","d3","src/globals/queries","src/globals/queryGroups","src/components/topics/views/TopicContextMenu","src/helpers/topicsConverter","src/helpers/topicsCloudRenderer","src/helpers/createRuleHelper","mustache!src/components/topics/templates/topicsList","css!src/components/topics/css/topics.css"],function(Backbone,_,$,d3,queries,queryGroups,TopicContextMenu,topicsConverter,topicsCloudRenderer,createRuleHelper,topicsListTemplate){"use strict";function isLogoQuery(settings){var currentMode=settings.get("currentMode");var queryGroupId=settings.get("queryGroupId");var queryId=settings.get("queryId");if(queryGroupId&&(!currentMode||currentMode==="queryGroup")){var queryGroup=queryGroups.get(queryGroupId);var queryList=queryGroup.get("queries");var isLogoQueryTest=_.find(queryList,function(queryObj){var query=queries.get(queryObj.id);return query&&query.get("type")==="logo"});return isLogoQueryTest}var query=queries.get(queryId);return query&&query.get("type")==="logo"}return Backbone.View.extend({className:"topicsCloud",contextMenuClass:TopicContextMenu,initialize:function initialize(options){if(!options||!options.breadcrumbModel){throw new Error("options.breadcrumbModel must be set!")}if(!options.showMentionInfo){throw new Error("options.showMentionInfo must be set!")}this.showMentionInfo=options.showMentionInfo;this.breadcrumbModel=options.breadcrumbModel;this.contextMenuEnabled=_.isBoolean(options.contextMenuEnabled)?options.contextMenuEnabled:true;this.settings=options.settings;this.grapherView=options.grapherView;this.includeKey=!!options.includeKey;this.renderCloudContainer({containerId:_.uniqueId("cloud-"),includeKey:this.includeKey})},renderCloudContainer:function renderCloudContainer(options){this.$el.html(topicsListTemplate(options))},addToBlacklist:function addToBlacklist(topic){var controlSettings=this.settings;var currentBlacklist=_.clone(controlSettings.get("blacklistTopics")||[]);currentBlacklist.push(topic);controlSettings.set({blacklistTopics:_(currentBlacklist).uniq()})},onShowTopicMenu:function onShowTopicMenu(topic){this.showTopicMenu({topicId:topic.id,$target:$(d3.event.target),openDefault:!this.contextMenuEnabled||d3.event.type==="dblclick"})},showTopicMenu:function showTopicMenu(settings){var topicData=this.model.getTopic(settings.topicId);var options={topicData:topicData,settings:this.settings,multipleQueries:this.settings.get("queryId").length>1,breadcrumbModel:this.breadcrumbModel,isInGraph:this.grapherView?this.grapherView.isGraphed(settings.topicId):false,position:"below-center"};this.contextMenu=this.contextMenuClass.show(_(settings).extend(options));if(this.contextMenuEnabled){this.listenTo(this.contextMenu,"showMentionInfo",this.showMentionInfo);this.listenTo(this.contextMenu,"hideTopic",this.addToBlacklist);this.listenTo(this.contextMenu,"topicAddedToGraph",this.onTopicAddedToGraph);this.listenTo(this.contextMenu,"topicRemovedFromGraph",this.onTopicRemovedFromGraph);this.listenTo(this.contextMenu,"createRule",this.onTopicCreateRule)}},onTopicAddedToGraph:function onTopicAddedToGraph(topicId){this.trigger("topicAddedToGraph",topicId)},onTopicRemovedFromGraph:function onTopicRemovedFromGraph(topicId){this.trigger("topicRemovedFromGraph",topicId)},onTopicCreateRule:function onTopicCreateRule(settings){var querySettings={};if(!settings.queryId){var isQueryGroupMode=this.settings.get("currentMode")==="queryGroup";var queryGroupId=this.settings.get("queryGroupId");querySettings.queryId=isQueryGroupMode&&queryGroupId?queryGroups.getQueryIdsFromGroupIds([queryGroupId]):this.settings.get("queryId")}createRuleHelper.show(Object.assign({},settings,querySettings))},render:function render(options){var $el=this.$el;var topicsData=this.model.get("topics");var cleanedTopics;if(this.settings&&isLogoQuery(this.settings)){this.addToBlacklist("twitter")}this.colourScheme=(options||{}).colourScheme||"basic";this.renderCloudContainer({containerId:_.uniqueId("cloud-"),includeKey:this.includeKey});if(!_.isArray(topicsData)){return}cleanedTopics=this.breadcrumbModel.cleanByName(topicsData);this.topicsToUse=topicsConverter.prepareTopicsForCloud(cleanedTopics,this.colourScheme);if(!this.topicsToUse||!this.topicsToUse.length){$el.find(".cloud").showMessage("No results");this.trigger("renderComplete");return}this.renderCloud()},renderCloud:function renderCloud(){var options={$cloudContainer:this.$el.find(".cloud"),height:450,clickHandler:this.onShowTopicMenu.bind(this),words:this.topicsToUse.map(_.clone),callback:this.trigger.bind(this,"renderComplete")};topicsCloudRenderer.renderCloud(options)},reflow:function reflow(){if(this.topicsToUse&&this.topicsToUse.length){this.renderCloud()}},shown:function shown(){this.reflow()}})});define("mustache!src/components/topics/templates/topicsBreadcrumb",["lib/mustache"],function(mustache){var escapedTemplate='{{#hastopics}}\n<ul class="topic-breadcrumb">\n<li class="first">\n<a class="topic-breadcrumb-remove">Back to Top</a>\n<span class="chevron-out"></span>\n</li>\n{{#topics}}\n<li{{#islast}} class="last"{{/islast}}>\n<span class="chevron-in"></span>\n<a class="topic-trail {{activityCName}}" data-topicname="{{name}}" data-topicid="{{id}}">{{name}}</a>\n<span class="chevron-out"></span>\n</li>\n{{/topics}}\n</ul>\n{{/hastopics}}';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/components/topics/views/TopicsBreadcrumbView",["backbone","underscore","jquery","mustache!src/components/topics/templates/topicsBreadcrumb"],function(Backbone,_,$,breadcrumbTemplate){"use strict";return Backbone.View.extend({className:"breadCrumb topicsBreadcrumb",_isLocked:false,events:{"click .topic-breadcrumb-remove":"onClickRemoveBreadcrumb","click .topic-trail":"onClickBreadcrumbItem"},initialize:function initialize(options){Backbone.View.prototype.initialize.call(this,options);this.listenTo(this.model,"change",this.render);this.listenTo(this.model,"rerender",this.render);this.lockable=options.lockable===true},lock:function lock(){if(!this.lockable){throw new Error("Cannot lock a non-lockable breadcrumb")}this._isLocked=true},unlock:function unlock(){this._isLocked=false},isLocked:function isLocked(){return this.lockable&&this._isLocked},onClickRemoveBreadcrumb:function onClickRemoveBreadcrumb(){if(this.isLocked()){return false}if(this.lockable){this.lock()}this.model.clear();return false},onClickBreadcrumbItem:function onClickBreadcrumbItem(e){if(this.isLocked()){return false}var $target=$(e.target);if($target.is(".currenttopic")){return false}if(this.lockable){this.lock()}this.model.navigateTo($target.attr("data-topicid"));return false},compileBreadcrumbTemplate:function compileBreadcrumbTemplate(){var trail=this.model.get("breadcrumb")||[],$domEl=$(breadcrumbTemplate({hastopics:!!_(trail).size(),topics:_(trail).reduce(function(memo,t,i){t.activityCName=t.active?"active":"inactive";t.islast=i===trail.length-1;if(t.isActiveTopic){t.activityCName+=" currenttopic"}memo.push(t);return memo},[])}));$domEl.find(".active:last").addClass("currenttopic");return $domEl},render:function render(){this.$el.html(this.compileBreadcrumbTemplate())}})});define("src/components/topics/models/TopicsBreadcrumb",["backbone","underscore"],function(Backbone,_){"use strict";function getSearchValues(self,types,val){return _(self.getBreadcrumbNodes()).chain().filter(function(t){return t.active&&(types.length===0||_.contains(types,t.type))}).pluck(val).value()}return Backbone.Model.extend({initialize:function initialize(options){if(options&&options.breadcrumbNodes){this.updateTrail(options.breadcrumbNodes)}},zoomInto:function zoomInto(breadcrumbNode){var trail=this.getBreadcrumbNodes();trail=_(trail).filter(function(t){return t.active},[]);trail.push(breadcrumbNode);this.updateTrail(trail)},navigateTo:function navigateTo(id){var found=false,trail=this.getBreadcrumbNodes();this.updateTrail(_([].concat(trail)).map(function(t){t.active=!found;if(t.id===id){found=true}return t}))},cleanByName:function cleanByName(topics){var currentTopicNames=getSearchValues(this,[],"name");return _(topics).filter(function(t){return _.indexOf(currentTopicNames,t.label)===-1})},getSearchString:function getSearchString(){return _.map(getSearchValues(this,["topic"],"name"),function(t){return'"'+t+'"'}).join(" ")},getSearchCategoryAndTagIds:function getSearchCategoryAndTagIds(){return getSearchValues(this,["category","tag"],"id")},getSearchCategoryIds:function getSearchCategoryIds(){return getSearchValues(this,["category"],"id")},getSearchTagIds:function getSearchTagIds(){return getSearchValues(this,["tag"],"id")},updateTrail:function updateTrail(trail,suppressChange){this.set({breadcrumb:trail},{silent:true});if(!suppressChange){this.trigger("change")}},getBreadcrumbNodes:function getBreadcrumbNodes(){return this.get("breadcrumb")||[]}})});define("src/components/youtubeanalytics/models/YoutubeAnalyticsControls",["src/models/CombinedQueryControls"],function(CombinedQueryControls){"use strict";var YoutubeAnalyticsControls=CombinedQueryControls.extend({defaults:function defaults(){return Object.assign({},CombinedQueryControls.prototype.defaults.call(this),{dimension1:"days",dimension2:"queries",aggregate:"volume"})},getQueryData:function getQueryData(){var queryData=Object.assign({},CombinedQueryControls.prototype.getQueryData.call(this),{youtubeOnly:true});return queryData},getQueryDataForExport:function getQueryDataForExport(){var queryData=Object.assign({timezone:this.timezone},this.getQueryData());return queryData}});return YoutubeAnalyticsControls});define("src/components/mentions/views/MentionsTopicsView",["backbone","underscore","src/views/ComponentView","src/components/topics/models/Topics","src/components/topics/models/TopicsControls","src/components/topics/views/TopicsCloudView","src/components/topics/views/TopicsBreadcrumbView","src/components/topics/models/TopicsBreadcrumb","src/components/youtubeanalytics/models/YoutubeAnalyticsControls"],function(Backbone,_,ComponentView,Topics,TopicsControls,TopicsCloudView,TopicsBreadcrumbView,TopicsBreadcrumb,YoutubeAnalyticsControls){"use strict";var overwriteSettings={excludeTopics:false,excludeTags:true,excludeCategories:true,orderBy:"volume",orderDirection:"desc"};var MentionTopics=Topics.extend({initialize:function initialize(attrs,options){if(options.youtubeOnly){this.controlsModel=YoutubeAnalyticsControls}Topics.prototype.initialize.apply(this,arguments)},onSettingsChanged:function onSettingsChanged(){if(this.ignoreChanges){return}Topics.prototype.onSettingsChanged.apply(this,arguments)}});function makeTopicsSettings(mentionsSettings){var settings=_.extend(_.omit(mentionsSettings,"page","pageSize","orderBy","orderDirection"),overwriteSettings);if(settings.search){settings.term=settings.search;delete settings.search}return settings}return ComponentView.extend({initialize:function initialize(options){options=options||{};options.exportModel=options.exportModel||new Backbone.Model;this.mentionsSettings=options.settings;this.youtubeOnly=options.youtubeOnly||false;this.topicsModel=new MentionTopics({},{settings:makeTopicsSettings(this.mentionsSettings.toJSON()),youtubeOnly:this.youtubeOnly});options.settings=this.topicsModel.settings;ComponentView.prototype.initialize.call(this,options);this.breadcrumbModel=new TopicsBreadcrumb;this.breadcrumbView=new TopicsBreadcrumbView({model:this.breadcrumbModel});this.topicsModel.ignoreChanges=true;this.cloudView=new TopicsCloudView({model:this.topicsModel,settings:this.settings,breadcrumbModel:this.breadcrumbModel,showMentionInfo:_.bind(this.showMentionInfo,this),contextMenuEnabled:false});this.originalTerm=this.settings.get("term");this.originalCat=this.settings.get("category");this.$el.html(this.breadcrumbView.el);this.$el.append(this.cloudView.el);this.listenTo(this.settings,"change",this.topicsControlsChanged);this.listenTo(this.mentionsSettings,"change",this.mentionsControlsChanged);this.listenTo(this.breadcrumbModel,"change",this.breadcrumbUpdated);this.stopListeningForStatusMessages(this.collection);this.listenForStatusMessages(this.topicsModel);this.listenTo(this.topicsModel,"sync",this.render);this.fetchOnNextShown=true;this.isHidden=true},render:function render(){this.cloudView.render()},resize:function resize(){this.cloudView.reflow()},remove:function remove(){this.cloudView.remove();this.breadcrumbView.remove();ComponentView.prototype.remove.call(this)},fetchModel:function fetchModel(){this.topicsModel.fetch()},shown:function shown(){if(this.fetchOnNextShown){this.fetchModel()}this.topicsModel.ignoreChanges=false;this.fetchOnNextShown=false;this.isHidden=false},hidden:function hidden(){this.isHidden=true;this.topicsModel.ignoreChanges=true},breadcrumbUpdated:function breadcrumbUpdated(){var searchString=this.breadcrumbModel.getSearchString(),categoryIds=this.breadcrumbModel.getSearchCategoryAndTagIds()||[];this.settings.set({breadcrumbSearch:searchString,breadcrumbCategory:categoryIds})},topicsControlsChanged:function topicsControlsChanged(){if(this.isHidden){this.fetchOnNextShown=true}if(this.mentionsSettings._changing){return}var newSettings=this.settings.toJSON();delete newSettings.excludeTopics;delete newSettings.excludeTags;delete newSettings.excludeCategories;delete newSettings.sort;delete newSettings.orderBy;delete newSettings.direction;delete newSettings.orderDirection;if(newSettings.breadcrumbSearch){newSettings.search=TopicsControls.combineSearchString(newSettings,newSettings.breadcrumbSearch);delete newSettings.breadcrumbSearch}if(newSettings.breadcrumbCategory){newSettings.category=(newSettings.category||[]).concat(newSettings.breadcrumbCategory||[]);delete newSettings.breadcrumbCategory}this.mentionsSettings.set(newSettings)},mentionsControlsChanged:function mentionsControlsChanged(){if(!this.settings||this.settings._changing){return}var newSettings=makeTopicsSettings(this.mentionsSettings.changedAttributes());this.settings.set(_.extend({},newSettings,overwriteSettings))},showMultipleQueryMessage:function showMultipleQueryMessage(){this.$el.showMessage("Topics Cloud View does not support multiple Queries.")}})});define("mustache!src/components/mentions/_bulk/templates/bulkDialog",["lib/mustache"],function(mustache){var escapedTemplate='<h1 class="popuptitletext singlemargin-bottom draggable">{{title}}</h1>\n<div>\n<div class="js-bulk-container"></div>\n<p class="doublemargin-top">\n<button class="js-apply defaultbutton" disabled>{{buttonText}}</button>\n<button class="js-cancel button singlemargin-left">Cancel</button>\n</p>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/components/mentions/_bulk/views/BulkMentionView",["backbone","underscore","jquery","src/helpers/errorHelper","mustache!src/components/mentions/_bulk/templates/bulkDialog","src/packages/modalDialogs","src/packages/waitmask"],function(Backbone,_,$,errorHelper,template){"use strict";return Backbone.View.extend({className:"bulkActionsModal",events:function events(){return{"change input[type=radio]":"onChangeRadio","change input[type=checkbox]":"onChangeCheckbox","click .js-apply":"onApply","click .js-cancel, .close":"onClose"}},initialize:function initialize(options){if(!options||!options.mentions){throw new Error("options.mentions must be defined!")}if(!options.selectedMentions||!options.selectedMentions.length){throw new Error("options.selectedMentions must be defined and not empty!")}if(!options.popupTitle){throw new Error("options.popupTitle must be defined")}this.mentions=options.mentions;this.selectedMentions=options.selectedMentions;this.popupTitle=options.popupTitle;this.mode=options.mode;this.buttonText=options.buttonText;this.titlePrefix=this.mode&&(this.mode==="remove"?"Remove":"Add")||""},remove:function remove(){this.$el.removeModal();Backbone.View.prototype.remove.call(this)},getButtonText:function getButtonText(){var prefix=this.mode==="remove"?"Remove from":"Add to";if(this.buttonText){return this.buttonText}if(this.selectedMentions.length===1){return prefix+" 1 Mention"}else if(this.selectedMentions==="all"){return prefix+" all "+this.mentions.resultsTotal+" Mentions"}return prefix+" "+this.selectedMentions.length+" Mentions"},getSuccessTitle:function getSuccessTitle(){if(this.selectedMentions==="all"){return"Updating Mentions in Progress"}return"Action complete"},getSuccessText:function getSuccessText(){if(this.selectedMentions.length===1){return"1 Mention has been updated"}else if(this.selectedMentions==="all"){return"Your Mentions are being updated. This may take some time, you will be notified when complete."}return this.selectedMentions.length+" Mentions have been updated"},showSuccessMessage:function showSuccessMessage(){this.error=false;this.success=true;this.$el.children(":not(h1)").remove();this.$el.append('<div class="successMessage">'+"<h2>"+this.getSuccessTitle()+"</h2>"+'<p class="singlemargin">'+this.getSuccessText()+"</p>"+"</div>"+'<p class="doublemargin-top"><button class="close button">Close</button></p>');this.$el.centreModal()},showErrorMessage:function showErrorMessage(message){this.error=true;this.success=false;this.$el.children(":not(h1)").remove();this.$el.append('<div class="errorMessage">'+"<h2>An error has occurred</h2>"+'<p class="singlemargin">'+message+"</p>"+"</div>"+'<p class="doublemargin-top"><button class="close button">Close</button></p>');this.$el.centreModal()},onChangeRadio:function onChangeRadio(e){var $input=$(e.target),$label=$input.next("label"),$li=$input.closest("li"),label=this.mode==="remove"?"(removing this)":"(adding this)",isEmptyInput=$input.attr("value")==="";this.$(".js-apply").prop("disabled",isEmptyInput);$li.siblings().each(function(){$(this).removeClass("selected");$("label",this).text($(this).data("originalLabel")||$("label",this).text())});if(!isEmptyInput){$li.data("originalLabel",$label.text()).addClass("selected");$label.html("<strong>"+$label.text()+"</strong>"+" "+label)}},onChangeCheckbox:function onChangeCheckbox(e){var $input=$(e.target),$label=$input.next("label"),$li=$input.closest("li"),label=this.mode==="remove"?"(removing this)":"(adding this)";this.$(".js-apply").prop("disabled",$input.val()==="");if($input.is(":checked")){$label.html("<strong>"+$li.data("name")+"</strong>"+" "+label);$li.addClass("selected")}else{$label.html($li.data("name")+" (no change)");$li.removeClass("selected")}this.$(".js-apply").prop("disabled",!this.$("input:checked").length)},onApply:function onApply(){var self=this,$el=this.$el,$input=this.$("li input:checked"),val=_($input).map(function(el){return parseInt($(el).val(),10)||$(el).val()}),selectedMentionIds=this.selectedMentions,saveAttrs=this.getSaveAttrs(val),options={success:function success(){$el.hideWaitmask();self.showSuccessMessage()},error:function error(response){var message=errorHelper.getErrorMessage(response);$el.hideWaitmask();self.showErrorMessage(message)}};$el.showWaitmask("Updating Mentions...");this.apply(selectedMentionIds,saveAttrs,options)},render:function render(){var view=this;this.$el.html(template({title:"".concat(this.titlePrefix," ").concat(this.popupTitle).trim(),buttonText:this.getButtonText()}));var oldRemove=view.remove;this.$el.showModal({draggable:"div > h1",className:"popup smallpopup",onClose:function onClose(){oldRemove.call(view)}})},apply:function apply(selectedMentionIds,saveAttrs,options){if(selectedMentionIds==="all"){return this.mentions.submitBulkJob(saveAttrs,options)}this.mentions.save(selectedMentionIds,saveAttrs,options)},onClose:function onClose(e){e.preventDefault();this.remove()}})});define("src/components/mentions/_bulk/views/BulkEmotionView",["src/controls/lib/paramAssert","src/components/mentions/_bulk/views/BulkMentionView","src/views/ChooseEmotionView"],function(paramAssert,BulkMentionView,ChooseEmotionView){"use strict";var VIEW_SELECTORS={APPLY:".js-apply"};var BulkEmotionView=BulkMentionView.extend({render:function render(){var _this=this;BulkMentionView.prototype.render.call(this);if(this.view){this.view.remove();this.view.off("selected");this.view=null}this.view=new ChooseEmotionView({mode:this.mode});this.view.render();this.view.on("selected",function(changes){return _this.onSelect(changes)});this.$(".js-bulk-container").html(this.view.el)},onSelect:function onSelect(changes){this.changes=changes;var hasChangedInput=changes.removeClassifications||changes.addClassifications;this.$(VIEW_SELECTORS.APPLY).prop("disabled",!hasChangedInput)},getSaveAttrs:function getSaveAttrs(){return this.changes||{}},remove:function remove(){BulkMentionView.prototype.remove.call(this);if(this.view){this.view.remove();this.view.off("selected");this.view=null}}},{show:function show(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};paramAssert.isNotDefined(options.mentions,"options.mentions must be defined!");paramAssert.isNotDefined(options.selectedMentions,"options.selectedMentions must be defined!");var view=new BulkEmotionView({popupTitle:"Emotions",mentions:options.mentions,selectedMentions:options.selectedMentions,mode:options.mode});view.render();return view}});return BulkEmotionView});define("mustache!src/components/mentions/_bulk/templates/bulkSentimentView",["lib/mustache"],function(mustache){var escapedTemplate='<fieldset>\n<ul class="bulklist">\n<li class="nochange"><input id="{{id}}-nochange" type="radio" name="sentiment" value="" checked /> <label for="{{id}}-nochange">No change</label></li>\n<li class="positive"><input id="{{id}}-positive" type="radio" name="sentiment" value="positive" /> <label for="{{id}}-positive">Positive</label></li>\n<li class="neutral"><input id="{{id}}-neutral" type="radio" name="sentiment" value="neutral" /> <label for="{{id}}-neutral">Neutral</label></li>\n<li class="negative"><input id="{{id}}-negative" type="radio" name="sentiment" value="negative" /> <label for="{{id}}-negative">Negative</label></li>\n</ul>\n</fieldset>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/components/mentions/_bulk/views/BulkSentimentView",["underscore","src/components/mentions/_bulk/views/BulkMentionView","mustache!src/components/mentions/_bulk/templates/bulkSentimentView"],function(_,BulkMentionView,bulkSentimentView){"use strict";var BulkSentimentView;return BulkSentimentView=BulkMentionView.extend({render:function render(){BulkMentionView.prototype.render.call(this);this.$(".js-bulk-container").html(bulkSentimentView({id:_.uniqueId("bulkSentimentView-")}))},getButtonText:function getButtonText(){var prefix="Change for";if(this.selectedMentions.length===1){return prefix+" 1 Mention"}else if(this.selectedMentions==="all"){return prefix+" all "+this.mentions.resultsTotal+" Mentions"}return prefix+" "+this.selectedMentions.length+" Mentions"},getSaveAttrs:function getSaveAttrs(value){return{sentiment:value[0]}}},{show:function show(options){if(!options){throw new Error("options must be defined!")}var view=new BulkSentimentView({popupTitle:"Change Sentiment",mentions:options.mentions,selectedMentions:options.selectedMentions});view.render();return view}})});define("mustache!src/components/mentions/_bulk/templates/bulkAddTagView",["lib/mustache"],function(mustache){var escapedTemplate='<div class="tags">\n<ul class="tagsList"></ul>\n<input class="field" type="text" placeholder="Enter tags" autofocus />\n</div>\n<p class="singlemargin-top">To add multiple Tags, press enter</p>\n\n{{#canRandomlyTag}}\n<p class="singlemargin-top">\n<input type="checkbox" name="randomlyTag" id="{{id}}-randomlyTag" />\n<label for="{{id}}-randomlyTag">Tag random sample</label> <a class="help icon-bwhelp" data-key="mentions:mentions-tags-random-tagging"></a>\n</p>\n<div class="randomTagOptions hidden">\n<p class="singlemargin-top">\n<label for="{{id}}-randomTagAmount">Tag</label>\n<input type="number" min="1" name="amount" class="field" id="{{id}}-randomTagAmount" value="25" />\n<select name="unit" id="{{id}}-randomTagUnit" class="selectfield">\n<option value="percent">%</option>\n<option value="mentions">mentions</option>\n</select>\n<label for="{{id}}-randomTagUnit"> of the <span class="total">{{total}} selected</span> mentions</label>\n</p>\n<p class="calculatedMentions singlemargin-top">\n<span class="selected"></span> mentions\n</p>\n</div>\n{{/canRandomlyTag}}\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/components/mentions/_bulk/views/BulkAddTagView",["async","underscore","jquery","src/helpers/validationTooltipHelper","src/components/mentions/_bulk/views/BulkMentionView","src/components/mentions/views/TagsInputView","mustache!src/components/mentions/_bulk/templates/bulkAddTagView","src/packages/modalDialogs"],function(async,_,$,validationTooltipHelper,BulkMentionView,TagsInputView,bulkAddTagView){"use strict";var BulkAddTagView=BulkMentionView.extend({className:"bulkActionsModal bulkTag",events:function events(){return _.extend({"change input[name=randomlyTag]":"onToggleRandomTagging","keyup input[name=amount]":"onChangeAmount","input input[name=amount]":"onChangeAmount","change select[name=unit]":"onChangeUnit"},BulkMentionView.prototype.events.call(this))},constructor:function BulkAddTagView(options){BulkMentionView.apply(this,arguments);if(!options||!options.tagCollection){throw new TypeError("BulkAddTagView must be instantiated with a tagCollection option")}this.tagCollection=options.tagCollection;if(options.mode==="remove"){throw new Error("This view does not support removing tags")}this.singleQuerySelected=options.singleQuerySelected},remove:function remove(){if(this.tagsInput){this.tagsInput.off("inputUpdate",this.updateApplyButton,this);this.tagsInput.remove()}BulkMentionView.prototype.remove.call(this)},render:function render(){BulkMentionView.prototype.render.call(this);var self=this,$el=this.$el,tags=this.tags=this.tags||[],canRandomlyTag=this.selectedMentions==="all"&&this.singleQuerySelected;this.$(".js-bulk-container").html(bulkAddTagView({id:_.uniqueId("bulkTag-"),canRandomlyTag:canRandomlyTag,total:this.mentions.resultsTotal}));if(canRandomlyTag){this.updateMentionCalculations()}this.applyButton=$el.find(".js-apply");this.tagsInput=new TagsInputView({tagCollection:self.tagCollection,placeholder:"Enter tags",onAdd:function onAdd(tag,done){tags.push(tag.toLowerCase());self.updateApplyButton();done()},onRemove:function onRemove(tag,done){tags.splice(tags.indexOf(tag),1);if(!tags.length){self.updateApplyButton()}done()}});this.tagsInput.render();$el.find("div.tags").html(this.tagsInput.el),this.tagsInput.on("inputUpdate",this.updateApplyButton,this)},updateApplyButton:function updateApplyButton(){if(!this.applyButton){return}var isRandomTaggingChecked=this.$("input[name=randomlyTag]").is(":checked");var isInValidRandomInput=this.$("input[name=amount]").hasClass("invalid");var hasRandomSampleAndIsInvalid=isRandomTaggingChecked&&isInValidRandomInput;var enable=(this.tagsInput.$("input").val()||this.tags.length)&&!hasRandomSampleAndIsInvalid;this.applyButton.prop("disabled",!enable)},getSaveAttrs:function getSaveAttrs(){var tags;this.tagsInput.addCurrentValue();tags=this.tagsInput.getTags();return{addTag:tags}},apply:function apply(selectedMentionIds,saveAttrs,options){var self=this,$amount=this.$("input[name=amount]"),randomlyTag=this.$("input[name=randomlyTag]").is(":checked"),unit=this.$("select[name=unit]").val(),amount=parseInt($amount.val(),10),size=this.mentions.resultsTotal,sampleSize;function ensureTagsExist(callback){async.forEachLimit(saveAttrs.addTag,5,function(tag,callback){self.tagCollection.ensureTagExists(tag,{success:function success(){callback()},error:function error(){callback()}})},callback)}if(randomlyTag){sampleSize=unit==="mentions"?amount:Math.round(size*(amount/100));ensureTagsExist(function(){self.mentions.submitBulkJob(saveAttrs,_.extend({sampleAmount:sampleSize},options))});return}ensureTagsExist(function(){BulkMentionView.prototype.apply.call(self,selectedMentionIds,saveAttrs,options)})},updateMentionCalculations:function updateMentionCalculations(){var total=this.mentions.resultsTotal;var $amount=this.$("input[name=amount]");var unit=this.$("select[name=unit]").val();var amount=parseInt($amount.val(),10);var applyBtnMentionText;var error=this.randomSampleInputValidation(amount,total);if(error){return}if(unit!=="percent"){this.$("p.calculatedMentions").addClass("hidden");applyBtnMentionText=amount===1?" Mention":" Mentions";this.$(".js-apply").text("Add to "+amount+applyBtnMentionText)}else{this.$("p.calculatedMentions").removeClass("hidden");this.$("span.selected").text("= "+Math.round(total*(amount/100)));this.updateButtonText()}},randomSampleInputValidation:function randomSampleInputValidation(amount,total){var error="";var $amount=this.$("input[name=amount]");var type=this.$("select[name=unit]").val();if(type==="percent"&&(!amount||amount>100)){error="Please enter a percentage value between 1 and 100"}else if(type==="mentions"&&(!amount||amount>total)){error="Please enter an amount of mentions between 1 and "+total+" (available mentions)"}if(error&&!$amount.hasClass("invalid")){$amount.addClass("invalid");validationTooltipHelper.showError(error,$amount);this.$("p.calculatedMentions").addClass("hidden");this.$(".js-apply").text("Add to all Mentions");this.updateApplyButton()}else if(!error&&$amount.hasClass("invalid")){$amount.removeClass("invalid");validationTooltipHelper.hideError($amount);this.updateApplyButton()}return!!error},updateButtonText:function updateButtonText(){var isRandomTaggingChecked=this.$("input[name=randomlyTag]").is(":checked");var total=this.mentions.resultsTotal;var addBtnAmountToDisplay;var unit=this.$("select[name=unit]").val();var $amount=this.$("input[name=amount]");var amount;var mentionsText=" Mentions";if(isRandomTaggingChecked&&!$amount.hasClass("invalid")){amount=parseInt($amount.val(),10);addBtnAmountToDisplay=unit!=="percent"?amount:Math.round(total*(amount/100));if(addBtnAmountToDisplay===1){mentionsText=" Mention"}}else if(!isRandomTaggingChecked){addBtnAmountToDisplay="all "+total}else{addBtnAmountToDisplay="all"}this.$(".js-apply").text("Add to "+addBtnAmountToDisplay+mentionsText)},onChangeAmount:function onChangeAmount(){this.updateMentionCalculations()},onChangeUnit:function onChangeUnit(e){var newUnit=$(e.target).val(),$amount=this.$("input[name=amount]"),total=this.mentions.resultsTotal,amount=$amount.val();if(newUnit==="mentions"){amount=amount?Math.min(total,Math.round(total*(amount/100))):"";this.$("p.calculatedMentions").addClass("hidden")}else{amount=amount?Math.min(100,Math.round(amount/total*100)):"";this.$("p.calculatedMentions").removeClass("hidden")}$amount.val(amount);$amount.removeClass("invalid");validationTooltipHelper.hideError($amount);this.updateApplyButton();this.updateMentionCalculations()},onToggleRandomTagging:function onToggleRandomTagging(e){var $input=$(e.target);this.$("div.randomTagOptions").toggleClass("hidden",!$input.is(":checked"));this.updateButtonText();$(this.el).centreModal()},onChangeRadio:function onChangeRadio(){},onChangeCheckbox:function onChangeCheckbox(){},showSuccessMessage:function showSuccessMessage(){var randomlyTag=this.$("input[name=randomlyTag]").is(":checked");BulkMentionView.prototype.showSuccessMessage.call(this);if(randomlyTag){this.$(".successMessage h2").text("To work with this sample of mentions...");this.$(".successMessage p").replaceWith("<p>...simply use the <strong>Tag Filter</strong> "+'in the "Controls" of any component or dashboard</p>'+'<p><img src="/img/tag_filter.jpg" alt="Using the tag filter" /></p>'+"<p>We'll email you when tagging is complete</p>")}}},{show:function show(options){if(!options){throw new Error("options must be defined!")}if(!options.tagCollection){throw new TypeError("BulkAddTagView.show must be passed a tagCollection option")}var view=new BulkAddTagView({popupTitle:"Tag",tagCollection:options.tagCollection,mentions:options.mentions,selectedMentions:options.selectedMentions,singleQuerySelected:options.singleQuerySelected,mode:options.mode,buttonText:options.buttonText});view.render();return view}});return BulkAddTagView});define("mustache!src/components/mentions/_bulk/templates/bulkRemoveTagView",["lib/mustache"],function(mustache){var escapedTemplate='<fieldset>\n<ul class="bulklist">\n{{#tags}}\n<li data-name="{{name}}"><input id="ss-{{formid}}-{{id}}" type="checkbox" value="{{id}}" name="tag" /><label for="ss-{{formid}}-{{id}}">{{name}} (no change)</label></li>\n{{/tags}}\n{{^tags}}\n<li>No Tags are available</li>\n{{/tags}}\n</ul>\n</fieldset>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/components/mentions/_bulk/views/BulkRemoveTagView",["underscore","src/components/mentions/_bulk/views/BulkMentionView","mustache!src/components/mentions/_bulk/templates/bulkRemoveTagView"],function(_,BulkMentionView,bulkRemoveTagView){"use strict";var BulkRemoveTagView=BulkMentionView.extend({constructor:function BulkRemoveTagView(options){BulkMentionView.apply(this,arguments);if(!options.tagCollection){throw new TypeError("BulkRemoveTagView must be instantiated with a tagCollection option")}this.tagCollection=options.tagCollection;if(options.mode&&options.mode!=="remove"){throw new Error("This view does not support anything but remove")}this.mode="remove"},render:function render(){BulkMentionView.prototype.render.call(this);var view=this;this.$(".js-bulk-container").html(bulkRemoveTagView({formid:_.uniqueId("bulkRemoveTagView-"),buttonText:this.getButtonText(),tags:view.tagCollection.chain().map(function(tag){return{id:tag.id,name:tag.get("name")}}).sortBy(function(tag){return tag.name.toLowerCase()}).value()}))},getSaveAttrs:function getSaveAttrs(tagIds){var view=this;return{removeTag:view.tagCollection.chain().filter(function(tag){return tagIds.indexOf(tag.id)>-1}).map(function(tag){return tag.get("name")}).value()}}},{show:function show(options){if(!options){throw new Error("options must be defined!")}if(!options.tagCollection){throw new TypeError("BulkRemoveTagView.show must be called with a tagCollection option")}var view=new BulkRemoveTagView({popupTitle:"Tag",tagCollection:options.tagCollection,mentions:options.mentions,selectedMentions:options.selectedMentions,buttonText:options.buttonText});view.render();return view}});return BulkRemoveTagView});define("mustache!src/components/mentions/_bulk/templates/bulkLocationView",["lib/mustache"],function(mustache){var escapedTemplate='<p>\n<input name="location" class="field fivecol" type="text" autocomplete="off" placeholder="Type to select new Location"></input>\n<input name="locationId" type="hidden"></input>\n</p>\n<p class="doublemargin-top mediumtext">\nNote: This will only affect the selected mentions and not the Location of historic or future mentions from the same author or website.\n</p>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/components/mentions/_bulk/views/BulkLocationView",["jquery","src/Workbench","src/components/mentions/_bulk/views/BulkMentionView","mustache!src/components/mentions/_bulk/templates/bulkLocationView","src/packages/modalDialogs","jquery.autocomplete/jquery.autocomplete","jquery.autocomplete/jquery.autocomplete.ajax"],function($,Workbench,BulkMentionView,template){"use strict";var BulkLocationView;return BulkLocationView=BulkMentionView.extend({className:"bulkActionsModal bulkLocation",remove:function remove(){if(this.autocomplete){this.autocomplete.remove()}BulkMentionView.prototype.remove.call(this)},render:function render(){BulkMentionView.prototype.render.call(this);var self=this,$el=this.$el,$input,$locationIdInput;this.$(".js-bulk-container").html(template());$input=$el.find("input[name=location]");$locationIdInput=$el.find("input[name=locationId]");$input.autocomplete({css:{width:450},clearAfterSelect:false,renderResult:function renderResult(result){var name=result.fullName,commaIdx=name.indexOf(",");name="<em>"+name.substring(0,commaIdx>-1?commaIdx:name.length)+"</em>"+(commaIdx>-1?name.substring(commaIdx,name.length):"");return name.length>83?name.substring(0,80)+"...":name},parseData:function parseData(data){return data.results},selected:function selected(result){$input.val(result.fullName);$locationIdInput.val(result.id);self.$(".js-apply").prop("disabled",false)},plugins:[{plugin:$.fn.autocomplete.ajax,options:{url:Workbench.buildApiUrl("/locations"),params:{pageSize:20,page:0}}}]})},getButtonText:function getButtonText(){var prefix="Change for";if(this.selectedMentions.length===1){return prefix+" 1 Mention"}else if(this.selectedMentions==="all"){return prefix+" all "+this.mentions.resultsTotal+" Mentions"}return prefix+" "+this.selectedMentions.length+" Mentions"},getSaveAttrs:function getSaveAttrs(){return{location:this.$("input[name=locationId]").val()}}},{show:function show(options){if(!options){throw new Error("options must be defined!")}var view=new BulkLocationView({popupTitle:"Change Location",mentions:options.mentions,selectedMentions:options.selectedMentions});view.render();view.$el.find("input:first").focus();return view}})});define("mustache!src/components/mentions/_bulk/templates/bulkCategoryView",["lib/mustache"],function(mustache){var escapedTemplate='<div class="errorPane notification-error rounded smallpadding-vertical singlepadding-horizontal hidden"></div>\n<p>\n<label for="maincat-{{formid}}" class="smallpadding-right">Main Category</label>\n<select id="maincat-{{formid}}" class="selectfield fourcol">\n<option value>-- Choose a Category --</option>\n{{#categories}}\n<option value="{{id}}"{{selected}}>{{name}}</option>\n{{/categories}}\n</select>\n{{#canEditCategories}}\n{{#addAction}}\n{{^emptyForm}}\n<a class="icon-pencil lightgrey smallpadding-left js-edit-category customtip" title="Edit this Category"></a>\n{{/emptyForm}}\n<a class="icon-plus lightgrey smallpadding-left js-add-category customtip" title="Create a new main Category"></a>\n{{/addAction}}\n{{/canEditCategories}}\n</p>\n{{#singleCategoryForm}}\n<p class="desc">This Subcategory will be {{descriptionText}} selected Mentions</p>\n<fieldset>\n<ul class="bulklist">\n{{#subCategories}}\n<li><input id="ss-{{formid}}" type="checkbox" value="{{id}}" name="category" checked disabled /><label for="ss-{{formid}}">{{name}}</label></li>\n{{/subCategories}}\n{{#addAction}}\n<li><a class="js-add-subcategory"><span class="icon-plus iconsmall smallpadding-right"></span>New Subcategory</a></li>\n{{/addAction}}\n</ul>\n</fieldset>\n{{/singleCategoryForm}}\n{{#singleSelectForm}}\n<p class="desc">Select which Subcategory should be {{verb}}</p>\n<fieldset>\n<ul class="bulklist">\n<li class="nochange"><input id="ss-{{formid}}" type="radio" value="" name="category" checked class="nochange" /><label for="ss-{{formid}}">No change</label></li>\n{{#subCategories}}\n<li><input id="ss-{{formid}}-{{id}}" type="radio" value="{{id}}" name="category" /><label for="ss-{{formid}}-{{id}}">{{name}}</label></li>\n{{/subCategories}}\n{{#addAction}}\n<li><a class="js-add-subcategory"><span class="icon-plus iconsmall smallpadding-right"></span>New Subcategory</a></li>\n{{/addAction}}\n</ul>\n</fieldset>\n{{/singleSelectForm}}\n{{#multipleSelectForm}}\n<p class="desc">Select which Subcategories should be {{verb}}</p>\n<fieldset>\n<ul class="bulklist">\n{{#subCategories}}\n<li data-name="{{name}}"><input id="ss-{{formid}}-{{id}}" type="checkbox" value="{{id}}" name="category" /><label for="ss-{{formid}}-{{id}}">{{name}} (no change)</label></li>\n{{/subCategories}}\n{{#addAction}}\n<li><a class="js-add-subcategory"><span class="icon-plus iconsmall smallpadding-right"></span>New Subcategory</a></li>\n{{/addAction}}\n</ul>\n</fieldset>\n{{/multipleSelectForm}}\n{{#emptyForm}}\n<fieldset class="empty"></fieldset>\n{{/emptyForm}}\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/components/mentions/_bulk/views/BulkCategoryView",["underscore","jquery","src/permissions","src/globals/categories","src/views/CategoriesFormView","src/components/mentions/_bulk/views/BulkMentionView","mustache!src/components/mentions/_bulk/templates/bulkCategoryView","lib/jquery.prompt","src/packages/customtip","src/packages/waitmask"],function(_,$,permissions,categories,CategoriesFormView,BulkMentionView,bulkCategoryView){"use strict";var BulkCategoryView;return BulkCategoryView=BulkMentionView.extend({className:"bulkCategory bulkActionsModal",events:function events(){return _.extend({"change select":"onChangeCategory","click .js-edit-category":"onEditCategory","click .js-add-category":"onAddCategory","click .js-add-subcategory":"onAddSubcategory"},BulkMentionView.prototype.events.call(this))},initialize:function initialize(options){this.listenTo(categories,"change",this.updateCategory);BulkMentionView.prototype.initialize.call(this,options)},render:function render(){BulkMentionView.prototype.render.call(this);var $el=this.$el,selectedCategoryId=this.selectedCategory,selectedCategory=categories.get(selectedCategoryId),getCategories=function getCategories(){return _.sortBy(categories.map(function(cat){return{id:cat.id,name:cat.get("name"),selected:selectedCategoryId===cat.id?" selected":""}}),function(category){return category.name.toLowerCase()})},getSubcategories=function getSubcategories(selectedCategory){var subcategories=[];if(selectedCategory){subcategories=_(selectedCategory.get("children")).chain().sortBy("order").map(function(cat){return{id:cat.id,name:cat.name}}).value()}return subcategories};this.$(".js-bulk-container").html(bulkCategoryView({formid:_.uniqueId("bulkCategory"),modeName:this.mode==="remove"?"Remove":"Add",canEditCategories:permissions.check("edit.categories"),addAction:this.mode==="remove"?false:true,showForm:true,singleCategoryForm:this.categoryType==="singleCategory",singleSelectForm:this.categoryType==="singleSelect",multipleSelectForm:this.categoryType==="multipleSelect",emptyForm:!this.categoryType,categories:getCategories(),subCategories:getSubcategories(selectedCategory),verb:this.mode==="remove"?"removed":"added",descriptionText:this.mode==="remove"?"removed from":"added to",successText:this.getSuccessText()}));this.$(".js-apply").prop("disabled",!(selectedCategory&&this.categoryType==="singleCategory"));$el.customtip()},getSaveAttrs:function getSaveAttrs(selectedSubcategoryIds){var method=this.mode==="remove"?"removeCategories":"addCategories",attrs={};attrs[method]=selectedSubcategoryIds;return attrs},onChangeCategory:function onChangeCategory(e){var val=parseInt($(e.target).val(),10);this.setCategory(val)},setCategory:function setCategory(val){this.selectedCategory=val;this.updateCategory()},updateCategory:function updateCategory(){var cat=categories.get(this.selectedCategory);if(!cat){this.categoryType=""}else if(cat.get("children").length===1){this.categoryType="singleCategory"}else if(cat.get("multiple")){this.categoryType="multipleSelect"}else{this.categoryType="singleSelect"}this.render()},onEditCategory:function onEditCategory(){var category=categories.get(this.selectedCategory);if(!category){return}CategoriesFormView.show({model:category,collection:categories})},onAddCategory:function onAddCategory(){categories.off("add",this.onCategoryAdded,this);categories.once("add",this.onCategoryAdded,this);CategoriesFormView.show({collection:categories})},onCategoryAdded:function onCategoryAdded(model){var id=model.id;this.setCategory(id)},onAddSubcategory:function onAddSubcategory(){var self=this,categoryModel=categories.get(this.selectedCategory),$container=this.$("div:first");$.prompt({text:"New Subcategory",intro:'Enter new Subcategory name for the Category "'+categoryModel.escape("name")+'"'},function(err,name){if(err){return}self.hideError();$container.showWaitmask("Saving new Subcategory...");categoryModel.save({children:_(categoryModel.get("children")).sortBy("ordering").concat({name:name})},{success:function success(model){$container.hideWaitmask();self.onSubcategoryAdded(model)},error:function error(){$container.hideWaitmask();self.showError("Couldn't save new Subcategory. Please try again.")}})})},onSubcategoryAdded:function onSubcategoryAdded(model){var newSubcategoryId=_(model.get("children")).max(function(c){return c.ordering}).id,$list;this.setCategory(model.id);$list=this.$("fieldset ul");$list.find('input[value="'+newSubcategoryId+'"]').prop("checked",true).trigger("change");$list.scrollTop($list[0].scrollHeight)},showError:function showError(message){this.$(".errorPane").text(message).removeClass("hidden")},hideError:function hideError(){this.$(".errorPane").text("").addClass("hidden")},remove:function remove(){categories.off("add",this.onCategoryAdded,this);BulkMentionView.prototype.remove.call(this)}},{show:function show(options){if(!options){throw new Error("options must be defined!")}var view=new BulkCategoryView({popupTitle:"Category",mentions:options.mentions,selectedMentions:options.selectedMentions,mode:options.mode,buttonText:options.buttonText});view.render();return view}})});define("src/components/mentions/_bulk/views/BulkStarView",["src/components/mentions/_bulk/views/BulkMentionView"],function(BulkMentionView){"use strict";var BulkStarView;return BulkStarView=BulkMentionView.extend({render:function render(){BulkMentionView.prototype.render.call(this);this.$(".js-apply").prop("disabled",false)},getSaveAttrs:function getSaveAttrs(){return{starred:this.mode!=="remove"}}},{show:function show(options){if(!options){throw new Error("options must be defined!")}var view=new BulkStarView({popupTitle:"Star",mentions:options.mentions,selectedMentions:options.selectedMentions,mode:options.mode});view.render();return view}})});define("mustache!src/components/mentions/_bulk/templates/bulkAssignmentView",["lib/mustache"],function(mustache){var escapedTemplate='<fieldset>\n<ul class="bulklist">\n<li class="nochange"><input id="{{id}}-nochange" type="radio" name="assignment" value="" checked /> <label for="{{id}}-nochange">No change</label></li>\n{{#assignments}}\n<li><input id="{{formid}}-{{id}}" type="radio" name="assignment" value="{{name}}" /> <label for="{{formid}}-{{id}}">{{name}}</label></li>\n{{/assignments}}\n</ul>\n</fieldset>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/components/mentions/_bulk/views/BulkAssignmentView",["underscore","src/globals/workflow","src/components/mentions/_bulk/views/BulkMentionView","mustache!src/components/mentions/_bulk/templates/bulkAssignmentView"],function(_,workflow,BulkMentionView,bulkAssignmentView){"use strict";var BulkAssignmentView;return BulkAssignmentView=BulkMentionView.extend({render:function render(){BulkMentionView.prototype.render.call(this);this.$(".js-bulk-container").html(bulkAssignmentView({formid:_.uniqueId("bulkAssignmentView-"),buttonText:this.getButtonText(),assignments:_(workflow.get("assignment").children).map(function(cat){return{id:cat.id,name:cat.name}})}))},getSaveAttrs:function getSaveAttrs(value){var method=this.mode==="remove"?"removeAssignment":"assignment",attrs={};attrs[method]=value[0];return attrs}},{show:function show(options){if(!options){throw new Error("options must be defined!")}var view=new BulkAssignmentView({popupTitle:"assignment",mentions:options.mentions,selectedMentions:options.selectedMentions,mode:options.mode,buttonText:options.buttonText});view.render();return view}})});define("mustache!src/components/mentions/_bulk/templates/bulkPriorityView",["lib/mustache"],function(mustache){var escapedTemplate='<fieldset>\n<ul class="bulklist">\n<li class="nochange"><input id="{{id}}-nochange" type="radio" name="priority" value="" checked /> <label for="{{id}}-nochange">No change</label></li>\n{{#priorities}}\n<li><input id="{{formid}}-{{id}}" type="radio" name="priority" value="{{name}}" /> <label for="{{formid}}-{{id}}">{{name}}</label></li>\n{{/priorities}}\n</ul>\n</fieldset>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/components/mentions/_bulk/views/BulkPriorityView",["underscore","src/globals/workflow","src/components/mentions/_bulk/views/BulkMentionView","mustache!src/components/mentions/_bulk/templates/bulkPriorityView"],function(_,workflow,BulkMentionView,bulkPriorityView){"use strict";var BulkPriorityView;return BulkPriorityView=BulkMentionView.extend({render:function render(){BulkMentionView.prototype.render.call(this);this.$(".js-bulk-container").html(bulkPriorityView({formid:_.uniqueId("bulkPriorityView-"),buttonText:this.getButtonText(),modeName:this.mode==="remove"?"Remove":"Add",priorities:_(workflow.get("priority").children).chain().map(function(cat){return{id:cat.id,name:cat.name,order:cat.order}}).sortBy(function(cat){return cat.order}).value()}))},getSaveAttrs:function getSaveAttrs(value){var method=this.mode==="remove"?"removePriority":"priority",attrs={};attrs[method]=value[0];return attrs}},{show:function show(options){if(!options){throw new Error("options must be defined!")}var view=new BulkPriorityView({popupTitle:"priority",mentions:options.mentions,selectedMentions:options.selectedMentions,mode:options.mode});view.render();return view}})});define("mustache!src/components/mentions/_bulk/templates/bulkStatusView",["lib/mustache"],function(mustache){var escapedTemplate='<fieldset>\n<ul class="bulklist">\n<li class="nochange"><input id="{{id}}-nochange" type="radio" name="status" value="" checked /> <label for="{{id}}-nochange">No change</label></li>\n{{#statuses}}\n<li><input id="{{formid}}-{{id}}" type="radio" name="status" value="{{name}}" /> <label for="{{formid}}-{{id}}">{{name}}</label></li>\n{{/statuses}}\n</ul>\n</fieldset>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/components/mentions/_bulk/views/BulkStatusView",["underscore","src/globals/workflow","src/components/mentions/_bulk/views/BulkMentionView","mustache!src/components/mentions/_bulk/templates/bulkStatusView"],function(_,workflow,BulkMentionView,bulkStatusView){"use strict";var BulkStatusView;return BulkStatusView=BulkMentionView.extend({render:function render(){BulkMentionView.prototype.render.call(this);this.$(".js-bulk-container").html(bulkStatusView({formid:_.uniqueId("bulkStatusView-"),buttonText:this.getButtonText(),modeName:this.mode==="remove"?"Remove":"Add",statuses:_(workflow.get("status").children).map(function(cat){return{id:cat.id,name:cat.name}})}))},getSaveAttrs:function getSaveAttrs(value){var method=this.mode==="remove"?"removeStatus":"status",attrs={};attrs[method]=value[0];return attrs}},{show:function show(options){if(!options){throw new Error("options must be defined!")}var view=new BulkStatusView({popupTitle:"Status",mentions:options.mentions,selectedMentions:options.selectedMentions,mode:options.mode});view.render();return view}})});define("src/components/mentions/_bulk/views/BulkCheckedView",["src/components/mentions/_bulk/views/BulkMentionView"],function(BulkMentionView){"use strict";var BulkCheckedView;return BulkCheckedView=BulkMentionView.extend({render:function render(){BulkMentionView.prototype.render.call(this);this.$(".js-apply").prop("disabled",false)},getSaveAttrs:function getSaveAttrs(){return{checked:this.mode!=="remove"}}},{show:function show(options){if(!options){throw new Error("options must be defined!")}var view=new BulkCheckedView({popupTitle:"Checked",mentions:options.mentions,selectedMentions:options.selectedMentions,mode:options.mode});view.render();return view}})});define("mustache!src/components/mentions/_bulk/templates/deleteAllMentions",["lib/mustache"],function(mustache){var escapedTemplate="You are about to delete {{amount}}. This action will remove these mentions from the query and affect all shared users of this project. Please confirm you would still like to proceed.\n";return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/components/mentions/_bulk/templates/markAsSpam",["lib/mustache"],function(mustache){var escapedTemplate="You are about to report {{amount}} as spam. This action will remove these mentions from the query and affect all shared users of this project. Please confirm you would still like to proceed.\n";return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/components/mentions/_bulk/css/bulkActionModal.css",["css!src/components/mentions/_bulk/css/compiled.css"],function(){});define("src/components/mentions/_table/MentionsTableBulkViews",["async","jquery","underscore","src/globals/queries","src/globals/queryGroups","src/globals/tags","src/events/globalEventNames","src/events/mentionEvents","src/components/mentions/_bulk/views/BulkEmotionView","src/components/mentions/_bulk/views/BulkSentimentView","src/components/mentions/_bulk/views/BulkAddTagView","src/components/mentions/_bulk/views/BulkRemoveTagView","src/components/mentions/_bulk/views/BulkLocationView","src/components/mentions/_bulk/views/BulkCategoryView","src/components/mentions/_bulk/views/BulkStarView","src/components/mentions/_bulk/views/BulkAssignmentView","src/components/mentions/_bulk/views/BulkPriorityView","src/components/mentions/_bulk/views/BulkStatusView","src/components/mentions/_bulk/views/BulkCheckedView","mustache!src/components/mentions/_bulk/templates/deleteAllMentions","mustache!src/components/mentions/_bulk/templates/markAsSpam","css!src/components/mentions/_bulk/css/bulkActionModal.css","lib/jquery.notify","lib/jquery.confirm"],function(async,$,_,queries,queryGroups,globalTags,globalEventNames,mentionEvents,BulkEmotionView,BulkSentimentView,BulkAddTagView,BulkRemoveTagView,BulkLocationView,BulkCategoryView,BulkStarView,BulkAssignmentView,BulkPriorityView,BulkStatusView,BulkCheckedView,deleteAllMentionsTemplate,markAsSpamTemplate){"use strict";function getEvents(table){return{"click thead .toggleColumns li.delete button":function clickTheadToggleColumnsLiDeleteButton(e){onBulkDelete(e,table)},"click thead .toggleColumns li.markAsSpam button":function clickTheadToggleColumnsLiMarkAsSpamButton(e){onBulkMarkAsSpam(e,table)},"click thead .toggleColumns li.bulkActions button":function clickTheadToggleColumnsLiBulkActionsButton(e){onToggleBulkActionsMenu(e,table)},"click .bulkActionsMenu":function clickBulkActionsMenu(e){hideBulkActionsMenu(e,table)},"click thead .toggleColumns li.bulkActions li.add-emotion a":function clickTheadToggleColumnsLiBulkActionsLiAddEmotionA(event){showBulkView(event,BulkEmotionView,table,{mode:"add"})},"click thead .toggleColumns li.bulkActions li.remove-emotion a":function clickTheadToggleColumnsLiBulkActionsLiRemoveEmotionA(event){showBulkView(event,BulkEmotionView,table,{mode:"remove"})},"click thead .toggleColumns li.bulkActions li.sentiment a":function clickTheadToggleColumnsLiBulkActionsLiSentimentA(event){showBulkView(event,BulkSentimentView,table)},"click thead .toggleColumns li.bulkActions li.location a":function clickTheadToggleColumnsLiBulkActionsLiLocationA(event){showBulkView(event,BulkLocationView,table)},"click thead .toggleColumns li.bulkActions li.tag a":function clickTheadToggleColumnsLiBulkActionsLiTagA(e){onBulkTag(e,table)},"click thead .toggleColumns li.bulkActions li.category a":function clickTheadToggleColumnsLiBulkActionsLiCategoryA(event){showBulkAddRemoveView(event,BulkCategoryView,table)},"click thead .toggleColumns li.bulkActions li.star a":function clickTheadToggleColumnsLiBulkActionsLiStarA(event){showBulkAddRemoveView(event,BulkStarView,table)},"click thead .toggleColumns li.bulkActions li.assign a":function clickTheadToggleColumnsLiBulkActionsLiAssignA(event){showBulkAddRemoveView(event,BulkAssignmentView,table)},"click thead .toggleColumns li.bulkActions li.priority a":function clickTheadToggleColumnsLiBulkActionsLiPriorityA(event){showBulkAddRemoveView(event,BulkPriorityView,table)},"click thead .toggleColumns li.bulkActions li.status a":function clickTheadToggleColumnsLiBulkActionsLiStatusA(event){showBulkAddRemoveView(event,BulkStatusView,table)},"click thead .toggleColumns li.bulkActions li.checked a":function clickTheadToggleColumnsLiBulkActionsLiCheckedA(event){showBulkAddRemoveView(event,BulkCheckedView,table)}}}function showBulkAddRemoveView(event,View,table){var mode=$(event.target).hasClass("remove")?"remove":"add";showBulkView(event,View,table,{mode:mode})}function showBulkView(event,View,table){var options=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};event.preventDefault();var selectedMentions=table.allSelected?"all":table.getSelectedMentionIds();View.show(Object.assign({mentions:table.collection,selectedMentions:selectedMentions},options))}function onBulkDelete(e,table){var self=table,ids=table.getSelectedMentionIds(),all=table.allSelected,mentionOrMentions=ids.length===1?"Mention":"Mentions",text=deleteAllMentionsTemplate({amount:all?"ALL mentions":ids.length===1?"1 mention":ids.length+" mentions"});$.confirm({title:"Delete "+mentionOrMentions,text:text},function(confirmed){if(!confirmed){return}$.notify("Deleting mentions",1e3);if(all){return self.collection.submitBulkJob({deleted:true},{success:function success(){var eventName;alert("Deleting ALL mentions may take some time, you will be emailed when complete.");eventName=globalEventNames.MENTIONS.MENTION_DELETE;trackBulkMentionEvents(eventName,self.collection.resultsTotal,self.settings);self.clearWaitingMessage()},error:function error(){self.clearWaitingMessage();$.notify({text:"Could not delete mentions",className:"notification-error"})}})}var deleteModels=self.collection.filter(function(mention){return ids.indexOf(mention.id)>-1});var mentionDeleteObjects=[];deleteModels.forEach(function(mention){mentionDeleteObjects.push({queryId:mention.attributes.queryId,mentionId:mention.attributes.resourceId,date:mention.attributes.date})});self.collection.bulkDelete(mentionDeleteObjects,function(err){if(err){self.clearWaitingMessage();return $.notify({text:"Could not delete mentions",className:"notification-error"})}trackMentionListEvents(globalEventNames.MENTIONS.MENTION_DELETE,deleteModels);self.collection.fetch()})})}function trackMentionListEvents(eventName,mentionsList){var queryList=_(mentionsList).countBy(function(mention){return mention.get("queryId")});Object.keys(queryList).forEach(function(queryId){mentionEvents.trigger(eventName,{count:queryList[queryId],queryId:parseInt(queryId,10),queryType:queries.get(queryId).get("type")})})}function trackBulkMentionEvents(eventName,selectedCount,settings){var queryList;if(settings.get("currentMode")==="query"){queryList=[].concat(settings.get("queryId"))}else{queryList=getQueriesFromGroupId(settings.get("queryGroupId"))}if(queryList.length===1){mentionEvents.trigger(eventName,{count:selectedCount,queryId:queryList[0],queryType:queries.get(queryList[0]).get("type")});return}mentionEvents.trigger(eventName,{count:selectedCount,queryList:queryList})}function getQueriesFromGroupId(queryGroupId){var queryList=queryGroups.get(queryGroupId).get("queries");return _(queryList).pluck("id")}function onBulkMarkAsSpam(e,table){var self=table,ids=table.getSelectedMentionIds(),mentionOrMentions=ids.length===1?"Mention":"Mentions",text=markAsSpamTemplate({amount:ids.length===1?"1 mention":ids.length+" mentions"});if(table.allSelected){return}$.confirm({title:"Mark "+mentionOrMentions+" as spam",text:text},function(confirmed){if(!confirmed){return}$.notify("Marking as spam",1e3);var deleteModels=self.collection.filter(function(mention){return ids.indexOf(mention.id)>-1});async.forEachLimit(deleteModels,10,function(mention,callback){mention.destroy({data:{isSpam:true},success:function success(){callback()},error:function error(){callback(new Error("Could not delete mention "+mention.id))}},{wait:true})},function(err){if(err){self.clearWaitingMessage();return self.showMessage("Could not delete mentions","warning")}trackMentionListEvents(globalEventNames.MENTIONS.MENTION_MARK_AS_SPAM,deleteModels);self.collection.fetch()})})}function onToggleBulkActionsMenu(e,table){e.preventDefault();e.stopPropagation();var $ul=table.$("thead li.bulkActions ul");$ul.toggleClass("hidden");if(!$ul.hasClass("hidden")){$("body").on("click.bulkActionsMenu",function(e){hideBulkActionsMenu(e,table)})}else{$("body").off("click.bulkActionsMenu")}}function hideBulkActionsMenu(e,table){$("body").off("click.bulkActionsMenu");var $ul=table.$("thead li.bulkActions ul");$ul.addClass("hidden")}function onBulkTag(event,table){event.preventDefault();var settings=table.settings;if($(event.target).hasClass("remove")){showBulkView(event,BulkRemoveTagView,table,{mode:"remove",tagCollection:globalTags})}else{showBulkView(event,BulkAddTagView,table,{mode:"add",tagCollection:globalTags,singleQuerySelected:settings.get("currentMode")==="query"&&settings.get("queryId").length===1})}}return{getEvents:getEvents,onBulkDelete:onBulkDelete,onBulkMarkAsSpam:onBulkMarkAsSpam}});define("src/components/mentions/_table/columns/CheckAndStarColumn",["jquery","src/permissions","src/globals/currentDashboard"],function($,permissions,currentDashboard){"use strict";function getEvents(table){return{"change th.checkAndStar input[type=checkbox]":function changeThCheckAndStarInputTypeCheckbox(e){onToggleCheckedAll(e,table)},"change td.checkAndStar input[type=checkbox]":function changeTdCheckAndStarInputTypeCheckbox(e){onToggleChecked(e,table)},"click td.checkAndStar a.starMention":function clickTdCheckAndStarAStarMention(e){onToggleStarred(e,table)}}}function getColumn(){return{name:"CheckAndStar",title:"",id:"checkAndStar",toggleable:false,headerClassName:"checkAndStar textcenter",headerFormatter:checkboxFormatter,formatter:actionsFormatter,updateFields:["starred"]}}function onToggleCheckedAll(e,table){var $input=$(e.target),checked=$input.is(":checked");table.$("tbody td.checkAndStar input[type=checkbox]").prop("checked",checked).closest("tr").toggleClass("selected",checked);table.allSelected=false;table.updateSelectedCount()}function onToggleChecked(e,table){var $input=$(e.target),checked=$input.is(":checked");$input.closest("tr").toggleClass("selected",checked);table.allSelected=false;table.updateSelectedCount()}function onToggleStarred(e,table){e.preventDefault();e.stopPropagation();var $star=$(e.target).closest("a.starMention"),id=$star.closest("tr").data("id"),mention=table.collection.get(id);if(mention){mention.save({starred:!mention.get("starred")},{patch:true})}}function checkboxFormatter(){if(permissions.check("select.mentions",currentDashboard)){return"<input type=checkbox />"}return""}function actionsFormatter(value,spec,row,index){var html,totalIndex=this.pager.pageSize*(this.pager.currentPage||0)+index+1;if(totalIndex<10){totalIndex="0"+totalIndex.toString()}html="<span class=number>"+totalIndex+"</span>";if(permissions.check("select.mentions",currentDashboard)){html+='<input type=checkbox value="'+row.id+'" '+(row.uiChecked?"checked":"")+" />"}if(permissions.check("edit.mentions",currentDashboard)){html+='<a class="starMention customtip '+(row.starred?"starred":"")+'" title="star this mention">star</a>'}return html}return{getEvents:getEvents,getColumn:getColumn}});define("src/components/mentions/_table/columns/sharedAuthorHelper",["jquery","src/views/AuthorContextMenu"],function($,AuthorContextMenu){"use strict";function onClickAuthor(e,table){e.preventDefault();e.stopPropagation();var $target=$(e.target);var mentionId=$target.closest("tr").data("id");var mention=table.collection.get(mentionId);var isTwitter=mention.get("pageType")==="twitter";var isFacebook=mention.get("pageType")==="facebook";var isInstagram=mention.get("pageType")==="instagram";var isMentionAuthorline=!!$target.closest(".authorline").length;showAuthorMenu(table,mention.get("author"),mention.get("facebookAuthorId"),$target,isTwitter,isFacebook,isInstagram,isMentionAuthorline)}function showAuthorMenu(table,author,authorId,$target,isTwitter,isFacebook,isInstagram,isMentionAuthorline){table.contextMenu=AuthorContextMenu.show({author:author,authorId:authorId,$target:$target,settings:table.settings,isTwitterProfile:!!isTwitter,isFacebookProfile:!!isFacebook,isInstagramProfile:!!isInstagram,isMentionAuthorline:!!isMentionAuthorline})}return{onClickAuthor:onClickAuthor,showAuthorMenu:showAuthorMenu}});define("src/components/mentions/helpers/mediaUrlHelper",["bw-fe-helpers/validationHelpers","src/components/mentions/helpers/logoDetectionHelper"],function(validationHelpers,logoDetectionHelper){"use strict";var getFirstImageMediaUrl=function getFirstImageMediaUrl(row,skipImageValidation){if(!skipImageValidation&&validationHelpers.hasImageMediaUrl(row.mediaUrls)||skipImageValidation&&!validationHelpers.isNullOrEmptyArray(row.mediaUrls)){return row.mediaUrls[0]}};var getDefaultImageMediaUrl=function getDefaultImageMediaUrl(row,logoImagesGroupId,skipImageValidation){var defaultImage=logoDetectionHelper.getDefaultLogoImage(row.logoImages,logoImagesGroupId);var defaultImageUrl=defaultImage&&defaultImage.url;if(defaultImageUrl){return defaultImageUrl}return getFirstImageMediaUrl(row,skipImageValidation)};return{getDefaultImageMediaUrl:getDefaultImageMediaUrl}});define("mustache!src/components/mentions/templates/mentionstableview/authorLine",["lib/mustache"],function(mustache){var escapedTemplate='<div class="authorline">\n{{#author}}\n<span class="author" data-author="{{author}}" data-domain="{{domain}}">{{author}}</span>\n<span class="smallmargin-horizontal">-</span>\n{{/author}}\n{{#isOfflinePublication}}\n<span class="site" data-domain="{{domain}}" data-publication="{{publicationName}}">{{publicationName}}</span>\n<a class="mention__date" href="#" target="_blank">\n<span class="externallink icon-external-link tinymargin-horizontal">\n</span>{{timestamp}}\n</a>\n\t{{/isOfflinePublication}}\n\t{{^isOfflinePublication}}\n\t    <span class="site" data-domain="{{domain}}">{{strippedDomain}}</span>\n{{#isDarkPost}}<span class="facebook__dark-post-label">(Dark post)</span>{{/isDarkPost}}\n{{#isDarkComment}}<span class="facebook__dark-post-label">(Dark comment)</span>{{/isDarkComment}}\n\t\t<a class="mention__date" href="{{url}}" target="_blank">\n\t\t    <span class="externallink icon-external-link tinymargin-horizontal">\n\t\t    </span>{{timestamp}}\n\t\t</a>\n\t{{/isOfflinePublication}}\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/components/mentions/templates/mentionstableview/facebookTitleImage",["lib/mustache"],function(mustache){var escapedTemplate='<a class="mention__logo mention__logo--facebook smallmargin-right" data-id="{{id}}" data-authorid="{{facebookAuthorId}}" title="Show Facebook Profile for {{author}}">\n{{#avatarUrl}}\n<img class="mention__avatar rounded" src="{{avatarUrl}}">{{^isDarkPost}}<img class="mention__data-source-logo">{{/isDarkPost}}\n{{/avatarUrl}}\n{{^avatarUrl}}\n<img class="mention__facebook-placeholder rounded">\n{{/avatarUrl}}\n</a>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/components/mentions/templates/mentionstableview/mediaUrlImage",["lib/mustache"],function(mustache){var escapedTemplate='{{#mediaUrl}}\n<img class="mention__inline-image smallpadding-vertical" src="{{mediaUrl}}">\n{{/mediaUrl}}\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/components/mentions/templates/mentionstableview/titleImage",["lib/mustache"],function(mustache){var escapedTemplate='{{#isOfflinePublication}}\n<span class="mention__logo mention__logo--offline-publication smallmargin-right" data-id="{{id}}"><img class="mention__favicon" src="{{faviconUrl}}"></span>\n{{/isOfflinePublication}}\n{{^isOfflinePublication}}\n<a class="mention__logo smallmargin-right" data-id="{{id}}" title="Show Domain Info"><img class="mention__favicon" src="{{faviconUrl}}"></a>\n{{/isOfflinePublication}}\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/components/mentions/templates/mentionstableview/titleContent",["lib/mustache"],function(mustache){var escapedTemplate='{{#isOfflinePublication}}\n<a class="title textellipsis" href="#">{{{title}}}</a>\n{{/isOfflinePublication}}\n{{^isOfflinePublication}}\n<a class="title textellipsis" href="{{url}}">{{{title}}}</a>\n{{/isOfflinePublication}}\n{{#snippet}}<p class="snippet">{{{.}}}</p>{{/snippet}}\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/components/mentions/formatters/mentionTitleFormatter",["jquery","src/permissions","src/globals/currentDashboard","src/helpers/mentionSnippetParser","src/components/mentions/helpers/mediaUrlHelper","src/components/mentions/helpers/offlinePublicationHelper","mustache!src/components/mentions/templates/mentionstableview/authorLine","mustache!src/components/mentions/templates/mentionstableview/facebookTitleImage","mustache!src/components/mentions/templates/mentionstableview/mediaUrlImage","mustache!src/components/mentions/templates/mentionstableview/titleImage","mustache!src/components/mentions/templates/mentionstableview/titleContent","mustache!src/components/mentions/templates/mentionsIntents","bw-fe-helpers/dateHelper","bw-fe-helpers/faviconHelper"],function($,permissions,currentDashboard,mentionSnippetParser,mediaUrlHelper,offlinePublicationHelper,renderAuthorLine,renderFacebookTitleImage,renderMediaUrlImage,renderTitleImage,renderTitleContent,mentionsIntents,dateHelper,faviconHelper){"use strict";function stripDomainPrefix(domain){if(!domain){return""}return domain.replace(/^www\./,"")}return{_getTitleImage:function _getTitleImage(row){if(row.pageType==="facebook"){var isDarkFacebookPost=row.resourceType==="dark-facebook-post";var isDarkFacebookComment=row.resourceType==="dark-facebook-comment";var isDarkPost=isDarkFacebookComment||isDarkFacebookPost;if(isDarkPost){row.isDarkPost=true;row.avatarUrl="/img/facebook-dark-post.png"}return renderFacebookTitleImage(row)}var url=row.url;if(row.isOfflinePublication){url=offlinePublicationHelper.getOnlineUrl(row.domain)}return renderTitleImage({id:row.id,faviconUrl:faviconHelper.getFaviconUrl(url),isOfflinePublication:row.isOfflinePublication})},_getAuthorLine:function _getAuthorLine(row){return renderAuthorLine({author:row.author,domain:row.domain,strippedDomain:stripDomainPrefix(row.domain),url:row.url,timestamp:dateHelper.formatTimeStamp(row.date,row.timezone),isOfflinePublication:row.isOfflinePublication,publicationName:row.publicationName,isDarkPost:row.resourceType==="dark-facebook-post",isDarkComment:row.resourceType==="dark-facebook-comment"})},_getTitleContent:function _getTitleContent(value,row){var snippet=row.hideSnippet?undefined:mentionSnippetParser.parse(row.snippet,row.matchPositions);return renderTitleContent({url:row.url,title:value||"No Title",snippet:snippet,isOfflinePublication:row.isOfflinePublication})},_getMediaUrlImage:function _getMediaUrlImage(row,logoImagesGroupId){return renderMediaUrlImage({mediaUrl:mediaUrlHelper.getDefaultImageMediaUrl(row,logoImagesGroupId)})},formatTitle:function formatTitle(value,row,logoImagesGroupId){var titleContainer=$("<div>",{class:"mention mention--other"});titleContainer.append(this._getTitleImage(row));titleContainer.append(this._getAuthorLine(row));titleContainer.append(this._getTitleContent(value,row));titleContainer.append(this._getMediaUrlImage(row,logoImagesGroupId));if(permissions.check("see.engagement",currentDashboard)){if(!row.isOfflinePublication){titleContainer.append(mentionsIntents())}}return titleContainer.prop("outerHTML")}}});define("mustache!src/extensions/twitteranalytics/formatters/twitterTableFormatters/formatTwitterProfile",["lib/mustache"],function(mustache){var escapedTemplate='<div class="mention mention--twitter">\n<a class="twitterAuthor" data-screen-name="{{accountName}}">\n<img class="twitterAvatar smallmargin-right" src="{{avatarUrl}}" title="Show Twitter Profile for @{{accountName}}">\n<span class="logo icon-bwtwitter"></span>\n<strong class="engagerUsername darkgrey">@{{accountName}}</strong>\n</a>\n{{#isVerified}}\n<span class="twitter-verified icon-ok-sign"></span>\n{{/isVerified}}\n<p class="twitterIntents singlemargin-top">\n<a href="https://twitter.com/intent/tweet?text=@{{accountName}}" target="_blank" data-tip-position="bottom" title="Tweet to @{{accountName}}" class="customtip js-engage"><span class="icon-twitter"></span> Tweet</a>\n</p>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/extensions/twitteranalytics/formatters/twitterTableFormatters/formatMentionCount",["lib/mustache"],function(mustache){var escapedTemplate='<a class="js-mention-count"{{#authorName}} data-author="{{authorName}}"{{/authorName}}{{#threadId}} data-thread-id="{{threadId}}"{{/threadId}}{{#timestamp}} data-timestamp="{{timestamp}}"{{/timestamp}} data-type="{{type}}" data-url="{{url}}">{{content}}</a>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/extensions/twitteranalytics/formatters/twitterTableFormatters",["underscore","moment","bw-fe-helpers/numberHelper","src/helpers/twitterHelper","src/helpers/mentionSnippetParser","bw-fe-helpers/autoLinkHelper","src/components/mentions/helpers/mediaUrlHelper","mustache!src/components/mentions/templates/twitterMention","mustache!src/components/mentions/templates/mentionstableview/mediaUrlImage","mustache!src/extensions/twitteranalytics/formatters/twitterTableFormatters/formatTwitterProfile","mustache!src/extensions/twitteranalytics/formatters/twitterTableFormatters/formatMentionCount","css!src/components/mentions/css/mentionTweetIntents.css"],function(_,moment,numberHelper,twitterHelper,mentionSnippetParser,autoLinkHelper,mediaUrlHelper,renderTwitterMentionTemplate,renderMediaUrlImage,renderTwitterProfileTemplate,renderMentionCountTemplate){"use strict";function renderTweetFromRow(content,row){var tweetText=mentionSnippetParser.parse(content,row.mentions||row.matchPositions),tweetEntities=row.urlEntities||twitterHelper.makeUrlEntities(row);return autoLinkHelper.twitterContent(tweetText,{urlEntities:tweetEntities,htmlEscapeNonEntities:false})}function mentionId(id,queryId){if(_.isNumber(id)){id+="-"+queryId}return id}return{formatContentWithAvatar:function formatContentWithAvatar(value,spec,row,logoImagesGroupId,showEngageOption){var date=moment.tz(row.date,row.timezone);return renderTwitterMentionTemplate({id:mentionId(row.id,row.queryId),author:row.author,avatarUrl:row.avatarUrl||"/img/twitter-profile-default.png",twitterFullName:row.twitterFullName,url:row.url,formattedTimestamp:date.isValid()?date.format("Do MMM"):"Open in new window",twitterVerified:row.twitterVerified===true,summary:!row.hideSnippet?renderTweetFromRow(row.snippet,row):null,mediaImage:renderMediaUrlImage({mediaUrl:mediaUrlHelper.getDefaultImageMediaUrl(row,logoImagesGroupId)}),retweets:row.twitterRetweets||0,impressions:row.impressions||0,replies:row.twitterReplyCount||0,intents:twitterHelper.getIntentsMarkupFromUrl(row.url,showEngageOption),prefix:"mention",isLogoMention:row.logoImages&&row.logoImages.length},false)},formatAuthorProfile:function formatAuthorProfile(author,spec,row){return renderTwitterProfileTemplate({accountName:author,avatarUrl:row.avatarUrl,isVerified:row.twitterVerified},false)},formatMentionCount:function formatMentionCount(value,column,row){if(String(value)==="0"){return"0"}if(value===""||!value){return"-"}return renderMentionCountTemplate({type:column.id,content:numberHelper.formatNaturalNumber(parseFloat(value)),threadId:row.threadId||null,authorName:row.author||null,url:row.url||null,timestamp:row.timestamp||row.date||null},false)}}});define("mustache!src/components/mentions/templates/mentionstableview/instagramMention",["lib/mustache"],function(mustache){var escapedTemplate='<div class="js-mention mention mention--instagram" data-id="{{id}}" data-queryId="{{queryId}}">\n<a class="js-avatar instagramAuthor mention__logo mention__logo--instagram" data-id="{{id}}" data-authorid="{{authorId}}" data-authorname="{{author}}">\n<img class="instagramAvatar mention__avatar smallmargin-right" title="Show Instagram Profile for @{{author}}" src="{{avatarUrl}}">\n<span class="icon-bwinstagram instagramcolor tinypadding-right biggertext valignmiddle"></span>\n<span class="js-author instagramUsername" data-authorname="{{author}}" data-authorid="{{authorId}}">@{{author}}</span>\n</a>\n\n<a class="mention__date" href="{{url}}" target="_blank"><span class="externallink icon-external-link tinymargin-right"></span>{{formattedTimestamp}}</a>\n\n<div class="js-mention-snippet instagramSummary smallmargin-bottom">{{{snippet}}}</div>\n\n{{#mediaUrl}}\n<div class="mention__postpic" style="background-image: url({{mediaUrl}})">\n{{#isInstagramVideo}}<div class="mention__video icon-play-circle"></div>{{/isInstagramVideo}}\n{{/mediaUrl}}\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/components/mentions/css/instagramMention.css",["css!src/components/mentions/css/compiled.css"],function(){});define("src/instagramchannel/formatters/instagramTableFormatters",["underscore","moment","bw-fe-helpers/autoLinkHelper","src/components/mentions/helpers/mediaUrlHelper","mustache!src/components/mentions/templates/mentionstableview/instagramMention","css!src/components/mentions/css/instagramMention.css"],function(_,moment,autoLinkHelper,mediaUrlHelper,renderInstagramMentionTemplate){"use strict";function isVideo(type){return type==="video"}function toInteger(val){return parseInt(val,10)||0}function formatMediaType(value){return isVideo(value)?"Video":"Image"}function formatTotalInteractions(value,column,row){return toInteger(row.instagramLikeCount)+toInteger(row.instagramCommentCount)}function formatContentWithAvatar(value,column,row,logoImagesGroupId){var date=moment.tz(row.date,row.timezone);var snippet=_.trim(row.snippet).length?_.prune(row.snippet,200):null;if(snippet){snippet=autoLinkHelper.instagramContent(snippet)}return renderInstagramMentionTemplate({author:row.author,authorId:row.authorId,avatarUrl:row.avatarUrl||"/img/instagram-profile-default.png",comments:row.instagramCommentCount||0,formattedTimestamp:date.isValid()?date.format("Do MMM"):"Open in new window",id:row.id,isInstagramVideo:isVideo(row.subtype),likes:row.instagramLikeCount||0,mediaUrl:mediaUrlHelper.getDefaultImageMediaUrl(row,logoImagesGroupId,true),queryId:row.queryId,resourceId:row.resourceId,snippet:snippet,url:_.escape(row.url)},false)}function formatHeaderReachEstimate(){var helpIcon='<a class="help icon-bwhelp smallmargin-left" data-key="reach-estimate"></a>';return"Reach".concat(helpIcon)}return{formatContentWithAvatar:formatContentWithAvatar,formatMediaType:formatMediaType,formatTotalInteractions:formatTotalInteractions,formatHeaderReachEstimate:formatHeaderReachEstimate}});define("src/components/mentions/_table/columns/TitleColumn",["jquery","backbone","src/components/mentions/_singlemention/views/SingleMentionView","src/components/mentions/_mentionsprofile/views/DomainProfileView","src/components/mentions/_mentionsprofile/views/TwitterProfileView","src/components/mentions/_mentionsprofile/views/FacebookProfileView","src/components/mentions/_mentionsprofile/views/InstagramProfileView","src/components/mentions/views/EngageContextMenu","src/components/mentions/_table/columns/sharedAuthorHelper","src/components/mentions/formatters/mentionTitleFormatter","src/extensions/twitteranalytics/formatters/twitterTableFormatters","src/instagramchannel/formatters/instagramTableFormatters","bw-fe-helpers/windowHelper"],function($,Backbone,SingleMentionView,DomainProfileView,TwitterProfileView,FacebookProfileView,InstagramProfileView,EngageContextMenu,sharedAuthorHelper,mentionTitleFormatter,twitterTableFormatters,instagramTableFormatters,windowHelper){"use strict";function getEvents(table){return{"click td.title a.twitterAuthor":function clickTdTitleATwitterAuthor(e){onClickTwitterAuthor(e,table)},"click td.title .twitterAvatar":function clickTdTitleTwitterAvatar(e){onClickTwitterAvatar(e)},"click tbody td.title":function clickTbodyTdTitle(e){onClickMention(e,table)},"click td.title a.profile":function clickTdTitleAProfile(e){onViewProfile(e,table)},"click td.title .author, .js-author.instagramUsername":function clickTdTitleAuthorJsAuthorInstagramUsername(e){sharedAuthorHelper.onClickAuthor(e,table)},"click td.title a.twitter-username":function clickTdTitleATwitterUsername(e){onClickTwitterUsername(e)},"click td.title a:not(.twitter-username)":function clickTdTitleANotTwitterUsername(e){onClickMentionLink(e)},"click td.title .mention__logo":function clickTdTitleMention__logo(e){onViewProfile(e,table)},"click td.title .engage":function clickTdTitleEngage(e){onClickEngage(e,table)}}}function getColumn(logoImagesGroupId){return{name:"Title",field:"title",id:"title",title:"Title",groupName:"",className:"title fourcolmin sixcolmax",toggleable:false,sortable:true,formatter:function formatter(){var newArgs=[logoImagesGroupId].concat(Array.from(arguments));return titleFormatter.apply(this,newArgs)}}}function getSourceKey(source,key){return source instanceof Backbone.Model?source.get(key):source[key]}function getSourceTypeGivenItem(source){var domain=getSourceKey(source,"domain");var pageType=getSourceKey(source,"pageType");if(domain){if(domain==="www.instagram.com"){return"instagram"}else if(domain==="www.facebook.com"){return"facebook"}}if(pageType==="twitter"){return"twitter"}return undefined}function titleFormatter(logoImagesGroupId,value,spec,row){if(this.toggleColumns){row.hideSnippet=this.toggleColumns.getCustomColumn({id:"snippets"}).disabled}switch(getSourceTypeGivenItem(row)){case"instagram":return instagramTableFormatters.formatContentWithAvatar(value,spec,row,logoImagesGroupId);case"twitter":return twitterTableFormatters.formatContentWithAvatar(value,spec,row,logoImagesGroupId,true);default:return mentionTitleFormatter.formatTitle(value,row,logoImagesGroupId)}}function onClickTwitterAuthor(e,table){var $target=$(e.target);var $currentTarget=$(e.currentTarget);e.preventDefault();e.stopPropagation();sharedAuthorHelper.showAuthorMenu(table,$currentTarget.data("screen-name"),null,$target,true)}function onClickTwitterAvatar(e){e.preventDefault();e.stopPropagation();var $target=$(e.currentTarget),author=$target.closest(".twitterAuthor").data("screen-name");if(!author){return}TwitterProfileView.show(author)}function onClickMention(e,table){var $titleAnchor=$(e.currentTarget).find("a.title");if($titleAnchor.attr("target")){openLinkOnClick($titleAnchor);return}var anchor=$(e.target).closest("a[href]"),mentionId=$(e.currentTarget).find(".mention").closest("tr").data("id"),mention=table.collection.get(mentionId);if(anchor.length&&!anchor.hasClass("title")&&!mention.get("isOfflinePublication")){return}e.preventDefault();if(table.contextMenu&&table.contextMenu.isShown()){return}table.singleMentionView=SingleMentionView.show({mentionId:mentionId,mentions:table.collection})}function onViewProfile(e,table){e.preventDefault();e.stopPropagation();var $target=$(e.currentTarget);var mentionId=$target.closest("tr").data("id");var mention=table.collection.get(mentionId);if(table.profileView){table.profileView.remove()}switch(getSourceTypeGivenItem(mention)){case"instagram":table.profileView=InstagramProfileView.show({authorName:mention.get("author")});break;case"twitter":table.profileView=TwitterProfileView.show(mention.get("author"));break;case"facebook":var authorId=$target.data("authorid");if(!authorId){return}table.profileView=FacebookProfileView.show({authorId:authorId,authorName:mention.get("author"),mentionUrl:"http://www.facebook.com/"+authorId,showPopularity:false});break;default:if(!mention.get("isOfflinePublication")){table.profileView=DomainProfileView.show(mention.get("url"),mention.get("title"))}}}function onClickTwitterUsername(e){e.stopPropagation();var author=$(e.target).data("screen-name");if(!author){return}e.preventDefault();TwitterProfileView.show(author)}function onClickMentionLink(e){if($(e.currentTarget).hasClass("title")||$(e.target).closest(".twitterIntents").length){e.preventDefault()}}function onClickEngage(e,table){e.preventDefault();e.stopPropagation();var id=$(e.target).closest("tr").data("id");if(table.contextMenu){table.contextMenu.remove()}table.contextMenu=EngageContextMenu.show({$target:$(e.target).closest("a"),mention:table.collection.get(id)})}function openLinkOnClick($anchor){windowHelper.open($anchor.attr("href")||"")}return{getEvents:getEvents,getColumn:getColumn,getSourceKey:getSourceKey,getSourceTypeGivenItem:getSourceTypeGivenItem,titleFormatter:titleFormatter}});define("css!src/components/mentions/css/logos.css",["css!src/components/mentions/css/compiled.css"],function(){});define("src/components/mentions/_table/columns/LogosColumn",["src/components/mentions/helpers/logoDetectionHelper","css!src/components/mentions/css/logos.css"],function(logoDetectionHelper){"use strict";var logosFormatter=function logosFormatter(logoImagesGroupId,value,spec,row){var defaultImage=logoDetectionHelper.getDefaultLogoImage(row.logoImages,logoImagesGroupId);if(!defaultImage){return"n/a"}return'<div class="js-logolist-wrapper b-mentions__logolist-wrapper"></div>'};var getColumn=function getColumn(logoImagesGroupId){return{name:"Logos",field:"logos",id:"logos",title:"",groupName:"Logos",className:"logos textcenter",formatter:logosFormatter.bind(null,logoImagesGroupId)}};return{getColumn:getColumn}});define("src/components/mentions/_table/columns/QueryColumn",[],function(){"use strict";function getColumn(){return{name:"Query",field:"queryName",id:"queryName",title:"",groupName:"Query"}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/sentimentemotion/SentimentColumn",["jquery","underscore","src/permissions","src/ApiError","src/globals/currentDashboard","src/storageProvider","src/globals/flags","src/globals/flagNames"],function($,_,permissions,ApiError,currentDashboard,storageProvider,flags,FLAGS){"use strict";function sentimentFormatter(value,spec,row){var className=value;if(!permissions.check("edit.mentions",currentDashboard)){return'<span class="'.concat(value,'">').concat(_.capitalize(value),"</span>")}if(row.pendingAttributes&&row.pendingAttributes.sentiment){className+=" waiting"}var sentimentOptions=["Positive","Neutral","Negative"].map(function(s){return'<li class="context-menu--row">\n                <a data-sentiment="'.concat(s.toLowerCase(),'" class="').concat(s.toLowerCase(),'">').concat(s,"</a>\n            </li>")}).join("\n");return'<div>\n                <ul class="context-menu popupframe">\n                    '.concat(sentimentOptions,'\n                </ul>\n                <a class="').concat(className,'">').concat(_.capitalize(value),"</a>\n            </div>")}function getEvents(table){return{"click td.sentiment ul a":function clickTdSentimentUlA(e){onChangeSentiment(e,table)}}}function onChangeSentiment(e,table){e.preventDefault();e.stopPropagation();var $newSentiment=$(e.target),$oldSentiment=$newSentiment.closest("td.sentiment").find("div > a"),id=$newSentiment.closest("tr").data("id"),mention=table.collection.get(id),sentiment=$newSentiment.data("sentiment"),sentimentText=$newSentiment.text();$oldSentiment.removeAttr("title");mention.save({sentiment:sentiment},{patch:true,success:function success(){$oldSentiment.text(sentimentText);$oldSentiment.removeClass("error positive negative neutral").attr("title","");$oldSentiment.addClass(sentimentText.toLowerCase())},error:function error(model,xhr){if(xhr.status===202){onSubViewDelayed()}else{var err=new ApiError(xhr);$oldSentiment.addClass("error").attr("title","An error occurred, please try again later");$oldSentiment.attr("title",err.toString())}}})}function onSubViewDelayed(){var lastShown=storageProvider.get("202NotificationLastShownInSingleMentionView");var tenMinutes=6e5;var tenSeconds=1e4;if(lastShown==null||Date.now()-lastShown>=tenMinutes){storageProvider.set("202NotificationLastShownInSingleMentionView",Date.now());$.notify({text:"Sorry, edits to mentions are taking longer than usual. The changes you've requested will be processed, but might take a while to appear everywhere.",duration:tenSeconds,className:"notification-warning-narrow"})}}function getColumn(){var emotionsEnabled=flags.variation(FLAGS.ENABLE_EMOTIONS);return{name:"Sentiment",title:emotionsEnabled?null:"",id:"sentiment",field:"sentiment",groupName:emotionsEnabled?"Sentiment and Emotion":"Sentiment",formatter:sentimentFormatter}}return{getEvents:getEvents,getColumn:getColumn}});define("lib/mustache",[],function(){"use strict";return window.Mustache});define("src/components/mentions/_table/columns/sentimentemotion/EmotionColumn",["jquery","underscore","lib/mustache","src/permissions","src/globals/currentDashboard","src/globals/flags","src/globals/flagNames","src/globals/classifications","src/controls/lib/controlsViewDataBuilder","text!src/controls/templates/sellecktMain.template","text!src/controls/templates/sellecktPopup.template","text!src/controls/templates/sellecktItem.template","text!src/controls/templates/sellecktSelection.template","lib/jquery.showValidation","src/packages/selleckt"],function($,_,Mustache,permissions,currentDashboard,flags,FLAGS,globalClassifications,controlsViewDataBuilder,sellecktMainTemplate,sellecktPopupTemplate,sellecktItemTemplate,sellecktSelectionTemplate){"use strict";function nameCompare(_ref,_ref2){var _ref$name=_ref.name,nameA=_ref$name===void 0?"":_ref$name;var _ref2$name=_ref2.name,nameB=_ref2$name===void 0?"":_ref2$name;return nameA.localeCompare(nameB)}function renderSelectedEmotionsHTML(selectedEmotionsArray){return selectedEmotionsArray.map(function(_ref3){var name=_ref3.name,labelId=_ref3.labelId;return Mustache.render(sellecktSelectionTemplate,{text:name,value:labelId})}).join("")}function emotionsFormatter(classificationsString,spec,row){var classifications=row.classifications;var emotions=globalClassifications.getEmotionLabels();if(!Array.isArray(classifications)){classifications=[]}var selectedEmotionsArray=classifications.filter(function(classification){return classification.classifierId==="emotions"}).sort(nameCompare);if(!flags.variation(FLAGS.ENABLE_EMOTIONS_MARKUP)||!permissions.check("edit.mentions",currentDashboard)){return'<ul class="selections">'+selectedEmotionsArray.map(function(classification){return'<li class="js-selection-item">'+classification.name+"</li>"}).join("")+"</ul>"}var disabledClass=selectedEmotionsArray.length===emotions.length?" disabled ":"";var sellecktPlaceholder=Mustache.render(sellecktMainTemplate,{className:"selleckt closed ".concat(disabledClass),selectedTextClass:"selectedText",selectedClass:"selected",selectedItemText:"Emotion",selections:renderSelectedEmotionsHTML(selectedEmotionsArray),selectionBottom:true});return"<div class='js-selleckt-container'>".concat(sellecktPlaceholder,"</div>")}function initSelleckt($select){var title="Emotion";return $select.selleckt({placeholderText:title,alternatePlaceholder:title,mainTemplate:sellecktMainTemplate,itemTemplate:sellecktItemTemplate,popupTemplate:sellecktPopupTemplate,selectionTemplate:sellecktSelectionTemplate,unselectItemClass:"remove",mainTemplateData:{selectionBottom:true}}).data("selleckt")}function createTempNativeSelect(mention,emotions){var classifications=mention.get("classifications");var selectedEmotions=!classifications?[]:classifications.filter(function(classification){return classification.classifierId==="emotions"}).sort(nameCompare);var options=controlsViewDataBuilder.buildOptionsFromObject(emotions,selectedEmotions.map(function(item){return item.labelId}));return $("<select multiple>".concat(options,"</select>"))}function bindSellecktListeners(sellecktInstance,table,mention,$sellecktContainer){sellecktInstance.on("onPopupCreated",onPopupChanged);sellecktInstance.on("close",onPopupChanged);sellecktInstance.on("itemSelected",onAddEmotion.bind(null,mention,{table:table,$sellecktContainer:$sellecktContainer,sellecktInstance:sellecktInstance}));sellecktInstance.on("itemUnselected",onRemoveEmotion.bind(null,mention,{table:table,$sellecktContainer:$sellecktContainer,sellecktInstance:sellecktInstance}))}function forwardInitialAction(sellecktInstance,$target){if($target.hasClass("remove")){var title=$target.closest(".selectionItem").data("value");sellecktInstance.unselectItem({value:title})}else if($target.hasClass("selected")){sellecktInstance._open()}}function onOpenClick(event,table){var $sellecktContainer=$(event.currentTarget);var id=$sellecktContainer.closest("tr").data("id");if(table.emotionsSelleckts[id]){return}$sellecktContainer.empty();var mention=table.collection.get(id);var emotions=globalClassifications.getEmotionLabels();var $select=createTempNativeSelect(mention,emotions);$sellecktContainer.append($select);var sellecktInstance=initSelleckt($select);if(sellecktInstance.selectedItems.length===sellecktInstance.items.length){sellecktInstance.toggleDisabled()}table.emotionsSelleckts[id]=sellecktInstance;bindSellecktListeners(sellecktInstance,table,mention,$sellecktContainer);forwardInitialAction(sellecktInstance,$(event.target))}function onAddEmotion(mention,data,_ref4){var value=_ref4.value;data.$sellecktContainer.showWaitmask();mention.save({addClassifications:["emotions:".concat(value)]},{patch:true,wait:true,success:onSuccess.bind(null,data.table,mention,data.$sellecktContainer),error:onAddError.bind(null,value,data.sellecktInstance,data.$sellecktContainer,"Unable to add ".concat(value," emotion"))})}function onRemoveEmotion(mention,data,_ref5){var value=_ref5.value;data.$sellecktContainer.showWaitmask();mention.save({removeClassifications:["emotions:".concat(value)]},{patch:true,wait:true,success:onSuccess.bind(null,data.table,mention,data.$sellecktContainer),error:onRemoveError.bind(null,value,data.sellecktInstance,data.$sellecktContainer,"Unable to remove ".concat(value," emotion"))})}function onAddError(value,sellecktInstance,$sellecktContainer){var $selected=$sellecktContainer.find(".selected");$selected.showInputValidation("Unable to add emotion. Please try again");$sellecktContainer.find(".selleckt").addClass("invalid");sellecktInstance.unselectItem({value:value},{silent:true});if(sellecktInstance.selectedItems.length===sellecktInstance.items.length){$sellecktContainer.find(".selleckt").removeClass("disabled")}sellecktInstance.selectedItems=_(sellecktInstance.selectedItems).reject(function(item){return item.value===value});$sellecktContainer.hideWaitmask()}function onRemoveError(value,sellecktInstance,$sellecktContainer){var $selected=$sellecktContainer.find(".selected");$selected.showInputValidation("Unable to remove emotion. Please try again");$sellecktContainer.find(".selleckt").addClass("invalid");sellecktInstance.selectItem({value:value,label:value},{silent:true});$sellecktContainer.hideWaitmask()}function onSuccess(table,mention,$view){var $selected=$view.find(".selected");$selected.hideValidation();if(table.emotionsSelleckts[mention.id]){table.emotionsSelleckts[mention.id].destroy();table.emotionsSelleckts[mention.id]=null}$view.hideWaitmask()}function onPopupChanged(){$("div.bwDataTable").toggleClass("no-scroll")}function getEvents(table){return{"click .js-selleckt-container":function clickJsSellecktContainer(event){event.stopPropagation();onOpenClick(event,table)}}}function getColumn(){return{name:"Emotion",field:"classifications",id:"emotion",disabled:true,className:"threecolmin emotion",groupName:"Sentiment and Emotion",formatter:emotionsFormatter}}return{getColumn:getColumn,getEvents:getEvents}});define("src/components/mentions/_table/columns/sentimentemotion/SentimentEmotionColumnGroup",["src/globals/flags","src/globals/flagNames","src/components/mentions/_table/columns/sentimentemotion/SentimentColumn","src/components/mentions/_table/columns/sentimentemotion/EmotionColumn"],function(flags,FLAGS,SentimentColumn,EmotionColumn){"use strict";function getColumns(){var columns=[SentimentColumn];if(flags.variation(FLAGS.ENABLE_EMOTIONS)){columns.push(EmotionColumn)}return columns}return{getColumns:getColumns}});define("src/components/mentions/_table/columns/page/FoundColumn",["bw-fe-helpers/dateHelper"],function(dateHelper){"use strict";function foundFormatter(value,colSpec,row){return dateHelper.format(value,"YYYY-MM-DD",{timezone:row.timezone})}function getColumn(){return{name:"Found",field:"date",id:"found",groupName:"Page",sortable:true,formatter:foundFormatter,className:"found textright nowrap"}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/page/TypeColumn",["underscore"],function(_){"use strict";function getColumn(){return{name:"Type",field:"pageType",id:"pageType",groupName:"Page",formatter:_.capitalize}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/page/AuthorColumn",["underscore","src/components/mentions/_table/columns/sharedAuthorHelper"],function(_,sharedAuthorHelper){"use strict";function getEvents(table){return{"click td.author a":function clickTdAuthorA(e){sharedAuthorHelper.onClickAuthor(e,table)}}}function authorFormatter(value,spec,row){if(!value){return""}if(row.pageType==="twitter"){return'<a href="http://twitter.com/'+value+'" data-screen-name="'+_.escape(row.author)+'" target="_blank" class="twitter-username" data-author="'+value+'" title="@'+value+'">@'+value+"</a>"}return'<a data-author="'+value+'" title="'+value+'">'+value+"</a>"}function getColumn(){return{name:"Author",field:"author",id:"author",groupName:"Page",sortable:true,disabled:true,formatter:authorFormatter}}return{getEvents:getEvents,getColumn:getColumn}});define("src/components/mentions/_table/columns/page/TimestampColumn",["bw-fe-helpers/dateHelper"],function(dateHelper){"use strict";function timestampFormatter(value,colSpec,row){return dateHelper.format(value,"YYYY-MM-DD HH:mm:ss",{timezone:row.timezone})}function getColumn(){return{name:"Timestamp",field:"date",id:"timestamp",groupName:"Page",sortable:true,disabled:true,formatter:timestampFormatter,className:"timestamp textright nowrap"}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/page/PageColumnGroup",["src/components/mentions/_table/columns/page/FoundColumn","src/components/mentions/_table/columns/page/TypeColumn","src/components/mentions/_table/columns/page/AuthorColumn","src/components/mentions/_table/columns/page/TimestampColumn"],function(FoundColumn,TypeColumn,AuthorColumn,TimestampColumn){"use strict";function getColumns(){return[FoundColumn,TypeColumn,AuthorColumn,TimestampColumn]}return{className:"page-group",getColumns:getColumns}});define("src/components/mentions/_table/columns/MentionTypeColumn",["underscore"],function(_){"use strict";function getColumn(){return{name:"Mention Type",field:"threadEntryType",id:"threadEntryType",groupName:"Mention Type",sortable:true,formatter:_.titleize,defaultText:"-"}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/forumthread/PostsColumn",[],function(){"use strict";function getColumn(){return{name:"Posts",field:"forumPosts",id:"forumPosts",groupName:"Forum Thread",sortable:true,disabled:true,defaultText:"-"}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/forumthread/ViewsColumn",[],function(){"use strict";function getColumn(){return{name:"Views",field:"forumViews",id:"forumViews",groupName:"Forum Thread",sortable:true,disabled:true,defaultText:"-"}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/forumthread/ForumThreadColumnGroup",["src/components/mentions/_table/columns/forumthread/PostsColumn","src/components/mentions/_table/columns/forumthread/ViewsColumn"],function(PostsColumn,ViewsColumn){"use strict";function getColumns(){return[PostsColumn,ViewsColumn]}return{className:"forumthread-group",getColumns:getColumns}});define("src/components/mentions/_table/columns/CommentsColumn",[],function(){"use strict";function getColumn(){return{name:"Comments",field:"blogComments",id:"blogComments",groupName:"Blog",sortable:true,disabled:true,defaultText:"-"}}return{getColumn:getColumn}});define("mustache!src/components/mentions/templates/mentionsPopupUtilsBarAddToDashboard",["lib/mustache"],function(mustache){var escapedTemplate='<li class="addToDashboard floatleft smallmargin-left componentHeader--section">\n<button class="customtip js-addToDashboard defaultbutton smallmargin-right"\ntitle="This will give you additional functionality like bulk\ncategorisation and deletion for this set of mentions">\n<span class="icon-circle-arrow-down smallpadding-right"></span>Add to Dashboard</button>\n</li>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/components/mentions/templates/mentionsPopupUtilsBarCreateRule",["lib/mustache"],function(mustache){var escapedTemplate='<li class="floatleft">\n<button class="customtip js-create-rule button smallmargin-right"\ntitle="Create Rule from this Topic">Create Rule&hellip;<span class="newIcon"></span>\n</button>\n</li>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}define("src/components/mentions/views/MentionsPopupUtilsBarView",["underscore","src/permissions","src/globals/currentDashboard","src/views/UtilsBarView","mustache!src/components/mentions/templates/mentionsPopupUtilsBarAddToDashboard","mustache!src/components/mentions/templates/mentionsPopupUtilsBarCreateRule","src/packages/customtip"],function(_,permissions,currentDashboard,UtilsBarView,addToDashboardTemplate,createRuleTemplate){"use strict";var VIEW_SELECTORS={MAXIMISE:"a.maximise",ADD_TO_DASHBOARD:".js-addToDashboard",CREATE_RULE:".js-create-rule"};return UtilsBarView.extend({events:function events(){var _$extend;return _.extend((_$extend={},_defineProperty(_$extend,"click ".concat(VIEW_SELECTORS.ADD_TO_DASHBOARD),"onAddToDashboard"),_defineProperty(_$extend,"click ".concat(VIEW_SELECTORS.CREATE_RULE),"onCreateRule"),_defineProperty(_$extend,"click ".concat(VIEW_SELECTORS.MAXIMISE),"onMaximise"),_$extend),UtilsBarView.prototype.events.call(this))},initialize:function initialize(options){options=options||{};options.canSeeHelp=false;options.canSeeControls=false;options.viewList=[{name:"Snippets",key:"snippetsView",isActive:true},{name:"Topics",key:"topicsView"}];UtilsBarView.prototype.initialize.call(this,options);this.bind("switchView",this.onSwitchViews,this);this.canAddToDashboard=options.canAddToDashboard===undefined?true:options.canAddToDashboard;this.canCreateRuleFromTopic=options.canCreateRuleFromTopic},onSwitchViews:function onSwitchViews(key){if(key==="topicsView"){this.$("li.addToDashboard").remove()}else{this.showAddToDashboard()}},onAddToDashboard:function onAddToDashboard(e){e.preventDefault();this.trigger("addToDashboard")},onCreateRule:function onCreateRule(e){e.preventDefault();this.trigger("createRule")},onMaximise:function onMaximise(e){e.preventDefault();this.trigger("maximise")},showAddToDashboard:function showAddToDashboard(){if(this.canAddToDashboard&&permissions.check("edit.dashboard",currentDashboard)){this.$("li.switch-views").before(addToDashboardTemplate())}},showCreateRule:function showCreateRule(){if(this.canCreateRuleFromTopic&&permissions.check("edit.rules")){this.$("li.switch-views").before(createRuleTemplate())}},render:function render(){UtilsBarView.prototype.render.call(this);this.showAddToDashboard();this.showCreateRule();this.$("li.js-componentcontextmenu").addClass("hidden");this.$("li.componentHeader--section").last().after('<li class="maximise floatleft singlemargin-horizontal">'+'<a class="maximise icon-resize-full  lightgrey customtip" title="Maximize">'+"</a></li>");this.$el.customtip()}})});define("mustache!src/components/mentions/templates/mentionsPopup",["lib/mustache"],function(mustache){var escapedTemplate='<header>\n<h1 class="popuptitletext textellipsis ellipsistooltip customtip draggable singlemargin-bottom" title="{{title}}">{{{title}}}</h1>\n</header>\n<div class="content"></div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/components/mentions/css/mentionsPopup.css",["css!src/components/mentions/css/compiled.css"],function(){});define("src/components/mentions/views/MentionsPopup",["backbone","underscore","jquery","moment","bw-fe-helpers/isoDateHelper","src/analytics/Analytics","src/globals/queries","src/globals/categories","src/globals/queryGroups","src/events/dashboardEvents","src/events/globalEventNames","src/permissions","src/helpers/createRuleHelper","src/views/ExportMenuView","src/components/mentions/views/MentionsPopupUtilsBarView","src/components/mentions/views/MentionsSnippetsView","src/components/mentions/views/MentionsTopicsView","src/components/mentions/models/MentionsControls","src/components/mentions/models/MentionCollection","src/components/mentions/helpers/mentionsExportHelper","mustache!src/components/mentions/templates/mentionsPopup","css!src/components/mentions/css/mentionsPopup.css"],function(Backbone,_,$,moment,isoDateHelper,Analytics,queries,categories,queryGroups,dashboardEvents,globalEventNames,permissions,createRuleHelper,ExportMenuView,MentionsPopupUtilsBarView,MentionsSnippetsView,MentionsTopicsView,MentionsControls,MentionCollection,mentionsExportHelper,mentionsPopup){"use strict";var DASHBOARD_EVENT_NAMES=globalEventNames.DASHBOARDS,MentionsPopup;function trackEvent(action,cid,values){Analytics.trackEvent({name:"Miscellaneous.MentionsPopup",action:action,origin:cid,values:values})}function createExportView(view){view.exportView=new ExportMenuView({model:new Backbone.Model({formats:[{id:"xlsx",name:"Excel"},{id:"fulltext.xlsx",name:"Excel (Full text)"},{id:"csv",name:"CSV"}]})});view.listenTo(view.exportView,"doExport",view.onExport)}function createUtilsBarView(view,options){view.utilsBarView=new MentionsPopupUtilsBarView({canExport:mentionsExportHelper.canExport(view.mentions.settings.toJSON()),exportView:view.exportView,canAddToDashboard:options.canAddToDashboard,canCreateRuleFromTopic:options.canCreateRuleFromTopic});view.listenTo(view.utilsBarView,"addToDashboard",view.onAddToDashboard);view.listenTo(view.utilsBarView,"createRule",view.onCreateRule);view.listenTo(view.utilsBarView,"switchView",view.onSwitchView);view.listenTo(view.utilsBarView,"minimise",view.onMinimise);view.listenTo(view.utilsBarView,"maximise",view.onMaximise);view.listenTo(view.utilsBarView,"close",view.onClose)}function extendWithDates(title,options){if(!options.dateRange){return title}var timezone=options.timezone;var dates=isoDateHelper.extractStartEndDates(options.dateRange);if(moment.tz(dates.endDate,timezone).diff(moment.tz(dates.startDate,timezone),"days")===1){title+=" on "+moment.tz(dates.startDate,timezone).format("MMM DD, YYYY")}else{title+=" between "+moment.tz(dates.startDate,timezone).format("MMM DD, YYYY")+" and "+moment.tz(dates.endDate,timezone).subtract(1,"days").format("MMM DD, YYYY")}return title}function extendWithSentiment(title,options){if(options.sentiment&&["positive","negative","neutral"].indexOf(options.sentiment.toLowerCase())>-1){title+=" in "+_.capitalize(options.sentiment)+"-like Contexts"}return title}function extendWithDomain(title,options){if(options.publication){return title+" from "+options.publication}if(options.domain&&!_.isArray(options.domain)){title+=" on "+(options.domain==="twitter.com"?"Twitter":options.domain)}else if(options.domain){title+=" across "+options.domain.length+" Sites"}return title}function extendWithPageType(title,options){if(options.pageType){title+=" on "+_.capitalize(options.pageType);if(!_(title).endsWith("Twitter")){title+=" Sites"}}return title}function extendWithCountryName(title,options){if(options.countryName){title+=" on Pages from "+options.countryName}return title}function extendWithSearch(title,options){if(options.search){title=/^".*"$/.test(options.search)?title+" for "+options.search:title+' for "'+options.search+'"'}if(options.twitterInsightValue){title+=" for "+options.twitterInsightValue}return title}function buildTitleHelper(options,queryGroupName){var title,authorDisplayName;if(!queryGroupName&&!options.queryName){title="Mentions Found"}else{title=(options.queryName||queryGroupName)+" Mentions Found"}if(options.author){authorDisplayName=options.author;if(options.domain==="twitter.com"||_.capitalize(options.pageType)==="Twitter"){authorDisplayName="@"+authorDisplayName}title="Mentions by "+authorDisplayName}title=extendWithDates(title,options);title=extendWithSentiment(title,options);title=extendWithDomain(title,options);title=extendWithPageType(title,options);title=extendWithCountryName(title,options);title=extendWithSearch(title,options);if(title==="Mentions Found"){title="Mentions"}return title}MentionsPopup=Backbone.View.extend({className:"mentionsPopup popup hugepopup",initialize:function initialize(options){if(!options||!options.title){throw new Error("options.title was not set!")}if(!options.settings){throw new Error("options.settings was not set!")}this.settings=options.settings;this.title=options.title||"Mentions";this.youtubeOnly=options.youtubeOnly||false;this.listenTo(dashboardEvents,DASHBOARD_EVENT_NAMES.DASHBOARD_HIDDEN,this.remove);this.mentions=new MentionCollection(null,{settings:this.settings});this.snippetsView=new MentionsSnippetsView({collection:this.mentions,settings:this.settings,isPopup:true,itemsType:options.itemsType,categories:categories,timezone:this.settings.timezone,totalMentions:options.totalMentions,showTermFilter:options.showTermFilter,youtubeOnly:this.youtubeOnly});this.listenTo(this.snippetsView,"sort",function(orderBy){trackEvent("Sort_by_"+orderBy,this.cid)});this.topicsView=new MentionsTopicsView({collection:this.mentions,settings:this.settings,youtubeOnly:this.youtubeOnly});createExportView(this);createUtilsBarView(this,options)},remove:function remove(){this.$el.removeModal();Backbone.View.prototype.remove.call(this)},render:function render(){var $el=this.$el,data=this.settings.toJSON();data.title=this.title;$el.html(mentionsPopup(data));$el.find("header").prepend(this.utilsBarView.el);this.utilsBarView.render();$el.find(".content").html(this.snippetsView.el);$el.find(".content").append(this.topicsView.el);$el.customtip();this.onSwitchView("snippetsView");$el.showModal({mask:true,className:"mentionsPopupModal",draggable:"header h1"})},doExport:function doExport(options){mentionsExportHelper.warnIfBigVolumeAndExport("MentionsPopup",this.mentions,this.settings,options)},onExport:function onExport(options){this.doExport(options)},onAddToDashboard:function onAddToDashboard(){var components;if(this.youtubeOnly){components=[{title:"YouTube Mentions",type:"youtubementions",settings:this.settings.toJSON()}]}else{components=[{title:"Mentions & Search",type:"mentions",settings:this.settings.toJSON()}]}dashboardEvents.trigger(DASHBOARD_EVENT_NAMES.TAB_CREATED,{components:components});this.trigger("addedToDashboard");this.remove()},onCreateRule:function onCreateRule(){var settings=this.settings.toJSON();createRuleHelper.show(settings);this.remove()},onSwitchView:function onSwitchView(key){if(key==="topicsView"){$(this.snippetsView.el).hide();$(this.topicsView.el).show();this.snippetsView.hidden();this.topicsView.render();this.topicsView.shown()}else{$(this.topicsView.el).hide();$(this.snippetsView.el).show();this.topicsView.hidden();this.snippetsView.render();this.snippetsView.shown()}if(!this.fetched){this.fetched=true;this.mentions.fetch()}},onMinimise:function onMinimise(){this.$el.toggleClass("minimised").removeClass("maximised").css({width:"",height:""})},onMaximise:function onMaximise(){var width,height,paddingHorizontal,paddingVertical,maximized=false;if(!this.$el.is(".maximised")){paddingHorizontal=this.$el.innerWidth()-this.$el.width();paddingVertical=this.$el.innerHeight()-this.$el.height();width=Math.floor($(window).width()*.95)-paddingHorizontal;height=Math.floor($(window).height()*.95)-paddingVertical;maximized=true}this.$el.removeClass("minimised").toggleClass("maximised").css({width:width||"",height:height||""}).centreModal();this.$el.find("a.maximise").attr("title",maximized?"Minimize":"Maximize").toggleClass("icon-resize-full icon-resize-small").customtip()},onClose:function onClose(){this.remove()}},{buildTitle:function buildTitle(settings,additionalOptions){var queryGroup,queryGroupId,queryGroupName,query,queryName,isQueryGroupId;additionalOptions=additionalOptions||{};isQueryGroupId=additionalOptions.queryGroupId||settings.get("currentMode")!=="query"&&settings.get("queryGroupId");if((additionalOptions.Query||additionalOptions.queryId)&&!additionalOptions.queryName){additionalOptions.queryId=parseInt(additionalOptions.Query||additionalOptions.queryId,10);query=queries.get(additionalOptions.queryId);if(query){queryName=query.get("name")}else{queryName=""}additionalOptions.queryName=queryName}else if(isQueryGroupId){queryGroupId=parseInt(additionalOptions.queryGroupId,10)||settings.get("queryGroupId");queryGroup=queryGroups.get(queryGroupId);if(queryGroup){queryGroupName=queryGroup.get("name")}}if(additionalOptions.Sentiment){additionalOptions.sentiment=additionalOptions.Sentiment}return buildTitleHelper(_.extend({timezone:settings.timezone},additionalOptions),queryGroupName)},showMentions:function showMentions(options){var additionalOptions=options.additionalOptions||{};var title=options.title||MentionsPopup.buildTitle(options.settings,additionalOptions);var settings=options.settings.toJSONSubset(additionalOptions);var timezone=options.settings.timezone;var controls;var popup;if(!permissions.check("see.mentions")){return}settings.sort="date";settings.direction="desc";settings.dateRange=isoDateHelper.convertToISODateRange(settings.dateRange,{timezone:timezone});settings.specifyTime=true;if(!settings.currentMode){settings.currentMode="query"}if("count"in settings){delete settings.count}if("start"in settings){delete settings.start}controls=new MentionsControls(settings,{timezone:timezone,youtubeOnly:options.youtubeOnly});popup=new MentionsPopup({title:title,settings:controls,canAddToDashboard:options.canAddToDashboard,canCreateRuleFromTopic:additionalOptions.canCreateRuleFromTopic,itemsType:options.itemsType,totalMentions:options.totalMentions,showTermFilter:options.showTermFilter,youtubeOnly:options.youtubeOnly});popup.render();trackEvent("Open_Popup",popup.cid,{title:title});return popup}});return MentionsPopup});define("mustache!src/components/mentions/_table/templates/numberFormatter",["lib/mustache"],function(mustache){var escapedTemplate="<a>{{value}}</a>";return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/components/mentions/_table/columns/twitter/twitterFormatter",["mustache!src/components/mentions/_table/templates/numberFormatter"],function(numberFormatterTemplate){"use strict";function numberFormatter(value){if(value==="0"){return value}return numberFormatterTemplate({value:value})}return{numberFormatter:numberFormatter}});function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};var ownKeys=Object.keys(source);if(typeof Object.getOwnPropertySymbols==="function"){ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))}ownKeys.forEach(function(key){_defineProperty(target,key,source[key])})}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(iter){if(Symbol.iterator in Object(iter)||Object.prototype.toString.call(iter)==="[object Arguments]")return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}}define("src/components/mentions/_table/columns/twitter/RetweetsColumn",["jquery","src/components/mentions/views/MentionsPopup","src/components/mentions/_table/columns/twitter/twitterFormatter","src/controls/filters/TwitterFilters"],function($,MentionsPopup,twitterFormatter,TwitterFilters){"use strict";function getColumn(){return{name:"Retweets",field:"twitterRetweets",id:"twitterRetweets",className:"twitterRetweets",groupName:"Twitter",sortable:true,disabled:true,defaultText:"-",formatter:twitterFormatter.numberFormatter}}function getEvents(table){return{"click .twitterRetweets a":function clickTwitterRetweetsA(event){onClickRetweet(event,table)}}}function onClickRetweet(event,table){event.preventDefault();event.stopPropagation();var id=$(event.currentTarget).closest("tr").data("id");var currentMention=table.collection.get(id);var twitterFilterNames=TwitterFilters.FILTER_NAMES;var unsetQueryParameters=Object.assign.apply(Object,_toConsumableArray(twitterFilterNames.map(function(name){return _defineProperty({},name,"")})));MentionsPopup.showMentions({settings:table.collection.settings,additionalOptions:_objectSpread({twitterRetweetOf:currentMention.get("url"),page:0},unsetQueryParameters)})}return{getEvents:getEvents,getColumn:getColumn}});define("src/components/mentions/_table/columns/twitter/ReachScoreColumn",[],function(){"use strict";function getColumn(){return{name:"Twitter Reach",field:"reach",id:"reach",groupName:"Twitter",sortable:true,disabled:true,defaultText:"-"}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/twitter/TweetsColumn",[],function(){"use strict";function getColumn(){return{name:"Tweets",field:"twitterPostCount",id:"twitterPostCount",groupName:"Twitter",sortable:true,disabled:true,defaultText:"-"}}return{getColumn:getColumn}});function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};var ownKeys=Object.keys(source);if(typeof Object.getOwnPropertySymbols==="function"){ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))}ownKeys.forEach(function(key){_defineProperty(target,key,source[key])})}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(iter){if(Symbol.iterator in Object(iter)||Object.prototype.toString.call(iter)==="[object Arguments]")return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}}define("src/components/mentions/_table/columns/twitter/TwitterReplyCountColumn",["jquery","src/components/mentions/views/MentionsPopup","src/components/mentions/_table/columns/twitter/twitterFormatter","src/controls/filters/TwitterFilters"],function($,MentionsPopup,twitterFormatter,TwitterFilters){"use strict";function getColumn(){return{name:"Replies",field:"twitterReplyCount",id:"twitterReplyCount",className:"twitterReplyCount",groupName:"Twitter",sortable:true,defaultText:"-",formatter:twitterFormatter.numberFormatter}}function getEvents(table){return{"click .twitterReplyCount a":function clickTwitterReplyCountA(event){onClickReply(event,table)}}}function onClickReply(event,table){event.preventDefault();event.stopPropagation();var id=$(event.currentTarget).closest("tr").data("id");var currentMention=table.collection.get(id);var twitterFilterNames=TwitterFilters.FILTER_NAMES;var unsetQueryParameters=Object.assign.apply(Object,_toConsumableArray(twitterFilterNames.map(function(name){return _defineProperty({},name,"")})));MentionsPopup.showMentions({settings:table.collection.settings,additionalOptions:_objectSpread({twitterReplyTo:currentMention.get("url"),page:0},unsetQueryParameters)})}return{getEvents:getEvents,getColumn:getColumn}});define("src/components/mentions/_table/columns/twitter/FollowersColumn",[],function(){"use strict";function getColumn(){return{name:"Followers",field:"twitterFollowers",id:"twitterFollowers",groupName:"Twitter",sortable:true,defaultText:"-"}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/twitter/FollowingColumn",[],function(){"use strict";function getColumn(){return{name:"Following",field:"twitterFollowing",id:"twitterFollowing",groupName:"Twitter",sortable:true,disabled:true,defaultText:"-"}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/twitter/ImpressionsColumn",[],function(){"use strict";function getColumn(){return{name:"Impressions",field:"impressions",id:"impressions",groupName:"Twitter",sortable:true,disabled:true,defaultText:"-"}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/twitter/InfluenceColumn",[],function(){"use strict";function getColumn(){return{name:"Influence",field:"influence",id:"influence",groupName:"Twitter",sortable:true,disabled:true,defaultText:"-"}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/twitter/OutreachColumn",[],function(){"use strict";function getColumn(){return{name:"Outreach",field:"outreach",id:"outreach",groupName:"Twitter",sortable:true,disabled:true,defaultText:"-"}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/twitter/UserRoleColumn",[],function(){"use strict";function getColumn(){return{name:"User Role",field:"twitterRole",id:"twitterRole",groupName:"Twitter",sortable:true,disabled:true,defaultText:"-"}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/twitter/VerifiedColumn",[],function(){"use strict";function getColumn(){return{name:"Verified",field:"twitterVerified",id:"twitterVerified",groupName:"Twitter",sortable:true,disabled:true,defaultText:"-"}}return{getColumn:getColumn}});define("src/models/AuthorModel",["src/models/DataModel"],function(DataModel){"use strict";return DataModel.extend({idAttribute:"username",url:function url(){var url="/authors/";url+=this.id;return encodeURI(url)}})});define("src/globals/demographicsUpdates",["jquery","underscore","src/Workbench","src/models/AuthorModel","src/events/projectEvents","src/events/globalEventNames","src/globals/currentProject","lib/jquery.notify"],function($,_,Workbench,AuthorModel,projectEvents,globalEventNames,currentProject){"use strict";var PROJECT_EVENT_NAMES=globalEventNames.PROJECTS;function startBulkAction(options){$.ajax({type:"POST",url:Workbench.buildApiUrl("/projects/{projectId}/bulkactions/author"),data:JSON.stringify(options),dataType:"json",contentType:"application/json",success:function success(){projectEvents.trigger(PROJECT_EVENT_NAMES.NOTIFICATION_SHOWN,{text:"Your Author change is being applied throughout your Project, this may take a few minutes."})},error:function error(){$.notify({text:"Could not update all mentions from this author. Please try again.",className:"notification-error"})}})}function stringToProfessionAndJobTitleObject(profession){return{profession:profession,jobTitle:null}}function validateUpdateInterestsOptions(options){if(!options){throw new TypeError("options (object) is required")}checkForRequiredArray(options,"interests");checkForRequiredString(options,"username");checkResourceAndQueryIds(options)}function validateUpdateProfessionsOptions(options){if(!options){throw new TypeError("options (object) is required")}checkForRequiredArray(options,"professions");checkForRequiredString(options,"username");checkResourceAndQueryIds(options)}function checkResourceAndQueryIds(options){if(options.resourceId&&!options.queryId){throw new TypeError("options.queryId must be supplied with options.resourceId")}if(options.queryId&&!options.resourceId){throw new TypeError("options.resourceId must be supplied with options.queryId")}}function checkForRequiredString(options,property){if(!_.isString(options[property])||options[property]===""){throw new TypeError("options."+property+" (string) is required")}}function checkForRequiredArray(options,property){if(!_.isArray(options[property])){throw new TypeError("options."+property+" (array) is required")}}function showAuthorSaveError(){$.notify({text:"Could not save author changes. Please try again.",className:"notification-error"})}function withMentionData(options,data){if(!options.queryId){return data}return _.extend(data,{resourceId:options.resourceId,queryId:options.queryId,date:options.date})}return{updateGender:function updateGender(options){if(!options){throw new TypeError("options (object) is required")}checkForRequiredString(options,"username");checkForRequiredString(options,"gender");checkResourceAndQueryIds(options);(new AuthorModel).save(withMentionData(options,{username:options.username,gender:options.gender,projectId:currentProject.id,domain:"twitter.com"}),{patch:true,success:function success(model){startBulkAction({authorName:options.username,domain:"twitter.com",gender:options.gender});if(options.success){options.success(model.toJSON())}},error:function error(){showAuthorSaveError();if(options.error){options.error()}}})},updateAccountType:function updateAccountType(options){if(!options){throw new TypeError("options (object) is required")}checkForRequiredString(options,"username");checkForRequiredString(options,"accountType");checkResourceAndQueryIds(options);(new AuthorModel).save(withMentionData(options,{username:options.username,accountType:options.accountType,projectId:currentProject.id,domain:"twitter.com"}),{patch:true,success:function success(model){startBulkAction({authorName:options.username,domain:"twitter.com",accountType:options.accountType});if(options.success){options.success(model.toJSON())}},error:function error(){showAuthorSaveError();if(options.error){options.error()}}})},updateProfessions:function updateProfessions(options){var opts=_.clone(options),data;validateUpdateProfessionsOptions(opts);opts.professions=opts.professions.map(stringToProfessionAndJobTitleObject);data=withMentionData(options,{username:opts.username,domain:"twitter.com",professions:opts.professions,projectId:currentProject.id});(new AuthorModel).save(data,{patch:true,success:function success(model){startBulkAction({authorName:opts.username,domain:"twitter.com",professions:opts.professions});if(opts.success){opts.success(model.toJSON())}},error:function error(){showAuthorSaveError();if(opts.error){opts.error()}}})},updateInterests:function updateInterests(options){validateUpdateInterestsOptions(options);(new AuthorModel).save(withMentionData(options,{username:options.username,domain:"twitter.com",interests:options.interests,projectId:currentProject.id}),{patch:true,success:function success(model){startBulkAction({authorName:options.username,domain:"twitter.com",interests:options.interests});if(options.success){options.success(model.toJSON())}},error:function error(){showAuthorSaveError();if(options.error){options.error()}}})}}});define("mustache!src/extensions/demographicssummary/templates/genderAndAccountTypeContextMenu",["lib/mustache"],function(mustache){var escapedTemplate='<ul>\n{{#showAccountTypeOptions}}\n{{#showIndividual}}\n<li class="context-menu--item jsAccountType" data-value="individual"><a>Change to "Individual"</a></li>\n{{/showIndividual}}\n{{#showOrganisational}}\n<li class="context-menu--item jsAccountType" data-value="organisational"><a>Change to "Organisational"</a></li>\n{{/showOrganisational}}\n{{/showAccountTypeOptions}}\n{{#showGenderOptions}}\n{{#showMale}}\n<li class="context-menu--item jsGender" data-value="male"><a>Change to "Male"</a></li>\n{{/showMale}}\n{{#showFemale}}\n<li class="context-menu--item jsGender" data-value="female"><a>Change to "Female"</a></li>\n{{/showFemale}}\n{{#showUnknown}}\n<li class="context-menu--item jsGender" data-value="unknown"><a>Change to "Unknown"</a></li>\n{{/showUnknown}}\n{{/showGenderOptions}}\n<li class="context-menu--item separator"></li>\n\n<li class="explanation grey">\n{{#singleMentionContext}}\nIt may take a few minutes before your dashboard is fully updated.\n{{/singleMentionContext}}\n\n{{^singleMentionContext}}\nIt may take a few minutes before this component and your dashboard is fully updated.\n{{/singleMentionContext}}\n</li>\n</ul>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/extensions/demographicssummary/css/demographicsContextMenu.css",["css!src/extensions/demographicssummary/css/compiled.css"],function(){});define("src/views/GenderAccountTypeContextMenuView",["underscore","jquery","backbone","src/analytics/Analytics","mustache!src/extensions/demographicssummary/templates/genderAndAccountTypeContextMenu","src/views/ContextMenuView","css!src/extensions/demographicssummary/css/demographicsContextMenu.css"],function(_,$,Backbone,Analytics,renderContextMenu,ContextMenuView){"use strict";var VALID_GENDERS=["male","female","unknown"],VALID_ACCOUNT_TYPES=["organisational","individual","unknown"];function trackAnalyticsEvent(analyticsCategory,action){if(analyticsCategory){Analytics.trackEvent({name:analyticsCategory,action:action,origin:"Application"})}}function validate(options){if(!options){throw new TypeError("options is required")}if(!options.analyticsCategory){throw new TypeError('options.analyticsCategory is required, for example "Component.Mentions"')}if(options.gender&&VALID_GENDERS.indexOf(options.gender)===-1){throw new TypeError(options.gender+" is not a valid gender. Valid genders are: "+VALID_GENDERS.join(","))}if(options.accountType&&VALID_ACCOUNT_TYPES.indexOf(options.accountType)===-1){throw new TypeError(options.accountType+" is not a valid accountType. Valid accountTypes are: "+VALID_ACCOUNT_TYPES.join(","))}}return ContextMenuView.extend({tagName:"nav",className:"demographicsContextMenuView context-menu popupframe",events:function events(){return{"click .jsGender":function triggerGenderChange(e){e.preventDefault();this.trigger("uiChangeGenderAction",$(e.currentTarget).data("value"))},"click .jsAccountType":function triggerAccountTypeChange(e){e.preventDefault();this.trigger("uiChangeAccountTypeAction",$(e.currentTarget).data("value"))}}},constructor:function GenderAccountTypeContextMenuView(options){Backbone.View.apply(this,arguments);validate(options);this.options=options;this.gender=(options.gender||"unknown").toLowerCase().trim();this.accountType=(options.accountType||"unknown").toLowerCase().trim()},render:function render(){if(_(this.options).keys().indexOf("gender")>-1){this.renderGenderMenu();return}this.renderAccountTypeMenu()},renderGenderMenu:function renderGenderMenu(){var templateData={},options=this.options;templateData.singleMentionContext=options.singleMentionContext;templateData.showGenderOptions=true;templateData.showMale=this.gender!=="male";templateData.showFemale=this.gender!=="female";templateData.showUnknown=this.gender!=="unknown";trackAnalyticsEvent(options.analyticsCategory,"Show_Gender_Context_Menu");this.$el.html(renderContextMenu(templateData))},renderAccountTypeMenu:function renderAccountTypeMenu(){var templateData={},options=this.options;templateData.singleMentionContext=options.singleMentionContext;templateData.showAccountTypeOptions=true;templateData.showOrganisational=this.accountType!=="organisational";templateData.showIndividual=this.accountType!=="individual";trackAnalyticsEvent(options.analyticsCategory,"Show_Account_Type_Context_Menu");this.$el.html(renderContextMenu(templateData))}})});define("mustache!src/extensions/demographicssummary/formatters/templates/profession",["lib/mustache"],function(mustache){var escapedTemplate='{{#isShowningDemographicsData}}\n{{#professions}}\n<span class="nowrap db">\n<span class="customtip" {{#jobTitles}}title="This author\'s Twitter bio contained {{jobTitles}}"{{/jobTitles}}{{^jobTitles}}title="This profession was assigned manually"{{/jobTitles}}>\n\t{{#isEditable}}\n\t\t<a {{#dataAttributes}}data-{{key}}="{{value}}"{{/dataAttributes}}>\n\t\t\t{{profession}}\n<span class="chevron icon-chevron-down"></span>\n\t\t</a>\n\t{{/isEditable}}\n\t{{^isEditable}}\n\t\t{{profession}}\n\t{{/isEditable}}\n</span>\n</span>\n{{/professions}}\n\n{{^professions}}\n{{#isEditable}}\n<a {{#dataAttributes}}data-{{key}}="{{value}}"{{/dataAttributes}}>\nUnknown\n<span class="chevron icon-chevron-down"></span>\n</a>\n{{/isEditable}}\n{{^isEditable}}\n<span>Unknown</span>\n{{/isEditable}}\n{{/professions}}\n{{/isShowningDemographicsData}}\n\n{{^isShowningDemographicsData}}\n<span class="lightgrey">-</span>\n{{/isShowningDemographicsData}}\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/extensions/demographicssummary/formatters/templates/interests",["lib/mustache"],function(mustache){var escapedTemplate='{{#isShowningDemographicsData}}\n{{#interests}}\n<span class="nowrap db">\n\t{{#isEditable}}\n\t\t<a {{#dataAttributes}}data-{{key}}="{{value}}"{{/dataAttributes}}>\n\t\t\t{{interest}}\n<span class="chevron icon-chevron-down"></span>\n\t\t</a>\n\t{{/isEditable}}\n\t{{^isEditable}}\n\t\t{{interest}}\n\t{{/isEditable}}\n</span>\n{{/interests}}\n\n{{^interests}}\n{{#isEditable}}\n<a {{#dataAttributes}}data-{{key}}="{{value}}"{{/dataAttributes}}>\nUnknown\n<span class="chevron icon-chevron-down"></span>\n</a>\n{{/isEditable}}\n{{^isEditable}}\n<span>Unknown</span>\n{{/isEditable}}\n{{/interests}}\n{{/isShowningDemographicsData}}\n\n{{^isShowningDemographicsData}}\n<span class="lightgrey">-</span>\n{{/isShowningDemographicsData}}\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/extensions/demographicssummary/formatters/templates/singleDemographic",["lib/mustache"],function(mustache){var escapedTemplate='{{#isShowningDemographicsData}}\n{{#isEditable}}\n<a class="hover-chevron-down">\n{{value}}\n<span class="chevron icon-chevron-down"></span>\n</a>\n{{/isEditable}}\n{{^isEditable}}\n{{value}}\n{{/isEditable}}\n{{/isShowningDemographicsData}}\n\n{{^isShowningDemographicsData}}\n<span class="lightgrey">-</span>\n{{/isShowningDemographicsData}}\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/extensions/demographicssummary/formatters/demographicsFormatters",["underscore","src/permissions","src/globals/currentDashboard","mustache!src/extensions/demographicssummary/formatters/templates/profession","mustache!src/extensions/demographicssummary/formatters/templates/interests","mustache!src/extensions/demographicssummary/formatters/templates/singleDemographic"],function(_,permissions,currentDashboard,professionTemplate,interestsTemplate,singleDemographicTemplate){"use strict";function canUserEditMentions(){return permissions.check("edit.mentions",currentDashboard)}function isShowningDemographicsData(row,column){var isEditablePageType,isLegalEdit,isOrganisational,field;isEditablePageType=row.pageType==="twitter"||row.pageType===undefined;if(!isEditablePageType){return false}isOrganisational=row.accountType&&row.accountType.toLowerCase()==="organisational";field=column.field.toLowerCase();isLegalEdit=!isOrganisational&&field==="gender"||!isOrganisational&&field==="professions"||!isOrganisational&&field==="interest"||field==="accounttype";return isLegalEdit}function stringifyJobTitles(jobTitles){var lastJobTitle;jobTitles=_(jobTitles).chain().without(null).map(function(jobTitle){return'"'+_.capitalize(jobTitle)+'"'}).value();if(jobTitles.length<3){return jobTitles.join(" and ")}lastJobTitle=jobTitles.pop();return jobTitles.join(", ")+", and "+lastJobTitle}function joinProfessions(professionJobTitleArray){var deduped={};if(!professionJobTitleArray){return[]}_(professionJobTitleArray).each(function(professionJobTitle){var profession=professionJobTitle.profession||"Unknown";if(!deduped[profession]){deduped[profession]=[]}deduped[profession].push(professionJobTitle.jobTitle)});return _(deduped).map(function(jobTitles,profession){return{profession:_.capitalize(profession),jobTitles:stringifyJobTitles(jobTitles)}})}function formatProfessionsForTemplate(professionJobTitleArray,options){var opts=options||{},hasProfessionData=professionJobTitleArray&&professionJobTitleArray.length>0,data={isEditable:opts.isEditable,isShowningDemographicsData:opts.isShowningDemographicsData,dataAttributes:opts.dataAttributes,professions:hasProfessionData?joinProfessions(professionJobTitleArray):undefined};return professionTemplate(data,false)}return{joinProfessions:joinProfessions,formatGender:function formatGender(gender,column,row){var data={isShowningDemographicsData:isShowningDemographicsData(row,column),isEditable:canUserEditMentions(),value:_.capitalize(gender||"Unknown")};return singleDemographicTemplate(data,false)},formatAccountType:function formatAccountType(accountType,column,row){var data={isShowningDemographicsData:isShowningDemographicsData(row,column),isEditable:canUserEditMentions(),value:_.capitalize(accountType||"Unknown")};return singleDemographicTemplate(data,false)},formatProfessions:function formatProfessions(professions,column,row){var professionJobTitleArray=row[column.field],options={isShowningDemographicsData:isShowningDemographicsData(row,column),isEditable:canUserEditMentions()};return formatProfessionsForTemplate(professionJobTitleArray,options)},formatInterests:function formatInterests(interests,column,row){var interestsArray=row[column.field],data={isEditable:canUserEditMentions(),isShowningDemographicsData:isShowningDemographicsData(row,column),interests:_(interestsArray).map(function(interest){return{interest:_.capitalize(interest)}})};return interestsTemplate(data,false)}}});define("src/components/mentions/_table/columns/twitter/sharedTwitterHelper",["jquery","underscore","src/packages/spin"],function($,_,spin){"use strict";function spinTd($anchorInTd){var $td=$anchorInTd.closest("td");$td.children().each(function(){$(this).hide();$td.append($('<span class="js-disabled lightgrey nowrap db">').text($(this).text().trim()))});return $td.spin(_.extend({left:$td.width()+8,top:0},spin.defaults))}function stopSpinningTd($anchorInTd){var $td=$anchorInTd.closest("td");$td.find(".js-disabled").remove();$td.children().each(function(){$(this).show()});$td.spin(false)}function updateMentionDemographics(mention,data){if(!mention||!data){return}mention.set({gender:data.gender,accountType:data.accountType,professions:data.professions,interest:data.interests})}return{spinTd:spinTd,stopSpinningTd:stopSpinningTd,updateMentionDemographics:updateMentionDemographics}});define("src/components/mentions/_table/columns/twitter/AccountTypeColumn",["jquery","underscore","src/analytics/Analytics","src/globals/demographicsUpdates","src/views/GenderAccountTypeContextMenuView","src/extensions/demographicssummary/formatters/demographicsFormatters","src/components/mentions/_table/columns/twitter/sharedTwitterHelper"],function($,_,Analytics,demographicsUpdates,GenderAccountTypeContextMenuView,demographicsFormatters,helper){"use strict";function getEvents(table){return{"click td.accountType a":function clickTdAccountTypeA(e){onClickAccountType(e,table)}}}function onClickAccountType(e,table){var mention,contextMenu;e.preventDefault();mention=table.collection.get($(e.target).closest("tr").data("id"));contextMenu=GenderAccountTypeContextMenuView.show({$target:$(e.target),accountType:mention.get("accountType"),analyticsCategory:"Component.Mentions"});if(!contextMenu){return}table.listenTo(contextMenu,"uiChangeAccountTypeAction",function(accountType){table.stopListening(contextMenu);updateAccountType(e.currentTarget,mention,accountType)})}function updateAccountType(currentTarget,mention,accountType){helper.spinTd($(currentTarget));demographicsUpdates.updateAccountType({username:mention.get("author"),accountType:accountType,resourceId:mention.get("resourceId"),queryId:mention.get("queryId"),date:mention.get("date"),success:_.partial(helper.updateMentionDemographics,mention),error:_.partial(helper.stopSpinningTd,$(currentTarget))});Analytics.trackEvent({name:"Component.Mentions",action:"Update_AccountType_"+_.capitalize(mention.get("accountType")||"unknown")+"_"+_.capitalize(accountType),origin:"Application"})}function getColumn(){return{name:"Account Type",field:"accountType",id:"accountType",groupName:"Twitter",sortable:true,formatter:demographicsFormatters.formatAccountType}}return{getEvents:getEvents,getColumn:getColumn}});define("src/components/mentions/_table/columns/twitter/GenderColumn",["jquery","underscore","src/extensions/demographicssummary/formatters/demographicsFormatters","src/views/GenderAccountTypeContextMenuView","src/globals/demographicsUpdates","src/components/mentions/_table/columns/twitter/sharedTwitterHelper","src/analytics/Analytics"],function($,_,demographicsFormatters,GenderAccountTypeContextMenuView,demographicsUpdates,helper,Analytics){"use strict";function getEvents(table){return{"click td.gender a":function clickTdGenderA(e){onClickGender(e,table)}}}function onClickGender(e,table){var mention,contextMenu;e.preventDefault();mention=table.collection.get($(e.target).closest("tr").data("id"));contextMenu=GenderAccountTypeContextMenuView.show({$target:$(e.target),gender:mention.get("gender"),analyticsCategory:"Component.Mentions"});if(!contextMenu){return}table.listenTo(contextMenu,"uiChangeGenderAction",function(gender){table.stopListening(contextMenu);updateGender(e.currentTarget,mention,gender)})}function updateGender(currentTarget,mention,gender){helper.spinTd($(currentTarget));demographicsUpdates.updateGender({username:mention.get("author"),gender:gender,resourceId:mention.get("resourceId"),queryId:mention.get("queryId"),date:mention.get("date"),success:_.partial(helper.updateMentionDemographics,mention),error:_.partial(helper.stopSpinningTd,$(currentTarget))});Analytics.trackEvent({name:"Component.Mentions",action:"Update_Gender_"+_.capitalize(mention.get("gender")||"unknown")+"_"+_.capitalize(gender),origin:"Application"})}function getColumn(){return{name:"Gender",field:"gender",id:"gender",groupName:"Twitter",sortable:true,formatter:demographicsFormatters.formatGender,updateFields:["accountType"]}}return{getEvents:getEvents,getColumn:getColumn}});define("mustache!templates/professionInterestContextMenu",["lib/mustache"],function(mustache){var escapedTemplate='<p class="js-author-name smallpadding-vertical singlepadding-horizontal">Edit {{modeText}} for {{username}}</p>\n<select multiple>\n{{#selectValues}}\n<option value="{{name}}" {{selected}}>{{name}}</option>\n{{/selectValues}}\n</select>\n\n<p class="singlepadding">\nIt may take a few minutes before your dashboard is fully updated.\n</p>\n\n<footer class="singlemargin-bottom">\n<button class="js-update js-update-{{modeText}} defaultbutton singlemargin-left">\nUpdate {{modeText}}\n</button>\n<button class="js-close button smallmargin-left">Cancel</button>\n</footer>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("text!templates/sellecktProfessionInterestEdit.template",[],function(){return'<li class="selectionItem rounded relative js-profession-interest-item" data-value="{{value}}">\n    <div class="relative smallpadding-left doublepadding-right textellipsis ellipsistooltip customtip" title="{{text}}">\n        {{text}}<i class="icon-remove remove unselect iconsmaller grey absright hugeline smallmargin-right customtip" title="Deselect"></i>\n    </div>\n</li>\n'});define("css!css/professionInterestContextMenu.css",["css!css/compiled.css"],function(){});define("src/views/ProfessionInterestContextMenuView",["underscore","jquery","backbone","src/analytics/Analytics","src/globals/interests","src/globals/professions","mustache!templates/professionInterestContextMenu","text!templates/sellecktProfessionInterestEdit.template","src/views/ContextMenuView","src/packages/selleckt","src/packages/spin","jquery.showRelativeTo","css!css/professionInterestContextMenu.css","lib/jquery.notify"],function(_,$,Backbone,Analytics,interests,professions,renderContextMenu,sellecktTemplate,ContextMenuView){"use strict";function makeSelectValues(values,selectedValues){return values.map(function(value){var isSelected=selectedValues&&selectedValues.some(function(selectedValue){return selectedValue===value.name});return{name:value.name,selected:isSelected?"selected":null}}).sort(function(a,b){if(a.name<b.name){return-1}if(a.name>b.name){return 1}return 0})}function validate(options){if(!options){throw new TypeError("options is required")}if(!_.isString(options.username)||options.username===""){throw new TypeError("options.username (string) is required")}if(!_.isString(options.analyticsCategory)||options.analyticsCategory===""){throw new TypeError('options.analyticsCategory (string) is required, for example "Component.Mentions"')}if(!options.professions&&!options.interests){throw new TypeError("options.professions or options.interests is required")}if(options.professions){options.professions.forEach(function(profession){if(!_.isString(profession.profession)){throw new TypeError("professions must have a profession string")}})}}function handleInitialisationError(contextMenu){setTimeout(function(){contextMenu.remove()});$.notify({text:"Could not open the context menu. Please try again.",className:"notification-error"})}function renderProfessions(contextMenu,username,currentProfessions){var data={};professions.load(function(err,professions){if(err){handleInitialisationError(contextMenu);return}data.selectValues=makeSelectValues(professions.toJSON(),currentProfessions.map(function(currentProfession){return currentProfession.profession}));data.username=username;data.modeText="professions";contextMenu.$el.html(renderContextMenu(data));contextMenu.$el.find("select").selleckt({selectionTemplate:sellecktTemplate,placeholderText:"Add a profession",alternatePlaceholder:"Select another",enableSearch:true})})}function renderInterests(contextMenu,username,currentInterests){var data={};interests.load(function(err,interests){if(err){handleInitialisationError(contextMenu);return}data.selectValues=makeSelectValues(interests.toJSON(),currentInterests);data.username=username;data.modeText="interests";contextMenu.$el.html(renderContextMenu(data));contextMenu.$el.find("select").selleckt({selectionTemplate:sellecktTemplate,placeholderText:"Add an interest",alternatePlaceholder:"Select another",enableSearch:true})})}var ProfessionInterestContextMenuView=ContextMenuView.extend({tagName:"div",className:"professionInterestContextMenuView context-menu popupframe",events:function events(){return{"click .js-update-professions":function update(e){var professions;e.preventDefault();professions=this.$("select").val()||[];this.trigger("uiChangeProfessionsAction",professions);this.remove()},"click .js-update-interests":function update(e){var interests;e.preventDefault();interests=this.$("select").val()||[];this.trigger("uiChangeInterestsAction",interests);this.remove()},"click .js-close":function close(e){e.preventDefault();this.remove()},click:function stopPropagation(e){e.stopPropagation()}}},constructor:function ProfessionInterestContextMenuView(options){var opts=_.clone(options);Backbone.View.apply(this,arguments);this.isProfessionMenu=_(opts).keys().indexOf("professions")>-1;opts.professions=opts.professions||[];opts.interests=opts.interests||[];validate(opts);this.options=opts},render:function render(){if(this.isProfessionMenu){renderProfessions(this,this.options.username,this.options.professions);Analytics.trackEvent({name:this.options.analyticsCategory,action:"Show_Professions_Context_Menu",origin:"Application"})}else{renderInterests(this,this.options.username,this.options.interests);Analytics.trackEvent({name:this.options.analyticsCategory,action:"Show_Interests_Context_Menu",origin:"Application"})}}});return ProfessionInterestContextMenuView});define("src/components/mentions/_table/columns/twitter/ProfessionColumn",["jquery","underscore","src/analytics/Analytics","src/globals/demographicsUpdates","src/views/ProfessionInterestContextMenuView","src/components/mentions/_table/columns/twitter/sharedTwitterHelper","src/extensions/demographicssummary/formatters/demographicsFormatters"],function($,_,Analytics,demographicsUpdates,ProfessionInterestContextMenuView,helper,demographicsFormatters){"use strict";function getEvents(table){return{"click td.professions a":function clickTdProfessionsA(e){showProfessionContextMenu(e,table)}}}function showProfessionContextMenu(e,table){var mention,contextMenu;e.preventDefault();mention=table.collection.get($(e.target).closest("tr").data("id"));contextMenu=ProfessionInterestContextMenuView.show({$target:$(e.target),username:mention.get("author"),mentionId:mention.get("resourceId"),queryId:mention.get("queryId"),professions:mention.get("professions"),analyticsCategory:"Component.Mentions"});if(!contextMenu){return}table.listenTo(contextMenu,"uiChangeProfessionsAction",function(updatedProfessions){table.stopListening(contextMenu);updateProfessions(e.currentTarget,mention,updatedProfessions)})}function updateProfessions(currentTarget,mention,updatedProfessions){helper.spinTd($(currentTarget));demographicsUpdates.updateProfessions({username:mention.get("author"),professions:updatedProfessions,resourceId:mention.get("resourceId"),queryId:mention.get("queryId"),date:mention.get("date"),success:_.partial(helper.updateMentionDemographics,mention),error:_.partial(helper.stopSpinningTd,$(currentTarget))});Analytics.trackEvent({name:"Component.Mentions",action:"Update_Professions",origin:"Application"})}function getColumn(){return{name:"Profession",field:"professions",id:"professions",groupName:"Twitter",disabled:true,formatter:demographicsFormatters.formatProfessions,updateFields:["accountType"]}}return{getEvents:getEvents,getColumn:getColumn}});define("src/components/mentions/_table/columns/twitter/InterestColumn",["jquery","underscore","src/analytics/Analytics","src/globals/demographicsUpdates","src/views/ProfessionInterestContextMenuView","src/components/mentions/_table/columns/twitter/sharedTwitterHelper","src/extensions/demographicssummary/formatters/demographicsFormatters"],function($,_,Analytics,demographicsUpdates,ProfessionInterestContextMenuView,helper,demographicsFormatters){"use strict";function getEvents(table){return{"click td.interest a":function clickTdInterestA(e){showInterestContextMenu(e,table)}}}function showInterestContextMenu(e,table){var mention,contextMenu;e.preventDefault();mention=table.collection.get($(e.target).closest("tr").data("id"));contextMenu=ProfessionInterestContextMenuView.show({$target:$(e.target),username:mention.get("author"),mentionId:mention.get("resourceId"),queryId:mention.get("queryId"),interests:mention.get("interest"),analyticsCategory:"Component.Mentions"});if(!contextMenu){return}table.listenTo(contextMenu,"uiChangeInterestsAction",function(updatedInterests){table.stopListening(contextMenu);updateInterests(e.currentTarget,mention,updatedInterests)})}function updateInterests(currentTarget,mention,updatedInterests){helper.spinTd($(currentTarget));demographicsUpdates.updateInterests({username:mention.get("author"),interests:updatedInterests,resourceId:mention.get("resourceId"),queryId:mention.get("queryId"),date:mention.get("date"),success:_.partial(helper.updateMentionDemographics,mention),error:_.partial(helper.stopSpinningTd,$(currentTarget))});Analytics.trackEvent({name:"Component.Mentions",action:"Update_Interests",origin:"Application"})}function getColumn(){return{name:"Interest",field:"interest",id:"interest",groupName:"Twitter",disabled:true,formatter:demographicsFormatters.formatInterests,updateFields:["accountType"]}}return{getEvents:getEvents,getColumn:getColumn}});define("src/components/mentions/_table/columns/twitter/AuthorCityColumn",[],function(){"use strict";function getColumn(){return{name:"Author City",field:"authorCity",id:"authorCity",groupName:"Twitter",disabled:true,defaultText:"-"}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/twitter/AuthorCountyColumn",[],function(){"use strict";function getColumn(){return{name:"Author County",field:"authorCounty",id:"authorCounty",groupName:"Twitter",disabled:true,defaultText:"-"}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/twitter/AuthorStateColumn",[],function(){"use strict";function getColumn(){return{name:"Author State",field:"authorState",id:"authorState",groupName:"Twitter",disabled:true,defaultText:"-"}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/twitter/AuthorCountryColumn",[],function(){"use strict";function getColumn(){return{name:"Author Country",field:"authorCountry",id:"authorCountry",groupName:"Twitter",disabled:true,defaultText:"-"}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/twitter/AuthorContinentColumn",[],function(){"use strict";function getColumn(){return{name:"Author Continent",field:"authorContinent",id:"authorContinent",groupName:"Twitter",disabled:true,defaultText:"-"}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/twitter/TwitterColumnGroup",["src/components/mentions/_table/columns/twitter/RetweetsColumn","src/components/mentions/_table/columns/twitter/ReachScoreColumn","src/components/mentions/_table/columns/twitter/TweetsColumn","src/components/mentions/_table/columns/twitter/TwitterReplyCountColumn","src/components/mentions/_table/columns/twitter/FollowersColumn","src/components/mentions/_table/columns/twitter/FollowingColumn","src/components/mentions/_table/columns/twitter/ImpressionsColumn","src/components/mentions/_table/columns/twitter/InfluenceColumn","src/components/mentions/_table/columns/twitter/OutreachColumn","src/components/mentions/_table/columns/twitter/UserRoleColumn","src/components/mentions/_table/columns/twitter/VerifiedColumn","src/components/mentions/_table/columns/twitter/AccountTypeColumn","src/components/mentions/_table/columns/twitter/GenderColumn","src/components/mentions/_table/columns/twitter/ProfessionColumn","src/components/mentions/_table/columns/twitter/InterestColumn","src/components/mentions/_table/columns/twitter/AuthorCityColumn","src/components/mentions/_table/columns/twitter/AuthorCountyColumn","src/components/mentions/_table/columns/twitter/AuthorStateColumn","src/components/mentions/_table/columns/twitter/AuthorCountryColumn","src/components/mentions/_table/columns/twitter/AuthorContinentColumn"],function(RetweetsColumn,ReachScoreColumn,TweetsColumn,TwitterReplyCountColumn,FollowersColumn,FollowingColumn,ImpressionsColumn,InfluenceColumn,OutreachColumn,UserRoleColumn,VerifiedColumn,AccountTypeColumn,GenderColumn,ProfessionColumn,InterestColumn,AuthorCityColumn,AuthorCountyColumn,AuthorStateColumn,AuthorCountryColumn,AuthorContinentColumn){"use strict";function getColumns(dashboardType){var columnToInsertAt;var columns=[RetweetsColumn,ReachScoreColumn,TweetsColumn,FollowingColumn,FollowersColumn,ImpressionsColumn,InfluenceColumn,OutreachColumn,UserRoleColumn,VerifiedColumn,AccountTypeColumn,GenderColumn,ProfessionColumn,InterestColumn,AuthorCityColumn,AuthorCountyColumn,AuthorStateColumn,AuthorCountryColumn,AuthorContinentColumn];if(dashboardType!=="twitter"){columnToInsertAt=RetweetsColumn}else{columnToInsertAt=InfluenceColumn}var indexToInsertAt=columns.indexOf(columnToInsertAt);columns.splice(indexToInsertAt+1,0,TwitterReplyCountColumn);return columns}return{className:"twitter-group",getColumns:getColumns}});define("src/components/mentions/_table/columns/facebook/CommentsColumn",[],function(){"use strict";function getColumn(){return{name:"Comments",field:"facebookComments",id:"facebookComments",className:"facebookComments textright",groupName:"Facebook",sortable:true,disabled:true,defaultText:"-"}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/facebook/LikesColumn",[],function(){"use strict";function getColumn(){return{name:"Likes",field:"facebookLikes",id:"facebookLikes",className:"facebookLikes textright",groupName:"Facebook",sortable:true,disabled:true,defaultText:"-"}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/facebook/MediaTypeColumn",["underscore"],function(_){"use strict";function getColumn(){return{name:"Media Type",field:"subtype",id:"facebookSubtype",groupName:"Facebook",sortable:true,disabled:true,defaultText:"-",formatter:function formatter(value){return _(value).titleize()}}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/facebook/MentionTypeColumn",["underscore"],function(_){"use strict";function getColumn(){return{name:"Mention Type",field:"resourceType",id:"resourceType",groupName:"Facebook",sortable:true,disabled:true,formatter:function formatter(value){value=_(value.split("-")).last();return _(value).titleize()},defaultText:"-"}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/facebook/SharesColumn",[],function(){"use strict";function getColumn(){return{name:"Shares",field:"facebookShares",id:"facebookShares",className:"facebookShares textright",groupName:"Facebook",sortable:true,disabled:true,defaultText:"-"}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/facebook/UserRoleColumn",[],function(){"use strict";function getColumn(){return{name:"User Role",field:"facebookRole",id:"facebookRole",groupName:"Facebook",sortable:true,disabled:true,defaultText:"-",formatter:function formatter(value){if(value==="audience"){value="Audience";return value}else if(value==="owner"){value="Page Owner";return value}}}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/facebook/FacebookColumnGroup",["src/components/mentions/_table/columns/facebook/CommentsColumn","src/components/mentions/_table/columns/facebook/LikesColumn","src/components/mentions/_table/columns/facebook/MediaTypeColumn","src/components/mentions/_table/columns/facebook/MentionTypeColumn","src/components/mentions/_table/columns/facebook/SharesColumn","src/components/mentions/_table/columns/facebook/UserRoleColumn"],function(CommentsColumn,LikesColumn,MediaTypeColumn,MentionTypeColumn,SharesColumn,UserRoleColumn){"use strict";function getColumns(){return[MentionTypeColumn,MediaTypeColumn,UserRoleColumn,LikesColumn,CommentsColumn,SharesColumn]}return{className:"facebook-group",getColumns:getColumns}});define("src/components/mentions/_table/columns/instagram/MediaTypeColumn",["underscore"],function(_){"use strict";function getColumn(){return{name:"Media Type",field:"subtype",id:"instagramSubtype",groupName:"Instagram",sortable:true,disabled:true,defaultText:"-",formatter:function formatter(value){return _.titleize(value)}}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/instagram/InteractionsColumn",["src/instagramchannel/formatters/instagramTableFormatters"],function(instagramTableFormatters){"use strict";function getColumn(){var columnId="instagramInteractions";return{name:"Total Interactions",field:"instagramInteractionsCount",id:columnId,className:columnId+" textright",groupName:"Instagram",sortable:true,disabled:true,defaultText:"-",formatter:instagramTableFormatters.formatTotalInteractions}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/instagram/LikesColumn",[],function(){"use strict";function getColumn(){var columnId="instagramLikes";return{name:"Likes",field:"instagramLikeCount",id:columnId,className:columnId+" textright",groupName:"Instagram",sortable:true,disabled:true,defaultText:"-"}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/instagram/CommentsColumn",[],function(){"use strict";function getColumn(){var columnId="instagramComments";return{name:"Comments",field:"instagramCommentCount",id:columnId,className:columnId+" textright",groupName:"Instagram",sortable:true,disabled:true,defaultText:"-"}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/instagram/FollowingColumn",[],function(){"use strict";function getColumn(){var columnId="instagramFollowing";return{name:"Following",field:"instagramFollowingCount",id:columnId,className:columnId+" textright",groupName:"Instagram",sortable:true,disabled:true,defaultText:"-"}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/instagram/FollowersColumn",[],function(){"use strict";function getColumn(){var columnId="instagramFollowers";return{name:"Followers",field:"instagramFollowerCount",id:columnId,className:columnId+" textright",groupName:"Instagram",sortable:true,disabled:true,defaultText:"-"}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/instagram/PostsColumn",[],function(){"use strict";function getColumn(){var columnId="instagramPosts";return{name:"Posts",field:"instagramPostCount",id:columnId,className:columnId+" textright",groupName:"Instagram",sortable:true,disabled:true,defaultText:"-"}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/instagram/InstagramColumnGroup",["src/components/mentions/_table/columns/instagram/MediaTypeColumn","src/components/mentions/_table/columns/instagram/InteractionsColumn","src/components/mentions/_table/columns/instagram/LikesColumn","src/components/mentions/_table/columns/instagram/CommentsColumn","src/components/mentions/_table/columns/instagram/FollowingColumn","src/components/mentions/_table/columns/instagram/FollowersColumn","src/components/mentions/_table/columns/instagram/PostsColumn"],function(MediaTypeColumn,InteractionsColumn,LikesColumn,CommentsColumn,FollowingColumn,FollowersColumn,PostsColumn){"use strict";function getColumns(){return[MediaTypeColumn,InteractionsColumn,LikesColumn,CommentsColumn,FollowingColumn,FollowersColumn,PostsColumn]}return{className:"instagram-group",getColumns:getColumns}});define("src/components/mentions/_table/columns/site/SiteColumn",["jquery","bw-fe-helpers/faviconHelper","src/components/mentions/views/SiteContextMenu"],function($,faviconHelper,SiteContextMenu){"use strict";function getEvents(table){return{"click td.title .site":function clickTdTitleSite(e){onClickSite(e,table)}}}function getColumn(){return{name:"Site",field:"domain",id:"favicon",groupName:"Source",disabled:true,formatter:favIconFormatter}}function favIconFormatter(value){var url=faviconHelper.getFaviconUrl(value);return'<img src="'+url+'" alt="Icon for '+value+'" height=16 width=16 />'}function onClickSite(e,table){e.preventDefault();e.stopPropagation();var $target=$(e.target),mentionId=$target.closest("tr").data("id"),mention=table.collection.get(mentionId)||{},mentionUrl=mention.get("url"),mentionTitle=mention.get("title");showSiteMenu(table,$target.data("domain"),$target,mentionUrl,mentionTitle,$target.attr("data-publication"))}function showSiteMenu(table,domain,$target,mentionUrl,mentionTitle,publicationName){table.contextMenu=SiteContextMenu.show({domain:domain,mentionUrl:mentionUrl,mentionTitle:mentionTitle,$target:$target,settings:table.settings,publicationName:publicationName})}return{getEvents:getEvents,getColumn:getColumn}});define("src/components/mentions/_table/columns/site/SiteNameColumn",[],function(){"use strict";function getColumn(){return{name:"Source",field:"domain",id:"domain",groupName:"Source",disabled:true,formatter:function formatter(value,spec,row){return row.isOfflinePublication?row.publicationName:row.domain}}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/site/MozRankColumn",["underscore"],function(_){"use strict";function floatFormatter(value){value=parseFloat(value);if(!value||!_.isNumber(value)||value==="-"){return"-"}return Math.round(value*100)/100}function getColumn(){return{name:"mozRank",field:"mozRank",id:"mozRank",groupName:"Source",sortable:true,disabled:true,formatter:floatFormatter,defaultText:"-"}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/site/BacklinksColumn",[],function(){"use strict";function getColumn(){return{name:"Backlinks",field:"backlinks",id:"backlinks",groupName:"Source",sortable:true,disabled:true,defaultText:"-"}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/site/SiteColumnGroup",["src/components/mentions/_table/columns/site/SiteColumn","src/components/mentions/_table/columns/site/SiteNameColumn","src/components/mentions/_table/columns/site/MozRankColumn","src/components/mentions/_table/columns/site/BacklinksColumn"],function(SiteColumn,SiteNameColumn,MozRankColumn,BacklinksColumn){"use strict";function getColumns(){return[SiteColumn,SiteNameColumn,MozRankColumn,BacklinksColumn]}return{className:"twitter-group",getColumns:getColumns}});define("src/components/mentions/_table/columns/location/LocationCityColumn",[],function(){"use strict";function getColumn(){return{name:"City",field:"city",id:"city",groupName:"Location",disabled:true}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/location/LocationCountyColumn",[],function(){"use strict";function getColumn(){return{name:"County",field:"county",id:"county",groupName:"Location",disabled:true}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/location/LocationStateColumn",[],function(){"use strict";function getColumn(){return{name:"State",field:"state",id:"state",groupName:"Location",disabled:true}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/location/LocationRegionColumn",[],function(){"use strict";function getColumn(){return{name:"Region",field:"region",id:"region",groupName:"Location",disabled:true}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/location/LocationCountryColumn",[],function(){"use strict";function getColumn(){return{name:"Country",field:"country",id:"country",groupName:"Location"}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/location/LocationContinentColumn",[],function(){"use strict";function getColumn(){return{name:"Continent",field:"continent",id:"continent",groupName:"Location",disabled:true}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/location/LocationColumnGroup",["src/globals/crimsonMode","src/components/mentions/_table/columns/location/LocationCityColumn","src/components/mentions/_table/columns/location/LocationCountyColumn","src/components/mentions/_table/columns/location/LocationStateColumn","src/components/mentions/_table/columns/location/LocationRegionColumn","src/components/mentions/_table/columns/location/LocationCountryColumn","src/components/mentions/_table/columns/location/LocationContinentColumn"],function(crimsonMode,LocationCityColumn,LocationCountyColumn,LocationStateColumn,LocationRegionColumn,LocationCountryColumn,LocationContinentColumn){"use strict";function getColumns(){if(crimsonMode.enabled()){return[LocationCityColumn,LocationRegionColumn,LocationCountryColumn,LocationContinentColumn]}return[LocationCityColumn,LocationCountyColumn,LocationStateColumn,LocationCountryColumn,LocationContinentColumn]}return{className:"location-group",getColumns:getColumns}});define("src/components/mentions/_table/columns/sitevisitors/VisitorsMonthColumn",[],function(){"use strict";function getColumn(){return{name:"Visitors/month",field:"monthlyVisitors",id:"monthlyVisitors",groupName:"Site Visitors",sortable:true,disabled:true,defaultText:"-"}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/sitevisitors/AvgVisitsColumn",[],function(){"use strict";function getColumn(){return{name:"Avg. Visits",field:"averageVisits",id:"averageVisits",groupName:"Site Visitors",sortable:true,disabled:true,defaultText:"-"}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/sitevisitors/AvgPagesColumn",[],function(){"use strict";function getColumn(){return{name:"Avg. Pages",field:"pagesPerVisit",id:"pagesPerVisit",groupName:"Site Visitors",sortable:true,disabled:true,defaultText:"-"}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/sitevisitors/AvgTimeColumn",[],function(){"use strict";function getColumn(){return{name:"Avg. Time (min)",field:"averageDurationOfVisit",id:"averageDurationOfVisit",groupName:"Site Visitors",sortable:true,disabled:true,defaultText:"-"}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/sitevisitors/MaleColumn",[],function(){"use strict";function getColumn(){return{name:"% Male",field:"percentMaleVisitors",id:"percentMaleVisitors",groupName:"Site Visitors",sortable:true,disabled:true,defaultText:"-"}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/sitevisitors/FemaleColumn",[],function(){"use strict";function getColumn(){return{name:"% Female",field:"percentFemaleVisitors",id:"percentFemaleVisitors",groupName:"Site Visitors",sortable:true,disabled:true,defaultText:"-"}}return{getColumn:getColumn}});define("src/components/mentions/_table/columns/sitevisitors/SiteVisitorsColumnGroup",["src/components/mentions/_table/columns/sitevisitors/VisitorsMonthColumn","src/components/mentions/_table/columns/sitevisitors/AvgVisitsColumn","src/components/mentions/_table/columns/sitevisitors/AvgPagesColumn","src/components/mentions/_table/columns/sitevisitors/AvgTimeColumn","src/components/mentions/_table/columns/sitevisitors/MaleColumn","src/components/mentions/_table/columns/sitevisitors/FemaleColumn"],function(VisitorsMonthColumn,AvgVisitsColumn,AvgPagesColumn,AvgTimeColumn,MaleColumn,FemaleColumn){"use strict";function getColumns(){return[VisitorsMonthColumn,AvgVisitsColumn,AvgPagesColumn,AvgTimeColumn,MaleColumn,FemaleColumn]}return{className:"workflow-group",getColumns:getColumns}});define("src/components/mentions/_table/columns/ShareColumn",["jquery","src/components/mentions/views/MentionShareMenu"],function($,MentionShareMenu){"use strict";function shareFormatter(logoImagesGroupId,value,spec){return spec.isOfflinePublication?"":'<a class="share">Share</a>'}function getEvents(table){return{"click td.share a.share":function clickTdShareAShare(e){onShowShareMenu(e,table)}}}function onShowShareMenu(e,table){e.preventDefault();e.stopPropagation();var id=$(e.target).closest("tr").data("id");if(table.shareMentionMenu){table.shareMentionMenu.remove()}table.shareMentionMenu=MentionShareMenu.show({target:$(e.target).closest("a"),mention:table.collection.get(id)})}function getColumn(){return{name:"Share",id:"share",title:"",groupName:"Share",formatter:shareFormatter}}return{getEvents:getEvents,getColumn:getColumn}});(function($,_){"use strict";var selectOptionTempl=_.template('<option value="<%-id%>"<%= selected ? " selected" : "" %>><%-text%></option>'),checkboxOptionTempl=_.template('<p title="<%- text%>"><input type=checkbox id="<%=uniqueId%>" value="<%-id%>"<%= selected ? " checked" : "" %>><label for="<%=uniqueId%>"><%-text%></label></p>');function buildSelecter(options,selected,multiple,defaultText){var $selecter=$(document.createElement("div")),optionTemplate=multiple?checkboxOptionTempl:selectOptionTempl,optionHtml=multiple?"":optionTemplate({text:defaultText,id:"",selected:false});selected=[].concat(selected);optionHtml+=_(options).reduce(function(memo,opt){memo+=optionTemplate({id:opt.value,uniqueId:_.uniqueId("selecterise-cb-"),selected:selected.indexOf(opt.value)>-1,text:opt.text});return memo},"");$selecter.html(multiple?optionHtml:"<select>"+optionHtml+"</select>");$selecter.addClass(multiple?"multiple":"single");return $selecter}function getSelectedValues($selecter,options,multiple){var selected;if(!multiple){selected=$selecter.find("select").val();return _(options).reduce(function(result,option){if(!result&&selected===option.value.toString()){return option}return result},null)}selected=$selecter.find("input:checked").map(function(){return this.value}).get();return _(options).reduce(function(result,option){if(selected.indexOf(option.value.toString())>-1){result.push(option)}return result},[])}$.fn.selecterise=function(options){if(!options||!options.options||!_.isArray(options.options)){throw new Error("options.options must be set to an array of value/text pairs")}var $el=$(this),multiple=!!options.multiple,defaultText=options.defaultText||"None",selected=options.selected,$selecter=buildSelecter(options.options,selected,multiple,defaultText);function setValue(e){var selected=getSelectedValues($selecter,options.options,multiple),selectedArray=[].concat(selected||[]);if(e&&$el.is(e.target)){e.stopPropagation();return}$el.text(_(selectedArray).pluck("text").join(", ")||defaultText);$selecter.before($el);$selecter.remove();$el.off("click",setValue);$("body").off("click.selecterise",setValue);if(options.callback){options.callback(selected)}}$selecter.addClass("selecterised");$el.after($selecter);$("body").on("click.selecterise",setValue);$selecter.on("click","*",function(e){e.stopPropagation()});if(multiple){$el.on("click.selecterise",setValue)}else{$selecter.find("select").one("change",setValue);$el.detach()}return{remove:function remove(){$selecter.before($el);$selecter.remove();$el.off("click",setValue);$("body").off("click.selecterise",setValue)},close:function close(){setValue()}}}})($,_);define("lib/jquery.selecterise",function(){});define("src/components/mentions/_table/columns/workflow/sharedWorkflowHelper",["underscore","src/globals/workflow","lib/jquery.selecterise"],function(_,globalWorkflow){"use strict";function doSelecterise(table,$a,items,attr,defaultText,multiple){var self=table,originalText=$a.text(),mentionId=$a.closest("tr").data("id"),mention=table.collection.get(mentionId),mentionCategories=_(mention.get("categories")).intersection(_(items).pluck("id"));if(["assignment","priority","status"].indexOf(attr)>-1){mentionCategories=[mention.get(attr)]}if(table.selecterised){table.selecterised.close();table.selecterised=null}if(table.selecterisedSyncing){return}table.selecterised=$a.selecterise({options:_(items).map(function(obj){return{value:obj.id,text:obj.name}}),selected:multiple?mentionCategories:mentionCategories[0],multiple:multiple,defaultText:defaultText,callback:function callback(selected){var attrs={},text=_([].concat(selected||[])).pluck("text").join(", ")||defaultText;if(text===originalText){return}attrs=self.setAttrs(attr,selected,multiple,mentionCategories,items);self.selecterised=null;self.saveMention(mention,attrs,originalText,$a)}})}function buildWorkflowSelecteriseItems(name,sortBy){return _(globalWorkflow.get(name).children).chain().sortBy(function(a){return sortBy&&a[sortBy].toLowerCase()}).map(function(a){return{id:a.name,name:a.name}}).value()}return{doSelecterise:doSelecterise,buildWorkflowSelecteriseItems:buildWorkflowSelecteriseItems}});define("src/components/mentions/_table/columns/workflow/AssignmentColumn",["jquery","underscore","src/components/mentions/_table/columns/workflow/sharedWorkflowHelper"],function($,_,helper){"use strict";function assignmentFormatter(value,spec,row){var text="None",className="";if(row.assignment){text=row.assignment}if(row.pendingAttributes&&(row.pendingAttributes.assignment||row.pendingAttributes.removeAssignment)){className="waiting"}return'<a class="'+className+'">'+_.escape(text)+"</a>"}function getEvents(table){return{"click td.assignment a":function clickTdAssignmentA(e){onClickAssignee(e,table)}}}function onClickAssignee(e,table){e.preventDefault();e.stopPropagation();helper.doSelecterise(table,$(e.target),helper.buildWorkflowSelecteriseItems("assignment","name"),"assignment","None")}function getColumn(){return{name:"Assignment",field:"assignment",id:"assignment",groupName:"Workflow",sortable:true,disabled:true,formatter:assignmentFormatter}}return{getEvents:getEvents,getColumn:getColumn}});define("src/components/mentions/_table/columns/workflow/CheckedColumn",["jquery","underscore","src/ApiError"],function($,_,ApiError){"use strict";function checkedFormatter(value,spec,row){var checked=row.checked===true,id=_.uniqueId("mention-checked-"),className="";if(row.pendingAttributes&&(row.pendingAttributes.checked||row.pendingAttributes.checked===false)){className="waiting"}return'<input type=checkbox value="'+row.id+'"'+(checked?" checked":"")+' id="'+id+'" /><label for="'+id+'" class="'+className+'">Yes</label>'}function getEvents(table){return{"change td.checked input":function changeTdCheckedInput(e){onChangeChecked(e,table)}}}function onChangeChecked(e,table){var $checkbox=$(e.target),$label=$checkbox.next("label"),mentionId=$checkbox.attr("value"),mention=table.collection.get(mentionId);function done(err){$label.removeClass("error").attr("title","");if(err){$label.addClass("error").attr("title","An error occurred, please try again later");$checkbox.prop("checked",!$checkbox.prop("checked"))}}mention.save({checked:$checkbox.is(":checked")},{patch:true,success:function success(){done()},error:function error(model,xhr){done(new ApiError(xhr))}})}function getColumn(){return{name:"Checked",field:"checked",id:"checked",groupName:"Workflow",sortable:true,disabled:true,formatter:checkedFormatter}}return{getEvents:getEvents,getColumn:getColumn}});define("src/components/mentions/_table/columns/workflow/PriorityColumn",["jquery","underscore","src/components/mentions/_table/columns/workflow/sharedWorkflowHelper"],function($,_,helper){"use strict";function priorityFormatter(value,spec,row){var text="n/a",className="";if(row.priority){text=row.priority}if(row.pendingAttributes&&(row.pendingAttributes.priority||row.pendingAttributes.removePriority)){className="waiting"}return'<a class="'+className+'">'+_.escape(text)+"</a>"}function getEvents(table){return{"click td.priority a":function clickTdPriorityA(e){onClickPriority(e,table)}}}function onClickPriority(e,table){e.preventDefault();e.stopPropagation();helper.doSelecterise(table,$(e.target),helper.buildWorkflowSelecteriseItems("priority"),"priority","n/a")}function getColumn(){return{name:"Priority",field:"priority",id:"priority",groupName:"Workflow",sortable:true,disabled:true,formatter:priorityFormatter}}return{getEvents:getEvents,getColumn:getColumn}});define("src/components/mentions/_table/columns/workflow/StatusColumn",["jquery","underscore","src/components/mentions/_table/columns/workflow/sharedWorkflowHelper"],function($,_,helper){"use strict";function statusFormatter(value,spec,row){var text="n/a",className="";if(row.status){text=row.status}if(row.pendingAttributes&&(row.pendingAttributes.status||row.pendingAttributes.removeStatus)){className="waiting"}return'<a class="'+className+'">'+_.escape(text)+"</a>"}function getEvents(table){return{"click td.status a":function clickTdStatusA(e){onClickStatus(e,table)}}}function onClickStatus(e,table){e.preventDefault();e.stopPropagation();helper.doSelecterise(table,$(e.target),helper.buildWorkflowSelecteriseItems("status"),"status","n/a")}function getColumn(){return{name:"Status",field:"status",id:"status",groupName:"Workflow",sortable:true,disabled:true,formatter:statusFormatter}}return{getEvents:getEvents,getColumn:getColumn}});define("src/components/mentions/_table/columns/workflow/TagsColumn",["jquery","underscore","src/ApiError","src/globals/tags","src/components/mentions/views/TagsInputView"],function($,_,ApiError,globalTags,TagsInputView){"use strict";function tagsFormatter(value,spec,row){var tags=[].concat(row[spec.field]||[]);var tagsString=_(tags).chain().unique().sort().map(TagsInputView.renderTag).value().join("\n");return'\n            <div>\n                <ul class="rendered-bycolumn tagsList field" data-id="'.concat(row.id,'">\n                    ').concat(tagsString,"\n                    ").concat(TagsInputView.renderTagInput(),"\n                </ul>\n            </div>\n        ")}function getEvents(table){return{"click td.tags li a.remove":function clickTdTagsLiARemove(e){onRemoveTag(e,table)},"focusin td.tags input":function focusinTdTagsInput(e){onFocusInTagInput(e,table)},"click td.tags .tagsList":function clickTdTagsTagsList(e){onFocusInTagInput(e,table)}}}function onRemoveTag(e,table){e.preventDefault();e.stopPropagation();var $tag=$(e.target).parent(),id=$tag.closest("ul.tagsList").data("id");if(!table.tagsInputs[id]){var tagInput=initTagInput(table,id,$tag.closest("td"));tagInput.onRemoveTag(e)}}function onFocusInTagInput(e,table){var id;var tagInput;var $input=$("input",e.target);if(!$input.length){$input=$(e.target)}id=$input.closest("tr").data("id");tagInput=initTagInput(table,id,$input.closest("td"));tagInput.onComponentClick()}function initTagInput(table,id,$td){var mention=table.collection.get(id);if(!table.tagsInputs[id]){table.tagsInputs[id]=new TagsInputView({tagCollection:globalTags,el:$td.children()[0],canUseBackspace:false,autocompleteMatchIfContains:true,onAdd:function onAdd(tagName,done){globalTags.ensureTagExists(tagName,{success:function success(){mention.save({addTag:[tagName]},{patch:true,success:function success(){done()},error:function error(model,xhr){var err=new ApiError(xhr);done(err)}})},error:function error(model,xhr){var err=new ApiError(xhr);done(err)}})},onRemove:function onRemove(tagName,done){mention.save({removeTag:[tagName]},{patch:true,success:function success(){done()},error:function error(model,xhr){done(new ApiError(xhr))}})}})}bindKeydownEvent($td);return table.tagsInputs[id]}function bindKeydownEvent($td){$td.on("keydown","input",function(e){var target=$(e.target);if(e.which===9){e.preventDefault();e.stopPropagation();target.trigger("focusout");if(e.shiftKey){$td.closest("tr").prev().find("td.tags input").trigger("focusin")}else{$td.closest("tr").next().find("td.tags input").trigger("focusin")}}})}function getColumn(){return{name:"Tags",field:"tags",id:"tags",groupName:"Workflow",disabled:true,formatter:tagsFormatter}}return{getEvents:getEvents,getColumn:getColumn}});define("src/components/mentions/_table/columns/workflow/NotesColumn",["jquery","src/components/notes/views/NotesView"],function($,NotesView){"use strict";function notesFormatter(value){return"<a class="+(value&&value.length?"active":"")+">read notes</a>"}function getEvents(table){return{"click td.notes a":function clickTdNotesA(e){onClickNote(e,table)}}}function onClickNote(e,table){var mention=table.collection.get($(e.target).closest("tr").data("id"));e.preventDefault();e.stopPropagation();if(table.notesView){table.notesView.remove()}table.notesView=NotesView.show(mention)}function getColumn(){return{name:"Notes",id:"notes",field:"noteIds",groupName:"Workflow",disabled:true,formatter:notesFormatter}}return{getEvents:getEvents,getColumn:getColumn}});define("src/components/mentions/_table/columns/workflow/WorkflowColumnGroup",["src/components/mentions/_table/columns/workflow/AssignmentColumn","src/components/mentions/_table/columns/workflow/CheckedColumn","src/components/mentions/_table/columns/workflow/PriorityColumn","src/components/mentions/_table/columns/workflow/StatusColumn","src/components/mentions/_table/columns/workflow/TagsColumn","src/components/mentions/_table/columns/workflow/NotesColumn"],function(AssignmentColumn,CheckedColumn,PriorityColumn,StatusColumn,TagsColumn,NotesColumn){"use strict";function getColumns(){return[AssignmentColumn,CheckedColumn,PriorityColumn,StatusColumn,TagsColumn,NotesColumn]}return{className:"workflow-group",getColumns:getColumns}});define("mustache!src/components/mentions/_table/templates/category",["lib/mustache"],function(mustache){var escapedTemplate='<div>\n<a data-values="{{values}}" data-catname="{{name}}" title="{{title}}" class="{{className}}">{{text}}</a>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/components/mentions/_table/templates/categoryCheckbox",["lib/mustache"],function(mustache){var escapedTemplate='<div>\n<input type=checkbox data-catid="{{catId}}" value="{{rowId}}" {{checked}} id="{{id}}"/>\n<label for="{{id}}" title="{{catName}}" class="{{className}}">{{catName}}</label>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/components/mentions/_table/columns/CategoriesColumn",["jquery","underscore","src/permissions","src/globals/categories","src/globals/currentDashboard","src/components/mentions/_table/columns/workflow/sharedWorkflowHelper","mustache!src/components/mentions/_table/templates/category","mustache!src/components/mentions/_table/templates/categoryCheckbox"],function($,_,permissions,categories,currentDashboard,SharedWorkflowHelper,categoryTemplate,categoryCheckboxTemplate){"use strict";function getEvents(table){return{"click td.category a":function clickTdCategoryA(e){onClickCategory(e,table)},"change td.category > div > input":function changeTdCategoryDivInput(e){onChangeCheckedCategory(e,table)}}}function onClickCategory(e,table){e.preventDefault();e.stopPropagation();var categoryName=$(e.target).data("catname").toString(),category=categories.getByName(categoryName),children=_(category.get("children")).sortBy(function(obj){return obj.order});SharedWorkflowHelper.doSelecterise(table,$(e.target),children,"category","n/a",category.get("multiple"))}function onChangeCheckedCategory(e,table){var $checkbox=$(e.target),$label=$checkbox.next("label"),categoryId=$checkbox.data("catid"),checked=$checkbox.prop("checked"),mentionId=$checkbox.attr("value"),mention=table.collection.get(mentionId),attrs={};if(checked){attrs.addCategories=[categoryId]}else{attrs.removeCategories=[categoryId]}mention.save(attrs,{patch:true,success:function success(){$label.removeClass("error").attr("title","")},error:function error(){$label.removeClass("error").attr("title","");$label.addClass("error").attr("title","An error occurred, please try again later");$checkbox.prop("checked",!$checkbox.prop("checked"))}})}function updateCategorySpecs(mentionsTableView){var table=mentionsTableView.table;if(!permissions.check("edit.mentions",currentDashboard)){return}setupCategoryColumnSpec(mentionsTableView);table.spec.forEach(function(spec){if(spec.id.indexOf("category/")!==0){return}if(categories.getByName(spec.name)){spec.formatter=createCategoryFormatter(spec.name);return}table.removeFromSpec(spec.id)})}function setupCategoryColumnSpec(mentionsTableView){var table=mentionsTableView.table,visibleColumns=mentionsTableView.settings.get("visibleColumns")||[];categories.chain().sortBy(function(cat){return cat.get("name").toLowerCase()}).each(function(cat){var name=cat.get("name"),id="category/"+cat.id,field=table.getField(id);if(field){table.removeFromSpec(id)}table.addToSpec({id:id,name:name,field:id,className:"category",groupName:"Categories",sortable:false,formatter:createCategoryFormatter(name),updateFields:["categories"],disabled:true});field=table.getField(id);field.disabled=visibleColumns.indexOf(id)===-1})}function createCategoryFormatter(name){var category=categories.getByName(name),children=_.clone(category.get("children")||[]);if(children.length===1){return buildCheckbox(children,category)}return function(value,spec,row){var text=[],className="";if(weHavePendingCategories(row,children,category)){className="waiting"}if(row.categories){text=setCategoryText(children,row)}return categoryTemplate({values:JSON.stringify(text),name:name,title:text.join(", "),className:className,text:text.join(", ")||"n/a"})}}function buildCheckbox(children,category){return function(value,spec,row){var id=_.uniqueId("category-checkbox-"+name),catId=children[0].id,catName=children[0].name,checked=row.categories&&row.categories.indexOf(children[0].id)>-1,className="";if(weHavePendingCategories(row,children,category)){className="waiting"}return categoryCheckboxTemplate({catId:_.escape(catId),rowId:row.id,checked:checked?" checked":"",id:id,catName:_.escape(catName),className:className})}}function setCategoryText(children,row){return _(children).chain().filter(function(child){return row.categories.indexOf(child.id)>-1}).map(function(child){return child.name}).value()}function weHavePendingCategories(row,children,category){var pendingCategories;if(row.pendingAttributes){pendingCategories=(row.pendingAttributes.categories||[]).concat(row.pendingAttributes.addCategories||[]).concat(row.pendingAttributes.removeCategories||[])}if(pendingCategories&&pendingCategories.indexOf(category.id)>-1){return true}if(_(children).any(function(child){return pendingCategories&&pendingCategories.indexOf(child.id)>-1})){return true}return false}return{getEvents:getEvents,updateCategorySpecs:updateCategorySpecs}});define("src/components/mentions/_table/columns/ReachMetricColumn",[],function(){"use strict";function getColumn(){return{id:"reachEstimate",name:"Reach",title:"Total",groupName:"Reach",field:"reachEstimate",sortable:true,className:"reachCol textright",headerClassName:"textright onecolmin",defaultText:"n/a"}}return{getColumn:getColumn}});define("src/components/mentions/_table/MentionsTableColumns",["underscore","src/globals/flags","src/globals/flagNames","src/components/mentions/_table/columns/CheckAndStarColumn","src/components/mentions/_table/columns/TitleColumn","src/components/mentions/_table/columns/LogosColumn","src/components/mentions/_table/columns/QueryColumn","src/components/mentions/_table/columns/sentimentemotion/SentimentEmotionColumnGroup","src/components/mentions/_table/columns/page/PageColumnGroup","src/components/mentions/_table/columns/MentionTypeColumn","src/components/mentions/_table/columns/forumthread/ForumThreadColumnGroup","src/components/mentions/_table/columns/CommentsColumn","src/components/mentions/_table/columns/twitter/TwitterColumnGroup","src/components/mentions/_table/columns/facebook/FacebookColumnGroup","src/components/mentions/_table/columns/instagram/InstagramColumnGroup","src/components/mentions/_table/columns/site/SiteColumnGroup","src/components/mentions/_table/columns/location/LocationColumnGroup","src/components/mentions/_table/columns/sitevisitors/SiteVisitorsColumnGroup","src/components/mentions/_table/columns/ShareColumn","src/components/mentions/_table/columns/workflow/WorkflowColumnGroup","src/components/mentions/_table/columns/CategoriesColumn","src/components/mentions/_table/columns/ReachMetricColumn"],function(_,flags,FLAGS,CheckAndStarColumn,TitleColumn,LogosColumn,QueryColumn,SentimentEmotionColumnGroup,PageColumnGroup,MentionTypeColumn,ForumThreadColumnGroup,CommentsColumn,TwitterColumnGroup,FacebookColumnGroup,InstagramColumnGroup,SiteColumnGroup,LocationColumnGroup,SiteVisitorsColumnGroup,ShareColumn,WorkflowColumnGroup,CategoriesColumn,ReachMetricColumn){"use strict";var COLUMNS_ENABLED_FOR_DASHBOARD_TYPE={twitter:["CheckAndStar","Title","Logos","Author","Verified","Timestamp","Impact","Retweets","Impressions","Tweets","Following","Followers","User Role","Share"],publicfacebook:["CheckAndStar","Title","Logos","Found","Author","Sentiment"],instagram:["CheckAndStar","Title","Logos","Found","Author","Total Interactions"]};function setupColumns(options){var dashboardType=options.dashboardType,hasLogoQuery=options.hasLogoQuery,restrictMarkup=options.restrictMarkup;var columns=[CheckAndStarColumn,TitleColumn];if(restrictMarkup){return columns.concat([QueryColumn,PageColumnGroup.getColumns(),LocationColumnGroup.getColumns(),WorkflowColumnGroup.getColumns()])}if(hasLogoQuery){columns.push(LogosColumn)}var features=[];if(flags.variation(FLAGS.ENABLE_REACH_METRIC)){features.push(ReachMetricColumn)}return columns.concat([QueryColumn,SentimentEmotionColumnGroup.getColumns(),PageColumnGroup.getColumns(),MentionTypeColumn,ForumThreadColumnGroup.getColumns(),CommentsColumn,TwitterColumnGroup.getColumns(dashboardType),SiteColumnGroup.getColumns(),LocationColumnGroup.getColumns(),SiteVisitorsColumnGroup.getColumns(),ShareColumn,WorkflowColumnGroup.getColumns(),FacebookColumnGroup.getColumns(),InstagramColumnGroup.getColumns()].concat(features))}function getColumnEvents(table){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var flattenedColumns=_.flatten(setupColumns(options));var eventsObject={};flattenedColumns.forEach(function(column){if(column.getEvents instanceof Function){_.extend(eventsObject,column.getEvents(table))}});_.extend(eventsObject,CategoriesColumn.getEvents(table));return eventsObject}function callAllColumns(options){var logoImagesGroupId=options.logoImagesGroupId;var columns=_.flatten(setupColumns(options));return columns.map(function(column){return column.getColumn(logoImagesGroupId)})}function getDefaultColumns(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var dashboardType=options.dashboardType;var preconfiguredDashboardTypes=Object.keys(COLUMNS_ENABLED_FOR_DASHBOARD_TYPE);var hasDefaultColumns=_.contains(preconfiguredDashboardTypes,dashboardType);return callAllColumns(options).map(function(spec){spec.className=spec.className||spec.id||spec.field;if(hasDefaultColumns){var enabledColumns=COLUMNS_ENABLED_FOR_DASHBOARD_TYPE[dashboardType];var shouldBeHidden=!_.contains(enabledColumns,spec.name);spec=_.defaults({disabled:shouldBeHidden},spec)}return spec})}function getCustomColumnGroups(){var features=[];if(flags.variation(FLAGS.ENABLE_REACH_METRIC)){features.push("Reach")}return["Sentiment","Page","Mention Type","Forum Thread","Blog","Twitter","Source","Location","Site Visitors","Share","Workflow","Categories","Facebook","Instagram"].concat(features)}return{getColumnEvents:getColumnEvents,getDefaultColumns:getDefaultColumns,getCustomColumnGroups:getCustomColumnGroups,updateCategorySpecs:CategoriesColumn.updateCategorySpecs}});(function(root,factory){"use strict";var MicroEvent=function(){};MicroEvent.prototype={bind:function(event,fct){this._events=this._events||{};this._events[event]=this._events[event]||[];this._events[event].push(fct)},unbind:function(event,fct){this._events=this._events||{};if(event in this._events===false){return}this._events[event].splice(this._events[event].indexOf(fct),1)},trigger:function(event){this._events=this._events||{};if(event in this._events===false){return}for(var i=0;i<this._events[event].length;i++){this._events[event][i].apply(this,Array.prototype.slice.call(arguments,1))}}};MicroEvent.mixin=function(destObject){var props=["bind","unbind","trigger"];for(var i=0;i<props.length;i++){destObject.prototype[props[i]]=MicroEvent.prototype[props[i]]}};if(typeof define==="function"&&define.amd){define("lib/tabler/tabler",["jquery","underscore"],function($,_){return factory($||root.jQuery,_||root._,MicroEvent)})}else{root.tabler=factory(root.jQuery,root._,MicroEvent)}})(this,function($,_,MicroEvent){"use strict";if(!$){throw new Error("tabler requires jQuery to be loaded")}if(!_){throw new Error("tabler requires underscore to be loaded")}function buildDefaultSpec(data){return _(data).chain().map(function(row){return _(row).keys()}).flatten().uniq().reduce(function(memo,key){memo[key]={field:key};return memo},{}).values().value()}function validateAndAddToSpec(table,spec){var i,s,name,fields=[];for(i=0;i<spec.length;i++){s=spec[i];name=s.id=s.id||s.field||s.name;if(!name){throw new Error("Spec field at index "+i+" does not have a field, id or name property")}if(fields.indexOf(name)>-1){throw new Error("Spec field at index "+i+' has duplicate "field" or "id" property of "'+name+'", if it has no "id" property add one, if it has an "id" property ensure it is unique')}fields.push(name);table.spec.push(s)}}function Tabler(options){this.$el=$(document.createElement("table"));this._plugins=[];this.cellClassName=options&&options.cellClassName;this.headerCellClassName=options&&options.headerCellClassName;this.headRowClassName=options&&options.headRowClassName;this.bodyRowClassName=options&&options.bodyRowClassName;this.footRowClassName=options&&options.footRowClassName}Tabler.create=function(spec,options){var table=new Tabler(options),plugins=options&&options.plugins||[],i;if(!options&&!_.isArray(spec)){options=spec;spec=undefined}options=options||{};for(i=0;i<plugins.length;i++){table.addPlugin(plugins[i],options[plugins[i].pluginName])}if(options.className){table.$el.addClass(options.className)}if(options.fetch){table.fetch=options.fetch}if(spec){table.spec=[];table.addToSpec(spec)}return table};_.extend(Tabler.prototype,{addPlugin:function(Plugin,options){if(!Plugin.pluginName){throw new Error("Plugin "+Plugin+" must have a pluginName property")}var plugin=new Plugin(options);plugin.attach(this);this[Plugin.pluginName]=plugin;this._plugins.push(Plugin.pluginName)},addToSpec:function(spec){var specs=[].concat(spec);validateAndAddToSpec(this,specs)},removeFromSpec:function(matcher){var spec=this.getField(matcher);this.spec.splice(this.spec.indexOf(spec),1)},load:function(data){this._data={totalResults:data.length,items:_(data).map(function(row){return row})}},_doFetch:function(options,callback){var data=_.clone(this._data);data.items=_.map(data.items,_.clone);callback(data)},fetch:function(options,callback){return this._doFetch(options,callback)},getFetchOptions:function(){return{}},destroy:function(){var pluginName;this._events=undefined;this.fetch=undefined;this.$el.off().empty().remove();this.spec=[];while(pluginName=this._plugins.shift()){if(this[pluginName].detach){this[pluginName].detach(this)}this[pluginName]=undefined}this._plugins=[]},getField:function(matcher){if(_.isUndefined(matcher)){throw new Error("matcher must be defined (a string or an object literal)")}if(!_.isObject(matcher)){matcher={id:matcher}}return _(this.spec).detect(function(spec){if(_(matcher).all(function(value,key){return spec[key]===value})){return spec}})},makeColumnAttrs:function(colSpec){var className=colSpec.className||"";if(this.cellClassName){className+=" "+this.cellClassName}return{width:colSpec.width,class:className.trim()}},makeHeaderAttrs:function(colSpec){var className=colSpec.headerClassName||colSpec.className||"";if(this.headerCellClassName){className+=" "+this.headerCellClassName}return{width:colSpec.width,class:className.trim()}},makeTag:function(tag,text,attrs){var builder=["<",tag];_(attrs).forEach(function(value,attr){if(value){builder=builder.concat([" ",attr,'="',_.escape(value),'"'])}});builder=builder.concat([">",text,"</"+tag+">"]);return builder.join("")},formatValue:function(row,colSpec,index){var value=row[colSpec.field];if(value===""||value===undefined||value===null||_.isNaN(value)){value=colSpec.defaultText||value}value=_.escape(value);if(typeof colSpec.formatter==="function"){value=colSpec.formatter.call(this,value,colSpec,row,index)}return value},getSpec:function(data){var spec=this.spec;if(!this.spec){this.spec=[];this.addToSpec(buildDefaultSpec(data.items))}spec=_(this.spec).filter(function(colSpec){return!colSpec.disabled});return spec},render:function(){var options=this.getFetchOptions();this.$el.addClass("loading");this.fetch(options,_(this.renderTable).bind(this))},update:function(rowIndex,newItem,options){var spec=this.getSpec(),$row=this.$("> tbody tr").eq(rowIndex),$tds,updateFieldNames=Object.keys(newItem);if(options&&options.invalidateRow){return $row.replaceWith(this.renderRow(newItem,rowIndex,spec))}$tds=$row.find("td");_(spec).forEach(function(spec,cellIndex){if(spec.disabled){return}var fields=[spec.field].concat(spec.updateFields||[]);if(_.intersection(updateFieldNames,fields).length>0){$tds.eq(cellIndex).replaceWith(this.renderCell(newItem,spec,rowIndex))}},this)},renderTable:function(data){var spec=this.getSpec(data),head,body,foot;if(!data.items){throw new Error("no data.items (not even an empty array)")}this.$el.removeClass("loading");head=this.renderHead(data,spec);body=this.renderBody(data,spec);foot=this.renderFoot(data,spec);this.$el.empty();if(head){this.$el.append("<thead>"+head+"</thead>")}if(body){this.$el.append("<tbody>"+body+"</tbody>")}if(foot){this.$el.append("<tfoot>"+foot+"</tfoot>")}},renderHeadTr:function(){if(this.headRowClassName){return'<tr class="'+_.escape(this.headRowClassName)+'">'}return"<tr>"},renderHead:function(data,spec){var head="";if(_(spec).any(function(col){return!!col.name||!!col.headerFormatter})){head+=this.renderHeadRow(spec)}return head},renderHeadRow:function(spec){return this.renderHeadTr()+_(spec).map(function(colSpec){return this.renderHeadCell(colSpec)},this).join("\n")+"</tr>"},renderHeadCell:function(colSpec){var title=_.isString(colSpec.title)?colSpec.title:colSpec.name;title=_.escape(title);if(typeof colSpec.headerFormatter==="function"){title=colSpec.headerFormatter.call(this,colSpec,title)}return this.makeTag("th",title,this.makeHeaderAttrs(colSpec))},renderBodyTr:function(){if(this.bodyRowClassName){return'<tr class="'+_.escape(this.bodyRowClassName)+'">'}return"<tr>"},renderFootTr:function(){if(this.footRowClassName){return'<tr class="'+_.escape(this.footRowClassName)+'">'}return"<tr>"},renderBody:function(data,spec){var self=this,body=_(data.items).map(function(row,i){return self.renderRow(row,i,spec)}).join("\n");return body},renderRow:function(row,i,spec){var self=this;return[this.renderBodyTr(row)].concat(_(spec).map(function(colSpec){return self.renderCell(row,_.clone(colSpec),i)})).concat("</tr>").join("\n")},renderCell:function(row,colSpec,index){return this.makeTag("td",this.formatValue(row,colSpec,index),this.makeColumnAttrs(colSpec))},renderFoot:function(){return""},$:function(){return this.$el.find.apply(this.$el,arguments)}});MicroEvent.mixin(Tabler);return Tabler});define("src/packages/datatabler",["underscore","lib/tabler/tabler"],function(_,tabler){"use strict";function getStyle(key){var styles={data:{className:" bwDataTable",headerCellClassName:" cellborder",headRowClassName:" rowborder columnheader",bodyRowClassName:" rowborder highlightrow",cellClassName:" cellborder cellpadding",footRowClassName:" rowborder-top"},list:{className:" bwListTable",headerCellClassName:"",headRowClassName:" rowborder rowborder-top columnheader",bodyRowClassName:" rowborder highlightrow",cellClassName:" cellpadding",footRowClassName:" rowborder-top"}};return styles[key]||styles.data}return{DEFAULT_PAGE_SIZE:10,DEFAULT_PAGE_SIZES:[5,10,20,50,100],create:function create(spec,options){var opts=_.clone(options)||{},table,tableStyle;if(!options&&!_.isArray(spec)){opts=_.clone(spec)||{};spec=undefined}tableStyle=getStyle(opts.style);table=tabler.create(spec,{fetch:opts.fetch,pager:opts.pager,plugins:opts.plugins,cellClassName:(opts.cellClassName||"")+tableStyle.cellClassName,headerCellClassName:(opts.headerCellClassName||"")+tableStyle.headerCellClassName,className:(opts.className||"")+tableStyle.className,headRowClassName:(opts.headRowClassName||"")+tableStyle.headRowClassName,bodyRowClassName:(opts.bodyRowClassName||"")+tableStyle.bodyRowClassName,footRowClassName:(opts.footRowClassName||"")+tableStyle.footRowClassName});table.headerCellClassName+=table.removeColumns?" removeable":" cellpadding";if(table.columnGrouper){table.headerCellClassName+=" rowborder-top";table.columnGrouper.groupHeaderCellClassName="columngroupheader "+(table.removeColumns?"removeable":"cellpadding")}return table}}});(function(root,factory){"use strict";if(typeof define==="function"&&define.amd){define("lib/tabler/tabler.sortable",["jquery","underscore"],function($,_){return factory($,_)})}else{root.tabler.sortable=factory(root.jQuery,root._)}})(this,function($,_){"use strict";function addSortableFieldsToSpec(colSpec){if(colSpec.sortable){var oldFormatter=colSpec.headerFormatter;colSpec.name=colSpec.name||colSpec.field;colSpec.headerClassName=(colSpec.headerClassName||colSpec.className||"")+" sortable";colSpec.className=(colSpec.className||"")+" sortable";colSpec.headerFormatter=function renderSortableHeader(colSpec,value){if(typeof oldFormatter==="function"){value=oldFormatter.call(this,colSpec,value)}return'<a href="#" class="sort" data-sort-key="'+_.escape(colSpec.field)+'">'+value+"</a>"}}}function defaultSort(data,field,direction){data.items=_(data.items).sortBy(function(row){return row[field]});if(direction==="desc"){data.items=_(data.items).reverse()}return data}function Sortable(options){_.extend(this,options||{})}Sortable.pluginName="sortable";function updateSpecForSort(table,field,direction){direction=(direction||"").replace(/ending$/i,"")==="asc"?"asc":"desc";_(table.spec).forEach(function(colSpec){if(colSpec.className){colSpec.className=colSpec.className.replace(/sorted-asc/g,"").replace(/sorted-desc/g,"").replace(/(^\s|\s$)/g,"")}if(colSpec.headerClassName){colSpec.headerClassName=colSpec.headerClassName.replace(/sorted-asc/g,"").replace(/sorted-desc/g,"").replace(/(^\s|\s$)/g,"")}if(colSpec.field===field&&colSpec.sortable){colSpec.className=((colSpec.className||"")+" sorted-"+direction).trim();colSpec.headerClassName=((colSpec.headerClassName||"")+" sorted-"+direction).trim()}})}_.extend(Sortable.prototype,{attach:function(table){var self=this;this.table=table;_(table.spec).forEach(function(colSpec){addSortableFieldsToSpec(colSpec)});var addToSpec=this.originalAddToSpec=table.addToSpec;table.addToSpec=function(spec){_([].concat(spec)).forEach(function(colSpec){addSortableFieldsToSpec(colSpec)});addToSpec.call(this,spec)};var getFetchOptions=table.getFetchOptions;table.getFetchOptions=function(){return _.extend(getFetchOptions.call(this),{field:self.field,direction:self.direction})};var doFetch=table._doFetch;table._doFetch=function(options,callback){doFetch.call(this,options,function(data){if(options.field){data=defaultSort(data,options.field,options.direction)}callback(data)})};var render=this.originalRender=table.render;table.render=function(){updateSpecForSort(this,self.field,self.direction);render.call(this)};table.$el.on("click","th.sortable",function(e){var $target=$(e.target),$th=$(e.currentTarget),$a=$th.find("a.sort"),field=$a.data("sort-key"),direction=$th.hasClass("sorted-asc")?"desc":$th.hasClass("sorted-desc")?"asc":"desc";if(!$target.is($th)&&$target.closest(".sort").length===0){return}if(!$a.length){return}e.preventDefault();self.field=field;self.direction=direction;table.render();table.trigger("sorted",{field:self.field,direction:self.direction})})},detach:function(table){table.addToSpec=this.originalAddToSpec;this.originalAddToSpec=undefined;table.render=this.originalRender;this.originalRender=undefined;table.$el.off("click","th.sortable")}});return Sortable});(function(root,factory){"use strict";if(typeof define==="function"&&define.amd){define("lib/tabler/tabler.columnGrouper",["jquery","underscore"],function($,_){return factory($,_)})}else{root.tabler.columnGrouper=factory(root.jQuery,root._)}})(this,function($,_){"use strict";function defaultFormatter(groupSpec){return _.escape(groupSpec.groupName)}function ColumnGrouper(options){this.options=options||{};this.formatters=this.options.formatters||{};this.headerCellClassNames=this.options.headerCellClassNames||{};this.groupHeaderCellClassName=this.options.groupHeaderCellClassName;this.firstCellInGroupClassName=this.options.firstCellInGroupClassName;this.lastCellInGroupClassName=this.options.lastCellInGroupClassName}ColumnGrouper.pluginName="columnGrouper";_.extend(ColumnGrouper.prototype,{getColumnGroups:function(spec){return _([].concat(spec)).reduce(function(memo,colSpec){var lastSpec=memo[memo.length-1],groupName=colSpec.groupName||"";if(!lastSpec||lastSpec.groupName!==groupName){memo.push({columns:[colSpec],groupName:groupName,count:1})}else{lastSpec.count++;lastSpec.columns.push(colSpec)}return memo},[])},attach:function(table){var self=this,renderHead=this.originalRenderHead=table.renderHead,makeHeaderAttrs=this.originalMakeHeaderAttrs=table.makeHeaderAttrs,makeColumnAttrs=this.originalMakeColumnAttrs=table.makeColumnAttrs;function isFirstColumnInGroup(colSpec){return _(self.columnGroupsSpec).any(function(groupSpec){return _.isEqual(_.first(groupSpec.columns),colSpec)})}function isLastColumnInGroup(colSpec){return _(self.columnGroupsSpec).any(function(groupSpec){return _.isEqual(_.last(groupSpec.columns),colSpec)})}table.renderHead=function(data,spec){var head="";self.columnGroupsSpec=self.getColumnGroups(spec);if(_(spec).any(function(col){return!!col.groupName})){head+="<tr class=columnGroups>"+_(self.columnGroupsSpec).chain().map(function(groupSpec){var formatter=self.formatters[groupSpec.groupName]||defaultFormatter,className=self.headerCellClassNames[groupSpec.groupName]||"";className=className||groupSpec.groupName.replace(/\s/g,"-").toLowerCase();className+=" "+(self.groupHeaderCellClassName||"");return table.makeTag("th",formatter(groupSpec,table),{colspan:groupSpec.count,class:className.trim()})}).value().join("\n")+"</tr>"}return head+renderHead.apply(this,arguments)};table.makeHeaderAttrs=function(colSpec){var attrs=makeHeaderAttrs.apply(this,arguments),className=attrs["class"];if(self.firstCellInGroupClassName&&isFirstColumnInGroup(colSpec)){className+=" "+self.firstCellInGroupClassName}if(self.lastCellInGroupClassName&&isLastColumnInGroup(colSpec)){className+=" "+self.lastCellInGroupClassName}attrs["class"]=className.trim();return attrs};table.makeColumnAttrs=function(colSpec){var attrs=makeColumnAttrs.apply(this,arguments),className=attrs["class"];if(self.firstCellInGroupClassName&&isFirstColumnInGroup(colSpec)){className+=" "+self.firstCellInGroupClassName}if(self.lastCellInGroupClassName&&isLastColumnInGroup(colSpec)){className+=" "+self.lastCellInGroupClassName}attrs["class"]=className.trim();return attrs}},detach:function(table){table.renderHead=this.originalRenderHead;table.makeHeaderAttrs=this.originalMakeHeaderAttrs;table.makeColumnAttrs=this.originalMakeColumnAttrs;this.originalRenderHead=undefined;this.originalMakeHeaderAttrs=undefined;this.originalMakeColumnAttrs=undefined;this.formatters={}}});return ColumnGrouper});(function(root,factory){"use strict";if(typeof define==="function"&&define.amd){define("lib/tabler/tabler.toggleColumns",["jquery","underscore"],function($,_){return factory($,_)})}else{root.tabler.toggleColumns=factory(root.jQuery,root._)}})(this,function($,_){"use strict";var $toggleUI=$(["<div class=toggleColumnsUI>","<h1>Show / Hide Columns</h1>","<form>","   <fieldset>","       <ul class=columns></ul>","   </fieldset>","   <p><button class=apply>Apply</button><a href=# class=cancel>Cancel</a></p>","</form>","</div>"].join("\n")).css({position:"absolute",zIndex:"1000",left:0,top:0});function defaultFormatter(spec){return _.escape(spec.name||spec.field||spec.id)}function defaultGroupFormatter(name){return _.escape(name)}function findNearestScrollingParent($el){var $scroller=$(window);$el.parents().each(function(i,el){var $el=$(el);if(["auto","scroll"].indexOf($el.css("overflow-y"))>-1&&el.scrollHeight>el.clientHeight){$scroller=$el;return false}});return $scroller}function checkColumnGroupStatus($columnGroupLi){var $columnGroupInput=$columnGroupLi.find("input[name=columnGroup]"),$allColumns=$columnGroupLi.find("input[name=column]"),allColumnsChecked=_($allColumns).all(function(el){return el.checked}),anyColumnsChecked=_($allColumns).any(function(el){return el.checked});$columnGroupInput.removeClass("partiallySelected");if(allColumnsChecked){$columnGroupInput.prop("checked",true)}else if(anyColumnsChecked){$columnGroupInput.prop("checked",true).addClass("partiallySelected")}else if(!allColumnsChecked){$columnGroupInput.prop("checked",false)}}function checkColumns($columnGroupLi){var $columnGroupInput=$columnGroupLi.find("input[name=columnGroup]"),$allColumns=$columnGroupLi.find("input[name=column]"),wasPartiallySelected=$columnGroupInput.hasClass("partiallySelected");if(wasPartiallySelected){$columnGroupInput.removeClass("partiallySelected");$columnGroupInput.prop("checked",true);$allColumns.prop("checked",true)}else{$allColumns.prop("checked",$columnGroupInput.is(":checked"))}}function detachToggleUI(){$toggleUI.detach()}function hideToggleUIFromClick(e){if($(e.target).closest(".toggleColumnsUI,button.showHide").length){$("body").one("click",hideToggleUIFromClick);return}$toggleUI.detach()}$toggleUI.on("change","input",function(e){var $input=$(e.target);if($input.is("[name=column]")){checkColumnGroupStatus($input.parents("li.columnGroup"))}else if($input.is("[name=columnGroup]")){checkColumns($input.parents("li.columnGroup"))}$toggleUI.find("button.apply").prop("disabled",$toggleUI.find("input[type=checkbox]:checked").length===0)});$toggleUI.on("click","li.columnGroup a.opener",function(e){var $a=$(e.target),$li=$a.parents("li.columnGroup").eq(0);e.preventDefault();$li.toggleClass("open").toggleClass("closed");$a.html($li.is(".closed")?"+":"&ndash;")});$toggleUI.on("click","button.apply",function(e){var table=$toggleUI.data("table");e.preventDefault();$toggleUI.find("input[type=checkbox][name=column]").each(function(i,el){var field=table.getField($(el).val())||table.toggleColumns.getCustomColumn({id:$(el).val()});field.disabled=!$(el).is(":checked")});$toggleUI.detach();table.render();table.trigger("columnsToggled")});$toggleUI.on("click","a.cancel",function(e){e.preventDefault();$toggleUI.detach()});function ToggleColumns(options){this.options=options||{}}ToggleColumns.pluginName="toggleColumns";_.extend(ToggleColumns.prototype,{getCustomColumn:function(findSpec){return _(this.customColumns).find(function(spec){return _(findSpec).all(function(value,key){return spec[key]===value})})},attach:function(table){var self=this,renderHead=this.originalRenderHead=table.renderHead;this.table=table;this.customColumns=[];this.groupFormatters={};this.formatters={};table.renderHead=function(data,spec){var html=["<tr class=toggleColumns>",'<th colspan="'+spec.length+'">',_.isFunction(self.headerHTML)?self.headerHTML():self.headerHTML||"","<button class=showHide>Columns</button>","</th>","</tr>"];return html.join("\n")+renderHead.apply(this,arguments)};table.$el.on("click",".toggleColumns th button.showHide",function(e){var $button=$(e.target),buttonOffset;if($toggleUI.closest("html").length){$toggleUI.removeData("table");$toggleUI.detach();return}findNearestScrollingParent(table.$el).one("scroll.tablerToggleColumns",detachToggleUI);$(window).one("resize.tablerToggleColumns",detachToggleUI);$("body").one("click.tablerToggleColumns",hideToggleUIFromClick);$toggleUI.data("table",table);$toggleUI.find("button.apply").prop("disabled",false);$toggleUI.find("ul.columns").html(_(table.toggleColumns.customColumns).chain().union(table.spec).filter(function(spec){return spec.toggleable!==false}).groupBy(function(spec){return spec.groupName||""}).map(function(group,name){var html=[],id=_.uniqueId("toggleColumnsUIGroup"),anyChecked,allChecked,displayText,groupFormatter;if(name){groupFormatter=self.groupFormatters[name]||defaultGroupFormatter;displayText=groupFormatter(name);anyChecked=_(group).any(function(spec){return!spec.disabled});allChecked=_(group).all(function(spec){return!spec.disabled});html.push('<li class="columnGroup closed">');html.push('<a href="#" class="opener">+</a>');html.push('<input name=columnGroup type=checkbox value="" id="'+_.escape(id)+'" '+(anyChecked?"checked":"")+" "+(allChecked?"":'class="partiallySelected"')+"/>");html.push('<label for="'+_.escape(id)+'">'+displayText+"</label>");html.push("<ul>")}html=html.concat(_(group).map(function(spec){var id=_.uniqueId("toggleColumnsUIValue"),columnFormatter=self.formatters[spec.id||spec.field]||defaultFormatter,displayText=columnFormatter(spec);return['<li><input name=column type=checkbox value="',_.escape(spec.id||spec.name),'" id="',_.escape(id),'" ',spec.disabled?"":" checked"," />",'<label for="',id,'">',displayText,"</label>","</li>"].join("")}));if(name){html.push("</ul>");html.push("</li>")}return html}).flatten().value().join("\n"));buttonOffset=$button.offset();$toggleUI.appendTo("body").css({left:buttonOffset.left-$toggleUI.outerWidth()+$button.outerWidth(),top:buttonOffset.top+$button.outerHeight()}).show()})},detach:function(table){$toggleUI.detach().removeData("table");table.renderHead=this.originalRenderHead;this.originalRenderHead=undefined;this.table=undefined;this.customColumns=[];table.$el.off("click",".toggleColumns th button.showHide");findNearestScrollingParent(table.$el).off("scroll.tablerToggleColumns");$(window).off("resize.tablerToggleColumns");$("body").off("click.tablerToggleColumns")}});return ToggleColumns});(function(root,factory){"use strict";if(typeof define==="function"&&define.amd){define("lib/tabler/tabler.removeColumns",["jquery","underscore"],function($,_){return factory($,_)})}else{root.tabler.removeColumns=factory(root.jQuery,root._)}})(this,function($,_){"use strict";function getLinkHtml(specIds){return'<a href class="removeColumn" data-ids="'+_.escape(JSON.stringify(specIds))+'" title="Hide this column. To show again later, click the &quot;Columns&quot; button top right">x</a>'}function formatSpec(spec){var oldFormatter=spec.headerFormatter;spec.headerFormatter=function(spec,value){if(typeof oldFormatter==="function"){value=oldFormatter.call(this,spec,value)}if(value&&spec.toggleable!==false){value=getLinkHtml([spec.id])+value}return'<span class="name">'+value+"</span>"}}function RemoveColumns(options){_.extend(this,options||{})}RemoveColumns.pluginName="removeColumns";function setupColumnGroup(table,spec){spec=[].concat(spec);var i,oldFormatter,specs,addRemoveLink,columnGrouper=table.columnGrouper,formatColumnGrouper,groups=columnGrouper.getColumnGroups(spec),groupSpec;function findSpecsInCurrentGroup(spec){return spec.groupName===groupSpec.groupName}function notToggleable(spec){return spec.toggleable===false}for(i=0;i<groups.length;i++){groupSpec=groups[i];oldFormatter=columnGrouper.formatters[groupSpec.groupName];specs=_(spec).filter(findSpecsInCurrentGroup);addRemoveLink=true;if(!specs.length||_(specs).any(notToggleable)){addRemoveLink=false}if(oldFormatter&&oldFormatter._removeColumnsFormatted){return}formatColumnGrouper=function(groupSpec,table){var html=_.escape(groupSpec.groupName),formatter=table.columnGrouper.formatters[groupSpec.groupName],oldFormatter=formatter.original,addRemoveLink=formatter.addRemoveLink,specs=_(table.spec).filter(function(spec){return spec.groupName===groupSpec.groupName});if(typeof oldFormatter==="function"){html=oldFormatter.call(this,groupSpec)}if(addRemoveLink){html=getLinkHtml(_(specs).pluck("id"))+html}return'<span class="name">'+html+"</span>"};formatColumnGrouper.original=oldFormatter;formatColumnGrouper.addRemoveLink=addRemoveLink;formatColumnGrouper._removeColumnsFormatted=true;columnGrouper.formatters[groupSpec.groupName]=formatColumnGrouper}}_.extend(RemoveColumns.prototype,{attach:function(table){_(table.spec).forEach(function(spec){formatSpec(spec)});var addToSpec=this.originalAddToSpec=table.addToSpec;table.addToSpec=function(spec){_([].concat(spec)).forEach(function(colSpec){formatSpec(colSpec)});addToSpec.call(this,spec);setupColumnGroup(table,spec)};table.$el.on("click","th a.removeColumn",function(e){e.preventDefault();var ids=$(e.target).data("ids");_([].concat(ids)).forEach(function(id){var field=table.getField({id:id});if(field){field.disabled=true}});table.trigger("columnsToggled");table.render()})},detach:function(table){table.addToSpec=this.originalAddToSpec;this.originalAddToSpec=undefined;table.$el.off("click","th a.removeColumn");if(!table.columnGrouper){return}_(table.columnGrouper.formatters).forEach(function(value,key){if(value.original){table.columnGrouper.formatters[key]=value.original;value.original=undefined}})}});return RemoveColumns});define("mustache!src/components/mentions/templates/toggleColumnsHeader",["lib/mustache"],function(mustache){var escapedTemplate='{{#mentionCount}}\n<p class="mentionCount singlepadding-right">\nMentions <strong>{{start}}</strong> - <strong>{{end}}</strong> of {{^historicData}}<strong>{{size}}</strong>{{/historicData}}{{#historicData}}<strong><span class="linkblue link disabled js-historic-data">~{{size}}</span></strong>&nbsp;<span class="lightgrey">(includes Historical Data)</span>{{/historicData}}</strong>\n<span class="selectedCount"></span>\n</p>\n{{/mentionCount}}\n{{#canEdit}}\n<ul class="actions utilsBar">\n<li class="delete floatleft"><button disabled class="button"><span class="icon-trash smallpadding-right"></span>Delete</button></li>\n<li class="markAsSpam singlemargin-left floatleft"><button disabled class="customtip button" title="Mark selected mentions as Spam">Spam</button></li>\n<li class="bulkActions hasMenu singlemargin-left floatleft">\n<button disabled class="customtip button" title="Open the bulk actions menu">More Actions<span class="smallpadding-left icon-chevron-down"></span></button>\n<ul class="context-menu popupframe hidden">\n{{^preventEditSentiment}}\n<li class="context-menu--row sentiment iconindent"><a>Change Sentiment</a></li>\n{{/preventEditSentiment}}\n<li class="context-menu--row location iconindent"><a>Change Location</a></li>\n{{^preventEditEmotion}}\n{{! Ensure emotion isn\'t added to YouTube Mentions and Search Component }}\n<li class="context-menu--row separator"></li>\n<li class="context-menu--row add-emotion iconindent"><a>Add Emotions</a></li>\n<li class="context-menu--row remove-emotion iconindent"><a>Remove Emotions</a></li>\n{{/preventEditEmotion}}\n<li class="context-menu--row separator"></li>\n<li class="context-menu--row tag iconindent"><span class="icon-tag lightgrey singlepadding-left"></span><a class="add">Add</a> or <a class="remove">Remove</a> Tags</li>\n<li class="context-menu--row category iconindent"><a class="add">Add</a> or <a class="remove">Remove</a> a Category</li>\n<li class="context-menu--row separator"></li>\n<li class="context-menu--row star iconindent"><span class="icon-star lightgrey singlepadding-left"></span><a class="add">Add</a> or <a class="remove">Remove</a> Stars</li>\n<li class="context-menu--row separator"></li>\n<li class="context-menu--row assign iconindent"><a class="add">Add</a> or <a class="remove">Remove</a> Assignment</li>\n<li class="context-menu--row priority iconindent"><a class="add">Add</a> or <a class="remove">Remove</a> Priority</li>\n<li class="context-menu--row status iconindent"><a class="add">Add</a> or <a class="remove">Remove</a> Status</li>\n<li class="context-menu--row checked iconindent"><a class="add">Add</a> or <a class="remove">Remove</a> "Checked" status</li>\n</ul>\n</li>\n</ul>\n{{/canEdit}}\n<p class="liveStream {{#showStreamWarning}}customtip{{/showStreamWarning}} {{^canEdit}}readOnly{{/canEdit}}" {{#showStreamWarning}}title="Live streaming is not supported together when using search terms in controls.<br/>You can set up rules to automatically tag/categorize mentions based on search terms then filter by them in &quot;live stream&quot; mode."{{/showStreamWarning}}>\n{{#showStreamWarning}}\n<span class="liveStreamWarning icon-warning-sign singlemargin-left"></span>\n{{/showStreamWarning}}\n<label for="livestream-{{id}}">Live stream</label>\n<input id="livestream-{{id}}" type="checkbox" value="true" name="liveStream" {{#disableStreamingField}}disabled="disabled"{{/disableStreamingField}} {{#streamingEnabled}}checked{{/streamingEnabled}}></input>\n<a class="help icon-bwhelp tinymargin-left" data-key="mentions:mentions-auto-refresh"></a>\n</p>\n{{#canEdit}}\n<p class="columnControls">\n\x3c!-- leave unclosed, will swallow button as well --\x3e\n{{/canEdit}}\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/components/mentions/css/mentionsTableView.css",["css!src/components/mentions/css/compiled.css"],function(){});function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}define("src/components/mentions/_table/MentionsTableView",["underscore","jquery","src/permissions","src/helpers/uhdHelpers","src/analytics/Analytics","src/globals/categories","src/globals/currentDashboard","src/globals/queries","src/globals/flags","src/globals/flagNames","src/views/ComponentView","src/views/HelpView","src/components/mentions/helpers/logoDetectionHelper","src/components/mentions/_table/MentionsTableBulkViews","src/components/mentions/_table/MentionsTableColumns","src/components/imagewall/components/logolist/LogoList","src/components/imagewall/components/passepartout/Passepartout","src/uhd/views/UHDBreakdownPopupView","src/packages/datatabler","lib/tabler/tabler.sortable","lib/tabler/tabler.columnGrouper","lib/tabler/tabler.toggleColumns","lib/tabler/tabler.pager","lib/tabler/tabler.pageSize","lib/tabler/tabler.removeColumns","mustache!src/components/mentions/templates/toggleColumnsHeader","css!src/components/mentions/css/mentionsTableView.css","css!src/components/mentions/css/mentions.css","css!src/components/mentions/css/twitterMention.css","src/packages/customtip"],function(_,$,permissions,uhdHelpers,Analytics,categories,currentDashboard,queries,flags,FLAGS,ComponentView,HelpView,logoDetectionHelper,MentionsTableBulkViews,MentionsTableColumns,LogoList,Passepartout,UHDBreakdownPopupView,tabler,sortable,columnGrouper,toggleColumns,pager,pageSize,removeColumns,toggleColumnsHeader){"use strict";var MentionsTableView;function extendTablerSettings(table){var tablerDefaultSettings=MentionsTableView.tablerDefaultSettings;_.extend(table.toggleColumns.formatters,tablerDefaultSettings.toggleColumns.formatters);_.extend(table.toggleColumns.groupFormatters,tablerDefaultSettings.toggleColumns.groupFormatters);_.extend(table.columnGrouper.formatters,tablerDefaultSettings.columnGrouper.formatters)}function bindColumnsToggled(table,settings){table.bind("columnsToggled",function(){settings.set({visibleColumns:_(table.spec).reduce(function(visibleColumns,spec){if(spec.toggleable!==false&&!spec.disabled){visibleColumns.push(spec.id)}return visibleColumns},[])})})}function setupMentionJson(attributesToUpdate,mentionJson,mention,isChecked){mentionJson=_(mention.toJSON()).pick(attributesToUpdate);mentionJson.pendingAttributes=mention.pendingAttributes();mentionJson.uiChecked=isChecked;mentionJson.id=mention.id;return mentionJson}function showUHDBreakdownPopupView(view,event){UHDBreakdownPopupView.show($(event.currentTarget),view.getHistoricDataBreakdown())}function destroyUHDBreakdownPopupView(){UHDBreakdownPopupView.destroy()}function getMentionCountHeader(collection,hasHistoricData){var startIndex=collection.resultsPage*collection.resultsPageSize;var size=hasHistoricData?collection.inflatedTotalDataSize:collection.resultsTotal;return collection.size()?{start:startIndex+1,end:startIndex+collection.size(),size:size}:undefined}function hasLogoQuery(view){var queryIds=view.settings&&view.settings.get("queryId")||[];return queries.containsLogoQueryIds(queryIds)}function buildTable(view){var columns=view.applyPermissions();var table=view.table=view.createTable(columns);extendTablerSettings(table);view.formatCustomColumnGrouper(table);view.bindSortedAndPaged(table);view.setupPaging(table);view.toggleColumns(table);bindColumnsToggled(table,view.settings);view.renderTableRow(table);view.setupSorting();view.loadSavedTableSpec();view.tagsInputs={};view.selecterised=null;view.passepartouts={};view.logoLists={};view.emotionsSelleckts={};view.$el.html(table.$el);view.delegateEvents()}function initializeMentionPassepartout(view,mentionId,defaultLogoImage){var passepartoutView=new Passepartout({showMousePointer:true,passepartoutMaxHeight:112});passepartoutView.render({logoImage:defaultLogoImage});view.passepartouts[mentionId]=passepartoutView}function appendPassepartouts(view){Object.entries(view.passepartouts).forEach(function(_ref){var _ref2=_slicedToArray(_ref,2),key=_ref2[0],passepartout=_ref2[1];view.$('.mention[data-id="'.concat(key,'"] .js-passepartout')).append(passepartout.$el)})}function cleanupPassepartouts(view){if(Object.entries(view.passepartouts).length){Object.entries(view.passepartouts).forEach(function(_ref3){var _ref4=_slicedToArray(_ref3,2),passepartout=_ref4[1];passepartout.remove()});view.passepartouts={}}}function cleanupEmotionsSelleckts(view){Object.values(view.emotionsSelleckts).forEach(function(selleckt){if(selleckt)selleckt.destroy()});view.emotionsSelleckts={}}function initializeMentionLogoList(view,mentionId,defaultLogoImage){var logoListView=new LogoList({layout:LogoList.VERTICAL});logoListView.render(defaultLogoImage.logos);view.logoLists[mentionId]=logoListView}function appendLogoLists(view){Object.entries(view.logoLists).forEach(function(_ref5){var _ref6=_slicedToArray(_ref5,2),key=_ref6[0],logoList=_ref6[1];view.$('[data-id="'.concat(key,'"] .js-logolist-wrapper')).append(logoList.$el)})}function cleanupLogoLists(view){if(Object.entries(view.logoLists).length){Object.entries(view.logoLists).forEach(function(_ref7){var _ref8=_slicedToArray(_ref7,2),logoList=_ref8[1];logoList.remove()});view.logoLists={}}}function onRowMouseEnter(event){var id=event.currentTarget.dataset.id;var passepartout=this.passepartouts[id];if(passepartout){passepartout.showSecondaryMask()}}function onRowMouseLeave(event){var id=event.currentTarget.dataset.id;var passepartout=this.passepartouts[id];if(passepartout){passepartout.hideSecondaryMask()}}function showPrimaryMask(view){_.values(view.passepartouts).forEach(function(passepartout){passepartout.showPrimaryMask()})}function hidePrimaryMask(view){_.values(view.passepartouts).forEach(function(passepartout){passepartout.hidePrimaryMask()})}HelpView.addPrefix("mentions","/src/components/mentions/help/");MentionsTableView=ComponentView.extend({className:"mentionsTableView bwDataTable modular",events:function events(){var columnsAndBulkEvents=_(this.getColumnEvents()).extend(MentionsTableBulkViews.getEvents(this));return _(columnsAndBulkEvents).extend({"click thead .toggleColumns p.mentionCount a":"onToggleSelectAllMentions","change thead .toggleColumns input[name=liveStream]":"onToggleLiveStream","click thead th a.removeColumn":"onRemoveColumn","mouseenter .js-historic-data":showUHDBreakdownPopupView.bind(null,this),"mouseleave .js-historic-data":destroyUHDBreakdownPopupView,"mouseenter tr[data-id]":onRowMouseEnter.bind(this),"mouseleave tr[data-id]":onRowMouseLeave.bind(this)})},constructor:function MentionsTableView(options){ComponentView.apply(this,arguments);this.componentEventBus=options.componentEventBus;this.listenToEvents();buildTable(this)},getColumnEvents:function getColumnEvents(){return MentionsTableColumns.getColumnEvents(this,{dashboardType:currentDashboard.get("dashboardType"),hasLogoQuery:hasLogoQuery(this)})},listenToEvents:function listenToEvents(){this.listenTo(this.collection,"reset",this.render);this.listenTo(this.collection,"add",this.mentionAdded);this.listenTo(this.collection,"remove",this.mentionRemoved);this.listenTo(this.collection,"change",this.mentionChanged);this.listenTo(this.collection,"sync",this.mentionSynced);this.listenTo(this.settings,"change:orderBy",this.setupSorting);this.listenTo(this.settings,"change:page",this.pageIndexChanged);this.listenTo(this.settings,"change:queryId",buildTable.bind(null,this));this.listenTo(categories,"change reset add remove",this.categoriesChanged);this.componentEventBus.on("mouseover",showPrimaryMask.bind(null,this));this.componentEventBus.on("mouseout",hidePrimaryMask.bind(null,this))},applyPermissions:function applyPermissions(){var canSeeEngagement=permissions.check("see.engagement",currentDashboard),canEditMentions=permissions.check("edit.mentions",currentDashboard);return _(this.getColumns()).reduce(function(memo,spec){if(spec.name==="Share"&&!canSeeEngagement){return memo}else if(!canEditMentions&&["Workflow"].indexOf(spec.groupName)>-1){return memo}else{if(spec.defaultText==="-"&&typeof spec.formatter!=="function"){spec.formatter=function(value){return value==="-"?'<span class="empty">-</span>':value}}memo.push(_.clone(spec))}return memo},[])},getHistoricDataBreakdown:function getHistoricDataBreakdown(){return this.collection.getHistoricDataBreakdown()},getColumns:function getColumns(){return MentionsTableColumns.getDefaultColumns({dashboardType:currentDashboard.get("dashboardType"),hasLogoQuery:hasLogoQuery(this),logoImagesGroupId:this.settings.get("logoImagesGroupId"),componentEventBus:this.componentEventBus})},createTable:function createTable(columns){var self=this;var logoImagesGroupId=this.settings.get("logoImagesGroupId");return tabler.create(columns,{plugins:[columnGrouper,removeColumns,toggleColumns,pager,pageSize,sortable],fetch:function fetch(options,callback){var selectedMentionIds=self.getSelectedMentionIds(),allSelected=self.$("thead .checkAndStar input").is(":checked");callback({totalResults:self.collection.resultsTotal,items:self.collection.map(function(mention){mention=mention.toJSON();mention.uiChecked=allSelected||selectedMentionIds.indexOf(mention.id)>-1;mention.timezone=currentDashboard.getTimezone();if(mention.logoImages&&mention.logoImages.length){var defaultLogoImage=logoDetectionHelper.getDefaultLogoImage(mention.logoImages,logoImagesGroupId);initializeMentionPassepartout(self,mention.id,defaultLogoImage);initializeMentionLogoList(self,mention.id,defaultLogoImage)}return mention})});appendPassepartouts(self);appendLogoLists(self);self.$("img").on("error",function(){$(this).css({visibility:"hidden"})})}})},formatCustomColumnGrouper:function formatCustomColumnGrouper(table){var self=this;_(MentionsTableView.customColumnGroups).forEach(function(groupName){var originalFormat=table.columnGrouper.formatters[groupName];table.columnGrouper.formatters[groupName]=function(groupSpec){var html=self.formatHelpGroup.apply(this,arguments);if(originalFormat){html=originalFormat.apply(this,arguments).replace(/<\/span>$/i,html+"</span>")}else{html=groupSpec.groupName+html}return html}})},bindSortedAndPaged:function bindSortedAndPaged(table){var self=this,settings=this.settings;table.bind("paged",function(pageOptions){settings.set({pageSize:pageOptions.pageSize,page:pageOptions.currentPage})});table.bind("sorted",function(sortOptions){settings.set({orderBy:sortOptions.field,orderDirection:sortOptions.direction,page:0});Analytics.trackEvent({name:"Component.Mentions",action:"Sort_Table_"+self.collection.url+"_By_"+sortOptions.field,origin:"Application"})})},toggleColumnsHeaderHtml:function toggleColumnsHeaderHtml(){var collection=this.collection;var settings=this.settings;var emotionsEnabled=flags.variation(FLAGS.ENABLE_EMOTIONS_MARKUP);var historicData=uhdHelpers.hasHistoricData(collection,settings.getQueryData().startDate);var hasTerms=_.trim(settings.get("search"))!=="";return{id:_.uniqueId(),canEdit:permissions.check("edit.mentions",currentDashboard),disableStreamingField:hasTerms&&!collection.isStreaming(),showStreamWarning:hasTerms,preventEditEmotion:!emotionsEnabled,mentionCount:getMentionCountHeader(collection,historicData),historicData:historicData,streamingEnabled:function streamingEnabled(){return function(output){return collection.isStreaming()?output:""}}}},toggleColumns:function toggleColumns(table){table.toggleColumns.headerHTML="<div>".concat(toggleColumnsHeader(this.toggleColumnsHeaderHtml(),false))},renderTableRow:function renderTableRow(table){var self=this;table.renderBodyTr=function(row){var className="rowborder highlightrow";if(self.previousMaximumId&&row.id===self.previousMaximumId){className+=" lastNewMention"}if(self.getSelectedMentionIds().indexOf(row.id)>-1){className+=" selected"}return'<tr lang="'+(row.language||"")+'" data-id="'+row.id+'"'+' class="'+className+'">'}},formatHelpGroup:function formatHelpGroup(groupSpec){var helpKey="mentions:mentions-table-"+groupSpec.groupName.replace(/\s/g,"").toLowerCase(),cssClass,markup;if(helpKey==="mentions:mentions-table-forumthread"){helpKey="mentions:mentions-table-forum"}if(helpKey==="mentions:mentions-table-location"){helpKey="mentions:mentions-table-locations";cssClass="sevencol"}if(helpKey==="mentions:mentions-table-sitevisitors"){helpKey="mentions:mentions-table-site-visitors"}if(helpKey==="mentions:mentions-table-impact"){helpKey="filters-impact"}if(helpKey==="mentions:mentions-table-reach"){helpKey="reach-estimate"}markup=' <a class="help icon-bwhelp" data-key="'+helpKey+'"></a>';if(cssClass){markup=markup.replace("<a",'<a data-modal-css-class="'+cssClass+'"')}return markup},setupSorting:function setupSorting(){var table=this.table;table.sortable.field=this.settings.get("orderBy");table.sortable.direction=this.settings.get("orderDirection")},setupPaging:function setupPaging(table){table.pager.pageSize=this.settings.get("pageSize")||20;table.pager.currentPage=0;table.pageSize.afterText="mentions / page";table.pageSize.sizes=[10,20,30,40,50,100];table.toggleColumns.customColumns.push({id:"snippets",name:"Show snippets"})},pageIndexChanged:function pageIndexChanged(){var start=this.settings.get("page")+this.settings.get("pageSize");this.table.pager.currentPage=Math.round(start/this.table.pager.pageSize)},loadSavedTableSpec:function loadSavedTableSpec(){var table=this.table,visibleColumns=this.settings.get("visibleColumns");if(!visibleColumns){return}_(table.spec).chain().filter(function(spec){return spec.toggleable!==false}).forEach(function(spec){spec.disabled=visibleColumns.indexOf(spec.id)===-1})},remove:function remove(){var collection=this.collection;if(this.notesView){this.notesView.remove()}if(this.shareMentionMenu){this.shareMentionMenu.remove()}if(this.engageContextMenu){this.engageContextMenu.remove()}if(this.singleMentionView){this.singleMentionView.remove()}if(this.profileView){this.profileView.remove()}this.tidyupTagsInputs();this.tidyupSelecterised();if(this.table){this.table.destroy();this.table=undefined}cleanupEmotionsSelleckts(this);cleanupPassepartouts(this);cleanupLogoLists(this);this.passepartouts={};this.logoLists={};ComponentView.prototype.remove.call(this);collection.disableStreaming()},tidyupTagsInputs:function tidyupTagsInputs(){_(this.tagsInputs).each(function(view){view.remove()});this.tagsInputs={}},tidyupSelecterised:function tidyupSelecterised(){if(this.selecterised){this.selecterised.remove()}this.selecterised=null},mentionAdded:function mentionAdded(){this.render()},mentionRemoved:function mentionRemoved(){this.render()},mentionChanged:function mentionChanged(mention){if(!mention.changedAttributes||!mention.changedAttributes()){return}this.updateMention(mention,_.keys(mention.changedAttributes()||{}))},mentionSynced:function mentionSynced(mention){if(!mention.sentAttributes||!mention.sentAttributes()){return}var sentAttributeNames=_(mention.sentAttributes()).reduce(function(attrs,value,key){key=key.replace(/^(add|remove)([A-Z])/,function(match,p1,p2){return p2.toLowerCase()});attrs.push(key);return attrs},[]);this.updateMention(mention,sentAttributeNames)},updateMention:function updateMention(mention,attributesToUpdate){var mentionIndex=this.collection.indexOf(mention),isChecked=this.getSelectedMentionIds().indexOf(mention.id)>-1,$currentRow=this.$("tr[data-id="+mention.id+"]"),$tagsInput=$currentRow.find("td.tags input"),mentionJson;if(mentionIndex===-1){return}mentionJson=setupMentionJson(attributesToUpdate,mentionJson,mention,isChecked);this.table.update(mentionIndex,mentionJson);this.detachTagsInput(mention,mentionJson);this.setRowToTagValue(mention,$tagsInput);this.setRowElementFromTag(mention,mentionJson);this.focusTagInput(mention,$tagsInput);this.checkMention(mention,isChecked);this.$("tr[data-id="+mention.id+"] td.professions").customtip()},detachTagsInput:function detachTagsInput(mention,mentionJson){if(this.tagsInputs[mention.id]&&(mentionJson.tags||mentionJson.addTag||mentionJson.removeTag)){this.tagsInputs[mention.id].detach()}},setRowToTagValue:function setRowToTagValue(mention,$tagsInput){var tagInputValue=$tagsInput.val();if(tagInputValue){this.$("tr[data-id="+mention.id+"] td.tags input").val(tagInputValue)}},setRowElementFromTag:function setRowElementFromTag(mention,mentionJson){if(this.tagsInputs[mention.id]&&(mentionJson.tags||mentionJson.addTag||mentionJson.removeTag)){this.tagsInputs[mention.id].setElement(this.$("tr[data-id="+mention.id+"] td.tags > div"))}},focusTagInput:function focusTagInput(mention,$tagsInput){var tagInputHasFocus=$tagsInput.is(":focus");if(tagInputHasFocus){this.$("tr[data-id="+mention.id+"] td.tags input").trigger("focusin")}},checkMention:function checkMention(mention,isChecked){if(isChecked){this.$("tr[data-id="+mention.id+"] td.checkAndStar input").prop("checked",true)}},render:function render(){var table=this.table;cleanupEmotionsSelleckts(this);cleanupPassepartouts(this);cleanupLogoLists(this);this.$(".statusMessageContainer").remove();this.tidyupTagsInputs();this.tidyupSelecterised();MentionsTableColumns.updateCategorySpecs(this);this.setUpTablePager(table);this.toggleColumns(table);table.render();this.triggerTagFocus();this.removeElementsBasedOnPermission();this.enableStreaming();this.$(".removeColumn").addClass("customtip").customtip();if(!this.collection.size()){this.showNoResultsMessage();return}this.updateSelectedCount();this.$("thead .toggleColumns").customtip();this.$("td.checkAndStar, td.title, td.professions").customtip();return this},setUpTablePager:function setUpTablePager(table){var start=this.collection.resultsPage*this.collection.resultsPageSize,data={start:start,size:this.collection.resultsTotal,end:start+this.collection.size()};table.pager.currentPage=Math.round(data.start/this.settings.get("pageSize"));table.pager.totalResults=data.size;table.pager.pageSize=this.settings.get("pageSize")},triggerTagFocus:function triggerTagFocus(){var focussedTagInput=this.$("td.tags input:focus").closest("tr").data("id");if(focussedTagInput){this.$("td.tags input[data-id="+focussedTagInput+"]").trigger("focusin")}},removeElementsBasedOnPermission:function removeElementsBasedOnPermission(){if(!permissions.check("edit.mentions",currentDashboard)){this.$("button.showHide").remove();this.$("th a.removeColumn").remove()}},enableStreaming:function enableStreaming(){if(this.collection.isStreamingSet()&&!this.collection.isStreaming()){this.$("thead .toggleColumns input[name=liveStream]").prop("checked",true);this.collection.enableStreaming()}},showNoResultsMessage:function showNoResultsMessage(){this.$("tfoot").addClass("hidden");this.$el.append('<div class="statusMessageContainer"></div>');this.$(".statusMessageContainer").showMessage("No results")},waitingForData:function waitingForData(model,xhr,options){options=options||{};if(options.streaming){return}if(options.patch){return}if(options.bulkJob){return}this.$(".statusMessageContainer").remove();ComponentView.prototype.waitingForData.call(this,_.extend({text:"Waiting for data...",opacity:.8},options))},showErrorMessage:function showErrorMessage(model,xhr,options){if(options&&options.patch){return this.clearWaitingMessage()}return ComponentView.prototype.showErrorMessage.call(this,model,xhr,options)},categoriesChanged:function categoriesChanged(){this.render()},getSelectedMentionIds:function getSelectedMentionIds(){var $checked=this.$("tbody td.checkAndStar input[type=checkbox]:checked");return $checked.map(function(){return this.value}).get()},updateSelectedCount:function updateSelectedCount(){var $all=this.$("tbody td.checkAndStar input[type=checkbox]"),$checked=$all.filter(":checked"),canSelectAll=Math.ceil(this.collection.resultsTotal/this.table.pager.pageSize)>1,allCount=$all.length,checkedCount=$checked.length,html;if(canSelectAll&&allCount===checkedCount){if(this.allSelected){html="(<strong>"+this.collection.resultsTotal+"</strong> selected <a class=selectAll>Deselect</a>)"}else{html="(<strong>"+checkedCount+"</strong> selected <a class=selectAll>Select all "+_.escape(this.collection.resultsTotal)+"</a>)"}this.$("thead th.checkAndStar input[type=checkbox]").prop("checked",true)}else{html="(<strong>"+checkedCount+"</strong> selected)";this.$("thead th.checkAndStar input[type=checkbox]").prop("checked",allCount===checkedCount);if(checkedCount<1){html=""}}this.$("thead tr.toggleColumns .actions button").prop("disabled",checkedCount<1);this.$("thead li.markAsSpam button").prop("disabled",this.allSelected||checkedCount<1);this.$(".toggleColumns p.mentionCount span.selectedCount").html(html);this.trigger("selectedCountChanged",this.allSelected?"all":checkedCount)},onToggleSelectAllMentions:function onToggleSelectAllMentions(e){e.preventDefault();this.allSelected=!this.allSelected;if(!this.allSelected){this.$("thead th.checkAndStar input[type=checkbox]").prop("checked",false);this.$("tbody td.checkAndStar input[type=checkbox]").prop("checked",false).closest("tr").toggleClass("selected",false)}this.updateSelectedCount()},onToggleLiveStream:function onToggleLiveStream(e){var checked=$(e.target).is(":checked");if(!checked){this.collection.disableStreaming()}else{this.collection.enableStreaming()}},onRemoveColumn:function onRemoveColumn(){var self=this;_.defer(function(){var $btn=self.$("thead button.showHide");$btn.addClass("throb");clearTimeout(self.throbTimer);self.throbTimer=setTimeout(function(){$btn.removeClass("throb")},4e3)})},setAttrs:function setAttrs(attr,selected,multiple,mentionCategories,items){var attrs={},values=(multiple?_(selected).pluck("value"):selected&&selected.value)||null,selectedCategories=_([].concat(values||[])).map(function(id){return parseInt(id,10)});if(attr==="category"){attrs.addCategories=_(selectedCategories).difference(mentionCategories);attrs.removeCategories=_(mentionCategories).difference(selectedCategories)}else if(attr==="removeCategory"){attrs.removeCategories=_(items).chain().pluck("id").intersection(mentionCategories).value()}else if(!values){attrs["remove"+_.capitalize(attr)]=multiple?mentionCategories:mentionCategories[0]}else{attrs[attr]=values}return attrs},saveMention:function saveMention(mention,attrs,originalText,$a){mention.save(attrs,{patch:true,success:function success(){$a.data("values",mention.get("categories")).removeClass("error").attr("title","")},error:function error(){$a.addClass("error").attr("title","An error occurred, please try again later");$a.text(originalText)}})}},{customColumnGroups:MentionsTableColumns.getCustomColumnGroups(),tablerDefaultSettings:{columnGrouper:{formatters:{}},toggleColumns:{formatters:{},groupFormatters:{}}}});return MentionsTableView});define("src/components/mentions/views/MentionsComponentUtilsBarView",["underscore","src/permissions","src/globals/currentDashboard","src/views/UtilsBarView","src/packages/customtip"],function(_,permissions,currentDashboard,UtilsBarView){"use strict";var toggleTagFilterLink='<li class="toggleTagFilter floatleft link componentHeader--section">'+'<a class="grey db singlepadding-horizontal componentHeader--toggle">'+'<span class="icon-tag componentHeader--icon customtip" title="Show Tag filter">'+'</span><span class="label smallpadding-left">Tag filter</span></a></li>';return UtilsBarView.extend({events:function events(){return _.extend({"click li.toggleTagFilter":"onToggleTagFilter"},UtilsBarView.prototype.events.call(this))},initialize:function initialize(options){UtilsBarView.prototype.initialize.call(this,options);this.bind("switchView",this.onSwitchViews,this)},render:function render(){UtilsBarView.prototype.render.call(this);if(permissions.check("edit.mentions",currentDashboard)){this.$("li.switch-views").before(toggleTagFilterLink)}this.$(".customtip").customtip()},tagFilterToggled:function tagFilterToggled(visible){var $trigger=this.$("li.toggleTagFilter");$trigger.toggleClass("active",visible)},onToggleTagFilter:function onToggleTagFilter(e){e.preventDefault();this.trigger("toggleTagFilter")}})});define("mustache!templates/componentTagFilterView",["lib/mustache"],function(mustache){var escapedTemplate='<form>\n<p>\n<input type="text" placeholder="Search tags" name="filterTags" class="iconfield search filterList" />\n<a class="help icon-bwhelp smallmargin-left" data-key="mentions:mentions-tags-reset"></a>\n\n<a class="resetView">Reset tag filter</a>\n</p>\n<ul class=tagsList>\n<li class="starred {{#starred}}selected{{/starred}}"><a class="tagName">Starred</a></li>\n{{#tags}}\n<li data-id={{id}} class="tag {{#selected}}selected{{/selected}}">\n<a class="tagName">{{name}}</a>\n\n<a class="toggleMenu">▾</a>\n<ul class="tagMenu context-menu popupframe hidden">\n<li class="context-menu--item rename"><a>Rename this Tag</a></li>\n<li class="context-menu--item delete"><a>Delete this Tag</a></li>\n</ul>\n</li>\n{{/tags}}\n</ul>\n</form>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/views/ComponentTagFilterView",["backbone","underscore","jquery","mustache!templates/componentTagFilterView","lib/jquery.prompt","lib/jquery.confirm","lib/jquery.showMessage","lib/jquery.clearabletext/jquery.clearableText","css!lib/jquery.clearabletext/jquery.clearableText.css"],function(Backbone,_,$,componentTagFilterView){"use strict";var ComponentTagFilterView=Backbone.View.extend({tagName:"section",className:"componentTagFilter",events:{"submit form":"onSubmitForm","keyup input[name=filterTags]":"onFilterTags","change input[name=filterTags]":"onFilterTags","click a.resetView":"onResetTagFilter","click li a.tagName":"onClickTagName","click li a.toggleMenu":"onClickToggleMenu","click li.rename":"onClickRenameTag","click li.delete":"onClickDeleteTag"},constructor:function constructor(options){Backbone.View.apply(this,arguments);if(!options||!options.settings){throw new Error("options.settings must be defined")}this.settings=options.settings;this.listenTo(this.settings,"change:category",this.render);this.listenTo(this.settings,"change:starred",this.render);if(!options.tagCollection){throw new TypeError("ComponentTagFilterView must be instantiated with a tagCollection option")}this.tagCollection=options.tagCollection;this.listenTo(this.tagCollection,"all",this.render);_(this).bindAll("hideAllTagMenus");$("body").on("click",this.hideAllTagMenus)},remove:function remove(){$("body").off("click",this.hideAllTagMenus);Backbone.View.prototype.remove.call(this)},render:function render(){var view=this,selectedTags=_(this.settings.get("tag")).chain().map(function(category){return view.tagCollection.get(category)}).compact().map(function(tag){return(tag.get("name")||"").toLowerCase()}).value();view.$el.html(componentTagFilterView({starred:!!view.settings.get("starred"),tags:view.tagCollection.chain().map(function(tag){var name=tag.get("name")||"";return{selected:selectedTags.indexOf(name.toLowerCase())>-1,id:tag.id,name:name}}).sortBy(function(tag){return tag.name.toLowerCase()}).value()}));this.$("input[name=filterTags]").clearableTextField()},toggle:function toggle(visible){this.$el.toggleClass("hidden",_.isBoolean(visible)?!visible:undefined);this.trigger("toggle",!this.$el.hasClass("hidden"))},onSubmitForm:function onSubmitForm(e){e.preventDefault()},onFilterTags:function onFilterTags(e){var val=$(e.target).val().toLowerCase();this.$("ul.tagsList>li").addClass("hidden").filter(function(){return $("a.tagName",this).text().toLowerCase().indexOf(val)>-1}).removeClass("hidden")},onResetTagFilter:function onResetTagFilter(e){e.preventDefault();this.settings.set({tag:null,starred:null},{unset:true});this.$("input[name=filterTags]").val("").keyup()},onClickTagName:function onClickTagName(e){var $a=$(e.target),$li=$a.closest("li");$li.toggleClass("selected");e.preventDefault();var attrs={starred:"",tag:[]};this.$("ul.tagsList li.selected").each(function(){var $li=$(this);if($li.is(".starred")){attrs.starred=true}else{attrs.tag.push($li.data("id"))}});this.updateSettings(attrs)},updateSettings:function updateSettings(attrs){this.settings.set(attrs)},hideAllTagMenus:function hideAllTagMenus(){this.$("ul.tagMenu").addClass("hidden")},onClickToggleMenu:function onClickToggleMenu(e){e.preventDefault();e.stopPropagation();var $li=$(e.target).closest("li");$li.find("ul.tagMenu").toggleClass("hidden");$li.siblings().find("ul.tagMenu").addClass("hidden")},onClickRenameTag:function onClickRenameTag(e){e.preventDefault();var self=this,tagName=$(e.target).closest("li.tag").find("a.tagName").text(),tag=self.tagCollection.getByName(tagName);$.prompt({text:'Rename "'+tagName+'" to:',okText:"Rename",validate:function validate(value){var error="";if(!value.trim().length){error="Tag name cannot be empty"}if(self.tagCollection.find(function(tag){return tag.get("name")===value})){error="A tag with this name already exists"}return error}},function(err,value){if(err){return}tag.save({name:value.trim()},{success:function success(){self.settings.trigger("change")}})})},onClickDeleteTag:function onClickDeleteTag(e){e.preventDefault();var self=this,tagId=$(e.target).closest("li.tag").data("id"),tag=self.tagCollection.get(tagId),tagName=tag&&tag.get("name")||"<deleted>";$.confirm({title:"WARNING",text:'This will <strong>delete</strong> the tag "'+_.escape(tagName)+'".\n'+'It will also remove it <strong>from all mentions</strong> that may be tagged with "'+_.escape(tagName)+'"!',escape:false},function(confirmed){if(!confirmed){return}tag.destroy({success:function success(){self.settings.trigger("change")}})})}});return ComponentTagFilterView});define("css!src/components/mentions/css/mentionsComponent.css",["css!src/components/mentions/css/compiled.css"],function(){});define("src/components/mentions/MentionsComponent",["backbone","underscore","jquery","src/globals/tags","src/components/Component","src/components/mentions/helpers/mentionsExportHelper","src/components/mentions/models/MentionCollection","src/components/mentions/views/MentionsControlsView","src/components/mentions/views/MentionsSnippetsView","src/components/mentions/views/MentionsTopicsView","src/components/mentions/_table/MentionsTableView","src/components/mentions/views/MentionsComponentUtilsBarView","src/views/ComponentTagFilterView","src/views/HelpView","css!src/components/mentions/css/mentionsComponent.css"],function(Backbone,_,$,globalTags,Component,mentionsExportHelper,MentionCollection,MentionsControlsView,MentionsSnippetsView,MentionsTopicsView,MentionsTableView,MentionsComponentUtilsBarView,ComponentTagFilterView,HelpView){"use strict";HelpView.addPrefix("mentions","/src/components/mentions/help/");var MentionsComponent;MentionsComponent=Component.extend({className:["mentionsComponent",Component.prototype.className].join(" "),events:function events(){return _.extend({"click div.newMentions":"onFetchNewMentions",mouseover:"onComponentMouseover",mouseout:"onComponentMouseout"},Component.prototype.events.call(this))},constructor:function MentionsComponent(options){this.collection=new MentionCollection(null,options);Component.apply(this,arguments)},initialize:function initialize(options){this.listenTo(this.collection,"newMentions",this.showNewMentionsIndicator);this.listenTo(this.collection,"checkingForNewMentions",this.showNewMentionsLoadingSpinner);Component.prototype.initialize.call(this,options);this.listenTo(this.settings,"change:liveStreaming",this.liveStreamingToggled);this.componentEventBus=Object.assign({},Backbone.Events);this.exportModel.set({showXlsCsv:true,showImage:false,useXlsx:true,formats:MentionsComponent.defaultExportFormats});this.tagsFilter=new ComponentTagFilterView({tagCollection:globalTags,settings:this.settings});this.canExport=mentionsExportHelper.canExport(this.collection.settings.toJSON());this.listenTo(this.tagsFilter,"toggle",this.onTagsFilterToggled)},remove:function remove(){if(this.tagsFilter){this.tagsFilter.remove()}Component.prototype.remove.call(this)},getHelpKey:function getHelpKey(){return"mentions:mentions-component"},getUtilsBarViewClass:function getUtilsBarViewClass(){return MentionsComponentUtilsBarView},translateLegacyViewName:function translateLegacyViewName(name){if(name==="tableview"){return"tableView"}if(name==="snippets"){return"snippetsView"}if(name==="dynamic_phrase_cloud"){return"topicsView"}return name},getViews:function getViews(){return{tableView:{name:"Table",isDefault:true,type:MentionsTableView,iconClassName:"icon-bwview-table",options:{componentEventBus:this.componentEventBus}},snippetsView:{name:"Snippets",type:MentionsSnippetsView,iconClassName:"icon-bwview-snippets",options:{viewOnly:false,showTermFilter:false,showDateFilter:false,componentEventBus:this.componentEventBus}},topicsView:{name:"Topic Cloud",type:MentionsTopicsView,iconClassName:"icon-bwview-cloud"}}},render:function render(){var renderPromise=Component.prototype.render.call(this);this.tagsFilter.updateSettings=function(attrs){attrs.page=0;ComponentTagFilterView.prototype.updateSettings.apply(this,arguments)};this.tagsFilter.toggle(false);this.tagsFilter.render();this.$(".content").prepend(this.tagsFilter.el);this.listenTo(this.utilsBarView,"toggleTagFilter",this.onToggleTagFilter);return renderPromise},showNewMentionsIndicator:function showNewMentionsIndicator(count){var $indicator=this.$("div.newMentions");if(!this.$(".newMentions").length){$indicator=$('<div class="newMentions singlemargin-vertical smallpadding-vertical"><p /><a class=remove>×</a></div>')}$indicator.find("p").html("<span>"+count+"</span> new mention"+(count===1?"":"s")+". Click here to reload.");this.$(".content").prepend($indicator)},showNewMentionsLoadingSpinner:function showNewMentionsLoadingSpinner(){var $indicator=this.$("div.newMentions");if($indicator.length){$indicator.find("span").text("").addClass("spinner loading-small")}},liveStreamingToggled:function liveStreamingToggled(){var enabled=this.settings.get("liveStreaming");if(!enabled){this.$(".newMentions").remove()}},onFetchNewMentions:function onFetchNewMentions(e){e.preventDefault();if(!$(e.target).hasClass("remove")){if(this._viewCache.tableView){this._viewCache.tableView.previousMaximumId=this.collection.maximumIdInResult}this.collection.fetch()}this.$(".newMentions").remove()},onToggleTagFilter:function onToggleTagFilter(){this.tagsFilter.toggle()},onTagsFilterToggled:function onTagsFilterToggled(visible){this.utilsBarView.tagFilterToggled(visible)},onComponentMouseover:function onComponentMouseover(){this.componentEventBus.trigger("mouseover")},onComponentMouseout:function onComponentMouseout(){this.componentEventBus.trigger("mouseout")},doExport:function doExport(options){mentionsExportHelper.warnIfBigVolumeAndExport(this.componentName,this.collection,this.settings,options)},disableApplyChanges:function disableApplyChanges(model,xhr,options){options=options||{};if(options.patch){return}if(options.bulkJob){return}Component.prototype.disableApplyChanges.apply(this,arguments)}},{defaultExportFormats:[{id:"xlsx",name:"Excel"},{id:"fulltext.xlsx",name:"Excel (Full text)"},{id:"csv",name:"CSV"}],ControlsViewClass:MentionsControlsView});return MentionsComponent});define("src/components/topauthors/models/TopAuthorsControls",["underscore","src/helpers/api2queryHelper","src/models/CombinedQueryControls"],function(_,api2queryHelper,CombinedQueryControls){"use strict";function migrateAttributes(attrs){attrs=_.clone(attrs);if(attrs.orderBy==="mentions"){attrs.orderBy="volume"}return api2queryHelper.sanitisePagination(attrs)}return CombinedQueryControls.extend({defaults:function defaults(){return _.extend(CombinedQueryControls.prototype.defaults.call(this),{limit:10})},set:function set(attrs,options){attrs=migrateAttributes(attrs);return CombinedQueryControls.prototype.set.call(this,attrs,options)},dataSpec:function dataSpec(){return _.extend(CombinedQueryControls.prototype.dataSpec.apply(this,arguments),{limit:{type:"positiveNumber",required:true}})},getQueryDataFieldNames:function getQueryDataFieldNames(){return CombinedQueryControls.prototype.getQueryDataFieldNames.apply(this,arguments).concat(["orderBy","orderDirection","limit"])}})});define("src/components/tweeters/models/TweetersControls",["underscore","src/models/CombinedQueryControls","src/helpers/api2queryHelper"],function(_,CombinedQueryControls,Api2queryHelper){"use strict";function mapPathToField(path){switch(path){case"visitor_minutes":return"duration";case"location":return"country";case"mentions":return"volume"}path=_(path.split("_")).reduce(function(memo,part){return memo+part[0].toUpperCase()+part.substring(1)},"");return path[0].toLowerCase()+path.substring(1)}function getExportOrderByFieldName(orderBy){var mapping={accountname:"domain"};return mapping[orderBy]||orderBy}return CombinedQueryControls.extend({defaults:function defaults(){return _.defaults(CombinedQueryControls.prototype.defaults.call(this),{limit:10})},dataSpec:function dataSpec(){return _.extend(CombinedQueryControls.prototype.dataSpec.apply(this,arguments),{limit:{type:"positiveNumber",required:true,maximumValue:1e3}})},getQueryDataForExport:function getQueryDataForExport(){var queryData=this.getQueryData();queryData.orderBy=getExportOrderByFieldName(queryData.orderBy);queryData.pageType="twitter";return queryData},set:function set(attrs){if(attrs.schema){attrs.spec=_(attrs.schema).map(function(schema){return{field:mapPathToField(schema.path),disabled:!!schema.hidden}});delete attrs.schema}attrs=Api2queryHelper.sanitiseOrder(attrs);attrs=Api2queryHelper.sanitiseLimit(attrs);if(attrs.orderBy==="mentions"){attrs.orderBy="volume"}if(attrs.orderBy==="importance"){attrs.orderBy="impact"}return CombinedQueryControls.prototype.set.apply(this,arguments)},getQueryDataFieldNames:function getQueryDataFieldNames(){return CombinedQueryControls.prototype.getQueryDataFieldNames.apply(this,arguments).concat(["orderBy","orderDirection","limit"])}})});define("src/models/markSiteAsSpam",["underscore","jquery","src/Workbench"],function(_,$,Workbench){"use strict";var MARK_AS_SPAM_URL="/projects/{projectId}/site/markasspam";function getCallData(data){return{domain:data.domain,queryId:data.queryId,queryGroupId:data.queryGroupId}}return{markAsSpam:function markAsSpam(data,options){var callData=getCallData(data),postSettings=_.extend({method:"post",contentType:"application/json",data:JSON.stringify(callData)},options);$.ajax(Workbench.buildApiUrl(MARK_AS_SPAM_URL),postSettings)}}});define("mustache!templates/markSiteAsSpam",["lib/mustache"],function(mustache){var escapedTemplate='<h1 class="popuptitletext singlemargin-bottom draggable">Mark as spam</h1>\n<p class="popupmessagetext">This will report the site <a href="http://{{domain}}" class="linkToSite" rel="nofollow" target="_blank">{{domain}}</a>\nas spam and delete all associated mentions{{ message }}.</p>\n<p class="doublemargin-top">\n<button class="confirm defaultbutton">Confirm</button>\n<button class="cancel button singlemargin-left">Cancel</button>\n</p>\n\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/views/MarkSiteAsSpamView",["backbone","jquery","src/permissions","src/globals/currentDashboard","src/models/markSiteAsSpam","mustache!templates/markSiteAsSpam"],function(Backbone,$,permissions,currentDashboard,markSiteAsSpam,template){"use strict";var MarkSiteAsSpamView;MarkSiteAsSpamView=Backbone.View.extend({className:"markSiteAsSpam",events:function events(){return{"click button.confirm":"onConfirm","click button.close":"onClose","click .cancel":"onCancel","click a.linkToSite":"ignoreClickOnSite"}},remove:function remove(){this.off();Backbone.View.prototype.remove.call(this)},render:function render(){if(!permissions.check("mark.as.spam",currentDashboard)){this.$el.empty();return}var templateData={domain:this.model.get("domain")};if(this.model.get("currentMode")==="queryGroup"){templateData.message=" for each of the queries in the Query group";this.$el.html(template(templateData))}else{if(this.model.get("queryId").length>1){templateData.message=" for each of the selected Queries";this.$el.html(template(templateData))}else{this.$el.html(template(templateData))}}},ignoreClickOnSite:function ignoreClickOnSite(e){e.stopPropagation()},onConfirm:function onConfirm(e){var self=this;e.preventDefault();e.stopPropagation();this.$("p").remove();this.$el.append("<p>Please wait...</p><p class=loading></p>");markSiteAsSpam.markAsSpam(this.model.toJSON(),{success:function success(){self.$("p").remove();$(self.el).append('<div class="successMessage"><h2>Process started!</h2>'+"<p>Your mentions are being marked as spam. <strong>This may take a few minutes</strong>.</p>"+"<p>To see the changes press the <strong>Apply</strong> button in the Controls.</p></div>"+'<p><button class="close button">Close</button></p>')},error:function error(){self.$("p:first").remove();self.$("p").removeClass("loading").addClass("error").text("An error occurred")}})},onCancel:function onCancel(e){e.preventDefault();this.trigger("cancelled")},onClose:function onClose(e){e.preventDefault();this.trigger("confirmed")}},{show:function show(options){var view=new MarkSiteAsSpamView({model:new Backbone.Model(options.model.toJSON())}),removeModal=function removeModal(){view.$el.removeModal()};view.on("confirmed",removeModal);view.on("cancelled",removeModal);view.render();view.$el.showModal({draggable:".draggable",className:"popup smallpopup",onClose:function onClose(){view.remove()}});return view}});return MarkSiteAsSpamView});define("mustache!templates/domainContextMenu",["lib/mustache"],function(mustache){var escapedTemplate='<ul>\n{{#isOfflinePublication}}\n{{^hidePrimaryLink}}\n<li class="context-menu--item default showMentions" data-publication="{{publication}}"><a>View Mentions</a></li>\n{{/hidePrimaryLink}}\n{{/isOfflinePublication}}\n{{^isOfflinePublication}}\n{{^hidePrimaryLink}}\n<li class="context-menu--item default showMentions" data-domain="{{domain}}"><a>View Mentions</a></li>\n<li class="context-menu--item separator"></li>\n{{/hidePrimaryLink}}\n{{#canAddToSiteGroup}}\n<li class="context-menu--item addToSiteGroup" data-domain="{{domain}}"><a>Add to a Site List</a></li>\n{{/canAddToSiteGroup}}\n{{#canMarkAsSpam}}\n<li class="context-menu--item markAsSpam" data-domain="{{domain}}"><a>Mark as Spam</a></li>\n{{/canMarkAsSpam}}\n{{/isOfflinePublication}}\n</ul>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/views/DomainContextMenu",["backbone","underscore","src/permissions","src/globals/me","src/globals/currentDashboard","src/views/ContextMenuView","src/views/MarkSiteAsSpamView","src/components/mentions/views/MentionsPopup","src/components/mentions/views/AddToSiteGroupView","mustache!templates/domainContextMenu","src/packages/modalDialogs"],function(Backbone,_,permissions,me,currentDashboard,ContextMenuView,MarkSiteAsSpamView,MentionsPopup,AddToSiteGroupView,template){"use strict";var QUERY_GROUP_DATA_SOURCE="queryGroup";return ContextMenuView.extend({tagName:"nav",className:"domainContextMenu context-menu popupframe",events:function events(){return{"click li.showMentions":"openMentions","click li.addToSiteGroup":"onAddToSiteGroup","click li.markAsSpam":"markAsSpam"}},initialize:function initialize(options){var currentMode;if(!options||!options.settings){throw new Error("options.settings must be defined!")}currentMode=options.settings.get("currentMode");this.model=this.model||new Backbone.Model({domain:options.domain,author:options.author,publication:options.publication});this.model.set({currentMode:currentMode});if(currentMode===QUERY_GROUP_DATA_SOURCE){this.model.set({queryGroupId:options.settings.get("queryGroupId")})}else{this.model.set({queryId:options.settings.get("queryId")})}this.settings=options.settings;this.hidePrimaryLink=options.hidePrimaryLink;this.model.on("change",this.render,this)},isOfflinePublication:function isOfflinePublication(){var publication=this.model.get("publication");return!(_.isUndefined(publication)||_.isNull(publication))},render:function render(){this.$el.html(template({domain:this.model.get("domain"),canAddToSiteGroup:permissions.check("edit.groups",currentDashboard),canMarkAsSpam:permissions.check("mark.as.spam",currentDashboard),hidePrimaryLink:this.hidePrimaryLink,isOfflinePublication:this.isOfflinePublication(),publication:this.model.get("publication")}))},checkDefaultActionConditions:function checkDefaultActionConditions(options){return options.openDefault||!permissions.check("mark.as.spam",currentDashboard)&&!permissions.check("edit.groups",currentDashboard)},performDefaultAction:function performDefaultAction(){this.openMentions()},onAddToSiteGroup:function onAddToSiteGroup(){this.addToSiteGroup(this.model.get("domain"))},addToSiteGroup:function addToSiteGroup(domain,additionalOptions){var options=_(additionalOptions||{}).extend({userId:me.id,domain:domain,target:this.$el.getRelativeToTarget()||this.$el});AddToSiteGroupView.show(options)},openMentions:function openMentions(){var additionalOptions={domain:this.model.get("domain"),publication:this.model.get("publication")},author=this.model.get("author");if(author){additionalOptions.author=author;additionalOptions.exactAuthor=true}MentionsPopup.showMentions({settings:this.settings,additionalOptions:additionalOptions})},markAsSpam:function markAsSpam(){MarkSiteAsSpamView.show({model:this.model})}})});define("mustache!templates/authorNameTableField",["lib/mustache"],function(mustache){var escapedTemplate='<div class="relative">\n{{^isTwitterAuthor}}\n<i class="authoricon profile iconbig icon-bwuser lightgrey absleft smallmargin-left"></i>\n{{/isTwitterAuthor}}\n{{#isTwitterAuthor}}\n<img class="twitter profile" data-value="{{authorName}}" title="Show Twitter Profile for @{{authorName}}" src="{{avatarUrl}}" />\n{{/isTwitterAuthor}}\n</div>\n<a {{#isTwitterAuthor}}href="http://twitter.com/{{authorName}}"{{/isTwitterAuthor}}\nclass="{{#isTwitterAuthor}}twitter{{/isTwitterAuthor}} account"\ndata-author="{{authorName}}"\ndata-domain="{{domain}}"\ndata-publication-name="{{publicationName}}">\n{{#isTwitterAuthor}}@{{/isTwitterAuthor}}{{authorName}}\n</a>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/formatters/authorTableFormatter",["mustache!templates/authorNameTableField"],function(renderAuthorNameTableFieldTemplate){"use strict";function _extractAndDecodeAvatarUrl(row){var avatarUrl=row.twitterAvatar||row.avatarUrl||"";return decodeURIComponent("/twitter-avatar?url="+avatarUrl)}return{authorNameFormatter:function authorNameFormatter(value,column,row){var authorName=row[column.field]||"[unknown]";return renderAuthorNameTableFieldTemplate({domain:row.domain,authorName:authorName,avatarUrl:_extractAndDecodeAvatarUrl(row),isTwitterAuthor:row.domain==="twitter.com",publicationName:row.publicationName},false)},extractAndDecodeAvatarUrl:function extractAndDecodeAvatarUrl(row){return _extractAndDecodeAvatarUrl(row)}}});define("src/formatters/queryFormatters",["underscore","src/globals/queries"],function(_,queries){"use strict";return{queriesListFormatter:function queriesListFormatter(value,column,row){var queryNames=row[column.field];queryNames=_(queryNames).chain().map(function(id){return queries.get(id).get("name")}).sortBy(function(id){return id}).value().join(", ");return'<span class="customtip" title="'+_.escape(queryNames)+'">'+_.escape(queryNames)+"</span>"}}});(function(root,factory){"use strict";if(typeof define==="function"&&define.amd){define("lib/tabler/tabler.aggregator",["jquery","underscore"],function($,_){return factory($,_)})}else{root.tabler.aggregator=factory(root.jQuery,root._)}})(this,function($,_){"use strict";function Aggregator(options){this.options=options||{}}Aggregator.pluginName="aggregator";_.extend(Aggregator.prototype,{attach:function(table){var aggregates=this.aggregates={},formatValue=this.originalFormatValue=table.formatValue;table.formatValue=function(row,colSpec,index){var aggregator=colSpec.aggregator,value=row[colSpec.field];if(aggregator){aggregates[colSpec.field]=aggregator.call(this,aggregates[colSpec.field],value,index)}return formatValue.apply(this,arguments)};var render=this.originalRender=table.render;table.render=function(){_(this.spec).forEach(function(spec){aggregates[spec.field]=0});render.apply(this,arguments)};var renderFoot=this.originalRenderFoot=table.renderFoot;table.renderFoot=function(data,spec){var foot=renderFoot.apply(this,arguments);if(_(spec).any(function(col){return!!col.aggregator})){foot=[table.renderFootTr()].concat(_(spec).map(function(spec){if(spec.aggregatorText){return table.makeTag("td",spec.aggregatorText,table.makeColumnAttrs(spec))}if(spec.aggregator){return table.makeTag("td",aggregates[spec.field],table.makeColumnAttrs(spec))}return table.makeTag("td",null,table.makeColumnAttrs(spec))})).concat("</tr>").join("\n")}return foot}},detach:function(table){table.render=this.originalRender;this.originalRender=undefined;table.renderFoot=this.originalRenderFoot;this.originalRenderFoot=undefined;table.formatValue=this.originalFormatValue;this.originalFormatValue=undefined}});return Aggregator});function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(iter){if(Symbol.iterator in Object(iter)||Object.prototype.toString.call(iter)==="[object Arguments]")return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}}define("src/components/topauthors/views/TopAuthorsTableView",["underscore","jquery","src/globals/flags","src/globals/flagNames","src/analytics/Analytics","src/views/ComponentView","src/components/mentions/_mentionsprofile/views/TwitterProfileView","src/views/AuthorContextMenu","src/views/DomainContextMenu","src/formatters/authorTableFormatter","src/formatters/queryFormatters","src/packages/datatabler","lib/tabler/tabler.sortable","lib/tabler/tabler.columnGrouper","lib/tabler/tabler.aggregator","lib/tabler/tabler.toggleColumns"],function(_,$,flags,FLAGS,Analytics,ComponentView,TwitterProfileView,AuthorContextMenu,DomainContextMenu,authorTableFormatter,queryFormatters,tabler,sortable,columnGrouper,aggregator,toggleColumns){"use strict";function totaliser(memo,value){return memo+parseInt(value||0,10)}function domainNameFormatter(value,columnDef,row){if(row.isOfflinePublication){return'<a data-domain="'.concat(value,'" data-publication="').concat(row.publicationName,'">').concat(row.publicationName,"</a>")}return'<a data-domain="'.concat(value,'">').concat(value,"</a>")}function mentionsTooltipFormatter(value,columnDef,row){if(row.queries&&row.queries.length>1){return'<span class="customtip" title="This value is the sum of mentions found across multiple Queries.'+'<br/>Be aware that duplicates are currently not being removed.">'+value+"</span>"}return value}function trackClickTwitterProfile(username){Analytics.trackEvent({name:"Component.Top Authors",action:"Click_Twitter_Profile",origin:"Application",values:{username:username}})}var TopAuthorsTableView=ComponentView.extend({className:"topAuthorsTableView bwDataTable modular",events:function events(){return{"click tbody td.authorname a":"onShowAuthorMenu","click tbody td.domainname a":"onShowDomainMenu","dblclick tbody td.authorname a":"onDblclickAuthor","dblclick tbody td.domainname a":"onDblclickDomain","click .profile":"onShowAuthorProfile"}},contextMenu:null,initialize:function initialize(options){var enableReachMetric=flags.variation(FLAGS.ENABLE_REACH_METRIC);var columnFeatures=[];var groupFeatures=[];ComponentView.prototype.initialize.call(this,options);_(this).bindAll("onShowAuthorMenu");this.collection.on("reset",this.render,this);this.settings.on("change:queryId change:currentMode",this.updateQueriesColumn,this);if(enableReachMetric){columnFeatures.push({name:"Reach",title:"Average",field:"reachEstimate",width:60,sortable:true,groupName:"Reach",className:"reachCol textright",defaultText:"n/a"})}var self=this,columns=_.map([].concat(_toConsumableArray(TopAuthorsTableView.defaultColumns),columnFeatures),_.clone),table=this.table=tabler.create(columns,{plugins:[sortable,columnGrouper,aggregator,toggleColumns],fetch:function fetch(options,callback){var items=self.collection.map(function(author){author=author.toJSON();return _.defaults({author:author.name,negative:author.sentiment.negative,neutral:author.sentiment.neutral,positive:author.sentiment.positive,mentions:author.volume,queries:author.queries,domain:author.domain},author)});callback({items:items})}}),tablerDefaultSettings=TopAuthorsTableView.tablerDefaultSettings;_.extend(table.toggleColumns.formatters,tablerDefaultSettings.toggleColumns.formatters);_.extend(table.toggleColumns.groupFormatters,tablerDefaultSettings.toggleColumns.groupFormatters);_.extend(table.columnGrouper.formatters,tablerDefaultSettings.columnGrouper.formatters);table.bind("sorted",function(options){self.settings.set({orderBy:options.field,orderDirection:options.direction});Analytics.trackEvent({name:"Component.Top Authors",action:"Sort_Table_"+self.collection.url+"_By_"+options.field,origin:"Application"})});if(enableReachMetric){groupFeatures.push("Reach")}_([].concat(_toConsumableArray(TopAuthorsTableView.customColumnGroups),groupFeatures)).each(function(groupName){table.columnGrouper.formatters[groupName]=function(groupSpec){return self.formatHelpGroup.call(this,groupSpec)}});table.toggleColumns.headerHTML='<a class="help icon-bwhelp" data-key="table-show-hide-columns"></a>';table.bind("columnsToggled",function(){self.settings.set({spec:_(TopAuthorsTableView.defaultColumns).chain().filter(function(defaultSpec){return defaultSpec.disabled!==table.getField(defaultSpec.field).disabled}).map(function(defaultSpec){var spec=table.getField(defaultSpec.field);return{field:spec.field,disabled:spec.disabled}}).value()})});this.$el.html(table.$el).showMessage("Waiting for data...");this.updateSorting();this.updateTableSpec()},formatHelpGroup:function formatHelpGroup(groupSpec){var betaLabel="";var helpKey="topauthors:topauthors-table-"+groupSpec.groupName.replace(/\s/g,"").toLowerCase();if(helpKey==="topauthors:topauthors-table-reach"){helpKey="reach-average"}return"".concat(groupSpec.groupName).concat(betaLabel,' <a class="help icon-bwhelp" data-key="').concat(helpKey,'"></a>')},remove:function remove(){this.collection.unbind("reset",this.render,this);this.hideContextMenu();this.table.destroy();ComponentView.prototype.remove.call(this)},updateSorting:function updateSorting(){var table=this.table;table.sortable.field=this.settings.get("orderBy");table.sortable.direction=this.settings.get("orderDirection")},updateTableSpec:function updateTableSpec(){var table=this.table,savedSpec=this.settings.get("spec");_(savedSpec).forEach(function(spec){var field=table.getField(spec.field);if(field){field.disabled=spec.disabled}})},updateQueriesColumn:function updateQueriesColumn(){var settings=this.settings,currentMode=settings.get("currentMode"),queryId=settings.get("queryId"),queriesColumn=this.table.getField("queries");queriesColumn.disabled=currentMode!=="queryGroup"&&_.isArray(queryId)&&queryId.length<=1},onDblclickAuthor:function onDblclickAuthor(e){e.preventDefault();e.stopPropagation();var $target=$(e.target),author=$target.attr("data-author");if(!author){return}this.showAuthorMenu({author:author,target:$target,openDefault:true,isTwitter:($target.attr("href")||"").match(/twitter\.com/gi),domain:$target.data("domain")})},onDblclickDomain:function onDblclickDomain(e){e.preventDefault();e.stopPropagation();var $target=$(e.target),domain=$target.text(),author=$target.closest("a.authorname").data("author");if(domain){this.showDomainMenu(domain,author,$target,true)}},onShowAuthorMenu:function onShowAuthorMenu(e){e.preventDefault();e.stopPropagation();var $target=$(e.target),author=$target.attr("data-author");if(!author){return}this.showAuthorMenu({author:author,target:$target,openDefault:e.type==="dblclick",isTwitter:($target.attr("href")||"").match(/twitter\.com/gi),domain:$target.data("domain"),publicationName:$target.attr("data-publication-name")})},showAuthorMenu:function showAuthorMenu(options){var opts=options||{};var settings=this.settings.clone();var mentionsOptions={author:opts.author,exactAuthor:true,domain:opts.domain};if(opts.publicationName){mentionsOptions.publication=opts.publicationName}settings.unset("reachMin");settings.unset("reachMax");AuthorContextMenu.show({author:opts.author,$target:opts.target,settings:settings,openDefault:opts.openDefault,isTwitterProfile:opts.isTwitter,mentionsOptions:mentionsOptions})},onShowAuthorProfile:function onShowAuthorProfile(e){var username=$(e.target).data("value");trackClickTwitterProfile(username);this.showAuthorProfile(username)},showAuthorProfile:function showAuthorProfile(author){TwitterProfileView.show(author)},onShowDomainMenu:function onShowDomainMenu(e){e.preventDefault();e.stopPropagation();var $target=$(e.target),domain=$target.data("domain"),author=$target.parents("tr").find("a.authorname").data("author"),publication=$target.data("publication");if(domain){this.showDomainMenu(domain,author,$target,e.type==="dblclick",publication)}},showDomainMenu:function showDomainMenu(domain,author,$target,openDefault,publication){DomainContextMenu.show({domain:domain,author:author,$target:$target,settings:this.settings,openDefault:openDefault,publication:publication})},hideContextMenu:function hideContextMenu(){DomainContextMenu.hide()},shown:function shown(){this.exportModel.set({showXlsCsv:true,showImage:false})},render:function render(){var $el=this.$el,table=this.table;this.updateSorting();this.updateTableSpec();if(!this.collection.size()){$el.showMessage("No results");return}$el.hideMessage();table.render();this.$el.customtip();return this}},{defaultColumns:[{name:"Author name",field:"author",width:250,sortable:true,className:"authorname",formatter:authorTableFormatter.authorNameFormatter,aggregatorText:"Total for top authors",toggleable:false},{name:"Source",field:"domain",width:200,sortable:false,className:"domainname textleft",formatter:domainNameFormatter},{name:"Mentions",field:"mentions",width:60,sortable:true,groupName:"Mentions",className:"mentions textright",formatter:mentionsTooltipFormatter,aggregator:totaliser,toggleable:false},{name:"Pos",field:"positive",width:60,sortable:true,groupName:"Mentions",className:"positive textright",formatter:mentionsTooltipFormatter,aggregator:totaliser},{name:"Neg",field:"negative",width:60,sortable:true,groupName:"Mentions",className:"negative textright",formatter:mentionsTooltipFormatter,aggregator:totaliser},{name:"Neu",field:"neutral",width:60,sortable:true,groupName:"Mentions",className:"neutral textright",formatter:mentionsTooltipFormatter,aggregator:totaliser},{name:"Queries",field:"queries",width:60,sortable:false,groupName:"Mentions",className:"queries textleft",disabled:true,formatter:queryFormatters.queriesListFormatter}],customColumnGroups:["Mentions"],tablerDefaultSettings:{columnGrouper:{formatters:{}},toggleColumns:{formatters:{},groupFormatters:{}}}});return TopAuthorsTableView});define("mustache!src/components/topauthors/templates/authorsSimpleList",["lib/mustache"],function(mustache){var escapedTemplate='{{#authorList}}\n<a data-author="{{name}}" {{#isTwitter}}href="//twitter.com/{{name}}"{{/isTwitter}} title="{{name}}{{#mentions}} ({{mentions}} mentions){{/mentions}}" class="topauthor">\n{{#isTwitter}}@{{/isTwitter}}{{name}}<br />\n</a>\n{{/authorList}}\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/components/topauthors/views/TopAuthorsSimpleListView",["backbone","mustache!src/components/topauthors/templates/authorsSimpleList"],function(Backbone,authorsSimpleListTemplate){"use strict";var TopAuthorsSimpleListView=Backbone.View.extend({initialize:function initialize(options){if(!options.collection){throw new Error("TopAuthorsSimpleListView should be initialized with a collection")}this.collection=options.collection;this.listenTo(this.collection,"reset",this.render);this.collection.settings.set({orderBy:"mentions",orderDirection:"desc"},{silent:true})},render:function render(){var authorList=this.collection.map(function(model){return{name:model.get("author"),mentions:model.get("mentions"),isTwitter:model.get("domain")==="twitter.com"}});this.$el.html(authorsSimpleListTemplate({authorList:authorList}));return this}});return TopAuthorsSimpleListView});function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};var ownKeys=Object.keys(source);if(typeof Object.getOwnPropertySymbols==="function"){ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))}ownKeys.forEach(function(key){_defineProperty(target,key,source[key])})}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}define("src/components/topauthors/models/TopAuthor",["underscore","backbone","src/globals/flags","src/globals/flagNames","src/helpers/api2queryHelper"],function(_,Backbone,flags,FLAGS,api2queryHelper){"use strict";return Backbone.Model.extend({constructor:function TopAuthor(){Backbone.Model.apply(this,arguments)},defaults:function defaults(){var enableReachMetric=flags.variation(FLAGS.ENABLE_REACH_METRIC);var defaults={queries:[],author:null,avatarUrl:null,mentions:null,volume:null,sentiment:null,domain:null,impact:null,impactAmplification:null,impactReach:null,impactRelevancy:null,publicationName:null,isOfflinePublication:false};if(enableReachMetric){return _objectSpread({},defaults,{reachEstimate:null})}return defaults},parse:function parse(result){var data=api2queryHelper.parseTopAuthorResult(result),keys=_.keys(this.defaults());if(data.hasOwnProperty("publicationName")&&!(_.isUndefined(data.publicationName)||_.isNull(data.publicationName))){data.isOfflinePublication=true}else{data.isOfflinePublication=false}return _.pick(data,keys)}})});define("src/components/topauthors/models/TopAuthorCollection",["src/models/DataCollection","src/components/topauthors/models/TopAuthor","src/components/topauthors/models/TopAuthorsControls"],function(DataCollection,TopAuthor,TopAuthorsControls){"use strict";return DataCollection.extend({model:TopAuthor,controlsModel:TopAuthorsControls,url:"/projects/{projectId}/data/volume/topauthors/queries",constructor:function TopAuthorCollection(){DataCollection.apply(this,arguments)},getQueryData:function getQueryData(){var data=this.settings.getQueryData();switch(data.orderBy){case"importanceAmplification":data.orderBy="importanceAltAmplification";break;case"importanceReach":data.orderBy="importanceAltReach";break;case"importanceRelevancy":data.orderBy="importanceAltRelevancy";break;case"importance":data.orderBy="importanceAltValue";break;case"mentions":data.orderBy="volume";break}return data},parse:function parse(data){this.backfillDetails=data.backfillDetails;return data.results}})});function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(iter){if(Symbol.iterator in Object(iter)||Object.prototype.toString.call(iter)==="[object Arguments]")return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}}define("src/components/topsites/views/TopSitesTableView",["underscore","jquery","src/globals/flags","src/globals/flagNames","src/analytics/Analytics","src/views/ComponentView","src/views/DomainContextMenu","src/views/AuthorContextMenu","src/components/topauthors/views/TopAuthorsSimpleListView","src/components/topauthors/models/TopAuthorCollection","src/formatters/queryFormatters","src/packages/datatabler","lib/tabler/tabler.sortable","lib/tabler/tabler.columnGrouper","lib/tabler/tabler.aggregator","lib/tabler/tabler.toggleColumns","mustache!src/components/topauthors/templates/authorsSimpleList"],function(_,$,flags,FLAGS,Analytics,ComponentView,DomainContextMenu,AuthorContextMenu,TopAuthorsSimpleListView,TopAuthorCollection,queryFormatters,tabler,sortable,columnGrouper,aggregator,toggleColumns,authorsSimpleListTemplate){"use strict";var AUTHOR_TOGGLER='<span class="authors-toggler" title="Collapse / expand author list"></span>';function totaliser(memo,value){return memo+parseInt(value||0,10)}function formatHelpGroup(groupSpec){var betaLabel="";var helpKey="topsites:top-sites-table-"+groupSpec.groupName.replace(/\s/g,"").toLowerCase();switch(groupSpec.groupName){case"Mentions":helpKey="topsites:top-sites-table-volume-sentiment";break;case"Site Ranking":helpKey="topsites:top-sites-table-moz-backlinks";break;case"Site Visitors":helpKey="mentions:mentions-table-site-visitors";break;case"Reach":helpKey="reach-average";break}return"".concat(groupSpec.groupName).concat(betaLabel,' <a class="help icon-bwhelp" data-key="').concat(helpKey,'"></a>')}function siteNameFormatter(v){return'<a href="http://'+v+'">'+v+"</a>"}function mozRankFormatter(v,columnDef,row){if(!v){v="n/a"}return'<a href="http://www.opensiteexplorer.org/links?site='+_.escape(row.domain)+'" target="_blank" title="Visit SEOmoz">'+(v||"")+"</a>"}function topAuthorsFormatter(value,column,row){var author=row[column.field],authorList;if(!author||!_.isObject(author)||_.isBlank(author.name)){return"n/a"}author.isTwitter=row.domain==="twitter.com";authorList=AUTHOR_TOGGLER+authorsSimpleListTemplate({authorList:[author]},false);return authorList}function averagesHeaderFormatter(columnDef,html){return html.replace("\r","<br/>").replace(/>([^<]+)</,function(match){return match.replace(/ /g,"&nbsp;")})}function topAuthorsHeaderFormatter(columnDef,value){return'<span class="authors-toggleall" title="Collapse / expand all author lists"></span> '+value}function mentionsTooltipFormatter(v,columnDef,row){if(row.queries&&row.queries.length>1){return'<span class="customtip" title="This value is the sum of mentions found across multiple Queries.<br/>'+'Be aware that duplicates are currently not being removed.">'+v+"</span>"}return v}var TopSitesTableView=ComponentView.extend({className:"topSitesTableView bwDataTable modular",events:{"click tbody td.sitename a":"onShowDomainMenu","click .authors-toggler":"onToggleAuthors","click .authors-toggleall":"onToggleAllAuthors","click .topauthor":"onShowAuthorContextMenu"},contextMenu:null,initialize:function initialize(options){ComponentView.prototype.initialize.call(this,options);_(this).bindAll("hideContextMenu","onShowDomainMenu","updateSorting");this.listenTo(this.collection,"reset",this.render);this.listenTo(this.settings,"change:queryId change:currentMode",this.updateQueriesColumn);var enableReachMetric=flags.variation(FLAGS.ENABLE_REACH_METRIC);var features=[];var groupFeatures=[];if(enableReachMetric){features.push({name:"Reach",field:"reachEstimate",title:"Average",sortable:true,width:60,groupName:"Reach",className:"textright",defaultText:"n/a"})}var self=this,columns=_.map([].concat(_toConsumableArray(TopSitesTableView.defaultColumns),features),_.clone),table=this.table=tabler.create(columns,{plugins:[sortable,columnGrouper,aggregator,toggleColumns],fetch:function fetch(options,callback){var items=self.collection.map(function(site){site=site.toJSON();return _.defaults({domain:site.domain,backlinks:site.backlinks,country:site.countryName||site.countryCode,duration:site.duration,mozRank:site.mozRank,monthlyVisitors:site.monthlyVisitors,negative:site.sentiment&&site.sentiment.negative,neutral:site.sentiment&&site.sentiment.neutral,positive:site.sentiment&&site.sentiment.positive,volume:site.volume,queries:site.queries,author:site.author},site)});callback({totalResults:items.length,items:items})}}),tablerDefaultSettings=TopSitesTableView.tablerDefaultSettings,oldRender=table.render||function(){};_.extend(table.toggleColumns.formatters,tablerDefaultSettings.toggleColumns.formatters);_.extend(table.toggleColumns.groupFormatters,tablerDefaultSettings.toggleColumns.groupFormatters);_.extend(table.columnGrouper.formatters,tablerDefaultSettings.columnGrouper.formatters);if(enableReachMetric){groupFeatures.push("Reach")}_([].concat(_toConsumableArray(TopSitesTableView.customColumnGroups),groupFeatures)).each(function(groupName){table.columnGrouper.formatters[groupName]=formatHelpGroup});table.bind("sorted",function(options){self.settings.set({orderBy:options.field,orderDirection:options.direction||"desc"});Analytics.trackEvent({name:"Component.Top Sites",action:"Sort_Table_"+self.collection.url+"_By_"+options.field,origin:"Application"})});table.toggleColumns.headerHTML='<a class="help icon-bwhelp" data-key="table-show-hide-columns"></a>';table.bind("columnsToggled",function(){self.settings.set({spec:_([].concat(_toConsumableArray(TopSitesTableView.defaultColumns),features)).chain().filter(function(defaultSpec){return defaultSpec.disabled!==table.getField(defaultSpec.field).disabled}).map(function(defaultSpec){var spec=table.getField(defaultSpec.field);return{field:spec.field,disabled:spec.disabled}}).value()})});table.render=function(){var authors=self.collection.pluck("author"),hasAuthors=_.any(authors,function(author){return author&&!!author.name});oldRender.call(this);self.$(".authors-toggleall").toggle(hasAuthors)};this.$el.html(table.$el);this.updateSorting();this.updateTableSpec();this.renderedAuthorsList=[]},waitingForData:function waitingForData(){ComponentView.prototype.waitingForData.call(this,{opacity:.33})},remove:function remove(){this.hideContextMenu();this.table.destroy();this._clearRenderedAuthorsListCache();ComponentView.prototype.remove.call(this)},_clearRenderedAuthorsListCache:function _clearRenderedAuthorsListCache(){_.invoke(this.renderedAuthorsList,"remove");this.renderedAuthorsList=[]},updateSorting:function updateSorting(){var table=this.table;table.sortable.field=this.settings.get("orderBy");table.sortable.direction=this.settings.get("orderDirection")},updateTableSpec:function updateTableSpec(){var table=this.table,savedSpec=this.settings.get("spec");_(savedSpec).forEach(function(spec){var field=table.getField(TopSitesTableView.oldFieldNameMap[spec.field]||spec.field);if(field){field.disabled=spec.disabled}})},updateQueriesColumn:function updateQueriesColumn(){var settings=this.settings,currentMode=settings.getCurrentMode(),queryId=settings.get("queryId"),queriesColumn=this.table.getField("queries");queriesColumn.disabled=currentMode!=="queryGroup"&&_.isArray(queryId)&&queryId.length<=1},onToggleAuthors:function onToggleAuthors(e){e.preventDefault();e.stopPropagation();this.toggleAuthorsColumnListing($(e.target).parent())},onToggleAllAuthors:function onToggleAllAuthors(e){e.preventDefault();e.stopPropagation();var self=this,$target=$(e.target),$tds=$target.closest("table").find("td.topauthors"),isTargetShown=$target.hasClass("shown");$tds.each(function(){var $td=$(this);if($td.find(".authors-toggler").length===1){self.toggleAuthorsColumnListing($(this),!isTargetShown)}});$target.toggleClass("shown")},toggleAuthorsColumnListing:function toggleAuthorsColumnListing($el,forceToggle){var self=this,topAuthorsSimpleListView,$tr=$el.closest("table tr"),rowIndex=$tr.index(),rowDomain,settings;if(!this.renderedAuthorsList[rowIndex]){rowDomain=this.collection.at(rowIndex).get("domain");settings=this.settings.toJSON();settings.domain=rowDomain;topAuthorsSimpleListView=new TopAuthorsSimpleListView({collection:new TopAuthorCollection([],{settings:settings})});topAuthorsSimpleListView.collection.fetch({success:function success(){$el.html(AUTHOR_TOGGLER);$el.append(topAuthorsSimpleListView.$el.children());self.renderedAuthorsList[rowIndex]=topAuthorsSimpleListView}})}$el.toggleClass("shown",forceToggle)},onClickAuthor:function onClickAuthor(e){e.preventDefault();e.stopPropagation();var $target=$(e.target),options=_(this.collection.settings.toJSON()).extend({author:$target.text().trim(),exactAuthor:true});this.showMentionInfo(options)},onShowAuthorContextMenu:function onShowAuthorContextMenu(e){e.preventDefault();e.stopPropagation();var $target=$(e.target),author=$target.data().author,domain=$target.closest("tr").find(".sitename a").text();if(author){this.showAuthorMenu(author,domain,$target,e.type==="dblclick")}},showAuthorMenu:function showAuthorMenu(author,domain,$target,openDefault){AuthorContextMenu.show({author:author,domain:domain,$target:$target,settings:this.settings,isTwitterProfile:domain.match(/twitter\.com/gi)!==null,openDefault:openDefault})},onShowDomainMenu:function onShowDomainMenu(e){e.preventDefault();e.stopPropagation();var $target=$(e.target),domain=$target.text();if(domain){this.showDomainMenu(domain,$target,e.type==="dblclick")}},showDomainMenu:function showDomainMenu(domain,$target,openDefault){DomainContextMenu.show({domain:domain,$target:$target,settings:this.settings,openDefault:openDefault})},hideContextMenu:function hideContextMenu(){DomainContextMenu.hide()},render:function render(){var $el=this.$el,table=this.table;this._clearRenderedAuthorsListCache();this.updateSorting();this.updateTableSpec();if(!this.collection.size()){$el.showMessage("No results");return}$el.hideMessage();table.render();this.$el.customtip();return this}},{defaultColumns:[{name:"Site name",field:"domain",width:250,sortable:false,className:"sitename",formatter:siteNameFormatter,aggregatorText:"Total for top sites",toggleable:false},{name:"Mentions",field:"volume",width:60,sortable:true,groupName:"Mentions",className:"mentions textright",formatter:mentionsTooltipFormatter,aggregator:totaliser,toggleable:false},{name:"Pos",field:"positive",width:60,sortable:true,groupName:"Mentions",className:"positive textright",formatter:mentionsTooltipFormatter,aggregator:totaliser},{name:"Neg",field:"negative",width:60,sortable:true,groupName:"Mentions",className:"negative textright",formatter:mentionsTooltipFormatter,aggregator:totaliser},{name:"Neu",field:"neutral",width:60,sortable:true,groupName:"Mentions",className:"neutral textright",formatter:mentionsTooltipFormatter,aggregator:totaliser},{name:"Queries",field:"queries",width:60,sortable:false,groupName:"Mentions",className:"queries textleft",disabled:true,formatter:queryFormatters.queriesListFormatter},{name:"mozRank",field:"mozRank",sortable:true,formatter:mozRankFormatter,groupName:"Site Ranking",className:"mozRank textright",defaultText:"n/a"},{name:"Backlinks",field:"backlinks",sortable:true,groupName:"Site Ranking",className:"textright",defaultText:"n/a",aggregator:totaliser},{name:"Visitors/Month",field:"monthlyVisitors",sortable:true,groupName:"Site Visitors",className:"textright",aggregator:totaliser,defaultText:"n/a"},{name:"Avg.\rVisits",field:"averageVisits",headerFormatter:averagesHeaderFormatter,sortable:true,disabled:true,groupName:"Site Visitors",className:"textleft",defaultText:"n/a"},{name:"Avg.\rPages",field:"averagePages",headerFormatter:averagesHeaderFormatter,sortable:true,disabled:true,groupName:"Site Visitors",className:"textleft",defaultText:"n/a"},{name:"Avg.\rTime (min)",field:"duration",headerFormatter:averagesHeaderFormatter,sortable:true,groupName:"Site Visitors",className:"textleft",aggregator:totaliser,defaultText:"n/a"},{name:"% Male",field:"percentMale",sortable:true,disabled:true,groupName:"Site Visitors",className:"textright",defaultText:"n/a"},{name:"% Female",field:"percentFemale",sortable:true,disabled:true,groupName:"Site Visitors",className:"textright",defaultText:"n/a"},{name:"Top Authors",field:"author",width:150,headerFormatter:topAuthorsHeaderFormatter,formatter:topAuthorsFormatter,sortable:false,disabled:false,groupName:"Site Visitors",className:"topauthors textleft",defaultText:"n/a"},{name:"Location",field:"country",title:"",width:150,sortable:false,groupName:"Location",className:"country",defaultText:"n/a"}],customColumnGroups:["Mentions","Site Ranking","Site Visitors"],oldFieldNameMap:{comscoreAverageVisits:"averageVisits",comscoreAveragePages:"averagePages",comscorePercentMale:"percentMale",comscorePercentFemale:"percentFemale"},tablerDefaultSettings:{columnGrouper:{formatters:{}},toggleColumns:{formatters:{},groupFormatters:{}}}});return TopSitesTableView});define("mustache!src/components/tweeters/templates/mentionstooltip",["lib/mustache"],function(mustache){var escapedTemplate='<span class="customtip" title="This value is the sum of mentions found across multiple Queries.\n<br/>Be aware that duplicates are currently not being removed.">{{value}}</span>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/components/tweeters/views/utils/tweetersTableColumns",["src/formatters/authorTableFormatter","src/formatters/queryFormatters","src/extensions/demographicssummary/formatters/demographicsFormatters","mustache!src/components/tweeters/templates/mentionstooltip"],function(authorTableFormatter,queryFormatters,demographicsFormatters,mentionsTooltipTemplate){"use strict";function totaliser(memo,value){return memo+parseInt(value||0,10)}function mentionsTooltipFormatter(value,column,row){if(row.queries&&row.queries.length>1){return mentionsTooltipTemplate({value:value})}return value}function getColumns(){return[{name:"Tweeter",field:"accountname",width:250,sortable:true,className:"accountname textleft",formatter:authorTableFormatter.authorNameFormatter,aggregatorText:"Total for tweeters",toggleable:false},{name:"Matching Tweets",field:"volume",width:60,sortable:true,className:"mentions textright",formatter:mentionsTooltipFormatter,aggregator:totaliser},{name:"Queries",field:"queries",width:60,sortable:false,className:"queries textleft",formatter:queryFormatters.queriesListFormatter,disabled:true},{name:"Pos",field:"positive",width:60,sortable:true,className:"positive textright",groupName:"Sentiment",formatter:mentionsTooltipFormatter,aggregator:totaliser},{name:"Neg",field:"negative",width:60,sortable:true,className:"negative textright",groupName:"Sentiment",formatter:mentionsTooltipFormatter,aggregator:totaliser},{name:"Neu",field:"neutral",width:60,sortable:true,className:"neutral textright",groupName:"Sentiment",formatter:mentionsTooltipFormatter,aggregator:totaliser},{name:"Followers",field:"followers",width:60,sortable:true,className:"followers textright",groupName:"Twitter",aggregator:totaliser},{name:"Following",field:"following",width:60,sortable:true,className:"following textright",groupName:"Twitter",aggregator:totaliser,disabled:true},{name:"Twitter Author Reach",field:"reach",width:60,sortable:true,className:"reach textright",groupName:"Twitter",aggregator:totaliser,disabled:true},{name:"Total Tweets",field:"tweets",width:60,sortable:true,className:"tweets textright",groupName:"Twitter",aggregator:totaliser,disabled:true},{name:"Account Type",field:"accountType",width:60,sortable:true,className:"js-accountType nowrap",groupName:"Demographics",formatter:demographicsFormatters.formatAccountType},{name:"Gender",field:"gender",width:60,sortable:true,className:"js-gender nowrap",groupName:"Demographics",formatter:demographicsFormatters.formatGender},{name:"Profession",field:"professions",width:60,sortable:false,className:"js-profession nowrap",groupName:"Demographics",formatter:demographicsFormatters.formatProfessions,disabled:true},{name:"Interest",field:"interest",width:60,sortable:false,className:"js-interest nowrap",groupName:"Demographics",formatter:demographicsFormatters.formatInterests,disabled:true},{name:"Author City",field:"authorCity",width:60,sortable:false,className:"js-authorCity nowrap",groupName:"Demographics",disabled:true},{name:"Author County",field:"authorCounty",width:60,sortable:false,className:"js-authorCounty nowrap",groupName:"Demographics",disabled:true},{name:"Author State",field:"authorState",width:60,sortable:false,className:"js-authorState nowrap",groupName:"Demographics",disabled:true},{name:"Author Country",field:"authorCountry",width:60,sortable:false,className:"js-authorCountry nowrap",groupName:"Demographics",disabled:true},{name:"Author Continent",field:"authorContinent",width:60,sortable:false,className:"js-authorContinent nowrap",groupName:"Demographics",disabled:true},{name:"Influence",field:"influence",width:60,sortable:true,className:"influence textright",groupName:"Kred",aggregator:totaliser},{name:"Outreach",field:"outreach",width:60,sortable:true,className:"outreach textright",groupName:"Kred",aggregator:totaliser}]}return{getColumns:getColumns}});define("mustache!src/components/tweeters/templates/header",["lib/mustache"],function(mustache){var escapedTemplate='<a class="help icon-bwhelp" data-key="table-show-hide-columns"></a>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/components/tweeters/templates/row",["lib/mustache"],function(mustache){var escapedTemplate='<tr class="{{bodyRowClassName}}" data-authorname="{{accountname}}">\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(iter){if(Symbol.iterator in Object(iter)||Object.prototype.toString.call(iter)==="[object Arguments]")return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}}define("src/components/tweeters/views/TweetersTableView",["underscore","jquery","src/analytics/Analytics","src/globals/flags","src/globals/flagNames","src/views/ComponentView","src/components/mentions/_mentionsprofile/views/TwitterProfileView","src/views/AuthorContextMenu","src/views/GenderAccountTypeContextMenuView","src/views/ProfessionInterestContextMenuView","src/components/tweeters/views/utils/tweetersTableColumns","src/packages/datatabler","lib/tabler/tabler.sortable","lib/tabler/tabler.columnGrouper","lib/tabler/tabler.aggregator","lib/tabler/tabler.toggleColumns","src/globals/demographicsUpdates","mustache!src/components/tweeters/templates/header","mustache!src/components/tweeters/templates/row"],function(_,$,Analytics,flags,FLAGS,ComponentView,TwitterProfileView,AuthorContextMenu,GenderAccountTypeContextMenuView,ProfessionInterestContextMenuView,tweetersTableColumns,tabler,sortable,columnGrouper,aggregator,toggleColumns,demographicsUpdates,headerTemplate,rowTemplate){"use strict";function formatHelpGroup(groupSpec){var groupName=groupSpec.groupName.replace(/\s/g,"").toLowerCase();var helpKey=groupName==="twitter"?"twitter-table-tweeters":"twitter-table-"+groupName;var modalClassPart="";var betaLabel="";if(helpKey==="twitter-table-demographics"){modalClassPart=' data-modal-css-class="sevencol"'}if(helpKey==="twitter-table-reach"){helpKey="reach-average"}var markup=" <a".concat(modalClassPart,' class="help icon-bwhelp" data-key="').concat(helpKey,'"></a>');var helpGroup="".concat(groupSpec.groupName).concat(betaLabel).concat(markup);return helpGroup}var TweetersTableView=ComponentView.extend({className:"tweetersTableView bwDataTable modular",events:{"click td .account":"onClickAccountName","dblclick td .account":"onDbClickAccountName","click td .profile":"onClickProfile","click td.js-gender a":function showGenderContextMenu(e){var topAuthorModel,contextMenu;e.preventDefault();topAuthorModel=this.getTopAuthorFromEl(e.target);contextMenu=GenderAccountTypeContextMenuView.show({$target:$(e.target),gender:topAuthorModel.get("gender"),analyticsCategory:"Component.Tweeters"});if(!contextMenu){return}this.stopListening(contextMenu);this.listenToOnce(contextMenu,"uiChangeGenderAction",function(gender){demographicsUpdates.updateGender({username:topAuthorModel.get("accountname"),gender:gender});Analytics.trackEvent({name:"Component.Tweeters",action:"Update_Gender_"+_.capitalize(topAuthorModel.get("gender")||"unknown")+"_"+_.capitalize(gender),origin:"Application"})})},"click td.js-accountType a":function showAccountTypeContextMenu(e){var topAuthorModel,contextMenu;e.preventDefault();topAuthorModel=this.getTopAuthorFromEl(e.target);contextMenu=GenderAccountTypeContextMenuView.show({$target:$(e.target),accountType:topAuthorModel.get("accountType"),analyticsCategory:"Component.Tweeters"});if(!contextMenu){return}this.stopListening(contextMenu);this.listenToOnce(contextMenu,"uiChangeAccountTypeAction",function(accountType){demographicsUpdates.updateAccountType({username:topAuthorModel.get("accountname"),accountType:accountType});Analytics.trackEvent({name:"Component.Tweeters",action:"Update_AccountType_"+_.capitalize(topAuthorModel.get("accountType")||"unknown")+"_"+_.capitalize(accountType),origin:"Application"})})},"click td.js-profession a":function showProfessionContextMenu(e){var topAuthorModel,contextMenu;e.preventDefault();topAuthorModel=this.getTopAuthorFromEl(e.target);contextMenu=ProfessionInterestContextMenuView.show({$target:$(e.target),username:topAuthorModel.get("accountname"),professions:topAuthorModel.get("professions"),analyticsCategory:"Component.Tweeters"});if(!contextMenu){return}this.stopListening(contextMenu);this.listenToOnce(contextMenu,"uiChangeProfessionsAction",function(updatedProfessions){demographicsUpdates.updateProfessions({username:topAuthorModel.get("accountname"),professions:updatedProfessions});Analytics.trackEvent({name:"Component.Tweeters",action:"Update_Professions",origin:"Application"})})},"click td.js-interest a":function showInterestContextMenu(e){var topAuthorModel,contextMenu;e.preventDefault();topAuthorModel=this.getTopAuthorFromEl(e.target);contextMenu=ProfessionInterestContextMenuView.show({$target:$(e.target),username:topAuthorModel.get("accountname"),interests:topAuthorModel.get("interest"),analyticsCategory:"Component.Tweeters"});if(!contextMenu){return}this.stopListening(contextMenu);this.listenToOnce(contextMenu,"uiChangeInterestsAction",function(updatedInterests){demographicsUpdates.updateInterests({username:topAuthorModel.get("accountname"),interests:updatedInterests});Analytics.trackEvent({name:"Component.Tweeters",action:"Update_Interests",origin:"Application"})})}},initialize:function initialize(options){ComponentView.prototype.initialize.call(this,options);this.listenTo(this.collection,"change",this.render);this.listenTo(this.collection,"sync",this.render);this.listenTo(this.collection,"reset",this.render);this.listenTo(this.settings,"change:queryId change:currentMode",this.updateQueriesColumn);var enableReachMetric=flags.variation(FLAGS.ENABLE_REACH_METRIC);var features=[];var groupFeatures=[];if(enableReachMetric){features.push({name:"Reach",title:"Average",field:"reachEstimate",width:60,sortable:true,className:"reachCol textright",groupName:"Reach",defaultText:"n/a"})}var self=this,columns=_.map([].concat(_toConsumableArray(TweetersTableView.defaultColumns),features),_.clone),table=this.table=tabler.create(columns,{plugins:[sortable,columnGrouper,aggregator,toggleColumns],fetch:function fetch(options,callback){var items=self.collection.map(function(tweeter){return tweeter.toJSON()});callback({items:items})}}),tablerDefaultSettings=TweetersTableView.tablerDefaultSettings;_.extend(table.toggleColumns.formatters,tablerDefaultSettings.toggleColumns.formatters);_.extend(table.toggleColumns.groupFormatters,tablerDefaultSettings.toggleColumns.groupFormatters);_.extend(table.columnGrouper.formatters,tablerDefaultSettings.columnGrouper.formatters);if(enableReachMetric){groupFeatures.push("Reach")}_([].concat(_toConsumableArray(TweetersTableView.customColumnGroups),groupFeatures)).each(function(groupName){table.columnGrouper.formatters[groupName]=formatHelpGroup});table.bind("sorted",function(sortOptions){self.collection.settings.set({orderBy:sortOptions.field,orderDirection:sortOptions.direction});Analytics.trackEvent({name:"Component.Tweeters",action:"Sort_Table_"+self.collection.url+"_By_"+sortOptions.field,origin:"Application"})});table.toggleColumns.headerHTML=headerTemplate({});table.bind("columnsToggled",function(){self.collection.settings.set({spec:_([].concat(_toConsumableArray(TweetersTableView.defaultColumns),features)).chain().filter(function(defaultSpec){return defaultSpec.disabled!==table.getField(defaultSpec.field).disabled}).map(function(defaultSpec){var spec=table.getField(defaultSpec.field);return{field:spec.field,disabled:spec.disabled}}).value()})});table.renderBodyTr=function(row){return rowTemplate({bodyRowClassName:table.bodyRowClassName,accountname:row.accountname})};this.$el.html(table.$el).showMessage("Waiting for data...");this.updateSorting();this.updateTableSpec()},showValidationError:function showValidationError(){this.table.$el.empty();ComponentView.prototype.showValidationError.call(this)},updateSorting:function updateSorting(){var table=this.table;table.sortable.field=this.collection.settings.get("orderBy");table.sortable.direction=this.collection.settings.get("orderDirection")},updateTableSpec:function updateTableSpec(){var table=this.table,savedSpec=this.collection.settings.get("spec");_(savedSpec).forEach(function(spec){table.getField(spec.field).disabled=spec.disabled})},updateQueriesColumn:function updateQueriesColumn(){var settings=this.settings,currentMode=settings.getCurrentMode(),queryId=settings.get("queryId"),queriesColumn=this.table.getField("queries");queriesColumn.disabled=currentMode!=="queryGroup"&&_.isArray(queryId)&&queryId.length<=1},getAuthorNameFromEl:function getAuthorNameFromEl(el){var $el=$(el);return $el.closest("tr").attr("data-authorname")},onClickAccountName:function onClickAccountName(e){e.preventDefault();e.stopPropagation();this.showAuthorMenu(this.getAuthorNameFromEl(e.target),$(e.target))},showAuthorMenu:function showAuthorMenu(author,$target,doDefault){var settings=this.settings.clone();settings.unset("reachMin");settings.unset("reachMax");AuthorContextMenu.show({author:author,$target:$target,settings:settings,openDefault:doDefault,isTwitterProfile:true})},onDbClickAccountName:function onDbClickAccountName(e){e.preventDefault();e.stopPropagation();this.showAuthorMenu(this.getAuthorNameFromEl(e.target),$(e.target),true)},onClickProfile:function onClickProfile(e){e.preventDefault();e.stopPropagation();this.showAuthorProfile(this.getAuthorNameFromEl(e.target))},showAuthorProfile:function showAuthorProfile(author){TwitterProfileView.show(author)},setupExportModel:function setupExportModel(){this.exportModel.set({showXlsCsv:true,showImage:false})},shown:function shown(){this.setupExportModel()},waitingForData:function waitingForData(){ComponentView.prototype.waitingForData.call(this,{opacity:.33})},render:function render(){var table=this.table;this.updateSorting();this.updateTableSpec();if(!this.collection.size()){table.$el.addClass("hidden");this.noResults();return}this.clearMessage();table.render();table.$el.removeClass("hidden");this.$el.customtip();return this},getTopAuthorFromEl:function getTopAuthorFromEl(el){var authorName=this.getAuthorNameFromEl(el);return this.collection.find(function(model){return model.get("accountname")===authorName})}},{defaultColumns:tweetersTableColumns.getColumns(),customColumnGroups:["Kred","Sentiment","Twitter","Demographics"],tablerDefaultSettings:{columnGrouper:{formatters:{}},toggleColumns:{formatters:{},groupFormatters:{}}}});return TweetersTableView});define("mustache!src/controls/filters/templates/impact",["lib/mustache"],function(mustache){var escapedTemplate='<p>\n<a rel="impact" class="toggle">\n<span class="icon-chevron-right grey smallpadding-right"></span>{{filterName}}\n</a>\n<span data-rel="impact" class="active-indicator {{groupClass}}">On</span>\n</p>\n<fieldset class="impact hidden">\n<p class="impact clearfix">\n<span class="indicator doubleheight {{#getTickClass}}impact{{/getTickClass}}" data-tick-key="impact"></span>\n<label>Total</label>\n<input name="impactMin" placeholder="Min" class="field num" pattern="{{isPositiveNumberRegex}}" value="{{impactMin}}"/>\n<span> to </span>\n<input name="impactMax" placeholder="Max" class="field num" pattern="{{isPositiveNumberRegex}}" value="{{impactMax}}"/>\n{{#showHelp}}\n<a class="help icon-bwhelp" data-key="{{helpKey}}"></a>\n{{/showHelp}}\n</p>\n</fieldset>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/controls/css/impactFilters.css",["css!src/controls/css/compiled.css"],function(){});define("src/controls/filters/ImpactFilters",["underscore","src/controls/filters/FiltersView","mustache!src/controls/filters/templates/impact","css!src/controls/css/impactFilters.css"],function(_,FiltersView,template){"use strict";return FiltersView.extend({constructor:function ImpactFilters(){FiltersView.apply(this,arguments)},makeEl:function makeEl(data){return template(this.getTemplateData(data))},getTemplateData:function getTemplateData(){return _(FiltersView.prototype.getTemplateData.call(this)).extend({filterName:"Impact",helpKey:"filters-impact"})},getFilterIndicatorStatuses:function getFilterIndicatorStatuses(model){var ticks={impact:!this.isNullOrEmpty(model.get("impactMin"))||!this.isNullOrEmpty(model.get("impactMax"))},groups=ticks.impact;return{tickIndicators:ticks,groupIndicators:groups}}})});define("src/extensions/Impact",["underscore","bw-fe-helpers/arrayHelper","src/ModuleWrapper","src/analytics/Analytics","src/extensions/demographicssummary/configuration/DemographicsDashboardConfiguration","src/components/mentions/MentionsComponent","src/controlsAttributesRewriter","src/models/Controls","src/components/topauthors/models/TopAuthorsControls","src/components/tweeters/models/TweetersControls","src/components/mentions/models/MentionsControls","src/views/AlertControlsView","src/components/mentions/views/MentionsControlsView","src/components/mentions/_table/MentionsTableView","src/components/mentions/_table/MentionsTableColumns","src/views/RuleControlsView","src/components/topauthors/views/TopAuthorsTableView","src/components/topsites/views/TopSitesTableView","src/components/tweeters/views/TweetersTableView","src/controls/filters/BlogFilters","src/controls/filters/ImpactFilters"],function(_,arrayHelper,ModuleWrapper,Analytics,DemographicsDashboardConfiguration,MentionsComponent,controlsAttributesRewriter,Controls,TopAuthorsControls,TweetersControls,MentionsControls,AlertControlsView,MentionsControlsView,MentionsTableView,MentionsTableColumns,RuleControlsView,TopAuthorsTableView,TopSitesTableView,TweetersTableView,BlogFilters,ImpactFilters){"use strict";var moduleWrapper=new ModuleWrapper,active=false;function addImpactFilterAfterBlogFilter(getFilters,viewOptions){var filters=getFilters(viewOptions);var authorFilterIndex=filters.findIndex(function(filter){return filter instanceof BlogFilters});filters.splice(authorFilterIndex+1,0,new ImpactFilters(viewOptions));return filters}function extendColumnsWithImpact(columnsArray,fieldName,groupName,columnNameToInsertAfter){arrayHelper.insertAfter(columnsArray,{name:columnNameToInsertAfter},{name:"Impact",title:"Total",field:fieldName,id:fieldName,width:90,sortable:true,groupName:groupName,className:"total onecolmin textright",defaultText:"-",headerFormatter:function headerFormatter(colSpec,title){return title}});return columnsArray}return{id:"Impact",GROUP_NAME:"Impact",isActive:function isActive(){return active},addImpactColumnToMentionsTableView:function addImpactColumnToMentionsTableView(fieldName,columnNameToInsertAfter){var ImpactExtension=this;moduleWrapper.wrap(MentionsTableColumns,"getDefaultColumns",function(originalFunc,options){if(options.restrictMarkup){return originalFunc(options)}var defaultColumns=originalFunc(options);return extendColumnsWithImpact(defaultColumns,fieldName,ImpactExtension.GROUP_NAME,columnNameToInsertAfter)});this.addImpactColumnGroupToTableView(MentionsTableView);this.addImpactGroupFormatterToTableView(MentionsTableView)},addImpactColumnToTableView:function addImpactColumnToTableView(TableView,fieldName,columnNameToInsertAfter){moduleWrapper.backup(TableView,"defaultColumns");extendColumnsWithImpact(TableView.defaultColumns,fieldName,this.GROUP_NAME,columnNameToInsertAfter);this.addImpactColumnGroupToTableView(TableView);this.addImpactGroupFormatterToTableView(TableView)},addImpactColumnGroupToTableView:function addImpactColumnGroupToTableView(TableView){if(TableView.customColumnGroups){moduleWrapper.backup(TableView,"customColumnGroups");TableView.customColumnGroups.push(this.GROUP_NAME)}},addImpactGroupFormatterToTableView:function addImpactGroupFormatterToTableView(TableView){if(TableView.tablerDefaultSettings){moduleWrapper.backup(TableView,"tablerDefaultSettings");TableView.tablerDefaultSettings.toggleColumns.groupFormatters[this.GROUP_NAME]=function(name){return name}}},addImpactColumnToTableViews:function addImpactColumnToTableViews(){this.addImpactColumnToMentionsTableView("impact","Timestamp");this.addImpactColumnToTableView(TopSitesTableView,"impact","Queries");this.addImpactColumnToTableView(TopAuthorsTableView,"impact","Queries");this.addImpactColumnToTableView(TweetersTableView,"impact","Neu");moduleWrapper.backup(MentionsControls,"columnNameMap");MentionsControls.columnNameMap.impact="impact"},setDefaultSorting:function setDefaultSorting(){var defaultSorting={orderBy:"impact",orderDirection:"descending"};moduleWrapper.wrap(TopAuthorsControls.prototype,"defaults",function(originalFunc){return _.extend(originalFunc(),defaultSorting)});moduleWrapper.wrap(TweetersControls.prototype,"defaults",function(originalFunc){return _.extend(originalFunc(),defaultSorting)});DemographicsDashboardConfiguration.spec.tabs.forEach(function(tab){tab.components.forEach(function(component){if(component.settings&&!_(component.settings).has("orderBy")||component.title.indexOf("by Volume")!==-1){return}if(component.type==="topsites"||component.type==="topauthors"||component.type==="toptweeters"){_.extend(component.settings,defaultSorting)}})})},addImpactFilter:function addImpactFilter(){moduleWrapper.wrap(MentionsControlsView.prototype,"getFilters",function(originalFunc,viewOptions){if(this.componentType==="youtubementions"){return originalFunc.call(this,viewOptions)}return addImpactFilterAfterBlogFilter.call(this,originalFunc,viewOptions)});moduleWrapper.wrap(AlertControlsView.prototype,"getFilters",function(originalFunc,viewOptions){return addImpactFilterAfterBlogFilter.call(this,originalFunc,viewOptions)});moduleWrapper.wrap(RuleControlsView.prototype,"getFilters",function(originalFunc,viewOptions){return addImpactFilterAfterBlogFilter.call(this,originalFunc,viewOptions)});moduleWrapper.wrap(controlsAttributesRewriter,"cleanAttributes",function(originalFunc,attrs){if(attrs.impactTotalMin){attrs.impactMin=attrs.impactTotalMin;delete attrs.impactTotalMin}if(attrs.impactTotalMax){attrs.impactMax=attrs.impactTotalMax;delete attrs.impactTotalMax}return originalFunc(attrs)});moduleWrapper.wrap(Controls.prototype,"dataSpec",function(originalFunc){return _.extend(originalFunc(),{impactMin:{type:"positiveNumber",lessThan:"impactMax"},impactMax:{type:"positiveNumber",greaterThan:"impactMin"}})});moduleWrapper.wrap(Controls.prototype,"getQueryDataFieldNames",function whitelistImpact(originalFunc){return originalFunc().concat(["impactMin","impactMax"])})},trackImpactFilter:function trackImpactFilter(){moduleWrapper.wrap(MentionsComponent.prototype,"initialize",function(originalFunc,options){originalFunc(options);this.settings.on("change",this.trackImpactFilter,this)});MentionsComponent.prototype.trackImpactFilter=function(){var filters={impactMin:parseInt(this.settings.get("impactMin"),10)||"",impactMax:parseInt(this.settings.get("impactMax"),10)||""};var filterValues;if(_.isNumber(filters.impactMin)||_.isNumber(filters.impactMax)){filterValues=_(filters).reduce(function(memo,value,key){if(value!==""){memo+="_"+key+"="+value}return memo},"");Analytics.trackEvent({name:"Component.Mentions",action:"Filter_"+this.collection.url+filterValues,origin:"Application"})}};moduleWrapper.wrap(MentionsComponent.prototype,"remove",function(originalFunc){this.settings.off("change",this.trackImpactFilter,this);originalFunc()})},apply:function apply(){this.addImpactColumnToTableViews();this.setDefaultSorting();this.addImpactFilter();this.trackImpactFilter();active=true},restore:function restore(){moduleWrapper.restore();delete MentionsComponent.prototype.trackImpactFilter;active=false}}})})();