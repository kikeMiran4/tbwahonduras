define(["jquery","src/views/ComponentView","src/components/mentions/views/MentionsPopup","src/components/mentions/_singlemention/views/SingleMentionView","src/components/mentions/models/MentionCollection","src/components/keyinsights/helpers/keyInsightsHelper","src/components/keyinsights/helpers/keyInsightsViewDataHelpers","src/components/keyinsights/helpers/constants","src/components/keyinsights/views/KeyInsightsTotalMentions","src/components/keyinsights/views/KeyInsightsUniqueAuthors","src/components/keyinsights/views/KeyInsightsTrendingTopics","src/components/keyinsights/views/KeyInsightsTopStories","src/components/keyinsights/views/KeyInsightsUniqueImages","src/components/keyinsights/views/KeyInsightsTopHashtags","src/helpers/componentRestrictions","src/packages/customtip","css!src/components/keyinsights/css/keyInsights.css"],function($,ComponentView,MentionsPopup,SingleMentionView,MentionCollection,keyInsightsHelper,viewDataHelpers,constants,KeyInsightsTotalMentions,KeyInsightsUniqueAuthors,KeyInsightsTrendingTopics,KeyInsightsTopStories,KeyInsightsUniqueImages,KeyInsightsTopHashtags,componentRestrictions){"use strict";var subViewClasses=[KeyInsightsTotalMentions,KeyInsightsUniqueImages,KeyInsightsUniqueAuthors,KeyInsightsTrendingTopics,KeyInsightsTopStories,KeyInsightsTopHashtags];function getActionFromDomEvent($target){switch($target.data("type")){case constants.totalMentions:return{type:constants.totalMentions};case constants.topStories:return{type:constants.topStories,mentionId:$target.data("id")};case constants.trendingTopics:return{type:constants.trendingTopics,topicLabel:$target.text().trim()};case constants.topHashtags:return{type:constants.topHashtags,hashtag:$target.text()};default:return{}}}function handlePanelAction(action,model){switch(action.type){case constants.totalMentions:return MentionsPopup.showMentions({settings:model.settings});case constants.trendingTopics:return MentionsPopup.showMentions({settings:model.settings,additionalOptions:{search:'"'.concat(action.topicLabel,'"')}});case constants.topStories:var topStories=model.get("topStories");var mentionsCollection=new MentionCollection(topStories);return SingleMentionView.show({mentions:mentionsCollection,mentionId:action.mentionId});case constants.topHashtags:return MentionsPopup.showMentions({settings:model.settings,additionalOptions:{search:"hashtags:".concat(action.hashtag.replace("#",""))}})}}return ComponentView.extend({className:"key-insights",events:{"click .js-panel-action":"onPanelAction"},constructor:function KeyInsightsComponentView(){var _this=this;ComponentView.apply(this,arguments);this.subViews=new Map;subViewClasses.forEach(function(ViewClass){_this.subViews.set(ViewClass,new ViewClass)});this.listenTo(this.model,"sync",this.render)},render:function render(){var showTopStories=keyInsightsHelper.shouldShowTopNewsStories(this.settings);var showUniqueImages=keyInsightsHelper.shouldShowUniqueImages(this.settings);var showTopHashtags=keyInsightsHelper.shouldShowTopHashtags(this.settings);var showTrendingTopics=!componentRestrictions.isRestricted("topics");var viewData=viewDataHelpers.format(this.model.toJSON());this.$el.html([this.subViews.get(KeyInsightsTotalMentions),showUniqueImages?this.subViews.get(KeyInsightsUniqueImages):undefined,showTopHashtags?undefined:this.subViews.get(KeyInsightsUniqueAuthors),showTrendingTopics?this.subViews.get(KeyInsightsTrendingTopics):undefined,showTopStories?this.subViews.get(KeyInsightsTopStories):undefined,showTopHashtags?this.subViews.get(KeyInsightsTopHashtags):undefined].filter(function(view){return view}).map(function(view){return view.render(viewData[view.type])}));this.$el.customtip()},onPanelAction:function onPanelAction(event){var action=getActionFromDomEvent($(event.currentTarget));var model=this.model;event.preventDefault();handlePanelAction(action,model)}})});