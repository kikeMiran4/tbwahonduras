(function(){define("src/helpers/dashboardExports/access",["src/globals/flags","src/globals/flagNames","src/globals/theme"],function(flags,FLAGS,theme){"use strict";return{userCanExport:function userCanExport(){if(flags.variation(FLAGS.DASHBOARD_EXPORT_FORCE_WHITELABEL)){return true}if(flags.variation(FLAGS.DASHBOARD_EXPORT)&&theme.isBrandwatchOrGreyLabelTheme()){return true}return false}}});define("src/extensions/ReportsExtension",["underscore","app","src/helpers/dashboardExports/access","src/ModuleWrapper","src/permissions","src/views/navigation/navigationHelper"],function(_,app,dashboardExportsAccessHelper,ModuleWrapper,permissions,navigationHelper){"use strict";var active=false,moduleWrapper=new ModuleWrapper;function loadReportsRouteHandler(app,callback){if(app.reportsRoute){return setTimeout(function(){callback(app.reportsRoute)},0)}require(["src/extensions/reports/routes/reportsRoute"],function(reportsRoute){app.reportsRoute=reportsRoute;callback(reportsRoute)})}return{id:"Reports",addReportsNavigation:function addReportsNavigation(){moduleWrapper.wrap(navigationHelper,"getSidebarItems",function(originalFunc){var items=originalFunc();var insertIndex=_.pluck(items,"routeId").indexOf("alerts");var reportsItem={routeId:"reports",name:"Reports",icon:"bar-chart",colourId:navigationHelper.getSidebarColours().SHARABLE_REPORTS_COLOUR_ID,colour:"#45c0d9"};items.splice(insertIndex,0,reportsItem);return items});moduleWrapper.wrap(navigationHelper,"getSubmenuItems",function(originalFunc){var items=originalFunc();if(dashboardExportsAccessHelper.userCanExport()){items.reports=[{name:"Exported Dashboards",routeId:"reports/exports",colourId:navigationHelper.getSidebarColours().SHARABLE_REPORTS_COLOUR_ID},{name:"Automated Reports",routeId:"reports/automated",colourId:navigationHelper.getSidebarColours().SHARABLE_REPORTS_COLOUR_ID}]}return items})},addReportsRouting:function addReportsRouting(){app.route("project/:id/reports","showReports",_.bind(this.showReports,this));if(dashboardExportsAccessHelper.userCanExport()){app.route("project/:id/reports/exports","showExports",_.bind(this.showExports,this));app.route("project/:id/reports/automated","showAutomated",_.bind(this.showAutomated,this))}},showExports:function showExports(projectId){loadReportsRouteHandler(app,function(handler){handler.loadExportsDownloadPage(projectId)})},showReports:function showReports(projectId){loadReportsRouteHandler(app,function(handler){handler.loadLandingPage(projectId)})},showAutomated:function showAutomated(projectId){loadReportsRouteHandler(app,function(handler){handler.loadAutomatedReportsPage(projectId)})},isActive:function isActive(){return active},apply:function apply(){if(!permissions.check("see.reports")){return}if(active){return}active=true;this.addReportsNavigation();this.addReportsRouting()},restore:function restore(){if(!active){return}active=false;moduleWrapper.restore();if(app.reportsRoute){app.reportsRoute.unload()}}}})})();