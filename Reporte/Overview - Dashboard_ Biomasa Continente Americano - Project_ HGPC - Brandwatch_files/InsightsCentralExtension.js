(function(){define("src/extensions/insightscentral/models/wrapProject",["underscore"],function(_){"use strict";function wrapProject(moduleWrapper){moduleWrapper.wrapModule("src/models/Project",function(err,Project){moduleWrapper.defineProperty(Project.prototype,"isPublishedProject",function(){return!!this.get("published")});moduleWrapper.wrap(Project.prototype,"sync",function(originalFunc,method,model,options){var attrs;options=options||{};attrs=options.attrs||model.toJSON();options.attrs=_.omit(attrs,"published","imageUrl","sector","useCase");return originalFunc.call(this,method,model,options)})})}return wrapProject});define("mustache!templates/appModal",["lib/mustache"],function(mustache){var escapedTemplate='<article class="bw-modal__popup">\n<div class="abstop absright doublepadding-top doublepadding-right">\n<a class="bw-modal__close js-modal-close icon-remove lightgrey singlepadding"></a>\n</div>\n<header class="js-modal-header bw-modal__header pagemargin-horizontal pagepadding-top"></header>\n<aside class="js-modal-filter rowborder pagemargin-horizontal"></aside>\n<section class="js-modal-content bw-modal__content pagepadding-horizontal bwscrollbar"></section>\n</article>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!css/appModal.css",["css!css/compiled.css"],function(){});define("src/views/AppModalView",["jquery","backbone","mustache!templates/appModal","css!css/appModal.css"],function($,Backbone,renderAppModalTemplate){"use strict";function listenToEsc(view){$(document).on("keydown.js-modal",function(e){if(e.keyCode===27){view.remove()}})}var AppModalView=Backbone.View.extend({className:"bw-modal js-modal modular",events:{click:function click(e){if(!$(e.target).hasClass("js-modal")){return}this.remove()},"click .js-modal-close":function clickJsModalClose(e){e.preventDefault();this.remove()}},constructor:function AppModalView(options){options=options||{};this.$header=options.$header;this.$content=options.$content;Backbone.View.apply(this,arguments);listenToEsc(this)},render:function render(){this.$el.html(renderAppModalTemplate());if(this.$header){this.$el.find(".js-modal-header").html(this.$header)}if(this.$content){this.$el.find(".js-modal-content").html(this.$content)}},remove:function remove(){$(document).off("keydown.js-modal");Backbone.View.prototype.remove.call(this)}},{show:function show(options){var view,ViewClass=this;options=options||{};view=new ViewClass(options);view.render();$("body").append(view.$el);return view}});return AppModalView});define("mustache!src/extensions/insightscentral/templates/list/insightListViewHeader",["lib/mustache"],function(mustache){var escapedTemplate='<div class="sevencolmax dib">\n<h1 class="pagetitletext smallpadding-bottom margin--zero">\n<span>Insights Central</span>\n</h1>\n<p class="biggertext grey doublepadding-bottom margin--zero">Dig deep into Brandwatch Use-Case and Research Projects</p>\n</div>\n<div class="mediumtext normalfont">\nOur selection of pre-built <strong>Projects</strong>, created by Brandwatch experts, presents insights and applications from across a variety of topics and industries. Check them out and copy them to your own account for <strong>free</strong>!\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/extensions/insightscentral/views/list/InsightListHeaderView",["backbone","mustache!src/extensions/insightscentral/templates/list/insightListViewHeader"],function(Backbone,renderInsightListHeaderTemplate){"use strict";var InsightListHeaderView=Backbone.View.extend({constructor:function InsightListHeaderView(){Backbone.View.apply(this,arguments)},render:function render(){return this.$el.html(renderInsightListHeaderTemplate())}});return InsightListHeaderView});define("mustache!src/extensions/insightscentral/templates/list/filterContextMenuView",["lib/mustache"],function(mustache){var escapedTemplate='{{#isLoaded}}\n<ul>\n{{#items}}\n<li data-id="{{id}}" class="context-menu--item iconindent{{#isSelected}} disabled{{/isSelected}}">\n{{#isSelected}} <span class="icon-ok lightgrey singlepadding-left"></span>{{/isSelected}}{{label}}\n</li>\n{{/items}}\n</ul>\n{{/isLoaded}}\n{{^isLoaded}}\n<div class="bw-ic-filtermenu__loader loading"></div>\n{{/isLoaded}}\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/extensions/insightscentral/css/list/filterContextMenu.css",["css!src/extensions/insightscentral/css/list/compiled.css"],function(){});define("src/extensions/insightscentral/views/list/FilterContextMenuView",["jquery","underscore","src/views/ContextMenuView","mustache!src/extensions/insightscentral/templates/list/filterContextMenuView","css!src/extensions/insightscentral/css/list/filterContextMenu.css"],function($,_,ContextMenuView,template){"use strict";var ITEM_SELECTED="ITEM_SELECTED";function onClickSelect(view,event){var $target=$(event.currentTarget);var id=$target.data("id")||undefined;view.collection.selection=id;view.trigger(ITEM_SELECTED)}function getItems(collection){var ret=[];collection.forEach(function(model){var id=model.cid;var isSelected=id===collection.selection;var label=model.get("label");if(!label){return}ret.push({id:id,isSelected:isSelected,label:label})});ret.unshift({label:"All",isSelected:collection.selection===undefined});return ret}function getTemplateData(collection){return{items:getItems(collection),isLoaded:!!collection.isLoaded}}var FilterContextMenuView=ContextMenuView.extend({tagName:"nav",className:"bw-ic-filtermenu context-menu popupframe",events:function events(){return{'click li:not(".disabled")':_.partial(onClickSelect,this)}},initialize:function initialize(options){if(!options.collection){throw new Error("options.collection is missing")}this.collection=options.collection;this.listenTo(this.collection,"sync",this.render);this.collection.load()},render:function render(){this.$el.html(template(getTemplateData(this.collection)))}});FilterContextMenuView.ITEM_SELECTED=ITEM_SELECTED;return FilterContextMenuView});define("mustache!src/extensions/insightscentral/templates/list/insightListFilterView",["lib/mustache"],function(mustache){var escapedTemplate='<ul class="bw-ic-filter">\n<li class="js-filter bw-ic-filter__link" data-name="language">\nLanguage: {{#selectedLanguage}}<span class="darkgrey">{{.}}</span>{{/selectedLanguage}}{{^selectedLanguage}}All{{/selectedLanguage}}\n<span class="icon-chevron-down"></span>\n</li>\n<li class="js-filter bw-ic-filter__link" data-name="sector">\nSector: {{#selectedSector}}<span class="darkgrey">{{.}}</span>{{/selectedSector}}{{^selectedSector}}All{{/selectedSector}}\n<span class="icon-chevron-down"></span>\n</li>\n<li class="js-filter bw-ic-filter__link" data-name="usecase">\nUse Case: {{#selectedUsecase}}<span class="darkgrey">{{.}}</span>{{/selectedUsecase}}{{^selectedUsecase}}All{{/selectedUsecase}}\n<span class="icon-chevron-down"></span>\n</li>\n</ul>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/extensions/insightscentral/css/list/insightListFilter.css",["css!src/extensions/insightscentral/css/list/compiled.css"],function(){});define("src/extensions/insightscentral/views/list/InsightListFilterView",["jquery","underscore","backbone","src/extensions/insightscentral/views/list/FilterContextMenuView","mustache!src/extensions/insightscentral/templates/list/insightListFilterView","css!src/extensions/insightscentral/css/list/insightListFilter.css"],function($,_,Backbone,FilterContextMenuView,renderInsightListFilterTemplate){"use strict";var FILTER_CHANGED="FILTER_CHANGED";function showFilterList(view,options){var contextMenuView=FilterContextMenuView.show(options);view.listenTo(contextMenuView,FilterContextMenuView.ITEM_SELECTED,_.partial(onItemSelected,view))}function onItemSelected(view){view.trigger(FILTER_CHANGED);view.render()}function getTemplateData(collectionMap){return{selectedLanguage:getSelectedText(collectionMap.language),selectedSector:getSelectedText(collectionMap.sector),selectedUsecase:getSelectedText(collectionMap.usecase)}}function getSelectedText(collection){var model=collection.get(collection.selection);if(!model){return}return model.get("label")}var InsightListFilterView=Backbone.View.extend({events:{"click .js-filter":function clickJsFilter(event){var $target=$(event.currentTarget);var collectionName=$target.data("name");var collection=this.collectionMap[collectionName];showFilterList(this,{$target:$target,collection:collection})}},constructor:function InsightListFilterView(options){this.collectionMap={language:options.languageFilterCollection,sector:options.sectorFilterCollection,usecase:options.useCaseFilterCollection};Backbone.View.apply(this,arguments)},render:function render(){return this.$el.html(renderInsightListFilterTemplate(getTemplateData(this.collectionMap)))}});InsightListFilterView.FILTER_CHANGED=FILTER_CHANGED;return InsightListFilterView});define("mustache!src/extensions/insightscentral/templates/list/insightListViewContent",["lib/mustache"],function(mustache){var escapedTemplate='<div class="bw-ic-content doublemargin-top">\n<ul class="bw-ic-content__grid">\x3c!--\n{{#list}}\n--\x3e<li class="bw-ic-content__griditem">\n<div class="bw-ic-content__tilecontainer">\n<div class="bw-ic-content__tile robotolightfont">\n<div class="bw-ic-content__tileinfo">\n{{#imageUrl}}<img src="{{imageUrl}}" class="db fullwidth">{{/imageUrl}}\n<h3 class="bw-ic-content__title darkgrey singlepadding">{{name}}</h3>\n<p class="absbottom absleft singlepadding mediumtext lightgrey">by Brandwatch</p>\n</div>\n<div class="bw-ic-content__tiledetail singlepadding-horizontal">\n<div class="bw-ic-content__description singlepadding-horizontal bwscrollbar-narrow">\n<h3 class="bw-ic-content__title darkgrey singlepadding-vertical">{{name}}</h3>\n<p class="normalfont mediumtext-bigline">{{description}}</p>\n</div>\n<a class="js-project bw-ic-content__button button defaultbutton textcenter" data-project-id="{{id}}">Explore Project for Free</a>\n</div>\n</div>\n</div>\n</li>\x3c!--\n{{/list}}\n--\x3e</ul>\n{{^list}}\n<div class="bw-ic-content__noresult textcenter pagepadding-top">\n<p class="grey bigtext">Sorry, no Projects were found matching your search.</p>\n<p class="lightgrey bigtext smallpadding-top">Try modifying your search criteria.</p>\n</div>\n{{/list}}\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/extensions/insightscentral/css/list/insightListContent.css",["css!src/extensions/insightscentral/css/list/compiled.css"],function(){});define("src/extensions/insightscentral/views/list/InsightListContentView",["jquery","backbone","mustache!src/extensions/insightscentral/templates/list/insightListViewContent","src/packages/waitmask","css!src/extensions/insightscentral/css/list/insightListContent.css"],function($,Backbone,renderInsightListContentTemplate){"use strict";var InsightListContentView=Backbone.View.extend({events:{"click .js-project":function onClickProject(e){this.trigger("select",$(e.currentTarget).data("projectId"))}},constructor:function InsightListContentView(options){this.insightProjectCollection=options.insightProjectCollection;Backbone.View.apply(this,arguments)},showLoader:function showLoader(){this.$el.showWaitmask({text:"Loading..",applyPosition:false})},showResults:function showResults(err,collection){this.$el.hideWaitmask().html(renderInsightListContentTemplate({list:collection.toJSON()}))},render:function render(){var view=this;this.showLoader();this.insightProjectCollection.load(function(err,collection){view.showResults(err,collection)});return this.$el}});return InsightListContentView});define("src/extensions/insightscentral/views/list/InsightListView",["underscore","src/views/AppModalView","src/extensions/insightscentral/views/list/InsightListHeaderView","src/extensions/insightscentral/views/list/InsightListFilterView","src/extensions/insightscentral/views/list/InsightListContentView"],function(_,AppModalView,InsightListHeaderView,InsightListFilterView,InsightListContentView){"use strict";function selectProject(view,projectId){view.trigger("select",projectId);view.remove()}function initializeSubViews(view){view.headerView=new InsightListHeaderView({el:view.$(".js-modal-header")});view.contentView=new InsightListContentView({el:view.$(".js-modal-content"),insightProjectCollection:view.insightProjectCollection});view.filterView=new InsightListFilterView({el:view.$(".js-modal-filter"),languageFilterCollection:view.languageFilterCollection,sectorFilterCollection:view.sectorFilterCollection,useCaseFilterCollection:view.useCaseFilterCollection});view.listenTo(view.contentView,"select",_.partial(selectProject,view));view.listenTo(view.filterView,InsightListFilterView.FILTER_CHANGED,_.partial(onFilterChanged,view))}function renderSubViews(view){view.headerView.render();view.contentView.render();view.filterView.render()}function removeSubViews(view){if(view.headerView){view.headerView.remove()}if(view.contentView){view.contentView.remove()}if(view.filterView){view.filterView.remove()}}function onFilterChanged(view){view.contentView.showLoader();view.insightProjectCollection.filter({language:view.languageFilterCollection.getSelectionLabel(),sector:view.sectorFilterCollection.getSelectionLabel(),usecase:view.useCaseFilterCollection.getSelectionLabel()},function(err,collection){view.contentView.showResults(err,collection)})}var InsightListView=AppModalView.extend({constructor:function InsightListView(options){options=options||{};this.insightProjectCollection=options.insightProjectCollection;this.languageFilterCollection=options.languageFilterCollection;this.sectorFilterCollection=options.sectorFilterCollection;this.useCaseFilterCollection=options.useCaseFilterCollection;AppModalView.apply(this,arguments)},render:function render(){AppModalView.prototype.render.apply(this,arguments);initializeSubViews(this);renderSubViews(this)},remove:function remove(){removeSubViews(this);AppModalView.prototype.remove.call(this)}});return InsightListView});define("src/extensions/insightscentral/models/PublishedProjectsCollection",["backbone","src/ApiError"],function(Backbone,ApiError){"use strict";return Backbone.Collection.extend({constructor:function PublishedProjectsCollection(){Backbone.Collection.apply(this,arguments)},url:"/projects/published",parse:function parse(response){return response.results},getQueryData:function getQueryData(){return this.filterOptions},filter:function filter(options,callback){this.reset();this.filterOptions=options;this.load(callback)},load:function load(callback){var collection=this;if(typeof callback!=="function"){throw new Error("Please supply a callback!")}collection.fetch().then(function success(){callback(null,collection)},function error(xhr){callback(new ApiError(xhr))})},reset:function reset(){this.filterOptions=undefined;return Backbone.Collection.prototype.reset.apply(this,arguments)}})});define("src/extensions/insightscentral/models/InsightCentralFilterCollection",["backbone"],function(Backbone){"use strict";return Backbone.Collection.extend({isLoaded:false,url:"/projects/published/category",constructor:function InsightCentralFilterCollection(data,options){Backbone.Collection.apply(this,arguments);if(!options||!options.name){throw new Error("options.name is missing")}this.filterName=options.name},load:function load(){if(this.isLoaded){return}this.fetch()},parse:function parse(response){return response.map(function(value){return{label:value}})},getQueryData:function getQueryData(){return{name:this.filterName}},fetch:function fetch(options){var originalSuccess;var model=this;options=options||{};originalSuccess=options.success;options.success=function(){model.isLoaded=true;if(originalSuccess){originalSuccess()}};return Backbone.Collection.prototype.fetch.call(this,options)},getSelectionLabel:function getSelectionLabel(){if(!this.selection){return}return this.get(this.selection).get("label")}})});define("src/extensions/insightscentral/insightscentralHelpers",["app","src/globals/me","src/globals/currentProject","src/events/insightsCentralEvents","src/extensions/insightscentral/events/globalEventNames","src/extensions/insightscentral/views/list/InsightListView","src/extensions/insightscentral/models/PublishedProjectsCollection","src/extensions/insightscentral/models/InsightCentralFilterCollection"],function(app,me,currentProject,insightsCentralEvents,globalEventNames,InsightListView,PublishedProjectsCollection,InsightCentralFilterCollection){"use strict";var RESEARCHER_PERMISSIONS_IN_RESEARCH_PROJECT=["see.projects","see.engagement.twitterIntents","see.dashboard.component.changeView","see.dashboard.component.optionsSummary","see.userPreferenceMenu","see.mentions","copy.research.projects"];function navigateToSelectedProject(projectId){if(!projectId){throw new Error("No insight central project id supplied")}insightsCentralEvents.trigger(globalEventNames.insightsCentral.OPEN_PROJECT,{projectId:projectId});app.navigate("/project/".concat(projectId,"/dashboards"),{trigger:true})}function showInsightsCentralProject(referrer){var languageFilterCollection=new InsightCentralFilterCollection(null,{name:"language"});var sectorFilterCollection=new InsightCentralFilterCollection(null,{name:"sector"});var useCaseFilterCollection=new InsightCentralFilterCollection(null,{name:"usecase"});var insightListView=InsightListView.show({insightProjectCollection:new PublishedProjectsCollection,languageFilterCollection:languageFilterCollection,sectorFilterCollection:sectorFilterCollection,useCaseFilterCollection:useCaseFilterCollection});insightsCentralEvents.trigger(globalEventNames.insightsCentral.OPEN_STORE,{referrer:referrer});insightListView.once("select",navigateToSelectedProject)}function researcherHasPermission(permission){return RESEARCHER_PERMISSIONS_IN_RESEARCH_PROJECT.indexOf(permission)!==-1}function hasAccessAsResearcher(){return currentProject.isPublishedProject()&&me.id!==currentProject.get("creatorUserId")}return{showInsightsCentralProject:showInsightsCentralProject,navigateToSelectedProject:navigateToSelectedProject,researcherHasPermission:researcherHasPermission,hasAccessAsResearcher:hasAccessAsResearcher}});define("src/extensions/insightscentral/views/wrapDashboardCollectionView",["src/extensions/insightscentral/insightscentralHelpers"],function(insightscentralHelpers){"use strict";function wrapDashboardCollectionView(moduleWrapper){moduleWrapper.wrapModule("src/views/DashboardCollectionView",function(err,DashboardView){moduleWrapper.wrap(DashboardView.prototype,"getTableTemplateData",function(originalFunc){var templateData=originalFunc();if(insightscentralHelpers.hasAccessAsResearcher()){templateData.showShareStatus=false}return templateData})})}return wrapDashboardCollectionView});define("src/extensions/insightscentral/models/CopyProjectUsageEstimate",["backbone"],function(Backbone){"use strict";function onSync(model){model.fetched=true}return Backbone.Model.extend({url:"projects/{projectId}/copy/usageestimate",constructor:function CopyProjectUsageEstimate(){Backbone.Model.apply(this,arguments);this.on("sync",onSync.bind(null,this))}})});define("mustache!src/extensions/insightscentral/templates/copyProjectConfirmation",["lib/mustache"],function(mustache){var escapedTemplate='<div class="copy-project-confirmation ninecol pagepadding">\n<h1 class="popuptitletext draggable">Copy this Project to Your Account?</h1>\n<div>\n<p class="singlemargin-top">By copying this Project you will have <strong>full control</strong> of the Project’s Queries, Rules and Dashboard configurations in your own account.</p>\n<p class="singlemargin-top"><strong>For Dashboards looking at historical time periods you may not see any data in your own copy at first.</strong> Your Project will only be filled with data from the last month automatically: if you want to get data from earlier you will need to request a Backfill.</p>\n<p class="singlemargin-top">There are no additional costs for copying Projects but Queries copied to your account and Mentions you start collecting now <strong>will count towards your monthly limit</strong>. Otherwise it works as if you’d created the Project yourself.</p>\n<p class="singlemargin-top">Read more about copying Projects in the <a class="js-help-center-link" target="_blank" href="{{helpCenterUrl}}">Help Center</a>.</p>\n</div>\n{{#loading}}<div class="singlemargin-top textcenter"><span class="loading dib"></span></div>{{/loading}}\n{{^loading}}{{{allowanceData}}}{{/loading}}\n<div class="doublemargin-top">\n<button class="js-confirm defaultbutton floatleft" {{#preventCopy}}disabled{{/preventCopy}}>\nCopy this Project to my Account\n</button>\n<button class="js-decline button singlemargin-left">\nNot Now\n</button>\n</div>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/extensions/insightscentral/templates/copyProjectQueryAllowance",["lib/mustache"],function(mustache){var escapedTemplate='<div class="doublemargin-top">\n<p class="bold">Query Usage</p>\n</div>\n{{#overLimit}}\n<div class="notice-err notification-error relative rounded singlepadding-horizontal smallpadding-vertical singlemargin-top mediumline">\n<p>The Copy of this Project will bring you over your monthly allowance.</p>\n<p>Please talk to your account contact if you wish to discuss your Query limit.</p>\n</div>\n{{/overLimit}}\n<div class="allowance-data singlemargin-top">\n<div class="allowance-panel singlepadding-vertical floatleft">\n<p class="allowance-label smalltext">Your monthly</p>\n<p class="allowance-label smalltext">Queries allowance</p>\n<p class="allowance-number robotolightfont">{{available}}</p>\n</div>\n<div class="allowance-panel singlepadding-vertical dib">\n<p class="allowance-label smalltext">Queries</p>\n<p class="allowance-label smalltext">in your Projects</p>\n<p class="allowance-number robotolightfont">{{used}}</p>\n</div>\n<div class="allowance-panel smallpadding-vertical floatright">\n<div class="lightgreybg smallpadding-vertical smallpadding-left">\n<p class="allowance-label smalltext">Queries</p>\n<p class="allowance-label smalltext">in this project</p>\n<p class="allowance-number robotolightfont">\n<span class="{{#overLimit}}color-error{{/overLimit}}{{^overLimit}}color-ok{{/overLimit}}">\n{{required}}\n</span>\n</p>\n</div>\n</div>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("mustache!src/extensions/insightscentral/templates/copyProjectMentionAllowance",["lib/mustache"],function(mustache){var escapedTemplate='<div class="doublemargin-top">\n<p class="bold">Data Usage Estimation</p>\n<p>Based on your Queries\' usage of the last 30 days and a <strong>rough prediction</strong> for the Queries contained in this Project.</p>\n</div>\n{{#overLimit}}\n<div class="notice-warn notification-warning relative rounded singlepadding-horizontal smallpadding-vertical singlemargin-top mediumline">\n<p>The Copy of this Project will likely bring you over your monthly allowance.</p>\n<p>Please talk to your account contact if you wish to discuss your mention limit.</p>\n</div>\n{{/overLimit}}\n<div class="allowance-data singlemargin-top">\n<div class="allowance-panel singlepadding-vertical floatleft">\n<p class="allowance-label smalltext">Your monthly<p>\n<p class="allowance-label smalltext">mentions allowance<p>\n<p class="allowance-number robotolightfont">{{available}}</p>\n</div>\n<div class="allowance-panel singlepadding-vertical dib">\n<p class="allowance-label smalltext">Estimated mentions</p>\n<p class="allowance-label smalltext">for your Projects</p>\n<p class="allowance-number robotolightfont">{{used}}</p>\n<p class="allowance-hint grey smalltext">Estimated for the next 30 days</p>\n</div>\n<div class="allowance-panel smallpadding-vertical floatright">\n<div class="lightgreybg smallpadding-vertical smallpadding-left">\n<p class="allowance-label smalltext">Estimated mentions</p>\n<p class="allowance-label smalltext">for this project</p>\n<p class="allowance-number robotolightfont">\n<span {{^overLimit}}class="color-ok"{{/overLimit}}>{{required}}</span>\n{{#overLimit}}<span class="icon-warning-sign biggertext color-warn"></span>{{/overLimit}}\n</p>\n<p class="allowance-hint grey smalltext">Estimated for the next 30 days</p>\n</div>\n</div>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("css!src/extensions/insightscentral/css/copyProjectConfirmation.css",["css!src/extensions/insightscentral/css/compiled.css"],function(){});define("src/extensions/insightscentral/views/CopyProjectConfirmationView",["backbone","underscore","src/helpers/clientHelper","bw-fe-helpers/numberHelper","src/extensions/insightscentral/models/CopyProjectUsageEstimate","mustache!src/extensions/insightscentral/templates/copyProjectConfirmation","mustache!src/extensions/insightscentral/templates/copyProjectQueryAllowance","mustache!src/extensions/insightscentral/templates/copyProjectMentionAllowance","css!src/extensions/insightscentral/css/copyProjectConfirmation.css","src/packages/modalDialogs"],function(Backbone,_,clientHelper,numberHelper,CopyProjectUsageEstimate,renderCopyProjectConfirmationTemplate,renderCopyProjectQueryAllowanceTemplate,renderCopyProjectMentionAllowanceTemplate){"use strict";var KEY_MAP={queries:{available:"clientQueryLimit",used:"clientQueryCount",required:"srcProjectQueryCount"},mentions:{available:"clientMentionLimit",used:"estimatedClientMentionsPerMonth",required:"estimatedProjectMentionsPerMonth"}};function getUsageData(usageData,keys){var available=usageData[keys.available];var used=usageData[keys.used];var required=usageData[keys.required];return{available:available,used:used,required:required,overLimit:required>available-used}}function getTemplateData(model){var data=model.toJSON();var hasValidQueryLimit=clientHelper.hasValidQueryLimit(data.clientQueryLimit);var usageData;var helpCenterUrl="/supportsso?return_to="+encodeURIComponent("https://support.brandwatch.com/hc/en-us/articles/213767377");if(!model.fetched){return{loading:true,preventCopy:true,helpCenterUrl:helpCenterUrl}}if(hasValidQueryLimit){usageData=getUsageData(data,KEY_MAP.queries);return{loading:false,preventCopy:usageData.overLimit,helpCenterUrl:helpCenterUrl,allowanceData:renderCopyProjectQueryAllowanceTemplate(usageData,false)}}usageData=getUsageData(data,KEY_MAP.mentions);return{loading:false,preventCopy:false,helpCenterUrl:helpCenterUrl,allowanceData:renderCopyProjectMentionAllowanceTemplate({available:usageData.available<1?"N/A":numberHelper.prettyNumber(usageData.available),used:numberHelper.prettyNumber(usageData.used),required:numberHelper.prettyNumber(usageData.required),overLimit:usageData.available<1?false:usageData.overLimit},false)}}function triggerResponseAndClose(view,response){view.trigger("response",response,view.trackingData||{});view.remove()}function memorizeTrackingData(view){var hasValidQueryLimit=clientHelper.hasValidQueryLimit(view.model.get("clientQueryLimit"));var allowancdeType=hasValidQueryLimit?"queries":"mentions";var usageData=getUsageData(view.model.toJSON(),KEY_MAP[allowancdeType]);view.trackingData={allowanceType:allowancdeType,allowanceExceeded:usageData.overLimit,allowanceDiff:usageData.available-usageData.used-usageData.required}}var CopyProjectConfirmationView=Backbone.View.extend({events:{"click .js-confirm":function onClickConfirm(){triggerResponseAndClose(this,CopyProjectConfirmationView.COPY_CONFIRM)},"click .js-decline":function onClickDecline(){triggerResponseAndClose(this,CopyProjectConfirmationView.COPY_DECLINE)}},constructor:function CopyProjectConfirmationView(){Backbone.View.apply(this,arguments);if(!this.model){throw new Error("options.model must be set")}this.listenTo(this.model,"sync",this.render);this.listenTo(this.model,"sync",memorizeTrackingData.bind(null,this))},render:function render(){var templateData=getTemplateData(this.model);this.$el.html(renderCopyProjectConfirmationTemplate(templateData));this.$el.centreModal()}},{show:function show(options){var model=new CopyProjectUsageEstimate;var view=new CopyProjectConfirmationView(_.extend({model:model},options));var originalRemove=view.remove;view.remove=function(){this.$el.removeModal();originalRemove.call(this)};view.render();view.$el.showModal({draggable:".draggable",onClose:function onClose(){triggerResponseAndClose(view,CopyProjectConfirmationView.COPY_CLOSE)}});model.fetch();return view}});CopyProjectConfirmationView.COPY_CONFIRM="copyConfirm";CopyProjectConfirmationView.COPY_DECLINE="copyDecline";CopyProjectConfirmationView.COPY_CLOSE="copyClose";return CopyProjectConfirmationView});define("mustache!src/extensions/insightscentral/templates/insightsCentralProjectNotification",["lib/mustache"],function(mustache){var escapedTemplate='<div class="js-insightscentral-project-notification insightscentral-project-notification notification-info {{notificationClass}}">\n<div class="notification-text doublepadding-horizontal singlepadding-vertical">\n<span class="icon-lock floatleft smallpadding-right"></span>\n<span>This Project is read-only.</span>\n{{#canCopyProjects}}\n<a title="Click to learn more" class="copy-button js-request-copy customtip rounded tinypadding-vertical singlepadding-horizontal smallmargin-left">Get Full Control</a>\n{{/canCopyProjects}}\n{{^canCopyProjects}}\n<span class="js-request-copy-permission-hint">You do not have permission to copy Insights Central Projects. Please contact your Admin if you’d like to request a copy.</span>\n{{/canCopyProjects}}\n</div>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/extensions/insightscentral/views/wrapDashboardView",["jquery","src/ApiError","underscore","src/permissions","src/globals/currentProject","src/globals/me","src/events/insightsCentralEvents","src/extensions/insightscentral/views/CopyProjectConfirmationView","src/extensions/insightscentral/events/globalEventNames","src/extensions/insightscentral/insightscentralHelpers","mustache!src/extensions/insightscentral/templates/insightsCentralProjectNotification"],function($,ApiError,_,permissions,currentProject,currentUser,insightsCentralEvents,CopyProjectConfirmationView,globalEventNames,insightscentralHelpers,renderResearchProjectNotification){"use strict";function trackEvent(options){insightsCentralEvents.trigger(globalEventNames.insightsCentral.PROJECT_COPY_REQUESTED,_.extend({srcProjectId:currentProject.id},options))}function onProjectCopySuccess(dstProject,trackingData){$.notify({text:"Thank you, we'll email "+currentUser.get("username")+" when your copy is ready.",className:"notification-success",duration:1e4});trackEvent(_.extend({dstProjectId:dstProject.id},trackingData))}function onProjectCopyFailure(response,trackingData){var apiError=new ApiError(response);$.notify({text:apiError.message,className:"notification-error",duration:1e4});trackEvent(_.extend({errorCode:parseInt(apiError.errorCodes[0],10)},trackingData))}function showResearchProjectNotification(view,notificationClass){if(!insightscentralHelpers.hasAccessAsResearcher()){return}view.$el.prepend(renderResearchProjectNotification({canCopyProjects:permissions.check("copy.research.projects"),notificationClass:notificationClass})).customtip({position:"bottom"});setTimeout(function(){view.$(".js-insightscentral-project-notification").addClass("shown")},1500)}function showCopyRequestConfirmation(view){var confirmationView=CopyProjectConfirmationView.show();view.listenToOnce(confirmationView,"response",function(response,trackingData){if(response===CopyProjectConfirmationView.COPY_CLOSE){trackEvent(_.extend({abortReason:"close"},trackingData));return}if(response===CopyProjectConfirmationView.COPY_DECLINE){trackEvent(_.extend({abortReason:"cancel"},trackingData));return}if(response===CopyProjectConfirmationView.COPY_CONFIRM){currentProject.copy({data:JSON.stringify({structureOnly:true}),success:function success(dstProject){onProjectCopySuccess(dstProject,trackingData)},error:function error(response){onProjectCopyFailure(response,trackingData)}})}})}function wrapDashboardView(moduleWrapper){moduleWrapper.wrapModule("src/views/DashboardView",function(err,DashboardView){moduleWrapper.wrap(DashboardView.prototype,"events",function(originalFunc){return _.extend({},originalFunc(),{"click .js-request-copy":function clickJsRequestCopy(e){e.stopPropagation();showCopyRequestConfirmation(this)}})});moduleWrapper.wrap(DashboardView.prototype,"render",function(originalFunc){originalFunc.call(this);showResearchProjectNotification(this)})})}return wrapDashboardView});define("mustache!src/extensions/insightscentral/templates/insightsCentralHeaderBreadcrumb",["lib/mustache"],function(mustache){var escapedTemplate='<div class="insights-central dib valigntop">\n<div class="breadcrumb">\n<div class="js-home breadcrumb-item customtip" title="Your Projects">{{productName}}</div>\n<span class="arrow icon-chevron-right"></span>\n\n<div class="js-insightscentral breadcrumb-item customtip" title="Research Projects">Insights Central</div>\n<span class="arrow icon-chevron-right"></span>\n\n<span class="project-label">Project:</span>\n<span class="js-current-project-name current-project-name bold textellipsis dib fourcolmax customtip ellipsistooltip"></span>\n</div>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/extensions/insightscentral/views/wrapHeaderView",["underscore","app","src/globals/theme","src/globals/currentProject","src/extensions/insightscentral/insightscentralHelpers","mustache!src/extensions/insightscentral/templates/insightsCentralHeaderBreadcrumb","src/packages/customtip"],function(_,app,theme,currentProject,insightscentralHelpers,renderInsightsCentralHeaderBreadcrumb){"use strict";function wrapHeaderView(moduleWrapper){moduleWrapper.wrapModule("src/views/HeaderView",function(err,HeaderView){moduleWrapper.backup(HeaderView.prototype,"events");_(HeaderView.prototype.events).extend({"click .js-insightscentral":function onClickInsightProjects(){insightscentralHelpers.showInsightsCentralProject("appHeader")},"click .js-home":function onClickHome(){app.navigate("/",{trigger:true})}});moduleWrapper.wrap(HeaderView.prototype,"render",function(originalFunc){originalFunc();this.$(".projectMenu").removeClass("tencolmax").addClass("twelvecolmax");this.$(".projectSwitcherContainer").append(renderInsightsCentralHeaderBreadcrumb({productName:theme.productName}));this.$(".insights-central .customtip").customtip({position:"bottom",offset:[3,0]})});moduleWrapper.wrap(HeaderView.prototype,"initialize",function(originalFunc){var self=this;originalFunc.apply(self,Array.prototype.slice.call(arguments,1));currentProject.onLoad(function(callback){var projectName=currentProject.get("name");self.$(".js-current-project-name").text(projectName).prop("title",projectName).customtip({position:"bottom",offset:[3,0]});callback()})});moduleWrapper.wrap(HeaderView.prototype,"hideProjectSwitcher",function(originalFunc){originalFunc();this.userMenuView.hideInsightsCentralLink()});moduleWrapper.wrap(HeaderView.prototype,"showProjectSwitcher",function(originalFunc){originalFunc();this.userMenuView.showInsightsCentralLink()})})}return wrapHeaderView});define("mustache!src/extensions/insightscentral/templates/projectsPageInsightsCentralLink",["lib/mustache"],function(mustache){var escapedTemplate='<div class="b-promolist__item">\n<div class="b-promolist__headline smallmargin-bottom" data-at="promo-content-headline">Insights Central</div>\n<div class="b-promolist__description singlemargin-bottom">Our selection of pre-built Projects, created by Brandwatch experts</div>\n<a class="js-insightscentral singlepmargin-top">Go to Insights Central</a>\n</div>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/extensions/insightscentral/views/wrapProjectSelectionPageView",["underscore","src/extensions/insightscentral/insightscentralHelpers","mustache!src/extensions/insightscentral/templates/projectsPageInsightsCentralLink"],function(_,insightscentralHelpers,renderProjectsPageInsightsCentralLink){"use strict";var PROMO_TITLE="or explore";var VIEW_SELECTORS={PROMO:".js-promo-content"};function addPromoView(view){view.$(VIEW_SELECTORS.PROMO).append(renderProjectsPageInsightsCentralLink())}function wrapProjectSelectionPageView(moduleWrapper){moduleWrapper.wrapModule("src/views/pages/ProjectSelectionPageView",function(err,ProjectSelectionPageView){moduleWrapper.backup(ProjectSelectionPageView.prototype,"events");_(ProjectSelectionPageView.prototype.events).extend({"click .js-insightscentral":function onClickResearchProjects(){insightscentralHelpers.showInsightsCentralProject("projectSelection")}});moduleWrapper.wrap(ProjectSelectionPageView.prototype,"render",function(originalFunc){this.promoTitle=PROMO_TITLE;originalFunc();addPromoView(this)})})}return wrapProjectSelectionPageView});define("src/extensions/insightscentral/views/wrapProjectSwitcherView",[],function(){"use strict";function wrapProjectSwitcherView(moduleWrapper){moduleWrapper.wrapModule("src/views/ProjectSwitcherView",function(err,ProjectSwitcherView){moduleWrapper.backup(ProjectSwitcherView.prototype,"className");ProjectSwitcherView.prototype.className+=" dib"})}return wrapProjectSwitcherView});define("src/extensions/insightscentral/views/wrapNavigationView",["src/extensions/insightscentral/insightscentralHelpers"],function(insightscentralHelpers){"use strict";function removeSidebarForResearchers(originalFunc){if(insightscentralHelpers.hasAccessAsResearcher()){return this.$el.empty().removeClass("sidebar--collapsed")}originalFunc.call(this)}function wrapNavigationView(moduleWrapper){moduleWrapper.wrapModule("src/views/navigation/NavigationView",function(err,Navigation){moduleWrapper.wrap(Navigation.prototype,"render",removeSidebarForResearchers)})}return wrapNavigationView});define("mustache!src/extensions/insightscentral/templates/insightsCentralHeaderLink",["lib/mustache"],function(mustache){var escapedTemplate='<li class="insights-central-link doublemargin-right valignmiddle">\n<a class="js-insightscentral-usermenu">\n<span class="smallpadding-left nowrap dib">Insights Central</span>\n</a>\n</li>\n';return function(data,partials,wrap){return mustache.render(escapedTemplate,data,partials,wrap)}});define("src/extensions/insightscentral/views/wrapUserMenuView",["underscore","src/globals/flags","src/globals/flagNames","src/extensions/insightscentral/insightscentralHelpers","mustache!src/extensions/insightscentral/templates/insightsCentralHeaderLink"],function(_,flags,FLAGS,insightscentralHelpers,renderInsightsCentralHeaderLink){"use strict";function wrapUserMenuView(moduleWrapper){moduleWrapper.wrapModule("src/views/navigation/UserMenuView",function(err,UserMenuView){moduleWrapper.wrap(UserMenuView.prototype,"events",function(originalFunc){return _(originalFunc()).extend({"click .js-insightscentral-usermenu":function onClickInsightProjects(){insightscentralHelpers.showInsightsCentralProject("userMenu")}})});moduleWrapper.wrap(UserMenuView.prototype,"render",function(originalFunc){originalFunc();if(flags.variation(FLAGS.ENABLE_HOMEPAGE)){return}this.$el.prepend(renderInsightsCentralHeaderLink())});moduleWrapper.defineProperty(UserMenuView.prototype,"hideInsightsCentralLink",function(){this.$(".insights-central-link").addClass("hidden")});moduleWrapper.defineProperty(UserMenuView.prototype,"showInsightsCentralLink",function(){this.$(".insights-central-link").removeClass("hidden")})})}return wrapUserMenuView});define("src/extensions/insightscentral/wrapAppLayout",["src/extensions/insightscentral/insightscentralHelpers"],function(insightscentralHelpers){"use strict";function wrapAppLayout(moduleWrapper){moduleWrapper.wrapModule("appLayout",function(err,appLayout){moduleWrapper.wrap(appLayout,"showSidebar",function(originalFunc){if(insightscentralHelpers.hasAccessAsResearcher()){this.hideSidebar();return}originalFunc.apply(this)});moduleWrapper.wrap(appLayout,"showHeader",function(originalFunc){originalFunc.apply(this);this.headerView.$el.toggleClass("insights-central-mode",insightscentralHelpers.hasAccessAsResearcher())})})}return wrapAppLayout});define("src/extensions/insightscentral/wrapPermissions",["src/globals/currentProject","src/extensions/insightscentral/insightscentralHelpers"],function(currentProject,insightscentralHelpers){"use strict";function wrapPermissions(moduleWrapper){moduleWrapper.wrapModule("src/permissions",function(err,permissions){permissions.set("copy.research.projects",["superadmin","admin","regular"]);moduleWrapper.wrap(permissions,"check",function(originalFunc,permission,targetObject){var userRoleHasPermission=originalFunc(permission,targetObject);var researchRoleHasPermission;if(currentProject.id&&insightscentralHelpers.hasAccessAsResearcher()){researchRoleHasPermission=insightscentralHelpers.researcherHasPermission(permission);return userRoleHasPermission&&researchRoleHasPermission}return userRoleHasPermission})})}return wrapPermissions});define("src/extensions/insightscentral/wrapPageTour",["src/globals/currentProject"],function(currentProject){"use strict";function wrapPageTour(moduleWrapper){moduleWrapper.wrapModule("src/pageTour",function(err,pageTour){moduleWrapper.wrap(pageTour,"setTourMark",function(originalFunc,tour){if(currentProject.get("published")&&tour==="welcome"){this.remove();return}originalFunc.apply(this,Array.prototype.slice.call(arguments,1))})})}return wrapPageTour});define("css!src/extensions/insightscentral/css/insightsCentral.css",["css!src/extensions/insightscentral/css/compiled.css"],function(){});define("src/extensions/insightscentral/InsightsCentralExtension",["src/permissions","src/ModuleWrapper","src/extensions/insightscentral/models/wrapProject","src/extensions/insightscentral/views/wrapDashboardCollectionView","src/extensions/insightscentral/views/wrapDashboardView","src/extensions/insightscentral/views/wrapHeaderView","src/extensions/insightscentral/views/wrapProjectSelectionPageView","src/extensions/insightscentral/views/wrapProjectSwitcherView","src/extensions/insightscentral/views/wrapNavigationView","src/extensions/insightscentral/views/wrapUserMenuView","src/extensions/insightscentral/wrapAppLayout","src/extensions/insightscentral/wrapPermissions","src/extensions/insightscentral/wrapPageTour","css!src/extensions/insightscentral/css/insightsCentral.css"],function(permissions,ModuleWrapper,wrapProject,wrapDashboardCollectionView,wrapDashboardView,wrapHeaderView,wrapProjectSelectionPageView,wrapProjectSwitcherView,wrapNavigationView,wrapUserMenuView,wrapAppLayout,wrapPermissions,wrapPageTour){"use strict";var active=false,moduleWrapper=new ModuleWrapper;return{id:"insightsCentralExtension",isActive:function isActive(){return active},apply:function apply(){if(active){return}wrapProject(moduleWrapper);wrapDashboardCollectionView(moduleWrapper);wrapDashboardView(moduleWrapper);wrapHeaderView(moduleWrapper);wrapProjectSelectionPageView(moduleWrapper);wrapProjectSwitcherView(moduleWrapper);wrapNavigationView(moduleWrapper);wrapUserMenuView(moduleWrapper);wrapAppLayout(moduleWrapper);wrapPermissions(moduleWrapper);wrapPageTour(moduleWrapper);active=true},restore:function restore(){if(!active){return}active=false;permissions.remove("copy.research.projects");moduleWrapper.restore()}}})})();